/*
Copyright (c) 2014, American Institutes for Research. All rights reserved.
GENERATED: 11/1/2014 3:23:48 PM
MACHINE: DC1BEHERASLT1
*/

/* SOURCE FILE: tracekit.js (d49e0c2d) 9/9/2014 2:08:59 PM */

/*
 TraceKit - Cross brower stack traces - github.com/occ/TraceKit
 MIT license
*/

(function(window, undefined) {


var TraceKit = {};
var _oldTraceKit = window.TraceKit;

// global reference to slice
var _slice = [].slice;
var UNKNOWN_FUNCTION = '?';


/**
 * _has, a better form of hasOwnProperty
 * Example: _has(MainHostObject, property) === true/false
 *
 * @param {Object} host object to check property
 * @param {string} key to check
 */
function _has(object, key) {
    return Object.prototype.hasOwnProperty.call(object, key);
}

function _isUndefined(what) {
    return typeof what === 'undefined';
}

/**
 * TraceKit.noConflict: Export TraceKit out to another variable
 * Example: var TK = TraceKit.noConflict()
 */
TraceKit.noConflict = function noConflict() {
    window.TraceKit = _oldTraceKit;
    return TraceKit;
};

/**
 * TraceKit.wrap: Wrap any function in a TraceKit reporter
 * Example: func = TraceKit.wrap(func);
 *
 * @param {Function} func Function to be wrapped
 * @return {Function} The wrapped func
 */
TraceKit.wrap = function traceKitWrapper(func) {
    function wrapped() {
        try {
            return func.apply(this, arguments);
        } catch (e) {
            TraceKit.report(e);
            throw e;
        }
    }
    return wrapped;
};

/**
 * TraceKit.report: cross-browser processing of unhandled exceptions
 *
 * Syntax:
 *   TraceKit.report.subscribe(function(stackInfo) { ... })
 *   TraceKit.report.unsubscribe(function(stackInfo) { ... })
 *   TraceKit.report(exception)
 *   try { ...code... } catch(ex) { TraceKit.report(ex); }
 *
 * Supports:
 *   - Firefox: full stack trace with line numbers, plus column number
 *              on top frame; column number is not guaranteed
 *   - Opera:   full stack trace with line and column numbers
 *   - Chrome:  full stack trace with line and column numbers
 *   - Safari:  line and column number for the top frame only; some frames
 *              may be missing, and column number is not guaranteed
 *   - IE:      line and column number for the top frame only; some frames
 *              may be missing, and column number is not guaranteed
 *
 * In theory, TraceKit should work on all of the following versions:
 *   - IE5.5+ (only 8.0 tested)
 *   - Firefox 0.9+ (only 3.5+ tested)
 *   - Opera 7+ (only 10.50 tested; versions 9 and earlier may require
 *     Exceptions Have Stacktrace to be enabled in opera:config)
 *   - Safari 3+ (only 4+ tested)
 *   - Chrome 1+ (only 5+ tested)
 *   - Konqueror 3.5+ (untested)
 *
 * Requires TraceKit.computeStackTrace.
 *
 * Tries to catch all unhandled exceptions and report them to the
 * subscribed handlers. Please note that TraceKit.report will rethrow the
 * exception. This is REQUIRED in order to get a useful stack trace in IE.
 * If the exception does not reach the top of the browser, you will only
 * get a stack trace from the point where TraceKit.report was called.
 *
 * Handlers receive a stackInfo object as described in the
 * TraceKit.computeStackTrace docs.
 */
TraceKit.report = (function reportModuleWrapper() {
    var handlers = [],
        lastException = null,
        lastExceptionStack = null;

    /**
     * Add a crash handler.
     * @param {Function} handler
     */
    function subscribe(handler) {
        installGlobalHandler();
        handlers.push(handler);
    }

    /**
     * Remove a crash handler.
     * @param {Function} handler
     */
    function unsubscribe(handler) {
        for (var i = handlers.length - 1; i >= 0; --i) {
            if (handlers[i] === handler) {
                handlers.splice(i, 1);
            }
        }
    }

    /**
     * Dispatch stack information to all handlers.
     * @param {Object.<string, *>} stack
     */
    function notifyHandlers(stack, windowError) {
        var exception = null;
        if (windowError && !TraceKit.collectWindowErrors) {
          return;
        }
        for (var i in handlers) {
            if (_has(handlers, i)) {
                try {
                    handlers[i].apply(null, [stack].concat(_slice.call(arguments, 2)));
                } catch (inner) {
                    exception = inner;
                }
            }
        }

        if (exception) {
            throw exception;
        }
    }

    var _oldOnerrorHandler, _onErrorHandlerInstalled;

    /**
     * Ensures all global unhandled exceptions are recorded.
     * Supported by Gecko and IE.
     * @param {string} message Error message.
     * @param {string} url URL of script that generated the exception.
     * @param {(number|string)} lineNo The line number at which the error
     * occurred.
     */
    function traceKitWindowOnError(message, url, lineNo) {
        var stack = null;

        if (lastExceptionStack) {
            TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack, url, lineNo, message);
            stack = lastExceptionStack;
            lastExceptionStack = null;
            lastException = null;
        } else {
            var location = {
                'url': url,
                'line': lineNo
            };
            location.func = TraceKit.computeStackTrace.guessFunctionName(location.url, location.line);
            location.context = TraceKit.computeStackTrace.gatherContext(location.url, location.line);
            stack = {
                'mode': 'onerror',
                'message': message,
                'url': document.location.href,
                'stack': [location],
                'useragent': navigator.userAgent
            };
        }

        notifyHandlers(stack, 'from window.onerror');

        if (_oldOnerrorHandler) {
            return _oldOnerrorHandler.apply(this, arguments);
        }

        return false;
    }

    function installGlobalHandler ()
    {
        if (_onErrorHandlerInstalled === true) {
            return;
        }
        _oldOnerrorHandler = window.onerror;
        window.onerror = traceKitWindowOnError;
        _onErrorHandlerInstalled = true;
    }

    function installWindowHander(win) {
        
    }

    /**
     * Reports an unhandled Error to TraceKit.
     * @param {Error} ex
     */
    function report(ex) {
        var args = _slice.call(arguments, 1);
        if (lastExceptionStack) {
            if (lastException === ex) {
                return; // already caught by an inner catch block, ignore
            } else {
                var s = lastExceptionStack;
                lastExceptionStack = null;
                lastException = null;
                notifyHandlers.apply(null, [s, null].concat(args));
            }
        }

        var stack = TraceKit.computeStackTrace(ex);
        lastExceptionStack = stack;
        lastException = ex;

        // If the stack trace is incomplete, wait for 2 seconds for
        // slow slow IE to see if onerror occurs or not before reporting
        // this exception; otherwise, we will end up with an incomplete
        // stack trace
        window.setTimeout(function () {
            if (lastException === ex) {
                lastExceptionStack = null;
                lastException = null;
                notifyHandlers.apply(null, [stack, null].concat(args));
            }
        }, (stack.incomplete ? 2000 : 0));

        throw ex; // re-throw to propagate to the top level (and cause window.onerror)
    }

    report.subscribe = subscribe;
    report.unsubscribe = unsubscribe;
    return report;
}());

/**
 * TraceKit.computeStackTrace: cross-browser stack traces in JavaScript
 *
 * Syntax:
 *   s = TraceKit.computeStackTrace.ofCaller([depth])
 *   s = TraceKit.computeStackTrace(exception) // consider using TraceKit.report instead (see below)
 * Returns:
 *   s.name              - exception name
 *   s.message           - exception message
 *   s.stack[i].url      - JavaScript or HTML file URL
 *   s.stack[i].func     - function name, or empty for anonymous functions (if guessing did not work)
 *   s.stack[i].args     - arguments passed to the function, if known
 *   s.stack[i].line     - line number, if known
 *   s.stack[i].column   - column number, if known
 *   s.stack[i].context  - an array of source code lines; the middle element corresponds to the correct line#
 *   s.mode              - 'stack', 'stacktrace', 'multiline', 'callers', 'onerror', or 'failed' -- method used to collect the stack trace
 *
 * Supports:
 *   - Firefox:  full stack trace with line numbers and unreliable column
 *               number on top frame
 *   - Opera 10: full stack trace with line and column numbers
 *   - Opera 9-: full stack trace with line numbers
 *   - Chrome:   full stack trace with line and column numbers
 *   - Safari:   line and column number for the topmost stacktrace element
 *               only
 *   - IE:       no line numbers whatsoever
 *
 * Tries to guess names of anonymous functions by looking for assignments
 * in the source code. In IE and Safari, we have to guess source file names
 * by searching for function bodies inside all page scripts. This will not
 * work for scripts that are loaded cross-domain.
 * Here be dragons: some function names may be guessed incorrectly, and
 * duplicate functions may be mismatched.
 *
 * TraceKit.computeStackTrace should only be used for tracing purposes.
 * Logging of unhandled exceptions should be done with TraceKit.report,
 * which builds on top of TraceKit.computeStackTrace and provides better
 * IE support by utilizing the window.onerror event to retrieve information
 * about the top of the stack.
 *
 * Note: In IE and Safari, no stack trace is recorded on the Error object,
 * so computeStackTrace instead walks its *own* chain of callers.
 * This means that:
 *  * in Safari, some methods may be missing from the stack trace;
 *  * in IE, the topmost function in the stack trace will always be the
 *    caller of computeStackTrace.
 *
 * This is okay for tracing (because you are likely to be calling
 * computeStackTrace from the function you want to be the topmost element
 * of the stack trace anyway), but not okay for logging unhandled
 * exceptions (because your catch block will likely be far away from the
 * inner function that actually caused the exception).
 *
 * Tracing example:
 *     function trace(message) {
 *         var stackInfo = TraceKit.computeStackTrace.ofCaller();
 *         var data = message + "\n";
 *         for(var i in stackInfo.stack) {
 *             var item = stackInfo.stack[i];
 *             data += (item.func || '[anonymous]') + "() in " + item.url + ":" + (item.line || '0') + "\n";
 *         }
 *         if (window.console)
 *             console.info(data);
 *         else
 *             alert(data);
 *     }
 */
TraceKit.computeStackTrace = (function computeStackTraceWrapper() {
    var debug = false,
        sourceCache = {};

    /**
     * Attempts to retrieve source code via XMLHttpRequest, which is used
     * to look up anonymous function names.
     * @param {string} url URL of source code.
     * @return {string} Source contents.
     */
    function loadSource(url) {
        if (!TraceKit.remoteFetching) { //Only attempt request if remoteFetching is on.
            return '';
        }
        try {
            var getXHR = function() {
                try {
                    return new window.XMLHttpRequest();
                } catch (e) {
                    // explicitly bubble up the exception if not found
                    return new window.ActiveXObject('Microsoft.XMLHTTP');
                }
            };

            var request = getXHR();
            request.open('GET', url, false);
            request.send('');
            return request.responseText;
        } catch (e) {
            return '';
        }
    }

    /**
     * Retrieves source code from the source code cache.
     * @param {string} url URL of source code.
     * @return {Array.<string>} Source contents.
     */
    function getSource(url) {
        if (!_has(sourceCache, url)) {
            // URL needs to be able to fetched within the acceptable domain.  Otherwise,
            // cross-domain errors will be triggered.
            var source = '';
            if (url.indexOf(document.domain) !== -1) {
                source = loadSource(url);
            }
            sourceCache[url] = source ? source.split('\n') : [];
        }

        return sourceCache[url];
    }

    /**
     * Tries to use an externally loaded copy of source code to determine
     * the name of a function by looking at the name of the variable it was
     * assigned to, if any.
     * @param {string} url URL of source code.
     * @param {(string|number)} lineNo Line number in source code.
     * @return {string} The function name, if discoverable.
     */
    function guessFunctionName(url, lineNo) {
        var reFunctionArgNames = /function ([^(]*)\(([^)]*)\)/,
            reGuessFunction = /['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,
            line = '',
            maxLines = 10,
            source = getSource(url),
            m;

        if (!source.length) {
            return UNKNOWN_FUNCTION;
        }

        // Walk backwards from the first line in the function until we find the line which
        // matches the pattern above, which is the function definition
        for (var i = 0; i < maxLines; ++i) {
            line = source[lineNo - i] + line;

            if (!_isUndefined(line)) {
                if ((m = reGuessFunction.exec(line))) {
                    return m[1];
                } else if ((m = reFunctionArgNames.exec(line))) {
                    return m[1];
                }
            }
        }

        return UNKNOWN_FUNCTION;
    }

    /**
     * Retrieves the surrounding lines from where an exception occurred.
     * @param {string} url URL of source code.
     * @param {(string|number)} line Line number in source code to centre
     * around for context.
     * @return {?Array.<string>} Lines of source code.
     */
    function gatherContext(url, line) {
        var source = getSource(url);

        if (!source.length) {
            return null;
        }

        var context = [],
            // linesBefore & linesAfter are inclusive with the offending line.
            // if linesOfContext is even, there will be one extra line
            //   *before* the offending line.
            linesBefore = Math.floor(TraceKit.linesOfContext / 2),
            // Add one extra line if linesOfContext is odd
            linesAfter = linesBefore + (TraceKit.linesOfContext % 2),
            start = Math.max(0, line - linesBefore - 1),
            end = Math.min(source.length, line + linesAfter - 1);

        line -= 1; // convert to 0-based index

        for (var i = start; i < end; ++i) {
            if (!_isUndefined(source[i])) {
                context.push(source[i]);
            }
        }

        return context.length > 0 ? context : null;
    }

    /**
     * Escapes special characters, except for whitespace, in a string to be
     * used inside a regular expression as a string literal.
     * @param {string} text The string.
     * @return {string} The escaped string literal.
     */
    function escapeRegExp(text) {
        return text.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g, '\\$&');
    }

    /**
     * Escapes special characters in a string to be used inside a regular
     * expression as a string literal. Also ensures that HTML entities will
     * be matched the same as their literal friends.
     * @param {string} body The string.
     * @return {string} The escaped string.
     */
    function escapeCodeAsRegExpForMatchingInsideHTML(body) {
        return escapeRegExp(body).replace('<', '(?:<|&lt;)').replace('>', '(?:>|&gt;)').replace('&', '(?:&|&amp;)').replace('"', '(?:"|&quot;)').replace(/\s+/g, '\\s+');
    }

    /**
     * Determines where a code fragment occurs in the source code.
     * @param {RegExp} re The function definition.
     * @param {Array.<string>} urls A list of URLs to search.
     * @return {?Object.<string, (string|number)>} An object containing
     * the url, line, and column number of the defined function.
     */
    function findSourceInUrls(re, urls) {
        var source, m;
        for (var i = 0, j = urls.length; i < j; ++i) {
            // console.log('searching', urls[i]);
            if ((source = getSource(urls[i])).length) {
                source = source.join('\n');
                if ((m = re.exec(source))) {
                    // console.log('Found function in ' + urls[i]);

                    return {
                        'url': urls[i],
                        'line': source.substring(0, m.index).split('\n').length,
                        'column': m.index - source.lastIndexOf('\n', m.index) - 1
                    };
                }
            }
        }

        // console.log('no match');

        return null;
    }

    /**
     * Determines at which column a code fragment occurs on a line of the
     * source code.
     * @param {string} fragment The code fragment.
     * @param {string} url The URL to search.
     * @param {(string|number)} line The line number to examine.
     * @return {?number} The column number.
     */
    function findSourceInLine(fragment, url, line) {
        var source = getSource(url),
            re = new RegExp('\\b' + escapeRegExp(fragment) + '\\b'),
            m;

        line -= 1;

        if (source && source.length > line && (m = re.exec(source[line]))) {
            return m.index;
        }

        return null;
    }

    /**
     * Determines where a function was defined within the source code.
     * @param {(Function|string)} func A function reference or serialized
     * function definition.
     * @return {?Object.<string, (string|number)>} An object containing
     * the url, line, and column number of the defined function.
     */
    function findSourceByFunctionBody(func) {
        var urls = [window.location.href],
            scripts = document.getElementsByTagName('script'),
            body,
            code = '' + func,
            codeRE = /^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,
            eventRE = /^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,
            re,
            parts,
            result;

        for (var i = 0; i < scripts.length; ++i) {
            var script = scripts[i];
            if (script.src) {
                urls.push(script.src);
            }
        }

        if (!(parts = codeRE.exec(code))) {
            re = new RegExp(escapeRegExp(code).replace(/\s+/g, '\\s+'));
        }

        // not sure if this is really necessary, but I donâ€™t have a test
        // corpus large enough to confirm that and it was in the original.
        else {
            var name = parts[1] ? '\\s+' + parts[1] : '',
                args = parts[2].split(',').join('\\s*,\\s*');

            body = escapeRegExp(parts[3]).replace(/;$/, ';?'); // semicolon is inserted if the function ends with a comment.replace(/\s+/g, '\\s+');
            re = new RegExp('function' + name + '\\s*\\(\\s*' + args + '\\s*\\)\\s*{\\s*' + body + '\\s*}');
        }

        // look for a normal function definition
        if ((result = findSourceInUrls(re, urls))) {
            return result;
        }

        // look for an old-school event handler function
        if ((parts = eventRE.exec(code))) {
            var event = parts[1];
            body = escapeCodeAsRegExpForMatchingInsideHTML(parts[2]);

            // look for a function defined in HTML as an onXXX handler
            re = new RegExp('on' + event + '=[\\\'"]\\s*' + body + '\\s*[\\\'"]', 'i');

            if ((result = findSourceInUrls(re, urls[0]))) {
                return result;
            }

            // look for ???
            re = new RegExp(body);

            if ((result = findSourceInUrls(re, urls))) {
                return result;
            }
        }

        return null;
    }

    // Contents of Exception in various browsers.
    //
    // SAFARI:
    // ex.message = Can't find variable: qq
    // ex.line = 59
    // ex.sourceId = 580238192
    // ex.sourceURL = http://...
    // ex.expressionBeginOffset = 96
    // ex.expressionCaretOffset = 98
    // ex.expressionEndOffset = 98
    // ex.name = ReferenceError
    //
    // FIREFOX:
    // ex.message = qq is not defined
    // ex.fileName = http://...
    // ex.lineNumber = 59
    // ex.stack = ...stack trace... (see the example below)
    // ex.name = ReferenceError
    //
    // CHROME:
    // ex.message = qq is not defined
    // ex.name = ReferenceError
    // ex.type = not_defined
    // ex.arguments = ['aa']
    // ex.stack = ...stack trace...
    //
    // INTERNET EXPLORER:
    // ex.message = ...
    // ex.name = ReferenceError
    //
    // OPERA:
    // ex.message = ...message... (see the example below)
    // ex.name = ReferenceError
    // ex.opera#sourceloc = 11  (pretty much useless, duplicates the info in ex.message)
    // ex.stacktrace = n/a; see 'opera:config#UserPrefs|Exceptions Have Stacktrace'

    /**
     * Computes stack trace information from the stack property.
     * Chrome and Gecko use this property.
     * @param {Error} ex
     * @return {?Object.<string, *>} Stack trace information.
     */
    function computeStackTraceFromStackProp(ex) {
        if (!ex.stack) {
            return null;
        }

        var chrome = /^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,
            gecko = /^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,
            lines = ex.stack.split('\n'),
            stack = [],
            parts,
            element,
            reference = /^(.*) is undefined$/.exec(ex.message);

        for (var i = 0, j = lines.length; i < j; ++i) {
            if ((parts = gecko.exec(lines[i]))) {
                element = {
                    'url': parts[3],
                    'func': parts[1] || UNKNOWN_FUNCTION,
                    'args': parts[2] ? parts[2].split(',') : '',
                    'line': +parts[4],
                    'column': parts[5] ? +parts[5] : null
                };
            } else if ((parts = chrome.exec(lines[i]))) {
                element = {
                    'url': parts[2],
                    'func': parts[1] || UNKNOWN_FUNCTION,
                    'line': +parts[3],
                    'column': parts[4] ? +parts[4] : null
                };
            } else {
                continue;
            }

            if (!element.func && element.line) {
                element.func = guessFunctionName(element.url, element.line);
            }

            if (element.line) {
                element.context = gatherContext(element.url, element.line);
            }

            stack.push(element);
        }

        if (stack[0] && stack[0].line && !stack[0].column && reference) {
            stack[0].column = findSourceInLine(reference[1], stack[0].url, stack[0].line);
        }

        if (!stack.length) {
            return null;
        }

        return {
            'mode': 'stack',
            'name': ex.name,
            'message': ex.message,
            'url': document.location.href,
            'stack': stack,
            'useragent': navigator.userAgent
        };
    }

    /**
     * Computes stack trace information from the stacktrace property.
     * Opera 10 uses this property.
     * @param {Error} ex
     * @return {?Object.<string, *>} Stack trace information.
     */
    function computeStackTraceFromStacktraceProp(ex) {
        // Access and store the stacktrace property before doing ANYTHING
        // else to it because Opera is not very good at providing it
        // reliably in other circumstances.
        var stacktrace = ex.stacktrace;

        var testRE = / line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,
            lines = stacktrace.split('\n'),
            stack = [],
            parts;

        for (var i = 0, j = lines.length; i < j; i += 2) {
            if ((parts = testRE.exec(lines[i]))) {
                var element = {
                    'line': +parts[1],
                    'column': +parts[2],
                    'func': parts[3] || parts[4],
                    'args': parts[5] ? parts[5].split(',') : [],
                    'url': parts[6]
                };

                if (!element.func && element.line) {
                    element.func = guessFunctionName(element.url, element.line);
                }
                if (element.line) {
                    try {
                        element.context = gatherContext(element.url, element.line);
                    } catch (exc) {}
                }

                if (!element.context) {
                    element.context = [lines[i + 1]];
                }

                stack.push(element);
            }
        }

        if (!stack.length) {
            return null;
        }

        return {
            'mode': 'stacktrace',
            'name': ex.name,
            'message': ex.message,
            'url': document.location.href,
            'stack': stack,
            'useragent': navigator.userAgent
        };
    }

    /**
     * NOT TESTED.
     * Computes stack trace information from an error message that includes
     * the stack trace.
     * Opera 9 and earlier use this method if the option to show stack
     * traces is turned on in opera:config.
     * @param {Error} ex
     * @return {?Object.<string, *>} Stack information.
     */
    function computeStackTraceFromOperaMultiLineMessage(ex) {
        // Opera includes a stack trace into the exception message. An example is:
        //
        // Statement on line 3: Undefined variable: undefinedFunc
        // Backtrace:
        //   Line 3 of linked script file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.js: In function zzz
        //         undefinedFunc(a);
        //   Line 7 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html: In function yyy
        //           zzz(x, y, z);
        //   Line 3 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html: In function xxx
        //           yyy(a, a, a);
        //   Line 1 of function script
        //     try { xxx('hi'); return false; } catch(ex) { TraceKit.report(ex); }
        //   ...

        var lines = ex.message.split('\n');
        if (lines.length < 4) {
            return null;
        }

        var lineRE1 = /^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,
            lineRE2 = /^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,
            lineRE3 = /^\s*Line (\d+) of function script\s*$/i,
            stack = [],
            scripts = document.getElementsByTagName('script'),
            inlineScriptBlocks = [],
            parts,
            i,
            len,
            source;

        for (i in scripts) {
            if (_has(scripts, i) && !scripts[i].src) {
                inlineScriptBlocks.push(scripts[i]);
            }
        }

        for (i = 2, len = lines.length; i < len; i += 2) {
            var item = null;
            if ((parts = lineRE1.exec(lines[i]))) {
                item = {
                    'url': parts[2],
                    'func': parts[3],
                    'line': +parts[1]
                };
            } else if ((parts = lineRE2.exec(lines[i]))) {
                item = {
                    'url': parts[3],
                    'func': parts[4]
                };
                var relativeLine = (+parts[1]); // relative to the start of the <SCRIPT> block
                var script = inlineScriptBlocks[parts[2] - 1];
                if (script) {
                    source = getSource(item.url);
                    if (source) {
                        source = source.join('\n');
                        var pos = source.indexOf(script.innerText);
                        if (pos >= 0) {
                            item.line = relativeLine + source.substring(0, pos).split('\n').length;
                        }
                    }
                }
            } else if ((parts = lineRE3.exec(lines[i]))) {
                var url = window.location.href.replace(/#.*$/, ''),
                    line = parts[1];
                var re = new RegExp(escapeCodeAsRegExpForMatchingInsideHTML(lines[i + 1]));
                source = findSourceInUrls(re, [url]);
                item = {
                    'url': url,
                    'line': source ? source.line : line,
                    'func': ''
                };
            }

            if (item) {
                if (!item.func) {
                    item.func = guessFunctionName(item.url, item.line);
                }
                var context = gatherContext(item.url, item.line);
                var midline = (context ? context[Math.floor(context.length / 2)] : null);
                if (context && midline.replace(/^\s*/, '') === lines[i + 1].replace(/^\s*/, '')) {
                    item.context = context;
                } else {
                    // if (context) alert("Context mismatch. Correct midline:\n" + lines[i+1] + "\n\nMidline:\n" + midline + "\n\nContext:\n" + context.join("\n") + "\n\nURL:\n" + item.url);
                    item.context = [lines[i + 1]];
                }
                stack.push(item);
            }
        }
        if (!stack.length) {
            return null; // could not parse multiline exception message as Opera stack trace
        }

        return {
            'mode': 'multiline',
            'name': ex.name,
            'message': lines[0],
            'url': document.location.href,
            'stack': stack,
            'useragent': navigator.userAgent
        };
    }

    /**
     * Adds information about the first frame to incomplete stack traces.
     * Safari and IE require this to get complete data on the first frame.
     * @param {Object.<string, *>} stackInfo Stack trace information from
     * one of the compute* methods.
     * @param {string} url The URL of the script that caused an error.
     * @param {(number|string)} lineNo The line number of the script that
     * caused an error.
     * @param {string=} message The error generated by the browser, which
     * hopefully contains the name of the object that caused the error.
     * @return {boolean} Whether or not the stack information was
     * augmented.
     */
    function augmentStackTraceWithInitialElement(stackInfo, url, lineNo, message) {
        var initial = {
            'url': url,
            'line': lineNo
        };

        if (initial.url && initial.line) {
            stackInfo.incomplete = false;

            if (!initial.func) {
                initial.func = guessFunctionName(initial.url, initial.line);
            }

            if (!initial.context) {
                initial.context = gatherContext(initial.url, initial.line);
            }

            var reference = / '([^']+)' /.exec(message);
            if (reference) {
                initial.column = findSourceInLine(reference[1], initial.url, initial.line);
            }

            if (stackInfo.stack.length > 0) {
                if (stackInfo.stack[0].url === initial.url) {
                    if (stackInfo.stack[0].line === initial.line) {
                        return false; // already in stack trace
                    } else if (!stackInfo.stack[0].line && stackInfo.stack[0].func === initial.func) {
                        stackInfo.stack[0].line = initial.line;
                        stackInfo.stack[0].context = initial.context;
                        return false;
                    }
                }
            }

            stackInfo.stack.unshift(initial);
            stackInfo.partial = true;
            return true;
        } else {
            stackInfo.incomplete = true;
        }

        return false;
    }

    /**
     * Computes stack trace information by walking the arguments.caller
     * chain at the time the exception occurred. This will cause earlier
     * frames to be missed but is the only way to get any stack trace in
     * Safari and IE. The top frame is restored by
     * {@link augmentStackTraceWithInitialElement}.
     * @param {Error} ex
     * @return {?Object.<string, *>} Stack trace information.
     */
    function computeStackTraceByWalkingCallerChain(ex, depth) {
        var functionName = /function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,
            stack = [],
            funcs = {},
            recursion = false,
            parts,
            item,
            source;

        for (var curr = computeStackTraceByWalkingCallerChain.caller; curr && !recursion; curr = curr.caller) {
            if (curr === computeStackTrace || curr === TraceKit.report) {
                // console.log('skipping internal function');
                continue;
            }

            item = {
                'url': null,
                'func': UNKNOWN_FUNCTION,
                'line': null,
                'column': null
            };

            if (curr.name) {
                item.func = curr.name;
            } else if ((parts = functionName.exec(curr.toString()))) {
                item.func = parts[1];
            }

            if ((source = findSourceByFunctionBody(curr))) {
                item.url = source.url;
                item.line = source.line;

                if (item.func === UNKNOWN_FUNCTION) {
                    item.func = guessFunctionName(item.url, item.line);
                }

                var reference = / '([^']+)' /.exec(ex.message || ex.description);
                if (reference) {
                    item.column = findSourceInLine(reference[1], source.url, source.line);
                }
            }

            if (funcs['' + curr]) {
                recursion = true;
            }else{
                funcs['' + curr] = true;
            }

            stack.push(item);
        }

        if (depth) {
            // console.log('depth is ' + depth);
            // console.log('stack is ' + stack.length);
            stack.splice(0, depth);
        }

        var result = {
            'mode': 'callers',
            'name': ex.name,
            'message': ex.message,
            'url': document.location.href,
            'stack': stack,
            'useragent': navigator.userAgent
        };
        augmentStackTraceWithInitialElement(result, ex.sourceURL || ex.fileName, ex.line || ex.lineNumber, ex.message || ex.description);
        return result;
    }

    /**
     * Computes a stack trace for an exception.
     * @param {Error} ex
     * @param {(string|number)=} depth
     */
    function computeStackTrace(ex, depth) {
        var stack = null;
        depth = (depth == null ? 0 : +depth);

        try {
            // This must be tried first because Opera 10 *destroys*
            // its stacktrace property if you try to access the stack
            // property first!!
            stack = computeStackTraceFromStacktraceProp(ex);
            if (stack) {
                return stack;
            }
        } catch (e) {
            if (debug) {
                throw e;
            }
        }

        try {
            stack = computeStackTraceFromStackProp(ex);
            if (stack) {
                return stack;
            }
        } catch (e) {
            if (debug) {
                throw e;
            }
        }

        try {
            stack = computeStackTraceFromOperaMultiLineMessage(ex);
            if (stack) {
                return stack;
            }
        } catch (e) {
            if (debug) {
                throw e;
            }
        }

        try {
            stack = computeStackTraceByWalkingCallerChain(ex, depth + 1);
            if (stack) {
                return stack;
            }
        } catch (e) {
            if (debug) {
                throw e;
            }
        }

        return {
            'mode': 'failed'
        };
    }

    /**
     * Logs a stacktrace starting from the previous call and working down.
     * @param {(number|string)=} depth How many frames deep to trace.
     * @return {Object.<string, *>} Stack trace information.
     */
    function computeStackTraceOfCaller(depth) {
        depth = (depth == null ? 0 : +depth) + 1; // "+ 1" because "ofCaller" should drop one frame
        try {
            throw new Error();
        } catch (ex) {
            return computeStackTrace(ex, depth + 1);
        }
    }

    computeStackTrace.augmentStackTraceWithInitialElement = augmentStackTraceWithInitialElement;
    computeStackTrace.guessFunctionName = guessFunctionName;
    computeStackTrace.gatherContext = gatherContext;
    computeStackTrace.ofCaller = computeStackTraceOfCaller;

    return computeStackTrace;
}());

/**
 * Extends support for global error handling for asynchronous browser
 * functions. Adopted from Closure Library's errorhandler.js
 */
(function extendToAsynchronousCallbacks() {
    var _helper = function _helper(fnName) {
        var originalFn = window[fnName];
        window[fnName] = function traceKitAsyncExtension() {
            // Make a copy of the arguments
            var args = _slice.call(arguments);
            var originalCallback = args[0];
            if (typeof (originalCallback) === 'function') {
                args[0] = TraceKit.wrap(originalCallback);
            }
            // IE < 9 doesn't support .call/.apply on setInterval/setTimeout, but it
            // also only supports 2 argument and doesn't care what "this" is, so we
            // can just call the original function directly.
            if (originalFn.apply) {
                return originalFn.apply(this, args);
            } else {
                return originalFn(args[0], args[1]);
            }
        };
    };

    _helper('setTimeout');
    _helper('setInterval');
}());

//Default options:
if (!TraceKit.remoteFetching) {
  TraceKit.remoteFetching = true;
}
if (!TraceKit.collectWindowErrors) {
  TraceKit.collectWindowErrors = true;
}
if (!TraceKit.linesOfContext || TraceKit.linesOfContext < 1) {
  // 5 lines before, the offending line, 5 lines after
  TraceKit.linesOfContext = 11;
}



// Export to global object
window.TraceKit = TraceKit;

}(window));

/* SOURCE FILE: yahoo-dom-event.js (99b8450c) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
if(typeof YAHOO=="undefined"||!YAHOO){var YAHOO={};}YAHOO.namespace=function(){var b=arguments,g=null,e,c,f;for(e=0;e<b.length;e=e+1){f=(""+b[e]).split(".");g=YAHOO;for(c=(f[0]=="YAHOO")?1:0;c<f.length;c=c+1){g[f[c]]=g[f[c]]||{};g=g[f[c]];}}return g;};YAHOO.log=function(d,a,c){var b=YAHOO.widget.Logger;if(b&&b.log){return b.log(d,a,c);}else{return false;}};YAHOO.register=function(a,f,e){var k=YAHOO.env.modules,c,j,h,g,d;if(!k[a]){k[a]={versions:[],builds:[]};}c=k[a];j=e.version;h=e.build;g=YAHOO.env.listeners;c.name=a;c.version=j;c.build=h;c.versions.push(j);c.builds.push(h);c.mainClass=f;for(d=0;d<g.length;d=d+1){g[d](c);}if(f){f.VERSION=j;f.BUILD=h;}else{YAHOO.log("mainClass is undefined for module "+a,"warn");}};YAHOO.env=YAHOO.env||{modules:[],listeners:[]};YAHOO.env.getVersion=function(a){return YAHOO.env.modules[a]||null;};YAHOO.env.parseUA=function(d){var e=function(i){var j=0;return parseFloat(i.replace(/\./g,function(){return(j++==1)?"":".";}));},h=navigator,g={ie:0,opera:0,gecko:0,webkit:0,chrome:0,mobile:null,air:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,webos:0,caja:h&&h.cajaVersion,secure:false,os:null},c=d||(navigator&&navigator.userAgent),f=window&&window.location,b=f&&f.href,a;g.secure=b&&(b.toLowerCase().indexOf("https")===0);if(c){if((/windows|win32/i).test(c)){g.os="windows";}else{if((/macintosh/i).test(c)){g.os="macintosh";}else{if((/rhino/i).test(c)){g.os="rhino";}}}if((/KHTML/).test(c)){g.webkit=1;}a=c.match(/AppleWebKit\/([^\s]*)/);if(a&&a[1]){g.webkit=e(a[1]);if(/ Mobile\//.test(c)){g.mobile="Apple";a=c.match(/OS ([^\s]*)/);if(a&&a[1]){a=e(a[1].replace("_","."));}g.ios=a;g.ipad=g.ipod=g.iphone=0;a=c.match(/iPad|iPod|iPhone/);if(a&&a[0]){g[a[0].toLowerCase()]=g.ios;}}else{a=c.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/);if(a){g.mobile=a[0];}if(/webOS/.test(c)){g.mobile="WebOS";a=c.match(/webOS\/([^\s]*);/);if(a&&a[1]){g.webos=e(a[1]);}}if(/ Android/.test(c)){g.mobile="Android";a=c.match(/Android ([^\s]*);/);if(a&&a[1]){g.android=e(a[1]);}}}a=c.match(/Chrome\/([^\s]*)/);if(a&&a[1]){g.chrome=e(a[1]);}else{a=c.match(/AdobeAIR\/([^\s]*)/);if(a){g.air=a[0];}}}if(!g.webkit){a=c.match(/Opera[\s\/]([^\s]*)/);if(a&&a[1]){g.opera=e(a[1]);a=c.match(/Version\/([^\s]*)/);if(a&&a[1]){g.opera=e(a[1]);}a=c.match(/Opera Mini[^;]*/);if(a){g.mobile=a[0];}}else{a=c.match(/MSIE\s([^;]*)/);if(a&&a[1]){g.ie=e(a[1]);}else{a=c.match(/Gecko\/([^\s]*)/);if(a){g.gecko=1;a=c.match(/rv:([^\s\)]*)/);if(a&&a[1]){g.gecko=e(a[1]);}}}}}}return g;};YAHOO.env.ua=YAHOO.env.parseUA();(function(){YAHOO.namespace("util","widget","example");if("undefined"!==typeof YAHOO_config){var b=YAHOO_config.listener,a=YAHOO.env.listeners,d=true,c;if(b){for(c=0;c<a.length;c++){if(a[c]==b){d=false;break;}}if(d){a.push(b);}}}})();YAHOO.lang=YAHOO.lang||{};(function(){var f=YAHOO.lang,a=Object.prototype,c="[object Array]",h="[object Function]",i="[object Object]",b=[],g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;"},d=["toString","valueOf"],e={isArray:function(j){return a.toString.apply(j)===c;},isBoolean:function(j){return typeof j==="boolean";},isFunction:function(j){return(typeof j==="function")||a.toString.apply(j)===h;},isNull:function(j){return j===null;},isNumber:function(j){return typeof j==="number"&&isFinite(j);},isObject:function(j){return(j&&(typeof j==="object"||f.isFunction(j)))||false;},isString:function(j){return typeof j==="string";},isUndefined:function(j){return typeof j==="undefined";},_IEEnumFix:(YAHOO.env.ua.ie)?function(l,k){var j,n,m;for(j=0;j<d.length;j=j+1){n=d[j];m=k[n];if(f.isFunction(m)&&m!=a[n]){l[n]=m;}}}:function(){},escapeHTML:function(j){return j.replace(/[&<>"'\/`]/g,function(k){return g[k];});},extend:function(m,n,l){if(!n||!m){throw new Error("extend failed, please check that "+"all dependencies are included.");}var k=function(){},j;k.prototype=n.prototype;m.prototype=new k();m.prototype.constructor=m;m.superclass=n.prototype;if(n.prototype.constructor==a.constructor){n.prototype.constructor=n;}if(l){for(j in l){if(f.hasOwnProperty(l,j)){m.prototype[j]=l[j];}}f._IEEnumFix(m.prototype,l);}},augmentObject:function(n,m){if(!m||!n){throw new Error("Absorb failed, verify dependencies.");}var j=arguments,l,o,k=j[2];if(k&&k!==true){for(l=2;l<j.length;l=l+1){n[j[l]]=m[j[l]];}}else{for(o in m){if(k||!(o in n)){n[o]=m[o];}}f._IEEnumFix(n,m);}return n;},augmentProto:function(m,l){if(!l||!m){throw new Error("Augment failed, verify dependencies.");}var j=[m.prototype,l.prototype],k;for(k=2;k<arguments.length;k=k+1){j.push(arguments[k]);}f.augmentObject.apply(this,j);return m;},dump:function(j,p){var l,n,r=[],t="{...}",k="f(){...}",q=", ",m=" => ";if(!f.isObject(j)){return j+"";}else{if(j instanceof Date||("nodeType" in j&&"tagName" in j)){return j;}else{if(f.isFunction(j)){return k;}}}p=(f.isNumber(p))?p:3;if(f.isArray(j)){r.push("[");for(l=0,n=j.length;l<n;l=l+1){if(f.isObject(j[l])){r.push((p>0)?f.dump(j[l],p-1):t);}else{r.push(j[l]);}r.push(q);}if(r.length>1){r.pop();}r.push("]");}else{r.push("{");for(l in j){if(f.hasOwnProperty(j,l)){r.push(l+m);if(f.isObject(j[l])){r.push((p>0)?f.dump(j[l],p-1):t);}else{r.push(j[l]);}r.push(q);}}if(r.length>1){r.pop();}r.push("}");}return r.join("");},substitute:function(x,y,E,l){var D,C,B,G,t,u,F=[],p,z=x.length,A="dump",r=" ",q="{",m="}",n,w;for(;;){D=x.lastIndexOf(q,z);if(D<0){break;}C=x.indexOf(m,D);if(D+1>C){break;}p=x.substring(D+1,C);G=p;u=null;B=G.indexOf(r);if(B>-1){u=G.substring(B+1);G=G.substring(0,B);}t=y[G];if(E){t=E(G,t,u);}if(f.isObject(t)){if(f.isArray(t)){t=f.dump(t,parseInt(u,10));}else{u=u||"";n=u.indexOf(A);if(n>-1){u=u.substring(4);}w=t.toString();if(w===i||n>-1){t=f.dump(t,parseInt(u,10));}else{t=w;}}}else{if(!f.isString(t)&&!f.isNumber(t)){t="~-"+F.length+"-~";F[F.length]=p;}}x=x.substring(0,D)+t+x.substring(C+1);if(l===false){z=D-1;}}for(D=F.length-1;D>=0;D=D-1){x=x.replace(new RegExp("~-"+D+"-~"),"{"+F[D]+"}","g");}return x;},trim:function(j){try{return j.replace(/^\s+|\s+$/g,"");}catch(k){return j;
}},merge:function(){var n={},k=arguments,j=k.length,m;for(m=0;m<j;m=m+1){f.augmentObject(n,k[m],true);}return n;},later:function(t,k,u,n,p){t=t||0;k=k||{};var l=u,s=n,q,j;if(f.isString(u)){l=k[u];}if(!l){throw new TypeError("method undefined");}if(!f.isUndefined(n)&&!f.isArray(s)){s=[n];}q=function(){l.apply(k,s||b);};j=(p)?setInterval(q,t):setTimeout(q,t);return{interval:p,cancel:function(){if(this.interval){clearInterval(j);}else{clearTimeout(j);}}};},isValue:function(j){return(f.isObject(j)||f.isString(j)||f.isNumber(j)||f.isBoolean(j));}};f.hasOwnProperty=(a.hasOwnProperty)?function(j,k){return j&&j.hasOwnProperty&&j.hasOwnProperty(k);}:function(j,k){return !f.isUndefined(j[k])&&j.constructor.prototype[k]!==j[k];};e.augmentObject(f,e,true);YAHOO.util.Lang=f;f.augment=f.augmentProto;YAHOO.augment=f.augmentProto;YAHOO.extend=f.extend;})();YAHOO.register("yahoo",YAHOO,{version:"2.9.0",build:"2800"});(function(){YAHOO.env._id_counter=YAHOO.env._id_counter||0;var e=YAHOO.util,k=YAHOO.lang,L=YAHOO.env.ua,a=YAHOO.lang.trim,B={},F={},m=/^t(?:able|d|h)$/i,w=/color$/i,j=window.document,v=j.documentElement,C="ownerDocument",M="defaultView",U="documentElement",S="compatMode",z="offsetLeft",o="offsetTop",T="offsetParent",x="parentNode",K="nodeType",c="tagName",n="scrollLeft",H="scrollTop",p="getBoundingClientRect",V="getComputedStyle",y="currentStyle",l="CSS1Compat",A="BackCompat",E="class",f="className",i="",b=" ",R="(?:^|\\s)",J="(?= |$)",t="g",O="position",D="fixed",u="relative",I="left",N="top",Q="medium",P="borderLeftWidth",q="borderTopWidth",d=L.opera,h=L.webkit,g=L.gecko,s=L.ie;e.Dom={CUSTOM_ATTRIBUTES:(!v.hasAttribute)?{"for":"htmlFor","class":f}:{"htmlFor":"for","className":E},DOT_ATTRIBUTES:{checked:true},get:function(aa){var ac,X,ab,Z,W,G,Y=null;if(aa){if(typeof aa=="string"||typeof aa=="number"){ac=aa+"";aa=j.getElementById(aa);G=(aa)?aa.attributes:null;if(aa&&G&&G.id&&G.id.value===ac){return aa;}else{if(aa&&j.all){aa=null;X=j.all[ac];if(X&&X.length){for(Z=0,W=X.length;Z<W;++Z){if(X[Z].id===ac){return X[Z];}}}}}}else{if(e.Element&&aa instanceof e.Element){aa=aa.get("element");}else{if(!aa.nodeType&&"length" in aa){ab=[];for(Z=0,W=aa.length;Z<W;++Z){ab[ab.length]=e.Dom.get(aa[Z]);}aa=ab;}}}Y=aa;}return Y;},getComputedStyle:function(G,W){if(window[V]){return G[C][M][V](G,null)[W];}else{if(G[y]){return e.Dom.IE_ComputedStyle.get(G,W);}}},getStyle:function(G,W){return e.Dom.batch(G,e.Dom._getStyle,W);},_getStyle:function(){if(window[V]){return function(G,Y){Y=(Y==="float")?Y="cssFloat":e.Dom._toCamel(Y);var X=G.style[Y],W;if(!X){W=G[C][M][V](G,null);if(W){X=W[Y];}}return X;};}else{if(v[y]){return function(G,Y){var X;switch(Y){case"opacity":X=100;try{X=G.filters["DXImageTransform.Microsoft.Alpha"].opacity;}catch(Z){try{X=G.filters("alpha").opacity;}catch(W){}}return X/100;case"float":Y="styleFloat";default:Y=e.Dom._toCamel(Y);X=G[y]?G[y][Y]:null;return(G.style[Y]||X);}};}}}(),setStyle:function(G,W,X){e.Dom.batch(G,e.Dom._setStyle,{prop:W,val:X});},_setStyle:function(){if(!window.getComputedStyle&&j.documentElement.currentStyle){return function(W,G){var X=e.Dom._toCamel(G.prop),Y=G.val;if(W){switch(X){case"opacity":if(Y===""||Y===null||Y===1){W.style.removeAttribute("filter");}else{if(k.isString(W.style.filter)){W.style.filter="alpha(opacity="+Y*100+")";if(!W[y]||!W[y].hasLayout){W.style.zoom=1;}}}break;case"float":X="styleFloat";default:W.style[X]=Y;}}else{}};}else{return function(W,G){var X=e.Dom._toCamel(G.prop),Y=G.val;if(W){if(X=="float"){X="cssFloat";}W.style[X]=Y;}else{}};}}(),getXY:function(G){return e.Dom.batch(G,e.Dom._getXY);},_canPosition:function(G){return(e.Dom._getStyle(G,"display")!=="none"&&e.Dom._inDoc(G));},_getXY:function(W){var X,G,Z,ab,Y,aa,ac=Math.round,ad=false;if(e.Dom._canPosition(W)){Z=W[p]();ab=W[C];X=e.Dom.getDocumentScrollLeft(ab);G=e.Dom.getDocumentScrollTop(ab);ad=[Z[I],Z[N]];if(Y||aa){ad[0]-=aa;ad[1]-=Y;}if((G||X)){ad[0]+=X;ad[1]+=G;}ad[0]=ac(ad[0]);ad[1]=ac(ad[1]);}else{}return ad;},getX:function(G){var W=function(X){return e.Dom.getXY(X)[0];};return e.Dom.batch(G,W,e.Dom,true);},getY:function(G){var W=function(X){return e.Dom.getXY(X)[1];};return e.Dom.batch(G,W,e.Dom,true);},setXY:function(G,X,W){e.Dom.batch(G,e.Dom._setXY,{pos:X,noRetry:W});},_setXY:function(G,Z){var aa=e.Dom._getStyle(G,O),Y=e.Dom.setStyle,ad=Z.pos,W=Z.noRetry,ab=[parseInt(e.Dom.getComputedStyle(G,I),10),parseInt(e.Dom.getComputedStyle(G,N),10)],ac,X;ac=e.Dom._getXY(G);if(!ad||ac===false){return false;}if(aa=="static"){aa=u;Y(G,O,aa);}if(isNaN(ab[0])){ab[0]=(aa==u)?0:G[z];}if(isNaN(ab[1])){ab[1]=(aa==u)?0:G[o];}if(ad[0]!==null){Y(G,I,ad[0]-ac[0]+ab[0]+"px");}if(ad[1]!==null){Y(G,N,ad[1]-ac[1]+ab[1]+"px");}if(!W){X=e.Dom._getXY(G);if((ad[0]!==null&&X[0]!=ad[0])||(ad[1]!==null&&X[1]!=ad[1])){e.Dom._setXY(G,{pos:ad,noRetry:true});}}},setX:function(W,G){e.Dom.setXY(W,[G,null]);},setY:function(G,W){e.Dom.setXY(G,[null,W]);},getRegion:function(G){var W=function(X){var Y=false;if(e.Dom._canPosition(X)){Y=e.Region.getRegion(X);}else{}return Y;};return e.Dom.batch(G,W,e.Dom,true);},getClientWidth:function(){return e.Dom.getViewportWidth();},getClientHeight:function(){return e.Dom.getViewportHeight();},getElementsByClassName:function(ab,af,ac,ae,X,ad){af=af||"*";ac=(ac)?e.Dom.get(ac):null||j;if(!ac){return[];}var W=[],G=ac.getElementsByTagName(af),Z=e.Dom.hasClass;for(var Y=0,aa=G.length;Y<aa;++Y){if(Z(G[Y],ab)){W[W.length]=G[Y];}}if(ae){e.Dom.batch(W,ae,X,ad);}return W;},hasClass:function(W,G){return e.Dom.batch(W,e.Dom._hasClass,G);},_hasClass:function(X,W){var G=false,Y;if(X&&W){Y=e.Dom._getAttribute(X,f)||i;if(Y){Y=Y.replace(/\s+/g,b);}if(W.exec){G=W.test(Y);}else{G=W&&(b+Y+b).indexOf(b+W+b)>-1;}}else{}return G;},addClass:function(W,G){return e.Dom.batch(W,e.Dom._addClass,G);},_addClass:function(X,W){var G=false,Y;if(X&&W){Y=e.Dom._getAttribute(X,f)||i;if(!e.Dom._hasClass(X,W)){e.Dom.setAttribute(X,f,a(Y+b+W));G=true;}}else{}return G;},removeClass:function(W,G){return e.Dom.batch(W,e.Dom._removeClass,G);},_removeClass:function(Y,X){var W=false,aa,Z,G;if(Y&&X){aa=e.Dom._getAttribute(Y,f)||i;e.Dom.setAttribute(Y,f,aa.replace(e.Dom._getClassRegex(X),i));Z=e.Dom._getAttribute(Y,f);if(aa!==Z){e.Dom.setAttribute(Y,f,a(Z));W=true;if(e.Dom._getAttribute(Y,f)===""){G=(Y.hasAttribute&&Y.hasAttribute(E))?E:f;Y.removeAttribute(G);}}}else{}return W;},replaceClass:function(X,W,G){return e.Dom.batch(X,e.Dom._replaceClass,{from:W,to:G});},_replaceClass:function(Y,X){var W,ab,aa,G=false,Z;if(Y&&X){ab=X.from;aa=X.to;if(!aa){G=false;}else{if(!ab){G=e.Dom._addClass(Y,X.to);}else{if(ab!==aa){Z=e.Dom._getAttribute(Y,f)||i;W=(b+Z.replace(e.Dom._getClassRegex(ab),b+aa).replace(/\s+/g,b)).split(e.Dom._getClassRegex(aa));W.splice(1,0,b+aa);e.Dom.setAttribute(Y,f,a(W.join(i)));G=true;}}}}else{}return G;},generateId:function(G,X){X=X||"yui-gen";var W=function(Y){if(Y&&Y.id){return Y.id;}var Z=X+YAHOO.env._id_counter++;
if(Y){if(Y[C]&&Y[C].getElementById(Z)){return e.Dom.generateId(Y,Z+X);}Y.id=Z;}return Z;};return e.Dom.batch(G,W,e.Dom,true)||W.apply(e.Dom,arguments);},isAncestor:function(W,X){W=e.Dom.get(W);X=e.Dom.get(X);var G=false;if((W&&X)&&(W[K]&&X[K])){if(W.contains&&W!==X){G=W.contains(X);}else{if(W.compareDocumentPosition){G=!!(W.compareDocumentPosition(X)&16);}}}else{}return G;},inDocument:function(G,W){return e.Dom._inDoc(e.Dom.get(G),W);},_inDoc:function(W,X){var G=false;if(W&&W[c]){X=X||W[C];G=e.Dom.isAncestor(X[U],W);}else{}return G;},getElementsBy:function(W,af,ab,ad,X,ac,ae){af=af||"*";ab=(ab)?e.Dom.get(ab):null||j;var aa=(ae)?null:[],G;if(ab){G=ab.getElementsByTagName(af);for(var Y=0,Z=G.length;Y<Z;++Y){if(W(G[Y])){if(ae){aa=G[Y];break;}else{aa[aa.length]=G[Y];}}}if(ad){e.Dom.batch(aa,ad,X,ac);}}return aa;},getElementBy:function(X,G,W){return e.Dom.getElementsBy(X,G,W,null,null,null,true);},batch:function(X,ab,aa,Z){var Y=[],W=(Z)?aa:null;X=(X&&(X[c]||X.item))?X:e.Dom.get(X);if(X&&ab){if(X[c]||X.length===undefined){return ab.call(W,X,aa);}for(var G=0;G<X.length;++G){Y[Y.length]=ab.call(W||X[G],X[G],aa);}}else{return false;}return Y;},getDocumentHeight:function(){var W=(j[S]!=l||h)?j.body.scrollHeight:v.scrollHeight,G=Math.max(W,e.Dom.getViewportHeight());return G;},getDocumentWidth:function(){var W=(j[S]!=l||h)?j.body.scrollWidth:v.scrollWidth,G=Math.max(W,e.Dom.getViewportWidth());return G;},getViewportHeight:function(){var G=self.innerHeight,W=j[S];if((W||s)&&!d){G=(W==l)?v.clientHeight:j.body.clientHeight;}return G;},getViewportWidth:function(){var G=self.innerWidth,W=j[S];if(W||s){G=(W==l)?v.clientWidth:j.body.clientWidth;}return G;},getAncestorBy:function(G,W){while((G=G[x])){if(e.Dom._testElement(G,W)){return G;}}return null;},getAncestorByClassName:function(W,G){W=e.Dom.get(W);if(!W){return null;}var X=function(Y){return e.Dom.hasClass(Y,G);};return e.Dom.getAncestorBy(W,X);},getAncestorByTagName:function(W,G){W=e.Dom.get(W);if(!W){return null;}var X=function(Y){return Y[c]&&Y[c].toUpperCase()==G.toUpperCase();};return e.Dom.getAncestorBy(W,X);},getPreviousSiblingBy:function(G,W){while(G){G=G.previousSibling;if(e.Dom._testElement(G,W)){return G;}}return null;},getPreviousSibling:function(G){G=e.Dom.get(G);if(!G){return null;}return e.Dom.getPreviousSiblingBy(G);},getNextSiblingBy:function(G,W){while(G){G=G.nextSibling;if(e.Dom._testElement(G,W)){return G;}}return null;},getNextSibling:function(G){G=e.Dom.get(G);if(!G){return null;}return e.Dom.getNextSiblingBy(G);},getFirstChildBy:function(G,X){var W=(e.Dom._testElement(G.firstChild,X))?G.firstChild:null;return W||e.Dom.getNextSiblingBy(G.firstChild,X);},getFirstChild:function(G,W){G=e.Dom.get(G);if(!G){return null;}return e.Dom.getFirstChildBy(G);},getLastChildBy:function(G,X){if(!G){return null;}var W=(e.Dom._testElement(G.lastChild,X))?G.lastChild:null;return W||e.Dom.getPreviousSiblingBy(G.lastChild,X);},getLastChild:function(G){G=e.Dom.get(G);return e.Dom.getLastChildBy(G);},getChildrenBy:function(W,Y){var X=e.Dom.getFirstChildBy(W,Y),G=X?[X]:[];e.Dom.getNextSiblingBy(X,function(Z){if(!Y||Y(Z)){G[G.length]=Z;}return false;});return G;},getChildren:function(G){G=e.Dom.get(G);if(!G){}return e.Dom.getChildrenBy(G);},getDocumentScrollLeft:function(G){G=G||j;return Math.max(G[U].scrollLeft,G.body.scrollLeft);},getDocumentScrollTop:function(G){G=G||j;return Math.max(G[U].scrollTop,G.body.scrollTop);},insertBefore:function(W,G){W=e.Dom.get(W);G=e.Dom.get(G);if(!W||!G||!G[x]){return null;}return G[x].insertBefore(W,G);},insertAfter:function(W,G){W=e.Dom.get(W);G=e.Dom.get(G);if(!W||!G||!G[x]){return null;}if(G.nextSibling){return G[x].insertBefore(W,G.nextSibling);}else{return G[x].appendChild(W);}},getClientRegion:function(){var X=e.Dom.getDocumentScrollTop(),W=e.Dom.getDocumentScrollLeft(),Y=e.Dom.getViewportWidth()+W,G=e.Dom.getViewportHeight()+X;return new e.Region(X,Y,G,W);},setAttribute:function(W,G,X){e.Dom.batch(W,e.Dom._setAttribute,{attr:G,val:X});},_setAttribute:function(X,W){var G=e.Dom._toCamel(W.attr),Y=W.val;if(X&&X.setAttribute){if(e.Dom.DOT_ATTRIBUTES[G]&&X.tagName&&X.tagName!="BUTTON"){X[G]=Y;}else{G=e.Dom.CUSTOM_ATTRIBUTES[G]||G;X.setAttribute(G,Y);}}else{}},getAttribute:function(W,G){return e.Dom.batch(W,e.Dom._getAttribute,G);},_getAttribute:function(W,G){var X;G=e.Dom.CUSTOM_ATTRIBUTES[G]||G;if(e.Dom.DOT_ATTRIBUTES[G]){X=W[G];}else{if(W&&"getAttribute" in W){if(/^(?:href|src)$/.test(G)){X=W.getAttribute(G,2);}else{X=W.getAttribute(G);}}else{}}return X;},_toCamel:function(W){var X=B;function G(Y,Z){return Z.toUpperCase();}return X[W]||(X[W]=W.indexOf("-")===-1?W:W.replace(/-([a-z])/gi,G));},_getClassRegex:function(W){var G;if(W!==undefined){if(W.exec){G=W;}else{G=F[W];if(!G){W=W.replace(e.Dom._patterns.CLASS_RE_TOKENS,"\\$1");W=W.replace(/\s+/g,b);G=F[W]=new RegExp(R+W+J,t);}}}return G;},_patterns:{ROOT_TAG:/^body|html$/i,CLASS_RE_TOKENS:/([\.\(\)\^\$\*\+\?\|\[\]\{\}\\])/g},_testElement:function(G,W){return G&&G[K]==1&&(!W||W(G));},_calcBorders:function(X,Y){var W=parseInt(e.Dom[V](X,q),10)||0,G=parseInt(e.Dom[V](X,P),10)||0;if(g){if(m.test(X[c])){W=0;G=0;}}Y[0]+=G;Y[1]+=W;return Y;}};var r=e.Dom[V];if(L.opera){e.Dom[V]=function(W,G){var X=r(W,G);if(w.test(G)){X=e.Dom.Color.toRGB(X);}return X;};}if(L.webkit){e.Dom[V]=function(W,G){var X=r(W,G);if(X==="rgba(0, 0, 0, 0)"){X="transparent";}return X;};}if(L.ie&&L.ie>=8){e.Dom.DOT_ATTRIBUTES.type=true;}})();YAHOO.util.Region=function(d,e,a,c){this.top=d;this.y=d;this[1]=d;this.right=e;this.bottom=a;this.left=c;this.x=c;this[0]=c;this.width=this.right-this.left;this.height=this.bottom-this.top;};YAHOO.util.Region.prototype.contains=function(a){return(a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom);};YAHOO.util.Region.prototype.getArea=function(){return((this.bottom-this.top)*(this.right-this.left));};YAHOO.util.Region.prototype.intersect=function(f){var d=Math.max(this.top,f.top),e=Math.min(this.right,f.right),a=Math.min(this.bottom,f.bottom),c=Math.max(this.left,f.left);
if(a>=d&&e>=c){return new YAHOO.util.Region(d,e,a,c);}else{return null;}};YAHOO.util.Region.prototype.union=function(f){var d=Math.min(this.top,f.top),e=Math.max(this.right,f.right),a=Math.max(this.bottom,f.bottom),c=Math.min(this.left,f.left);return new YAHOO.util.Region(d,e,a,c);};YAHOO.util.Region.prototype.toString=function(){return("Region {"+"top: "+this.top+", right: "+this.right+", bottom: "+this.bottom+", left: "+this.left+", height: "+this.height+", width: "+this.width+"}");};YAHOO.util.Region.getRegion=function(e){var g=YAHOO.util.Dom.getXY(e),d=g[1],f=g[0]+e.offsetWidth,a=g[1]+e.offsetHeight,c=g[0];return new YAHOO.util.Region(d,f,a,c);};YAHOO.util.Point=function(a,b){if(YAHOO.lang.isArray(a)){b=a[1];a=a[0];}YAHOO.util.Point.superclass.constructor.call(this,b,a,b,a);};YAHOO.extend(YAHOO.util.Point,YAHOO.util.Region);(function(){var b=YAHOO.util,a="clientTop",f="clientLeft",j="parentNode",k="right",w="hasLayout",i="px",u="opacity",l="auto",d="borderLeftWidth",g="borderTopWidth",p="borderRightWidth",v="borderBottomWidth",s="visible",q="transparent",n="height",e="width",h="style",t="currentStyle",r=/^width|height$/,o=/^(\d[.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz|%){1}?/i,m={get:function(x,z){var y="",A=x[t][z];if(z===u){y=b.Dom.getStyle(x,u);}else{if(!A||(A.indexOf&&A.indexOf(i)>-1)){y=A;}else{if(b.Dom.IE_COMPUTED[z]){y=b.Dom.IE_COMPUTED[z](x,z);}else{if(o.test(A)){y=b.Dom.IE.ComputedStyle.getPixel(x,z);}else{y=A;}}}}return y;},getOffset:function(z,E){var B=z[t][E],x=E.charAt(0).toUpperCase()+E.substr(1),C="offset"+x,y="pixel"+x,A="",D;if(B==l){D=z[C];if(D===undefined){A=0;}A=D;if(r.test(E)){z[h][E]=D;if(z[C]>D){A=D-(z[C]-D);}z[h][E]=l;}}else{if(!z[h][y]&&!z[h][E]){z[h][E]=B;}A=z[h][y];}return A+i;},getBorderWidth:function(x,z){var y=null;if(!x[t][w]){x[h].zoom=1;}switch(z){case g:y=x[a];break;case v:y=x.offsetHeight-x.clientHeight-x[a];break;case d:y=x[f];break;case p:y=x.offsetWidth-x.clientWidth-x[f];break;}return y+i;},getPixel:function(y,x){var A=null,B=y[t][k],z=y[t][x];y[h][k]=z;A=y[h].pixelRight;y[h][k]=B;return A+i;},getMargin:function(y,x){var z;if(y[t][x]==l){z=0+i;}else{z=b.Dom.IE.ComputedStyle.getPixel(y,x);}return z;},getVisibility:function(y,x){var z;while((z=y[t])&&z[x]=="inherit"){y=y[j];}return(z)?z[x]:s;},getColor:function(y,x){return b.Dom.Color.toRGB(y[t][x])||q;},getBorderColor:function(y,x){var z=y[t],A=z[x]||z.color;return b.Dom.Color.toRGB(b.Dom.Color.toHex(A));}},c={};c.top=c.right=c.bottom=c.left=c[e]=c[n]=m.getOffset;c.color=m.getColor;c[g]=c[p]=c[v]=c[d]=m.getBorderWidth;c.marginTop=c.marginRight=c.marginBottom=c.marginLeft=m.getMargin;c.visibility=m.getVisibility;c.borderColor=c.borderTopColor=c.borderRightColor=c.borderBottomColor=c.borderLeftColor=m.getBorderColor;b.Dom.IE_COMPUTED=c;b.Dom.IE_ComputedStyle=m;})();(function(){var c="toString",a=parseInt,b=RegExp,d=YAHOO.util;d.Dom.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(e){if(!d.Dom.Color.re_RGB.test(e)){e=d.Dom.Color.toHex(e);}if(d.Dom.Color.re_hex.exec(e)){e="rgb("+[a(b.$1,16),a(b.$2,16),a(b.$3,16)].join(", ")+")";}return e;},toHex:function(f){f=d.Dom.Color.KEYWORDS[f]||f;if(d.Dom.Color.re_RGB.exec(f)){f=[Number(b.$1).toString(16),Number(b.$2).toString(16),Number(b.$3).toString(16)];for(var e=0;e<f.length;e++){if(f[e].length<2){f[e]="0"+f[e];}}f=f.join("");}if(f.length<6){f=f.replace(d.Dom.Color.re_hex3,"$1$1");}if(f!=="transparent"&&f.indexOf("#")<0){f="#"+f;}return f.toUpperCase();}};}());YAHOO.register("dom",YAHOO.util.Dom,{version:"2.9.0",build:"2800"});YAHOO.util.CustomEvent=function(d,c,b,a,e){this.type=d;this.scope=c||window;this.silent=b;this.fireOnce=e;this.fired=false;this.firedWith=null;this.signature=a||YAHOO.util.CustomEvent.LIST;this.subscribers=[];if(!this.silent){}var f="_YUICEOnSubscribe";if(d!==f){this.subscribeEvent=new YAHOO.util.CustomEvent(f,this,true);}this.lastError=null;};YAHOO.util.CustomEvent.LIST=0;YAHOO.util.CustomEvent.FLAT=1;YAHOO.util.CustomEvent.prototype={subscribe:function(b,c,d){if(!b){throw new Error("Invalid callback for subscriber to '"+this.type+"'");}if(this.subscribeEvent){this.subscribeEvent.fire(b,c,d);}var a=new YAHOO.util.Subscriber(b,c,d);if(this.fireOnce&&this.fired){this.notify(a,this.firedWith);}else{this.subscribers.push(a);}},unsubscribe:function(d,f){if(!d){return this.unsubscribeAll();}var e=false;for(var b=0,a=this.subscribers.length;b<a;++b){var c=this.subscribers[b];if(c&&c.contains(d,f)){this._delete(b);e=true;}}return e;},fire:function(){this.lastError=null;var h=[],a=this.subscribers.length;var d=[].slice.call(arguments,0),c=true,f,b=false;if(this.fireOnce){if(this.fired){return true;}else{this.firedWith=d;}}this.fired=true;if(!a&&this.silent){return true;}if(!this.silent){}var e=this.subscribers.slice();for(f=0;f<a;++f){var g=e[f];if(!g||!g.fn){b=true;}else{c=this.notify(g,d);if(false===c){if(!this.silent){}break;}}}return(c!==false);},notify:function(g,c){var b,i=null,f=g.getScope(this.scope),a=YAHOO.util.Event.throwErrors;if(!this.silent){}if(this.signature==YAHOO.util.CustomEvent.FLAT){if(c.length>0){i=c[0];}try{b=g.fn.call(f,i,g.obj);}catch(h){this.lastError=h;if(a){throw h;}}}else{try{b=g.fn.call(f,this.type,c,g.obj);}catch(d){this.lastError=d;if(a){throw d;}}}return b;},unsubscribeAll:function(){var a=this.subscribers.length,b;for(b=a-1;b>-1;b--){this._delete(b);}this.subscribers=[];return a;},_delete:function(a){var b=this.subscribers[a];if(b){delete b.fn;delete b.obj;}this.subscribers.splice(a,1);},toString:function(){return"CustomEvent: "+"'"+this.type+"', "+"context: "+this.scope;}};YAHOO.util.Subscriber=function(a,b,c){this.fn=a;this.obj=YAHOO.lang.isUndefined(b)?null:b;this.overrideContext=c;};YAHOO.util.Subscriber.prototype.getScope=function(a){if(this.overrideContext){if(this.overrideContext===true){return this.obj;}else{return this.overrideContext;}}return a;};YAHOO.util.Subscriber.prototype.contains=function(a,b){if(b){return(this.fn==a&&this.obj==b);}else{return(this.fn==a);}};YAHOO.util.Subscriber.prototype.toString=function(){return"Subscriber { obj: "+this.obj+", overrideContext: "+(this.overrideContext||"no")+" }";};if(!YAHOO.util.Event){YAHOO.util.Event=function(){var g=false,h=[],j=[],a=0,e=[],b=0,c={63232:38,63233:40,63234:37,63235:39,63276:33,63277:34,25:9},d=YAHOO.env.ua.ie,f="focusin",i="focusout";return{POLL_RETRYS:500,POLL_INTERVAL:40,EL:0,TYPE:1,FN:2,WFN:3,UNLOAD_OBJ:3,ADJ_SCOPE:4,OBJ:5,OVERRIDE:6,CAPTURE:7,lastError:null,isSafari:YAHOO.env.ua.webkit,webkit:YAHOO.env.ua.webkit,isIE:d,_interval:null,_dri:null,_specialTypes:{focusin:(d?"focusin":"focus"),focusout:(d?"focusout":"blur")},DOMReady:false,throwErrors:false,startInterval:function(){if(!this._interval){this._interval=YAHOO.lang.later(this.POLL_INTERVAL,this,this._tryPreloadAttach,null,true);}},onAvailable:function(q,m,o,p,n){var k=(YAHOO.lang.isString(q))?[q]:q;for(var l=0;l<k.length;l=l+1){e.push({id:k[l],fn:m,obj:o,overrideContext:p,checkReady:n});}a=this.POLL_RETRYS;this.startInterval();},onContentReady:function(n,k,l,m){this.onAvailable(n,k,l,m,true);},onDOMReady:function(){this.DOMReadyEvent.subscribe.apply(this.DOMReadyEvent,arguments);},_addListener:function(m,k,v,p,t,y){if(!v||!v.call){return false;}if(this._isValidCollection(m)){var w=true;for(var q=0,s=m.length;q<s;++q){w=this.on(m[q],k,v,p,t)&&w;}return w;}else{if(YAHOO.lang.isString(m)){var o=this.getEl(m);if(o){m=o;}else{this.onAvailable(m,function(){YAHOO.util.Event._addListener(m,k,v,p,t,y);});return true;}}}if(!m){return false;}if("unload"==k&&p!==this){j[j.length]=[m,k,v,p,t];return true;}var l=m;if(t){if(t===true){l=p;}else{l=t;}}var n=function(z){return v.call(l,YAHOO.util.Event.getEvent(z,m),p);};var x=[m,k,v,n,l,p,t,y];var r=h.length;h[r]=x;try{this._simpleAdd(m,k,n,y);}catch(u){this.lastError=u;this.removeListener(m,k,v);return false;}return true;},_getType:function(k){return this._specialTypes[k]||k;},addListener:function(m,p,l,n,o){var k=((p==f||p==i)&&!YAHOO.env.ua.ie)?true:false;return this._addListener(m,this._getType(p),l,n,o,k);},addFocusListener:function(l,k,m,n){return this.on(l,f,k,m,n);},removeFocusListener:function(l,k){return this.removeListener(l,f,k);},addBlurListener:function(l,k,m,n){return this.on(l,i,k,m,n);},removeBlurListener:function(l,k){return this.removeListener(l,i,k);},removeListener:function(l,k,r){var m,p,u;k=this._getType(k);if(typeof l=="string"){l=this.getEl(l);}else{if(this._isValidCollection(l)){var s=true;for(m=l.length-1;m>-1;m--){s=(this.removeListener(l[m],k,r)&&s);}return s;}}if(!r||!r.call){return this.purgeElement(l,false,k);}if("unload"==k){for(m=j.length-1;m>-1;m--){u=j[m];if(u&&u[0]==l&&u[1]==k&&u[2]==r){j.splice(m,1);return true;}}return false;}var n=null;var o=arguments[3];if("undefined"===typeof o){o=this._getCacheIndex(h,l,k,r);}if(o>=0){n=h[o];}if(!l||!n){return false;}var t=n[this.CAPTURE]===true?true:false;try{this._simpleRemove(l,k,n[this.WFN],t);}catch(q){this.lastError=q;return false;}delete h[o][this.WFN];delete h[o][this.FN];h.splice(o,1);return true;},getTarget:function(m,l){var k=m.target||m.srcElement;return this.resolveTextNode(k);},resolveTextNode:function(l){try{if(l&&3==l.nodeType){return l.parentNode;}}catch(k){return null;}return l;},getPageX:function(l){var k=l.pageX;if(!k&&0!==k){k=l.clientX||0;if(this.isIE){k+=this._getScrollLeft();}}return k;},getPageY:function(k){var l=k.pageY;if(!l&&0!==l){l=k.clientY||0;if(this.isIE){l+=this._getScrollTop();}}return l;},getXY:function(k){return[this.getPageX(k),this.getPageY(k)];},getRelatedTarget:function(l){var k=l.relatedTarget;
if(!k){if(l.type=="mouseout"){k=l.toElement;}else{if(l.type=="mouseover"){k=l.fromElement;}}}return this.resolveTextNode(k);},getTime:function(m){if(!m.time){var l=new Date().getTime();try{m.time=l;}catch(k){this.lastError=k;return l;}}return m.time;},stopEvent:function(k){this.stopPropagation(k);this.preventDefault(k);},stopPropagation:function(k){if(k.stopPropagation){k.stopPropagation();}else{k.cancelBubble=true;}},preventDefault:function(k){if(k.preventDefault){k.preventDefault();}else{k.returnValue=false;}},getEvent:function(m,k){var l=m||window.event;if(!l){var n=this.getEvent.caller;while(n){l=n.arguments[0];if(l&&Event==l.constructor){break;}n=n.caller;}}return l;},getCharCode:function(l){var k=l.keyCode||l.charCode||0;if(YAHOO.env.ua.webkit&&(k in c)){k=c[k];}return k;},_getCacheIndex:function(n,q,r,p){for(var o=0,m=n.length;o<m;o=o+1){var k=n[o];if(k&&k[this.FN]==p&&k[this.EL]==q&&k[this.TYPE]==r){return o;}}return -1;},generateId:function(k){var l=k.id;if(!l){l="yuievtautoid-"+b;++b;k.id=l;}return l;},_isValidCollection:function(l){try{return(l&&typeof l!=="string"&&l.length&&!l.tagName&&!l.alert&&typeof l[0]!=="undefined");}catch(k){return false;}},elCache:{},getEl:function(k){return(typeof k==="string")?document.getElementById(k):k;},clearCache:function(){},DOMReadyEvent:new YAHOO.util.CustomEvent("DOMReady",YAHOO,0,0,1),_load:function(l){if(!g){g=true;var k=YAHOO.util.Event;k._ready();k._tryPreloadAttach();}},_ready:function(l){var k=YAHOO.util.Event;if(!k.DOMReady){k.DOMReady=true;k.DOMReadyEvent.fire();k._simpleRemove(document,"DOMContentLoaded",k._ready);}},_tryPreloadAttach:function(){if(e.length===0){a=0;if(this._interval){this._interval.cancel();this._interval=null;}return;}if(this.locked){return;}if(this.isIE){if(!this.DOMReady){this.startInterval();return;}}this.locked=true;var q=!g;if(!q){q=(a>0&&e.length>0);}var p=[];var r=function(t,u){var s=t;if(u.overrideContext){if(u.overrideContext===true){s=u.obj;}else{s=u.overrideContext;}}u.fn.call(s,u.obj);};var l,k,o,n,m=[];for(l=0,k=e.length;l<k;l=l+1){o=e[l];if(o){n=this.getEl(o.id);if(n){if(o.checkReady){if(g||n.nextSibling||!q){m.push(o);e[l]=null;}}else{r(n,o);e[l]=null;}}else{p.push(o);}}}for(l=0,k=m.length;l<k;l=l+1){o=m[l];r(this.getEl(o.id),o);}a--;if(q){for(l=e.length-1;l>-1;l--){o=e[l];if(!o||!o.id){e.splice(l,1);}}this.startInterval();}else{if(this._interval){this._interval.cancel();this._interval=null;}}this.locked=false;},purgeElement:function(p,q,s){var n=(YAHOO.lang.isString(p))?this.getEl(p):p;var r=this.getListeners(n,s),o,k;if(r){for(o=r.length-1;o>-1;o--){var m=r[o];this.removeListener(n,m.type,m.fn);}}if(q&&n&&n.childNodes){for(o=0,k=n.childNodes.length;o<k;++o){this.purgeElement(n.childNodes[o],q,s);}}},getListeners:function(n,k){var q=[],m;if(!k){m=[h,j];}else{if(k==="unload"){m=[j];}else{k=this._getType(k);m=[h];}}var s=(YAHOO.lang.isString(n))?this.getEl(n):n;for(var p=0;p<m.length;p=p+1){var u=m[p];if(u){for(var r=0,t=u.length;r<t;++r){var o=u[r];if(o&&o[this.EL]===s&&(!k||k===o[this.TYPE])){q.push({type:o[this.TYPE],fn:o[this.FN],obj:o[this.OBJ],adjust:o[this.OVERRIDE],scope:o[this.ADJ_SCOPE],index:r});}}}}return(q.length)?q:null;},_unload:function(s){var m=YAHOO.util.Event,p,o,n,r,q,t=j.slice(),k;for(p=0,r=j.length;p<r;++p){n=t[p];if(n){try{k=window;if(n[m.ADJ_SCOPE]){if(n[m.ADJ_SCOPE]===true){k=n[m.UNLOAD_OBJ];}else{k=n[m.ADJ_SCOPE];}}n[m.FN].call(k,m.getEvent(s,n[m.EL]),n[m.UNLOAD_OBJ]);}catch(w){}t[p]=null;}}n=null;k=null;j=null;if(h){for(o=h.length-1;o>-1;o--){n=h[o];if(n){try{m.removeListener(n[m.EL],n[m.TYPE],n[m.FN],o);}catch(v){}}}n=null;}try{m._simpleRemove(window,"unload",m._unload);m._simpleRemove(window,"load",m._load);}catch(u){}},_getScrollLeft:function(){return this._getScroll()[1];},_getScrollTop:function(){return this._getScroll()[0];},_getScroll:function(){var k=document.documentElement,l=document.body;if(k&&(k.scrollTop||k.scrollLeft)){return[k.scrollTop,k.scrollLeft];}else{if(l){return[l.scrollTop,l.scrollLeft];}else{return[0,0];}}},regCE:function(){},_simpleAdd:function(){if(window.addEventListener){return function(m,n,l,k){m.addEventListener(n,l,(k));};}else{if(window.attachEvent){return function(m,n,l,k){m.attachEvent("on"+n,l);};}else{return function(){};}}}(),_simpleRemove:function(){if(window.removeEventListener){return function(m,n,l,k){m.removeEventListener(n,l,(k));};}else{if(window.detachEvent){return function(l,m,k){l.detachEvent("on"+m,k);};}else{return function(){};}}}()};}();(function(){var a=YAHOO.util.Event;a.on=a.addListener;a.onFocus=a.addFocusListener;a.onBlur=a.addBlurListener;
/*! DOMReady: based on work by: Dean Edwards/John Resig/Matthias Miller/Diego Perini */
if(a.isIE){if(self!==self.top){document.onreadystatechange=function(){if(document.readyState=="complete"){document.onreadystatechange=null;a._ready();}};}else{YAHOO.util.Event.onDOMReady(YAHOO.util.Event._tryPreloadAttach,YAHOO.util.Event,true);var b=document.createElement("p");a._dri=setInterval(function(){try{b.doScroll("left");clearInterval(a._dri);a._dri=null;a._ready();b=null;}catch(c){}},a.POLL_INTERVAL);}}else{if(a.webkit&&a.webkit<525){a._dri=setInterval(function(){var c=document.readyState;if("loaded"==c||"complete"==c){clearInterval(a._dri);a._dri=null;a._ready();}},a.POLL_INTERVAL);}else{a._simpleAdd(document,"DOMContentLoaded",a._ready);}}a._simpleAdd(window,"load",a._load);a._simpleAdd(window,"unload",a._unload);a._tryPreloadAttach();})();}YAHOO.util.EventProvider=function(){};YAHOO.util.EventProvider.prototype={__yui_events:null,__yui_subscribers:null,subscribe:function(a,c,f,e){this.__yui_events=this.__yui_events||{};var d=this.__yui_events[a];if(d){d.subscribe(c,f,e);}else{this.__yui_subscribers=this.__yui_subscribers||{};var b=this.__yui_subscribers;if(!b[a]){b[a]=[];}b[a].push({fn:c,obj:f,overrideContext:e});}},unsubscribe:function(c,e,g){this.__yui_events=this.__yui_events||{};var a=this.__yui_events;if(c){var f=a[c];if(f){return f.unsubscribe(e,g);}}else{var b=true;for(var d in a){if(YAHOO.lang.hasOwnProperty(a,d)){b=b&&a[d].unsubscribe(e,g);
}}return b;}return false;},unsubscribeAll:function(a){return this.unsubscribe(a);},createEvent:function(b,g){this.__yui_events=this.__yui_events||{};var e=g||{},d=this.__yui_events,f;if(d[b]){}else{f=new YAHOO.util.CustomEvent(b,e.scope||this,e.silent,YAHOO.util.CustomEvent.FLAT,e.fireOnce);d[b]=f;if(e.onSubscribeCallback){f.subscribeEvent.subscribe(e.onSubscribeCallback);}this.__yui_subscribers=this.__yui_subscribers||{};var a=this.__yui_subscribers[b];if(a){for(var c=0;c<a.length;++c){f.subscribe(a[c].fn,a[c].obj,a[c].overrideContext);}}}return d[b];},fireEvent:function(b){this.__yui_events=this.__yui_events||{};var d=this.__yui_events[b];if(!d){return null;}var a=[];for(var c=1;c<arguments.length;++c){a.push(arguments[c]);}return d.fire.apply(d,a);},hasEvent:function(a){if(this.__yui_events){if(this.__yui_events[a]){return true;}}return false;}};(function(){var a=YAHOO.util.Event,c=YAHOO.lang;YAHOO.util.KeyListener=function(d,i,e,f){if(!d){}else{if(!i){}else{if(!e){}}}if(!f){f=YAHOO.util.KeyListener.KEYDOWN;}var g=new YAHOO.util.CustomEvent("keyPressed");this.enabledEvent=new YAHOO.util.CustomEvent("enabled");this.disabledEvent=new YAHOO.util.CustomEvent("disabled");if(c.isString(d)){d=document.getElementById(d);}if(c.isFunction(e)){g.subscribe(e);}else{g.subscribe(e.fn,e.scope,e.correctScope);}function h(o,n){if(!i.shift){i.shift=false;}if(!i.alt){i.alt=false;}if(!i.ctrl){i.ctrl=false;}if(o.shiftKey==i.shift&&o.altKey==i.alt&&o.ctrlKey==i.ctrl){var j,m=i.keys,l;if(YAHOO.lang.isArray(m)){for(var k=0;k<m.length;k++){j=m[k];l=a.getCharCode(o);if(j==l){g.fire(l,o);break;}}}else{l=a.getCharCode(o);if(m==l){g.fire(l,o);}}}}this.enable=function(){if(!this.enabled){a.on(d,f,h);this.enabledEvent.fire(i);}this.enabled=true;};this.disable=function(){if(this.enabled){a.removeListener(d,f,h);this.disabledEvent.fire(i);}this.enabled=false;};this.toString=function(){return"KeyListener ["+i.keys+"] "+d.tagName+(d.id?"["+d.id+"]":"");};};var b=YAHOO.util.KeyListener;b.KEYDOWN="keydown";b.KEYUP="keyup";b.KEY={ALT:18,BACK_SPACE:8,CAPS_LOCK:20,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,META:224,NUM_LOCK:144,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PRINTSCREEN:44,RIGHT:39,SCROLL_LOCK:145,SHIFT:16,SPACE:32,TAB:9,UP:38};})();YAHOO.register("event",YAHOO.util.Event,{version:"2.9.0",build:"2800"});YAHOO.register("yahoo-dom-event", YAHOO, {version: "2.9.0", build: "2800"});

/* SOURCE FILE: event-mouseenter-min.js (627b721f) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
(function(){var b=YAHOO.util.Event,g=YAHOO.lang,e=b.addListener,f=b.removeListener,c=b.getListeners,d=[],h={mouseenter:"mouseover",mouseleave:"mouseout"},a=function(n,m,l){var j=b._getCacheIndex(d,n,m,l),i,k;if(j>=0){i=d[j];}if(n&&i){k=f.call(b,i[0],m,i[3]);if(k){delete d[j][2];delete d[j][3];d.splice(j,1);}}return k;};g.augmentObject(b._specialTypes,h);g.augmentObject(b,{_createMouseDelegate:function(i,j,k){return function(q,m){var p=this,l=b.getRelatedTarget(q),o,n;if(p!=l&&!YAHOO.util.Dom.isAncestor(p,l)){o=p;if(k){if(k===true){o=j;}else{o=k;}}n=[q,j];if(m){n.splice(1,0,p,m);}return i.apply(o,n);}};},addListener:function(m,l,k,n,o){var i,j;if(h[l]){i=b._createMouseDelegate(k,n,o);i.mouseDelegate=true;d.push([m,l,k,i]);j=e.call(b,m,l,i);}else{j=e.apply(b,arguments);}return j;},removeListener:function(l,k,j){var i;if(h[k]){i=a.apply(b,arguments);}else{i=f.apply(b,arguments);}return i;},getListeners:function(p,o){var n=[],r,m=(o==="mouseover"||o==="mouseout"),q,k,j;if(o&&(m||h[o])){r=c.call(b,p,this._getType(o));if(r){for(k=r.length-1;k>-1;k--){j=r[k];q=j.fn.mouseDelegate;if((h[o]&&q)||(m&&!q)){n.push(j);}}}}else{n=c.apply(b,arguments);}return(n&&n.length)?n:null;}},true);b.on=b.addListener;}());YAHOO.register("event-mouseenter",YAHOO.util.Event,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: event-delegate-min.js (dd1202b0) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
(function(){var A=YAHOO.util.Event,C=YAHOO.lang,B=[],D=function(H,E,F){var G;if(!H||H===F){G=false;}else{G=YAHOO.util.Selector.test(H,E)?H:D(H.parentNode,E,F);}return G;};C.augmentObject(A,{_createDelegate:function(F,E,G,H){return function(I){var J=this,N=A.getTarget(I),L=E,P=(J.nodeType===9),Q,K,O,M;if(C.isFunction(E)){Q=E(N);}else{if(C.isString(E)){if(!P){O=J.id;if(!O){O=A.generateId(J);}M=("#"+O+" ");L=(M+E).replace(/,/gi,(","+M));}if(YAHOO.util.Selector.test(N,L)){Q=N;}else{if(YAHOO.util.Selector.test(N,((L.replace(/,/gi," *,"))+" *"))){Q=D(N,L,J);}}}}if(Q){K=Q;if(H){if(H===true){K=G;}else{K=H;}}return F.call(K,I,Q,J,G);}};},delegate:function(F,J,L,G,H,I){var E=J,K,M;if(C.isString(G)&&!YAHOO.util.Selector){return false;}if(J=="mouseenter"||J=="mouseleave"){if(!A._createMouseDelegate){return false;}E=A._getType(J);K=A._createMouseDelegate(L,H,I);M=A._createDelegate(function(P,O,N){return K.call(O,P,N);},G,H,I);}else{M=A._createDelegate(L,G,H,I);}B.push([F,E,L,M]);return A.on(F,E,M);},removeDelegate:function(F,J,I){var K=J,H=false,G,E;if(J=="mouseenter"||J=="mouseleave"){K=A._getType(J);}G=A._getCacheIndex(B,F,K,I);if(G>=0){E=B[G];}if(F&&E){H=A.removeListener(E[0],E[1],E[3]);if(H){delete B[G][2];delete B[G][3];B.splice(G,1);}}return H;}});}());YAHOO.register("event-delegate",YAHOO.util.Event,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: selector-min.js (06625725) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
var Y=YAHOO,Y_DOM=YAHOO.util.Dom,EMPTY_ARRAY=[],Y_UA=Y.env.ua,Y_Lang=Y.lang,Y_DOC=document,Y_DOCUMENT_ELEMENT=Y_DOC.documentElement,Y_DOM_inDoc=Y_DOM.inDocument,Y_mix=Y_Lang.augmentObject,Y_guid=Y_DOM.generateId,Y_getDoc=function(a){var b=Y_DOC;if(a){b=(a.nodeType===9)?a:a.ownerDocument||a.document||Y_DOC;}return b;},Y_Array=function(g,d){var c,b,h=d||0;try{return Array.prototype.slice.call(g,h);}catch(f){b=[];c=g.length;for(;h<c;h++){b.push(g[h]);}return b;}},Y_DOM_allById=function(f,a){a=a||Y_DOC;var b=[],c=[],d,e;if(a.querySelectorAll){c=a.querySelectorAll('[id="'+f+'"]');}else{if(a.all){b=a.all(f);if(b){if(b.nodeName){if(b.id===f){c.push(b);b=EMPTY_ARRAY;}else{b=[b];}}if(b.length){for(d=0;e=b[d++];){if(e.id===f||(e.attributes&&e.attributes.id&&e.attributes.id.value===f)){c.push(e);}}}}}else{c=[Y_getDoc(a).getElementById(f)];}}return c;};var COMPARE_DOCUMENT_POSITION="compareDocumentPosition",OWNER_DOCUMENT="ownerDocument",Selector={_foundCache:[],useNative:true,_compare:("sourceIndex" in Y_DOCUMENT_ELEMENT)?function(f,e){var d=f.sourceIndex,c=e.sourceIndex;if(d===c){return 0;}else{if(d>c){return 1;}}return -1;}:(Y_DOCUMENT_ELEMENT[COMPARE_DOCUMENT_POSITION]?function(b,a){if(b[COMPARE_DOCUMENT_POSITION](a)&4){return -1;}else{return 1;}}:function(e,d){var c,a,b;if(e&&d){c=e[OWNER_DOCUMENT].createRange();c.setStart(e,0);a=d[OWNER_DOCUMENT].createRange();a.setStart(d,0);b=c.compareBoundaryPoints(1,a);}return b;}),_sort:function(a){if(a){a=Y_Array(a,0,true);if(a.sort){a.sort(Selector._compare);}}return a;},_deDupe:function(a){var b=[],c,d;for(c=0;(d=a[c++]);){if(!d._found){b[b.length]=d;d._found=true;}}for(c=0;(d=b[c++]);){d._found=null;d.removeAttribute("_found");}return b;},query:function(b,j,k,a){if(j&&typeof j=="string"){j=Y_DOM.get(j);if(!j){return(k)?null:[];}}else{j=j||Y_DOC;}var f=[],c=(Selector.useNative&&Y_DOC.querySelector&&!a),e=[[b,j]],g,l,d,h=(c)?Selector._nativeQuery:Selector._bruteQuery;if(b&&h){if(!a&&(!c||j.tagName)){e=Selector._splitQueries(b,j);}for(d=0;(g=e[d++]);){l=h(g[0],g[1],k);if(!k){l=Y_Array(l,0,true);}if(l){f=f.concat(l);}}if(e.length>1){f=Selector._sort(Selector._deDupe(f));}}return(k)?(f[0]||null):f;},_splitQueries:function(c,f){var b=c.split(","),d=[],g="",e,a;if(f){if(f.tagName){f.id=f.id||Y_guid();g='[id="'+f.id+'"] ';}for(e=0,a=b.length;e<a;++e){c=g+b[e];d.push([c,f]);}}return d;},_nativeQuery:function(a,b,c){if(Y_UA.webkit&&a.indexOf(":checked")>-1&&(Selector.pseudos&&Selector.pseudos.checked)){return Selector.query(a,b,c,true);}try{return b["querySelector"+(c?"":"All")](a);}catch(d){return Selector.query(a,b,c,true);}},filter:function(b,a){var c=[],d,e;if(b&&a){for(d=0;(e=b[d++]);){if(Selector.test(e,a)){c[c.length]=e;}}}else{}return c;},test:function(c,d,k){var g=false,b=d.split(","),a=false,l,o,h,n,f,e,m;if(c&&c.tagName){if(!k&&!Y_DOM_inDoc(c)){l=c.parentNode;if(l){k=l;}else{n=c[OWNER_DOCUMENT].createDocumentFragment();n.appendChild(c);k=n;a=true;}}k=k||c[OWNER_DOCUMENT];if(!c.id){c.id=Y_guid();}for(f=0;(m=b[f++]);){m+='[id="'+c.id+'"]';h=Selector.query(m,k);for(e=0;o=h[e++];){if(o===c){g=true;break;}}if(g){break;}}if(a){n.removeChild(c);}}return g;}};YAHOO.util.Selector=Selector;var PARENT_NODE="parentNode",TAG_NAME="tagName",ATTRIBUTES="attributes",COMBINATOR="combinator",PSEUDOS="pseudos",SelectorCSS2={_reRegExpTokens:/([\^\$\?\[\]\*\+\-\.\(\)\|\\])/,SORT_RESULTS:true,_children:function(e,a){var b=e.children,d,c=[],f,g;if(e.children&&a&&e.children.tags){c=e.children.tags(a);}else{if((!b&&e[TAG_NAME])||(b&&a)){f=b||e.childNodes;b=[];for(d=0;(g=f[d++]);){if(g.tagName){if(!a||a===g.tagName){b.push(g);}}}}}return b||[];},_re:{attr:/(\[[^\]]*\])/g,esc:/\\[:\[\]\(\)#\.\'\>+~"]/gi,pseudos:/(\([^\)]*\))/g},shorthand:{"\\#(-?[_a-z]+[-\\w\\uE000]*)":"[id=$1]","\\.(-?[_a-z]+[-\\w\\uE000]*)":"[className~=$1]"},operators:{"":function(b,a){return !!b.getAttribute(a);},"~=":"(?:^|\\s+){val}(?:\\s+|$)","|=":"^{val}(?:-|$)"},pseudos:{"first-child":function(a){return Selector._children(a[PARENT_NODE])[0]===a;}},_bruteQuery:function(f,j,l){var g=[],a=[],i=Selector._tokenize(f),e=i[i.length-1],k=Y_getDoc(j),c,b,h,d;if(e){b=e.id;h=e.className;d=e.tagName||"*";if(j.getElementsByTagName){if(b&&(j.all||(j.nodeType===9||Y_DOM_inDoc(j)))){a=Y_DOM_allById(b,j);}else{if(h){a=j.getElementsByClassName(h);}else{a=j.getElementsByTagName(d);}}}else{c=j.firstChild;while(c){if(c.tagName){a.push(c);}c=c.nextSilbing||c.firstChild;}}if(a.length){g=Selector._filterNodes(a,i,l);}}return g;},_filterNodes:function(l,f,h){var r=0,q,s=f.length,k=s-1,e=[],o=l[0],v=o,t=Selector.getters,d,p,c,g,a,m,b,u;for(r=0;(v=o=l[r++]);){k=s-1;g=null;testLoop:while(v&&v.tagName){c=f[k];b=c.tests;q=b.length;if(q&&!a){while((u=b[--q])){d=u[1];if(t[u[0]]){m=t[u[0]](v,u[0]);}else{m=v[u[0]];if(m===undefined&&v.getAttribute){m=v.getAttribute(u[0]);}}if((d==="="&&m!==u[2])||(typeof d!=="string"&&d.test&&!d.test(m))||(!d.test&&typeof d==="function"&&!d(v,u[0],u[2]))){if((v=v[g])){while(v&&(!v.tagName||(c.tagName&&c.tagName!==v.tagName))){v=v[g];}}continue testLoop;}}}k--;if(!a&&(p=c.combinator)){g=p.axis;v=v[g];while(v&&!v.tagName){v=v[g];}if(p.direct){g=null;}}else{e.push(o);if(h){return e;}break;}}}o=v=null;return e;},combinators:{" ":{axis:"parentNode"},">":{axis:"parentNode",direct:true},"+":{axis:"previousSibling",direct:true}},_parsers:[{name:ATTRIBUTES,re:/^\uE003(-?[a-z]+[\w\-]*)+([~\|\^\$\*!=]=?)?['"]?([^\uE004'"]*)['"]?\uE004/i,fn:function(d,e){var c=d[2]||"",a=Selector.operators,b=(d[3])?d[3].replace(/\\/g,""):"",f;if((d[1]==="id"&&c==="=")||(d[1]==="className"&&Y_DOCUMENT_ELEMENT.getElementsByClassName&&(c==="~="||c==="="))){e.prefilter=d[1];d[3]=b;e[d[1]]=(d[1]==="id")?d[3]:b;}if(c in a){f=a[c];if(typeof f==="string"){d[3]=b.replace(Selector._reRegExpTokens,"\\$1");f=new RegExp(f.replace("{val}",d[3]));}d[2]=f;}if(!e.last||e.prefilter!==d[1]){return d.slice(1);}}},{name:TAG_NAME,re:/^((?:-?[_a-z]+[\w-]*)|\*)/i,fn:function(b,c){var a=b[1].toUpperCase();c.tagName=a;if(a!=="*"&&(!c.last||c.prefilter)){return[TAG_NAME,"=",a];
}if(!c.prefilter){c.prefilter="tagName";}}},{name:COMBINATOR,re:/^\s*([>+~]|\s)\s*/,fn:function(a,b){}},{name:PSEUDOS,re:/^:([\-\w]+)(?:\uE005['"]?([^\uE005]*)['"]?\uE006)*/i,fn:function(a,b){var c=Selector[PSEUDOS][a[1]];if(c){if(a[2]){a[2]=a[2].replace(/\\/g,"");}return[a[2],c];}else{return false;}}}],_getToken:function(a){return{tagName:null,id:null,className:null,attributes:{},combinator:null,tests:[]};},_tokenize:function(c){c=c||"";c=Selector._replaceShorthand(Y_Lang.trim(c));var b=Selector._getToken(),h=c,g=[],j=false,e,f,d,a;outer:do{j=false;for(d=0;(a=Selector._parsers[d++]);){if((e=a.re.exec(c))){if(a.name!==COMBINATOR){b.selector=c;}c=c.replace(e[0],"");if(!c.length){b.last=true;}if(Selector._attrFilters[e[1]]){e[1]=Selector._attrFilters[e[1]];}f=a.fn(e,b);if(f===false){j=false;break outer;}else{if(f){b.tests.push(f);}}if(!c.length||a.name===COMBINATOR){g.push(b);b=Selector._getToken(b);if(a.name===COMBINATOR){b.combinator=Selector.combinators[e[1]];}}j=true;}}}while(j&&c.length);if(!j||c.length){g=[];}return g;},_replaceShorthand:function(b){var d=Selector.shorthand,c=b.match(Selector._re.esc),e,h,g,f,a;if(c){b=b.replace(Selector._re.esc,"\uE000");}e=b.match(Selector._re.attr);h=b.match(Selector._re.pseudos);if(e){b=b.replace(Selector._re.attr,"\uE001");}if(h){b=b.replace(Selector._re.pseudos,"\uE002");}for(g in d){if(d.hasOwnProperty(g)){b=b.replace(new RegExp(g,"gi"),d[g]);}}if(e){for(f=0,a=e.length;f<a;++f){b=b.replace(/\uE001/,e[f]);}}if(h){for(f=0,a=h.length;f<a;++f){b=b.replace(/\uE002/,h[f]);}}b=b.replace(/\[/g,"\uE003");b=b.replace(/\]/g,"\uE004");b=b.replace(/\(/g,"\uE005");b=b.replace(/\)/g,"\uE006");if(c){for(f=0,a=c.length;f<a;++f){b=b.replace("\uE000",c[f]);}}return b;},_attrFilters:{"class":"className","for":"htmlFor"},getters:{href:function(b,a){return Y_DOM.getAttribute(b,a);}}};Y_mix(Selector,SelectorCSS2,true);Selector.getters.src=Selector.getters.rel=Selector.getters.href;if(Selector.useNative&&Y_DOC.querySelector){Selector.shorthand["\\.([^\\s\\\\(\\[:]*)"]="[class~=$1]";}Selector._reNth=/^(?:([\-]?\d*)(n){1}|(odd|even)$)*([\-+]?\d*)$/;Selector._getNth=function(d,o,q,h){Selector._reNth.test(o);var m=parseInt(RegExp.$1,10),c=RegExp.$2,j=RegExp.$3,k=parseInt(RegExp.$4,10)||0,p=[],l=Selector._children(d.parentNode,q),f;if(j){m=2;f="+";c="n";k=(j==="odd")?1:0;}else{if(isNaN(m)){m=(c)?1:0;}}if(m===0){if(h){k=l.length-k+1;}if(l[k-1]===d){return true;}else{return false;}}else{if(m<0){h=!!h;m=Math.abs(m);}}if(!h){for(var e=k-1,g=l.length;e<g;e+=m){if(e>=0&&l[e]===d){return true;}}}else{for(var e=l.length-k,g=l.length;e>=0;e-=m){if(e<g&&l[e]===d){return true;}}}return false;};Y_mix(Selector.pseudos,{"root":function(a){return a===a.ownerDocument.documentElement;},"nth-child":function(a,b){return Selector._getNth(a,b);},"nth-last-child":function(a,b){return Selector._getNth(a,b,null,true);},"nth-of-type":function(a,b){return Selector._getNth(a,b,a.tagName);},"nth-last-of-type":function(a,b){return Selector._getNth(a,b,a.tagName,true);},"last-child":function(b){var a=Selector._children(b.parentNode);return a[a.length-1]===b;},"first-of-type":function(a){return Selector._children(a.parentNode,a.tagName)[0]===a;},"last-of-type":function(b){var a=Selector._children(b.parentNode,b.tagName);return a[a.length-1]===b;},"only-child":function(b){var a=Selector._children(b.parentNode);return a.length===1&&a[0]===b;},"only-of-type":function(b){var a=Selector._children(b.parentNode,b.tagName);return a.length===1&&a[0]===b;},"empty":function(a){return a.childNodes.length===0;},"not":function(a,b){return !Selector.test(a,b);},"contains":function(a,b){var c=a.innerText||a.textContent||"";return c.indexOf(b)>-1;},"checked":function(a){return(a.checked===true||a.selected===true);},enabled:function(a){return(a.disabled!==undefined&&!a.disabled);},disabled:function(a){return(a.disabled);}});Y_mix(Selector.operators,{"^=":"^{val}","!=":function(b,a,c){return b[a]!==c;},"$=":"{val}$","*=":"{val}"});Selector.combinators["~"]={axis:"previousSibling"};YAHOO.register("selector",YAHOO.util.Selector,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: json-min.js (a1d88dcf) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
YAHOO.lang.JSON=(function(){var l=YAHOO.lang,_UNICODE_EXCEPTIONS=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_ESCAPES=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,_VALUES=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,_BRACKETS=/(?:^|:|,)(?:\s*\[)+/g,_INVALID=/^[\],:{}\s]*$/,_SPECIAL_CHARS=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_CHARS={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function _revive(data,reviver){var walk=function(o,key){var k,v,value=o[key];if(value&&typeof value==="object"){for(k in value){if(l.hasOwnProperty(value,k)){v=walk(value,k);if(v===undefined){delete value[k];}else{value[k]=v;}}}}return reviver.call(o,key,value);};return typeof reviver==="function"?walk({"":data},""):data;}function _char(c){if(!_CHARS[c]){_CHARS[c]="\\u"+("0000"+(+(c.charCodeAt(0))).toString(16)).slice(-4);}return _CHARS[c];}function _prepare(s){return s.replace(_UNICODE_EXCEPTIONS,_char);}function _isValid(str){return l.isString(str)&&_INVALID.test(str.replace(_ESCAPES,"@").replace(_VALUES,"]").replace(_BRACKETS,""));}function _string(s){return'"'+s.replace(_SPECIAL_CHARS,_char)+'"';}function _stringify(h,key,d,w,pstack){var o=typeof w==="function"?w.call(h,key,h[key]):h[key],i,len,j,k,v,isArray,a;if(o instanceof Date){o=l.JSON.dateToString(o);}else{if(o instanceof String||o instanceof Boolean||o instanceof Number){o=o.valueOf();}}switch(typeof o){case"string":return _string(o);case"number":return isFinite(o)?String(o):"null";case"boolean":return String(o);case"object":if(o===null){return"null";}for(i=pstack.length-1;i>=0;--i){if(pstack[i]===o){return"null";}}pstack[pstack.length]=o;a=[];isArray=l.isArray(o);if(d>0){if(isArray){for(i=o.length-1;i>=0;--i){a[i]=_stringify(o,i,d-1,w,pstack)||"null";}}else{j=0;if(l.isArray(w)){for(i=0,len=w.length;i<len;++i){k=w[i];v=_stringify(o,k,d-1,w,pstack);if(v){a[j++]=_string(k)+":"+v;}}}else{for(k in o){if(typeof k==="string"&&l.hasOwnProperty(o,k)){v=_stringify(o,k,d-1,w,pstack);if(v){a[j++]=_string(k)+":"+v;}}}}a.sort();}}pstack.pop();return isArray?"["+a.join(",")+"]":"{"+a.join(",")+"}";}return undefined;}return{isValid:function(s){return _isValid(_prepare(s));},parse:function(s,reviver){s=_prepare(s);if(_isValid(s)){return _revive(eval("("+s+")"),reviver);}throw new SyntaxError("parseJSON");},stringify:function(o,w,d){if(o!==undefined){if(l.isArray(w)){w=(function(a){var uniq=[],map={},v,i,j,len;for(i=0,j=0,len=a.length;i<len;++i){v=a[i];if(typeof v==="string"&&map[v]===undefined){uniq[(map[v]=j++)]=v;}}return uniq;})(w);}d=d>=0?d:1/0;return _stringify({"":o},"",d,w,[]);}return undefined;},dateToString:function(d){function _zeroPad(v){return v<10?"0"+v:v;}return d.getUTCFullYear()+"-"+_zeroPad(d.getUTCMonth()+1)+"-"+_zeroPad(d.getUTCDate())+"T"+_zeroPad(d.getUTCHours())+":"+_zeroPad(d.getUTCMinutes())+":"+_zeroPad(d.getUTCSeconds())+"Z";},stringToDate:function(str){if(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})Z$/.test(str)){var d=new Date();d.setUTCFullYear(RegExp.$1,(RegExp.$2|0)-1,RegExp.$3);d.setUTCHours(RegExp.$4,RegExp.$5,RegExp.$6);return d;}return str;}};})();YAHOO.register("json",YAHOO.lang.JSON,{version:"2.7.0",build:"1796"});

/* SOURCE FILE: connection-min.js (ff9f19f3) 9/9/2014 2:08:59 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
YAHOO.util.Connect={_msxml_progid:["Microsoft.XMLHTTP","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"],_http_headers:{},_has_http_headers:false,_use_default_post_header:true,_default_post_header:"application/x-www-form-urlencoded; charset=UTF-8",_default_form_header:"application/x-www-form-urlencoded",_use_default_xhr_header:true,_default_xhr_header:"XMLHttpRequest",_has_default_headers:true,_isFormSubmit:false,_default_headers:{},_poll:{},_timeOut:{},_polling_interval:50,_transaction_id:0,startEvent:new YAHOO.util.CustomEvent("start"),completeEvent:new YAHOO.util.CustomEvent("complete"),successEvent:new YAHOO.util.CustomEvent("success"),failureEvent:new YAHOO.util.CustomEvent("failure"),abortEvent:new YAHOO.util.CustomEvent("abort"),_customEvents:{onStart:["startEvent","start"],onComplete:["completeEvent","complete"],onSuccess:["successEvent","success"],onFailure:["failureEvent","failure"],onUpload:["uploadEvent","upload"],onAbort:["abortEvent","abort"]},setProgId:function(a){this._msxml_progid.unshift(a);},setDefaultPostHeader:function(a){if(typeof a=="string"){this._default_post_header=a;this._use_default_post_header=true;}else{if(typeof a=="boolean"){this._use_default_post_header=a;}}},setDefaultXhrHeader:function(a){if(typeof a=="string"){this._default_xhr_header=a;}else{this._use_default_xhr_header=a;}},setPollingInterval:function(a){if(typeof a=="number"&&isFinite(a)){this._polling_interval=a;}},createXhrObject:function(g){var d,a,b;try{a=new XMLHttpRequest();d={conn:a,tId:g,xhr:true};}catch(c){for(b=0;b<this._msxml_progid.length;++b){try{a=new ActiveXObject(this._msxml_progid[b]);d={conn:a,tId:g,xhr:true};break;}catch(f){}}}finally{return d;}},getConnectionObject:function(a){var c,d=this._transaction_id;try{if(!a){c=this.createXhrObject(d);}else{c={tId:d};if(a==="xdr"){c.conn=this._transport;c.xdr=true;}else{if(a==="upload"){c.upload=true;}}}if(c){this._transaction_id++;}}catch(b){}return c;},asyncRequest:function(h,d,g,a){var b=g&&g.argument?g.argument:null,e=this,f,c;if(this._isFileUpload){c="upload";}else{if(g&&g.xdr){c="xdr";}}f=this.getConnectionObject(c);if(!f){return null;}else{if(g&&g.customevents){this.initCustomEvents(f,g);}if(this._isFormSubmit){if(this._isFileUpload){window.setTimeout(function(){e.uploadFile(f,g,d,a);},10);return f;}if(h.toUpperCase()=="GET"){if(this._sFormData.length!==0){d+=((d.indexOf("?")==-1)?"?":"&")+this._sFormData;}}else{if(h.toUpperCase()=="POST"){a=a?this._sFormData+"&"+a:this._sFormData;}}}if(h.toUpperCase()=="GET"&&(g&&g.cache===false)){d+=((d.indexOf("?")==-1)?"?":"&")+"rnd="+new Date().valueOf().toString();}if(this._use_default_xhr_header){if(!this._default_headers["X-Requested-With"]){this.initHeader("X-Requested-With",this._default_xhr_header,true);}}if((h.toUpperCase()==="POST"&&this._use_default_post_header)&&this._isFormSubmit===false){this.initHeader("Content-Type",this._default_post_header);}if(f.xdr){this.xdr(f,h,d,g,a);return f;}f.conn.open(h,d,true);if(this._has_default_headers||this._has_http_headers){this.setHeader(f);}this.handleReadyState(f,g);f.conn.send(a||"");if(this._isFormSubmit===true){this.resetFormState();}this.startEvent.fire(f,b);if(f.startEvent){f.startEvent.fire(f,b);}return f;}},initCustomEvents:function(a,c){var b;for(b in c.customevents){if(this._customEvents[b][0]){a[this._customEvents[b][0]]=new YAHOO.util.CustomEvent(this._customEvents[b][1],(c.scope)?c.scope:null);a[this._customEvents[b][0]].subscribe(c.customevents[b]);}}},handleReadyState:function(c,d){var b=this,a=(d&&d.argument)?d.argument:null;if(d&&d.timeout){this._timeOut[c.tId]=window.setTimeout(function(){b.abort(c,d,true);},d.timeout);}this._poll[c.tId]=window.setInterval(function(){if(c.conn&&c.conn.readyState===4){window.clearInterval(b._poll[c.tId]);delete b._poll[c.tId];if(d&&d.timeout){window.clearTimeout(b._timeOut[c.tId]);delete b._timeOut[c.tId];}b.completeEvent.fire(c,a);if(c.completeEvent){c.completeEvent.fire(c,a);}b.handleTransactionResponse(c,d);}},this._polling_interval);},handleTransactionResponse:function(b,j,d){var f,a,h=(j&&j.argument)?j.argument:null,c=(b.r&&b.r.statusText==="xdr:success")?true:false,i=(b.r&&b.r.statusText==="xdr:failure")?true:false,k=d;try{if((b.conn.status!==undefined&&b.conn.status!==0)||c){f=b.conn.status;}else{if(i&&!k){f=0;}else{f=13030;}}}catch(g){f=13030;}if((f>=200&&f<300)||f===1223||c){a=b.xdr?b.r:this.createResponseObject(b,h);if(j&&j.success){if(!j.scope){j.success(a);}else{j.success.apply(j.scope,[a]);}}this.successEvent.fire(a);if(b.successEvent){b.successEvent.fire(a);}}else{switch(f){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:a=this.createExceptionObject(b.tId,h,(d?d:false));if(j&&j.failure){if(!j.scope){j.failure(a);}else{j.failure.apply(j.scope,[a]);}}break;default:a=(b.xdr)?b.response:this.createResponseObject(b,h);if(j&&j.failure){if(!j.scope){j.failure(a);}else{j.failure.apply(j.scope,[a]);}}}this.failureEvent.fire(a);if(b.failureEvent){b.failureEvent.fire(a);}}this.releaseObject(b);a=null;},createResponseObject:function(a,h){var d={},k={},f,c,g,b;try{c=a.conn.getAllResponseHeaders();g=c.split("\n");for(f=0;f<g.length;f++){b=g[f].indexOf(":");if(b!=-1){k[g[f].substring(0,b)]=YAHOO.lang.trim(g[f].substring(b+2));}}}catch(j){}d.tId=a.tId;d.status=(a.conn.status==1223)?204:a.conn.status;d.statusText=(a.conn.status==1223)?"No Content":a.conn.statusText;d.getResponseHeader=k;d.getAllResponseHeaders=c;d.responseText=a.conn.responseText;d.responseXML=a.conn.responseXML;if(h){d.argument=h;}return d;},createExceptionObject:function(h,d,a){var f=0,g="communication failure",c=-1,b="transaction aborted",e={};e.tId=h;if(a){e.status=c;e.statusText=b;}else{e.status=f;e.statusText=g;}if(d){e.argument=d;}return e;},initHeader:function(a,d,c){var b=(c)?this._default_headers:this._http_headers;b[a]=d;if(c){this._has_default_headers=true;}else{this._has_http_headers=true;}},setHeader:function(a){var b;if(this._has_default_headers){for(b in this._default_headers){if(YAHOO.lang.hasOwnProperty(this._default_headers,b)){a.conn.setRequestHeader(b,this._default_headers[b]);
}}}if(this._has_http_headers){for(b in this._http_headers){if(YAHOO.lang.hasOwnProperty(this._http_headers,b)){a.conn.setRequestHeader(b,this._http_headers[b]);}}this._http_headers={};this._has_http_headers=false;}},resetDefaultHeaders:function(){this._default_headers={};this._has_default_headers=false;},abort:function(e,g,a){var d,b=(g&&g.argument)?g.argument:null;e=e||{};if(e.conn){if(e.xhr){if(this.isCallInProgress(e)){e.conn.abort();window.clearInterval(this._poll[e.tId]);delete this._poll[e.tId];if(a){window.clearTimeout(this._timeOut[e.tId]);delete this._timeOut[e.tId];}d=true;}}else{if(e.xdr){e.conn.abort(e.tId);d=true;}}}else{if(e.upload){var c="yuiIO"+e.tId;var f=document.getElementById(c);if(f){YAHOO.util.Event.removeListener(f,"load");document.body.removeChild(f);if(a){window.clearTimeout(this._timeOut[e.tId]);delete this._timeOut[e.tId];}d=true;}}else{d=false;}}if(d===true){this.abortEvent.fire(e,b);if(e.abortEvent){e.abortEvent.fire(e,b);}this.handleTransactionResponse(e,g,true);}return d;},isCallInProgress:function(a){a=a||{};if(a.xhr&&a.conn){return a.conn.readyState!==4&&a.conn.readyState!==0;}else{if(a.xdr&&a.conn){return a.conn.isCallInProgress(a.tId);}else{if(a.upload===true){return document.getElementById("yuiIO"+a.tId)?true:false;}else{return false;}}}},releaseObject:function(a){if(a&&a.conn){a.conn=null;a=null;}}};(function(){var g=YAHOO.util.Connect,h={};function d(i){var j='<object id="YUIConnectionSwf" type="application/x-shockwave-flash" data="'+i+'" width="0" height="0">'+'<param name="movie" value="'+i+'">'+'<param name="allowScriptAccess" value="always">'+"</object>",k=document.createElement("div");document.body.appendChild(k);k.innerHTML=j;}function b(l,i,j,n,k){h[parseInt(l.tId)]={"o":l,"c":n};if(k){n.method=i;n.data=k;}l.conn.send(j,n,l.tId);}function e(i){d(i);g._transport=document.getElementById("YUIConnectionSwf");}function c(){g.xdrReadyEvent.fire();}function a(j,i){if(j){g.startEvent.fire(j,i.argument);if(j.startEvent){j.startEvent.fire(j,i.argument);}}}function f(j){var k=h[j.tId].o,i=h[j.tId].c;if(j.statusText==="xdr:start"){a(k,i);return;}j.responseText=decodeURI(j.responseText);k.r=j;if(i.argument){k.r.argument=i.argument;}this.handleTransactionResponse(k,i,j.statusText==="xdr:abort"?true:false);delete h[j.tId];}g.xdr=b;g.swf=d;g.transport=e;g.xdrReadyEvent=new YAHOO.util.CustomEvent("xdrReady");g.xdrReady=c;g.handleXdrResponse=f;})();(function(){var e=YAHOO.util.Connect,g=YAHOO.util.Event,a=document.documentMode?document.documentMode:false;e._isFileUpload=false;e._formNode=null;e._sFormData=null;e._submitElementValue=null;e.uploadEvent=new YAHOO.util.CustomEvent("upload");e._hasSubmitListener=function(){if(g){g.addListener(document,"click",function(k){var j=g.getTarget(k),i=j.nodeName.toLowerCase();if((i==="input"||i==="button")&&(j.type&&j.type.toLowerCase()=="submit")){e._submitElementValue=encodeURIComponent(j.name)+"="+encodeURIComponent(j.value);}});return true;}return false;}();function h(w,r,m){var v,l,u,s,z,t=false,p=[],y=0,o,q,n,x,k;this.resetFormState();if(typeof w=="string"){v=(document.getElementById(w)||document.forms[w]);}else{if(typeof w=="object"){v=w;}else{return;}}if(r){this.createFrame(m?m:null);this._isFormSubmit=true;this._isFileUpload=true;this._formNode=v;return;}for(o=0,q=v.elements.length;o<q;++o){l=v.elements[o];z=l.disabled;u=l.name;if(!z&&u){u=encodeURIComponent(u)+"=";s=encodeURIComponent(l.value);switch(l.type){case"select-one":if(l.selectedIndex>-1){k=l.options[l.selectedIndex];p[y++]=u+encodeURIComponent((k.attributes.value&&k.attributes.value.specified)?k.value:k.text);}break;case"select-multiple":if(l.selectedIndex>-1){for(n=l.selectedIndex,x=l.options.length;n<x;++n){k=l.options[n];if(k.selected){p[y++]=u+encodeURIComponent((k.attributes.value&&k.attributes.value.specified)?k.value:k.text);}}}break;case"radio":case"checkbox":if(l.checked){p[y++]=u+s;}break;case"file":case undefined:case"reset":case"button":break;case"submit":if(t===false){if(this._hasSubmitListener&&this._submitElementValue){p[y++]=this._submitElementValue;}t=true;}break;default:p[y++]=u+s;}}}this._isFormSubmit=true;this._sFormData=p.join("&");this.initHeader("Content-Type",this._default_form_header);return this._sFormData;}function d(){this._isFormSubmit=false;this._isFileUpload=false;this._formNode=null;this._sFormData="";}function c(i){var j="yuiIO"+this._transaction_id,l=(a===9)?true:false,k;if(YAHOO.env.ua.ie&&!l){k=document.createElement('<iframe id="'+j+'" name="'+j+'" />');if(typeof i=="boolean"){k.src="javascript:false";}}else{k=document.createElement("iframe");k.id=j;k.name=j;}k.style.position="absolute";k.style.top="-1000px";k.style.left="-1000px";document.body.appendChild(k);}function f(j){var m=[],k=j.split("&"),l,n;for(l=0;l<k.length;l++){n=k[l].indexOf("=");if(n!=-1){m[l]=document.createElement("input");m[l].type="hidden";m[l].name=decodeURIComponent(k[l].substring(0,n));m[l].value=decodeURIComponent(k[l].substring(n+1));this._formNode.appendChild(m[l]);}}return m;}function b(m,y,n,l){var t="yuiIO"+m.tId,u="multipart/form-data",w=document.getElementById(t),p=(a>=8)?true:false,z=this,v=(y&&y.argument)?y.argument:null,x,s,k,r,j,q;j={action:this._formNode.getAttribute("action"),method:this._formNode.getAttribute("method"),target:this._formNode.getAttribute("target")};this._formNode.setAttribute("action",n);this._formNode.setAttribute("method","POST");this._formNode.setAttribute("target",t);if(YAHOO.env.ua.ie&&!p){this._formNode.setAttribute("encoding",u);}else{this._formNode.setAttribute("enctype",u);}if(l){x=this.appendPostData(l);}this._formNode.submit();this.startEvent.fire(m,v);if(m.startEvent){m.startEvent.fire(m,v);}if(y&&y.timeout){this._timeOut[m.tId]=window.setTimeout(function(){z.abort(m,y,true);},y.timeout);}if(x&&x.length>0){for(s=0;s<x.length;s++){this._formNode.removeChild(x[s]);}}for(k in j){if(YAHOO.lang.hasOwnProperty(j,k)){if(j[k]){this._formNode.setAttribute(k,j[k]);}else{this._formNode.removeAttribute(k);}}}this.resetFormState();
q=function(){var i,A,B;if(y&&y.timeout){window.clearTimeout(z._timeOut[m.tId]);delete z._timeOut[m.tId];}z.completeEvent.fire(m,v);if(m.completeEvent){m.completeEvent.fire(m,v);}r={tId:m.tId,argument:v};try{i=w.contentWindow.document.getElementsByTagName("body")[0];A=w.contentWindow.document.getElementsByTagName("pre")[0];if(i){if(A){B=A.textContent?A.textContent:A.innerText;}else{B=i.textContent?i.textContent:i.innerText;}}r.responseText=B;r.responseXML=w.contentWindow.document.XMLDocument?w.contentWindow.document.XMLDocument:w.contentWindow.document;}catch(o){}if(y&&y.upload){if(!y.scope){y.upload(r);}else{y.upload.apply(y.scope,[r]);}}z.uploadEvent.fire(r);if(m.uploadEvent){m.uploadEvent.fire(r);}g.removeListener(w,"load",q);setTimeout(function(){document.body.removeChild(w);z.releaseObject(m);},100);};g.addListener(w,"load",q);}e.setForm=h;e.resetFormState=d;e.createFrame=c;e.appendPostData=f;e.uploadFile=b;})();YAHOO.register("connection",YAHOO.util.Connect,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: get-min.js (d16e6f87) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
YAHOO.util.Get=function(){var m={},k=0,r=0,l=false,n=YAHOO.env.ua,s=YAHOO.lang,q,d,e,i=function(x,t,y){var u=y||window,z=u.document,A=z.createElement(x),v;for(v in t){if(t.hasOwnProperty(v)){A.setAttribute(v,t[v]);}}return A;},h=function(u,v,t){var w={id:"yui__dyn_"+(r++),type:"text/css",rel:"stylesheet",href:u};if(t){s.augmentObject(w,t);}return i("link",w,v);},p=function(u,v,t){var w={id:"yui__dyn_"+(r++),type:"text/javascript",src:u};if(t){s.augmentObject(w,t);}return i("script",w,v);},a=function(t,u){return{tId:t.tId,win:t.win,data:t.data,nodes:t.nodes,msg:u,purge:function(){d(this.tId);}};},b=function(t,w){var u=m[w],v=(s.isString(t))?u.win.document.getElementById(t):t;if(!v){q(w,"target node not found: "+t);}return v;},c=function(w){var u=m[w],v,t;u.finished=true;if(u.aborted){v="transaction "+w+" was aborted";q(w,v);return;}if(u.onSuccess){t=u.scope||u.win;u.onSuccess.call(t,a(u));}},o=function(v){var u=m[v],t;if(u.onTimeout){t=u.scope||u;u.onTimeout.call(t,a(u));}},f=function(v,A){var u=m[v],D=u.win,C=D.document,B=C.getElementsByTagName("head")[0],x,y,t,E,z;if(u.timer){u.timer.cancel();}if(u.aborted){y="transaction "+v+" was aborted";q(v,y);return;}if(A){u.url.shift();if(u.varName){u.varName.shift();}}else{u.url=(s.isString(u.url))?[u.url]:u.url;if(u.varName){u.varName=(s.isString(u.varName))?[u.varName]:u.varName;}}if(u.url.length===0){if(u.type==="script"&&n.webkit&&n.webkit<420&&!u.finalpass&&!u.varName){z=p(null,u.win,u.attributes);z.innerHTML='YAHOO.util.Get._finalize("'+v+'");';u.nodes.push(z);B.appendChild(z);}else{c(v);}return;}t=u.url[0];if(!t){u.url.shift();return f(v);}if(u.timeout){u.timer=s.later(u.timeout,u,o,v);}if(u.type==="script"){x=p(t,D,u.attributes);}else{x=h(t,D,u.attributes);}e(u.type,x,v,t,D,u.url.length);u.nodes.push(x);if(u.insertBefore){E=b(u.insertBefore,v);if(E){E.parentNode.insertBefore(x,E);}}else{B.appendChild(x);}if((n.webkit||n.gecko)&&u.type==="css"){f(v,t);}},j=function(){if(l){return;}l=true;var t,u;for(t in m){if(m.hasOwnProperty(t)){u=m[t];if(u.autopurge&&u.finished){d(u.tId);delete m[t];}}}l=false;},g=function(u,t,v){var x="q"+(k++),w;v=v||{};if(k%YAHOO.util.Get.PURGE_THRESH===0){j();}m[x]=s.merge(v,{tId:x,type:u,url:t,finished:false,aborted:false,nodes:[]});w=m[x];w.win=w.win||window;w.scope=w.scope||w.win;w.autopurge=("autopurge" in w)?w.autopurge:(u==="script")?true:false;w.attributes=w.attributes||{};w.attributes.charset=v.charset||w.attributes.charset||"utf-8";s.later(0,w,f,x);return{tId:x};};e=function(H,z,x,u,D,E,G){var F=G||f,B,t,I,v,J,A,C,y;if(n.ie){z.onreadystatechange=function(){B=this.readyState;if("loaded"===B||"complete"===B){z.onreadystatechange=null;F(x,u);}};}else{if(n.webkit){if(H==="script"){if(n.webkit>=420){z.addEventListener("load",function(){F(x,u);});}else{t=m[x];if(t.varName){v=YAHOO.util.Get.POLL_FREQ;t.maxattempts=YAHOO.util.Get.TIMEOUT/v;t.attempts=0;t._cache=t.varName[0].split(".");t.timer=s.later(v,t,function(w){I=this._cache;A=I.length;J=this.win;for(C=0;C<A;C=C+1){J=J[I[C]];if(!J){this.attempts++;if(this.attempts++>this.maxattempts){y="Over retry limit, giving up";t.timer.cancel();q(x,y);}else{}return;}}t.timer.cancel();F(x,u);},null,true);}else{s.later(YAHOO.util.Get.POLL_FREQ,null,F,[x,u]);}}}}else{z.onload=function(){F(x,u);};}}};q=function(w,v){var u=m[w],t;if(u.onFailure){t=u.scope||u.win;u.onFailure.call(t,a(u,v));}};d=function(z){if(m[z]){var t=m[z],u=t.nodes,x=u.length,C=t.win.document,A=C.getElementsByTagName("head")[0],v,y,w,B;if(t.insertBefore){v=b(t.insertBefore,z);if(v){A=v.parentNode;}}for(y=0;y<x;y=y+1){w=u[y];if(w.clearAttributes){w.clearAttributes();}else{for(B in w){if(w.hasOwnProperty(B)){delete w[B];}}}A.removeChild(w);}t.nodes=[];}};return{POLL_FREQ:10,PURGE_THRESH:20,TIMEOUT:2000,_finalize:function(t){s.later(0,null,c,t);},abort:function(u){var v=(s.isString(u))?u:u.tId,t=m[v];if(t){t.aborted=true;}},script:function(t,u){return g("script",t,u);},css:function(t,u){return g("css",t,u);}};}();YAHOO.register("get",YAHOO.util.Get,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: cookie-min.js (3b456c38) 9/9/2014 2:08:59 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
YAHOO.namespace("util");YAHOO.util.Cookie={_createCookieString:function(B,D,C,A){var F=YAHOO.lang,E=encodeURIComponent(B)+"="+(C?encodeURIComponent(D):D);if(F.isObject(A)){if(A.expires instanceof Date){E+="; expires="+A.expires.toUTCString();}if(F.isString(A.path)&&A.path!==""){E+="; path="+A.path;}if(F.isString(A.domain)&&A.domain!==""){E+="; domain="+A.domain;}if(A.secure===true){E+="; secure";}}return E;},_createCookieHashString:function(B){var D=YAHOO.lang;if(!D.isObject(B)){throw new TypeError("Cookie._createCookieHashString(): Argument must be an object.");}var C=[];for(var A in B){if(D.hasOwnProperty(B,A)&&!D.isFunction(B[A])&&!D.isUndefined(B[A])){C.push(encodeURIComponent(A)+"="+encodeURIComponent(String(B[A])));}}return C.join("&");},_parseCookieHash:function(E){var D=E.split("&"),F=null,C={};if(E.length>0){for(var B=0,A=D.length;B<A;B++){F=D[B].split("=");C[decodeURIComponent(F[0])]=decodeURIComponent(F[1]);}}return C;},_parseCookieString:function(J,A){var K={};if(YAHOO.lang.isString(J)&&J.length>0){var B=(A===false?function(L){return L;}:decodeURIComponent);var H=J.split(/;\s/g),I=null,C=null,E=null;for(var D=0,F=H.length;D<F;D++){E=H[D].match(/([^=]+)=/i);if(E instanceof Array){try{I=decodeURIComponent(E[1]);C=B(H[D].substring(E[1].length+1));}catch(G){}}else{I=decodeURIComponent(H[D]);C="";}K[I]=C;}}return K;},exists:function(A){if(!YAHOO.lang.isString(A)||A===""){throw new TypeError("Cookie.exists(): Cookie name must be a non-empty string.");}var B=this._parseCookieString(document.cookie,true);return B.hasOwnProperty(A);},get:function(B,A){var E=YAHOO.lang,C;if(E.isFunction(A)){C=A;A={};}else{if(E.isObject(A)){C=A.converter;}else{A={};}}var D=this._parseCookieString(document.cookie,!A.raw);if(!E.isString(B)||B===""){throw new TypeError("Cookie.get(): Cookie name must be a non-empty string.");}if(E.isUndefined(D[B])){return null;}if(!E.isFunction(C)){return D[B];}else{return C(D[B]);}},getSub:function(A,C,B){var E=YAHOO.lang,D=this.getSubs(A);if(D!==null){if(!E.isString(C)||C===""){throw new TypeError("Cookie.getSub(): Subcookie name must be a non-empty string.");}if(E.isUndefined(D[C])){return null;}if(!E.isFunction(B)){return D[C];}else{return B(D[C]);}}else{return null;}},getSubs:function(B){var A=YAHOO.lang.isString;if(!A(B)||B===""){throw new TypeError("Cookie.getSubs(): Cookie name must be a non-empty string.");}var C=this._parseCookieString(document.cookie,false);if(A(C[B])){return this._parseCookieHash(C[B]);}return null;},remove:function(B,A){if(!YAHOO.lang.isString(B)||B===""){throw new TypeError("Cookie.remove(): Cookie name must be a non-empty string.");}A=YAHOO.lang.merge(A||{},{expires:new Date(0)});return this.set(B,"",A);},removeSub:function(B,E,A){var F=YAHOO.lang;A=A||{};if(!F.isString(B)||B===""){throw new TypeError("Cookie.removeSub(): Cookie name must be a non-empty string.");}if(!F.isString(E)||E===""){throw new TypeError("Cookie.removeSub(): Subcookie name must be a non-empty string.");}var D=this.getSubs(B);if(F.isObject(D)&&F.hasOwnProperty(D,E)){delete D[E];if(!A.removeIfEmpty){return this.setSubs(B,D,A);}else{for(var C in D){if(F.hasOwnProperty(D,C)&&!F.isFunction(D[C])&&!F.isUndefined(D[C])){return this.setSubs(B,D,A);}}return this.remove(B,A);}}else{return"";}},set:function(B,C,A){var E=YAHOO.lang;A=A||{};if(!E.isString(B)){throw new TypeError("Cookie.set(): Cookie name must be a string.");}if(E.isUndefined(C)){throw new TypeError("Cookie.set(): Value cannot be undefined.");}var D=this._createCookieString(B,C,!A.raw,A);document.cookie=D;return D;},setSub:function(B,D,C,A){var F=YAHOO.lang;if(!F.isString(B)||B===""){throw new TypeError("Cookie.setSub(): Cookie name must be a non-empty string.");}if(!F.isString(D)||D===""){throw new TypeError("Cookie.setSub(): Subcookie name must be a non-empty string.");}if(F.isUndefined(C)){throw new TypeError("Cookie.setSub(): Subcookie value cannot be undefined.");}var E=this.getSubs(B);if(!F.isObject(E)){E={};}E[D]=C;return this.setSubs(B,E,A);},setSubs:function(B,C,A){var E=YAHOO.lang;if(!E.isString(B)){throw new TypeError("Cookie.setSubs(): Cookie name must be a string.");}if(!E.isObject(C)){throw new TypeError("Cookie.setSubs(): Cookie value must be an object.");}var D=this._createCookieString(B,this._createCookieHashString(C),false,A);document.cookie=D;return D;}};YAHOO.register("cookie",YAHOO.util.Cookie,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: storage-min.js (15d82a1b) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
(function(){var g=YAHOO,f=g.util,e=g.lang,c,d,b=/^type=(\w+)/i,a=/&value=(.*)/i;if(!f.Storage){c=function(h){g.log("Exception in YAHOO.util.Storage.?? - must be extended by a storage engine".replace("??",h).replace("??",this.getName?this.getName():"Unknown"),"error");};d=function(h,k,j){var i=this;g.env._id_counter+=1;i._cfg=e.isObject(j)?j:{};i._location=h;i._name=k;i.isReady=false;i.createEvent(d.CE_READY,{scope:i,fireOnce:true});i.createEvent(d.CE_CHANGE,{scope:i});i.subscribe(d.CE_READY,function(){i.isReady=true;});};d.CE_READY="YUIStorageReady";d.CE_CHANGE="YUIStorageChange";d.prototype={CE_READY:d.CE_READY,CE_CHANGE:d.CE_CHANGE,_cfg:"",_name:"",_location:"",length:0,isReady:false,clear:function(){this._clear();this.length=0;},getItem:function(h){g.log("Fetching item at  "+h);var i=this._getItem(h);return e.isValue(i)?this._getValue(i):null;},getName:function(){return this._name;},hasKey:function(h){return e.isString(h)&&this._hasKey(h);},key:function(h){g.log("Fetching key at "+h);if(e.isNumber(h)&&-1<h&&this.length>h){var i=this._key(h);if(i){return i;}}throw ("INDEX_SIZE_ERR - Storage.setItem - The provided index ("+h+") is not available");},removeItem:function(j){g.log("removing "+j);var i=this,h;if(i.hasKey(j)){h=i._getItem(j);if(!h){h=null;}i._removeItem(j);i.fireEvent(d.CE_CHANGE,new f.StorageEvent(i,j,h,null,f.StorageEvent.TYPE_REMOVE_ITEM));}else{}},setItem:function(j,k){g.log("SETTING "+k+" to "+j);if(e.isString(j)){var i=this,h=i._getItem(j);if(!h){h=null;}if(i._setItem(j,i._createValue(k))){i.fireEvent(d.CE_CHANGE,new f.StorageEvent(i,j,h,k,i.hasKey(j)?f.StorageEvent.TYPE_UPDATE_ITEM:f.StorageEvent.TYPE_ADD_ITEM));}else{throw ("QUOTA_EXCEEDED_ERROR - Storage.setItem - The choosen storage method ("+i.getName()+") has exceeded capacity");}}else{}},_clear:function(){c("_clear");return"";},_createValue:function(h){var i=(e.isNull(h)||e.isUndefined(h))?(""+h):typeof h;return"type="+i+"&value="+encodeURIComponent(""+h);},_getItem:function(h){c("_getItem");return"";},_getValue:function(h){var j=h.match(b)[1],i=h.match(a)[1];switch(j){case"boolean":return"true"==i;case"number":return parseFloat(i);case"null":return null;default:return decodeURIComponent(i);}},_key:function(h){c("_key");return"";},_hasKey:function(h){return null!==this._getItem(h);},_removeItem:function(h){c("_removeItem");return"";},_setItem:function(h,i){c("_setItem");return"";}};e.augmentProto(d,f.EventProvider);f.Storage=d;}}());(function(){var h=YAHOO.util,e=YAHOO.lang,d={},g=[],f={},b=function(i){return(i&&i.isAvailable())?i:null;},a=function(i,l,k){var j=d[i+l.ENGINE_NAME];if(!j){j=new l(i,k);d[i+l.ENGINE_NAME]=j;}return j;},c=function(i){switch(i){case h.StorageManager.LOCATION_LOCAL:case h.StorageManager.LOCATION_SESSION:return i;default:return h.StorageManager.LOCATION_SESSION;}};h.StorageManager={LOCATION_SESSION:"sessionStorage",LOCATION_LOCAL:"localStorage",get:function(q,k,p){var n=e.isObject(p)?p:{},o=b(f[q]),m,l;if(!o&&!n.force){if(n.order){l=n.order.length;for(m=0;m<l&&!o;m+=1){o=b(n.order[m]);}}if(!o){l=g.length;for(m=0;m<l&&!o;m+=1){o=b(g[m]);}}}if(o){return a(c(k),o,n.engine);}throw ("YAHOO.util.StorageManager.get - No engine available, please include an engine before calling this function.");},getByteSize:function(i){return encodeURIComponent(""+i).length;},register:function(i){if(e.isFunction(i)&&e.isFunction(i.isAvailable)&&e.isString(i.ENGINE_NAME)){f[i.ENGINE_NAME]=i;g.push(i);return true;}return false;}};YAHOO.register("StorageManager",h.SWFStore,{version:"2.9.0",build:"2800"});}());(function(){function a(e,d,c,b,f){this.key=d;this.oldValue=c;this.newValue=b;this.url=window.location.href;this.window=window;this.storageArea=e;this.type=f;}YAHOO.lang.augmentObject(a,{TYPE_ADD_ITEM:"addItem",TYPE_REMOVE_ITEM:"removeItem",TYPE_UPDATE_ITEM:"updateItem"});a.prototype={key:null,newValue:null,oldValue:null,source:null,storageArea:null,type:null,url:null};YAHOO.util.StorageEvent=a;}());(function(){var a=YAHOO.util;a.StorageEngineKeyed=function(){a.StorageEngineKeyed.superclass.constructor.apply(this,arguments);this._keys=[];this._keyMap={};};YAHOO.lang.extend(a.StorageEngineKeyed,a.Storage,{_keys:null,_keyMap:null,_addKey:function(b){if(!this._keyMap.hasOwnProperty(b)){this._keys.push(b);this._keyMap[b]=this.length;this.length=this._keys.length;}},_clear:function(){this._keys=[];this.length=0;},_indexOfKey:function(c){var b=this._keyMap[c];return undefined===b?-1:b;},_key:function(b){return this._keys[b];},_removeItem:function(f){var e=this,c=e._indexOfKey(f),d=e._keys.slice(c+1),b;delete e._keyMap[f];for(b in e._keyMap){if(c<e._keyMap[b]){e._keyMap[b]-=1;}}e._keys.length=c;e._keys=e._keys.concat(d);e.length=e._keys.length;}});}());(function(){var e=YAHOO.util,c=YAHOO.lang,a=function(f){f.begin();},b=function(f){f.commit();},d=function(f,h){var g=this,i=window[f];d.superclass.constructor.call(g,f,d.ENGINE_NAME,h);if(!i.begin){a=function(){};}if(!i.commit){b=function(){};}g.length=i.length;g._driver=i;g.fireEvent(e.Storage.CE_READY);};c.extend(d,e.Storage,{_driver:null,_clear:function(){var g=this,f,h;if(g._driver.clear){g._driver.clear();}else{for(f=g.length;0<=f;f-=1){h=g._key(f);g._removeItem(h);}}},_getItem:function(f){var g=this._driver.getItem(f);return c.isObject(g)?g.value:g;},_key:function(f){return this._driver.key(f);},_removeItem:function(f){var g=this._driver;a(g);g.removeItem(f);b(g);this.length=g.length;},_setItem:function(g,f){var i=this._driver;try{a(i);i.setItem(g,f);b(i);this.length=i.length;return true;}catch(h){return false;}}},true);d.ENGINE_NAME="html5";d.isAvailable=function(){try{return("localStorage" in window)&&window["localStorage"]!==null&&("sessionStorage" in window)&&window["sessionStorage"]!==null;}catch(f){return false;}};e.StorageManager.register(d);e.StorageEngineHTML5=d;}());(function(){var h=YAHOO.util,d=YAHOO.lang,e=9948,g="YUIStorageEngine",b=null,f=encodeURIComponent,a=decodeURIComponent,c=function(l,o){var n=this,p={},k,i,j;c.superclass.constructor.call(n,l,c.ENGINE_NAME,o);
if(!b){b=google.gears.factory.create(c.GEARS);b.open(window.location.host.replace(/[\/\:\*\?"\<\>\|;,]/g,"")+"-"+c.DATABASE);b.execute("CREATE TABLE IF NOT EXISTS "+g+" (key TEXT, location TEXT, value TEXT)");}k=h.StorageManager.LOCATION_SESSION===n._location;i=h.Cookie.get("sessionKey"+c.ENGINE_NAME);if(!i){b.execute("BEGIN");b.execute("DELETE FROM "+g+' WHERE location="'+f(h.StorageManager.LOCATION_SESSION)+'"');b.execute("COMMIT");}j=b.execute("SELECT key FROM "+g+' WHERE location="'+f(n._location)+'"');p={};try{while(j.isValidRow()){var m=a(j.field(0));if(!p[m]){p[m]=true;n._addKey(m);}j.next();}}finally{j.close();}if(k){h.Cookie.set("sessionKey"+c.ENGINE_NAME,true);}n.fireEvent(h.Storage.CE_READY);};d.extend(c,h.StorageEngineKeyed,{_clear:function(){c.superclass._clear.call(this);b.execute("BEGIN");b.execute("DELETE FROM "+g+' WHERE location="'+f(this._location)+'"');b.execute("COMMIT");},_getItem:function(k){var i=b.execute("SELECT value FROM "+g+' WHERE key="'+f(k)+'" AND location="'+f(this._location)+'"'),j="";try{while(i.isValidRow()){j+=i.field(0);i.next();}}finally{i.close();}return j?a(j):null;},_removeItem:function(i){c.superclass._removeItem.call(this,i);b.execute("BEGIN");b.execute("DELETE FROM "+g+' WHERE key="'+f(i)+'" AND location="'+f(this._location)+'"');b.execute("COMMIT");},_setItem:function(r,k){this._addKey(r);var l=f(r),m=f(this._location),p=f(k),q=[],s=e-(l+m).length,o=0,n;if(s<p.length){for(n=p.length;o<n;o+=s){q.push(p.substr(o,s));}}else{q.push(p);}b.execute("BEGIN");b.execute("DELETE FROM "+g+' WHERE key="'+l+'" AND location="'+m+'"');for(o=0,n=q.length;o<n;o+=1){b.execute("INSERT INTO "+g+' VALUES ("'+l+'", "'+m+'", "'+q[o]+'")');}b.execute("COMMIT");return true;}});h.Event.on("unload",function(){if(b){b.close();}});c.ENGINE_NAME="gears";c.GEARS="beta.database";c.DATABASE="yui.database";c.isAvailable=function(){if(("google" in window)&&("gears" in window.google)){try{google.gears.factory.create(c.GEARS);return true;}catch(i){}}return false;};h.StorageManager.register(c);h.StorageEngineGears=c;}());(function(){var b=YAHOO,i=b.util,g=b.lang,f=i.Dom,j=i.StorageManager,c=215,h=138,d=new RegExp("^("+j.LOCATION_SESSION+"|"+j.LOCATION_LOCAL+")"),e=null,k=function(m,n){return m._location+n;},a=function(n){if(!e){if(!g.isString(n.swfURL)){n.swfURL=l.SWFURL;}if(!n.containerID){var o=document.getElementsByTagName("body")[0],m=o.appendChild(document.createElement("div"));n.containerID=f.generateId(m);}if(!n.attributes){n.attributes={};}if(!n.attributes.flashVars){n.attributes.flashVars={};}n.attributes.flashVars.allowedDomain=document.location.hostname;n.attributes.flashVars.useCompression="true";n.attributes.version=9.115;e=new b.widget.SWF(n.containerID,n.swfURL,n.attributes);e.subscribe("save",function(p){b.log(p.message,"info");});e.subscribe("quotaExceededError",function(p){b.log(p.message,"error");});e.subscribe("inadequateDimensions",function(p){b.log(p.message,"error");});e.subscribe("error",function(p){b.log(p.message,"error");});e.subscribe("securityError",function(p){b.log(p.message,"error");});}},l=function(m,p){var o=this;l.superclass.constructor.call(o,m,l.ENGINE_NAME,p);a(o._cfg);var n=function(){o._swf=e._swf;e.initialized=true;var s=j.LOCATION_SESSION===o._location,r=i.Cookie.get("sessionKey"+l.ENGINE_NAME),u,t,q;for(u=e.callSWF("getLength",[])-1;0<=u;u-=1){t=e.callSWF("getNameAt",[u]);q=s&&(-1<t.indexOf(j.LOCATION_SESSION));if(q&&!r){e.callSWF("removeItem",[t]);}else{if(s===q){o._addKey(t);}}}if(s){i.Cookie.set("sessionKey"+l.ENGINE_NAME,true);}o.fireEvent(i.Storage.CE_READY);};if(e.initialized){n();}else{e.addListener("contentReady",n);}};g.extend(l,i.StorageEngineKeyed,{_swf:null,_clear:function(){for(var m=this._keys.length-1,n;0<=m;m-=1){n=this._keys[m];e.callSWF("removeItem",[n]);}l.superclass._clear.call(this);},_getItem:function(m){var n=k(this,m);return e.callSWF("getValueOf",[n]);},_key:function(m){return l.superclass._key.call(this,m).replace(d,"");},_removeItem:function(m){b.log("removing SWF key: "+m);var n=k(this,m);l.superclass._removeItem.call(this,n);e.callSWF("removeItem",[n]);},_setItem:function(m,p){var n=k(this,m),o;if(e.callSWF("setItem",[n,p])){this._addKey(n);return true;}else{o=f.get(e._id);if(c>f.getStyle(o,"width").replace(/\D+/g,"")){f.setStyle(o,"width",c+"px");}if(h>f.getStyle(o,"height").replace(/\D+/g,"")){f.setStyle(o,"height",h+"px");}b.log("attempting to show settings. are dimensions adequate? "+e.callSWF("hasAdequateDimensions"));return e.callSWF("displaySettings",[]);}}});l.SWFURL="swfstore.swf";l.ENGINE_NAME="swf";l.isAvailable=function(){return(6<=b.env.ua.flash&&b.widget.SWF);};j.register(l);i.StorageEngineSWF=l;}());YAHOO.register("storage",YAHOO.util.Storage,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: element-min.js (dbb679f7) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
YAHOO.util.Attribute=function(b,a){if(a){this.owner=a;this.configure(b,true);}};YAHOO.util.Attribute.INVALID_VALUE={};YAHOO.util.Attribute.prototype={name:undefined,value:null,owner:null,readOnly:false,writeOnce:false,_initialConfig:null,_written:false,method:null,setter:null,getter:null,validator:null,getValue:function(){var a=this.value;if(this.getter){a=this.getter.call(this.owner,this.name,a);}return a;},setValue:function(f,b){var e,a=this.owner,c=this.name,g=YAHOO.util.Attribute.INVALID_VALUE,d={type:c,prevValue:this.getValue(),newValue:f};if(this.readOnly||(this.writeOnce&&this._written)){return false;}if(this.validator&&!this.validator.call(a,f)){return false;}if(!b){e=a.fireBeforeChangeEvent(d);if(e===false){return false;}}if(this.setter){f=this.setter.call(a,f,this.name);if(f===undefined){}if(f===g){return false;}}if(this.method){if(this.method.call(a,f,this.name)===g){return false;}}this.value=f;this._written=true;d.type=c;if(!b){this.owner.fireChangeEvent(d);}return true;},configure:function(b,c){b=b||{};if(c){this._written=false;}this._initialConfig=this._initialConfig||{};for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a];if(c){this._initialConfig[a]=b[a];}}}},resetValue:function(){return this.setValue(this._initialConfig.value);},resetConfig:function(){this.configure(this._initialConfig,true);},refresh:function(a){this.setValue(this.value,a);}};(function(){var a=YAHOO.util.Lang;YAHOO.util.AttributeProvider=function(){};YAHOO.util.AttributeProvider.prototype={_configs:null,get:function(c){this._configs=this._configs||{};var b=this._configs[c];if(!b||!this._configs.hasOwnProperty(c)){return null;}return b.getValue();},set:function(d,e,b){this._configs=this._configs||{};var c=this._configs[d];if(!c){return false;}return c.setValue(e,b);},getAttributeKeys:function(){this._configs=this._configs;var c=[],b;for(b in this._configs){if(a.hasOwnProperty(this._configs,b)&&!a.isUndefined(this._configs[b])){c[c.length]=b;}}return c;},setAttributes:function(d,b){for(var c in d){if(a.hasOwnProperty(d,c)){this.set(c,d[c],b);}}},resetValue:function(c,b){this._configs=this._configs||{};if(this._configs[c]){this.set(c,this._configs[c]._initialConfig.value,b);return true;}return false;},refresh:function(e,c){this._configs=this._configs||{};var f=this._configs;e=((a.isString(e))?[e]:e)||this.getAttributeKeys();for(var d=0,b=e.length;d<b;++d){if(f.hasOwnProperty(e[d])){this._configs[e[d]].refresh(c);}}},register:function(b,c){this.setAttributeConfig(b,c);},getAttributeConfig:function(c){this._configs=this._configs||{};var b=this._configs[c]||{};var d={};for(c in b){if(a.hasOwnProperty(b,c)){d[c]=b[c];}}return d;},setAttributeConfig:function(b,c,d){this._configs=this._configs||{};c=c||{};if(!this._configs[b]){c.name=b;this._configs[b]=this.createAttribute(c);}else{this._configs[b].configure(c,d);}},configureAttribute:function(b,c,d){this.setAttributeConfig(b,c,d);},resetAttributeConfig:function(b){this._configs=this._configs||{};this._configs[b].resetConfig();},subscribe:function(b,c){this._events=this._events||{};if(!(b in this._events)){this._events[b]=this.createEvent(b);}YAHOO.util.EventProvider.prototype.subscribe.apply(this,arguments);},on:function(){this.subscribe.apply(this,arguments);},addListener:function(){this.subscribe.apply(this,arguments);},fireBeforeChangeEvent:function(c){var b="before";b+=c.type.charAt(0).toUpperCase()+c.type.substr(1)+"Change";c.type=b;return this.fireEvent(c.type,c);},fireChangeEvent:function(b){b.type+="Change";return this.fireEvent(b.type,b);},createAttribute:function(b){return new YAHOO.util.Attribute(b,this);}};YAHOO.augment(YAHOO.util.AttributeProvider,YAHOO.util.EventProvider);})();(function(){var b=YAHOO.util.Dom,d=YAHOO.util.AttributeProvider,c={mouseenter:true,mouseleave:true};var a=function(e,f){this.init.apply(this,arguments);};a.DOM_EVENTS={"click":true,"dblclick":true,"keydown":true,"keypress":true,"keyup":true,"mousedown":true,"mousemove":true,"mouseout":true,"mouseover":true,"mouseup":true,"mouseenter":true,"mouseleave":true,"focus":true,"blur":true,"submit":true,"change":true};a.prototype={DOM_EVENTS:null,DEFAULT_HTML_SETTER:function(g,e){var f=this.get("element");if(f){f[e]=g;}return g;},DEFAULT_HTML_GETTER:function(e){var f=this.get("element"),g;if(f){g=f[e];}return g;},appendChild:function(e){e=e.get?e.get("element"):e;return this.get("element").appendChild(e);},getElementsByTagName:function(e){return this.get("element").getElementsByTagName(e);},hasChildNodes:function(){return this.get("element").hasChildNodes();},insertBefore:function(e,f){e=e.get?e.get("element"):e;f=(f&&f.get)?f.get("element"):f;return this.get("element").insertBefore(e,f);},removeChild:function(e){e=e.get?e.get("element"):e;return this.get("element").removeChild(e);},replaceChild:function(e,f){e=e.get?e.get("element"):e;f=f.get?f.get("element"):f;return this.get("element").replaceChild(e,f);},initAttributes:function(e){},addListener:function(j,i,k,h){h=h||this;var e=YAHOO.util.Event,g=this.get("element")||this.get("id"),f=this;if(c[j]&&!e._createMouseDelegate){return false;}if(!this._events[j]){if(g&&this.DOM_EVENTS[j]){e.on(g,j,function(m,l){if(m.srcElement&&!m.target){m.target=m.srcElement;}if((m.toElement&&!m.relatedTarget)||(m.fromElement&&!m.relatedTarget)){m.relatedTarget=e.getRelatedTarget(m);}if(!m.currentTarget){m.currentTarget=g;}f.fireEvent(j,m,l);},k,h);}this.createEvent(j,{scope:this});}return YAHOO.util.EventProvider.prototype.subscribe.apply(this,arguments);},on:function(){return this.addListener.apply(this,arguments);},subscribe:function(){return this.addListener.apply(this,arguments);},removeListener:function(f,e){return this.unsubscribe.apply(this,arguments);},addClass:function(e){b.addClass(this.get("element"),e);},getElementsByClassName:function(f,e){return b.getElementsByClassName(f,e,this.get("element"));},hasClass:function(e){return b.hasClass(this.get("element"),e);},removeClass:function(e){return b.removeClass(this.get("element"),e);},replaceClass:function(f,e){return b.replaceClass(this.get("element"),f,e);
},setStyle:function(f,e){return b.setStyle(this.get("element"),f,e);},getStyle:function(e){return b.getStyle(this.get("element"),e);},fireQueue:function(){var f=this._queue;for(var g=0,e=f.length;g<e;++g){this[f[g][0]].apply(this,f[g][1]);}},appendTo:function(f,g){f=(f.get)?f.get("element"):b.get(f);this.fireEvent("beforeAppendTo",{type:"beforeAppendTo",target:f});g=(g&&g.get)?g.get("element"):b.get(g);var e=this.get("element");if(!e){return false;}if(!f){return false;}if(e.parent!=f){if(g){f.insertBefore(e,g);}else{f.appendChild(e);}}this.fireEvent("appendTo",{type:"appendTo",target:f});return e;},get:function(e){var g=this._configs||{},f=g.element;if(f&&!g[e]&&!YAHOO.lang.isUndefined(f.value[e])){this._setHTMLAttrConfig(e);}return d.prototype.get.call(this,e);},setAttributes:function(l,h){var f={},j=this._configOrder;for(var k=0,e=j.length;k<e;++k){if(l[j[k]]!==undefined){f[j[k]]=true;this.set(j[k],l[j[k]],h);}}for(var g in l){if(l.hasOwnProperty(g)&&!f[g]){this.set(g,l[g],h);}}},set:function(f,h,e){var g=this.get("element");if(!g){this._queue[this._queue.length]=["set",arguments];if(this._configs[f]){this._configs[f].value=h;}return;}if(!this._configs[f]&&!YAHOO.lang.isUndefined(g[f])){this._setHTMLAttrConfig(f);}return d.prototype.set.apply(this,arguments);},setAttributeConfig:function(e,f,g){this._configOrder.push(e);d.prototype.setAttributeConfig.apply(this,arguments);},createEvent:function(f,e){this._events[f]=true;return d.prototype.createEvent.apply(this,arguments);},init:function(f,e){this._initElement(f,e);},destroy:function(){var e=this.get("element");YAHOO.util.Event.purgeElement(e,true);this.unsubscribeAll();if(e&&e.parentNode){e.parentNode.removeChild(e);}this._queue=[];this._events={};this._configs={};this._configOrder=[];},_initElement:function(g,f){this._queue=this._queue||[];this._events=this._events||{};this._configs=this._configs||{};this._configOrder=[];f=f||{};f.element=f.element||g||null;var i=false;var e=a.DOM_EVENTS;this.DOM_EVENTS=this.DOM_EVENTS||{};for(var h in e){if(e.hasOwnProperty(h)){this.DOM_EVENTS[h]=e[h];}}if(typeof f.element==="string"){this._setHTMLAttrConfig("id",{value:f.element});}if(b.get(f.element)){i=true;this._initHTMLElement(f);this._initContent(f);}YAHOO.util.Event.onAvailable(f.element,function(){if(!i){this._initHTMLElement(f);}this.fireEvent("available",{type:"available",target:b.get(f.element)});},this,true);YAHOO.util.Event.onContentReady(f.element,function(){if(!i){this._initContent(f);}this.fireEvent("contentReady",{type:"contentReady",target:b.get(f.element)});},this,true);},_initHTMLElement:function(e){this.setAttributeConfig("element",{value:b.get(e.element),readOnly:true});},_initContent:function(e){this.initAttributes(e);this.setAttributes(e,true);this.fireQueue();},_setHTMLAttrConfig:function(e,g){var f=this.get("element");g=g||{};g.name=e;g.setter=g.setter||this.DEFAULT_HTML_SETTER;g.getter=g.getter||this.DEFAULT_HTML_GETTER;g.value=g.value||f[e];this._configs[e]=new YAHOO.util.Attribute(g,this);}};YAHOO.augment(a,d);YAHOO.util.Element=a;})();YAHOO.register("element",YAHOO.util.Element,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: button-min.js (a0429a46) 9/9/2014 2:08:59 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
(function(){var G=YAHOO.util.Dom,M=YAHOO.util.Event,I=YAHOO.lang,L=YAHOO.env.ua,B=YAHOO.widget.Overlay,J=YAHOO.widget.Menu,D={},K=null,E=null,C=null;function F(O,N,R,P){var S,Q;if(I.isString(O)&&I.isString(N)){if(L.ie&&(L.ie<9)){Q='<input type="'+O+'" name="'+N+'"';if(P){Q+=" checked";}Q+=">";S=document.createElement(Q);S.value=R;}else{S=document.createElement("input");S.name=N;S.type=O;S.value=R;if(P){S.checked=true;}}}return S;}function H(O,V){var N=O.nodeName.toUpperCase(),S=(this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME),T=this,U,P,Q;function W(X){if(!(X in V)){U=O.getAttributeNode(X);if(U&&("value" in U)){V[X]=U.value;}}}function R(){W("type");if(V.type=="button"){V.type="push";}if(!("disabled" in V)){V.disabled=O.disabled;}W("name");W("value");W("title");}switch(N){case"A":V.type="link";W("href");W("target");break;case"INPUT":R();if(!("checked" in V)){V.checked=O.checked;}break;case"BUTTON":R();P=O.parentNode.parentNode;if(G.hasClass(P,S+"-checked")){V.checked=true;}if(G.hasClass(P,S+"-disabled")){V.disabled=true;}O.removeAttribute("value");O.setAttribute("type","button");break;}O.removeAttribute("id");O.removeAttribute("name");if(!("tabindex" in V)){V.tabindex=O.tabIndex;}if(!("label" in V)){Q=N=="INPUT"?O.value:O.innerHTML;if(Q&&Q.length>0){V.label=Q;}}}function A(P){var O=P.attributes,N=O.srcelement,R=N.nodeName.toUpperCase(),Q=this;if(R==this.NODE_NAME){P.element=N;P.id=N.id;G.getElementsBy(function(S){switch(S.nodeName.toUpperCase()){case"BUTTON":case"A":case"INPUT":H.call(Q,S,O);break;}},"*",N);}else{switch(R){case"BUTTON":case"A":case"INPUT":H.call(this,N,O);break;}}}YAHOO.widget.Button=function(R,O){if(!B&&YAHOO.widget.Overlay){B=YAHOO.widget.Overlay;}if(!J&&YAHOO.widget.Menu){J=YAHOO.widget.Menu;}var Q=YAHOO.widget.Button.superclass.constructor,P,N;if(arguments.length==1&&!I.isString(R)&&!R.nodeName){if(!R.id){R.id=G.generateId();}Q.call(this,(this.createButtonElement(R.type)),R);}else{P={element:null,attributes:(O||{})};if(I.isString(R)){N=G.get(R);if(N){if(!P.attributes.id){P.attributes.id=R;}P.attributes.srcelement=N;A.call(this,P);if(!P.element){P.element=this.createButtonElement(P.attributes.type);}Q.call(this,P.element,P.attributes);}}else{if(R.nodeName){if(!P.attributes.id){if(R.id){P.attributes.id=R.id;}else{P.attributes.id=G.generateId();}}P.attributes.srcelement=R;A.call(this,P);if(!P.element){P.element=this.createButtonElement(P.attributes.type);}Q.call(this,P.element,P.attributes);}}}};YAHOO.extend(YAHOO.widget.Button,YAHOO.util.Element,{_button:null,_menu:null,_hiddenFields:null,_onclickAttributeValue:null,_activationKeyPressed:false,_activationButtonPressed:false,_hasKeyEventHandlers:false,_hasMouseEventHandlers:false,_nOptionRegionX:0,CLASS_NAME_PREFIX:"yui-",NODE_NAME:"SPAN",CHECK_ACTIVATION_KEYS:[32],ACTIVATION_KEYS:[13,32],OPTION_AREA_WIDTH:20,CSS_CLASS_NAME:"button",_setType:function(N){if(N=="split"){this.on("option",this._onOption);}},_setLabel:function(O){this._button.innerHTML=O;var P,N=L.gecko;if(N&&N<1.9&&G.inDocument(this.get("element"))){P=(this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME);this.removeClass(P);I.later(0,this,this.addClass,P);}},_setTabIndex:function(N){this._button.tabIndex=N;},_setTitle:function(N){if(this.get("type")!="link"){this._button.title=N;}},_setDisabled:function(N){if(this.get("type")!="link"){if(N){if(this._menu){this._menu.hide();}if(this.hasFocus()){this.blur();}this._button.setAttribute("disabled","disabled");this.addStateCSSClasses("disabled");this.removeStateCSSClasses("hover");this.removeStateCSSClasses("active");this.removeStateCSSClasses("focus");}else{this._button.removeAttribute("disabled");this.removeStateCSSClasses("disabled");}}},_setHref:function(N){if(this.get("type")=="link"){this._button.href=N;}},_setTarget:function(N){if(this.get("type")=="link"){this._button.setAttribute("target",N);}},_setChecked:function(N){var O=this.get("type");if(O=="checkbox"||O=="radio"){if(N){this.addStateCSSClasses("checked");}else{this.removeStateCSSClasses("checked");}}},_setMenu:function(U){var P=this.get("lazyloadmenu"),R=this.get("element"),N,W=false,X,O,Q;function V(){X.render(R.parentNode);this.removeListener("appendTo",V);}function T(){X.cfg.queueProperty("container",R.parentNode);this.removeListener("appendTo",T);}function S(){var Y;if(X){G.addClass(X.element,this.get("menuclassname"));G.addClass(X.element,this.CLASS_NAME_PREFIX+this.get("type")+"-button-menu");X.showEvent.subscribe(this._onMenuShow,null,this);X.hideEvent.subscribe(this._onMenuHide,null,this);X.renderEvent.subscribe(this._onMenuRender,null,this);if(J&&X instanceof J){if(P){Y=this.get("container");if(Y){X.cfg.queueProperty("container",Y);}else{this.on("appendTo",T);}}X.cfg.queueProperty("clicktohide",false);X.keyDownEvent.subscribe(this._onMenuKeyDown,this,true);X.subscribe("click",this._onMenuClick,this,true);this.on("selectedMenuItemChange",this._onSelectedMenuItemChange);Q=X.srcElement;if(Q&&Q.nodeName.toUpperCase()=="SELECT"){Q.style.display="none";Q.parentNode.removeChild(Q);}}else{if(B&&X instanceof B){if(!K){K=new YAHOO.widget.OverlayManager();}K.register(X);}}this._menu=X;if(!W&&!P){if(G.inDocument(R)){X.render(R.parentNode);}else{this.on("appendTo",V);}}}}if(B){if(J){N=J.prototype.CSS_CLASS_NAME;}if(U&&J&&(U instanceof J)){X=U;W=true;S.call(this);}else{if(B&&U&&(U instanceof B)){X=U;W=true;X.cfg.queueProperty("visible",false);S.call(this);}else{if(J&&I.isArray(U)){X=new J(G.generateId(),{lazyload:P,itemdata:U});this._menu=X;this.on("appendTo",S);}else{if(I.isString(U)){O=G.get(U);if(O){if(J&&G.hasClass(O,N)||O.nodeName.toUpperCase()=="SELECT"){X=new J(U,{lazyload:P});S.call(this);}else{if(B){X=new B(U,{visible:false});S.call(this);}}}}else{if(U&&U.nodeName){if(J&&G.hasClass(U,N)||U.nodeName.toUpperCase()=="SELECT"){X=new J(U,{lazyload:P});S.call(this);}else{if(B){if(!U.id){G.generateId(U);}X=new B(U,{visible:false});S.call(this);}}}}}}}}},_setOnClick:function(N){if(this._onclickAttributeValue&&(this._onclickAttributeValue!=N)){this.removeListener("click",this._onclickAttributeValue.fn);
this._onclickAttributeValue=null;}if(!this._onclickAttributeValue&&I.isObject(N)&&I.isFunction(N.fn)){this.on("click",N.fn,N.obj,N.scope);this._onclickAttributeValue=N;}},_isActivationKey:function(N){var S=this.get("type"),O=(S=="checkbox"||S=="radio")?this.CHECK_ACTIVATION_KEYS:this.ACTIVATION_KEYS,Q=O.length,R=false,P;if(Q>0){P=Q-1;do{if(N==O[P]){R=true;break;}}while(P--);}return R;},_isSplitButtonOptionKey:function(P){var O=(M.getCharCode(P)==40);var N=function(Q){M.preventDefault(Q);this.removeListener("keypress",N);};if(O){if(L.opera){this.on("keypress",N);}M.preventDefault(P);}return O;},_addListenersToForm:function(){var T=this.getForm(),S=YAHOO.widget.Button.onFormKeyPress,R,N,Q,P,O;if(T){M.on(T,"reset",this._onFormReset,null,this);M.on(T,"submit",this._onFormSubmit,null,this);N=this.get("srcelement");if(this.get("type")=="submit"||(N&&N.type=="submit")){Q=M.getListeners(T,"keypress");R=false;if(Q){P=Q.length;if(P>0){O=P-1;do{if(Q[O].fn==S){R=true;break;}}while(O--);}}if(!R){M.on(T,"keypress",S);}}}},_showMenu:function(R){if(YAHOO.widget.MenuManager){YAHOO.widget.MenuManager.hideVisible();}if(K){K.hideAll();}var N=this._menu,Q=this.get("menualignment"),P=this.get("focusmenu"),O;if(this._renderedMenu){N.cfg.setProperty("context",[this.get("element"),Q[0],Q[1]]);N.cfg.setProperty("preventcontextoverlap",true);N.cfg.setProperty("constraintoviewport",true);}else{N.cfg.queueProperty("context",[this.get("element"),Q[0],Q[1]]);N.cfg.queueProperty("preventcontextoverlap",true);N.cfg.queueProperty("constraintoviewport",true);}this.focus();if(J&&N&&(N instanceof J)){O=N.focus;N.focus=function(){};if(this._renderedMenu){N.cfg.setProperty("minscrollheight",this.get("menuminscrollheight"));N.cfg.setProperty("maxheight",this.get("menumaxheight"));}else{N.cfg.queueProperty("minscrollheight",this.get("menuminscrollheight"));N.cfg.queueProperty("maxheight",this.get("menumaxheight"));}N.show();N.focus=O;N.align();if(R.type=="mousedown"){M.stopPropagation(R);}if(P){N.focus();}}else{if(B&&N&&(N instanceof B)){if(!this._renderedMenu){N.render(this.get("element").parentNode);}N.show();N.align();}}},_hideMenu:function(){var N=this._menu;if(N){N.hide();}},_onMouseOver:function(O){var Q=this.get("type"),N,P;if(Q==="split"){N=this.get("element");P=(G.getX(N)+(N.offsetWidth-this.OPTION_AREA_WIDTH));this._nOptionRegionX=P;}if(!this._hasMouseEventHandlers){if(Q==="split"){this.on("mousemove",this._onMouseMove);}this.on("mouseout",this._onMouseOut);this._hasMouseEventHandlers=true;}this.addStateCSSClasses("hover");if(Q==="split"&&(M.getPageX(O)>P)){this.addStateCSSClasses("hoveroption");}if(this._activationButtonPressed){this.addStateCSSClasses("active");}if(this._bOptionPressed){this.addStateCSSClasses("activeoption");}if(this._activationButtonPressed||this._bOptionPressed){M.removeListener(document,"mouseup",this._onDocumentMouseUp);}},_onMouseMove:function(N){var O=this._nOptionRegionX;if(O){if(M.getPageX(N)>O){this.addStateCSSClasses("hoveroption");}else{this.removeStateCSSClasses("hoveroption");}}},_onMouseOut:function(N){var O=this.get("type");this.removeStateCSSClasses("hover");if(O!="menu"){this.removeStateCSSClasses("active");}if(this._activationButtonPressed||this._bOptionPressed){M.on(document,"mouseup",this._onDocumentMouseUp,null,this);}if(O==="split"&&(M.getPageX(N)>this._nOptionRegionX)){this.removeStateCSSClasses("hoveroption");}},_onDocumentMouseUp:function(P){this._activationButtonPressed=false;this._bOptionPressed=false;var Q=this.get("type"),N,O;if(Q=="menu"||Q=="split"){N=M.getTarget(P);O=this._menu.element;if(N!=O&&!G.isAncestor(O,N)){this.removeStateCSSClasses((Q=="menu"?"active":"activeoption"));this._hideMenu();}}M.removeListener(document,"mouseup",this._onDocumentMouseUp);},_onMouseDown:function(P){var Q,O=true;function N(){this._hideMenu();this.removeListener("mouseup",N);}if((P.which||P.button)==1){if(!this.hasFocus()){I.later(0,this,this.focus);}Q=this.get("type");if(Q=="split"){if(M.getPageX(P)>this._nOptionRegionX){this.fireEvent("option",P);O=false;}else{this.addStateCSSClasses("active");this._activationButtonPressed=true;}}else{if(Q=="menu"){if(this.isActive()){this._hideMenu();this._activationButtonPressed=false;}else{this._showMenu(P);this._activationButtonPressed=true;}}else{this.addStateCSSClasses("active");this._activationButtonPressed=true;}}if(Q=="split"||Q=="menu"){this._hideMenuTimer=I.later(250,this,this.on,["mouseup",N]);}}return O;},_onMouseUp:function(P){this.inMouseDown=false;var Q=this.get("type"),N=this._hideMenuTimer,O=true;if(N){N.cancel();}if(Q=="checkbox"||Q=="radio"){if((P.which||P.button)!=1){return;}this.set("checked",!(this.get("checked")));}this._activationButtonPressed=false;if(Q!="menu"){this.removeStateCSSClasses("active");}if(Q=="split"&&M.getPageX(P)>this._nOptionRegionX){O=false;}return O;},_onFocus:function(O){var N;this.addStateCSSClasses("focus");if(this._activationKeyPressed){this.addStateCSSClasses("active");}C=this;if(!this._hasKeyEventHandlers){N=this._button;M.on(N,"blur",this._onBlur,null,this);M.on(N,"keydown",this._onKeyDown,null,this);M.on(N,"keyup",this._onKeyUp,null,this);this._hasKeyEventHandlers=true;}this.fireEvent("focus",O);},_onBlur:function(N){this.removeStateCSSClasses("focus");if(this.get("type")!="menu"){this.removeStateCSSClasses("active");}if(this._activationKeyPressed){M.on(document,"keyup",this._onDocumentKeyUp,null,this);}C=null;this.fireEvent("blur",N);},_onDocumentKeyUp:function(N){if(this._isActivationKey(M.getCharCode(N))){this._activationKeyPressed=false;M.removeListener(document,"keyup",this._onDocumentKeyUp);}},_onKeyDown:function(O){var N=this._menu;if(this.get("type")=="split"&&this._isSplitButtonOptionKey(O)){this.fireEvent("option",O);}else{if(this._isActivationKey(M.getCharCode(O))){if(this.get("type")=="menu"){this._showMenu(O);}else{this._activationKeyPressed=true;this.addStateCSSClasses("active");}}}if(N&&N.cfg.getProperty("visible")&&M.getCharCode(O)==27){N.hide();this.focus();}},_onKeyUp:function(N){var O;
if(this._isActivationKey(M.getCharCode(N))){O=this.get("type");if(O=="checkbox"||O=="radio"){this.set("checked",!(this.get("checked")));}this._activationKeyPressed=false;if(this.get("type")!="menu"){this.removeStateCSSClasses("active");}}},_onClick:function(P){var R=this.get("type"),Q,N,O;switch(R){case"submit":if(P.returnValue!==false){this.submitForm();}break;case"reset":Q=this.getForm();if(Q){Q.reset();}break;case"split":if(this._nOptionRegionX>0&&(M.getPageX(P)>this._nOptionRegionX)){O=false;}else{this._hideMenu();N=this.get("srcelement");if(N&&N.type=="submit"&&P.returnValue!==false){this.submitForm();}}break;}return O;},_onDblClick:function(O){var N=true;if(this.get("type")=="split"&&M.getPageX(O)>this._nOptionRegionX){N=false;}return N;},_onAppendTo:function(N){I.later(0,this,this._addListenersToForm);},_onFormReset:function(O){var P=this.get("type"),N=this._menu;if(P=="checkbox"||P=="radio"){this.resetValue("checked");}if(J&&N&&(N instanceof J)){this.resetValue("selectedMenuItem");}},_onFormSubmit:function(N){this.createHiddenFields();},_onDocumentMouseDown:function(R){var O=M.getTarget(R),Q=this.get("element"),P=this._menu.element;function N(T){var V,S,U;if(!T){return true;}for(V=0,S=T.length;V<S;V++){U=T[V].element;if(O==U||G.isAncestor(U,O)){return true;}if(T[V]&&T[V].getSubmenus){if(N(T[V].getSubmenus())){return true;}}}return false;}if(O!=Q&&!G.isAncestor(Q,O)&&O!=P&&!G.isAncestor(P,O)){if(this._menu&&this._menu.getSubmenus){if(!N(this._menu.getSubmenus())){return;}}this._hideMenu();if(L.ie&&(L.ie<9)&&O.focus){O.setActive();}M.removeListener(document,"mousedown",this._onDocumentMouseDown);}},_onOption:function(N){if(this.hasClass(this.CLASS_NAME_PREFIX+"split-button-activeoption")){this._hideMenu();this._bOptionPressed=false;}else{this._showMenu(N);this._bOptionPressed=true;}},_onMenuShow:function(N){M.on(document,"mousedown",this._onDocumentMouseDown,null,this);var O=(this.get("type")=="split")?"activeoption":"active";this.addStateCSSClasses(O);},_onMenuHide:function(N){var O=(this.get("type")=="split")?"activeoption":"active";this.removeStateCSSClasses(O);if(this.get("type")=="split"){this._bOptionPressed=false;}},_onMenuKeyDown:function(P,O){var N=O[0];if(M.getCharCode(N)==27){this.focus();if(this.get("type")=="split"){this._bOptionPressed=false;}}},_onMenuRender:function(P){var S=this.get("element"),O=S.parentNode,N=this._menu,R=N.element,Q=N.srcElement,T;if(O!=R.parentNode){O.appendChild(R);}this._renderedMenu=true;if(Q&&Q.nodeName.toLowerCase()==="select"&&Q.value){T=N.getItem(Q.selectedIndex);this.set("selectedMenuItem",T,true);this._onSelectedMenuItemChange({newValue:T});}},_onMenuClick:function(O,N){var Q=N[1],P;if(Q){this.set("selectedMenuItem",Q);P=this.get("srcelement");if(P&&P.type=="submit"){this.submitForm();}this._hideMenu();}},_onSelectedMenuItemChange:function(O){var P=O.prevValue,Q=O.newValue,N=this.CLASS_NAME_PREFIX;if(P){G.removeClass(P.element,(N+"button-selectedmenuitem"));}if(Q){G.addClass(Q.element,(N+"button-selectedmenuitem"));}},_onLabelClick:function(N){this.focus();var O=this.get("type");if(O=="radio"||O=="checkbox"){this.set("checked",(!this.get("checked")));}},createButtonElement:function(N){var P=this.NODE_NAME,O=document.createElement(P);O.innerHTML="<"+P+' class="first-child">'+(N=="link"?"<a></a>":'<button type="button"></button>')+"</"+P+">";return O;},addStateCSSClasses:function(O){var P=this.get("type"),N=this.CLASS_NAME_PREFIX;if(I.isString(O)){if(O!="activeoption"&&O!="hoveroption"){this.addClass(N+this.CSS_CLASS_NAME+("-"+O));}this.addClass(N+P+("-button-"+O));}},removeStateCSSClasses:function(O){var P=this.get("type"),N=this.CLASS_NAME_PREFIX;if(I.isString(O)){this.removeClass(N+this.CSS_CLASS_NAME+("-"+O));this.removeClass(N+P+("-button-"+O));}},createHiddenFields:function(){this.removeHiddenFields();var V=this.getForm(),Z,O,S,X,Y,T,U,N,R,W,P,Q=false;if(V&&!this.get("disabled")){O=this.get("type");S=(O=="checkbox"||O=="radio");if((S&&this.get("checked"))||(E==this)){Z=F((S?O:"hidden"),this.get("name"),this.get("value"),this.get("checked"));if(Z){if(S){Z.style.display="none";}V.appendChild(Z);}}X=this._menu;if(J&&X&&(X instanceof J)){Y=this.get("selectedMenuItem");P=X.srcElement;Q=(P&&P.nodeName.toUpperCase()=="SELECT");if(Y){U=(Y.value===null||Y.value==="")?Y.cfg.getProperty("text"):Y.value;T=this.get("name");if(Q){W=P.name;}else{if(T){W=(T+"_options");}}if(U&&W){N=F("hidden",W,U);V.appendChild(N);}}else{if(Q){N=V.appendChild(P);}}}if(Z&&N){this._hiddenFields=[Z,N];}else{if(!Z&&N){this._hiddenFields=N;}else{if(Z&&!N){this._hiddenFields=Z;}}}R=this._hiddenFields;}return R;},removeHiddenFields:function(){var Q=this._hiddenFields,O,P;function N(R){if(G.inDocument(R)){R.parentNode.removeChild(R);}}if(Q){if(I.isArray(Q)){O=Q.length;if(O>0){P=O-1;do{N(Q[P]);}while(P--);}}else{N(Q);}this._hiddenFields=null;}},submitForm:function(){var Q=this.getForm(),P=this.get("srcelement"),O=false,N;if(Q){if(this.get("type")=="submit"||(P&&P.type=="submit")){E=this;}if(L.ie&&(L.ie<9)){O=Q.fireEvent("onsubmit");}else{N=document.createEvent("HTMLEvents");N.initEvent("submit",true,true);O=Q.dispatchEvent(N);}if((L.ie||L.webkit)&&O){Q.submit();}}return O;},init:function(P,d){var V=d.type=="link"?"a":"button",a=d.srcelement,S=P.getElementsByTagName(V)[0],U;if(!S){U=P.getElementsByTagName("input")[0];if(U){S=document.createElement("button");S.setAttribute("type","button");U.parentNode.replaceChild(S,U);}}this._button=S;YAHOO.widget.Button.superclass.init.call(this,P,d);var T=this.get("id"),Z=T+"-button";S.id=Z;var X,Q;var e=function(f){return(f.htmlFor===T);};var c=function(){Q.setAttribute((L.ie?"htmlFor":"for"),Z);};if(a&&this.get("type")!="link"){X=G.getElementsBy(e,"label");if(I.isArray(X)&&X.length>0){Q=X[0];}}D[T]=this;var b=this.CLASS_NAME_PREFIX;this.addClass(b+this.CSS_CLASS_NAME);this.addClass(b+this.get("type")+"-button");M.on(this._button,"focus",this._onFocus,null,this);this.on("mouseover",this._onMouseOver);this.on("mousedown",this._onMouseDown);
this.on("mouseup",this._onMouseUp);this.on("click",this._onClick);var R=this.get("onclick");this.set("onclick",null);this.set("onclick",R);this.on("dblclick",this._onDblClick);var O;if(Q){if(this.get("replaceLabel")){this.set("label",Q.innerHTML);O=Q.parentNode;O.removeChild(Q);}else{this.on("appendTo",c);M.on(Q,"click",this._onLabelClick,null,this);this._label=Q;}}this.on("appendTo",this._onAppendTo);var N=this.get("container"),Y=this.get("element"),W=G.inDocument(Y);if(N){if(a&&a!=Y){O=a.parentNode;if(O){O.removeChild(a);}}if(I.isString(N)){M.onContentReady(N,this.appendTo,N,this);}else{this.on("init",function(){I.later(0,this,this.appendTo,N);});}}else{if(!W&&a&&a!=Y){O=a.parentNode;if(O){this.fireEvent("beforeAppendTo",{type:"beforeAppendTo",target:O});O.replaceChild(Y,a);this.fireEvent("appendTo",{type:"appendTo",target:O});}}else{if(this.get("type")!="link"&&W&&a&&a==Y){this._addListenersToForm();}}}this.fireEvent("init",{type:"init",target:this});},initAttributes:function(O){var N=O||{};YAHOO.widget.Button.superclass.initAttributes.call(this,N);this.setAttributeConfig("type",{value:(N.type||"push"),validator:I.isString,writeOnce:true,method:this._setType});this.setAttributeConfig("label",{value:N.label,validator:I.isString,method:this._setLabel});this.setAttributeConfig("value",{value:N.value});this.setAttributeConfig("name",{value:N.name,validator:I.isString});this.setAttributeConfig("tabindex",{value:N.tabindex,validator:I.isNumber,method:this._setTabIndex});this.configureAttribute("title",{value:N.title,validator:I.isString,method:this._setTitle});this.setAttributeConfig("disabled",{value:(N.disabled||false),validator:I.isBoolean,method:this._setDisabled});this.setAttributeConfig("href",{value:N.href,validator:I.isString,method:this._setHref});this.setAttributeConfig("target",{value:N.target,validator:I.isString,method:this._setTarget});this.setAttributeConfig("checked",{value:(N.checked||false),validator:I.isBoolean,method:this._setChecked});this.setAttributeConfig("container",{value:N.container,writeOnce:true});this.setAttributeConfig("srcelement",{value:N.srcelement,writeOnce:true});this.setAttributeConfig("menu",{value:null,method:this._setMenu,writeOnce:true});this.setAttributeConfig("lazyloadmenu",{value:(N.lazyloadmenu===false?false:true),validator:I.isBoolean,writeOnce:true});this.setAttributeConfig("menuclassname",{value:(N.menuclassname||(this.CLASS_NAME_PREFIX+"button-menu")),validator:I.isString,method:this._setMenuClassName,writeOnce:true});this.setAttributeConfig("menuminscrollheight",{value:(N.menuminscrollheight||90),validator:I.isNumber});this.setAttributeConfig("menumaxheight",{value:(N.menumaxheight||0),validator:I.isNumber});this.setAttributeConfig("menualignment",{value:(N.menualignment||["tl","bl"]),validator:I.isArray});this.setAttributeConfig("selectedMenuItem",{value:null});this.setAttributeConfig("onclick",{value:N.onclick,method:this._setOnClick});this.setAttributeConfig("focusmenu",{value:(N.focusmenu===false?false:true),validator:I.isBoolean});this.setAttributeConfig("replaceLabel",{value:false,validator:I.isBoolean,writeOnce:true});},focus:function(){if(!this.get("disabled")){try{this._button.focus();}catch(N){}}},blur:function(){if(!this.get("disabled")){try{this._button.blur();}catch(N){}}},hasFocus:function(){return(C==this);},isActive:function(){return this.hasClass(this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME+"-active");},getMenu:function(){return this._menu;},getForm:function(){var N=this._button,O;if(N){O=N.form;}return O;},getHiddenFields:function(){return this._hiddenFields;},destroy:function(){var P=this.get("element"),N=this._menu,T=this._label,O,S;if(N){if(K&&K.find(N)){K.remove(N);}N.destroy();}M.purgeElement(P);M.purgeElement(this._button);M.removeListener(document,"mouseup",this._onDocumentMouseUp);M.removeListener(document,"keyup",this._onDocumentKeyUp);M.removeListener(document,"mousedown",this._onDocumentMouseDown);if(T){M.removeListener(T,"click",this._onLabelClick);O=T.parentNode;O.removeChild(T);}var Q=this.getForm();if(Q){M.removeListener(Q,"reset",this._onFormReset);M.removeListener(Q,"submit",this._onFormSubmit);}this.unsubscribeAll();O=P.parentNode;if(O){O.removeChild(P);}delete D[this.get("id")];var R=(this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME);S=G.getElementsByClassName(R,this.NODE_NAME,Q);if(I.isArray(S)&&S.length===0){M.removeListener(Q,"keypress",YAHOO.widget.Button.onFormKeyPress);}},fireEvent:function(O,N){var P=arguments[0];if(this.DOM_EVENTS[P]&&this.get("disabled")){return false;}return YAHOO.widget.Button.superclass.fireEvent.apply(this,arguments);},toString:function(){return("Button "+this.get("id"));}});YAHOO.widget.Button.onFormKeyPress=function(R){var P=M.getTarget(R),S=M.getCharCode(R),Q=P.nodeName&&P.nodeName.toUpperCase(),N=P.type,T=false,V,X,O,W;function U(a){var Z,Y;switch(a.nodeName.toUpperCase()){case"INPUT":case"BUTTON":if(a.type=="submit"&&!a.disabled){if(!T&&!O){O=a;}}break;default:Z=a.id;if(Z){V=D[Z];if(V){T=true;if(!V.get("disabled")){Y=V.get("srcelement");if(!X&&(V.get("type")=="submit"||(Y&&Y.type=="submit"))){X=V;}}}}break;}}if(S==13&&((Q=="INPUT"&&(N=="text"||N=="password"||N=="checkbox"||N=="radio"||N=="file"))||Q=="SELECT")){G.getElementsBy(U,"*",this);if(O){O.focus();}else{if(!O&&X){M.preventDefault(R);if(L.ie){X.get("element").fireEvent("onclick");}else{W=document.createEvent("HTMLEvents");W.initEvent("click",true,true);if(L.gecko<1.9){X.fireEvent("click",W);}else{X.get("element").dispatchEvent(W);}}}}}};YAHOO.widget.Button.addHiddenFieldsToForm=function(N){var R=YAHOO.widget.Button.prototype,T=G.getElementsByClassName((R.CLASS_NAME_PREFIX+R.CSS_CLASS_NAME),"*",N),Q=T.length,S,O,P;if(Q>0){for(P=0;P<Q;P++){O=T[P].id;if(O){S=D[O];if(S){S.createHiddenFields();}}}}};YAHOO.widget.Button.getButton=function(N){return D[N];};})();(function(){var C=YAHOO.util.Dom,B=YAHOO.util.Event,D=YAHOO.lang,A=YAHOO.widget.Button,E={};YAHOO.widget.ButtonGroup=function(J,H){var I=YAHOO.widget.ButtonGroup.superclass.constructor,K,G,F;
if(arguments.length==1&&!D.isString(J)&&!J.nodeName){if(!J.id){F=C.generateId();J.id=F;}I.call(this,(this._createGroupElement()),J);}else{if(D.isString(J)){G=C.get(J);if(G){if(G.nodeName.toUpperCase()==this.NODE_NAME){I.call(this,G,H);}}}else{K=J.nodeName.toUpperCase();if(K&&K==this.NODE_NAME){if(!J.id){J.id=C.generateId();}I.call(this,J,H);}}}};YAHOO.extend(YAHOO.widget.ButtonGroup,YAHOO.util.Element,{_buttons:null,NODE_NAME:"DIV",CLASS_NAME_PREFIX:"yui-",CSS_CLASS_NAME:"buttongroup",_createGroupElement:function(){var F=document.createElement(this.NODE_NAME);return F;},_setDisabled:function(G){var H=this.getCount(),F;if(H>0){F=H-1;do{this._buttons[F].set("disabled",G);}while(F--);}},_onKeyDown:function(K){var G=B.getTarget(K),I=B.getCharCode(K),H=G.parentNode.parentNode.id,J=E[H],F=-1;if(I==37||I==38){F=(J.index===0)?(this._buttons.length-1):(J.index-1);}else{if(I==39||I==40){F=(J.index===(this._buttons.length-1))?0:(J.index+1);}}if(F>-1){this.check(F);this.getButton(F).focus();}},_onAppendTo:function(H){var I=this._buttons,G=I.length,F;for(F=0;F<G;F++){I[F].appendTo(this.get("element"));}},_onButtonCheckedChange:function(G,F){var I=G.newValue,H=this.get("checkedButton");if(I&&H!=F){if(H){H.set("checked",false,true);}this.set("checkedButton",F);this.set("value",F.get("value"));}else{if(H&&!H.set("checked")){H.set("checked",true,true);}}},init:function(I,H){this._buttons=[];YAHOO.widget.ButtonGroup.superclass.init.call(this,I,H);this.addClass(this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME);var K=(YAHOO.widget.Button.prototype.CLASS_NAME_PREFIX+"radio-button"),J=this.getElementsByClassName(K);if(J.length>0){this.addButtons(J);}function F(L){return(L.type=="radio");}J=C.getElementsBy(F,"input",this.get("element"));if(J.length>0){this.addButtons(J);}this.on("keydown",this._onKeyDown);this.on("appendTo",this._onAppendTo);var G=this.get("container");if(G){if(D.isString(G)){B.onContentReady(G,function(){this.appendTo(G);},null,this);}else{this.appendTo(G);}}},initAttributes:function(G){var F=G||{};YAHOO.widget.ButtonGroup.superclass.initAttributes.call(this,F);this.setAttributeConfig("name",{value:F.name,validator:D.isString});this.setAttributeConfig("disabled",{value:(F.disabled||false),validator:D.isBoolean,method:this._setDisabled});this.setAttributeConfig("value",{value:F.value});this.setAttributeConfig("container",{value:F.container,writeOnce:true});this.setAttributeConfig("checkedButton",{value:null});},addButton:function(J){var L,K,G,F,H,I;if(J instanceof A&&J.get("type")=="radio"){L=J;}else{if(!D.isString(J)&&!J.nodeName){J.type="radio";L=new A(J);}else{L=new A(J,{type:"radio"});}}if(L){F=this._buttons.length;H=L.get("name");I=this.get("name");L.index=F;this._buttons[F]=L;E[L.get("id")]=L;if(H!=I){L.set("name",I);}if(this.get("disabled")){L.set("disabled",true);}if(L.get("checked")){this.set("checkedButton",L);}K=L.get("element");G=this.get("element");if(K.parentNode!=G){G.appendChild(K);}L.on("checkedChange",this._onButtonCheckedChange,L,this);}return L;},addButtons:function(G){var H,I,J,F;if(D.isArray(G)){H=G.length;J=[];if(H>0){for(F=0;F<H;F++){I=this.addButton(G[F]);if(I){J[J.length]=I;}}}}return J;},removeButton:function(H){var I=this.getButton(H),G,F;if(I){this._buttons.splice(H,1);delete E[I.get("id")];I.removeListener("checkedChange",this._onButtonCheckedChange);I.destroy();G=this._buttons.length;if(G>0){F=this._buttons.length-1;do{this._buttons[F].index=F;}while(F--);}}},getButton:function(F){return this._buttons[F];},getButtons:function(){return this._buttons;},getCount:function(){return this._buttons.length;},focus:function(H){var I,G,F;if(D.isNumber(H)){I=this._buttons[H];if(I){I.focus();}}else{G=this.getCount();for(F=0;F<G;F++){I=this._buttons[F];if(!I.get("disabled")){I.focus();break;}}}},check:function(F){var G=this.getButton(F);if(G){G.set("checked",true);}},destroy:function(){var I=this._buttons.length,H=this.get("element"),F=H.parentNode,G;if(I>0){G=this._buttons.length-1;do{this._buttons[G].destroy();}while(G--);}B.purgeElement(H);F.removeChild(H);},toString:function(){return("ButtonGroup "+this.get("id"));}});})();YAHOO.register("button",YAHOO.widget.Button,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: animation-min.js (fef6821d) 9/9/2014 2:08:59 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
(function(){var b=YAHOO.util;var a=function(d,c,e,f){if(!d){}this.init(d,c,e,f);};a.NAME="Anim";a.prototype={toString:function(){var c=this.getEl()||{};var d=c.id||c.tagName;return(this.constructor.NAME+": "+d);},patterns:{noNegatives:/width|height|opacity|padding/i,offsetAttribute:/^((width|height)|(top|left))$/,defaultUnit:/width|height|top$|bottom$|left$|right$/i,offsetUnit:/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i},doMethod:function(c,e,d){return this.method(this.currentFrame,e,d-e,this.totalFrames);},setAttribute:function(c,f,e){var d=this.getEl();if(this.patterns.noNegatives.test(c)){f=(f>0)?f:0;}if(c in d&&!("style" in d&&c in d.style)){d[c]=f;}else{b.Dom.setStyle(d,c,f+e);}},getAttribute:function(c){var e=this.getEl();var g=b.Dom.getStyle(e,c);if(g!=="auto"&&!this.patterns.offsetUnit.test(g)){return parseFloat(g);}var d=this.patterns.offsetAttribute.exec(c)||[];var h=!!(d[3]);var f=!!(d[2]);if("style" in e){if(f||(b.Dom.getStyle(e,"position")=="absolute"&&h)){g=e["offset"+d[0].charAt(0).toUpperCase()+d[0].substr(1)];}else{g=0;}}else{if(c in e){g=e[c];}}return g;},getDefaultUnit:function(c){if(this.patterns.defaultUnit.test(c)){return"px";}return"";},setRuntimeAttribute:function(d){var j;var e;var f=this.attributes;this.runtimeAttributes[d]={};var h=function(i){return(typeof i!=="undefined");};if(!h(f[d]["to"])&&!h(f[d]["by"])){return false;}j=(h(f[d]["from"]))?f[d]["from"]:this.getAttribute(d);if(h(f[d]["to"])){e=f[d]["to"];}else{if(h(f[d]["by"])){if(j.constructor==Array){e=[];for(var g=0,c=j.length;g<c;++g){e[g]=j[g]+f[d]["by"][g]*1;}}else{e=j+f[d]["by"]*1;}}}this.runtimeAttributes[d].start=j;this.runtimeAttributes[d].end=e;this.runtimeAttributes[d].unit=(h(f[d].unit))?f[d]["unit"]:this.getDefaultUnit(d);return true;},init:function(f,c,h,i){var d=false;var e=null;var g=0;f=b.Dom.get(f);this.attributes=c||{};this.duration=!YAHOO.lang.isUndefined(h)?h:1;this.method=i||b.Easing.easeNone;this.useSeconds=true;this.currentFrame=0;this.totalFrames=b.AnimMgr.fps;this.setEl=function(j){f=b.Dom.get(j);};this.getEl=function(){return f;};this.isAnimated=function(){return d;};this.getStartTime=function(){return e;};this.runtimeAttributes={};this.animate=function(){if(this.isAnimated()){return false;}this.currentFrame=0;this.totalFrames=(this.useSeconds)?Math.ceil(b.AnimMgr.fps*this.duration):this.duration;if(this.duration===0&&this.useSeconds){this.totalFrames=1;}b.AnimMgr.registerElement(this);return true;};this.stop=function(j){if(!this.isAnimated()){return false;}if(j){this.currentFrame=this.totalFrames;this._onTween.fire();}b.AnimMgr.stop(this);};this._handleStart=function(){this.onStart.fire();this.runtimeAttributes={};for(var j in this.attributes){if(this.attributes.hasOwnProperty(j)){this.setRuntimeAttribute(j);}}d=true;g=0;e=new Date();};this._handleTween=function(){var l={duration:new Date()-this.getStartTime(),currentFrame:this.currentFrame};l.toString=function(){return("duration: "+l.duration+", currentFrame: "+l.currentFrame);};this.onTween.fire(l);var k=this.runtimeAttributes;for(var j in k){if(k.hasOwnProperty(j)){this.setAttribute(j,this.doMethod(j,k[j].start,k[j].end),k[j].unit);}}this.afterTween.fire(l);g+=1;};this._handleComplete=function(){var j=(new Date()-e)/1000;var k={duration:j,frames:g,fps:g/j};k.toString=function(){return("duration: "+k.duration+", frames: "+k.frames+", fps: "+k.fps);};d=false;g=0;this.onComplete.fire(k);};this._onStart=new b.CustomEvent("_start",this,true);this.onStart=new b.CustomEvent("start",this);this.onTween=new b.CustomEvent("tween",this);this.afterTween=new b.CustomEvent("afterTween",this);this._onTween=new b.CustomEvent("_tween",this,true);this.onComplete=new b.CustomEvent("complete",this);this._onComplete=new b.CustomEvent("_complete",this,true);this._onStart.subscribe(this._handleStart);this._onTween.subscribe(this._handleTween);this._onComplete.subscribe(this._handleComplete);}};b.Anim=a;})();YAHOO.util.AnimMgr=new function(){var e=null;var c=[];var g=0;this.fps=1000;this.delay=20;this.registerElement=function(j){c[c.length]=j;g+=1;j._onStart.fire();this.start();};var f=[];var d=false;var h=function(){var j=f.shift();b.apply(YAHOO.util.AnimMgr,j);if(f.length){arguments.callee();}};var b=function(k,j){j=j||a(k);if(!k.isAnimated()||j===-1){return false;}k._onComplete.fire();c.splice(j,1);g-=1;if(g<=0){this.stop();}return true;};this.unRegister=function(){f.push(arguments);if(!d){d=true;h();d=false;}};this.start=function(){if(e===null){e=setInterval(this.run,this.delay);}};this.stop=function(l){if(!l){clearInterval(e);for(var k=0,j=c.length;k<j;++k){this.unRegister(c[0],0);}c=[];e=null;g=0;}else{this.unRegister(l);}};this.run=function(){for(var l=0,j=c.length;l<j;++l){var k=c[l];if(!k||!k.isAnimated()){continue;}if(k.currentFrame<k.totalFrames||k.totalFrames===null){k.currentFrame+=1;if(k.useSeconds){i(k);}k._onTween.fire();}else{YAHOO.util.AnimMgr.stop(k,l);}}};var a=function(l){for(var k=0,j=c.length;k<j;++k){if(c[k]===l){return k;}}return -1;};var i=function(k){var n=k.totalFrames;var m=k.currentFrame;var l=(k.currentFrame*k.duration*1000/k.totalFrames);var j=(new Date()-k.getStartTime());var o=0;if(j<k.duration*1000){o=Math.round((j/l-1)*k.currentFrame);}else{o=n-(m+1);}if(o>0&&isFinite(o)){if(k.currentFrame+o>=n){o=n-(m+1);}k.currentFrame+=o;}};this._queue=c;this._getIndex=a;};YAHOO.util.Bezier=new function(){this.getPosition=function(e,d){var f=e.length;var c=[];for(var b=0;b<f;++b){c[b]=[e[b][0],e[b][1]];}for(var a=1;a<f;++a){for(b=0;b<f-a;++b){c[b][0]=(1-d)*c[b][0]+d*c[parseInt(b+1,10)][0];c[b][1]=(1-d)*c[b][1]+d*c[parseInt(b+1,10)][1];}}return[c[0][0],c[0][1]];};};(function(){var a=function(f,e,g,h){a.superclass.constructor.call(this,f,e,g,h);};a.NAME="ColorAnim";a.DEFAULT_BGCOLOR="#fff";var c=YAHOO.util;YAHOO.extend(a,c.Anim);var d=a.superclass;var b=a.prototype;b.patterns.color=/color$/i;b.patterns.rgb=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i;b.patterns.hex=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i;b.patterns.hex3=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i;
b.patterns.transparent=/^transparent|rgba\(0, 0, 0, 0\)$/;b.parseColor=function(e){if(e.length==3){return e;}var f=this.patterns.hex.exec(e);if(f&&f.length==4){return[parseInt(f[1],16),parseInt(f[2],16),parseInt(f[3],16)];}f=this.patterns.rgb.exec(e);if(f&&f.length==4){return[parseInt(f[1],10),parseInt(f[2],10),parseInt(f[3],10)];}f=this.patterns.hex3.exec(e);if(f&&f.length==4){return[parseInt(f[1]+f[1],16),parseInt(f[2]+f[2],16),parseInt(f[3]+f[3],16)];}return null;};b.getAttribute=function(e){var g=this.getEl();if(this.patterns.color.test(e)){var i=YAHOO.util.Dom.getStyle(g,e);var h=this;if(this.patterns.transparent.test(i)){var f=YAHOO.util.Dom.getAncestorBy(g,function(j){return !h.patterns.transparent.test(i);});if(f){i=c.Dom.getStyle(f,e);}else{i=a.DEFAULT_BGCOLOR;}}}else{i=d.getAttribute.call(this,e);}return i;};b.doMethod=function(f,k,g){var j;if(this.patterns.color.test(f)){j=[];for(var h=0,e=k.length;h<e;++h){j[h]=d.doMethod.call(this,f,k[h],g[h]);}j="rgb("+Math.floor(j[0])+","+Math.floor(j[1])+","+Math.floor(j[2])+")";}else{j=d.doMethod.call(this,f,k,g);}return j;};b.setRuntimeAttribute=function(f){d.setRuntimeAttribute.call(this,f);if(this.patterns.color.test(f)){var h=this.attributes;var k=this.parseColor(this.runtimeAttributes[f].start);var g=this.parseColor(this.runtimeAttributes[f].end);if(typeof h[f]["to"]==="undefined"&&typeof h[f]["by"]!=="undefined"){g=this.parseColor(h[f].by);for(var j=0,e=k.length;j<e;++j){g[j]=k[j]+g[j];}}this.runtimeAttributes[f].start=k;this.runtimeAttributes[f].end=g;}};c.ColorAnim=a;})();
/*!
TERMS OF USE - EASING EQUATIONS
Open source under the BSD License.
Copyright 2001 Robert Penner All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * Neither the name of the author nor the names of contributors may be used to endorse or promote products derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
YAHOO.util.Easing={easeNone:function(e,a,g,f){return g*e/f+a;},easeIn:function(e,a,g,f){return g*(e/=f)*e+a;},easeOut:function(e,a,g,f){return -g*(e/=f)*(e-2)+a;},easeBoth:function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e+a;}return -g/2*((--e)*(e-2)-1)+a;},easeInStrong:function(e,a,g,f){return g*(e/=f)*e*e*e+a;},easeOutStrong:function(e,a,g,f){return -g*((e=e/f-1)*e*e*e-1)+a;},easeBothStrong:function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e*e*e+a;}return -g/2*((e-=2)*e*e*e-2)+a;},elasticIn:function(g,e,k,j,f,i){if(g==0){return e;}if((g/=j)==1){return e+k;}if(!i){i=j*0.3;}if(!f||f<Math.abs(k)){f=k;var h=i/4;}else{var h=i/(2*Math.PI)*Math.asin(k/f);}return -(f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i))+e;},elasticOut:function(g,e,k,j,f,i){if(g==0){return e;}if((g/=j)==1){return e+k;}if(!i){i=j*0.3;}if(!f||f<Math.abs(k)){f=k;var h=i/4;}else{var h=i/(2*Math.PI)*Math.asin(k/f);}return f*Math.pow(2,-10*g)*Math.sin((g*j-h)*(2*Math.PI)/i)+k+e;},elasticBoth:function(g,e,k,j,f,i){if(g==0){return e;}if((g/=j/2)==2){return e+k;}if(!i){i=j*(0.3*1.5);}if(!f||f<Math.abs(k)){f=k;var h=i/4;}else{var h=i/(2*Math.PI)*Math.asin(k/f);}if(g<1){return -0.5*(f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i))+e;}return f*Math.pow(2,-10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i)*0.5+k+e;},backIn:function(e,a,h,g,f){if(typeof f=="undefined"){f=1.70158;}return h*(e/=g)*e*((f+1)*e-f)+a;},backOut:function(e,a,h,g,f){if(typeof f=="undefined"){f=1.70158;}return h*((e=e/g-1)*e*((f+1)*e+f)+1)+a;},backBoth:function(e,a,h,g,f){if(typeof f=="undefined"){f=1.70158;}if((e/=g/2)<1){return h/2*(e*e*(((f*=(1.525))+1)*e-f))+a;}return h/2*((e-=2)*e*(((f*=(1.525))+1)*e+f)+2)+a;},bounceIn:function(e,a,g,f){return g-YAHOO.util.Easing.bounceOut(f-e,0,g,f)+a;},bounceOut:function(e,a,g,f){if((e/=f)<(1/2.75)){return g*(7.5625*e*e)+a;}else{if(e<(2/2.75)){return g*(7.5625*(e-=(1.5/2.75))*e+0.75)+a;}else{if(e<(2.5/2.75)){return g*(7.5625*(e-=(2.25/2.75))*e+0.9375)+a;}}}return g*(7.5625*(e-=(2.625/2.75))*e+0.984375)+a;},bounceBoth:function(e,a,g,f){if(e<f/2){return YAHOO.util.Easing.bounceIn(e*2,0,g,f)*0.5+a;}return YAHOO.util.Easing.bounceOut(e*2-f,0,g,f)*0.5+g*0.5+a;}};(function(){var a=function(h,g,i,j){if(h){a.superclass.constructor.call(this,h,g,i,j);}};a.NAME="Motion";var e=YAHOO.util;YAHOO.extend(a,e.ColorAnim);var f=a.superclass;var c=a.prototype;c.patterns.points=/^points$/i;c.setAttribute=function(g,i,h){if(this.patterns.points.test(g)){h=h||"px";f.setAttribute.call(this,"left",i[0],h);f.setAttribute.call(this,"top",i[1],h);}else{f.setAttribute.call(this,g,i,h);}};c.getAttribute=function(g){if(this.patterns.points.test(g)){var h=[f.getAttribute.call(this,"left"),f.getAttribute.call(this,"top")];}else{h=f.getAttribute.call(this,g);}return h;};c.doMethod=function(g,k,h){var j=null;if(this.patterns.points.test(g)){var i=this.method(this.currentFrame,0,100,this.totalFrames)/100;j=e.Bezier.getPosition(this.runtimeAttributes[g],i);
}else{j=f.doMethod.call(this,g,k,h);}return j;};c.setRuntimeAttribute=function(q){if(this.patterns.points.test(q)){var h=this.getEl();var k=this.attributes;var g;var m=k["points"]["control"]||[];var j;var n,p;if(m.length>0&&!(m[0] instanceof Array)){m=[m];}else{var l=[];for(n=0,p=m.length;n<p;++n){l[n]=m[n];}m=l;}if(e.Dom.getStyle(h,"position")=="static"){e.Dom.setStyle(h,"position","relative");}if(d(k["points"]["from"])){e.Dom.setXY(h,k["points"]["from"]);}else{e.Dom.setXY(h,e.Dom.getXY(h));}g=this.getAttribute("points");if(d(k["points"]["to"])){j=b.call(this,k["points"]["to"],g);var o=e.Dom.getXY(this.getEl());for(n=0,p=m.length;n<p;++n){m[n]=b.call(this,m[n],g);}}else{if(d(k["points"]["by"])){j=[g[0]+k["points"]["by"][0],g[1]+k["points"]["by"][1]];for(n=0,p=m.length;n<p;++n){m[n]=[g[0]+m[n][0],g[1]+m[n][1]];}}}this.runtimeAttributes[q]=[g];if(m.length>0){this.runtimeAttributes[q]=this.runtimeAttributes[q].concat(m);}this.runtimeAttributes[q][this.runtimeAttributes[q].length]=j;}else{f.setRuntimeAttribute.call(this,q);}};var b=function(g,i){var h=e.Dom.getXY(this.getEl());g=[g[0]-h[0]+i[0],g[1]-h[1]+i[1]];return g;};var d=function(g){return(typeof g!=="undefined");};e.Motion=a;})();(function(){var d=function(f,e,g,h){if(f){d.superclass.constructor.call(this,f,e,g,h);}};d.NAME="Scroll";var b=YAHOO.util;YAHOO.extend(d,b.ColorAnim);var c=d.superclass;var a=d.prototype;a.doMethod=function(e,h,f){var g=null;if(e=="scroll"){g=[this.method(this.currentFrame,h[0],f[0]-h[0],this.totalFrames),this.method(this.currentFrame,h[1],f[1]-h[1],this.totalFrames)];}else{g=c.doMethod.call(this,e,h,f);}return g;};a.getAttribute=function(e){var g=null;var f=this.getEl();if(e=="scroll"){g=[f.scrollLeft,f.scrollTop];}else{g=c.getAttribute.call(this,e);}return g;};a.setAttribute=function(e,h,g){var f=this.getEl();if(e=="scroll"){f.scrollLeft=h[0];f.scrollTop=h[1];}else{c.setAttribute.call(this,e,h,g);}};b.Scroll=d;})();YAHOO.register("animation",YAHOO.util.Anim,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: dragdrop-min.js (1d0909e9) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
if(!YAHOO.util.DragDropMgr){YAHOO.util.DragDropMgr=function(){var A=YAHOO.util.Event,B=YAHOO.util.Dom;return{useShim:false,_shimActive:false,_shimState:false,_debugShim:false,_createShim:function(){var C=document.createElement("div");C.id="yui-ddm-shim";if(document.body.firstChild){document.body.insertBefore(C,document.body.firstChild);}else{document.body.appendChild(C);}C.style.display="none";C.style.backgroundColor="red";C.style.position="absolute";C.style.zIndex="99999";B.setStyle(C,"opacity","0");this._shim=C;A.on(C,"mouseup",this.handleMouseUp,this,true);A.on(C,"mousemove",this.handleMouseMove,this,true);A.on(window,"scroll",this._sizeShim,this,true);},_sizeShim:function(){if(this._shimActive){var C=this._shim;C.style.height=B.getDocumentHeight()+"px";C.style.width=B.getDocumentWidth()+"px";C.style.top="0";C.style.left="0";}},_activateShim:function(){if(this.useShim){if(!this._shim){this._createShim();}this._shimActive=true;var C=this._shim,D="0";if(this._debugShim){D=".5";}B.setStyle(C,"opacity",D);this._sizeShim();C.style.display="block";}},_deactivateShim:function(){this._shim.style.display="none";this._shimActive=false;},_shim:null,ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:true,stopPropagation:true,initialized:false,locked:false,interactionInfo:null,init:function(){this.initialized=true;},POINT:0,INTERSECT:1,STRICT_INTERSECT:2,mode:0,_execOnAll:function(E,D){for(var F in this.ids){for(var C in this.ids[F]){var G=this.ids[F][C];if(!this.isTypeOfDD(G)){continue;}G[E].apply(G,D);}}},_onLoad:function(){this.init();A.on(document,"mouseup",this.handleMouseUp,this,true);A.on(document,"mousemove",this.handleMouseMove,this,true);A.on(window,"unload",this._onUnload,this,true);A.on(window,"resize",this._onResize,this,true);},_onResize:function(C){this._execOnAll("resetConstraints",[]);},lock:function(){this.locked=true;},unlock:function(){this.locked=false;},isLocked:function(){return this.locked;},locationCache:{},useCache:true,clickPixelThresh:3,clickTimeThresh:1000,dragThreshMet:false,clickTimeout:null,startX:0,startY:0,fromTimeout:false,regDragDrop:function(D,C){if(!this.initialized){this.init();}if(!this.ids[C]){this.ids[C]={};}this.ids[C][D.id]=D;},removeDDFromGroup:function(E,C){if(!this.ids[C]){this.ids[C]={};}var D=this.ids[C];if(D&&D[E.id]){delete D[E.id];}},_remove:function(E){for(var D in E.groups){if(D){var C=this.ids[D];if(C&&C[E.id]){delete C[E.id];}}}delete this.handleIds[E.id];},regHandle:function(D,C){if(!this.handleIds[D]){this.handleIds[D]={};}this.handleIds[D][C]=C;},isDragDrop:function(C){return(this.getDDById(C))?true:false;},getRelated:function(H,D){var G=[];for(var F in H.groups){for(var E in this.ids[F]){var C=this.ids[F][E];if(!this.isTypeOfDD(C)){continue;}if(!D||C.isTarget){G[G.length]=C;}}}return G;},isLegalTarget:function(G,F){var D=this.getRelated(G,true);for(var E=0,C=D.length;E<C;++E){if(D[E].id==F.id){return true;}}return false;},isTypeOfDD:function(C){return(C&&C.__ygDragDrop);},isHandle:function(D,C){return(this.handleIds[D]&&this.handleIds[D][C]);},getDDById:function(D){for(var C in this.ids){if(this.ids[C][D]){return this.ids[C][D];}}return null;},handleMouseDown:function(E,D){this.currentTarget=YAHOO.util.Event.getTarget(E);this.dragCurrent=D;var C=D.getEl();this.startX=YAHOO.util.Event.getPageX(E);this.startY=YAHOO.util.Event.getPageY(E);this.deltaX=this.startX-C.offsetLeft;this.deltaY=this.startY-C.offsetTop;this.dragThreshMet=false;this.clickTimeout=setTimeout(function(){var F=YAHOO.util.DDM;F.startDrag(F.startX,F.startY);F.fromTimeout=true;},this.clickTimeThresh);},startDrag:function(C,E){if(this.dragCurrent&&this.dragCurrent.useShim){this._shimState=this.useShim;this.useShim=true;}this._activateShim();clearTimeout(this.clickTimeout);var D=this.dragCurrent;if(D&&D.events.b4StartDrag){D.b4StartDrag(C,E);D.fireEvent("b4StartDragEvent",{x:C,y:E});}if(D&&D.events.startDrag){D.startDrag(C,E);D.fireEvent("startDragEvent",{x:C,y:E});}this.dragThreshMet=true;},handleMouseUp:function(C){if(this.dragCurrent){clearTimeout(this.clickTimeout);if(this.dragThreshMet){if(this.fromTimeout){this.fromTimeout=false;this.handleMouseMove(C);}this.fromTimeout=false;this.fireEvents(C,true);}else{}this.stopDrag(C);this.stopEvent(C);}},stopEvent:function(C){if(this.stopPropagation){YAHOO.util.Event.stopPropagation(C);}if(this.preventDefault){YAHOO.util.Event.preventDefault(C);}},stopDrag:function(E,D){var C=this.dragCurrent;if(C&&!D){if(this.dragThreshMet){if(C.events.b4EndDrag){C.b4EndDrag(E);C.fireEvent("b4EndDragEvent",{e:E});}if(C.events.endDrag){C.endDrag(E);C.fireEvent("endDragEvent",{e:E});}}if(C.events.mouseUp){C.onMouseUp(E);C.fireEvent("mouseUpEvent",{e:E});}}if(this._shimActive){this._deactivateShim();if(this.dragCurrent&&this.dragCurrent.useShim){this.useShim=this._shimState;this._shimState=false;}}this.dragCurrent=null;this.dragOvers={};},handleMouseMove:function(F){var C=this.dragCurrent;if(C){if(YAHOO.env.ua.ie&&(YAHOO.env.ua.ie<9)&&!F.button){this.stopEvent(F);return this.handleMouseUp(F);}else{if(F.clientX<0||F.clientY<0){}}if(!this.dragThreshMet){var E=Math.abs(this.startX-YAHOO.util.Event.getPageX(F));var D=Math.abs(this.startY-YAHOO.util.Event.getPageY(F));if(E>this.clickPixelThresh||D>this.clickPixelThresh){this.startDrag(this.startX,this.startY);}}if(this.dragThreshMet){if(C&&C.events.b4Drag){C.b4Drag(F);C.fireEvent("b4DragEvent",{e:F});}if(C&&C.events.drag){C.onDrag(F);C.fireEvent("dragEvent",{e:F});}if(C){this.fireEvents(F,false);}}this.stopEvent(F);}},fireEvents:function(W,M){var c=this.dragCurrent;if(!c||c.isLocked()||c.dragOnly){return;}var O=YAHOO.util.Event.getPageX(W),N=YAHOO.util.Event.getPageY(W),Q=new YAHOO.util.Point(O,N),K=c.getTargetCoord(Q.x,Q.y),F=c.getDragEl(),E=["out","over","drop","enter"],V=new YAHOO.util.Region(K.y,K.x+F.offsetWidth,K.y+F.offsetHeight,K.x),I=[],D={},L={},R=[],d={outEvts:[],overEvts:[],dropEvts:[],enterEvts:[]};for(var T in this.dragOvers){var f=this.dragOvers[T];if(!this.isTypeOfDD(f)){continue;
}if(!this.isOverTarget(Q,f,this.mode,V)){d.outEvts.push(f);}I[T]=true;delete this.dragOvers[T];}for(var S in c.groups){if("string"!=typeof S){continue;}for(T in this.ids[S]){var G=this.ids[S][T];if(!this.isTypeOfDD(G)){continue;}if(G.isTarget&&!G.isLocked()&&G!=c){if(this.isOverTarget(Q,G,this.mode,V)){D[S]=true;if(M){d.dropEvts.push(G);}else{if(!I[G.id]){d.enterEvts.push(G);}else{d.overEvts.push(G);}this.dragOvers[G.id]=G;}}}}}this.interactionInfo={out:d.outEvts,enter:d.enterEvts,over:d.overEvts,drop:d.dropEvts,point:Q,draggedRegion:V,sourceRegion:this.locationCache[c.id],validDrop:M};for(var C in D){R.push(C);}if(M&&!d.dropEvts.length){this.interactionInfo.validDrop=false;if(c.events.invalidDrop){c.onInvalidDrop(W);c.fireEvent("invalidDropEvent",{e:W});}}for(T=0;T<E.length;T++){var Z=null;if(d[E[T]+"Evts"]){Z=d[E[T]+"Evts"];}if(Z&&Z.length){var H=E[T].charAt(0).toUpperCase()+E[T].substr(1),Y="onDrag"+H,J="b4Drag"+H,P="drag"+H+"Event",X="drag"+H;if(this.mode){if(c.events[J]){c[J](W,Z,R);L[Y]=c.fireEvent(J+"Event",{event:W,info:Z,group:R});}if(c.events[X]&&(L[Y]!==false)){c[Y](W,Z,R);c.fireEvent(P,{event:W,info:Z,group:R});}}else{for(var a=0,U=Z.length;a<U;++a){if(c.events[J]){c[J](W,Z[a].id,R[0]);L[Y]=c.fireEvent(J+"Event",{event:W,info:Z[a].id,group:R[0]});}if(c.events[X]&&(L[Y]!==false)){c[Y](W,Z[a].id,R[0]);c.fireEvent(P,{event:W,info:Z[a].id,group:R[0]});}}}}}},getBestMatch:function(E){var G=null;var D=E.length;if(D==1){G=E[0];}else{for(var F=0;F<D;++F){var C=E[F];if(this.mode==this.INTERSECT&&C.cursorIsOver){G=C;break;}else{if(!G||!G.overlap||(C.overlap&&G.overlap.getArea()<C.overlap.getArea())){G=C;}}}}return G;},refreshCache:function(D){var F=D||this.ids;for(var C in F){if("string"!=typeof C){continue;}for(var E in this.ids[C]){var G=this.ids[C][E];if(this.isTypeOfDD(G)){var H=this.getLocation(G);if(H){this.locationCache[G.id]=H;}else{delete this.locationCache[G.id];}}}}},verifyEl:function(D){try{if(D){var C=D.offsetParent;if(C){return true;}}}catch(E){}return false;},getLocation:function(H){if(!this.isTypeOfDD(H)){return null;}var F=H.getEl(),K,E,D,M,L,N,C,J,G;try{K=YAHOO.util.Dom.getXY(F);}catch(I){}if(!K){return null;}E=K[0];D=E+F.offsetWidth;M=K[1];L=M+F.offsetHeight;N=M-H.padding[0];C=D+H.padding[1];J=L+H.padding[2];G=E-H.padding[3];return new YAHOO.util.Region(N,C,J,G);},isOverTarget:function(K,C,E,F){var G=this.locationCache[C.id];if(!G||!this.useCache){G=this.getLocation(C);this.locationCache[C.id]=G;}if(!G){return false;}C.cursorIsOver=G.contains(K);var J=this.dragCurrent;if(!J||(!E&&!J.constrainX&&!J.constrainY)){return C.cursorIsOver;}C.overlap=null;if(!F){var H=J.getTargetCoord(K.x,K.y);var D=J.getDragEl();F=new YAHOO.util.Region(H.y,H.x+D.offsetWidth,H.y+D.offsetHeight,H.x);}var I=F.intersect(G);if(I){C.overlap=I;return(E)?true:C.cursorIsOver;}else{return false;}},_onUnload:function(D,C){this.unregAll();},unregAll:function(){if(this.dragCurrent){this.stopDrag();this.dragCurrent=null;}this._execOnAll("unreg",[]);this.ids={};},elementCache:{},getElWrapper:function(D){var C=this.elementCache[D];if(!C||!C.el){C=this.elementCache[D]=new this.ElementWrapper(YAHOO.util.Dom.get(D));}return C;},getElement:function(C){return YAHOO.util.Dom.get(C);},getCss:function(D){var C=YAHOO.util.Dom.get(D);return(C)?C.style:null;},ElementWrapper:function(C){this.el=C||null;this.id=this.el&&C.id;this.css=this.el&&C.style;},getPosX:function(C){return YAHOO.util.Dom.getX(C);},getPosY:function(C){return YAHOO.util.Dom.getY(C);},swapNode:function(E,C){if(E.swapNode){E.swapNode(C);}else{var F=C.parentNode;var D=C.nextSibling;if(D==E){F.insertBefore(E,C);}else{if(C==E.nextSibling){F.insertBefore(C,E);}else{E.parentNode.replaceChild(C,E);F.insertBefore(E,D);}}}},getScroll:function(){var E,C,F=document.documentElement,D=document.body;if(F&&(F.scrollTop||F.scrollLeft)){E=F.scrollTop;C=F.scrollLeft;}else{if(D){E=D.scrollTop;C=D.scrollLeft;}else{}}return{top:E,left:C};},getStyle:function(D,C){return YAHOO.util.Dom.getStyle(D,C);},getScrollTop:function(){return this.getScroll().top;},getScrollLeft:function(){return this.getScroll().left;},moveToEl:function(C,E){var D=YAHOO.util.Dom.getXY(E);YAHOO.util.Dom.setXY(C,D);},getClientHeight:function(){return YAHOO.util.Dom.getViewportHeight();},getClientWidth:function(){return YAHOO.util.Dom.getViewportWidth();},numericSort:function(D,C){return(D-C);},_timeoutCount:0,_addListeners:function(){var C=YAHOO.util.DDM;if(YAHOO.util.Event&&document){C._onLoad();}else{if(C._timeoutCount>2000){}else{setTimeout(C._addListeners,10);if(document&&document.body){C._timeoutCount+=1;}}}},handleWasClicked:function(C,E){if(this.isHandle(E,C.id)){return true;}else{var D=C.parentNode;while(D){if(this.isHandle(E,D.id)){return true;}else{D=D.parentNode;}}}return false;}};}();YAHOO.util.DDM=YAHOO.util.DragDropMgr;YAHOO.util.DDM._addListeners();}(function(){var A=YAHOO.util.Event;var B=YAHOO.util.Dom;YAHOO.util.DragDrop=function(E,C,D){if(E){this.init(E,C,D);}};YAHOO.util.DragDrop.prototype={events:null,on:function(){this.subscribe.apply(this,arguments);},id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:false,lock:function(){this.locked=true;},unlock:function(){this.locked=false;},isTarget:true,padding:null,dragOnly:false,useShim:false,_domRef:null,__ygDragDrop:true,constrainX:false,constrainY:false,minX:0,maxX:0,minY:0,maxY:0,deltaX:0,deltaY:0,maintainOffset:false,xTicks:null,yTicks:null,primaryButtonOnly:true,available:false,hasOuterHandles:false,cursorIsOver:false,overlap:null,b4StartDrag:function(C,D){},startDrag:function(C,D){},b4Drag:function(C){},onDrag:function(C){},onDragEnter:function(C,D){},b4DragOver:function(C){},onDragOver:function(C,D){},b4DragOut:function(C){},onDragOut:function(C,D){},b4DragDrop:function(C){},onDragDrop:function(C,D){},onInvalidDrop:function(C){},b4EndDrag:function(C){},endDrag:function(C){},b4MouseDown:function(C){},onMouseDown:function(C){},onMouseUp:function(C){},onAvailable:function(){},getEl:function(){if(!this._domRef){this._domRef=B.get(this.id);
}return this._domRef;},getDragEl:function(){return B.get(this.dragElId);},init:function(F,C,D){this.initTarget(F,C,D);A.on(this._domRef||this.id,"mousedown",this.handleMouseDown,this,true);for(var E in this.events){this.createEvent(E+"Event");}},initTarget:function(E,C,D){this.config=D||{};this.events={};this.DDM=YAHOO.util.DDM;this.groups={};if(typeof E!=="string"){this._domRef=E;E=B.generateId(E);}this.id=E;this.addToGroup((C)?C:"default");this.handleElId=E;A.onAvailable(E,this.handleOnAvailable,this,true);this.setDragElId(E);this.invalidHandleTypes={A:"A"};this.invalidHandleIds={};this.invalidHandleClasses=[];this.applyConfig();},applyConfig:function(){this.events={mouseDown:true,b4MouseDown:true,mouseUp:true,b4StartDrag:true,startDrag:true,b4EndDrag:true,endDrag:true,drag:true,b4Drag:true,invalidDrop:true,b4DragOut:true,dragOut:true,dragEnter:true,b4DragOver:true,dragOver:true,b4DragDrop:true,dragDrop:true};if(this.config.events){for(var C in this.config.events){if(this.config.events[C]===false){this.events[C]=false;}}}this.padding=this.config.padding||[0,0,0,0];this.isTarget=(this.config.isTarget!==false);this.maintainOffset=(this.config.maintainOffset);this.primaryButtonOnly=(this.config.primaryButtonOnly!==false);this.dragOnly=((this.config.dragOnly===true)?true:false);this.useShim=((this.config.useShim===true)?true:false);},handleOnAvailable:function(){this.available=true;this.resetConstraints();this.onAvailable();},setPadding:function(E,C,F,D){if(!C&&0!==C){this.padding=[E,E,E,E];}else{if(!F&&0!==F){this.padding=[E,C,E,C];}else{this.padding=[E,C,F,D];}}},setInitPosition:function(F,E){var G=this.getEl();if(!this.DDM.verifyEl(G)){if(G&&G.style&&(G.style.display=="none")){}else{}return;}var D=F||0;var C=E||0;var H=B.getXY(G);this.initPageX=H[0]-D;this.initPageY=H[1]-C;this.lastPageX=H[0];this.lastPageY=H[1];this.setStartPosition(H);},setStartPosition:function(D){var C=D||B.getXY(this.getEl());this.deltaSetXY=null;this.startPageX=C[0];this.startPageY=C[1];},addToGroup:function(C){this.groups[C]=true;this.DDM.regDragDrop(this,C);},removeFromGroup:function(C){if(this.groups[C]){delete this.groups[C];}this.DDM.removeDDFromGroup(this,C);},setDragElId:function(C){this.dragElId=C;},setHandleElId:function(C){if(typeof C!=="string"){C=B.generateId(C);}this.handleElId=C;this.DDM.regHandle(this.id,C);},setOuterHandleElId:function(C){if(typeof C!=="string"){C=B.generateId(C);}A.on(C,"mousedown",this.handleMouseDown,this,true);this.setHandleElId(C);this.hasOuterHandles=true;},unreg:function(){A.removeListener(this.id,"mousedown",this.handleMouseDown);this._domRef=null;this.DDM._remove(this);},isLocked:function(){return(this.DDM.isLocked()||this.locked);},handleMouseDown:function(J,I){var D=J.which||J.button;if(this.primaryButtonOnly&&D>1){return;}if(this.isLocked()){return;}var C=this.b4MouseDown(J),F=true;if(this.events.b4MouseDown){F=this.fireEvent("b4MouseDownEvent",J);}var E=this.onMouseDown(J),H=true;if(this.events.mouseDown){if(E===false){H=false;}else{H=this.fireEvent("mouseDownEvent",J);}}if((C===false)||(E===false)||(F===false)||(H===false)){return;}this.DDM.refreshCache(this.groups);var G=new YAHOO.util.Point(A.getPageX(J),A.getPageY(J));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(G,this)){}else{if(this.clickValidator(J)){this.setStartPosition();this.DDM.handleMouseDown(J,this);this.DDM.stopEvent(J);}else{}}},clickValidator:function(D){var C=YAHOO.util.Event.getTarget(D);return(this.isValidHandleChild(C)&&(this.id==this.handleElId||this.DDM.handleWasClicked(C,this.id)));},getTargetCoord:function(E,D){var C=E-this.deltaX;var F=D-this.deltaY;if(this.constrainX){if(C<this.minX){C=this.minX;}if(C>this.maxX){C=this.maxX;}}if(this.constrainY){if(F<this.minY){F=this.minY;}if(F>this.maxY){F=this.maxY;}}C=this.getTick(C,this.xTicks);F=this.getTick(F,this.yTicks);return{x:C,y:F};},addInvalidHandleType:function(C){var D=C.toUpperCase();this.invalidHandleTypes[D]=D;},addInvalidHandleId:function(C){if(typeof C!=="string"){C=B.generateId(C);}this.invalidHandleIds[C]=C;},addInvalidHandleClass:function(C){this.invalidHandleClasses.push(C);},removeInvalidHandleType:function(C){var D=C.toUpperCase();delete this.invalidHandleTypes[D];},removeInvalidHandleId:function(C){if(typeof C!=="string"){C=B.generateId(C);}delete this.invalidHandleIds[C];},removeInvalidHandleClass:function(D){for(var E=0,C=this.invalidHandleClasses.length;E<C;++E){if(this.invalidHandleClasses[E]==D){delete this.invalidHandleClasses[E];}}},isValidHandleChild:function(F){var E=true;var H;try{H=F.nodeName.toUpperCase();}catch(G){H=F.nodeName;}E=E&&!this.invalidHandleTypes[H];E=E&&!this.invalidHandleIds[F.id];for(var D=0,C=this.invalidHandleClasses.length;E&&D<C;++D){E=!B.hasClass(F,this.invalidHandleClasses[D]);}return E;},setXTicks:function(F,C){this.xTicks=[];this.xTickSize=C;var E={};for(var D=this.initPageX;D>=this.minX;D=D-C){if(!E[D]){this.xTicks[this.xTicks.length]=D;E[D]=true;}}for(D=this.initPageX;D<=this.maxX;D=D+C){if(!E[D]){this.xTicks[this.xTicks.length]=D;E[D]=true;}}this.xTicks.sort(this.DDM.numericSort);},setYTicks:function(F,C){this.yTicks=[];this.yTickSize=C;var E={};for(var D=this.initPageY;D>=this.minY;D=D-C){if(!E[D]){this.yTicks[this.yTicks.length]=D;E[D]=true;}}for(D=this.initPageY;D<=this.maxY;D=D+C){if(!E[D]){this.yTicks[this.yTicks.length]=D;E[D]=true;}}this.yTicks.sort(this.DDM.numericSort);},setXConstraint:function(E,D,C){this.leftConstraint=parseInt(E,10);this.rightConstraint=parseInt(D,10);this.minX=this.initPageX-this.leftConstraint;this.maxX=this.initPageX+this.rightConstraint;if(C){this.setXTicks(this.initPageX,C);}this.constrainX=true;},clearConstraints:function(){this.constrainX=false;this.constrainY=false;this.clearTicks();},clearTicks:function(){this.xTicks=null;this.yTicks=null;this.xTickSize=0;this.yTickSize=0;},setYConstraint:function(C,E,D){this.topConstraint=parseInt(C,10);this.bottomConstraint=parseInt(E,10);this.minY=this.initPageY-this.topConstraint;this.maxY=this.initPageY+this.bottomConstraint;
if(D){this.setYTicks(this.initPageY,D);}this.constrainY=true;},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var D=(this.maintainOffset)?this.lastPageX-this.initPageX:0;var C=(this.maintainOffset)?this.lastPageY-this.initPageY:0;this.setInitPosition(D,C);}else{this.setInitPosition();}if(this.constrainX){this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize);}if(this.constrainY){this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize);}},getTick:function(I,F){if(!F){return I;}else{if(F[0]>=I){return F[0];}else{for(var D=0,C=F.length;D<C;++D){var E=D+1;if(F[E]&&F[E]>=I){var H=I-F[D];var G=F[E]-I;return(G>H)?F[D]:F[E];}}return F[F.length-1];}}},toString:function(){return("DragDrop "+this.id);}};YAHOO.augment(YAHOO.util.DragDrop,YAHOO.util.EventProvider);})();YAHOO.util.DD=function(C,A,B){if(C){this.init(C,A,B);}};YAHOO.extend(YAHOO.util.DD,YAHOO.util.DragDrop,{scroll:true,autoOffset:function(C,B){var A=C-this.startPageX;var D=B-this.startPageY;this.setDelta(A,D);},setDelta:function(B,A){this.deltaX=B;this.deltaY=A;},setDragElPos:function(C,B){var A=this.getDragEl();this.alignElWithMouse(A,C,B);},alignElWithMouse:function(C,G,F){var E=this.getTargetCoord(G,F);if(!this.deltaSetXY){var H=[E.x,E.y];YAHOO.util.Dom.setXY(C,H);var D=parseInt(YAHOO.util.Dom.getStyle(C,"left"),10);var B=parseInt(YAHOO.util.Dom.getStyle(C,"top"),10);this.deltaSetXY=[D-E.x,B-E.y];}else{YAHOO.util.Dom.setStyle(C,"left",(E.x+this.deltaSetXY[0])+"px");YAHOO.util.Dom.setStyle(C,"top",(E.y+this.deltaSetXY[1])+"px");}this.cachePosition(E.x,E.y);var A=this;setTimeout(function(){A.autoScroll.call(A,E.x,E.y,C.offsetHeight,C.offsetWidth);},0);},cachePosition:function(B,A){if(B){this.lastPageX=B;this.lastPageY=A;}else{var C=YAHOO.util.Dom.getXY(this.getEl());this.lastPageX=C[0];this.lastPageY=C[1];}},autoScroll:function(J,I,E,K){if(this.scroll){var L=this.DDM.getClientHeight();var B=this.DDM.getClientWidth();var N=this.DDM.getScrollTop();var D=this.DDM.getScrollLeft();var H=E+I;var M=K+J;var G=(L+N-I-this.deltaY);var F=(B+D-J-this.deltaX);var C=40;var A=(document.all)?80:30;if(H>L&&G<C){window.scrollTo(D,N+A);}if(I<N&&N>0&&I-N<C){window.scrollTo(D,N-A);}if(M>B&&F<C){window.scrollTo(D+A,N);}if(J<D&&D>0&&J-D<C){window.scrollTo(D-A,N);}}},applyConfig:function(){YAHOO.util.DD.superclass.applyConfig.call(this);this.scroll=(this.config.scroll!==false);},b4MouseDown:function(A){this.setStartPosition();this.autoOffset(YAHOO.util.Event.getPageX(A),YAHOO.util.Event.getPageY(A));},b4Drag:function(A){this.setDragElPos(YAHOO.util.Event.getPageX(A),YAHOO.util.Event.getPageY(A));},toString:function(){return("DD "+this.id);}});YAHOO.util.DDProxy=function(C,A,B){if(C){this.init(C,A,B);this.initFrame();}};YAHOO.util.DDProxy.dragElId="ygddfdiv";YAHOO.extend(YAHOO.util.DDProxy,YAHOO.util.DD,{resizeFrame:true,centerFrame:false,createFrame:function(){var B=this,A=document.body;if(!A||!A.firstChild){setTimeout(function(){B.createFrame();},50);return;}var F=this.getDragEl(),E=YAHOO.util.Dom;if(!F){F=document.createElement("div");F.id=this.dragElId;var D=F.style;D.position="absolute";D.visibility="hidden";D.cursor="move";D.border="2px solid #aaa";D.zIndex=999;D.height="25px";D.width="25px";var C=document.createElement("div");E.setStyle(C,"height","100%");E.setStyle(C,"width","100%");E.setStyle(C,"background-color","#ccc");E.setStyle(C,"opacity","0");F.appendChild(C);A.insertBefore(F,A.firstChild);}},initFrame:function(){this.createFrame();},applyConfig:function(){YAHOO.util.DDProxy.superclass.applyConfig.call(this);this.resizeFrame=(this.config.resizeFrame!==false);this.centerFrame=(this.config.centerFrame);this.setDragElId(this.config.dragElId||YAHOO.util.DDProxy.dragElId);},showFrame:function(E,D){var C=this.getEl();var A=this.getDragEl();var B=A.style;this._resizeProxy();if(this.centerFrame){this.setDelta(Math.round(parseInt(B.width,10)/2),Math.round(parseInt(B.height,10)/2));}this.setDragElPos(E,D);YAHOO.util.Dom.setStyle(A,"visibility","visible");},_resizeProxy:function(){if(this.resizeFrame){var H=YAHOO.util.Dom;var B=this.getEl();var C=this.getDragEl();var G=parseInt(H.getStyle(C,"borderTopWidth"),10);var I=parseInt(H.getStyle(C,"borderRightWidth"),10);var F=parseInt(H.getStyle(C,"borderBottomWidth"),10);var D=parseInt(H.getStyle(C,"borderLeftWidth"),10);if(isNaN(G)){G=0;}if(isNaN(I)){I=0;}if(isNaN(F)){F=0;}if(isNaN(D)){D=0;}var E=Math.max(0,B.offsetWidth-I-D);var A=Math.max(0,B.offsetHeight-G-F);H.setStyle(C,"width",E+"px");H.setStyle(C,"height",A+"px");}},b4MouseDown:function(B){this.setStartPosition();var A=YAHOO.util.Event.getPageX(B);var C=YAHOO.util.Event.getPageY(B);this.autoOffset(A,C);},b4StartDrag:function(A,B){this.showFrame(A,B);},b4EndDrag:function(A){YAHOO.util.Dom.setStyle(this.getDragEl(),"visibility","hidden");},endDrag:function(D){var C=YAHOO.util.Dom;var B=this.getEl();var A=this.getDragEl();C.setStyle(A,"visibility","");C.setStyle(B,"visibility","hidden");YAHOO.util.DDM.moveToEl(B,A);C.setStyle(A,"visibility","hidden");C.setStyle(B,"visibility","");},toString:function(){return("DDProxy "+this.id);}});YAHOO.util.DDTarget=function(C,A,B){if(C){this.initTarget(C,A,B);}};YAHOO.extend(YAHOO.util.DDTarget,YAHOO.util.DragDrop,{toString:function(){return("DDTarget "+this.id);}});YAHOO.register("dragdrop",YAHOO.util.DragDropMgr,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: container-min.js (c0ceff96) 9/9/2014 2:08:59 PM */

/*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.8.1
*/
(function(){YAHOO.util.Config=function(D){if(D){this.init(D);}};var B=YAHOO.lang,C=YAHOO.util.CustomEvent,A=YAHOO.util.Config;A.CONFIG_CHANGED_EVENT="configChanged";A.BOOLEAN_TYPE="boolean";A.prototype={owner:null,queueInProgress:false,config:null,initialConfig:null,eventQueue:null,configChangedEvent:null,init:function(D){this.owner=D;this.configChangedEvent=this.createEvent(A.CONFIG_CHANGED_EVENT);this.configChangedEvent.signature=C.LIST;this.queueInProgress=false;this.config={};this.initialConfig={};this.eventQueue=[];},checkBoolean:function(D){return(typeof D==A.BOOLEAN_TYPE);},checkNumber:function(D){return(!isNaN(D));},fireEvent:function(D,F){var E=this.config[D];if(E&&E.event){E.event.fire(F);}},addProperty:function(E,D){E=E.toLowerCase();this.config[E]=D;D.event=this.createEvent(E,{scope:this.owner});D.event.signature=C.LIST;D.key=E;if(D.handler){D.event.subscribe(D.handler,this.owner);}this.setProperty(E,D.value,true);if(!D.suppressEvent){this.queueProperty(E,D.value);}},getConfig:function(){var D={},F=this.config,G,E;for(G in F){if(B.hasOwnProperty(F,G)){E=F[G];if(E&&E.event){D[G]=E.value;}}}return D;},getProperty:function(D){var E=this.config[D.toLowerCase()];if(E&&E.event){return E.value;}else{return undefined;}},resetProperty:function(D){D=D.toLowerCase();var E=this.config[D];if(E&&E.event){if(this.initialConfig[D]&&!B.isUndefined(this.initialConfig[D])){this.setProperty(D,this.initialConfig[D]);return true;}}else{return false;}},setProperty:function(E,G,D){var F;E=E.toLowerCase();if(this.queueInProgress&&!D){this.queueProperty(E,G);return true;}else{F=this.config[E];if(F&&F.event){if(F.validator&&!F.validator(G)){return false;}else{F.value=G;if(!D){this.fireEvent(E,G);this.configChangedEvent.fire([E,G]);}return true;}}else{return false;}}},queueProperty:function(S,P){S=S.toLowerCase();var R=this.config[S],K=false,J,G,H,I,O,Q,F,M,N,D,L,T,E;if(R&&R.event){if(!B.isUndefined(P)&&R.validator&&!R.validator(P)){return false;}else{if(!B.isUndefined(P)){R.value=P;}else{P=R.value;}K=false;J=this.eventQueue.length;for(L=0;L<J;L++){G=this.eventQueue[L];if(G){H=G[0];I=G[1];if(H==S){this.eventQueue[L]=null;this.eventQueue.push([S,(!B.isUndefined(P)?P:I)]);K=true;break;}}}if(!K&&!B.isUndefined(P)){this.eventQueue.push([S,P]);}}if(R.supercedes){O=R.supercedes.length;for(T=0;T<O;T++){Q=R.supercedes[T];F=this.eventQueue.length;for(E=0;E<F;E++){M=this.eventQueue[E];if(M){N=M[0];D=M[1];if(N==Q.toLowerCase()){this.eventQueue.push([N,D]);this.eventQueue[E]=null;break;}}}}}return true;}else{return false;}},refireEvent:function(D){D=D.toLowerCase();var E=this.config[D];if(E&&E.event&&!B.isUndefined(E.value)){if(this.queueInProgress){this.queueProperty(D);}else{this.fireEvent(D,E.value);}}},applyConfig:function(D,G){var F,E;if(G){E={};for(F in D){if(B.hasOwnProperty(D,F)){E[F.toLowerCase()]=D[F];}}this.initialConfig=E;}for(F in D){if(B.hasOwnProperty(D,F)){this.queueProperty(F,D[F]);}}},refresh:function(){var D;for(D in this.config){if(B.hasOwnProperty(this.config,D)){this.refireEvent(D);}}},fireQueue:function(){var E,H,D,G,F;this.queueInProgress=true;for(E=0;E<this.eventQueue.length;E++){H=this.eventQueue[E];if(H){D=H[0];G=H[1];F=this.config[D];F.value=G;this.eventQueue[E]=null;this.fireEvent(D,G);}}this.queueInProgress=false;this.eventQueue=[];},subscribeToConfigEvent:function(D,E,G,H){var F=this.config[D.toLowerCase()];if(F&&F.event){if(!A.alreadySubscribed(F.event,E,G)){F.event.subscribe(E,G,H);}return true;}else{return false;}},unsubscribeFromConfigEvent:function(D,E,G){var F=this.config[D.toLowerCase()];if(F&&F.event){return F.event.unsubscribe(E,G);}else{return false;}},toString:function(){var D="Config";if(this.owner){D+=" ["+this.owner.toString()+"]";}return D;},outputEventQueue:function(){var D="",G,E,F=this.eventQueue.length;for(E=0;E<F;E++){G=this.eventQueue[E];if(G){D+=G[0]+"="+G[1]+", ";}}return D;},destroy:function(){var E=this.config,D,F;for(D in E){if(B.hasOwnProperty(E,D)){F=E[D];F.event.unsubscribeAll();F.event=null;}}this.configChangedEvent.unsubscribeAll();this.configChangedEvent=null;this.owner=null;this.config=null;this.initialConfig=null;this.eventQueue=null;}};A.alreadySubscribed=function(E,H,I){var F=E.subscribers.length,D,G;if(F>0){G=F-1;do{D=E.subscribers[G];if(D&&D.obj==I&&D.fn==H){return true;}}while(G--);}return false;};YAHOO.lang.augmentProto(A,YAHOO.util.EventProvider);}());(function(){YAHOO.widget.Module=function(R,Q){if(R){this.init(R,Q);}else{}};var F=YAHOO.util.Dom,D=YAHOO.util.Config,N=YAHOO.util.Event,M=YAHOO.util.CustomEvent,G=YAHOO.widget.Module,I=YAHOO.env.ua,H,P,O,E,A={"BEFORE_INIT":"beforeInit","INIT":"init","APPEND":"append","BEFORE_RENDER":"beforeRender","RENDER":"render","CHANGE_HEADER":"changeHeader","CHANGE_BODY":"changeBody","CHANGE_FOOTER":"changeFooter","CHANGE_CONTENT":"changeContent","DESTROY":"destroy","BEFORE_SHOW":"beforeShow","SHOW":"show","BEFORE_HIDE":"beforeHide","HIDE":"hide"},J={"VISIBLE":{key:"visible",value:true,validator:YAHOO.lang.isBoolean},"EFFECT":{key:"effect",suppressEvent:true,supercedes:["visible"]},"MONITOR_RESIZE":{key:"monitorresize",value:true},"APPEND_TO_DOCUMENT_BODY":{key:"appendtodocumentbody",value:false}};G.IMG_ROOT=null;G.IMG_ROOT_SSL=null;G.CSS_MODULE="yui-module";G.CSS_HEADER="hd";G.CSS_BODY="bd";G.CSS_FOOTER="ft";G.RESIZE_MONITOR_SECURE_URL="javascript:false;";G.RESIZE_MONITOR_BUFFER=1;G.textResizeEvent=new M("textResize");G.forceDocumentRedraw=function(){var Q=document.documentElement;if(Q){Q.className+=" ";Q.className=YAHOO.lang.trim(Q.className);}};function L(){if(!H){H=document.createElement("div");H.innerHTML=('<div class="'+G.CSS_HEADER+'"></div>'+'<div class="'+G.CSS_BODY+'"></div><div class="'+G.CSS_FOOTER+'"></div>');P=H.firstChild;O=P.nextSibling;E=O.nextSibling;}return H;}function K(){if(!P){L();}return(P.cloneNode(false));}function B(){if(!O){L();}return(O.cloneNode(false));}function C(){if(!E){L();}return(E.cloneNode(false));}G.prototype={constructor:G,element:null,header:null,body:null,footer:null,id:null,imageRoot:G.IMG_ROOT,initEvents:function(){var Q=M.LIST;
this.beforeInitEvent=this.createEvent(A.BEFORE_INIT);this.beforeInitEvent.signature=Q;this.initEvent=this.createEvent(A.INIT);this.initEvent.signature=Q;this.appendEvent=this.createEvent(A.APPEND);this.appendEvent.signature=Q;this.beforeRenderEvent=this.createEvent(A.BEFORE_RENDER);this.beforeRenderEvent.signature=Q;this.renderEvent=this.createEvent(A.RENDER);this.renderEvent.signature=Q;this.changeHeaderEvent=this.createEvent(A.CHANGE_HEADER);this.changeHeaderEvent.signature=Q;this.changeBodyEvent=this.createEvent(A.CHANGE_BODY);this.changeBodyEvent.signature=Q;this.changeFooterEvent=this.createEvent(A.CHANGE_FOOTER);this.changeFooterEvent.signature=Q;this.changeContentEvent=this.createEvent(A.CHANGE_CONTENT);this.changeContentEvent.signature=Q;this.destroyEvent=this.createEvent(A.DESTROY);this.destroyEvent.signature=Q;this.beforeShowEvent=this.createEvent(A.BEFORE_SHOW);this.beforeShowEvent.signature=Q;this.showEvent=this.createEvent(A.SHOW);this.showEvent.signature=Q;this.beforeHideEvent=this.createEvent(A.BEFORE_HIDE);this.beforeHideEvent.signature=Q;this.hideEvent=this.createEvent(A.HIDE);this.hideEvent.signature=Q;},platform:function(){var Q=navigator.userAgent.toLowerCase();if(Q.indexOf("windows")!=-1||Q.indexOf("win32")!=-1){return"windows";}else{if(Q.indexOf("macintosh")!=-1){return"mac";}else{return false;}}}(),browser:function(){var Q=navigator.userAgent.toLowerCase();if(Q.indexOf("opera")!=-1){return"opera";}else{if(Q.indexOf("msie 7")!=-1){return"ie7";}else{if(Q.indexOf("msie")!=-1){return"ie";}else{if(Q.indexOf("safari")!=-1){return"safari";}else{if(Q.indexOf("gecko")!=-1){return"gecko";}else{return false;}}}}}}(),isSecure:function(){if(window.location.href.toLowerCase().indexOf("https")===0){return true;}else{return false;}}(),initDefaultConfig:function(){this.cfg.addProperty(J.VISIBLE.key,{handler:this.configVisible,value:J.VISIBLE.value,validator:J.VISIBLE.validator});this.cfg.addProperty(J.EFFECT.key,{suppressEvent:J.EFFECT.suppressEvent,supercedes:J.EFFECT.supercedes});this.cfg.addProperty(J.MONITOR_RESIZE.key,{handler:this.configMonitorResize,value:J.MONITOR_RESIZE.value});this.cfg.addProperty(J.APPEND_TO_DOCUMENT_BODY.key,{value:J.APPEND_TO_DOCUMENT_BODY.value});},init:function(V,U){var S,W;this.initEvents();this.beforeInitEvent.fire(G);this.cfg=new D(this);if(this.isSecure){this.imageRoot=G.IMG_ROOT_SSL;}if(typeof V=="string"){S=V;V=document.getElementById(V);if(!V){V=(L()).cloneNode(false);V.id=S;}}this.id=F.generateId(V);this.element=V;W=this.element.firstChild;if(W){var R=false,Q=false,T=false;do{if(1==W.nodeType){if(!R&&F.hasClass(W,G.CSS_HEADER)){this.header=W;R=true;}else{if(!Q&&F.hasClass(W,G.CSS_BODY)){this.body=W;Q=true;}else{if(!T&&F.hasClass(W,G.CSS_FOOTER)){this.footer=W;T=true;}}}}}while((W=W.nextSibling));}this.initDefaultConfig();F.addClass(this.element,G.CSS_MODULE);if(U){this.cfg.applyConfig(U,true);}if(!D.alreadySubscribed(this.renderEvent,this.cfg.fireQueue,this.cfg)){this.renderEvent.subscribe(this.cfg.fireQueue,this.cfg,true);}this.initEvent.fire(G);},initResizeMonitor:function(){var R=(I.gecko&&this.platform=="windows");if(R){var Q=this;setTimeout(function(){Q._initResizeMonitor();},0);}else{this._initResizeMonitor();}},_initResizeMonitor:function(){var Q,S,U;function W(){G.textResizeEvent.fire();}if(!I.opera){S=F.get("_yuiResizeMonitor");var V=this._supportsCWResize();if(!S){S=document.createElement("iframe");if(this.isSecure&&G.RESIZE_MONITOR_SECURE_URL&&I.ie){S.src=G.RESIZE_MONITOR_SECURE_URL;}if(!V){U=["<html><head><script ",'type="text/javascript">',"window.onresize=function(){window.parent.","YAHOO.widget.Module.textResizeEvent.","fire();};<","/script></head>","<body></body></html>"].join("");S.src="data:text/html;charset=utf-8,"+encodeURIComponent(U);}S.id="_yuiResizeMonitor";S.title="Text Resize Monitor";S.style.position="absolute";S.style.visibility="hidden";var R=document.body,T=R.firstChild;if(T){R.insertBefore(S,T);}else{R.appendChild(S);}S.style.backgroundColor="transparent";S.style.borderWidth="0";S.style.width="2em";S.style.height="2em";S.style.left="0";S.style.top=(-1*(S.offsetHeight+G.RESIZE_MONITOR_BUFFER))+"px";S.style.visibility="visible";if(I.webkit){Q=S.contentWindow.document;Q.open();Q.close();}}if(S&&S.contentWindow){G.textResizeEvent.subscribe(this.onDomResize,this,true);if(!G.textResizeInitialized){if(V){if(!N.on(S.contentWindow,"resize",W)){N.on(S,"resize",W);}}G.textResizeInitialized=true;}this.resizeMonitor=S;}}},_supportsCWResize:function(){var Q=true;if(I.gecko&&I.gecko<=1.8){Q=false;}return Q;},onDomResize:function(S,R){var Q=-1*(this.resizeMonitor.offsetHeight+G.RESIZE_MONITOR_BUFFER);this.resizeMonitor.style.top=Q+"px";this.resizeMonitor.style.left="0";},setHeader:function(R){var Q=this.header||(this.header=K());if(R.nodeName){Q.innerHTML="";Q.appendChild(R);}else{Q.innerHTML=R;}if(this._rendered){this._renderHeader();}this.changeHeaderEvent.fire(R);this.changeContentEvent.fire();},appendToHeader:function(R){var Q=this.header||(this.header=K());Q.appendChild(R);this.changeHeaderEvent.fire(R);this.changeContentEvent.fire();},setBody:function(R){var Q=this.body||(this.body=B());if(R.nodeName){Q.innerHTML="";Q.appendChild(R);}else{Q.innerHTML=R;}if(this._rendered){this._renderBody();}this.changeBodyEvent.fire(R);this.changeContentEvent.fire();},appendToBody:function(R){var Q=this.body||(this.body=B());Q.appendChild(R);this.changeBodyEvent.fire(R);this.changeContentEvent.fire();},setFooter:function(R){var Q=this.footer||(this.footer=C());if(R.nodeName){Q.innerHTML="";Q.appendChild(R);}else{Q.innerHTML=R;}if(this._rendered){this._renderFooter();}this.changeFooterEvent.fire(R);this.changeContentEvent.fire();},appendToFooter:function(R){var Q=this.footer||(this.footer=C());Q.appendChild(R);this.changeFooterEvent.fire(R);this.changeContentEvent.fire();},render:function(S,Q){var T=this;function R(U){if(typeof U=="string"){U=document.getElementById(U);}if(U){T._addToParent(U,T.element);T.appendEvent.fire();}}this.beforeRenderEvent.fire();
if(!Q){Q=this.element;}if(S){R(S);}else{if(!F.inDocument(this.element)){return false;}}this._renderHeader(Q);this._renderBody(Q);this._renderFooter(Q);this._rendered=true;this.renderEvent.fire();return true;},_renderHeader:function(Q){Q=Q||this.element;if(this.header&&!F.inDocument(this.header)){var R=Q.firstChild;if(R){Q.insertBefore(this.header,R);}else{Q.appendChild(this.header);}}},_renderBody:function(Q){Q=Q||this.element;if(this.body&&!F.inDocument(this.body)){if(this.footer&&F.isAncestor(Q,this.footer)){Q.insertBefore(this.body,this.footer);}else{Q.appendChild(this.body);}}},_renderFooter:function(Q){Q=Q||this.element;if(this.footer&&!F.inDocument(this.footer)){Q.appendChild(this.footer);}},destroy:function(){var Q;if(this.element){N.purgeElement(this.element,true);Q=this.element.parentNode;}if(Q){Q.removeChild(this.element);}this.element=null;this.header=null;this.body=null;this.footer=null;G.textResizeEvent.unsubscribe(this.onDomResize,this);this.cfg.destroy();this.cfg=null;this.destroyEvent.fire();},show:function(){this.cfg.setProperty("visible",true);},hide:function(){this.cfg.setProperty("visible",false);},configVisible:function(R,Q,S){var T=Q[0];if(T){this.beforeShowEvent.fire();F.setStyle(this.element,"display","block");this.showEvent.fire();}else{this.beforeHideEvent.fire();F.setStyle(this.element,"display","none");this.hideEvent.fire();}},configMonitorResize:function(S,R,T){var Q=R[0];if(Q){this.initResizeMonitor();}else{G.textResizeEvent.unsubscribe(this.onDomResize,this,true);this.resizeMonitor=null;}},_addToParent:function(Q,R){if(!this.cfg.getProperty("appendtodocumentbody")&&Q===document.body&&Q.firstChild){Q.insertBefore(R,Q.firstChild);}else{Q.appendChild(R);}},toString:function(){return"Module "+this.id;}};YAHOO.lang.augmentProto(G,YAHOO.util.EventProvider);}());(function(){YAHOO.widget.Overlay=function(P,O){YAHOO.widget.Overlay.superclass.constructor.call(this,P,O);};var I=YAHOO.lang,M=YAHOO.util.CustomEvent,G=YAHOO.widget.Module,N=YAHOO.util.Event,F=YAHOO.util.Dom,D=YAHOO.util.Config,K=YAHOO.env.ua,B=YAHOO.widget.Overlay,H="subscribe",E="unsubscribe",C="contained",J,A={"BEFORE_MOVE":"beforeMove","MOVE":"move"},L={"X":{key:"x",validator:I.isNumber,suppressEvent:true,supercedes:["iframe"]},"Y":{key:"y",validator:I.isNumber,suppressEvent:true,supercedes:["iframe"]},"XY":{key:"xy",suppressEvent:true,supercedes:["iframe"]},"CONTEXT":{key:"context",suppressEvent:true,supercedes:["iframe"]},"FIXED_CENTER":{key:"fixedcenter",value:false,supercedes:["iframe","visible"]},"WIDTH":{key:"width",suppressEvent:true,supercedes:["context","fixedcenter","iframe"]},"HEIGHT":{key:"height",suppressEvent:true,supercedes:["context","fixedcenter","iframe"]},"AUTO_FILL_HEIGHT":{key:"autofillheight",supercedes:["height"],value:"body"},"ZINDEX":{key:"zindex",value:null},"CONSTRAIN_TO_VIEWPORT":{key:"constraintoviewport",value:false,validator:I.isBoolean,supercedes:["iframe","x","y","xy"]},"IFRAME":{key:"iframe",value:(K.ie==6?true:false),validator:I.isBoolean,supercedes:["zindex"]},"PREVENT_CONTEXT_OVERLAP":{key:"preventcontextoverlap",value:false,validator:I.isBoolean,supercedes:["constraintoviewport"]}};B.IFRAME_SRC="javascript:false;";B.IFRAME_OFFSET=3;B.VIEWPORT_OFFSET=10;B.TOP_LEFT="tl";B.TOP_RIGHT="tr";B.BOTTOM_LEFT="bl";B.BOTTOM_RIGHT="br";B.PREVENT_OVERLAP_X={"tltr":true,"blbr":true,"brbl":true,"trtl":true};B.PREVENT_OVERLAP_Y={"trbr":true,"tlbl":true,"bltl":true,"brtr":true};B.CSS_OVERLAY="yui-overlay";B.CSS_HIDDEN="yui-overlay-hidden";B.CSS_IFRAME="yui-overlay-iframe";B.STD_MOD_RE=/^\s*?(body|footer|header)\s*?$/i;B.windowScrollEvent=new M("windowScroll");B.windowResizeEvent=new M("windowResize");B.windowScrollHandler=function(P){var O=N.getTarget(P);if(!O||O===window||O===window.document){if(K.ie){if(!window.scrollEnd){window.scrollEnd=-1;}clearTimeout(window.scrollEnd);window.scrollEnd=setTimeout(function(){B.windowScrollEvent.fire();},1);}else{B.windowScrollEvent.fire();}}};B.windowResizeHandler=function(O){if(K.ie){if(!window.resizeEnd){window.resizeEnd=-1;}clearTimeout(window.resizeEnd);window.resizeEnd=setTimeout(function(){B.windowResizeEvent.fire();},100);}else{B.windowResizeEvent.fire();}};B._initialized=null;if(B._initialized===null){N.on(window,"scroll",B.windowScrollHandler);N.on(window,"resize",B.windowResizeHandler);B._initialized=true;}B._TRIGGER_MAP={"windowScroll":B.windowScrollEvent,"windowResize":B.windowResizeEvent,"textResize":G.textResizeEvent};YAHOO.extend(B,G,{CONTEXT_TRIGGERS:[],init:function(P,O){B.superclass.init.call(this,P);this.beforeInitEvent.fire(B);F.addClass(this.element,B.CSS_OVERLAY);if(O){this.cfg.applyConfig(O,true);}if(this.platform=="mac"&&K.gecko){if(!D.alreadySubscribed(this.showEvent,this.showMacGeckoScrollbars,this)){this.showEvent.subscribe(this.showMacGeckoScrollbars,this,true);}if(!D.alreadySubscribed(this.hideEvent,this.hideMacGeckoScrollbars,this)){this.hideEvent.subscribe(this.hideMacGeckoScrollbars,this,true);}}this.initEvent.fire(B);},initEvents:function(){B.superclass.initEvents.call(this);var O=M.LIST;this.beforeMoveEvent=this.createEvent(A.BEFORE_MOVE);this.beforeMoveEvent.signature=O;this.moveEvent=this.createEvent(A.MOVE);this.moveEvent.signature=O;},initDefaultConfig:function(){B.superclass.initDefaultConfig.call(this);var O=this.cfg;O.addProperty(L.X.key,{handler:this.configX,validator:L.X.validator,suppressEvent:L.X.suppressEvent,supercedes:L.X.supercedes});O.addProperty(L.Y.key,{handler:this.configY,validator:L.Y.validator,suppressEvent:L.Y.suppressEvent,supercedes:L.Y.supercedes});O.addProperty(L.XY.key,{handler:this.configXY,suppressEvent:L.XY.suppressEvent,supercedes:L.XY.supercedes});O.addProperty(L.CONTEXT.key,{handler:this.configContext,suppressEvent:L.CONTEXT.suppressEvent,supercedes:L.CONTEXT.supercedes});O.addProperty(L.FIXED_CENTER.key,{handler:this.configFixedCenter,value:L.FIXED_CENTER.value,validator:L.FIXED_CENTER.validator,supercedes:L.FIXED_CENTER.supercedes});O.addProperty(L.WIDTH.key,{handler:this.configWidth,suppressEvent:L.WIDTH.suppressEvent,supercedes:L.WIDTH.supercedes});
O.addProperty(L.HEIGHT.key,{handler:this.configHeight,suppressEvent:L.HEIGHT.suppressEvent,supercedes:L.HEIGHT.supercedes});O.addProperty(L.AUTO_FILL_HEIGHT.key,{handler:this.configAutoFillHeight,value:L.AUTO_FILL_HEIGHT.value,validator:this._validateAutoFill,supercedes:L.AUTO_FILL_HEIGHT.supercedes});O.addProperty(L.ZINDEX.key,{handler:this.configzIndex,value:L.ZINDEX.value});O.addProperty(L.CONSTRAIN_TO_VIEWPORT.key,{handler:this.configConstrainToViewport,value:L.CONSTRAIN_TO_VIEWPORT.value,validator:L.CONSTRAIN_TO_VIEWPORT.validator,supercedes:L.CONSTRAIN_TO_VIEWPORT.supercedes});O.addProperty(L.IFRAME.key,{handler:this.configIframe,value:L.IFRAME.value,validator:L.IFRAME.validator,supercedes:L.IFRAME.supercedes});O.addProperty(L.PREVENT_CONTEXT_OVERLAP.key,{value:L.PREVENT_CONTEXT_OVERLAP.value,validator:L.PREVENT_CONTEXT_OVERLAP.validator,supercedes:L.PREVENT_CONTEXT_OVERLAP.supercedes});},moveTo:function(O,P){this.cfg.setProperty("xy",[O,P]);},hideMacGeckoScrollbars:function(){F.replaceClass(this.element,"show-scrollbars","hide-scrollbars");},showMacGeckoScrollbars:function(){F.replaceClass(this.element,"hide-scrollbars","show-scrollbars");},_setDomVisibility:function(O){F.setStyle(this.element,"visibility",(O)?"visible":"hidden");var P=B.CSS_HIDDEN;if(O){F.removeClass(this.element,P);}else{F.addClass(this.element,P);}},configVisible:function(R,O,X){var Q=O[0],S=F.getStyle(this.element,"visibility"),Y=this.cfg.getProperty("effect"),V=[],U=(this.platform=="mac"&&K.gecko),g=D.alreadySubscribed,W,P,f,c,b,a,d,Z,T;if(S=="inherit"){f=this.element.parentNode;while(f.nodeType!=9&&f.nodeType!=11){S=F.getStyle(f,"visibility");if(S!="inherit"){break;}f=f.parentNode;}if(S=="inherit"){S="visible";}}if(Y){if(Y instanceof Array){Z=Y.length;for(c=0;c<Z;c++){W=Y[c];V[V.length]=W.effect(this,W.duration);}}else{V[V.length]=Y.effect(this,Y.duration);}}if(Q){if(U){this.showMacGeckoScrollbars();}if(Y){if(Q){if(S!="visible"||S===""){this.beforeShowEvent.fire();T=V.length;for(b=0;b<T;b++){P=V[b];if(b===0&&!g(P.animateInCompleteEvent,this.showEvent.fire,this.showEvent)){P.animateInCompleteEvent.subscribe(this.showEvent.fire,this.showEvent,true);}P.animateIn();}}}}else{if(S!="visible"||S===""){this.beforeShowEvent.fire();this._setDomVisibility(true);this.cfg.refireEvent("iframe");this.showEvent.fire();}else{this._setDomVisibility(true);}}}else{if(U){this.hideMacGeckoScrollbars();}if(Y){if(S=="visible"){this.beforeHideEvent.fire();T=V.length;for(a=0;a<T;a++){d=V[a];if(a===0&&!g(d.animateOutCompleteEvent,this.hideEvent.fire,this.hideEvent)){d.animateOutCompleteEvent.subscribe(this.hideEvent.fire,this.hideEvent,true);}d.animateOut();}}else{if(S===""){this._setDomVisibility(false);}}}else{if(S=="visible"||S===""){this.beforeHideEvent.fire();this._setDomVisibility(false);this.hideEvent.fire();}else{this._setDomVisibility(false);}}}},doCenterOnDOMEvent:function(){var O=this.cfg,P=O.getProperty("fixedcenter");if(O.getProperty("visible")){if(P&&(P!==C||this.fitsInViewport())){this.center();}}},fitsInViewport:function(){var S=B.VIEWPORT_OFFSET,Q=this.element,T=Q.offsetWidth,R=Q.offsetHeight,O=F.getViewportWidth(),P=F.getViewportHeight();return((T+S<O)&&(R+S<P));},configFixedCenter:function(S,Q,T){var U=Q[0],P=D.alreadySubscribed,R=B.windowResizeEvent,O=B.windowScrollEvent;if(U){this.center();if(!P(this.beforeShowEvent,this.center)){this.beforeShowEvent.subscribe(this.center);}if(!P(R,this.doCenterOnDOMEvent,this)){R.subscribe(this.doCenterOnDOMEvent,this,true);}if(!P(O,this.doCenterOnDOMEvent,this)){O.subscribe(this.doCenterOnDOMEvent,this,true);}}else{this.beforeShowEvent.unsubscribe(this.center);R.unsubscribe(this.doCenterOnDOMEvent,this);O.unsubscribe(this.doCenterOnDOMEvent,this);}},configHeight:function(R,P,S){var O=P[0],Q=this.element;F.setStyle(Q,"height",O);this.cfg.refireEvent("iframe");},configAutoFillHeight:function(T,S,P){var V=S[0],Q=this.cfg,U="autofillheight",W="height",R=Q.getProperty(U),O=this._autoFillOnHeightChange;Q.unsubscribeFromConfigEvent(W,O);G.textResizeEvent.unsubscribe(O);this.changeContentEvent.unsubscribe(O);if(R&&V!==R&&this[R]){F.setStyle(this[R],W,"");}if(V){V=I.trim(V.toLowerCase());Q.subscribeToConfigEvent(W,O,this[V],this);G.textResizeEvent.subscribe(O,this[V],this);this.changeContentEvent.subscribe(O,this[V],this);Q.setProperty(U,V,true);}},configWidth:function(R,O,S){var Q=O[0],P=this.element;F.setStyle(P,"width",Q);this.cfg.refireEvent("iframe");},configzIndex:function(Q,O,R){var S=O[0],P=this.element;if(!S){S=F.getStyle(P,"zIndex");if(!S||isNaN(S)){S=0;}}if(this.iframe||this.cfg.getProperty("iframe")===true){if(S<=0){S=1;}}F.setStyle(P,"zIndex",S);this.cfg.setProperty("zIndex",S,true);if(this.iframe){this.stackIframe();}},configXY:function(Q,P,R){var T=P[0],O=T[0],S=T[1];this.cfg.setProperty("x",O);this.cfg.setProperty("y",S);this.beforeMoveEvent.fire([O,S]);O=this.cfg.getProperty("x");S=this.cfg.getProperty("y");this.cfg.refireEvent("iframe");this.moveEvent.fire([O,S]);},configX:function(Q,P,R){var O=P[0],S=this.cfg.getProperty("y");this.cfg.setProperty("x",O,true);this.cfg.setProperty("y",S,true);this.beforeMoveEvent.fire([O,S]);O=this.cfg.getProperty("x");S=this.cfg.getProperty("y");F.setX(this.element,O,true);this.cfg.setProperty("xy",[O,S],true);this.cfg.refireEvent("iframe");this.moveEvent.fire([O,S]);},configY:function(Q,P,R){var O=this.cfg.getProperty("x"),S=P[0];this.cfg.setProperty("x",O,true);this.cfg.setProperty("y",S,true);this.beforeMoveEvent.fire([O,S]);O=this.cfg.getProperty("x");S=this.cfg.getProperty("y");F.setY(this.element,S,true);this.cfg.setProperty("xy",[O,S],true);this.cfg.refireEvent("iframe");this.moveEvent.fire([O,S]);},showIframe:function(){var P=this.iframe,O;if(P){O=this.element.parentNode;if(O!=P.parentNode){this._addToParent(O,P);}P.style.display="block";}},hideIframe:function(){if(this.iframe){this.iframe.style.display="none";}},syncIframe:function(){var O=this.iframe,Q=this.element,S=B.IFRAME_OFFSET,P=(S*2),R;if(O){O.style.width=(Q.offsetWidth+P+"px");
O.style.height=(Q.offsetHeight+P+"px");R=this.cfg.getProperty("xy");if(!I.isArray(R)||(isNaN(R[0])||isNaN(R[1]))){this.syncPosition();R=this.cfg.getProperty("xy");}F.setXY(O,[(R[0]-S),(R[1]-S)]);}},stackIframe:function(){if(this.iframe){var O=F.getStyle(this.element,"zIndex");if(!YAHOO.lang.isUndefined(O)&&!isNaN(O)){F.setStyle(this.iframe,"zIndex",(O-1));}}},configIframe:function(R,Q,S){var O=Q[0];function T(){var V=this.iframe,W=this.element,X;if(!V){if(!J){J=document.createElement("iframe");if(this.isSecure){J.src=B.IFRAME_SRC;}if(K.ie){J.style.filter="alpha(opacity=0)";J.frameBorder=0;}else{J.style.opacity="0";}J.style.position="absolute";J.style.border="none";J.style.margin="0";J.style.padding="0";J.style.display="none";J.tabIndex=-1;J.className=B.CSS_IFRAME;}V=J.cloneNode(false);V.id=this.id+"_f";X=W.parentNode;var U=X||document.body;this._addToParent(U,V);this.iframe=V;}this.showIframe();this.syncIframe();this.stackIframe();if(!this._hasIframeEventListeners){this.showEvent.subscribe(this.showIframe);this.hideEvent.subscribe(this.hideIframe);this.changeContentEvent.subscribe(this.syncIframe);this._hasIframeEventListeners=true;}}function P(){T.call(this);this.beforeShowEvent.unsubscribe(P);this._iframeDeferred=false;}if(O){if(this.cfg.getProperty("visible")){T.call(this);}else{if(!this._iframeDeferred){this.beforeShowEvent.subscribe(P);this._iframeDeferred=true;}}}else{this.hideIframe();if(this._hasIframeEventListeners){this.showEvent.unsubscribe(this.showIframe);this.hideEvent.unsubscribe(this.hideIframe);this.changeContentEvent.unsubscribe(this.syncIframe);this._hasIframeEventListeners=false;}}},_primeXYFromDOM:function(){if(YAHOO.lang.isUndefined(this.cfg.getProperty("xy"))){this.syncPosition();this.cfg.refireEvent("xy");this.beforeShowEvent.unsubscribe(this._primeXYFromDOM);}},configConstrainToViewport:function(P,O,Q){var R=O[0];if(R){if(!D.alreadySubscribed(this.beforeMoveEvent,this.enforceConstraints,this)){this.beforeMoveEvent.subscribe(this.enforceConstraints,this,true);}if(!D.alreadySubscribed(this.beforeShowEvent,this._primeXYFromDOM)){this.beforeShowEvent.subscribe(this._primeXYFromDOM);}}else{this.beforeShowEvent.unsubscribe(this._primeXYFromDOM);this.beforeMoveEvent.unsubscribe(this.enforceConstraints,this);}},configContext:function(U,T,Q){var X=T[0],R,O,V,S,P,W=this.CONTEXT_TRIGGERS;if(X){R=X[0];O=X[1];V=X[2];S=X[3];P=X[4];if(W&&W.length>0){S=(S||[]).concat(W);}if(R){if(typeof R=="string"){this.cfg.setProperty("context",[document.getElementById(R),O,V,S,P],true);}if(O&&V){this.align(O,V,P);}if(this._contextTriggers){this._processTriggers(this._contextTriggers,E,this._alignOnTrigger);}if(S){this._processTriggers(S,H,this._alignOnTrigger);this._contextTriggers=S;}}}},_alignOnTrigger:function(P,O){this.align();},_findTriggerCE:function(O){var P=null;if(O instanceof M){P=O;}else{if(B._TRIGGER_MAP[O]){P=B._TRIGGER_MAP[O];}}return P;},_processTriggers:function(S,U,R){var Q,T;for(var P=0,O=S.length;P<O;++P){Q=S[P];T=this._findTriggerCE(Q);if(T){T[U](R,this,true);}else{this[U](Q,R);}}},align:function(P,W,S){var V=this.cfg.getProperty("context"),T=this,O,Q,U;function R(Z,a){var Y=null,X=null;switch(P){case B.TOP_LEFT:Y=a;X=Z;break;case B.TOP_RIGHT:Y=a-Q.offsetWidth;X=Z;break;case B.BOTTOM_LEFT:Y=a;X=Z-Q.offsetHeight;break;case B.BOTTOM_RIGHT:Y=a-Q.offsetWidth;X=Z-Q.offsetHeight;break;}if(Y!==null&&X!==null){if(S){Y+=S[0];X+=S[1];}T.moveTo(Y,X);}}if(V){O=V[0];Q=this.element;T=this;if(!P){P=V[1];}if(!W){W=V[2];}if(!S&&V[4]){S=V[4];}if(Q&&O){U=F.getRegion(O);switch(W){case B.TOP_LEFT:R(U.top,U.left);break;case B.TOP_RIGHT:R(U.top,U.right);break;case B.BOTTOM_LEFT:R(U.bottom,U.left);break;case B.BOTTOM_RIGHT:R(U.bottom,U.right);break;}}}},enforceConstraints:function(P,O,Q){var S=O[0];var R=this.getConstrainedXY(S[0],S[1]);this.cfg.setProperty("x",R[0],true);this.cfg.setProperty("y",R[1],true);this.cfg.setProperty("xy",R,true);},_getConstrainedPos:function(X,P){var T=this.element,R=B.VIEWPORT_OFFSET,Z=(X=="x"),Y=(Z)?T.offsetWidth:T.offsetHeight,S=(Z)?F.getViewportWidth():F.getViewportHeight(),c=(Z)?F.getDocumentScrollLeft():F.getDocumentScrollTop(),b=(Z)?B.PREVENT_OVERLAP_X:B.PREVENT_OVERLAP_Y,O=this.cfg.getProperty("context"),U=(Y+R<S),W=this.cfg.getProperty("preventcontextoverlap")&&O&&b[(O[1]+O[2])],V=c+R,a=c+S-Y-R,Q=P;if(P<V||P>a){if(W){Q=this._preventOverlap(X,O[0],Y,S,c);}else{if(U){if(P<V){Q=V;}else{if(P>a){Q=a;}}}else{Q=V;}}}return Q;},_preventOverlap:function(X,W,Y,U,b){var Z=(X=="x"),T=B.VIEWPORT_OFFSET,S=this,Q=((Z)?F.getX(W):F.getY(W))-b,O=(Z)?W.offsetWidth:W.offsetHeight,P=Q-T,R=(U-(Q+O))-T,c=false,V=function(){var d;if((S.cfg.getProperty(X)-b)>Q){d=(Q-Y);}else{d=(Q+O);}S.cfg.setProperty(X,(d+b),true);return d;},a=function(){var e=((S.cfg.getProperty(X)-b)>Q)?R:P,d;if(Y>e){if(c){V();}else{V();c=true;d=a();}}return d;};a();return this.cfg.getProperty(X);},getConstrainedX:function(O){return this._getConstrainedPos("x",O);},getConstrainedY:function(O){return this._getConstrainedPos("y",O);},getConstrainedXY:function(O,P){return[this.getConstrainedX(O),this.getConstrainedY(P)];},center:function(){var R=B.VIEWPORT_OFFSET,S=this.element.offsetWidth,Q=this.element.offsetHeight,P=F.getViewportWidth(),T=F.getViewportHeight(),O,U;if(S<P){O=(P/2)-(S/2)+F.getDocumentScrollLeft();}else{O=R+F.getDocumentScrollLeft();}if(Q<T){U=(T/2)-(Q/2)+F.getDocumentScrollTop();}else{U=R+F.getDocumentScrollTop();}this.cfg.setProperty("xy",[parseInt(O,10),parseInt(U,10)]);this.cfg.refireEvent("iframe");if(K.webkit){this.forceContainerRedraw();}},syncPosition:function(){var O=F.getXY(this.element);this.cfg.setProperty("x",O[0],true);this.cfg.setProperty("y",O[1],true);this.cfg.setProperty("xy",O,true);},onDomResize:function(Q,P){var O=this;B.superclass.onDomResize.call(this,Q,P);setTimeout(function(){O.syncPosition();O.cfg.refireEvent("iframe");O.cfg.refireEvent("context");},0);},_getComputedHeight:(function(){if(document.defaultView&&document.defaultView.getComputedStyle){return function(P){var O=null;
if(P.ownerDocument&&P.ownerDocument.defaultView){var Q=P.ownerDocument.defaultView.getComputedStyle(P,"");if(Q){O=parseInt(Q.height,10);}}return(I.isNumber(O))?O:null;};}else{return function(P){var O=null;if(P.style.pixelHeight){O=P.style.pixelHeight;}return(I.isNumber(O))?O:null;};}})(),_validateAutoFillHeight:function(O){return(!O)||(I.isString(O)&&B.STD_MOD_RE.test(O));},_autoFillOnHeightChange:function(R,P,Q){var O=this.cfg.getProperty("height");if((O&&O!=="auto")||(O===0)){this.fillHeight(Q);}},_getPreciseHeight:function(P){var O=P.offsetHeight;if(P.getBoundingClientRect){var Q=P.getBoundingClientRect();O=Q.bottom-Q.top;}return O;},fillHeight:function(R){if(R){var P=this.innerElement||this.element,O=[this.header,this.body,this.footer],V,W=0,X=0,T=0,Q=false;for(var U=0,S=O.length;U<S;U++){V=O[U];if(V){if(R!==V){X+=this._getPreciseHeight(V);}else{Q=true;}}}if(Q){if(K.ie||K.opera){F.setStyle(R,"height",0+"px");}W=this._getComputedHeight(P);if(W===null){F.addClass(P,"yui-override-padding");W=P.clientHeight;F.removeClass(P,"yui-override-padding");}T=Math.max(W-X,0);F.setStyle(R,"height",T+"px");if(R.offsetHeight!=T){T=Math.max(T-(R.offsetHeight-T),0);}F.setStyle(R,"height",T+"px");}}},bringToTop:function(){var S=[],R=this.element;function V(Z,Y){var b=F.getStyle(Z,"zIndex"),a=F.getStyle(Y,"zIndex"),X=(!b||isNaN(b))?0:parseInt(b,10),W=(!a||isNaN(a))?0:parseInt(a,10);if(X>W){return -1;}else{if(X<W){return 1;}else{return 0;}}}function Q(Y){var X=F.hasClass(Y,B.CSS_OVERLAY),W=YAHOO.widget.Panel;if(X&&!F.isAncestor(R,Y)){if(W&&F.hasClass(Y,W.CSS_PANEL)){S[S.length]=Y.parentNode;}else{S[S.length]=Y;}}}F.getElementsBy(Q,"DIV",document.body);S.sort(V);var O=S[0],U;if(O){U=F.getStyle(O,"zIndex");if(!isNaN(U)){var T=false;if(O!=R){T=true;}else{if(S.length>1){var P=F.getStyle(S[1],"zIndex");if(!isNaN(P)&&(U==P)){T=true;}}}if(T){this.cfg.setProperty("zindex",(parseInt(U,10)+2));}}}},destroy:function(){if(this.iframe){this.iframe.parentNode.removeChild(this.iframe);}this.iframe=null;B.windowResizeEvent.unsubscribe(this.doCenterOnDOMEvent,this);B.windowScrollEvent.unsubscribe(this.doCenterOnDOMEvent,this);G.textResizeEvent.unsubscribe(this._autoFillOnHeightChange);if(this._contextTriggers){this._processTriggers(this._contextTriggers,E,this._alignOnTrigger);}B.superclass.destroy.call(this);},forceContainerRedraw:function(){var O=this;F.addClass(O.element,"yui-force-redraw");setTimeout(function(){F.removeClass(O.element,"yui-force-redraw");},0);},toString:function(){return"Overlay "+this.id;}});}());(function(){YAHOO.widget.OverlayManager=function(G){this.init(G);};var D=YAHOO.widget.Overlay,C=YAHOO.util.Event,E=YAHOO.util.Dom,B=YAHOO.util.Config,F=YAHOO.util.CustomEvent,A=YAHOO.widget.OverlayManager;A.CSS_FOCUSED="focused";A.prototype={constructor:A,overlays:null,initDefaultConfig:function(){this.cfg.addProperty("overlays",{suppressEvent:true});this.cfg.addProperty("focusevent",{value:"mousedown"});},init:function(I){this.cfg=new B(this);this.initDefaultConfig();if(I){this.cfg.applyConfig(I,true);}this.cfg.fireQueue();var H=null;this.getActive=function(){return H;};this.focus=function(J){var K=this.find(J);if(K){K.focus();}};this.remove=function(K){var M=this.find(K),J;if(M){if(H==M){H=null;}var L=(M.element===null&&M.cfg===null)?true:false;if(!L){J=E.getStyle(M.element,"zIndex");M.cfg.setProperty("zIndex",-1000,true);}this.overlays.sort(this.compareZIndexDesc);this.overlays=this.overlays.slice(0,(this.overlays.length-1));M.hideEvent.unsubscribe(M.blur);M.destroyEvent.unsubscribe(this._onOverlayDestroy,M);M.focusEvent.unsubscribe(this._onOverlayFocusHandler,M);M.blurEvent.unsubscribe(this._onOverlayBlurHandler,M);if(!L){C.removeListener(M.element,this.cfg.getProperty("focusevent"),this._onOverlayElementFocus);M.cfg.setProperty("zIndex",J,true);M.cfg.setProperty("manager",null);}if(M.focusEvent._managed){M.focusEvent=null;}if(M.blurEvent._managed){M.blurEvent=null;}if(M.focus._managed){M.focus=null;}if(M.blur._managed){M.blur=null;}}};this.blurAll=function(){var K=this.overlays.length,J;if(K>0){J=K-1;do{this.overlays[J].blur();}while(J--);}};this._manageBlur=function(J){var K=false;if(H==J){E.removeClass(H.element,A.CSS_FOCUSED);H=null;K=true;}return K;};this._manageFocus=function(J){var K=false;if(H!=J){if(H){H.blur();}H=J;this.bringToTop(H);E.addClass(H.element,A.CSS_FOCUSED);K=true;}return K;};var G=this.cfg.getProperty("overlays");if(!this.overlays){this.overlays=[];}if(G){this.register(G);this.overlays.sort(this.compareZIndexDesc);}},_onOverlayElementFocus:function(I){var G=C.getTarget(I),H=this.close;if(H&&(G==H||E.isAncestor(H,G))){this.blur();}else{this.focus();}},_onOverlayDestroy:function(H,G,I){this.remove(I);},_onOverlayFocusHandler:function(H,G,I){this._manageFocus(I);},_onOverlayBlurHandler:function(H,G,I){this._manageBlur(I);},_bindFocus:function(G){var H=this;if(!G.focusEvent){G.focusEvent=G.createEvent("focus");G.focusEvent.signature=F.LIST;G.focusEvent._managed=true;}else{G.focusEvent.subscribe(H._onOverlayFocusHandler,G,H);}if(!G.focus){C.on(G.element,H.cfg.getProperty("focusevent"),H._onOverlayElementFocus,null,G);G.focus=function(){if(H._manageFocus(this)){if(this.cfg.getProperty("visible")&&this.focusFirst){this.focusFirst();}this.focusEvent.fire();}};G.focus._managed=true;}},_bindBlur:function(G){var H=this;if(!G.blurEvent){G.blurEvent=G.createEvent("blur");G.blurEvent.signature=F.LIST;G.focusEvent._managed=true;}else{G.blurEvent.subscribe(H._onOverlayBlurHandler,G,H);}if(!G.blur){G.blur=function(){if(H._manageBlur(this)){this.blurEvent.fire();}};G.blur._managed=true;}G.hideEvent.subscribe(G.blur);},_bindDestroy:function(G){var H=this;G.destroyEvent.subscribe(H._onOverlayDestroy,G,H);},_syncZIndex:function(G){var H=E.getStyle(G.element,"zIndex");if(!isNaN(H)){G.cfg.setProperty("zIndex",parseInt(H,10));}else{G.cfg.setProperty("zIndex",0);}},register:function(G){var J=false,H,I;if(G instanceof D){G.cfg.addProperty("manager",{value:this});this._bindFocus(G);this._bindBlur(G);this._bindDestroy(G);
this._syncZIndex(G);this.overlays.push(G);this.bringToTop(G);J=true;}else{if(G instanceof Array){for(H=0,I=G.length;H<I;H++){J=this.register(G[H])||J;}}}return J;},bringToTop:function(M){var I=this.find(M),L,G,J;if(I){J=this.overlays;J.sort(this.compareZIndexDesc);G=J[0];if(G){L=E.getStyle(G.element,"zIndex");if(!isNaN(L)){var K=false;if(G!==I){K=true;}else{if(J.length>1){var H=E.getStyle(J[1].element,"zIndex");if(!isNaN(H)&&(L==H)){K=true;}}}if(K){I.cfg.setProperty("zindex",(parseInt(L,10)+2));}}J.sort(this.compareZIndexDesc);}}},find:function(G){var K=G instanceof D,I=this.overlays,M=I.length,J=null,L,H;if(K||typeof G=="string"){for(H=M-1;H>=0;H--){L=I[H];if((K&&(L===G))||(L.id==G)){J=L;break;}}}return J;},compareZIndexDesc:function(J,I){var H=(J.cfg)?J.cfg.getProperty("zIndex"):null,G=(I.cfg)?I.cfg.getProperty("zIndex"):null;if(H===null&&G===null){return 0;}else{if(H===null){return 1;}else{if(G===null){return -1;}else{if(H>G){return -1;}else{if(H<G){return 1;}else{return 0;}}}}}},showAll:function(){var H=this.overlays,I=H.length,G;for(G=I-1;G>=0;G--){H[G].show();}},hideAll:function(){var H=this.overlays,I=H.length,G;for(G=I-1;G>=0;G--){H[G].hide();}},toString:function(){return"OverlayManager";}};}());(function(){YAHOO.widget.Tooltip=function(P,O){YAHOO.widget.Tooltip.superclass.constructor.call(this,P,O);};var E=YAHOO.lang,N=YAHOO.util.Event,M=YAHOO.util.CustomEvent,C=YAHOO.util.Dom,J=YAHOO.widget.Tooltip,H=YAHOO.env.ua,G=(H.ie&&(H.ie<=6||document.compatMode=="BackCompat")),F,I={"PREVENT_OVERLAP":{key:"preventoverlap",value:true,validator:E.isBoolean,supercedes:["x","y","xy"]},"SHOW_DELAY":{key:"showdelay",value:200,validator:E.isNumber},"AUTO_DISMISS_DELAY":{key:"autodismissdelay",value:5000,validator:E.isNumber},"HIDE_DELAY":{key:"hidedelay",value:250,validator:E.isNumber},"TEXT":{key:"text",suppressEvent:true},"CONTAINER":{key:"container"},"DISABLED":{key:"disabled",value:false,suppressEvent:true},"XY_OFFSET":{key:"xyoffset",value:[0,25],suppressEvent:true}},A={"CONTEXT_MOUSE_OVER":"contextMouseOver","CONTEXT_MOUSE_OUT":"contextMouseOut","CONTEXT_TRIGGER":"contextTrigger"};J.CSS_TOOLTIP="yui-tt";function K(Q,O){var P=this.cfg,R=P.getProperty("width");if(R==O){P.setProperty("width",Q);}}function D(P,O){if("_originalWidth" in this){K.call(this,this._originalWidth,this._forcedWidth);}var Q=document.body,U=this.cfg,T=U.getProperty("width"),R,S;if((!T||T=="auto")&&(U.getProperty("container")!=Q||U.getProperty("x")>=C.getViewportWidth()||U.getProperty("y")>=C.getViewportHeight())){S=this.element.cloneNode(true);S.style.visibility="hidden";S.style.top="0px";S.style.left="0px";Q.appendChild(S);R=(S.offsetWidth+"px");Q.removeChild(S);S=null;U.setProperty("width",R);U.refireEvent("xy");this._originalWidth=T||"";this._forcedWidth=R;}}function B(P,O,Q){this.render(Q);}function L(){N.onDOMReady(B,this.cfg.getProperty("container"),this);}YAHOO.extend(J,YAHOO.widget.Overlay,{init:function(P,O){J.superclass.init.call(this,P);this.beforeInitEvent.fire(J);C.addClass(this.element,J.CSS_TOOLTIP);if(O){this.cfg.applyConfig(O,true);}this.cfg.queueProperty("visible",false);this.cfg.queueProperty("constraintoviewport",true);this.setBody("");this.subscribe("changeContent",D);this.subscribe("init",L);this.subscribe("render",this.onRender);this.initEvent.fire(J);},initEvents:function(){J.superclass.initEvents.call(this);var O=M.LIST;this.contextMouseOverEvent=this.createEvent(A.CONTEXT_MOUSE_OVER);this.contextMouseOverEvent.signature=O;this.contextMouseOutEvent=this.createEvent(A.CONTEXT_MOUSE_OUT);this.contextMouseOutEvent.signature=O;this.contextTriggerEvent=this.createEvent(A.CONTEXT_TRIGGER);this.contextTriggerEvent.signature=O;},initDefaultConfig:function(){J.superclass.initDefaultConfig.call(this);this.cfg.addProperty(I.PREVENT_OVERLAP.key,{value:I.PREVENT_OVERLAP.value,validator:I.PREVENT_OVERLAP.validator,supercedes:I.PREVENT_OVERLAP.supercedes});this.cfg.addProperty(I.SHOW_DELAY.key,{handler:this.configShowDelay,value:200,validator:I.SHOW_DELAY.validator});this.cfg.addProperty(I.AUTO_DISMISS_DELAY.key,{handler:this.configAutoDismissDelay,value:I.AUTO_DISMISS_DELAY.value,validator:I.AUTO_DISMISS_DELAY.validator});this.cfg.addProperty(I.HIDE_DELAY.key,{handler:this.configHideDelay,value:I.HIDE_DELAY.value,validator:I.HIDE_DELAY.validator});this.cfg.addProperty(I.TEXT.key,{handler:this.configText,suppressEvent:I.TEXT.suppressEvent});this.cfg.addProperty(I.CONTAINER.key,{handler:this.configContainer,value:document.body});this.cfg.addProperty(I.DISABLED.key,{handler:this.configContainer,value:I.DISABLED.value,supressEvent:I.DISABLED.suppressEvent});this.cfg.addProperty(I.XY_OFFSET.key,{value:I.XY_OFFSET.value.concat(),supressEvent:I.XY_OFFSET.suppressEvent});},configText:function(P,O,Q){var R=O[0];if(R){this.setBody(R);}},configContainer:function(Q,P,R){var O=P[0];if(typeof O=="string"){this.cfg.setProperty("container",document.getElementById(O),true);}},_removeEventListeners:function(){var R=this._context,O,Q,P;if(R){O=R.length;if(O>0){P=O-1;do{Q=R[P];N.removeListener(Q,"mouseover",this.onContextMouseOver);N.removeListener(Q,"mousemove",this.onContextMouseMove);N.removeListener(Q,"mouseout",this.onContextMouseOut);}while(P--);}}},configContext:function(T,P,U){var S=P[0],V,O,R,Q;if(S){if(!(S instanceof Array)){if(typeof S=="string"){this.cfg.setProperty("context",[document.getElementById(S)],true);}else{this.cfg.setProperty("context",[S],true);}S=this.cfg.getProperty("context");}this._removeEventListeners();this._context=S;V=this._context;if(V){O=V.length;if(O>0){Q=O-1;do{R=V[Q];N.on(R,"mouseover",this.onContextMouseOver,this);N.on(R,"mousemove",this.onContextMouseMove,this);N.on(R,"mouseout",this.onContextMouseOut,this);}while(Q--);}}}},onContextMouseMove:function(P,O){O.pageX=N.getPageX(P);O.pageY=N.getPageY(P);},onContextMouseOver:function(Q,P){var O=this;if(O.title){P._tempTitle=O.title;O.title="";}if(P.fireEvent("contextMouseOver",O,Q)!==false&&!P.cfg.getProperty("disabled")){if(P.hideProcId){clearTimeout(P.hideProcId);
P.hideProcId=null;}N.on(O,"mousemove",P.onContextMouseMove,P);P.showProcId=P.doShow(Q,O);}},onContextMouseOut:function(Q,P){var O=this;if(P._tempTitle){O.title=P._tempTitle;P._tempTitle=null;}if(P.showProcId){clearTimeout(P.showProcId);P.showProcId=null;}if(P.hideProcId){clearTimeout(P.hideProcId);P.hideProcId=null;}P.fireEvent("contextMouseOut",O,Q);P.hideProcId=setTimeout(function(){P.hide();},P.cfg.getProperty("hidedelay"));},doShow:function(R,O){var T=this.cfg.getProperty("xyoffset"),P=T[0],S=T[1],Q=this;if(H.opera&&O.tagName&&O.tagName.toUpperCase()=="A"){S+=12;}return setTimeout(function(){var U=Q.cfg.getProperty("text");if(Q._tempTitle&&(U===""||YAHOO.lang.isUndefined(U)||YAHOO.lang.isNull(U))){Q.setBody(Q._tempTitle);}else{Q.cfg.refireEvent("text");}Q.moveTo(Q.pageX+P,Q.pageY+S);if(Q.cfg.getProperty("preventoverlap")){Q.preventOverlap(Q.pageX,Q.pageY);}N.removeListener(O,"mousemove",Q.onContextMouseMove);Q.contextTriggerEvent.fire(O);Q.show();Q.hideProcId=Q.doHide();},this.cfg.getProperty("showdelay"));},doHide:function(){var O=this;return setTimeout(function(){O.hide();},this.cfg.getProperty("autodismissdelay"));},preventOverlap:function(S,R){var O=this.element.offsetHeight,Q=new YAHOO.util.Point(S,R),P=C.getRegion(this.element);P.top-=5;P.left-=5;P.right+=5;P.bottom+=5;if(P.contains(Q)){this.cfg.setProperty("y",(R-O-5));}},onRender:function(S,R){function T(){var W=this.element,V=this.underlay;if(V){V.style.width=(W.offsetWidth+6)+"px";V.style.height=(W.offsetHeight+1)+"px";}}function P(){C.addClass(this.underlay,"yui-tt-shadow-visible");if(H.ie){this.forceUnderlayRedraw();}}function O(){C.removeClass(this.underlay,"yui-tt-shadow-visible");}function U(){var X=this.underlay,W,V,Z,Y;if(!X){W=this.element;V=YAHOO.widget.Module;Z=H.ie;Y=this;if(!F){F=document.createElement("div");F.className="yui-tt-shadow";}X=F.cloneNode(false);W.appendChild(X);this.underlay=X;this._shadow=this.underlay;P.call(this);this.subscribe("beforeShow",P);this.subscribe("hide",O);if(G){window.setTimeout(function(){T.call(Y);},0);this.cfg.subscribeToConfigEvent("width",T);this.cfg.subscribeToConfigEvent("height",T);this.subscribe("changeContent",T);V.textResizeEvent.subscribe(T,this,true);this.subscribe("destroy",function(){V.textResizeEvent.unsubscribe(T,this);});}}}function Q(){U.call(this);this.unsubscribe("beforeShow",Q);}if(this.cfg.getProperty("visible")){U.call(this);}else{this.subscribe("beforeShow",Q);}},forceUnderlayRedraw:function(){var O=this;C.addClass(O.underlay,"yui-force-redraw");setTimeout(function(){C.removeClass(O.underlay,"yui-force-redraw");},0);},destroy:function(){this._removeEventListeners();J.superclass.destroy.call(this);},toString:function(){return"Tooltip "+this.id;}});}());(function(){YAHOO.widget.Panel=function(V,U){YAHOO.widget.Panel.superclass.constructor.call(this,V,U);};var S=null;var E=YAHOO.lang,F=YAHOO.util,A=F.Dom,T=F.Event,M=F.CustomEvent,K=YAHOO.util.KeyListener,I=F.Config,H=YAHOO.widget.Overlay,O=YAHOO.widget.Panel,L=YAHOO.env.ua,P=(L.ie&&(L.ie<=6||document.compatMode=="BackCompat")),G,Q,C,D={"SHOW_MASK":"showMask","HIDE_MASK":"hideMask","DRAG":"drag"},N={"CLOSE":{key:"close",value:true,validator:E.isBoolean,supercedes:["visible"]},"DRAGGABLE":{key:"draggable",value:(F.DD?true:false),validator:E.isBoolean,supercedes:["visible"]},"DRAG_ONLY":{key:"dragonly",value:false,validator:E.isBoolean,supercedes:["draggable"]},"UNDERLAY":{key:"underlay",value:"shadow",supercedes:["visible"]},"MODAL":{key:"modal",value:false,validator:E.isBoolean,supercedes:["visible","zindex"]},"KEY_LISTENERS":{key:"keylisteners",suppressEvent:true,supercedes:["visible"]},"STRINGS":{key:"strings",supercedes:["close"],validator:E.isObject,value:{close:"Close"}}};O.CSS_PANEL="yui-panel";O.CSS_PANEL_CONTAINER="yui-panel-container";O.FOCUSABLE=["a","button","select","textarea","input","iframe"];function J(V,U){if(!this.header&&this.cfg.getProperty("draggable")){this.setHeader("&#160;");}}function R(V,U,W){var Z=W[0],X=W[1],Y=this.cfg,a=Y.getProperty("width");if(a==X){Y.setProperty("width",Z);}this.unsubscribe("hide",R,W);}function B(V,U){var Y,X,W;if(P){Y=this.cfg;X=Y.getProperty("width");if(!X||X=="auto"){W=(this.element.offsetWidth+"px");Y.setProperty("width",W);this.subscribe("hide",R,[(X||""),W]);}}}YAHOO.extend(O,H,{init:function(V,U){O.superclass.init.call(this,V);this.beforeInitEvent.fire(O);A.addClass(this.element,O.CSS_PANEL);this.buildWrapper();if(U){this.cfg.applyConfig(U,true);}this.subscribe("showMask",this._addFocusHandlers);this.subscribe("hideMask",this._removeFocusHandlers);this.subscribe("beforeRender",J);this.subscribe("render",function(){this.setFirstLastFocusable();this.subscribe("changeContent",this.setFirstLastFocusable);});this.subscribe("show",this.focusFirst);this.initEvent.fire(O);},_onElementFocus:function(Z){if(S===this){var Y=T.getTarget(Z),X=document.documentElement,V=(Y!==X&&Y!==window);if(V&&Y!==this.element&&Y!==this.mask&&!A.isAncestor(this.element,Y)){try{if(this.firstElement){this.firstElement.focus();}else{if(this._modalFocus){this._modalFocus.focus();}else{this.innerElement.focus();}}}catch(W){try{if(V&&Y!==document.body){Y.blur();}}catch(U){}}}}},_addFocusHandlers:function(V,U){if(!this.firstElement){if(L.webkit||L.opera){if(!this._modalFocus){this._createHiddenFocusElement();}}else{this.innerElement.tabIndex=0;}}this.setTabLoop(this.firstElement,this.lastElement);T.onFocus(document.documentElement,this._onElementFocus,this,true);S=this;},_createHiddenFocusElement:function(){var U=document.createElement("button");U.style.height="1px";U.style.width="1px";U.style.position="absolute";U.style.left="-10000em";U.style.opacity=0;U.tabIndex=-1;this.innerElement.appendChild(U);this._modalFocus=U;},_removeFocusHandlers:function(V,U){T.removeFocusListener(document.documentElement,this._onElementFocus,this);if(S==this){S=null;}},focusFirst:function(W,U,Y){var V=this.firstElement;if(U&&U[1]){T.stopEvent(U[1]);}if(V){try{V.focus();}catch(X){}}},focusLast:function(W,U,Y){var V=this.lastElement;
if(U&&U[1]){T.stopEvent(U[1]);}if(V){try{V.focus();}catch(X){}}},setTabLoop:function(X,Z){var V=this.preventBackTab,W=this.preventTabOut,U=this.showEvent,Y=this.hideEvent;if(V){V.disable();U.unsubscribe(V.enable,V);Y.unsubscribe(V.disable,V);V=this.preventBackTab=null;}if(W){W.disable();U.unsubscribe(W.enable,W);Y.unsubscribe(W.disable,W);W=this.preventTabOut=null;}if(X){this.preventBackTab=new K(X,{shift:true,keys:9},{fn:this.focusLast,scope:this,correctScope:true});V=this.preventBackTab;U.subscribe(V.enable,V,true);Y.subscribe(V.disable,V,true);}if(Z){this.preventTabOut=new K(Z,{shift:false,keys:9},{fn:this.focusFirst,scope:this,correctScope:true});W=this.preventTabOut;U.subscribe(W.enable,W,true);Y.subscribe(W.disable,W,true);}},getFocusableElements:function(U){U=U||this.innerElement;var X={};for(var W=0;W<O.FOCUSABLE.length;W++){X[O.FOCUSABLE[W]]=true;}function V(Y){if(Y.focus&&Y.type!=="hidden"&&!Y.disabled&&X[Y.tagName.toLowerCase()]){return true;}return false;}return A.getElementsBy(V,null,U);},setFirstLastFocusable:function(){this.firstElement=null;this.lastElement=null;var U=this.getFocusableElements();this.focusableElements=U;if(U.length>0){this.firstElement=U[0];this.lastElement=U[U.length-1];}if(this.cfg.getProperty("modal")){this.setTabLoop(this.firstElement,this.lastElement);}},initEvents:function(){O.superclass.initEvents.call(this);var U=M.LIST;this.showMaskEvent=this.createEvent(D.SHOW_MASK);this.showMaskEvent.signature=U;this.hideMaskEvent=this.createEvent(D.HIDE_MASK);this.hideMaskEvent.signature=U;this.dragEvent=this.createEvent(D.DRAG);this.dragEvent.signature=U;},initDefaultConfig:function(){O.superclass.initDefaultConfig.call(this);this.cfg.addProperty(N.CLOSE.key,{handler:this.configClose,value:N.CLOSE.value,validator:N.CLOSE.validator,supercedes:N.CLOSE.supercedes});this.cfg.addProperty(N.DRAGGABLE.key,{handler:this.configDraggable,value:(F.DD)?true:false,validator:N.DRAGGABLE.validator,supercedes:N.DRAGGABLE.supercedes});this.cfg.addProperty(N.DRAG_ONLY.key,{value:N.DRAG_ONLY.value,validator:N.DRAG_ONLY.validator,supercedes:N.DRAG_ONLY.supercedes});this.cfg.addProperty(N.UNDERLAY.key,{handler:this.configUnderlay,value:N.UNDERLAY.value,supercedes:N.UNDERLAY.supercedes});this.cfg.addProperty(N.MODAL.key,{handler:this.configModal,value:N.MODAL.value,validator:N.MODAL.validator,supercedes:N.MODAL.supercedes});this.cfg.addProperty(N.KEY_LISTENERS.key,{handler:this.configKeyListeners,suppressEvent:N.KEY_LISTENERS.suppressEvent,supercedes:N.KEY_LISTENERS.supercedes});this.cfg.addProperty(N.STRINGS.key,{value:N.STRINGS.value,handler:this.configStrings,validator:N.STRINGS.validator,supercedes:N.STRINGS.supercedes});},configClose:function(X,V,Y){var Z=V[0],W=this.close,U=this.cfg.getProperty("strings");if(Z){if(!W){if(!C){C=document.createElement("a");C.className="container-close";C.href="#";}W=C.cloneNode(true);this.innerElement.appendChild(W);W.innerHTML=(U&&U.close)?U.close:"&#160;";T.on(W,"click",this._doClose,this,true);this.close=W;}else{W.style.display="block";}}else{if(W){W.style.display="none";}}},_doClose:function(U){T.preventDefault(U);this.hide();},configDraggable:function(V,U,W){var X=U[0];if(X){if(!F.DD){this.cfg.setProperty("draggable",false);return;}if(this.header){A.setStyle(this.header,"cursor","move");this.registerDragDrop();}this.subscribe("beforeShow",B);}else{if(this.dd){this.dd.unreg();}if(this.header){A.setStyle(this.header,"cursor","auto");}this.unsubscribe("beforeShow",B);}},configUnderlay:function(d,c,Z){var b=(this.platform=="mac"&&L.gecko),e=c[0].toLowerCase(),V=this.underlay,W=this.element;function X(){var f=false;if(!V){if(!Q){Q=document.createElement("div");Q.className="underlay";}V=Q.cloneNode(false);this.element.appendChild(V);this.underlay=V;if(P){this.sizeUnderlay();this.cfg.subscribeToConfigEvent("width",this.sizeUnderlay);this.cfg.subscribeToConfigEvent("height",this.sizeUnderlay);this.changeContentEvent.subscribe(this.sizeUnderlay);YAHOO.widget.Module.textResizeEvent.subscribe(this.sizeUnderlay,this,true);}if(L.webkit&&L.webkit<420){this.changeContentEvent.subscribe(this.forceUnderlayRedraw);}f=true;}}function a(){var f=X.call(this);if(!f&&P){this.sizeUnderlay();}this._underlayDeferred=false;this.beforeShowEvent.unsubscribe(a);}function Y(){if(this._underlayDeferred){this.beforeShowEvent.unsubscribe(a);this._underlayDeferred=false;}if(V){this.cfg.unsubscribeFromConfigEvent("width",this.sizeUnderlay);this.cfg.unsubscribeFromConfigEvent("height",this.sizeUnderlay);this.changeContentEvent.unsubscribe(this.sizeUnderlay);this.changeContentEvent.unsubscribe(this.forceUnderlayRedraw);YAHOO.widget.Module.textResizeEvent.unsubscribe(this.sizeUnderlay,this,true);this.element.removeChild(V);this.underlay=null;}}switch(e){case"shadow":A.removeClass(W,"matte");A.addClass(W,"shadow");break;case"matte":if(!b){Y.call(this);}A.removeClass(W,"shadow");A.addClass(W,"matte");break;default:if(!b){Y.call(this);}A.removeClass(W,"shadow");A.removeClass(W,"matte");break;}if((e=="shadow")||(b&&!V)){if(this.cfg.getProperty("visible")){var U=X.call(this);if(!U&&P){this.sizeUnderlay();}}else{if(!this._underlayDeferred){this.beforeShowEvent.subscribe(a);this._underlayDeferred=true;}}}},configModal:function(V,U,X){var W=U[0];if(W){if(!this._hasModalityEventListeners){this.subscribe("beforeShow",this.buildMask);this.subscribe("beforeShow",this.bringToTop);this.subscribe("beforeShow",this.showMask);this.subscribe("hide",this.hideMask);H.windowResizeEvent.subscribe(this.sizeMask,this,true);this._hasModalityEventListeners=true;}}else{if(this._hasModalityEventListeners){if(this.cfg.getProperty("visible")){this.hideMask();this.removeMask();}this.unsubscribe("beforeShow",this.buildMask);this.unsubscribe("beforeShow",this.bringToTop);this.unsubscribe("beforeShow",this.showMask);this.unsubscribe("hide",this.hideMask);H.windowResizeEvent.unsubscribe(this.sizeMask,this);this._hasModalityEventListeners=false;}}},removeMask:function(){var V=this.mask,U;if(V){this.hideMask();U=V.parentNode;
if(U){U.removeChild(V);}this.mask=null;}},configKeyListeners:function(X,U,a){var W=U[0],Z,Y,V;if(W){if(W instanceof Array){Y=W.length;for(V=0;V<Y;V++){Z=W[V];if(!I.alreadySubscribed(this.showEvent,Z.enable,Z)){this.showEvent.subscribe(Z.enable,Z,true);}if(!I.alreadySubscribed(this.hideEvent,Z.disable,Z)){this.hideEvent.subscribe(Z.disable,Z,true);this.destroyEvent.subscribe(Z.disable,Z,true);}}}else{if(!I.alreadySubscribed(this.showEvent,W.enable,W)){this.showEvent.subscribe(W.enable,W,true);}if(!I.alreadySubscribed(this.hideEvent,W.disable,W)){this.hideEvent.subscribe(W.disable,W,true);this.destroyEvent.subscribe(W.disable,W,true);}}}},configStrings:function(V,U,W){var X=E.merge(N.STRINGS.value,U[0]);this.cfg.setProperty(N.STRINGS.key,X,true);},configHeight:function(X,V,Y){var U=V[0],W=this.innerElement;A.setStyle(W,"height",U);this.cfg.refireEvent("iframe");},_autoFillOnHeightChange:function(X,V,W){O.superclass._autoFillOnHeightChange.apply(this,arguments);if(P){var U=this;setTimeout(function(){U.sizeUnderlay();},0);}},configWidth:function(X,U,Y){var W=U[0],V=this.innerElement;A.setStyle(V,"width",W);this.cfg.refireEvent("iframe");},configzIndex:function(V,U,X){O.superclass.configzIndex.call(this,V,U,X);if(this.mask||this.cfg.getProperty("modal")===true){var W=A.getStyle(this.element,"zIndex");if(!W||isNaN(W)){W=0;}if(W===0){this.cfg.setProperty("zIndex",1);}else{this.stackMask();}}},buildWrapper:function(){var W=this.element.parentNode,U=this.element,V=document.createElement("div");V.className=O.CSS_PANEL_CONTAINER;V.id=U.id+"_c";if(W){W.insertBefore(V,U);}V.appendChild(U);this.element=V;this.innerElement=U;A.setStyle(this.innerElement,"visibility","inherit");},sizeUnderlay:function(){var V=this.underlay,U;if(V){U=this.element;V.style.width=U.offsetWidth+"px";V.style.height=U.offsetHeight+"px";}},registerDragDrop:function(){var V=this;if(this.header){if(!F.DD){return;}var U=(this.cfg.getProperty("dragonly")===true);this.dd=new F.DD(this.element.id,this.id,{dragOnly:U});if(!this.header.id){this.header.id=this.id+"_h";}this.dd.startDrag=function(){var X,Z,W,c,b,a;if(YAHOO.env.ua.ie==6){A.addClass(V.element,"drag");}if(V.cfg.getProperty("constraintoviewport")){var Y=H.VIEWPORT_OFFSET;X=V.element.offsetHeight;Z=V.element.offsetWidth;W=A.getViewportWidth();c=A.getViewportHeight();b=A.getDocumentScrollLeft();a=A.getDocumentScrollTop();if(X+Y<c){this.minY=a+Y;this.maxY=a+c-X-Y;}else{this.minY=a+Y;this.maxY=a+Y;}if(Z+Y<W){this.minX=b+Y;this.maxX=b+W-Z-Y;}else{this.minX=b+Y;this.maxX=b+Y;}this.constrainX=true;this.constrainY=true;}else{this.constrainX=false;this.constrainY=false;}V.dragEvent.fire("startDrag",arguments);};this.dd.onDrag=function(){V.syncPosition();V.cfg.refireEvent("iframe");if(this.platform=="mac"&&YAHOO.env.ua.gecko){this.showMacGeckoScrollbars();}V.dragEvent.fire("onDrag",arguments);};this.dd.endDrag=function(){if(YAHOO.env.ua.ie==6){A.removeClass(V.element,"drag");}V.dragEvent.fire("endDrag",arguments);V.moveEvent.fire(V.cfg.getProperty("xy"));};this.dd.setHandleElId(this.header.id);this.dd.addInvalidHandleType("INPUT");this.dd.addInvalidHandleType("SELECT");this.dd.addInvalidHandleType("TEXTAREA");}},buildMask:function(){var U=this.mask;if(!U){if(!G){G=document.createElement("div");G.className="mask";G.innerHTML="&#160;";}U=G.cloneNode(true);U.id=this.id+"_mask";document.body.insertBefore(U,document.body.firstChild);this.mask=U;if(YAHOO.env.ua.gecko&&this.platform=="mac"){A.addClass(this.mask,"block-scrollbars");}this.stackMask();}},hideMask:function(){if(this.cfg.getProperty("modal")&&this.mask){this.mask.style.display="none";A.removeClass(document.body,"masked");this.hideMaskEvent.fire();}},showMask:function(){if(this.cfg.getProperty("modal")&&this.mask){A.addClass(document.body,"masked");this.sizeMask();this.mask.style.display="block";this.showMaskEvent.fire();}},sizeMask:function(){if(this.mask){var V=this.mask,W=A.getViewportWidth(),U=A.getViewportHeight();if(V.offsetHeight>U){V.style.height=U+"px";}if(V.offsetWidth>W){V.style.width=W+"px";}V.style.height=A.getDocumentHeight()+"px";V.style.width=A.getDocumentWidth()+"px";}},stackMask:function(){if(this.mask){var U=A.getStyle(this.element,"zIndex");if(!YAHOO.lang.isUndefined(U)&&!isNaN(U)){A.setStyle(this.mask,"zIndex",U-1);}}},render:function(U){return O.superclass.render.call(this,U,this.innerElement);},_renderHeader:function(U){U=U||this.innerElement;O.superclass._renderHeader.call(this,U);},_renderBody:function(U){U=U||this.innerElement;O.superclass._renderBody.call(this,U);},_renderFooter:function(U){U=U||this.innerElement;O.superclass._renderFooter.call(this,U);},destroy:function(){H.windowResizeEvent.unsubscribe(this.sizeMask,this);this.removeMask();if(this.close){T.purgeElement(this.close);}O.superclass.destroy.call(this);},forceUnderlayRedraw:function(){var U=this.underlay;A.addClass(U,"yui-force-redraw");setTimeout(function(){A.removeClass(U,"yui-force-redraw");},0);},toString:function(){return"Panel "+this.id;}});}());(function(){YAHOO.widget.Dialog=function(J,I){YAHOO.widget.Dialog.superclass.constructor.call(this,J,I);};var B=YAHOO.util.Event,G=YAHOO.util.CustomEvent,E=YAHOO.util.Dom,A=YAHOO.widget.Dialog,F=YAHOO.lang,H={"BEFORE_SUBMIT":"beforeSubmit","SUBMIT":"submit","MANUAL_SUBMIT":"manualSubmit","ASYNC_SUBMIT":"asyncSubmit","FORM_SUBMIT":"formSubmit","CANCEL":"cancel"},C={"POST_METHOD":{key:"postmethod",value:"async"},"POST_DATA":{key:"postdata",value:null},"BUTTONS":{key:"buttons",value:"none",supercedes:["visible"]},"HIDEAFTERSUBMIT":{key:"hideaftersubmit",value:true}};A.CSS_DIALOG="yui-dialog";function D(){var L=this._aButtons,J,K,I;if(F.isArray(L)){J=L.length;if(J>0){I=J-1;do{K=L[I];if(YAHOO.widget.Button&&K instanceof YAHOO.widget.Button){K.destroy();}else{if(K.tagName.toUpperCase()=="BUTTON"){B.purgeElement(K);B.purgeElement(K,false);}}}while(I--);}}}YAHOO.extend(A,YAHOO.widget.Panel,{form:null,initDefaultConfig:function(){A.superclass.initDefaultConfig.call(this);this.callback={success:null,failure:null,argument:null};
this.cfg.addProperty(C.POST_METHOD.key,{handler:this.configPostMethod,value:C.POST_METHOD.value,validator:function(I){if(I!="form"&&I!="async"&&I!="none"&&I!="manual"){return false;}else{return true;}}});this.cfg.addProperty(C.POST_DATA.key,{value:C.POST_DATA.value});this.cfg.addProperty(C.HIDEAFTERSUBMIT.key,{value:C.HIDEAFTERSUBMIT.value});this.cfg.addProperty(C.BUTTONS.key,{handler:this.configButtons,value:C.BUTTONS.value,supercedes:C.BUTTONS.supercedes});},initEvents:function(){A.superclass.initEvents.call(this);var I=G.LIST;this.beforeSubmitEvent=this.createEvent(H.BEFORE_SUBMIT);this.beforeSubmitEvent.signature=I;this.submitEvent=this.createEvent(H.SUBMIT);this.submitEvent.signature=I;this.manualSubmitEvent=this.createEvent(H.MANUAL_SUBMIT);this.manualSubmitEvent.signature=I;this.asyncSubmitEvent=this.createEvent(H.ASYNC_SUBMIT);this.asyncSubmitEvent.signature=I;this.formSubmitEvent=this.createEvent(H.FORM_SUBMIT);this.formSubmitEvent.signature=I;this.cancelEvent=this.createEvent(H.CANCEL);this.cancelEvent.signature=I;},init:function(J,I){A.superclass.init.call(this,J);this.beforeInitEvent.fire(A);E.addClass(this.element,A.CSS_DIALOG);this.cfg.setProperty("visible",false);if(I){this.cfg.applyConfig(I,true);}this.showEvent.subscribe(this.focusFirst,this,true);this.beforeHideEvent.subscribe(this.blurButtons,this,true);this.subscribe("changeBody",this.registerForm);this.initEvent.fire(A);},doSubmit:function(){var P=YAHOO.util.Connect,Q=this.form,K=false,N=false,R,M,L,I;switch(this.cfg.getProperty("postmethod")){case"async":R=Q.elements;M=R.length;if(M>0){L=M-1;do{if(R[L].type=="file"){K=true;break;}}while(L--);}if(K&&YAHOO.env.ua.ie&&this.isSecure){N=true;}I=this._getFormAttributes(Q);P.setForm(Q,K,N);var J=this.cfg.getProperty("postdata");var O=P.asyncRequest(I.method,I.action,this.callback,J);this.asyncSubmitEvent.fire(O);break;case"form":Q.submit();this.formSubmitEvent.fire();break;case"none":case"manual":this.manualSubmitEvent.fire();break;}},_getFormAttributes:function(K){var I={method:null,action:null};if(K){if(K.getAttributeNode){var J=K.getAttributeNode("action");var L=K.getAttributeNode("method");if(J){I.action=J.value;}if(L){I.method=L.value;}}else{I.action=K.getAttribute("action");I.method=K.getAttribute("method");}}I.method=(F.isString(I.method)?I.method:"POST").toUpperCase();I.action=F.isString(I.action)?I.action:"";return I;},registerForm:function(){var I=this.element.getElementsByTagName("form")[0];if(this.form){if(this.form==I&&E.isAncestor(this.element,this.form)){return;}else{B.purgeElement(this.form);this.form=null;}}if(!I){I=document.createElement("form");I.name="frm_"+this.id;this.body.appendChild(I);}if(I){this.form=I;B.on(I,"submit",this._submitHandler,this,true);}},_submitHandler:function(I){B.stopEvent(I);this.submit();this.form.blur();},setTabLoop:function(I,J){I=I||this.firstButton;J=this.lastButton||J;A.superclass.setTabLoop.call(this,I,J);},setFirstLastFocusable:function(){A.superclass.setFirstLastFocusable.call(this);var J,I,K,L=this.focusableElements;this.firstFormElement=null;this.lastFormElement=null;if(this.form&&L&&L.length>0){I=L.length;for(J=0;J<I;++J){K=L[J];if(this.form===K.form){this.firstFormElement=K;break;}}for(J=I-1;J>=0;--J){K=L[J];if(this.form===K.form){this.lastFormElement=K;break;}}}},configClose:function(J,I,K){A.superclass.configClose.apply(this,arguments);},_doClose:function(I){B.preventDefault(I);this.cancel();},configButtons:function(S,R,M){var N=YAHOO.widget.Button,U=R[0],K=this.innerElement,T,P,J,Q,O,I,L;D.call(this);this._aButtons=null;if(F.isArray(U)){O=document.createElement("span");O.className="button-group";Q=U.length;this._aButtons=[];this.defaultHtmlButton=null;for(L=0;L<Q;L++){T=U[L];if(N){J=new N({label:T.text});J.appendTo(O);P=J.get("element");if(T.isDefault){J.addClass("default");this.defaultHtmlButton=P;}if(F.isFunction(T.handler)){J.set("onclick",{fn:T.handler,obj:this,scope:this});}else{if(F.isObject(T.handler)&&F.isFunction(T.handler.fn)){J.set("onclick",{fn:T.handler.fn,obj:((!F.isUndefined(T.handler.obj))?T.handler.obj:this),scope:(T.handler.scope||this)});}}this._aButtons[this._aButtons.length]=J;}else{P=document.createElement("button");P.setAttribute("type","button");if(T.isDefault){P.className="default";this.defaultHtmlButton=P;}P.innerHTML=T.text;if(F.isFunction(T.handler)){B.on(P,"click",T.handler,this,true);}else{if(F.isObject(T.handler)&&F.isFunction(T.handler.fn)){B.on(P,"click",T.handler.fn,((!F.isUndefined(T.handler.obj))?T.handler.obj:this),(T.handler.scope||this));}}O.appendChild(P);this._aButtons[this._aButtons.length]=P;}T.htmlButton=P;if(L===0){this.firstButton=P;}if(L==(Q-1)){this.lastButton=P;}}this.setFooter(O);I=this.footer;if(E.inDocument(this.element)&&!E.isAncestor(K,I)){K.appendChild(I);}this.buttonSpan=O;}else{O=this.buttonSpan;I=this.footer;if(O&&I){I.removeChild(O);this.buttonSpan=null;this.firstButton=null;this.lastButton=null;this.defaultHtmlButton=null;}}this.changeContentEvent.fire();},getButtons:function(){return this._aButtons||null;},focusFirst:function(K,I,M){var J=this.firstFormElement;if(I&&I[1]){B.stopEvent(I[1]);}if(J){try{J.focus();}catch(L){}}else{if(this.defaultHtmlButton){this.focusDefaultButton();}else{this.focusFirstButton();}}},focusLast:function(K,I,M){var N=this.cfg.getProperty("buttons"),J=this.lastFormElement;if(I&&I[1]){B.stopEvent(I[1]);}if(N&&F.isArray(N)){this.focusLastButton();}else{if(J){try{J.focus();}catch(L){}}}},_getButton:function(J){var I=YAHOO.widget.Button;if(I&&J&&J.nodeName&&J.id){J=I.getButton(J.id)||J;}return J;},focusDefaultButton:function(){var I=this._getButton(this.defaultHtmlButton);if(I){try{I.focus();}catch(J){}}},blurButtons:function(){var N=this.cfg.getProperty("buttons"),K,M,J,I;if(N&&F.isArray(N)){K=N.length;if(K>0){I=(K-1);do{M=N[I];if(M){J=this._getButton(M.htmlButton);if(J){try{J.blur();}catch(L){}}}}while(I--);}}},focusFirstButton:function(){var L=this.cfg.getProperty("buttons"),K,I;if(L&&F.isArray(L)){K=L[0];if(K){I=this._getButton(K.htmlButton);
if(I){try{I.focus();}catch(J){}}}}},focusLastButton:function(){var M=this.cfg.getProperty("buttons"),J,L,I;if(M&&F.isArray(M)){J=M.length;if(J>0){L=M[(J-1)];if(L){I=this._getButton(L.htmlButton);if(I){try{I.focus();}catch(K){}}}}}},configPostMethod:function(J,I,K){this.registerForm();},validate:function(){return true;},submit:function(){if(this.validate()){if(this.beforeSubmitEvent.fire()){this.doSubmit();this.submitEvent.fire();if(this.cfg.getProperty("hideaftersubmit")){this.hide();}return true;}else{return false;}}else{return false;}},cancel:function(){this.cancelEvent.fire();this.hide();},getData:function(){var Y=this.form,J,R,U,L,S,P,O,I,V,K,W,Z,N,a,M,X,T;function Q(c){var b=c.tagName.toUpperCase();return((b=="INPUT"||b=="TEXTAREA"||b=="SELECT")&&c.name==L);}if(Y){J=Y.elements;R=J.length;U={};for(X=0;X<R;X++){L=J[X].name;S=E.getElementsBy(Q,"*",Y);P=S.length;if(P>0){if(P==1){S=S[0];O=S.type;I=S.tagName.toUpperCase();switch(I){case"INPUT":if(O=="checkbox"){U[L]=S.checked;}else{if(O!="radio"){U[L]=S.value;}}break;case"TEXTAREA":U[L]=S.value;break;case"SELECT":V=S.options;K=V.length;W=[];for(T=0;T<K;T++){Z=V[T];if(Z.selected){M=Z.attributes.value;W[W.length]=(M&&M.specified)?Z.value:Z.text;}}U[L]=W;break;}}else{O=S[0].type;switch(O){case"radio":for(T=0;T<P;T++){N=S[T];if(N.checked){U[L]=N.value;break;}}break;case"checkbox":W=[];for(T=0;T<P;T++){a=S[T];if(a.checked){W[W.length]=a.value;}}U[L]=W;break;}}}}}return U;},destroy:function(){D.call(this);this._aButtons=null;var I=this.element.getElementsByTagName("form"),J;if(I.length>0){J=I[0];if(J){B.purgeElement(J);if(J.parentNode){J.parentNode.removeChild(J);}this.form=null;}}A.superclass.destroy.call(this);},toString:function(){return"Dialog "+this.id;}});}());(function(){YAHOO.widget.SimpleDialog=function(E,D){YAHOO.widget.SimpleDialog.superclass.constructor.call(this,E,D);};var C=YAHOO.util.Dom,B=YAHOO.widget.SimpleDialog,A={"ICON":{key:"icon",value:"none",suppressEvent:true},"TEXT":{key:"text",value:"",suppressEvent:true,supercedes:["icon"]}};B.ICON_BLOCK="blckicon";B.ICON_ALARM="alrticon";B.ICON_HELP="hlpicon";B.ICON_INFO="infoicon";B.ICON_WARN="warnicon";B.ICON_TIP="tipicon";B.ICON_CSS_CLASSNAME="yui-icon";B.CSS_SIMPLEDIALOG="yui-simple-dialog";YAHOO.extend(B,YAHOO.widget.Dialog,{initDefaultConfig:function(){B.superclass.initDefaultConfig.call(this);this.cfg.addProperty(A.ICON.key,{handler:this.configIcon,value:A.ICON.value,suppressEvent:A.ICON.suppressEvent});this.cfg.addProperty(A.TEXT.key,{handler:this.configText,value:A.TEXT.value,suppressEvent:A.TEXT.suppressEvent,supercedes:A.TEXT.supercedes});},init:function(E,D){B.superclass.init.call(this,E);this.beforeInitEvent.fire(B);C.addClass(this.element,B.CSS_SIMPLEDIALOG);this.cfg.queueProperty("postmethod","manual");if(D){this.cfg.applyConfig(D,true);}this.beforeRenderEvent.subscribe(function(){if(!this.body){this.setBody("");}},this,true);this.initEvent.fire(B);},registerForm:function(){B.superclass.registerForm.call(this);this.form.innerHTML+='<input type="hidden" name="'+this.id+'" value=""/>';},configIcon:function(K,J,H){var D=J[0],E=this.body,F=B.ICON_CSS_CLASSNAME,L,I,G;if(D&&D!="none"){L=C.getElementsByClassName(F,"*",E);if(L.length===1){I=L[0];G=I.parentNode;if(G){G.removeChild(I);I=null;}}if(D.indexOf(".")==-1){I=document.createElement("span");I.className=(F+" "+D);I.innerHTML="&#160;";}else{I=document.createElement("img");I.src=(this.imageRoot+D);I.className=F;}if(I){E.insertBefore(I,E.firstChild);}}},configText:function(E,D,F){var G=D[0];if(G){this.setBody(G);this.cfg.refireEvent("icon");}},toString:function(){return"SimpleDialog "+this.id;}});}());(function(){YAHOO.widget.ContainerEffect=function(E,H,G,D,F){if(!F){F=YAHOO.util.Anim;}this.overlay=E;this.attrIn=H;this.attrOut=G;this.targetElement=D||E.element;this.animClass=F;};var B=YAHOO.util.Dom,C=YAHOO.util.CustomEvent,A=YAHOO.widget.ContainerEffect;A.FADE=function(D,F){var G=YAHOO.util.Easing,I={attributes:{opacity:{from:0,to:1}},duration:F,method:G.easeIn},E={attributes:{opacity:{to:0}},duration:F,method:G.easeOut},H=new A(D,I,E,D.element);H.handleUnderlayStart=function(){var K=this.overlay.underlay;if(K&&YAHOO.env.ua.ie){var J=(K.filters&&K.filters.length>0);if(J){B.addClass(D.element,"yui-effect-fade");}}};H.handleUnderlayComplete=function(){var J=this.overlay.underlay;if(J&&YAHOO.env.ua.ie){B.removeClass(D.element,"yui-effect-fade");}};H.handleStartAnimateIn=function(K,J,L){B.addClass(L.overlay.element,"hide-select");if(!L.overlay.underlay){L.overlay.cfg.refireEvent("underlay");}L.handleUnderlayStart();L.overlay._setDomVisibility(true);B.setStyle(L.overlay.element,"opacity",0);};H.handleCompleteAnimateIn=function(K,J,L){B.removeClass(L.overlay.element,"hide-select");if(L.overlay.element.style.filter){L.overlay.element.style.filter=null;}L.handleUnderlayComplete();L.overlay.cfg.refireEvent("iframe");L.animateInCompleteEvent.fire();};H.handleStartAnimateOut=function(K,J,L){B.addClass(L.overlay.element,"hide-select");L.handleUnderlayStart();};H.handleCompleteAnimateOut=function(K,J,L){B.removeClass(L.overlay.element,"hide-select");if(L.overlay.element.style.filter){L.overlay.element.style.filter=null;}L.overlay._setDomVisibility(false);B.setStyle(L.overlay.element,"opacity",1);L.handleUnderlayComplete();L.overlay.cfg.refireEvent("iframe");L.animateOutCompleteEvent.fire();};H.init();return H;};A.SLIDE=function(F,D){var I=YAHOO.util.Easing,L=F.cfg.getProperty("x")||B.getX(F.element),K=F.cfg.getProperty("y")||B.getY(F.element),M=B.getClientWidth(),H=F.element.offsetWidth,J={attributes:{points:{to:[L,K]}},duration:D,method:I.easeIn},E={attributes:{points:{to:[(M+25),K]}},duration:D,method:I.easeOut},G=new A(F,J,E,F.element,YAHOO.util.Motion);G.handleStartAnimateIn=function(O,N,P){P.overlay.element.style.left=((-25)-H)+"px";P.overlay.element.style.top=K+"px";};G.handleTweenAnimateIn=function(Q,P,R){var S=B.getXY(R.overlay.element),O=S[0],N=S[1];if(B.getStyle(R.overlay.element,"visibility")=="hidden"&&O<L){R.overlay._setDomVisibility(true);
}R.overlay.cfg.setProperty("xy",[O,N],true);R.overlay.cfg.refireEvent("iframe");};G.handleCompleteAnimateIn=function(O,N,P){P.overlay.cfg.setProperty("xy",[L,K],true);P.startX=L;P.startY=K;P.overlay.cfg.refireEvent("iframe");P.animateInCompleteEvent.fire();};G.handleStartAnimateOut=function(O,N,R){var P=B.getViewportWidth(),S=B.getXY(R.overlay.element),Q=S[1];R.animOut.attributes.points.to=[(P+25),Q];};G.handleTweenAnimateOut=function(P,O,Q){var S=B.getXY(Q.overlay.element),N=S[0],R=S[1];Q.overlay.cfg.setProperty("xy",[N,R],true);Q.overlay.cfg.refireEvent("iframe");};G.handleCompleteAnimateOut=function(O,N,P){P.overlay._setDomVisibility(false);P.overlay.cfg.setProperty("xy",[L,K]);P.animateOutCompleteEvent.fire();};G.init();return G;};A.prototype={init:function(){this.beforeAnimateInEvent=this.createEvent("beforeAnimateIn");this.beforeAnimateInEvent.signature=C.LIST;this.beforeAnimateOutEvent=this.createEvent("beforeAnimateOut");this.beforeAnimateOutEvent.signature=C.LIST;this.animateInCompleteEvent=this.createEvent("animateInComplete");this.animateInCompleteEvent.signature=C.LIST;this.animateOutCompleteEvent=this.createEvent("animateOutComplete");this.animateOutCompleteEvent.signature=C.LIST;this.animIn=new this.animClass(this.targetElement,this.attrIn.attributes,this.attrIn.duration,this.attrIn.method);this.animIn.onStart.subscribe(this.handleStartAnimateIn,this);this.animIn.onTween.subscribe(this.handleTweenAnimateIn,this);this.animIn.onComplete.subscribe(this.handleCompleteAnimateIn,this);this.animOut=new this.animClass(this.targetElement,this.attrOut.attributes,this.attrOut.duration,this.attrOut.method);this.animOut.onStart.subscribe(this.handleStartAnimateOut,this);this.animOut.onTween.subscribe(this.handleTweenAnimateOut,this);this.animOut.onComplete.subscribe(this.handleCompleteAnimateOut,this);},animateIn:function(){this.beforeAnimateInEvent.fire();this.animIn.animate();},animateOut:function(){this.beforeAnimateOutEvent.fire();this.animOut.animate();},handleStartAnimateIn:function(E,D,F){},handleTweenAnimateIn:function(E,D,F){},handleCompleteAnimateIn:function(E,D,F){},handleStartAnimateOut:function(E,D,F){},handleTweenAnimateOut:function(E,D,F){},handleCompleteAnimateOut:function(E,D,F){},toString:function(){var D="ContainerEffect";if(this.overlay){D+=" ["+this.overlay.toString()+"]";}return D;}};YAHOO.lang.augmentProto(A,YAHOO.util.EventProvider);})();YAHOO.register("container",YAHOO.widget.Module,{version:"2.8.1",build:"19"});

/* SOURCE FILE: containerariaplugin-min.js (efd4cacb) 9/9/2014 2:08:59 PM */

(function(){var S=YAHOO.util.Event,U=YAHOO.util.Dom,al=YAHOO.lang,G=YAHOO.env.ua,e=YAHOO.widget.Panel,I=YAHOO.widget.Tooltip,an=YAHOO.widget.SimpleDialog,g=YAHOO.widget.Module.prototype,aj=g.initDefaultConfig,Y=g._initResizeMonitor,h=YAHOO.widget.Overlay.prototype,L=h.showIframe,aa,a,l,c,O=false,z,R,b=false,ab={},ad={},v="aria-",ak="role",W="presentation",K="usearia",N="blur",ah="focus",D="visible",y="beforeHide",x="alertdialog",Q="dialog",B="describedby",ac="context",k="hidden",j="container-close",t="a",X="href",o="button",am="keydown",n="beforeShow",ag="close",A="labelledby",w="xy",H="tooltip",V="destroy";var q=function(ao,ap){ao.setAttribute(ak,ap)};var s=function(ao,aq,ap){ao.setAttribute((v+aq),ap)};al.augmentObject(g,{_initResizeMonitor:function(){Y.call(this);var ao=this.resizeMonitor;if(ao){q(ao,W);s(ao,k,true);ao.tabIndex=-1}},configUseARIA:function(ap,ao){},configDescribedBy:function(aq,ap){var ao=ap[0];if(this.cfg.getProperty(K)&&ao){s(this.element,B,ao)}},configLabelledBy:function(aq,ap){var ao=ap[0];if(this.cfg.getProperty(K)&&ao){s(this.element,A,ao)}},initDefaultConfig:function(){this.cfg.addProperty(K,{handler:this.configUseARIA,value:(G.gecko&&G.gecko>=1.9)||(G.ie&&G.ie>=8),validator:al.isBoolean});this.cfg.addProperty(A,{handler:this.configLabelledBy,validator:al.isString});this.cfg.addProperty(B,{handler:this.configDescribedBy,validator:al.isString});aj.call(this)}},"initDefaultConfig","configUseARIA","configLabelledBy","configDescribedBy","_initResizeMonitor");h.showIframe=function(){L.call(this);var ao=this.iframe;if(this.cfg.getProperty(K)&&ao&&!ao.getAttribute(ak)){q(ao,W);ao.tabIndex=-1}};var i=function(ap){var ao=S.getCharCode(ap);if(ao===27){if(this.cancel){this.cancel()}else{this.hide()}}};var p=function(ao){this.fireEvent(ah,ao)};var af=function(ao){this.fireEvent(N,ao)};var ai=function(aq,ap){var ao=ap[0];if(R._manageFocus(this)){if(this.cfg.getProperty(D)&&this.focusFirst){if(!ao){this.focusFirst()}}}};var d=function(aq,ap){var ao=ap[0];if(R._manageBlur(this)&&!ao){this.fireEvent(N)}};var F=function(aq,ao,ap){this.blur();if(ap&&ap.focus){try{ap.focus()}catch(ar){}}this.unsubscribe(aq,F,ap)};var r=function(){var ao=(this.cfg.getProperty("modal")===true)?"hideMask":y;this.subscribe(ao,F,z)};var f=function(){s(this.innerElement,k,!this.cfg.getProperty(D))};var u=function(){U.getElementsByClassName(j,t,this.element,function(ao){ao.removeAttribute(X);q(ao,o);ao.tabIndex=0})};var Z=function(ap,ao){var aq=ao[0];if(aq){u.call(this)}};if(e){aa=e.prototype;a=aa.initDefaultConfig;al.augmentObject(aa,{hasFocus:function(){return(R&&this===R.getActive())},configUseARIA:function(aq,ap){var ao=ap[0];if(ao){if(!R){R=new YAHOO.widget.OverlayManager()}R.register(this);this.focus=function(){if(!this.hasFocus()){this.fireEvent(ah)}};this.blur=function(){if(this.hasFocus()){this.fireEvent(N)}};S.onFocus(this.element,p,null,this);S.onBlur(this.element,af,null,this);this.subscribe(ah,ai);this.subscribe(N,d);S.on(this.element,am,i,null,this);this.subscribe(n,r);f.call(this);this.cfg.subscribeToConfigEvent(D,f);this.cfg.subscribeToConfigEvent(ag,Z);if(!O){S.onFocus(document,function(ar){z=S.getTarget(ar)});O=true}}},configDescribedBy:function(aq,ap){var ao=ap[0];if(this.cfg.getProperty(K)&&ao){s(this.innerElement,B,ao)}},configLabelledBy:function(aq,ap){var ao=ap[0];if(this.cfg.getProperty(K)&&ao){s(this.innerElement,A,ao)}},configRole:function(au,ar){var at=ar[0],aq,ap,ao;if(at){switch(at){case x:aq=this.body;if(aq){ao=aq.id||U.generateId(aq);this.cfg.setProperty(B,ao)}break;case Q:ap=this.header;if(ap){ao=ap.id||U.generateId(ap);this.cfg.setProperty(A,ao)}break}q(this.innerElement,at);u.call(this)}},initDefaultConfig:function(){a.call(this);this.cfg.addProperty(ak,{handler:this.configRole,value:Q,validator:al.isString})}},"initDefaultConfig","configRole","configUseARIA","configLabelledBy","configDescribedBy","hasFocus")}if(an){l=an.prototype;c=l.configIcon;l.configIcon=function(ap,ao,at){c.apply(this,arguments);var au=ao[0],ar=an.ICON_CSS_CLASSNAME,aq;if(au&&au!="none"){aq=U.getElementsByClassName(ar,"*",this.body);if(aq){q(aq[0],W)}}}}var m=function(aq){var ao=S.getTarget(aq),ar=ad[ao.id],ap;if(ar){ap=U.getXY(ao);ar.cfg.setProperty(w,[ap[0],(ap[1]+ao.offsetHeight+5)]);ar.show()}};var J=function(ap){var ao=S.getTarget(ap),aq=ad[ao.id];if(aq&&aq.cfg.getProperty(D)){aq.hide()}};var T=function(ap){var ao=ap.id,aq=ad[ao];if(aq===this){delete ad[ao];ap.removeAttribute(B)}};var E=function(){var ap=(this.element)?this.element.id:this.id,ao=ab[ap];U.batch(ao,T,this,true);ab[ap]=null};var M=function(ap){var ao=ap.id||U.generateId(ap);ad[ao]=this;s(ap,B,this.element.id)};var C=function(){var ao=this.cfg.getProperty(ac);U.batch(ao,M,this,true);ab[this.element.id]=ao};var P=function(aq,ao){E.call(this);var ap=ao[0];if(ap){C.call(this)}};var ae=function(){s(this.body,k,!this.cfg.getProperty(D))};if(I){I.prototype.configUseARIA=function(aq,ap){var ao=ap[0];if(ao){q(this.body,H);this.cfg.subscribeToConfigEvent(ac,P);ae.call(this);this.cfg.subscribeToConfigEvent(D,ae);this.subscribe(V,E);if(!b){S.onFocus(document,m);S.onBlur(document,J);b=true}}}}}());YAHOO.register("containerariaplugin",YAHOO.widget.Module,{version:"@VERSION@",build:"@BUILD@"});

/* SOURCE FILE: event-simulate-min.js (1fbc8fcf) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
YAHOO.util.UserAction={simulateKeyEvent:function(f,j,e,c,l,b,a,k,h,n,m){f=YAHOO.util.Dom.get(f);if(!f){throw new Error("simulateKeyEvent(): Invalid target.");}if(YAHOO.lang.isString(j)){j=j.toLowerCase();switch(j){case"keyup":case"keydown":case"keypress":break;case"textevent":j="keypress";break;default:throw new Error("simulateKeyEvent(): Event type '"+j+"' not supported.");}}else{throw new Error("simulateKeyEvent(): Event type must be a string.");}if(!YAHOO.lang.isBoolean(e)){e=true;}if(!YAHOO.lang.isBoolean(c)){c=true;}if(!YAHOO.lang.isObject(l)){l=window;}if(!YAHOO.lang.isBoolean(b)){b=false;}if(!YAHOO.lang.isBoolean(a)){a=false;}if(!YAHOO.lang.isBoolean(k)){k=false;}if(!YAHOO.lang.isBoolean(h)){h=false;}if(!YAHOO.lang.isNumber(n)){n=0;}if(!YAHOO.lang.isNumber(m)){m=0;}var i=null;if(YAHOO.lang.isFunction(document.createEvent)){try{i=document.createEvent("KeyEvents");i.initKeyEvent(j,e,c,l,b,a,k,h,n,m);}catch(g){try{i=document.createEvent("Events");}catch(d){i=document.createEvent("UIEvents");}finally{i.initEvent(j,e,c);i.view=l;i.altKey=a;i.ctrlKey=b;i.shiftKey=k;i.metaKey=h;i.keyCode=n;i.charCode=m;}}f.dispatchEvent(i);}else{if(YAHOO.lang.isObject(document.createEventObject)){i=document.createEventObject();i.bubbles=e;i.cancelable=c;i.view=l;i.ctrlKey=b;i.altKey=a;i.shiftKey=k;i.metaKey=h;i.keyCode=(m>0)?m:n;f.fireEvent("on"+j,i);}else{throw new Error("simulateKeyEvent(): No event simulation framework present.");}}},simulateMouseEvent:function(k,p,h,e,q,j,g,f,d,b,c,a,o,m,i,l){k=YAHOO.util.Dom.get(k);if(!k){throw new Error("simulateMouseEvent(): Invalid target.");}l=l||null;if(YAHOO.lang.isString(p)){p=p.toLowerCase();switch(p){case"mouseover":case"mouseout":case"mousedown":case"mouseup":case"click":case"dblclick":case"mousemove":break;default:throw new Error("simulateMouseEvent(): Event type '"+p+"' not supported.");}}else{throw new Error("simulateMouseEvent(): Event type must be a string.");}if(!YAHOO.lang.isBoolean(h)){h=true;}if(!YAHOO.lang.isBoolean(e)){e=(p!="mousemove");}if(!YAHOO.lang.isObject(q)){q=window;}if(!YAHOO.lang.isNumber(j)){j=1;}if(!YAHOO.lang.isNumber(g)){g=0;}if(!YAHOO.lang.isNumber(f)){f=0;}if(!YAHOO.lang.isNumber(d)){d=0;}if(!YAHOO.lang.isNumber(b)){b=0;}if(!YAHOO.lang.isBoolean(c)){c=false;}if(!YAHOO.lang.isBoolean(a)){a=false;}if(!YAHOO.lang.isBoolean(o)){o=false;}if(!YAHOO.lang.isBoolean(m)){m=false;}if(!YAHOO.lang.isNumber(i)){i=0;}var n=null;if(YAHOO.lang.isFunction(document.createEvent)){n=document.createEvent("MouseEvents");if(n.initMouseEvent){n.initMouseEvent(p,h,e,q,j,g,f,d,b,c,a,o,m,i,l);}else{n=document.createEvent("UIEvents");n.initEvent(p,h,e);n.view=q;n.detail=j;n.screenX=g;n.screenY=f;n.clientX=d;n.clientY=b;n.ctrlKey=c;n.altKey=a;n.metaKey=m;n.shiftKey=o;n.button=i;n.relatedTarget=l;}if(l&&!n.relatedTarget){if(p=="mouseout"){n.toElement=l;}else{if(p=="mouseover"){n.fromElement=l;}}}k.dispatchEvent(n);}else{if(YAHOO.lang.isObject(document.createEventObject)){n=document.createEventObject();n.bubbles=h;n.cancelable=e;n.view=q;n.detail=j;n.screenX=g;n.screenY=f;n.clientX=d;n.clientY=b;n.ctrlKey=c;n.altKey=a;n.metaKey=m;n.shiftKey=o;switch(i){case 0:n.button=1;break;case 1:n.button=4;break;case 2:break;default:n.button=0;}n.relatedTarget=l;k.fireEvent("on"+p,n);}else{throw new Error("simulateMouseEvent(): No event simulation framework present.");}}},fireMouseEvent:function(c,b,a){a=a||{};this.simulateMouseEvent(c,b,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget);},click:function(b,a){this.fireMouseEvent(b,"click",a);},dblclick:function(b,a){this.fireMouseEvent(b,"dblclick",a);},mousedown:function(b,a){this.fireMouseEvent(b,"mousedown",a);},mousemove:function(b,a){this.fireMouseEvent(b,"mousemove",a);},mouseout:function(b,a){this.fireMouseEvent(b,"mouseout",a);},mouseover:function(b,a){this.fireMouseEvent(b,"mouseover",a);},mouseup:function(b,a){this.fireMouseEvent(b,"mouseup",a);},fireKeyEvent:function(b,c,a){a=a||{};this.simulateKeyEvent(c,b,a.bubbles,a.cancelable,a.view,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);},keydown:function(b,a){this.fireKeyEvent("keydown",b,a);},keypress:function(b,a){this.fireKeyEvent("keypress",b,a);},keyup:function(b,a){this.fireKeyEvent("keyup",b,a);}};YAHOO.register("event-simulate",YAHOO.util.UserAction,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: menu-min.js (3054efe0) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
(function(){var K=YAHOO.env.ua,C=YAHOO.util.Dom,Z=YAHOO.util.Event,H=YAHOO.lang,T="DIV",P="hd",M="bd",O="ft",X="LI",A="disabled",D="mouseover",F="mouseout",U="mousedown",G="mouseup",V="click",B="keydown",N="keyup",I="keypress",L="clicktohide",S="position",Q="dynamic",Y="showdelay",J="selected",E="visible",W="UL",R="MenuManager";YAHOO.widget.MenuManager=function(){var l=false,d={},o={},h={},c={"click":"clickEvent","mousedown":"mouseDownEvent","mouseup":"mouseUpEvent","mouseover":"mouseOverEvent","mouseout":"mouseOutEvent","keydown":"keyDownEvent","keyup":"keyUpEvent","keypress":"keyPressEvent","focus":"focusEvent","focusin":"focusEvent","blur":"blurEvent","focusout":"blurEvent"},i=null;function b(r){var p,q;if(r&&r.tagName){switch(r.tagName.toUpperCase()){case T:p=r.parentNode;if((C.hasClass(r,P)||C.hasClass(r,M)||C.hasClass(r,O))&&p&&p.tagName&&p.tagName.toUpperCase()==T){q=p;}else{q=r;}break;case X:q=r;break;default:p=r.parentNode;if(p){q=b(p);}break;}}return q;}function e(t){var p=Z.getTarget(t),q=b(p),u=true,w=t.type,x,r,s,z,y;if(q){r=q.tagName.toUpperCase();if(r==X){s=q.id;if(s&&h[s]){z=h[s];y=z.parent;}}else{if(r==T){if(q.id){y=d[q.id];}}}}if(y){x=c[w];if(w=="click"&&(K.gecko&&y.platform!="mac")&&t.button>0){u=false;}if(u&&z&&!z.cfg.getProperty(A)){z[x].fire(t);}if(u){y[x].fire(t,z);}}else{if(w==U){for(var v in o){if(H.hasOwnProperty(o,v)){y=o[v];if(y.cfg.getProperty(L)&&!(y instanceof YAHOO.widget.MenuBar)&&y.cfg.getProperty(S)==Q){y.hide();if(K.ie&&p.focus&&(K.ie<9)){p.setActive();}}else{if(y.cfg.getProperty(Y)>0){y._cancelShowDelay();}if(y.activeItem){y.activeItem.blur();y.activeItem.cfg.setProperty(J,false);y.activeItem=null;}}}}}}}function n(q,p,r){if(d[r.id]){this.removeMenu(r);}}function k(q,p){var r=p[1];if(r){i=r;}}function f(q,p){i=null;}function a(r,q){var p=q[0],s=this.id;if(p){o[s]=this;}else{if(o[s]){delete o[s];}}}function j(q,p){m(this);}function m(q){var p=q.id;if(p&&h[p]){if(i==q){i=null;}delete h[p];q.destroyEvent.unsubscribe(j);}}function g(q,p){var s=p[0],r;if(s instanceof YAHOO.widget.MenuItem){r=s.id;if(!h[r]){h[r]=s;s.destroyEvent.subscribe(j);}}}return{addMenu:function(q){var p;if(q instanceof YAHOO.widget.Menu&&q.id&&!d[q.id]){d[q.id]=q;if(!l){p=document;Z.on(p,D,e,this,true);Z.on(p,F,e,this,true);Z.on(p,U,e,this,true);Z.on(p,G,e,this,true);Z.on(p,V,e,this,true);Z.on(p,B,e,this,true);Z.on(p,N,e,this,true);Z.on(p,I,e,this,true);Z.onFocus(p,e,this,true);Z.onBlur(p,e,this,true);l=true;}q.cfg.subscribeToConfigEvent(E,a);q.destroyEvent.subscribe(n,q,this);q.itemAddedEvent.subscribe(g);q.focusEvent.subscribe(k);q.blurEvent.subscribe(f);}},removeMenu:function(s){var q,p,r;if(s){q=s.id;if((q in d)&&(d[q]==s)){p=s.getItems();if(p&&p.length>0){r=p.length-1;do{m(p[r]);}while(r--);}delete d[q];if((q in o)&&(o[q]==s)){delete o[q];}if(s.cfg){s.cfg.unsubscribeFromConfigEvent(E,a);}s.destroyEvent.unsubscribe(n,s);s.itemAddedEvent.unsubscribe(g);s.focusEvent.unsubscribe(k);s.blurEvent.unsubscribe(f);}}},hideVisible:function(){var p;for(var q in o){if(H.hasOwnProperty(o,q)){p=o[q];if(!(p instanceof YAHOO.widget.MenuBar)&&p.cfg.getProperty(S)==Q){p.hide();}}}},getVisible:function(){return o;},getMenus:function(){return d;},getMenu:function(q){var p;if(q in d){p=d[q];}return p;},getMenuItem:function(q){var p;if(q in h){p=h[q];}return p;},getMenuItemGroup:function(t){var q=C.get(t),p,v,u,r,s;if(q&&q.tagName&&q.tagName.toUpperCase()==W){v=q.firstChild;if(v){p=[];do{r=v.id;if(r){u=this.getMenuItem(r);if(u){p[p.length]=u;}}}while((v=v.nextSibling));if(p.length>0){s=p;}}}return s;},getFocusedMenuItem:function(){return i;},getFocusedMenu:function(){var p;if(i){p=i.parent.getRoot();}return p;},toString:function(){return R;}};}();})();(function(){var AM=YAHOO.lang,Aq="Menu",G="DIV",K="div",Am="id",AH="SELECT",e="xy",R="y",Ax="UL",L="ul",AJ="first-of-type",k="LI",h="OPTGROUP",Az="OPTION",Ah="disabled",AY="none",y="selected",At="groupindex",i="index",O="submenu",Au="visible",AX="hidedelay",Ac="position",AD="dynamic",C="static",An=AD+","+C,Q="url",M="#",V="target",AU="maxheight",T="topscrollbar",x="bottomscrollbar",d="_",P=T+d+Ah,E=x+d+Ah,b="mousemove",Av="showdelay",c="submenuhidedelay",AF="iframe",w="constraintoviewport",A4="preventcontextoverlap",AO="submenualignment",Z="autosubmenudisplay",AC="clicktohide",g="container",j="scrollincrement",Aj="minscrollheight",A2="classname",Ag="shadow",Ar="keepopen",A0="hd",D="hastitle",p="context",u="",Ak="mousedown",Ae="keydown",Ao="height",U="width",AQ="px",Ay="effect",AE="monitorresize",AW="display",AV="block",J="visibility",z="absolute",AS="zindex",l="yui-menu-body-scrolled",AK="&#32;",A1=" ",Ai="mouseover",H="mouseout",AR="itemAdded",n="itemRemoved",AL="hidden",s="yui-menu-shadow",AG=s+"-visible",m=s+A1+AG;YAHOO.widget.Menu=function(A6,A5){if(A5){this.parent=A5.parent;this.lazyLoad=A5.lazyLoad||A5.lazyload;this.itemData=A5.itemData||A5.itemdata;}YAHOO.widget.Menu.superclass.constructor.call(this,A6,A5);};function B(A6){var A5=false;if(AM.isString(A6)){A5=(An.indexOf((A6.toLowerCase()))!=-1);}return A5;}var f=YAHOO.util.Dom,AA=YAHOO.util.Event,Aw=YAHOO.widget.Module,AB=YAHOO.widget.Overlay,r=YAHOO.widget.Menu,A3=YAHOO.widget.MenuManager,F=YAHOO.util.CustomEvent,As=YAHOO.env.ua,Ap,AT=false,Ad,Ab=[["mouseOverEvent",Ai],["mouseOutEvent",H],["mouseDownEvent",Ak],["mouseUpEvent","mouseup"],["clickEvent","click"],["keyPressEvent","keypress"],["keyDownEvent",Ae],["keyUpEvent","keyup"],["focusEvent","focus"],["blurEvent","blur"],["itemAddedEvent",AR],["itemRemovedEvent",n]],AZ={key:Au,value:false,validator:AM.isBoolean},AP={key:w,value:true,validator:AM.isBoolean,supercedes:[AF,"x",R,e]},AI={key:A4,value:true,validator:AM.isBoolean,supercedes:[w]},S={key:Ac,value:AD,validator:B,supercedes:[Au,AF]},A={key:AO,value:["tl","tr"]},t={key:Z,value:true,validator:AM.isBoolean,suppressEvent:true},Y={key:Av,value:250,validator:AM.isNumber,suppressEvent:true},q={key:AX,value:0,validator:AM.isNumber,suppressEvent:true},v={key:c,value:250,validator:AM.isNumber,suppressEvent:true},o={key:AC,value:true,validator:AM.isBoolean,suppressEvent:true},AN={key:g,suppressEvent:true},Af={key:j,value:1,validator:AM.isNumber,supercedes:[AU],suppressEvent:true},N={key:Aj,value:90,validator:AM.isNumber,supercedes:[AU],suppressEvent:true},X={key:AU,value:0,validator:AM.isNumber,supercedes:[AF],suppressEvent:true},W={key:A2,value:null,validator:AM.isString,suppressEvent:true},a={key:Ah,value:false,validator:AM.isBoolean,suppressEvent:true},I={key:Ag,value:true,validator:AM.isBoolean,suppressEvent:true,supercedes:[Au]},Al={key:Ar,value:false,validator:AM.isBoolean};
function Aa(A5){Ad=AA.getTarget(A5);}YAHOO.lang.extend(r,AB,{CSS_CLASS_NAME:"yuimenu",ITEM_TYPE:null,GROUP_TITLE_TAG_NAME:"h6",OFF_SCREEN_POSITION:"-999em",_useHideDelay:false,_bHandledMouseOverEvent:false,_bHandledMouseOutEvent:false,_aGroupTitleElements:null,_aItemGroups:null,_aListElements:null,_nCurrentMouseX:0,_bStopMouseEventHandlers:false,_sClassName:null,lazyLoad:false,itemData:null,activeItem:null,parent:null,srcElement:null,init:function(A7,A6){this._aItemGroups=[];this._aListElements=[];this._aGroupTitleElements=[];if(!this.ITEM_TYPE){this.ITEM_TYPE=YAHOO.widget.MenuItem;}var A5;if(AM.isString(A7)){A5=f.get(A7);}else{if(A7.tagName){A5=A7;}}if(A5&&A5.tagName){switch(A5.tagName.toUpperCase()){case G:this.srcElement=A5;if(!A5.id){A5.setAttribute(Am,f.generateId());}r.superclass.init.call(this,A5);this.beforeInitEvent.fire(r);break;case AH:this.srcElement=A5;r.superclass.init.call(this,f.generateId());this.beforeInitEvent.fire(r);break;}}else{r.superclass.init.call(this,A7);this.beforeInitEvent.fire(r);}if(this.element){f.addClass(this.element,this.CSS_CLASS_NAME);this.initEvent.subscribe(this._onInit);this.beforeRenderEvent.subscribe(this._onBeforeRender);this.renderEvent.subscribe(this._onRender);this.beforeShowEvent.subscribe(this._onBeforeShow);this.hideEvent.subscribe(this._onHide);this.showEvent.subscribe(this._onShow);this.beforeHideEvent.subscribe(this._onBeforeHide);this.mouseOverEvent.subscribe(this._onMouseOver);this.mouseOutEvent.subscribe(this._onMouseOut);this.clickEvent.subscribe(this._onClick);this.keyDownEvent.subscribe(this._onKeyDown);this.keyPressEvent.subscribe(this._onKeyPress);this.blurEvent.subscribe(this._onBlur);if(!AT){AA.onFocus(document,Aa);AT=true;}if((As.gecko&&As.gecko<1.9)||(As.webkit&&As.webkit<523)){this.cfg.subscribeToConfigEvent(R,this._onYChange);}if(A6){this.cfg.applyConfig(A6,true);}A3.addMenu(this);this.initEvent.fire(r);}},_initSubTree:function(){var A6=this.srcElement,A5,A8,BB,BC,BA,A9,A7;if(A6){A5=(A6.tagName&&A6.tagName.toUpperCase());if(A5==G){BC=this.body.firstChild;if(BC){A8=0;BB=this.GROUP_TITLE_TAG_NAME.toUpperCase();do{if(BC&&BC.tagName){switch(BC.tagName.toUpperCase()){case BB:this._aGroupTitleElements[A8]=BC;break;case Ax:this._aListElements[A8]=BC;this._aItemGroups[A8]=[];A8++;break;}}}while((BC=BC.nextSibling));if(this._aListElements[0]){f.addClass(this._aListElements[0],AJ);}}}BC=null;if(A5){switch(A5){case G:BA=this._aListElements;A9=BA.length;if(A9>0){A7=A9-1;do{BC=BA[A7].firstChild;if(BC){do{if(BC&&BC.tagName&&BC.tagName.toUpperCase()==k){this.addItem(new this.ITEM_TYPE(BC,{parent:this}),A7);}}while((BC=BC.nextSibling));}}while(A7--);}break;case AH:BC=A6.firstChild;do{if(BC&&BC.tagName){switch(BC.tagName.toUpperCase()){case h:case Az:this.addItem(new this.ITEM_TYPE(BC,{parent:this}));break;}}}while((BC=BC.nextSibling));break;}}}},_getFirstEnabledItem:function(){var A5=this.getItems(),A9=A5.length,A8,A7;for(var A6=0;A6<A9;A6++){A8=A5[A6];if(A8&&!A8.cfg.getProperty(Ah)&&A8.element.style.display!=AY){A7=A8;break;}}return A7;},_addItemToGroup:function(BA,BB,BF){var BD,BG,A8,BE,A9,A6,A7,BC;function A5(BH,BI){return(BH[BI]||A5(BH,(BI+1)));}if(BB instanceof this.ITEM_TYPE){BD=BB;BD.parent=this;}else{if(AM.isString(BB)){BD=new this.ITEM_TYPE(BB,{parent:this});}else{if(AM.isObject(BB)){BB.parent=this;BD=new this.ITEM_TYPE(BB.text,BB);}}}if(BD){if(BD.cfg.getProperty(y)){this.activeItem=BD;}BG=AM.isNumber(BA)?BA:0;A8=this._getItemGroup(BG);if(!A8){A8=this._createItemGroup(BG);}if(AM.isNumber(BF)){A9=(BF>=A8.length);if(A8[BF]){A8.splice(BF,0,BD);}else{A8[BF]=BD;}BE=A8[BF];if(BE){if(A9&&(!BE.element.parentNode||BE.element.parentNode.nodeType==11)){this._aListElements[BG].appendChild(BE.element);}else{A6=A5(A8,(BF+1));if(A6&&(!BE.element.parentNode||BE.element.parentNode.nodeType==11)){this._aListElements[BG].insertBefore(BE.element,A6.element);}}BE.parent=this;this._subscribeToItemEvents(BE);this._configureSubmenu(BE);this._updateItemProperties(BG);this.itemAddedEvent.fire(BE);this.changeContentEvent.fire();BC=BE;}}else{A7=A8.length;A8[A7]=BD;BE=A8[A7];if(BE){if(!f.isAncestor(this._aListElements[BG],BE.element)){this._aListElements[BG].appendChild(BE.element);}BE.element.setAttribute(At,BG);BE.element.setAttribute(i,A7);BE.parent=this;BE.index=A7;BE.groupIndex=BG;this._subscribeToItemEvents(BE);this._configureSubmenu(BE);if(A7===0){f.addClass(BE.element,AJ);}this.itemAddedEvent.fire(BE);this.changeContentEvent.fire();BC=BE;}}}return BC;},_removeItemFromGroupByIndex:function(A8,A6){var A7=AM.isNumber(A8)?A8:0,A9=this._getItemGroup(A7),BB,BA,A5;if(A9){BB=A9.splice(A6,1);BA=BB[0];if(BA){this._updateItemProperties(A7);if(A9.length===0){A5=this._aListElements[A7];if(A5&&A5.parentNode){A5.parentNode.removeChild(A5);}this._aItemGroups.splice(A7,1);this._aListElements.splice(A7,1);A5=this._aListElements[0];if(A5){f.addClass(A5,AJ);}}this.itemRemovedEvent.fire(BA);this.changeContentEvent.fire();}}return BA;},_removeItemFromGroupByValue:function(A8,A5){var BA=this._getItemGroup(A8),BB,A9,A7,A6;if(BA){BB=BA.length;A9=-1;if(BB>0){A6=BB-1;do{if(BA[A6]==A5){A9=A6;break;}}while(A6--);if(A9>-1){A7=this._removeItemFromGroupByIndex(A8,A9);}}}return A7;},_updateItemProperties:function(A6){var A7=this._getItemGroup(A6),BA=A7.length,A9,A8,A5;if(BA>0){A5=BA-1;do{A9=A7[A5];if(A9){A8=A9.element;A9.index=A5;A9.groupIndex=A6;A8.setAttribute(At,A6);A8.setAttribute(i,A5);f.removeClass(A8,AJ);}}while(A5--);if(A8){f.addClass(A8,AJ);}}},_createItemGroup:function(A7){var A5,A6;if(!this._aItemGroups[A7]){this._aItemGroups[A7]=[];A5=document.createElement(L);this._aListElements[A7]=A5;A6=this._aItemGroups[A7];}return A6;},_getItemGroup:function(A7){var A5=AM.isNumber(A7)?A7:0,A8=this._aItemGroups,A6;if(A5 in A8){A6=A8[A5];}return A6;},_configureSubmenu:function(A5){var A6=A5.cfg.getProperty(O);if(A6){this.cfg.configChangedEvent.subscribe(this._onParentMenuConfigChange,A6,true);this.renderEvent.subscribe(this._onParentMenuRender,A6,true);}},_subscribeToItemEvents:function(A5){A5.destroyEvent.subscribe(this._onMenuItemDestroy,A5,this);
A5.cfg.configChangedEvent.subscribe(this._onMenuItemConfigChange,A5,this);},_onVisibleChange:function(A7,A6){var A5=A6[0];if(A5){f.addClass(this.element,Au);}else{f.removeClass(this.element,Au);}},_cancelHideDelay:function(){var A5=this.getRoot()._hideDelayTimer;if(A5){A5.cancel();}},_execHideDelay:function(){this._cancelHideDelay();var A5=this.getRoot();A5._hideDelayTimer=AM.later(A5.cfg.getProperty(AX),this,function(){if(A5.activeItem){if(A5.hasFocus()){A5.activeItem.focus();}A5.clearActiveItem();}if(A5==this&&!(this instanceof YAHOO.widget.MenuBar)&&this.cfg.getProperty(Ac)==AD){this.hide();}});},_cancelShowDelay:function(){var A5=this.getRoot()._showDelayTimer;if(A5){A5.cancel();}},_execSubmenuHideDelay:function(A7,A6,A5){A7._submenuHideDelayTimer=AM.later(50,this,function(){if(this._nCurrentMouseX>(A6+10)){A7._submenuHideDelayTimer=AM.later(A5,A7,function(){this.hide();});}else{A7.hide();}});},_disableScrollHeader:function(){if(!this._bHeaderDisabled){f.addClass(this.header,P);this._bHeaderDisabled=true;}},_disableScrollFooter:function(){if(!this._bFooterDisabled){f.addClass(this.footer,E);this._bFooterDisabled=true;}},_enableScrollHeader:function(){if(this._bHeaderDisabled){f.removeClass(this.header,P);this._bHeaderDisabled=false;}},_enableScrollFooter:function(){if(this._bFooterDisabled){f.removeClass(this.footer,E);this._bFooterDisabled=false;}},_onMouseOver:function(BH,BA){var BI=BA[0],BE=BA[1],A5=AA.getTarget(BI),A9=this.getRoot(),BG=this._submenuHideDelayTimer,A6,A8,BD,A7,BC,BB;var BF=function(){if(this.parent.cfg.getProperty(y)){this.show();}};if(!this._bStopMouseEventHandlers){if(!this._bHandledMouseOverEvent&&(A5==this.element||f.isAncestor(this.element,A5))){if(this._useHideDelay){this._cancelHideDelay();}this._nCurrentMouseX=0;AA.on(this.element,b,this._onMouseMove,this,true);if(!(BE&&f.isAncestor(BE.element,AA.getRelatedTarget(BI)))){this.clearActiveItem();}if(this.parent&&BG){BG.cancel();this.parent.cfg.setProperty(y,true);A6=this.parent.parent;A6._bHandledMouseOutEvent=true;A6._bHandledMouseOverEvent=false;}this._bHandledMouseOverEvent=true;this._bHandledMouseOutEvent=false;}if(BE&&!BE.handledMouseOverEvent&&!BE.cfg.getProperty(Ah)&&(A5==BE.element||f.isAncestor(BE.element,A5))){A8=this.cfg.getProperty(Av);BD=(A8>0);if(BD){this._cancelShowDelay();}A7=this.activeItem;if(A7){A7.cfg.setProperty(y,false);}BC=BE.cfg;BC.setProperty(y,true);if(this.hasFocus()||A9._hasFocus){BE.focus();A9._hasFocus=false;}if(this.cfg.getProperty(Z)){BB=BC.getProperty(O);if(BB){if(BD){A9._showDelayTimer=AM.later(A9.cfg.getProperty(Av),BB,BF);}else{BB.show();}}}BE.handledMouseOverEvent=true;BE.handledMouseOutEvent=false;}}},_onMouseOut:function(BD,A7){var BE=A7[0],BB=A7[1],A8=AA.getRelatedTarget(BE),BC=false,BA,A9,A5,A6;if(!this._bStopMouseEventHandlers){if(BB&&!BB.cfg.getProperty(Ah)){BA=BB.cfg;A9=BA.getProperty(O);if(A9&&(A8==A9.element||f.isAncestor(A9.element,A8))){BC=true;}if(!BB.handledMouseOutEvent&&((A8!=BB.element&&!f.isAncestor(BB.element,A8))||BC)){if(!BC){BB.cfg.setProperty(y,false);if(A9){A5=this.cfg.getProperty(c);A6=this.cfg.getProperty(Av);if(!(this instanceof YAHOO.widget.MenuBar)&&A5>0&&A5>=A6){this._execSubmenuHideDelay(A9,AA.getPageX(BE),A5);}else{A9.hide();}}}BB.handledMouseOutEvent=true;BB.handledMouseOverEvent=false;}}if(!this._bHandledMouseOutEvent){if(this._didMouseLeave(A8)||BC){if(this._useHideDelay){this._execHideDelay();}AA.removeListener(this.element,b,this._onMouseMove);this._nCurrentMouseX=AA.getPageX(BE);this._bHandledMouseOutEvent=true;this._bHandledMouseOverEvent=false;}}}},_didMouseLeave:function(A5){return(A5===this._shadow||(A5!=this.element&&!f.isAncestor(this.element,A5)));},_onMouseMove:function(A6,A5){if(!this._bStopMouseEventHandlers){this._nCurrentMouseX=AA.getPageX(A6);}},_onClick:function(BG,A7){var BH=A7[0],BB=A7[1],BD=false,A9,BE,A6,A5,BA,BC,BF;var A8=function(){A6=this.getRoot();if(A6 instanceof YAHOO.widget.MenuBar||A6.cfg.getProperty(Ac)==C){A6.clearActiveItem();}else{A6.hide();}};if(BB){if(BB.cfg.getProperty(Ah)){AA.preventDefault(BH);A8.call(this);}else{A9=BB.cfg.getProperty(O);BA=BB.cfg.getProperty(Q);if(BA){BC=BA.indexOf(M);BF=BA.length;if(BC!=-1){BA=BA.substr(BC,BF);BF=BA.length;if(BF>1){A5=BA.substr(1,BF);BE=YAHOO.widget.MenuManager.getMenu(A5);if(BE){BD=(this.getRoot()===BE.getRoot());}}else{if(BF===1){BD=true;}}}}if(BD&&!BB.cfg.getProperty(V)){AA.preventDefault(BH);if(As.webkit){BB.focus();}else{BB.focusEvent.fire();}}if(!A9&&!this.cfg.getProperty(Ar)){A8.call(this);}}}},_stopMouseEventHandlers:function(){this._bStopMouseEventHandlers=true;AM.later(10,this,function(){this._bStopMouseEventHandlers=false;});},_onKeyDown:function(BJ,BD){var BG=BD[0],BF=BD[1],BC,BH,A6,A9,BK,A5,BN,A8,BI,A7,BE,BM,BA,BB;if(this._useHideDelay){this._cancelHideDelay();}if(BF&&!BF.cfg.getProperty(Ah)){BH=BF.cfg;A6=this.parent;switch(BG.keyCode){case 38:case 40:BK=(BG.keyCode==38)?BF.getPreviousEnabledSibling():BF.getNextEnabledSibling();if(BK){this.clearActiveItem();BK.cfg.setProperty(y,true);BK.focus();if(this.cfg.getProperty(AU)>0||f.hasClass(this.body,l)){A5=this.body;BN=A5.scrollTop;A8=A5.offsetHeight;BI=this.getItems();A7=BI.length-1;BE=BK.element.offsetTop;if(BG.keyCode==40){if(BE>=(A8+BN)){A5.scrollTop=BE-A8;}else{if(BE<=BN){A5.scrollTop=0;}}if(BK==BI[A7]){A5.scrollTop=BK.element.offsetTop;}}else{if(BE<=BN){A5.scrollTop=BE-BK.element.offsetHeight;}else{if(BE>=(BN+A8)){A5.scrollTop=BE;}}if(BK==BI[0]){A5.scrollTop=0;}}BN=A5.scrollTop;BM=A5.scrollHeight-A5.offsetHeight;if(BN===0){this._disableScrollHeader();this._enableScrollFooter();}else{if(BN==BM){this._enableScrollHeader();this._disableScrollFooter();}else{this._enableScrollHeader();this._enableScrollFooter();}}}}AA.preventDefault(BG);this._stopMouseEventHandlers();break;case 39:BC=BH.getProperty(O);if(BC){if(!BH.getProperty(y)){BH.setProperty(y,true);}BC.show();BC.setInitialFocus();BC.setInitialSelection();}else{A9=this.getRoot();if(A9 instanceof YAHOO.widget.MenuBar){BK=A9.activeItem.getNextEnabledSibling();
if(BK){A9.clearActiveItem();BK.cfg.setProperty(y,true);BC=BK.cfg.getProperty(O);if(BC){BC.show();BC.setInitialFocus();}else{BK.focus();}}}}AA.preventDefault(BG);this._stopMouseEventHandlers();break;case 37:if(A6){BA=A6.parent;if(BA instanceof YAHOO.widget.MenuBar){BK=BA.activeItem.getPreviousEnabledSibling();if(BK){BA.clearActiveItem();BK.cfg.setProperty(y,true);BC=BK.cfg.getProperty(O);if(BC){BC.show();BC.setInitialFocus();}else{BK.focus();}}}else{this.hide();A6.focus();}}AA.preventDefault(BG);this._stopMouseEventHandlers();break;}}if(BG.keyCode==27){if(this.cfg.getProperty(Ac)==AD){this.hide();if(this.parent){this.parent.focus();}else{BB=this._focusedElement;if(BB&&BB.focus){try{BB.focus();}catch(BL){}}}}else{if(this.activeItem){BC=this.activeItem.cfg.getProperty(O);if(BC&&BC.cfg.getProperty(Au)){BC.hide();this.activeItem.focus();}else{this.activeItem.blur();this.activeItem.cfg.setProperty(y,false);}}}AA.preventDefault(BG);}},_onKeyPress:function(A7,A6){var A5=A6[0];if(A5.keyCode==40||A5.keyCode==38){AA.preventDefault(A5);}},_onBlur:function(A6,A5){if(this._hasFocus){this._hasFocus=false;}},_onYChange:function(A6,A5){var A8=this.parent,BA,A7,A9;if(A8){BA=A8.parent.body.scrollTop;if(BA>0){A9=(this.cfg.getProperty(R)-BA);f.setY(this.element,A9);A7=this.iframe;if(A7){f.setY(A7,A9);}this.cfg.setProperty(R,A9,true);}}},_onScrollTargetMouseOver:function(BB,BE){var BD=this._bodyScrollTimer;if(BD){BD.cancel();}this._cancelHideDelay();var A7=AA.getTarget(BB),A9=this.body,A8=this.cfg.getProperty(j),A5,A6;function BC(){var BF=A9.scrollTop;if(BF<A5){A9.scrollTop=(BF+A8);this._enableScrollHeader();}else{A9.scrollTop=A5;this._bodyScrollTimer.cancel();this._disableScrollFooter();}}function BA(){var BF=A9.scrollTop;if(BF>0){A9.scrollTop=(BF-A8);this._enableScrollFooter();}else{A9.scrollTop=0;this._bodyScrollTimer.cancel();this._disableScrollHeader();}}if(f.hasClass(A7,A0)){A6=BA;}else{A5=A9.scrollHeight-A9.offsetHeight;A6=BC;}this._bodyScrollTimer=AM.later(10,this,A6,null,true);},_onScrollTargetMouseOut:function(A7,A5){var A6=this._bodyScrollTimer;if(A6){A6.cancel();}this._cancelHideDelay();},_onInit:function(A6,A5){this.cfg.subscribeToConfigEvent(Au,this._onVisibleChange);var A7=!this.parent,A8=this.lazyLoad;if(((A7&&!A8)||(A7&&(this.cfg.getProperty(Au)||this.cfg.getProperty(Ac)==C))||(!A7&&!A8))&&this.getItemGroups().length===0){if(this.srcElement){this._initSubTree();}if(this.itemData){this.addItems(this.itemData);}}else{if(A8){this.cfg.fireQueue();}}},_onBeforeRender:function(A8,A7){var A9=this.element,BC=this._aListElements.length,A6=true,BB=0,A5,BA;if(BC>0){do{A5=this._aListElements[BB];if(A5){if(A6){f.addClass(A5,AJ);A6=false;}if(!f.isAncestor(A9,A5)){this.appendToBody(A5);}BA=this._aGroupTitleElements[BB];if(BA){if(!f.isAncestor(A9,BA)){A5.parentNode.insertBefore(BA,A5);}f.addClass(A5,D);}}BB++;}while(BB<BC);}},_onRender:function(A6,A5){if(this.cfg.getProperty(Ac)==AD){if(!this.cfg.getProperty(Au)){this.positionOffScreen();}}},_onBeforeShow:function(A7,A6){var A9,BC,A8,BA=this.cfg.getProperty(g);if(this.lazyLoad&&this.getItemGroups().length===0){if(this.srcElement){this._initSubTree();}if(this.itemData){if(this.parent&&this.parent.parent&&this.parent.parent.srcElement&&this.parent.parent.srcElement.tagName.toUpperCase()==AH){A9=this.itemData.length;for(BC=0;BC<A9;BC++){if(this.itemData[BC].tagName){this.addItem((new this.ITEM_TYPE(this.itemData[BC])));}}}else{this.addItems(this.itemData);}}A8=this.srcElement;if(A8){if(A8.tagName.toUpperCase()==AH){if(f.inDocument(A8)){this.render(A8.parentNode);}else{this.render(BA);}}else{this.render();}}else{if(this.parent){this.render(this.parent.element);}else{this.render(BA);}}}var BB=this.parent,A5;if(!BB&&this.cfg.getProperty(Ac)==AD){this.cfg.refireEvent(e);}if(BB){A5=BB.parent.cfg.getProperty(AO);this.cfg.setProperty(p,[BB.element,A5[0],A5[1]]);this.align();}},getConstrainedY:function(BH){var BS=this,BO=BS.cfg.getProperty(p),BV=BS.cfg.getProperty(AU),BR,BG={"trbr":true,"tlbl":true,"bltl":true,"brtr":true},BA=(BO&&BG[BO[1]+BO[2]]),BC=BS.element,BW=BC.offsetHeight,BQ=AB.VIEWPORT_OFFSET,BL=f.getViewportHeight(),BP=f.getDocumentScrollTop(),BM=(BS.cfg.getProperty(Aj)+BQ<BL),BU,BD,BJ,BK,BF=false,BE,A7,BI=BP+BQ,A9=BP+BL-BW-BQ,A5=BH;var BB=function(){var BX;if((BS.cfg.getProperty(R)-BP)>BJ){BX=(BJ-BW);}else{BX=(BJ+BK);}BS.cfg.setProperty(R,(BX+BP),true);return BX;};var A8=function(){if((BS.cfg.getProperty(R)-BP)>BJ){return(A7-BQ);}else{return(BE-BQ);}};var BN=function(){var BX;if((BS.cfg.getProperty(R)-BP)>BJ){BX=(BJ+BK);}else{BX=(BJ-BC.offsetHeight);}BS.cfg.setProperty(R,(BX+BP),true);};var A6=function(){BS._setScrollHeight(this.cfg.getProperty(AU));BS.hideEvent.unsubscribe(A6);};var BT=function(){var Ba=A8(),BX=(BS.getItems().length>0),BZ,BY;if(BW>Ba){BZ=BX?BS.cfg.getProperty(Aj):BW;if((Ba>BZ)&&BX){BR=Ba;}else{BR=BV;}BS._setScrollHeight(BR);BS.hideEvent.subscribe(A6);BN();if(Ba<BZ){if(BF){BB();}else{BB();BF=true;BY=BT();}}}else{if(BR&&(BR!==BV)){BS._setScrollHeight(BV);BS.hideEvent.subscribe(A6);BN();}}return BY;};if(BH<BI||BH>A9){if(BM){if(BS.cfg.getProperty(A4)&&BA){BD=BO[0];BK=BD.offsetHeight;BJ=(f.getY(BD)-BP);BE=BJ;A7=(BL-(BJ+BK));BT();A5=BS.cfg.getProperty(R);}else{if(!(BS instanceof YAHOO.widget.MenuBar)&&BW>=BL){BU=(BL-(BQ*2));if(BU>BS.cfg.getProperty(Aj)){BS._setScrollHeight(BU);BS.hideEvent.subscribe(A6);BN();A5=BS.cfg.getProperty(R);}}else{if(BH<BI){A5=BI;}else{if(BH>A9){A5=A9;}}}}}else{A5=BQ+BP;}}return A5;},_onHide:function(A6,A5){if(this.cfg.getProperty(Ac)===AD){this.positionOffScreen();}},_onShow:function(BD,BB){var A5=this.parent,A7,A8,BA,A6;function A9(BF){var BE;if(BF.type==Ak||(BF.type==Ae&&BF.keyCode==27)){BE=AA.getTarget(BF);if(BE!=A7.element||!f.isAncestor(A7.element,BE)){A7.cfg.setProperty(Z,false);AA.removeListener(document,Ak,A9);AA.removeListener(document,Ae,A9);}}}function BC(BF,BE,BG){this.cfg.setProperty(U,u);this.hideEvent.unsubscribe(BC,BG);}if(A5){A7=A5.parent;if(!A7.cfg.getProperty(Z)&&(A7 instanceof YAHOO.widget.MenuBar||A7.cfg.getProperty(Ac)==C)){A7.cfg.setProperty(Z,true);
AA.on(document,Ak,A9);AA.on(document,Ae,A9);}if((this.cfg.getProperty("x")<A7.cfg.getProperty("x"))&&(As.gecko&&As.gecko<1.9)&&!this.cfg.getProperty(U)){A8=this.element;BA=A8.offsetWidth;A8.style.width=BA+AQ;A6=(BA-(A8.offsetWidth-BA))+AQ;this.cfg.setProperty(U,A6);this.hideEvent.subscribe(BC,A6);}}if(this===this.getRoot()&&this.cfg.getProperty(Ac)===AD){this._focusedElement=Ad;this.focus();}},_onBeforeHide:function(A7,A6){var A5=this.activeItem,A9=this.getRoot(),BA,A8;if(A5){BA=A5.cfg;BA.setProperty(y,false);A8=BA.getProperty(O);if(A8){A8.hide();}}if(As.ie&&this.cfg.getProperty(Ac)===AD&&this.parent){A9._hasFocus=this.hasFocus();}if(A9==this){A9.blur();}},_onParentMenuConfigChange:function(A6,A5,A9){var A7=A5[0][0],A8=A5[0][1];switch(A7){case AF:case w:case AX:case Av:case c:case AC:case Ay:case A2:case j:case AU:case Aj:case AE:case Ag:case A4:case Ar:A9.cfg.setProperty(A7,A8);break;case AO:if(!(this.parent.parent instanceof YAHOO.widget.MenuBar)){A9.cfg.setProperty(A7,A8);}break;}},_onParentMenuRender:function(A6,A5,BB){var A8=BB.parent.parent,A7=A8.cfg,A9={constraintoviewport:A7.getProperty(w),xy:[0,0],clicktohide:A7.getProperty(AC),effect:A7.getProperty(Ay),showdelay:A7.getProperty(Av),hidedelay:A7.getProperty(AX),submenuhidedelay:A7.getProperty(c),classname:A7.getProperty(A2),scrollincrement:A7.getProperty(j),maxheight:A7.getProperty(AU),minscrollheight:A7.getProperty(Aj),iframe:A7.getProperty(AF),shadow:A7.getProperty(Ag),preventcontextoverlap:A7.getProperty(A4),monitorresize:A7.getProperty(AE),keepopen:A7.getProperty(Ar)},BA;if(!(A8 instanceof YAHOO.widget.MenuBar)){A9[AO]=A7.getProperty(AO);}BB.cfg.applyConfig(A9);if(!this.lazyLoad){BA=this.parent.element;if(this.element.parentNode==BA){this.render();}else{this.render(BA);}}},_onMenuItemDestroy:function(A7,A6,A5){this._removeItemFromGroupByValue(A5.groupIndex,A5);},_onMenuItemConfigChange:function(A7,A6,A5){var A9=A6[0][0],BA=A6[0][1],A8;switch(A9){case y:if(BA===true){this.activeItem=A5;}break;case O:A8=A6[0][1];if(A8){this._configureSubmenu(A5);}break;}},configVisible:function(A7,A6,A8){var A5,A9;if(this.cfg.getProperty(Ac)==AD){r.superclass.configVisible.call(this,A7,A6,A8);}else{A5=A6[0];A9=f.getStyle(this.element,AW);f.setStyle(this.element,J,Au);if(A5){if(A9!=AV){this.beforeShowEvent.fire();f.setStyle(this.element,AW,AV);this.showEvent.fire();}}else{if(A9==AV){this.beforeHideEvent.fire();f.setStyle(this.element,AW,AY);this.hideEvent.fire();}}}},configPosition:function(A7,A6,BA){var A9=this.element,A8=A6[0]==C?C:z,BB=this.cfg,A5;f.setStyle(A9,Ac,A8);if(A8==C){f.setStyle(A9,AW,AV);BB.setProperty(Au,true);}else{f.setStyle(A9,J,AL);}if(A8==z){A5=BB.getProperty(AS);if(!A5||A5===0){BB.setProperty(AS,1);}}},configIframe:function(A6,A5,A7){if(this.cfg.getProperty(Ac)==AD){r.superclass.configIframe.call(this,A6,A5,A7);}},configHideDelay:function(A6,A5,A7){var A8=A5[0];this._useHideDelay=(A8>0);},configContainer:function(A6,A5,A8){var A7=A5[0];if(AM.isString(A7)){this.cfg.setProperty(g,f.get(A7),true);}},_clearSetWidthFlag:function(){this._widthSetForScroll=false;this.cfg.unsubscribeFromConfigEvent(U,this._clearSetWidthFlag);},_subscribeScrollHandlers:function(A6,A5){var A8=this._onScrollTargetMouseOver;var A7=this._onScrollTargetMouseOut;AA.on(A6,Ai,A8,this,true);AA.on(A6,H,A7,this,true);AA.on(A5,Ai,A8,this,true);AA.on(A5,H,A7,this,true);},_unsubscribeScrollHandlers:function(A6,A5){var A8=this._onScrollTargetMouseOver;var A7=this._onScrollTargetMouseOut;AA.removeListener(A6,Ai,A8);AA.removeListener(A6,H,A7);AA.removeListener(A5,Ai,A8);AA.removeListener(A5,H,A7);},_setScrollHeight:function(BF){var BC=BF,BB=false,BG=false,A8,A9,BE,A6,A5,BD,BA,A7;if(this.getItems().length>0){A8=this.element;A9=this.body;BE=this.header;A6=this.footer;A5=this.cfg.getProperty(Aj);if(BC>0&&BC<A5){BC=A5;}f.setStyle(A9,Ao,u);f.removeClass(A9,l);A9.scrollTop=0;BG=((As.gecko&&As.gecko<1.9)||As.ie);if(BC>0&&BG&&!this.cfg.getProperty(U)){BA=A8.offsetWidth;A8.style.width=BA+AQ;A7=(BA-(A8.offsetWidth-BA))+AQ;this.cfg.unsubscribeFromConfigEvent(U,this._clearSetWidthFlag);this.cfg.setProperty(U,A7);this._widthSetForScroll=true;this.cfg.subscribeToConfigEvent(U,this._clearSetWidthFlag);}if(BC>0&&(!BE&&!A6)){this.setHeader(AK);this.setFooter(AK);BE=this.header;A6=this.footer;f.addClass(BE,T);f.addClass(A6,x);A8.insertBefore(BE,A9);A8.appendChild(A6);}BD=BC;if(BE&&A6){BD=(BD-(BE.offsetHeight+A6.offsetHeight));}if((BD>0)&&(A9.offsetHeight>BC)){f.addClass(A9,l);f.setStyle(A9,Ao,(BD+AQ));if(!this._hasScrollEventHandlers){this._subscribeScrollHandlers(BE,A6);this._hasScrollEventHandlers=true;}this._disableScrollHeader();this._enableScrollFooter();BB=true;}else{if(BE&&A6){if(this._widthSetForScroll){this._widthSetForScroll=false;this.cfg.unsubscribeFromConfigEvent(U,this._clearSetWidthFlag);this.cfg.setProperty(U,u);}this._enableScrollHeader();this._enableScrollFooter();if(this._hasScrollEventHandlers){this._unsubscribeScrollHandlers(BE,A6);this._hasScrollEventHandlers=false;}A8.removeChild(BE);A8.removeChild(A6);this.header=null;this.footer=null;BB=true;}}if(BB){this.cfg.refireEvent(AF);this.cfg.refireEvent(Ag);}}},_setMaxHeight:function(A6,A5,A7){this._setScrollHeight(A7);this.renderEvent.unsubscribe(this._setMaxHeight);},configMaxHeight:function(A6,A5,A7){var A8=A5[0];if(this.lazyLoad&&!this.body&&A8>0){this.renderEvent.subscribe(this._setMaxHeight,A8,this);}else{this._setScrollHeight(A8);}},configClassName:function(A7,A6,A8){var A5=A6[0];if(this._sClassName){f.removeClass(this.element,this._sClassName);}f.addClass(this.element,A5);this._sClassName=A5;},_onItemAdded:function(A6,A5){var A7=A5[0];if(A7){A7.cfg.setProperty(Ah,true);}},configDisabled:function(A7,A6,BA){var A9=A6[0],A5=this.getItems(),BB,A8;if(AM.isArray(A5)){BB=A5.length;if(BB>0){A8=BB-1;do{A5[A8].cfg.setProperty(Ah,A9);}while(A8--);}if(A9){this.clearActiveItem(true);f.addClass(this.element,Ah);this.itemAddedEvent.subscribe(this._onItemAdded);}else{f.removeClass(this.element,Ah);this.itemAddedEvent.unsubscribe(this._onItemAdded);
}}},_sizeShadow:function(){var A6=this.element,A5=this._shadow;if(A5&&A6){if(A5.style.width&&A5.style.height){A5.style.width=u;A5.style.height=u;}A5.style.width=(A6.offsetWidth+6)+AQ;A5.style.height=(A6.offsetHeight+1)+AQ;}},_replaceShadow:function(){this.element.appendChild(this._shadow);},_addShadowVisibleClass:function(){f.addClass(this._shadow,AG);},_removeShadowVisibleClass:function(){f.removeClass(this._shadow,AG);},_removeShadow:function(){var A5=(this._shadow&&this._shadow.parentNode);if(A5){A5.removeChild(this._shadow);}this.beforeShowEvent.unsubscribe(this._addShadowVisibleClass);this.beforeHideEvent.unsubscribe(this._removeShadowVisibleClass);this.cfg.unsubscribeFromConfigEvent(U,this._sizeShadow);this.cfg.unsubscribeFromConfigEvent(Ao,this._sizeShadow);this.cfg.unsubscribeFromConfigEvent(AU,this._sizeShadow);this.cfg.unsubscribeFromConfigEvent(AU,this._replaceShadow);this.changeContentEvent.unsubscribe(this._sizeShadow);Aw.textResizeEvent.unsubscribe(this._sizeShadow);},_createShadow:function(){var A6=this._shadow,A5;if(!A6){A5=this.element;if(!Ap){Ap=document.createElement(K);Ap.className=m;}A6=Ap.cloneNode(false);A5.appendChild(A6);this._shadow=A6;this.beforeShowEvent.subscribe(this._addShadowVisibleClass);this.beforeHideEvent.subscribe(this._removeShadowVisibleClass);if(As.ie){AM.later(0,this,function(){this._sizeShadow();this.syncIframe();});this.cfg.subscribeToConfigEvent(U,this._sizeShadow);this.cfg.subscribeToConfigEvent(Ao,this._sizeShadow);this.cfg.subscribeToConfigEvent(AU,this._sizeShadow);this.changeContentEvent.subscribe(this._sizeShadow);Aw.textResizeEvent.subscribe(this._sizeShadow,this,true);this.destroyEvent.subscribe(function(){Aw.textResizeEvent.unsubscribe(this._sizeShadow,this);});}this.cfg.subscribeToConfigEvent(AU,this._replaceShadow);}},_shadowBeforeShow:function(){if(this._shadow){this._replaceShadow();if(As.ie){this._sizeShadow();}}else{this._createShadow();}this.beforeShowEvent.unsubscribe(this._shadowBeforeShow);},configShadow:function(A6,A5,A7){var A8=A5[0];if(A8&&this.cfg.getProperty(Ac)==AD){if(this.cfg.getProperty(Au)){if(this._shadow){this._replaceShadow();if(As.ie){this._sizeShadow();}}else{this._createShadow();}}else{this.beforeShowEvent.subscribe(this._shadowBeforeShow);}}else{if(!A8){this.beforeShowEvent.unsubscribe(this._shadowBeforeShow);this._removeShadow();}}},initEvents:function(){r.superclass.initEvents.call(this);var A6=Ab.length-1,A7,A5;do{A7=Ab[A6];A5=this.createEvent(A7[1]);A5.signature=F.LIST;this[A7[0]]=A5;}while(A6--);},positionOffScreen:function(){var A6=this.iframe,A7=this.element,A5=this.OFF_SCREEN_POSITION;A7.style.top=u;A7.style.left=u;if(A6){A6.style.top=A5;A6.style.left=A5;}},getRoot:function(){var A7=this.parent,A6,A5;if(A7){A6=A7.parent;A5=A6?A6.getRoot():this;}else{A5=this;}return A5;},toString:function(){var A6=Aq,A5=this.id;if(A5){A6+=(A1+A5);}return A6;},setItemGroupTitle:function(BA,A9){var A8,A7,A6,A5;if(AM.isString(BA)&&BA.length>0){A8=AM.isNumber(A9)?A9:0;A7=this._aGroupTitleElements[A8];if(A7){A7.innerHTML=BA;}else{A7=document.createElement(this.GROUP_TITLE_TAG_NAME);A7.innerHTML=BA;this._aGroupTitleElements[A8]=A7;}A6=this._aGroupTitleElements.length-1;do{if(this._aGroupTitleElements[A6]){f.removeClass(this._aGroupTitleElements[A6],AJ);A5=A6;}}while(A6--);if(A5!==null){f.addClass(this._aGroupTitleElements[A5],AJ);}this.changeContentEvent.fire();}},addItem:function(A5,A6){return this._addItemToGroup(A6,A5);},addItems:function(A9,A8){var BB,A5,BA,A6,A7;if(AM.isArray(A9)){BB=A9.length;A5=[];for(A6=0;A6<BB;A6++){BA=A9[A6];if(BA){if(AM.isArray(BA)){A5[A5.length]=this.addItems(BA,A6);}else{A5[A5.length]=this._addItemToGroup(A8,BA);}}}if(A5.length){A7=A5;}}return A7;},insertItem:function(A5,A6,A7){return this._addItemToGroup(A7,A5,A6);},removeItem:function(A5,A7){var A8,A6;if(!AM.isUndefined(A5)){if(A5 instanceof YAHOO.widget.MenuItem){A8=this._removeItemFromGroupByValue(A7,A5);}else{if(AM.isNumber(A5)){A8=this._removeItemFromGroupByIndex(A7,A5);}}if(A8){A8.destroy();A6=A8;}}return A6;},getItems:function(){var A8=this._aItemGroups,A6,A7,A5=[];if(AM.isArray(A8)){A6=A8.length;A7=((A6==1)?A8[0]:(Array.prototype.concat.apply(A5,A8)));}return A7;},getItemGroups:function(){return this._aItemGroups;},getItem:function(A6,A7){var A8,A5;if(AM.isNumber(A6)){A8=this._getItemGroup(A7);if(A8){A5=A8[A6];}}return A5;},getSubmenus:function(){var A6=this.getItems(),BA=A6.length,A5,A7,A9,A8;if(BA>0){A5=[];for(A8=0;A8<BA;A8++){A9=A6[A8];if(A9){A7=A9.cfg.getProperty(O);if(A7){A5[A5.length]=A7;}}}}return A5;},clearContent:function(){var A9=this.getItems(),A6=A9.length,A7=this.element,A8=this.body,BD=this.header,A5=this.footer,BC,BB,BA;if(A6>0){BA=A6-1;do{BC=A9[BA];if(BC){BB=BC.cfg.getProperty(O);if(BB){this.cfg.configChangedEvent.unsubscribe(this._onParentMenuConfigChange,BB);this.renderEvent.unsubscribe(this._onParentMenuRender,BB);}this.removeItem(BC,BC.groupIndex);}}while(BA--);}if(BD){AA.purgeElement(BD);A7.removeChild(BD);}if(A5){AA.purgeElement(A5);A7.removeChild(A5);}if(A8){AA.purgeElement(A8);A8.innerHTML=u;}this.activeItem=null;this._aItemGroups=[];this._aListElements=[];this._aGroupTitleElements=[];this.cfg.setProperty(U,null);},destroy:function(A5){this.clearContent();this._aItemGroups=null;this._aListElements=null;this._aGroupTitleElements=null;r.superclass.destroy.call(this,A5);},setInitialFocus:function(){var A5=this._getFirstEnabledItem();if(A5){A5.focus();}},setInitialSelection:function(){var A5=this._getFirstEnabledItem();if(A5){A5.cfg.setProperty(y,true);}},clearActiveItem:function(A7){if(this.cfg.getProperty(Av)>0){this._cancelShowDelay();}var A5=this.activeItem,A8,A6;if(A5){A8=A5.cfg;if(A7){A5.blur();this.getRoot()._hasFocus=true;}A8.setProperty(y,false);A6=A8.getProperty(O);if(A6){A6.hide();}this.activeItem=null;}},focus:function(){if(!this.hasFocus()){this.setInitialFocus();}},blur:function(){var A5;if(this.hasFocus()){A5=A3.getFocusedMenuItem();if(A5){A5.blur();}}},hasFocus:function(){return(A3.getFocusedMenu()==this.getRoot());
},_doItemSubmenuSubscribe:function(A6,A5,A8){var A9=A5[0],A7=A9.cfg.getProperty(O);if(A7){A7.subscribe.apply(A7,A8);}},_doSubmenuSubscribe:function(A6,A5,A8){var A7=this.cfg.getProperty(O);if(A7){A7.subscribe.apply(A7,A8);}},subscribe:function(){r.superclass.subscribe.apply(this,arguments);r.superclass.subscribe.call(this,AR,this._doItemSubmenuSubscribe,arguments);var A5=this.getItems(),A9,A8,A6,A7;if(A5){A9=A5.length;if(A9>0){A7=A9-1;do{A8=A5[A7];A6=A8.cfg.getProperty(O);if(A6){A6.subscribe.apply(A6,arguments);}else{A8.cfg.subscribeToConfigEvent(O,this._doSubmenuSubscribe,arguments);}}while(A7--);}}},unsubscribe:function(){r.superclass.unsubscribe.apply(this,arguments);r.superclass.unsubscribe.call(this,AR,this._doItemSubmenuSubscribe,arguments);var A5=this.getItems(),A9,A8,A6,A7;if(A5){A9=A5.length;if(A9>0){A7=A9-1;do{A8=A5[A7];A6=A8.cfg.getProperty(O);if(A6){A6.unsubscribe.apply(A6,arguments);}else{A8.cfg.unsubscribeFromConfigEvent(O,this._doSubmenuSubscribe,arguments);}}while(A7--);}}},initDefaultConfig:function(){r.superclass.initDefaultConfig.call(this);var A5=this.cfg;A5.addProperty(AZ.key,{handler:this.configVisible,value:AZ.value,validator:AZ.validator});A5.addProperty(AP.key,{handler:this.configConstrainToViewport,value:AP.value,validator:AP.validator,supercedes:AP.supercedes});A5.addProperty(AI.key,{value:AI.value,validator:AI.validator,supercedes:AI.supercedes});A5.addProperty(S.key,{handler:this.configPosition,value:S.value,validator:S.validator,supercedes:S.supercedes});A5.addProperty(A.key,{value:A.value,suppressEvent:A.suppressEvent});A5.addProperty(t.key,{value:t.value,validator:t.validator,suppressEvent:t.suppressEvent});A5.addProperty(Y.key,{value:Y.value,validator:Y.validator,suppressEvent:Y.suppressEvent});A5.addProperty(q.key,{handler:this.configHideDelay,value:q.value,validator:q.validator,suppressEvent:q.suppressEvent});A5.addProperty(v.key,{value:v.value,validator:v.validator,suppressEvent:v.suppressEvent});A5.addProperty(o.key,{value:o.value,validator:o.validator,suppressEvent:o.suppressEvent});A5.addProperty(AN.key,{handler:this.configContainer,value:document.body,suppressEvent:AN.suppressEvent});A5.addProperty(Af.key,{value:Af.value,validator:Af.validator,supercedes:Af.supercedes,suppressEvent:Af.suppressEvent});A5.addProperty(N.key,{value:N.value,validator:N.validator,supercedes:N.supercedes,suppressEvent:N.suppressEvent});A5.addProperty(X.key,{handler:this.configMaxHeight,value:X.value,validator:X.validator,suppressEvent:X.suppressEvent,supercedes:X.supercedes});A5.addProperty(W.key,{handler:this.configClassName,value:W.value,validator:W.validator,supercedes:W.supercedes});A5.addProperty(a.key,{handler:this.configDisabled,value:a.value,validator:a.validator,suppressEvent:a.suppressEvent});A5.addProperty(I.key,{handler:this.configShadow,value:I.value,validator:I.validator});A5.addProperty(Al.key,{value:Al.value,validator:Al.validator});}});})();(function(){YAHOO.widget.MenuItem=function(AS,AR){if(AS){if(AR){this.parent=AR.parent;this.value=AR.value;this.id=AR.id;}this.init(AS,AR);}};var x=YAHOO.util.Dom,j=YAHOO.widget.Module,AB=YAHOO.widget.Menu,c=YAHOO.widget.MenuItem,AK=YAHOO.util.CustomEvent,k=YAHOO.env.ua,AQ=YAHOO.lang,AL="text",O="#",Q="-",L="helptext",n="url",AH="target",A="emphasis",N="strongemphasis",b="checked",w="submenu",H="disabled",B="selected",P="hassubmenu",U="checked-disabled",AI="hassubmenu-disabled",AD="hassubmenu-selected",T="checked-selected",q="onclick",J="classname",AJ="",i="OPTION",v="OPTGROUP",K="LI",AE="href",r="SELECT",X="DIV",AN='<em class="helptext">',a="<em>",I="</em>",W="<strong>",y="</strong>",Y="preventcontextoverlap",h="obj",AG="scope",t="none",V="visible",E=" ",m="MenuItem",AA="click",D="show",M="hide",S="li",AF='<a href="#"></a>',p=[["mouseOverEvent","mouseover"],["mouseOutEvent","mouseout"],["mouseDownEvent","mousedown"],["mouseUpEvent","mouseup"],["clickEvent",AA],["keyPressEvent","keypress"],["keyDownEvent","keydown"],["keyUpEvent","keyup"],["focusEvent","focus"],["blurEvent","blur"],["destroyEvent","destroy"]],o={key:AL,value:AJ,validator:AQ.isString,suppressEvent:true},s={key:L,supercedes:[AL],suppressEvent:true},G={key:n,value:O,suppressEvent:true},AO={key:AH,suppressEvent:true},AP={key:A,value:false,validator:AQ.isBoolean,suppressEvent:true,supercedes:[AL]},d={key:N,value:false,validator:AQ.isBoolean,suppressEvent:true,supercedes:[AL]},l={key:b,value:false,validator:AQ.isBoolean,suppressEvent:true,supercedes:[H,B]},F={key:w,suppressEvent:true,supercedes:[H,B]},AM={key:H,value:false,validator:AQ.isBoolean,suppressEvent:true,supercedes:[AL,B]},f={key:B,value:false,validator:AQ.isBoolean,suppressEvent:true},u={key:q,suppressEvent:true},AC={key:J,value:null,validator:AQ.isString,suppressEvent:true},z={key:"keylistener",value:null,suppressEvent:true},C=null,e={};var Z=function(AU,AT){var AR=e[AU];if(!AR){e[AU]={};AR=e[AU];}var AS=AR[AT];if(!AS){AS=AU+Q+AT;AR[AT]=AS;}return AS;};var g=function(AR){x.addClass(this.element,Z(this.CSS_CLASS_NAME,AR));x.addClass(this._oAnchor,Z(this.CSS_LABEL_CLASS_NAME,AR));};var R=function(AR){x.removeClass(this.element,Z(this.CSS_CLASS_NAME,AR));x.removeClass(this._oAnchor,Z(this.CSS_LABEL_CLASS_NAME,AR));};c.prototype={CSS_CLASS_NAME:"yuimenuitem",CSS_LABEL_CLASS_NAME:"yuimenuitemlabel",SUBMENU_TYPE:null,_oAnchor:null,_oHelpTextEM:null,_oSubmenu:null,_oOnclickAttributeValue:null,_sClassName:null,constructor:c,index:null,groupIndex:null,parent:null,element:null,srcElement:null,value:null,browser:j.prototype.browser,id:null,init:function(AR,Ab){if(!this.SUBMENU_TYPE){this.SUBMENU_TYPE=AB;}this.cfg=new YAHOO.util.Config(this);this.initDefaultConfig();var AX=this.cfg,AY=O,AT,Aa,AZ,AS,AV,AU,AW;if(AQ.isString(AR)){this._createRootNodeStructure();AX.queueProperty(AL,AR);}else{if(AR&&AR.tagName){switch(AR.tagName.toUpperCase()){case i:this._createRootNodeStructure();AX.queueProperty(AL,AR.text);AX.queueProperty(H,AR.disabled);this.value=AR.value;this.srcElement=AR;break;case v:this._createRootNodeStructure();
AX.queueProperty(AL,AR.label);AX.queueProperty(H,AR.disabled);this.srcElement=AR;this._initSubTree();break;case K:AZ=x.getFirstChild(AR);if(AZ){AY=AZ.getAttribute(AE,2);AS=AZ.getAttribute(AH);AV=AZ.innerHTML;}this.srcElement=AR;this.element=AR;this._oAnchor=AZ;AX.setProperty(AL,AV,true);AX.setProperty(n,AY,true);AX.setProperty(AH,AS,true);this._initSubTree();break;}}}if(this.element){AU=(this.srcElement||this.element).id;if(!AU){AU=this.id||x.generateId();this.element.id=AU;}this.id=AU;x.addClass(this.element,this.CSS_CLASS_NAME);x.addClass(this._oAnchor,this.CSS_LABEL_CLASS_NAME);AW=p.length-1;do{Aa=p[AW];AT=this.createEvent(Aa[1]);AT.signature=AK.LIST;this[Aa[0]]=AT;}while(AW--);if(Ab){AX.applyConfig(Ab);}AX.fireQueue();}},_createRootNodeStructure:function(){var AR,AS;if(!C){C=document.createElement(S);C.innerHTML=AF;}AR=C.cloneNode(true);AR.className=this.CSS_CLASS_NAME;AS=AR.firstChild;AS.className=this.CSS_LABEL_CLASS_NAME;this.element=AR;this._oAnchor=AS;},_initSubTree:function(){var AX=this.srcElement,AT=this.cfg,AV,AU,AS,AR,AW;if(AX.childNodes.length>0){if(this.parent.lazyLoad&&this.parent.srcElement&&this.parent.srcElement.tagName.toUpperCase()==r){AT.setProperty(w,{id:x.generateId(),itemdata:AX.childNodes});}else{AV=AX.firstChild;AU=[];do{if(AV&&AV.tagName){switch(AV.tagName.toUpperCase()){case X:AT.setProperty(w,AV);break;case i:AU[AU.length]=AV;break;}}}while((AV=AV.nextSibling));AS=AU.length;if(AS>0){AR=new this.SUBMENU_TYPE(x.generateId());AT.setProperty(w,AR);for(AW=0;AW<AS;AW++){AR.addItem((new AR.ITEM_TYPE(AU[AW])));}}}}},configText:function(Aa,AT,AV){var AS=AT[0],AU=this.cfg,AY=this._oAnchor,AR=AU.getProperty(L),AZ=AJ,AW=AJ,AX=AJ;if(AS){if(AR){AZ=AN+AR+I;}if(AU.getProperty(A)){AW=a;AX=I;}if(AU.getProperty(N)){AW=W;AX=y;}AY.innerHTML=(AW+AS+AX+AZ);}},configHelpText:function(AT,AS,AR){this.cfg.refireEvent(AL);},configURL:function(AT,AS,AR){var AV=AS[0];if(!AV){AV=O;}var AU=this._oAnchor;if(k.opera){AU.removeAttribute(AE);}AU.setAttribute(AE,AV);},configTarget:function(AU,AT,AS){var AR=AT[0],AV=this._oAnchor;if(AR&&AR.length>0){AV.setAttribute(AH,AR);}else{AV.removeAttribute(AH);}},configEmphasis:function(AT,AS,AR){var AV=AS[0],AU=this.cfg;if(AV&&AU.getProperty(N)){AU.setProperty(N,false);}AU.refireEvent(AL);},configStrongEmphasis:function(AU,AT,AS){var AR=AT[0],AV=this.cfg;if(AR&&AV.getProperty(A)){AV.setProperty(A,false);}AV.refireEvent(AL);},configChecked:function(AT,AS,AR){var AV=AS[0],AU=this.cfg;if(AV){g.call(this,b);}else{R.call(this,b);}AU.refireEvent(AL);if(AU.getProperty(H)){AU.refireEvent(H);}if(AU.getProperty(B)){AU.refireEvent(B);}},configDisabled:function(AT,AS,AR){var AV=AS[0],AW=this.cfg,AU=AW.getProperty(w),AX=AW.getProperty(b);if(AV){if(AW.getProperty(B)){AW.setProperty(B,false);}g.call(this,H);if(AU){g.call(this,AI);}if(AX){g.call(this,U);}}else{R.call(this,H);if(AU){R.call(this,AI);}if(AX){R.call(this,U);}}},configSelected:function(AT,AS,AR){var AX=this.cfg,AW=this._oAnchor,AV=AS[0],AY=AX.getProperty(b),AU=AX.getProperty(w);if(k.opera){AW.blur();}if(AV&&!AX.getProperty(H)){g.call(this,B);if(AU){g.call(this,AD);}if(AY){g.call(this,T);}}else{R.call(this,B);if(AU){R.call(this,AD);}if(AY){R.call(this,T);}}if(this.hasFocus()&&k.opera){AW.focus();}},_onSubmenuBeforeHide:function(AU,AT){var AV=this.parent,AR;function AS(){AV._oAnchor.blur();AR.beforeHideEvent.unsubscribe(AS);}if(AV.hasFocus()){AR=AV.parent;AR.beforeHideEvent.subscribe(AS);}},configSubmenu:function(AY,AT,AW){var AV=AT[0],AU=this.cfg,AS=this.parent&&this.parent.lazyLoad,AX,AZ,AR;if(AV){if(AV instanceof AB){AX=AV;AX.parent=this;AX.lazyLoad=AS;}else{if(AQ.isObject(AV)&&AV.id&&!AV.nodeType){AZ=AV.id;AR=AV;AR.lazyload=AS;AR.parent=this;AX=new this.SUBMENU_TYPE(AZ,AR);AU.setProperty(w,AX,true);}else{AX=new this.SUBMENU_TYPE(AV,{lazyload:AS,parent:this});AU.setProperty(w,AX,true);}}if(AX){AX.cfg.setProperty(Y,true);g.call(this,P);if(AU.getProperty(n)===O){AU.setProperty(n,(O+AX.id));}this._oSubmenu=AX;if(k.opera){AX.beforeHideEvent.subscribe(this._onSubmenuBeforeHide);}}}else{R.call(this,P);if(this._oSubmenu){this._oSubmenu.destroy();}}if(AU.getProperty(H)){AU.refireEvent(H);}if(AU.getProperty(B)){AU.refireEvent(B);}},configOnClick:function(AT,AS,AR){var AU=AS[0];if(this._oOnclickAttributeValue&&(this._oOnclickAttributeValue!=AU)){this.clickEvent.unsubscribe(this._oOnclickAttributeValue.fn,this._oOnclickAttributeValue.obj);this._oOnclickAttributeValue=null;}if(!this._oOnclickAttributeValue&&AQ.isObject(AU)&&AQ.isFunction(AU.fn)){this.clickEvent.subscribe(AU.fn,((h in AU)?AU.obj:this),((AG in AU)?AU.scope:null));this._oOnclickAttributeValue=AU;}},configClassName:function(AU,AT,AS){var AR=AT[0];if(this._sClassName){x.removeClass(this.element,this._sClassName);}x.addClass(this.element,AR);this._sClassName=AR;},_dispatchClickEvent:function(){var AS=this,AR;if(!AS.cfg.getProperty(H)){AR=x.getFirstChild(AS.element);this._dispatchDOMClick(AR);}},_dispatchDOMClick:function(AS){var AR;if(k.ie&&k.ie<9){AS.fireEvent(q);}else{if((k.gecko&&k.gecko>=1.9)||k.opera||k.webkit){AR=document.createEvent("HTMLEvents");AR.initEvent(AA,true,true);}else{AR=document.createEvent("MouseEvents");AR.initMouseEvent(AA,true,true,window,0,0,0,0,0,false,false,false,false,0,null);}AS.dispatchEvent(AR);}},_createKeyListener:function(AU,AT,AW){var AV=this,AS=AV.parent;var AR=new YAHOO.util.KeyListener(AS.element.ownerDocument,AW,{fn:AV._dispatchClickEvent,scope:AV,correctScope:true});if(AS.cfg.getProperty(V)){AR.enable();}AS.subscribe(D,AR.enable,null,AR);AS.subscribe(M,AR.disable,null,AR);AV._keyListener=AR;AS.unsubscribe(D,AV._createKeyListener,AW);},configKeyListener:function(AT,AS){var AV=AS[0],AU=this,AR=AU.parent;if(AU._keyData){AR.unsubscribe(D,AU._createKeyListener,AU._keyData);AU._keyData=null;}if(AU._keyListener){AR.unsubscribe(D,AU._keyListener.enable);AR.unsubscribe(M,AU._keyListener.disable);AU._keyListener.disable();AU._keyListener=null;}if(AV){AU._keyData=AV;AR.subscribe(D,AU._createKeyListener,AV,AU);}},initDefaultConfig:function(){var AR=this.cfg;
AR.addProperty(o.key,{handler:this.configText,value:o.value,validator:o.validator,suppressEvent:o.suppressEvent});AR.addProperty(s.key,{handler:this.configHelpText,supercedes:s.supercedes,suppressEvent:s.suppressEvent});AR.addProperty(G.key,{handler:this.configURL,value:G.value,suppressEvent:G.suppressEvent});AR.addProperty(AO.key,{handler:this.configTarget,suppressEvent:AO.suppressEvent});AR.addProperty(AP.key,{handler:this.configEmphasis,value:AP.value,validator:AP.validator,suppressEvent:AP.suppressEvent,supercedes:AP.supercedes});AR.addProperty(d.key,{handler:this.configStrongEmphasis,value:d.value,validator:d.validator,suppressEvent:d.suppressEvent,supercedes:d.supercedes});AR.addProperty(l.key,{handler:this.configChecked,value:l.value,validator:l.validator,suppressEvent:l.suppressEvent,supercedes:l.supercedes});AR.addProperty(AM.key,{handler:this.configDisabled,value:AM.value,validator:AM.validator,suppressEvent:AM.suppressEvent});AR.addProperty(f.key,{handler:this.configSelected,value:f.value,validator:f.validator,suppressEvent:f.suppressEvent});AR.addProperty(F.key,{handler:this.configSubmenu,supercedes:F.supercedes,suppressEvent:F.suppressEvent});AR.addProperty(u.key,{handler:this.configOnClick,suppressEvent:u.suppressEvent});AR.addProperty(AC.key,{handler:this.configClassName,value:AC.value,validator:AC.validator,suppressEvent:AC.suppressEvent});AR.addProperty(z.key,{handler:this.configKeyListener,value:z.value,suppressEvent:z.suppressEvent});},getNextSibling:function(){var AR=function(AX){return(AX.nodeName.toLowerCase()==="ul");},AV=this.element,AU=x.getNextSibling(AV),AT,AS,AW;if(!AU){AT=AV.parentNode;AS=x.getNextSiblingBy(AT,AR);if(AS){AW=AS;}else{AW=x.getFirstChildBy(AT.parentNode,AR);}AU=x.getFirstChild(AW);}return YAHOO.widget.MenuManager.getMenuItem(AU.id);},getNextEnabledSibling:function(){var AR=this.getNextSibling();return(AR.cfg.getProperty(H)||AR.element.style.display==t)?AR.getNextEnabledSibling():AR;},getPreviousSibling:function(){var AR=function(AX){return(AX.nodeName.toLowerCase()==="ul");},AV=this.element,AU=x.getPreviousSibling(AV),AT,AS,AW;if(!AU){AT=AV.parentNode;AS=x.getPreviousSiblingBy(AT,AR);if(AS){AW=AS;}else{AW=x.getLastChildBy(AT.parentNode,AR);}AU=x.getLastChild(AW);}return YAHOO.widget.MenuManager.getMenuItem(AU.id);},getPreviousEnabledSibling:function(){var AR=this.getPreviousSibling();return(AR.cfg.getProperty(H)||AR.element.style.display==t)?AR.getPreviousEnabledSibling():AR;},focus:function(){var AU=this.parent,AT=this._oAnchor,AR=AU.activeItem;function AS(){try{if(!(k.ie&&!document.hasFocus())){if(AR){AR.blurEvent.fire();}AT.focus();this.focusEvent.fire();}}catch(AV){}}if(!this.cfg.getProperty(H)&&AU&&AU.cfg.getProperty(V)&&this.element.style.display!=t){AQ.later(0,this,AS);}},blur:function(){var AR=this.parent;if(!this.cfg.getProperty(H)&&AR&&AR.cfg.getProperty(V)){AQ.later(0,this,function(){try{this._oAnchor.blur();this.blurEvent.fire();}catch(AS){}},0);}},hasFocus:function(){return(YAHOO.widget.MenuManager.getFocusedMenuItem()==this);},destroy:function(){var AT=this.element,AS,AR,AV,AU;if(AT){AS=this.cfg.getProperty(w);if(AS){AS.destroy();}AR=AT.parentNode;if(AR){AR.removeChild(AT);this.destroyEvent.fire();}AU=p.length-1;do{AV=p[AU];this[AV[0]].unsubscribeAll();}while(AU--);this.cfg.configChangedEvent.unsubscribeAll();}},toString:function(){var AS=m,AR=this.id;if(AR){AS+=(E+AR);}return AS;}};AQ.augmentProto(c,YAHOO.util.EventProvider);})();(function(){var B="xy",C="mousedown",F="ContextMenu",J=" ";YAHOO.widget.ContextMenu=function(L,K){YAHOO.widget.ContextMenu.superclass.constructor.call(this,L,K);};var I=YAHOO.util.Event,E=YAHOO.env.ua,G=YAHOO.widget.ContextMenu,A={"TRIGGER_CONTEXT_MENU":"triggerContextMenu","CONTEXT_MENU":(E.opera?C:"contextmenu"),"CLICK":"click"},H={key:"trigger",suppressEvent:true};function D(L,K,M){this.cfg.setProperty(B,M);this.beforeShowEvent.unsubscribe(D,M);}YAHOO.lang.extend(G,YAHOO.widget.Menu,{_oTrigger:null,_bCancelled:false,contextEventTarget:null,triggerContextMenuEvent:null,init:function(L,K){G.superclass.init.call(this,L);this.beforeInitEvent.fire(G);if(K){this.cfg.applyConfig(K,true);}this.initEvent.fire(G);},initEvents:function(){G.superclass.initEvents.call(this);this.triggerContextMenuEvent=this.createEvent(A.TRIGGER_CONTEXT_MENU);this.triggerContextMenuEvent.signature=YAHOO.util.CustomEvent.LIST;},cancel:function(){this._bCancelled=true;},_removeEventHandlers:function(){var K=this._oTrigger;if(K){I.removeListener(K,A.CONTEXT_MENU,this._onTriggerContextMenu);if(E.opera){I.removeListener(K,A.CLICK,this._onTriggerClick);}}},_onTriggerClick:function(L,K){if(L.ctrlKey){I.stopEvent(L);}},_onTriggerContextMenu:function(M,K){var L;if(!(M.type==C&&!M.ctrlKey)){this.contextEventTarget=I.getTarget(M);this.triggerContextMenuEvent.fire(M);if(!this._bCancelled){I.stopEvent(M);YAHOO.widget.MenuManager.hideVisible();L=I.getXY(M);if(!YAHOO.util.Dom.inDocument(this.element)){this.beforeShowEvent.subscribe(D,L);}else{this.cfg.setProperty(B,L);}this.show();}this._bCancelled=false;}},toString:function(){var L=F,K=this.id;if(K){L+=(J+K);}return L;},initDefaultConfig:function(){G.superclass.initDefaultConfig.call(this);this.cfg.addProperty(H.key,{handler:this.configTrigger,suppressEvent:H.suppressEvent});},destroy:function(K){this._removeEventHandlers();G.superclass.destroy.call(this,K);},configTrigger:function(L,K,N){var M=K[0];if(M){if(this._oTrigger){this._removeEventHandlers();}this._oTrigger=M;I.on(M,A.CONTEXT_MENU,this._onTriggerContextMenu,this,true);if(E.opera){I.on(M,A.CLICK,this._onTriggerClick,this,true);}}else{this._removeEventHandlers();}}});}());YAHOO.widget.ContextMenuItem=YAHOO.widget.MenuItem;(function(){var D=YAHOO.lang,N="static",M="dynamic,"+N,A="disabled",F="selected",B="autosubmenudisplay",G="submenu",C="visible",Q=" ",H="submenutoggleregion",P="MenuBar";YAHOO.widget.MenuBar=function(T,S){YAHOO.widget.MenuBar.superclass.constructor.call(this,T,S);};function O(T){var S=false;if(D.isString(T)){S=(M.indexOf((T.toLowerCase()))!=-1);
}return S;}var R=YAHOO.util.Event,L=YAHOO.widget.MenuBar,K={key:"position",value:N,validator:O,supercedes:[C]},E={key:"submenualignment",value:["tl","bl"]},J={key:B,value:false,validator:D.isBoolean,suppressEvent:true},I={key:H,value:false,validator:D.isBoolean};D.extend(L,YAHOO.widget.Menu,{init:function(T,S){if(!this.ITEM_TYPE){this.ITEM_TYPE=YAHOO.widget.MenuBarItem;}L.superclass.init.call(this,T);this.beforeInitEvent.fire(L);if(S){this.cfg.applyConfig(S,true);}this.initEvent.fire(L);},CSS_CLASS_NAME:"yuimenubar",SUBMENU_TOGGLE_REGION_WIDTH:20,_onKeyDown:function(U,T,Y){var S=T[0],Z=T[1],W,X,V;if(Z&&!Z.cfg.getProperty(A)){X=Z.cfg;switch(S.keyCode){case 37:case 39:if(Z==this.activeItem&&!X.getProperty(F)){X.setProperty(F,true);}else{V=(S.keyCode==37)?Z.getPreviousEnabledSibling():Z.getNextEnabledSibling();if(V){this.clearActiveItem();V.cfg.setProperty(F,true);W=V.cfg.getProperty(G);if(W){W.show();W.setInitialFocus();}else{V.focus();}}}R.preventDefault(S);break;case 40:if(this.activeItem!=Z){this.clearActiveItem();X.setProperty(F,true);Z.focus();}W=X.getProperty(G);if(W){if(W.cfg.getProperty(C)){W.setInitialSelection();W.setInitialFocus();}else{W.show();W.setInitialFocus();}}R.preventDefault(S);break;}}if(S.keyCode==27&&this.activeItem){W=this.activeItem.cfg.getProperty(G);if(W&&W.cfg.getProperty(C)){W.hide();this.activeItem.focus();}else{this.activeItem.cfg.setProperty(F,false);this.activeItem.blur();}R.preventDefault(S);}},_onClick:function(e,Y,b){L.superclass._onClick.call(this,e,Y,b);var d=Y[1],T=true,S,f,U,W,Z,a,c,V;var X=function(){if(a.cfg.getProperty(C)){a.hide();}else{a.show();}};if(d&&!d.cfg.getProperty(A)){f=Y[0];U=R.getTarget(f);W=this.activeItem;Z=this.cfg;if(W&&W!=d){this.clearActiveItem();}d.cfg.setProperty(F,true);a=d.cfg.getProperty(G);if(a){S=d.element;c=YAHOO.util.Dom.getX(S);V=c+(S.offsetWidth-this.SUBMENU_TOGGLE_REGION_WIDTH);if(Z.getProperty(H)){if(R.getPageX(f)>V){X();R.preventDefault(f);T=false;}}else{X();}}}return T;},configSubmenuToggle:function(U,T){var S=T[0];if(S){this.cfg.setProperty(B,false);}},toString:function(){var T=P,S=this.id;if(S){T+=(Q+S);}return T;},initDefaultConfig:function(){L.superclass.initDefaultConfig.call(this);var S=this.cfg;S.addProperty(K.key,{handler:this.configPosition,value:K.value,validator:K.validator,supercedes:K.supercedes});S.addProperty(E.key,{value:E.value,suppressEvent:E.suppressEvent});S.addProperty(J.key,{value:J.value,validator:J.validator,suppressEvent:J.suppressEvent});S.addProperty(I.key,{value:I.value,validator:I.validator,handler:this.configSubmenuToggle});}});}());YAHOO.widget.MenuBarItem=function(B,A){YAHOO.widget.MenuBarItem.superclass.constructor.call(this,B,A);};YAHOO.lang.extend(YAHOO.widget.MenuBarItem,YAHOO.widget.MenuItem,{init:function(B,A){if(!this.SUBMENU_TYPE){this.SUBMENU_TYPE=YAHOO.widget.Menu;}YAHOO.widget.MenuBarItem.superclass.init.call(this,B);var C=this.cfg;if(A){C.applyConfig(A,true);}C.fireQueue();},CSS_CLASS_NAME:"yuimenubaritem",CSS_LABEL_CLASS_NAME:"yuimenubaritemlabel",toString:function(){var A="MenuBarItem";if(this.cfg&&this.cfg.getProperty("text")){A+=(": "+this.cfg.getProperty("text"));}return A;}});YAHOO.register("menu",YAHOO.widget.Menu,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: tabview-min.js (213744dd) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
(function(){var b=YAHOO.util,c=b.Dom,i=b.Event,g=window.document,k="active",d="activeIndex",f="activeTab",e="disabled",a="contentEl",h="element",j=function(m,l){l=l||{};if(arguments.length==1&&!YAHOO.lang.isString(m)&&!m.nodeName){l=m;m=l.element||null;}if(!m&&!l.element){m=this._createTabViewElement(l);}j.superclass.constructor.call(this,m,l);};YAHOO.extend(j,b.Element,{CLASSNAME:"yui-navset",TAB_PARENT_CLASSNAME:"yui-nav",CONTENT_PARENT_CLASSNAME:"yui-content",_tabParent:null,_contentParent:null,addTab:function(n,o){var p=this.get("tabs"),s=this._tabParent,q=this._contentParent,l=n.get(h),m=n.get(a),t=this.get(d),r;if(!p){this._queue[this._queue.length]=["addTab",arguments];return false;}r=this.getTab(o);o=(o===undefined)?p.length:o;p.splice(o,0,n);if(r){s.insertBefore(l,r.get(h));if(m){q.appendChild(m);}}else{s.appendChild(l);if(m){q.appendChild(m);}}if(!n.get(k)){n.set("contentVisible",false,true);if(o<=t){this.set(d,t+1,true);}}else{this.set(f,n,true);this.set("activeIndex",o,true);}this._initTabEvents(n);},_initTabEvents:function(l){l.addListener(l.get("activationEvent"),l._onActivate,this,l);l.addListener("activationEventChange",l._onActivationEventChange,this,l);},_removeTabEvents:function(l){l.removeListener(l.get("activationEvent"),l._onActivate,this,l);l.removeListener("activationEventChange",l._onActivationEventChange,this,l);},DOMEventHandler:function(q){var r=i.getTarget(q),t=this._tabParent,s=this.get("tabs"),n,m,l;if(c.isAncestor(t,r)){for(var o=0,p=s.length;o<p;o++){m=s[o].get(h);l=s[o].get(a);if(r==m||c.isAncestor(m,r)){n=s[o];break;}}if(n){n.fireEvent(q.type,q);}}},getTab:function(l){return this.get("tabs")[l];},getTabIndex:function(p){var m=null,o=this.get("tabs");for(var n=0,l=o.length;n<l;++n){if(p==o[n]){m=n;break;}}return m;},removeTab:function(o){var n=this.get("tabs").length,l=this.get(d),m=this.getTabIndex(o);if(o===this.get(f)){if(n>1){if(m+1===n){this.set(d,m-1);}else{this.set(d,m+1);}}else{this.set(f,null);}}else{if(m<l){this.set(d,l-1,true);}}this._removeTabEvents(o);this._tabParent.removeChild(o.get(h));this._contentParent.removeChild(o.get(a));this._configs.tabs.value.splice(m,1);o.fireEvent("remove",{type:"remove",tabview:this});},toString:function(){var l=this.get("id")||this.get("tagName");return"TabView "+l;},contentTransition:function(m,l){if(m){m.set("contentVisible",true);}if(l){l.set("contentVisible",false);}},initAttributes:function(l){j.superclass.initAttributes.call(this,l);if(!l.orientation){l.orientation="top";}var n=this.get(h);if(!this.hasClass(this.CLASSNAME)){this.addClass(this.CLASSNAME);}this.setAttributeConfig("tabs",{value:[],readOnly:true});this._tabParent=this.getElementsByClassName(this.TAB_PARENT_CLASSNAME,"ul")[0]||this._createTabParent();this._contentParent=this.getElementsByClassName(this.CONTENT_PARENT_CLASSNAME,"div")[0]||this._createContentParent();this.setAttributeConfig("orientation",{value:l.orientation,method:function(o){var p=this.get("orientation");this.addClass("yui-navset-"+o);if(p!=o){this.removeClass("yui-navset-"+p);}if(o==="bottom"){this.appendChild(this._tabParent);}}});this.setAttributeConfig(d,{value:l.activeIndex,validator:function(q){var o=true,p;if(q){p=this.getTab(q);if(p&&p.get(e)){o=false;}}return o;}});this.setAttributeConfig(f,{value:l[f],method:function(p){var o=this.get(f);if(p){p.set(k,true);}if(o&&o!==p){o.set(k,false);}if(o&&p!==o){this.contentTransition(p,o);}else{if(p){p.set("contentVisible",true);}}},validator:function(p){var o=true;if(p&&p.get(e)){o=false;}return o;}});this.on("activeTabChange",this._onActiveTabChange);this.on("activeIndexChange",this._onActiveIndexChange);if(this._tabParent){this._initTabs();}this.DOM_EVENTS.submit=false;this.DOM_EVENTS.focus=false;this.DOM_EVENTS.blur=false;this.DOM_EVENTS.change=false;for(var m in this.DOM_EVENTS){if(YAHOO.lang.hasOwnProperty(this.DOM_EVENTS,m)){this.addListener.call(this,m,this.DOMEventHandler);}}},deselectTab:function(l){if(this.getTab(l)===this.get(f)){this.set(f,null);}},selectTab:function(l){this.set(f,this.getTab(l));},_onActiveTabChange:function(n){var l=this.get(d),m=this.getTabIndex(n.newValue);if(l!==m){if(!(this.set(d,m))){this.set(f,n.prevValue);}}},_onActiveIndexChange:function(l){if(l.newValue!==this.getTabIndex(this.get(f))){if(!(this.set(f,this.getTab(l.newValue)))){this.set(d,l.prevValue);}}},_initTabs:function(){var q=c.getChildren(this._tabParent),o=c.getChildren(this._contentParent),n=this.get(d),r,m,s;for(var p=0,l=q.length;p<l;++p){m={};if(o[p]){m.contentEl=o[p];}r=new YAHOO.widget.Tab(q[p],m);this.addTab(r);if(r.hasClass(r.ACTIVE_CLASSNAME)){s=r;}}if(n!=undefined){this.set(f,this.getTab(n));}else{this._configs[f].value=s;this._configs[d].value=this.getTabIndex(s);}},_createTabViewElement:function(l){var m=g.createElement("div");if(this.CLASSNAME){m.className=this.CLASSNAME;}return m;},_createTabParent:function(l){var m=g.createElement("ul");if(this.TAB_PARENT_CLASSNAME){m.className=this.TAB_PARENT_CLASSNAME;}this.get(h).appendChild(m);return m;},_createContentParent:function(l){var m=g.createElement("div");if(this.CONTENT_PARENT_CLASSNAME){m.className=this.CONTENT_PARENT_CLASSNAME;}this.get(h).appendChild(m);return m;}});YAHOO.widget.TabView=j;})();(function(){var d=YAHOO.util,i=d.Dom,l=YAHOO.lang,m="activeTab",j="label",g="labelEl",q="content",c="contentEl",o="element",p="cacheData",b="dataSrc",h="dataLoaded",a="dataTimeout",n="loadMethod",f="postData",k="disabled",e=function(s,r){r=r||{};if(arguments.length==1&&!l.isString(s)&&!s.nodeName){r=s;s=r.element;}if(!s&&!r.element){s=this._createTabElement(r);}this.loadHandler={success:function(t){this.set(q,t.responseText);},failure:function(t){}};e.superclass.constructor.call(this,s,r);this.DOM_EVENTS={};};YAHOO.extend(e,YAHOO.util.Element,{LABEL_TAGNAME:"em",ACTIVE_CLASSNAME:"selected",HIDDEN_CLASSNAME:"yui-hidden",ACTIVE_TITLE:"active",DISABLED_CLASSNAME:k,LOADING_CLASSNAME:"loading",dataConnection:null,loadHandler:null,_loading:false,toString:function(){var r=this.get(o),s=r.id||r.tagName;
return"Tab "+s;},initAttributes:function(r){r=r||{};e.superclass.initAttributes.call(this,r);this.setAttributeConfig("activationEvent",{value:r.activationEvent||"click"});this.setAttributeConfig(g,{value:r[g]||this._getLabelEl(),method:function(s){s=i.get(s);var t=this.get(g);if(t){if(t==s){return false;}t.parentNode.replaceChild(s,t);this.set(j,s.innerHTML);}}});this.setAttributeConfig(j,{value:r.label||this._getLabel(),method:function(t){var s=this.get(g);if(!s){this.set(g,this._createLabelEl());}s.innerHTML=t;}});this.setAttributeConfig(c,{value:r[c]||document.createElement("div"),method:function(s){s=i.get(s);var t=this.get(c);if(t){if(t===s){return false;}if(!this.get("selected")){i.addClass(s,this.HIDDEN_CLASSNAME);}t.parentNode.replaceChild(s,t);this.set(q,s.innerHTML);}}});this.setAttributeConfig(q,{value:r[q]||this.get(c).innerHTML,method:function(s){this.get(c).innerHTML=s;}});this.setAttributeConfig(b,{value:r.dataSrc});this.setAttributeConfig(p,{value:r.cacheData||false,validator:l.isBoolean});this.setAttributeConfig(n,{value:r.loadMethod||"GET",validator:l.isString});this.setAttributeConfig(h,{value:false,validator:l.isBoolean,writeOnce:true});this.setAttributeConfig(a,{value:r.dataTimeout||null,validator:l.isNumber});this.setAttributeConfig(f,{value:r.postData||null});this.setAttributeConfig("active",{value:r.active||this.hasClass(this.ACTIVE_CLASSNAME),method:function(s){if(s===true){this.addClass(this.ACTIVE_CLASSNAME);this.set("title",this.ACTIVE_TITLE);}else{this.removeClass(this.ACTIVE_CLASSNAME);this.set("title","");}},validator:function(s){return l.isBoolean(s)&&!this.get(k);}});this.setAttributeConfig(k,{value:r.disabled||this.hasClass(this.DISABLED_CLASSNAME),method:function(s){if(s===true){this.addClass(this.DISABLED_CLASSNAME);}else{this.removeClass(this.DISABLED_CLASSNAME);}},validator:l.isBoolean});this.setAttributeConfig("href",{value:r.href||this.getElementsByTagName("a")[0].getAttribute("href",2)||"#",method:function(s){this.getElementsByTagName("a")[0].href=s;},validator:l.isString});this.setAttributeConfig("contentVisible",{value:r.contentVisible,method:function(s){if(s){i.removeClass(this.get(c),this.HIDDEN_CLASSNAME);if(this.get(b)){if(!this._loading&&!(this.get(h)&&this.get(p))){this._dataConnect();}}}else{i.addClass(this.get(c),this.HIDDEN_CLASSNAME);}},validator:l.isBoolean});},_dataConnect:function(){if(!d.Connect){return false;}i.addClass(this.get(c).parentNode,this.LOADING_CLASSNAME);this._loading=true;this.dataConnection=d.Connect.asyncRequest(this.get(n),this.get(b),{success:function(r){this.loadHandler.success.call(this,r);this.set(h,true);this.dataConnection=null;i.removeClass(this.get(c).parentNode,this.LOADING_CLASSNAME);this._loading=false;},failure:function(r){this.loadHandler.failure.call(this,r);this.dataConnection=null;i.removeClass(this.get(c).parentNode,this.LOADING_CLASSNAME);this._loading=false;},scope:this,timeout:this.get(a)},this.get(f));},_createTabElement:function(r){var v=document.createElement("li"),s=document.createElement("a"),u=r.label||null,t=r.labelEl||null;s.href=r.href||"#";v.appendChild(s);if(t){if(!u){u=this._getLabel();}}else{t=this._createLabelEl();}s.appendChild(t);return v;},_getLabelEl:function(){return this.getElementsByTagName(this.LABEL_TAGNAME)[0];},_createLabelEl:function(){var r=document.createElement(this.LABEL_TAGNAME);return r;},_getLabel:function(){var r=this.get(g);if(!r){return undefined;}return r.innerHTML;},_onActivate:function(u,t){var s=this,r=false;d.Event.preventDefault(u);if(s===t.get(m)){r=true;}t.set(m,s,r);},_onActivationEventChange:function(s){var r=this;if(s.prevValue!=s.newValue){r.removeListener(s.prevValue,r._onActivate);r.addListener(s.newValue,r._onActivate,this,r);}}});YAHOO.widget.Tab=e;})();YAHOO.register("tabview",YAHOO.widget.TabView,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: slider-min.js (dcc3e909) 9/9/2014 2:09:00 PM */

/*
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
(function(){var B=YAHOO.util.Dom.getXY,A=YAHOO.util.Event,D=Array.prototype.slice;function C(G,E,F,H){C.ANIM_AVAIL=(!YAHOO.lang.isUndefined(YAHOO.util.Anim));if(G){this.init(G,E,true);this.initSlider(H);this.initThumb(F);}}YAHOO.lang.augmentObject(C,{getHorizSlider:function(F,G,I,H,E){return new C(F,F,new YAHOO.widget.SliderThumb(G,F,I,H,0,0,E),"horiz");},getVertSlider:function(G,H,E,I,F){return new C(G,G,new YAHOO.widget.SliderThumb(H,G,0,0,E,I,F),"vert");},getSliderRegion:function(G,H,J,I,E,K,F){return new C(G,G,new YAHOO.widget.SliderThumb(H,G,J,I,E,K,F),"region");},SOURCE_UI_EVENT:1,SOURCE_SET_VALUE:2,SOURCE_KEY_EVENT:3,ANIM_AVAIL:false},true);YAHOO.extend(C,YAHOO.util.DragDrop,{_mouseDown:false,dragOnly:true,initSlider:function(E){this.type=E;this.createEvent("change",this);this.createEvent("slideStart",this);this.createEvent("slideEnd",this);this.isTarget=false;this.animate=C.ANIM_AVAIL;this.backgroundEnabled=true;this.tickPause=40;this.enableKeys=true;this.keyIncrement=20;this.moveComplete=true;this.animationDuration=0.2;this.SOURCE_UI_EVENT=1;this.SOURCE_SET_VALUE=2;this.valueChangeSource=0;this._silent=false;this.lastOffset=[0,0];},initThumb:function(F){var E=this;this.thumb=F;F.cacheBetweenDrags=true;if(F._isHoriz&&F.xTicks&&F.xTicks.length){this.tickPause=Math.round(360/F.xTicks.length);}else{if(F.yTicks&&F.yTicks.length){this.tickPause=Math.round(360/F.yTicks.length);}}F.onAvailable=function(){return E.setStartSliderState();};F.onMouseDown=function(){E._mouseDown=true;return E.focus();};F.startDrag=function(){E._slideStart();};F.onDrag=function(){E.fireEvents(true);};F.onMouseUp=function(){E.thumbMouseUp();};},onAvailable:function(){this._bindKeyEvents();},_bindKeyEvents:function(){A.on(this.id,"keydown",this.handleKeyDown,this,true);A.on(this.id,"keypress",this.handleKeyPress,this,true);},handleKeyPress:function(F){if(this.enableKeys){var E=A.getCharCode(F);switch(E){case 37:case 38:case 39:case 40:case 36:case 35:A.preventDefault(F);break;default:}}},handleKeyDown:function(J){if(this.enableKeys){var G=A.getCharCode(J),F=this.thumb,H=this.getXValue(),E=this.getYValue(),I=true;switch(G){case 37:H-=this.keyIncrement;break;case 38:E-=this.keyIncrement;break;case 39:H+=this.keyIncrement;break;case 40:E+=this.keyIncrement;break;case 36:H=F.leftConstraint;E=F.topConstraint;break;case 35:H=F.rightConstraint;E=F.bottomConstraint;break;default:I=false;}if(I){if(F._isRegion){this._setRegionValue(C.SOURCE_KEY_EVENT,H,E,true);}else{this._setValue(C.SOURCE_KEY_EVENT,(F._isHoriz?H:E),true);}A.stopEvent(J);}}},setStartSliderState:function(){this.setThumbCenterPoint();this.baselinePos=B(this.getEl());this.thumb.startOffset=this.thumb.getOffsetFromParent(this.baselinePos);if(this.thumb._isRegion){if(this.deferredSetRegionValue){this._setRegionValue.apply(this,this.deferredSetRegionValue);this.deferredSetRegionValue=null;}else{this.setRegionValue(0,0,true,true,true);}}else{if(this.deferredSetValue){this._setValue.apply(this,this.deferredSetValue);this.deferredSetValue=null;}else{this.setValue(0,true,true,true);}}},setThumbCenterPoint:function(){var E=this.thumb.getEl();if(E){this.thumbCenterPoint={x:parseInt(E.offsetWidth/2,10),y:parseInt(E.offsetHeight/2,10)};}},lock:function(){this.thumb.lock();this.locked=true;},unlock:function(){this.thumb.unlock();this.locked=false;},thumbMouseUp:function(){this._mouseDown=false;if(!this.isLocked()){this.endMove();}},onMouseUp:function(){this._mouseDown=false;if(this.backgroundEnabled&&!this.isLocked()){this.endMove();}},getThumb:function(){return this.thumb;},focus:function(){this.valueChangeSource=C.SOURCE_UI_EVENT;var E=this.getEl();if(E.focus){try{E.focus();}catch(F){}}this.verifyOffset();return !this.isLocked();},onChange:function(E,F){},onSlideStart:function(){},onSlideEnd:function(){},getValue:function(){return this.thumb.getValue();},getXValue:function(){return this.thumb.getXValue();},getYValue:function(){return this.thumb.getYValue();},setValue:function(){var E=D.call(arguments);E.unshift(C.SOURCE_SET_VALUE);return this._setValue.apply(this,E);},_setValue:function(I,L,G,H,E){var F=this.thumb,K,J;if(!F.available){this.deferredSetValue=arguments;return false;}if(this.isLocked()&&!H){return false;}if(isNaN(L)){return false;}if(F._isRegion){return false;}this._silent=E;this.valueChangeSource=I||C.SOURCE_SET_VALUE;F.lastOffset=[L,L];this.verifyOffset();this._slideStart();if(F._isHoriz){K=F.initPageX+L+this.thumbCenterPoint.x;this.moveThumb(K,F.initPageY,G);}else{J=F.initPageY+L+this.thumbCenterPoint.y;this.moveThumb(F.initPageX,J,G);}return true;},setRegionValue:function(){var E=D.call(arguments);E.unshift(C.SOURCE_SET_VALUE);return this._setRegionValue.apply(this,E);},_setRegionValue:function(F,J,H,I,G,K){var L=this.thumb,E,M;if(!L.available){this.deferredSetRegionValue=arguments;return false;}if(this.isLocked()&&!G){return false;}if(isNaN(J)){return false;}if(!L._isRegion){return false;}this._silent=K;this.valueChangeSource=F||C.SOURCE_SET_VALUE;L.lastOffset=[J,H];this.verifyOffset();this._slideStart();E=L.initPageX+J+this.thumbCenterPoint.x;M=L.initPageY+H+this.thumbCenterPoint.y;this.moveThumb(E,M,I);return true;},verifyOffset:function(){var F=B(this.getEl()),E=this.thumb;if(!this.thumbCenterPoint||!this.thumbCenterPoint.x){this.setThumbCenterPoint();}if(F){if(F[0]!=this.baselinePos[0]||F[1]!=this.baselinePos[1]){this.setInitPosition();this.baselinePos=F;E.initPageX=this.initPageX+E.startOffset[0];E.initPageY=this.initPageY+E.startOffset[1];E.deltaSetXY=null;this.resetThumbConstraints();return false;}}return true;},moveThumb:function(K,J,I,G){var L=this.thumb,M=this,F,E,H;if(!L.available){return;}L.setDelta(this.thumbCenterPoint.x,this.thumbCenterPoint.y);E=L.getTargetCoord(K,J);F=[Math.round(E.x),Math.round(E.y)];if(this.animate&&L._graduated&&!I){this.lock();this.curCoord=B(this.thumb.getEl());this.curCoord=[Math.round(this.curCoord[0]),Math.round(this.curCoord[1])];setTimeout(function(){M.moveOneTick(F);},this.tickPause);}else{if(this.animate&&C.ANIM_AVAIL&&!I){this.lock();
H=new YAHOO.util.Motion(L.id,{points:{to:F}},this.animationDuration,YAHOO.util.Easing.easeOut);H.onComplete.subscribe(function(){M.unlock();if(!M._mouseDown){M.endMove();}});H.animate();}else{L.setDragElPos(K,J);if(!G&&!this._mouseDown){this.endMove();}}}},_slideStart:function(){if(!this._sliding){if(!this._silent){this.onSlideStart();this.fireEvent("slideStart");}this._sliding=true;this.moveComplete=false;}},_slideEnd:function(){if(this._sliding){var E=this._silent;this._sliding=false;this.moveComplete=true;this._silent=false;if(!E){this.onSlideEnd();this.fireEvent("slideEnd");}}},moveOneTick:function(F){var H=this.thumb,G=this,I=null,E,J;if(H._isRegion){I=this._getNextX(this.curCoord,F);E=(I!==null)?I[0]:this.curCoord[0];I=this._getNextY(this.curCoord,F);J=(I!==null)?I[1]:this.curCoord[1];I=E!==this.curCoord[0]||J!==this.curCoord[1]?[E,J]:null;}else{if(H._isHoriz){I=this._getNextX(this.curCoord,F);}else{I=this._getNextY(this.curCoord,F);}}if(I){this.curCoord=I;this.thumb.alignElWithMouse(H.getEl(),I[0]+this.thumbCenterPoint.x,I[1]+this.thumbCenterPoint.y);if(!(I[0]==F[0]&&I[1]==F[1])){setTimeout(function(){G.moveOneTick(F);},this.tickPause);}else{this.unlock();if(!this._mouseDown){this.endMove();}}}else{this.unlock();if(!this._mouseDown){this.endMove();}}},_getNextX:function(E,F){var H=this.thumb,J,G=[],I=null;if(E[0]>F[0]){J=H.tickSize-this.thumbCenterPoint.x;G=H.getTargetCoord(E[0]-J,E[1]);I=[G.x,G.y];}else{if(E[0]<F[0]){J=H.tickSize+this.thumbCenterPoint.x;G=H.getTargetCoord(E[0]+J,E[1]);I=[G.x,G.y];}else{}}return I;},_getNextY:function(E,F){var H=this.thumb,J,G=[],I=null;if(E[1]>F[1]){J=H.tickSize-this.thumbCenterPoint.y;G=H.getTargetCoord(E[0],E[1]-J);I=[G.x,G.y];}else{if(E[1]<F[1]){J=H.tickSize+this.thumbCenterPoint.y;G=H.getTargetCoord(E[0],E[1]+J);I=[G.x,G.y];}else{}}return I;},b4MouseDown:function(E){if(!this.backgroundEnabled){return false;}this.thumb.autoOffset();this.baselinePos=[];},onMouseDown:function(F){if(!this.backgroundEnabled||this.isLocked()){return false;}this._mouseDown=true;var E=A.getPageX(F),G=A.getPageY(F);this.focus();this._slideStart();this.moveThumb(E,G);},onDrag:function(F){if(this.backgroundEnabled&&!this.isLocked()){var E=A.getPageX(F),G=A.getPageY(F);this.moveThumb(E,G,true,true);this.fireEvents();}},endMove:function(){this.unlock();this.fireEvents();this._slideEnd();},resetThumbConstraints:function(){var E=this.thumb;E.setXConstraint(E.leftConstraint,E.rightConstraint,E.xTickSize);E.setYConstraint(E.topConstraint,E.bottomConstraint,E.xTickSize);},fireEvents:function(G){var F=this.thumb,I,H,E;if(!G){F.cachePosition();}if(!this.isLocked()){if(F._isRegion){I=F.getXValue();H=F.getYValue();if(I!=this.previousX||H!=this.previousY){if(!this._silent){this.onChange(I,H);this.fireEvent("change",{x:I,y:H});}}this.previousX=I;this.previousY=H;}else{E=F.getValue();if(E!=this.previousVal){if(!this._silent){this.onChange(E);this.fireEvent("change",E);}}this.previousVal=E;}}},toString:function(){return("Slider ("+this.type+") "+this.id);}});YAHOO.lang.augmentProto(C,YAHOO.util.EventProvider);YAHOO.widget.Slider=C;})();YAHOO.widget.SliderThumb=function(G,B,E,D,A,F,C){if(G){YAHOO.widget.SliderThumb.superclass.constructor.call(this,G,B);this.parentElId=B;}this.isTarget=false;this.tickSize=C;this.maintainOffset=true;this.initSlider(E,D,A,F,C);this.scroll=false;};YAHOO.extend(YAHOO.widget.SliderThumb,YAHOO.util.DD,{startOffset:null,dragOnly:true,_isHoriz:false,_prevVal:0,_graduated:false,getOffsetFromParent0:function(C){var A=YAHOO.util.Dom.getXY(this.getEl()),B=C||YAHOO.util.Dom.getXY(this.parentElId);return[(A[0]-B[0]),(A[1]-B[1])];},getOffsetFromParent:function(H){var A=this.getEl(),E,I,F,B,K,D,C,J,G;if(!this.deltaOffset){I=YAHOO.util.Dom.getXY(A);F=H||YAHOO.util.Dom.getXY(this.parentElId);E=[(I[0]-F[0]),(I[1]-F[1])];B=parseInt(YAHOO.util.Dom.getStyle(A,"left"),10);K=parseInt(YAHOO.util.Dom.getStyle(A,"top"),10);D=B-E[0];C=K-E[1];if(isNaN(D)||isNaN(C)){}else{this.deltaOffset=[D,C];}}else{J=parseInt(YAHOO.util.Dom.getStyle(A,"left"),10);G=parseInt(YAHOO.util.Dom.getStyle(A,"top"),10);E=[J+this.deltaOffset[0],G+this.deltaOffset[1]];}return E;},initSlider:function(D,C,A,E,B){this.initLeft=D;this.initRight=C;this.initUp=A;this.initDown=E;this.setXConstraint(D,C,B);this.setYConstraint(A,E,B);if(B&&B>1){this._graduated=true;}this._isHoriz=(D||C);this._isVert=(A||E);this._isRegion=(this._isHoriz&&this._isVert);},clearTicks:function(){YAHOO.widget.SliderThumb.superclass.clearTicks.call(this);this.tickSize=0;this._graduated=false;},getValue:function(){return(this._isHoriz)?this.getXValue():this.getYValue();},getXValue:function(){if(!this.available){return 0;}var A=this.getOffsetFromParent();if(YAHOO.lang.isNumber(A[0])){this.lastOffset=A;return(A[0]-this.startOffset[0]);}else{return(this.lastOffset[0]-this.startOffset[0]);}},getYValue:function(){if(!this.available){return 0;}var A=this.getOffsetFromParent();if(YAHOO.lang.isNumber(A[1])){this.lastOffset=A;return(A[1]-this.startOffset[1]);}else{return(this.lastOffset[1]-this.startOffset[1]);}},toString:function(){return"SliderThumb "+this.id;},onChange:function(A,B){}});(function(){var A=YAHOO.util.Event,B=YAHOO.widget;function C(I,F,H,D){var G=this,J={min:false,max:false},E,K;this.minSlider=I;this.maxSlider=F;this.activeSlider=I;this.isHoriz=I.thumb._isHoriz;E=this.minSlider.thumb.onMouseDown;K=this.maxSlider.thumb.onMouseDown;this.minSlider.thumb.onMouseDown=function(){G.activeSlider=G.minSlider;E.apply(this,arguments);};this.maxSlider.thumb.onMouseDown=function(){G.activeSlider=G.maxSlider;K.apply(this,arguments);};this.minSlider.thumb.onAvailable=function(){I.setStartSliderState();J.min=true;if(J.max){G.fireEvent("ready",G);}};this.maxSlider.thumb.onAvailable=function(){F.setStartSliderState();J.max=true;if(J.min){G.fireEvent("ready",G);}};I.onMouseDown=F.onMouseDown=function(L){return this.backgroundEnabled&&G._handleMouseDown(L);};I.onDrag=F.onDrag=function(L){G._handleDrag(L);};I.onMouseUp=F.onMouseUp=function(L){G._handleMouseUp(L);
};I._bindKeyEvents=function(){G._bindKeyEvents(this);};F._bindKeyEvents=function(){};I.subscribe("change",this._handleMinChange,I,this);I.subscribe("slideStart",this._handleSlideStart,I,this);I.subscribe("slideEnd",this._handleSlideEnd,I,this);F.subscribe("change",this._handleMaxChange,F,this);F.subscribe("slideStart",this._handleSlideStart,F,this);F.subscribe("slideEnd",this._handleSlideEnd,F,this);this.createEvent("ready",this);this.createEvent("change",this);this.createEvent("slideStart",this);this.createEvent("slideEnd",this);D=YAHOO.lang.isArray(D)?D:[0,H];D[0]=Math.min(Math.max(parseInt(D[0],10)|0,0),H);D[1]=Math.max(Math.min(parseInt(D[1],10)|0,H),0);if(D[0]>D[1]){D.splice(0,2,D[1],D[0]);}this.minVal=D[0];this.maxVal=D[1];this.minSlider.setValue(this.minVal,true,true,true);this.maxSlider.setValue(this.maxVal,true,true,true);}C.prototype={minVal:-1,maxVal:-1,minRange:0,_handleSlideStart:function(E,D){this.fireEvent("slideStart",D);},_handleSlideEnd:function(E,D){this.fireEvent("slideEnd",D);},_handleDrag:function(D){B.Slider.prototype.onDrag.call(this.activeSlider,D);},_handleMinChange:function(){this.activeSlider=this.minSlider;this.updateValue();},_handleMaxChange:function(){this.activeSlider=this.maxSlider;this.updateValue();},_bindKeyEvents:function(D){A.on(D.id,"keydown",this._handleKeyDown,this,true);A.on(D.id,"keypress",this._handleKeyPress,this,true);},_handleKeyDown:function(D){this.activeSlider.handleKeyDown.apply(this.activeSlider,arguments);},_handleKeyPress:function(D){this.activeSlider.handleKeyPress.apply(this.activeSlider,arguments);},setValues:function(H,K,I,E,J){var F=this.minSlider,M=this.maxSlider,D=F.thumb,L=M.thumb,N=this,G={min:false,max:false};if(D._isHoriz){D.setXConstraint(D.leftConstraint,L.rightConstraint,D.tickSize);L.setXConstraint(D.leftConstraint,L.rightConstraint,L.tickSize);}else{D.setYConstraint(D.topConstraint,L.bottomConstraint,D.tickSize);L.setYConstraint(D.topConstraint,L.bottomConstraint,L.tickSize);}this._oneTimeCallback(F,"slideEnd",function(){G.min=true;if(G.max){N.updateValue(J);setTimeout(function(){N._cleanEvent(F,"slideEnd");N._cleanEvent(M,"slideEnd");},0);}});this._oneTimeCallback(M,"slideEnd",function(){G.max=true;if(G.min){N.updateValue(J);setTimeout(function(){N._cleanEvent(F,"slideEnd");N._cleanEvent(M,"slideEnd");},0);}});F.setValue(H,I,E,false);M.setValue(K,I,E,false);},setMinValue:function(F,H,I,E){var G=this.minSlider,D=this;this.activeSlider=G;D=this;this._oneTimeCallback(G,"slideEnd",function(){D.updateValue(E);setTimeout(function(){D._cleanEvent(G,"slideEnd");},0);});G.setValue(F,H,I);},setMaxValue:function(D,H,I,F){var G=this.maxSlider,E=this;this.activeSlider=G;this._oneTimeCallback(G,"slideEnd",function(){E.updateValue(F);setTimeout(function(){E._cleanEvent(G,"slideEnd");},0);});G.setValue(D,H,I);},updateValue:function(J){var E=this.minSlider.getValue(),K=this.maxSlider.getValue(),F=false,D,M,H,I,L,G;if(E!=this.minVal||K!=this.maxVal){F=true;D=this.minSlider.thumb;M=this.maxSlider.thumb;H=this.isHoriz?"x":"y";G=this.minSlider.thumbCenterPoint[H]+this.maxSlider.thumbCenterPoint[H];I=Math.max(K-G-this.minRange,0);L=Math.min(-E-G-this.minRange,0);if(this.isHoriz){I=Math.min(I,M.rightConstraint);D.setXConstraint(D.leftConstraint,I,D.tickSize);M.setXConstraint(L,M.rightConstraint,M.tickSize);}else{I=Math.min(I,M.bottomConstraint);D.setYConstraint(D.leftConstraint,I,D.tickSize);M.setYConstraint(L,M.bottomConstraint,M.tickSize);}}this.minVal=E;this.maxVal=K;if(F&&!J){this.fireEvent("change",this);}},selectActiveSlider:function(H){var E=this.minSlider,D=this.maxSlider,J=E.isLocked()||!E.backgroundEnabled,G=D.isLocked()||!E.backgroundEnabled,F=YAHOO.util.Event,I;if(J||G){this.activeSlider=J?D:E;}else{if(this.isHoriz){I=F.getPageX(H)-E.thumb.initPageX-E.thumbCenterPoint.x;}else{I=F.getPageY(H)-E.thumb.initPageY-E.thumbCenterPoint.y;}this.activeSlider=I*2>D.getValue()+E.getValue()?D:E;}},_handleMouseDown:function(D){if(!D._handled&&!this.minSlider._sliding&&!this.maxSlider._sliding){D._handled=true;this.selectActiveSlider(D);return B.Slider.prototype.onMouseDown.call(this.activeSlider,D);}else{return false;}},_handleMouseUp:function(D){B.Slider.prototype.onMouseUp.apply(this.activeSlider,arguments);},_oneTimeCallback:function(G,D,F){var E=function(){G.unsubscribe(D,E);F.apply({},arguments);};G.subscribe(D,E);},_cleanEvent:function(K,E){var J,I,D,G,H,F;if(K.__yui_events&&K.events[E]){for(I=K.__yui_events.length;I>=0;--I){if(K.__yui_events[I].type===E){J=K.__yui_events[I];break;}}if(J){H=J.subscribers;F=[];G=0;for(I=0,D=H.length;I<D;++I){if(H[I]){F[G++]=H[I];}}J.subscribers=F;}}}};YAHOO.lang.augmentProto(C,YAHOO.util.EventProvider);B.Slider.getHorizDualSlider=function(H,J,K,G,F,D){var I=new B.SliderThumb(J,H,0,G,0,0,F),E=new B.SliderThumb(K,H,0,G,0,0,F);return new C(new B.Slider(H,H,I,"horiz"),new B.Slider(H,H,E,"horiz"),G,D);};B.Slider.getVertDualSlider=function(H,J,K,G,F,D){var I=new B.SliderThumb(J,H,0,0,0,G,F),E=new B.SliderThumb(K,H,0,0,0,G,F);return new B.DualSlider(new B.Slider(H,H,I,"vert"),new B.Slider(H,H,E,"vert"),G,D);};YAHOO.widget.DualSlider=C;})();YAHOO.register("slider",YAHOO.widget.Slider,{version:"2.9.0",build:"2800"});

/* SOURCE FILE: jquery-1.11.1.min.js (804ff984) 9/9/2014 2:09:01 PM */

/*! jQuery v1.11.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l="1.11.1",m=function(a,b){return new m.fn.init(a,b)},n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,o=/^-ms-/,p=/-([\da-z])/gi,q=function(a,b){return b.toUpperCase()};m.fn=m.prototype={jquery:l,constructor:m,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=m.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return m.each(this,a,b)},map:function(a){return this.pushStack(m.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},m.extend=m.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},m.extend({expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===m.type(a)},isArray:Array.isArray||function(a){return"array"===m.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!m.isArray(a)&&a-parseFloat(a)>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==m.type(a)||a.nodeType||m.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(k.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&m.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(o,"ms-").replace(p,q)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=r(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(n,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(r(Object(a))?m.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=r(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),m.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||m.guid++,e):void 0},now:function(){return+new Date},support:k}),m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function r(a){var b=a.length,c=m.type(a);return"function"===c||m.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var s=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+-new Date,v=a.document,w=0,x=0,y=gb(),z=gb(),A=gb(),B=function(a,b){return a===b&&(l=!0),0},C="undefined",D=1<<31,E={}.hasOwnProperty,F=[],G=F.pop,H=F.push,I=F.push,J=F.slice,K=F.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=N.replace("w","w#"),P="\\["+M+"*("+N+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+O+"))|)"+M+"*\\]",Q=":("+N+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+P+")*)|.*)\\)|)",R=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),S=new RegExp("^"+M+"*,"+M+"*"),T=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),V=new RegExp(Q),W=new RegExp("^"+O+"$"),X={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{I.apply(F=J.call(v.childNodes),v.childNodes),F[v.childNodes.length].nodeType}catch(eb){I={apply:F.length?function(a,b){H.apply(a,J.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],!a||"string"!=typeof a)return d;if(1!==(k=b.nodeType)&&9!==k)return[];if(p&&!e){if(f=_.exec(a))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return I.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return I.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=9===k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+qb(o[l]);w=ab.test(a)&&ob(b.parentNode)||b,x=o.join(",")}if(x)try{return I.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function gb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function hb(a){return a[u]=!0,a}function ib(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function jb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function kb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||D)-(~a.sourceIndex||D);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function lb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function nb(a){return hb(function(b){return b=+b,hb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function ob(a){return a&&typeof a.getElementsByTagName!==C&&a}c=fb.support={},f=fb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fb.setDocument=function(a){var b,e=a?a.ownerDocument||a:v,g=e.defaultView;return e!==n&&9===e.nodeType&&e.documentElement?(n=e,o=e.documentElement,p=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){m()},!1):g.attachEvent&&g.attachEvent("onunload",function(){m()})),c.attributes=ib(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ib(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(e.getElementsByClassName)&&ib(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=ib(function(a){return o.appendChild(a).id=u,!e.getElementsByName||!e.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==C&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c=typeof a.getAttributeNode!==C&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==C?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==C&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(e.querySelectorAll))&&(ib(function(a){a.innerHTML="<select msallowclip=''><option selected=''></option></select>",a.querySelectorAll("[msallowclip^='']").length&&q.push("[*^$]="+M+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+M+"*(?:value|"+L+")"),a.querySelectorAll(":checked").length||q.push(":checked")}),ib(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+M+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ib(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",Q)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===v&&t(v,a)?-1:b===e||b.ownerDocument===v&&t(v,b)?1:k?K.call(k,a)-K.call(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:k?K.call(k,a)-K.call(k,b):0;if(f===g)return kb(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?kb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},e):n},fb.matches=function(a,b){return fb(a,null,null,b)},fb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fb(b,n,null,[a]).length>0},fb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&E.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fb.selectors={cacheLength:50,createPseudo:hb,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+M+")"+a+"("+M+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?hb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=K.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:hb(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?hb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:hb(function(a){return function(b){return fb(a,b).length>0}}),contains:hb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:hb(function(a){return W.test(a||"")||fb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:nb(function(){return[0]}),last:nb(function(a,b){return[b-1]}),eq:nb(function(a,b,c){return[0>c?c+b:c]}),even:nb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:nb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:nb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:nb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=lb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=mb(b);function pb(){}pb.prototype=d.filters=d.pseudos,d.setFilters=new pb,g=fb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fb.error(a):z(a,i).slice(0)};function qb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function rb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function sb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function tb(a,b,c){for(var d=0,e=b.length;e>d;d++)fb(a,b[d],c);return c}function ub(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function vb(a,b,c,d,e,f){return d&&!d[u]&&(d=vb(d)),e&&!e[u]&&(e=vb(e,f)),hb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||tb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ub(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ub(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?K.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):I.apply(g,r)})}function wb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=rb(function(a){return a===b},h,!0),l=rb(function(a){return K.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>i;i++)if(c=d.relative[a[i].type])m=[rb(sb(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return vb(i>1&&sb(m),i>1&&qb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&wb(a.slice(i,e)),f>e&&wb(a=a.slice(e)),f>e&&qb(a))}m.push(c)}return sb(m)}function xb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=G.call(i));s=ub(s)}I.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&fb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?hb(f):f}return h=fb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wb(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xb(e,d)),f.selector=a}return f},i=fb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&ob(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qb(j),!a)return I.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&ob(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ib(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ib(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||jb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ib(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||jb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ib(function(a){return null==a.getAttribute("disabled")})||jb(L,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fb}(a);m.find=s,m.expr=s.selectors,m.expr[":"]=m.expr.pseudos,m.unique=s.uniqueSort,m.text=s.getText,m.isXMLDoc=s.isXML,m.contains=s.contains;var t=m.expr.match.needsContext,u=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,v=/^.[^:#\[\.,]*$/;function w(a,b,c){if(m.isFunction(b))return m.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return m.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(v.test(b))return m.filter(b,a,c);b=m.filter(b,a)}return m.grep(a,function(a){return m.inArray(a,b)>=0!==c})}m.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?m.find.matchesSelector(d,a)?[d]:[]:m.find.matches(a,m.grep(b,function(a){return 1===a.nodeType}))},m.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(m(a).filter(function(){for(b=0;e>b;b++)if(m.contains(d[b],this))return!0}));for(b=0;e>b;b++)m.find(a,d[b],c);return c=this.pushStack(e>1?m.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(w(this,a||[],!1))},not:function(a){return this.pushStack(w(this,a||[],!0))},is:function(a){return!!w(this,"string"==typeof a&&t.test(a)?m(a):a||[],!1).length}});var x,y=a.document,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=m.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||x).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof m?b[0]:b,m.merge(this,m.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:y,!0)),u.test(c[1])&&m.isPlainObject(b))for(c in b)m.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=y.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return x.find(a);this.length=1,this[0]=d}return this.context=y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):m.isFunction(a)?"undefined"!=typeof x.ready?x.ready(a):a(m):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),m.makeArray(a,this))};A.prototype=m.fn,x=m(y);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};m.extend({dir:function(a,b,c){var d=[],e=a[b];while(e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!m(e).is(c)))1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),m.fn.extend({has:function(a){var b,c=m(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(m.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=t.test(a)||"string"!=typeof a?m(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&m.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?m.unique(f):f)},index:function(a){return a?"string"==typeof a?m.inArray(this[0],m(a)):m.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(m.unique(m.merge(this.get(),m(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}m.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return m.dir(a,"parentNode")},parentsUntil:function(a,b,c){return m.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return m.dir(a,"nextSibling")},prevAll:function(a){return m.dir(a,"previousSibling")},nextUntil:function(a,b,c){return m.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return m.dir(a,"previousSibling",c)},siblings:function(a){return m.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return m.sibling(a.firstChild)},contents:function(a){return m.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:m.merge([],a.childNodes)}},function(a,b){m.fn[a]=function(c,d){var e=m.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=m.filter(d,e)),this.length>1&&(C[a]||(e=m.unique(e)),B.test(a)&&(e=e.reverse())),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return m.each(a.match(E)||[],function(a,c){b[c]=!0}),b}m.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):m.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){m.each(b,function(b,c){var d=m.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&m.each(arguments,function(a,c){var d;while((d=m.inArray(c,h,d))>-1)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?m.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},m.extend({Deferred:function(a){var b=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return m.Deferred(function(c){m.each(b,function(b,f){var g=m.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&m.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?m.extend(a,d):d}},e={};return d.pipe=d.then,m.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&m.isFunction(a.promise)?e:0,g=1===f?a:m.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&m.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;m.fn.ready=function(a){return m.ready.promise().done(a),this},m.extend({isReady:!1,readyWait:1,holdReady:function(a){a?m.readyWait++:m.ready(!0)},ready:function(a){if(a===!0?!--m.readyWait:!m.isReady){if(!y.body)return setTimeout(m.ready);m.isReady=!0,a!==!0&&--m.readyWait>0||(H.resolveWith(y,[m]),m.fn.triggerHandler&&(m(y).triggerHandler("ready"),m(y).off("ready")))}}});function I(){y.addEventListener?(y.removeEventListener("DOMContentLoaded",J,!1),a.removeEventListener("load",J,!1)):(y.detachEvent("onreadystatechange",J),a.detachEvent("onload",J))}function J(){(y.addEventListener||"load"===event.type||"complete"===y.readyState)&&(I(),m.ready())}m.ready.promise=function(b){if(!H)if(H=m.Deferred(),"complete"===y.readyState)setTimeout(m.ready);else if(y.addEventListener)y.addEventListener("DOMContentLoaded",J,!1),a.addEventListener("load",J,!1);else{y.attachEvent("onreadystatechange",J),a.attachEvent("onload",J);var c=!1;try{c=null==a.frameElement&&y.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!m.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}I(),m.ready()}}()}return H.promise(b)};var K="undefined",L;for(L in m(k))break;k.ownLast="0"!==L,k.inlineBlockNeedsLayout=!1,m(function(){var a,b,c,d;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",k.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(d))}),function(){var a=y.createElement("div");if(null==k.deleteExpando){k.deleteExpando=!0;try{delete a.test}catch(b){k.deleteExpando=!1}}a=null}(),m.acceptData=function(a){var b=m.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var M=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,N=/([A-Z])/g;function O(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(N,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:M.test(c)?m.parseJSON(c):c}catch(e){}m.data(a,b,c)}else c=void 0}return c}function P(a){var b;for(b in a)if(("data"!==b||!m.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function Q(a,b,d,e){if(m.acceptData(a)){var f,g,h=m.expando,i=a.nodeType,j=i?m.cache:a,k=i?a[h]:a[h]&&h;
if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||m.guid++:h),j[k]||(j[k]=i?{}:{toJSON:m.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=m.extend(j[k],b):j[k].data=m.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[m.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[m.camelCase(b)])):f=g,f}}function R(a,b,c){if(m.acceptData(a)){var d,e,f=a.nodeType,g=f?m.cache:a,h=f?a[m.expando]:m.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){m.isArray(b)?b=b.concat(m.map(b,m.camelCase)):b in d?b=[b]:(b=m.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!P(d):!m.isEmptyObject(d))return}(c||(delete g[h].data,P(g[h])))&&(f?m.cleanData([a],!0):k.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}m.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?m.cache[a[m.expando]]:a[m.expando],!!a&&!P(a)},data:function(a,b,c){return Q(a,b,c)},removeData:function(a,b){return R(a,b)},_data:function(a,b,c){return Q(a,b,c,!0)},_removeData:function(a,b){return R(a,b,!0)}}),m.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=m.data(f),1===f.nodeType&&!m._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=m.camelCase(d.slice(5)),O(f,d,e[d])));m._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){m.data(this,a)}):arguments.length>1?this.each(function(){m.data(this,a,b)}):f?O(f,a,m.data(f,a)):void 0},removeData:function(a){return this.each(function(){m.removeData(this,a)})}}),m.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=m._data(a,b),c&&(!d||m.isArray(c)?d=m._data(a,b,m.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=m.queue(a,b),d=c.length,e=c.shift(),f=m._queueHooks(a,b),g=function(){m.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return m._data(a,c)||m._data(a,c,{empty:m.Callbacks("once memory").add(function(){m._removeData(a,b+"queue"),m._removeData(a,c)})})}}),m.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?m.queue(this[0],a):void 0===b?this:this.each(function(){var c=m.queue(this,a,b);m._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&m.dequeue(this,a)})},dequeue:function(a){return this.each(function(){m.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=m.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=m._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=["Top","Right","Bottom","Left"],U=function(a,b){return a=b||a,"none"===m.css(a,"display")||!m.contains(a.ownerDocument,a)},V=m.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===m.type(c)){e=!0;for(h in c)m.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,m.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(m(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},W=/^(?:checkbox|radio)$/i;!function(){var a=y.createElement("input"),b=y.createElement("div"),c=y.createDocumentFragment();if(b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",k.leadingWhitespace=3===b.firstChild.nodeType,k.tbody=!b.getElementsByTagName("tbody").length,k.htmlSerialize=!!b.getElementsByTagName("link").length,k.html5Clone="<:nav></:nav>"!==y.createElement("nav").cloneNode(!0).outerHTML,a.type="checkbox",a.checked=!0,c.appendChild(a),k.appendChecked=a.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,c.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,k.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){k.noCloneEvent=!1}),b.cloneNode(!0).click()),null==k.deleteExpando){k.deleteExpando=!0;try{delete b.test}catch(d){k.deleteExpando=!1}}}(),function(){var b,c,d=y.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(k[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),k[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var X=/^(?:input|select|textarea)$/i,Y=/^key/,Z=/^(?:mouse|pointer|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=/^([^.]*)(?:\.(.+)|)$/;function ab(){return!0}function bb(){return!1}function cb(){try{return y.activeElement}catch(a){}}m.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=m.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof m===K||a&&m.event.triggered===a.type?void 0:m.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(E)||[""],h=b.length;while(h--)f=_.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=m.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=m.event.special[o]||{},l=m.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&m.expr.match.needsContext.test(e),namespace:p.join(".")},i),(n=g[o])||(n=g[o]=[],n.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?n.splice(n.delegateCount++,0,l):n.push(l),m.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m.hasData(a)&&m._data(a);if(r&&(k=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=_.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=m.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,n=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=n.length;while(f--)g=n[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(n.splice(f,1),g.selector&&n.delegateCount--,l.remove&&l.remove.call(a,g));i&&!n.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||m.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)m.event.remove(a,o+b[j],c,d,!0);m.isEmptyObject(k)&&(delete r.handle,m._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,o=[d||y],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||y,3!==d.nodeType&&8!==d.nodeType&&!$.test(p+m.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[m.expando]?b:new m.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:m.makeArray(c,[b]),k=m.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!m.isWindow(d)){for(i=k.delegateType||p,$.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||y)&&o.push(l.defaultView||l.parentWindow||a)}n=0;while((h=o[n++])&&!b.isPropagationStopped())b.type=n>1?i:k.bindType||p,f=(m._data(h,"events")||{})[b.type]&&m._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&m.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&m.acceptData(d)&&g&&d[p]&&!m.isWindow(d)){l=d[g],l&&(d[g]=null),m.event.triggered=p;try{d[p]()}catch(r){}m.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=m.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(m._data(this,"events")||{})[a.type]||[],k=m.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=m.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((m.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?m(c,this).index(i)>=0:m.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[m.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=Z.test(e)?this.mouseHooks:Y.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new m.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||y,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==cb()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===cb()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return m.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return m.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=m.extend(new m.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?m.event.trigger(e,null,b):m.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},m.removeEvent=y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===K&&(a[d]=null),a.detachEvent(d,c))},m.Event=function(a,b){return this instanceof m.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ab:bb):this.type=a,b&&m.extend(this,b),this.timeStamp=a&&a.timeStamp||m.now(),void(this[m.expando]=!0)):new m.Event(a,b)},m.Event.prototype={isDefaultPrevented:bb,isPropagationStopped:bb,isImmediatePropagationStopped:bb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ab,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ab,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ab,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},m.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){m.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!m.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.submitBubbles||(m.event.special.submit={setup:function(){return m.nodeName(this,"form")?!1:void m.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=m.nodeName(b,"input")||m.nodeName(b,"button")?b.form:void 0;c&&!m._data(c,"submitBubbles")&&(m.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),m._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&m.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return m.nodeName(this,"form")?!1:void m.event.remove(this,"._submit")}}),k.changeBubbles||(m.event.special.change={setup:function(){return X.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(m.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),m.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),m.event.simulate("change",this,a,!0)})),!1):void m.event.add(this,"beforeactivate._change",function(a){var b=a.target;X.test(b.nodeName)&&!m._data(b,"changeBubbles")&&(m.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||m.event.simulate("change",this.parentNode,a,!0)}),m._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return m.event.remove(this,"._change"),!X.test(this.nodeName)}}),k.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){m.event.simulate(b,a.target,m.event.fix(a),!0)};m.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=m._data(d,b);e||d.addEventListener(a,c,!0),m._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=m._data(d,b)-1;e?m._data(d,b,e):(d.removeEventListener(a,c,!0),m._removeData(d,b))}}}),m.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=bb;else if(!d)return this;return 1===e&&(g=d,d=function(a){return m().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=m.guid++)),this.each(function(){m.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,m(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=bb),this.each(function(){m.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){m.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?m.event.trigger(a,b,c,!0):void 0}});function db(a){var b=eb.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}var eb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",fb=/ jQuery\d+="(?:null|\d+)"/g,gb=new RegExp("<(?:"+eb+")[\\s/>]","i"),hb=/^\s+/,ib=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,jb=/<([\w:]+)/,kb=/<tbody/i,lb=/<|&#?\w+;/,mb=/<(?:script|style|link)/i,nb=/checked\s*(?:[^=]|=\s*.checked.)/i,ob=/^$|\/(?:java|ecma)script/i,pb=/^true\/(.*)/,qb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,rb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:k.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},sb=db(y),tb=sb.appendChild(y.createElement("div"));rb.optgroup=rb.option,rb.tbody=rb.tfoot=rb.colgroup=rb.caption=rb.thead,rb.th=rb.td;function ub(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==K?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==K?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||m.nodeName(d,b)?f.push(d):m.merge(f,ub(d,b));return void 0===b||b&&m.nodeName(a,b)?m.merge([a],f):f}function vb(a){W.test(a.type)&&(a.defaultChecked=a.checked)}function wb(a,b){return m.nodeName(a,"table")&&m.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function xb(a){return a.type=(null!==m.find.attr(a,"type"))+"/"+a.type,a}function yb(a){var b=pb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function zb(a,b){for(var c,d=0;null!=(c=a[d]);d++)m._data(c,"globalEval",!b||m._data(b[d],"globalEval"))}function Ab(a,b){if(1===b.nodeType&&m.hasData(a)){var c,d,e,f=m._data(a),g=m._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)m.event.add(b,c,h[c][d])}g.data&&(g.data=m.extend({},g.data))}}function Bb(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!k.noCloneEvent&&b[m.expando]){e=m._data(b);for(d in e.events)m.removeEvent(b,d,e.handle);b.removeAttribute(m.expando)}"script"===c&&b.text!==a.text?(xb(b).text=a.text,yb(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),k.html5Clone&&a.innerHTML&&!m.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&W.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}m.extend({clone:function(a,b,c){var d,e,f,g,h,i=m.contains(a.ownerDocument,a);if(k.html5Clone||m.isXMLDoc(a)||!gb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(tb.innerHTML=a.outerHTML,tb.removeChild(f=tb.firstChild)),!(k.noCloneEvent&&k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||m.isXMLDoc(a)))for(d=ub(f),h=ub(a),g=0;null!=(e=h[g]);++g)d[g]&&Bb(e,d[g]);if(b)if(c)for(h=h||ub(a),d=d||ub(f),g=0;null!=(e=h[g]);g++)Ab(e,d[g]);else Ab(a,f);return d=ub(f,"script"),d.length>0&&zb(d,!i&&ub(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,l,n=a.length,o=db(b),p=[],q=0;n>q;q++)if(f=a[q],f||0===f)if("object"===m.type(f))m.merge(p,f.nodeType?[f]:f);else if(lb.test(f)){h=h||o.appendChild(b.createElement("div")),i=(jb.exec(f)||["",""])[1].toLowerCase(),l=rb[i]||rb._default,h.innerHTML=l[1]+f.replace(ib,"<$1></$2>")+l[2],e=l[0];while(e--)h=h.lastChild;if(!k.leadingWhitespace&&hb.test(f)&&p.push(b.createTextNode(hb.exec(f)[0])),!k.tbody){f="table"!==i||kb.test(f)?"<table>"!==l[1]||kb.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;while(e--)m.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}m.merge(p,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));h&&o.removeChild(h),k.appendChecked||m.grep(ub(p,"input"),vb),q=0;while(f=p[q++])if((!d||-1===m.inArray(f,d))&&(g=m.contains(f.ownerDocument,f),h=ub(o.appendChild(f),"script"),g&&zb(h),c)){e=0;while(f=h[e++])ob.test(f.type||"")&&c.push(f)}return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=m.expando,j=m.cache,l=k.deleteExpando,n=m.event.special;null!=(d=a[h]);h++)if((b||m.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)n[e]?m.event.remove(d,e):m.removeEvent(d,e,g.handle);j[f]&&(delete j[f],l?delete d[i]:typeof d.removeAttribute!==K?d.removeAttribute(i):d[i]=null,c.push(f))}}}),m.fn.extend({text:function(a){return V(this,function(a){return void 0===a?m.text(this):this.empty().append((this[0]&&this[0].ownerDocument||y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?m.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||m.cleanData(ub(c)),c.parentNode&&(b&&m.contains(c.ownerDocument,c)&&zb(ub(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&m.cleanData(ub(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&m.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return m.clone(this,a,b)})},html:function(a){return V(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(fb,""):void 0;if(!("string"!=typeof a||mb.test(a)||!k.htmlSerialize&&gb.test(a)||!k.leadingWhitespace&&hb.test(a)||rb[(jb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(ib,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(m.cleanData(ub(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,m.cleanData(ub(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,n=this,o=l-1,p=a[0],q=m.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&nb.test(p))return this.each(function(c){var d=n.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(i=m.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=m.map(ub(i,"script"),xb),f=g.length;l>j;j++)d=i,j!==o&&(d=m.clone(d,!0,!0),f&&m.merge(g,ub(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,m.map(g,yb),j=0;f>j;j++)d=g[j],ob.test(d.type||"")&&!m._data(d,"globalEval")&&m.contains(h,d)&&(d.src?m._evalUrl&&m._evalUrl(d.src):m.globalEval((d.text||d.textContent||d.innerHTML||"").replace(qb,"")));i=c=null}return this}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){m.fn[a]=function(a){for(var c,d=0,e=[],g=m(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),m(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Cb,Db={};function Eb(b,c){var d,e=m(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:m.css(e[0],"display");return e.detach(),f}function Fb(a){var b=y,c=Db[a];return c||(c=Eb(a,b),"none"!==c&&c||(Cb=(Cb||m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Cb[0].contentWindow||Cb[0].contentDocument).document,b.write(),b.close(),c=Eb(a,b),Cb.detach()),Db[a]=c),c}!function(){var a;k.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,d;return c=y.getElementsByTagName("body")[0],c&&c.style?(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(y.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(d),a):void 0}}();var Gb=/^margin/,Hb=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Ib,Jb,Kb=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ib=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)},Jb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ib(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||m.contains(a.ownerDocument,a)||(g=m.style(a,b)),Hb.test(g)&&Gb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):y.documentElement.currentStyle&&(Ib=function(a){return a.currentStyle},Jb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ib(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Hb.test(g)&&!Kb.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Lb(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d,e,f,g,h;if(b=y.createElement("div"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=d&&d.style){c.cssText="float:left;opacity:.5",k.opacity="0.5"===c.opacity,k.cssFloat=!!c.cssFloat,b.style.backgroundClip="content-box",b.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===b.style.backgroundClip,k.boxSizing=""===c.boxSizing||""===c.MozBoxSizing||""===c.WebkitBoxSizing,m.extend(k,{reliableHiddenOffsets:function(){return null==g&&i(),g},boxSizingReliable:function(){return null==f&&i(),f},pixelPosition:function(){return null==e&&i(),e},reliableMarginRight:function(){return null==h&&i(),h}});function i(){var b,c,d,i;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),b.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",e=f=!1,h=!0,a.getComputedStyle&&(e="1%"!==(a.getComputedStyle(b,null)||{}).top,f="4px"===(a.getComputedStyle(b,null)||{width:"4px"}).width,i=b.appendChild(y.createElement("div")),i.style.cssText=b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",b.style.width="1px",h=!parseFloat((a.getComputedStyle(i,null)||{}).marginRight)),b.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=b.getElementsByTagName("td"),i[0].style.cssText="margin:0;border:0;padding:0;display:none",g=0===i[0].offsetHeight,g&&(i[0].style.display="",i[1].style.display="none",g=0===i[0].offsetHeight),c.removeChild(d))}}}(),m.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Mb=/alpha\([^)]*\)/i,Nb=/opacity\s*=\s*([^)]*)/,Ob=/^(none|table(?!-c[ea]).+)/,Pb=new RegExp("^("+S+")(.*)$","i"),Qb=new RegExp("^([+-])=("+S+")","i"),Rb={position:"absolute",visibility:"hidden",display:"block"},Sb={letterSpacing:"0",fontWeight:"400"},Tb=["Webkit","O","Moz","ms"];function Ub(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Tb.length;while(e--)if(b=Tb[e]+c,b in a)return b;return d}function Vb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=m._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&U(d)&&(f[g]=m._data(d,"olddisplay",Fb(d.nodeName)))):(e=U(d),(c&&"none"!==c||!e)&&m._data(d,"olddisplay",e?c:m.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Wb(a,b,c){var d=Pb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Xb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=m.css(a,c+T[f],!0,e)),d?("content"===c&&(g-=m.css(a,"padding"+T[f],!0,e)),"margin"!==c&&(g-=m.css(a,"border"+T[f]+"Width",!0,e))):(g+=m.css(a,"padding"+T[f],!0,e),"padding"!==c&&(g+=m.css(a,"border"+T[f]+"Width",!0,e)));return g}function Yb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ib(a),g=k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Jb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Hb.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Xb(a,b,c||(g?"border":"content"),d,f)+"px"}m.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Jb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":k.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=m.camelCase(b),i=a.style;if(b=m.cssProps[h]||(m.cssProps[h]=Ub(i,h)),g=m.cssHooks[b]||m.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Qb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(m.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||m.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=m.camelCase(b);return b=m.cssProps[h]||(m.cssProps[h]=Ub(a.style,h)),g=m.cssHooks[b]||m.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Jb(a,b,d)),"normal"===f&&b in Sb&&(f=Sb[b]),""===c||c?(e=parseFloat(f),c===!0||m.isNumeric(e)?e||0:f):f}}),m.each(["height","width"],function(a,b){m.cssHooks[b]={get:function(a,c,d){return c?Ob.test(m.css(a,"display"))&&0===a.offsetWidth?m.swap(a,Rb,function(){return Yb(a,b,d)}):Yb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ib(a);return Wb(a,c,d?Xb(a,b,d,k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,e),e):0)}}}),k.opacity||(m.cssHooks.opacity={get:function(a,b){return Nb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=m.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===m.trim(f.replace(Mb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Mb.test(f)?f.replace(Mb,e):f+" "+e)}}),m.cssHooks.marginRight=Lb(k.reliableMarginRight,function(a,b){return b?m.swap(a,{display:"inline-block"},Jb,[a,"marginRight"]):void 0}),m.each({margin:"",padding:"",border:"Width"},function(a,b){m.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+T[d]+b]=f[d]||f[d-2]||f[0];return e}},Gb.test(a)||(m.cssHooks[a+b].set=Wb)}),m.fn.extend({css:function(a,b){return V(this,function(a,b,c){var d,e,f={},g=0;if(m.isArray(b)){for(d=Ib(a),e=b.length;e>g;g++)f[b[g]]=m.css(a,b[g],!1,d);return f}return void 0!==c?m.style(a,b,c):m.css(a,b)},a,b,arguments.length>1)},show:function(){return Vb(this,!0)},hide:function(){return Vb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){U(this)?m(this).show():m(this).hide()})}});function Zb(a,b,c,d,e){return new Zb.prototype.init(a,b,c,d,e)}m.Tween=Zb,Zb.prototype={constructor:Zb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(m.cssNumber[c]?"":"px")
},cur:function(){var a=Zb.propHooks[this.prop];return a&&a.get?a.get(this):Zb.propHooks._default.get(this)},run:function(a){var b,c=Zb.propHooks[this.prop];return this.pos=b=this.options.duration?m.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Zb.propHooks._default.set(this),this}},Zb.prototype.init.prototype=Zb.prototype,Zb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=m.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){m.fx.step[a.prop]?m.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[m.cssProps[a.prop]]||m.cssHooks[a.prop])?m.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Zb.propHooks.scrollTop=Zb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},m.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},m.fx=Zb.prototype.init,m.fx.step={};var $b,_b,ac=/^(?:toggle|show|hide)$/,bc=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),cc=/queueHooks$/,dc=[ic],ec={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bc.exec(b),f=e&&e[3]||(m.cssNumber[a]?"":"px"),g=(m.cssNumber[a]||"px"!==f&&+d)&&bc.exec(m.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,m.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function fc(){return setTimeout(function(){$b=void 0}),$b=m.now()}function gc(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=T[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function hc(a,b,c){for(var d,e=(ec[b]||[]).concat(ec["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ic(a,b,c){var d,e,f,g,h,i,j,l,n=this,o={},p=a.style,q=a.nodeType&&U(a),r=m._data(a,"fxshow");c.queue||(h=m._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,n.always(function(){n.always(function(){h.unqueued--,m.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=m.css(a,"display"),l="none"===j?m._data(a,"olddisplay")||Fb(a.nodeName):j,"inline"===l&&"none"===m.css(a,"float")&&(k.inlineBlockNeedsLayout&&"inline"!==Fb(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",k.shrinkWrapBlocks()||n.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ac.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||m.style(a,d)}else j=void 0;if(m.isEmptyObject(o))"inline"===("none"===j?Fb(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=m._data(a,"fxshow",{}),f&&(r.hidden=!q),q?m(a).show():n.done(function(){m(a).hide()}),n.done(function(){var b;m._removeData(a,"fxshow");for(b in o)m.style(a,b,o[b])});for(d in o)g=hc(q?r[d]:0,d,n),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function jc(a,b){var c,d,e,f,g;for(c in a)if(d=m.camelCase(c),e=b[d],f=a[c],m.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=m.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kc(a,b,c){var d,e,f=0,g=dc.length,h=m.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$b||fc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:m.extend({},b),opts:m.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$b||fc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=m.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jc(k,j.opts.specialEasing);g>f;f++)if(d=dc[f].call(j,a,k,j.opts))return d;return m.map(k,hc,j),m.isFunction(j.opts.start)&&j.opts.start.call(a,j),m.fx.timer(m.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}m.Animation=m.extend(kc,{tweener:function(a,b){m.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],ec[c]=ec[c]||[],ec[c].unshift(b)},prefilter:function(a,b){b?dc.unshift(a):dc.push(a)}}),m.speed=function(a,b,c){var d=a&&"object"==typeof a?m.extend({},a):{complete:c||!c&&b||m.isFunction(a)&&a,duration:a,easing:c&&b||b&&!m.isFunction(b)&&b};return d.duration=m.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in m.fx.speeds?m.fx.speeds[d.duration]:m.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){m.isFunction(d.old)&&d.old.call(this),d.queue&&m.dequeue(this,d.queue)},d},m.fn.extend({fadeTo:function(a,b,c,d){return this.filter(U).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=m.isEmptyObject(a),f=m.speed(b,c,d),g=function(){var b=kc(this,m.extend({},a),f);(e||m._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=m.timers,g=m._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&cc.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&m.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=m._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=m.timers,g=d?d.length:0;for(c.finish=!0,m.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),m.each(["toggle","show","hide"],function(a,b){var c=m.fn[b];m.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gc(b,!0),a,d,e)}}),m.each({slideDown:gc("show"),slideUp:gc("hide"),slideToggle:gc("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){m.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),m.timers=[],m.fx.tick=function(){var a,b=m.timers,c=0;for($b=m.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||m.fx.stop(),$b=void 0},m.fx.timer=function(a){m.timers.push(a),a()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){_b||(_b=setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){clearInterval(_b),_b=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(a,b){return a=m.fx?m.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e;b=y.createElement("div"),b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=y.createElement("select"),e=c.appendChild(y.createElement("option")),a=b.getElementsByTagName("input")[0],d.style.cssText="top:1px",k.getSetAttribute="t"!==b.className,k.style=/top/.test(d.getAttribute("style")),k.hrefNormalized="/a"===d.getAttribute("href"),k.checkOn=!!a.value,k.optSelected=e.selected,k.enctype=!!y.createElement("form").enctype,c.disabled=!0,k.optDisabled=!e.disabled,a=y.createElement("input"),a.setAttribute("value",""),k.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),k.radioValue="t"===a.value}();var lc=/\r/g;m.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=m.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,m(this).val()):a,null==e?e="":"number"==typeof e?e+="":m.isArray(e)&&(e=m.map(e,function(a){return null==a?"":a+""})),b=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=m.valHooks[e.type]||m.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(lc,""):null==c?"":c)}}}),m.extend({valHooks:{option:{get:function(a){var b=m.find.attr(a,"value");return null!=b?b:m.trim(m.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&m.nodeName(c.parentNode,"optgroup"))){if(b=m(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=m.makeArray(b),g=e.length;while(g--)if(d=e[g],m.inArray(m.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(a,b){return m.isArray(b)?a.checked=m.inArray(m(a).val(),b)>=0:void 0}},k.checkOn||(m.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var mc,nc,oc=m.expr.attrHandle,pc=/^(?:checked|selected)$/i,qc=k.getSetAttribute,rc=k.input;m.fn.extend({attr:function(a,b){return V(this,m.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){m.removeAttr(this,a)})}}),m.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===K?m.prop(a,b,c):(1===f&&m.isXMLDoc(a)||(b=b.toLowerCase(),d=m.attrHooks[b]||(m.expr.match.bool.test(b)?nc:mc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=m.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void m.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=m.propFix[c]||c,m.expr.match.bool.test(c)?rc&&qc||!pc.test(c)?a[d]=!1:a[m.camelCase("default-"+c)]=a[d]=!1:m.attr(a,c,""),a.removeAttribute(qc?c:d)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&m.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),nc={set:function(a,b,c){return b===!1?m.removeAttr(a,c):rc&&qc||!pc.test(c)?a.setAttribute(!qc&&m.propFix[c]||c,c):a[m.camelCase("default-"+c)]=a[c]=!0,c}},m.each(m.expr.match.bool.source.match(/\w+/g),function(a,b){var c=oc[b]||m.find.attr;oc[b]=rc&&qc||!pc.test(b)?function(a,b,d){var e,f;return d||(f=oc[b],oc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,oc[b]=f),e}:function(a,b,c){return c?void 0:a[m.camelCase("default-"+b)]?b.toLowerCase():null}}),rc&&qc||(m.attrHooks.value={set:function(a,b,c){return m.nodeName(a,"input")?void(a.defaultValue=b):mc&&mc.set(a,b,c)}}),qc||(mc={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},oc.id=oc.name=oc.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},m.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:mc.set},m.attrHooks.contenteditable={set:function(a,b,c){mc.set(a,""===b?!1:b,c)}},m.each(["width","height"],function(a,b){m.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),k.style||(m.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var sc=/^(?:input|select|textarea|button|object)$/i,tc=/^(?:a|area)$/i;m.fn.extend({prop:function(a,b){return V(this,m.prop,a,b,arguments.length>1)},removeProp:function(a){return a=m.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),m.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!m.isXMLDoc(a),f&&(b=m.propFix[b]||b,e=m.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=m.find.attr(a,"tabindex");return b?parseInt(b,10):sc.test(a.nodeName)||tc.test(a.nodeName)&&a.href?0:-1}}}}),k.hrefNormalized||m.each(["href","src"],function(a,b){m.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),k.optSelected||(m.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this}),k.enctype||(m.propFix.enctype="encoding");var uc=/[\t\r\n\f]/g;m.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(uc," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=m.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(uc," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?m.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(m.isFunction(a)?function(c){m(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=m(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===K||"boolean"===c)&&(this.className&&m._data(this,"__className__",this.className),this.className=this.className||a===!1?"":m._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(uc," ").indexOf(b)>=0)return!0;return!1}}),m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){m.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),m.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var vc=m.now(),wc=/\?/,xc=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;m.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=m.trim(b+"");return e&&!m.trim(e.replace(xc,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():m.error("Invalid JSON: "+b)},m.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||m.error("Invalid XML: "+b),c};var yc,zc,Ac=/#.*$/,Bc=/([?&])_=[^&]*/,Cc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Dc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ec=/^(?:GET|HEAD)$/,Fc=/^\/\//,Gc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hc={},Ic={},Jc="*/".concat("*");try{zc=location.href}catch(Kc){zc=y.createElement("a"),zc.href="",zc=zc.href}yc=Gc.exec(zc.toLowerCase())||[];function Lc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(m.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Mc(a,b,c,d){var e={},f=a===Ic;function g(h){var i;return e[h]=!0,m.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Nc(a,b){var c,d,e=m.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&m.extend(!0,a,c),a}function Oc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Pc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zc,type:"GET",isLocal:Dc.test(yc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Jc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Nc(Nc(a,m.ajaxSettings),b):Nc(m.ajaxSettings,a)},ajaxPrefilter:Lc(Hc),ajaxTransport:Lc(Ic),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=m.ajaxSetup({},b),l=k.context||k,n=k.context&&(l.nodeType||l.jquery)?m(l):m.event,o=m.Deferred(),p=m.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j){j={};while(b=Cc.exec(f))j[b[1].toLowerCase()]=b[2]}b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||zc)+"").replace(Ac,"").replace(Fc,yc[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=m.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(c=Gc.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===yc[1]&&c[2]===yc[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(yc[3]||("http:"===yc[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=m.param(k.data,k.traditional)),Mc(Hc,k,b,v),2===t)return v;h=k.global,h&&0===m.active++&&m.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Ec.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(wc.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Bc.test(e)?e.replace(Bc,"$1_="+vc++):e+(wc.test(e)?"&":"?")+"_="+vc++)),k.ifModified&&(m.lastModified[e]&&v.setRequestHeader("If-Modified-Since",m.lastModified[e]),m.etag[e]&&v.setRequestHeader("If-None-Match",m.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Jc+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Mc(Ic,k,b,v)){v.readyState=1,h&&n.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Oc(k,v,c)),u=Pc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(m.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(m.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&n.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(n.trigger("ajaxComplete",[v,k]),--m.active||m.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return m.get(a,b,c,"json")},getScript:function(a,b){return m.get(a,void 0,b,"script")}}),m.each(["get","post"],function(a,b){m[b]=function(a,c,d,e){return m.isFunction(c)&&(e=e||d,d=c,c=void 0),m.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){m.fn[b]=function(a){return this.on(b,a)}}),m._evalUrl=function(a){return m.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},m.fn.extend({wrapAll:function(a){if(m.isFunction(a))return this.each(function(b){m(this).wrapAll(a.call(this,b))});if(this[0]){var b=m(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(m.isFunction(a)?function(b){m(this).wrapInner(a.call(this,b))}:function(){var b=m(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=m.isFunction(a);return this.each(function(c){m(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}}),m.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!k.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||m.css(a,"display"))},m.expr.filters.visible=function(a){return!m.expr.filters.hidden(a)};var Qc=/%20/g,Rc=/\[\]$/,Sc=/\r?\n/g,Tc=/^(?:submit|button|image|reset|file)$/i,Uc=/^(?:input|select|textarea|keygen)/i;function Vc(a,b,c,d){var e;if(m.isArray(b))m.each(b,function(b,e){c||Rc.test(a)?d(a,e):Vc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==m.type(b))d(a,b);else for(e in b)Vc(a+"["+e+"]",b[e],c,d)}m.param=function(a,b){var c,d=[],e=function(a,b){b=m.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=m.ajaxSettings&&m.ajaxSettings.traditional),m.isArray(a)||a.jquery&&!m.isPlainObject(a))m.each(a,function(){e(this.name,this.value)});else for(c in a)Vc(c,a[c],b,e);return d.join("&").replace(Qc,"+")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=m.prop(this,"elements");return a?m.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!m(this).is(":disabled")&&Uc.test(this.nodeName)&&!Tc.test(a)&&(this.checked||!W.test(a))}).map(function(a,b){var c=m(this).val();return null==c?null:m.isArray(c)?m.map(c,function(a){return{name:b.name,value:a.replace(Sc,"\r\n")}}):{name:b.name,value:c.replace(Sc,"\r\n")}}).get()}}),m.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zc()||$c()}:Zc;var Wc=0,Xc={},Yc=m.ajaxSettings.xhr();a.ActiveXObject&&m(a).on("unload",function(){for(var a in Xc)Xc[a](void 0,!0)}),k.cors=!!Yc&&"withCredentials"in Yc,Yc=k.ajax=!!Yc,Yc&&m.ajaxTransport(function(a){if(!a.crossDomain||k.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Wc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Xc[g],b=void 0,f.onreadystatechange=m.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Xc[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}});function Zc(){try{return new a.XMLHttpRequest}catch(b){}}function $c(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return m.globalEval(a),a}}}),m.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),m.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=y.head||m("head")[0]||y.documentElement;return{send:function(d,e){b=y.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var _c=[],ad=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=_c.pop()||m.expando+"_"+vc++;return this[a]=!0,a}}),m.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(ad.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&ad.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=m.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(ad,"$1"+e):b.jsonp!==!1&&(b.url+=(wc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||m.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,_c.push(e)),g&&m.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),m.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||y;var d=u.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=m.buildFragment([a],b,e),e&&e.length&&m(e).remove(),m.merge([],d.childNodes))};var bd=m.fn.load;m.fn.load=function(a,b,c){if("string"!=typeof a&&bd)return bd.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=m.trim(a.slice(h,a.length)),a=a.slice(0,h)),m.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&m.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?m("<div>").append(m.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},m.expr.filters.animated=function(a){return m.grep(m.timers,function(b){return a===b.elem}).length};var cd=a.document.documentElement;function dd(a){return m.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}m.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=m.css(a,"position"),l=m(a),n={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=m.css(a,"top"),i=m.css(a,"left"),j=("absolute"===k||"fixed"===k)&&m.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),m.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(n.top=b.top-h.top+g),null!=b.left&&(n.left=b.left-h.left+e),"using"in b?b.using.call(a,n):l.css(n)}},m.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){m.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,m.contains(b,e)?(typeof e.getBoundingClientRect!==K&&(d=e.getBoundingClientRect()),c=dd(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===m.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),m.nodeName(a[0],"html")||(c=a.offset()),c.top+=m.css(a[0],"borderTopWidth",!0),c.left+=m.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-m.css(d,"marginTop",!0),left:b.left-c.left-m.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||cd;while(a&&!m.nodeName(a,"html")&&"static"===m.css(a,"position"))a=a.offsetParent;return a||cd})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);m.fn[a]=function(d){return V(this,function(a,d,e){var f=dd(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?m(f).scrollLeft():e,c?e:m(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),m.each(["top","left"],function(a,b){m.cssHooks[b]=Lb(k.pixelPosition,function(a,c){return c?(c=Jb(a,b),Hb.test(c)?m(a).position()[b]+"px":c):void 0})}),m.each({Height:"height",Width:"width"},function(a,b){m.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){m.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return V(this,function(b,c,d){var e;return m.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?m.css(b,c,g):m.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),m.fn.size=function(){return this.length},m.fn.andSelf=m.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return m});var ed=a.jQuery,fd=a.$;return m.noConflict=function(b){return a.$===m&&(a.$=fd),b&&a.jQuery===m&&(a.jQuery=ed),m},typeof b===K&&(a.jQuery=a.$=m),m});

/* SOURCE FILE: soundmanager2-nodebug-jsmin.js (0e8174aa) 9/9/2014 2:09:01 PM */

/** @license
 *
 * SoundManager 2: JavaScript Sound for the Web
 * ----------------------------------------------
 * http://schillmania.com/projects/soundmanager2/
 *
 * Copyright (c) 2007, Scott Schiller. All rights reserved.
 * Code provided under the BSD License:
 * http://schillmania.com/projects/soundmanager2/license.txt
 *
 * V2.97a.20140901
 */
(function(g,h){function G(F,G){function W(b){return c.preferFlash&&v&&!c.ignoreFlash&&c.flash[b]!==h&&c.flash[b]}function r(b){return function(c){var d=this._s;return!d||!d._a?null:b.call(this,c)}}this.setupOptions={url:F||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1E3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,
html5Test:/^(probably|maybe)$/i,preferFlash:!1,noSWFCache:!1,idPrefix:"sound"};this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100};this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,
ondataerror:null};this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null};this.audioFormats={mp3:{type:['audio/mpeg; codecs\x3d"mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs\x3d"mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs\x3dvorbis"],required:!1},opus:{type:["audio/ogg; codecs\x3dopus","audio/opus"],required:!1},
wav:{type:['audio/wav; codecs\x3d"1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}};this.movieID="sm2-container";this.id=G||"sm2movie";this.debugID="soundmanager-debug";this.debugURLParam=/([#?&])debug=1/i;this.versionNumber="V2.97a.20140901";this.altURL=this.movieURL=this.version=null;this.enabled=this.swfLoaded=!1;this.oMC=null;this.sounds={};this.soundIDs=[];this.didFlashBlock=this.muted=!1;this.filePattern=null;this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i};this.features=
{buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1};this.sandbox={};this.html5={usingFlash:null};this.flash={};this.ignoreFlash=this.html5Only=!1;var Ja,c=this,Ka=null,k=null,X,t=navigator.userAgent,La=g.location.href.toString(),p=document,la,Ma,ma,n,x=[],M=!1,N=!1,m=!1,y=!1,na=!1,O,w,oa,Y,pa,D,H,I,Na,qa,ra,Z,sa,$,ta,E,ua,P,va,aa,J,Oa,wa,Pa,xa,Qa,Q=null,ya=null,R,za,K,ba,ca,q,S=!1,Aa=!1,Ra,Sa,Ta,da=0,T=null,ea,Ua=[],U,u=null,Va,fa,V,z,ga,Ba,Wa,s,fb=Array.prototype.slice,A=!1,Ca,v,Da,
Xa,B,ha,Ya=0,ia=t.match(/(ipad|iphone|ipod)/i),Za=t.match(/android/i),C=t.match(/msie/i),gb=t.match(/webkit/i),ja=t.match(/safari/i)&&!t.match(/chrome/i),Ea=t.match(/opera/i),Fa=t.match(/(mobile|pre\/|xoom)/i)||ia||Za,$a=!La.match(/usehtml5audio/i)&&!La.match(/sm2\-ignorebadua/i)&&ja&&!t.match(/silk/i)&&t.match(/OS X 10_6_([3-7])/i),Ga=p.hasFocus!==h?p.hasFocus():null,ka=ja&&(p.hasFocus===h||!p.hasFocus()),ab=!ka,bb=/(mp3|mp4|mpa|m4a|m4b)/i,Ha=p.location?p.location.protocol.match(/http/i):null,cb=
!Ha?"http://":"",db=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,eb="mpeg4 aac flv mov mp4 m4v f4v m4a m4b mp4v 3gp 3g2".split(" "),hb=RegExp("\\.("+eb.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i;this.useAltURL=!Ha;var Ia;try{Ia=Audio!==h&&(Ea&&opera!==h&&10>opera.version()?new Audio(null):new Audio).canPlayType!==h}catch(ib){Ia=!1}this.hasHTML5=Ia;this.setup=function(b){var e=!c.url;b!==h&&m&&u&&c.ok();oa(b);b&&
(e&&(P&&b.url!==h)&&c.beginDelayedInit(),!P&&(b.url!==h&&"complete"===p.readyState)&&setTimeout(E,1));return c};this.supported=this.ok=function(){return u?m&&!y:c.useHTML5Audio&&c.hasHTML5};this.getMovie=function(b){return X(b)||p[b]||g[b]};this.createSound=function(b,e){function d(){a=ba(a);c.sounds[a.id]=new Ja(a);c.soundIDs.push(a.id);return c.sounds[a.id]}var a,f=null;if(!m||!c.ok())return!1;e!==h&&(b={id:b,url:e});a=w(b);a.url=ea(a.url);void 0===a.id&&(a.id=c.setupOptions.idPrefix+Ya++);if(q(a.id,
!0))return c.sounds[a.id];if(fa(a))f=d(),f._setup_html5(a);else{if(c.html5Only||c.html5.usingFlash&&a.url&&a.url.match(/data\:/i))return d();8<n&&null===a.isMovieStar&&(a.isMovieStar=!(!a.serverURL&&!(a.type&&a.type.match(db)||a.url&&a.url.match(hb))));a=ca(a,void 0);f=d();8===n?k._createSound(a.id,a.loops||1,a.usePolicyFile):(k._createSound(a.id,a.url,a.usePeakData,a.useWaveformData,a.useEQData,a.isMovieStar,a.isMovieStar?a.bufferTime:!1,a.loops||1,a.serverURL,a.duration||null,a.autoPlay,!0,a.autoLoad,
a.usePolicyFile),a.serverURL||(f.connected=!0,a.onconnect&&a.onconnect.apply(f)));!a.serverURL&&(a.autoLoad||a.autoPlay)&&f.load(a)}!a.serverURL&&a.autoPlay&&f.play();return f};this.destroySound=function(b,e){if(!q(b))return!1;var d=c.sounds[b],a;d._iO={};d.stop();d.unload();for(a=0;a<c.soundIDs.length;a++)if(c.soundIDs[a]===b){c.soundIDs.splice(a,1);break}e||d.destruct(!0);delete c.sounds[b];return!0};this.load=function(b,e){return!q(b)?!1:c.sounds[b].load(e)};this.unload=function(b){return!q(b)?
!1:c.sounds[b].unload()};this.onposition=this.onPosition=function(b,e,d,a){return!q(b)?!1:c.sounds[b].onposition(e,d,a)};this.clearOnPosition=function(b,e,d){return!q(b)?!1:c.sounds[b].clearOnPosition(e,d)};this.start=this.play=function(b,e){var d=null,a=e&&!(e instanceof Object);if(!m||!c.ok())return!1;if(q(b,a))a&&(e={url:e});else{if(!a)return!1;a&&(e={url:e});e&&e.url&&(e.id=b,d=c.createSound(e).play())}null===d&&(d=c.sounds[b].play(e));return d};this.setPosition=function(b,e){return!q(b)?!1:c.sounds[b].setPosition(e)};
this.stop=function(b){return!q(b)?!1:c.sounds[b].stop()};this.stopAll=function(){for(var b in c.sounds)c.sounds.hasOwnProperty(b)&&c.sounds[b].stop()};this.pause=function(b){return!q(b)?!1:c.sounds[b].pause()};this.pauseAll=function(){var b;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].pause()};this.resume=function(b){return!q(b)?!1:c.sounds[b].resume()};this.resumeAll=function(){var b;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].resume()};this.togglePause=function(b){return!q(b)?
!1:c.sounds[b].togglePause()};this.setPan=function(b,e){return!q(b)?!1:c.sounds[b].setPan(e)};this.setVolume=function(b,e){return!q(b)?!1:c.sounds[b].setVolume(e)};this.mute=function(b){var e=0;b instanceof String&&(b=null);if(b)return!q(b)?!1:c.sounds[b].mute();for(e=c.soundIDs.length-1;0<=e;e--)c.sounds[c.soundIDs[e]].mute();return c.muted=!0};this.muteAll=function(){c.mute()};this.unmute=function(b){b instanceof String&&(b=null);if(b)return!q(b)?!1:c.sounds[b].unmute();for(b=c.soundIDs.length-
1;0<=b;b--)c.sounds[c.soundIDs[b]].unmute();c.muted=!1;return!0};this.unmuteAll=function(){c.unmute()};this.toggleMute=function(b){return!q(b)?!1:c.sounds[b].toggleMute()};this.getMemoryUse=function(){var b=0;k&&8!==n&&(b=parseInt(k._getMemoryUse(),10));return b};this.disable=function(b){var e;b===h&&(b=!1);if(y)return!1;y=!0;for(e=c.soundIDs.length-1;0<=e;e--)Pa(c.sounds[c.soundIDs[e]]);O(b);s.remove(g,"load",H);return!0};this.canPlayMIME=function(b){var e;c.hasHTML5&&(e=V({type:b}));!e&&u&&(e=b&&
c.ok()?!!(8<n&&b.match(db)||b.match(c.mimePattern)):null);return e};this.canPlayURL=function(b){var e;c.hasHTML5&&(e=V({url:b}));!e&&u&&(e=b&&c.ok()?!!b.match(c.filePattern):null);return e};this.canPlayLink=function(b){return b.type!==h&&b.type&&c.canPlayMIME(b.type)?!0:c.canPlayURL(b.href)};this.getSoundById=function(b,e){return!b?null:c.sounds[b]};this.onready=function(b,c){if("function"===typeof b)c||(c=g),pa("onready",b,c),D();else throw R("needFunction","onready");return!0};this.ontimeout=function(b,
c){if("function"===typeof b)c||(c=g),pa("ontimeout",b,c),D({type:"ontimeout"});else throw R("needFunction","ontimeout");return!0};this._wD=this._writeDebug=function(b,c){return!0};this._debug=function(){};this.reboot=function(b,e){var d,a,f;for(d=c.soundIDs.length-1;0<=d;d--)c.sounds[c.soundIDs[d]].destruct();if(k)try{C&&(ya=k.innerHTML),Q=k.parentNode.removeChild(k)}catch(h){}ya=Q=u=k=null;c.enabled=P=m=S=Aa=M=N=y=A=c.swfLoaded=!1;c.soundIDs=[];c.sounds={};Ya=0;if(b)x=[];else for(d in x)if(x.hasOwnProperty(d)){a=
0;for(f=x[d].length;a<f;a++)x[d][a].fired=!1}c.html5={usingFlash:null};c.flash={};c.html5Only=!1;c.ignoreFlash=!1;g.setTimeout(function(){ta();e||c.beginDelayedInit()},20);return c};this.reset=function(){return c.reboot(!0,!0)};this.getMoviePercent=function(){return k&&"PercentLoaded"in k?k.PercentLoaded():null};this.beginDelayedInit=function(){na=!0;E();setTimeout(function(){if(Aa)return!1;aa();$();return Aa=!0},20);I()};this.destruct=function(){c.disable(!0)};Ja=function(b){var e,d,a=this,f,l,L,
g,p,r,t=!1,m=[],u=0,x,y,v=null,z;d=e=null;this.sID=this.id=b.id;this.url=b.url;this._iO=this.instanceOptions=this.options=w(b);this.pan=this.options.pan;this.volume=this.options.volume;this.isHTML5=!1;this._a=null;z=this.url?!1:!0;this.id3={};this._debug=function(){};this.load=function(b){var e=null,d;b!==h?a._iO=w(b,a.options):(b=a.options,a._iO=b,v&&v!==a.url&&(a._iO.url=a.url,a.url=null));a._iO.url||(a._iO.url=a.url);a._iO.url=ea(a._iO.url);d=a.instanceOptions=a._iO;if(!d.url&&!a.url)return a;
if(d.url===a.url&&0!==a.readyState&&2!==a.readyState)return 3===a.readyState&&d.onload&&ha(a,function(){d.onload.apply(a,[!!a.duration])}),a;a.loaded=!1;a.readyState=1;a.playState=0;a.id3={};if(fa(d))e=a._setup_html5(d),e._called_load||(a._html5_canplay=!1,a.url!==d.url&&(a._a.src=d.url,a.setPosition(0)),a._a.autobuffer="auto",a._a.preload="auto",a._a._called_load=!0);else{if(c.html5Only||a._iO.url&&a._iO.url.match(/data\:/i))return a;try{a.isHTML5=!1;a._iO=ca(ba(d));if(a._iO.autoPlay&&(a._iO.position||
a._iO.from))a._iO.autoPlay=!1;d=a._iO;8===n?k._load(a.id,d.url,d.stream,d.autoPlay,d.usePolicyFile):k._load(a.id,d.url,!!d.stream,!!d.autoPlay,d.loops||1,!!d.autoLoad,d.usePolicyFile)}catch(f){J({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}a.url=d.url;return a};this.unload=function(){0!==a.readyState&&(a.isHTML5?(g(),a._a&&(a._a.pause(),v=ga(a._a))):8===n?k._unload(a.id,"about:blank"):k._unload(a.id),f());return a};this.destruct=function(b){a.isHTML5?(g(),a._a&&(a._a.pause(),ga(a._a),A||L(),a._a._s=
null,a._a=null)):(a._iO.onfailure=null,k._destroySound(a.id));b||c.destroySound(a.id,!0)};this.start=this.play=function(b,e){var d,f,l,g,L;f=!0;f=null;e=e===h?!0:e;b||(b={});a.url&&(a._iO.url=a.url);a._iO=w(a._iO,a.options);a._iO=w(b,a._iO);a._iO.url=ea(a._iO.url);a.instanceOptions=a._iO;if(!a.isHTML5&&a._iO.serverURL&&!a.connected)return a.getAutoPlay()||a.setAutoPlay(!0),a;fa(a._iO)&&(a._setup_html5(a._iO),p());1===a.playState&&!a.paused&&(d=a._iO.multiShot,d||(a.isHTML5&&a.setPosition(a._iO.position),
f=a));if(null!==f)return f;b.url&&b.url!==a.url&&(!a.readyState&&!a.isHTML5&&8===n&&z?z=!1:a.load(a._iO));a.loaded||(0===a.readyState?(!a.isHTML5&&!c.html5Only?(a._iO.autoPlay=!0,a.load(a._iO)):a.isHTML5?a.load(a._iO):f=a,a.instanceOptions=a._iO):2===a.readyState&&(f=a));if(null!==f)return f;!a.isHTML5&&(9===n&&0<a.position&&a.position===a.duration)&&(b.position=0);if(a.paused&&0<=a.position&&(!a._iO.serverURL||0<a.position))a.resume();else{a._iO=w(b,a._iO);if((!a.isHTML5&&null!==a._iO.position&&
0<a._iO.position||null!==a._iO.from&&0<a._iO.from||null!==a._iO.to)&&0===a.instanceCount&&0===a.playState&&!a._iO.serverURL){d=function(){a._iO=w(b,a._iO);a.play(a._iO)};if(a.isHTML5&&!a._html5_canplay)a.load({_oncanplay:d}),f=!1;else if(!a.isHTML5&&!a.loaded&&(!a.readyState||2!==a.readyState))a.load({onload:d}),f=!1;if(null!==f)return f;a._iO=y()}(!a.instanceCount||a._iO.multiShotEvents||a.isHTML5&&a._iO.multiShot&&!A||!a.isHTML5&&8<n&&!a.getAutoPlay())&&a.instanceCount++;a._iO.onposition&&0===a.playState&&
r(a);a.playState=1;a.paused=!1;a.position=a._iO.position!==h&&!isNaN(a._iO.position)?a._iO.position:0;a.isHTML5||(a._iO=ca(ba(a._iO)));a._iO.onplay&&e&&(a._iO.onplay.apply(a),t=!0);a.setVolume(a._iO.volume,!0);a.setPan(a._iO.pan,!0);a.isHTML5?2>a.instanceCount?(p(),f=a._setup_html5(),a.setPosition(a._iO.position),f.play()):(l=new Audio(a._iO.url),g=function(){s.remove(l,"ended",g);a._onfinish(a);ga(l);l=null},L=function(){s.remove(l,"canplay",L);try{l.currentTime=a._iO.position/1E3}catch(b){}l.play()},
s.add(l,"ended",g),void 0!==a._iO.volume&&(l.volume=Math.max(0,Math.min(1,a._iO.volume/100))),a.muted&&(l.muted=!0),a._iO.position?s.add(l,"canplay",L):l.play()):(f=k._start(a.id,a._iO.loops||1,9===n?a.position:a.position/1E3,a._iO.multiShot||!1),9===n&&!f&&a._iO.onplayerror&&a._iO.onplayerror.apply(a))}return a};this.stop=function(b){var c=a._iO;1===a.playState&&(a._onbufferchange(0),a._resetOnPosition(0),a.paused=!1,a.isHTML5||(a.playState=0),x(),c.to&&a.clearOnPosition(c.to),a.isHTML5?a._a&&(b=
a.position,a.setPosition(0),a.position=b,a._a.pause(),a.playState=0,a._onTimer(),g()):(k._stop(a.id,b),c.serverURL&&a.unload()),a.instanceCount=0,a._iO={},c.onstop&&c.onstop.apply(a));return a};this.setAutoPlay=function(b){a._iO.autoPlay=b;a.isHTML5||(k._setAutoPlay(a.id,b),b&&!a.instanceCount&&1===a.readyState&&a.instanceCount++)};this.getAutoPlay=function(){return a._iO.autoPlay};this.setPosition=function(b){b===h&&(b=0);var c=a.isHTML5?Math.max(b,0):Math.min(a.duration||a._iO.duration,Math.max(b,
0));a.position=c;b=a.position/1E3;a._resetOnPosition(a.position);a._iO.position=c;if(a.isHTML5){if(a._a){if(a._html5_canplay){if(a._a.currentTime!==b)try{a._a.currentTime=b,(0===a.playState||a.paused)&&a._a.pause()}catch(e){}}else if(b)return a;a.paused&&a._onTimer(!0)}}else b=9===n?a.position:b,a.readyState&&2!==a.readyState&&k._setPosition(a.id,b,a.paused||!a.playState,a._iO.multiShot);return a};this.pause=function(b){if(a.paused||0===a.playState&&1!==a.readyState)return a;a.paused=!0;a.isHTML5?
(a._setup_html5().pause(),g()):(b||b===h)&&k._pause(a.id,a._iO.multiShot);a._iO.onpause&&a._iO.onpause.apply(a);return a};this.resume=function(){var b=a._iO;if(!a.paused)return a;a.paused=!1;a.playState=1;a.isHTML5?(a._setup_html5().play(),p()):(b.isMovieStar&&!b.serverURL&&a.setPosition(a.position),k._pause(a.id,b.multiShot));!t&&b.onplay?(b.onplay.apply(a),t=!0):b.onresume&&b.onresume.apply(a);return a};this.togglePause=function(){if(0===a.playState)return a.play({position:9===n&&!a.isHTML5?a.position:
a.position/1E3}),a;a.paused?a.resume():a.pause();return a};this.setPan=function(b,c){b===h&&(b=0);c===h&&(c=!1);a.isHTML5||k._setPan(a.id,b);a._iO.pan=b;c||(a.pan=b,a.options.pan=b);return a};this.setVolume=function(b,e){b===h&&(b=100);e===h&&(e=!1);a.isHTML5?a._a&&(c.muted&&!a.muted&&(a.muted=!0,a._a.muted=!0),a._a.volume=Math.max(0,Math.min(1,b/100))):k._setVolume(a.id,c.muted&&!a.muted||a.muted?0:b);a._iO.volume=b;e||(a.volume=b,a.options.volume=b);return a};this.mute=function(){a.muted=!0;a.isHTML5?
a._a&&(a._a.muted=!0):k._setVolume(a.id,0);return a};this.unmute=function(){a.muted=!1;var b=a._iO.volume!==h;a.isHTML5?a._a&&(a._a.muted=!1):k._setVolume(a.id,b?a._iO.volume:a.options.volume);return a};this.toggleMute=function(){return a.muted?a.unmute():a.mute()};this.onposition=this.onPosition=function(b,c,e){m.push({position:parseInt(b,10),method:c,scope:e!==h?e:a,fired:!1});return a};this.clearOnPosition=function(a,b){var c;a=parseInt(a,10);if(isNaN(a))return!1;for(c=0;c<m.length;c++)if(a===
m[c].position&&(!b||b===m[c].method))m[c].fired&&u--,m.splice(c,1)};this._processOnPosition=function(){var b,c;b=m.length;if(!b||!a.playState||u>=b)return!1;for(b-=1;0<=b;b--)c=m[b],!c.fired&&a.position>=c.position&&(c.fired=!0,u++,c.method.apply(c.scope,[c.position]));return!0};this._resetOnPosition=function(a){var b,c;b=m.length;if(!b)return!1;for(b-=1;0<=b;b--)c=m[b],c.fired&&a<=c.position&&(c.fired=!1,u--);return!0};y=function(){var b=a._iO,c=b.from,e=b.to,d,f;f=function(){a.clearOnPosition(e,
f);a.stop()};d=function(){if(null!==e&&!isNaN(e))a.onPosition(e,f)};null!==c&&!isNaN(c)&&(b.position=c,b.multiShot=!1,d());return b};r=function(){var b,c=a._iO.onposition;if(c)for(b in c)if(c.hasOwnProperty(b))a.onPosition(parseInt(b,10),c[b])};x=function(){var b,c=a._iO.onposition;if(c)for(b in c)c.hasOwnProperty(b)&&a.clearOnPosition(parseInt(b,10))};p=function(){a.isHTML5&&Ra(a)};g=function(){a.isHTML5&&Sa(a)};f=function(b){b||(m=[],u=0);t=!1;a._hasTimer=null;a._a=null;a._html5_canplay=!1;a.bytesLoaded=
null;a.bytesTotal=null;a.duration=a._iO&&a._iO.duration?a._iO.duration:null;a.durationEstimate=null;a.buffered=[];a.eqData=[];a.eqData.left=[];a.eqData.right=[];a.failures=0;a.isBuffering=!1;a.instanceOptions={};a.instanceCount=0;a.loaded=!1;a.metadata={};a.readyState=0;a.muted=!1;a.paused=!1;a.peakData={left:0,right:0};a.waveformData={left:[],right:[]};a.playState=0;a.position=null;a.id3={}};f();this._onTimer=function(b){var c,f=!1,l={};if(a._hasTimer||b){if(a._a&&(b||(0<a.playState||1===a.readyState)&&
!a.paused))c=a._get_html5_duration(),c!==e&&(e=c,a.duration=c,f=!0),a.durationEstimate=a.duration,c=1E3*a._a.currentTime||0,c!==d&&(d=c,f=!0),(f||b)&&a._whileplaying(c,l,l,l,l);return f}};this._get_html5_duration=function(){var b=a._iO;return(b=a._a&&a._a.duration?1E3*a._a.duration:b&&b.duration?b.duration:null)&&!isNaN(b)&&Infinity!==b?b:null};this._apply_loop=function(a,b){a.loop=1<b?"loop":""};this._setup_html5=function(b){b=w(a._iO,b);var c=A?Ka:a._a,e=decodeURI(b.url),d;A?e===decodeURI(Ca)&&
(d=!0):e===decodeURI(v)&&(d=!0);if(c){if(c._s)if(A)c._s&&(c._s.playState&&!d)&&c._s.stop();else if(!A&&e===decodeURI(v))return a._apply_loop(c,b.loops),c;d||(v&&f(!1),c.src=b.url,Ca=v=a.url=b.url,c._called_load=!1)}else b.autoLoad||b.autoPlay?(a._a=new Audio(b.url),a._a.load()):a._a=Ea&&10>opera.version()?new Audio(null):new Audio,c=a._a,c._called_load=!1,A&&(Ka=c);a.isHTML5=!0;a._a=c;c._s=a;l();a._apply_loop(c,b.loops);b.autoLoad||b.autoPlay?a.load():(c.autobuffer=!1,c.preload="auto");return c};
l=function(){if(a._a._added_events)return!1;var b;a._a._added_events=!0;for(b in B)B.hasOwnProperty(b)&&a._a&&a._a.addEventListener(b,B[b],!1);return!0};L=function(){var b;a._a._added_events=!1;for(b in B)B.hasOwnProperty(b)&&a._a&&a._a.removeEventListener(b,B[b],!1)};this._onload=function(b){var c=!!b||!a.isHTML5&&8===n&&a.duration;a.loaded=c;a.readyState=c?3:2;a._onbufferchange(0);a._iO.onload&&ha(a,function(){a._iO.onload.apply(a,[c])});return!0};this._onbufferchange=function(b){if(0===a.playState||
b&&a.isBuffering||!b&&!a.isBuffering)return!1;a.isBuffering=1===b;a._iO.onbufferchange&&a._iO.onbufferchange.apply(a,[b]);return!0};this._onsuspend=function(){a._iO.onsuspend&&a._iO.onsuspend.apply(a);return!0};this._onfailure=function(b,c,e){a.failures++;if(a._iO.onfailure&&1===a.failures)a._iO.onfailure(b,c,e)};this._onwarning=function(b,c,e){if(a._iO.onwarning)a._iO.onwarning(b,c,e)};this._onfinish=function(){var b=a._iO.onfinish;a._onbufferchange(0);a._resetOnPosition(0);a.instanceCount&&(a.instanceCount--,
a.instanceCount||(x(),a.playState=0,a.paused=!1,a.instanceCount=0,a.instanceOptions={},a._iO={},g(),a.isHTML5&&(a.position=0)),(!a.instanceCount||a._iO.multiShotEvents)&&b&&ha(a,function(){b.apply(a)}))};this._whileloading=function(b,c,e,d){var f=a._iO;a.bytesLoaded=b;a.bytesTotal=c;a.duration=Math.floor(e);a.bufferLength=d;a.durationEstimate=!a.isHTML5&&!f.isMovieStar?f.duration?a.duration>f.duration?a.duration:f.duration:parseInt(a.bytesTotal/a.bytesLoaded*a.duration,10):a.duration;a.isHTML5||(a.buffered=
[{start:0,end:a.duration}]);(3!==a.readyState||a.isHTML5)&&f.whileloading&&f.whileloading.apply(a)};this._whileplaying=function(b,c,e,d,f){var l=a._iO;if(isNaN(b)||null===b)return!1;a.position=Math.max(0,b);a._processOnPosition();!a.isHTML5&&8<n&&(l.usePeakData&&(c!==h&&c)&&(a.peakData={left:c.leftPeak,right:c.rightPeak}),l.useWaveformData&&(e!==h&&e)&&(a.waveformData={left:e.split(","),right:d.split(",")}),l.useEQData&&(f!==h&&f&&f.leftEQ)&&(b=f.leftEQ.split(","),a.eqData=b,a.eqData.left=b,f.rightEQ!==
h&&f.rightEQ&&(a.eqData.right=f.rightEQ.split(","))));1===a.playState&&(!a.isHTML5&&(8===n&&!a.position&&a.isBuffering)&&a._onbufferchange(0),l.whileplaying&&l.whileplaying.apply(a));return!0};this._oncaptiondata=function(b){a.captiondata=b;a._iO.oncaptiondata&&a._iO.oncaptiondata.apply(a,[b])};this._onmetadata=function(b,c){var e={},d,f;d=0;for(f=b.length;d<f;d++)e[b[d]]=c[d];a.metadata=e;console.log("updated metadata",a.metadata);a._iO.onmetadata&&a._iO.onmetadata.call(a,a.metadata)};this._onid3=
function(b,c){var e=[],d,f;d=0;for(f=b.length;d<f;d++)e[b[d]]=c[d];a.id3=w(a.id3,e);a._iO.onid3&&a._iO.onid3.apply(a)};this._onconnect=function(b){b=1===b;if(a.connected=b)a.failures=0,q(a.id)&&(a.getAutoPlay()?a.play(h,a.getAutoPlay()):a._iO.autoLoad&&a.load()),a._iO.onconnect&&a._iO.onconnect.apply(a,[b])};this._ondataerror=function(b){0<a.playState&&a._iO.ondataerror&&a._iO.ondataerror.apply(a)}};va=function(){return p.body||p.getElementsByTagName("div")[0]};X=function(b){return p.getElementById(b)};
w=function(b,e){var d=b||{},a,f;a=e===h?c.defaultOptions:e;for(f in a)a.hasOwnProperty(f)&&d[f]===h&&(d[f]="object"!==typeof a[f]||null===a[f]?a[f]:w(d[f],a[f]));return d};ha=function(b,c){!b.isHTML5&&8===n?g.setTimeout(c,0):c()};Y={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1};oa=function(b,e){var d,a=!0,f=e!==h,l=c.setupOptions;for(d in b)if(b.hasOwnProperty(d))if("object"!==typeof b[d]||null===b[d]||b[d]instanceof Array||b[d]instanceof RegExp)f&&Y[e]!==h?c[e][d]=b[d]:
l[d]!==h?(c.setupOptions[d]=b[d],c[d]=b[d]):Y[d]===h?a=!1:c[d]instanceof Function?c[d].apply(c,b[d]instanceof Array?b[d]:[b[d]]):c[d]=b[d];else if(Y[d]===h)a=!1;else return oa(b[d],d);return a};s=function(){function b(a){a=fb.call(a);var b=a.length;d?(a[1]="on"+a[1],3<b&&a.pop()):3===b&&a.push(!1);return a}function c(b,e){var h=b.shift(),g=[a[e]];if(d)h[g](b[0],b[1]);else h[g].apply(h,b)}var d=g.attachEvent,a={add:d?"attachEvent":"addEventListener",remove:d?"detachEvent":"removeEventListener"};return{add:function(){c(b(arguments),
"add")},remove:function(){c(b(arguments),"remove")}}}();B={abort:r(function(){}),canplay:r(function(){var b=this._s,c;if(b._html5_canplay)return!0;b._html5_canplay=!0;b._onbufferchange(0);c=b._iO.position!==h&&!isNaN(b._iO.position)?b._iO.position/1E3:null;if(this.currentTime!==c)try{this.currentTime=c}catch(d){}b._iO._oncanplay&&b._iO._oncanplay()}),canplaythrough:r(function(){var b=this._s;b.loaded||(b._onbufferchange(0),b._whileloading(b.bytesLoaded,b.bytesTotal,b._get_html5_duration()),b._onload(!0))}),
durationchange:r(function(){var b=this._s,c;c=b._get_html5_duration();!isNaN(c)&&c!==b.duration&&(b.durationEstimate=b.duration=c)}),ended:r(function(){this._s._onfinish()}),error:r(function(){this._s._onload(!1)}),loadeddata:r(function(){var b=this._s;!b._loaded&&!ja&&(b.duration=b._get_html5_duration())}),loadedmetadata:r(function(){}),loadstart:r(function(){this._s._onbufferchange(1)}),play:r(function(){this._s._onbufferchange(0)}),playing:r(function(){this._s._onbufferchange(0)}),progress:r(function(b){var c=
this._s,d,a,f=0,f=b.target.buffered;d=b.loaded||0;var l=b.total||1;c.buffered=[];if(f&&f.length){d=0;for(a=f.length;d<a;d++)c.buffered.push({start:1E3*f.start(d),end:1E3*f.end(d)});f=1E3*(f.end(0)-f.start(0));d=Math.min(1,f/(1E3*b.target.duration))}isNaN(d)||(c._whileloading(d,l,c._get_html5_duration()),d&&(l&&d===l)&&B.canplaythrough.call(this,b))}),ratechange:r(function(){}),suspend:r(function(b){var c=this._s;B.progress.call(this,b);c._onsuspend()}),stalled:r(function(){}),timeupdate:r(function(){this._s._onTimer()}),
waiting:r(function(){this._s._onbufferchange(1)})};fa=function(b){return!b||!b.type&&!b.url&&!b.serverURL?!1:b.serverURL||b.type&&W(b.type)?!1:b.type?V({type:b.type}):V({url:b.url})||c.html5Only||b.url.match(/data\:/i)};ga=function(b){var e;b&&(e=ja?"about:blank":c.html5.canPlayType("audio/wav")?"data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w\x3d\x3d":"about:blank",b.src=e,void 0!==b._called_unload&&(b._called_load=!1));A&&(Ca=null);return e};V=function(b){if(!c.useHTML5Audio||
!c.hasHTML5)return!1;var e=b.url||null;b=b.type||null;var d=c.audioFormats,a;if(b&&c.html5[b]!==h)return c.html5[b]&&!W(b);if(!z){z=[];for(a in d)d.hasOwnProperty(a)&&(z.push(a),d[a].related&&(z=z.concat(d[a].related)));z=RegExp("\\.("+z.join("|")+")(\\?.*)?$","i")}a=e?e.toLowerCase().match(z):null;!a||!a.length?b&&(e=b.indexOf(";"),a=(-1!==e?b.substr(0,e):b).substr(6)):a=a[1];a&&c.html5[a]!==h?e=c.html5[a]&&!W(a):(b="audio/"+a,e=c.html5.canPlayType({type:b}),e=(c.html5[a]=e)&&c.html5[b]&&!W(b));
return e};Wa=function(){function b(a){var b,d=b=!1;if(!e||"function"!==typeof e.canPlayType)return b;if(a instanceof Array){g=0;for(b=a.length;g<b;g++)if(c.html5[a[g]]||e.canPlayType(a[g]).match(c.html5Test))d=!0,c.html5[a[g]]=!0,c.flash[a[g]]=!!a[g].match(bb);b=d}else a=e&&"function"===typeof e.canPlayType?e.canPlayType(a):!1,b=!(!a||!a.match(c.html5Test));return b}if(!c.useHTML5Audio||!c.hasHTML5)return u=c.html5.usingFlash=!0,!1;var e=Audio!==h?Ea&&10>opera.version()?new Audio(null):new Audio:
null,d,a,f={},l,g;l=c.audioFormats;for(d in l)if(l.hasOwnProperty(d)&&(a="audio/"+d,f[d]=b(l[d].type),f[a]=f[d],d.match(bb)?(c.flash[d]=!0,c.flash[a]=!0):(c.flash[d]=!1,c.flash[a]=!1),l[d]&&l[d].related))for(g=l[d].related.length-1;0<=g;g--)f["audio/"+l[d].related[g]]=f[d],c.html5[l[d].related[g]]=f[d],c.flash[l[d].related[g]]=f[d];f.canPlayType=e?b:null;c.html5=w(c.html5,f);c.html5.usingFlash=Va();u=c.html5.usingFlash;return!0};sa={};R=function(){};ba=function(b){8===n&&(1<b.loops&&b.stream)&&(b.stream=
!1);return b};ca=function(b,c){if(b&&!b.usePolicyFile&&(b.onid3||b.usePeakData||b.useWaveformData||b.useEQData))b.usePolicyFile=!0;return b};la=function(){return!1};Pa=function(b){for(var c in b)b.hasOwnProperty(c)&&"function"===typeof b[c]&&(b[c]=la)};xa=function(b){b===h&&(b=!1);(y||b)&&c.disable(b)};Qa=function(b){var e=null;if(b)if(b.match(/\.swf(\?.*)?$/i)){if(e=b.substr(b.toLowerCase().lastIndexOf(".swf?")+4))return b}else b.lastIndexOf("/")!==b.length-1&&(b+="/");b=(b&&-1!==b.lastIndexOf("/")?
b.substr(0,b.lastIndexOf("/")+1):"./")+c.movieURL;c.noSWFCache&&(b+="?ts\x3d"+(new Date).getTime());return b};ra=function(){n=parseInt(c.flashVersion,10);8!==n&&9!==n&&(c.flashVersion=n=8);var b=c.debugMode||c.debugFlash?"_debug.swf":".swf";c.useHTML5Audio&&(!c.html5Only&&c.audioFormats.mp4.required&&9>n)&&(c.flashVersion=n=9);c.version=c.versionNumber+(c.html5Only?" (HTML5-only mode)":9===n?" (AS3/Flash 9)":" (AS2/Flash 8)");8<n?(c.defaultOptions=w(c.defaultOptions,c.flash9Options),c.features.buffering=
!0,c.defaultOptions=w(c.defaultOptions,c.movieStarOptions),c.filePatterns.flash9=RegExp("\\.(mp3|"+eb.join("|")+")(\\?.*)?$","i"),c.features.movieStar=!0):c.features.movieStar=!1;c.filePattern=c.filePatterns[8!==n?"flash9":"flash8"];c.movieURL=(8===n?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",b);c.features.peakData=c.features.waveformData=c.features.eqData=8<n};Oa=function(b,c){if(!k)return!1;k._setPolling(b,c)};wa=function(){};q=this.getSoundById;K=function(){var b=[];c.debugMode&&
b.push("sm2_debug");c.debugFlash&&b.push("flash_debug");c.useHighPerformance&&b.push("high_performance");return b.join(" ")};za=function(){R("fbHandler");var b=c.getMoviePercent(),e={type:"FLASHBLOCK"};if(c.html5Only)return!1;c.ok()?c.oMC&&(c.oMC.className=[K(),"movieContainer","swf_loaded"+(c.didFlashBlock?" swf_unblocked":"")].join(" ")):(u&&(c.oMC.className=K()+" movieContainer "+(null===b?"swf_timedout":"swf_error")),c.didFlashBlock=!0,D({type:"ontimeout",ignoreInit:!0,error:e}),J(e))};pa=function(b,
c,d){x[b]===h&&(x[b]=[]);x[b].push({method:c,scope:d||null,fired:!1})};D=function(b){b||(b={type:c.ok()?"onready":"ontimeout"});if(!m&&b&&!b.ignoreInit||"ontimeout"===b.type&&(c.ok()||y&&!b.ignoreInit))return!1;var e={success:b&&b.ignoreInit?c.ok():!y},d=b&&b.type?x[b.type]||[]:[],a=[],f,e=[e],g=u&&!c.ok();b.error&&(e[0].error=b.error);b=0;for(f=d.length;b<f;b++)!0!==d[b].fired&&a.push(d[b]);if(a.length){b=0;for(f=a.length;b<f;b++)a[b].scope?a[b].method.apply(a[b].scope,e):a[b].method.apply(this,
e),g||(a[b].fired=!0)}return!0};H=function(){g.setTimeout(function(){c.useFlashBlock&&za();D();"function"===typeof c.onload&&c.onload.apply(g);c.waitForWindowLoad&&s.add(g,"load",H)},1)};Da=function(){if(v!==h)return v;var b=!1,c=navigator,d=c.plugins,a,f=g.ActiveXObject;if(d&&d.length)(c=c.mimeTypes)&&(c["application/x-shockwave-flash"]&&c["application/x-shockwave-flash"].enabledPlugin&&c["application/x-shockwave-flash"].enabledPlugin.description)&&(b=!0);else if(f!==h&&!t.match(/MSAppHost/i)){try{a=
new f("ShockwaveFlash.ShockwaveFlash")}catch(l){a=null}b=!!a}return v=b};Va=function(){var b,e,d=c.audioFormats;if(ia&&t.match(/os (1|2|3_0|3_1)\s/i))c.hasHTML5=!1,c.html5Only=!0,c.oMC&&(c.oMC.style.display="none");else if(c.useHTML5Audio&&(!c.html5||!c.html5.canPlayType))c.hasHTML5=!1;if(c.useHTML5Audio&&c.hasHTML5)for(e in U=!0,d)if(d.hasOwnProperty(e)&&d[e].required)if(c.html5.canPlayType(d[e].type)){if(c.preferFlash&&(c.flash[e]||c.flash[d[e].type]))b=!0}else U=!1,b=!0;c.ignoreFlash&&(b=!1,U=
!0);c.html5Only=c.hasHTML5&&c.useHTML5Audio&&!b;return!c.html5Only};ea=function(b){var e,d,a=0;if(b instanceof Array){e=0;for(d=b.length;e<d;e++)if(b[e]instanceof Object){if(c.canPlayMIME(b[e].type)){a=e;break}}else if(c.canPlayURL(b[e])){a=e;break}b[a].url&&(b[a]=b[a].url);b=b[a]}return b};Ra=function(b){b._hasTimer||(b._hasTimer=!0,!Fa&&c.html5PollingInterval&&(null===T&&0===da&&(T=setInterval(Ta,c.html5PollingInterval)),da++))};Sa=function(b){b._hasTimer&&(b._hasTimer=!1,!Fa&&c.html5PollingInterval&&
da--)};Ta=function(){var b;if(null!==T&&!da)return clearInterval(T),T=null,!1;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].isHTML5&&c.sounds[c.soundIDs[b]]._hasTimer&&c.sounds[c.soundIDs[b]]._onTimer()};J=function(b){b=b!==h?b:{};"function"===typeof c.onerror&&c.onerror.apply(g,[{type:b.type!==h?b.type:null}]);b.fatal!==h&&b.fatal&&c.disable()};Xa=function(){if(!$a||!Da())return!1;var b=c.audioFormats,e,d;for(d in b)if(b.hasOwnProperty(d)&&("mp3"===d||"mp4"===d))if(c.html5[d]=!1,b[d]&&
b[d].related)for(e=b[d].related.length-1;0<=e;e--)c.html5[b[d].related[e]]=!1};this._setSandboxType=function(b){};this._externalInterfaceOK=function(b){if(c.swfLoaded)return!1;c.swfLoaded=!0;ka=!1;$a&&Xa();setTimeout(ma,C?100:1)};aa=function(b,e){function d(a,b){return'\x3cparam name\x3d"'+a+'" value\x3d"'+b+'" /\x3e'}if(M&&N)return!1;if(c.html5Only)return ra(),c.oMC=X(c.movieID),ma(),N=M=!0,!1;var a=e||c.url,f=c.altURL||a,g=va(),k=K(),n=null,n=p.getElementsByTagName("html")[0],m,r,q,n=n&&n.dir&&
n.dir.match(/rtl/i);b=b===h?c.id:b;ra();c.url=Qa(Ha?a:f);e=c.url;c.wmode=!c.wmode&&c.useHighPerformance?"transparent":c.wmode;if(null!==c.wmode&&(t.match(/msie 8/i)||!C&&!c.useHighPerformance)&&navigator.platform.match(/win32|win64/i))Ua.push(sa.spcWmode),c.wmode=null;g={name:b,id:b,src:e,quality:"high",allowScriptAccess:c.allowScriptAccess,bgcolor:c.bgColor,pluginspage:cb+"www.macromedia.com/go/getflashplayer",title:"JS/Flash audio component (SoundManager 2)",type:"application/x-shockwave-flash",
wmode:c.wmode,hasPriority:"true"};c.debugFlash&&(g.FlashVars="debug\x3d1");c.wmode||delete g.wmode;if(C)a=p.createElement("div"),r=['\x3cobject id\x3d"'+b+'" data\x3d"'+e+'" type\x3d"'+g.type+'" title\x3d"'+g.title+'" classid\x3d"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase\x3d"'+cb+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version\x3d6,0,40,0"\x3e',d("movie",e),d("AllowScriptAccess",c.allowScriptAccess),d("quality",g.quality),c.wmode?d("wmode",c.wmode):"",d("bgcolor",
c.bgColor),d("hasPriority","true"),c.debugFlash?d("FlashVars",g.FlashVars):"","\x3c/object\x3e"].join("");else for(m in a=p.createElement("embed"),g)g.hasOwnProperty(m)&&a.setAttribute(m,g[m]);wa();k=K();if(g=va())if(c.oMC=X(c.movieID)||p.createElement("div"),c.oMC.id)q=c.oMC.className,c.oMC.className=(q?q+" ":"movieContainer")+(k?" "+k:""),c.oMC.appendChild(a),C&&(m=c.oMC.appendChild(p.createElement("div")),m.className="sm2-object-box",m.innerHTML=r),N=!0;else{c.oMC.id=c.movieID;c.oMC.className=
"movieContainer "+k;m=k=null;c.useFlashBlock||(c.useHighPerformance?k={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(k={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},n&&(k.left=Math.abs(parseInt(k.left,10))+"px")));gb&&(c.oMC.style.zIndex=1E4);if(!c.debugFlash)for(q in k)k.hasOwnProperty(q)&&(c.oMC.style[q]=k[q]);try{C||c.oMC.appendChild(a),g.appendChild(c.oMC),C&&(m=c.oMC.appendChild(p.createElement("div")),m.className="sm2-object-box",
m.innerHTML=r),N=!0}catch(s){throw Error(R("domError")+" \n"+s.toString());}}return M=!0};$=function(){if(c.html5Only)return aa(),!1;if(k||!c.url)return!1;k=c.getMovie(c.id);k||(Q?(C?c.oMC.innerHTML=ya:c.oMC.appendChild(Q),Q=null,M=!0):aa(c.id,c.url),k=c.getMovie(c.id));"function"===typeof c.oninitmovie&&setTimeout(c.oninitmovie,1);return!0};I=function(){setTimeout(Na,1E3)};qa=function(){g.setTimeout(function(){c.setup({preferFlash:!1}).reboot();c.didFlashBlock=!0;c.beginDelayedInit()},1)};Na=function(){var b,
e=!1;if(!c.url||S)return!1;S=!0;s.remove(g,"load",I);if(v&&ka&&!Ga)return!1;m||(b=c.getMoviePercent(),0<b&&100>b&&(e=!0));setTimeout(function(){b=c.getMoviePercent();if(e)return S=!1,g.setTimeout(I,1),!1;!m&&ab&&(null===b?c.useFlashBlock||0===c.flashLoadTimeout?c.useFlashBlock&&za():!c.useFlashBlock&&U?qa():D({type:"ontimeout",ignoreInit:!0,error:{type:"INIT_FLASHBLOCK"}}):0!==c.flashLoadTimeout&&(!c.useFlashBlock&&U?qa():xa(!0)))},c.flashLoadTimeout)};Z=function(){if(Ga||!ka)return s.remove(g,"focus",
Z),!0;Ga=ab=!0;S=!1;I();s.remove(g,"focus",Z);return!0};O=function(b){if(m)return!1;if(c.html5Only)return m=!0,H(),!0;var e=!0,d;if(!c.useFlashBlock||!c.flashLoadTimeout||c.getMoviePercent())m=!0;d={type:!v&&u?"NO_FLASH":"INIT_TIMEOUT"};if(y||b)c.useFlashBlock&&c.oMC&&(c.oMC.className=K()+" "+(null===c.getMoviePercent()?"swf_timedout":"swf_error")),D({type:"ontimeout",error:d,ignoreInit:!0}),J(d),e=!1;y||(c.waitForWindowLoad&&!na?s.add(g,"load",H):H());return e};Ma=function(){var b,e=c.setupOptions;
for(b in e)e.hasOwnProperty(b)&&(c[b]===h?c[b]=e[b]:c[b]!==e[b]&&(c.setupOptions[b]=c[b]))};ma=function(){if(m)return!1;if(c.html5Only)return m||(s.remove(g,"load",c.beginDelayedInit),c.enabled=!0,O()),!0;$();try{k._externalInterfaceTest(!1),Oa(!0,c.flashPollingInterval||(c.useHighPerformance?10:50)),c.debugMode||k._disableDebug(),c.enabled=!0,c.html5Only||s.add(g,"unload",la)}catch(b){return J({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),xa(!0),O(),!1}O();s.remove(g,"load",c.beginDelayedInit);return!0};
E=function(){if(P)return!1;P=!0;Ma();wa();!v&&c.hasHTML5&&c.setup({useHTML5Audio:!0,preferFlash:!1});Wa();!v&&u&&(Ua.push(sa.needFlash),c.setup({flashLoadTimeout:1}));p.removeEventListener&&p.removeEventListener("DOMContentLoaded",E,!1);$();return!0};Ba=function(){"complete"===p.readyState&&(E(),p.detachEvent("onreadystatechange",Ba));return!0};ua=function(){na=!0;E();s.remove(g,"load",ua)};ta=function(){if(Fa&&(c.setupOptions.useHTML5Audio=!0,c.setupOptions.preferFlash=!1,ia||Za&&!t.match(/android\s2\.3/i)))ia&&
(c.ignoreFlash=!0),A=!0};ta();Da();s.add(g,"focus",Z);s.add(g,"load",I);s.add(g,"load",ua);p.addEventListener?p.addEventListener("DOMContentLoaded",E,!1):p.attachEvent?p.attachEvent("onreadystatechange",Ba):J({type:"NO_DOM2_EVENTS",fatal:!0})}if(!g||!g.document)throw Error("SoundManager requires a browser with window and document objects.");var F=null;if(void 0===g.SM2_DEFER||!SM2_DEFER)F=new G;"object"===typeof module&&module&&"object"===typeof module.exports?(g.soundManager=F,module.exports.SoundManager=
G,module.exports.soundManager=F):"function"===typeof define&&define.amd?define("SoundManager",[],function(){return{SoundManager:G,soundManager:F}}):(g.SoundManager=G,g.soundManager=F)})(window);

/* SOURCE FILE: flash_detect_min.js (23ce8365) 9/9/2014 2:08:53 PM */

//http://www.featureblend.com/license.txt
var FlashDetect=new function(){var self=this;self.installed=false;self.raw="";self.major=-1;self.minor=-1;self.revision=-1;self.revisionStr="";var activeXDetectRules=[{"name":"ShockwaveFlash.ShockwaveFlash.7","version":function(obj){return getActiveXVersion(obj);}},{"name":"ShockwaveFlash.ShockwaveFlash.6","version":function(obj){var version="6,0,21";try{obj.AllowScriptAccess="always";version=getActiveXVersion(obj);}catch(err){}
return version;}},{"name":"ShockwaveFlash.ShockwaveFlash","version":function(obj){return getActiveXVersion(obj);}}];var getActiveXVersion=function(activeXObj){var version=-1;try{version=activeXObj.GetVariable("$version");}catch(err){}
return version;};var getActiveXObject=function(name){var obj=-1;try{obj=new ActiveXObject(name);}catch(err){obj={activeXError:true};}
return obj;};var parseActiveXVersion=function(str){var versionArray=str.split(",");return{"raw":str,"major":parseInt(versionArray[0].split(" ")[1],10),"minor":parseInt(versionArray[1],10),"revision":parseInt(versionArray[2],10),"revisionStr":versionArray[2]};};var parseStandardVersion=function(str){var descParts=str.split(/ +/);var majorMinor=descParts[2].split(/\./);var revisionStr=descParts[3];return{"raw":str,"major":parseInt(majorMinor[0],10),"minor":parseInt(majorMinor[1],10),"revisionStr":revisionStr,"revision":parseRevisionStrToInt(revisionStr)};};var parseRevisionStrToInt=function(str){return parseInt(str.replace(/[a-zA-Z]/g,""),10)||self.revision;};self.majorAtLeast=function(version){return self.major>=version;};self.minorAtLeast=function(version){return self.minor>=version;};self.revisionAtLeast=function(version){return self.revision>=version;};self.versionAtLeast=function(major){var properties=[self.major,self.minor,self.revision];var len=Math.min(properties.length,arguments.length);for(i=0;i<len;i++){if(properties[i]>=arguments[i]){if(i+1<len&&properties[i]==arguments[i]){continue;}else{return true;}}else{return false;}}};self.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var type='application/x-shockwave-flash';var mimeTypes=navigator.mimeTypes;if(mimeTypes&&mimeTypes[type]&&mimeTypes[type].enabledPlugin&&mimeTypes[type].enabledPlugin.description){var version=mimeTypes[type].enabledPlugin.description;var versionObj=parseStandardVersion(version);self.raw=versionObj.raw;self.major=versionObj.major;self.minor=versionObj.minor;self.revisionStr=versionObj.revisionStr;self.revision=versionObj.revision;self.installed=true;}}else if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){var version=-1;for(var i=0;i<activeXDetectRules.length&&version==-1;i++){var obj=getActiveXObject(activeXDetectRules[i].name);if(!obj.activeXError){self.installed=true;version=activeXDetectRules[i].version(obj);if(version!=-1){var versionObj=parseActiveXVersion(version);self.raw=versionObj.raw;self.major=versionObj.major;self.minor=versionObj.minor;self.revision=versionObj.revision;self.revisionStr=versionObj.revisionStr;}}}}}();};FlashDetect.JS_RELEASE="1.0.4";

/* SOURCE FILE: rangy-core.js (e18fc602) 9/9/2014 2:09:01 PM */

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.783
 * Build date: 29 June 2013
 */
(function(a){function j(a,b){var e=typeof a[b];return e==d||e==c&&!!a[b]||e=="unknown"}function k(a,b){return typeof a[b]==c&&!!a[b]}function l(a,b){return typeof a[b]!=e}function m(a){return function(b,c){var d=c.length;while(d--)if(!a(b,c[d]))return!1;return!0}}function q(a){return a&&n(a,i)&&p(a,h)}function r(a){return k(a,"body")?a.body:a.getElementsByTagName("body")[0]}function u(a){k(window,"console")&&j(window.console,"log")&&window.console.log(a)}function v(a,b){b?window.alert(a):u(a)}function w(a){t.initialized=!0,t.supported=!1,v("Rangy is not supported on this page in your browser. Reason: "+a,t.config.alertOnFail)}function x(a){v("Rangy warning: "+a,t.config.alertOnWarn)}function A(a){return a.message||a.description||String(a)}function B(){if(t.initialized)return;var a,b=!1,c=!1;j(document,"createRange")&&(a=document.createRange(),n(a,g)&&p(a,f)&&(b=!0),a.detach());var d=r(document);if(!d||d.nodeName.toLowerCase()!="body"){w("No body element found");return}d&&j(d,"createTextRange")&&(a=d.createTextRange(),q(a)&&(c=!0));if(!b&&!c){w("Neither Range nor TextRange are available");return}t.initialized=!0,t.features={implementsDomRange:b,implementsTextRange:c};var e,h;for(var i in s)(e=s[i])instanceof E&&e.init(e,t);for(var k=0,l=z.length;k<l;++k)try{z[k](t)}catch(m){h="Rangy init listener threw an exception. Continuing. Detail: "+A(m),u(h)}}function D(a){a=a||window,B();for(var b=0,c=C.length;b<c;++b)C[b](a)}function E(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function F(a,b,c,d){var e=new E(b,c,function(a){if(!a.initialized){a.initialized=!0;try{d(t,a),a.supported=!0}catch(c){var e="Module '"+b+"' failed to load: "+A(c);u(e)}}});s[b]=e}function G(){}function H(){}var b=typeof a.define=="function"&&a.define.amd,c="object",d="function",e="undefined",f=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],g=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],h=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],i=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],n=m(j),o=m(k),p=m(l),s={},t={version:"1.3alpha.783",initialized:!1,supported:!0,util:{isHostMethod:j,isHostObject:k,isHostProperty:l,areHostMethods:n,areHostObjects:o,areHostProperties:p,isTextRange:q,getBody:r},features:{},modules:s,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};t.fail=w,t.warn=x,{}.hasOwnProperty?t.util.extend=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&d!==null&&typeof d=="object"&&e!==null&&typeof e=="object"&&t.util.extend(d,e,!0),a[f]=e);return a}:w("hasOwnProperty not supported"),function(){var a=document.createElement("div");a.appendChild(document.createElement("span"));var b=[].slice,c;try{b.call(a.childNodes,0)[0].nodeType==1&&(c=function(a){return b.call(a,0)})}catch(d){}c||(c=function(a){var b=[];for(var c=0,d=a.length;c<d;++c)b[c]=a[c];return b}),t.util.toArray=c}();var y;j(document,"addEventListener")?y=function(a,b,c){a.addEventListener(b,c,!1)}:j(document,"attachEvent")?y=function(a,b,c){a.attachEvent("on"+b,c)}:w("Document does not have required addEventListener or attachEvent method"),t.util.addListener=y;var z=[];t.init=B,t.addInitListener=function(a){t.initialized?a(t):z.push(a)};var C=[];t.addCreateMissingNativeApiListener=function(a){C.push(a)},t.createMissingNativeApi=D,E.prototype={init:function(a){var b=this.dependencies||[];for(var c=0,d=b.length,e,f;c<d;++c){f=b[c],e=s[f];if(!e||!(e instanceof E))throw new Error("required module '"+f+"' not found");e.init();if(!e.supported)throw new Error("required module '"+f+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},warn:function(a){t.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){t.warn("DEPRECATED: "+a+" in module "+this.name+"is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},t.createModule=function(a){var b,c;arguments.length==2?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]),F(!1,a,c,b)},t.createCoreModule=function(a,b,c){F(!0,a,b,c)},t.RangePrototype=G,t.rangePrototype=new G,t.selectionPrototype=new H;var I=!1,J=function(a){I||(I=!0,t.initialized||B())};if(typeof window==e){w("No window found");return}if(typeof document==e){w("No document found");return}j(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",J,!1),y(window,"load",J),b&&a.define(function(){return t.amd=!0,t}),a.rangy=t})(this),rangy.createCoreModule("DomUtil",[],function(a,b){function h(a){var b;return typeof a.namespaceURI==c||(b=a.namespaceURI)===null||b=="http://www.w3.org/1999/xhtml"}function i(a){var b=a.parentNode;return b.nodeType==1?b:null}function j(a){var b=0;while(a=a.previousSibling)++b;return b}function k(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function l(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(g(c,d))return d;return null}function m(a,b,c){var d=c?b:b.parentNode;while(d){if(d===a)return!0;d=d.parentNode}return!1}function n(a,b){return m(a,b,!0)}function o(a,b,c){var d,e=c?a:a.parentNode;while(e){d=e.parentNode;if(d===b)return e;e=d}return null}function p(a){var b=a.nodeType;return b==3||b==4||b==8}function q(a){if(!a)return!1;var b=a.nodeType;return b==3||b==8}function r(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function s(a,b,c){var d=a.cloneNode(!1);d.deleteData(0,b),a.deleteData(b,a.length-b),r(d,a);if(c)for(var e=0,f;f=c[e++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>j(a)&&++f.offset;return d}function t(a){if(a.nodeType==9)return a;if(typeof a.ownerDocument!=c)return a.ownerDocument;if(typeof a.document!=c)return a.document;if(a.parentNode)return t(a.parentNode);throw b.createError("getDocument: no document found for node")}function u(a){var d=t(a);if(typeof d.defaultView!=c)return d.defaultView;if(typeof d.parentWindow!=c)return d.parentWindow;throw b.createError("Cannot get a window object for node")}function v(a){if(typeof a.contentDocument!=c)return a.contentDocument;if(typeof a.contentWindow!=c)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function w(a){if(typeof a.contentWindow!=c)return a.contentWindow;if(typeof a.contentDocument!=c)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function x(a){return a&&d.isHostMethod(a,"setTimeout")&&d.isHostObject(a,"document")}function y(a,b,c){var e;a?d.isHostProperty(a,"nodeType")?e=a.nodeType==1&&a.tagName.toLowerCase()=="iframe"?v(a):t(a):x(a)&&(e=a.document):e=document;if(!e)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return e}function z(a){var b;while(b=a.parentNode)a=b;return a}function A(a,c,d,e){var f,g,h,i,k;if(a==d)return c===e?0:c<e?-1:1;if(f=o(d,a,!0))return c<=j(f)?-1:1;if(f=o(a,d,!0))return j(f)<e?-1:1;g=l(a,d);if(!g)throw new Error("comparePoints error: nodes have no common ancestor");h=a===g?g:o(a,g,!0),i=d===g?g:o(d,g,!0);if(h===i)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");k=g.firstChild;while(k){if(k===h)return-1;if(k===i)return 1;k=k.nextSibling}}function C(a){try{return a.parentNode,!1}catch(b){return!0}}function D(a){if(!a)return"[No node]";if(B&&C(a))return"[Broken node]";if(p(a))return'"'+a.data+'"';if(a.nodeType==1){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+a.childNodes.length+"]["+a.innerHTML.slice(0,20)+"]"}return a.nodeName}function E(a){var b=t(a).createDocumentFragment(),c;while(c=a.firstChild)b.appendChild(c);return b}function G(a){this.root=a,this._next=a}function H(a){return new G(a)}function I(a,b){this.node=a,this.offset=b}function J(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var c="undefined",d=a.util;d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),d.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var e=document.createElement("div");d.areHostMethods(e,["insertBefore","appendChild","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),d.isHostProperty(e,"innerHTML")||b.fail("Element is missing innerHTML property");var f=document.createTextNode("test");d.areHostMethods(f,["splitText","deleteData","insertData","appendData","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"])||!d.areHostProperties(f,["data"]))||b.fail("Incomplete Text Node implementation");var g=function(a,b){var c=a.length;while(c--)if(a[c]===b)return!0;return!1},B=!1;(function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br>",B=C(c),a.features.crashyTextNodes=B})();var F;typeof window.getComputedStyle!=c?F=function(a,b){return u(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=c?F=function(a,b){return a.currentStyle[b]}:b.fail("No means of obtaining computed style properties found"),G.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b,c;if(this._current){b=a.firstChild;if(b)this._next=b;else{c=null;while(a!==this.root&&!(c=a.nextSibling))a=a.parentNode;this._next=c}}return this._current},detach:function(){this._current=this._next=this.root=null}},I.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+D(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},J.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},J.prototype.toString=function(){return this.message},a.dom={arrayContains:g,isHtmlNamespace:h,parentElement:i,getNodeIndex:j,getNodeLength:k,getCommonAncestor:l,isAncestorOf:m,isOrIsAncestorOf:n,getClosestAncestorIn:o,isCharacterDataNode:p,isTextOrCommentNode:q,insertAfter:r,splitDataNode:s,getDocument:t,getWindow:u,getIframeWindow:w,getIframeDocument:v,getBody:d.getBody,isWindow:x,getContentDocument:y,getRootContainer:z,comparePoints:A,isBrokenNode:C,inspectNode:D,getComputedStyleProperty:F,fragmentFromNodeChildren:E,createIterator:H,DomPosition:I},a.DOMException=J}),rangy.createCoreModule("DomRange",["DomUtil"],function(a,b){function r(a,b){return a.nodeType!=3&&(i(a,b.startContainer)||i(a,b.endContainer))}function s(a){return a.document||j(a.startContainer)}function t(a){return new e(a.parentNode,h(a))}function u(a){return new e(a.parentNode,h(a)+1)}function v(a,b,d){var e=a.nodeType==11?a.firstChild:a;return g(b)?d==b.length?c.insertAfter(a,b):b.parentNode.insertBefore(a,d==0?b:l(b,d)):d>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[d]),e}function w(a,b,c){Y(a),Y(b);if(s(b)!=s(a))throw new f("WRONG_DOCUMENT_ERR");var d=k(a.startContainer,a.startOffset,b.endContainer,b.endOffset),e=k(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return c?d<=0&&e>=0:d<0&&e>0}function x(a){var b;for(var c,d=s(a.range).createDocumentFragment(),e;c=a.next();){b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(e=a.getSubtreeIterator(),c.appendChild(x(e)),e.detach(!0));if(c.nodeType==10)throw new f("HIERARCHY_REQUEST_ERR");d.appendChild(c)}return d}function y(a,b,d){var e,f;d=d||{stop:!1};for(var g,h;g=a.next();)if(a.isPartiallySelectedSubtree()){if(b(g)===!1){d.stop=!0;return}h=a.getSubtreeIterator(),y(h,b,d),h.detach(!0);if(d.stop)return}else{e=c.createIterator(g);while(f=e.next())if(b(f)===!1){d.stop=!0;return}}}function z(a){var b;while(a.next())a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),z(b),b.detach(!0)):a.remove()}function A(a){for(var b,c=s(a.range).createDocumentFragment(),d;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(A(d)),d.detach(!0)):a.remove();if(b.nodeType==10)throw new f("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function B(a,b,c){var d=!!b&&!!b.length,e,f=!!c;d&&(e=new RegExp("^("+b.join("|")+")$"));var g=[];return y(new D(a,!1),function(a){(!d||e.test(a.nodeType))&&(!f||c(a))&&g.push(a)}),g}function C(a){var b=typeof a.getName=="undefined"?"Range":a.getName();return"["+b+"("+c.inspectNode(a.startContainer)+":"+a.startOffset+", "+c.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function D(a,b){this.range=a,this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&g(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===c&&!g(this.sc)?this.sc.childNodes[this.so]:m(this.sc,c,!0),this._last=this.ec===c&&!g(this.ec)?this.ec.childNodes[this.eo-1]:m(this.ec,c,!0))}}function E(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function K(a){return function(b,c){var d,e=c?b:b.parentNode;while(e){d=e.nodeType;if(o(a,d))return e;e=e.parentNode}return null}}function O(a,b){if(N(a,b))throw new E("INVALID_NODE_TYPE_ERR")}function P(a){if(!a.startContainer)throw new f("INVALID_STATE_ERR")}function Q(a,b){if(!o(b,a.nodeType))throw new E("INVALID_NODE_TYPE_ERR")}function R(a,b){if(b<0||b>(g(a)?a.length:a.childNodes.length))throw new f("INDEX_SIZE_ERR")}function S(a,b){if(L(a,!0)!==L(b,!0))throw new f("WRONG_DOCUMENT_ERR")}function T(a){if(M(a,!0))throw new f("NO_MODIFICATION_ALLOWED_ERR")}function U(a,b){if(!a)throw new f(b)}function V(a){return q&&c.isBrokenNode(a)||!o(G,a.nodeType)&&!L(a,!0)}function W(a,b){return b<=(g(a)?a.length:a.childNodes.length)}function X(a){return!!a.startContainer&&!!a.endContainer&&!V(a.startContainer)&&!V(a.endContainer)&&W(a.startContainer,a.startOffset)&&W(a.endContainer,a.endOffset)}function Y(a){P(a);if(!X(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function bb(a,b){Y(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,i=c===e;g(e)&&f>0&&f<e.length&&l(e,f,b),g(c)&&d>0&&d<c.length&&(c=l(c,d,b),i?(f-=d,e=c):e==c.parentNode&&f>=h(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function lb(a){a.START_TO_START=db,a.START_TO_END=eb,a.END_TO_END=fb,a.END_TO_START=gb,a.NODE_BEFORE=hb,a.NODE_AFTER=ib,a.NODE_BEFORE_AND_AFTER=jb,a.NODE_INSIDE=kb}function mb(a){lb(a),lb(a.prototype)}function nb(a,b){return function(){Y(this);var c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,f=new D(this,!0),g,h;c!==e&&(g=m(c,e,!0),h=u(g),c=h.node,d=h.offset),y(f,T),f.reset();var i=a(f);return f.detach(),b(this,c,d,c,d),i}}function ob(b,c,e){function f(a,b){return function(c){P(this),Q(c,F),Q(p(c),G);var d=(a?t:u)(c);(b?i:j)(this,d.node,d.offset)}}function i(a,b,d){var e=a.endContainer,f=a.endOffset;if(b!==a.startContainer||d!==a.startOffset){if(p(b)!=p(e)||k(b,d,e,f)==1)e=b,f=d;c(a,b,d,e,f)}}function j(a,b,d){var e=a.startContainer,f=a.startOffset;if(b!==a.endContainer||d!==a.endOffset){if(p(b)!=p(e)||k(b,d,e,f)==-1)e=b,f=d;c(a,e,f,b,d)}}var l=function(){};l.prototype=a.rangePrototype,b.prototype=new l,d.extend(b.prototype,{setStart:function(a,b){P(this),O(a,!0),R(a,b),i(this,a,b)},setEnd:function(a,b){P(this),O(a,!0),R(a,b),j(this,a,b)},setStartAndEnd:function(){P(this);var a=arguments,b=a[0],d=a[1],e=b,f=d;switch(a.length){case 3:f=a[2];break;case 4:e=a[2],f=a[3]}c(this,b,d,e,f)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:f(!0,!0),setStartAfter:f(!1,!0),setEndBefore:f(!0,!1),setEndAfter:f(!1,!1),collapse:function(a){Y(this),a?c(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):c(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){P(this),O(a,!0),c(this,a,0,a,n(a))},selectNode:function(a){P(this),O(a,!1),Q(a,F);var b=t(a),d=u(a);c(this,b.node,b.offset,d.node,d.offset)},extractContents:nb(A,c),deleteContents:nb(z,c),canSurroundContents:function(){Y(this),T(this.startContainer),T(this.endContainer);var a=new D(this,!0),b=a._first&&r(a._first,this)||a._last&&r(a._last,this);return a.detach(),!b},detach:function(){e(this)},splitBoundaries:function(){bb(this)},splitBoundariesPreservingPositions:function(a){bb(this,a)},normalizeBoundaries:function(){Y(this);var a=this.startContainer,b=this.startOffset,d=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(d=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},i=function(c){var f=c.previousSibling;if(f&&f.nodeType==c.nodeType){a=c;var g=c.length;b=f.length,c.insertData(0,f.data),f.parentNode.removeChild(f);if(a==d)e+=b,d=a;else if(d==c.parentNode){var i=h(c);e==i?(d=c,e=g):e>i&&e--}}},j=!0;if(g(d))d.length==e&&f(d);else{if(e>0){var k=d.childNodes[e-1];k&&g(k)&&f(k)}j=!this.collapsed}if(j){if(g(a))b==0&&i(a);else if(b<a.childNodes.length){var l=a.childNodes[b];l&&g(l)&&i(l)}}else a=d,b=e;c(this,a,b,d,e)},collapseToPoint:function(a,b){P(this),O(a,!0),R(a,b),this.setStartAndEnd(a,b)}}),mb(b)}function pb(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:c.getCommonAncestor(a.startContainer,a.endContainer)}function qb(a,b,d,e,f){a.startContainer=b,a.startOffset=d,a.endContainer=e,a.endOffset=f,a.document=c.getDocument(b),pb(a)}function rb(a){P(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=a.document=null,a.collapsed=a.commonAncestorContainer=null}function sb(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,pb(this)}var c=a.dom,d=a.util,e=c.DomPosition,f=a.DOMException,g=c.isCharacterDataNode,h=c.getNodeIndex,i=c.isOrIsAncestorOf,j=c.getDocument,k=c.comparePoints,l=c.splitDataNode,m=c.getClosestAncestorIn,n=c.getNodeLength,o=c.arrayContains,p=c.getRootContainer,q=a.features.crashyTextNodes;D.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,g(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a=this._current,b,c;!g(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b))},isPartiallySelectedSubtree:function(){var a=this._current;return r(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new sb(s(this.range));var b=this._current,c=b,d=0,e=b,f=n(b);i(b,this.sc)&&(c=this.sc,d=this.so),i(b,this.ec)&&(e=this.ec,f=this.eo),qb(a,c,d,e,f)}return new D(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},E.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},E.prototype.toString=function(){return this.message};var F=[1,3,4,5,7,8,10],G=[2,9,11],H=[5,6,10,12],I=[1,3,4,5,7,8,10,11],J=[1,3,4,5,7,8],L=K([9,11]),M=K(H),N=K([6,10,12]),Z=document.createElement("style"),$=!1;try{Z.innerHTML="<b>x</b>",$=Z.firstChild.nodeType==3}catch(_){}a.features.htmlParsingConforms=$;var ab=$?function(a){var b=this.startContainer,d=j(b);if(!b)throw new f("INVALID_STATE_ERR");var e=null;return b.nodeType==1?e=b:g(b)&&(e=c.parentElement(b)),e===null||e.nodeName=="HTML"&&c.isHtmlNamespace(j(e).documentElement)&&c.isHtmlNamespace(e)?e=d.createElement("body"):e=e.cloneNode(!1),e.innerHTML=a,c.fragmentFromNodeChildren(e)}:function(a){P(this);var b=s(this),d=b.createElement("body");return d.innerHTML=a,c.fragmentFromNodeChildren(d)},cb=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],db=0,eb=1,fb=2,gb=3,hb=0,ib=1,jb=2,kb=3;d.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){Y(this),S(this.startContainer,b.startContainer);var c,d,e,f,g=a==gb||a==db?"start":"end",h=a==eb||a==db?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],k(c,d,e,f)},insertNode:function(a){Y(this),Q(a,I),T(this.startContainer);if(i(a,this.startContainer))throw new f("HIERARCHY_REQUEST_ERR");var b=v(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){Y(this);var a,b;if(this.collapsed)return s(this).createDocumentFragment();if(this.startContainer===this.endContainer&&g(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=s(this).createDocumentFragment(),b.appendChild(a),b;var c=new D(this,!0);return a=x(c),c.detach(),a},canSurroundContents:function(){Y(this),T(this.startContainer),T(this.endContainer);var a=new D(this,!0),b=a._first&&r(a._first,this)||a._last&&r(a._last,this);return a.detach(),!b},surroundContents:function(a){Q(a,J);if(!this.canSurroundContents())throw new E("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())while(a.lastChild)a.removeChild(a.lastChild);v(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){Y(this);var a=new sb(s(this)),b=cb.length,c;while(b--)c=cb[b],a[c]=this[c];return a},toString:function(){Y(this);var a=this.startContainer;if(a===this.endContainer&&g(a))return a.nodeType==3||a.nodeType==4?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new D(this,!0);return y(c,function(a){(a.nodeType==3||a.nodeType==4)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){Y(this);var b=a.parentNode,c=h(a);if(!b)throw new f("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return d<0?e>0?jb:hb:e>0?ib:kb},comparePoint:function(a,b){return Y(this),U(a,"HIERARCHY_REQUEST_ERR"),S(a,this.startContainer),k(a,b,this.startContainer,this.startOffset)<0?-1:k(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ab,toHtml:function(){Y(this);var a=this.commonAncestorContainer.parentNode.cloneNode(!1);return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){Y(this),U(a,"NOT_FOUND_ERR");if(j(a)!==s(this))return!1;var c=a.parentNode,d=h(a);U(c,"NOT_FOUND_ERR");var e=k(c,d,this.endContainer,this.endOffset),f=k(c,d+1,this.startContainer,this.startOffset);return b?e<=0&&f>=0:e<0&&f>0},isPointInRange:function(a,b){return Y(this),U(a,"HIERARCHY_REQUEST_ERR"),S(a,this.startContainer),k(a,b,this.startContainer,this.startOffset)>=0&&k(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return w(this,a,!1)},intersectsOrTouchesRange:function(a){return w(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=k(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=k(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return b==-1&&d.setStart(a.startContainer,a.startOffset),c==1&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return k(a.startContainer,a.startOffset,this.startContainer,this.startOffset)==-1&&b.setStart(a.startContainer,a.startOffset),k(a.endContainer,a.endOffset,this.endContainer,this.endOffset)==1&&b.setEnd(a.endContainer,a.endOffset),b}throw new E("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==kb},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,n(a))<=0},containsRange:function(a){var b=this.intersection(a);return b!==null&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},getNodes:function(a,b){return Y(this),B(this,a,b)},getDocument:function(){return s(this)},collapseBefore:function(a){P(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){P(this),this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var d=s(this),e=a.createRange(d);b=b||c.getBody(d),e.selectNodeContents(b);var f=this.intersection(e),g=0,h=0;return f&&(e.setEnd(f.startContainer,f.startOffset),g=e.toString().length,h=g+f.toString().length,e.detach()),{start:g,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);var d=[b],e,f=!1,g=!1,h,i,j;while(!g&&(e=d.pop()))if(e.nodeType==3)h=c+e.length,!f&&a.start>=c&&a.start<=h&&(this.setStart(e,a.start-c),f=!0),f&&a.end>=c&&a.end<=h&&(this.setEnd(e,a.end-c),g=!0),c=h;else{j=e.childNodes,i=j.length;while(i--)d.push(j[i])}},getName:function(){return"DomRange"},equals:function(a){return sb.rangesEqual(this,a)},isValid:function(){return X(this)},inspect:function(){return C(this)}}),ob(sb,qb,rb),d.extend(sb,{rangeProperties:cb,RangeIterator:D,copyComparisonConstants:mb,createPrototypeRange:ob,inspect:C,getRangeDocument:s,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=sb,a.RangeException=E}),rangy.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;a.features.implementsDomRange&&function(){function k(a){var b=g.length,c;while(b--)c=g[b],a[c]=a.nativeRange[c];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function l(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);if(f||g||h)a.setEnd(d,e),a.setStart(b,c)}function m(a){a.nativeRange.detach(),a.detached=!0;var b=g.length;while(b--)a[g[b]]=null}var d,g=h.rangeProperties,n;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,k(this)},h.createPrototypeRange(c,l,m),d=c.prototype,d.selectNode=function(a){this.nativeRange.selectNode(a),k(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(a){this.nativeRange.surroundContents(a),k(this)},d.collapse=function(a){this.nativeRange.collapse(a),k(this)},d.cloneRange=function(){return new c(this.nativeRange.cloneRange())},d.refresh=function(){k(this)},d.toString=function(){return this.nativeRange.toString()};var o=document.createTextNode("test");i(document).appendChild(o);var p=document.createRange();p.setStart(o,0),p.setEnd(o,0);try{p.setStart(o,1),d.setStart=function(a,b){this.nativeRange.setStart(a,b),k(this)},d.setEnd=function(a,b){this.nativeRange.setEnd(a,b),k(this)},n=function(a){return function(b){this.nativeRange[a](b),k(this)}}}catch(q){d.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}k(this)},d.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}k(this)},n=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}k(this)}}}d.setStartBefore=n("setStartBefore","setEndBefore"),d.setStartAfter=n("setStartAfter","setEndAfter"),d.setEndBefore=n("setEndBefore","setStartBefore"),d.setEndAfter=n("setEndAfter","setStartAfter"),d.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},p.selectNodeContents(o),p.setEnd(o,3);var r=document.createRange();r.selectNodeContents(o),r.setEnd(o,4),r.setStart(o,2),p.compareBoundaryPoints(p.START_TO_END,r)==-1&&p.compareBoundaryPoints(p.END_TO_START,r)==1?d.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:d.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var s=document.createElement("div");s.innerHTML="123";var t=s.firstChild,u=i(document);u.appendChild(s),p.setStart(t,1),p.setEnd(t,2),p.deleteContents(),t.data=="13"&&(d.deleteContents=function(){this.nativeRange.deleteContents(),k(this)},d.extractContents=function(){var a=this.nativeRange.extractContents();return k(this),a}),u.removeChild(s),u=null,f.isHostMethod(p,"createContextualFragment")&&(d.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(o),p.detach(),r.detach(),d.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}();if(a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return a.compareEndPoints("StartToEnd",a)==0},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();e.isOrIsAncestorOf(b,i)||(i=b);if(!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&l.parentNode.removeChild(l);var m,n=c?"StartToStart":"StartToEnd",o,p,q,r,s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;for(;;){v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(n,a);if(m==0||s==u)break;if(m==-1){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}r=l.nextSibling;if(m==-1&&r&&k(r)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(r.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;w=x.moveStart("character",y);while((m=x.compareEndPoints("StartToEnd",x))==-1)w++,x.moveStart("character",1)}else w=h.text.length;q=new g(r,w)}else o=(d||!c)&&l.previousSibling,p=(d||c)&&l.nextSibling,p&&k(p)?q=new g(p,0):o&&k(o)?q=new g(o,o.data.length):q=new g(i,e.getNodeIndex(l));return l.parentNode.removeChild(l),{boundaryPosition:q,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,f=a.offset,g=e.getDocument(a.node),h,j,l=i(g).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(j=a.node.childNodes,c=f<j.length?j[f]:null,d=a.node),h=g.createElement("span"),h.innerHTML="&#feff;",c?d.insertBefore(h,c):d.appendChild(h),l.moveToElementText(h),l.collapse(!b),d.removeChild(h),m&&l[b?"moveStart":"moveEnd"]("character",f),l};d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d),d.rangeToTextRange=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d},a.WrappedTextRange=d;if(!a.features.implementsDomRange||a.config.preferTextRange){var p=function(){return this}();typeof p.Range=="undefined"&&(p.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},a.createIframeRange=function(c){return b.deprecationNotice("createIframeRange()","createRange(iframeEl)"),a.createRange(c)},a.createIframeRangyRange=function(c){return b.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),a.createRangyRange(c)},a.addCreateMissingNativeApiListener(function(b){var c=b.document;typeof c.createRange=="undefined"&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function r(a){return typeof a=="string"?a=="backward":!!a}function s(a,c){if(!a)return window;if(d.isWindow(a))return a;if(a instanceof T)return a.win;var e=d.getContentDocument(a,b,c);return d.getWindow(e)}function t(a){return s(a,"getWinSelection").getSelection()}function u(a){return s(a,"getDocSelection").document.selection}function I(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function J(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function K(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function L(b){var c;return b instanceof g?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof h?c=b.nativeRange:m.implementsDomRange&&b instanceof d.getWindow(b.startContainer).Range&&(c=b),c}function M(a){if(!a.length||a[0].nodeType!=1)return!1;for(var b=1,c=a.length;b<c;++b)if(!d.isAncestorOf(a[0],a[b]))return!1;return!0}function N(a){var c=a.getNodes();if(!M(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function O(a){return!!a&&typeof a.text!="undefined"}function P(a,b){var c=new h(b);a._ranges=[c],I(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function Q(b){b._ranges.length=0;if(b.docSelection.type=="None")K(b);else{var c=b.docSelection.createRange();if(O(c))P(b,c);else{b.rangeCount=c.length;var d,e=o(c.item(0));for(var f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=b.rangeCount==1&&b._ranges[0].collapsed,I(b,b._ranges[b.rangeCount-1],!1)}}}function R(a,c){var d=a.docSelection.createRange(),e=N(c),f=o(d.item(0)),g=p(f).createControlRange();for(var h=0,i=d.length;h<i;++h)g.add(d.item(h));try{g.add(e)}catch(j){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),Q(a)}function T(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function U(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function W(a,b){var c=V.length,d,e;while(c--){d=V[c],e=d.selection;if(b=="deleteAll")U(e);else if(d.win==a)return b=="delete"?(V.splice(c,1),!0):e}return b=="deleteAll"&&(V.length=0),null}function Z(a,c){var d=o(c[0].startContainer),e=p(d).createControlRange();for(var f=0,g,h=c.length;f<h;++f){g=N(c[f]);try{e.add(g)}catch(i){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}e.select(),Q(a)}function cb(a,b){if(a.win.document!=o(b))throw new i("WRONG_DOCUMENT_ERR")}function db(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function eb(a){var b=[],c=new j(a.anchorNode,a.anchorOffset),d=new j(a.focusNode,a.focusOffset),e=typeof a.getName=="function"?a.getName():"Selection";if(typeof a.rangeCount!="undefined")for(var f=0,h=a.rangeCount;f<h;++f)b[f]=g.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var c="boolean",d=a.dom,e=a.util,f=e.isHostMethod,g=a.DomRange,h=a.WrappedRange,i=a.DOMException,j=d.DomPosition,k,l,m=a.features,n="Control",o=d.getDocument,p=d.getBody,q=g.rangesEqual,v=f(window,"getSelection"),w=e.isHostObject(document,"selection");m.implementsWinGetSelection=v,m.implementsDocSelection=w;var x=w&&(!v||a.config.preferTextRange);x?(k=u,a.isSelectionValid=function(a){var b=s(a,"isSelectionValid").document,c=b.selection;return c.type!="None"||o(c.createRange().parentElement())==b}):v?(k=t,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=k;var y=k(),z=a.createNativeRange(document),A=p(document),B=e.areHostProperties(y,["anchorNode","focusNode","anchorOffset","focusOffset"]);m.selectionHasAnchorAndFocus=B;var C=f(y,"extend");m.selectionHasExtend=C;var D=typeof y.rangeCount=="number";m.selectionHasRangeCount=D;var E=!1,F=!0;e.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&typeof y.rangeCount=="number"&&m.implementsDomRange&&function(){var a=window.getSelection();if(a){var b=p(document),c=b.appendChild(document.createElement("div"));c.contentEditable="false";var d=c.appendChild(document.createTextNode("\u00a0\u00a0\u00a0")),e=document.createRange();e.setStart(d,1),e.collapse(!0),a.addRange(e),F=a.rangeCount==1,a.removeAllRanges();var f=e.cloneRange();e.setStart(d,0),f.setEnd(d,3),f.setStart(d,2),a.addRange(e),a.addRange(f),E=a.rangeCount==2,b.removeChild(c),a.removeAllRanges(),e.detach(),f.detach()}}(),m.selectionSupportsMultipleRanges=E,m.collapsedNonEditableSelectionsSupported=F;var G=!1,H;A&&f(A,"createControlRange")&&(H=A.createControlRange(),e.areHostProperties(H,["item","add"])&&(G=!0)),m.implementsControlRange=G,B?l=function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:l=function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var S;f(y,"getRangeAt")?S=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:B&&(S=function(b){var c=o(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),T.prototype=a.selectionPrototype;var V=[],X=function(a){if(a&&a instanceof T)return a.refresh(),a;a=s(a,"getNativeSelection");var b=W(a),c=k(a),d=w?u(a):null;return b?(b.nativeSelection=c,b.docSelection=d,b.refresh()):(b=new T(c,d,a),V.push({win:a,selection:b})),b};a.getSelection=X,a.getIframeSelection=function(c){return b.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),a.getSelection(d.getIframeWindow(c))};var Y=T.prototype;if(!x&&B&&e.areHostMethods(y,["removeAllRanges","addRange"])){Y.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),K(this)};var $=function(b,c){var d=g.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(L(e)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};D?Y.addRange=function(b,c){if(G&&w&&this.docSelection.type==n)R(this,b);else if(r(c)&&C)$(this,b);else{var d;E?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(L(b).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==d+1){if(a.config.checkSelectionRanges){var e=S(this.nativeSelection,this.rangeCount-1);e&&!q(e,b)&&(b=new h(e))}this._ranges[this.rangeCount-1]=b,I(this,b,bb(this.nativeSelection)),this.isCollapsed=l(this)}else this.refresh()}}:Y.addRange=function(a,b){r(b)&&C?$(this,a):(this.nativeSelection.addRange(L(a)),this.refresh())},Y.setRanges=function(a){if(G&&a.length>1)Z(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else{if(!(f(y,"empty")&&f(z,"select")&&G&&x))return b.fail("No means of selecting a Range or TextRange was found"),!1;Y.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=o(this.anchorNode);else if(this.docSelection.type==n){var b=this.docSelection.createRange();b.length&&(a=o(b.item(0)))}if(a){var c=p(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}K(this)},Y.addRange=function(b){this.docSelection.type==n?R(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,I(this,b,!1))},Y.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?Z(this,a):b&&this.addRange(a[0])}}Y.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new i("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var _;if(x)_=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=p(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==n?Q(b):O(c)?P(b,c):K(b)};else if(f(y,"getRangeAt")&&typeof y.rangeCount=="number")_=function(b){if(G&&w&&b.docSelection.type==n)Q(b);else{b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount;if(b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));I(b,b._ranges[b.rangeCount-1],bb(b.nativeSelection)),b.isCollapsed=l(b)}else K(b)}};else{if(!B||typeof y.isCollapsed!=c||typeof z.collapsed!=c||!m.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;_=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=S(c,0),a._ranges=[b],a.rangeCount=1,J(a),a.isCollapsed=l(a)):K(a)}}Y.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;_(this);if(a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;while(e--)if(!q(b[e],this._ranges[e]))return!0;return!1}};var ab=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;d<e;++d)q(b,c[d])||a.addRange(c[d]);a.rangeCount||K(a)};G?Y.removeRange=function(a){if(this.docSelection.type==n){var b=this.docSelection.createRange(),c=N(a),d=o(b.item(0)),e=p(d).createControlRange(),f,g=!1;for(var h=0,i=b.length;h<i;++h)f=b.item(h),f!==c||g?e.add(b.item(h)):g=!0;e.select(),Q(this)}else ab(this,a)}:Y.removeRange=function(a){ab(this,a)};var bb;!x&&B&&m.implementsDomRange?(bb=function(a){var b=!1;return a.anchorNode&&(b=d.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1),b},Y.isBackward=function(){return bb(this)}):bb=Y.isBackward=function(){return!1},Y.isBackwards=Y.isBackward,Y.toString=function(){var a=[];for(var b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")},Y.collapse=function(b,c){cb(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},Y.collapseToStart=function(){if(!this.rangeCount)throw new i("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},Y.collapseToEnd=function(){if(!this.rangeCount)throw new i("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},Y.selectAllChildren=function(b){cb(this,b);var c=a.createRange(b);c.selectNodeContents(b),console.log("before",c.inspect()),this.setSingleRange(c),console.log("after",this._ranges[0].inspect())},Y.deleteFromDocument=function(){if(G&&w&&this.docSelection.type==n){var a=this.docSelection.createRange(),b;while(a.length)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;d<e;++d)c[d].deleteContents();this.addRange(c[e-1])}}},Y.eachRange=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(a(this.getRangeAt(c)))return b},Y.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},Y.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},Y.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b))}),c},Y.setStart=db(!0),Y.setEnd=db(!1),a.rangePrototype.select=function(a){X(this.getDocument()).setSingleRange(this,a)},Y.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&b.length==1?this.addRange(b[0],"backward"):this.setRanges(b)},Y.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)},Y.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},Y.moveToBookmark=function(b){var c=[];for(var d=0,e,f;e=b.rangeBookmarks[d++];)f=a.createRange(this.win),f.moveToBookmark(e),c.push(f);b.backward?this.setSingleRange(c[0],"backward"):this.setRanges(c)},Y.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},Y.getName=function(){return"WrappedSelection"},Y.inspect=function(){return eb(this)},Y.detach=function(){W(this.win,"delete"),U(this)},T.detachAll=function(){W(null,"deleteAll")},T.inspect=eb,T.isDirectionBackward=r,a.Selection=T,a.selectionPrototype=Y,a.addCreateMissingNativeApiListener(function(a){typeof a.getSelection=="undefined"&&(a.getSelection=function(){return X(a)}),a=null})})

/* SOURCE FILE: rangy-cssclassapplier.js (5004102a) 9/9/2014 2:09:01 PM */

/**
 * Class Applier module for Rangy.
 * Adds, removes and toggles classes on Ranges and Selections
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.783
 * Build date: 29 June 2013
 */
rangy.createModule("ClassApplier",["WrappedSelection"],function(a,b){function g(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function h(a,b){return a.className&&(new RegExp("(?:^|\\s)"+b+"(?:\\s|$)")).test(a.className)}function i(a,b){a.className?h(a,b)||(a.className+=" "+b):a.className=b}function k(a){return a.split(/\s+/).sort().join(" ")}function l(a){return k(a.className)}function m(a,b){return l(a)==l(b)}function n(a,b){return a.compareBoundaryPoints(b.START_TO_START,b)}function o(a,b,c,d,e){var f=a.node,g=a.offset,h=f,i=g;f==d&&g>e&&i++,f==b&&(g==c||g==c+1)&&(h=d,i+=e-c),f==b&&g>c+1&&i--,a.node=h,a.offset=i}function p(a,b,d,e){d==-1&&(d=b.childNodes.length);var f=a.parentNode,g=c.getNodeIndex(a);for(var h=0,i;i=e[h++];)o(i,f,g,b,d);b.childNodes.length==d?b.appendChild(a):b.insertBefore(a,b.childNodes[d])}function q(a,b,c,d,e){var f,g=[];while(f=a.firstChild)p(f,b,c++,e),g.push(f);return d&&a.parentNode.removeChild(a),g}function r(a,b){return q(a,a.parentNode,c.getNodeIndex(a),!0,b)}function s(a,b){var c=a.cloneRange();c.selectNodeContents(b);var d=c.intersection(a),e=d?d.toString():"";return c.detach(),e!=""}function t(a){var b=a.getNodes([3]),c=0,d;while((d=b[c])&&!s(a,d))++c;var e=b.length-1;while((d=b[e])&&!s(a,d))--e;return b.slice(c,e+1)}function u(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var c=0,d=a.attributes.length,e,f,g;c<d;++c){e=a.attributes[c],g=e.name;if(g!="class"){f=b.attributes.getNamedItem(g);if(e.specified!=f.specified)return!1;if(e.specified&&e.nodeValue!==f.nodeValue)return!1}}return!0}function v(a,b){for(var c=0,d=a.attributes.length,f;c<d;++c){f=a.attributes[c].name;if((!b||!e(b,f))&&a.attributes[c].specified&&f!="class")return!0}return!1}function w(a,b){var c;for(var d in b)if(b.hasOwnProperty(d)){c=b[d];if(typeof c=="object"){if(!w(a[d],c))return!1}else if(a[d]!==c)return!1}return!0}function z(a){var b;return a&&a.nodeType==1&&((b=a.parentNode)&&b.nodeType==9&&b.designMode=="on"||y(a)&&!y(a.parentNode))}function A(a){return(y(a)||a.nodeType!=1&&y(a.parentNode))&&!z(a)}function C(a){return a&&a.nodeType==1&&!B.test(x(a,"display"))}function E(a){if(a.data.length==0)return!0;if(D.test(a.data))return!1;var b=x(a.parentNode,"whiteSpace");switch(b){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(a.data))return!1}return C(a.previousSibling)||C(a.nextSibling)}function F(a){var b=[],c,e;for(c=0;e=a[c++];)b.push(new d(e.startContainer,e.startOffset),new d(e.endContainer,e.endOffset));return b}function G(a,b){for(var c=0,d,e,f,g=a.length;c<g;++c)d=a[c],e=b[c*2],f=b[c*2+1],d.setStartAndEnd(e.node,e.offset,f.node,f.offset)}function H(a,b){return c.isCharacterDataNode(a)?b==0?!!a.previousSibling:b==a.length?!!a.nextSibling:!0:b>0&&b<a.childNodes.length}function I(a,d,e,f){var g,h,i=e==0;if(c.isAncestorOf(d,a))return a;if(c.isCharacterDataNode(d)){var j=c.getNodeIndex(d);if(e==0)e=j;else{if(e!=d.length)throw b.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+e+" in "+d.data);e=j+1}d=d.parentNode}if(H(d,e)){g=d.cloneNode(!1),h=d.parentNode,g.id&&g.removeAttribute("id");var k,l=0;while(k=d.childNodes[e])p(k,g,l++,f);return p(g,h,c.getNodeIndex(d)+1,f),d==a?g:I(a,h,c.getNodeIndex(g),f)}if(a!=d){g=d.parentNode;var m=c.getNodeIndex(d);return i||m++,I(a,g,m,f)}return a}function J(a,b){return a.tagName==b.tagName&&m(a,b)&&u(a,b)&&x(a,"display")=="inline"&&x(b,"display")=="inline"}function K(a){var b=a?"nextSibling":"previousSibling";return function(c,d){var e=c.parentNode,f=c[b];if(f){if(f&&f.nodeType==3)return f}else if(d){f=e[b];if(f&&f.nodeType==1&&J(e,f))return f[a?"firstChild":"lastChild"]}return null}}function N(a){this.isElementMerge=a.nodeType==1,this.textNodes=[];var b=this.isElementMerge?a.lastChild:a;b&&(this.textNodes[0]=b)}function Q(a,b,c){this.cssClass=a;var d,e,f,h,i=null;if(typeof b=="object"&&b!==null){c=b.tagNames,i=b.elementProperties;for(e=0;h=O[e++];)b.hasOwnProperty(h)&&(this[h]=b[h]);d=b.normalize}else d=b;this.normalize=typeof d=="undefined"?!0:d,this.attrExceptions=[];var j=document.createElement(this.elementTagName);this.elementProperties=this.copyPropertiesToElement(i,j,!0),this.elementSortedClassName=this.elementProperties.hasOwnProperty("className")?this.elementProperties.className:a,this.applyToAnyTagName=!1;var k=typeof c;if(k=="string")c=="*"?this.applyToAnyTagName=!0:this.tagNames=g(c.toLowerCase()).split(/\s*,\s*/);else if(k=="object"&&typeof c.length=="number"){this.tagNames=[];for(e=0,f=c.length;e<f;++e)c[e]=="*"?this.applyToAnyTagName=!0:this.tagNames.push(c[e].toLowerCase())}else this.tagNames=[this.elementTagName]}function R(a,b,c){return new Q(a,b,c)}var c=a.dom,d=c.DomPosition,e=c.arrayContains,f="span",j=function(){function a(a,b,c){return b&&c?" ":""}return function(b,c){b.className&&(b.className=b.className.replace(new RegExp("(^|\\s)"+c+"(\\s|$)"),a))}}(),x=c.getComputedStyleProperty,y;(function(){var a=document.createElement("div");typeof a.isContentEditable=="boolean"?y=function(a){return a&&a.nodeType==1&&a.isContentEditable}:y=function(a){return!a||a.nodeType!=1||a.contentEditable=="false"?!1:a.contentEditable=="true"||y(a.parentNode)}})();var B=/^inline(-block|-table)?$/i,D=/[^\r\n\t\f \u200B]/,L=K(!1),M=K(!0);N.prototype={doMerge:function(a){var b=this.textNodes,c=b[0];if(b.length>1){var d=[],e=0,f,g;for(var h=0,i=b.length,j,k;h<i;++h){f=b[h],g=f.parentNode;if(h>0){g.removeChild(f),g.hasChildNodes()||g.parentNode.removeChild(g);if(a)for(j=0;k=a[j++];)k.node==f&&(k.node=c,k.offset+=e)}d[h]=f.data,e+=f.data.length}c.data=d.join("")}return c.data},getLength:function(){var a=this.textNodes.length,b=0;while(a--)b+=this.textNodes[a].length;return b},toString:function(){var a=[];for(var b=0,c=this.textNodes.length;b<c;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}};var O=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements"],P={};Q.prototype={elementTagName:f,elementProperties:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,copyPropertiesToElement:function(a,b,c){var d,e,f={},g,h,j,l;for(var m in a)if(a.hasOwnProperty(m)){h=a[m],j=b[m];if(m=="className")i(b,h),i(b,this.cssClass),b[m]=k(b[m]),c&&(f[m]=b[m]);else if(m=="style"){e=j,c&&(f[m]=g={});for(d in a[m])e[d]=h[d],c&&(g[d]=e[d]);this.attrExceptions.push(m)}else b[m]=h,c&&(f[m]=b[m],l=P.hasOwnProperty(m)?P[m]:m,this.attrExceptions.push(l))}return c?f:""},hasClass:function(a){return a.nodeType==1&&e(this.tagNames,a.tagName.toLowerCase())&&h(a,this.cssClass)},getSelfOrAncestorWithClass:function(a){while(a){if(this.hasClass(a))return a;a=a.parentNode}return null},isModifiable:function(a){return!this.applyToEditableOnly||A(a)},isIgnorableWhiteSpaceNode:function(a){return this.ignoreWhiteSpace&&a&&a.nodeType==3&&E(a)},postApply:function(a,b,c,d){var e=a[0],f=a[a.length-1],g=[],h,i=e,j=f,k=0,l=f.length,m,n;for(var o=0,p=a.length;o<p;++o)m=a[o],n=L(m,!d),n?(h||(h=new N(n),g.push(h)),h.textNodes.push(m),m===e&&(i=h.textNodes[0],k=i.length),m===f&&(j=h.textNodes[0],l=h.getLength())):h=null;var q=M(f,!d);q&&(h||(h=new N(f),g.push(h)),h.textNodes.push(q));if(g.length){for(o=0,p=g.length;o<p;++o)g[o].doMerge(c);b.setStartAndEnd(i,k,j,l)}},createContainer:function(a){var b=a.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,b,!1),i(b,this.cssClass),b},applyToTextNode:function(a,b){var d=a.parentNode;if(d.childNodes.length==1&&this.useExistingElements&&e(this.tagNames,d.tagName.toLowerCase())&&w(d,this.elementProperties))i(d,this.cssClass);else{var f=this.createContainer(c.getDocument(a));a.parentNode.insertBefore(f,a),f.appendChild(a)}},isRemovable:function(a){return a.tagName.toLowerCase()==this.elementTagName&&l(a)==this.elementSortedClassName&&w(a,this.elementProperties)&&!v(a,this.attrExceptions)&&this.isModifiable(a)},isEmptyContainer:function(a){var b=a.childNodes.length;return a.nodeType==1&&this.isRemovable(a)&&(b==0||b==1&&this.isEmptyContainer(a.firstChild))},removeEmptyContainers:function(a){var b=this,c=a.getNodes([1],function(a){return b.isEmptyContainer(a)});for(var d=0,e;e=c[d++];)e.parentNode.removeChild(e)},undoToTextNode:function(a,b,c,d){if(!b.containsNode(c)){var e=b.cloneRange();e.selectNode(c),e.isPointInRange(b.endContainer,b.endOffset)&&(I(c,b.endContainer,b.endOffset,d),b.setEndAfter(c)),e.isPointInRange(b.startContainer,b.startOffset)&&(c=I(c,b.startContainer,b.startOffset,d))}this.isRemovable(c)?r(c,d):j(c,this.cssClass)},applyToRange:function(a,b){b=b||[];var c=F(b||[]);a.splitBoundariesPreservingPositions(c),this.removeEmptyElements&&this.removeEmptyContainers(a);var d=t(a);if(d.length){for(var e=0,f;f=d[e++];)!this.isIgnorableWhiteSpaceNode(f)&&!this.getSelfOrAncestorWithClass(f)&&this.isModifiable(f)&&this.applyToTextNode(f,c);f=d[d.length-1],a.setStartAndEnd(d[0],0,f,f.length),this.normalize&&this.postApply(d,a,c,!1),G(b,c)}},applyToRanges:function(a){var b=a.length;while(b--)this.applyToRange(a[b],a);return a},applyToSelection:function(b){var c=a.getSelection(b);c.setRanges(this.applyToRanges(c.getAllRanges()))},undoToRange:function(a,b){b=b||[];var c=F(b);a.splitBoundariesPreservingPositions(c),this.removeEmptyElements&&this.removeEmptyContainers(a,c);var d=t(a),e,f,g=d[d.length-1];if(d.length){for(var h=0,i=d.length;h<i;++h)e=d[h],f=this.getSelfOrAncestorWithClass(e),f&&this.isModifiable(e)&&this.undoToTextNode(e,a,f,c),a.setStartAndEnd(d[0],0,g,g.length);this.normalize&&this.postApply(d,a,c,!0),G(b,c)}},undoToRanges:function(a){var b=a.length;while(b--)this.undoToRange(a[b],a);return a},undoToSelection:function(b){var c=a.getSelection(b),d=a.getSelection(b).getAllRanges();this.undoToRanges(d),c.setRanges(d)},getTextSelectedByRange:function(a,b){var c=b.cloneRange();c.selectNodeContents(a);var d=c.intersection(b),e=d?d.toString():"";return c.detach(),e},isAppliedToRange:function(a){if(a.collapsed||a.toString()=="")return!!this.getSelfOrAncestorWithClass(a.commonAncestorContainer);var b=a.getNodes([3]);if(b.length)for(var c=0,d;d=b[c++];)if(!this.isIgnorableWhiteSpaceNode(d)&&s(a,d)&&this.isModifiable(d)&&!this.getSelfOrAncestorWithClass(d))return!1;return!0},isAppliedToRanges:function(a){var b=a.length;if(b==0)return!1;while(b--)if(!this.isAppliedToRange(a[b]))return!1;return!0},isAppliedToSelection:function(b){var c=a.getSelection(b);return this.isAppliedToRanges(c.getAllRanges())},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleRanges:function(a){this.isAppliedToRanges(a)?this.undoToRanges(a):this.applyToRanges(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},getElementsWithClassIntersectingRange:function(a){var b=[],c=this;return a.getNodes([3],function(a){var d=c.getSelfOrAncestorWithClass(a);d&&!e(b,d)&&b.push(d)}),b},getElementsWithClassIntersectingSelection:function(b){var c=a.getSelection(b),d=[],f=this;return c.eachRange(function(a){var b=f.getElementsWithClassIntersectingRange(a);for(var c=0,g;g=b[c++];)e(d,g)||d.push(g)}),d},detach:function(){}},Q.util={hasClass:h,addClass:i,removeClass:j,hasSameClasses:m,replaceWithOwnChildren:r,elementsHaveSameNonClassAttributes:u,elementHasNonClassAttributes:v,splitNodeAt:I,isEditableElement:y,isEditingHost:z,isEditable:A},a.CssClassApplier=a.ClassApplier=Q,a.createCssClassApplier=a.createClassApplier=R})

/* SOURCE FILE: q.min.js (fd1a5fd7) 9/9/2014 2:09:01 PM */

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){window.Q=a("./q")},{"./q":2}],2:[function(a,b){"use strict";function c(a){return function(){return Z.apply(a,arguments)}}function d(a){return a===Object(a)}function e(a){return"[object StopIteration]"===fb(a)||a instanceof V}function f(a,b){if(S&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(hb)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var e=c.join("\n"+hb+"\n");a.stack=g(e)}}function g(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];j(e)||h(e)||!e||c.push(e)}return c.join("\n")}function h(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function i(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function j(a){var b=i(a);if(!b)return!1;var c=b[0],d=b[1];return c===U&&d>=W&&mb>=d}function k(){if(S)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=i(c);if(!d)return;return U=d[0],d[1]}}function l(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function m(a){return t(a)?a:u(a)?F(a):E(a)}function n(){function a(a){b=a,f.source=a,_(c,function(b,c){Y(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=cb(n.prototype),f=cb(q.prototype);if(f.promiseDispatch=function(a,e,f){var g=$(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):Y(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=l(function(){if(c)return f;var a=s(b);return t(a)&&(b=a),a},"valueOf","inspect"),f.inspect=function(){return b?b.inspect():{state:"pending"}},m.longStackSupport&&S)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(m(c))},e.fulfill=function(c){b||a(E(c))},e.reject=function(c){b||a(D(c))},e.notify=function(a){b||_(d,function(b,c){Y(function(){c(a)})},void 0)},e}function o(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=n();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function p(a){return o(function(b,c){for(var d=0,e=a.length;e>d;d++)m(a[d]).then(b,c)})}function q(a,b,c){void 0===b&&(b=function(a){return D(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=cb(q.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=D(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=l(function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value})}return d}function r(a,b,c,d){return m(a).then(b,c,d)}function s(a){if(t(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function t(a){return d(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function u(a){return d(a)&&"function"==typeof a.then}function v(a){return t(a)&&"pending"===a.inspect().state}function w(a){return!t(a)||"fulfilled"===a.inspect().state}function x(a){return t(a)&&"rejected"===a.inspect().state}function y(){kb||"undefined"==typeof window||window.Touch||!window.console||console.warn("[Q] Unhandled rejection reasons (should be empty):",ib),kb=!0}function z(){for(var a=0;a<ib.length;a++){var b=ib[a];b&&"undefined"!=typeof b.stack?console.warn("Unhandled rejection reason:",b.stack):console.warn("Unhandled rejection reason (no stack):",b)}}function A(){ib.length=0,jb.length=0,kb=!1,lb||(lb=!0,"undefined"!=typeof process&&process.on&&process.on("exit",z))}function B(a,b){lb&&(jb.push(a),ib.push(b),y())}function C(a){if(lb){var b=ab(jb,a);-1!==b&&(jb.splice(b,1),ib.splice(b,1))}}function D(a){var b=q({when:function(b){return b&&C(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return B(b,a),b}function E(a){return q({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return eb(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function F(a){var b=n();return Y(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function G(a){return q({isDef:function(){}},function(b,c){return M(a,b,c)},function(){return m(a).inspect()})}function H(a,b,c){return m(a).spread(b,c)}function I(a){return function(){function b(a,b){var g;if(gb){try{g=c[a](b)}catch(h){return D(h)}return g.done?g.value:r(g.value,d,f)}try{g=c[a](b)}catch(h){return e(h)?h.value:D(h)}return r(g,d,f)}var c=a.apply(this,arguments),d=b.bind(b,"next"),f=b.bind(b,"throw");return d()}}function J(a){m.done(m.async(a)())}function K(a){throw new V(a)}function L(a){return function(){return H([this,N(arguments)],function(b,c){return a.apply(b,c)})}}function M(a,b,c){return m(a).dispatch(b,c)}function N(a){return r(a,function(a){var b=0,c=n();return _(a,function(d,e,f){var g;t(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,r(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function O(a){return r(a,function(a){return a=bb(a,m),r(N(bb(a,function(a){return r(a,X,X)})),function(){return a})})}function P(a){return r(a,function(a){return N(bb(a,function(b,c){return r(b,function(b){return a[c]={state:"fulfilled",value:b},a[c]},function(b){return a[c]={state:"rejected",reason:b},a[c]})})).thenResolve(a)})}function Q(a,b){return m(a).then(void 0,void 0,b)}function R(a,b){return m(a).nodeify(b)}var S=!1;try{throw new Error}catch(T){S=!!T.stack}var U,V,W=k(),X=function(){},Y=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(g){if(f)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),g;setTimeout(function(){throw g},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0,f=!1;if(Y=function(a){c=c.next={task:a,domain:f&&process.domain,next:null},d||(d=!0,e())},"undefined"!=typeof process&&process.nextTick)f=!0,e=function(){process.nextTick(a)};else if("function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=a,e=function(){g.port2.postMessage(0)}}else e=function(){setTimeout(a,0)};return Y}(),Z=Function.call,$=c(Array.prototype.slice),_=c(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),ab=c(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),bb=c(Array.prototype.map||function(a,b){var c=this,d=[];return _(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),cb=Object.create||function(a){function b(){}return b.prototype=a,new b},db=c(Object.prototype.hasOwnProperty),eb=Object.keys||function(a){var b=[];for(var c in a)db(a,c)&&b.push(c);return b},fb=c(Object.prototype.toString);V="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var gb;try{new Function("(function* (){ yield 1; })"),gb=!0}catch(T){gb=!1}var hb="From previous event:";m.resolve=m,m.nextTick=Y,m.longStackSupport=!1,m.defer=n,n.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve($(arguments,1)):a.resolve(c)}},m.promise=o,m.passByCopy=function(a){return a},q.prototype.passByCopy=function(){return this},m.join=function(a,b){return m(a).join(b)},q.prototype.join=function(a){return m([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},m.race=p,q.prototype.race=function(){return this.then(m.race)},m.makePromise=q,q.prototype.toString=function(){return"[object Promise]"},q.prototype.then=function(a,b,c){function d(b){try{return"function"==typeof a?a(b):b}catch(c){return D(c)}}function e(a){if("function"==typeof b){f(a,h);try{return b(a)}catch(c){return D(c)}}return D(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=n(),j=!1;return Y(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(d(a)))},"when",[function(a){j||(j=!0,i.resolve(e(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!m.onerror)throw d;m.onerror(d)}c||i.notify(b)}]),i.promise},m.when=r,q.prototype.thenResolve=function(a){return this.then(function(){return a})},m.thenResolve=function(a,b){return m(a).thenResolve(b)},q.prototype.thenReject=function(a){return this.then(function(){throw a})},m.thenReject=function(a,b){return m(a).thenReject(b)},m.nearer=s,m.isPromise=t,m.isPromiseAlike=u,m.isPending=v,q.prototype.isPending=function(){return"pending"===this.inspect().state},m.isFulfilled=w,q.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},m.isRejected=x,q.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ib=[],jb=[],kb=!1,lb=!0;m.resetUnhandledRejections=A,m.getUnhandledReasons=function(){return ib.slice()},m.stopUnhandledRejectionTracking=function(){A(),"undefined"!=typeof process&&process.on&&process.removeListener("exit",z),lb=!1},A(),m.reject=D,m.fulfill=E,m.master=G,m.spread=H,q.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},m.async=I,m.spawn=J,m["return"]=K,m.promised=L,m.dispatch=M,q.prototype.dispatch=function(a,b){var c=this,d=n();return Y(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},m.get=function(a,b){return m(a).dispatch("get",[b])},q.prototype.get=function(a){return this.dispatch("get",[a])},m.set=function(a,b,c){return m(a).dispatch("set",[b,c])},q.prototype.set=function(a,b){return this.dispatch("set",[a,b])},m.del=m["delete"]=function(a,b){return m(a).dispatch("delete",[b])},q.prototype.del=q.prototype["delete"]=function(a){return this.dispatch("delete",[a])},m.mapply=m.post=function(a,b,c){return m(a).dispatch("post",[b,c])},q.prototype.mapply=q.prototype.post=function(a,b){return this.dispatch("post",[a,b])},m.send=m.mcall=m.invoke=function(a,b){return m(a).dispatch("post",[b,$(arguments,2)])},q.prototype.send=q.prototype.mcall=q.prototype.invoke=function(a){return this.dispatch("post",[a,$(arguments,1)])},m.fapply=function(a,b){return m(a).dispatch("apply",[void 0,b])},q.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},m["try"]=m.fcall=function(a){return m(a).dispatch("apply",[void 0,$(arguments,1)])},q.prototype.fcall=function(){return this.dispatch("apply",[void 0,$(arguments)])},m.fbind=function(a){var b=m(a),c=$(arguments,1);return function(){return b.dispatch("apply",[this,c.concat($(arguments))])}},q.prototype.fbind=function(){var a=this,b=$(arguments);return function(){return a.dispatch("apply",[this,b.concat($(arguments))])}},m.keys=function(a){return m(a).dispatch("keys",[])},q.prototype.keys=function(){return this.dispatch("keys",[])},m.all=N,q.prototype.all=function(){return N(this)},m.allResolved=l(O,"allResolved","allSettled"),q.prototype.allResolved=function(){return O(this)},m.allSettled=P,q.prototype.allSettled=function(){return P(this)},m.fail=m["catch"]=function(a,b){return m(a).then(void 0,b)},q.prototype.fail=q.prototype["catch"]=function(a){return this.then(void 0,a)},m.progress=Q,q.prototype.progress=function(a){return this.then(void 0,void 0,a)},m.fin=m["finally"]=function(a,b){return m(a)["finally"](b)},q.prototype.fin=q.prototype["finally"]=function(a){return a=m(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},m.done=function(a,b,c,d){return m(a).done(b,c,d)},q.prototype.done=function(a,b,c){var d=function(a){Y(function(){if(f(a,e),!m.onerror)throw a;m.onerror(a)})},e=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(d=process.domain.bind(d)),e.then(void 0,d)},m.timeout=function(a,b,c){return m(a).timeout(b,c)},q.prototype.timeout=function(a,b){var c=n(),d=setTimeout(function(){c.reject(new Error(b||"Timed out after "+a+" ms"))},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},m.delay=function(a,b){return void 0===b&&(b=a,a=void 0),m(a).delay(b)},q.prototype.delay=function(a){return this.then(function(b){var c=n();return setTimeout(function(){c.resolve(b)},a),c.promise})},m.nfapply=function(a,b){return m(a).nfapply(b)},q.prototype.nfapply=function(a){var b=n(),c=$(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},m.nfcall=function(a){var b=$(arguments,1);return m(a).nfapply(b)},q.prototype.nfcall=function(){var a=$(arguments),b=n();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},m.nfbind=m.denodeify=function(a){var b=$(arguments,1);return function(){var c=b.concat($(arguments)),d=n();return c.push(d.makeNodeResolver()),m(a).fapply(c).fail(d.reject),d.promise}},q.prototype.nfbind=q.prototype.denodeify=function(){var a=$(arguments);return a.unshift(this),m.denodeify.apply(void 0,a)},m.nbind=function(a,b){var c=$(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat($(arguments)),f=n();return e.push(f.makeNodeResolver()),m(d).fapply(e).fail(f.reject),f.promise}},q.prototype.nbind=function(){var a=$(arguments,0);return a.unshift(this),m.nbind.apply(void 0,a)},m.nmapply=m.npost=function(a,b,c){return m(a).npost(b,c)},q.prototype.nmapply=q.prototype.npost=function(a,b){var c=$(b||[]),d=n();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},m.nsend=m.nmcall=m.ninvoke=function(a,b){var c=$(arguments,2),d=n();return c.push(d.makeNodeResolver()),m(a).dispatch("post",[b,c]).fail(d.reject),d.promise},q.prototype.nsend=q.prototype.nmcall=q.prototype.ninvoke=function(a){var b=$(arguments,1),c=n();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},m.nodeify=R,q.prototype.nodeify=function(a){return a?(this.then(function(b){Y(function(){a(null,b)})},function(b){Y(function(){a(b)})}),void 0):this},b.exports=m;var mb=k()},{}]},{},[1]);

/* SOURCE FILE: es5-shim.min.js (84c9f2f0) 9/9/2014 2:09:01 PM */

/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2014 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.0.3/LICENSE
 */
(function(t,e){if(typeof define==="function"&&define.amd){define(e)}else if(typeof exports==="object"){module.exports=e()}else{t.returnExports=e()}})(this,function(){var t=Array.prototype;var e=Object.prototype;var r=Function.prototype;var n=String.prototype;var i=Number.prototype;var a=t.slice;var o=t.splice;var l=t.push;var u=t.unshift;var s=r.call;var f=e.toString;var c=function(t){return e.toString.call(t)==="[object Function]"};var h=function(t){return e.toString.call(t)==="[object RegExp]"};var p=function ve(t){return f.call(t)==="[object Array]"};var v=function ge(t){return f.call(t)==="[object String]"};var g=function ye(t){var e=f.call(t);var r=e==="[object Arguments]";if(!r){r=!p(t)&&t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&c(t.callee)}return r};var y=Object.defineProperty&&function(){try{Object.defineProperty({},"x",{});return true}catch(t){return false}}();var d;if(y){d=function(t,e,r,n){if(!n&&e in t){return}Object.defineProperty(t,e,{configurable:true,enumerable:false,writable:true,value:r})}}else{d=function(t,e,r,n){if(!n&&e in t){return}t[e]=r}}var m=function(t,r,n){for(var i in r){if(e.hasOwnProperty.call(r,i)){d(t,i,r[i],n)}}};function w(t){t=+t;if(t!==t){t=0}else if(t!==0&&t!==1/0&&t!==-(1/0)){t=(t>0||-1)*Math.floor(Math.abs(t))}return t}function b(t){var e=typeof t;return t===null||e==="undefined"||e==="boolean"||e==="number"||e==="string"}function x(t){var e,r,n;if(b(t)){return t}r=t.valueOf;if(c(r)){e=r.call(t);if(b(e)){return e}}n=t.toString;if(c(n)){e=n.call(t);if(b(e)){return e}}throw new TypeError}var S=function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return Object(t)};var O=function de(t){return t>>>0};function T(){}m(r,{bind:function me(t){var e=this;if(!c(e)){throw new TypeError("Function.prototype.bind called on incompatible "+e)}var r=a.call(arguments,1);var n=function(){if(this instanceof u){var n=e.apply(this,r.concat(a.call(arguments)));if(Object(n)===n){return n}return this}else{return e.apply(t,r.concat(a.call(arguments)))}};var i=Math.max(0,e.length-r.length);var o=[];for(var l=0;l<i;l++){o.push("$"+l)}var u=Function("binder","return function ("+o.join(",")+"){return binder.apply(this,arguments)}")(n);if(e.prototype){T.prototype=e.prototype;u.prototype=new T;T.prototype=null}return u}});var j=s.bind(e.hasOwnProperty);var E;var N;var I;var D;var _;if(_=j(e,"__defineGetter__")){E=s.bind(e.__defineGetter__);N=s.bind(e.__defineSetter__);I=s.bind(e.__lookupGetter__);D=s.bind(e.__lookupSetter__)}var M=function(){var t=[1,2];var e=t.splice();return t.length===2&&p(e)&&e.length===0}();m(t,{splice:function we(t,e){if(arguments.length===0){return[]}else{return o.apply(this,arguments)}}},M);var F=function(){var e={};t.splice.call(e,0,0,1);return e.length===1}();m(t,{splice:function be(t,e){if(arguments.length===0){return[]}var r=arguments;this.length=Math.max(w(this.length),0);if(arguments.length>0&&typeof e!=="number"){r=a.call(arguments);if(r.length<2){r.push(this.length-t)}else{r[1]=w(e)}}return o.apply(this,r)}},!F);var R=[].unshift(0)!==1;m(t,{unshift:function(){u.apply(this,arguments);return this.length}},R);m(Array,{isArray:p});var k=Object("a");var C=k[0]!=="a"||!(0 in k);var U=function xe(t){var e=true;var r=true;if(t){t.call("foo",function(t,r,n){if(typeof n!=="object"){e=false}});t.call([1],function(){"use strict";r=typeof this==="string"},"x")}return!!t&&e&&r};m(t,{forEach:function Se(t){var e=S(this),r=C&&v(this)?this.split(""):e,n=arguments[1],i=-1,a=r.length>>>0;if(!c(t)){throw new TypeError}while(++i<a){if(i in r){t.call(n,r[i],i,e)}}}},!U(t.forEach));m(t,{map:function Oe(t){var e=S(this),r=C&&v(this)?this.split(""):e,n=r.length>>>0,i=Array(n),a=arguments[1];if(!c(t)){throw new TypeError(t+" is not a function")}for(var o=0;o<n;o++){if(o in r){i[o]=t.call(a,r[o],o,e)}}return i}},!U(t.map));m(t,{filter:function Te(t){var e=S(this),r=C&&v(this)?this.split(""):e,n=r.length>>>0,i=[],a,o=arguments[1];if(!c(t)){throw new TypeError(t+" is not a function")}for(var l=0;l<n;l++){if(l in r){a=r[l];if(t.call(o,a,l,e)){i.push(a)}}}return i}},!U(t.filter));m(t,{every:function je(t){var e=S(this),r=C&&v(this)?this.split(""):e,n=r.length>>>0,i=arguments[1];if(!c(t)){throw new TypeError(t+" is not a function")}for(var a=0;a<n;a++){if(a in r&&!t.call(i,r[a],a,e)){return false}}return true}},!U(t.every));m(t,{some:function Ee(t){var e=S(this),r=C&&v(this)?this.split(""):e,n=r.length>>>0,i=arguments[1];if(!c(t)){throw new TypeError(t+" is not a function")}for(var a=0;a<n;a++){if(a in r&&t.call(i,r[a],a,e)){return true}}return false}},!U(t.some));var A=false;if(t.reduce){A=typeof t.reduce.call("es5",function(t,e,r,n){return n})==="object"}m(t,{reduce:function Ne(t){var e=S(this),r=C&&v(this)?this.split(""):e,n=r.length>>>0;if(!c(t)){throw new TypeError(t+" is not a function")}if(!n&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in r){a=r[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in r){a=t.call(void 0,a,r[i],i,e)}}return a}},!A);var P=false;if(t.reduceRight){P=typeof t.reduceRight.call("es5",function(t,e,r,n){return n})==="object"}m(t,{reduceRight:function Ie(t){var e=S(this),r=C&&v(this)?this.split(""):e,n=r.length>>>0;if(!c(t)){throw new TypeError(t+" is not a function")}if(!n&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i,a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in r){i=r[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in r){i=t.call(void 0,i,r[a],a,e)}}while(a--);return i}},!P);var Z=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;m(t,{indexOf:function De(t){var e=C&&v(this)?this.split(""):S(this),r=e.length>>>0;if(!r){return-1}var n=0;if(arguments.length>1){n=w(arguments[1])}n=n>=0?n:Math.max(0,r+n);for(;n<r;n++){if(n in e&&e[n]===t){return n}}return-1}},Z);var J=Array.prototype.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;m(t,{lastIndexOf:function _e(t){var e=C&&v(this)?this.split(""):S(this),r=e.length>>>0;if(!r){return-1}var n=r-1;if(arguments.length>1){n=Math.min(n,w(arguments[1]))}n=n>=0?n:r-Math.abs(n);for(;n>=0;n--){if(n in e&&t===e[n]){return n}}return-1}},J);var z=!{toString:null}.propertyIsEnumerable("toString"),$=function(){}.propertyIsEnumerable("prototype"),G=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],B=G.length;m(Object,{keys:function Me(t){var e=c(t),r=g(t),n=t!==null&&typeof t==="object",i=n&&v(t);if(!n&&!e&&!r){throw new TypeError("Object.keys called on a non-object")}var a=[];var o=$&&e;if(i||r){for(var l=0;l<t.length;++l){a.push(String(l))}}else{for(var u in t){if(!(o&&u==="prototype")&&j(t,u)){a.push(String(u))}}}if(z){var s=t.constructor,f=s&&s.prototype===t;for(var h=0;h<B;h++){var p=G[h];if(!(f&&p==="constructor")&&j(t,p)){a.push(p)}}}return a}});var H=Object.keys&&function(){return Object.keys(arguments).length===2}(1,2);var L=Object.keys;m(Object,{keys:function Fe(e){if(g(e)){return L(t.slice.call(e))}else{return L(e)}}},!H);var X=-621987552e5;var Y="-000001";var q=Date.prototype.toISOString&&new Date(X).toISOString().indexOf(Y)===-1;m(Date.prototype,{toISOString:function Re(){var t,e,r,n,i;if(!isFinite(this)){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}n=this.getUTCFullYear();i=this.getUTCMonth();n+=Math.floor(i/12);i=(i%12+12)%12;t=[i+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()];n=(n<0?"-":n>9999?"+":"")+("00000"+Math.abs(n)).slice(0<=n&&n<=9999?-4:-6);e=t.length;while(e--){r=t[e];if(r<10){t[e]="0"+r}}return n+"-"+t.slice(0,2).join("-")+"T"+t.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"}},q);var K=false;try{K=Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(X).toJSON().indexOf(Y)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(Q){}if(!K){Date.prototype.toJSON=function ke(t){var e=Object(this),r=x(e),n;if(typeof r==="number"&&!isFinite(r)){return null}n=e.toISOString;if(typeof n!=="function"){throw new TypeError("toISOString property is not callable")}return n.call(e)}}var V=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var W=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"));var te=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(!Date.parse||te||W||!V){Date=function(t){function e(r,n,i,a,o,l,u){var s=arguments.length;if(this instanceof t){var f=s===1&&String(r)===r?new t(e.parse(r)):s>=7?new t(r,n,i,a,o,l,u):s>=6?new t(r,n,i,a,o,l):s>=5?new t(r,n,i,a,o):s>=4?new t(r,n,i,a):s>=3?new t(r,n,i):s>=2?new t(r,n):s>=1?new t(r):new t;f.constructor=e;return f}return t.apply(this,arguments)}var r=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];function i(t,e){var r=e>1?1:0;return n[e]+Math.floor((t-1969+r)/4)-Math.floor((t-1901+r)/100)+Math.floor((t-1601+r)/400)+365*(t-1970)}function a(e){return Number(new t(1970,0,1,0,0,0,e))}for(var o in t){e[o]=t[o]}e.now=t.now;e.UTC=t.UTC;e.prototype=t.prototype;e.prototype.constructor=e;e.parse=function l(e){var n=r.exec(e);if(n){var o=Number(n[1]),l=Number(n[2]||1)-1,u=Number(n[3]||1)-1,s=Number(n[4]||0),f=Number(n[5]||0),c=Number(n[6]||0),h=Math.floor(Number(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),v=n[9]==="-"?1:-1,g=Number(n[10]||0),y=Number(n[11]||0),d;if(s<(f>0||c>0||h>0?24:25)&&f<60&&c<60&&h<1e3&&l>-1&&l<12&&g<24&&y<60&&u>-1&&u<i(o,l+1)-i(o,l)){d=((i(o,l)+u)*24+s+g*v)*60;d=((d+f+y*v)*60+c)*1e3+h;if(p){d=a(d)}if(-864e13<=d&&d<=864e13){return d}}return NaN}return t.parse.apply(this,arguments)};return e}(Date)}if(!Date.now){Date.now=function Ce(){return(new Date).getTime()}}var ee=i.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128");var re={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function Ue(t,e){var r=-1;while(++r<re.size){e+=t*re.data[r];re.data[r]=e%re.base;e=Math.floor(e/re.base)}},divide:function Ae(t){var e=re.size,r=0;while(--e>=0){r+=re.data[e];re.data[e]=Math.floor(r/t);r=r%t*re.base}},numToString:function Pe(){var t=re.size;var e="";while(--t>=0){if(e!==""||t===0||re.data[t]!==0){var r=String(re.data[t]);if(e===""){e=r}else{e+="0000000".slice(0,7-r.length)+r}}}return e},pow:function Ze(t,e,r){return e===0?r:e%2===1?Ze(t,e-1,r*t):Ze(t*t,e/2,r)},log:function Je(t){var e=0;while(t>=4096){e+=12;t/=4096}while(t>=2){e+=1;t/=2}return e}};m(i,{toFixed:function ze(t){var e,r,n,i,a,o,l,u;e=Number(t);e=e!==e?0:Math.floor(e);if(e<0||e>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}r=Number(this);if(r!==r){return"NaN"}if(r<=-1e21||r>=1e21){return String(r)}n="";if(r<0){n="-";r=-r}i="0";if(r>1e-21){a=re.log(r*re.pow(2,69,1))-69;o=a<0?r*re.pow(2,-a,1):r/re.pow(2,a,1);o*=4503599627370496;a=52-a;if(a>0){re.multiply(0,o);l=e;while(l>=7){re.multiply(1e7,0);l-=7}re.multiply(re.pow(10,l,1),0);l=a-1;while(l>=23){re.divide(1<<23);l-=23}re.divide(1<<l);re.multiply(1,1);re.divide(2);i=re.numToString()}else{re.multiply(0,o);re.multiply(1<<-a,0);i=re.numToString()+"0.00000000000000000000".slice(2,2+e)}}if(e>0){u=i.length;if(u<=e){i=n+"0.0000000000000000000".slice(0,e-u+2)+i}else{i=n+i.slice(0,u-e)+"."+i.slice(u-e)}}else{i=n+i}return i}},ee);var ne=n.split;if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var e=/()??/.exec("")[1]===void 0;n.split=function(r,n){var i=this;if(r===void 0&&n===0){return[]}if(f.call(r)!=="[object RegExp]"){return ne.call(this,r,n)}var a=[],o=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.extended?"x":"")+(r.sticky?"y":""),l=0,u,s,c,h;r=new RegExp(r.source,o+"g");i+="";if(!e){u=new RegExp("^"+r.source+"$(?!\\s)",o)}n=n===void 0?-1>>>0:O(n);while(s=r.exec(i)){c=s.index+s[0].length;if(c>l){a.push(i.slice(l,s.index));if(!e&&s.length>1){s[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(arguments[t]===void 0){s[t]=void 0}}})}if(s.length>1&&s.index<i.length){t.push.apply(a,s.slice(1))}h=s[0].length;l=c;if(a.length>=n){break}}if(r.lastIndex===s.index){r.lastIndex++}}if(l===i.length){if(h||!r.test("")){a.push("")}}else{a.push(i.slice(l))}return a.length>n?a.slice(0,n):a}})()}else if("0".split(void 0,0).length){n.split=function $e(t,e){if(t===void 0&&e===0){return[]}return ne.call(this,t,e)}}var ie=n.replace;var ae=function(){var t=[];"x".replace(/x(.)?/g,function(e,r){t.push(r)});return t.length===1&&typeof t[0]==="undefined"}();if(!ae){n.replace=function Ge(t,e){var r=c(e);var n=h(t)&&/\)[*?]/.test(t.source);if(!r||!n){return ie.call(this,t,e)}else{var i=function(r){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(r);t.lastIndex=i;a.push(arguments[n-2],arguments[n-1]);return e.apply(this,a)};return ie.call(this,t,i)}}}var oe=n.substr;var le="".substr&&"0b".substr(-1)!=="b";m(n,{substr:function Be(t,e){return oe.call(this,t<0?(t=this.length+t)<0?0:t:t,e)}},le);var ue="	\n\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var se="\u200b";var fe="["+ue+"]";var ce=new RegExp("^"+fe+fe+"*");var he=new RegExp(fe+fe+"*$");var pe=n.trim&&(ue.trim()||!se.trim());m(n,{trim:function He(){if(this===void 0||this===null){throw new TypeError("can't convert "+this+" to object")}return String(this).replace(ce,"").replace(he,"")}},pe);if(parseInt(ue+"08")!==8||parseInt(ue+"0x16")!==22){parseInt=function(t){var e=/^0[xX]/;return function r(n,i){n=String(n).trim();if(!Number(i)){i=e.test(n)?16:10}return t(n,i)}}(parseInt)}});
//# sourceMappingURL=es5-shim.map

/* SOURCE FILE: es5-sham.min.js (7ebf97e1) 9/9/2014 2:09:01 PM */

/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2014 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.0.3/LICENSE
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){var e=Function.prototype.call;var t=Object.prototype;var r=e.bind(t.hasOwnProperty);var n;var o;var i;var c;var f=r(t,"__defineGetter__");if(f){n=e.bind(t.__defineGetter__);o=e.bind(t.__defineSetter__);i=e.bind(t.__lookupGetter__);c=e.bind(t.__lookupSetter__)}if(!Object.getPrototypeOf){Object.getPrototypeOf=function g(e){var r=e.__proto__;if(r||r===null){return r}else if(e.constructor){return e.constructor.prototype}else{return t}}}function u(e){try{e.sentinel=0;return Object.getOwnPropertyDescriptor(e,"sentinel").value===0}catch(t){}}if(Object.defineProperty){var p=u({});var a=typeof document==="undefined"||u(document.createElement("div"));if(!a||!p){var l=Object.getOwnPropertyDescriptor}}if(!Object.getOwnPropertyDescriptor||l){var b="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function E(e,n){if(typeof e!=="object"&&typeof e!=="function"||e===null){throw new TypeError(b+e)}if(l){try{return l.call(Object,e,n)}catch(o){}}if(!r(e,n)){return}var u={enumerable:true,configurable:true};if(f){var p=e.__proto__;var a=e!==t;if(a){e.__proto__=t}var _=i(e,n);var s=c(e,n);if(a){e.__proto__=p}if(_||s){if(_){u.get=_}if(s){u.set=s}return u}}u.value=e[n];u.writable=true;return u}}if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function x(e){return Object.keys(e)}}if(!Object.create){var _;var s=!({__proto__:null}instanceof Object);if(s||typeof document==="undefined"){_=function(){return{__proto__:null}}}else{_=function(){var e=document.createElement("iframe");var t=document.body||document.documentElement;e.style.display="none";t.appendChild(e);e.src="javascript:";var r=e.contentWindow.Object.prototype;t.removeChild(e);e=null;delete r.constructor;delete r.hasOwnProperty;delete r.propertyIsEnumerable;delete r.isPrototypeOf;delete r.toLocaleString;delete r.toString;delete r.valueOf;r.__proto__=null;function n(){}n.prototype=r;_=function(){return new n};return new n}}Object.create=function z(e,t){var r;function n(){}if(e===null){r=_()}else{if(typeof e!=="object"&&typeof e!=="function"){throw new TypeError("Object prototype may only be an Object or null")}n.prototype=e;r=new n;r.__proto__=e}if(t!==void 0){Object.defineProperties(r,t)}return r}}function d(e){try{Object.defineProperty(e,"sentinel",{});return"sentinel"in e}catch(t){}}if(Object.defineProperty){var y=d({});var O=typeof document==="undefined"||d(document.createElement("div"));if(!y||!O){var j=Object.defineProperty,v=Object.defineProperties}}if(!Object.defineProperty||j){var w="Property description must be an object: ";var P="Object.defineProperty called on non-object: ";var m="getters & setters can not be defined "+"on this javascript engine";Object.defineProperty=function S(e,u,p){if(typeof e!=="object"&&typeof e!=="function"||e===null){throw new TypeError(P+e)}if(typeof p!=="object"&&typeof p!=="function"||p===null){throw new TypeError(w+p)}if(j){try{return j.call(Object,e,u,p)}catch(a){}}if(r(p,"value")){if(f&&(i(e,u)||c(e,u))){var l=e.__proto__;e.__proto__=t;delete e[u];e[u]=p.value;e.__proto__=l}else{e[u]=p.value}}else{if(!f){throw new TypeError(m)}if(r(p,"get")){n(e,u,p.get)}if(r(p,"set")){o(e,u,p.set)}}return e}}if(!Object.defineProperties||v){Object.defineProperties=function T(e,t){if(v){try{return v.call(Object,e,t)}catch(n){}}for(var o in t){if(r(t,o)&&o!=="__proto__"){Object.defineProperty(e,o,t[o])}}return e}}if(!Object.seal){Object.seal=function D(e){return e}}if(!Object.freeze){Object.freeze=function k(e){return e}}try{Object.freeze(function(){})}catch(h){Object.freeze=function F(e){return function t(r){if(typeof r==="function"){return r}else{return e(r)}}}(Object.freeze)}if(!Object.preventExtensions){Object.preventExtensions=function G(e){return e}}if(!Object.isSealed){Object.isSealed=function C(e){return false}}if(!Object.isFrozen){Object.isFrozen=function N(e){return false}}if(!Object.isExtensible){Object.isExtensible=function I(e){if(Object(e)!==e){throw new TypeError}var t="";while(r(e,t)){t+="?"}e[t]=true;var n=r(e,t);delete e[t];return n}}});
//# sourceMappingURL=es5-sham.map

/* SOURCE FILE: hammer.min.js (60b6e82e) 9/9/2014 2:09:01 PM */

/*! Hammer.JS - v2.0.2 - 2014-07-28
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */


!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e,f;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0,f=a.length;f>e;e++)b.call(c,a[e],e,a);else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0,g=e.length;g>f;f++)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]);return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==hb?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0,e=a.length;e>d;d++)if(c&&a[d][c]==b||!c&&a[d]===b)return d;return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0,g=a.length;g>f;f++){var h=b?a[f][b]:a[f];s(e,h)<0&&d.push(a[f]),e[f]=h}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0,h=fb.length;h>g;g++)if(c=fb[g],e=c?c+f:b,e in a)return e;return d}function w(){return lb++}function x(b,c){var d=this;this.manager=b,this.callback=c,this.element=b.element,this.target=b.options.inputTarget,this.domHandler=function(a){l(b.options.enable,[b])&&d.handler(a)},this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(a,this.evWin,this.domHandler)}function y(a){var b;return new(b=ob?M:pb?N:nb?P:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&vb&&d-e===0,g=b&(xb|yb)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=kb(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY),b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,C(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};(b.eventType===vb||f.eventType===xb)&&(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=yb&&(i>ub||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=jb(l.x)>jb(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;c++)b[c]={clientX:ib(a.pointers[c].clientX),clientY:ib(a.pointers[c].clientY)};return{timeStamp:kb(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:ib(a[0].clientX),y:ib(a[0].clientY)};for(var c=0,d=0,e=0;b>e;e++)c+=a[e].clientX,d+=a[e].clientY;return{x:ib(c/b),y:ib(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?zb:jb(a)>=jb(b)?a>0?Ab:Bb:b>0?Cb:Db}function H(a,b,c){c||(c=Hb);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Hb);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Ib)-I(a[1],a[0],Ib)}function K(a,b){return H(b[0],b[1],Ib)/H(a[0],a[1],Ib)}function L(){this.evEl=Kb,this.evWin=Lb,this.allow=!0,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Ob,this.evWin=Pb,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=Rb,this.targetIds={},x.apply(this,arguments)}function O(a,b){var c=t(a.touches),d=this.targetIds;if(b&(vb|wb)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.targetTouches),h=t(a.changedTouches),i=[];if(b===vb)for(e=0,f=g.length;f>e;e++)d[g[e].identifier]=!0;for(e=0,f=h.length;f>e;e++)d[h[e].identifier]&&i.push(h[e]),b&(xb|yb)&&delete d[h[e].identifier];return i.length?[u(g.concat(i),"identifier",!0),i]:void 0}function P(){x.apply(this,arguments);var a=k(this.handler,this);this.touch=new N(this.manager,a),this.mouse=new L(this.manager,a)}function Q(a,b){this.manager=a,this.set(b)}function R(a){if(q(a,Xb))return Xb;var b=q(a,Yb),c=q(a,Zb);return b&&c?Yb+" "+Zb:b||c?b?Yb:Zb:q(a,Wb)?Wb:Vb}function S(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=$b,this.simultaneous={},this.requireFail=[]}function T(a){return a&dc?"cancel":a&bc?"end":a&ac?"move":a&_b?"start":""}function U(a){return a==Db?"down":a==Cb?"up":a==Ab?"left":a==Bb?"right":""}function V(a,b){var c=b.manager;return c?c.get(a):a}function W(){S.apply(this,arguments)}function X(){W.apply(this,arguments),this.pX=null,this.pY=null}function Y(){W.apply(this,arguments)}function Z(){S.apply(this,arguments),this._timer=null,this._input=null}function $(){W.apply(this,arguments)}function _(){W.apply(this,arguments)}function ab(){S.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function bb(a,b){return b=b||{},b.recognizers=m(b.recognizers,bb.defaults.preset),new cb(a,b)}function cb(a,b){b=b||{},this.options=i(b,bb.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=y(this),this.touchAction=new Q(this,this.options.touchAction),db(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[2])},this)}function db(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:""})}function eb(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var fb=["","webkit","moz","MS","ms","o"],gb=b.createElement("div"),hb="function",ib=Math.round,jb=Math.abs,kb=Date.now,lb=1,mb=/mobile|tablet|ip(ad|hone|od)|android/i,nb="ontouchstart"in a,ob=v(a,"PointerEvent")!==d,pb=nb&&mb.test(navigator.userAgent),qb="touch",rb="pen",sb="mouse",tb="kinect",ub=25,vb=1,wb=2,xb=4,yb=8,zb=1,Ab=2,Bb=4,Cb=8,Db=16,Eb=Ab|Bb,Fb=Cb|Db,Gb=Eb|Fb,Hb=["x","y"],Ib=["clientX","clientY"];x.prototype={handler:function(){},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(a,this.evWin,this.domHandler)}};var Jb={mousedown:vb,mousemove:wb,mouseup:xb},Kb="mousedown",Lb="mousemove mouseup";j(L,x,{handler:function(a){var b=Jb[a.type];b&vb&&0===a.button&&(this.pressed=!0),b&wb&&1!==a.which&&(b=xb),this.pressed&&this.allow&&(b&xb&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:sb,srcEvent:a}))}});var Mb={pointerdown:vb,pointermove:wb,pointerup:xb,pointercancel:yb,pointerout:yb},Nb={2:qb,3:rb,4:sb,5:tb},Ob="pointerdown",Pb="pointermove pointerup pointercancel";a.MSPointerEvent&&(Ob="MSPointerDown",Pb="MSPointerMove MSPointerUp MSPointerCancel"),j(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Mb[d],f=Nb[a.pointerType]||a.pointerType,g=f==qb;e&vb&&(0===a.button||g)?b.push(a):e&(xb|yb)&&(c=!0);var h=s(b,a.pointerId,"pointerId");0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Qb={touchstart:vb,touchmove:wb,touchend:xb,touchcancel:yb},Rb="touchstart touchmove touchend touchcancel";j(N,x,{handler:function(a){var b=Qb[a.type],c=O.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:qb,srcEvent:a})}}),j(P,x,{handler:function(a,b,c){var d=c.pointerType==qb,e=c.pointerType==sb;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(xb|yb)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Sb=v(gb.style,"touchAction"),Tb=Sb!==d,Ub="compute",Vb="auto",Wb="manipulation",Xb="none",Yb="pan-x",Zb="pan-y";Q.prototype={set:function(a){a==Ub&&(a=this.compute()),Tb&&(this.manager.element.style[Sb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),R(a.join(" "))},preventDefaults:function(a){if(!Tb){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=q(d,Xb),f=q(d,Zb),g=q(d,Yb);return e||f&&g||f&&c&Eb||g&&c&Fb?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var $b=1,_b=2,ac=4,bc=8,cc=bc,dc=16,ec=32;S.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=V(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=V(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=V(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=V(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?T(d):""),a)}var c=this,d=this.state;bc>d&&b(!0),b(),d>=bc&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=ec)},canEmit:function(){for(var a=0;a<this.requireFail.length;a++)if(!(this.requireFail[a].state&(ec|$b)))return!1;return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(cc|dc|ec)&&(this.state=$b),this.state=this.process(b),void(this.state&(_b|ac|bc|dc)&&this.tryEmit(b))):(this.reset(),void(this.state=ec))},process:function(){},getTouchAction:function(){},reset:function(){}},j(W,S,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(_b|ac),e=this.attrTest(a);return d&&(c&yb||!e)?b|dc:d||e?c&xb?b|bc:b&_b?b|ac:_b:ec}}),j(X,W,{defaults:{event:"pan",threshold:10,pointers:1,direction:Gb},getTouchAction:function(){var a=this.options.direction;if(a===Gb)return[Xb];var b=[];return a&Eb&&b.push(Zb),a&Fb&&b.push(Yb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Eb?(e=0===f?zb:0>f?Ab:Bb,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?zb:0>g?Cb:Db,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return W.prototype.attrTest.call(this,a)&&(this.state&_b||!(this.state&_b)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=U(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(Y,W,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Xb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&_b)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),j(Z,S,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[Vb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(xb|yb)&&!f)this.reset();else if(a.eventType&vb)this.reset(),this._timer=e(function(){this.state=cc,this.tryEmit()},b.time,this);else if(a.eventType&xb)return cc;return ec},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===cc&&(a&&a.eventType&xb?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=kb(),this.manager.emit(this.options.event,this._input)))}}),j($,W,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Xb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&_b)}}),j(_,W,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Eb|Fb,pointers:1},getTouchAction:function(){return X.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Eb|Fb)?b=a.velocity:c&Eb?b=a.velocityX:c&Fb&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&jb(b)>this.options.velocity&&a.eventType&xb},emit:function(a){var b=U(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(ab,S,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Wb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&vb&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=xb)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=cc,this.tryEmit()},b.interval,this),_b):cc}return ec},failTimeout:function(){return this._timer=e(function(){this.state=ec},this.options.interval,this),ec},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==cc&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),bb.VERSION="2.0.2",bb.defaults={domEvents:!1,touchAction:Ub,inputTarget:null,enable:!0,preset:[[$,{enable:!1}],[Y,{enable:!1},["rotate"]],[_,{direction:Eb}],[X,{direction:Eb},["swipe"]],[ab],[ab,{event:"doubletap",taps:2},["tap"]],[Z]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var fc=1,gc=2;cb.prototype={set:function(a){return h(this.options,a),this},stop:function(a){this.session.stopped=a?gc:fc},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&cc)&&(e=b.curRecognizer=null);for(var f=0,g=d.length;g>f;f++)c=d[f],b.stopped===gc||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(_b|ac|bc)&&(e=b.curRecognizer=c)}},get:function(a){if(a instanceof S)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&eb(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0,e=c.length;e>d;d++)c[d](b)}},destroy:function(){this.element&&db(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(bb,{INPUT_START:vb,INPUT_MOVE:wb,INPUT_END:xb,INPUT_CANCEL:yb,STATE_POSSIBLE:$b,STATE_BEGAN:_b,STATE_CHANGED:ac,STATE_ENDED:bc,STATE_RECOGNIZED:cc,STATE_CANCELLED:dc,STATE_FAILED:ec,DIRECTION_NONE:zb,DIRECTION_LEFT:Ab,DIRECTION_RIGHT:Bb,DIRECTION_UP:Cb,DIRECTION_DOWN:Db,DIRECTION_HORIZONTAL:Eb,DIRECTION_VERTICAL:Fb,DIRECTION_ALL:Gb,Manager:cb,Input:x,TouchAction:Q,Recognizer:S,AttrRecognizer:W,Tap:ab,Pan:X,Swipe:_,Pinch:Y,Rotate:$,Press:Z,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),typeof define==hb&&define.amd?define(function(){return bb}):"undefined"!=typeof module&&module.exports?module.exports=bb:a[c]=bb}(window,document,"Hammer");
//# sourceMappingURL=hammer.min.map

/* SOURCE FILE: jquery.hammer.js (79781c35) 9/9/2014 2:09:01 PM */

(function($, Hammer, dataAttr) {
    function hammerify(el, options) {
        var $el = $(el);
        if(!$el.data(dataAttr)) {
            $el.data(dataAttr, new Hammer($el[0], options));
        }
    }

    $.fn.hammer = function(options) {
        return this.each(function() {
            hammerify(this, options);
        });
    };

    // extend the emit method to also trigger jQuery events
    Hammer.Manager.prototype.emit = (function(originalEmit) {
        return function(type, data) {
            originalEmit.call(this, type, data);
            jQuery(this.element).triggerHandler({
                type: type,
                gesture: data
            });
        };
    })(Hammer.Manager.prototype.emit);
})(jQuery, Hammer, "hammer");

/* SOURCE FILE: util.js (d5750f5d) 9/9/2014 2:09:05 PM */

var YUE = YAHOO.util.Event;
var YUD = YAHOO.util.Dom;
var YUC = YAHOO.util.Connect;
var YCE = YAHOO.util.CustomEvent;
var YLang = YAHOO.util.Lang;
(function() {
if (typeof window.console != 'object') {
window.console = {
log: function () { },
error: function () { },
warn: function () { },
info: function () { },
dir: function () { }
};
}
})();
var Util = {};
(function(Util) {
var logs = [];
var logMax = 500;
function LogEvent(message) {
this.message = message;
this.date = new Date();
}
LogEvent.prototype.toString = function() {
return '* ' + Util.Date.formatTime(this.date) + ' - ' + this.message;
};
Util.log = function(msg) {
var logEvent = new LogEvent(msg);
logs.push(logEvent);
if (logs.length > logMax) {
logs = logs.slice(1);
}
if (typeof console.log == 'function') {
console.log(logEvent.toString());
}
return logEvent;
};
Util.logInfo = function(msg) {
if (typeof console.info == 'function') {
console.info(msg);
}
};
Util.logError = function(msg) {
if (typeof console.error == 'function') {
console.error(msg);
}
};
Util.dir = function(msg) {
if (typeof console.dir == 'function') {
console.dir(msg);
}
};
Util.getDebugLog = function() {
return logs.join('\n');
};
Util.queueWork = function(fn               , context             ) {
context = context || window;
return YAHOO.lang.later(0, context, fn);
};
})(Util);
Util.Asserts = { };
Util.Asserts.assert = function(condition, opt_message)
{
if (!condition)
{
var message = 'Assertion failed';
if (opt_message)
{
message += ': ' + opt_message;
}
throw new Error(message);
}
return condition;
};

/* SOURCE FILE: util_assert.js (ff346371) 9/9/2014 2:09:05 PM */

Util.Assert = {};
(function(Assert) {
var errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];
var AssertionError = function (message            ) {
var tmp = Error.prototype.constructor.apply(this, arguments);
for (var idx = 0; idx < errorProps.length; idx++) {
this[errorProps[idx]] = tmp[errorProps[idx]];
}
};
AssertionError.prototype = new Error();
AssertionError.prototype.getMessage = function() {
return this.message;
}
AssertionError.prototype.toString = function() {
return this.name + ": " + this.getMessage();
}
var ComparisonFailure = function(message            , expected            , actual            ){
AssertionError.call(this, message);
this.expected             = expected;
this.actual             = actual;
this.name             = "ComparisonFailure";
};
YAHOO.lang.extend(ComparisonFailure, AssertionError);
ComparisonFailure.prototype.getMessage = function ()             {
return this.message + "\nExpected: " + this.expected + " (" + (typeof this.expected) + ")"  +
"\nActual:" + this.actual + " (" + (typeof this.actual) + ")";
}
var UnexpectedValue = function (message            , unexpected            ){
AssertionError.call(this, message);
this.unexpected             = unexpected;
this.name             = "UnexpectedValue";
};
YAHOO.lang.extend(UnexpectedValue, AssertionError);
UnexpectedValue.prototype.getMessage = function ()             {
return this.message + "\nUnexpected: " + this.unexpected + " (" + (typeof this.unexpected) + ") ";
}
var ShouldFail = function (message            ){
AssertionError.call(this, message || "This test should fail but didn't.");
this.name             = "ShouldFail";
};
YAHOO.lang.extend(ShouldFail, AssertionError);
var ShouldError = function (message            ){
AssertionError.call(this, message || "This test should have thrown an error but didn't.");
this.name             = "ShouldError";
};
YAHOO.lang.extend(ShouldError, AssertionError);
var UnexpectedError = function (cause            ){
AssertionError.call(this, "Unexpected error: " + cause.message);
this.cause            = cause;
this.name             = "UnexpectedError";
this.stack             = cause.stack;
};
YAHOO.lang.extend(UnexpectedError, AssertionError);
function formatMessage(customMessage            , defaultMessage            )             {
var message = customMessage;
if (YAHOO.lang.isString(customMessage) && customMessage.length > 0){
return YAHOO.lang.substitute(customMessage, { message: defaultMessage });
} else {
return defaultMessage;
}
}
Assert.fail = function (message            )           {
throw new AssertionError(formatMessage(message, "Test force-failed."));
}
Assert.areEqual = function (expected            , actual            , message            )           {
if (expected != actual) {
throw new ComparisonFailure(formatMessage(message, "Values should be equal."), expected, actual);
}
}
Assert.areNotEqual = function (unexpected            , actual            ,
message            )           {
if (unexpected == actual) {
throw new UnexpectedValue(formatMessage(message, "Values should not be equal."), unexpected);
}
}
Assert.areNotSame = function (unexpected            , actual            , message            )           {
if (unexpected === actual) {
throw UnexpectedValue(formatMessage(message, "Values should not be the same."), unexpected);
}
}
Assert.areSame = function (expected            , actual            , message            )           {
if (expected !== actual) {
throw new ComparisonFailure(formatMessage(message, "Values should be the same."), expected, actual);
}
}
Assert.isFalse = function (actual             , message            ) {
if (false !== actual) {
throw new ComparisonFailure(formatMessage(message, "Value should be false."), false, actual);
}
}
Assert.isTrue = function (actual             , message            )           {
if (true !== actual) {
throw new ComparisonFailure(formatMessage(message, "Value should be true."), true, actual);
}
}
Assert.isNaN = function (actual            , message            )          {
if (!isNaN(actual)){
throw new ComparisonFailure(formatMessage(message, "Value should be NaN."), NaN, actual);
}
}
Assert.isNotNaN = function (actual            , message            )          {
if (isNaN(actual)){
throw new UnexpectedValue(formatMessage(message, "Values should not be NaN."), NaN);
}
}
Assert.isNotNull = function (actual            , message            )           {
if (YAHOO.lang.isNull(actual)) {
throw new UnexpectedValue(formatMessage(message, "Values should not be null."), null);
}
}
Assert.isNotUndefined = function (actual            , message            )           {
if (YAHOO.lang.isUndefined(actual)) {
throw new UnexpectedValue(formatMessage(message, "Value should not be undefined."), undefined);
}
}
Assert.isNull = function (actual            , message            )           {
if (!YAHOO.lang.isNull(actual)) {
throw new ComparisonFailure(formatMessage(message, "Value should be null."), null, actual);
}
}
Assert.isUndefined = function (actual            , message            )           {
if (!YAHOO.lang.isUndefined(actual)) {
throw new ComparisonFailure(formatMessage(message, "Value should be undefined."), undefined, actual);
}
}
Assert.isArray = function (actual            , message            )           {
if (!YAHOO.lang.isArray(actual)){
throw new UnexpectedValue(formatMessage(message, "Value should be an array."), actual);
}
}
Assert.isBoolean = function (actual            , message            )           {
if (!YAHOO.lang.isBoolean(actual)){
throw new UnexpectedValue(formatMessage(message, "Value should be a Boolean."), actual);
}
}
Assert.isFunction = function (actual            , message            )           {
if (!YAHOO.lang.isFunction(actual)){
throw new UnexpectedValue(formatMessage(message, "Value should be a function."), actual);
}
}
Assert.isInstanceOf = function (expected              , actual            , message            )           {
if (!(actual instanceof expected)){
throw new ComparisonFailure(formatMessage(message, "Value isn't an instance of expected type."), expected, actual);
}
}
Assert.isNumber = function (actual            , message            )           {
if (!YAHOO.lang.isNumber(actual)){
throw new UnexpectedValue(formatMessage(message, "Value should be a number."), actual);
}
}
Assert.isObject = function (actual            , message            )           {
if (!YAHOO.lang.isObject(actual)){
throw new UnexpectedValue(formatMessage(message, "Value should be an object."), actual);
}
}
Assert.isString = function (actual            , message            )           {
if (!YAHOO.lang.isString(actual)){
throw new UnexpectedValue(formatMessage(message, "Value should be a string."), actual);
}
}
Assert.isElement = function (actual                 , message            )           {
if (!Util.Dom.isElement(actual)){
throw new UnexpectedValue(formatMessage(message, "Value should be an HTMLElement."), actual);
}
}
Assert.isTypeOf = function (expected            , actual            , message            )          {
if (typeof actual != expected){
throw new ComparisonFailure(formatMessage(message, "Value should be of type " + expected + "."), expected, typeof actual);
}
}
})(Util.Assert);

/* SOURCE FILE: util_function.js (b1b5dbeb) 9/9/2014 2:09:05 PM */

if (!Function.prototype.bind) {
Function.prototype.bind = function(oThis) {
if (typeof this !== "function") {
throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
}
var aArgs = Array.prototype.slice.call(arguments, 1),
fToBind = this,
fNOP = function() {
},
fBound = function() {
return fToBind.apply(this instanceof fNOP && oThis
? this
: oThis,
aArgs.concat(Array.prototype.slice.call(arguments)));
};
fNOP.prototype = this.prototype;
fBound.prototype = new fNOP();
return fBound;
};
}
Util.Function = {};
Util.Function.bind = function(func, scope          ) {
function closure() {
var cl_args = args.slice();
for (var i = 0, i_max = arguments.length; i < i_max; i++) {
cl_args.push(arguments[i]);
}
if (scope === null) {
return func.apply(this, cl_args);
} else {
return func.apply(scope, cl_args);
}
}
var args = [];
scope = YAHOO.lang.isValue(scope) ? scope : null;
for (var i = 2, i_max = arguments.length; i < i_max; i++) {
args.push(arguments[i]);
}
return closure;
};
Util.bind = Util.Function.bind;

/* SOURCE FILE: util_object.js (d9c8d3a5) 10/26/2014 1:27:06 PM */

(function (Util) {
var O = (Object.create) ? function(obj) {
return Object.create(obj);
} : (function() {
function F() {}
return function(obj) {
F.prototype = obj;
return new F();
};
}());
O.keys = function (object) {
if (Object.keys) {
return Object.keys(object);
} else {
var keys = [];
for (var key in object) {
if (object.hasOwnProperty(key)) {
keys.push(key);
}
}
return keys;
}
};
O.getKeys = O.keys;
O.values = function (object) {
var values = [];
for (var key in object) {
if (object.hasOwnProperty(key)) {
values.push(object[key]);
}
}
return values;
};
O.getValues = O.values;
O.isEmpty = function (object) {
for (var key in object) {
if (object.hasOwnProperty(key)) {
return false;
}
}
return true;
};
O.remove = function (obj, key) {
var rv;
if ((rv = key in obj)) {
delete obj[key];
}
return rv;
};
O.clear = function(obj) {
Object.keys(obj).forEach(function(key) {
delete obj[key];
});
};
O.clone = function (obj) {
if (obj == null || typeof (obj) != 'object') {
return obj;
}
var newObj = {};
for (var prop in obj) {
(function (prop) {
if (typeof obj[prop] == 'function') {
newObj[prop] = function () {
obj[prop]();
};
} else {
newObj[prop] = obj[prop];
}
})(prop);
}
return newObj;
};
O.isFrozen = function(obj) {
return (Object.isFrozen) ? Object.isFrozen(obj) : false;
};
O.freeze = (Object.freeze) ? function(obj) {
return Object.freeze(obj);
} : function(obj) {
return obj;
};
O.deepFreeze = (Object.freeze) ? function(obj) {
var prop, propKey;
Object.freeze(obj);
for (propKey in obj) {
prop = obj[propKey];
if (obj.hasOwnProperty(propKey) && prop instanceof Object && !O.isFrozen(prop)) {
O.deepFreeze(prop);
}
}
return obj;
} : function(obj) {
return obj;
};
Util.Object = O;
})(Util);
(function(O) {
var OP = Object.prototype;
var hasOwn = OP.hasOwnProperty;
function owns (obj, key) {
return !!obj && hasOwn.call(obj, key);
}
O.each = function(obj, fn, thisObj, proto) {
var key;
for (key in obj) {
if (proto || owns(obj, key)) {
fn.call(thisObj || window, obj[key], key, obj);
}
}
};
O.mix = function (receiver, supplier, overwrite, whitelist, mode, merge) {
var alwaysOverwrite, exists, from, i, key, len, to;
if (!receiver || !supplier) {
return receiver || {};
}
if (mode) {
if (mode === 2) {
O.mix(receiver.prototype, supplier.prototype, overwrite, whitelist, 0, merge);
}
from = mode === 1 || mode === 3 ? supplier.prototype : supplier;
to = mode === 1 || mode === 4 ? receiver.prototype : receiver;
if (!from || !to) {
return receiver;
}
} else {
from = supplier;
to = receiver;
}
alwaysOverwrite = overwrite && !merge;
if (whitelist) {
for (i = 0, len = whitelist.length; i < len; ++i) {
key = whitelist[i];
if (!hasOwn.call(from, key)) {
continue;
}
exists = alwaysOverwrite ? false : key in to;
if (merge && exists && isObject(to[key], true)
&& isObject(from[key], true)) {
O.mix(to[key], from[key], overwrite, null, 0, merge);
} else if (overwrite || !exists) {
to[key] = from[key];
}
}
} else {
for (key in from) {
if (!hasOwn.call(from, key)) {
continue;
}
exists = alwaysOverwrite ? false : key in to;
if (merge && exists && isObject(to[key], true)
&& isObject(from[key], true)) {
O.mix(to[key], from[key], overwrite, null, 0, merge);
} else if (overwrite || !exists) {
to[key] = from[key];
}
}
}
return receiver;
};
})(Util.Object);
(function (JSON) {
if (typeof JSON != 'object' &&
typeof YAHOO == 'object') {
JSON = {};
JSON.stringify = YAHOO.lang.JSON.stringify;
JSON.parse = YAHOO.lang.JSON.parse;
}
})(window.JSON, window.YAHOO);

/* SOURCE FILE: util_number.js (ea4a1c59) 9/9/2014 2:09:05 PM */

Util.Number = function() { };
Util.Number.parse = function(str)
{
return parseInt(str, 10);
};
Util.Number.limit = function(num, min, max)
{
return Math.min(max, Math.max(min, num));
};
Util.Number.from = function(item)
{
var number = parseFloat(item);
return isFinite(number) ? number : null;
};

/* SOURCE FILE: util_string.js (07ea47eb) 9/9/2014 2:09:05 PM */

Util.String = function() { };
Util.String.equals = function (str1, str2, options) {
options = options || {};
if (typeof str1 != 'string' ||
typeof str2 != 'string') {
return false;
}
if (options.trim) {
str1 = str1.trim();
str2 = str2.trim();
}
if (options.ignoreCase) {
if (options.useLocale) {
str1 = str1.toLocaleLowerCase();
str2 = str2.toLocaleLowerCase();
} else {
str1 = str1.toLowerCase();
str2 = str2.toLowerCase();
}
}
return (str1 === str2);
};
Util.String.startsWith = function(str, prefix)
{
return (str && str.indexOf(prefix) === 0);
};
Util.String.endsWith = function(str, suffix)
{
return (str && str.match(suffix+"$") == suffix);
};
Util.String.contains = function(str, search) {
return (str && search &&
str.indexOf(search) !== -1);
};
Util.String.isHttpProtocol = function(str)
{
return (Util.String.startsWith(str, 'http:') ||
Util.String.startsWith(str, 'https:'));
};
Util.String.format = function()
{
var str = arguments[0];
for (var i = 0; i < arguments.length - 1; i++)
{
var reg = new RegExp("\\{" + i + "\\}", "gm");
str = str.replace(reg, arguments[i + 1]);
}
return str;
};
Util.String.getUUID = function() {
return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
var r = Math.random() * 16 | 0,
v = c == 'x' ? r : (r & 0x3 | 0x8);
return v.toString(16);
});
};
Util.String.isNullOrEmpty = function(str) {
if (str == null) {
return true;
}
if (!YAHOO.lang.isString(str)) {
return true;
}
return (str.length === 0);
};
Util.String.isNullOrWhiteSpace = function(str) {
if (Util.String.isNullOrEmpty(str)) {
return true;
}
str = YAHOO.lang.trim(str);
return (str.length === 0);
};
Util.String.capitalize = function(str) {
return str.charAt(0).toUpperCase() + str.slice(1);
}
Util.String._HASHCODE_MAX = 0x100000000;
Util.String.hashCode = function(str)
{
var hash = 0, len = str.length;
for (var i = 0; i < len; ++i)
{
hash = hash * 31 + str.charCodeAt(i);
hash %= Util.String._HASHCODE_MAX;
}
return hash;
};
Util.HashCombiner = function()
{
this._hash = 17;
};
Util.HashCombiner.prototype.get = function() { return this._hash; };
Util.HashCombiner.prototype.add = function(str)
{
this._hash = this._hash * 31 + Util.String.hashCode(str.toString());
this._hash %= Util.String._HASHCODE_MAX;
};
if (!String.prototype.startsWith)
{
String.prototype.startsWith = function(s) { return this.indexOf(s) === 0; };
}
(function(Util) {
var NEW_LINE = '\n';
function SB(value) {
this._arr = [];
if (value) {
this.append(value);
}
}
SB.prototype.append = function (value) {
this._arr.push(value);
}
SB.prototype.appendLine = function (value) {
if (value) {
this.append(value);
}
this.append(NEW_LINE);
}
SB.prototype.appendFormat = function (                ) {
var str = Util.String.format.apply(this, arguments);
this.append(str);
}
SB.prototype.appendSub = function(str, obj) {
str = YAHOO.lang.substitute(str, obj);
this.append(str);
}
SB.prototype.toString = function (separator) {
separator = separator || '';
return this._arr.join(separator);
}
Util.StringBuilder = SB;
})(Util);

/* SOURCE FILE: util_date.js (f203b8d5) 9/9/2014 2:09:05 PM */

(function(Util)
{
Util.Date = {};
function xPad(x, pad, r) {
if (typeof r === 'undefined') {
r = 10;
}
for (; parseInt(x, 10) < r && r > 1; r /= 10) {
x = pad.toString() + x;
}
return x.toString();
}
Util.Date.formatTime = function(d) {
var hour = d.getHours() % 12;
hour = xPad(hour === 0 ? 12 : hour, 0);
var time = hour + ':' + xPad(d.getMinutes(), 0) + ':' + xPad(d.getSeconds(), 0) + '.' + xPad(d.getMilliseconds(), 00);
return time;
};
Util.Date.now = Date.now || (function() {
return +new Date();
});
Util.Date.xPad = xPad;
})(Util);

/* SOURCE FILE: util_converters.js (d21f13ef) 9/9/2014 2:09:05 PM */

Util.Converters = {};
Util.Converters.parseBoolean = function(value) {
if (YAHOO.util.Lang.isNull(value)) return null;
if (YAHOO.util.Lang.isBoolean(value)) return value;
if (YAHOO.util.Lang.isString(value)) {
return value.toLowerCase() === 'true';
} else {
return null;
}
};
Util.Converters.parseInt = function(value) {
if (YAHOO.util.Lang.isNull(value)) return null;
if (YAHOO.util.Lang.isNumber(value)) return value;
if (YAHOO.util.Lang.isString(value)) {
return value * 1;
} else {
return null;
}
};

/* SOURCE FILE: util_array.js (f6584c8e) 10/26/2014 1:27:06 PM */

(function(Util) {
var A = {};
var Native = Array.prototype;
A.isArray = function (arg) {
if (Array.isArray) {
return Array.isArray(arg);
} else {
return Object.prototype.toString.call(arg) === '[object Array]';
}
}
A.each = function(a, f, o) {
Native.forEach.call(a || [], f, o);
};
A.map = function(a, f, o) {
return Native.map.call(a, f, o);
};
A.filter = function (a, f, o) {
return Native.filter.call(a, f, o);
}
A.reject = function (a, f, o) {
return A.filter(a, function (item, i, a) {
return !f.call(o, item, i, a);
});
}
A.reduce = function(a, init, f, o) {
return Native.reduce.call(a, function (init, item, i, a) {
return f.call(o, init, item, i, a);
}, init);
}
A.every = function (a, f, o) {
return Native.every.call(a, f, o);
}
A.some = function(a, f, o) {
return Native.some.call(a, f, o);
}
A.find = function (list, predicate, thisArg) {
if (list == null) {
throw new TypeError('array is null or undefined');
}
if (typeof predicate !== 'function') {
throw new TypeError('predicate must be a function');
}
if (list.find) {
return list.find(predicate, thisArg);
}
var len = list.length;
for (var i = 0; i < len; i++) {
if (predicate.call(thisArg, list[i], i, list)) {
return list[i];
}
}
return undefined;
};
A.findWhere = function(list, predicate, thisArg) {
if (list == null) {
throw new TypeError('array is null or undefined');
}
if (typeof predicate !== 'function') {
throw new TypeError('predicate must be a function');
}
var len = list.length;
for (var i = 0; i < len; i++) {
var value = predicate.call(thisArg, list[i], i, list);
if (value) {
return value;
}
}
return undefined;
}
A.findIndex = function (list, predicate, thisArg) {
if (list == null) {
throw new TypeError('array is null or undefined');
}
if (typeof predicate !== 'function') {
throw new TypeError('predicate must be a function');
}
if (list.findIndex) {
return list.findIndex(predicate, thisArg);
}
var len = list.length;
for (var i = 0; i < len; i++) {
if (predicate.call(thisArg, list[i], i, list)) {
return i;
}
}
return -1;
};
A.concat = function (var_args) {
return Native.concat.apply(Native, arguments);
};
A.splice = function (arr, index, howMany, var_args) {
Util.Asserts.assert(arr.length != null);
return Native.splice.apply(arr, A.slice(arguments, 1));
};
A.slice = function (arr, start, opt_end) {
Util.Asserts.assert(arr.length != null);
if (arguments.length <= 2) {
return Native.slice.call(arr, start);
} else {
return Native.slice.call(arr, start, opt_end);
}
};
A.contains = function (arr, obj) {
return arr.indexOf(obj) >= 0;
};
A.clone = function(arr) {
return arr.slice(0);
}
A.removeAt = function (arr, i) {
return Array.prototype.splice.call(arr, i, 1).length == 1;
};
A.remove = function (arr, obj) {
var i = arr.indexOf(obj);
var rv;
if ((rv = i >= 0)) {
A.removeAt(arr, i);
}
return rv;
};
A.clear = function (arr) {
if (!A.isArray(arr)) {
for (var i = arr.length - 1; i >= 0; i--) {
delete arr[i];
}
}
arr.length = 0;
};
A.isEmpty = function (arr) {
return arr.length == 0;
};
A.insertAt = function (arr, obj, opt_i) {
A.splice(arr, opt_i, 0, obj);
};
A.insertBefore = function (arr, obj, target) {
var idx = arr.indexOf(obj);
if (idx == -1) {
return false;
} else {
if (idx == 0) {
arr.unshift(target);
} else {
A.insertAt(arr, target, idx);
}
return true;
}
};
A.insertAfter = function (arr, obj, target) {
var idx = arr.indexOf(obj);
if (idx == -1) {
return false;
} else {
if (idx == arr.length - 1) {
arr.push(target);
} else {
A.insertAt(arr, target, idx + 1);
}
return true;
}
};
A.partition = function (a, f, o) {
var results = {
matches: [],
rejects: []
};
A.each(a, function (item, index) {
var set = f.call(o, item, index, a) ? results.matches : results.rejects;
set.push(item);
});
return results;
};
A.zip = function (a, a2) {
var results = [];
A.each(a, function (item, index) {
results.push([item, a2[index]]);
});
return results;
};
A.unique = function(a, sort) {
sort = sort ? sort : false;
var uniqueList = a.slice(), i = 0, n = -1, item = null;
if (sort) {
while (i < uniqueList.length) {
if (uniqueList[i] === item) {
n = (n == -1 ? i : n);
i += 1;
} else if (n !== -1) {
uniqueList.splice(n, i - n);
i = n;
n = -1;
} else {
item = uniqueList[i];
i += 1;
}
}
return uniqueList;
} else {
while (i < uniqueList.length) {
item = uniqueList[i];
while ((n = uniqueList.lastIndexOf(item)) !== i) {
uniqueList.splice(n, 1);
}
i += 1;
}
return uniqueList;
}
};
A.uniqueStrings = function (list) {
var bucket = {}, i, l = list.length, uniqueList = [];
for (i = 0; i < l; i++) {
if (list[i] == null ||
list[i].length == 0) {
continue;
}
bucket[list[i]] = null;
}
for (key in bucket) {
uniqueList.push(key);
}
return uniqueList;
};
A.first = function (arr, defaultValue) {
var value = arr && arr[0];
return (value != null) ? value :
(defaultValue !== undefined) ? defaultValue : null;
};
A.last = function (arr, defaultValue) {
var value = arr && arr[arr.length - 1];
return (value != null) ? value :
(defaultValue !== undefined) ? defaultValue : null;
};
A.pick = function (values) {
for (var i = 0, l = values.length; i < l; i++) {
if (values[i] != null) {
return values[i];
}
}
return null;
};
A.peek = function (array) {
return array[array.length - 1];
};
A.flatten = function (a) {
var result = [],
i, len, val;
if (!a) {
return result;
}
for (i = 0, len = a.length; i < len; ++i) {
val = a[i];
if (A.isArray(val)) {
result.push.apply(result, A.flatten(val));
} else {
result.push(val);
}
}
return result;
};
A.mapFlatten = function (a, f, o) {
return A.flatten(A.map(a, f, o));
};
A.defaultCompare = function (a, b) {
return a > b ? 1 : a < b ? -1 : 0;
};
A.numericSort = function (a, b) {
return (a - b);
};
A.sort = function (arr, opt_compareFn) {
if (arr.length == null) {
return;
}
Array.prototype.sort.call(arr, opt_compareFn || A.defaultCompare);
};
A.shuffle = function (arr) {
var currentIndex = arr.length,
temporaryValue,
randomIndex;
while (0 !== currentIndex) {
randomIndex = Math.floor(Math.random() * currentIndex);
currentIndex -= 1;
temporaryValue = arr[currentIndex];
arr[currentIndex] = arr[randomIndex];
arr[randomIndex] = temporaryValue;
}
return arr;
};
A.transform = function(arr, fn, accumulator) {
accumulator = accumulator || [];
if (fn) {
arr.forEach(fn.bind(this, accumulator));
}
return accumulator;
}
Util.Array = A;
})(Util);

/* SOURCE FILE: util_structs.js (ef2481a0) 9/9/2014 2:09:05 PM */

Util.Structs = {};
Util.Structs.Stack = function()
{
this._arr = [];
};
Util.Structs.Stack.prototype.push = function(element)
{
this._arr.push(element);
};
Util.Structs.Stack.prototype.pop = function()
{
return this._arr.pop();
};
Util.Structs.Stack.prototype.peek = function()
{
return this._arr[this._arr.length - 1];
};
Util.Structs.Queue = function()
{
this._elements = [];
};
Util.Structs.Queue.prototype._head = 0;
Util.Structs.Queue.prototype._tail = 0;
Util.Structs.Queue.prototype.enqueue = function(element)
{
this._elements[this._tail++] = element;
};
Util.Structs.Queue.prototype.dequeue = function()
{
if (this._head == this._tail)
{
return undefined;
}
var result = this._elements[this._head];
delete this._elements[this._head];
this._head++;
return result;
};
Util.Structs.Queue.prototype.peek = function()
{
if (this._head == this._tail)
{
return undefined;
}
return this._elements[this._head];
};
Util.Structs.Queue.prototype.getCount = function()
{
return this._tail - this._head;
};
Util.Structs.Queue.prototype.isEmpty = function()
{
return this._tail - this._head == 0;
};
Util.Structs.Queue.prototype.clear = function()
{
this._elements.length = 0;
this._head = 0;
this._tail = 0;
};
Util.Structs.Queue.prototype.contains = function(obj)
{
return Util.Array.contains(this._elements, obj);
};
Util.Structs.Queue.prototype.remove = function(obj)
{
var index = this._elements.indexOf(obj);
if (index < 0)
{
return false;
}
if (index == this._head)
{
this.dequeue();
}
else
{
Util.Array.removeAt(this._elements, index);
this._tail--;
}
return true;
};
Util.Structs.Queue.prototype.getValues = function()
{
return this._elements.slice(this._head, this._tail);
};
Util.Structs.Map = function(opt_map, var_args)
{
this._count = 0;
this._version = 0;
this._map = {};
this._keys = [];
var argLength = arguments.length;
if (argLength > 1)
{
if (argLength % 2)
{
throw Error('Uneven number of arguments');
}
for (var i = 0; i < argLength; i += 2)
{
this.set(arguments[i], arguments[i + 1]);
}
}
else if (opt_map)
{
this.addAll(                     (opt_map));
}
};
Util.Structs.Map.prototype.getCount = function()
{
return this._count;
};
Util.Structs.Map.prototype.getValues = function()
{
this._cleanupKeysArray();
var rv = [];
for (var i = 0; i < this._keys.length; i++)
{
var key = this._keys[i];
rv.push(this._map[key]);
}
return rv;
};
Util.Structs.Map.prototype.getKeys = function()
{
this._cleanupKeysArray();
return                               (this._keys.concat());
};
Util.Structs.Map.prototype.containsKey = function(key)
{
return Util.Structs.Map._hasKey(this._map, key);
};
Util.Structs.Map.prototype.containsValue = function(val)
{
for (var i = 0; i < this._keys.length; i++)
{
var key = this._keys[i];
if (Util.Structs.Map._hasKey(this._map, key) && this._map[key] == val)
{
return true;
}
}
return false;
};
Util.Structs.Map.prototype.equals = function(otherMap, opt_equalityFn)
{
if (this === otherMap)
{
return true;
}
if (this._count != otherMap.getCount())
{
return false;
}
var equalityFn = opt_equalityFn || Util.Structs.Map.defaultEquals;
this._cleanupKeysArray();
for (var key, i = 0; key = this._keys[i]; i++)
{
if (!equalityFn(this.get(key), otherMap.get(key)))
{
return false;
}
}
return true;
};
Util.Structs.Map.defaultEquals = function(a, b)
{
return a === b;
};
Util.Structs.Map.prototype.isEmpty = function()
{
return this._count == 0;
};
Util.Structs.Map.prototype.clear = function()
{
this._map = {};
this._keys.length = 0;
this._count = 0;
this._version = 0;
};
Util.Structs.Map.prototype.remove = function(key)
{
if (Util.Structs.Map._hasKey(this._map, key))
{
delete this._map[key];
this._count--;
this._version++;
if (this._keys.length > 2 * this._count)
{
this._cleanupKeysArray();
}
return true;
}
return false;
};
Util.Structs.Map.prototype._cleanupKeysArray = function()
{
if (this._count != this._keys.length)
{
var srcIndex = 0;
var destIndex = 0;
while (srcIndex < this._keys.length)
{
var key = this._keys[srcIndex];
if (Util.Structs.Map._hasKey(this._map, key))
{
this._keys[destIndex++] = key;
}
srcIndex++;
}
this._keys.length = destIndex;
}
if (this._count != this._keys.length)
{
var seen = {};
var srcIndex = 0;
var destIndex = 0;
while (srcIndex < this._keys.length)
{
var key = this._keys[srcIndex];
if (!(Util.Structs.Map._hasKey(seen, key)))
{
this._keys[destIndex++] = key;
seen[key] = 1;
}
srcIndex++;
}
this._keys.length = destIndex;
}
};
Util.Structs.Map.prototype.get = function(key, opt_val)
{
if (Util.Structs.Map._hasKey(this._map, key))
{
return this._map[key];
}
return opt_val;
};
Util.Structs.Map.prototype.set = function(key, value)
{
if (!(Util.Structs.Map._hasKey(this._map, key)))
{
this._count++;
this._keys.push(key);
this._version++;
}
this._map[key] = value;
};
Util.Structs.Map.prototype.addAll = function(map)
{
var keys, values;
if (map instanceof Util.Structs.Map)
{
keys = map.getKeys();
values = map.getValues();
} else
{
keys = Util.Object.getKeys(map);
values = Util.Object.getValues(map);
}
for (var i = 0; i < keys.length; i++)
{
this.set(keys[i], values[i]);
}
};
Util.Structs.Map.prototype.clone = function()
{
return new Util.Structs.Map(this);
};
Util.Structs.Map._hasKey = function(obj, key)
{
return Object.prototype.hasOwnProperty.call(obj, key);
};

/* SOURCE FILE: util_iter.js (e1db2171) 9/9/2014 2:09:05 PM */

(function(Util) {
function Iterator(ref, options) {
if (!(this instanceof Iterator)) {
return new Iterator(ref, options);
}
this.options = {
pit: false,
limits: false,
chains: false
};
if (YAHOO.lang.isObject(options)) {
YAHOO.lang.augmentObject(this.options, options, true);
}
this._ref = ref;
this.ref = function() {
return this._ref;
};
this._key = null;
this.setKey = function (key) {
return this._key = key;
};
this.jump = function (key) {
key = this.setKey(this.valid(key));
return (this.options.chains) ? this : this.current(key);
};
this.key = function () {
var key = this.valid(this._key);
return this.setKey(key);
};
var min, max;
with (this.options) {
min = Util.Array.pick([this.options.min, 0]);
max = Util.Array.pick([this.options.max, ref.length - 1]);
}
};
Iterator.prototype.jumpTo = function (obj) {
var idx = this.ref().indexOf(obj);
if (idx >= 0) {
return this.jump(idx);
}
return null;
};
Iterator.prototype.valid = function () {
var length = this.ref().length;
var key = (arguments.length > 0) ? Util.Number.from(arguments[0]) : this.key();
if (key === null || length === 0) {
return null;
}
if (key < 0) {
key = this.ref().length + key;
}
if (key < 0 || key > length - 1) {
return null;
}
var range = function (side) {
return (typeof side !== 'number') ? null : Util.Number.limit(side, 0, length);
};
return key;
};
Iterator.prototype.reset = function () {
var range = this.range(1), key = (range.length) ? range[0] : null;
return this.jump(key);
},
Iterator.prototype.rewind = function () {
return this.jump(null);
};
Iterator.prototype.end = function () {
var range = this.range(1), key = (range.length) ? range.pop() : null;
return this.jump(key), this.current(key);
};
Iterator.prototype.next = function () {
return this.slide(1);
};
Iterator.prototype.prev = function () {
return this.slide(-1);
};
Iterator.prototype.current = function (key) {
key = (key === void 0) ? this.key() : this.valid(key);
return (key === null) ? null : this.ref()[key];
};
Iterator.prototype.slide = function (offset, from) {
offset = parseInt(offset);
var range = this.range(1);
var key = Util.Array.pick([Util.Number.from(from), this.key()]);
var limit = this.options.limits, pit = this.options.pit;
if (!range.length || offset === null || (limit && key === null && offset < 0)) {
return this.jump(null);
}
if (offset === 0) {
return this.current();
}
if (pit) {
range.unshift(null);
}
var max = range.length - 1;
if (key === null) {
key = (pit) ? 1 : 0;
if (limit) {
offset--, key = (pit) ? 1 : 0;
} else if (offset < 0) {
offset++, key = max;
} else {
offset--;
}
} else {
key = range.indexOf(key);
}
if (!pit && !limit && Math.abs(offset) >= range.length) {
offset = offset % range.length;
}
key = key + offset;
var more = key > max, less = key < 0;
if (more || less) {
if (pit && limit) {
key = null;
} else if (more) {
key = (limit) ? max : key - max - 1;
} else if (less) {
key = (limit) ? 0 : key + max + 1;
}
}
return this.jump(range[key]);
};
Iterator.prototype.range = function () {
var array = this.ref(), length = array.length - 1, keys = Util.Object.keys(array), pub = !arguments[0];
if (length < 0) {
return [];
}
if (pub) {
return array;
} else {
var range = Util.Array.map(keys, function (item) {
return parseInt(item);
});
return range;
}
};
Util.Iterator = Iterator;
})(Util);

/* SOURCE FILE: util_dom.js (ac68fc66) 9/9/2014 2:09:05 PM */

(function(Util) {
var D = {};
var DocClass = window.HTMLDocument || window.Document;
D.isDocument = function (obj) {
return (obj instanceof DocClass ||
Object.prototype.toString.call(obj) == "[object HTMLDocument]");
};
D.getWindow = function(doc) {
if (doc) {
return (doc.defaultView || doc.parentWindow);
}
return null;
};
D.getFrameContentDocument = function(frame) {
if (frame) {
if (YAHOO.env.ua.webkit) {
return (frame.document || frame.contentWindow.document);
} else {
return (frame.contentDocument || frame.contentWindow.document);
}
}
return null;
};
D.getFrameContentWindow = function(frame) {
if (frame) {
return (frame.contentWindow || this.getWindow(this.getFrameContentDocument(frame)));
}
return null;
};
D.getOwnerDocument = function (node) {
return (node.nodeType == NODE_TYPE.DOCUMENT ? node :
node.ownerDocument || node.document);
};
D.getOwnerWindow = function(node) {
var doc = D.getOwnerDocument(node);
return doc ? D.getWindow(doc) : null;
};
D.copyCSSFrame = function(frameID) {
var frame = YUD.get(frameID);
if (frame == null || frame.src == '') {
return false;
}
if (frame.contentDocument == null || frame.contentDocument.body == null) {
return false;
}
frame.contentDocument.body.className = document.body.className;
return true;
};
D.isVisible = function (node) {
node = YUD.get(node);
if (!node) {
return false;
}
while (node && (node.nodeName.toLowerCase() != 'body') && (YUD.getStyle(node, 'display') != 'none') && (YUD.getStyle(node, 'visibility') != 'hidden')) {
node = node.parentNode;
}
if (node && node.nodeName.toLowerCase() == 'body') {
return true;
} else {
return false;
}
};
D.getFocusableElements = function(root) {
root = root || this.innerElement;
var focusableTags = [
"a",
"button",
"select",
"textarea",
"input",
"iframe"
];
var focusable = {};
for (var i = 0; i < focusableTags.length; i++) {
focusable[focusableTags[i]] = true;
}
function isFocusable(el) {
if (el.focus && el.type !== "hidden" && !el.disabled && focusable[el.tagName.toLowerCase()]) {
return true;
}
return false;
}
return YUD.getElementsBy(isFocusable, null, root);
};
D.isFormElement = function(el) {
if (el.nodeType == 3              ) {
el = el.parentNode;
}
return " button textarea input select option ".indexOf(" " + el.tagName.toLowerCase() + " ") >= 0;
};
D.focus = function(obj) {
if (!obj || typeof (obj.focus) != 'function') {
return false;
}
try {
obj.focus();
} catch (ex) {
return false;
}
return true;
};
D.blur = function(obj) {
if (!obj || typeof (obj.blur) != 'function') {
return false;
}
try {
obj.blur();
} catch (ex) {
return false;
}
return true;
};
D.focusWindow = function(delay) {
if (YAHOO.lang.isNumber(delay)) {
setTimeout(function() {
D.focus(window);
}, delay);
} else {
D.focus(window);
}
};
D.getAncestor = function(needle, haystacks) {
if (needle == null || haystacks == null) {
return false;
}
var isMatch = function(element) {
for (var i = 0; i < haystacks.length; i++) {
var haystack = haystacks[i];
if (haystack == element) {
return true;
}
}
return false;
};
if (isMatch(needle)) {
return needle;
}
var element = null;
try {
element = YUD.getAncestorBy(needle, function(ancestor) {
return isMatch(ancestor);
});
} catch (ex) {
}
return element;
};
D.isNode = function (o) {
return (
typeof Node === 'function' ? o instanceof Node :
o && typeof o === 'object' && typeof o.nodeType === 'number' && typeof o.nodeName === 'string'
);
};
D.isElement = function (o) {
return (
typeof HTMLElement === 'function' ? o instanceof HTMLElement :
o && typeof o === 'object' && o.nodeType === 1 && typeof o.nodeName === 'string'
);
};
var TEXT_TYPES = {
'text': 1,
'password': 1
};
D.isTextInput = function(el) {
if (!el) {
return false;
}
if (el.tagName && el.tagName.toLowerCase() == 'textarea') {
return true;
}
if (el.tagName && el.tagName.toLowerCase() == 'input' && TEXT_TYPES[el.type]) {
return true;
}
if (el.contentEditable == '' ||
el.contentEditable == 'true') {
return true;
}
if (el.isContentEditable) {
return true;
}
var doc = D.getOwnerDocument(el);
if (doc) {
if (doc.designMode == 'on') {
return true;
}
if (YUD.getAttribute(doc.body, 'data-tds-textinput') == 'true') {
return true;
}
}
return false;
};
D.isImgLoaded = function(img) {
if (!img.complete) {
return false;
}
if (typeof img.naturalWidth != 'undefined' && img.naturalWidth == 0) {
return false;
}
return true;
};
var NODE_TYPE = D.NodeType = {
ELEMENT: 1,
ATTRIBUTE: 2,
TEXT: 3,
CDATA_SECTION: 4,
ENTITY_REFERENCE: 5,
ENTITY: 6,
PROCESSING_INSTRUCTION: 7,
COMMENT: 8,
DOCUMENT: 9,
DOCUMENT_TYPE: 10,
DOCUMENT_FRAGMENT: 11,
NOTATION: 12
};
D.removeNode = function(node) {
return node && node.parentNode ? node.parentNode.removeChild(node) : null;
};
D.removeChildren = function(node) {
var child;
while ((child = node.firstChild)) {
node.removeChild(child);
}
};
var DIRECT_ATTRIBUTE_MAP = {
'cellpadding': 'cellPadding',
'cellspacing': 'cellSpacing',
'colspan': 'colSpan',
'rowspan': 'rowSpan',
'valign': 'vAlign',
'height': 'height',
'width': 'width',
'usemap': 'useMap',
'frameborder': 'frameBorder',
'maxlength': 'maxLength',
'type': 'type'
};
D.setProperties = function(element, properties) {
for (key in properties) {
var val = properties[key];
if (key == 'style') {
element.style.cssText = val;
} else if (key == 'class') {
element.className = val;
} else if (key == 'for') {
element.htmlFor = val;
} else if (key.lastIndexOf('aria-', 0) == 0)
{
element.setAttribute(key, val);
} else if (key in DIRECT_ATTRIBUTE_MAP) {
element.setAttribute(DIRECT_ATTRIBUTE_MAP[key], val);
} else {
element[key] = val;
}
}
};
D.setTextContent = function(element, text) {
if ('textContent' in element) {
element.textContent = text;
} else if (element.firstChild && element.firstChild.nodeType == NODE_TYPE.TEXT) {
while (element.lastChild != element.firstChild) {
element.removeChild(element.lastChild);
}
element.firstChild.data = text;
} else {
D.removeChildren(element);
var doc = D.getOwnerDocument(element);
element.appendChild(doc.createTextNode(text));
}
};
D.setOuterHTML = function (el, html, doc) {
function setHTML(el, html, doc) {
var n, tp;
tp = doc.createElement("body");
tp.innerHTML = html;
n = tp.lastChild;
while (n) {
YUD.insertAfter(n.cloneNode(true), el);
n = n.previousSibling;
}
D.removeNode(el);
};
el = YAHOO.util.Dom.get(el);
if (!el || el.nodeType != 1) {
return null;
}
doc = doc || el.ownerDocument || document;
if (YAHOO.env.ua.ie) {
try {
el.outerHTML = html;
} catch (ex) {
setHTML(el, html, doc);
}
} else {
setHTML(el, html, doc);
}
return el;
};
var TAGS_TO_IGNORE = {
'SCRIPT': 1,
'STYLE': 1,
'HEAD': 1,
'IFRAME': 1,
'OBJECT': 1
};
var PREDEFINED_TAG_VALUES = {
'IMG': ' ',
'BR': '\n'
};
function _getTextContent(node, buf, normalizeWhitespace) {
if (node.nodeName in TAGS_TO_IGNORE) {
} else if (node.nodeType == NODE_TYPE.TEXT) {
if (normalizeWhitespace) {
buf.push(String(node.nodeValue).replace(/(\r\n|\r|\n)/g, ''));
} else {
buf.push(node.nodeValue);
}
} else if (node.nodeName in PREDEFINED_TAG_VALUES) {
buf.push(PREDEFINED_TAG_VALUES[node.nodeName]);
} else {
var child = node.firstChild;
while (child) {
_getTextContent(child, buf, normalizeWhitespace);
child = child.nextSibling;
}
}
};
D.getTextContent = function(node) {
var textContent;
var CAN_USE_INNER_TEXT = (YAHOO.env.ua.ie > 0 && YAHOO.env.ua.ie < 9);
if (CAN_USE_INNER_TEXT && ('innerText' in node)) {
textContent = node.innerText.replace(/(\r\n|\r|\n)/g, '\n');
} else {
var buf = [];
_getTextContent(node, buf, true);
textContent = buf.join('');
}
textContent = textContent.replace(/ \xAD /g, ' ').replace(/\xAD/g, '');
if (!YAHOO.env.ua.ie) {
textContent = textContent.replace(/ +/g, ' ');
}
if (textContent != ' ') {
textContent = textContent.replace(/^\s*/, '');
}
return textContent;
};
D.contains = function(parent, descendant) {
if (parent.contains && descendant.nodeType == NODE_TYPE.ELEMENT) {
return parent == descendant || parent.contains(descendant);
}
if (typeof parent.compareDocumentPosition != 'undefined') {
return parent == descendant || Boolean(parent.compareDocumentPosition(descendant) & 16);
}
while (descendant && parent != descendant) {
descendant = descendant.parentNode;
}
return descendant == parent;
};
D.compareNodeOrder = function (node1, node2) {
if (node1 == node2) {
return 0;
}
if (!D.isNode(node1) || !D.isNode(node2)) {
return 0;
}
return node1.compareDocumentPosition(node2) & 2 ? 1 : -1;
};
D.sort = function(arr) {
Util.Array.sort(arr, D.compareNodeOrder);
};
D.toggleClass = function(node, className, force) {
var add = (force !== undefined) ? force : !(YUD.hasClass(node, className));
if (add) {
YUD.addClass(node, className);
} else {
YUD.removeClass(node, className);
}
};
D.getElementByClassName = function(className, tag, root, apply, o, overrides) {
var elements = YUD.getElementsByClassName(className, tag, root, apply, o, overrides);
if (elements.length > 0) {
return elements[0];
}
return null;
};
D.getSelectionRange = function(win) {
win = win || window;
var selection = win.getSelection();
var range = null;
if (selection && selection.rangeCount > 0) {
try {
range = selection.getRangeAt(0);
} catch (ex) {
}
}
return range;
};
D.getElementRegions = function(el) {
var regions = [];
if (el.getClientRects) {
var clientRects = el.getClientRects();
for (var i = 0, ii = clientRects.length; i < ii; i++) {
var clientRect = clientRects[i];
var region = new YAHOO.util.Region(clientRect.top, clientRect.right, clientRect.bottom, clientRect.left);
regions.push(region);
}
} else {
var targetPos = YAHOO.util.Dom.getXY(el);
var top = targetPos[1],
left = targetPos[0],
bottom = top + el.offsetHeight,
right = left + el.offsetWidth;
var region = new YAHOO.util.Region(top, right, bottom, left);
regions.push(region);
}
return regions;
};
D.createElementFromHtml = function(html) {
var div = document.createElement('div');
div.innerHTML = html;
return YUD.getFirstChild(div);
};
D.batch = function(nodes, method, scope) {
var count = nodes.length;
for (var i = 0; i < count; i++) {
var node = nodes[i];
if (typeof scope == 'object') {
method.call(scope, node);
} else {
method(node);
}
}
};
D.queryTags = function(name, context) {
context = context || document;
return context.getElementsByTagName(name);
};
D.queryTag = function(name, context) {
var results = D.queryTags(name, context);
return (results.length > 0) ? results[0] : null;
};
D.queryTagsBatch = function(name, context, method, scope) {
var results = D.queryTags(name, context);
return D.batch(results, method, scope);
};
D.getElementsByTagName = function(name, context) {
context = context || document;
var collection = context.getElementsByTagName(name);
return Util.Array.slice(collection);
};
D.getElementByTagName = function(name, context) {
var list = D.getElementsByTagName(name, context);
return (list.length > 0) ? list[0] : null;
};
D.batchElementsByTagName = function(name, context, method, scope) {
var list = D.getElementsByTagName(name, context);
return D.batch(list, method, scope);
};
D.querySelectorAll = function(selector, context) {
context = context || document;
var nodeList = context.querySelectorAll(selector);
return Util.Array.slice(nodeList);
};
D.querySelector = function(selector, context) {
context = context || document;
return context.querySelector(selector);
};
D.batchQuerySelector = function(selector, context, method, scope) {
var results = D.querySelectorAll(selector, context);
return D.batch(results, method, scope);
};
D.querySelectorBatch = D.batchQuerySelector;
D.stopAllEvents = function (el, type) {
YUE.on(el, type, YUE.stopEvent, YUE, true);
};
D.stopDragEvents = function (el) {
el = el || window;
D.stopAllEvents(el, 'dragstart');
D.stopAllEvents(el, 'draggesture');
};
D.stopDropEvents = function (el) {
el = el || window;
D.stopAllEvents(el, 'drop');
};
Util.Dom = D;
})(window.Util);

/* SOURCE FILE: util_dom_builder.js (102fea48) 9/9/2014 2:09:05 PM */

(function(D) {
var L = YAHOO.lang;
var HTML = {};
function processChild(child) {
if (L.isNull(child) || L.isUndefined(child)) {
return null;
}
else if (L.isArray(child)) {
var r, fn = arguments.callee, l = [];
for (var i = 0; i < child.length; i++) {
r = fn.call(this, child[i]);
if (L.isArray(r)) {
for (var j = 0; j < r.length; j++) {
l.push(r[j]);
}
}
else {
l.push(r);
}
}
return l;
}
else if (L.isString(child) || L.isNumber(child)) {
return document.createTextNode(child);
}
else if (L.isFunction(child)) {
return arguments.callee.call(this, child.call(this));
}
else {
return child;
}
}
function __replaceWord(w) {
return w.substr(1, 2).toUpperCase();
}
function processStyleName(k) {
return k.replace(/\-\w/, __replaceWord);
}
function processAttr(k, v) {
if (k == 'style' && L.isObject(v)) {
var d = {};
for (var sk in v) {
if (L.isValue(v[sk])) {
d[processStyleName(sk)] = v[sk];
}
}
return d;
}
else if (!L.isString(v) && L.isValue(v)) {
return v.toString();
}
else if (L.isFunction(v)) {
return arguments.callee.call(this, k, v());
}
return v;
}
function createDom(tag, attrs               ) {
if ((YAHOO.env.ua.ie > 0 && YAHOO.env.ua.ie < 9) && L.isObject(attrs) && (attrs.name || attrs.type)) {
var tagNameArr = ['<', tag];
if (attrs.name) {
tagNameArr.push(' name="', attrs.name, '"');
}
if (attrs.type) {
tagNameArr.push(' type="', attrs.type, '"');
attrs = L.merge(attrs);
delete attrs.type;
}
tagNameArr.push('>');
tag = tagNameArr.join('');
}
var el = document.createElement(tag);
if (L.isObject(attrs)) {
for (var key in attrs) {
if (L.hasOwnProperty(attrs, key)) {
var attr = processAttr.call(this, key, attrs[key]);
if (key === 'style') {
if (L.isObject(attr)) {
for (var sk in attr) {
if (L.hasOwnProperty(attr, sk)) {
YUD.setStyle(el, sk, attr[sk]);
}
}
}
else {
el.style.cssText = attr;
}
}
else if (key === 'class') {
el.className = attr;
}
else {
YUD.setAttribute(el, key, attr);
}
}
}
}
var children = [];
for (var i = 2; i < arguments.length; i++) {
children.push(arguments[i]);
}
for (var i = 0; i < children.length; i++) {
var child = processChild.call(this, children[i]);
if (!L.isNull(child)) {
if (L.isArray(child)) {
for (var j = 0; j < child.length; j++) {
el.appendChild(child[j]);
}
}
else {
el.appendChild(child);
}
}
}
return el;
}
HTML.createDom = createDom;
var tag_cache = {};
function makeTag(t) {
var tag_name = t.toUpperCase();
if (tag_cache.hasOwnProperty(tag_name)) {
return tag_cache[tag_name];
}
return Util.Function.bind(createDom, null, t);
}
HTML.makeTag = makeTag;
var tag, tags = ['a', 'button', 'br', 'canvas',
'dd', 'div', 'dl', 'dt', 'em', 'fieldset', 'form',
'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'hr', 'img', 'input',
'label', 'legend', 'li', 'ol', 'optgroup', 'option', 'p', 'pre',
'select', 'span', 'strong', 'table', 'tbody', 'td', 'textarea',
'tfoot', 'th', 'thead', 'tr', 'tt', 'ul'];
for (var i = 0, i_max = tags.length; i < i_max; i++) {
tag = tags[i];
HTML[tag.toUpperCase()] = makeTag(tag);
}
D.Builder = HTML;
window.HTML = HTML;
})(Util.Dom);

/* SOURCE FILE: util_style.js (b6e98768) 9/9/2014 2:09:05 PM */

Util.Style = { };
Util.Style._getCascadedStyle = function(element, style)
{
return element.currentStyle ? element.currentStyle[style] : null;
};
Util.Style._ieBorderWidthKeywords =
{
'thin': 2,
'medium': 4,
'thick': 6
};
Util.Style._getIePixelValue = function(element, value, name, pixelName)
{
if (/^\d+px?$/.test(value))
{
return parseInt(value, 10);
}
else
{
var oldStyleValue = element.style[name];
var oldRuntimeValue = element.runtimeStyle[name];
element.runtimeStyle[name] = element.currentStyle[name];
element.style[name] = value;
var pixelValue = element.style[pixelName];
element.style[name] = oldStyleValue;
element.runtimeStyle[name] = oldRuntimeValue;
return pixelValue;
}
};
Util.Style._getIePixelBorder = function(element, prop)
{
if (Util.Style._getCascadedStyle(element, prop + 'Style') == 'none')
{
return 0;
}
var width = Util.Style._getCascadedStyle(element, prop + 'Width');
if (width in Util.Style._ieBorderWidthKeywords)
{
return Util.Style._ieBorderWidthKeywords[width];
}
return Util.Style._getIePixelValue(element, width, 'left', 'pixelLeft');
};
Util.Style.getBorderBox = function(element)
{
if (YAHOO.env.ua.ie)
{
var left = Util.Style._getIePixelBorder(element, 'borderLeft');
var right = Util.Style._getIePixelBorder(element, 'borderRight');
var top = Util.Style._getIePixelBorder(element, 'borderTop');
var bottom = Util.Style._getIePixelBorder(element, 'borderBottom');
return new YAHOO.util.Region(top, right, bottom, left);
}
else
{
var left = (YUD.getComputedStyle(element, 'borderLeftWidth'));
var right = (YUD.getComputedStyle(element, 'borderRightWidth'));
var top = (YUD.getComputedStyle(element, 'borderTopWidth'));
var bottom = (YUD.getComputedStyle(element, 'borderBottomWidth'));
return new YAHOO.util.Region(parseFloat(top),
parseFloat(right),
parseFloat(bottom),
parseFloat(left));
}
};
Util.Style.getPageOffset = function(element)
{
var region = YUD.getRegion(element);
return { x: region.left, y: region.top };
};
Util.Style.scrollIntoContainerView = function(element, container, opt_center)
{
var elementPos = Util.Style.getPageOffset(element);
var containerPos = Util.Style.getPageOffset(container);
var containerBorder = Util.Style.getBorderBox(container);
var relX = elementPos.x - containerPos.x - containerBorder.left;
var relY = elementPos.y - containerPos.y - containerBorder.top;
var spaceX = container.clientWidth - element.offsetWidth;
var spaceY = container.clientHeight - element.offsetHeight;
if (opt_center)
{
container.scrollLeft += relX - spaceX / 2;
container.scrollTop += relY - spaceY / 2;
}
else
{
container.scrollLeft += Math.min(relX, Math.max(relX - spaceX, 0));
container.scrollTop += Math.min(relY, Math.max(relY - spaceY, 0));
}
};
Util.Style.setStyles = function(element, stylesString)
{
if (YAHOO.env.ua.ie)
{
element.cssText = stylesString;
}
else
{
var propToSet = YAHOO.env.ua.webkit ? 'innerText' : 'innerHTML';
element[propToSet] = stylesString;
}
};
Util.Style.installStyles = function(doc, stylesString)
{
var styleSheet = null;
if (YAHOO.env.ua.ie)
{
styleSheet = doc.createStyleSheet();
Util.Style.setStyles(styleSheet, stylesString);
}
else
{
var head = doc.getElementsByTagName('head')[0];
styleSheet = doc.createElement('style');
Util.Style.setStyles(styleSheet, stylesString);
head.appendChild(styleSheet);
}
return styleSheet;
};

/* SOURCE FILE: util_promise.js (5508c3df) 9/9/2014 2:09:05 PM */

Util.Promise = {};
(function (P, Q) {
P.defer = Q.defer;
P.isPromise = Q.isPromise;
})(Util.Promise, Q);

/* SOURCE FILE: util_event.js (b616bde9) 9/9/2014 2:09:05 PM */

(function(Util) {
var E = {};
E.hasModifier = function(ev) {
return (ev.ctrlKey || ev.altKey || ev.metaKey);
};
E.inTextInput = function(ev) {
var target = YAHOO.util.Event.getTarget(ev);
return Util.Dom.isTextInput(target);
};
E.Mouse = (function() {
if ('ontouchstart' in window) {
return {
start: 'touchstart',
end: 'touchend',
move: 'touchmove',
click: 'click',
enter: 'touchenter',
leave: 'touchleave',
touchScreen: true
};
} else {
return {
start: 'mousedown',
end: 'mouseup',
move: 'mousemove',
click: 'click',
enter: 'mouseenter',
leave: 'mouseleave',
touchScreen: false
};
}
})();
E.normalize = function(evt) {
if ('ontouchstart' in window && evt.changedTouches) {
var touches = evt.changedTouches;
for (var i = 0, ii = touches.length; i < ii; i++) {
if (touches[i].target == evt.target) {
var oldevt = evt;
evt = touches[i];
evt.preventDefault = function() { return oldevt.preventDefault(); };
evt.stopPropagation = function() { return oldevt.stopPropagation(); };
break;
}
}
}
return evt;
};
var EventMap = {
'start': Hammer.INPUT_START,
'move': Hammer.INPUT_MOVE,
'end': Hammer.INPUT_END
};
function DOMRecognizer(inputType, options) {
this.inputType = inputType;
Hammer.Recognizer.call(this, options);
}
Hammer.inherit(DOMRecognizer, Hammer.Recognizer);
DOMRecognizer.prototype.process = function (input) {
if (input.eventType & this.inputType) {
return Hammer.STATE_RECOGNIZED;
}
return Hammer.STATE_FAILED;
};
E.addTouchMouse = function(name, el, callback) {
var manager = new Hammer.Manager(el);
var events = name.split(' ');
events.forEach(function(event) {
var inputType = EventMap[event];
if (inputType) {
manager.add(new DOMRecognizer(inputType, { event: event }));
}
});
manager.on(name, function (evt) {
var normalizedEvent = E.normalize(evt.srcEvent);
callback(normalizedEvent);
});
return manager;
};
Util.Event = E;
})(Util);

/* SOURCE FILE: util_event_custom.js (ed2a5350) 9/9/2014 2:09:05 PM */

Util = window.Util || {};
Util.Event = Util.Event || {};
(function (UE) {
function Subscriber(fn, overrideContext, fireOnce) {
this.fn = fn;
this.overrideContext = overrideContext;
this.fireOnce = fireOnce;
};
Subscriber.prototype.getScope = function (defaultScope) {
if (this.overrideContext) {
return this.overrideContext;
}
return defaultScope;
};
Subscriber.prototype.contains = function (fn) {
return (this.fn == fn);
};
function CE(context, fireOnce) {
this.scope = context || window;
this.fireOnce = fireOnce;
this.fired = false;
this.firedWith = null;
this.subscribers = [];
this.lastError = null;
};
CE.prototype.subscribe = function(fn, overrideContext, fireOnce) {
if (!fn) {
throw new Error("Invalid callback for subscriber");
}
var sub = new Subscriber(fn, overrideContext, fireOnce);
if (this.fireOnce && this.fired) {
this.notify(sub, this.firedWith);
} else {
this.subscribers.push(sub);
}
};
CE.prototype.unsubscribe = function(fn) {
if (!fn) {
return false;
}
var found = false;
for (var i = 0, len = this.subscribers.length; i < len; ++i) {
var sub = this.subscribers[i];
if (sub && sub.contains(fn)) {
this._delete(i);
found = true;
}
}
return found;
};
CE.prototype.fire = function() {
this.lastError = null;
var len = this.subscribers.length;
var args = [].slice.call(arguments, 0), ret = true, i;
if (this.fireOnce) {
if (this.fired) {
return true;
} else {
this.firedWith = args;
}
}
this.fired = true;
if (!len) {
return true;
}
var subs = this.subscribers.slice();
for (i = 0; i < len; ++i) {
var sub = subs[i];
if (sub && sub.fn) {
ret = this.notify(sub, args);
if (sub.fireOnce) {
this.unsubscribe(sub.fn);
}
if (false === ret) {
break;
}
}
}
return (ret !== false);
};
CE.prototype.notify = function (sub, args) {
var scope = sub.getScope(this.scope);
var ret = sub.fn.apply(scope, args);
return ret;
};
CE.prototype.unsubscribeAll = function() {
var l = this.subscribers.length, i;
for (i = l - 1; i > -1; i--) {
this._delete(i);
}
this.subscribers = [];
return l;
};
CE.prototype._delete = function (index) {
var sub = this.subscribers[index];
if (sub) {
delete sub.fn;
}
this.subscribers.splice(index, 1);
};
UE.Custom = CE;
})(Util.Event);

/* SOURCE FILE: util_event_emitter.js (9b395bf6) 9/9/2014 2:09:05 PM */

(function(UE) {
function augment(obj) {
var events = new Emitter(obj);
obj.on = function (name, fn) {
return events.on(name, fn);
}
obj.once = function (name, fn) {
return events.once(name, fn);
}
obj.fire = function (name) {
var args = Array.prototype.slice.call(arguments, 0);
return events.fire.apply(events, args);
}
obj.fireArgs = function (name, args) {
return events.fire.apply(events, name, args);
}
obj.removeListener = function (name, fn) {
return events.removeListener(name, fn);
}
obj.removeAllListeners = function () {
return events.removeAllListeners();
}
return events;
}
function Emitter(context) {
if (!(this instanceof Emitter)) {
return augment(context);
}
this.scope = context || window;
this._events = {};
this._subscribers = {};
};
Emitter.prototype.addListener = function(p_type, p_fn, overrideContext, fireOnce) {
overrideContext = overrideContext || this.scope;
var ce = this._events[p_type];
if (ce) {
ce.subscribe(p_fn, overrideContext, fireOnce);
} else {
var subs = this._subscribers;
if (!subs[p_type]) {
subs[p_type] = [];
}
subs[p_type].push({
fn: p_fn,
overrideContext: overrideContext,
fireOnce: fireOnce
});
}
};
Emitter.prototype.on = Emitter.prototype.addListener;
Emitter.prototype.once = function(p_type, p_fn, overrideContext) {
this.addListener(p_type, p_fn, overrideContext, true);
}
Emitter.prototype.removeListener = function (p_type, p_fn) {
if (!p_type) return false;
var ce = this._events[p_type];
if (ce) {
return ce.unsubscribe(p_fn);
} else {
var arr = this._subscribers[p_type];
if (arr) {
delete this._subscribers[p_type];
return true;
}
}
return false;
}
Emitter.prototype.removeAllListeners = function (p_type, p_fn) {
var evts = this._events;
var subs = this._subscribers;
if (p_type) {
return this.removeListener(p_type, p_fn);
}
var ret = false;
for (p_type in evts) {
if (YAHOO.lang.hasOwnProperty(evts, p_type)) {
if (evts[p_type].unsubscribe(p_fn)) {
ret = true;
}
}
}
if (!ret) {
for (p_type in subs) {
if (YAHOO.lang.hasOwnProperty(subs, p_type)) {
if (p_fn) {
var qs = subs[p_type];
} else {
delete subs[p_type];
}
}
}
}
return ret;
};
Emitter.prototype.create = function(p_type, p_config) {
var opts = p_config || {},
events = this._events;
var ce = events[p_type];
if (!ce) {
ce = new UE.Custom(opts.scope || this.scope, opts.fireOnce);
events[p_type] = ce;
var qs = this._subscribers[p_type];
if (qs) {
for (var i = 0; i < qs.length; ++i) {
ce.subscribe(qs[i].fn, qs[i].overrideContext, qs[i].fireOnce);
}
}
}
return ce;
};
Emitter.prototype.fire = function(p_type) {
var ce = this._events[p_type];
if (!ce) {
ce = this.create(p_type);
}
var args = Array.prototype.slice.call(arguments, 1);
return ce.fire.apply(ce, args);
};
Emitter.prototype.fireArgs = function (p_type, args) {
var ce = this._events[p_type];
if (!ce) {
ce = this.create(p_type);
}
return ce.fire.apply(ce, args);
};
Emitter.prototype.has = function(type) {
if (this._events[type]) {
return true;
}
return false;
};
UE.Emitter = Emitter;
})(Util.Event);

/* SOURCE FILE: util_event_manager.js (70ce259f) 9/9/2014 2:09:05 PM */

(function(Util) {
function EM(context) {
this._context = context || null;
this._events = new YAHOO.util.EventProvider();
};
EM.prototype.subscribe = function (name, func, overrideContext) {
if (!YAHOO.lang.isString(name)) {
return false;
}
if (!YAHOO.lang.isFunction(func)) {
return false;
}
if (!this._events.hasEvent(name)) {
if (this._context) {
this._events.createEvent(name, {
scope: this._context
});
} else {
this._events.createEvent(name);
}
}
function yuiFunc(args          ) {
var ret;
if (args) {
ret = func.apply(this, args);
} else {
ret = func.call(this);
}
return ret;
};
this._events.subscribe(name, yuiFunc, null, overrideContext || this._context);
return true;
};
EM.prototype.on = EM.prototype.subscribe;
EM.prototype.unsubscribe = function (name, func) {
return this._events.unsubscribe(name, func);
}
EM.prototype.fireArgs = function (name, args          ) {
return this._events.fireEvent(name, args);
};
EM.prototype.fire = function (name          ) {
var args = Array.prototype.slice.call(arguments, 1);
return this.fireArgs(name, args);
};
Util.EventManager = EM;
})(Util);

/* SOURCE FILE: util_delay.js (8decf0e7) 9/9/2014 2:09:05 PM */

Util.Delay = function(listener, interval, scope)
{
this._listener = listener;
this._interval = interval || 0;
this._scope = scope;
};
Util.Delay.prototype._timer = null;
Util.Delay.prototype.start = function(opt_interval)
{
this.stop();
this._timer = YAHOO.lang.later((opt_interval) ? opt_interval : this._interval, this, this._doAction);
};
Util.Delay.prototype.stop = function()
{
if (this.isActive())
{
this._timer.cancel();
}
this._timer = null;
};
Util.Delay.prototype.fire = function()
{
this.stop();
this._doAction();
};
Util.Delay.prototype.fireIfActive = function()
{
if (this.isActive())
{
this.fire();
}
};
Util.Delay.prototype.isActive = function()
{
return this._timer != null;
};
Util.Delay.prototype._doAction = function()
{
this._timer = null;
if (this._listener)
{
this._listener.call(this._scope);
}
};

/* SOURCE FILE: util_delay_conditional.js (96fc928d) 9/9/2014 2:09:05 PM */

Util.ConditionalDelay = function(listener, scope)
{
this._listener = listener;
this._scope = scope;
this._delay = new Util.Delay(this._onTick, 0             , this          );
this.onSuccess = new YAHOO.util.CustomEvent('onSuccess', this._scope, false, YAHOO.util.CustomEvent.FLAT);
this.onFailure = new YAHOO.util.CustomEvent('onFailure', this._scope, false, YAHOO.util.CustomEvent.FLAT);
};
Util.ConditionalDelay.prototype._interval = 0;
Util.ConditionalDelay.prototype._runUntil = 0;
Util.ConditionalDelay.prototype._isDone = false;
Util.ConditionalDelay.prototype.start = function(interval, timeout)
{
this.stop();
this._isDone = false;
timeout = timeout || 0;
this._interval = Math.max(interval || 0, 0);
this._runUntil = timeout < 0 ? -1 : (Util.Date.now() + timeout);
this._delay.start(timeout < 0 ? this._interval : Math.min(this._interval, timeout));
};
Util.ConditionalDelay.prototype.stop = function()
{
this._delay.stop();
};
Util.ConditionalDelay.prototype.isActive = function()
{
return this._delay.isActive();
};
Util.ConditionalDelay.prototype.isDone = function()
{
return this._isDone;
};
Util.ConditionalDelay.prototype._onTick = function()
{
var successful = this._listener.call(this._scope);
if (successful)
{
this._isDone = true;
this.onSuccess.fire();
}
else
{
if (this._runUntil < 0)
{
this._delay.start(this._interval);
}
else
{
var timeLeft = this._runUntil - Util.Date.now();
if (timeLeft <= 0)
{
this.onFailure.fire();
}
else
{
this._delay.start(Math.min(this._interval, timeLeft));
}
}
}
};

/* SOURCE FILE: util_taskworkflow.js (2679350a) 9/9/2014 2:09:05 PM */

Util.TaskWorkflow = function(globalContext)
{
var _tasks = [];
var _callback = null;
var _executer = (function()
{
var _stopped = false;
return {
wait: function()
{
_stopped = true;
},
resume: function(result)
{
var task;
_stopped = false;
if (_tasks.length > 0)
{
task = _tasks.shift();
result = task.func.apply(task.context, [_executer, result, task.obj]);
if (!_stopped)
{
_executer.resume(result);
}
}
else if (_callback && _callback.func)
{
_callback.func.apply(_callback.context, [_callback.obj]);
}
},
cancel: function()
{
_stopped = true;
_tasks = [];
_callback = null;
}
};
} ());
this.add = function(func, obj, overrideContext)
{
if (!YAHOO.lang.isFunction(func))
{
throw "expected function but was " + typeof (func);
}
var context = globalContext;
if (overrideContext)
{
if (overrideContext === true) context = obj;
else context = overrideContext;
}
_tasks.push({ func: func, context: context, obj: obj });
return this;
};
this.start = function(func, context, obj)
{
context = context || globalContext;
_callback = { func: func, context: context, obj: obj };
_executer.resume();
};
};
Util.TaskWorkflow.process = function()
{
var taskQueue = new Util.TaskWorkflow();
for (var i = 0; i < arguments.length; i++)
{
taskQueue.add(arguments[i]);
}
taskQueue.start();
};

/* SOURCE FILE: util_xhr.js (7e6b1b65) 9/9/2014 2:09:05 PM */

Util.XhrManager = function(opt_timeoutInterval, opt_maxRetries, opt_scope)
{
this._timeoutInterval = opt_timeoutInterval;
this._maxRetries = YAHOO.lang.isNumber(opt_maxRetries) ? Math.max(0, opt_maxRetries) : 0;
this._requests = new Util.Structs.Map();
this._scope = opt_scope;
this.Events = new Util.EventManager(this);
};
Util.XhrManager.prototype.inProgress = function(id)
{
return this._requests.containsKey(id);
};
Util.XhrManager.prototype.getOutstandingCount = function()
{
return this._requests.getCount();
};
Util.XhrManager.prototype.createRequest = function(id, url, opt_method, opt_content, opt_callback, opt_scope, opt_timeout, opt_maxRetries)
{
var request = new Util.XhrManager.Request(
id,
url,
opt_method,
opt_content,
opt_callback,
opt_scope || this._scope,
(YAHOO.lang.isNumber(opt_timeout) ? opt_timeout : this._timeoutInterval),
(YAHOO.lang.isNumber(opt_maxRetries) ? opt_maxRetries : this._maxRetries));
return request;
};
Util.XhrManager.prototype.send = function(id, url, opt_method, opt_content, opt_callback, opt_scope, opt_timeout, opt_maxRetries)
{
var request = this.createRequest(id, url, opt_method, opt_content, opt_callback, opt_scope, opt_timeout, opt_maxRetries);
this.sendRequest(request);
return request;
};
Util.XhrManager.prototype.sendRequest = function(request)
{
var id = request.getId();
if (this.inProgress(id)) throw Error("XhrManager ID in use");
request.resetAttemptCount();
request.setCompleted(false);
request.setAborted(false);
this.Events.fire('onRequest', request);
this._requests.set(id, request);
this._retry(id);
};
Util.XhrManager.prototype._retry = function(id)
{
var request = this._requests.get(id);
if (!request) return false;
if (request.isCompleted() || request.hasReachedMaxRetries())
{
this._complete(id);
return false;
}
var xhr = this;
var processResponse = function(xhrObj, success)
{
request.setResponse(xhrObj);
if (success) success = (xhrObj.getAllResponseHeaders != '');
request.setSuccess(success);
if (success) xhr.Events.fire('onSuccess', request);
else xhr.Events.fire('onFailure', request);
if (!success && request.allowRetry())
{
xhr._retry(id);
}
else
{
xhr._complete(id);
}
};
var callbackYUI =
{
success: function(xhrObj) { processResponse(xhrObj, true); },
failure: function(xhrObj) { processResponse(xhrObj, false); }
};
if (request.getTimeout()) callbackYUI.timeout = request.getTimeout();
var transaction = YAHOO.util.Connect.asyncRequest(request.getMethod(), request.getUrl(), callbackYUI, request.getContent());
request.setTransaction(transaction);
request.increaseAttemptCount();
this.Events.fire('onSent', request);
return true;
};
Util.XhrManager.prototype._complete = function(id)
{
var request = this._requests.get(id);
if (request == null) return;
this._requests.remove(id);
request.setCompleted(true);
var ret = this.Events.fire('onComplete', request);
if (ret === false) return;
var callback = request.getCallback();
var scope = request.getScope();
if (YAHOO.lang.isFunction(callback))
{
if (YAHOO.lang.isObject(scope))
{
callback.apply(scope, [request]);
}
else
{
callback(request);
}
}
};
Util.XhrManager.prototype.abort = function(id)
{
var request = this._requests.get(id);
if (!request) return false;
request.setAborted(true);
this._requests.remove(id);
var transaction = request.getTransaction();
if (transaction)
{
YAHOO.util.Connect.abort(transaction);
}
this.Events.fire('onAbort', request);
return true;
};
Util.XhrManager.prototype.abortAll = function()
{
var requestIds = this._requests.getKeys();
Util.Array.each(requestIds, function(id)
{
this.abort(id);
});
};
Util.XhrManager.Request = function(id, url, opt_method, opt_content, opt_callback, opt_scope, opt_timeout, opt_maxRetries, opt_args)
{
this._id = id;
this._url = url;
this._method = YAHOO.lang.isString(opt_method) ? opt_method : 'GET';
this._content = opt_content || null;
this._callback = YAHOO.lang.isFunction(opt_callback) ? opt_callback : null;
this._scope = YAHOO.lang.isObject(opt_scope) ? opt_scope : null;
this._timeout = YAHOO.lang.isNumber(opt_timeout) ? opt_timeout : null;
this._maxRetries = YAHOO.lang.isNumber(opt_maxRetries) ? opt_maxRetries : 0;
this._args = opt_args;
this._attemptCount = 0;
this._completed = false;
this._succeeded = false;
this._aborted = false;
this._transaction = null;
this._response = null;
};
Util.XhrManager.Request.prototype.getId = function() { return this._id; };
Util.XhrManager.Request.prototype.getUrl = function() { return this._url; };
Util.XhrManager.Request.prototype.setUrl = function(url) { this._url = url; };
Util.XhrManager.Request.prototype.getMethod = function() { return this._method; };
Util.XhrManager.Request.prototype.setMethod = function(method) { this._method = method; };
Util.XhrManager.Request.prototype.getContent = function() { return this._content; };
Util.XhrManager.Request.prototype.setContent = function(content) { this._content = content; };
Util.XhrManager.Request.prototype.getCallback = function() { return this._callback; };
Util.XhrManager.Request.prototype.setCallback = function(callback) { this._callback = callback; };
Util.XhrManager.Request.prototype.getScope = function() { return this._scope; };
Util.XhrManager.Request.prototype.setScope = function(scope) { this._scope = scope; };
Util.XhrManager.Request.prototype.getTimeout = function() { return this._timeout; };
Util.XhrManager.Request.prototype.setTimeout = function(timeout) { this._timeout = timeout; };
Util.XhrManager.Request.prototype.clearTimeout = function() { this._timeout = null; };
Util.XhrManager.Request.prototype.getMaxRetries = function() { return this._maxRetries; };
Util.XhrManager.Request.prototype.setMaxRetries = function(retries) { this._maxRetries = retries; };
Util.XhrManager.Request.prototype.getArgs = function() { return this._args; };
Util.XhrManager.Request.prototype.setArgs = function(args) { this._args = args; };
Util.XhrManager.Request.prototype.getAttemptCount = function() { return this._attemptCount; };
Util.XhrManager.Request.prototype.increaseAttemptCount = function() { this._attemptCount++; };
Util.XhrManager.Request.prototype.resetAttemptCount = function() { this._attemptCount = 0; };
Util.XhrManager.Request.prototype.hasReachedMaxRetries = function() { return this._attemptCount > this._maxRetries; };
Util.XhrManager.Request.prototype.setCompleted = function(complete) { this._completed = complete; };
Util.XhrManager.Request.prototype.isCompleted = function() { return this._completed; };
Util.XhrManager.Request.prototype.setAborted = function(abort) { this._aborted = abort; };
Util.XhrManager.Request.prototype.isAborted = function() { return this._aborted; };
Util.XhrManager.Request.prototype.setTransaction = function(tid) { this._transaction = tid; };
Util.XhrManager.Request.prototype.getTransaction = function() { return this._transaction; };
Util.XhrManager.Request.prototype.setResponse = function(xhrObj) { this._response = xhrObj; };
Util.XhrManager.Request.prototype.getResponse = function() { return this._response; };
Util.XhrManager.Request.prototype.setSuccess = function(success) { this._succeeded = success; };
Util.XhrManager.Request.prototype.isSuccess = function() { return this._succeeded; };
Util.XhrManager.Request.prototype.getContentType = function()
{
var contentType = null;
var xhrObj = this.getResponse();
if (xhrObj && xhrObj.getResponseHeader)
{
contentType = xhrObj.getResponseHeader['Content-Type'];
}
return (YAHOO.lang.isString(contentType)) ? contentType : '';
};
Util.XhrManager.Request.prototype.getResponseText = function()
{
if (this.isCompleted())
{
var response = this.getResponse();
if (response) return response.responseText || null;
}
return null;
};
Util.XhrManager.Request.prototype.getResponseJson = function()
{
var contentType = this.getContentType();
var text = this.getResponseText();
if (text != null && text.length > 0 && contentType.indexOf('application/json') != -1)
{
return Util.XhrManager.parseJson(text);
}
return null;
};
Util.XhrManager.Request.prototype.getResponseXml = function()
{
var contentType = this.getContentType();
var response = this.getResponse();
if (this.isCompleted() && contentType.indexOf('text/xml') != -1)
{
if (response) return response.responseXML || null;
}
return null;
};
Util.XhrManager.Request.prototype.allowRetry = function()
{
var response = this.getResponse();
if (response)
{
if (response.getAllResponseHeaders == '') return true;
return (response.status == 0 || response.status == -1);
}
return false;
};
Util.XhrManager.parseJson = function(text)
{
var reISO = /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/;
var reMsAjax = /^\/Date\((d|-|.*)\)[\/|\\]$/;
var parseDatesReviver = function(key, value)
{
if (typeof value === 'string')
{
var a = reISO.exec(value);
if (a) return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4], +a[5], +a[6]));
a = reMsAjax.exec(value);
if (a)
{
var b = a[1].split(/[-+,.]/);
return new Date(b[0] ? +b[0] : 0 - +b[1]);
}
}
return value;
};
return YAHOO.lang.JSON.parse(text, parseDatesReviver);
};

/* SOURCE FILE: util_browser.js (1a2f6426) 10/26/2014 1:27:06 PM */

(function (Util) {
var MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;
var SUPPORT_TOUCH = ('ontouchstart' in window);
var SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);
var Browser = {};
Browser.isWindows = function () {
return (navigator.platform.indexOf("Windows") != -1 ||
navigator.platform.indexOf("Win32") != -1 ||
navigator.platform.indexOf("Win64") != -1);
};
Browser.isLinux = function () {
return (navigator.platform.indexOf("X11") != -1 ||
navigator.platform.indexOf("Linux") != -1 ||
navigator.platform.indexOf("BSD") != -1);
};
Browser.isMac = function () {
return (navigator.platform.indexOf("Macintosh") != -1 ||
navigator.platform.indexOf("MacPPC") != -1 ||
navigator.platform.indexOf("MacIntel") != -1);
};
Browser.getWindowsNTVersion = function () {
var matches = navigator.userAgent.match(/Windows NT (\d+\.\d+)/);
var value;
if (matches && matches[1]) {
value = parseFloat(matches[1]);
}
return value || 0;
};
Browser.getOSXVersion = function () {
var matches = navigator.userAgent.match(/Mac OS X (\d+\.\d+)/);
var value;
if (matches && matches[1]) {
value = parseFloat(matches[1]);
}
return value || 0;
};
Browser.isMacPPC = function () {
return navigator.userAgent.indexOf('PPC Mac') != -1;
};
Browser.getFirefoxVersion = function () {
if (YAHOO.env.ua.gecko > 0) {
switch (YAHOO.env.ua.gecko) {
case 1.7: return 1.0;
case 1.8: return 1.5;
case 1.81: return 2.0;
case 1.9: return 3.0;
case 1.91: return 3.5;
case 1.92: return 3.6;
case 1.93: return 3.7;
case 2.0: return 4.0;
default: return YAHOO.env.ua.gecko;
}
}
return 0;
};
Browser.isFirefox = function () {
return (Browser.getFirefoxVersion() > 0);
};
Browser.isIE = function () {
return (YAHOO.env.ua.ie > 0);
};
Browser.getIEDocMode = function () {
return (document.documentMode ? document.documentMode : 0);
};
Browser.isChrome = function () {
return (YAHOO.env.ua.chrome > 0);
};
Browser.isChromeOS = function () {
return (window.navigator.userAgent.indexOf('CrOS') > -1);
};
Browser.getChromeVersion = function () {
return YAHOO.env.ua.chrome;
};
Browser.isMobile = function () {
return (YAHOO.env.ua.mobile != null);
};
Browser.isIOS = function () {
return (Browser.getIOSVersion() > 0);
};
Browser.getIOSVersion = function () {
return YAHOO.env.ua.ios;
};
Browser.isAndroid = function () {
return (YAHOO.env.ua.android > 0);
};
Browser.isTouchDevice = function () {
return SUPPORT_TOUCH;
};
Browser.isOnlyTouchDevice = function () {
return SUPPORT_ONLY_TOUCH;
};
Browser.supportsSVG = function () {
return document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1');
};
Browser.supportsAudioOGG = function () {
if (Browser.isIOS() || Browser.isAndroid()) {
return false;
} else if (Browser.isChrome() || Browser.isFirefox()) {
return true;
} else {
return false;
}
};
Browser.supportsModifierKeys = function () {
return !Browser.isIOS();
};
Browser.isSecure = function () {
var clientSideCheck = (navigator.userAgent.indexOf('AIRSecureBrowser') != -1 ||
navigator.userAgent.indexOf('AIRMobile') != -1);
var serverSideCheck = (typeof TDS == 'object' && typeof TDS.BrowserInfo == 'object') ? TDS.BrowserInfo.isSecure : false;
var extensionCheck = window.AIRSecureBrowserExtension ? true : false;
var chromeAppCheck = YUD.hasClass(document.body, 'browser_airsecurebrowser');
return clientSideCheck || serverSideCheck || extensionCheck || chromeAppCheck;
};
Browser.getSecureVersion = function () {
var numberfy = function (s) {
var c = 0;
return parseFloat(s.replace(/\./g, function () {
return (c++ == 1) ? '' : '.';
}));
};
var ua = navigator.userAgent;
var ma = ua.match(/AIRSecureBrowser\/([^\s\)]*)/);
if (ma && ma[1]) {
return numberfy(ma[1]);
}
ma = ua.match(/AIRMobile[SecureBrowser]*\/([^\s\)]*)/);
if (ma && ma[1]) {
return numberfy(ma[1]);
}
return 0;
};
Browser.getFlashVersion = function () {
return parseFloat(FlashDetect.major + '.' + FlashDetect.minor);
};
Browser.resolveUrl = function (url, root) {
url = url || '';
root = root || document;
url = url.replace(/&amp;/g, '&');
url = url.split('&').join('&amp;').split('<').join('&lt;').split('"').join('&quot;');
var el = root.createElement('div');
el.innerHTML = '<a href="' + url + '">x</a>';
return el.firstChild.href;
};
Browser.requestFullScreen = function (elem) {
if (!elem) {
elem = document.body;
}
if (elem.webkitRequestFullScreen) {
YUD.addClass(elem, 'fullScreenMode');
elem.webkitRequestFullScreen();
elem.addEventListener('webkitfullscreenchange', function () {
if (!document.webkitIsFullScreen) {
YUD.removeClass(elem, 'fullScreenMode');
removeEventListener(this);
}
});
}
else {
return;
}
};
Util.Browser = Browser;
})(Util);

/* SOURCE FILE: util_browser_feature.js (dc39706e) 9/9/2014 2:09:05 PM */

(function(Browser) {
var lookup = {};
function add(name, fn) {
lookup[name] = fn;
}
function parseFeature(str) {
var data = str.split('(');
var name = data[0];
var version = data[1] ? (data[1].replace(')', '') * 1) : 0;
return {
name: name,
version: version
};
}
function parseFeatures(str) {
var features = [];
var groups = str.split('|');
for (var i = 0; i < groups.length; i++) {
features.push(parseFeature(groups[i]));
}
return features;
}
function checkSupported(feature) {
if (lookup[feature.name]) {
return lookup[feature.name](feature);
} else {
return false;
}
}
function supports(data) {
var features;
if (YAHOO.lang.isString(data)) {
features = parseFeatures(data);
} else if (YAHOO.lang.isArray(data)) {
features = data;
} else {
throw new Error('Invalid data provided for checking supported features.');
}
var supported = [];
var unsupported = [];
for (var i = 0; i < features.length; i++) {
var feature = features[i];
if (YAHOO.lang.isString(feature)) {
feature = {
name: feature,
version: 0
};
}
if (checkSupported(feature)) {
supported.push(feature.name);
} else {
unsupported.push(feature.name);
}
}
return {
supported: supported,
unsupported: unsupported
};
}
Browser.Feature = {
add: add,
supports: supports
};
})(Util.Browser);
(function(Feature) {
Feature.add('Flash', function(feature) {
var flashVer = Util.Browser.getFlashVersion();
return (flashVer >= feature.version);
});
Feature.add('SVG', function(feature) {
return Util.Browser.supportsSVG();
});
Feature.add('Audio', function(feature) {
return soundManager.canPlayMIME('audio/ogg') ||
soundManager.canPlayMIME('audio/m4a');
});
Feature.add('Recorder', function(feature) {
var recorder = TDS.SecureBrowser.getRecorder();
return recorder != null;
});
})(Util.Browser.Feature);

/* SOURCE FILE: util_cookies.js (7f2b939b) 9/9/2014 2:09:05 PM */

Util.Browser.createCookie = function(name, value, days) {
var expires;
if (days) {
var date = new Date();
date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
expires = "; expires=" + date.toGMTString();
} else {
expires = "";
}
document.cookie = name + "=" + value + expires + "; path=/";
};
Util.Browser.readCookie = function(name) {
var nameEQ = name + "=";
var ca = document.cookie.split(';');
for (var i = 0; i < ca.length; i++) {
var c = ca[i];
while (c.charAt(0) == ' ') {
c = c.substring(1, c.length);
}
if (c.indexOf(nameEQ) == 0) {
return c.substring(nameEQ.length, c.length);
}
}
return null;
};
Util.Browser.eraseCookie = function(name) {
this.createCookie(name, "", -1);
};
Util.Browser.clearCookies = function() {
var cookies = document.cookie.split(";");
for (var i = 0; i < cookies.length; i++) {
var cookieName = cookies[i].split("=")[0];
Util.Browser.eraseCookie(cookieName);
}
};

/* SOURCE FILE: util_java.js (47e36526) 9/9/2014 2:09:05 PM */

Util.Browser._getJREVersion = function(runApplet, codebase) {
var plugin = (navigator.mimeTypes && navigator.mimeTypes["application/x-java-applet"]) ? navigator.mimeTypes["application/x-java-applet"].enabledPlugin : 0;
if (!plugin) {
return -2;
}
var version = 0;
for (var i = 1; i < 7; i++) {
if (navigator.mimeTypes["application/x-java-applet;version=1." + i]) {
version = "1." + i;
for (var j = 1; j < 4; j++) {
if (navigator.mimeTypes["application/x-java-applet;version=1." + i + "." + j]) {
version = "1." + i + "." + j;
}
}
}
}
if (runApplet) {
var loadJREVersion = function() {
var applet = document.getElementById('DetectPluginApplet');
if (applet == null) {
var container = document.createElement('div');
container.style.visibility = "hidden";
container.innerHTML = '<applet id="DetectPluginApplet" name="DetectPluginApplet" code="DetectPluginApplet.class" codebase="' + codebase + '"></applet>';
try {
document.body.appendChild(container);
} catch(ex) {
return false;
}
}
applet = document.getElementById('DetectPluginApplet');
if (applet == null) {
return false;
}
try {
version = applet.getJREVersion();
} catch(ex) {
return false;
}
return true;
};
var loaded = loadJREVersion();
if (!loaded && Util.Browser.isWindows()) {
return -3;
}
}
return parseFloat(version);
};
Util.Browser.getJREVersion = function(runApplet, codebase) {
codebase = codebase || '../Shared/Applets/Utilities/';
try {
return this._getJREVersion(runApplet, codebase);
} catch(e) {
return -1;
}
};
Util.Browser.getJREVersionAsync = function(callback) {
var success = callback.success || function() {};
var failure = callback.failure || function() {};
var timeout = callback.timeout || 60000;
var codebase = callback.codebase || '../Shared/Applets/Utilities/';
var plugin = (navigator.mimeTypes && navigator.mimeTypes["application/x-java-applet"]) ?
navigator.mimeTypes["application/x-java-applet"].enabledPlugin : 0;
if (!plugin) {
failure(-2);
return false;
}
var getPluginVersion = function() {
var version = -1;
for (var i = 1; i < 7; i++) {
if (navigator.mimeTypes["application/x-java-applet;version=1." + i]) {
version = "1." + i;
for (var j = 1; j < 4; j++) {
if (navigator.mimeTypes["application/x-java-applet;version=1." + i + "." + j]) {
version = "1." + i + "." + j;
}
}
}
}
return parseFloat(version);
};
var getJREVersion = function() {
var version = -1;
var applet = document.getElementById('DetectPluginApplet');
if (applet == null) {
var container = document.createElement('div');
container.style.visibility = "hidden";
container.innerHTML = '<applet id="DetectPluginApplet" name="DetectPluginApplet" code="DetectPluginApplet.class" codebase="' + codebase + '"></applet>';
try {
document.body.appendChild(container);
} catch(ex) {
return version;
}
}
applet = document.getElementById('DetectPluginApplet');
if (applet == null) {
return version;
}
try {
version = applet.getJREVersion();
} catch(ex) {
return version;
}
return parseFloat(version);
};
var jreVersion = -1;
var pollCondition = function() {
jreVersion = getJREVersion();
return (jreVersion > -1);
};
var pollSuccess = function() {
success({ applet: jreVersion, plugin: getPluginVersion() });
};
var pollStart = function() {
var conditionalDelay = new Util.ConditionalDelay(pollCondition);
conditionalDelay.onSuccess.subscribe(function() {
pollSuccess();
});
conditionalDelay.onFailure.subscribe(function() {
failure(-3);
});
conditionalDelay.start(250, timeout);
};
setTimeout(function() {
if (pollCondition()) {
pollSuccess();
} else {
pollStart();
}
}, 0);
return true;
};

/* SOURCE FILE: util_querystring.js (a12fa7a7) 9/9/2014 2:09:05 PM */

Util.QueryString = {};
Util.QueryString.reload = function(obj)
{
var currentUrl = window.location.href;
var currentQS = window.location.search;
var newQS = '?' + Util.QueryString.stringify(obj);
if (currentQS.length > 0)
{
currentUrl = currentUrl.replace(currentQS, newQS);
}
else
{
currentUrl = currentUrl + newQS;
}
window.location = currentUrl;
};
(function()
{
var QueryString = {},
stack = [],
L = YAHOO.lang;
QueryString.escape = encodeURIComponent;
QueryString.stringify = function(obj, c, name)
{
var begin, end, i, l, n, s,
sep = c && c.sep ? c.sep : "&",
eq = c && c.eq ? c.eq : "=",
aK = c && c.arrayKey ? c.arrayKey : false;
if (L.isNull(obj) || L.isUndefined(obj) || L.isFunction(obj))
{
return name ? QueryString.escape(name) + eq : '';
}
if (L.isBoolean(obj) || Object.prototype.toString.call(obj) === '[object Boolean]')
{
obj = obj.toString();
}
if (L.isNumber(obj) || L.isString(obj))
{
return QueryString.escape(name) + eq + QueryString.escape(obj);
}
if (L.isArray(obj))
{
s = [];
name = aK ? name + '[]' : name;
l = obj.length;
for (i = 0; i < l; i++)
{
s.push(QueryString.stringify(obj[i], c, name));
}
return s.join(sep);
}
for (i = stack.length - 1; i >= 0; --i)
{
if (stack[i] === obj)
{
throw new Error("QueryString.stringify. Cyclical reference");
}
}
stack.push(obj);
s = [];
begin = name ? name + '[' : '';
end = name ? ']' : '';
for (i in obj)
{
if (obj.hasOwnProperty(i))
{
n = begin + i + end;
s.push(QueryString.stringify(obj[i], c, n));
}
}
stack.pop();
s = s.join(sep);
if (!s && name)
{
return name + "=";
}
return s;
};
var pieceParser = function(eq)
{
return function parsePiece(key, val)
{
var sliced, numVal, head, tail, ret;
if (arguments.length !== 2)
{
key = key.split(eq);
return parsePiece(
QueryString.unescape(key.shift()),
QueryString.unescape(key.join(eq))
);
}
key = key.replace(/^\s+|\s+$/g, '');
if (L.isString(val))
{
val = val.replace(/^\s+|\s+$/g, '');
if (!isNaN(val))
{
numVal = +val;
if (val === numVal.toString(10))
{
val = numVal;
}
}
}
sliced = /(.*)\[([^\]]*)\]$/.exec(key);
if (!sliced)
{
ret = {};
if (key)
{
ret[key] = val;
}
return ret;
}
tail = sliced[2];
head = sliced[1];
if (!tail)
{
return parsePiece(head, [val]);
}
ret = {};
ret[tail] = val;
return parsePiece(head, ret);
};
};
var mergeParams = function(params, addition)
{
return (
(!params) ? addition
: (L.isArray(params)) ? params.concat(addition)
: (!L.isObject(params) || !L.isObject(addition)) ? [params].concat(addition)
: mergeObjects(params, addition)
);
};
var mergeObjects = function(params, addition)
{
for (var i in addition)
{
if (i && addition.hasOwnProperty(i))
{
params[i] = mergeParams(params[i], addition[i]);
}
}
return params;
};
QueryString.parse = function(qs, sep, eq)
{
if (qs == null) qs = window.location.search.substring(1);
if (qs == null || qs.length == 0) return {};
return Util.Array.reduce(
Util.Array.map(
qs.split(sep || "&"),
pieceParser(eq || "=")
),
{},
mergeParams
);
};
QueryString.unescape = function(s)
{
return decodeURIComponent(s.replace(/\+/g, ' '));
};
Util.QueryString = QueryString;
})();

/* SOURCE FILE: util_mobile.js (df9d80d7) 9/9/2014 2:09:05 PM */

Util.Mobile = {};
(function(YAHOO) {
if (typeof YAHOO.util.DragDropMgr != 'object' || !Util.Browser.isTouchDevice()) {
return;
}
var Event = YAHOO.util.Event;
var DDM = YAHOO.util.DragDropMgr;
var DD = YAHOO.util.DragDrop;
var fixEvent = function(origFunc) {
return (function() {
var args = Array.prototype.slice.call(arguments, 0);
args[0] = Util.Event.normalize(args[0]);
origFunc.apply(this, args);
});
};
DDM.handleMouseDown = fixEvent(DDM.handleMouseDown);
DDM.handleMouseMove = fixEvent(DDM.handleMouseMove);
DDM.handleMouseUp = fixEvent(DDM.handleMouseUp);
DD.prototype.handleMouseDown = fixEvent(DD.prototype.handleMouseDown);
YUE.removeListener(DDM._shim, 'mouseup', DDM.handleMouseUp, DDM, true);
YUE.removeListener(DDM._shim, 'mousemove', DDM.handleMouseMove, DDM, true);
YUE.addListener(DDM._shim, 'touchend', DDM.handleMouseUp, DDM, true);
YUE.addListener(DDM._shim, 'touchstart', DDM.handleMouseMove, DDM, true);
YUE.removeListener(document, 'mouseup', DDM.handleMouseUp, DDM, true);
YUE.removeListener(document, 'mousemove', DDM.handleMouseMove, DDM, true);
YUE.addListener(document, 'touchend', DDM.handleMouseUp, DDM, true);
YUE.addListener(document, 'touchmove', DDM.handleMouseMove, DDM, true);
var replaceFunc = function(origFunc, newFunc) {
return (function() {
origFunc.apply(this, arguments);
newFunc.apply(this, arguments);
});
};
DD.prototype.init = replaceFunc(DD.prototype.init, function() {
YUE.removeListener(this._domRef || this.id, 'mousedown', this.handleMouseDown, this, true);
YUE.addListener(this._domRef || this.id, 'touchstart', this.handleMouseDown, this, true);
});
DD.prototype.setOuterHandleElId = replaceFunc(DD.prototype.setOuterHandleElId, function() {
YUE.removeListener(this.handleElId, 'mousedown', this.handleMouseDown, this, true);
YUE.addListener(this.handleElId, 'touchstart', this.handleMouseDown, this, true);
});
DD.prototype.unreg = replaceFunc(DD.prototype.unreg, function() {
YUE.removeListener(this.id, 'touchstart', this.handleMouseDown);
});
})(YAHOO);
(function(YAHOO) {
if (typeof YAHOO.widget.MenuManager != 'object' || !Util.Browser.isTouchDevice()) {
return;
}
var fixListener = function(obj, type, listener) {
YUE.removeListener(obj, listener.type, listener.fn);
YUE.on(document, type, function(ev) {
ev = Util.Event.normalize(ev);
ev = Util.Object.clone(ev);
ev.type = listener.type;
listener.fn.call(this, ev);
});
};
var fixMenuManager = function() {
var menu = new YAHOO.widget.Menu();
YAHOO.widget.MenuManager.addMenu(menu);
YAHOO.widget.MenuManager.removeMenu(menu);
var docListeners = YUE.getListeners(document);
if (docListeners == null) {
return;
}
for (var i = 0; i < docListeners.length; i++) {
var docListener = docListeners[i];
if (docListener.obj == YAHOO.widget.MenuManager) {
if (docListener.type == 'mousedown') {
fixListener(document, 'touchstart', docListener);
} else if (docListener.type == 'mouseup') {
fixListener(document, 'touchend', docListener);
} else if (docListener.type == 'click') {
fixListener(document, 'touchstart', docListener);
}
}
}
};
YUE.onDOMReady(fixMenuManager);
})(YAHOO);
(function(YAHOO) {
var DD = YAHOO.util.DD;
var DDM = YAHOO.util.DragDropMgr;
function drawBox(id, x, y, h, w) {
var el = document.getElementById(id);
if (el == null) {
el = document.createElement('box');
el.setAttribute('id', id);
el.style.position = 'absolute';
el.style.border = '3px solid red';
el.style.zIndex = '99999';
el.style.pointerEvents = 'none';
document.body.appendChild(el);
}
el.style.left = x + 'px';
el.style.top = y + 'px';
el.style.height = h + 'px';
el.style.width = w + 'px';
}
function removeBox(id) {
var el = document.getElementById(id);
if (el == null) {
Util.Dom.removeNode(el);
}
}
function getElDoc(element) {
return (element['nodeType'] === 9) ? element :
element['ownerDocument'] ||
element.document ||
document;
}
function docScrollX(node, doc) {
doc = doc || (node) ? getElDoc(node) : document;
var dv = doc.defaultView,
pageOffset = (dv) ? dv.pageXOffset : 0;
return Math.max(doc['documentElement'].scrollLeft, doc.body.scrollLeft, pageOffset);
}
function docScrollY(node, doc) {
doc = doc || (node) ? getElDoc(node) : document;
var dv = doc.defaultView,
pageOffset = (dv) ? dv.pageYOffset : 0;
return Math.max(doc['documentElement'].scrollTop, doc.body.scrollTop, pageOffset);
}
function getScrollLeft(node) {
return ('scrollLeft' in node) ? node.scrollLeft : docScrollX(node);
}
function getScrollTop(node) {
return ('scrollTop' in node) ? node.scrollTop : docScrollY(node);
}
DD.prototype.setScrollBuffer = function (value) {
this._scrollBuffer = value;
}
DD.prototype.getScrollBuffer = function () {
return this._scrollBuffer || 20;
}
DD.prototype.setScrollDelay = function (value) {
this._scrollDelay = value;
}
DD.prototype.getScrollDelay = function () {
return this._scrollDelay || 150;
}
DD.prototype.setScrollDirection = function (horizontal, vertical) {
this._scrollHorizontal = horizontal;
this._scrollVertical = vertical;
}
DD.prototype.isScrollHorizontal = function () {
return this._scrollHorizontal || false;
}
DD.prototype.isScrollVertical = function () {
return this._scrollVertical || false;
}
DD.prototype.isWindowScroll = function() {
return this._parentScroll == null || this._parentScroll == window;
};
DD.prototype.getParentScroll = function() {
return this._parentScroll || window;
};
DD.prototype.setParentScroll = function(element) {
this._parentScroll = element;
};
DD.prototype._getVPRegion = function() {
var el = this.getParentScroll(),
b = this.getScrollBuffer(),
ws = this.isWindowScroll(),
xy = ((ws) ? [] : YUD.getXY(el)),
width = ((ws) ? YUD.getViewportWidth() : el.offsetWidth),
height = ((ws) ? YUD.getViewportHeight() : el.offsetHeight),
top = ((ws) ? getScrollTop(el) : xy[1]),
left = ((ws) ? getScrollLeft(el) : xy[0]);
return {
top: top + b,
right: (width + left) - b,
bottom: (height + top) - b,
left: left + b
};
};
DD.prototype._initScroll = function() {
var scrollDelay = this.getScrollDelay();
this._cancelScroll();
this._scrollTimer = YAHOO.lang.later(scrollDelay, this, this._checkWinScroll, [true], true);
};
DD.prototype._cancelScroll = function() {
if (this._scrollTimer) {
this._scrollTimer.cancel();
delete this._scrollTimer;
}
};
DD.prototype._checkWinScroll = function(move) {
if (this != DDM.dragCurrent) {
this._cancelScroll();
return;
}
var dragEl = this.getDragEl(),
dragHeight = dragEl.offsetHeight,
dragWidth = dragEl.offsetWidth,
dragXY = YUD.getXY(dragEl),
dragBottom = dragXY[1] + dragHeight,
dragTop = dragXY[1],
dragRight = dragXY[0] + dragWidth,
dragLeft = dragXY[0];
var parentRegion = this._getVPRegion(),
parentEl = this.getParentScroll(),
parentScrollTop = getScrollTop(parentEl),
parentScrollLeft = getScrollLeft(parentEl),
ws = this.isWindowScroll(),
scroll = false,
b = this.getScrollBuffer(),
nt = dragTop,
nl = dragLeft,
st = parentScrollTop,
sl = parentScrollLeft;
if (this.isScrollHorizontal()) {
if (dragLeft <= parentRegion.left) {
scroll = true;
nl = dragXY[0] - ((ws) ? b : 0);
sl = parentScrollLeft - b;
}
if (dragRight >= parentRegion.right) {
scroll = true;
nl = dragXY[0] + ((ws) ? b : 0);
sl = parentScrollLeft + b;
}
}
if (this.isScrollVertical()) {
if (dragBottom >= parentRegion.bottom) {
scroll = true;
nt = dragXY[1] + ((ws) ? b : 0);
st = parentScrollTop + b;
}
if (dragTop <= parentRegion.top) {
scroll = true;
nt = dragXY[1] - ((ws) ? b : 0);
st = parentScrollTop - b;
}
}
if (st < 0) {
st = 0;
nt = dragXY[1];
}
if (sl < 0) {
sl = 0;
nl = dragXY[0];
}
if (nt < 0) {
nt = dragXY[1];
}
if (nl < 0) {
nl = dragXY[0];
}
if (move) {
this.alignElWithMouse(dragEl, nl, nt);
if (parentEl == window) {
parentEl.scrollTo(sl, st);
} else {
parentEl.scrollTop = st;
parentEl.scrollLeft = sl;
}
if (!st && !sl) {
this._cancelScroll();
}
} else {
if (scroll) {
this._initScroll();
} else {
this._cancelScroll();
}
}
};
DD.prototype.autoScroll = function(x, y, h, w) {};
DD.prototype.b4Drag = function(e) {
this.setDragElPos(YAHOO.util.Event.getPageX(e), YAHOO.util.Event.getPageY(e));
if (this.scroll) {
if (this._scrollTimer) {
this._cancelScroll();
}
this._checkWinScroll();
}
};
})(YAHOO);

/* SOURCE FILE: util_mozilla.js (5bdb0520) 9/9/2014 2:09:05 PM */

var Mozilla = {};
Mozilla.SecurityPrivilege =
{
Unavailable: 0,
Disabled: 1,
Available: 2
};
Mozilla.UniversalConnect =
{
Unknown: 0,
Denied: 1,
Allowed: 2
};
Mozilla._universalConnect = Mozilla.UniversalConnect.Unknown;
Mozilla._lastException = null;
Mozilla.allowPrivileged = function()
{
try
{
if (typeof netscape == 'object' &&
typeof netscape.security == 'object' &&
typeof netscape.security.PrivilegeManager == 'object') {
return Mozilla.SecurityPrivilege.Available;
}
}
catch (ex)
{
Mozilla._lastException = ex;
var errorMessage = (typeof ex == 'string') ? ex : ex.message;
if (errorMessage.indexOf('Permission denied') != -1)
{
return Mozilla.SecurityPrivilege.Disabled;
}
}
return Mozilla.SecurityPrivilege.Unavailable;
};
Mozilla.execPrivileged = function (callback, browserMinVersion, browserMaxVersion)
{
if (Mozilla._universalConnect == Mozilla.UniversalConnect.Denied) return false;
if (Mozilla._universalConnect == Mozilla.UniversalConnect.Unknown)
{
var securityPrivilege = Mozilla.allowPrivileged();
if (securityPrivilege == Mozilla.SecurityPrivilege.Unavailable)
{
Mozilla._universalConnect = Mozilla.UniversalConnect.Denied;
return false;
}
}
var minBrowser = YAHOO.lang.isNumber(browserMinVersion) ? browserMinVersion : -1;
var maxBrowser = YAHOO.lang.isNumber(browserMaxVersion) ? browserMaxVersion : -1;
if (minBrowser > 0 && Util.Browser.getFirefoxVersion() <= minBrowser ||
maxBrowser > 0 && Util.Browser.getFirefoxVersion() >= maxBrowser)
return false;
try
{
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
Mozilla._universalConnect = Mozilla.UniversalConnect.Allowed;
}
catch (ex)
{
Mozilla._lastException = ex;
Mozilla._universalConnect = Mozilla.UniversalConnect.Denied;
return false;
}
if (typeof (callback) == 'function') callback();
return true;
};
Mozilla.getPreference = function(name)
{
var value;
Mozilla.execPrivileged(function()
{
value = Mozilla.preference(name);
});
return value;
};
Mozilla.setPreference = function (name, value, browserMinVersion, browserMaxVersion)
{
var success = false;
Mozilla.execPrivileged(function()
{
Mozilla.preference(name, value);
success = true;
}, browserMinVersion, browserMaxVersion);
return success;
};
Mozilla.enableCaretMode = function(enable)
{
var allowed = Mozilla.execPrivileged(function()
{
if (typeof (enable) == 'undefined')
{
enable = !Mozilla.getPreference('accessibility.browsewithcaret');
}
Mozilla.setPreference('accessibility.warn_on_browsewithcaret', false);
Mozilla.setPreference('accessibility.browsewithcaret', enable);
});
return (allowed && enable);
};
Mozilla.inCaretMode = function()
{
return Mozilla.getPreference('accessibility.browsewithcaret');
};
Mozilla.enableTabFocus = function()
{
return Mozilla.setPreference('accessibility.tabfocus', 7);
};
Mozilla.preference = function(name, value)
{
if (typeof (navigator) == 'object' &&
typeof (navigator.preference) == 'function')
{
return navigator.preference(name, value);
}
var rv;
if (typeof (Components) != 'object' ||
typeof (Components.classes) != 'object') return rv;
var prefService = Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefService);
var prefBranch = prefService.getBranch('');
if (YAHOO.lang.isUndefined(value))
{
var prefType = prefBranch.getPrefType(name);
switch (prefType)
{
case prefBranch.PREF_STRING: rv = prefBranch.getCharPref(name); break;
case prefBranch.PREF_INT: rv = prefBranch.getIntPref(name); break;
case prefBranch.PREF_BOOL: rv = prefBranch.getBoolPref(name); break;
default: return null;
}
}
else
{
if (YAHOO.lang.isString(value)) rv = prefBranch.setCharPref(name, value);
else if (YAHOO.lang.isNumber(value)) rv = prefBranch.setIntPref(name, value);
else if (YAHOO.lang.isBoolean(value)) rv = prefBranch.setBoolPref(name, value);
else if (YAHOO.lang.isNull(value)) rv = prefBranch.deleteBranch(name);
}
return rv;
};
Mozilla.enableScreenshots = function () {
var processEnable1 = Components.classes["@mozilla.org/process/util;1"]
.createInstance(Components.interfaces.nsIProcess);
if (processEnable1 == null) {
return false;
}
var processEnable2 = Components.classes["@mozilla.org/process/util;1"]
.createInstance(Components.interfaces.nsIProcess);
if (processEnable2 == null) {
return false;
}
var fileEnable1 = Components.classes["@mozilla.org/file/local;1"]
.createInstance(Components.interfaces.nsILocalFile);
if (fileEnable1 == null) {
return false;
}
var fileEnable2 = Components.classes["@mozilla.org/file/local;1"]
.createInstance(Components.interfaces.nsILocalFile);
if (fileEnable2 == null) {
return false;
}
try {
fileEnable1.initWithPath("/usr/bin/defaults");
} catch (err) {
return false;
}
try {
fileEnable2.initWithPath("/usr/bin/killall");
} catch (err) {
return false;
}
try {
processEnable1.init(fileEnable1);
} catch (err) {
return false;
}
var args = [];
args.push("write");
args.push("com.apple.screencapture");
args.push("location");
args.push("~/Desktop");
try {
processEnable1.run(true, args, args.length);
} catch (err) {
return false;
}
try {
processEnable2.init(fileEnable2);
} catch (err) {
return false;
}
args = [];
args.push("SystemUIServer");
try {
processEnable2.run(true, args, args.length);
} catch (err) {
return false;
}
return true;
};
Mozilla.disableScreenshots = function () {
var processDisable1 = Components.classes["@mozilla.org/process/util;1"]
.createInstance(Components.interfaces.nsIProcess);
if (processDisable1 == null) {
return false;
}
var processDisable2 = Components.classes["@mozilla.org/process/util;1"]
.createInstance(Components.interfaces.nsIProcess);
if (processDisable2 == null) {
return false;
}
var fileDisable1 = Components.classes["@mozilla.org/file/local;1"]
.createInstance(Components.interfaces.nsILocalFile);
if (fileDisable1 == null) {
return false;
}
var fileDisable2 = Components.classes["@mozilla.org/file/local;1"]
.createInstance(Components.interfaces.nsILocalFile);
if (fileDisable2 == null) {
return false;
}
try {
fileDisable1.initWithPath("/usr/bin/defaults");
} catch (err) {
return false;
}
try {
fileDisable2.initWithPath("/usr/bin/killall");
} catch (err) {
return false;
}
try {
processDisable1.init(fileDisable1);
} catch (err) {
return false;
}
var args = [];
args.push("write");
args.push("com.apple.screencapture");
args.push("location");
args.push("/tmp");
try {
processDisable1.run(true, args, args.length);
} catch (err) {
return false;
}
try {
processDisable2.init(fileDisable2);
} catch (err) {
return false;
}
args = [];
args.push("SystemUIServer");
try {
processDisable2.run(true, args, args.length);
} catch (err) {
return false;
}
return true;
};
(function (Mozilla, Components) {
function getWindowMediator() {
return Components.classes["@mozilla.org/appshell/window-mediator;1"].getService(Components.interfaces.nsIWindowMediator);
}
function getRecentWindow() {
var wm = getWindowMediator();
return wm.getMostRecentWindow("navigator:browser");
}
Mozilla.fullscreen = function () {
try {
return Mozilla.execPrivileged(function () {
var win = getRecentWindow();
if (win) {
win.moveTo(0, 0);
win.resizeTo(screen.width, screen.height);
win.BrowserFullScreen();
}
});
} catch (ex) {
return false;
}
};
Mozilla.moveWindowTo = function (x, y) {
try {
return Mozilla.execPrivileged(function () {
var win = getRecentWindow();
if (win) {
win.moveTo(x, y);
}
});
} catch (ex) {
return false;
}
};
Mozilla.resizeWindowTo = function (width, height) {
try {
return Mozilla.execPrivileged(function () {
var win = getRecentWindow();
if (win) {
win.resizeTo(width, height);
}
});
} catch (ex) {
return false;
}
};
})(window.Mozilla, window.Components);

/* SOURCE FILE: util_statistics.js (0de98978) 9/9/2014 2:09:05 PM */

Util.Statistics =
{
MACHEP: 1.11022302462515654042E-16,
MAXLOG: 7.09782712893383996732E2,
MINLOG: -7.451332191019412076235E2,
MAXGAM: 171.624376956302725,
SQTPI: 2.50662827463100050242E0,
SQRTH: 7.07106781186547524401E-1,
LOGPI: 1.14472988584940017414
};
Util.Statistics.poisson = function(k        , x           )
{
if (k < 0 || x < 0) return 0.0;
return Util.Statistics.igamc((k + 1), x);
};
Util.Statistics.poissonc = function(k        , x           )
{
if (k < 0 || x < 0) return 0.0;
return Util.Statistics.igam((k + 1), x);
};
Util.Statistics.igamc = function(a           , x           )
{
var big = 4.503599627370496e15;
var biginv = 2.22044604925031308085e-16;
var ans, ax, c, yc, r, t, y, z;
var pk, pkm1, pkm2, qk, qkm1, qkm2;
if (x <= 0 || a <= 0) return 1.0;
if (x < 1.0 || x < a) return 1.0 - Util.Statistics.igam(a, x);
ax = a * Math.log(x) - x - Util.Statistics.lgamma(a);
if (ax < -Util.Statistics.MAXLOG) return 0.0;
ax = Math.exp(ax);
y = 1.0 - a;
z = x + y + 1.0;
c = 0.0;
pkm2 = 1.0;
qkm2 = x;
pkm1 = x + 1.0;
qkm1 = z * x;
ans = pkm1 / qkm1;
do
{
c += 1.0;
y += 1.0;
z += 2.0;
yc = y * c;
pk = pkm1 * z - pkm2 * yc;
qk = qkm1 * z - qkm2 * yc;
if (qk != 0)
{
r = pk / qk;
t = Math.abs((ans - r) / r);
ans = r;
}
else
t = 1.0;
pkm2 = pkm1;
pkm1 = pk;
qkm2 = qkm1;
qkm1 = qk;
if (Math.abs(pk) > big)
{
pkm2 *= biginv;
pkm1 *= biginv;
qkm2 *= biginv;
qkm1 *= biginv;
}
} while (t > Util.Statistics.MACHEP);
return ans * ax;
};
Util.Statistics.lgamma = function(x           )
{
var p, q, w, z;
var A = [
8.11614167470508450300E-4,
-5.95061904284301438324E-4,
7.93650340457716943945E-4,
-2.77777777730099687205E-3,
8.33333333333331927722E-2
];
var B = [
-1.37825152569120859100E3,
-3.88016315134637840924E4,
-3.31612992738871184744E5,
-1.16237097492762307383E6,
-1.72173700820839662146E6,
-8.53555664245765465627E5
];
var C = [
-3.51815701436523470549E2,
-1.70642106651881159223E4,
-2.20528590553854454839E5,
-1.13933444367982507207E6,
-2.53252307177582951285E6,
-2.01889141433532773231E6
];
if (x < -34.0)
{
q = -x;
w = Util.Statistics.lgamma(q);
p = Math.floor(q);
if (p == q) throw new Error("lgam: Overflow");
z = q - p;
if (z > 0.5)
{
p += 1.0;
z = p - q;
}
z = q * Math.sin(Math.PI * z);
if (z == 0.0) throw new Error("lgamma: Overflow");
z = Util.Statistics.LOGPI - Math.log(z) - w;
return z;
}
if (x < 13.0)
{
z = 1.0;
while (x >= 3.0)
{
x -= 1.0;
z *= x;
}
while (x < 2.0)
{
if (x == 0.0) throw new Error("lgamma: Overflow");
z /= x;
x += 1.0;
}
if (z < 0.0) z = -z;
if (x == 2.0) return Math.log(z);
x -= 2.0;
p = x * Util.Statistics.polevl(x, B, 5) / Util.Statistics.p1evl(x, C, 6);
return (Math.log(z) + p);
}
if (x > 2.556348e305) throw new Error("lgamma: Overflow");
q = (x - 0.5) * Math.log(x) - x + 0.91893853320467274178;
if (x > 1.0e8) return (q);
p = 1.0 / (x * x);
if (x >= 1000.0)
q += ((7.9365079365079365079365e-4 * p
- 2.7777777777777777777778e-3) * p
+ 0.0833333333333333333333) / x;
else
q += Util.Statistics.polevl(p, A, 4) / x;
return q;
};
Util.Statistics.igam = function(a           , x           )
{
var ans, ax, c, r;
if (x <= 0 || a <= 0) return 0.0;
if (x > 1.0 && x > a) return 1.0 - Util.Statistics.igamc(a, x);
ax = a * Math.log(x) - x - Util.Statistics.lgamma(a);
if (ax < -Util.Statistics.MAXLOG) return (0.0);
ax = Math.exp(ax);
r = a;
c = 1.0;
ans = 1.0;
do
{
r += 1.0;
c *= x / r;
ans += c;
} while (c / ans > Util.Statistics.MACHEP);
return (ans * ax / a);
};
Util.Statistics.polevl = function(x           , coef             , N        )
{
var ans;
ans = coef[0];
for (var i = 1; i <= N; i++)
{
ans = ans * x + coef[i];
}
return ans;
};
Util.Statistics.p1evl = function(x           , coef             , N        )
{
var ans;
ans = x + coef[0];
for (var i = 1; i < N; i++)
{
ans = ans * x + coef[i];
}
return ans;
};

/* SOURCE FILE: util_network.js (a3b129f7) 9/9/2014 2:09:05 PM */

Util.Network = {};
Util.Network.BandWidthTester = function (config) {
this.sizeOfRequestinBytes = (typeof config.requestSizeinKiloBytes == 'number') ? config.requestSizeinKiloBytes * 1024 : 1;
this.iterCount = (typeof config.numIterations == 'number') ? config.numIterations : 1;
this.callBack = (typeof config.callBack == 'function') ? config.callBack : null;
this.url = (typeof config.url == 'string') ? config.url : 'Pages/API/Diagnostics.axd?size=' + this.sizeOfRequestinBytes;
this.alternateGETPOST = (typeof config.alternateGETPOST == 'boolean') ? config.alternateGETPOST : false;
this.latencyOffsetinms = (typeof config.latencyOffsetinms == 'number') ? config.latencyOffsetinms : 0;
this.downloadurl = (typeof config.downloadurl == 'string') ? config.downloadurl : this.url;
this.sizeOfDownloadRequestinBytes = this.sizeOfRequestinBytes;
this.sizeOfUploadRequestinBytes = 1000000;
this.uploadurl = (typeof config.uploadurl == 'string') ? config.uploadurl : 'Pages/API/Diagnostics.axd?size=' + this.sizeOfUploadRequestinBytes; ;
this.generateUploadData = (typeof config.generateUploadData == 'boolean') ? config.generateUploadData : false;
this.callBackScope = (typeof config.callBackScope == 'object') ? config.callBackScope : this;
this._currentStartTime = undefined;
this._currentMode = 'GET';
this._currenData = null;
this._modeStats = [];
this._modeStats['GET'] = { iterations: 0, successful: 0, aveLineSpeed: 0, aveTransactionTime: 0, minDelay: -1, maxDelay: -1, minLineSpeed: -1, maxLineSpeed: -1, rawResults: [] };
this._modeStats['POST'] = { iterations: 0, successful: 0, aveLineSpeed: 0, aveTransactionTime: 0, minDelay: -1, maxDelay: -1, minLineSpeed: -1, maxLineSpeed: -1, rawResults: [] };
this._YUIcallBack = { success: this._success, failure: this._failure, cache: false, scope: this };
};
Util.Network.BandWidthTester.prototype.run = function ()
{
var statsData = this._modeStats[this._currentMode];
if (statsData.iterations > this.iterCount) {
if (this.callBack != null)
this.callBack.call(this.callBackScope, this._modeStats);
return;
}
if (this.generateUploadData || this._currenData == null) {
var tmpArray = [];
for (var i = 0; i < this.sizeOfUploadRequestinBytes; i++) tmpArray.push('a');
this._currenData = tmpArray.join("");
}
this._currentStartTime = (new Date()).getTime();
if (this._currentMode == 'GET') {
YAHOO.util.Connect.asyncRequest('GET', this.downloadurl, this._YUIcallBack, null);
} else {
if (this._currenData != null && this._currenData.length >= this.sizeOfUploadRequestinBytes) {
YAHOO.util.Connect.asyncRequest('POST', this.uploadurl, this._YUIcallBack, this._currenData);
} else {
this._checkPoint(-1);
}
}
};
Util.Network.BandWidthTester.prototype._checkPoint = function(lineSpeed, transactionTime) {
var statsData = this._modeStats[this._currentMode];
statsData.iterations++;
if (lineSpeed > 0) {
statsData.successful++;
statsData.aveLineSpeed = (statsData.aveLineSpeed * (statsData.iterations - 1) + lineSpeed) / statsData.iterations;
statsData.aveTransactionTime = (statsData.aveTransactionTime * (statsData.iterations - 1) + transactionTime) / statsData.iterations;
if (statsData.minLineSpeed < 0 || statsData.minLineSpeed > lineSpeed) statsData.minLineSpeed = lineSpeed;
if (statsData.maxLineSpeed < 0 || statsData.maxLineSpeed < lineSpeed) statsData.maxLineSpeed = lineSpeed;
if (typeof transactionTime == 'number') {
if (statsData.minDelay < 0 || statsData.minDelay > transactionTime) statsData.minDelay = transactionTime;
if (statsData.maxDelay < 0 || statsData.maxDelay < transactionTime) statsData.maxDelay = transactionTime;
}
}
statsData.rawResults.push(lineSpeed);
if (this.alternateGETPOST || (statsData.iterations > this.iterCount)) {
this._currentMode = (this._currentMode == 'GET') ? 'POST' : 'GET';
}
statsData = this._modeStats[this._currentMode];
if (statsData.iterations >= this.iterCount) {
if (this.callBack && typeof this.callBack == 'function') this.callBack.call(this.callBackScope, this._modeStats);
} else {
this.run();
}
};
Util.Network.BandWidthTester.prototype._success = function (o) {
var endtime = (new Date()).getTime();
var millitime = (endtime - this._currentStartTime) + this.latencyOffsetinms;
var downloadtimeinSecs = millitime / 1000;
var linespeed = 0;
if (this._currentMode == 'GET') {
linespeed = this.sizeOfDownloadRequestinBytes / 1000 / downloadtimeinSecs;
} else if (this._currentMode == 'POST') {
linespeed = this.sizeOfUploadRequestinBytes / 1000 / downloadtimeinSecs;
}
if (!this.generateUploadData) this._currenData = o.responseText;
this._checkPoint(linespeed, millitime);
};
Util.Network.BandWidthTester.prototype._failure = function(o)
{
this._checkPoint(-1);
};
Util.Network.CapacityCalculator = function(config)
{
this._veryLow = .999;
this._moderate = .85;
this._high = .6;
this._risk = 'Unknown';
this._probability = 0.0;
this._recommendedNumber = -1;
};
Util.Network.CapacityCalculator.prototype.GetRisk = function()
{
return this._risk;
};
Util.Network.CapacityCalculator.prototype.GetRecommendedStudentCount = function()
{
return this._recommendedNumber;
};
Util.Network.CapacityCalculator.prototype.ProbabilityWithinCapacity = function(goodput, itemsize, students, responseTime)
{
var maxItems = this._MaxItemsPerSecond(goodput, itemsize);
this._probability = this._ProbabilityWithinCapacity_1(students, responseTime, maxItems);
this._risk = this._CalculateRisk(students);
switch (this._risk)
{
case 'High':
case 'NearCertain':
this._recommendedNumber = this._RecommendNumber(students, responseTime, maxItems);
break;
}
return this._probability;
};
Util.Network.CapacityCalculator.prototype._MaxItemsPerSecond = function(goodput, itemSize)
{
return goodput * 1000 / itemSize;
};
Util.Network.CapacityCalculator.prototype._ProbabilityWithinCapacity_1 = function(students, responseTime, maxItems)
{
var probability=0.0;
var max1 = Math.floor(maxItems);
if (max1 > 0) probability = this._ProbabilityWithinCapacityPerSecond_1(students, responseTime, max1);
else probability = this._ProbabilityBelowEquilibrium(students, responseTime, maxItems);
return probability;
};
Util.Network.CapacityCalculator.prototype._ProbabilityWithinCapacityPerSecond_1 = function(students, respTime, maxItems)
{
return Util.Statistics.poisson(maxItems, students / respTime);
};
Util.Network.CapacityCalculator.prototype._ProbabilityBelowEquilibrium = function(students, responseTime, maxItems)
{
var equilibriumTime = 1.0 / maxItems;
var meanResponses = equilibriumTime * students / responseTime;
return Util.Statistics.poisson(1, meanResponses);
};
Util.Network.CapacityCalculator.prototype._CalculateRisk = function(students)
{
if (this._probability == -1) this._risk = 'Unknown';
if (students == 1) this._risk = 'Moderate';
else if (this._probability < this._high) this._risk = 'NearCertain';
else if (this._probability < this._moderate) this._risk = 'High';
else if (this._probability < this._veryLow) this._risk = 'Moderate';
else this._risk = 'VeryLow';
return this._risk;
};
Util.Network.CapacityCalculator.prototype._RecommendNumber = function(students, responseTime, maxItems)
{
var recommendation = students;
var step = Math.ceil(.25 * students);
var direction = -1;
var lastRecommendation = students;
var p = this._ProbabilityWithinCapacity_1(students, responseTime, maxItems);
var dir = direction;
while ((p > this._veryLow) || (p < this._moderate))
{
if (dir != direction) step = Math.max(1, Math.round(.5 * step));
students = Math.max(1, students + dir * step);
p = this._ProbabilityWithinCapacity_1(students, responseTime, maxItems);
if (p > this._veryLow) dir = 1;
else if (p < this._moderate) dir = -1;
}
this._recommendedNumber = students;
return this._recommendedNumber;
};
Util.Network.AppletBandWidthTester = {
bandwidthTestApplet: null,
sectionDiagnosticsObject: null,
currentRunConfig: null,
run: function(testConfig) {
Util.Network.AppletBandWidthTester.bandwidthTestApplet.setDebugMode(testConfig.debugMode);
Util.Network.AppletBandWidthTester.bandwidthTestApplet.setPacketSize(testConfig.bufferSize);
Util.Network.AppletBandWidthTester.bandwidthTestApplet.setTotalNumberOfSimultaneousConnections(testConfig.numberOfSimultaneousConnections);
Util.Network.AppletBandWidthTester.currentRunConfig = testConfig;
var wereTestsStarted = Util.Network.AppletBandWidthTester.bandwidthTestApplet.asynchronousNetworkAction(1, testConfig.applicationURL);
if (!wereTestsStarted) {
var callbackFn = Util.Network.AppletBandWidthTester.currentRunConfig.onFailureCallbackFn;
var callbackContext = Util.Network.AppletBandWidthTester.currentRunConfig.owner;
callbackFn.call(callbackContext, 'TESTS_ALREADYRUNNING', "Bandwidth tests already running.");
}
return wereTestsStarted;
}
};
Util.Network.AppletBandWidthTester.init = function(diagnosticsSectionObject) {
var appletConfig =
{
id: 'BandwidthTestApplet',
codebase: window.javaFolder + 'AIRBandwidthTester/',
code: 'air/org/AIRBandwidthTest/NetworkApplet.class',
archive: 'AIRBandwidthTestApplet.jar',
callback: 'bandwidthTestAppletEventHandler'
};
Util.Network.AppletBandWidthTester.sectionDiagnosticsObject = diagnosticsSectionObject;
Util.Frame.injectApplet('BandwidthTestApplet', appletConfig);
return true;
};
function bandwidthTestAppletEventHandler(bandwidthTestApplet, event, data) {
if (event == 'BandwidthTestAppletInited') {
if (bandwidthTestApplet == null) return false;
Util.Network.AppletBandWidthTester.bandwidthTestApplet = bandwidthTestApplet;
Util.Network.AppletBandWidthTester.sectionDiagnosticsObject.setAppletSpeedTestClickHandler();
}
else if (event == 'AppletSpeedTestMeasurementsReady') {
var downloadMeasurements =  parseFloat(data[0]);
var uploadMeasurements = parseFloat(data[1]);
var callbackFn = Util.Network.AppletBandWidthTester.currentRunConfig.onSuccessCallbackFn;
var callbackContext = Util.Network.AppletBandWidthTester.currentRunConfig.owner;
callbackFn.call(callbackContext, downloadMeasurements, uploadMeasurements);
}
};

/* SOURCE FILE: util_workflow.js (78301f7b) 9/9/2014 2:09:05 PM */

Util.Workflow = function()
{
this._activities = new Util.Structs.Map();
this._transitions = new Util.Structs.Map();
this._activeActivity = null;
this._transitionActivity = null;
this.Events = new Util.EventManager();
};
Util.Workflow.Approval =
{
Denied: 0,
Approved: 1,
Pending: 2
};
Util.Workflow.prototype._isActivity = function(activity)
{
return (activity && (activity instanceof Util.Workflow.Activity));
};
Util.Workflow.prototype.getActivity = function(id)
{
if (this._isActivity(id)) return id;
return this._activities.get(id);
};
Util.Workflow.prototype.addActivity = function(activity)
{
if (!this._isActivity(activity))
{
throw "expected activity object but was " + typeof (to);
}
var self = this;
activity.Events.subscribe('onRequest', function(action, data)
{
try
{
self._requestTransition(activity, action, data);
}
catch (ex)
{
TDS.Diagnostics.report(ex);
}
});
activity.Events.subscribe('onReady', function(data)
{
try
{
self._finishTransition(activity, data);
}
catch (ex)
{
TDS.Diagnostics.report(ex);
}
});
var id = activity.getId();
this._activities.set(id, activity);
};
Util.Workflow.prototype.getTransition = function(from, action)
{
var id = from + '_' + action;
return this._transitions.get(id);
};
Util.Workflow.prototype.addTransition = function(from, action, to)
{
var id = from + '_' + action;
this._transitions.set(id, { from: from, to: to });
};
Util.Workflow.prototype._requestTransition = function(fromActivity, action, data)
{
fromActivity = this.getActivity(fromActivity);
var transition = this.getTransition(fromActivity, action);
if (transition)
{
var toActivity = transition.to;
if (YAHOO.lang.isFunction(toActivity))
{
toActivity = toActivity(data);
}
toActivity = this.getActivity(toActivity);
if (toActivity)
{
if (YAHOO.lang.isFunction(toActivity.requestApproval))
{
this._approveTransition(toActivity, data);
}
else
{
this._beginTransition(toActivity, data);
}
}
}
};
Util.Workflow.prototype._approveTransition = function(activity, data)
{
activity._approvedAction = null;
var activityApproval = Util.Workflow.Approval.Approved;
var requestApproval = activity.requestApproval(data);
if (YAHOO.lang.isNumber(requestApproval))
{
activityApproval = requestApproval;
}
if (activityApproval == Util.Workflow.Approval.Approved)
{
this._beginTransition(activity, data);
}
else if (activityApproval == Util.Workflow.Approval.Pending)
{
activity._approvedAction = Util.bind(this._beginTransition, this, activity, data);
}
};
Util.Workflow.prototype._beginTransition = function(activity, data)
{
if (this._activeActivity == activity)
{
throw 'cannot transition to activity (' + activity + ') because it is already active';
}
if (this._transitionActivity != null)
{
throw 'cannot begin transition activity (' + activity + ') because there is a current one (' + this._transitionActivity + ') in progress';
}
this._transitionActivity = activity;
this.Events.fire('onRequest', activity);
if (!activity.hasVisited())
{
if (YAHOO.lang.isFunction(activity.init)) activity.init();
activity.markVisited();
}
var wait = false;
if (YAHOO.lang.isFunction(activity.load)) wait = activity.load(data);
if (wait !== true) this._finishTransition(activity);
};
Util.Workflow.prototype._finishTransition = function(activity, data)
{
if (this._transitionActivity == null)
{
throw 'cannot finalize transition activity (' + activity + ') because it is not in progress';
}
this.Events.fire('onReady', activity, data);
var previousActivity = null;
if (this._activeActivity)
{
this.Events.fire('onLeave', this._activeActivity);
if (YAHOO.lang.isFunction(this._activeActivity.leave))
{
this._activeActivity.leave();
}
previousActivity = this._activeActivity;
}
this._activeActivity = activity;
this.Events.fire('onEnter', this._activeActivity, data);
if (YAHOO.lang.isFunction(this._activeActivity.enter))
{
this._activeActivity.enter(data);
}
this._transitionActivity = null;
};
Util.Workflow.prototype.start = function(id)
{
var activity = this.getActivity(id);
try
{
this._beginTransition(activity);
}
catch (ex)
{
TDS.Diagnostics.report(ex);
}
};
Util.Workflow.Activity = function(id)
{
if (!YAHOO.lang.isString(id)) throw new Error('Activity must have a valid ID');
this.Events = new Util.EventManager(this);
this.request = function(action, data        )
{
this.Events.fire('onRequest', action, data);
};
this.requestApproved = function()
{
if (YAHOO.lang.isFunction(this._approvedAction)) this._approvedAction();
};
this.ready = function(data)
{
this.Events.fire('onReady', data);
};
this.getId = function() { return id; };
this.toString = function() { return this.getId(); };
this._visited = false;
this.markVisited = function() { this._visited = true; };
this.hasVisited = function() { return this._visited; };
};
Util.Workflow.extendActivity = function(activityClass)
{
YAHOO.lang.extend(activityClass, Util.Workflow.Activity);
};

/* SOURCE FILE: util_xml.js (921e46e4) 9/9/2014 2:09:05 PM */

Util.Xml = { };
Util.Xml.getNodeText = function(node) {
return (node) ? ((node.text) ? node.text : (node.textContent) ? node.textContent : null) : null;
};
Util.Xml.escapeHTMLEncode = function(str)
{
if (str == null) return '';
var div = document.createElement('div');
var text = document.createTextNode(str);
div.appendChild(text);
return div.innerHTML;
};
Util.Xml.getAttribute = function(node, name) {
return node.getAttribute(name);
};
Util.Xml.getAttributeBool = function(node, name)
{
return Util.Converters.parseBoolean(node.getAttribute(name));
};
Util.Xml.getAttributeInt = function(node, name)
{
return Util.Converters.parseInt(node.getAttribute(name));
};
Util.Xml.getCData = function(node, name)
{
var nodeText = Util.Dom.queryTag(name, node);
if (nodeText != null) {
return Util.Xml.getNodeText(nodeText);
}
return null;
};
Util.Xml.MAX_XML_SIZE_KB = 2 * 1024;
Util.Xml.MAX_ELEMENT_DEPTH = 256;
Util.Xml.createDocument = function(opt_rootTagName, opt_namespaceUri)
{
if (opt_namespaceUri && !opt_rootTagName) {
throw Error("Can't create document with namespace and no root tag");
}
if (document.implementation && document.implementation.createDocument) {
return document.implementation.createDocument(opt_namespaceUri || '', opt_rootTagName || '', null);
}
else if (typeof ActiveXObject != 'undefined') {
var doc = Util.Xml._createMsXmlDocument();
if (doc) {
if (opt_rootTagName) {
doc.appendChild(doc.createNode(Util.Dom.NodeType.ELEMENT, opt_rootTagName, opt_namespaceUri || ''));
}
return doc;
}
}
throw Error('Your browser does not support creating new documents');
};
Util.Xml.parseFromString = function(text, type)
{
type = type || 'text/xml';
var xmlDoc;
if (window.DOMParser) {
xmlDoc = (new window.DOMParser()).parseFromString(text, type);
} else {
xmlDoc = Util.Xml._createMsXmlDocument();
xmlDoc.loadXML(text);
}
var errorMsg = null;
if (xmlDoc.parseError && xmlDoc.parseError.errorCode != 0) {
errorMsg = 'XML Parsing Error: ' + xmlDoc.parseError.reason
+ ' at line ' + xmlDoc.parseError.line
+ ' at position ' + xmlDoc.parseError.linepos;
} else {
if (xmlDoc.documentElement) {
if (xmlDoc.documentElement.nodeName == 'parsererror') {
errorMsg = xmlDoc.documentElement.childNodes[0].nodeValue;
}
var errors = xmlDoc.getElementsByTagName('parsererror');
if (errors.length > 0) {
errorMsg = errors[0].textContent;
}
} else {
errorMsg = 'XML Parsing Error';
}
}
if (errorMsg) {
throw new Error(errorMsg);
}
return xmlDoc;
};
Util.Xml.serializeToString = function(node)
{
if (typeof XMLSerializer != 'undefined') {
return new XMLSerializer().serializeToString(node);
}
if (node.xml) {
return node.xml;
}
throw Error('Your browser does not support serializing XML documents');
};
Util.Xml._createMsXmlDocument = function() {
var doc = new ActiveXObject('Microsoft.XMLDOM');
doc.async = false;
doc.resolveExternals = false;
doc.validateOnParse = false;
try {
doc.setProperty('ProhibitDTD', true);
doc.setProperty('MaxXMLSize', Util.Dom.MAX_XML_SIZE_KB);
doc.setProperty('MaxElementDepth', Util.Dom.MAX_ELEMENT_DEPTH);
} catch (e) {
}
return doc;
};
Util.Xml.innerHTML = function (node) {
var str = Util.Xml.serializeToString(node);
return $(str).html();
};

/* SOURCE FILE: util_frame.js (7d9ccd54) 9/9/2014 2:09:05 PM */

Util.Frame = { };
Util.Frame.DOCTYPE_HTML32 =              '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">';
Util.Frame.DOCTYPE_HTML4_TRANSITIONAL =  '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">';
Util.Frame.DOCTYPE_HTML4_STRICT =        '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">';
Util.Frame.DOCTYPE_XHTML1_TRANSITIONAL = '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';
Util.Frame.DOCTYPE_XHTML1_STRICT =       '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">';
Util.Frame.DOCTYPE_XHTML11 =             '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">';
Util.Frame.DOCTYPE_MATHML =              '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"';
Util.Frame.DOCTYPE_HTML5 =               '<!DOCTYPE html>';
Util.Frame.createElement = function(id)
{
var frame;
if (YAHOO.env.ua.ie > 0 && Util.Browser.getIEDocMode() < 9)
{
frame = document.createElement('<iframe id="' + id + '" name="' + id + '">');
}
else
{
frame = document.createElement('iframe');
frame.setAttribute('id', id);
frame.setAttribute('name', id);
}
return frame;
};
Util.Frame.create = function(id, parent)
{
var iframe = Util.Frame.createElement(id);
YAHOO.util.Dom.addClass(iframe, 'contentFrame');
iframe.onLoading = new YAHOO.util.CustomEvent('loading', iframe, false, YAHOO.util.CustomEvent.FLAT);
iframe.onLoaded = new YAHOO.util.CustomEvent('loaded', iframe, false, YAHOO.util.CustomEvent.FLAT);
iframe.onAborted = new YAHOO.util.CustomEvent('aborted', iframe, false, YAHOO.util.CustomEvent.FLAT);
iframe.onBeforeShow = new YAHOO.util.CustomEvent('beforeShow', iframe, false, YAHOO.util.CustomEvent.FLAT);
iframe.onShow = new YAHOO.util.CustomEvent('show', iframe, false, YAHOO.util.CustomEvent.FLAT);
iframe.onBeforeHide = new YAHOO.util.CustomEvent('beforeHide', iframe, false, YAHOO.util.CustomEvent.FLAT);
iframe.onHide = new YAHOO.util.CustomEvent('hide', iframe, false, YAHOO.util.CustomEvent.FLAT);
iframe.timestamps =
{
createDate: new Date(),
attemptDate: null,
loadDate: null,
showDate: null,
hideDate: null,
abortDate: null
};
iframe.durationCounters =
{
loadTime: 0,
visitTime: 0
};
iframe.counters =
{
attemptCount: 0,
loadCount: 0,
showCount: 0,
hideCount: 0,
abortCount: 0
};
iframe.debug = function()
{
Util.dir(iframe.timestamps);
Util.dir(iframe.durationCounters);
Util.dir(iframe.counters);
};
var config = {
name: id,
border: '0'
};
for (var i in config)
{
if (YAHOO.lang.hasOwnProperty(config, i))
{
iframe.setAttribute(i, config[i]);
}
}
if (YAHOO.env.ua.ie) iframe.src = 'javascript:false;';
else iframe.src = 'javascript:;';
parent.appendChild(iframe);
this.addEnhancements(iframe);
return iframe;
};
Util.Frame.addEnhancements = function(iframe)
{
var enhancements =
{
abortTimer: null,
loadState: 0,
getDebugID: function()
{
return this.id.replace('iframe_', '')
},
_loadInit: function(timeout)
{
if (this.loadState == 1) return false;
this.loadState = 1;
var successCallback = function()
{
if (this.abortTimer != null) this.abortTimer.cancel();
YUE.removeListener(this, 'load', successCallback);
if (this.loadState == -1) return;
this.counters.loadCount++;
this.timestamps.loadDate = new Date();
this.durationCounters.loadTime = (this.timestamps.loadDate - this.timestamps.attemptDate);
this.loadState = 2;
this.onLoaded.fire(this);
};
var abortCallback = function()
{
YUE.removeListener(this, 'load', successCallback);
if (this.loadState == 2) return;
this.abort();
this.counters.abortCount++;
this.timestamps.abortDate = new Date();
this.loadState = -1;
this.onAborted.fire(this);
};
YUE.addListener(this, 'load', successCallback);
this.onLoading.fire(this);
if (timeout != null && timeout >= 0)
{
this.abortTimer = YAHOO.lang.later(timeout, this, abortCallback);
}
this.counters.attemptCount++;
this.timestamps.attemptDate = new Date();
return true;
},
abort: function()
{
try
{
var frameWin = this.getWindow();
frameWin.stop();
}
catch (ex) { };
},
load: function(url, timeout)
{
if (!this._loadInit(timeout)) return false;
Util.log('iframe ' + this.getDebugID() + ': formPost = ' + url);
var frameRequestsID = 'frameRequests';
var frameRequests = document.getElementById(frameRequestsID);
if (frameRequests == null)
{
frameRequests = document.createElement('div');
frameRequests.id = frameRequestsID;
document.body.appendChild(frameRequests);
YUD.setStyle(frameRequests, 'display', 'none');
}
var form = document.createElement("form");
frameRequests.appendChild(form);
form.enctype = form.encoding = "multipart/form-data";
form.setAttribute('action', url);
form.setAttribute('method', 'POST');
form.setAttribute('target', this.id);
form.submit();
return true;
},
loadHtml: function(html, timeout)
{
if (!this._loadInit(timeout)) return false;
var doc = this.getDocument();
doc.open();
doc.write(html);
doc.close();
return true;
},
isShowing: function()
{
if (this.tagName != 'IFRAME' || this.nodeName != 'IFRAME')
{
Util.log('iframe: show error this is not a iframe');
}
return !YAHOO.util.Dom.hasClass(this, 'contentFrameHide');
},
forceRedraw: function()
{
var body = this.getBody();
YUD.addClass(body, 'forceRedraw');
setTimeout(function()
{
YUD.removeClass(body, 'forceRedraw');
}, 1);
},
show: function()
{
if (this.isShowing())
{
Util.log('iframe: Trying to show a page that is currently showing.');
return false;
}
var allow = this.onBeforeShow.fire(this);
if (allow === false) return false;
this.timestamps.showDate = new Date();
this.counters.showCount++;
YAHOO.util.Dom.removeClass(this, 'contentFrameHide');
this.onShow.fire(this);
this.forceRedraw();
return true;
},
hide: function()
{
if (!this.isShowing())
{
Util.log('iframe: Trying to hide a page that is currently hidden.');
return false;
}
var allow = this.onBeforeHide.fire(this);
if (allow === false) return false;
this.timestamps.hideDate = new Date();
this.counters.hideCount++;
this.durationCounters.visitTime += (this.timestamps.hideDate - this.timestamps.showDate);
YAHOO.util.Dom.addClass(this, 'contentFrameHide');
this.onHide.fire(this);
return true;
},
getWindow: function()
{
return window[this.id];
},
getDocument: function()
{
var doc = null;
try
{
if (iframe.contentDocument)
{
doc = iframe.contentDocument;
}
else if (iframe.contentWindow)
{
doc = iframe.contentWindow.document;
}
else if (iframe.document)
{
doc = iframe.document;
}
}
catch (ex) { }
return doc;
},
getBody: function()
{
return this.getDocument().body;
},
havePermission: function()
{
try
{
this.getDocument();
return true;
}
catch (e)
{
return false;
}
}
};
Util.Object.mix(iframe, enhancements);
};
Util.Frame.BLANK_SOURCE = 'javascript:""';
Util.Frame.STYLES_ = 'border:0;vertical-align:bottom;';
Util.Frame.createBlank = function(opt_styles)
{
return (Util.Dom.Builder.createDom('iframe', {
'frameborder': 0,
'style': Util.Frame.STYLES_ + (opt_styles || ''),
'src': Util.Frame.BLANK_SOURCE
}));
};
Util.Frame.writeContent = function(iframe, content)
{
var doc = Util.Dom.getFrameContentDocument(iframe);
doc.open();
doc.write(content);
doc.close();
};
Util.Frame.createWithContent = function(parentElement, opt_headContents, opt_bodyContents, opt_styles, opt_quirks)
{
var contentBuf = [];
if (!opt_quirks)
{
contentBuf.push('<!DOCTYPE html>');
}
contentBuf.push('<html><head>', opt_headContents, '</head><body>', opt_bodyContents, '</body></html>');
var iframe = Util.Frame.createBlank(opt_styles);
parentElement.appendChild(iframe);
Util.Frame.writeContent(iframe, contentBuf.join(''));
return iframe;
};
Util.Frame.createHidden = function(id)
{
var frame = Util.Frame.createElement(id);
frame.setAttribute('border', '0');
frame.setAttribute('frameBorder', '0');
frame.setAttribute('width', '0');
frame.setAttribute('marginWidth', '0');
frame.setAttribute('height', '0');
frame.setAttribute('marginHeight', '0');
frame.setAttribute('leftMargin', '0');
frame.setAttribute('topMargin', '0');
frame.setAttribute('allowTransparency', 'false');
var style = 'width:0px; height:0px; border: 0px; visibility: hidden; display:block;';
frame.setAttribute('style', style);
frame.src = (YAHOO.env.ua.ie) ? 'javascript:false;' : 'javascript:;';
return frame;
};
Util.Frame.injectApplet = function(id, config)
{
var frame = Util.Frame.createHidden(id);
document.body.appendChild(frame);
var script_cookie = '<script type="text/javascript">function getCookies() { return document.cookie; }</script>';
var script_events = '<script type="text/javascript">function tdsFireEvent(id, name, event, data, sequenceNumber, logSeqNumber) { setTimeout(function() { if (typeof(parent.{callback}) != "function") return; parent.{callback}(document.getElementById(id), event, data, sequenceNumber, logSeqNumber); }, 0); }</script>';
script_events = YAHOO.lang.substitute(script_events, config);
var appletHtml = '<applet id="{id}" name="{id}" archive="{archive}" codebase="{codebase}" code="{code}" mayscript="true" scriptable="true"><param value="{id}" name="id"/></applet>';
appletHtml = YAHOO.lang.substitute(appletHtml, config);
var frameHtml = '<html><head>' + script_cookie + script_events + '</head><body>' + appletHtml + '</body></html>';
var frameDoc = frame.contentDocument ? frame.contentDocument : frame.contentWindow ? frame.contentWindow.document : frame.document;
frameDoc.open();
frameDoc.write(frameHtml);
frameDoc.close();
return frameDoc.getElementById(config.id);
};
Util.Frame.injectEmbed = function(id, type)
{
var frame = Util.Frame.createHidden(id);
document.body.appendChild(frame);
var embedHtml = '<embed type="{type}"></embed>';
embedHtml = YAHOO.lang.substitute(embedHtml, {
type: type
});
var frameHtml = '<html><head></head><body>' + embedHtml + '</body></html>';
var frameDoc = frame.contentDocument ? frame.contentDocument : frame.contentWindow ? frame.contentWindow.document : frame.document;
frameDoc.open();
frameDoc.write(frameHtml);
frameDoc.close();
return frameDoc.getElementsByTagName('embed')[0];
};
Util.Frame.createHtml = function(bodyHtml, options)
{
options = options || {};
var html = [];
if (!YAHOO.lang.isObject(options.docType))
{
options.docType = Util.Frame.DOCTYPE_XHTML1_TRANSITIONAL;
}
html.push(options.docType);
html.push('<html xmlns="http://www.w3.org/1999/xhtml">');
html.push('<head>');
html.push('<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />');
if (!YAHOO.lang.isObject(options.baseURI))
{
options.baseURI = document.baseURI || document.URL;
}
var frameURI = options.baseURI.replace(/[^/]*$/, '');
html.push('<base href="' + frameURI + '" />');
if (YAHOO.lang.isArray(options.scripts))
{
Util.Array.each(options.scripts, function(script)
{
html.push('<script type="text/javascript" src="' + script + '"></script>');
});
}
if (YAHOO.lang.isArray(options.styles))
{
Util.Array.each(options.styles, function(style)
{
html.push('<link type="text/css" rel="stylesheet" href="' + style + '" />');
});
}
html.push('</head>');
if (YAHOO.lang.isString(options.callbackName))
{
html.push('<body onload="setTimeout(function() { parent.' + options.callbackName + '(this); }, 0);"');
}
else
{
html.push('<body>');
}
if (YAHOO.lang.isString(bodyHtml)) html.push(bodyHtml);
html.push('</body></html>');
return html.join('');
};

/* SOURCE FILE: util_storage.js (cd3b910e) 9/9/2014 2:09:05 PM */

(function(Util) {
function serialize(value) {
return JSON.stringify(value);
}
function deserialize(value) {
if (typeof value != 'string') {
return undefined;
}
try {
return JSON.parse(value);
} catch (ex) {
return value || undefined;
}
}
var Storage = function(api) {
this._api = api;
};
Storage.prototype.length = function () {
return this._api.length;
};
Storage.prototype.remove = function (key) {
this._api.removeItem(key);
};
Storage.prototype.setString = function (key, value) {
this._api.setItem(key, value);
};
Storage.prototype.set = function (key, value) {
if (value === undefined) {
this.remove(key);
} else {
this.setString(key, serialize(value));
}
};
Storage.prototype.getString = function (key) {
try {
return this._api.getItem(key);
} catch (ex) {
return undefined;
}
};
Storage.prototype.get = function (key) {
var json = this.getString(key);
if (json === undefined || json === null) {
return undefined;
}
try {
return deserialize(json);
} catch (ex) {
throw new Error('Invalid data for the key "' + key + '"');
}
};
Storage.prototype._key = function(index) {
return this._api.key(index);
};
Storage.prototype.keys = function(filter) {
var keys = [];
var i = 0, len = this.length();
for (; i < len; i++) {
var key = this._key(i);
if (key && (typeof filter != 'function' || filter(key))) {
keys.push(key);
}
}
return keys;
};
Storage.prototype.clear = function() {
if (this._api.clear) {
this._api.clear();
} else {
var keys = this.keys();
keys.forEach(function(key) {
this.remove(key);
}.bind(this));
}
};
Util.Storage = new Storage(sessionStorage);
})(Util);

/* SOURCE FILE: util_xdm.js (0d663f11) 10/26/2014 1:27:06 PM */

window.Util = window.Util || {};
Util.XDM = (function () {
var defaults = {
targetWindow: window,
targetOrigin: '*',
sourceOrigin: false
};
var id = 0;
var requests = {};
var listeners = {};
var XDM = function (targetWindow, targetOrigin) {
targetWindow = targetWindow || window;
return $.extend(XDM.bind(), {
targetWindow: targetWindow,
targetOrigin: targetOrigin,
post: postRequest
});
};
XDM.suppressException = false;
XDM.init = function (thisWindow) {
thisWindow = thisWindow || window;
if (thisWindow.addEventListener) {
thisWindow.addEventListener('message', messageHandler, true);
}
return XDM;
};
XDM.addListener = function(name, callback) {
listeners[name] = callback;
};
XDM.removeListener = function (name) {
delete listeners[name];
};
XDM.removeListeners = function () {
Object.keys(listeners).forEach(function(key) {
XDM.removeListener(key);
});
};
function postRequest(requestName) {
var req = new Request(requestName);
req.targetWindow = this.targetWindow || defaults.targetWindow;
req.targetOrigin = this.targetOrigin || defaults.targetOrigin;
req.data = [].slice.call(arguments, 1);
req.send();
return req;
}
function messageHandler(evt) {
try {
var data = JSON.parse(evt.data);
} catch (ex) {
console.log('XDM: error parsing json data');
return;
}
if (data.type === 'request') {
console.log('MESSAGE REQUEST: ', data);
var response = new Response(data);
response.targetWindow = evt.source;
response.targetOrigin = evt.origin === 'null' ? defaults.targetOrigin : evt.origin;
response.send();
}
else if (data.type === 'response') {
console.log('MESSAGE RESPONSE: ', data);
if (data.success) {
requests[data.id].resolve(data.data);
} else {
requests[data.id].reject(new XDM.Error(data.data));
}
delete requests[data.id];
}
}
function Request(name) {
this.init.apply(this, [].slice.call(arguments));
}
Request.prototype.init = function(name) {
$.extend(this, $.Deferred());
this.id = ++id;
this.name = name;
this.data = [].slice.call(arguments);
this.type = 'request';
requests[id] = this;
};
Request.prototype.send = function() {
this.targetWindow = this.targetWindow || defaults.targetWindow;
this.targetOrigin = this.targetOrigin || defaults.targetOrigin;
this.targetWindow.postMessage(JSON.stringify(this), this.targetOrigin);
};
Request.prototype.toJSON = function() {
return {
id: this.id,
name: this.name,
type: this.type,
data: this.data
};
};
Request.create = function (obj) {
return $.extend(new Request(), obj);
};
function Response(req) {
this.init(req);
}
Response.prototype.init = function(req) {
this.id = req.id;
this.name = req.name;
this.type = 'response';
try {
var request = Request.create(req);
var listener = listeners[req.name];
if (listener) {
this.data = listener.apply(this, request.data);
this.success = true;
} else {
throw new Error('Could not find the listener \'' + req.name + '\'');
}
} catch (error) {
this.data = new XDM.Error(error);
this.success = false;
}
};
Response.prototype.send = function () {
this.targetWindow = this.targetWindow || defaults.targetWindow;
this.targetOrigin = this.targetOrigin || defaults.targetOrigin;
var request = this;
function postMessage(value) {
request.data = value;
request.targetWindow.postMessage(JSON.stringify(request), request.targetOrigin);
};
$.when(this.data).then(function (value) {
postMessage(value);
}, function(error) {
request.success = false;
if (error instanceof Error) {
error = new XDM.Error(error);
}
postMessage(error);
});
if (!XDM.suppressException && !this.success) {
throw this.data.error;
}
};
Response.prototype.toJSON = function() {
return {
id: this.id,
name: this.name,
type: this.type,
data: this.data,
success: this.success
};
};
XDM.Error = function (error) {
this.error = error;
$.extend(this, error);
this.name = error.name;
this.message = error.message;
this.number = error.number;
this.description = error.description;
this.fileName = error.fileName;
this.lineNumber = error.lineNumber;
this.stack = error.stack;
this.toString = function () {
return this.message;
};
};
return XDM;
})();

/* SOURCE FILE: util_slider.js (24cde676) 9/9/2014 2:09:05 PM */

(function (Util) {
function Slider(id, min, max) {
this._id = id;
this._min = min;
this._max = max;
this._element = null;
this._instance = null;
this._tickSize = 0;
this.onStart = new Util.Event.Custom(this);
this.onChange = new Util.Event.Custom(this);
this.onEnd = new Util.Event.Custom(this);
}
Slider.prototype.getId = function () {
return this._id;
};
Slider.prototype.getEl = function () {
return this._element;
};
Slider.prototype.getValue = function () {
if (this._instance) {
var rawValue = this._instance.getValue();
return Math.floor((rawValue / this._tickSize) + this._min);
}
return -1;
};
Slider.prototype.setValue = function (realValue) {
if (this._instance) {
this._instance.setValue((realValue - this._min) * this._tickSize, true);
}
};
Slider.prototype.increment = function () {
if (this._instance) {
var value = this._instance.getValue() + this._tickSize;
this._instance.setValue(value);
}
};
Slider.prototype.decrement = function () {
if (this._instance) {
var value = this._instance.getValue() - this._tickSize;
this._instance.setValue(value);
}
};
Slider.prototype.render = function (sliderWidth, thumbWidth) {
sliderWidth = sliderWidth || 195;
thumbWidth = thumbWidth || 23;
var maxThumbPos = sliderWidth - thumbWidth;
var container = document.createElement('div');
container.className = 'slide_controls_slider yui-h-slider';
container.style.width = sliderWidth + 'px';
var bgSlider = document.createElement('div');
bgSlider.id = 'slider_bg_' + this._id;
bgSlider.className = 'slide_controls_slider_bg';
bgSlider.setAttribute('tabindex', 0);
container.appendChild(bgSlider);
var thumbSlider = document.createElement('span');
thumbSlider.id = 'slider_image_' + this._id;
thumbSlider.className = 'slide_controls_img';
bgSlider.appendChild(thumbSlider);
this._element = container;
this._tickSize = Math.floor(maxThumbPos / (this._max - this._min));
this._instance = YAHOO.widget.Slider.getHorizSlider(bgSlider, thumbSlider, 0, maxThumbPos, this._tickSize);
this._instance.keyIncrement = this._tickSize;
this._instance.subscribe('slideStart', function () {
this.onStart.fire(this.getValue());
}.bind(this));
this._instance.subscribe('change', function () {
this.onChange.fire(this.getValue());
}.bind(this));
this._instance.subscribe('slideEnd', function () {
this.onEnd.fire(this.getValue());
}.bind(this));
return container;
};
Slider.create = function (id, min, max, width) {
var slider = new Slider(id, min, max);
slider.render(width);
return slider;
};
Util.Slider = Slider;
})(Util);

/* SOURCE FILE: util_workerfactory.js (4fc780a9) 9/9/2014 2:09:05 PM */

(function (Util) {
var workerFactory = {};
if (Util.Browser.isSecure() && Util.Browser.getSecureVersion() >= 7.0) {
var commandName = 'bootstrap-workerfactory';
var workerBody = [
"(function () {",
"    function handleImportScriptCommand(event) {",
"        var command = event.data.command,",
"            scriptUrl = event.data.scriptUrl;",
"",
"        if (command === '" + commandName + "' && scriptUrl) {",
"            console.log('bootstrapping worker with url \"' + scriptUrl + '\"');",
"",
"            importScripts(scriptUrl);",
"            self.removeEventListener('message', handleImportScriptCommand);",
"        }",
"    }",
"",
"    self.addEventListener('message', handleImportScriptCommand);",
"})();"
].join('\n');
var blob = new Blob([workerBody], { type: 'text/javascript' }),
url = URL.createObjectURL(blob);
var workerPool = [],
initialPoolSize = 1;
function initializeWorkerPool() {
for (; initialPoolSize--;) {
var worker = new Worker(url);
workerPool.push(worker);
}
}
initializeWorkerPool();
workerFactory.create = function (scriptUrl) {
var worker = workerPool.shift();
worker.postMessage({
command: commandName,
scriptUrl: scriptUrl
});
return worker;
};
} else {
workerFactory.create = function (scriptUrl) {
return new Worker(scriptUrl);
};
}
Object.freeze(workerFactory);
Util.workerFactory = workerFactory;
})(Util);

/* SOURCE FILE: air_mobile_2.js (e28f47b3) 10/26/2014 1:27:05 PM */

if (typeof Summit != 'object') Summit = {};
if (typeof Summit.SecureBrowser != 'object') Summit.SecureBrowser = {};
Summit.SecureBrowser.Mobile = function () {
var AIRMobile = {
CMD_RECORD_AUDIO: "cmdRecordAudioSample",
CMD_INITIALIZE: "cmdInitialize",
CMD_GET_PROCESSES: "cmdGetNativeProcesses",
CMD_CHECK_GUIDED_ACCESS: "cmdCheckGuidedAccess",
CMD_ENABLE_GUIDED_ACCESS: "cmdEnableGuidedAccess",
CMD_CHECK_TTS: "cmdCheckTTS",
CMD_JAVASCRIPT_LOG: "cmdJavascriptLog",
CMD_SET_DEFAULT_URL: "cmdSetDefaultURL",
CMD_CHECK_ORIENTATION: "cmdCheckOrientation",
CMD_LOCK_ORIENTATION: "cmdLockOrientation",
CMD_SPEAK_TEXT: "cmdSpeakText",
CMD_STOP_SPEAKING: "cmdStopSpeaking",
CMD_PAUSE_SPEAKING: "cmdPauseSpeaking",
CMD_RESUME_SPEAKING: "cmdResumeSpeaking",
CMD_CHECK_SPEAK_STATUS: "cmdCheckSpeakStatus",
CMD_EXIT_APPLICATION: "cmdExitApplication",
CMD_RESTART_APPLICATION: "cmdRestartApplication",
CMD_SET_MIC_MUTE: "cmdSetMicMuted",
CMD_CLEAR_WEB_CACHE : "cmdRequestClearWebCache",
CMD_CLEAR_WEB_COOKIES : "cmdRequestClearCookies",
CMD_GET_MAC_ADDRESS : "cmdRequestGetMACAddress",
CMD_GET_IP_ADDRESS_LIST : "cmdRequestGetIPAddressList",
CMD_GET_START_TIME : "cmdRequestGetStartTime",
EVENT_CONNECTIVITY_CHANGED: "airMobile_connectivity_changed",
EVENT_DEFAULT_URL_CHANGED: "airMobile_default_url_changed",
EVENT_DEVICE_READY: "airMobile_device_ready",
EVENT_ENTER_BACKGROUND: "airMobile_enter_background",
EVENT_RETURN_FROM_BACKGROUND: "airMobile_return_from_background",
EVENT_GUIDED_ACCESS_CHANGED: "airMobile_guided_access_changed",
EVENT_RUNNING_PROCESSES_CHANGED: "airMobile_running_process_changed",
EVENT_TTS_CHANGED: "airMobile_tts_changed",
EVENT_TTS_SYNCHRONIZED: "airMobile_tts_synchronized",
EVENT_ORIENTATION_CHANGED: "airMobile_orientation_changed",
EVENT_KEYBOARD_CHANGED: "airMobile_keyboard_changed",
EVENT_MIC_MUTE_CHANGED: "airMobile_mic_mute_changed",
EVENT_MINI_APP_DETECTED : "airMobile_mini_app_detected",
EVENT_CLIPBOARD_CHANGED : "airMobile_clipboard_changed",
callbacks: {},
device: {
isReady: false,
apiVersion: -1.0,
defaultURL: "Unknown",
rootAccess: false,
model: "Unknown",
manufacturer: "Unknown",
operatingSystem: "Unknown",
operatingSystemVersion: "Unknown",
connectivityStatus: "Unknown",
guidedAccessEnabled: false,
textToSpeechEnabled: false,
ttsEngineStatus: "unavailable",
runningProcesses: [],
installedPackages: [],
screenResolution: "Unknown",
orientation: "Unknown",
lockedOrientation: "none",
keyboard: "unknown",
micMuted: false,
ipAddress : "unknown",
macAddress : "unknown",
startTime : "unknown",
ttsVoices : "unknown",
screenShotsEnabled: function() {
var isIOS, isAndroid;
isIOS = this.operatingSystem.toLowerCase() == "iphone os";
isAndroid = !isIOS;
if (isIOS) {
return this.guidedAccessEnabled ? false : true;
} else if (isAndroid) {
return false;
}
return true;
},
supportsFeature: function(_feature) {
var isIOS, isAndroid;
isIOS = this.operatingSystem.toLowerCase() == "iphone os";
isAndroid = this.operatingSystem.toLowerCase() == "android";
if (_feature == "guided_access")
{
return isIOS;
} else if (_feature == "text_to_speech")
{
return isIOS || isAndroid;
} else if (_feature == "running_processes")
{
return isIOS || isAndroid;
} else if (_feature == "installed_packages")
{
return isAndroid;
} else if (_feature == "mic_mute")
{
return isAndroid;
} else if (_feature == "tts_engine")
{
return isAndroid || isIOS;
} else if (_feature == "exit")
{
return isAndroid;
}
return false;
},
formattedDeviceInfo: function() {
var isiOS = this.operatingSystem.toLowerCase() == "iphone os";
return "Device: " + this.model + ", OS: " + this.operatingSystem + ", Version: " + this.operatingSystemVersion + (isiOS ? ", Jailbroken: " : ", Rooted: ") + (this.rootAccess ? "Yes" : "No") + ", Resolution: " + this.screenResolution;
}
},
checkGuidedAccessStatus: function(_identifier, _callback) {
return this.sendCommand(this.CMD_CHECK_GUIDED_ACCESS, _identifier, _callback);
},
enableGuidedAccess: function (toEnable, _identifier, _callback) {
_identifier = _identifier == null ? this.UUID() : _identifier;
this.callbacks[_identifier] = _callback;
var params = {
identifier: _identifier,
enable: toEnable ? "true" : "false"
};
this.sendToApp(this.CMD_ENABLE_GUIDED_ACCESS, JSON.stringify(params, null, true));
},
checkRunningProcesses: function(_identifier, _callback) {
return this.sendCommand(this.CMD_GET_PROCESSES, _identifier, _callback);
},
checkTextToSpeechStatus: function(_identifier, _callback) {
return this.sendCommand(this.CMD_CHECK_TTS, _identifier, _callback);
},
checkOrientation: function(_identifier, _callback) {
return this.sendCommand(this.CMD_CHECK_ORIENTATION, _identifier, _callback);
},
requestOrientationLock: function(_orientation, _identifier, _callback) {
_identifier = _identifier == null ? this.UUID() : _identifier;
this.callbacks[_identifier] = _callback;
var params = {
identifier: _identifier,
orientation: _orientation
};
this.sendToApp(this.CMD_LOCK_ORIENTATION, JSON.stringify(params, null, true));
return _identifier;
},
recordAudio: function(_duration, _identifier, _callback) {
_identifier = _identifier == null ? this.UUID() : _identifier;
this.callbacks[_identifier] = _callback;
var params = {
identifier: _identifier,
duration: _duration
};
this.sendToApp(this.CMD_RECORD_AUDIO, JSON.stringify(params, null, true));
return _identifier;
},
setDefaultURL: function(_urlString, _identifier, _callback) {
var params = null;
if (_callback != null) {
_identifier = _identifier == null ? this.UUID() : _identifier;
this.callbacks[_identifier] = _callback;
params = {
identifier: _identifier,
url: _urlString
};
} else {
params = {
url: _urlString
};
}
this.sendToApp(this.CMD_SET_DEFAULT_URL, JSON.stringify(params, null, true));
return _identifier;
},
exitApplication: function(_identifier, _callback) {
return this.sendCommand(this.CMD_EXIT_APPLICATION, _identifier, _callback);
},
restartApplication: function(_identifier, _callback) {
return this.sendCommand(this.CMD_RESTART_APPLICATION, _identifier, _callback);
},
setMicMute: function(_muted, _identifier, _callback) {
var params = null;
if (_callback != null) {
_identifier = _identifier == null ? this.UUID() : _identifier;
this.callbacks[_identifier] = _callback;
params = {
identifier: _identifier,
muted: _muted
};
}
this.sendToApp(this.CMD_SET_MIC_MUTE, JSON.stringify(params, null, true));
return _identifier;
},
ntvOnMicMuteChanged: function(_parameters) {
var results, changed;
results = JSON.parse(_parameters, null);
changed = false;
if (this.device.micMuted != results.muted) {
changed = true;
this.device.micMuted = results.muted;
}
this.executeCallback(results);
if (changed == true) {
this.dispatchEvent(this.EVENT_MIC_MUTE_CHANGED);
}
return this.device.micMuted;
},
ntvOnRecordingComplete: function(_parameters) {
var results = JSON.parse(_parameters, null);
this.executeCallback(results);
return "Audio Received";
},
ntvOnConnectivityChanged: function(_parameters) {
var results = JSON.parse(_parameters, null);
if (results.status && results.status != this.device.connectivityStatus) {
this.device.connectivityStatus = results.status;
this.dispatchEvent(this.EVENT_CONNECTIVITY_CHANGED);
}
return this.device.connectivityStatus;
},
ntvOnDeviceReady: function(_parameters) {
var results = JSON.parse(_parameters, null);
this.device.isReady = true;
this.device.apiVersion = results.apiVersion != null ? results.apiVersion : -1.0;
this.device.model = results.model;
this.device.manufacturer = results.manufacturer;
this.device.operatingSystem = results.operatingSystem;
this.device.operatingSystemVersion = results.operatingSystemVersion;
this.device.runningProcesses = results.runningProcesses;
this.device.installedPackages = results.installedPackages;
this.device.rootAccess = results.rootAccess;
this.device.connectivityStatus = results.connectivity;
this.device.defaultURL = results.defaultURL;
this.device.textToSpeechEnabled = results.textToSpeech;
this.device.guidedAccessEnabled = results.guidedAccess;
this.device.screenResolution = results.screenResolution;
this.device.orientation = results.orientation;
this.device.lockedOrientation = results.lockedOrientation;
this.device.ttsEngineStatus = results.ttsEngineStatus;
this.device.keyboard = results.keyboard;
this.device.micMuted = results.muted;
this.device.ipAddress = results.ipAddress;
this.device.startTime = results.startTime;
this.device.macAddress = results.macAddress;
this.device.ttsVoices = results.availableTTSLanguages;
this.dispatchEvent(this.EVENT_DEVICE_READY);
return "OK";
},
ntvOnRequestNotSupported: function(_parameters) {
var response = JSON.parse(_parameters, null);
if (response.errorMessage == null) {
response.errorMessage = "Platform does not support feature";
}
this.executeCallback(response);
},
ntvOnGuidedAccessEnabled: function(_parameters) {
var results, changed;
results = JSON.parse(_parameters, null);
changed = results.enabled != this.device.guidedAccessEnabled;
this.device.guidedAccessEnabled = results.enabled;
this.executeCallback(results);
if (changed == true) {
this.dispatchEvent(this.EVENT_GUIDED_ACCESS_CHANGED);
}
return this.device.guidedAccessEnabled;
},
ntvOnEnableGuidedAccessReceived: function (_parameters) {
var results;
results = JSON.parse(_parameters, null);
if (results.enabled != null) {
this.device.guidedAccessEnabled = results.enabled;
}
this.executeCallback(results);
},
ntvOnTextToSpeechEnabled: function(_parameters) {
var results, changed;
results = JSON.parse(_parameters, null);
changed = this.device.textToSpeechEnabled != results.enabled;
if (changed == false) {
changed = this.device.ttsEngineStatus != results.ttsEngineStatus;
}
this.device.textToSpeechEnabled = results.enabled;
if (results.ttsEngineStatus != null) {
this.device.ttsEngineStatus = results.ttsEngineStatus;
}
this.executeCallback(results);
if (changed == true) {
this.dispatchEvent(this.EVENT_TTS_CHANGED);
}
return this.device.textToSpeechEnabled;
},
ntvOnTTSSynchronized: function(_parameters) {
var results = JSON.parse(_parameters, null);
if (results != null) {
this.dispatchMessageEvent(this.EVENT_TTS_SYNCHRONIZED, results);
}
},
ntvOnRunningProcessesUpdated: function(_parameters) {
var results, processes, added, removed;
results = JSON.parse(_parameters, null);
processes = results.runningProcesses;
added = diffArr(processes, this.device.runningProcesses);
removed = diffArr(this.device.runningProcesses, processes);
this.device.runningProcesses = processes;
this.executeCallback(results);
if (added.length > 0 || removed.length > 0) {
this.dispatchEvent(this.EVENT_RUNNING_PROCESSES_CHANGED);
}
return added.length > 0;
},
ntvApplicationEnterBackground: function() {
this.dispatchEvent(this.EVENT_ENTER_BACKGROUND);
return "OK";
},
ntvApplicationReturnFromBackground: function() {
this.dispatchEvent(this.EVENT_RETURN_FROM_BACKGROUND);
return "OK";
},
ntvOnSetDefaultURL: function(_parameters) {
var results, changed;
results = JSON.parse(_parameters, null);
changed = false;
if (results.url) {
changed = results.url != AIRMobile.device.defaultURL;
AIRMobile.device.defaultURL = results.url;
}
this.executeCallback(results);
if (changed) {
this.dispatchEvent(this.EVENT_DEFAULT_URL_CHANGED);
}
return this.device.defaultURL;
},
ntvMiniAppLaunched : function(){
this.dispatchEvent(this.EVENT_MINI_APP_DETECTED);
return "OK";
},
ntvOnOrientationChanged: function(_parameters) {
var results, changed;
results = JSON.parse(_parameters, null);
changed = false;
if (results.orientation) {
changed = results.orientation != AIRMobile.device.orientation;
AIRMobile.device.orientation = results.orientation;
}
this.executeCallback(results);
if (changed) {
this.dispatchEvent(this.EVENT_ORIENTATION_CHANGED);
}
return this.device.orientation;
},
ntvOnOrientationLockChanged: function(_parameters) {
var results, orientationChanged;
results = JSON.parse(_parameters, null);
orientationChanged = false;
if (results.lockedOrientation) {
AIRMobile.device.lockedOrientation = results.lockedOrientation;
}
if (results.orientation) {
orientationChanged = results.orientation != AIRMobile.device.orientation;
AIRMobile.device.orientation = results.orientation;
}
this.executeCallback(results);
if (orientationChanged) {
this.dispatchEvent(this.EVENT_ORIENTATION_CHANGED);
}
return this.device.lockedOrientation;
},
ntvOnKeyboardChanged: function(_parameters) {
var results = JSON.parse(_parameters, null);
if (results.keyboard) {
this.device.keyboard = results.keyboard;
}
this.dispatchEvent(this.EVENT_KEYBOARD_CHANGED);
return results.keyboard;
},
ntvOnClipboardContentsChanged: function(_parameters) {
var results = JSON.parse(_parameters, null);
return this.dispatchMessageEvent(this.EVENT_CLIPBOARD_CHANGED, results.contents);
},
dispatchEvent: function(_eventName) {
var result, event;
result = false;
if (_eventName && _eventName.length > 0) {
event = document.createEvent("Event");
event.initEvent(_eventName, true, true);
document.dispatchEvent(event);
result = true;
}
return result;
},
dispatchMessageEvent: function(_eventName, _message) {
var result, origin, event;
result = false;
if (_eventName && _eventName.length > 0) {
origin = window.location.protocol + "//" + window.location.host;
event = document.createEvent("MessageEvent");
event.initMessageEvent(_eventName, true, true, _message, origin, 12, window, null);
document.dispatchEvent(event);
result = true;
}
return result;
},
executeCallback: function(_responseObject) {
var callback, result;
callback = this.callbacks[_responseObject.identifier];
result = false;
if (callback != null) {
callback(_responseObject);
delete this.callbacks[_responseObject.identifier];
result = true;
} else if (_responseObject.identifier != null) {
console.warn("No callback for identifier: " + _responseObject.identifier);
}
return result;
},
log: function(_parameters) {
this.sendToApp(this.CMD_JAVASCRIPT_LOG, _parameters);
},
sendToApp: function(_key, _value) {
var iframe = document.createElement("IFRAME");
iframe.setAttribute("src", _key + ":##airMobile_msgsnd##" + _value);
document.documentElement.appendChild(iframe);
iframe.parentNode.removeChild(iframe);
iframe = null;
},
sendCommand: function(_command, _identifier, _callback) {
var params = null;
if (_callback != null) {
_identifier = _identifier == null ? this.UUID() : _identifier;
this.callbacks[_identifier] = _callback;
params = {
identifier: _identifier
};
}
this.sendToApp(_command, JSON.stringify(params, null, true));
return _identifier;
},
UUID: function() {
return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
var r = Math.random() * 16 | 0,
v = c == 'x' ? r : (r & 0x3 | 0x8);
return v.toString(16);
});
},
listen: function(evnt, elem, func) {
if (elem.addEventListener)
{
elem.addEventListener(evnt, func, false);
} else if (elem.attachEvent)
{
return elem.attachEvent("on" + evnt, func);
}
},
initialize: function() {
var params = {
version: "2.0"
};
this.sendToApp(this.CMD_INITIALIZE, JSON.stringify(params, null, true));
},
security : {
isEnvironmentSecure : function() {
var isIOS = AIRMobile.device.operatingSystem.toLowerCase() == "iphone os";
var isAndroid = !isIOS;
if (isAndroid || (!AIRMobile.device.screenShotsEnabled() && AIRMobile.device.guidedAccessEnabled)) {
return true;
}else {
return false;
}
},
enableLockdown : function() {
},
clearCache : function() {
AIRMobile.sendCommand(AIRMobile.CMD_CLEAR_WEB_CACHE, null, null);
},
clearCookies : function() {
AIRMobile.sendCommand(AIRMobile.CMD_CLEAR_WEB_COOKIES, null, null);
},
getMACAddress : function() {
return AIRMobile.device.macAddress;
},
getIPAddressList : function() {
return AIRMobile.device.ipAddress;
},
getProcessList : function() {
return AIRMobile.device.runningProcesses;
},
close : function(_restart) {
if (!_restart) {
AIRMobile.exitApplication(null, null);
}else {
AIRMobile.restartApplication(null, null);
}
},
getStartTime : function() {
return AIRMobile.device.startTime;
},
getDeviceInfo : function() {
var deviceInfo;
deviceInfo = ('Manufacturer=' + AIRMobile.device.manufacturer);
deviceInfo += ('|HWVer=' + AIRMobile.device.model);
deviceInfo += ('|SWVer=' + AIRMobile.device.operatingSystemVersion);
return deviceInfo;
}
},
tts : {
speak: function(_textToSpeak, _options, _callback) {
var params = null;
var _identifier = null;
if (_callback != null) {
_identifier = AIRMobile.UUID();
AIRMobile.callbacks[_identifier] = _callback;
params = {
identifier: _identifier,
textToSpeak: _textToSpeak
};
if (_options != null) {
params.options = _options;
}
}
if (AIRMobile.device.operatingSystem.toLowerCase() == "iphone os") {
AIRMobile.sendToApp(AIRMobile.CMD_SPEAK_TEXT, encodeURIComponent(JSON.stringify(params, null, true)));
} else {
AIRMobile.sendToApp(AIRMobile.CMD_SPEAK_TEXT, JSON.stringify(params, null, true));
}
return _identifier;
},
stop : function(_identifier, _callback) {
return AIRMobile.sendCommand(AIRMobile.CMD_STOP_SPEAKING, _identifier, _callback);
},
getStatus : function() {
return AIRMobile.device.ttsEngineStatus;
},
pause : function() {
return AIRMobile.sendCommand(AIRMobile.CMD_PAUSE_SPEAKING, null, null);
},
resume : function() {
return AIRMobile.sendCommand(AIRMobile.CMD_RESUME_SPEAKING, null, null);
},
getVoices : function(){
return AIRMobile.device.ttsVoices;
},
},
};
AIRMobile.listen("load", window, function() {
AIRMobile.initialize();
});
AIRMobile.recorder = {
EVENT_INITIALIZING: "INITIALIZING",
EVENT_READY: "READY",
EVENT_ERROR: "ERROR",
EVENT_START: "START",
EVENT_INPROGRESS: "INPROGRESS",
EVENT_END: "END",
EVENT_PLAYBACK_START: "PLAYBACK_START",
EVENT_PLAYBACK_END: "PLAYBACK_END",
EVENT_PLAYBACK_PAUSED: "PLAYBACK_PAUSED",
EVENT_PLAYBACK_RESUMED: "PLAYBACK_RESUMED",
EVENT_PLAYBACK_STOPPED: "PLAYBACK_STOPPED",
EVENT_PLAYBACK_ERROR: "PLAYBACK_ERROR",
STATUS_IDLE: "IDLE",
STATUS_ACTIVE: "ACTIVE",
STATUS_INITIALIZING: "INITIALIZING",
STATUS_ERROR: "ERROR",
STATUS_STOPPING: "STOPPING",
PLAYBACK_STATE_IDLE: "IDLE",
PLAYBACK_STATE_PLAYING: "PLAYING",
PLAYBACK_STATE_PAUSED: "PAUSED",
CMD_INITIALIZE_RECORDER: "cmdInitializeRecorder",
CMD_END_AUDIO_CAPTURE: "cmdEndAudioCapture",
CMD_START_AUDIO_CAPTURE: "cmdStartAudioCapture",
CMD_PLAY_AUDIO: "cmdPlaybackAudio",
CMD_STOP_PLAYBACK: "cmdStopAudioPlayback",
CMD_PAUSE_PLAYBACK: "cmdPauseAudioPlayback",
CMD_RESUME_PLAYBACK: "cmdResumeAudioPlayback",
CMD_REQUEST_AUDIO_FILE_LIST: "cmdRequestAudioFileList",
CMD_REQUEST_AUDIO_FILE: "cmdRequestAudioFile",
CMD_CLEAR_AUDIO_CACHE: "cmdRequestClearAudioCache",
status: "unknown",
playbackStatus: "IDLE",
capabilities: null,
initialize: function(_eventListener) {
this.status = this.STATUS_INITIALIZING;
AIRMobile.listen(AIRMobile.recorder.EVENT_INITIALIZING, document, _eventListener);
AIRMobile.listen(AIRMobile.recorder.EVENT_READY, document, _eventListener);
AIRMobile.listen(AIRMobile.recorder.EVENT_ERROR, document, _eventListener);
AIRMobile.dispatchEvent(this.EVENT_INITIALIZING);
var params = {
identifier: AIRMobile.UUID()
};
AIRMobile.sendToApp(AIRMobile.recorder.CMD_INITIALIZE_RECORDER, JSON.stringify(params, null, true));
return params.identifier;
},
getStatus: function() {
return this.status;
},
getCapabilities: function() {
if (this.status == "unknown") {
throw new Error("Recorder not initialized");
}
return this.capabilities;
},
startCapture: function(_options, _eventListener) {
if (this.status == AIRMobile.recorder.STATUS_IDLE) {
var errorMessage = this.errorMessageForOptions(_options);
if (errorMessage == null) {
_options.identifier = AIRMobile.UUID();
if(!_options.filename)
{
_options.filename = _options.identifier;
}
AIRMobile.listen(this.EVENT_START, document, _eventListener);
AIRMobile.listen(this.EVENT_END, document, _eventListener);
AIRMobile.listen(this.EVENT_INPROGRESS, document, _eventListener);
AIRMobile.listen(this.EVENT_ERROR, document, _eventListener);
this.status = this.STATUS_ACTIVE;
AIRMobile.dispatchEvent(this.EVENT_START);
AIRMobile.sendToApp(AIRMobile.recorder.CMD_START_AUDIO_CAPTURE, JSON.stringify(_options, null, true));
} else {
throw new Error(errorMessage);
}
} else {
throw new Error("Invalid state for recording");
}
return _options.identifier;
},
stopCapture: function() {
var params = {
identifier: AIRMobile.UUID()
};
if (this.status == AIRMobile.recorder.STATUS_ACTIVE) {
AIRMobile.sendToApp(AIRMobile.recorder.CMD_END_AUDIO_CAPTURE, JSON.stringify(params, null, true));
} else {
throw new Error("Recorder not recording");
}
return params.identifier;
},
play: function(_audioData, _eventListener) {
if(_audioData.type == 'filename' && _audioData.data == null)
{
_audioData.data = _audioData.filename;
}
var params = {
identifier: AIRMobile.UUID(),
audioInfo: _audioData
};
if(this.playbackStatus == this.PLAYBACK_STATE_IDLE)
{
AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_START, document, _eventListener);
AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_END, document, _eventListener);
AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_PAUSED, document, _eventListener);
AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_RESUMED, document, _eventListener);
AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_STOPPED, document, _eventListener);
AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_ERROR, document, _eventListener);
AIRMobile.sendToApp(this.CMD_PLAY_AUDIO, JSON.stringify(params, null, true));
return params.identifier;
}
else
{
throw new Error("Audio is already playing");
}
return null;
},
stopPlay: function() {
var params = {
identifier: AIRMobile.UUID()
};
if (this.playbackStatus != this.PLAYBACK_STATE_PLAYING && this.playbackStatus != this.PLAYBACK_STATE_PAUSED) {
AIRMobile.sendToApp(this.CMD_STOP_PLAYBACK, JSON.stringify(params, null, true));
throw new Error("Playback has not begun");
}
AIRMobile.sendToApp(this.CMD_STOP_PLAYBACK, JSON.stringify(params, null, true));
},
pausePlay: function() {
var params = {
identifier: AIRMobile.UUID()
};
if (this.playbackStatus != this.PLAYBACK_STATE_PLAYING) {
throw new Error("Playback has not begun");
}
AIRMobile.sendToApp(this.CMD_PAUSE_PLAYBACK, JSON.stringify(params, null, true));
},
resumePlay: function() {
var params = {
identifier: AIRMobile.UUID()
};
if (this.playbackStatus != this.PLAYBACK_STATE_PAUSED) {
throw new Error("Playback is not paused");
}
AIRMobile.sendToApp(this.CMD_RESUME_PLAYBACK, JSON.stringify(params, null, true));
},
retrieveAudioFile: function(_fileIdentifier, _callback) {
var identifier, params;
if (_callback != null) {
identifier = AIRMobile.UUID();
AIRMobile.callbacks[identifier] = _callback;
params = {
identifier: identifier,
filename: _fileIdentifier
};
}
AIRMobile.sendToApp(this.CMD_REQUEST_AUDIO_FILE, JSON.stringify(params, null, true));
},
clearAudioFileCache: function(_callback) {
var identifier, params;
if (_callback != null) {
identifier = AIRMobile.UUID();
AIRMobile.callbacks[identifier] = _callback;
params = {
identifier: identifier,
};
}
AIRMobile.sendToApp(this.CMD_CLEAR_AUDIO_CACHE, JSON.stringify(params, null, true));
},
retrieveAudioFileList: function(_callback) {
var identifier, params;
if (_callback != null) {
identifier = AIRMobile.UUID();
AIRMobile.callbacks[identifier] = _callback;
params = {
identifier: identifier
};
}
AIRMobile.sendToApp(this.CMD_REQUEST_AUDIO_FILE_LIST, JSON.stringify(params, null, true));
},
errorMessageForOptions: function(_options) {
var results, deviceID, capabilities, device;
results = true;
deviceID = _options.captureDevice;
capabilities = AIRMobile.recorder.getCapabilities();
if (this.isValidDevice(deviceID)) {
device = this.getDevice(deviceID);
if (!this.isValidOption(device.channelCounts, _options.channelCount)) {
return "Invalid channel count for device";
} else if (!this.isValidOption(device.sampleRates, _options.sampleRate)) {
return "Invalid sample rate for device";
} else if (!this.isValidOption(device.sampleSizes, _options.sampleSize)) {
return "Invalid sample size for device";
} else if (!this.isValidOption(device.formats, _options.encodingFormat)) {
return "Invalid format for device";
}
} else {
return "The recording device specified does not exist." + deviceID;
}
return null;
},
getDevice: function(_deviceID) {
var device, capabilities, dev;
device = null;
capabilities = AIRMobile.recorder.getCapabilities();
for (var i = 0; i < capabilities.supportedInputDevices.length; i++) {
dev = capabilities.supportedInputDevices[i];
if (dev.id == _deviceID) {
device = dev;
}
}
return device;
},
isValidDevice: function(_deviceID) {
var valid, capabilities, device;
valid = false;
if (_deviceID != null) {
capabilities = AIRMobile.recorder.getCapabilities();
for (var i = 0; i < capabilities.supportedInputDevices.length; i++) {
device = capabilities.supportedInputDevices[i];
if (device.id == _deviceID) {
valid = true;
}
}
}
return valid;
},
isValidOption: function(_options, _selection) {
var found = false;
for (var i = 0; i < _options.length; i++) {
var option = _options[i];
if (option == _selection) {
found = true;
}
}
return found;
}
};
AIRMobile.ntvOnPlaybackStateChanged = function(_parameters) {
var results = JSON.parse(_parameters, null);
if (results.playbackState == "playing") {
AIRMobile.recorder.playbackStatus = AIRMobile.recorder.PLAYBACK_STATE_PLAYING;
AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_START);
} else if (results.playbackState == "stopped") {
AIRMobile.recorder.playbackStatus = AIRMobile.recorder.PLAYBACK_STATE_IDLE;
AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_STOPPED);
} else if (results.playbackState == "paused") {
AIRMobile.recorder.playbackStatus = AIRMobile.recorder.PLAYBACK_STATE_PAUSED;
AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_PAUSED);
} else if (results.playbackState == "resumed") {
AIRMobile.recorder.playbackStatus = AIRMobile.recorder.PLAYBACK_STATE_PLAYING;
AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_RESUMED);
} else if (results.playbackState == "end") {
AIRMobile.recorder.playbackStatus = AIRMobile.recorder.PLAYBACK_STATE_IDLE;
AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_END);
} else if (results.playbackState == "error") {
AIRMobile.recorder.playbackStatus = AIRMobile.recorder.PLAYBACK_STATE_IDLE;
AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_ERROR);
}
};
AIRMobile.ntvOnRecorderInitialized = function(_parameters) {
var results = JSON.parse(_parameters, null);
var message = null;
if (results.state == null) {
results.state = AIRMobile.recorder.EVENT_ERROR;
}
if (results.state == AIRMobile.recorder.EVENT_ERROR) {
message = results.message != null ? results.message : "An error occured initializing the recorder";
} else if (results.state == AIRMobile.recorder.EVENT_READY) {
AIRMobile.recorder.capabilities = results.capabilities;
AIRMobile.recorder.status = this.recorder.STATUS_IDLE;
}
if (message != null) {
this.dispatchMessageEvent(results.state, message);
} else {
this.dispatchEvent(results.state);
}
};
AIRMobile.ntvOnRecorderUpdate = function(_parameters) {
var results = JSON.parse(_parameters, null);
if (results.updateType == AIRMobile.recorder.EVENT_START) {
AIRMobile.recorder.status = AIRMobile.recorder.STATUS_ACTIVE;
} else if (results.updateType == AIRMobile.recorder.EVENT_INPROGRESS) {
AIRMobile.recorder.status = AIRMobile.recorder.STATUS_ACTIVE;
} else if (results.updateType == AIRMobile.recorder.EVENT_END) {
AIRMobile.recorder.status = AIRMobile.recorder.STATUS_IDLE;
} else if (results.updateType == AIRMobile.recorder.EVENT_ERROR) {
AIRMobile.recorder.status = AIRMobile.recorder.STATUS_ERROR;
}
if (results.updateType == AIRMobile.recorder.EVENT_END) {
var messageData = JSON.stringify(results.data, null, true);
AIRMobile.dispatchMessageEvent(results.updateType, messageData);
} else {
AIRMobile.dispatchEvent(results.updateType);
}
};
AIRMobile.ntvOnAudioFileDataRetrieved = function(_parameters) {
var results = JSON.parse(_parameters, null);
AIRMobile.executeCallback(results);
};
AIRMobile.ntvOnAudioFileListRetrieved = function(_parameters) {
var results = JSON.parse(_parameters, null);
AIRMobile.executeCallback(results);
};
var console = {
log: function(log) {
setTimeout(function() {
AIRMobile.log(JSON.stringify({
type: "info",
value: log
}, null, true));
}, 100);
},
error: function(log) {
setTimeout(function() {
AIRMobile.log(JSON.stringify({
type: "error",
value: log
}, null, true));
}, 100);
},
warn: function(log) {
setTimeout(function() {
AIRMobile.log(JSON.stringify({
type: "warn",
value: log
}, null, true));
}, 100);
},
debug: function(log) {
setTimeout(function() {
AIRMobile.log(JSON.stringify({
type: "debug",
value: log
}, null, true));
}, 100);
},
info: function(log) {
setTimeout(function() {
AIRMobile.log(JSON.stringify({
type: "info",
value: log
}, null, true));
}, 100);
}
};
var diffArr = function(a, b) {
return a.filter(function(i) {
return !(b.indexOf(i) > -1);
});
};
window.AIRMobile = AIRMobile;
this.getNativeBrowser = function () { return AIRMobile; };
}

/* SOURCE FILE: factory.js (c3c9a9d8) 9/9/2014 2:09:04 PM */

TDS = window.TDS || {};
TDS.SecureBrowser = TDS.SecureBrowser || {};
(function(SB) {
var sbImpl = null,
sbRecImpl = null;
function initialize() {
if (Util.Browser.isSecure()) {
if (Util.Browser.isIOS()) {
sbImpl = new TDS.SecureBrowser.Mobile.iOS();
} else if (Util.Browser.isAndroid()) {
sbImpl = new TDS.SecureBrowser.Mobile.Android();
} else if (Util.Browser.isChrome()) {
sbImpl = new TDS.SecureBrowser.Chrome();
} else {
sbImpl = new TDS.SecureBrowser.Firefox();
}
} else if (Util.Browser.isChrome()) {
sbImpl = new TDS.SecureBrowser.Chrome();
}
if (sbImpl == null) {
sbImpl = new TDS.SecureBrowser.Base();
}
if (Util.Browser.isSecure()) {
if (Util.Browser.isIOS() || Util.Browser.isAndroid()) {
sbRecImpl = new TDS.SecureBrowser.Mobile.Recorder();
}
}
if (navigator.plugins) {
for (var i = 0; i < navigator.plugins.length; i++) {
var plugin = navigator.plugins[i];
if (plugin.name &&
(plugin.name.indexOf('AIR Audio') == 0               ||
plugin.name == 'libaudiorecorder.so'                   ||
plugin.name == 'libnpAIRAudio.so'                  )) {
sbRecImpl = new TDS.SecureBrowser.Firefox.Recorder();
break;
}
}
}
sbImpl.initialize();
}
SB.initialize = initialize;
SB.getImplementation = function() {
return sbImpl;
};
SB.getRecorder = function() {
return sbRecImpl;
};
})(TDS.SecureBrowser);

/* SOURCE FILE: base.js (c1c0dae1) 10/26/2014 1:27:05 PM */

TDS = window.TDS || {};
TDS.SecureBrowser = TDS.SecureBrowser || {};
(function(SB) {
function Base() {
this.Events = {
onSecurityBreach: new YAHOO.util.CustomEvent('onSecurityBreach', this, false, YAHOO.util.CustomEvent.FLAT),
};
Util.Event.Emitter(this);
YUE.on(window, 'beforeunload', function () {
this.fire('dispose');
this.dispose();
}.bind(this));
};
Base.prototype.initialize = function () { };
Base.prototype.dispose = function() { };
Base.prototype.isEnvironmentSecure = function() {
return true;
};
Base.prototype.clearCache = function() {
return false;
};
Base.prototype.clearCookies = function() {
return false;
};
Base.prototype.clearHistory = function() {
this.clearCache();
this.clearCookies();
};
Base.prototype.emptyClipBoard = function() { return false; };
Base.prototype.getMACAddress = function() { return null; };
Base.prototype.getIPAddressList = function(bypassCache) { return []; };
Base.prototype.getIPAddress = function(bypassCache) {
var addressList = this.getIPAddressList();
if (addressList != null && addressList.length > 0) {
return addressList[0];
}
return null;
};
Base.prototype.loadProcessList = function() {
return false;
};
Base.prototype.getProcessList = function() {
return [];
};
Base.prototype.getForbiddenApps = function() {
var currentForbiddenApps = [];
if (typeof (TDS) != 'object' ||
typeof (TDS.Config) != 'object' ||
typeof (TDS.Config.forbiddenApps) != 'object' ||
(TDS.Config.forbiddenApps == null)) {
return currentForbiddenApps;
}
var processList = this.getProcessList();
if (processList) {
Util.Array.each(processList, function(currentProcess) {
var processName = currentProcess;
var parentProcessName = '';
if (currentProcess.indexOf("|") > -1) {
var processInfoArray = currentProcess.split("|");
processName = processInfoArray[0];
parentProcessName = processInfoArray[1];
}
var matchingApp = Util.Array.find(TDS.Config.forbiddenApps, function(forbiddenApp) {
if (Util.String.equals(forbiddenApp.name, processName, {
trim: true,
ignoreCase: true
})) {
if (Util.String.isNullOrEmpty(parentProcessName) || Util.String.isNullOrEmpty(forbiddenApp.exemptions)) {
return true;
} else {
var exemptionList = forbiddenApp.exemptions.split(",");
var exemptionMatchFound = Util.Array.find(exemptionList, function(exemption) {
return (parentProcessName.indexOf(exemption) > -1);
});
return (exemptionMatchFound == null);
}
}
});
if (matchingApp != null) {
currentForbiddenApps.push(matchingApp);
}
});
}
return currentForbiddenApps;
};
Base.prototype.fixFocus = function() {
return false;
};
Base.prototype.close = function() {
if (typeof TDS.logout == 'function') {
TDS.logout();
}
return false;
};
Base.prototype.getAppStartTime = function() {
if (window.sessionStorage.getItem("appStartTime") != null) {
return Date.parse(window.sessionStorage.getItem("appStartTime"));
}
return null;
};
Base.prototype.setAppStartTime = function(timestamp, forceSet) {
if (forceSet || this.getAppStartTime() == null) {
window.sessionStorage.setItem("appStartTime", timestamp);
}
};
Base.prototype.getRunTime = function() {
return null;
};
Base.prototype.enableLockDown = function(lockDown) {
return false;
};
Base.prototype.mute = function() {
return false;
};
Base.prototype.unmute = function() {
return false;
};
Base.prototype.isMuted = function() {
return false;
};
Base.prototype.enablePermissiveMode = function(enabled) {};
Base.prototype.enableChromeMode = function(enabled) {
};
Base.prototype.getVolume = function() {
return -1;
};
Base.prototype.setVolume = function(percent) {
return false;
};
Base.prototype.HKEY_CURRENT_USER = 0x80000001;
Base.prototype.HKEY_LOCAL_MACHINE = 0x80000002;
Base.prototype.readRegistryValue = function (hkey, key, name) {
return null;
};
SB.Base = Base;
})(TDS.SecureBrowser);

/* SOURCE FILE: firefox.js (653f1cd0) 10/26/2014 1:27:05 PM */

(function(SB) {
function Firefox() {
Firefox.superclass.constructor.call(this);
this.runtime = null;
this._ignoringBreachEvents = null;
};
YAHOO.lang.extend(Firefox, TDS.SecureBrowser.Base);
Firefox.prototype.initialize = function() {
try {
if (typeof (Runtime) == 'function') {
this.runtime = new Runtime();
} else {
var success = Mozilla.execPrivileged(function() {
var sbClass = Components.classes["@mozilla.org/securebrowser;1"];
if (sbClass) {
this.runtime = sbClass.createInstance(Components.interfaces.mozISecureBrowser);
}
}.bind(this));
if (!success) {
console.log('SB runtime component failed to load');
}
}
if (!this.runtime) {
return;
}
this.enableSecurityBreachDetection();
} catch (ex) {
}
};
Firefox.prototype.dispose = function () {
console.log('Disposing SB runtime...');
if (this.runtime != null) {
delete this.runtime;
this.runtime = null;
}
this.disableSecurityBreachDetection();
};
Firefox.prototype._hasAPI = function() {
return (typeof (SecureBrowser) != 'undefined');
};
Firefox.prototype._hasRuntime = function() {
return (this.runtime != null);
};
Firefox.prototype.clearCache = function() {
try {
if (this._hasAPI()) {
SecureBrowser.clearCache();
return true;
}
} catch (ex) {
}
return false;
};
Firefox.prototype.clearCookies = function() {
try {
if (this._hasAPI()) {
SecureBrowser.clearCookies();
return true;
}
} catch (ex) {
}
return false;
};
Firefox.prototype.emptyClipBoard = function() {
try {
if (this._hasAPI()) {
SecureBrowser.emptyClipBoard();
return true;
}
} catch (ex) {
}
return false;
};
Firefox.prototype.getMACAddress = function() {
var mac = null;
try {
if (this._hasRuntime()) {
mac = this.runtime.getMACAddress();
mac.toUpperCase();
}
} catch (e) {
}
return mac;
};
Firefox.prototype._getIPAddressList = function(bypassCache) {
if (!this._hasRuntime()) {
return null;
}
if (!YAHOO.util.Lang.isBoolean(bypassCache)) {
bypassCache = false;
}
var dnsService = Components.classes["@mozilla.org/network/dns-service;1"].getService(Components.interfaces.nsIDNSService);
var record = dnsService.resolve(dnsService.myHostName, bypassCache);
var addressList = [];
while (record.hasMore()) {
var address = record.getNextAddrAsString();
addressList.push(address);
}
return addressList;
};
Firefox.prototype.getIPAddressList = function(bypassCache) {
var addressList = null;
try {
addressList = this._getIPAddressList(bypassCache);
} catch (ex) {
}
return addressList;
};
Firefox.prototype.getProcessList = function(allowDups) {
var processList = [];
if (this._hasRuntime()) {
try {
var processString = this.runtime.getRunningProcessList();
processList = processString.split(',');
if (typeof (this.runtime.services) == "string") {
var serviceString = this.runtime.services;
if (!Util.String.isNullOrEmpty(serviceString)) {
var serviceList = serviceString.split(',');
serviceList = serviceList.map(function(service) {
return service + '|unavailable';
});
processList = processList.concat(serviceList);
}
}
} catch (e) {
}
}
for (var i = 0; i < processList.length; i++) {
processList[i] = YAHOO.lang.trim(processList[i]).toLowerCase();
}
processList = (allowDups === true) ? processList : Util.Array.unique(processList);
return processList;
};
Firefox.prototype.fixFocus = function() {
var stopIgnoringBreachEvents = function() {
this._ignoringBreachEvents = null;
Util.log("Resuming breach detection");
};
if (this._ignoringBreachEvents) {
clearTimeout(this._ignoringBreachEvents);
}
this._ignoringBreachEvents = setTimeout(stopIgnoringBreachEvents.bind(this), 1000);
Util.log("Suspending breach detection");
try {
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
var wm = Components.classes["@mozilla.org/appshell/window-mediator;1"].getService(Components.interfaces.nsIWindowMediator);
var w = wm.getMostRecentWindow("navigator:browser");
var hiddenWindowRef = w.openDialog("chrome://bmakiosk/content/hiddenWindow.xul", "hidden", "alwaysLowered=yes,titlebar=no");
setTimeout(function() {
if (hiddenWindowRef != null) {
hiddenWindowRef.close();
}
hiddenWindowRef = null;
}, 1);
Util.log('SecureBrowser: Fixed focus success');
return true;
} catch (ex) {
Util.log('SecureBrowser: Fixed focus failed - ' + ex);
}
return false;
};
Firefox.prototype.close = function() {
if (Util.Browser.isMac() && (Util.Browser.getOSXVersion() >= 10.8) && (Util.Browser.getSecureVersion() <= 6.2)) {
var screenshotsEnabled = Mozilla.enableScreenshots();
if (screenshotsEnabled) {
Util.log('Screenshots are enabled.');
} else {
Util.log('Screenshots are not enabled.');
}
}
try {
window.dispatchEvent(new Event('beforeunload'));
} catch(ex) {
}
setTimeout(function() {
try {
SecureBrowser.CloseWindow();
} catch(ex) {
}
}, 1000);
};
Firefox.prototype.getAppStartTime = function() {
try {
var startTimePref = Mozilla.getPreference("bmakiosk.startup.timestamp");
if (startTimePref != null) {
return Date.parse(startTimePref);
}
} catch (e) {
}
if (window.sessionStorage.getItem("appStartTime") != null) {
return Date.parse(window.sessionStorage.getItem("appStartTime"));
}
return null;
};
Firefox.prototype._hasNativeMute = function() {
var winVer = Util.Browser.getWindowsNTVersion();
return (winVer >= 6.0 && typeof this.runtime.systemMute == 'boolean');
};
Firefox.prototype.mute = function() {
try {
if (this._hasRuntime()) {
if (this._hasNativeMute()) {
console.log('mute native');
this.runtime.systemMute = true;
return true;
} else if (this.runtime.systemVolume != null) {
console.log('mute volume');
Util.Storage.set('tds-mutedVolume', this.runtime.systemVolume);
this.runtime.systemVolume = 0;
return true;
}
}
} catch (ex) {
console.error(ex);
}
return false;
};
Firefox.prototype.unmute = function() {
try {
if (this._hasRuntime()) {
if (this._hasNativeMute()) {
console.log('unmute native');
this.runtime.systemMute = false;
return true;
} else if (this.runtime.systemVolume === 0) {
var mutedVolume = Util.Storage.get('tds-mutedVolume');
if (mutedVolume) {
console.log('unmute volume: ' + mutedVolume);
this.runtime.systemVolume = mutedVolume;
return true;
}
}
}
} catch (ex) {
console.error(ex);
}
return false;
};
Firefox.prototype.isMuted = function() {
try {
if (this._hasRuntime()) {
if (this._hasNativeMute()) {
return (this.runtime.systemMute === true);
} else {
return (this.runtime.systemVolume === 0);
}
}
} catch (ex) {
console.error(ex);
}
return false;
};
Firefox.prototype.getVolume = function(checkMute) {
try {
if (this._hasRuntime()) {
if (checkMute && this.isMuted()) {
return 0;
} else {
return this.runtime.systemVolume * 10;
}
}
} catch (ex) {
console.error(ex);
}
return -1;
};
Firefox.prototype.setVolume = function(percent, checkMute) {
try {
if (this._hasRuntime()) {
var level = Math.round(percent / 10);
console.log('set volume: ' + level);
this.runtime.systemVolume = level;
if (checkMute && percent > 0 && this.isMuted()) {
this.unmute();
}
return true;
}
} catch (ex) {
console.error(ex);
}
return false;
};
Firefox.prototype.enablePermissiveMode = function(enabled) {
var changed = false;
try {
if (this._hasRuntime() &&
typeof this.runtime.permissive == 'boolean') {
this.runtime.permissive = enabled;
changed = true;
}
} catch (ex) {
}
if (changed && Util.Browser.isMac()) {
var availWidth = screen.availWidth;
var availHeight = screen.availHeight;
Mozilla.resizeWindowTo(availWidth, availHeight);
}
return changed;
};
Firefox.prototype.enableChromeMode = function(enabled) {
try {
if (typeof SecureBrowser == 'object' &&
typeof SecureBrowser.showChrome == 'function') {
SecureBrowser.showChrome(enabled);
return true;
}
} catch (ex) {
}
return false;
};
Firefox.prototype.enableSecurityBreachDetection = function() {
var self = this;
var observer =
{
QueryInterface: function(iid) {
if (iid.equals(Components.interfaces.nsISupports) ||
iid.equals(Components.interfaces.nsIObserver)) {
return this;
}
throw Components.results.NS_ERROR_NO_INTERFACE;
},
observe: function(subject, topic, data) {
if (topic == "sb-security-breach" && !self._ignoringBreachEvents) {
Util.log('Security breach detected!');
var notification = { type: 'sb-security-breach', message: 'Event from SB' };
self.Events.onSecurityBreach.fire(notification);
}
}
};
try {
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
var os = Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService);
os.addObserver(observer, "sb-security-breach", false);
Util.log('Listening for sb-security-breach events');
} catch (e) {
Util.log(e.message);
}
};
Firefox.prototype.disableSecurityBreachDetection = function() {
try {
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
var os = Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService);
var observers = os.enumerateObservers('sb-security-breach');
while (observers.hasMoreElements()) {
os.removeObserver(observers.getNext(), 'sb-security-breach');
}
Util.log('Removing all observers for sb-security-breach events');
} catch (e) {
Util.log(e.message);
}
};
function parseRegistryValue(wrk, value) {
switch (wrk.getValueType(value)) {
case wrk.TYPE_STRING:
return wrk.readStringValue(value);
case wrk.TYPE_BINARY:
return wrk.readBinaryValue(value);
case wrk.TYPE_INT:
return wrk.readIntValue(value);
case wrk.TYPE_INT64:
return wrk.readInt64Value(value);
}
return null;
}
function readRegistryValue(hkey, key, valueName) {
var value = null;
var regClass = Components.classes["@mozilla.org/windows-registry-key;1"];
var registry = regClass.createInstance(Components.interfaces.nsIWindowsRegKey);
registry.open(hkey, key, registry.ACCESS_READ);
if (registry.hasValue(valueName)) {
value = parseRegistryValue(registry, valueName);
}
registry.close();
return value;
}
Firefox.prototype.readRegistryValue = function (hkey, key, valueName) {
var value = null;
Mozilla.execPrivileged(function() {
try {
value = readRegistryValue(hkey, key, valueName);
} catch (ex) {
}
});
return value;
};
SB.Firefox = Firefox;
})(TDS.SecureBrowser);

/* SOURCE FILE: chrome.js (003bd1e2) 10/26/2014 1:27:05 PM */

(function (SB) {
function Chrome() {
Chrome.superclass.constructor.call(this);
};
YAHOO.lang.extend(Chrome, TDS.SecureBrowser.Base);
Chrome.prototype.initialize = function() {
TDS.AppWindow = window;
var bootstrap = function (event) {
if (event.data.type && event.data.type == "CHROME RESPONSE" && event.data.command == "APP WELCOME") {
TDS.AppWindow = event.source;
window.removeEventListener(bootstrap);
}
};
window.addEventListener("message", bootstrap, true);
};
Chrome.prototype.enableLockDown = function (lockDown) {
TDS.AppWindow.postMessage({ type: "CHROME COMMAND", command: "UI FULLSCREEN", params: { enable: lockDown, interval: 500 } }, "*");
};
Chrome.prototype.close = function () {
TDS.AppWindow.postMessage({ type: "CHROME COMMAND", command: "APP CLOSE", params: {} }, "*");
if (typeof TDS.logout == 'function') TDS.logout();
return false;
};
SB.Chrome = Chrome;
})(TDS.SecureBrowser);

/* SOURCE FILE: mobile.android.js (166965b6) 9/9/2014 2:09:04 PM */

TDS.SecureBrowser.Mobile = TDS.SecureBrowser.Mobile || {};
TDS.SecureBrowser.Mobile.Android = function () {
TDS.SecureBrowser.Mobile.Android.superclass.constructor.call(this);
this._config = { pausedSinceLaunch: false, keyboardChanged: false, clipboardChanged: false };
this._airMobile = (new Summit.SecureBrowser.Mobile()).getNativeBrowser();
this._airMobile.initialize();
};
YAHOO.lang.extend(TDS.SecureBrowser.Mobile.Android, TDS.SecureBrowser.Base);
TDS.SecureBrowser.Mobile.Android.prototype.initialize = function () {
var sb = this._airMobile;
var config = this._config;
sb.listen(sb.EVENT_DEVICE_READY, window.document, function () {
sb.listen(sb.EVENT_RETURN_FROM_BACKGROUND, window.document, function () {
config.pausedSinceLaunch = true;
});
if (sb.device.keyboard != 'com.air.mobilebrowser/.softkeyboard.SoftKeyboard') {
config.keyboardChanged = true;
}
sb.listen(sb.EVENT_KEYBOARD_CHANGED, window.document, function () {
config.keyboardChanged = true;
});
sb.listen(sb.EVENT_CLIPBOARD_CHANGED, window.document, function () {
config.clipboardChanged = true;
});
sb.listen(sb.EVENT_MINI_APP_DETECTED, window.document, function () {
config.pausedSinceLaunch = true;
});
});
};
TDS.SecureBrowser.Mobile.Android.prototype.isEnvironmentSecure = function () {
return (!this._config.pausedSinceLaunch && !this._config.keyboardChanged && !this._config.clipboardChanged);
};
TDS.SecureBrowser.Mobile.Android.prototype.getRunTime = function () {
return this._airMobile;
}

/* SOURCE FILE: mobile.ios.js (ea558bfc) 10/26/2014 1:27:05 PM */

TDS.SecureBrowser.Mobile = TDS.SecureBrowser.Mobile || {};
TDS.SecureBrowser.Mobile.iOS = function () {
TDS.SecureBrowser.Mobile.iOS.superclass.constructor.call(this);
this._guidedAccessMode = 'unknown';
this._processes = [];
this._backgroundThreshold = 5;
this._airMobile = (new Summit.SecureBrowser.Mobile()).getNativeBrowser();
this._airMobile.initialize();
};
YAHOO.lang.extend(TDS.SecureBrowser.Mobile.iOS, TDS.SecureBrowser.Base);
TDS.SecureBrowser.Mobile.iOS.prototype.loadProcessList = function () {
this.setProcessList();
};
TDS.SecureBrowser.Mobile.iOS.prototype.getProcessList = function () {
this.setProcessList();
return this._processes;
};
TDS.SecureBrowser.Mobile.iOS.prototype.setBackgroundThreshold = function (value) {
this._backgroundThreshold = value;
};
TDS.SecureBrowser.Mobile.iOS.prototype.initialize = function () {
var secBrowser = this._airMobile;
var guidedAccessMode = this._guidedAccessMode;
var backgroundThreshold = this._backgroundThreshold;
var startTimeBackground = null;
var hasBeenBackgrounded = false;
this.getHasBeenBackgrounded = function () { return hasBeenBackgrounded; };
this.setProcessList = function () { this._processes = secBrowser.device.runningProcesses; };
var isLockedDown = true;
var isAutonomousGuidedAccessEnabled;
function checkAutonomousGuidedAccess() {
if (typeof (isAutonomousGuidedAccessEnabled) == 'undefined') {
if (Util.Browser.getIOSVersion() >= 7) {
isAutonomousGuidedAccessEnabled = TDS.getAppSetting('sb.iosAutonomousGuidedAccessAllowed', false);
} else {
isAutonomousGuidedAccessEnabled = false;
}
}
}
this.getGuidedAccessMode = function () {
checkAutonomousGuidedAccess();
if (typeof (isAutonomousGuidedAccessEnabled) == 'undefined') {
return 'true';
} else if (!isAutonomousGuidedAccessEnabled) {
return guidedAccessMode;
} else if (isLockedDown) {
return guidedAccessMode;
} else {
return 'true';
}
};
this.setLockDown = function (lockdown) {
isLockedDown = lockdown;
if (!lockdown) {
hasBeenBackgrounded = false;
if (guidedAccessMode == 'true') {
secBrowser.enableGuidedAccess(lockdown, null, function (enableResults) {
if (enableResults.didSucceed) {
guidedAccessMode = 'false';
}
});
}
} else if (isAutonomousGuidedAccessEnabled && guidedAccessMode == 'false') {
secBrowser.enableGuidedAccess(lockdown, null, function (enableResults) {
if (enableResults.didSucceed) {
guidedAccessMode = 'true';
}
});
}
};
secBrowser.checkGuidedAccessStatus(null, function (results) {
if (results.enabled) {
guidedAccessMode = 'true';
} else {
guidedAccessMode = 'false';
}
Util.log("access mode recorded is .. " + guidedAccessMode);
});
secBrowser.listen(secBrowser.EVENT_GUIDED_ACCESS_CHANGED, document, function () {
if (secBrowser.device.guidedAccessEnabled) {
guidedAccessMode = 'true';
} else {
guidedAccessMode = 'false';
}
Util.log("access mode now is changed to ... " + guidedAccessMode);
});
secBrowser.listen(secBrowser.EVENT_ENTER_BACKGROUND, document, function () {
if (isLockedDown) {
startTimeBackground = (new Date()).getTime();
}
Util.log("the browser has been pushed to the background");
});
secBrowser.listen(secBrowser.EVENT_RETURN_FROM_BACKGROUND, document, function () {
if (isLockedDown) {
if (startTimeBackground != null) {
var endTimeBackground = (new Date()).getTime();
if ((endTimeBackground - startTimeBackground) > (backgroundThreshold * 1000)) {
hasBeenBackgrounded = true;
}
startTimeBackground = null;
}
}
Util.log("the browser has been put to the background");
});
};
TDS.SecureBrowser.Mobile.iOS.prototype.enableLockDown = function (lockDown) {
this.setLockDown(lockDown);
};
TDS.SecureBrowser.Mobile.iOS.prototype.isEnvironmentSecure = function () {
return ((this.getGuidedAccessMode() == 'true') && (!this.getHasBeenBackgrounded()));
};
TDS.SecureBrowser.Mobile.iOS.prototype.getRunTime = function () {
return this._airMobile;
};

/* SOURCE FILE: base.recorder.js (bfcc1bd9) 9/9/2014 2:09:04 PM */

(function(SB) {
var Event = {
DEVICE_INITIALIZING: "INITIALIZING",
DEVICE_READY: "READY",
DEVICE_ERROR: "ERROR",
CAPTURE_START: "START",
CAPTURE_INPROGRESS: "INPROGRESS",
CAPTURE_END: "END",
PLAYBACK_START: "PLAYBACK_START",
PLAYBACK_END: "PLAYBACK_END",
PLAYBACK_PAUSED: "PLAYBACK_PAUSED",
PLAYBACK_RESUMED: "PLAYBACK_RESUMED",
PLAYBACK_STOPPED: "PLAYBACK_STOPPED",
PLAYBACK_ERROR: "PLAYBACK_ERROR",
STATUS_IDLE: "IDLE",
STATUS_ACTIVE: "ACTIVE",
STATUS_INITIALIZING: "INITIALIZING",
STATUS_ERROR: "ERROR",
STATUS_STOPPING: "STOPPING"
};
var Recorder = function() {
};
Recorder.Event = Event;
Recorder.prototype.initialize = function(eventListener) {
};
Recorder.prototype.getStatus = function() {
return 'UNKNOWN';
};
Recorder.prototype.getCapabilities = function() {
return null;
};
Recorder.prototype.getDefaultOptions = function() {
return {};
};
Recorder.prototype.startCapture = function(options, eventListener) {
};
Recorder.prototype.stopCapture = function() {
};
Recorder.prototype.play = function(audioData, eventListener) {
};
Recorder.prototype.stopPlay = function() {
};
Recorder.prototype.pausePlay = function() {
};
Recorder.prototype.resumePlay = function() {
};
Recorder.prototype.loadAudioFile = function(fileIdentifier, callback) {
};
Recorder.prototype.retrieveAudioFileList = function(fileIdentifier, callback) {
};
Recorder.prototype.retrieveAudioFile = function(fileIdentifier, callback) {
};
Recorder.prototype.clearAudioFileCache = function(callback) {
};
Recorder.prototype.getLogs = function() {
return [];
};
SB.Base.Recorder = Recorder;
})(TDS.SecureBrowser);

/* SOURCE FILE: firefox.recorder.js (fb7be3d0) 9/9/2014 2:09:04 PM */

(function (SB) {
var logs = [];
function addLog(msg) {
var log = {
timestamp: new Date(),
message: msg
};
logs.push(log);
}
var Event = SB.Base.Recorder.Event;
var api = null;
var currentListener = null;
var currentFile = null;
function isPPC() {
return (Util.Browser.getSecureVersion() >= 5.6 &&
Util.Browser.getSecureVersion() <= 5.9);
}
var observerService = null;
function getEventType(type) {
switch (type) {
case 'AUDIOERROR': return Event.DEVICE_ERROR;
case 'PLAYSTART': return Event.PLAYBACK_START;
case 'PLAYSTOP': return Event.PLAYBACK_STOPPED;
case 'PLAYPAUSED': return Event.PLAYBACK_PAUSED;
case 'PLAYRESUMED': return Event.PLAYBACK_RESUMED;
default: return type;
}
}
function getAudioFileList() {
var listValue = Util.Storage.get('recorder-list');
if (listValue) {
return listValue;
} else {
return [];
}
}
function getAudioFile(filename) {
return Util.Storage.get('recorder-data-' + filename);
}
function setAudioFile(fileIdentifier, obj) {
var list = getAudioFileList();
list.push(fileIdentifier);
Util.Storage.set('recorder-list', list);
if (!Util.String.contains(obj.data, '"filename"')) {
obj.data = obj.data.replace('"qualityIndicator"', '"filename" : "' + fileIdentifier + '",\n"qualityIndicator"');
}
obj.data = obj.data.replace(/\n/g, '');
Util.Storage.setString('recorder-data-' + fileIdentifier, obj.data);
}
var recordTimer = null;
function startRecordTimer(duration            ) {
recordTimer = YAHOO.lang.later(duration * 1000, this, checkRecordTimer);
}
function stopRecordTimer() {
if (recordTimer) {
recordTimer.cancel();
recordTimer = null;
}
}
function checkRecordTimer() {
recordTimer = null;
if (api.getStatus() == 'ACTIVE') {
api.stopCapture();
}
}
function processEvent(evt) {
if (evt.type == 'AUDIOERROR') {
var status = api.getStatus();
addLog('Error: \'' + evt.detail + '\' (' + status + ')');
if (status == 'ERRORSTAT') {
console.error('SB Recorder Error: \'' + evt.detail + '\'');
} else {
console.warn('SB Recorder Warn: \'' + evt.detail + '\'');
return;
}
} else if (evt.type != 'INPROGRESS') {
console.log('SB Recorder Event: \'' + evt.type + '\'');
addLog('Event: \'' + evt.type + '\'');
}
var obj = {
type: getEventType(evt.type),
data: (evt.detail || null)
};
if (typeof currentListener == 'function') {
(function (eventListener) {
setTimeout(function () {
eventListener(obj);
}, 0);
})(currentListener);
}
if (obj.type == 'END') {
stopRecordTimer();
setAudioFile(currentFile, obj);
}
}
var eventNames = [
'INITIALIZING', 'READY', 'AUDIOERROR',
'START', 'INPROGRESS', 'END',
'PLAYSTART', 'PLAYSTOP', 'PLAYPAUSED', 'PLAYRESUMED'
];
var AudioRecorderObserver = {
observe: function (subject, topic, data) {
var obj = { type: topic };
if (topic == "END") {
obj = { type: topic, data: "", detail: data };
}
processEvent(obj);
}
};
function addListeners(doc) {
if (isPPC()) {
for (var i = 0; i < eventNames.length; i++) {
observerService.addObserver(AudioRecorderObserver, eventNames[i], false);
}
} else {
for (var i = 0; i < eventNames.length; i++) {
YUE.addListener(doc, eventNames[i], processEvent, this, true);
}
}
}
function removeListeners(doc) {
if (isPPC()) {
for (var i = 0; i < eventNames.length; i++) {
observerService.removeObserver(AudioRecorderObserver, eventNames[i]);
}
} else {
for (var i = 0; i < eventNames.length; i++) {
YUE.removeListener(doc, eventNames[i], processEvent, this, true);
}
}
}
function createAPI() {
addLog('API: Creating');
var embed = Util.Frame.injectEmbed('recorderFrame', 'application/airaudio');
if (isPPC()) {
var embedDoc = Util.Dom.getOwnerDocument(embed);
var embedWin = Util.Dom.getWindow(embedDoc);
var embedComponents = embedWin.Components;
observerService = embedComponents.classes["@mozilla.org/observer-service;1"].getService(embedComponents.interfaces.nsIObserverService);
embedWin.AudioRecorderObserverService = observerService;
}
addListeners(Util.Dom.getOwnerDocument(embed));
addLog('API: Created');
return embed;
}
function removeAPI() {
addLog('API: Removing');
try {
api.clean();
} catch(ex) {
console.error(ex);
}
var apiDoc = Util.Dom.getOwnerDocument(api);
var apiWin = Util.Dom.getWindow(apiDoc);
removeListeners(apiDoc);
Util.Dom.removeNode(api);
if (apiWin.frameElement) {
Util.Dom.removeNode(apiWin.frameElement);
}
api = null;
addLog('API: Removed');
}
function Recorder() {
Recorder.superclass.constructor.call(this);
}
YAHOO.lang.extend(Recorder, TDS.SecureBrowser.Base.Recorder);
Recorder.prototype.getNative = function() {
return api;
};
Recorder.prototype.dispose = function() {
removeAPI();
};
Recorder.prototype.getLogs = function () {
return logs;
};
Recorder.prototype.initialize = function (eventListener) {
var delay = 0;
if (api) {
delay = 500;
try {
var status = api.getStatus();
if (status == 'ACTIVE') {
api.stopCapture();
} else if (status == 'PLAYING') {
api.stopPlay();
}
} catch(ex) {
console.error(ex);
}
}
currentListener = eventListener;
setTimeout(function () {
if (api) {
removeAPI();
}
setTimeout(function () {
addLog('API: Initialize');
api = createAPI();
if (api && api.initialize) {
api.initialize();
} else {
console.error('Could not call initialize on the recorder API.');
}
}, delay);
}, delay);
};
Recorder.prototype.getCapabilities = function () {
var str = api.getCapabilities();
if (str && str.length > 0) {
addLog('API: Capabilities: ' + str);
return JSON.parse(str);
} else {
return null;
}
};
Recorder.prototype.getStatus = function () {
return api.getStatus();
};
Recorder.prototype.startCapture = function (options, eventListener) {
currentListener = eventListener;
if (options.filename) {
currentFile = options.filename;
} else {
currentFile = Util.String.getUUID() + '.' + options.encodingFormat.toLowerCase();
}
if (options.captureLimit) {
if (options.captureLimit.size) {
options.captureLimit.type = 'size';
options.captureLimit.limit = options.captureLimit.size;
}
else if (options.captureLimit.duration) {
options.captureLimit.type = 'time';
options.captureLimit.limit = 99999;
}
}
var optionsStr = JSON.stringify(options);
addLog('Action: Start Capture \'' + currentFile + '\' (' + optionsStr + ')');
api.startCapture(optionsStr, eventListener);
if (options.captureLimit && options.captureLimit.duration > 0) {
startRecordTimer(options.captureLimit.duration);
}
};
Recorder.prototype.stopCapture = function () {
addLog('Action: Stop Capture');
api.stopCapture();
};
Recorder.prototype.play = function (audioData, eventListener) {
currentListener = eventListener;
if (audioData.type == 'filename') {
var audioFile = getAudioFile(audioData.filename);
if (audioFile == null) {
throw new Error('Could not find audio file: ' + audioData.filename);
}
audioData.data = audioFile.base64;
}
addLog('Action: Play \'' + audioData.filename + '\'');
api.play(JSON.stringify(audioData));
};
Recorder.prototype.stopPlay = function () {
addLog('Action: Stop Play');
api.stopPlay();
};
Recorder.prototype.pausePlay = function () {
addLog('Action: Pause Play');
api.pausePlay();
};
Recorder.prototype.resumePlay = function () {
addLog('Action: Resume Play');
api.resumePlay();
};
Recorder.prototype.loadAudioFile = function (fileIdentifier, base64, eventListener) {
var obj = {
data: '{ "base64": "' + base64 + '" }'
};
setAudioFile(fileIdentifier, obj);
if (eventListener) {
setTimeout(function () {
eventListener();
}, 0);
}
};
Recorder.prototype.retrieveAudioFileList = function (eventListener) {
var list = getAudioFileList();
if (eventListener) {
setTimeout(function () {
eventListener(list);
}, 0);
} else {
return list;
}
return true;
};
Recorder.prototype.retrieveAudioFile = function (fileIdentifier, eventListener) {
var data = getAudioFile(fileIdentifier);
if (eventListener) {
setTimeout(function () {
eventListener(data);
}, 0);
} else {
return data;
}
return true;
};
Recorder.prototype.clearAudioFileCache = function (eventListener) {
var list = getAudioFileList();
for (var i = 0; i < list.length; i++) {
Util.Storage.remove('recorder-data-' + list[i]);
}
Util.Storage.remove('recorder-list');
if (eventListener) {
setTimeout(function () {
eventListener();
}, 0);
}
};
SB.Firefox.Recorder = Recorder;
YUE.on(window, 'beforeunload', function () {
if(api && typeof api.clean == 'function') {
if(Util.Browser.isMacPPC()) {
var audioStatus = api.getStatus();
if(audioStatus=="ACTIVE") {
api.stopCapture();
var audioList = getAudioFileList();
var lastFileId = audioList.pop();
if(lastFileId) {
var audioData = {
type: 'filename',
filename: lastFileId
};
Recorder.prototype.play(audioData);
Recorder.prototype.stopPlay();
}
}
}
api.clean();
}
});
})(TDS.SecureBrowser);

/* SOURCE FILE: mobile.recorder.js (bb927f14) 9/9/2014 2:09:04 PM */

(function(SB) {
function Recorder() {
Recorder.superclass.constructor.call(this);
}
YAHOO.lang.extend(Recorder, TDS.SecureBrowser.Base.Recorder);
Recorder.prototype.initialize = function(eventListener) {
AIRMobile.recorder.initialize(eventListener);
};
Recorder.prototype.getCapabilities = function() {
return AIRMobile.recorder.getCapabilities(event);
};
Recorder.prototype.getDefaultOptions = function() {
return {
captureDevice: 0,
sampleRate: 48000,
channelCount: 1,
sampleSize: 16,
encodingFormat: 'opus'
};
};
Recorder.prototype.getStatus = function() {
return AIRMobile.recorder.getStatus();
};
Recorder.prototype.startCapture = function(options, eventListener) {
options = YAHOO.lang.augmentObject(this.getDefaultOptions(), (options || {}));
AIRMobile.recorder.startCapture(options, eventListener);
};
Recorder.prototype.stopCapture = function() {
AIRMobile.recorder.stopCapture();
};
Recorder.prototype.play = function(audioData, eventListener) {
AIRMobile.recorder.play(audioData, eventListener);
};
Recorder.prototype.stopPlay = function() {
AIRMobile.recorder.stopPlay();
};
Recorder.prototype.pausePlay = function() {
AIRMobile.recorder.pausePlay();
};
Recorder.prototype.resumePlay = function() {
AIRMobile.recorder.resumePlay();
};
Recorder.prototype.retrieveAudioFileList = function(callback) {
if (!callback) {
throw new Error('This recorder does not support sync api call.');
}
AIRMobile.recorder.retrieveAudioFileList(function(event) {
callback(event.files);
});
};
Recorder.prototype.retrieveAudioFile = function(fileIdentifier, callback) {
if (!callback) {
throw new Error('This recorder does not support sync api call.');
}
AIRMobile.recorder.retrieveAudioFile(function(event) {
callback(event.audioInfo);
});
};
Recorder.prototype.clearAudioFileCache = function(callback) {
AIRMobile.recorder.clearAudioFileCache(callback);
};
SB.Mobile.Recorder = Recorder;
})(TDS.SecureBrowser);

/* SOURCE FILE: base.js (3bf63c56) 10/26/2014 1:27:05 PM */

TDS.SecureBrowser.Validators = (function() {
var list = [];
function register(validator) {
list.push(validator);
}
function getValidators() {
return list;
}
function run() {
var exemptions = [];
var validatorExemptionsAppSetting = TDS.getAppSetting('sb.validatorExemptions');
if (validatorExemptionsAppSetting && validatorExemptionsAppSetting != '') {
exemptions = validatorExemptionsAppSetting.split(',');
}
var validators = list.filter(function(validator) {
return !Util.Array.contains(exemptions, validator.name) && validator.isSupported();
});
return Util.Array.partition(validators, function (validator) {
return validator.validate();
});
}
function validate() {
var partition = run();
return partition.rejects.map(function(validator) {
return validator.message;
});
}
return {
register: register,
getValidators: getValidators,
validate: validate
}
})();

/* SOURCE FILE: vmware.js (f6aee345) 10/26/2014 1:27:05 PM */

(function(SBV) {
SBV.register({
name: 'vmware',
isSupported: function () {
return (Util.Browser.isSecure() && Util.Browser.isWindows());
},
validate: function () {
var SB = Util.SecureBrowser;
var systemManufacturer = SB.readRegistryValue(SB.HKEY_LOCAL_MACHINE, "HARDWARE\\DESCRIPTION\\System\\BIOS", "SystemManufacturer");
if (systemManufacturer && systemManufacturer.indexOf("VMware") != -1) {
var viewClient = SB.readRegistryValue(SB.HKEY_CURRENT_USER, "Volatile Environment", "ViewClient_Type");
if (viewClient != "Teradici_POiCP") {
return false;
}
}
return true;
},
message: 'Browser.Denied.VMwareUncertified'
});
})(TDS.SecureBrowser.Validators);

/* SOURCE FILE: expose.js (7658c4a8) 10/26/2014 1:27:05 PM */

(function(SBV) {
SBV.register({
name: 'expose',
isSupported: function () {
return (Util.Browser.isSecure() && Util.Browser.isMac() && (Util.Browser.getOSXVersion() <= 10.6));
},
validate: function () {
var prefValue = Mozilla.getPreference('bmakiosk.expose.enabled');
if (prefValue === true) {
return false;
}
return true;
},
message: 'Browser.Denied.ExposeEnabled'
});
})(TDS.SecureBrowser.Validators);

/* SOURCE FILE: spaces.js (6849c554) 10/26/2014 1:27:05 PM */

(function(SBV) {
SBV.register({
name: 'spaces',
isSupported: function () {
return (Util.Browser.isSecure() && Util.Browser.isMac());
},
validate: function () {
var prefValue = Mozilla.getPreference('bmakiosk.spaces.enabled');
if (prefValue === true) {
return false;
}
return true;
},
message: 'Browser.Denied.SpacesEnabled'
});
})(TDS.SecureBrowser.Validators);

/* SOURCE FILE: util_securebrowser.js (52d4751b) 9/9/2014 2:09:05 PM */

(function() {
TDS.SecureBrowser.initialize();
Util.SecureBrowser = TDS.SecureBrowser.getImplementation();
})();
(function(SB, Mozilla) {
SB.fixUserAgent = function() {
var ua = navigator.userAgent;
if (ua.indexOf('AIRSecureBrowser/5.5') != -1 && ua.indexOf('Firefox/3.6.28') == -1) {
Mozilla.setPreference('general.useragent.extra.kiosk', '5.5 Firefox/3.6.28');
} else if (ua.indexOf('AIRSecureBrowser/5.6') != -1 && ua.indexOf('Firefox/3.6.28') == -1) {
Mozilla.setPreference('general.useragent.extra.kiosk', '5.6 Firefox/3.6.28');
}
};
})(Util.SecureBrowser, Mozilla);

/* SOURCE FILE: loader.js (0a473287) 9/9/2014 2:09:01 PM */

var ResourceLoader = function()
{
this._status = ResourceLoader.Status.NEW;
this._events = new YAHOO.util.EventProvider();
for (var key in ResourceLoader.Status)
{
this._events.createEvent(ResourceLoader.Status[key], { scope: this });
}
};
ResourceLoader.Status =
{
NEW: 'NEW',
LOADING: 'LOADING',
COMPLETE: 'COMPLETE',
ERROR: 'ERROR',
ABORT: 'ABORT'
};
ResourceLoader.extend = function(subclass)
{
YAHOO.lang.extend(subclass, ResourceLoader);
};
ResourceLoader.prototype.getStatus = function() { return this._status; };
ResourceLoader.prototype.setStatus = function(status)
{
this._status = status;
this._events.fireEvent(status);
};
ResourceLoader.prototype.setStatusAsync = function(status)
{
YAHOO.lang.later(0, this, this.setStatus, status);
};
ResourceLoader.prototype.subscribe = function(status, callback, overrideContext)
{
this._events.subscribe(status, callback, null, overrideContext || this);
};
ResourceLoader.prototype.load = function() {};
ResourceLoader.prototype.abort = function() {};

/* SOURCE FILE: collection.js (6281374d) 9/9/2014 2:09:01 PM */

ResourceLoader.Collection = function()
{
ResourceLoader.Collection.superclass.constructor.call(this);
this._loaders = [];
};
ResourceLoader.extend(ResourceLoader.Collection);
ResourceLoader.Collection.prototype.hasLoaders = function() { return this._loaders.length > 0; };
ResourceLoader.Collection.prototype.getLoaders = function() { return this._loaders; };
ResourceLoader.Collection.prototype.add = function(loader)
{
if (!(loader instanceof ResourceLoader))
{
throw new Error('You can only add a loader instance to a loader collection.');
}
this._loaders.push(loader);
};
ResourceLoader.Collection.prototype.load = function()
{
this.setStatus(ResourceLoader.Status.LOADING);
for (var i = 0; i < this._loaders.length; i++)
{
var loader = this._loaders[i];
loader.subscribe(ResourceLoader.Status.COMPLETE, this._checkFinished, this);
loader.subscribe(ResourceLoader.Status.ERROR, this._checkFinished, this);
loader.subscribe(ResourceLoader.Status.ABORT, this._checkFinished, this);
loader.load();
}
this._checkFinished();
};
ResourceLoader.Collection.prototype._checkFinished = function()
{
var completed = 0;
for (var i = 0; i < this._loaders.length; i++)
{
var status = this._loaders[i].getStatus();
if (status == ResourceLoader.Status.NEW ||
status == ResourceLoader.Status.LOADING)
{
return;
}
if (status == ResourceLoader.Status.COMPLETE)
{
completed++;
}
}
if (this._loaders.length == completed)
{
this.setStatusAsync(ResourceLoader.Status.COMPLETE);
}
else
{
this.setStatusAsync(ResourceLoader.Status.ERROR);
}
};

/* SOURCE FILE: dependency.js (9cb2dc41) 9/9/2014 2:09:01 PM */

ResourceLoader.Dependency = function(parentLoader, childLoader)
{
ResourceLoader.Dependency.superclass.constructor.call(this);
this._parentLoader = parentLoader;
this._childLoader = childLoader;
};
ResourceLoader.extend(ResourceLoader.Dependency);
ResourceLoader.Dependency.prototype.load = function()
{
this.setStatus(ResourceLoader.Status.LOADING);
var eventMapper = function(fromLoader, toLoader, status)
{
fromLoader.subscribe(status, function() { toLoader.setStatus(status); }, toLoader);
};
eventMapper(this._parentLoader, this, ResourceLoader.Status.ERROR);
eventMapper(this._parentLoader, this, ResourceLoader.Status.ABORT);
this._parentLoader.subscribe(ResourceLoader.Status.COMPLETE, function()
{
this._childLoader.load();
}, this);
eventMapper(this._childLoader, this, ResourceLoader.Status.ERROR);
eventMapper(this._childLoader, this, ResourceLoader.Status.ABORT);
eventMapper(this._childLoader, this, ResourceLoader.Status.COMPLETE);
this._parentLoader.load();
};

/* SOURCE FILE: conditional.js (11e63107) 9/9/2014 2:09:01 PM */

ResourceLoader.Conditional = function(listener, interval, timeout)
{
ResourceLoader.Conditional.superclass.constructor.call(this);
this._conditionalDelay = new Util.ConditionalDelay(listener, this);
this._interval = interval;
this._timeout = timeout;
};
ResourceLoader.extend(ResourceLoader.Conditional);
ResourceLoader.Conditional.prototype.load = function()
{
this.setStatus(ResourceLoader.Status.LOADING);
this._conditionalDelay.onSuccess.subscribe(function()
{
this.setStatus(ResourceLoader.Status.COMPLETE);
});
this._conditionalDelay.onFailure.subscribe(function()
{
this.setStatus(ResourceLoader.Status.ERROR);
});
this._conditionalDelay.start(this._interval, this._timeout);
};

/* SOURCE FILE: image.js (b32281d8) 9/9/2014 2:09:01 PM */

ResourceLoader.Image = function(src, timeoutInterval, retriesMax)
{
ResourceLoader.Image.superclass.constructor.call(this);
if (YAHOO.lang.isString(src))
{
this._img = new Image();
this._src = src;
}
else
{
this._img = src;
this._src = this._img.src;
}
this._timeoutInterval = timeoutInterval || 0;
this._timeoutObj = null;
this._retriesMax = retriesMax || 0;
this._retries = 0;
};
ResourceLoader.extend(ResourceLoader.Image);
ResourceLoader.Image.prototype.getElement = function() { return this._img; };
ResourceLoader.Image.prototype.load = function()
{
if (this._img.id == '') this._img.id = YAHOO.util.Dom.generateId();
this._attachEvents();
if (this._img.src == '') this._img.src = this._src;
this.setStatus(ResourceLoader.Status.LOADING);
this._startTimer();
return true;
};
ResourceLoader.Image.prototype._onEvent = function(evt)
{
this._stopTimer();
var eventType = evt.type;
if (eventType == 'readystatechange')
{
if (this._img.readyState == 'complete')
{
eventType = 'load';
}
else
{
return;
}
}
if (typeof this._img.naturalWidth == 'undefined')
{
if (eventType == 'load')
{
this._img.naturalWidth = this._img.width;
this._img.naturalHeight = this._img.height;
}
else
{
this._img.naturalWidth = 0;
this._img.naturalHeight = 0;
}
}
this._removeEvents();
if (eventType == 'load') this.setStatus(ResourceLoader.Status.COMPLETE);
else this.setStatus(ResourceLoader.Status.ERROR);
};
ResourceLoader.Image.prototype._attachEvents = function()
{
var loadEvent = YAHOO.env.ua.ie ? 'readystatechange' : 'load';
YUE.addListener(this._img, loadEvent, this._onEvent, this, true);
YUE.addListener(this._img, 'abort', this._onEvent, this, true);
YUE.addListener(this._img, 'error', this._onEvent, this, true);
};
ResourceLoader.Image.prototype._removeEvents = function()
{
var loadEvent = YAHOO.env.ua.ie ? 'readystatechange' : 'load';
YUE.removeListener(this._img, loadEvent, this._onEvent);
YUE.removeListener(this._img, 'abort', this._onEvent);
YUE.removeListener(this._img, 'error', this._onEvent);
};
ResourceLoader.Image.prototype._startTimer = function()
{
this._stopTimer();
if (this._timeoutInterval > 0)
{
this._timeoutObj = YAHOO.lang.later(this._timeoutInterval, this, this._onTimeout);
}
};
ResourceLoader.Image.prototype._stopTimer = function()
{
if (this._timeoutObj != null)
{
this._timeoutObj.cancel();
this._timeoutObj = null;
}
};
ResourceLoader.Image.prototype._onTimeout = function()
{
if (this.getStatus() != ResourceLoader.Status.LOADING) return;
if (this._retries < this._retriesMax)
{
this._retry();
}
else
{
this._removeEvents();
this.setStatus(ResourceLoader.Status.ABORT);
}
};
ResourceLoader.Image.prototype._retry = function()
{
this._retries++;
this._img.src = this._src;
this._startTimer();
};
ResourceLoader.ImageCollection = function()
{
ResourceLoader.ImageCollection.superclass.constructor.call(this);
};
YAHOO.lang.extend(ResourceLoader.ImageCollection, ResourceLoader.Collection);
ResourceLoader.ImageCollection.prototype.addImage = function(url)
{
this.add(new ResourceLoader.Image(url));
};
ResourceLoader.ImageCollection.prototype.getImage = function(url)
{
var imageLoaders = this.getLoaders();
for (var i = 0; i < imageLoaders.length; i++)
{
var image = imageLoaders[i].getElement();
if (image.src == url) return image;
}
return null;
};
ResourceLoader.ImageCollection.prototype.getErrors = function()
{
var imageErrors = [];
var imageLoaders = this.getLoaders();
for (var i = 0; i < imageLoaders.length; i++)
{
var imageLoader = imageLoaders[i];
if (imageLoader.getStatus() != ResourceLoader.Status.COMPLETE)
{
imageErrors.push(imageLoader.getElement());
}
}
return imageErrors;
};
ResourceLoader.ImageCollection.prototype.load = function(callbackSuccess, callbackFailure)
{
if (YAHOO.lang.isFunction(callbackSuccess))
{
this.subscribe(ResourceLoader.Status.COMPLETE, callbackSuccess, this);
}
if (YAHOO.lang.isFunction(callbackFailure))
{
this.subscribe(ResourceLoader.Status.ERROR, callbackFailure, this);
this.subscribe(ResourceLoader.Status.ABORT, callbackFailure, this);
}
ResourceLoader.ImageCollection.superclass.load.call(this);
};

/* SOURCE FILE: binary.js (eb78b02e) 9/9/2014 2:09:01 PM */

ResourceLoader.Binary = function(url, timeoutInterval, retriesMax)
{
ResourceLoader.Binary.superclass.constructor.call(this);
this._url = url;
this._active = false;
this._inSend = false;
this._inOpen = false;
this._inAbort = false;
this._timeoutInterval = timeoutInterval || 0;
this._timeoutObj = null;
this._retriesMax = retriesMax || 0;
this._retries = 0;
this._xhr = null;
this._response = null;
};
ResourceLoader.extend(ResourceLoader.Binary);
ResourceLoader.Binary.prototype.getResponse = function() { return this._response; };
ResourceLoader.Binary.prototype.load = function()
{
this._send();
this.setStatus(ResourceLoader.Status.LOADING);
return true;
};
ResourceLoader.Binary.prototype._ieProgId = null;
ResourceLoader.Binary.prototype._getProgId = function()
{
if (!this._ieProgId && typeof XMLHttpRequest == 'undefined' && typeof ActiveXObject != 'undefined')
{
var ACTIVE_X_IDENTS = ['MSXML2.XMLHTTP.6.0', 'MSXML2.XMLHTTP.3.0', 'MSXML2.XMLHTTP', 'Microsoft.XMLHTTP'];
for (var i = 0; i < ACTIVE_X_IDENTS.length; i++)
{
var candidate = ACTIVE_X_IDENTS[i];
try
{
new ActiveXObject(candidate);
this._ieProgId = candidate;
return candidate;
}
catch (e)
{
}
}
throw Error('Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed');
}
return this._ieProgId;
};
ResourceLoader.Binary.prototype._createInstance = function()
{
var progId = this._getProgId();
if (progId)
{
return new ActiveXObject(progId);
}
else
{
return new XMLHttpRequest();
}
};
ResourceLoader.Binary.prototype._send = function()
{
if (this._xhr) throw Error('Xhr Object is active with another request');
this._active = true;
this._xhr = this._createInstance();
this._xhr.onreadystatechange = Util.bind(this._onReadyStateChange, this);
this._inOpen = true;
this._xhr.open('GET', this._url, true);
this._inOpen = false;
this._xhr.setRequestHeader('X-TDS-Loader', 'binary');
if (this._timeoutObj) this._timeoutObj.cancel();
if (this._timeoutInterval > 0)
{
this._timeoutObj = YAHOO.lang.later(this._timeoutInterval, this, this._timeout);
}
this._inSend = true;
this._xhr.send(null);
this._inSend = false;
};
ResourceLoader.Binary.prototype._timeout = function()
{
if (this._xhr)
{
var allowRetry = (this._retries < this._retriesMax);
this._abort(allowRetry);
if (allowRetry)
{
this._retries++;
this._send();
}
}
};
ResourceLoader.Binary.prototype._abort = function(preventEvent)
{
if (this._xhr && this._active)
{
this._active = false;
this._inAbort = true;
this._xhr.abort();
this._inAbort = false;
if (!preventEvent) this.setStatus(ResourceLoader.Status.ABORT);
this._cleanUpXhr();
}
};
ResourceLoader.Binary.prototype._onReadyStateChange = function()
{
if (!this._active) return;
if (this._xhr.readyState != 4) return;
if (this._inSend)
{
YAHOO.lang.later(0, this._onReadyStateChange, this);
return;
}
this._active = false;
var httpStatus = this._xhr.status;
var httpHeaders = this._xhr.getAllResponseHeaders();
if (((httpStatus >= 200 && httpStatus < 300) || httpStatus === 1223) && httpHeaders != '')
{
var response = {};
this._response = response;
response.status = httpStatus;
response.contentLength = this._xhr.getResponseHeader('Content-Length');
response.contentType = this._xhr.getResponseHeader('Content-Type');
response.content = (typeof this._xhr.responseBody == 'unknown') ?
this._xhr.responseBody :
this._xhr.responseText;
this.setStatus(ResourceLoader.Status.COMPLETE);
}
else
{
this.setStatus(ResourceLoader.Status.ERROR);
}
this._cleanUpXhr();
};
ResourceLoader.Binary.prototype._cleanUpXhr = function()
{
if (this._xhr)
{
var xhr = this._xhr;
this._xhr = null;
if (this._timeoutObj)
{
this._timeoutObj.cancel();
this._timeoutObj = null;
}
try
{
xhr.onreadystatechange = function () {};
}
catch (e) {}
}
};

/* SOURCE FILE: script.js (8cca61ce) 9/9/2014 2:09:01 PM */

ResourceLoader.Script = function(url          , win, timeout)
{
ResourceLoader.Script.superclass.constructor.call(this);
this._url = url;
this._win = win;
this._timeout = timeout || 0;
this._id = null;
};
ResourceLoader.extend(ResourceLoader.Script);
ResourceLoader.Script.prototype.load = function()
{
this.setStatus(ResourceLoader.Status.LOADING);
var loader = this;
var config =
{
onSuccess: function() { this.setStatus(ResourceLoader.Status.COMPLETE); },
onFailure: function() { this.setStatus(ResourceLoader.Status.ERROR); },
onTimeout: function() { this.setStatus(ResourceLoader.Status.ABORT); },
scope: loader
};
if (this._win != null) config.win = this._win;
if (this._timeout > 0) config.timeout = this._timeout;
this._id = YAHOO.util.Get.script(this._url, config);
};
ResourceLoader.Script.prototype.abort = function()
{
YAHOO.util.Get.abort(this._id);
};

/* SOURCE FILE: xhr.js (3991be33) 9/9/2014 2:09:01 PM */

ResourceLoader.Xhr = function(url, opt_method, opt_content, opt_timeout, opt_maxRetries)
{
ResourceLoader.Xhr.superclass.constructor.call(this);
this._manager = new Util.XhrManager(0, 0, true);
this._request = this._manager.createRequest(url, url, opt_method, opt_content, this._onCompleted, this, opt_timeout, opt_maxRetries);
};
ResourceLoader.extend(ResourceLoader.Xhr);
ResourceLoader.Xhr.prototype.load = function()
{
this.setStatus(ResourceLoader.Status.LOADING);
this._manager.sendRequest(this._request);
};
ResourceLoader.Xhr.prototype._onCompleted = function()
{
if (this._request.isSuccess()) this.setStatus(ResourceLoader.Status.COMPLETE);
else this.setStatus(ResourceLoader.Status.ERROR);
};

/* SOURCE FILE: promise.js (68d91af8) 9/9/2014 2:09:01 PM */

(function (RL) {
var Status = RL.Status;
function RLP(promise) {
this.promise = promise;
RLP.superclass.constructor.call(this);
}
RL.extend(RLP);
RLP.prototype.load = function () {
if (this.getStatus() != Status.NEW) {
return false;
}
this.setStatus(Status.LOADING);
this.promise.done(
function () {
this.setStatus(Status.COMPLETE);
}.bind(this),
function (error) {
this.setStatus(Status.ERROR);
}.bind(this));
return true;
}
RL.Promise = RLP;
})(window.ResourceLoader);

/* SOURCE FILE: messages_legacy.js (d1d386c0) 9/9/2014 2:09:01 PM */

(function() {
function getDisplayMessage(translation)
{
if (translation == null) return '';
var clientMessage = translation.getClientMessage();
if (YAHOO.lang.isString(clientMessage)) {
return clientMessage;
} else {
return translation.getParentMessage().getDefaultMessage();
}
}
function format(text, params) {
if (params == null) return text;
for (var i = 0, l = params.length; i < l; ++i) {
var reg = new RegExp("\\{" + i + "\\}", "g");
text = text.replace(reg, params[i]);
}
return text;
}
function get(defaultMessage, params) {
var translation = null;
if (TDS.messages != null) {
translation = TDS.messages.findTranslation(defaultMessage);
}
if (translation == null) {
return defaultMessage;
}
var text = getDisplayMessage(translation);
if (params) {
text = format(text, params);
}
return text;
}
function getAlt(key, alt) {
var message = get(key);
if (message == key && YAHOO.lang.isString(alt)) {
return alt;
} else {
return message;
}
}
function has(key) {
return (key != get(key));
}
var regex = /\#(\S+)\#/g;
function parse(text) {
return text.replace(regex, function(match, key) {
return getAlt(key, match);
});
}
window.Messages = {
get: get,
getAlt: getAlt,
has: has,
parse: parse,
format: format
};
})();
Messages.setContent = function (node, key) {
node.setAttribute('i18n-content', key);
Util.Dom.setTextContent(node, Messages.get(key));
};
Messages.setHTMLContent = function (node, key) {
node.setAttribute('i18n-content', key);
node.innerHTML = Messages.get(key);
};
(function() {
function getDisplayMessage(translation, params) {
if (translation == null) {
return '';
}
var clientMessage = translation.getClientMessage();
var messageID = translation.getParentMessage().getMessageId();
if (clientMessage != null && clientMessage.length > 0) {
if (params) {
clientMessage = Messages.format(clientMessage, params);
}
return clientMessage + ' [Message Code: ' + messageID + ']';
} else {
var defaultMessage = translation.getParentMessage().getDefaultMessage();
return defaultMessage + ' [Message Code: ' + messageID + ']';
}
}
function get(defaultMessage, params) {
var translation = null;
if (TDS.messages != null) {
translation = TDS.messages.findTranslation(defaultMessage);
}
if (translation == null) {
return defaultMessage;
} else {
return getDisplayMessage(translation, params);
}
}
function getAlt(key, alt) {
var message = get(key);
if (message == key && alt) {
return alt;
} else {
return message;
}
}
window.ErrorCodes = {
get: get,
getAlt: getAlt
};
})();

/* SOURCE FILE: messages_system.js (eb8fb3be) 9/9/2014 2:09:01 PM */

if (typeof TDS == 'undefined') TDS = {};
TDS.Messages = { };
TDS.Messages.MessageTranslation = function(message                         , clientMessage, languageCode, subject, gradeCode)
{
this._message = message;
this._clientMessage = clientMessage;
this._languageCode = languageCode || null;
this._subject = subject || null;
this._gradeCode = gradeCode || null;
};
TDS.Messages.MessageTranslation.prototype.getParentMessage = function() { return this._message; };
TDS.Messages.MessageTranslation.prototype.getClientMessage = function() { return this._clientMessage; };
TDS.Messages.MessageTranslation.prototype.getLanguage = function() { return this._languageCode; };
TDS.Messages.MessageTranslation.prototype.getSubject = function() { return this._subject; };
TDS.Messages.MessageTranslation.prototype.getGrade = function() { return this._gradeCode; };
TDS.Messages.Message = function(context                                , messageId        , defaultMessage           )
{
this._context = context;
this._messageId = messageId;
this._defaultMessage = defaultMessage;
this._translationList = [];
this._translation3D = null;
};
TDS.Messages.Message.prototype.getParentContext = function() { return this._context; };
TDS.Messages.Message.prototype.getMessageId = function() { return this._messageId; };
TDS.Messages.Message.prototype.getDefaultMessage = function() { return this._defaultMessage; };
TDS.Messages.Message.prototype.getTranslations = function() { return this._translationList; };
TDS.Messages.Message.prototype.addTranslation = function(clientMessage, languageCode, gradeCode, subject)
{
var translation = new TDS.Messages.MessageTranslation(this, clientMessage, languageCode, gradeCode, subject);
this._translationList.push(translation);
return translation;
};
TDS.Messages.Message.prototype.initTranslationIndex = function(translation3D)
{
this._translation3D = translation3D;
};
TDS.Messages.Message.prototype.setTranslationIndex = function(messageIndex                 , translationIndex        )
{
var langIdx = messageIndex.getLanguageIndex();
var subjectIdx = messageIndex.getSubjectIndex();
var gradeIdx = messageIndex.getGradeIndex();
this._translation3D[langIdx][subjectIdx][gradeIdx] = translationIndex;
};
TDS.Messages.Message.prototype.getTranslationByIndex = function(messageIndex                 )
{
var langIdx = messageIndex.getLanguageIndex();
var subjectIdx = messageIndex.getSubjectIndex();
var gradeIdx = messageIndex.getGradeIndex();
var index = this._translation3D[langIdx, subjectIdx, gradeIdx];
if (!YAHOO.lang.isNumber(index)) index = 0;
return this._translationList[index];
};
TDS.Messages.Message.prototype.getTranslationByLang = function(languageCode)
{
var translations = this.getTranslations();
var translation = Util.Array.find(translations, function(translation)
{
return (translation.getLanguage() == languageCode);
});
if (translation != null) return translation;
if (translation == null && translations.length > 0) return translations[0];
return null;
};
TDS.Messages.Message.prototype.toString = function() { return this.getDefaultMessage(); };
TDS.Messages.MessageContext = function(contextName)
{
this._name = contextName;
this._messagesLookup = new Util.Structs.Map();
};
TDS.Messages.MessageContext.prototype.getName = function() { return this._name; };
TDS.Messages.MessageContext.prototype.addMessage = function(messageId        , defaultMessage           )
{
var message = new TDS.Messages.Message(this, messageId, defaultMessage);
this._messagesLookup.set(defaultMessage, message);
return message;
};
TDS.Messages.MessageContext.prototype.getMessages = function()
{
return this._messagesLookup.getValues();
};
TDS.Messages.MessageContext.prototype.getMessage = function(defaultMessage           )
{
return this._messagesLookup.get(defaultMessage);
};
TDS.Messages.MessageContext.prototype.toString = function() { return this.getName(); };
TDS.Messages.MessageSystem = function()
{
this._languages = [];
this._messageIndexer = new TDS.Messages.MessageIndexer();
this._messageContexts = new Util.Structs.Map();
};
TDS.Messages.MessageSystem.prototype.hasLanguage = function(language)
{
return (this._languages.indexOf(language) != -1);
};
TDS.Messages.MessageSystem.prototype._getLanguage = function() { return 'ENU'; };
TDS.Messages.MessageSystem.prototype.getIndexer = function() { return this._messageIndexer; };
TDS.Messages.MessageSystem.prototype.addContext = function(context           )
{
var messageContext = new TDS.Messages.MessageContext(context);
this._messageContexts.set(context, messageContext);
return messageContext;
};
TDS.Messages.MessageSystem.prototype.getContexts = function() { return this._messageContexts.getValues(); };
TDS.Messages.MessageSystem.prototype.getContext = function(context           )
{
return this._messageContexts.get(context);
};
TDS.Messages.MessageSystem.prototype.getTranslation = function(context, defaultMessage, languageCode, subject, gradeCode)
{
var messageContext = this.getContext(context);
if (messageContext != null)
{
var message = messageContext.getMessage(defaultMessage);
if (message != null)
{
return message.getTranslationByLang(languageCode);
}
}
return null;
};
TDS.Messages.MessageSystem.prototype.findTranslation = function(defaultMessage)
{
var translation = null;
var language = this._getLanguage();
var contexts = this.getContexts();
for (var i = 0; i < contexts.length; i++)
{
var context = contexts[i];
translation = this.getTranslation(context.getName(), defaultMessage, language, null, null);
if (translation != null) break;
}
return translation;
};
TDS.Messages.MessageSystem.prototype.getTextByContext = function(context, defaultMessage)
{
var language = this._getLanguage();
var translation = this.getTranslation(context, defaultMessage, language, null, null);
if (translation) return translation.getClientMessage();
return defaultMessage;
};
TDS.Messages.MessageSystem.prototype.getTemplateData = function()
{
var language = this._getLanguage();
var templateData = {};
Util.Array.each(this.getContexts(), function(messageContext)
{
Util.Array.each(messageContext.getMessages(), function(message)
{
var translation = message.getTranslationByLang(language);
templateData[message.getDefaultMessage()] = translation.getClientMessage();
});
});
return templateData;
};

/* SOURCE FILE: messages_indexer.js (a1020c19) 9/9/2014 2:09:01 PM */

TDS.Messages.MessageIndex = function(langIdx        , subjectIdx        , gradeIdx        )
{
this._langIdx = langIdx;
this._subjectIdx = subjectIdx;
this._gradeIdx = gradeIdx;
};
TDS.Messages.MessageIndex.prototype.getLanguageIndex = function() { return this._langIdx; };
TDS.Messages.MessageIndex.prototype.getSubjectIndex = function() { return this._subjectIdx; };
TDS.Messages.MessageIndex.prototype.getGradeIndex = function() { return this._gradeIdx; };
TDS.Messages.MessageIndexer = function()
{
this._languageDictionary = new Util.Structs.Map();
this._subjectDictionary = new Util.Structs.Map();
this._gradeDictionary = new Util.Structs.Map();
this.init();
};
TDS.Messages.MessageIndexer.prototype.init = function()
{
this._languageDictionary.clear();
this._subjectDictionary.clear();
this._gradeDictionary.clear();
this._languageDictionary.set('ENU', 0);
this._subjectDictionary.set('DefaultSubject', 0);
this._gradeDictionary.set('DefaultGrade', 0);
};
TDS.Messages.MessageIndexer.prototype.addLanguage = function(language)
{
if (!YAHOO.lang.isString(language)) return 0;
if (this._languageDictionary.containsKey(language))
{
return this._languageDictionary.get(language);
}
this._languageDictionary.set(language, this._languageDictionary.getCount());
return this._languageDictionary.getCount() - 1;
};
TDS.Messages.MessageIndexer.prototype.addSubject = function(subject)
{
if (!YAHOO.lang.isString(subject)) return 0;
if (this._subjectDictionary.containsKey(subject))
{
return this._subjectDictionary.get(subject);
}
this._subjectDictionary.set(subject, this._subjectDictionary.getCount());
return this._subjectDictionary.getCount() - 1;
};
TDS.Messages.MessageIndexer.prototype.addGrade = function(grade)
{
if (!YAHOO.lang.isString(grade)) return 0;
if (this._gradeDictionary.containsKey(grade))
{
return this._gradeDictionary.get(grade);
}
this._gradeDictionary.set(grade, this._gradeDictionary.getCount());
return this._gradeDictionary.getCount() - 1;
};
TDS.Messages.MessageIndexer.prototype.createIndexer3D = function()
{
var i1 = (this._languageDictionary.getCount() > 0) ? this._languageDictionary.getCount() : 1;
var i2 = (this._subjectDictionary.getCount() > 0) ? this._subjectDictionary.getCount() : 1;
var i3 = (this._gradeDictionary.getCount() > 0) ? this._gradeDictionary.getCount() : 1;
return Util.Array.createMultiDimArray(i1, i2, i3);
};
TDS.Messages.MessageIndexer.prototype.getLanguageIndex = function(language)
{
if (!YAHOO.lang.isString(language) || this._languageDictionary.getCount() == 0) return 0;
if (this._languageDictionary.containsKey(language))
{
return this._languageDictionary.get(language);
}
return 0;
};
TDS.Messages.MessageIndexer.prototype.getSubjectIndex = function(subject)
{
if (!YAHOO.lang.isString(subject) || this._subjectDictionary.getCount() == 0) return 0;
if (this._subjectDictionary.containsKey(subject))
{
return this._subjectDictionary.get(subject);
}
return 0;
};
TDS.Messages.MessageIndexer.prototype.getGradeIndex = function(grade)
{
if (!YAHOO.lang.isString(grade) || this._gradeDictionary.getCount() == 0) return 0;
if (this._gradeDictionary.containsKey(grade))
{
return this._gradeDictionary.get(grade);
}
return 0;
};
TDS.Messages.MessageIndexer.prototype.get = function(language, subject, grade)
{
var langIdx = this.getLanguageIndex(language);
var subjectIdx = this.getSubjectIndex(subject);
var gradeIdx = this.getGradeIndex(grade);
return new TDS.Messages.MessageIndex(langIdx, subjectIdx, gradeIdx);
};

/* SOURCE FILE: messages_loader.js (330b4aa1) 9/9/2014 2:09:01 PM */

TDS.Messages.MessageLoader = function(messageSystem)
{
this._messageSystem = messageSystem || new TDS.Messages.MessageSystem();
};
TDS.Messages.MessageLoader.prototype.getMessageSystem = function() { return this._messageSystem; };
TDS.Messages.MessageLoader.prototype.load = function(json)
{
if (json.c_l != null && !this._messageSystem.hasLanguage(json.c_l))
{
this._messageSystem._languages.push(json.c_l);
}
Util.Array.each(json.c_a, this.loadContext, this);
};
TDS.Messages.MessageLoader.prototype.loadContext = function(jsonContext)
{
if (jsonContext == null) return;
var messageContext = this._messageSystem.getContext(jsonContext.c);
if (messageContext == null)
{
messageContext = this._messageSystem.addContext(jsonContext.c);
}
Util.Array.each(jsonContext.m_a, function(jsonMessage)
{
var message = messageContext.getMessage(jsonMessage.m);
if (message == null)
{
message = messageContext.addMessage(jsonMessage.id, jsonMessage.m);
}
Util.Array.each(jsonMessage.t_a, function(jsonTranslation)
{
message.addTranslation(jsonTranslation.t, jsonTranslation.l, jsonTranslation.s, jsonTranslation.g);
});
});
};
TDS.Messages.MessageLoader.prototype.buildIndex = function()
{
var messageIndexer = this._messageSystem.getIndexer();
Util.Array.each(this._messageSystem.getContexts(), function(messageContext)
{
Util.Array.each(messageContext.getMessages(), function(message)
{
Util.Array.each(message.getTranslations(), function(translation)
{
messageIndexer.addLanguage(translation.getLanguage());
messageIndexer.addSubject(translation.getSubject());
messageIndexer.addGrade(translation.getGrade());
});
});
});
Util.Array.each(this._messageSystem.getContexts(), function(messageContext)
{
Util.Array.each(messageContext.getMessages(), function(message)
{
message.initTranslationIndex(messageIndexer.createIndexer3D());
var translationIndex = 0;
Util.Array.each(message.getTranslations(), function(translation)
{
var messageIndex = messageIndexer.get(translation.getLanguage(), translation.getSubject(), translation.getGrade());
message.setTranslationIndex(messageIndex, translationIndex);
translationIndex++;
});
});
});
};

/* SOURCE FILE: messages_template.js (32cae42c) 9/9/2014 2:09:01 PM */

TDS.Messages.Template = (function () {
var hasText = function(element) {
var text = Util.Dom.getTextContent(element);
if (text == null) {
return false;
}
text = YAHOO.lang.trim(text);
return (text.length > 0);
};
var handlers = {
'i18n-content': function(element, key, dictionary) {
var replacement = dictionary[key];
if (YAHOO.lang.isString(replacement)) {
element.innerHTML = replacement;
}
else if (!hasText(element)) {
element.innerHTML = key;
}
},
'i18n-text': function(element, key, dictionary) {
var replacement = dictionary[key];
if (YAHOO.lang.isString(replacement)) {
Util.Dom.setTextContent(element, replacement);
} else if (!hasText(element)) {
Util.Dom.setTextContent(element, key);
}
},
'i18n-button': function(element, key, dictionary) {
var replacement = dictionary[key];
if (YAHOO.lang.isString(replacement)) {
replacement = replacement.replace('<span>', '');
replacement = replacement.replace('</span>', '');
Util.Dom.setTextContent(element, replacement);
} else if (!hasText(element)) {
Util.Dom.setTextContent(element, key);
}
},
'i18n-options': function(element, key, dictionary) {
var options = dictionary[key];
options.forEach(function(values) {
var option = (typeof values == 'string') ? new Option(values) : new Option(values[1], values[0]);
element.appendChild(option);
});
},
'i18n-values': function (element, attributeAndKeys, dictionary) {
var parts = attributeAndKeys.replace(/\s/g, '').split(/;/);
for (var j = 0; j < parts.length; j++) {
var attributeAndKeyPair = parts[j].match(/^([^:]+):(.+)$/);
if (attributeAndKeyPair) {
var propName = attributeAndKeyPair[1];
var propExpr = attributeAndKeyPair[2];
if (propExpr in dictionary) {
var value = dictionary[propExpr];
if (propName.charAt(0) == '.') {
var path = propName.slice(1).split('.');
var targetObject = element;
while (targetObject && path.length > 1) {
targetObject = targetObject[path.shift()];
}
if (targetObject) {
targetObject[path] = value;
if (path == 'innerHTML') {
process(element, dictionary);
}
}
} else {
element.setAttribute(propName, value);
}
} else {
Util.log('i18n-values: Missing value for "' + propExpr + '"');
}
}
}
}
};
var attributeNames = Util.Object.keys(handlers);
var selector = '[' + attributeNames.join('],[') + ']';
function process(node, dictionary) {
var elements = YAHOO.util.Selector.query(selector, node);
for (var element, i = 0; element = elements[i]; i++) {
for (var j = 0; j < attributeNames.length; j++) {
var name = attributeNames[j];
var attribute = element.getAttribute(name);
if (attribute != null) {
handlers[name](element, attribute, dictionary);
}
}
}
}
return {
process: process
};
})();
TDS.Messages.Template.processLanguage = function(node) {
var templateData = TDS.messages.getTemplateData();
TDS.Messages.Template.process(node || document, templateData);
};

/* SOURCE FILE: accs.js (b1b87f61) 10/26/2014 1:27:05 PM */

var Accommodations = (function() {
function Accs(id, label) {
this._position = null;
this._id = null;
this._label = null;
this._types = [];
this._typeLookup = new Util.Structs.Map();
this._valuesLookup = new Util.Structs.Map();
this._toolDependencies = [];
this.setId(id || null);
this.setLabel(label || null);
Util.Event.Emitter(this);
};
Accs.DOM_ID = 'data-accs-id';
Accs.create = function(json) {
var accommodations = new Accs();
accommodations.importJson(json);
return accommodations;
};
var AccsProto = Accs.prototype;
AccsProto.getPosition = function() {
return this._position;
};
AccsProto.setPosition = function(position) {
this._position = position;
};
AccsProto.getId = function() {
return this._id;
};
AccsProto.setId = function(id) {
if (id) {
this._id = id;
} else if (!this._id) {
this._id = 'default';
}
};
AccsProto.getLabel = function() {
return this._label;
};
AccsProto.setLabel = function(label) {
this._label = label;
};
AccsProto.createType = function(name, label, isVisible, isSelectable, allowChange, studentControl, dependsOn) {
if (typeof name != 'string') {
throw Error('Cannot create acc type because the name is not a valid string.');
}
var accType = this.getType(name);
if (!accType) {
accType = new Accs.Type(this, name, label, isVisible, isSelectable, allowChange, studentControl, dependsOn);
this._types.push(accType);
this._typeLookup.set(name, accType);
this.fire('createType', accType);
}
return accType;
};
AccsProto.createTypeFromObject = function(obj) {
if (obj instanceof Accs.Type) {
var dependsOnType = obj.getDependsOnTool();
var dependsOnTypeName = (dependsOnType == null) ? null : dependsOnType.getName();
return this.createType(obj.getName(), obj.getLabel(), obj.isVisible(), obj.isSelectable(), obj.allowChange(), obj.allowStudentControl(), dependsOnTypeName);
} else {
return this.createType(obj.name, obj.label, obj.isVisible, obj.isSelectable, obj.allowChange, obj.studentControl, obj.dependsOn);
}
};
AccsProto.getTypes = function() {
return this._types.slice(0);
};
AccsProto.hasType = function(typeName) {
return this._typeLookup.containsKey(typeName);
};
AccsProto.getType = function(typeName) {
return this._typeLookup.get(typeName);
};
AccsProto.removeType = function (name) {
var accType = this.getType(name);
if (accType) {
accType.destroy();
}
};
AccsProto.hasValue = function(valueCode) {
return this._valuesLookup.containsKey(valueCode);
};
AccsProto.getValue = function(valueCode) {
return this._valuesLookup.get(valueCode);
};
AccsProto.isAnyVisible = function () {
return this.getTypes().some(function(accType) {
return accType.isVisible();
});
};
AccsProto.findCode = function(typeName, valueCode, requireSelected) {
var accType = this.getType(typeName);
if (!accType) {
return null;
}
return Util.Array.find(accType.getValues(), function(accValue) {
if (requireSelected && accValue.isSelected() !== true) {
return false;
}
if (valueCode == accValue.getCode()) {
return true;
}
var splitCodes = accValue.getCodes();
for (var i = 0; i < splitCodes.length; i++) {
if (valueCode == splitCodes[i]) {
return true;
}
}
return false;
});
};
AccsProto.getValues = function (includeAll) {
var values = this._valuesLookup.getValues();
return values.filter(function (accValue) {
return (includeAll || accValue.isActive());
});
};
AccsProto.getSelected = function () {
return this.getValues().filter(function (accValue) {
return accValue.isSelected();
});
};
AccsProto.selectCodes = function(typeName, codes) {
if (typeof codes == 'string') {
codes = [codes];
}
if (!$.isArray(codes)) {
return [];
}
var accType = this.getType(typeName);
var valuesToSelect = $.map(codes, function(code) {
return this.getValue(code);
}.bind(this));
if (accType) {
accType.getValues().forEach(function(accValue) {
if (valuesToSelect.indexOf(accValue) == -1) {
accValue.deselect();
}
});
}
valuesToSelect.forEach(function (accValue) {
accValue.select();
});
return valuesToSelect;
};
AccsProto.selectDefaults = function () {
var accTypes = this.getTypes();
var accPartition = Util.Array.partition(accTypes, function(accType) {
return !accType.getDependsOnTool();
});
function selectDefaultCodes(accType) {
var accValue = accType.getDefault();
if (accValue) {
this.selectCodes(accType.getName(), [accValue.getCode()]);
}
};
accPartition.matches.forEach(selectDefaultCodes.bind(this));
accPartition.rejects.forEach(selectDefaultCodes.bind(this));
};
AccsProto.clearDependencies = function() {
Util.Array.clear(this._toolDependencies);
this.getTypes().forEach(function(accType) {
accType.clearDependsOnTool();
});
};
AccsProto.selectAll = function() {
this.clearDependencies();
this.getTypes().forEach(function (accType) {
this.selectCodes(accType.getName(), accType.getCodes());
}.bind(this));
};
AccsProto.getSelectedEncoded = function() {
return this.getSelected().map(function(accValue) {
var accType = accValue.getParentType();
var name = accType.getName();
var code = encodeURIComponent(accValue.getCode());
return encodeURIComponent(name + '=' + code);
}).join('&');
};
AccsProto.getSelectedDelimited = function(encode, delimiter) {
return this.getSelected().map(function(accValue) {
var code = accValue.getCode();
if (encode) {
code = encodeURIComponent(code);
}
return code;
}).join(delimiter || ';');
};
AccsProto.getSelectedJson = function() {
return this.getTypes().map(function(accType) {
return {
type: accType.getName(),
codes: accType.getCodes(true)
};
}).filter(function(obj) {
return obj.codes.length;
});
};
AccsProto.clone = function() {
var accommodations = new Accs();
var jsonTypes = this.exportJson();
accommodations.importJson(jsonTypes);
return accommodations;
};
AccsProto.unionWith = function (other) {
other.getTypes().forEach(function (otherType) {
var unionType = this.createTypeFromObject(otherType);
otherType.getValues().forEach(function(otherValue) {
unionType.createValueFromObject(otherValue);
});
}.bind(this));
};
AccsProto.replaceWith = function(other) {
other.getTypes().forEach(function(otherType) {
var replaceType = this.getType(otherType.getName());
if (replaceType) {
replaceType.destroy();
}
replaceType = this.createTypeFromObject(otherType);
otherType.getValues().forEach(function(otherValue) {
replaceType.createValueFromObject(otherValue);
});
}.bind(this));
};
AccsProto.applyCSS = function(el) {
var accsId = this.getId();
var codes = $.map(this.getValues(), function (accValue) {
if (accValue.isSelected()) {
return accValue.getCodes();
}
}).join(' ');
$(el).addClass(codes)
.attr(Accs.DOM_ID, accsId);
console.log('ACCS APPLY CSS: ' + accsId);
};
AccsProto.removeCSS = function(el) {
var accsId = this.getId();
var codes = $.map(this.getValues(), function (accValue) {
return accValue.getCodes();
}).join(' ');
$(el).removeClass(codes)
.attr(Accs.DOM_ID, '');
console.log('ACCS REMOVE CSS: ' + accsId);
};
AccsProto.createProps = function() {
return new Accs.Properties(this);
};
AccsProto.getDependencies = function() {
return this._toolDependencies;
};
AccsProto.addDependency = function (ifType, ifValue, thenType, thenValue, isDefault) {
var dependency = new Accs.Dependency(this, ifType, ifValue, thenType, thenValue, isDefault);
if (!dependency.ifType() || !dependency.ifValue() || !dependency.thenType() || !dependency.thenValue()) {
return null;
}
this._toolDependencies.push(dependency);
return dependency;
};
AccsProto.removeDependency = function(dep) {
return Util.Array.remove(this._toolDependencies, dep);
};
AccsProto.clear = function() {
Util.Array.clone(this._toolDependencies).forEach(function (dep) {
dep.destroy();
});
Util.Array.clear(this._toolDependencies);
Util.Array.clone(this._types).forEach(function (accType) {
accType.destroy();
});
Util.Array.clear(this._types);
this._typeLookup.clear();
this._valuesLookup.clear();
};
AccsProto.destroy = function () {
this.clear();
this._id = null;
this._label = null;
};
return Accs;
})();

/* SOURCE FILE: accs.type.js (2c23ddae) 10/26/2014 1:27:05 PM */

Accommodations.Type = (function() {
var AccType = function (parentAccommodations, name, label, isVisible, isSelectable, allowChange, studentControl, dependsOn) {
this.getParentAccommodations = function() {
return parentAccommodations;
};
this.getName = function() {
return name;
};
this.getLabel = function () {
if (typeof TDS == 'object' && TDS.messages != null) {
var text = TDS.messages.getTextByContext('AccType', name);
if (text != name) {
return text;
}
}
return label ? label : name;
};
this.isVisible = function () {
if (isVisible) {
return (this.getValues().length > 0);
}
return false;
};
this.isSelectable = function () {
return (isSelectable === true);
};
this.allowChange = function () {
return (allowChange === true);
};
this.allowStudentControl = function () {
return (studentControl === true);
};
this._dependsOnTypeName = dependsOn;
this._values = [];
var id = parentAccommodations.getId() + '-' + name.replace(/\s+/g, '').toLowerCase();
this.getControlId = function() {
return 'accs-control-' + id;
};
this.getId = function() {
return 'accs-type-' + id;
};
this.clear = function() {
Util.Array.clone(this._values).forEach(function (accValue) {
accValue.destroy();
});
Util.Array.clear(this._values);
};
this.destroy = function () {
this.clear();
var self = this;
parentAccommodations.getDependencies()
.filter(function (dep) {
return dep.ifType() == self || dep.thenType() == self;
})
.forEach(function (dep) {
parentAccommodations.removeDependency(dep);
});
parentAccommodations._typeLookup.remove(name);
Util.Array.remove(parentAccommodations._types, this);
parentAccommodations = null;
name = null;
label = null;
this._dependsOnTypeName = null;
};
};
var AccTypeProto = AccType.prototype;
AccTypeProto.createValue = function (code, name, label, isDefault, allowCombine) {
if (typeof code != 'string') {
throw Error('Cannot create acc value because the code is not a valid string.');
}
var accValue = this.getParentAccommodations().getValue(code);
if (!accValue) {
accValue = new Accommodations.Value(this, code, name, label, isDefault, allowCombine);
this._values.push(accValue);
this.getParentAccommodations()._valuesLookup.set(code, accValue);
this.getParentAccommodations().fire('createValue', accValue);
}
return accValue;
};
AccTypeProto.createValueFromObject = function (obj) {
var accValue;
if (obj instanceof Accommodations.Value) {
accValue = this.createValue(obj.getCode(), obj.getName(), obj.getLabel(), obj.isDefault(), obj.allowCombine());
accValue._selected = obj._selected;
} else {
accValue = this.createValue(obj.code, obj.name, obj.label, obj.isDefault, obj.allowCombine);
accValue._selected = obj.selected;
}
return accValue;
};
AccTypeProto.removeValue = function (code) {
var accValue = this.getParentAccommodations().getValue(code);
if (accValue) {
this.getParentAccommodations().fire('removeValue', accValue);
accValue.deselect();
accValue.destroy();
}
};
AccTypeProto.getValues = function (includeAll) {
return this._values.filter(function (accValue) {
return (includeAll || accValue.isActive());
});
};
AccTypeProto.getCodes = function (requireSelected) {
return this.getValues().filter(function (accValue) {
return (!requireSelected || accValue.isSelected());
}).map(function(accValue) {
return accValue.getCode();
});
};
AccTypeProto.getDefault = function () {
var defaultValue = Util.Array.find(this.getValues(), function (accValue) {
var dependencyRule = accValue.getDependencyRule();
if (dependencyRule) {
return dependencyRule.isDefault();
} else {
return accValue.isDefault();
}
});
if (defaultValue) {
return defaultValue;
} else {
return this.getValues()[0];
}
};
AccTypeProto.getSelected = function () {
return this.getValues().filter(function(accValue) {
return accValue.isSelected();
});
};
AccTypeProto.deselectAll = function () {
this.getValues().forEach(function (accValue) {
accValue.deselect();
});
};
AccTypeProto.isMultiSelect = function () {
return this.getValues().some(function (accValue) {
return accValue.allowCombine();
});
};
AccTypeProto.isBoolSelect = function () {
var values = this.getValues();
if (values.length != 2) {
return false;
}
var value1 = values[0].getName();
var value2 = values[1].getName();
return ((value1 == 'False' && value2 == 'True') || (value1 == 'True' && value2 == 'False'));
};
AccTypeProto.hashCode = function () {
var hashString = this.getCodes().join('|');
return Util.String.hashCode(hashString);
};
AccTypeProto.toString = function() {
return this.getName();
};
AccTypeProto.setDependsOnTool = function (name) {
this._dependsOnTypeName = name;
};
AccTypeProto.getDependsOnTool = function () {
if (typeof this._dependsOnTypeName == 'string') {
var accommodations = this.getParentAccommodations();
return accommodations.getType(this._dependsOnTypeName);
}
return null;
};
AccTypeProto.clearDependsOnTool = function () {
this._dependsOnTypeName = null;
};
AccTypeProto.getDependentTypes = function () {
var accommodations = this.getParentAccommodations();
var accTypes = accommodations.getTypes();
var dependentTypes = [];
accTypes.forEach(function (accType) {
if (accType.getDependsOnTool() === this) {
if (dependentTypes.indexOf(accType) == -1) {
dependentTypes.push(accType);
}
}
}.bind(this));
return dependentTypes;
};
return AccType;
})();

/* SOURCE FILE: accs.value.js (57befeff) 10/26/2014 1:27:05 PM */

Accommodations.Value = (function () {
var AccValue = function (parentType, code, name, label, isDefault, allowCombine) {
this.getParentType = function () {
return parentType;
};
this.getCode = function () {
return code;
};
this.setCode = function (str) {
code = str;
};
this.getCodes = function () {
return (code && code.split('&')) || [];
};
this.getName = function () {
return name;
};
this.setName = function (str) {
name = str;
};
this.allowCombine = function () {
return (allowCombine === true);
};
this.setCombinable = function (value) {
allowCombine = !!value;
};
this.getLabel = function () {
if (typeof TDS == 'object' && TDS.messages != null) {
var text = TDS.messages.getTextByContext('AccValue', code);
if (text != code) {
return text;
}
}
return label ? label : name;
};
this.setLabel = function(str) {
label = str;
};
this._isDefault = isDefault;
this._selected = false;
this.destroy = function () {
var self = this;
parentType.getParentAccommodations().getDependencies()
.filter(function (dep) {
return dep.ifValue() == self || dep.thenValue() == self;
})
.forEach(function (dep) {
parentType.getParentAccommodations().removeDependency(dep);
});
parentType.getParentAccommodations()._valuesLookup.remove(code);
Util.Array.remove(parentType._values, this);
parentType = null;
code = null;
label = null;
};
this.toString = function () {
return code;
};
};
var AccValueProto = AccValue.prototype;
AccValueProto.setDefault = function (isDefault) {
this._isDefault = !!isDefault;
};
AccValueProto.isDefault = function () {
return this._isDefault;
};
AccValueProto.isSelected = function () { return this._selected; };
AccValueProto.select = function () {
if (this._selected) {
return false;
}
if (!this.isActive()) {
return false;
}
var parentType = this.getParentType();
if (!this.allowCombine()) {
var selectedValues = parentType.getSelected();
selectedValues.forEach(function(selectedValue) {
selectedValue.deselect();
});
}
this._selected = true;
var dependentTypes = parentType.getDependentTypes();
dependentTypes.forEach(function (dependentType) {
var allValues = dependentType.getValues(true);
allValues.forEach(function (dependentValue) {
dependentValue.deselect();
});
var dependentDefaultValue = dependentType.getDefault();
if (dependentDefaultValue) {
dependentDefaultValue.select();
}
});
parentType.getParentAccommodations().fire('selectValue', this);
return true;
};
AccValueProto.deselect = function () {
if (!this._selected) {
return false;
}
this._selected = false;
this.getParentType().getParentAccommodations().fire('deselectValue', this);
return true;
};
AccValueProto.getDependencyRule = function () {
var parentType = this.getParentType();
if (!parentType) {
return null;
}
var dependancyType = parentType.getDependsOnTool();
if (!dependancyType) {
return null;
}
var accs = parentType.getParentAccommodations();
var dependancy = Util.Array.find(accs.getDependencies(), function (dependency) {
var accIfType = dependency.ifType();
if (accIfType && accIfType == dependancyType) {
var accIfValue = dependency.ifValue();
if (accIfValue && accIfValue.isSelected()) {
var accThenValue = dependency.thenValue();
return (accThenValue == this);
}
}
return false;
}, this);
return dependancy;
};
AccValueProto.isActive = function () {
var dependancyType = this.getParentType().getDependsOnTool();
if (dependancyType != null) {
return (this.getDependencyRule() != null);
}
return true;
};
AccValueProto.restrict = function (restrictType, byValue, isDefault) {
var thisType = this.getParentType();
var accs = thisType.getParentAccommodations();
var restrictTypeObj = accs.getType(restrictType);
var restrictValueObj = accs.getValue(byValue);
if (restrictTypeObj) {
restrictTypeObj.setDependsOnTool(thisType.getName());
}
isDefault = isDefault || (restrictValueObj && restrictValueObj.isDefault());
accs.addDependency(thisType.getName(), this.getCode(), restrictType, byValue, isDefault);
};
AccValueProto.depends = function (dependType, onValue, isDefault) {
var thisType = this.getParentType();
var accs = thisType.getParentAccommodations();
thisType.setDependsOnTool(dependType);
isDefault = isDefault || this.isDefault();
accs.addDependency(dependType, onValue, thisType.getName(), this.getCode(), isDefault);
};
return AccValue;
})();

/* SOURCE FILE: accs.dependency.js (1c918546) 10/26/2014 1:27:05 PM */

Accommodations.Dependency = (function () {
function Dependency(parentAccommodations, ifTypeName, ifValueCode, thenTypeName, thenValueCode, thenIsDefault) {
this.ifType = function() {
return parentAccommodations.getType(ifTypeName);
};
this.ifValue = function() {
return parentAccommodations.getValue(ifValueCode);
};
this.thenType = function() {
return parentAccommodations.getType(thenTypeName);
};
this.thenValue = function() {
return parentAccommodations.getValue(thenValueCode);
};
this.isDefault = function() {
return (thenIsDefault === true);
};
this.destroy = function() {
parentAccommodations = null;
ifTypeName = null;
ifValueCode = null;
thenTypeName = null;
thenValueCode = null;
};
};
return Dependency;
})();

/* SOURCE FILE: accs.json.js (14cc16cb) 10/26/2014 1:27:05 PM */

(function(Accs) {
Accs.prototype.importJsonArray = function (accTypes) {
if (!$.isArray(accTypes)) {
return;
}
for (var i = 0; i < accTypes.length; i++) {
var jsonType = accTypes[i];
var accType = this.createTypeFromObject(jsonType);
var jsonvalues = jsonType.values;
for (var j = 0; j < jsonvalues.length; j++) {
var jsonValue = jsonvalues[j];
var accValue = accType.createValueFromObject(jsonValue);
}
}
};
Accs.prototype.importJson = function (accJson) {
if (!accJson) {
return;
}
this.setPosition(accJson.position);
this.setId(accJson.id);
this.setLabel(accJson.label);
this.importJsonArray(accJson.types);
if ($.isArray(accJson.dependencies)) {
for (var i = 0; i < accJson.dependencies.length; i++) {
var jsonDependency = accJson.dependencies[i];
this.addDependency(jsonDependency.ifType, jsonDependency.ifValue, jsonDependency.thenType, jsonDependency.thenValue, jsonDependency.isDefault);
}
}
};
Accs.prototype.exportJson = function () {
var json = {};
json.position = this.getPosition();
json.id = this.getId();
json.label = this.getLabel();
json.types = [];
json.dependencies = [];
this.getTypes().forEach(function(accType) {
var accValues = accType.getValues();
if (accValues.length == 0) {
return;
}
var dependsOnType = accType.getDependsOnTool();
var dependsOnTypeName = (dependsOnType == null) ? null : dependsOnType.getName();
var jsonType = {
name: accType.getName(),
label: accType.getLabel(),
isVisible: accType.isVisible(),
isSelectable: accType.isSelectable(),
allowChange: accType.allowChange(),
studentControl: accType.allowStudentControl(),
dependsOn: dependsOnTypeName
};
json.types.push(jsonType);
jsonType.values = [];
accValues.forEach(function (accValue) {
var jsonValue = {
code: accValue.getCode(),
name: accValue.getName(),
label: accValue.getLabel(),
isDefault: (accValue == accType.getDefault()),
allowCombine: accValue.allowCombine(),
selected: accValue._selected
};
jsonType.values.push(jsonValue);
});
});
this.getDependencies().forEach(function(dependency) {
var jsonDependency = {
ifType: dependency.ifType().getName(),
ifValue: dependency.ifValue().getCode(),
thenType: dependency.thenType().getName(),
thenValue: dependency.thenValue().getCode(),
isDefault: dependency.isDefault()
};
json.dependencies.push(jsonDependency);
});
return json;
};
})(window.Accommodations);

/* SOURCE FILE: accs.props.js (5cfe8814) 10/26/2014 1:27:05 PM */

(function(Accs) {
function Props(accommodations) {
this._accommodations = accommodations;
}
var PropsProto = Props.prototype;
PropsProto.getSelectedValue = function(typeName) {
if (this._accommodations == null) {
return null;
}
var accType = this._accommodations.getType(typeName);
if (accType != null) {
var selectedValues = accType.getSelected();
if (selectedValues.length > 0) {
return selectedValues[0];
}
}
return null;
};
PropsProto.getSelectedCode = function(type) {
var selectedValue = this.getSelectedValue(type);
return (selectedValue) ? selectedValue.getCode() : null;
};
PropsProto.isSelected = function(type, code) {
if (this._accommodations == null) {
return false;
}
var foundValue = this._accommodations.findCode(type, code, true);
return (foundValue != null);
};
PropsProto.existsAndNotEquals = function(type, code) {
var selectedCode = this.getSelectedCode(type);
return (selectedCode != null && selectedCode != code);
};
PropsProto.getLanguage = function() {
var language = this.getSelectedCode('Language');
return (language) ? language : 'ENU';
};
PropsProto.getLanguages = function(selectedOnly) {
var accType = this._accommodations.getType('Language');
return (accType != null) ? accType.getCodes(selectedOnly) : ['ENU'];
};
PropsProto.hasBraille = function() {
if (this.isSelected('Braille', 'TDS_Braille1')) {
return true;
}
var language = this.getLanguage();
return Util.String.endsWith(language, '-Braille');
};
PropsProto.getBrailleType = function() {
return this.getSelectedCode('Braille Type');
};
PropsProto.getCalculator = function() {
return this.getSelectedCode('Calculator');
};
PropsProto.getColorChoice = function() {
return this.getSelectedCode('Color Choices');
};
PropsProto.getFormula = function() {
return this.getSelectedCode('Formula');
};
PropsProto.getFontSize = function() {
return this.getSelectedCode('Font Size');
};
PropsProto.getFontType = function() {
return this.getSelectedCode('Font Type');
};
PropsProto.hasGuideForRevision = function() {
return this.isSelected('Guide for Revision', 'TDS_GfR1');
};
PropsProto.hasHighlighting = function() {
return this.isSelected('Highlight', 'TDS_Highlight1');
};
PropsProto.hasMarkForReview = function() {
return this.isSelected('Mark for Review', 'TDS_MfR1');
};
PropsProto.hasPrintItem = function() {
return this.isSelected('Print on Request', 'TDS_PoD_Item');
};
PropsProto.hasPrintStimulus = function() {
return this.isSelected('Print on Request', 'TDS_PoD_Stim');
};
PropsProto.getPrintSize = function() {
return this.getSelectedCode('Print Size');
};
PropsProto.getPeriodicTable = function() {
return this.getSelectedCode('Periodic Table');
};
PropsProto.hasStrikethrough = function() {
return this.isSelected('Strikethrough', 'TDS_ST1');
};
PropsProto.hasTutorial = function() {
return this.isSelected('Tutorial', 'TDS_T1');
};
PropsProto.hasASIVoiceGuidance = function() {
return this.isSelected('Scaffolding Voice Guidance', 'TDS_ASIGuide1');
};
PropsProto.hasTTSInstruction = function() {
return this.isSelected('TTS', 'TDS_TTS_Inst');
};
PropsProto.hasTTSItem = function() {
return this.isSelected('TTS', 'TDS_TTS_Item');
};
PropsProto.hasTTSStimulus = function() {
return this.isSelected('TTS', 'TDS_TTS_Stim');
};
PropsProto.hasTTS = function () {
return this.existsAndNotEquals('TTS', 'TDS_TTS0');
};
PropsProto.hasTTSPausing = function() {
return this.isSelected('TTS Pausing', 'TDS_TTSPause1');
};
PropsProto.hasCalculator = function() {
return this.existsAndNotEquals('Calculator', 'TDS_Calc0');
};
PropsProto.hasColorChoice = function() {
return this.existsAndNotEquals('Color Choices', 'TDS_CC0');
};
PropsProto.hasFormula = function() {
return this.existsAndNotEquals('Formula', 'TDS_F0');
};
PropsProto.hasPeriodicTable = function() {
return this.existsAndNotEquals('Periodic Table', 'TDS_PT0');
};
PropsProto.hasStudentComments = function() {
return this.existsAndNotEquals('Student Comments', 'TDS_SC0');
};
PropsProto.getStudentComments = function() {
return this.getSelectedCode('Student Comments');
};
PropsProto.getNavigationDropdown = function() {
return this.getSelectedCode('Navigation Dropdown');
};
PropsProto.getTTXBusinessRules = function() {
return this.getSelectedCode('TTX Business Rules');
};
PropsProto.showFeedback = function () {
return this.isSelected('Feedback', 'LPN_FB1');
};
PropsProto.showExpandablePassages = function() {
return this.isSelected('Expandable Passages', 'TDS_ExpandablePassages1');
};
PropsProto.hasAudioControl = function() {
return this.existsAndNotEquals('TTS Audio Adjustments', 'TDS_TTSAA0');
};
PropsProto.showVoicePackControl = function() {
return this.isSelected('TTS Audio Adjustments', 'TDS_TTSAA_SelectVP');
};
PropsProto.showVolumeControl = function() {
return this.isSelected('TTS Audio Adjustments', 'TDS_TTSAA_Volume');
};
PropsProto.showPitchControl = function() {
return this.isSelected('TTS Audio Adjustments', 'TDS_TTSAA_Pitch');
};
PropsProto.showRateControl = function() {
return this.isSelected('TTS Audio Adjustments', 'TDS_TTSAA_Rate');
};
PropsProto.blockPausing = function() {
return this.isSelected('Block Pausing', 'TDS_BP1');
};
PropsProto.hasResponseReset = function() {
return this.isSelected('Item Response Reset', 'TDS_ItemReset1');
};
PropsProto.isTestShellClassic = function() {
return this.isSelected('Test Shell', 'TDS_TS_Classic');
};
PropsProto.isTestShellModern = function() {
return this.isSelected('Test Shell', 'TDS_TS_Modern');
};
PropsProto.isTestShellUniversal = function() {
return this.isSelected('Test Shell', 'TDS_TS_Universal');
};
PropsProto.isTestShellAccessibility = function() {
return this.isSelected('Test Shell', 'TDS_TS_Accessibility');
};
PropsProto.isStreamlinedMode = function() {
return this.isSelected('Streamlined Mode', 'TDS_SLM1');
};
PropsProto.requirePageVisit = function() {
return this.isSelected('Require Page Visit', 'TDS_RPV1');
};
PropsProto.hasASL = function() {
return this.isSelected('American Sign Language', 'TDS_ASL1');
};
PropsProto.hasClosedCaptioning = function () {
return this.isSelected('Closed Captioning', 'TDS_ClosedCap1');
};
PropsProto.hideTestScore = function() {
return this.isSelected('Suppress Score', 'TDS_SS1');
};
PropsProto.showItemScoreReportSummary = function() {
return this.isSelected('Item Score Report', 'TDS_ISR_Summary');
};
PropsProto.showItemScoreReportResponses = function() {
return this.isSelected('Item Score Report', 'TDS_ISR_SumViewResp');
};
PropsProto.isPermissiveModeEnabled = function() {
return this.isSelected('Permissive Mode', 'TDS_PM1');
};
PropsProto.hasFullScreenEnabled = function() {
return this.isSelected('Fullscreen', 'TDS_FS_On') ||
this.isSelected('Fullscreen', 'TDS_FS_Pass');
};
PropsProto.hasFullScreenPassword = function() {
return this.isSelected('Fullscreen', 'TDS_FS_Pass');
};
PropsProto.hasSoundPlayCheck = function() {
return this.isSelected('Hardware Checks', 'TDS_HWPlayback') ||
this.isSelected('Hardware Checks', 'TDS_HWPlaybackVol');
};
PropsProto.hasSoundPlayVolCheck = function () {
return this.isSelected('Hardware Checks', 'TDS_HWPlaybackVol');
};
PropsProto.hasRecorderCheck = function () {
return this.isSelected('Hardware Checks', 'TDS_HWRecording');
};
PropsProto.hasSoundCheck = function() {
return this.existsAndNotEquals('Hardware Checks', 'TDS_HW0');
};
PropsProto.isAutoMute = function() {
return this.isSelected('Mute System Volume', 'TDS_Mute1');
};
PropsProto.hasMaskingEnabled = function() {
return this.isSelected('Masking', 'TDS_Masking1');
};
PropsProto.isAudioRewindEnabled = function() {
return this.isSelected('Audio Playback Controls', 'TDS_APC_PSP');
};
PropsProto.isPaginatedItemGroupsEnabled = function() {
return this.isSelected('Paginate Item Groups', 'TDS_PIG1');
};
PropsProto.hasReverseContrast = function() {
return this.isSelected('Color Choices', 'TDS_CCInvert');
};
PropsProto.getTestProgressIndicator = function() {
return this.getSelectedCode('Test Progress Indictator') || 'TDS_TPI_Responses';
};
PropsProto.hasSystemVolumeControl = function() {
return this.isSelected('System Volume Control', 'TDS_SVC1');
};
PropsProto.isDictionaryEnabled = function() {
return this.existsAndNotEquals('Dictionary', 'TDS_Dict0');
};
PropsProto.getDictionary = function() {
return this.getSelectedCode('Dictionary');
};
PropsProto.getDictionaryOptions = function() {
var accType = this._accommodations.getType('Dictionary Options');
return (accType != null) ? accType.getCodes() : [];
};
PropsProto.isSpanishDictionaryEnabled = function () {
return this.existsAndNotEquals('Spanish Dictionary', 'TDS_SP0');
};
PropsProto.getSpanishDictionary = function () {
return this.getSelectedCode('Spanish Dictionary');
};
PropsProto.getSpanishDictionaryOptions = function () {
var accType = this._accommodations.getType('Spanish Dictionary Options');
return (accType != null) ? accType.getCodes() : [];
};
PropsProto.isThesaurusEnabled = function() {
return this.existsAndNotEquals('Thesaurus', 'TDS_TH0');
};
PropsProto.getThesaurus = function() {
return this.getSelectedCode('Thesaurus');
};
PropsProto.getThesaurusOptions = function() {
var accType = this._accommodations.getType('Thesaurus Options');
return (accType != null) ? accType.getCodes() : [];
};
PropsProto.isTTSTrackingEnabled = function() {
return this.existsAndNotEquals('TTS Tracking', 'TDS_TTSTracking0');
};
PropsProto.isSecurityBreachDetectionEnabled = function() {
return this.isSelected('Enhanced Security Options', 'TDS_ESO_DetectBrowserBreach') && !this.isPermissiveModeEnabled();
};
PropsProto.showItemToolsMenu = function() {
return this.isSelected('Item Tools Menu', 'TDS_ITM1');
};
PropsProto.checkOptionalUnanswered = function() {
return this.isSelected('Check Optional Unanswered', 'TDS_COU1');
};
PropsProto.getHTMLEditorButtonGroups = function () {
var accType = this._accommodations.getType('HTMLEditor Button Groups');
var selButtonGroups = accType ? accType.getSelected() : [];
var buttonGroups = [];
for (var index = 0; index < selButtonGroups.length; ++index) {
buttonGroups.push(selButtonGroups[index].getCode());
}
return buttonGroups;
};
PropsProto.isReviewScreenLayoutDropDown = function() {
return this.isSelected('Review Screen Layout', 'TDS_RSL_DropDown');
};
PropsProto.isReviewScreenLayoutListView = function () {
return this.isSelected('Review Screen Layout', 'TDS_RSL_ListView');
};
Accs.Properties = Props;
})(Accommodations);

/* SOURCE FILE: accs.manager.js (431c0630) 10/26/2014 1:27:05 PM */

Accommodations.Manager =
{
_mapOfAccommodations: new Util.Structs.Map(),
_current: null,
onChange: new YAHOO.util.CustomEvent('onChange', Accommodations.Manager, false, YAHOO.util.CustomEvent.FLAT)
};
Accommodations.Manager.clear = function() {
this._mapOfAccommodations.clear();
this._current = null;
};
Accommodations.Manager.add = function(accommodations) {
var id = accommodations.getId();
this._mapOfAccommodations.set(id, accommodations);
if (this._current == null) {
this.setDefault(id);
this.setCurrent(id);
}
};
Accommodations.Manager.get = function(id) {
return this._mapOfAccommodations.get(id);
};
Accommodations.Manager.getProperties = function(id) {
var accommodations = this.get(id);
return new Accommodations.Properties(accommodations);
};
Accommodations.Manager.setDefault = function(id) {
if (YAHOO.lang.isString(id)) {
this._default = id;
}
};
Accommodations.Manager.getDefault = function() {
return this.get(this._default);
};
Accommodations.Manager.getDefaultProperties = function() {
var accommodations = this.getDefault();
return new Accommodations.Properties(accommodations);
};
Accommodations.Manager.getDefaultProps = Accommodations.Manager.getDefaultProperties;
Accommodations.Manager.setCurrent = function (id) {
if (!YAHOO.lang.isString(id)) return;
if (id == this._current) return;
if (this.get(id) == null) return;
var accsPrevious = this.getCurrent();
this._current = id;
var accsCurrent = this.getCurrent();
this.onChange.fire({
previous: accsPrevious,
current: accsCurrent
});
};
Accommodations.Manager.getCurrent = function() {
return this.get(this._current);
};
Accommodations.Manager.getCurrentProperties = function() {
var accommodations = this.getCurrent();
return new Accommodations.Properties(accommodations);
};
Accommodations.Manager.getCurrentProps = Accommodations.Manager.getCurrentProperties;
Accommodations.Manager.addJson = function(json) {
if (YAHOO.lang.isArray(json)) {
Util.Array.each(json, Accommodations.Manager.addJson, this);
} else {
var accommodations = Accommodations.create(json);
accommodations.selectAll();
this.add(accommodations);
}
};
Accommodations.Manager.updateCSS = function(el, newId) {
var newAccs = Accommodations.Manager.get(newId);
if (newAccs == null) return;
var currentId = el.getAttribute(Accommodations.DOM_ID);
if (currentId != newId) {
if (currentId != null) {
var currentAccs = Accommodations.Manager.get(currentId);
if (currentAccs) {
currentAccs.removeCSS(el);
}
}
newAccs.applyCSS(el);
}
};

/* SOURCE FILE: accs.renderer.js (0dcd3fea) 10/26/2014 1:27:05 PM */

Accommodations.Renderer = (function() {
function Renderer(accs, opts) {
this._accs = accs;
this._opts = opts || {};
YAHOO.lang.augmentObject(this._opts, {
showHidden: false,
showLocked: false,
reviewDisabled: false,
reviewAll: false
});
}
Renderer.prototype.getContainer = function() {
var containerId = 'accs-container-' + this._accs.getId();
return document.getElementById(containerId);
};
Renderer.prototype.getForm = function() {
var formId = 'accs-form-' + this._accs.getId();
return document.forms[formId];
};
Renderer.prototype._onSelect = function(accValue) {
console.log('AccSelect: ' + accValue);
this.renderTypes(accValue.getParentType().getDependentTypes());
};
Renderer.prototype.bind = function () {
this._accs.on('selectValue', this._onSelect.bind(this));
};
Renderer.prototype.unbind = function () {
this._accs.removeListener('selectValue', this._onSelect.bind(this));
};
Renderer.prototype.render = function (parentEl) {
parentEl = YAHOO.util.Dom.get(parentEl);
var container = this.getContainer();
if (!container) {
var containerId = 'accs-container-' + this._accs.getId();
container = HTML.DIV({ id: containerId });
}
parentEl.appendChild(container);
var form = this.getForm();
if (!form) {
var formId = 'accs-form-' + this._accs.getId();
form = HTML.FORM({ id: formId, name: formId });
}
container.appendChild(form);
var accTypes = this._accs.getTypes().filter(function(accType) {
return (!accType.getDependsOnTool());
});
this.renderTypes(accTypes);
return true;
};
Renderer.prototype.renderTypes = function (accTypes) {
accTypes.forEach(this.renderType.bind(this));
};
Renderer.prototype.renderType = function (accType) {
var containerEl = this.createContainer(accType);
if ((!this._opts.showHidden && !accType.isVisible()) ||
(!this._opts.showLocked && !accType.isSelectable())) {
$(containerEl).hide();
} else {
$(containerEl).show();
var editable = (accType.getValues().length > 1);
var disabled = (!accType.isSelectable() || !editable);
var reviewMode = ((this._opts.reviewAll && (!editable || !accType.allowStudentControl())) ||
(this._opts.reviewDisabled && disabled));
var labelEl = this.createLabel(accType, reviewMode);
containerEl.appendChild(labelEl);
var ctrlEl;
if (reviewMode) {
ctrlEl = this.createList(accType);
} else {
if (accType.isBoolSelect()) {
$(containerEl).addClass('checkbox');
ctrlEl = this.createCheckBox(accType, disabled);
} else if (accType.isMultiSelect()) {
$(containerEl).addClass('multiselect');
ctrlEl = this.createCheckboxes(accType, disabled);
} else {
$(containerEl).addClass('singleselect');
ctrlEl = this.createDropdown(accType, disabled);
}
}
if (ctrlEl) {
$(ctrlEl).addClass('control');
containerEl.appendChild(ctrlEl);
}
var clearEl = document.createElement('span');
clearEl.className = 'clear';
containerEl.appendChild(clearEl);
}
this.getForm().appendChild(containerEl);
this.renderTypes(accType.getDependentTypes());
};
Renderer.prototype.createContainer = function(accType) {
var containerEl = document.getElementById(accType.getControlId());
if (containerEl) {
$(containerEl).empty();
}
if (!containerEl) {
containerEl = document.createElement('div');
containerEl.setAttribute('id', accType.getControlId());
}
containerEl.className = '';
if (accType.getDependsOnTool()) {
$(containerEl).addClass('dependency');
}
return containerEl;
};
Renderer.prototype.createLabel = function(accType, reviewMode) {
var labelEl = document.createElement(reviewMode ? 'span' : 'label');
labelEl.className = 'label';
if (!reviewMode) {
labelEl.setAttribute('for', accType.getId());
labelEl.setAttribute('i18n-text', accType.getId());
}
var labelText = document.createTextNode(accType.getLabel() + ': ');
labelEl.appendChild(labelText);
return labelEl;
};
Renderer.prototype.createList = function(accType) {
var spanEl = document.createElement('span');
var valueNames = accType.getSelected().map(function (accValue) {
return accValue.getLabel();
});
$(spanEl).text(valueNames.join(', '));
return spanEl;
};
Renderer.prototype.createCheckBox = function (accType, disabled) {
var accValues = accType.getValues();
var trueValue = Util.Array.find(accValues, function(accValue) {
return accValue.getName() == 'True';
});
var checkbox = document.createElement('input');
checkbox.setAttribute('id', accType.getId());
checkbox.setAttribute('name', accType.getId());
checkbox.setAttribute('type', 'checkbox');
checkbox.setAttribute('tabindex', 0);
checkbox.value = trueValue.getCode();
accValues.forEach(function (accValue) {
if (accValue.isSelected() && accValue.getCode() == checkbox.value) {
checkbox.checked = true;
}
});
if (disabled) {
checkbox.disabled = true;
}
YUE.on(checkbox, 'click', function() {
this.save();
}.bind(this));
return checkbox;
};
Renderer.prototype.createCheckboxes = function (accType, disabled) {
var accs = this._accs;
var form = this.getForm();
var valueContainer = document.createElement('div');
valueContainer.className = 'values';
function clickEvent(clickedCheckbox, clickedValue) {
var checkboxes = form[accType.getId()];
if (!clickedCheckbox.checked) {
var defaultValue = accType.getDefault();
var defaultCheckbox = null;
$(checkboxes).each(function(idx, checkbox) {
if (defaultValue.getCode() == checkbox.value) {
defaultCheckbox = checkbox;
}
if (checkbox.checked) {
return;
}
});
if (defaultCheckbox) {
defaultCheckbox.checked = true;
}
return;
}
$(checkboxes).each(function(idx, checkbox) {
if (clickedValue.allowCombine()) {
var accValue = accs.getValue(checkbox.value);
if (!accValue.allowCombine()) {
checkbox.checked = false;
}
} else if (clickedCheckbox.value != checkbox.value) {
checkbox.checked = false;
}
});
};
var accValues = accType.getValues();
accValues.forEach(function(accValue) {
var valueLabel = document.createElement('label');
if (!accType.isSelectable()) {
valueLabel.className = 'disabled';
}
valueContainer.appendChild(valueLabel);
var valueCB = document.createElement('input');
valueCB.setAttribute('name', accType.getId());
valueCB.setAttribute('type', 'checkbox');
valueCB.value = accValue.getCode();
if (accValue.allowCombine()) {
valueCB.className = 'allowCombine';
}
if (accValue.isSelected()) {
valueCB.checked = true;
}
if (disabled) {
valueCB.disabled = true;
}
YUE.on(valueCB, 'click', function() {
clickEvent(valueCB, accValue);
this.save();
}.bind(this));
valueLabel.appendChild(valueCB);
var labelText = document.createTextNode(accValue.getLabel());
valueLabel.appendChild(labelText);
}.bind(this));
return valueContainer;
};
Renderer.prototype.createDropdown = function (accType, disabled) {
var accValues = accType.getValues();
var select = document.createElement('select');
select.id = accType.getId();
select.name = accType.getId();
select.setAttribute('tabindex', 0);
if (accType.isMultiSelect()) {
select.setAttribute('multiple', 'multiple');
}
var optIdx = 0;
accValues.forEach(function (accValue) {
if (accType.isMultiSelect()) {
if (accValue.getCode() == 'None' || accValue.getCode().indexOf('_None') != -1) {
return;
}
}
var optionLabel = accValue.getLabel() || accValue.getCode();
var optionValue = accValue.getCode();
var option = select.options[optIdx] = new Option(optionLabel, optionValue);
option.selected = accValue.isSelected();
optIdx++;
});
if (disabled) {
select.disabled = true;
}
YUE.on(select, 'change', function () {
this.save();
}.bind(this));
return select;
};
Renderer.prototype._saveType = function (accType) {
var form = this.getForm();
var accValues = accType.getValues();
var ctrl = form[accType.getId()];
if (!ctrl) {
return;
}
if (accType.isBoolSelect()) {
var accValue = ctrl.checked ? accValues[1] : accValues[0];
this._accs.selectCodes(accType.getName(), [accValue.getCode()]);
}
else if (accType.isMultiSelect()) {
var selectedCodes = [];
$(ctrl).each(function (idx, checkbox) {
if (checkbox.checked) {
selectedCodes.push(checkbox.value);
}
});
this._accs.selectCodes(accType.getName(), selectedCodes);
}
else {
this._accs.selectCodes(accType.getName(), [ctrl.value]);
}
};
Renderer.prototype.save = function() {
this._accs.getTypes().forEach(this._saveType.bind(this));
};
return Renderer;
})();

/* SOURCE FILE: accs.dialog.js (4b543357) 10/26/2014 1:27:05 PM */

Accommodations.Dialog = (function() {
var yuiDialog = null;
function AccsDialog(accs, parentEl, width, height) {
this.onCancel = new YAHOO.util.CustomEvent('onCancel', this, true, YAHOO.util.CustomEvent.FLAT);
this.onBeforeSave = new YAHOO.util.CustomEvent('onBeforeSave', this, true, YAHOO.util.CustomEvent.FLAT);
this.onSave = new YAHOO.util.CustomEvent('onSave', this, true, YAHOO.util.CustomEvent.FLAT);
this._parentContainer = YAHOO.util.Dom.get(parentEl);
this._yuiDialog = null;
this._width = width || 350;
this._height = height || 400;
this._accommodations = accs;
this._renderer = null;
}
AccsDialog.prototype._init = function() {
var self = this;
YAHOO.util.Dom.setStyle(this._parentContainer, 'display', '');
var handleSubmit = function() {
this.hide();
self.onBeforeSave.fire(self._accommodations);
self._renderer.save();
self.onSave.fire(self._accommodations);
};
var handleCancel = function() {
this.hide();
self.onCancel.fire();
};
yuiDialog = new YAHOO.widget.Dialog(this._parentContainer, {
modal: true,
visible: false,
draggable: false,
close: false,
postmethod: 'none'
});
TDS.Dialog.fixTabIndex(yuiDialog);
yuiDialog.cfg.queueProperty('buttons', [
{ text: 'Submit', handler: handleSubmit, isDefault: true },
{ text: 'Cancel', handler: handleCancel }
]);
yuiDialog.beforeShowEvent.subscribe(function() {
var buttons = yuiDialog.getButtons();
buttons[0].set('label', Messages.getAlt('Global.Button.Submit', 'Submit'));
buttons[1].set('label', Messages.getAlt('Global.Button.Cancel', 'Cancel'));
});
this._renderer = new Accommodations.Renderer(this._accommodations);
};
AccsDialog.prototype.show = function () {
if (!yuiDialog) {
this._init();
}
var el = $('div.bd', yuiDialog.innerElement).get(0);
this._renderer.render(el);
yuiDialog.render();
yuiDialog.changeContentEvent.fire();
yuiDialog.show();
};
return AccsDialog;
})();

/* SOURCE FILE: tds.js (7c978bf3) 10/26/2014 1:27:05 PM */

var TDS = window.TDS || {};
var tds = TDS;
TDS._initialized = false;
TDS.buildNumber = 0;
TDS.baseUrl = '';
TDS.messages = null;
TDS.globalAccommodations = null;
TDS.testeeCheckin = null;
TDS.clientStylePath = null;
TDS.isProxyLogin = false;
TDS.isDataEntry = false;
TDS.isReadOnly = false;
TDS.isSIRVE = false;
TDS.inPTMode = false;
TDS.showItemScores = false;
TDS.Settings = {};
TDS.Debug = {
showExceptions: false,
ignoreForbiddenApps: false,
ignoreBrowserChecks: false
};
TDS.init = function () {
if (TDS._initialized) {
return;
}
if (TDS.Config) {
TDS.Config.load();
}
if (TDS.messages) {
TDS.messages._getLanguage = TDS.getLanguage;
TDS.Messages.Template.processLanguage();
}
TDS._initialized = true;
Util.log('TDS INIT');
};
TDS.getAccommodations = function () {
if (typeof LoginShell == 'object' && LoginShell.segmentsAccommodations != null) {
return LoginShell.segmentsAccommodations[0];
}
if (typeof ContentManager == 'object') {
var page = ContentManager.getCurrentPage();
if (page) {
return page.getAccommodations();
}
}
var accommodations = Accommodations.Manager.getCurrent();
if (accommodations) {
return accommodations;
}
return TDS.globalAccommodations;
};
TDS.getAccs = TDS.getAccommodations;
TDS.getAccommodationProperties = function() {
var accommodations = TDS.getAccommodations();
return new Accommodations.Properties(accommodations);
};
TDS.getAccProps = TDS.getAccommodationProperties;
TDS.getLanguages = function() {
var accGlobalProps = new Accommodations.Properties(TDS.globalAccommodations);
return accGlobalProps.getLanguages();
};
TDS.getLanguage = function() {
var accProps = TDS.getAccommodationProperties();
return accProps.getLanguage();
};
TDS.resolveBaseUrl = function(path) {
var url = TDS.baseUrl + (path || '');
return Util.Browser.resolveUrl(url);
};
TDS.redirect = function(url) {
if (TDS.Dialog) {
TDS.Dialog.showProgress();
}
var raw = Util.String.isHttpProtocol(url);
if (raw !== true) {
url = this.baseUrl + url;
}
setTimeout(function() {
top.window.location.href = url;
}, 1);
};
TDS.redirectError = function(key, header, context) {
var url = TDS.baseUrl + 'Pages/Notification.aspx';
if (YAHOO.lang.isString(key)) {
var message = Messages.get(key);
url += '?messageKey=' + encodeURIComponent(message);
}
if (YAHOO.lang.isString(header)) {
url = url + "&header=" + encodeURIComponent(header);
}
if (YAHOO.lang.isString(context)) {
url = url + "&context=" + encodeURIComponent(context);
}
top.location.href = url;
};
TDS.redirectTestShell = function (pageNum, itemNum) {
var redirectUrl;
var accProps = TDS.getAccommodationProperties();
if (accProps.isTestShellModern()) {
redirectUrl = 'Pages/TestShell.aspx?name=modern';
} else {
redirectUrl = 'Pages/TestShell.aspx';
}
if (pageNum > 0) {
redirectUrl += (redirectUrl.indexOf('?') != -1) ? '&' : '?';
redirectUrl += 'page=' + pageNum;
}
if (itemNum > 0) {
redirectUrl += (redirectUrl.indexOf('?') != -1) ? '&' : '?';
redirectUrl += 'item=' + itemNum;
}
TDS.redirect(redirectUrl);
};
TDS.getLoginUrl = function() {
var url;
if (typeof TDS.Student == 'object') {
url = TDS.Student.Storage.getReturnUrl();
}
if (TDS.isProxyLogin) {
url = TDS.Student.Storage.getProctorReturnUrl() || url ;
}
if (url == null) {
url = TDS.baseUrl;
url += 'Pages/LoginShell.aspx?logout=true';
}
return url;
};
TDS.logout = function () {
var url = TDS.getLoginUrl();
if (TDS.isProxyLogin) {
var proctor = (window.LoginShell) ? LoginShell.proctor : null;
var storage = TDS.Student.Storage;
var testSession = storage.getTestSession();
var sessionKey = (proctor) ? proctor.sessionKey : testSession.key;
var proctorKey = (proctor) ? proctor.proctorKey : testSession.proctorKey;
var loginBrowserKey = (proctor) ? proctor.loginBrowserKey : storage.getProctorLoginBrowserKey();
var satBrowserKey = (proctor) ? proctor.satBrowserKey : storage.getProctorSatBrowserKey();
var logoutProctorCallback = function() {
TDS.redirect(url);
}
TDS.Student.API.logoutProctor(sessionKey, proctorKey, loginBrowserKey, satBrowserKey).then(logoutProctorCallback);
} else {
TDS.redirect(url);
}
};
TDS.logoutProctor = function(exl) {
TDS.redirect('Pages/Proxy/logout.aspx?exl=' + exl, false);
};
TDS.getAppSetting = function (name, defaultValue                            ) {
if (TDS.Config && TDS.Config.appSettings) {
var value = TDS.Config.appSettings[name];
if (value !== undefined) {
return value;
}
}
return defaultValue;
};
(function () {
YAHOO.util.Event.onDOMReady(TDS.init);
YAHOO.util.Event.throwErrors = true;
if (typeof Util == 'object') {
Util.Dom.stopDragEvents();
}
})();

/* SOURCE FILE: tds_config.js (c8318e19) 10/26/2014 1:27:06 PM */

TDS.Config = (function(TDS, Config) {
YAHOO.lang.augmentObject(Config, {
styles: [],
accs_global: null,
accs_segments: null,
messages: null,
appSettings: null
});
function setStyles() {
if (Config.styles) {
Util.Array.each(Config.styles, function(style) {
YUD.addClass(document.body, style);
});
}
}
function loadGlobalAccs() {
if (typeof Accommodations != 'function') {
return;
}
TDS.globalAccommodations = new Accommodations('global');
if (Config.accs_global) {
TDS.globalAccommodations.importJson(Config.accs_global);
TDS.globalAccommodations.selectDefaults();
}
}
function loadTestAccs() {
if (typeof Accommodations != 'function') {
return;
}
if (typeof TDS.Student == 'object') {
Config.accs_segments = TDS.Student.Storage.getAccJson();
}
if (Config.accs_segments) {
Config.accs_segments.forEach(function(json) {
var accommodations = Accommodations.create(json);
Accommodations.Manager.add(accommodations);
});
}
}
function loadMessages() {
if (typeof TDS.Messages != 'object') {
return;
}
var messageLoader = new TDS.Messages.MessageLoader();
if (Config.messages) {
messageLoader.load(Config.messages);
}
TDS.messages = messageLoader.getMessageSystem();
};
Config.load = function() {
setStyles();
loadGlobalAccs();
loadTestAccs();
loadMessages();
};
return Config;
})(window.TDS, window.TDS.Config || {});

/* SOURCE FILE: tds_diagnostics.js (072e505e) 9/9/2014 2:09:05 PM */

if (typeof TDS != 'object') TDS = {};
TDS.Diagnostics = (function (TDS) {
var loggers = [];
var sendCount = 0;
var sendLimit = 10;
var signatures = {};
var debugMode = false;
var Kit;
if (typeof window.CrashKit == 'object') {
Kit = window.CrashKit;
} else if (typeof window.TraceKit == 'object') {
Kit = window.TraceKit;
}
function setDebugMode(enabled) {
debugMode = enabled;
}
function registerLogger(fn) {
loggers.push(fn);
}
function report(ex, rethrow) {
if (Kit) {
if (typeof ex == 'string') {
try {
throw new Error(ex);
} catch (ex2) {
ex = ex2;
}
}
try {
Kit.report(ex);
return;
} catch (ex) {
}
}
if (typeof rethrow != 'boolean' || rethrow) {
throw ex;
}
};
function addErrorHandler(win) {
if (Kit) {
Kit.report.addErrorHandler(win);
}
};
function getUrl(name) {
return TDS.baseUrl + 'Pages/API/Global.axd/' + name;
}
function sendRequest(url, callback, data) {
YAHOO.util.Connect.asyncRequest('POST', url, callback, data);
}
function logServerError(message, details, completed) {
if (!message) {
return;
}
try {
message = encodeURIComponent(message);
details = details ? encodeURIComponent(details) : '';
var callback = {
timeout: 30000
};
if (typeof completed == 'function') {
callback.success = completed.bind(null, true);
callback.failure = completed.bind(null, false);
}
var url = getUrl('LogError');
sendRequest(url, callback, 'message=' + message + '&details=' + details);
} catch (ex) {
Util.log('logError failed: ' + ex.message);
}
};
function getServerDebugDetails() {
var details = 'TDS LOGS: ' + Util.getDebugLog();
details += '\n\n';
return details;
};
function logServerDebug(message) {
message = message || '';
var sendLog = function (message, showID) {
var details = getServerDebugDetails();
logServerError('JAVASCRIPT LOG DUMP: ' + message, details, showID);
};
sendLog(message, false);
};
function getExceptionSummary(stackInfo) {
var message = 'JS EXCEPTION: \n "' + stackInfo.message + '"';
if (stackInfo.mode != 'failed') {
try {
var urlPieces = stackInfo.stack[0].url.split('/');
var urlFile = urlPieces[urlPieces.length - 1];
if (urlFile) {
if (urlFile.toLowerCase().indexOf('scripthandler.axd') != -1) {
urlFile = 'scripthandler';
} else {
urlFile = urlFile.split('?')[0];
}
}
message += ' on line ' + stackInfo.stack[0].line + ' of the file ' + urlFile;
} catch (e) {
message += ' [error parsing stack]';
}
}
return message;
}
var DIVIDER = '#####';
function appendDivider(sb) {
sb.appendLine(DIVIDER);
}
function appendLoggers(sb) {
loggers.forEach(function (fn) {
try {
var logStr = fn();
if (logStr) {
sb.appendLine();
sb.appendLine(logStr);
sb.appendLine();
sb.appendLine(DIVIDER);
}
} catch (ex) {
}
});
}
function getExceptionDetails(stackInfo) {
var details = new Util.StringBuilder();
if (stackInfo.stack && stackInfo.stack.length > 0 && stackInfo.Name != "failed") {
stackInfo.stack.forEach(function (frame) {
details.appendFormat("FUNCTION: '{0}' {1} ({2})", frame.func, frame.url, frame.line);
details.appendLine();
details.appendLine("CONTEXT:");
if (frame.context && frame.context.length > 0) {
var row = 0;
frame.context.forEach(function (code) {
if (typeof code == 'string') {
if (code.length > 80) {
code = code.substring(0, 80);
}
if (!Util.String.endsWith(code, '\n')) {
code += '\n';
}
}
details.appendFormat("{0}: {1}", ++row, code);
});
}
details.appendLine();
});
}
appendDivider(details);
appendLoggers(details);
return details.toString();
}
function globalExceptionHandler(stackInfo) {
if (!stackInfo || !stackInfo.message) {
return;
}
if (debugMode) {
var summary = getExceptionSummary(stackInfo);
try {
TDS.Dialog.showAlert(summary);
} catch (e) {
alert(summary);
}
}
var stackHash = Util.String.hashCode(stackInfo.message);
if (signatures[stackHash]) {
return;
}
sendCount++;
if (sendCount > sendLimit) {
return;
}
signatures[stackHash] = true;
var serverMessage = 'JS EXCEPTION: ' + stackInfo.message;
var serverDetails;
try {
serverDetails = getExceptionDetails(stackInfo);
} catch (ex) {
serverDetails = 'JS PARSING ERROR: ' + ex.message;
}
logServerError(serverMessage, serverDetails);
console.warn(serverDetails);
};
if (Kit) {
Kit.report.subscribe(globalExceptionHandler);
if (typeof window.TraceKit == 'object' && window.TraceKit === Kit) {
var traceKitWindowOnError = window.onerror;
Kit.report.addErrorHandler = function (win) {
if (win) {
win.onerror = traceKitWindowOnError;
}
}
TraceKit.linesOfContext = 5;
}
}
$(document).ready(function() {
setDebugMode(TDS.Debug.showExceptions);
});
return {
report: report,
addErrorHandler: addErrorHandler,
logServerError: logServerError,
logServerDebug: logServerDebug,
showError: setDebugMode.bind(null, true),
registerLogger: registerLogger,
appendDivider: appendDivider,
appendLoggers: appendLoggers
};
})(TDS);

/* SOURCE FILE: tds_ToolManager.js (8eefd665) 9/9/2014 2:09:05 PM */

window.TDS = window.TDS || {};
(function(TDS) {
var TM = {
_timeout: 120,
_overlayManager: new YAHOO.widget.OverlayManager(),
_container: null,
Events: new Util.EventManager()
};
TM.makeResize = function(panel) {
var mask = panel.getMask();
var frame = panel.getFrame();
var IE_QUIRKS = (YAHOO.env.ua.ie && document.compatMode == "BackCompat");
var IE_SYNC = (YAHOO.env.ua.ie == 6 || (YAHOO.env.ua.ie == 7 && IE_QUIRKS));
var PANEL_BODY_PADDING = (10 * 2);
var resize = new YAHOO.util.Resize(panel.id, {
autoRatio: false,
minWidth: 300,
minHeight: 100,
status: false,
proxy: true,
hover: true
});
if (YAHOO.env.ua.ie == 6) {
YUD.setStyle(resize._handles.r, 'height', (panel.element.offsetHeight - 5) + 'px');
resize.on('startResize', function() {
YUD.setStyle(mask, 'height', panel.body.offsetHeight + 'px');
YUD.setStyle(mask, 'width', panel.body.offsetWidth + 'px');
});
}
resize.on('resize', function(args) {
var panelHeight = args.height;
var panelWidth = args.width;
if (!panelHeight) {
panelHeight = resize._cache.height;
}
if (!panelWidth) {
panelWidth = resize._cache.width;
}
var headerHeight = (this.header) ? this.header.offsetHeight : 0;
var footerHeight = (this.footer) ? this.footer.offsetHeight : 0;
var bodyHeight = (panelHeight - headerHeight - footerHeight);
var bodyContentHeight = (IE_QUIRKS) ? bodyHeight : bodyHeight - PANEL_BODY_PADDING;
var bodyContentWidth = (IE_QUIRKS) ? panelWidth : panelWidth - PANEL_BODY_PADDING;
YUD.setStyle(this.body, 'height', bodyContentHeight + 'px');
YUD.setStyle(this.body, 'width', bodyContentWidth + 'px');
if (YAHOO.env.ua.ie == 6) {
YUD.setStyle(resize._handles.r, 'height', (this.element.offsetHeight - 5) + 'px');
YUD.setStyle(mask, 'height', bodyHeight + 'px');
YUD.setStyle(mask, 'width', panelWidth + 'px');
YUD.setStyle(frame, 'height', bodyContentHeight + 'px');
YUD.setStyle(frame, 'width', bodyContentWidth + 'px');
}
if (IE_SYNC) {
this.sizeUnderlay();
this.syncIframe();
}
}, panel, true);
};
TM.bottomLeft = function(dialog) {
dialog.refresh();
var nViewportOffset = 10,
elementWidth = dialog.element.offsetWidth,
elementHeight = dialog.element.offsetHeight,
viewPortWidth = YUD.getViewportWidth(),
viewPortHeight = YUD.getViewportHeight(),
x,
y;
x = nViewportOffset + YUD.getDocumentScrollLeft();
var footerOffset = (YUD.get('foot') ? YUD.get('foot').offsetHeight : 0);
if ((elementHeight + footerOffset) < viewPortHeight) {
y = (viewPortHeight - elementHeight - footerOffset) + YUD.getDocumentScrollTop();
} else {
y = nViewportOffset + YUD.getDocumentScrollTop();
}
dialog.cfg.setProperty("xy", [parseInt(x, 10), parseInt(y, 10)]);
dialog.cfg.refireEvent("iframe");
if (YAHOO.env.ua.webkit) {
dialog.forceContainerRedraw();
}
};
TM.init = function() {
TM._container = YUD.get('tools');
if (!TM._container) {
TM._container = HTML.DIV({ id: 'tools' });
document.body.appendChild(TM._container);
}
TM.Events.fire('init');
};
TM.createPanel = function(id, name, header, footer, key, resize) {
var panel = new YAHOO.widget.Dialog(id, {
draggable: true,
constraintoviewport: true,
close: true,
underlay: 'none',
visible: false,
zindex: 998
});
var htmlBody = [];
htmlBody.push('<iframe id="frame-' + id + '" frameborder="0" marginheight="0" marginwidth="0" height="100%" width="100%"></iframe>');
htmlBody.push('<div class="yui-panel-mask"></div>');
if (header) {
panel.setHeader(header);
}
panel.setBody(htmlBody.join(''));
if (footer) {
panel.setFooter(footer);
}
panel.getFrame = function() {
return this.element.getElementsByTagName('iframe')[0];
};
panel.getMask = function() {
return YUD.getElementsByClassName('yui-panel-mask', 'div', panel.element)[0];
};
panel.isShowing = function() {
return TM.isShowing(id);
};
panel.load = function() {
TM.loadKey(panel, key);
};
panel.renderEvent.subscribe(function() {
panel.dd.useShim = true;
YUD.addClass(panel.innerElement, 'tool');
var className = 'tool-' + name;
YUD.addClass(panel.innerElement, className);
if (panel.innerElement && panel.innerElement.parentNode) {
YUD.addClass(panel.innerElement.parentNode, className + '-container');
}
panel.load();
}, panel, true);
panel.refresh = function() {
panel.cfg.setProperty('width', YUD.getStyle(panel.innerElement, 'width'));
panel.cfg.setProperty('height', YUD.getStyle(panel.innerElement, 'height'));
};
TM.Events.fire('onCreating', panel);
panel.render(TM._container);
TM.bottomLeft(panel);
if (resize) {
TM.makeResize(panel);
}
panel.beforeShowEvent.subscribe(function() {
panel.refresh();
});
panel.showEvent.subscribe(function() {
TM.Events.fire('onShow', panel);
setTimeout(function() {
TM._overlayManager.focus(panel);
}, 0);
});
panel.beforeHideEvent.subscribe(function() {
if (Util.Browser.isSecure() && !Util.Browser.isMac()) {
Util.SecureBrowser.fixFocus();
}
});
panel.hideEvent.subscribe(function() {
TM.Events.fire('onHide', panel);
Util.Dom.focusWindow(2);
});
TM._overlayManager.register(panel);
TM.Events.fire('onCreated', panel);
return panel;
};
TM.loadFrameUrl = function (container, frame, url, success, abort) {
var timer = null;
function loadFrame() {
YUD.addClass(container, 'yui-panel-loading');
YUE.addListener(frame, 'load', onFrameLoaded);
timer = YAHOO.lang.later((TM._timeout * 1000), this, onFrameAborted);
frame.src = url;
}
function onFrameLoaded() {
Util.log('tool load: ' + url);
YUD.removeClass(container, 'yui-panel-loading');
if (timer) {
timer.cancel();
}
YUE.removeListener(frame, 'load', onFrameLoaded);
var frameDoc = Util.Dom.getFrameContentDocument(frame);
var allowAccess = true;
try {
var test = frameDoc.URL;
} catch (ex) {
allowAccess = false;
}
if (allowAccess) {
if (frame.src == '' || frameDoc.URL == 'about:blank') {
return;
}
KeyManager.attachListener(frameDoc);
Util.Dom.copyCSSFrame(frame);
}
if (YAHOO.lang.isFunction(success)) {
success(frameDoc, allowAccess);
}
}
function onFrameAborted() {
Util.log('tool abort: ' + url);
YUD.removeClass(container, 'yui-panel-loading');
YUE.removeListener(frame, 'load', onFrameLoaded);
var frameWin = Util.Dom.getFrameContentWindow(frame);
try {
frameWin.stop();
} catch (ex) {
}
if (YAHOO.lang.isFunction(abort)) {
abort();
}
var errorMessage = 'Timeout occured loading content.';
var errorLink = '<a href="#" id=\"reload\">Click here to reload</a>';
frame.src = Util.Frame.BLANK_SOURCE;
Util.Frame.writeContent(frame, errorMessage + ' ' + errorLink);
var frameDoc = Util.Dom.getFrameContentDocument(frame);
YUE.addListener(frameDoc.getElementById('reload'), 'click', function(ev) {
YUE.stopEvent(ev);
loadFrame();
});
}
loadFrame();
};
TM.loadUrl = function(panel, url, fn) {
var frame = panel.getFrame();
TM.loadFrameUrl(panel.element, frame, url, function() {
TM.Events.fire('onLoaded', panel);
if (YAHOO.lang.isFunction(fn)) {
fn();
}
});
};
TM.loadFrameKey = function(container, frame, messageKey, fn) {
if (!messageKey) {
return;
}
var url;
if (Util.String.isHttpProtocol(messageKey)) {
url = messageKey;
} else if (Messages.has(messageKey)) {
url = Messages.get(messageKey);
url = TDS.baseUrl + 'Pages/' + url;
} else {
return;
}
TM.loadFrameUrl(container, frame, url, fn);
};
TM.loadKey = function(panel, messageKey) {
var frame = panel.getFrame();
function onPanelLoaded() {
TM.Events.fire('onLoaded', panel);
}
function onPanelFailed() {
TM.Events.fire('onFailed', panel);
}
TM.loadFrameKey(panel.element, frame, messageKey, onPanelLoaded, onPanelFailed);
};
TM.get = function(id) {
return TM._overlayManager.find(id);
};
TM.getAll = function() {
return TM._overlayManager.overlays;
};
TM.isShowing = function(id) {
var panel = TM.get(id);
return (panel) ? panel.cfg.getProperty("visible") : false;
};
TM.hide = function(id) {
var panel = TM.get(id);
if (panel) {
panel.hide();
}
};
TM.hideAll = function() {
TM._overlayManager.hideAll();
};
TM.show = function(id) {
var panel = TM.get(id);
if (panel) {
TM.hideAll();
panel.show();
}
};
TM.toggle = function(id) {
var panel = TM.get(id);
if (!panel) {
return;
}
if (TM.isShowing(panel)) {
TM.hide(panel);
} else {
TM.show(panel);
setTimeout(function() {
panel.getFrame().focus();
}, 0);
}
};
TM.Events.subscribe('onLoaded', function(panel) {
var panelFrame = panel.getFrame();
var panelDoc = Util.Dom.getFrameContentDocument(panelFrame);
YUD.batch(panelDoc.getElementsByTagName('a'), function(link) {
if (link.href.length == 0) {
return;
}
var targetID = link.hash.substring(1);
if (targetID.length == 0) {
return;
}
var target = panelDoc.getElementById(targetID);
if (target == null) {
return;
}
YUE.on(link, 'click', function(evt) {
YUE.stopEvent(evt);
target.scrollIntoView();
window.scrollTo(0, 0);
});
});
});
TDS.ToolManager = TM;
YUE.onDOMReady(function () {
TM.init();
var panel = TM.createPanel('panel-hack', 'hack', 'Header', 'Footer');
YUD.setStyle(panel.element, 'display', 'none');
});
})(window.TDS);

/* SOURCE FILE: tds_dialog.js (f10a4c22) 9/9/2014 2:09:05 PM */

TDS = window.TDS || {};
(function(TDS) {
var CSS_SHOWING_PROGRESS = 'showingLoading';
var progressDialog = new YAHOO.widget.Panel("yuiProgressDialog", {
width: '240px',
fixedcenter: true,
close: false,
draggable: false,
modal: true,
visible: false
});
progressDialog.showEvent.subscribe(function() {
YUD.addClass(document.body, CSS_SHOWING_PROGRESS);
});
progressDialog.hideEvent.subscribe(function() {
YUD.removeClass(document.body, CSS_SHOWING_PROGRESS);
});
function setProgressMessage(html) {
if (html) {
html = html + '<br/>';
} else {
html = '';
}
progressDialog.setBody(html);
}
function showProgress(message) {
progressDialog.setHeader(Messages.get('Global.Label.PleaseWait'));
progressDialog.render(document.body);
progressDialog.show();
progressDialog.cfg.setProperty('zindex', 1004);
setProgressMessage(message);
}
function hideProgress() {
progressDialog.hide();
}
var dialog = new YAHOO.widget.SimpleDialog('yuiSimpleDialog', {
width: '250px',
fixedcenter: true,
modal: true,
visible: false,
draggable: false,
close: false,
postmethod: 'none',
usearia: true,
role: 'dialog'
});
dialog.showEvent.subscribe(function() {
YUD.addClass(document.body, 'showingDialog');
});
dialog.hideEvent.subscribe(function() {
YUD.removeClass(document.body, 'showingDialog');
});
function showObj(obj) {
hideProgress();
var buttons;
if (YAHOO.lang.isArray(obj.buttons)) {
buttons = obj.buttons;
} else {
buttons = [{ text: 'Global.Label.OK', handler: function() {
this.hide();
}}];
}
buttons.forEach(function (button) {
if (button.text) {
button.text = Messages.getAlt(button.text, button.altText);
}
});
var header;
if (obj.header) {
header = Messages.get(obj.header);
} else {
header = '';
}
var html;
if (obj.text) {
if (obj.altText) {
html = Messages.getAlt(obj.text, obj.altText);
} else {
html = Messages.get(obj.text);
}
if (html.indexOf('#') != -1) {
html = Messages.parse(html);
}
} else if (obj.bodyHtml) {
html = obj.bodyHtml;
} else {
html = '';
}
dialog.cfg.queueProperty('buttons', buttons);
dialog.setHeader(header);
dialog.setBody(html);
if (obj.formHtml) {
dialog.form.innerHTML = obj.formHtml;
if (obj.formHandler) {
YUE.on(dialog.form, 'submit', obj.formHandler);
}
}
dialog.render(document.body);
dialog.show();
dialog.cfg.setProperty('zindex', 1005);
}
function showDialog(header, message, buttons) {
showObj({
text: message,
header: header,
buttons: buttons
});
}
function showPrompt(message, funcYes, funcNo) {
var header = 'Global.Label.Warning';
var handleYes = function() {
this.hide();
if (YAHOO.lang.isFunction(funcYes)) {
funcYes();
}
};
var handleNo = function() {
this.hide();
if (YAHOO.lang.isFunction(funcNo)) {
funcNo();
}
};
var buttons = [
{ text: 'Global.Label.No', handler: handleNo, isDefault: true },
{ text: 'Global.Label.Yes', handler: handleYes }
];
showDialog(header, message, buttons);
}
function _showAlert(message, funcOk) {
var handleOk = function() {
this.hide();
if (YAHOO.lang.isFunction(funcOk)) {
funcOk();
}
};
var buttons = [
{ text: 'Global.Label.OK', handler: handleOk }
];
showDialog('Global.Label.Warning', message, buttons);
}
function showAlert(message, funcOk) {
_showAlert(message, funcOk);
}
function showWarning(message, funcOk) {
_showAlert(message, funcOk);
}
function showInput(message, cb) {
var getDialogInput = function() {
return Util.Dom.getElementByClassName('tds-dialogInput', 'input', dialog.form);
};
var handleOk = function () {
dialog.hide();
if (YAHOO.lang.isFunction(cb)) {
var dialogInput = getDialogInput();
if (dialogInput) {
cb(dialogInput.value);
}
}
};
var handleCancel = function () {
dialog.hide();
};
var buttons = [
{ text: 'Global.Label.Cancel', altText: 'Cancel', handler: handleCancel, isDefault: true },
{ text: 'Global.Label.Ok', altText: 'Ok', handler: handleOk }
];
var bodyHtml = '<span class="tds-dialogMessage">' + message + '</span>';
var formHtml = '<input class="tds-dialogInput" type="text"></input>';
showObj({
header: '&nbsp;',
bodyHtml: bodyHtml,
formHtml: formHtml,
formHandler: handleOk,
buttons: buttons,
});
var dialogInput = getDialogInput();
if (dialogInput) {
setTimeout(function() {
dialogInput.focus();
}, 0);
}
}
function fixTabIndex(dialog) {
dialog.beforeShowEvent.subscribe(function() {
this.setFirstLastFocusable();
for (var i = 0; i < dialog.focusableElements.length; i++) {
var focusableElement = dialog.focusableElements[i];
focusableElement.setAttribute('tabindex', 0);
}
});
dialog.showEvent.subscribe(function() {
dialog.focusDefaultButton();
});
dialog.beforeShowEvent.subscribe(function() {
var usearia = dialog.cfg.getProperty('usearia');
if (usearia) {
var id = dialog.body.id || YUD.generateId(dialog.body);
dialog.cfg.setProperty('describedby', id);
}
});
}
fixTabIndex(dialog);
TDS.Dialog = {
showProgress: showProgress,
hideProgress: hideProgress,
showObj: showObj,
show: showDialog,
showPrompt: showPrompt,
showAlert: showAlert,
showWarning: showWarning,
showInput: showInput,
fixTabIndex: fixTabIndex
};
})(TDS);

/* SOURCE FILE: tds_keyboard.js (2a359396) 10/26/2014 1:27:06 PM */

var KeyEventResult =
{
Ignored: 0,
Stop: 1,
Matched: 2,
Allow: 3
};
function onglobalkeyevent(evt, type, key, keyCode, charCode) {
if (evt.ctrlKey && !Util.Browser.supportsModifierKeys()) {
return;
}
var shiftKey = evt.shiftKey;
var ctrlKey = evt.ctrlKey;
var metaKey = evt.metaKey;
var altKey = evt.altKey;
var target = YUE.getTarget(evt);
var inTextInput = Util.Event.inTextInput(evt);
var inLoadingDialog = YAHOO.util.Dom.hasClass(document.body, 'showingLoading');
var inModalDialog = YAHOO.util.Dom.hasClass(document.body, 'showingDialog');
var keyObj =
{
type: type,
key: key,
keyCode: keyCode,
charCode: charCode,
shiftKey: shiftKey,
ctrlKey: ctrlKey,
altKey: altKey,
metaKey: metaKey,
target: target
};
KeyManager.onKeyEvent.fire(keyObj);
if (evt.ctrlKey && evt.altKey && evt.shiftKey && key == 'F10') {
return;
}
var stopEvent = function() {
YAHOO.util.Event.stopEvent(evt);
};
var isKeySafeForLanguage = function() {
if (!inTextInput) {
return false;
}
if (typeof (TDS) != 'object') {
return false;
}
var currentLanguage = TDS.getLanguage();
if (currentLanguage == 'HAW' && evt.altKey) {
switch (keyCode) {
case 65:
case 69:
case 73:
case 79:
case 85:
case 222: return true;
}
}
return false;
};
var isKeyNavigational = function() {
if (!evt.altKey && !evt.ctrlKey && evt.keyCode == 9) {
return true;
}
if (!Util.Event.hasModifier(evt)) {
if (keyCode == 13) {
return true;
}
}
if (!Util.Event.hasModifier(evt) || evt.shiftKey) {
if (keyCode >= 37 && keyCode <= 40) {
return true;
}
}
if (isKeySafeForLanguage()) {
return true;
}
return false;
};
if (inLoadingDialog) {
stopEvent();
return;
}
if (inModalDialog && !inTextInput) {
if (!isKeyNavigational()) {
stopEvent();
}
return;
}
var keyResult;
if (typeof window.onkeyevent == 'function') {
keyResult = window.onkeyevent(evt, type, key, keyCode, charCode, target);
}
if (Util.Browser.isChromeOS() && type == 'keydown') {
if (evt.ctrlKey && ((evt.altKey && evt.keyCode == 90) || (evt.keyCode == 166 || evt.keyCode == 167))) {
keyResult = KeyEventResult.Stop;
}
}
if (!keyResult) {
if (isKeyNavigational()) {
keyResult = KeyEventResult.Allow;
} else {
keyResult = KeyEventResult.Ignored;
}
}
if (keyResult === KeyEventResult.Allow) {
return;
}
else if (keyResult === KeyEventResult.Stop) {
stopEvent();
}
else if (inTextInput) {
if (Util.Event.hasModifier(evt) || keyResult === KeyEventResult.Matched) {
stopEvent();
}
}
else if (keyResult !== KeyEventResult.Allow) {
stopEvent();
}
}
var KeyManager =
{
onKeyEvent: new YAHOO.util.CustomEvent('onGlobalKeyEvent', KeyManager, false, YAHOO.util.CustomEvent.FLAT),
isInit: false,
isWindows: false,
isMac: false,
isUnix: false,
attachListener: function(doc) {
YAHOO.util.Event.addListener(doc, "keyup", this._onKeyUpDown, this, true);
YAHOO.util.Event.addListener(doc, "keydown", this._onKeyUpDown, this, true);
YAHOO.util.Event.addListener(doc, "keypress", this._onKeyPress, this, true);
},
preinit: function () {
if (navigator.platform.indexOf("Windows") != -1 || navigator.platform.indexOf("Win32") != -1 || navigator.platform.indexOf("Win64") != -1) {
this.isWindows = true;
} else if (navigator.platform.indexOf("Macintosh") != -1 || navigator.platform.indexOf("MacPPC") != -1 || navigator.platform.indexOf("MacIntel") != -1) {
this.isMac = true;
} else if (navigator.platform.indexOf("X11") != -1 || navigator.platform.indexOf("Linux") != -1 || navigator.platform.indexOf("BSD") != -1) {
this.isUnix = true;
}
this._lastUpDownType = {};
if (!this._identifierToKeyCodeMap) {
this._identifierToKeyCodeMap = {};
for (var key in this._keyCodeToIdentifierMap) {
this._identifierToKeyCodeMap[this._keyCodeToIdentifierMap[key]] = parseInt(key, 10);
}
for (var key in this._specialCharCodeMap) {
this._identifierToKeyCodeMap[this._specialCharCodeMap[key]] = parseInt(key, 10);
}
}
if (YAHOO.env.ua.ie) {
this._charCode2KeyCode = {
13: 13,
27: 27
};
} else if (YAHOO.env.ua.gecko) {
this._keyCodeFix = {
12: this._identifierToKeyCode("NumLock")
};
} else if (YAHOO.env.ua.webkit) {
if (YAHOO.env.ua.webkit < 525.13) {
this._charCode2KeyCode = {
63289: this._identifierToKeyCode("NumLock"),
63276: this._identifierToKeyCode("PageUp"),
63277: this._identifierToKeyCode("PageDown"),
63275: this._identifierToKeyCode("End"),
63273: this._identifierToKeyCode("Home"),
63234: this._identifierToKeyCode("Left"),
63232: this._identifierToKeyCode("Up"),
63235: this._identifierToKeyCode("Right"),
63233: this._identifierToKeyCode("Down"),
63272: this._identifierToKeyCode("Delete"),
63302: this._identifierToKeyCode("Insert"),
63236: this._identifierToKeyCode("F1"),
63237: this._identifierToKeyCode("F2"),
63238: this._identifierToKeyCode("F3"),
63239: this._identifierToKeyCode("F4"),
63240: this._identifierToKeyCode("F5"),
63241: this._identifierToKeyCode("F6"),
63242: this._identifierToKeyCode("F7"),
63243: this._identifierToKeyCode("F8"),
63244: this._identifierToKeyCode("F9"),
63245: this._identifierToKeyCode("F10"),
63246: this._identifierToKeyCode("F11"),
63247: this._identifierToKeyCode("F12"),
63248: this._identifierToKeyCode("PrintScreen"),
3: this._identifierToKeyCode("Enter"),
12: this._identifierToKeyCode("NumLock"),
13: this._identifierToKeyCode("Enter")
};
} else {
this._charCode2KeyCode = {
13: 13,
27: 27
};
}
}
},
init: function (el) {
this.preinit();
if (typeof el != 'object') {
el = (YAHOO.env.ua.gecko) ? window : document;
}
this.attachListener(el);
this.isInit = true;
Util.log('keyboard: init');
},
isValidKeyIdentifier: function(keyIdentifier) {
if (this._identifierToKeyCodeMap[keyIdentifier]) {
return true;
}
if (keyIdentifier.length != 1) {
return false;
}
if (keyIdentifier >= "0" && keyIdentifier <= "9") {
return true;
}
if (keyIdentifier >= "A" && keyIdentifier <= "Z") {
return true;
}
switch (keyIdentifier) {
case "+":
case "-":
case "*":
case "/":
return true;
default:
return false;
}
},
__keyEvents: {
keyup: 1,
keydown: 1,
keypress: 1,
keyinput: 1
},
_onKeyUpDown: function (domEvent) {
if (!this.isInit) return;
if (YAHOO.env.ua.ie) {
domEvent = window.event || domEvent;
var keyCode = domEvent.keyCode;
var charCode = 0;
var type = domEvent.type;
if (!(this._lastUpDownType[keyCode] == "keydown" && type == "keydown")) {
this._idealKeyHandler(keyCode, charCode, type, domEvent);
}
if (type == "keydown") {
if (this._isNonPrintableKeyCode(keyCode) || keyCode == 8 || keyCode == 9) {
this._idealKeyHandler(keyCode, charCode, "keypress", domEvent);
}
}
this._lastUpDownType[keyCode] = type;
}
else if (YAHOO.env.ua.gecko) {
var keyCode = this._keyCodeFix[domEvent.keyCode] || domEvent.keyCode;
var charCode = domEvent.charCode;
var type = domEvent.type;
if (this.isWindows) {
var keyIdentifier = keyCode ? this._keyCodeToIdentifier(keyCode) : this._charCodeToIdentifier(charCode);
if (!(this._lastUpDownType[keyIdentifier] == "keypress" && type == "keydown")) {
this._idealKeyHandler(keyCode, charCode, type, domEvent);
}
this._lastUpDownType[keyIdentifier] = type;
}
else {
this._idealKeyHandler(keyCode, charCode, type, domEvent);
}
}
else if (YAHOO.env.ua.webkit) {
var keyCode = 0;
var charCode = 0;
var type = domEvent.type;
if (YAHOO.env.ua.webkit < 525.13) {
if (YAHOO.env.ua.webkit > 420) {
if (!this._lastCharCodeForType) {
this._lastCharCodeForType = {};
}
var isSafariSpecialKey = this._lastCharCodeForType[type] > 63000;
if (isSafariSpecialKey) {
this._lastCharCodeForType[type] = null;
return;
}
this._lastCharCodeForType[type] = domEvent.charCode;
}
if (type == "keyup" || type == "keydown") {
if ((domEvent.charCode == 3 || domEvent.charCode == 13) && domEvent.keyIdentifier != "Enter") {
keyCode = domEvent.keyCode;
} else {
keyCode = this._charCode2KeyCode[domEvent.charCode] || domEvent.keyCode;
}
} else {
if (this._charCode2KeyCode[domEvent.charCode]) {
keyCode = this._charCode2KeyCode[domEvent.charCode];
} else {
charCode = domEvent.charCode;
}
}
this._idealKeyHandler(keyCode, charCode, type, domEvent);
}
else {
keyCode = domEvent.keyCode;
if (!(this._lastUpDownType[keyCode] == "keydown" && type == "keydown")) {
this._idealKeyHandler(keyCode, charCode, type, domEvent);
}
if (type == "keydown") {
if (this._isNonPrintableKeyCode(keyCode) || keyCode == 8 || keyCode == 9) {
this._idealKeyHandler(keyCode, charCode, "keypress", domEvent);
}
if (Util.Browser.isChromeOS() && (keyCode == 90 || keyCode == 166 || keyCode == 167)) {
this._idealKeyHandler(keyCode, charCode, "keydown", domEvent);
}
}
this._lastUpDownType[keyCode] = type;
}
}
else if (YAHOO.env.ua.opera) {
this._idealKeyHandler(domEvent.keyCode, 0, domEvent.type, domEvent);
}
},
_onKeyPress: function (domEvent) {
if (!this.isInit) return;
if (YAHOO.env.ua.ie) {
domEvent = window.event || domEvent;
if (this._charCode2KeyCode[domEvent.keyCode]) {
this._idealKeyHandler(this._charCode2KeyCode[domEvent.keyCode], 0, domEvent.type, domEvent);
} else {
this._idealKeyHandler(0, domEvent.keyCode, domEvent.type, domEvent);
}
}
else if (YAHOO.env.ua.gecko) {
var keyCode = this._keyCodeFix[domEvent.keyCode] || domEvent.keyCode;
var charCode = domEvent.charCode;
var type = domEvent.type;
if (this.isWindows) {
var keyIdentifier = keyCode ? this._keyCodeToIdentifier(keyCode) : this._charCodeToIdentifier(charCode);
if (!(this._lastUpDownType[keyIdentifier] == "keypress" && type == "keydown")) {
this._idealKeyHandler(keyCode, charCode, type, domEvent);
}
this._lastUpDownType[keyIdentifier] = type;
}
else {
this._idealKeyHandler(keyCode, charCode, type, domEvent);
}
}
else if (YAHOO.env.ua.webkit) {
if (YAHOO.env.ua.webkit < 525.13) {
var keyCode = 0;
var charCode = 0;
var type = domEvent.type;
if (!YAHOO.env.ua.webkit > 420) {
if (!this._lastCharCodeForType) {
this._lastCharCodeForType = {};
}
var isSafariSpecialKey = this._lastCharCodeForType[type] > 63000;
if (isSafariSpecialKey) {
this._lastCharCodeForType[type] = null;
return;
}
this._lastCharCodeForType[type] = domEvent.charCode;
}
if (type == "keyup" || type == "keydown") {
keyCode = this._charCode2KeyCode[domEvent.charCode] || domEvent.keyCode;
} else {
if (this._charCode2KeyCode[domEvent.charCode]) {
keyCode = this._charCode2KeyCode[domEvent.charCode];
} else {
charCode = domEvent.charCode;
}
}
this._idealKeyHandler(keyCode, charCode, type, domEvent);
}
else {
if (this._charCode2KeyCode[domEvent.keyCode]) {
this._idealKeyHandler(this._charCode2KeyCode[domEvent.keyCode], 0, domEvent.type, domEvent);
} else {
this._idealKeyHandler(0, domEvent.keyCode, domEvent.type, domEvent);
}
}
}
else if (YAHOO.env.ua.opera) {
if (this._keyCodeToIdentifierMap[domEvent.keyCode]) {
this._idealKeyHandler(domEvent.keyCode, 0, domEvent.type, domEvent);
} else {
this._idealKeyHandler(0, domEvent.keyCode, domEvent.type, domEvent);
}
}
},
_idealKeyHandler: function(keyCode, charCode, eventType, domEvent) {
if (!keyCode && !charCode) {
return;
}
var keyIdentifier;
if (keyCode) {
keyIdentifier = this._keyCodeToIdentifier(keyCode);
onglobalkeyevent(domEvent, eventType, keyIdentifier, keyCode, charCode);
}
else {
keyIdentifier = this._charCodeToIdentifier(charCode);
onglobalkeyevent(domEvent, "keypress", keyIdentifier, keyCode, charCode);
}
var cancelled = (domEvent.returnValue == false);
if (eventType == "keydown" && cancelled && (YAHOO.env.ua.webkit >= 525.13 || YAHOO.env.ua.ie)) {
if (!(this._isNonPrintableKeyCode(keyCode) || keyCode == 8 || keyCode == 9)) {
if (!domEvent.shiftKey && charCode == 0 && this._IEkeyCodeToIdentifierMap[keyCode]) {
keyIdentifier = this._IEkeyCodeToIdentifierMap[keyCode];
} else if (domEvent.shiftKey && keyIdentifier == 0 && this._IEShiftkeyCodeToIdentifierMap[keyCode]) {
keyIdentifier = this._IEShiftkeyCodeToIdentifierMap[keyCode];
}
onglobalkeyevent(domEvent, "keypress", keyIdentifier, keyCode, charCode);
}
}
},
_specialCharCodeMap: {
8: "Backspace",
9: "Tab",
13: "Enter",
27: "Escape",
32: "Space"
},
_keyCodeToIdentifierMap: {
16: "Shift",
17: "Control",
18: "Alt",
20: "CapsLock",
224: "Meta",
37: "Left",
38: "Up",
39: "Right",
40: "Down",
33: "PageUp",
34: "PageDown",
35: "End",
36: "Home",
45: "Insert",
46: "Delete",
112: "F1",
113: "F2",
114: "F3",
115: "F4",
116: "F5",
117: "F6",
118: "F7",
119: "F8",
120: "F9",
121: "F10",
122: "F11",
123: "F12",
144: "NumLock",
44: "PrintScreen",
145: "Scroll",
19: "Pause",
91: "Win",
93: "Apps"
},
_IEkeyCodeToIdentifierMap: {
186: ";",
187: "=",
188: ",",
190: ".",
191: "/",
219: "[",
220: "\\",
221: "]",
222: "'"
},
_IEShiftkeyCodeToIdentifierMap: {
48: ")",
49: "!",
50: "@",
51: "#",
52: "$",
53: "%",
54: "^",
55: "&",
56: "*",
57: "(",
186: ":",
187: "+",
188: "<",
190: ">",
191: "?",
219: "{",
220: "|",
221: "}",
222: "\""
},
_numpadToCharCode: {
96: "0".charCodeAt(0),
97: "1".charCodeAt(0),
98: "2".charCodeAt(0),
99: "3".charCodeAt(0),
100: "4".charCodeAt(0),
101: "5".charCodeAt(0),
102: "6".charCodeAt(0),
103: "7".charCodeAt(0),
104: "8".charCodeAt(0),
105: "9".charCodeAt(0),
106: "*".charCodeAt(0),
107: "+".charCodeAt(0),
109: "-".charCodeAt(0),
110: ",".charCodeAt(0),
111: "/".charCodeAt(0)
},
_charCodeA: "A".charCodeAt(0),
_charCodeZ: "Z".charCodeAt(0),
_charCode0: "0".charCodeAt(0),
_charCode9: "9".charCodeAt(0),
_isNonPrintableKeyCode: function(keyCode) {
return this._keyCodeToIdentifierMap[keyCode] ? true : false;
},
_isIdentifiableKeyCode: function(keyCode) {
if (keyCode >= this._charCodeA && keyCode <= this._charCodeZ) {
return true;
}
if (keyCode >= this._charCode0 && keyCode <= this._charCode9) {
return true;
}
if (this._specialCharCodeMap[keyCode]) {
return true;
}
if (this._numpadToCharCode[keyCode]) {
return true;
}
if (this._isNonPrintableKeyCode(keyCode)) {
return true;
}
return false;
},
_keyCodeToIdentifier: function(keyCode) {
if (this._isIdentifiableKeyCode(keyCode)) {
var numPadKeyCode = this._numpadToCharCode[keyCode];
if (numPadKeyCode) {
return String.fromCharCode(numPadKeyCode);
}
return (this._keyCodeToIdentifierMap[keyCode] || this._specialCharCodeMap[keyCode] || String.fromCharCode(keyCode));
} else {
return "Unidentified";
}
},
_charCodeToIdentifier: function(charCode) {
return this._specialCharCodeMap[charCode] || String.fromCharCode(charCode).toUpperCase();
},
_identifierToKeyCode: function(keyIdentifier) {
return this._identifierToKeyCodeMap[keyIdentifier] || keyIdentifier.charCodeAt(0);
}
};

/* SOURCE FILE: tds_button.js (e990cbe4) 9/9/2014 2:09:05 PM */

if (typeof TDS != 'object') TDS = {};
TDS.Button = {};
TDS.Button.init = function()
{
var spans = YUD.getElementsByClassName('tds-button', 'span');
YUD.batch(spans, this.processButtonSpan);
}
TDS.Button.processButtonSpan = function(buttonSpan)
{
var button = buttonSpan.getElementsByTagName('button')[0];
YUE.on(button, 'focus', function(el)
{
YUD.addClass(buttonSpan, 'tds-button-focus');
});
YUE.on(button, 'blur', function(el)
{
YUD.removeClass(buttonSpan, 'tds-button-focus');
});
YUE.on(button, 'mouseover', function(el)
{
YUD.addClass(buttonSpan, 'tds-button-hover');
});
YUE.on(button, 'mouseout', function(el)
{
YUD.removeClass(buttonSpan, 'tds-button-hover');
});
}

/* SOURCE FILE: tds_aria.js (3cca8223) 9/9/2014 2:09:05 PM */

if (typeof TDS != 'object') TDS = {};
TDS.ARIA = {};
TDS.ARIA.createLog = function()
{
var logDiv = YUD.get('log');
if (logDiv) return logDiv;
logDiv = HTML.DIV(
{
'id': 'log',
'className': 'element-invisible',
'role': 'log'
});
logDiv.setAttribute('aria-live', 'polite');
logDiv.setAttribute('aria-relevant', 'additions text');
logDiv.setAttribute('aria-atomic', 'true');
document.body.appendChild(logDiv);
return logDiv;
};
TDS.ARIA.writeLog = function(msg)
{
var logDiv = YUD.get('log');
if (logDiv == null)
{
logDiv = this.createLog();
}
var currentMsgDiv = YUD.getFirstChild(logDiv);
var msgDiv = HTML.P(null, msg);
if (currentMsgDiv)
{
logDiv.replaceChild(msgDiv, currentMsgDiv);
}
else
{
logDiv.appendChild(msgDiv);
}
Util.log('ARIA LOG: ' + msg);
};

/* SOURCE FILE: tds_xhr.js (be68b2ef) 9/9/2014 2:09:05 PM */

if (typeof TDS != 'object') TDS = {};
TDS.XhrManager = function(opt_timeoutInterval, opt_maxRetries, opt_scope)
{
TDS.XhrManager.superclass.constructor.call(this, opt_timeoutInterval, opt_maxRetries, opt_scope);
this.Events.subscribe('onRequest', function(request)
{
var config = request.getArgs();
if (config && config.showProgress) {
this.Events.fire('onShowProgress');
}
});
this.Events.subscribe('onComplete', function(request)
{
var config = request.getArgs();
if (config && config.showProgress) {
this.Events.fire('onHideProgress');
}
});
this.Events.subscribe('onComplete', this.checkIfValid);
};
YAHOO.extend(TDS.XhrManager, Util.XhrManager);
TDS.XhrManager.JsonReply =
{
OK: 0,
Error: 1,
Denied: 2,
ReturnStatus: 3
};
TDS.XhrManager.prototype.getUrl = function(action, data)
{
return null;
};
TDS.XhrManager.prototype.createAction = function(action, data, callback, customConfig, parameters)
{
var url = this.getUrl(action, data);
parameters = parameters || {};
parameters.timestamp = Util.Date.now();
var querystring = Util.QueryString.stringify(parameters);
url += ((url.indexOf('?') == -1) ? '?' : '&') + querystring;
var method = 'POST';
var content = null;
if (YAHOO.lang.isString(data))
{
content = data;
}
else if (YAHOO.lang.isObject(data))
{
content = Util.QueryString.stringify(data);
}
var receiveActionCallback = function(request)
{
var json = request.getResponseJson();
if (YAHOO.lang.isObject(json) && YAHOO.lang.isFunction(callback))
{
callback(json.data, json);
}
};
var request = this.createRequest(action, url, method, content, receiveActionCallback);
var config =
{
showProgress: true,
showDialog: true,
showError: false,
allowRetry: true,
forceLogout: true
};
if (YAHOO.lang.isObject(customConfig))
{
config = YAHOO.lang.merge(config, customConfig);
}
request.setArgs(config);
return request;
};
TDS.XhrManager.prototype.sendAction = function(action, data, callback, customConfig, parameters)
{
var request = this.createAction(action, data, callback, customConfig, parameters);
try { this.sendRequest(request); }
catch (ex) { TDS.Diagnostics.report(ex); }
};
TDS.XhrManager.prototype.sendPromise = function (action, postData, queryData, customConfig) {
var url = this.getUrl(action, postData);
queryData = queryData || {};
queryData.timestamp = Util.Date.now();
var qs = Util.QueryString.stringify(queryData);
url += ((url.indexOf('?') == -1) ? '?' : '&') + qs;
var content = null;
if (YAHOO.lang.isString(postData)) {
content = postData;
} else if (YAHOO.lang.isObject(postData)) {
content = Util.QueryString.stringify(postData);
}
var defered = Util.Promise.defer();
var callback = function (request) {
var json = request.getResponseJson();
if (request.isSuccess() && YAHOO.lang.isObject(json)) {
defered.resolve(json.data);
} else {
defered.reject(request);
}
};
var request = this.createRequest(action, url, 'POST', content, callback);
var config = {
showProgress: true,
showDialog: true,
showError: false,
allowRetry: true,
forceLogout: true
};
if (YAHOO.lang.isObject(customConfig)) {
config = YAHOO.lang.merge(config, customConfig);
}
request.setArgs(config);
this.sendRequest(request);
return defered.promise;
};
TDS.XhrManager.prototype.checkIfValid = function(request)
{
if (request.isSuccess()) return true;
var config = request.getArgs();
if (config && !config.showDialog) return true;
var errorMessage = 'There was a problem with your request.';
var json = request.getResponseJson();
if (json && json.replyText)
{
errorMessage = json.replyText;
}
var retriable = ((config && config.allowRetry) && request.allowRetry());
var logout = (config && config.forceLogout);
this.Events.fire('onError', request, errorMessage, retriable, logout);
return false;
};

/* SOURCE FILE: tds_help.js (a63bd7bb) 9/9/2014 2:26:31 PM */

TDS.Help = (function (TDS) {
function HelpGuide(contentFrame, btnStartTTS) {
this.onReset = new YAHOO.util.CustomEvent('onReset', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT);
this.selection = null;
var frame = contentFrame;
var enabled = false;
var that = this;
if (frame && Util.Browser.isMobile()) {
var frameDoc = Util.Dom.getFrameContentDocument(frame);
if (frameDoc) {
YUE.addListener(frameDoc, 'selectionchange', function(evt) {
if (evt && evt.target != btnStartTTS) {
that.selection = rangy.getSelection(frameDoc);
}
});
}
}
this.init = function() {
shouldEnableTTS();
return enabled;
};
this.isEnabled = function() {
return enabled;
};
this.hasTTSInstrAccommodationEnabled = function() {
var accProps = TDS.getAccommodationProperties();
var language = accProps.getLanguage();
return accProps.hasTTSInstruction() && isTTSPossibleForLanguage(language);
};
this.getStartSpeakingHandler = function() {
return startSpeakingHandler;
};
this.getStopSpeakingHandler = function() {
return stopSpeakingHandler;
};
this.reset = function(fireResetEvent) {
enabled = checkEnabled();
if (fireResetEvent) {
this.onReset.fire();
}
};
var isTTSPossibleForLanguage = function(language) {
if ("ENU" == language || "ESN" == language) {
return true;
}
return false;
};
var checkEnabled = function() {
var accProps = TDS.getAccommodationProperties();
var language = accProps.getLanguage();
var ctrl = TTS.getInstance();
var languageSupported = ctrl.isLanguageSupported(language);
var ttsSupported = (ctrl.getStatus() != TTS.Status.NotSupported);
if (ttsSupported && languageSupported) {
return true;
} else {
return false;
}
};
var shouldEnableTTS = function() {
if (that.hasTTSInstrAccommodationEnabled()) {
if (TTS.Manager.getStatus() != TTS.Status.Uninitialized) {
that.reset(true);
} else {
TTS.Manager.Events.onInitFailure.subscribe(function() {
disable();
});
TTS.Manager.Events.onStatusChange.subscribe(function() {
if (TTS.Manager.getStatus() == TTS.Status.NotSupported) {
disable();
}
});
TTS.Manager.Events.onInitSuccess.subscribe(function() {
that.reset(true);
});
YAHOO.util.Event.onDOMReady(function() {
TTS.getInstance();
});
}
}
return false;
};
var disable = function() {
enabled = false;
that.onReset.fire();
};
var startSpeakingHandler = function(evt, altFrame, touchSelected) {
if (enabled) {
var prepSelection = function(frame, language) {
var doc = Util.Dom.getFrameContentWindow(frame).document;
if (touchSelected) {
selected = touchSelected;
} else {
var selected = rangy.getSelection(doc);
}
var element = doc.getElementById('helpContent');
ctrl.languageManager.addLanguageTags(element, language);
var entity = {};
entity.getElement = function() { return element; };
ctrl.setCurrentDomEntity(entity);
return selected;
};
var language = TDS.getAccommodationProperties().getLanguage();
var ctrl = TTS.getInstance();
ctrl.stop();
var domWalker = null;
if (TTS.version && TTS.version > 1) {
var selection;
if (typeof altFrame != 'undefined' && altFrame != null) {
selection = prepSelection(altFrame, language);
} else {
selection = prepSelection(frame, language);
}
if (selection.getAllRanges().length) {
ctrl.playSelection(selection, language);
}
} else {
if (typeof altFrame != 'undefined' && altFrame != null) {
ctrl.play(Util.Dom.getFrameContentWindow(altFrame), TTS.Parser.Types.Selection, language);
} else {
ctrl.play(Util.Dom.getFrameContentWindow(frame), TTS.Parser.Types.Selection, language);
}
}
}
};
var stopSpeakingHandler = function(evt, altFrame) {
if (enabled) {
TTS.getInstance().stop();
}
};
}
HelpGuide.getKey = function() {
var key = 'Global.Path.Help';
var accProps = TDS.getAccProps();
if (accProps && accProps.isStreamlinedMode()) {
if (Messages.has(key + '.Streamlined')) {
key = key + '.Streamlined';
}
}
return key;
};
HelpGuide.getUrl = function () {
var key = HelpGuide.getKey();
var url = TDS.baseUrl + 'Pages/';
url += Messages.get(key);
return url;
};
HelpGuide.onLoad = function(frame, btnStartSpeaking, btnStopSpeaking, messageDiv, noTTSMessageDiv) {
btnStartSpeaking = YUD.get(btnStartSpeaking);
btnStopSpeaking = YUD.get(btnStopSpeaking);
messageDiv = YUD.get(messageDiv);
noTTSMessageDiv = YUD.get(noTTSMessageDiv);
var tdsHelpFunctionality = new HelpGuide(frame, btnStartSpeaking);
var disableTTS = function() {
var hasTTSInstrAccommmodation = tdsHelpFunctionality.hasTTSInstrAccommodationEnabled();
YUD.addClass(btnStartSpeaking, 'disabled');
YUD.addClass(btnStopSpeaking, 'disabled');
YUD.setStyle(messageDiv, 'display', 'none');
if (hasTTSInstrAccommmodation) {
YUD.setStyle(noTTSMessageDiv, 'display', 'block');
} else {
YUD.setStyle(noTTSMessageDiv, 'display', 'none');
YUD.setStyle(btnStartSpeaking, 'display', 'none');
YUD.setStyle(btnStopSpeaking, 'display', 'none');
}
var startSpeakingEvt = Util.Browser.isMobile() ? 'touchstart' : 'click';
YUE.removeListener(btnStartSpeaking, startSpeakingEvt);
YUE.removeListener(btnStopSpeaking, 'click');
};
var initDisplay = function() {
var enableTTSOnInstr = tdsHelpFunctionality.isEnabled();
if (enableTTSOnInstr) {
YUD.removeClass(btnStartSpeaking, 'disabled');
YUD.removeClass(btnStopSpeaking, 'disabled');
var startSpeakingEvt = Util.Browser.isMobile() ? 'touchstart' : 'click';
YUE.addListener(btnStartSpeaking, startSpeakingEvt, function(evt) {
YUE.stopEvent(evt);
var handler = tdsHelpFunctionality.getStartSpeakingHandler();
handler(null, null, tdsHelpFunctionality.selection);
});
YUE.addListener(btnStopSpeaking, 'click', function() {
var handler = tdsHelpFunctionality.getStopSpeakingHandler();
handler();
});
} else {
disableTTS();
}
};
tdsHelpFunctionality.onReset.subscribe(function() {
initDisplay();
});
tdsHelpFunctionality.init();
initDisplay();
};
TDS.ToolManager.Events.subscribe('onCreating', function(panel) {
if (panel.id.indexOf('tool-Global.Path.Help') == -1) {
return;
}
var tdsHelpFunctionality = new HelpGuide(panel.getFrame());
var hasTTSInstrAccommmodation = tdsHelpFunctionality.hasTTSInstrAccommodationEnabled();
if (hasTTSInstrAccommmodation) {
var startSpeaking = function() {
var thatPanel = panel;
var handler = tdsHelpFunctionality.getStartSpeakingHandler();
handler(null, thatPanel.getFrame());
};
var stopSpeaking = function() {
var thatPanel = panel;
var handler = tdsHelpFunctionality.getStopSpeakingHandler();
handler(null, thatPanel.getFrame());
};
var buttons = [
{ text: Messages.get('TDSContentJS.Label.StartSpeaking'), handler: startSpeaking, disabled: true },
{ text: Messages.get('TDSContentJS.Label.StopSpeaking'), handler: stopSpeaking, isDefault: true, disabled: true }
];
panel.cfg.queueProperty("buttons", buttons);
panel.renderEvent.subscribe(function() {
var helpMessage = Messages.get('TestInstructions.Label.Help');
helpMessage = helpMessage + Messages.get('TestInstructions.Label.NoTTSHelp');
var helpMessageElement = document.createElement('span');
helpMessageElement.innerHTML = helpMessage;
panel.appendToFooter(helpMessageElement);
});
var oninited = function(thatPanel) {
var enableTTSOnInstr = tdsHelpFunctionality.isEnabled();
if (thatPanel.getButtons() == null) {
return;
}
for (var counter1 = 0; counter1 < thatPanel.getButtons().length; ++counter1) {
var button = null;
var label = thatPanel.getButtons()[counter1].getAttributeConfig('label').value;
if (label == Messages.get('TDSContentJS.Label.StartSpeaking')) {
button = thatPanel.getButtons()[counter1];
button.addClass('ttsHelpSpeakButtonClass');
} else if (label == Messages.get('TDSContentJS.Label.StopSpeaking')) {
button = thatPanel.getButtons()[counter1];
button.addClass('ttsHelpStopSpeakButtonClass');
}
if (button != null) {
button.setAttributeConfig('disabled', enableTTSOnInstr);
if (!enableTTSOnInstr) {
button.addClass('disabled');
} else {
button.removeClass('disabled');
}
}
}
if (enableTTSOnInstr) {
YAHOO.util.Dom.addClass(panel.footer, 'hasTTS');
YAHOO.util.Dom.removeClass(panel.footer, 'noTTS');
} else {
YAHOO.util.Dom.addClass(panel.footer, 'noTTS');
YAHOO.util.Dom.removeClass(panel.footer, 'hasTTS');
}
};
panel.showEvent.subscribe(function() {
tdsHelpFunctionality.reset(false);
oninited(panel);
});
panel.hideEvent.subscribe(function() {
TTS.Manager.stop();
});
tdsHelpFunctionality.onReset.subscribe(function() { oninited(panel); });
tdsHelpFunctionality.init();
YAHOO.util.Event.onDOMReady(function() {
TTS.getInstance();
});
}
});
return HelpGuide;
})(window.TDS);

/* SOURCE FILE: tds_cache.js (18a68aa4) 9/9/2014 2:09:05 PM */

TDS.Cache = {};
TDS.Cache.id = null;
TDS.Cache.validate = false;
TDS.Cache._statusLookup = ['uncached', 'idle', 'checking', 'downloading', 'updateready', 'obsolete'];
TDS.Cache._eventLookup = ['cached', 'checking', 'downloading', 'error', 'noupdate', 'obsolete', 'progress', 'updateready'];
TDS.Cache._currentEvent = null;
TDS.Cache._count = 0;
TDS.Cache._shuttingDown = false;
TDS.Cache._shutDown = false;
TDS.Cache.Events = new Util.EventManager();
TDS.Cache.getCount = function() { return TDS.Cache._count; };
TDS.Cache.hasManifest = function()
{
return (document.getElementsByTagName('html')[0].getAttribute('manifest') != null);
};
TDS.Cache.isSupported = function()
{
return (typeof(window.applicationCache) == 'object');
};
TDS.Cache.isAvailable = function()
{
return (this.hasManifest() && this.isSupported());
};
TDS.Cache.getStatus = function()
{
if (this.isAvailable())
{
try
{
return TDS.Cache._statusLookup[window.applicationCache.status];
}
catch (ex)
{
}
}
return null;
};
TDS.Cache.getEvent = function() { return TDS.Cache._currentEvent; };
TDS.Cache.isBusy = function()
{
var status = this.getStatus();
var event = this.getEvent();
if (['checking', 'downloading'].indexOf(status) > -1) return true;
if (status == 'uncached' && event != null)
{
if (['checking', 'downloading', 'progress'].indexOf(event) > -1) return true;
}
return false;
};
TDS.Cache.enable = function()
{
Mozilla.execPrivileged(function()
{
Mozilla.setPreference('browser.cache.offline.enable', true);
});
};
TDS.Cache.disable = function()
{
Mozilla.execPrivileged(function()
{
Mozilla.setPreference('browser.cache.offline.enable', false);
});
};
TDS.Cache.init = function()
{
if (!this.isAvailable()) return false;
var cacheEvents = TDS.Cache._eventLookup;
for (var i = 0; i < cacheEvents.length; i++)
{
try
{
window.applicationCache.addEventListener(cacheEvents[i], TDS.Cache._handler, false);
}
catch (ex)
{
return false;
}
}
return true;
};
TDS.Cache._handler = function(evt)
{
TDS.Cache._currentEvent = evt.type;
if (evt.type == 'progress') TDS.Cache._count++;
TDS.Cache.Events.fire('onChange', evt);
if (TDS.Cache._shuttingDown) TDS.Cache._tryToShutdown();
};
TDS.Cache.stop = function()
{
if (TDS.Cache._shuttingDown) return;
TDS.Cache._shuttingDown = true;
TDS.Cache.Events.fire('onStop');
var success = TDS.Cache._tryToShutdown();
if (!success)
{
TDS.Cache._shuttingDown = true;
TDS.Cache.disable();
}
};
TDS.Cache._tryToShutdown = function()
{
if (TDS.Cache._shutDown) return false;
if (TDS.Cache.isAvailable() && TDS.Cache.isBusy()) return false;
TDS.Cache._shutDown = true;
setTimeout(function()
{
TDS.Cache.enable();
TDS.Cache.Events.fire('onShutdown');
}, 5000);
return true;
};
TDS.Cache.init();
TDS.Cache.checkObsolete = function()
{
var storageKey = 'tds.cache.id';
var storedCacheId = Mozilla.getPreference(storageKey);
if (storedCacheId != TDS.Cache.id)
{
if (YAHOO.lang.isString(TDS.Cache.id))
{
Util.log('checkObsolete: set=' + TDS.Cache.id);
Mozilla.setPreference(storageKey, TDS.Cache.id);
}
if (YAHOO.lang.isString(storedCacheId))
{
Util.log('checkObsolete: clearCache');
Util.SecureBrowser.clearCache();
}
}
};

/* SOURCE FILE: tds_timeout.js (33d7ccb8) 10/26/2014 1:27:06 PM */

TDS.IdleTimer = (function(TDS) {
return function(waitMins, respondSecs, funcNoResponse) {
this.message = ErrorCodes.get('IdleTimeout');
this.isStarted = false;
this.timerIdle = null;
this.waitMins = waitMins;
this.respondSecs = respondSecs;
this.Events = new Util.EventManager();
this.getIdleMilliseconds = function() {
return this.waitMins * 60 * 1000;
};
this.getRespondMilliseconds = function() {
return this.respondSecs * 1000;
};
this.start = function() {
Util.log('timeout: start');
this.isStarted = true;
this.reset();
};
this.stop = function() {
this.isStarted = false;
this.cancel();
};
this.reset = function() {
if (!this.isStarted) {
return;
}
this.cancel();
this.timerIdle = YAHOO.lang.later(this.getIdleMilliseconds(), this, this.openDialog);
};
this.cancel = function() {
if (this.timerIdle != null) {
this.timerIdle.cancel();
}
};
this.openDialog = function() {
Util.log('timeout: openDialog');
this.stop();
this.timerIdle = YAHOO.lang.later(this.getRespondMilliseconds(), this, this.dialogNoResponse);
var self = this;
TDS.Dialog.showAlert(this.message, function () {
self.cancel();
self.start();
}.bind(this));
};
this.dialogNoResponse = function() {
Util.log('timeout: dialogNoResponse');
if (typeof (funcNoResponse) == 'function') {
funcNoResponse();
}
this.Events.fire('onTimeout');
};
this.addListeners = function(win) {
YAHOO.util.Event.addListener(win, "keyup", this.reset, this, true);
YAHOO.util.Event.addListener(win, 'mousedown', this.reset, this, true);
};
this.addListeners(window);
if (this.message.indexOf('{0}') != -1) {
this.message = this.message.replace('{0}', this.waitMins);
}
if (this.message.indexOf('{1}') != -1) {
this.message = this.message.replace('{1}', this.respondSecs);
}
};
})(window.TDS);

/* SOURCE FILE: tds_shell.js (9642a434) 9/9/2014 2:09:05 PM */

TDS.Shell = (function (TDS) {
var shell = {
name: null,
allowFocus: false
};
function addClick(id, callback) {
var target = YUD.get(id);
if (target == null) {
return false;
}
if (!shell.allowFocus && window.ContentManager.enableARIA === false) {
target.setAttribute('tabindex', '-1');
if (target.tagName != 'SELECT') {
YUE.on(target, 'mousedown', function(evt) {
YUE.stopEvent(evt);
});
YUE.on(target, 'mouseup', function(evt) {
YUE.stopEvent(evt);
});
}
}
YUE.on(target, 'click', function (evt) {
if (target.nodeName == 'A' || target.nodeName == 'SELECT') {
YUE.stopEvent(evt);
}
if (YUD.getAttribute(target, 'disabled') != 'disabled') {
callback.call(this, evt);
}
}, this, true);
return true;
}
function enableButton(id) {
var btnEl = YUD.get(id);
if (btnEl) {
$(btnEl).parent().removeClass('inactive');
$(btnEl).parent().addClass('active');
btnEl.setAttribute('aria-disabled', 'false');
}
}
function disableButton(id) {
var btnEl = YUD.get(id);
if (btnEl) {
$(btnEl).parent().removeClass('active');
$(btnEl).parent().addClass('inactive');
btnEl.setAttribute('aria-disabled', 'true');
}
}
function showButton(id) {
var btnEl = YUD.get(id);
if (btnEl) {
$(btnEl).parent().show();
btnEl.setAttribute('aria-hidden', 'false');
}
}
function hideButton(id) {
var btnEl = YUD.get(id);
if (btnEl) {
$(btnEl).parent().hide();
btnEl.setAttribute('aria-hidden', 'true');
}
}
function processButton(linkEl, options) {
if (options.inactive) {
disableButton(linkEl);
} else {
enableButton(linkEl);
}
if (options.hidden) {
hideButton(linkEl);
} else {
showButton(linkEl);
}
if (YAHOO.lang.isFunction(options.fn)) {
addClick(linkEl, options.fn);
}
}
function createButton(parentId, options) {
var ulEl = YUD.get(parentId);
if (ulEl == null) {
return null;
}
var liEl = document.createElement('li');
var linkEl = document.createElement('a');
if (options.id) {
linkEl.id = options.id;
}
var classname = options.classname || options.className;
if (classname) {
$(linkEl).addClass(classname);
}
if (options.allowFocus) {
linkEl.setAttribute('tabindex', '0');
} else {
linkEl.setAttribute('tabindex', '-1');
}
YUD.setAttribute(linkEl, 'href', '#');
liEl.appendChild(linkEl);
var iconEl = document.createElement('span');
iconEl.className = 'icon';
linkEl.appendChild(iconEl);
var labelEl;
if (shell.name == 'universal') {
labelEl = document.createElement('span');
labelEl.className = 'label';
linkEl.appendChild(labelEl);
} else {
labelEl = iconEl;
}
var text = options.text || options.label;
if (options.i18n) {
labelEl.innerHTML = Messages.getAlt(options.i18n, text);
} else if (text) {
labelEl.innerHTML = text;
}
ulEl.appendChild(liEl);
return linkEl;
};
function addButton(parentId, options) {
options = options || {};
if (typeof options.allowFocus != 'boolean') {
options.allowFocus = shell.allowFocus;
}
var linkEl = null;
if (options.id) {
linkEl = document.getElementById(options.id);
}
if (!linkEl) {
linkEl = createButton(parentId, options);
}
processButton(linkEl, options);
return linkEl;
};
var addTool = addButton.bind(shell, 'studentTools');
var addControl = addButton.bind(shell, 'studentControls');
function processConfig(config) {
var toolbar = config.toolbars[shell.name] || config.toolbars['modern'];
toolbar.controls.forEach(function(name) {
var button = config.controls[name];
addControl(button);
});
toolbar.tools.forEach(function (name) {
var button = config.tools[name];
addTool(button);
});
}
shell.enableButton = enableButton;
shell.disableButton = disableButton;
shell.showButton = showButton;
shell.hideButton = hideButton;
shell.addTool = addTool;
shell.addControl = addControl;
shell.addClick = addClick;
shell.processConfig = processConfig;
shell.getNavigationEl = function () {
return document.getElementById('ddlNavigation');
}
shell.getJumpEl = function () {
return document.getElementById('jumpGo');
}
shell.getHelpEl = function () {
return document.getElementById('btnHelp');
}
shell.getSettingsEl = function () {
return document.getElementById('btnSettings');
}
shell.getSoundCuesEl = function () {
return document.getElementById('soundCues');
}
shell.getContentsEl = function () {
return document.getElementById('contents');
}
shell.setSessionName = function(text) {
$('.sessionID').html(text);
}
shell.setStudentName = function(text) {
$('#ot-studentInfo, .studentInfo').html(text);
}
return shell;
})(window.TDS);

/* SOURCE FILE: tds_shell_notification.js (4c3b7771) 9/9/2014 2:09:05 PM */

TDS.Shell.Notification = (function() {
var SELECTOR_CONTAINER = '.alertBar';
var SELECTOR_DISMISS = '.alertBar .alertDismiss';
var SELECTOR_CONTENT = '.alertBar .alertContent';
var SELECTOR_ENTRIES = '.alertBar .alertContent li';
function activate() {
$(SELECTOR_CONTAINER).addClass('alertActive');
}
function disable() {
$(SELECTOR_CONTAINER).removeClass('alertActive');
}
function show() {
$(SELECTOR_CONTAINER).removeClass('alertClosed');
}
function hide() {
$(SELECTOR_CONTAINER).addClass('alertClosed');
}
function toggle() {
$(SELECTOR_CONTAINER).toggleClass('alertClosed');
}
function remove(numToShow) {
$(SELECTOR_ENTRIES).slice(numToShow).remove();
}
var isInit = false;
function init() {
if (isInit) return;
$(SELECTOR_DISMISS).click(function (evt) {
YUE.stopEvent(evt);
toggle();
});
isInit = true;
}
function add(text) {
init();
activate();
show();
$(SELECTOR_CONTENT).prepend('<li>' + text + '</li>');
remove(3);
}
return {
add: add
};
})();

/* SOURCE FILE: soundjs-0.5.2.min.js (eadd7762) 9/9/2014 2:08:53 PM */

/*!
* @license SoundJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2013 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/

/**!
 * SoundJS FlashPlugin also includes swfobject (http://code.google.com/p/swfobject/)
 */

this.createjs=this.createjs||{},function(){var a=createjs.SoundJS=createjs.SoundJS||{};a.version="0.5.2",a.buildDate="Thu, 12 Dec 2013 23:33:37 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){},b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b._listeners=null,b._captureListeners=null,b.initialize=function(){},b.addEventListener=function(a,b,c){var d;d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var e=d[a];return e&&this.removeEventListener(a,b,c),e=d[a],e?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a,b){if("string"==typeof a){var c=this._listeners;if(!c||!c[a])return!1;a=new createjs.Event(a)}if(a.target=b||this,a.bubbles&&this.parent){for(var d=this,e=[d];d.parent;)e.push(d=d.parent);var f,g=e.length;for(f=g-1;f>=0&&!a.propagationStopped;f--)e[f]._dispatchEvent(a,1+(0==f));for(f=1;g>f&&!a.propagationStopped;f++)e[f]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;a.currentTarget=this,a.eventPhase=b,a.removed=!1,e=e.slice();for(var f=0;c>f&&!a.immediatePropagationStopped;f++){var g=e[f];g.handleEvent?g.handleEvent(a):g(a),a.removed&&(this.off(a.type,g,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype;b.type=null,b.target=null,b.currentTarget=null,b.eventPhase=0,b.bubbles=!1,b.cancelable=!1,b.timeStamp=0,b.defaultPrevented=!1,b.propagationStopped=!1,b.immediatePropagationStopped=!1,b.removed=!1,b.initialize=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c,this.timeStamp=(new Date).getTime()},b.preventDefault=function(){this.defaultPrevented=!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";createjs.indexOf=function(a,b){for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1}}(),this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}}}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Sound cannot be instantiated"}function b(a,b){this.init(a,b)}function c(){this.isDefault=!0,this.addEventListener=this.removeEventListener=this.removeAllEventListeners=this.dispatchEvent=this.hasEventListener=this._listeners=this._interrupt=this._playFailed=this.pause=this.resume=this.play=this._beginPlaying=this._cleanUp=this.stop=this.setMasterVolume=this.setVolume=this.mute=this.setMute=this.getMute=this.setPan=this.getPosition=this.setPosition=this.playFailed=function(){return!1},this.getVolume=this.getPan=this.getDuration=function(){return 0},this.playState=a.PLAY_FAILED,this.toString=function(){return"[Sound Default Sound Instance]"}}function d(){}var e=a;e.DELIMITER="|",e.INTERRUPT_ANY="any",e.INTERRUPT_EARLY="early",e.INTERRUPT_LATE="late",e.INTERRUPT_NONE="none",e.PLAY_INITED="playInited",e.PLAY_SUCCEEDED="playSucceeded",e.PLAY_INTERRUPTED="playInterrupted",e.PLAY_FINISHED="playFinished",e.PLAY_FAILED="playFailed",e.SUPPORTED_EXTENSIONS=["mp3","ogg","mpeg","wav","m4a","mp4","aiff","wma","mid"],e.EXTENSION_MAP={m4a:"mp4"},e.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,e.defaultInterruptBehavior=e.INTERRUPT_NONE,e.alternateExtensions=[],e._lastID=0,e.activePlugin=null,e._pluginsRegistered=!1,e._masterVolume=1,e._masterMute=!1,e._instances=[],e._idHash={},e._preloadHash={},e._defaultSoundInstance=null,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e._sendFileLoadEvent=function(a){if(e._preloadHash[a])for(var b=0,c=e._preloadHash[a].length;c>b;b++){var d=e._preloadHash[a][b];if(e._preloadHash[a][b]=!0,e.hasEventListener("fileload")){var f=new createjs.Event("fileload");f.src=d.src,f.id=d.id,f.data=d.data,e.dispatchEvent(f)}}},e.getPreloadHandlers=function(){return{callback:createjs.proxy(e.initLoad,e),types:["sound"],extensions:e.SUPPORTED_EXTENSIONS}},e.registerPlugin=function(a){try{console.log("createjs.Sound.registerPlugin has been deprecated. Please use registerPlugins.")}catch(b){}return e._registerPlugin(a)},e._registerPlugin=function(a){return e._pluginsRegistered=!0,null==a?!1:a.isSupported()?(e.activePlugin=new a,!0):!1},e.registerPlugins=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];if(e._registerPlugin(d))return!0}return!1},e.initializeDefaultPlugins=function(){return null!=e.activePlugin?!0:e._pluginsRegistered?!1:e.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])?!0:!1},e.isReady=function(){return null!=e.activePlugin},e.getCapabilities=function(){return null==e.activePlugin?null:e.activePlugin._capabilities},e.getCapability=function(a){return null==e.activePlugin?null:e.activePlugin._capabilities[a]},e.initLoad=function(a,b,c,d,f){a=a.replace(f,"");var g=e.registerSound(a,c,d,!1,f);return null==g?!1:g},e.registerSound=function(a,c,d,f,g){if(!e.initializeDefaultPlugins())return!1;if(a instanceof Object&&(g=c,c=a.id,d=a.data,a=a.src),e.alternateExtensions.length)var h=e._parsePath2(a,"sound",c,d);else var h=e._parsePath(a,"sound",c,d);if(null==h)return!1;null!=g&&(a=g+a,h.src=g+h.src),null!=c&&(e._idHash[c]=h.src);var i=null;null!=d&&(isNaN(d.channels)?isNaN(d)||(i=parseInt(d)):i=parseInt(d.channels));var j=e.activePlugin.register(h.src,i);if(null!=j&&(null!=j.numChannels&&(i=j.numChannels),b.create(h.src,i),null!=d&&isNaN(d)?d.channels=h.data.channels=i||b.maxPerChannel():d=h.data=i||b.maxPerChannel(),null!=j.tag?h.tag=j.tag:j.src&&(h.src=j.src),null!=j.completeHandler&&(h.completeHandler=j.completeHandler),j.type&&(h.type=j.type)),0!=f)if(e._preloadHash[h.src]||(e._preloadHash[h.src]=[]),e._preloadHash[h.src].push({src:a,id:c,data:d}),1==e._preloadHash[h.src].length)e.activePlugin.preload(h.src,j);else if(1==e._preloadHash[h.src][0])return!0;return h},e.registerManifest=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=createjs.Sound.registerSound(a[d].src,a[d].id,a[d].data,a[d].preload,b);return c},e.removeSound=function(a,c){if(null==e.activePlugin)return!1;if(a instanceof Object&&(a=a.src),a=e._getSrcById(a),e.alternateExtensions.length)var d=e._parsePath2(a);else var d=e._parsePath(a);if(null==d)return!1;null!=c&&(d.src=c+d.src),a=d.src;for(var f in e._idHash)e._idHash[f]==a&&delete e._idHash[f];return b.removeSrc(a),delete e._preloadHash[a],e.activePlugin.removeSound(a),!0},e.removeManifest=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=createjs.Sound.removeSound(a[d].src,b);return c},e.removeAllSounds=function(){e._idHash={},e._preloadHash={},b.removeAll(),e.activePlugin.removeAllSounds()},e.loadComplete=function(a){if(e.alternateExtensions.length)var b=e._parsePath2(a,"sound");else var b=e._parsePath(a,"sound");return a=b?e._getSrcById(b.src):e._getSrcById(a),1==e._preloadHash[a][0]},e._parsePath=function(a,b,c,d){"string"!=typeof a&&(a=a.toString());var f=a.split(e.DELIMITER);if(f.length>1)try{console.log('createjs.Sound.DELIMITER "|" loading approach has been deprecated. Please use the new alternateExtensions property.')}catch(g){}for(var h={type:b||"sound",id:c,data:d},i=e.getCapabilities(),j=0,k=f.length;k>j;j++){var l=f[j],m=l.match(e.FILE_PATTERN);if(null==m)return!1;var n=m[4],o=m[5];if(i[o]&&createjs.indexOf(e.SUPPORTED_EXTENSIONS,o)>-1)return h.name=n,h.src=l,h.extension=o,h}return null},e._parsePath2=function(a,b,c,d){"string"!=typeof a&&(a=a.toString());var f=a.match(e.FILE_PATTERN);if(null==f)return!1;for(var g=f[4],h=f[5],i=e.getCapabilities(),j=0;!i[h];)if(h=e.alternateExtensions[j++],j>e.alternateExtensions.length)return null;a=a.replace("."+f[5],"."+h);var k={type:b||"sound",id:c,data:d};return k.name=g,k.src=a,k.extension=h,k},e.play=function(a,b,c,d,f,g,h){var i=e.createInstance(a),j=e._playInstance(i,b,c,d,f,g,h);return j||i.playFailed(),i},e.createInstance=function(c){if(!e.initializeDefaultPlugins())return e._defaultSoundInstance;if(c=e._getSrcById(c),e.alternateExtensions.length)var d=e._parsePath2(c,"sound");else var d=e._parsePath(c,"sound");var f=null;return null!=d&&null!=d.src?(b.create(d.src),f=e.activePlugin.create(d.src)):f=a._defaultSoundInstance,f.uniqueId=e._lastID++,f},e.setVolume=function(a){if(null==Number(a))return!1;if(a=Math.max(0,Math.min(1,a)),e._masterVolume=a,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(a))for(var b=this._instances,c=0,d=b.length;d>c;c++)b[c].setMasterVolume(a)},e.getVolume=function(){return e._masterVolume},e.setMute=function(a){if(null==a||void 0==a)return!1;if(this._masterMute=a,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(a))for(var b=this._instances,c=0,d=b.length;d>c;c++)b[c].setMasterMute(a);return!0},e.getMute=function(){return this._masterMute},e.stop=function(){for(var a=this._instances,b=a.length;b--;)a[b].stop()},e._playInstance=function(a,b,c,d,f,g,h){if(b instanceof Object&&(c=b.delay,d=b.offset,f=b.loop,g=b.volume,h=b.pan,b=b.interrupt),b=b||e.defaultInterruptBehavior,null==c&&(c=0),null==d&&(d=a.getPosition()),null==f&&(f=0),null==g&&(g=a.volume),null==h&&(h=a.pan),0==c){var i=e._beginPlaying(a,b,d,f,g,h);if(!i)return!1}else{var j=setTimeout(function(){e._beginPlaying(a,b,d,f,g,h)},c);a._delayTimeoutId=j}return this._instances.push(a),!0},e._beginPlaying=function(a,c,d,e,f,g){if(!b.add(a,c))return!1;var h=a._beginPlaying(d,e,f,g);if(!h){var i=createjs.indexOf(this._instances,a);return i>-1&&this._instances.splice(i,1),!1}return!0},e._getSrcById=function(a){return null==e._idHash||null==e._idHash[a]?a:e._idHash[a]},e._playFinished=function(a){b.remove(a);var c=createjs.indexOf(this._instances,a);c>-1&&this._instances.splice(c,1)},createjs.Sound=a,b.channels={},b.create=function(a,c){var d=b.get(a);return null==d?(b.channels[a]=new b(a,c),!0):!1},b.removeSrc=function(a){var c=b.get(a);return null==c?!1:(c.removeAll(),delete b.channels[a],!0)},b.removeAll=function(){for(var a in b.channels)b.channels[a].removeAll();b.channels={}},b.add=function(a,c){var d=b.get(a.src);return null==d?!1:d.add(a,c)},b.remove=function(a){var c=b.get(a.src);return null==c?!1:(c.remove(a),!0)},b.maxPerChannel=function(){return f.maxDefault},b.get=function(a){return b.channels[a]};var f=b.prototype;f.src=null,f.max=null,f.maxDefault=100,f.length=0,f.init=function(a,b){this.src=a,this.max=b||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},f.get=function(a){return this._instances[a]},f.add=function(a,b){return this.getSlot(b,a)?(this._instances.push(a),this.length++,!0):!1},f.remove=function(a){var b=createjs.indexOf(this._instances,a);return-1==b?!1:(this._instances.splice(b,1),this.length--,!0)},f.removeAll=function(){for(var a=this.length-1;a>=0;a--)this._instances[a].stop()},f.getSlot=function(b){for(var c,d,e=0,f=this.max;f>e;e++){if(c=this.get(e),null==c)return!0;(b!=a.INTERRUPT_NONE||c.playState==a.PLAY_FINISHED)&&(0!=e?c.playState==a.PLAY_FINISHED||c.playState==a.PLAY_INTERRUPTED||c.playState==a.PLAY_FAILED?d=c:(b==a.INTERRUPT_EARLY&&c.getPosition()<d.getPosition()||b==a.INTERRUPT_LATE&&c.getPosition()>d.getPosition())&&(d=c):d=c)}return null!=d?(d._interrupt(),this.remove(d),!0):!1},f.toString=function(){return"[Sound SoundChannel]"},a._defaultSoundInstance=new c,d.init=function(){var a=window.navigator.userAgent;d.isFirefox=a.indexOf("Firefox")>-1,d.isOpera=null!=window.opera,d.isChrome=a.indexOf("Chrome")>-1,d.isIOS=a.indexOf("iPod")>-1||a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1,d.isAndroid=a.indexOf("Android")>-1,d.isBlackberry=a.indexOf("Blackberry")>-1},d.init(),createjs.Sound.BrowserDetect=d}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._init()}var b=a;b._capabilities=null,b.isSupported=function(){var a=createjs.Sound.BrowserDetect.isIOS||createjs.Sound.BrowserDetect.isAndroid||createjs.Sound.BrowserDetect.isBlackberry;return"file:"!=location.protocol||a||this._isFileXHRSupported()?(b._generateCapabilities(),null==b.context?!1:!0):!1},b._isFileXHRSupported=function(){var a=!0,b=new XMLHttpRequest;try{b.open("GET","fail.fail",!1)}catch(c){return a=!1}b.onerror=function(){a=!1},b.onload=function(){a=404==this.status||200==this.status||0==this.status&&""!=this.response};try{b.send()}catch(c){a=!1}return a},b._generateCapabilities=function(){if(null==b._capabilities){var a=document.createElement("audio");if(null==a.canPlayType)return null;if(window.webkitAudioContext)b.context=new webkitAudioContext;else{if(!window.AudioContext)return null;b.context=new AudioContext}b._compatibilitySetUp(),b.playEmptySound(),b._capabilities={panning:!0,volume:!0,tracks:-1};for(var c=createjs.Sound.SUPPORTED_EXTENSIONS,d=createjs.Sound.EXTENSION_MAP,e=0,f=c.length;f>e;e++){var g=c[e],h=d[g]||g;b._capabilities[g]="no"!=a.canPlayType("audio/"+g)&&""!=a.canPlayType("audio/"+g)||"no"!=a.canPlayType("audio/"+h)&&""!=a.canPlayType("audio/"+h)}b.context.destination.numberOfChannels<2&&(b._capabilities.panning=!1),b.dynamicsCompressorNode=b.context.createDynamicsCompressor(),b.dynamicsCompressorNode.connect(b.context.destination),b.gainNode=b.context.createGain(),b.gainNode.connect(b.dynamicsCompressorNode)}},b._compatibilitySetUp=function(){if(!b.context.createGain){b.context.createGain=b.context.createGainNode;var a=b.context.createBufferSource();a.__proto__.start=a.__proto__.noteGrainOn,a.__proto__.stop=a.__proto__.noteOff,this._panningModel=0}},b.playEmptySound=function(){var a=this.context.createBuffer(1,1,22050),b=this.context.createBufferSource();b.buffer=a,b.connect(this.context.destination),b.start(0,0,0)};var c=a.prototype;c._capabilities=null,c._volume=1,c.context=null,c._panningModel="equalpower",c.dynamicsCompressorNode=null,c.gainNode=null,c._arrayBuffers=null,c._init=function(){this._capabilities=b._capabilities,this._arrayBuffers={},this.context=b.context,this.gainNode=b.gainNode,this.dynamicsCompressorNode=b.dynamicsCompressorNode},c.register=function(a){this._arrayBuffers[a]=!0;var b=new createjs.WebAudioPlugin.Loader(a,this);return{tag:b}},c.isPreloadStarted=function(a){return null!=this._arrayBuffers[a]},c.isPreloadComplete=function(a){return!(null==this._arrayBuffers[a]||1==this._arrayBuffers[a])},c.removeSound=function(a){delete this._arrayBuffers[a]},c.removeAllSounds=function(){this._arrayBuffers={}},c.addPreloadResults=function(a,b){this._arrayBuffers[a]=b},c._handlePreloadComplete=function(){createjs.Sound._sendFileLoadEvent(this.src)},c.preload=function(a){this._arrayBuffers[a]=!0;var b=new createjs.WebAudioPlugin.Loader(a,this);b.onload=this._handlePreloadComplete,b.load()},c.create=function(a){return this.isPreloadStarted(a)||this.preload(a),new createjs.WebAudioPlugin.SoundInstance(a,this)},c.setVolume=function(a){return this._volume=a,this._updateVolume(),!0},c._updateVolume=function(){var a=createjs.Sound._masterMute?0:this._volume;a!=this.gainNode.gain.value&&(this.gainNode.gain.value=a)},c.getVolume=function(){return this._volume},c.setMute=function(){return this._updateVolume(),!0},c.toString=function(){return"[WebAudioPlugin]"},createjs.WebAudioPlugin=a}(),function(){"use strict";function a(a,b){this._init(a,b)}var b=a.prototype=new createjs.EventDispatcher;b.src=null,b.uniqueId=-1,b.playState=null,b._owner=null,b._offset=0,b._delay=0,b._volume=1;try{Object.defineProperty(b,"volume",{get:function(){return this._volume},set:function(a){return null==Number(a)?!1:(a=Math.max(0,Math.min(1,a)),this._volume=a,this._updateVolume(),void 0)}})}catch(c){}b._pan=0;try{Object.defineProperty(b,"pan",{get:function(){return this._pan},set:function(a){return this._owner._capabilities.panning&&null!=Number(a)?(a=Math.max(-1,Math.min(1,a)),this._pan=a,this.panNode.setPosition(a,0,-.5),void 0):!1}})}catch(c){}b._duration=0,b._remainingLoops=0,b._delayTimeoutId=null,b._soundCompleteTimeout=null,b.gainNode=null,b.panNode=null,b.sourceNode=null,b._sourceNodeNext=null,b._muted=!1,b._paused=!1,b._startTime=0,b._endedHandler=null,b._sendEvent=function(a){var b=new createjs.Event(a);this.dispatchEvent(b)},b._init=function(a,b){this._owner=b,this.src=a,this.gainNode=this._owner.context.createGain(),this.panNode=this._owner.context.createPanner(),this.panNode.panningModel=this._owner._panningModel,this.panNode.connect(this.gainNode),this._owner.isPreloadComplete(this.src)&&(this._duration=1e3*this._owner._arrayBuffers[this.src].duration),this._endedHandler=createjs.proxy(this._handleSoundComplete,this)},b._cleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._delayTimeoutId),clearTimeout(this._soundCompleteTimeout),this._startTime=0,null!=window.createjs&&createjs.Sound._playFinished(this)},b._cleanUpAudioNode=function(a){return a&&(a.stop(0),a.disconnect(this.panNode),a=null),a},b._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._paused=!1,this._sendEvent("interrupted")},b._handleSoundReady=function(){if(null!=window.createjs){if(1e3*this._offset>this.getDuration())return this.playFailed(),void 0;this._offset<0&&(this._offset=0),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._paused=!1,this.gainNode.connect(this._owner.gainNode);var a=this._owner._arrayBuffers[this.src].duration;this.sourceNode=this._createAndPlayAudioNode(this._owner.context.currentTime-a,this._offset),this._duration=1e3*a,this._startTime=this.sourceNode.startTime-this._offset,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(a-this._offset)),0!=this._remainingLoops&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._startTime,0))}},b._createAndPlayAudioNode=function(a,b){var c=this._owner.context.createBufferSource();return c.buffer=this._owner._arrayBuffers[this.src],c.connect(this.panNode),this._owner.context.currentTime,c.startTime=a+c.buffer.duration,c.start(c.startTime,b,c.buffer.duration-b),c},b.play=function(a,b,c,d,e,f){this._cleanUp(),createjs.Sound._playInstance(this,a,b,c,d,e,f)},b._beginPlaying=function(a,b,c,d){return null!=window.createjs&&this.src?(this._offset=a/1e3,this._remainingLoops=b,this.volume=c,this.pan=d,this._owner.isPreloadComplete(this.src)?(this._handleSoundReady(null),this._sendEvent("succeeded"),1):(this.playFailed(),void 0)):void 0},b.pause=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED?!1:(this._paused=!0,this._offset=this._owner.context.currentTime-this._startTime,this._cleanUpAudioNode(this.sourceNode),this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(),clearTimeout(this._delayTimeoutId),clearTimeout(this._soundCompleteTimeout),!0)},b.resume=function(){return this._paused?(this._handleSoundReady(null),!0):!1},b.stop=function(){return this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._offset=0,!0},b.setVolume=function(a){return this.volume=a,!0},b._updateVolume=function(){var a=this._muted?0:this._volume;return a!=this.gainNode.gain.value?(this.gainNode.gain.value=a,!0):!1},b.getVolume=function(){return this.volume},b.setMute=function(a){return null==a||void 0==a?!1:(this._muted=a,this._updateVolume(),!0)},b.getMute=function(){return this._muted},b.setPan=function(a){return this.pan=a,this.pan!=a?!1:void 0},b.getPan=function(){return this.pan},b.getPosition=function(){if(this._paused||null==this.sourceNode)var a=this._offset;else var a=this._owner.context.currentTime-this._startTime;return 1e3*a},b.setPosition=function(a){return this._offset=a/1e3,this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._cleanUpAudioNode(this.sourceNode),this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout)),this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||this._handleSoundReady(null),!0},b.getDuration=function(){return this._duration},b._handleSoundComplete=function(){return this._offset=0,0!=this._remainingLoops?(this._remainingLoops--,this._sourceNodeNext?(this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._startTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._startTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)):this._handleSoundReady(null),this._sendEvent("loop"),void 0):(null!=window.createjs&&(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._sendEvent("complete")),void 0)},b.playFailed=function(){null!=window.createjs&&(this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed"))},b.toString=function(){return"[WebAudioPlugin SoundInstance]"},createjs.WebAudioPlugin.SoundInstance=a}(),function(){"use strict";function a(a,b){this._init(a,b)}var b=a.prototype;b.request=null,b.owner=null,b.progress=-1,b.src=null,b.originalSrc=null,b.result=null,b.onload=null,b.onprogress=null,b.onError=null,b._init=function(a,b){this.src=a,this.originalSrc=a,this.owner=b},b.load=function(a){null!=a&&(this.src=a),this.request=new XMLHttpRequest,this.request.open("GET",this.src,!0),this.request.responseType="arraybuffer",this.request.onload=createjs.proxy(this.handleLoad,this),this.request.onError=createjs.proxy(this.handleError,this),this.request.onprogress=createjs.proxy(this.handleProgress,this),this.request.send()},b.handleProgress=function(a,b){this.progress=a/b,null!=this.onprogress&&this.onprogress({loaded:a,total:b,progress:this.progress})},b.handleLoad=function(){this.owner.context.decodeAudioData(this.request.response,createjs.proxy(this.handleAudioDecoded,this),createjs.proxy(this.handleError,this))},b.handleAudioDecoded=function(a){this.progress=1,this.result=a,this.src=this.originalSrc,this.owner.addPreloadResults(this.src,this.result),this.onload&&this.onload()},b.handleError=function(a){this.owner.removeSound(this.src),this.onerror&&this.onerror(a)},b.toString=function(){return"[WebAudioPlugin Loader]"},createjs.WebAudioPlugin.Loader=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._init()}var b=a;b.MAX_INSTANCES=30,b._AUDIO_READY="canplaythrough",b._AUDIO_ENDED="ended",b._AUDIO_SEEKED="seeked",b._AUDIO_STALLED="stalled",b._capabilities=null,b.enableIOS=!1,b.isSupported=function(){if(createjs.Sound.BrowserDetect.isIOS&&!b.enableIOS)return!1;b._generateCapabilities();var a=b.tag;return null==a||null==b._capabilities?!1:!0},b._generateCapabilities=function(){if(null==b._capabilities){var a=b.tag=document.createElement("audio");if(null==a.canPlayType)return null;b._capabilities={panning:!0,volume:!0,tracks:-1};for(var c=createjs.Sound.SUPPORTED_EXTENSIONS,d=createjs.Sound.EXTENSION_MAP,e=0,f=c.length;f>e;e++){var g=c[e],h=d[g]||g;b._capabilities[g]="no"!=a.canPlayType("audio/"+g)&&""!=a.canPlayType("audio/"+g)||"no"!=a.canPlayType("audio/"+h)&&""!=a.canPlayType("audio/"+h)}}};var c=a.prototype;c._capabilities=null,c._audioSources=null,c.defaultNumChannels=2,c.loadedHandler=null,c._init=function(){this._capabilities=b._capabilities,this._audioSources={}},c.register=function(a,b){this._audioSources[a]=!0;for(var c=createjs.HTMLAudioPlugin.TagPool.get(a),d=null,e=b||this.defaultNumChannels,f=0;e>f;f++)d=this._createTag(a),c.add(d);if(d.id=a,this.loadedHandler=createjs.proxy(this._handleTagLoad,this),d.addEventListener&&d.addEventListener("canplaythrough",this.loadedHandler),null==d.onreadystatechange)d.onreadystatechange=this.loadedHandler;else{var g=d.onreadystatechange;d.onreadystatechange=function(){g(),this.loadedHandler()}}return{tag:d,numChannels:e}},c._handleTagLoad=function(a){a.target.removeEventListener&&a.target.removeEventListener("canplaythrough",this.loadedHandler),a.target.onreadystatechange=null,a.target.src!=a.target.id&&createjs.HTMLAudioPlugin.TagPool.checkSrc(a.target.id)},c._createTag=function(a){var b=document.createElement("audio");return b.autoplay=!1,b.preload="none",b.src=a,b},c.removeSound=function(a){delete this._audioSources[a],createjs.HTMLAudioPlugin.TagPool.remove(a)},c.removeAllSounds=function(){this._audioSources={},createjs.HTMLAudioPlugin.TagPool.removeAll()},c.create=function(a){if(!this.isPreloadStarted(a)){var b=createjs.HTMLAudioPlugin.TagPool.get(a),c=this._createTag(a);c.id=a,b.add(c),this.preload(a,{tag:c})}return new createjs.HTMLAudioPlugin.SoundInstance(a,this)},c.isPreloadStarted=function(a){return null!=this._audioSources[a]},c.preload=function(a,b){this._audioSources[a]=!0,new createjs.HTMLAudioPlugin.Loader(a,b.tag)},c.toString=function(){return"[HTMLAudioPlugin]"},createjs.HTMLAudioPlugin=a}(),function(){"use strict";function a(a,b){this._init(a,b)}var b=a.prototype=new createjs.EventDispatcher;b.src=null,b.uniqueId=-1,b.playState=null,b._owner=null,b.loaded=!1,b._offset=0,b._delay=0,b._volume=1;try{Object.defineProperty(b,"volume",{get:function(){return this._volume},set:function(a){null!=Number(a)&&(a=Math.max(0,Math.min(1,a)),this._volume=a,this._updateVolume())}})}catch(c){}b.pan=0,b._duration=0,b._remainingLoops=0,b._delayTimeoutId=null,b.tag=null,b._muted=!1,b._paused=!1,b._endedHandler=null,b._readyHandler=null,b._stalledHandler=null,b.loopHandler=null,b._init=function(a,b){this.src=a,this._owner=b,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleSoundReady,this),this._stalledHandler=createjs.proxy(this._handleSoundStalled,this),this.loopHandler=createjs.proxy(this.handleSoundLoop,this)},b._sendEvent=function(a){var b=new createjs.Event(a);this.dispatchEvent(b)},b._cleanUp=function(){var a=this.tag;if(null!=a){a.pause(),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1);try{a.currentTime=0}catch(b){}createjs.HTMLAudioPlugin.TagPool.setInstance(this.src,a),this.tag=null}clearTimeout(this._delayTimeoutId),null!=window.createjs&&createjs.Sound._playFinished(this)},b._interrupt=function(){null!=this.tag&&(this.playState=createjs.Sound.PLAY_INTERRUPTED,this._cleanUp(),this._paused=!1,this._sendEvent("interrupted"))},b.play=function(a,b,c,d,e,f){this._cleanUp(),createjs.Sound._playInstance(this,a,b,c,d,e,f)},b._beginPlaying=function(a,b,c,d){if(null==window.createjs)return-1;var e=this.tag=createjs.HTMLAudioPlugin.TagPool.getInstance(this.src);return null==e?(this.playFailed(),-1):(e.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._offset=a,this.volume=c,this.pan=d,this._updateVolume(),this._remainingLoops=b,4!==e.readyState?(e.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),e.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),e.preload="auto",e.load()):this._handleSoundReady(null),this._sendEvent("succeeded"),1)},b._handleSoundStalled=function(){this._cleanUp(),this._sendEvent("failed")},b._handleSoundReady=function(){if(null!=window.createjs){if(this._duration=1e3*this.tag.duration,this.playState=createjs.Sound.PLAY_SUCCEEDED,this._paused=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._offset>=this.getDuration())return this.playFailed(),void 0;this._offset>0&&(this.tag.currentTime=.001*this._offset),-1==this._remainingLoops&&(this.tag.loop=!0),0!=this._remainingLoops&&(this.tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1),this.tag.loop=!0),this.tag.play()}},b.pause=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||null==this.tag?!1:(this._paused=!0,this.tag.pause(),clearTimeout(this._delayTimeoutId),!0)},b.resume=function(){return this._paused&&null!=this.tag?(this._paused=!1,this.tag.play(),!0):!1},b.stop=function(){return this._offset=0,this.pause(),this.playState=createjs.Sound.PLAY_FINISHED,this._cleanUp(),!0},b.setMasterVolume=function(){return this._updateVolume(),!0},b.setVolume=function(a){return this.volume=a,!0},b._updateVolume=function(){if(null!=this.tag){var a=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;return a!=this.tag.volume&&(this.tag.volume=a),!0}return!1},b.getVolume=function(){return this.volume},b.setMasterMute=function(){return this._updateVolume(),!0},b.setMute=function(a){return null==a||void 0==a?!1:(this._muted=a,this._updateVolume(),!0)},b.getMute=function(){return this._muted},b.setPan=function(){return!1},b.getPan=function(){return 0},b.getPosition=function(){return null==this.tag?this._offset:1e3*this.tag.currentTime},b.setPosition=function(a){if(null==this.tag)this._offset=a;else{this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1);try{this.tag.currentTime=.001*a}catch(b){return!1}this.tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1)}return!0},b.getDuration=function(){return this._duration},b._handleSoundComplete=function(){this._offset=0,null!=window.createjs&&(this.playState=createjs.Sound.PLAY_FINISHED,this._cleanUp(),this._sendEvent("complete"))},b.handleSoundLoop=function(){this._offset=0,this._remainingLoops--,0==this._remainingLoops&&(this.tag.loop=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1)),this._sendEvent("loop")},b.playFailed=function(){null!=window.createjs&&(this.playState=createjs.Sound.PLAY_FAILED,this._cleanUp(),this._sendEvent("failed"))},b.toString=function(){return"[HTMLAudioPlugin SoundInstance]"},createjs.HTMLAudioPlugin.SoundInstance=a}(),function(){"use strict";function a(a,b){this._init(a,b)}var b=a.prototype;b.src=null,b.tag=null,b.preloadTimer=null,b.loadedHandler=null,b._init=function(a,b){if(this.src=a,this.tag=b,this.preloadTimer=setInterval(createjs.proxy(this.preloadTick,this),200),this.loadedHandler=createjs.proxy(this.sendLoadedEvent,this),this.tag.addEventListener&&this.tag.addEventListener("canplaythrough",this.loadedHandler),null==this.tag.onreadystatechange)this.tag.onreadystatechange=createjs.proxy(this.sendLoadedEvent,this);else{var c=this.tag.onreadystatechange;this.tag.onreadystatechange=function(){c(),this.tag.onreadystatechange=createjs.proxy(this.sendLoadedEvent,this)}
}this.tag.preload="auto",this.tag.load()},b.preloadTick=function(){var a=this.tag.buffered,b=this.tag.duration;a.length>0&&a.end(0)>=b-1&&this.handleTagLoaded()},b.handleTagLoaded=function(){clearInterval(this.preloadTimer)},b.sendLoadedEvent=function(){this.tag.removeEventListener&&this.tag.removeEventListener("canplaythrough",this.loadedHandler),this.tag.onreadystatechange=null,createjs.Sound._sendFileLoadEvent(this.src)},b.toString=function(){return"[HTMLAudioPlugin Loader]"},createjs.HTMLAudioPlugin.Loader=a}(),function(){"use strict";function a(a){this._init(a)}var b=a;b.tags={},b.get=function(c){var d=b.tags[c];return null==d&&(d=b.tags[c]=new a(c)),d},b.remove=function(a){var c=b.tags[a];return null==c?!1:(c.removeAll(),delete b.tags[a],!0)},b.removeAll=function(){for(var a in b.tags)b.tags[a].removeAll();b.tags={}},b.getInstance=function(a){var c=b.tags[a];return null==c?null:c.get()},b.setInstance=function(a,c){var d=b.tags[a];return null==d?null:d.set(c)},b.checkSrc=function(a){var c=b.tags[a];return null==c?null:(c.checkSrcChange(),void 0)};var c=a.prototype;c.src=null,c.length=0,c.available=0,c.tags=null,c._init=function(a){this.src=a,this.tags=[]},c.add=function(a){this.tags.push(a),this.length++,this.available++},c.removeAll=function(){for(;this.length--;)delete this.tags[this.length];this.src=null,this.tags.length=0},c.get=function(){if(0==this.tags.length)return null;this.available=this.tags.length;var a=this.tags.pop();return null==a.parentNode&&document.body.appendChild(a),a},c.set=function(a){var b=createjs.indexOf(this.tags,a);-1==b&&this.tags.push(a),this.available=this.tags.length},c.checkSrcChange=function(){for(var a=this.tags.length-1,b=this.tags[a].src;a--;)this.tags[a].src=b},c.toString=function(){return"[HTMLAudioPlugin TagPool]"},createjs.HTMLAudioPlugin.TagPool=a}();

/* SOURCE FILE: preloadjs-0.4.1.min.js (3131976d) 9/9/2014 2:08:53 PM */

/*!
* @license PreloadJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2013 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
this.createjs=this.createjs||{},function(){"use strict";var a=createjs.PreloadJS=createjs.PreloadJS||{};a.version="0.4.1",a.buildDate="Thu, 12 Dec 2013 23:33:38 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype;b.type=null,b.target=null,b.currentTarget=null,b.eventPhase=0,b.bubbles=!1,b.cancelable=!1,b.timeStamp=0,b.defaultPrevented=!1,b.propagationStopped=!1,b.immediatePropagationStopped=!1,b.removed=!1,b.initialize=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c,this.timeStamp=(new Date).getTime()},b.preventDefault=function(){this.defaultPrevented=!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){},b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b._listeners=null,b._captureListeners=null,b.initialize=function(){},b.addEventListener=function(a,b,c){var d;d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var e=d[a];return e&&this.removeEventListener(a,b,c),e=d[a],e?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a,b){if("string"==typeof a){var c=this._listeners;if(!c||!c[a])return!1;a=new createjs.Event(a)}if(a.target=b||this,a.bubbles&&this.parent){for(var d=this,e=[d];d.parent;)e.push(d=d.parent);var f,g=e.length;for(f=g-1;f>=0&&!a.propagationStopped;f--)e[f]._dispatchEvent(a,1+(0==f));for(f=1;g>f&&!a.propagationStopped;f++)e[f]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;a.currentTarget=this,a.eventPhase=b,a.removed=!1,e=e.slice();for(var f=0;c>f&&!a.immediatePropagationStopped;f++){var g=e[f];g.handleEvent?g.handleEvent(a):g(a),a.removed&&(this.off(a.type,g,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";createjs.indexOf=function(a,b){for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1}}(),this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}}}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){this.init()};a.prototype=new createjs.EventDispatcher;var b=a.prototype,c=a;c.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?)|(.{0,2}\/{1}))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,c.PATH_PATTERN=/^(?:(\w+:)\/{2})|(.{0,2}\/{1})?([/.]*?(?:[^?]+)?\/?)?$/,b.loaded=!1,b.canceled=!1,b.progress=0,b._item=null,b.getItem=function(){return this._item},b.init=function(){},b.load=function(){},b.close=function(){},b._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},b._sendProgress=function(a){if(!this._isCanceled()){var b=null;"number"==typeof a?(this.progress=a,b=new createjs.Event("progress"),b.loaded=this.progress,b.total=1):(b=a,this.progress=a.loaded/a.total,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),b.progress=this.progress,this.hasEventListener("progress")&&this.dispatchEvent(b)}},b._sendComplete=function(){this._isCanceled()||this.dispatchEvent("complete")},b._sendError=function(a){!this._isCanceled()&&this.hasEventListener("error")&&(null==a&&(a=new createjs.Event("error")),this.dispatchEvent(a))},b._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1},b._parseURI=function(a){return a?a.match(c.FILE_PATTERN):null},b._parsePath=function(a){return a?a.match(c.PATH_PATTERN):null},b._formatQueryString=function(a,b){if(null==a)throw new Error("You must specify data.");var c=[];for(var d in a)c.push(d+"="+escape(a[d]));return b&&(c=c.concat(b)),c.join("&")},b.buildPath=function(a,b){if(null==b)return a;var c=[],d=a.indexOf("?");if(-1!=d){var e=a.slice(d+1);c=c.concat(e.split("&"))}return-1!=d?a.slice(0,d)+"?"+this._formatQueryString(b,c):a+"?"+this._formatQueryString(b,c)},b._isCrossDomain=function(a){var b=document.createElement("a");b.href=a.src;var c=document.createElement("a");c.href=location.href;var d=""!=b.hostname&&(b.port!=c.port||b.protocol!=c.protocol||b.hostname!=c.hostname);return d},b._isLocal=function(a){var b=document.createElement("a");return b.href=a.src,""==b.hostname&&"file:"==b.protocol},b.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b,c){this.init(a,b,c)},b=a.prototype=new createjs.AbstractLoader,c=a;c.loadTimeout=8e3,c.LOAD_TIMEOUT=0,c.BINARY="binary",c.CSS="css",c.IMAGE="image",c.JAVASCRIPT="javascript",c.JSON="json",c.JSONP="jsonp",c.MANIFEST="manifest",c.SOUND="sound",c.SVG="svg",c.TEXT="text",c.XML="xml",c.POST="POST",c.GET="GET",b._basePath=null,b._crossOrigin="",b.useXHR=!0,b.stopOnError=!1,b.maintainScriptOrder=!0,b.next=null,b._typeCallbacks=null,b._extensionCallbacks=null,b._loadStartWasDispatched=!1,b._maxConnections=1,b._currentlyLoadingScript=null,b._currentLoads=null,b._loadQueue=null,b._loadQueueBackup=null,b._loadItemsById=null,b._loadItemsBySrc=null,b._loadedResults=null,b._loadedRawResults=null,b._numItems=0,b._numItemsLoaded=0,b._scriptOrder=null,b._loadedScripts=null,b.init=function(a,b,c){this._numItems=this._numItemsLoaded=0,this._paused=!1,this._loadStartWasDispatched=!1,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._scriptOrder=[],this._loadedScripts=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._typeCallbacks={},this._extensionCallbacks={},this._basePath=b,this.setUseXHR(a),this._crossOrigin=c===!0?"Anonymous":c===!1||null==c?"":c},b.setUseXHR=function(a){return this.useXHR=0!=a&&null!=window.XMLHttpRequest,this.useXHR},b.removeAll=function(){this.remove()},b.remove=function(a){var b=null;if(!a||a instanceof Array){if(a)b=a;else if(arguments.length>0)return}else b=[a];var c=!1;if(b){for(;b.length;){var d=b.pop(),e=this.getResult(d);for(f=this._loadQueue.length-1;f>=0;f--)if(g=this._loadQueue[f].getItem(),g.id==d||g.src==d){this._loadQueue.splice(f,1)[0].cancel();break}for(f=this._loadQueueBackup.length-1;f>=0;f--)if(g=this._loadQueueBackup[f].getItem(),g.id==d||g.src==d){this._loadQueueBackup.splice(f,1)[0].cancel();break}if(e)delete this._loadItemsById[e.id],delete this._loadItemsBySrc[e.src],this._disposeItem(e);else for(var f=this._currentLoads.length-1;f>=0;f--){var g=this._currentLoads[f].getItem();if(g.id==d||g.src==d){this._currentLoads.splice(f,1)[0].cancel(),c=!0;break}}}c&&this._loadNext()}else{this.close();for(var h in this._loadItemsById)this._disposeItem(this._loadItemsById[h]);this.init(this.useXHR)}},b.reset=function(){this.close();for(var a in this._loadItemsById)this._disposeItem(this._loadItemsById[a]);for(var b=[],c=0,d=this._loadQueueBackup.length;d>c;c++)b.push(this._loadQueueBackup[c].getItem());this.loadManifest(b,!1)},c.isBinary=function(a){switch(a){case createjs.LoadQueue.IMAGE:case createjs.LoadQueue.BINARY:return!0;default:return!1}},c.isText=function(a){switch(a){case createjs.LoadQueue.TEXT:case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:case createjs.LoadQueue.XML:case createjs.LoadQueue.HTML:case createjs.LoadQueue.CSS:case createjs.LoadQueue.SVG:case createjs.LoadQueue.JAVASCRIPT:return!0;default:return!1}},b.installPlugin=function(a){if(null!=a&&null!=a.getPreloadHandlers){var b=a.getPreloadHandlers();if(b.scope=a,null!=b.types)for(var c=0,d=b.types.length;d>c;c++)this._typeCallbacks[b.types[c]]=b;if(null!=b.extensions)for(c=0,d=b.extensions.length;d>c;c++)this._extensionCallbacks[b.extensions[c]]=b}},b.setMaxConnections=function(a){this._maxConnections=a,!this._paused&&this._loadQueue.length>0&&this._loadNext()},b.loadFile=function(a,b,c){if(null==a){var d=new createjs.Event("error");return d.text="PRELOAD_NO_FILE",this._sendError(d),void 0}this._addItem(a,null,c),b!==!1?this.setPaused(!1):this.setPaused(!0)},b.loadManifest=function(a,b,d){var e=null,f=null;if(a instanceof Array){if(0==a.length){var g=new createjs.Event("error");return g.text="PRELOAD_MANIFEST_EMPTY",this._sendError(g),void 0}e=a}else if("string"==typeof a)e=[{src:a,type:c.MANIFEST}];else{if("object"!=typeof a){var g=new createjs.Event("error");return g.text="PRELOAD_MANIFEST_NULL",this._sendError(g),void 0}if(void 0!==a.src){if(null==a.type)a.type=c.MANIFEST;else if(a.type!=c.MANIFEST){var g=new createjs.Event("error");g.text="PRELOAD_MANIFEST_ERROR",this._sendError(g)}e=[a]}else void 0!==a.manifest&&(e=a.manifest,f=a.path)}for(var h=0,i=e.length;i>h;h++)this._addItem(e[h],f,d);b!==!1?this.setPaused(!1):this.setPaused(!0)},b.load=function(){this.setPaused(!1)},b.getItem=function(a){return this._loadItemsById[a]||this._loadItemsBySrc[a]},b.getResult=function(a,b){var c=this._loadItemsById[a]||this._loadItemsBySrc[a];if(null==c)return null;var d=c.id;return b&&this._loadedRawResults[d]?this._loadedRawResults[d]:this._loadedResults[d]},b.setPaused=function(a){this._paused=a,this._paused||this._loadNext()},b.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1},b._addItem=function(a,b,c){var d=this._createLoadItem(a,b,c);if(null!=d){var e=this._createLoader(d);null!=e&&(this._loadQueue.push(e),this._loadQueueBackup.push(e),this._numItems++,this._updateProgress(),this.maintainScriptOrder&&d.type==createjs.LoadQueue.JAVASCRIPT&&e instanceof createjs.XHRLoader&&(this._scriptOrder.push(d),this._loadedScripts.push(null)))}},b._createLoadItem=function(a,b,c){var d=null;switch(typeof a){case"string":d={src:a};break;case"object":d=window.HTMLAudioElement&&a instanceof window.HTMLAudioElement?{tag:a,src:d.tag.src,type:createjs.LoadQueue.SOUND}:a;break;default:return null}var e=this._parseURI(d.src);null!=e&&(d.ext=e[6]),null==d.type&&(d.type=this._getTypeByExtension(d.ext));var f="",g=c||this._basePath,h=d.src;if(e&&null==e[1]&&null==e[3])if(b){f=b;var i=this._parsePath(b);h=b+h,null!=g&&i&&null==i[1]&&null==i[2]&&(f=g+f)}else null!=g&&(f=g);if(d.src=f+d.src,d.path=f,(d.type==createjs.LoadQueue.JSON||d.type==createjs.LoadQueue.MANIFEST)&&(d._loadAsJSONP=null!=d.callback),d.type==createjs.LoadQueue.JSONP&&null==d.callback)throw new Error("callback is required for loading JSONP requests.");(void 0===d.tag||null===d.tag)&&(d.tag=this._createTag(d)),(void 0===d.id||null===d.id||""===d.id)&&(d.id=h);var j=this._typeCallbacks[d.type]||this._extensionCallbacks[d.ext];if(j){var k=j.callback.call(j.scope,d.src,d.type,d.id,d.data,f,this);if(k===!1)return null;k===!0||(null!=k.src&&(d.src=k.src),null!=k.id&&(d.id=k.id),null!=k.tag&&(d.tag=k.tag),null!=k.completeHandler&&(d.completeHandler=k.completeHandler),k.type&&(d.type=k.type),e=this._parseURI(d.src),null!=e&&null!=e[6]&&(d.ext=e[6].toLowerCase()))}return this._loadItemsById[d.id]=d,this._loadItemsBySrc[d.src]=d,d},b._createLoader=function(a){var b=this.useXHR;switch(a.type){case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:b=!a._loadAsJSONP;break;case createjs.LoadQueue.XML:case createjs.LoadQueue.TEXT:b=!0;break;case createjs.LoadQueue.SOUND:case createjs.LoadQueue.JSONP:b=!1;break;case null:return null}return b?new createjs.XHRLoader(a,this._crossOrigin):new createjs.TagLoader(a)},b._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded?(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load()):this.loaded=!1;for(var a=0;a<this._loadQueue.length&&!(this._currentLoads.length>=this._maxConnections);a++){var b=this._loadQueue[a];if(this.maintainScriptOrder&&b instanceof createjs.TagLoader&&b.getItem().type==createjs.LoadQueue.JAVASCRIPT){if(this._currentlyLoadingScript)continue;this._currentlyLoadingScript=!0}this._loadQueue.splice(a,1),a--,this._loadItem(b)}}},b._loadItem=function(a){a.on("progress",this._handleProgress,this),a.on("complete",this._handleFileComplete,this),a.on("error",this._handleFileError,this),this._currentLoads.push(a),this._sendFileStart(a.getItem()),a.load()},b._handleFileError=function(a){var b=a.target;this._numItemsLoaded++,this._updateProgress();var c=new createjs.Event("error");c.text="FILE_LOAD_ERROR",c.item=b.getItem(),this._sendError(c),this.stopOnError||(this._removeLoadItem(b),this._loadNext())},b._handleFileComplete=function(a){var b=a.target,c=b.getItem();if(this._loadedResults[c.id]=b.getResult(),b instanceof createjs.XHRLoader&&(this._loadedRawResults[c.id]=b.getResult(!0)),this._removeLoadItem(b),this.maintainScriptOrder&&c.type==createjs.LoadQueue.JAVASCRIPT){if(!(b instanceof createjs.TagLoader))return this._loadedScripts[createjs.indexOf(this._scriptOrder,c)]=c,this._checkScriptLoadOrder(b),void 0;this._currentlyLoadingScript=!1}if(delete c._loadAsJSONP,c.type==createjs.LoadQueue.MANIFEST){var d=b.getResult();null!=d&&void 0!==d.manifest&&this.loadManifest(d,!0)}this._processFinishedLoad(c,b)},b._processFinishedLoad=function(a,b){this._numItemsLoaded++,this._updateProgress(),this._sendFileComplete(a,b),this._loadNext()},b._checkScriptLoadOrder=function(){for(var a=this._loadedScripts.length,b=0;a>b;b++){var c=this._loadedScripts[b];if(null===c)break;if(c!==!0){var d=this._loadedResults[c.id];(document.body||document.getElementsByTagName("body")[0]).appendChild(d),this._processFinishedLoad(c),this._loadedScripts[b]=!0}}},b._removeLoadItem=function(a){for(var b=this._currentLoads.length,c=0;b>c;c++)if(this._currentLoads[c]==a){this._currentLoads.splice(c,1);break}},b._handleProgress=function(a){var b=a.target;this._sendFileProgress(b.getItem(),b.progress),this._updateProgress()},b._updateProgress=function(){var a=this._numItemsLoaded/this._numItems,b=this._numItems-this._numItemsLoaded;if(b>0){for(var c=0,d=0,e=this._currentLoads.length;e>d;d++)c+=this._currentLoads[d].progress;a+=c/b*(b/this._numItems)}this._sendProgress(a)},b._disposeItem=function(a){delete this._loadedResults[a.id],delete this._loadedRawResults[a.id],delete this._loadItemsById[a.id],delete this._loadItemsBySrc[a.src]},b._createTag=function(a){var b=null;switch(a.type){case createjs.LoadQueue.IMAGE:return b=document.createElement("img"),""==this._crossOrigin||this._isLocal(a)||(b.crossOrigin=this._crossOrigin),b;case createjs.LoadQueue.SOUND:return b=document.createElement("audio"),b.autoplay=!1,b;case createjs.LoadQueue.JSON:case createjs.LoadQueue.JSONP:case createjs.LoadQueue.JAVASCRIPT:case createjs.LoadQueue.MANIFEST:return b=document.createElement("script"),b.type="text/javascript",b;case createjs.LoadQueue.CSS:return b=this.useXHR?document.createElement("style"):document.createElement("link"),b.rel="stylesheet",b.type="text/css",b;case createjs.LoadQueue.SVG:return this.useXHR?b=document.createElement("svg"):(b=document.createElement("object"),b.type="image/svg+xml"),b}return null},b._getTypeByExtension=function(a){if(null==a)return createjs.LoadQueue.TEXT;switch(a.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.LoadQueue.IMAGE;case"ogg":case"mp3":case"wav":return createjs.LoadQueue.SOUND;case"json":return createjs.LoadQueue.JSON;case"xml":return createjs.LoadQueue.XML;case"css":return createjs.LoadQueue.CSS;case"js":return createjs.LoadQueue.JAVASCRIPT;case"svg":return createjs.LoadQueue.SVG;default:return createjs.LoadQueue.TEXT}},b._sendFileProgress=function(a,b){if(this._isCanceled())return this._cleanUp(),void 0;if(this.hasEventListener("fileprogress")){var c=new createjs.Event("fileprogress");c.progress=b,c.loaded=b,c.total=1,c.item=a,this.dispatchEvent(c)}},b._sendFileComplete=function(a,b){if(!this._isCanceled()){var c=new createjs.Event("fileload");c.loader=b,c.item=a,c.result=this._loadedResults[a.id],c.rawResult=this._loadedRawResults[a.id],a.completeHandler&&a.completeHandler(c),this.hasEventListener("fileload")&&this.dispatchEvent(c)}},b._sendFileStart=function(a){var b=new createjs.Event("filestart");b.item=a,this.hasEventListener("filestart")&&this.dispatchEvent(b)},b.toString=function(){return"[PreloadJS LoadQueue]"},createjs.LoadQueue=a;var d=function(){};d.init=function(){var a=navigator.userAgent;d.isFirefox=a.indexOf("Firefox")>-1,d.isOpera=null!=window.opera,d.isChrome=a.indexOf("Chrome")>-1,d.isIOS=a.indexOf("iPod")>-1||a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1},d.init(),createjs.LoadQueue.BrowserDetect=d}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a){this.init(a)},b=a.prototype=new createjs.AbstractLoader;b._loadTimeout=null,b._tagCompleteProxy=null,b._isAudio=!1,b._tag=null,b._jsonResult=null,b.init=function(a){this._item=a,this._tag=a.tag,this._isAudio=window.HTMLAudioElement&&a.tag instanceof window.HTMLAudioElement,this._tagCompleteProxy=createjs.proxy(this._handleLoad,this)},b.getResult=function(){return this._item.type==createjs.LoadQueue.JSONP||this._item.type==createjs.LoadQueue.MANIFEST?this._jsonResult:this._tag},b.cancel=function(){this.canceled=!0,this._clean()},b.load=function(){var a=this._item,b=this._tag;clearTimeout(this._loadTimeout);var c=createjs.LoadQueue.LOAD_TIMEOUT;0==c&&(c=createjs.LoadQueue.loadTimeout),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),c),this._isAudio&&(b.src=null,b.preload="auto"),b.onerror=createjs.proxy(this._handleError,this),this._isAudio?(b.onstalled=createjs.proxy(this._handleStalled,this),b.addEventListener("canplaythrough",this._tagCompleteProxy,!1)):(b.onload=createjs.proxy(this._handleLoad,this),b.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this));var d=this.buildPath(a.src,a.values);switch(a.type){case createjs.LoadQueue.CSS:b.href=d;break;case createjs.LoadQueue.SVG:b.data=d;break;default:b.src=d}if(a.type==createjs.LoadQueue.JSONP||a.type==createjs.LoadQueue.JSON||a.type==createjs.LoadQueue.MANIFEST){if(null==a.callback)throw new Error("callback is required for loading JSONP requests.");if(null!=window[a.callback])throw new Error('JSONP callback "'+a.callback+'" already exists on window. You need to specify a different callback. Or re-name the current one.');window[a.callback]=createjs.proxy(this._handleJSONPLoad,this)}(a.type==createjs.LoadQueue.SVG||a.type==createjs.LoadQueue.JSONP||a.type==createjs.LoadQueue.JSON||a.type==createjs.LoadQueue.MANIFEST||a.type==createjs.LoadQueue.JAVASCRIPT||a.type==createjs.LoadQueue.CSS)&&(this._startTagVisibility=b.style.visibility,b.style.visibility="hidden",(document.body||document.getElementsByTagName("body")[0]).appendChild(b)),null!=b.load&&b.load()},b._handleJSONPLoad=function(a){this._jsonResult=a},b._handleTimeout=function(){this._clean();var a=new createjs.Event("error");a.text="PRELOAD_TIMEOUT",this._sendError(a)},b._handleStalled=function(){},b._handleError=function(){this._clean();var a=new createjs.Event("error");this._sendError(a)},b._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var a=this.getItem().tag;("loaded"==a.readyState||"complete"==a.readyState)&&this._handleLoad()},b._handleLoad=function(){if(!this._isCanceled()){var a=this.getItem(),b=a.tag;if(!(this.loaded||this._isAudio&&4!==b.readyState)){switch(this.loaded=!0,a.type){case createjs.LoadQueue.SVG:case createjs.LoadQueue.JSON:case createjs.LoadQueue.JSONP:case createjs.LoadQueue.MANIFEST:case createjs.LoadQueue.CSS:b.style.visibility=this._startTagVisibility,(document.body||document.getElementsByTagName("body")[0]).removeChild(b)}this._clean(),this._sendComplete()}}},b._clean=function(){clearTimeout(this._loadTimeout);var a=this.getItem(),b=a.tag;null!=b&&(b.onload=null,b.removeEventListener&&b.removeEventListener("canplaythrough",this._tagCompleteProxy,!1),b.onstalled=null,b.onprogress=null,b.onerror=null,null!=b.parentNode&&a.type==createjs.LoadQueue.SVG&&a.type==createjs.LoadQueue.JSON&&a.type==createjs.LoadQueue.MANIFEST&&a.type==createjs.LoadQueue.CSS&&a.type==createjs.LoadQueue.JSONP&&b.parentNode.removeChild(b));var a=this.getItem();(a.type==createjs.LoadQueue.JSONP||a.type==createjs.LoadQueue.MANIFEST)&&(window[a.callback]=null)},b.toString=function(){return"[PreloadJS TagLoader]"},createjs.TagLoader=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b){this.init(a,b)},b=a.prototype=new createjs.AbstractLoader;b._request=null,b._loadTimeout=null,b._xhrLevel=1,b._response=null,b._rawResponse=null,b._crossOrigin="",b.init=function(a,b){this._item=a,this._crossOrigin=b,!this._createXHR(a)},b.getResult=function(a){return a&&this._rawResponse?this._rawResponse:this._response},b.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},b.load=function(){if(null==this._request)return this._handleError(),void 0;if(this._request.onloadstart=createjs.proxy(this._handleLoadStart,this),this._request.onprogress=createjs.proxy(this._handleProgress,this),this._request.onabort=createjs.proxy(this._handleAbort,this),this._request.onerror=createjs.proxy(this._handleError,this),this._request.ontimeout=createjs.proxy(this._handleTimeout,this),1==this._xhrLevel){var a=createjs.LoadQueue.LOAD_TIMEOUT;if(0==a)a=createjs.LoadQueue.loadTimeout;else try{console.warn("LoadQueue.LOAD_TIMEOUT has been deprecated in favor of LoadQueue.loadTimeout")}catch(b){}this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),a)}this._request.onload=createjs.proxy(this._handleLoad,this),this._request.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);try{this._item.values&&this._item.method!=createjs.LoadQueue.GET?this._item.method==createjs.LoadQueue.POST&&this._request.send(this._formatQueryString(this._item.values)):this._request.send()}catch(c){var d=new createjs.Event("error");d.error=c,this._sendError(d)}},b.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},b.getResponseHeader=function(a){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(a):null},b._handleProgress=function(a){if(a&&!(a.loaded>0&&0==a.total)){var b=new createjs.Event("progress");b.loaded=a.loaded,b.total=a.total,this._sendProgress(b)}},b._handleLoadStart=function(){clearTimeout(this._loadTimeout),this._sendLoadStart()},b._handleAbort=function(){this._clean();var a=new createjs.Event("error");a.text="XHR_ABORTED",this._sendError(a)},b._handleError=function(){this._clean();var a=new createjs.Event("error");this._sendError(a)},b._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},b._handleLoad=function(){if(!this.loaded){if(this.loaded=!0,!this._checkError())return this._handleError(),void 0;this._response=this._getResponse(),this._clean();var a=this._generateTag();a&&this._sendComplete()}},b._handleTimeout=function(a){this._clean();var b=new createjs.Event("error");b.text="PRELOAD_TIMEOUT",this._sendError(a)},b._checkError=function(){var a=parseInt(this._request.status);switch(a){case 404:case 0:return!1}return!0},b._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(a){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(a){}return null},b._createXHR=function(a){var b=this._isCrossDomain(a),c=null;if(b&&window.XDomainRequest)c=new XDomainRequest;else if(window.XMLHttpRequest)c=new XMLHttpRequest;else try{c=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(d){try{c=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(d){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(d){return!1}}}createjs.LoadQueue.isText(a.type)&&c.overrideMimeType&&c.overrideMimeType("text/plain; charset=utf-8"),this._xhrLevel="string"==typeof c.responseType?2:1;var e=null;return e=a.method==createjs.LoadQueue.GET?this.buildPath(a.src,a.values):a.src,c.open(a.method||createjs.LoadQueue.GET,e,!0),b&&c instanceof XMLHttpRequest&&1==this._xhrLevel&&c.setRequestHeader("Origin",location.origin),a.values&&a.method==createjs.LoadQueue.POST&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),createjs.LoadQueue.isBinary(a.type)&&(c.responseType="arraybuffer"),this._request=c,!0},b._clean=function(){clearTimeout(this._loadTimeout);var a=this._request;a.onloadstart=null,a.onprogress=null,a.onabort=null,a.onerror=null,a.onload=null,a.ontimeout=null,a.onloadend=null,a.onreadystatechange=null},b._generateTag=function(){var a=this._item.type,b=this._item.tag;switch(a){case createjs.LoadQueue.IMAGE:return b.onload=createjs.proxy(this._handleTagReady,this),""!=this._crossOrigin&&(b.crossOrigin="Anonymous"),b.src=this.buildPath(this._item.src,this._item.values),this._rawResponse=this._response,this._response=b,!1;case createjs.LoadQueue.JAVASCRIPT:return b=document.createElement("script"),b.text=this._response,this._rawResponse=this._response,this._response=b,!0;case createjs.LoadQueue.CSS:var c=document.getElementsByTagName("head")[0];if(c.appendChild(b),b.styleSheet)b.styleSheet.cssText=this._response;else{var d=document.createTextNode(this._response);b.appendChild(d)}return this._rawResponse=this._response,this._response=b,!0;case createjs.LoadQueue.XML:var e=this._parseXML(this._response,"text/xml");return this._rawResponse=this._response,this._response=e,!0;case createjs.LoadQueue.SVG:var e=this._parseXML(this._response,"image/svg+xml");return this._rawResponse=this._response,null!=e.documentElement?(b.appendChild(e.documentElement),this._response=b):this._response=e,!0;case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:var f={};try{f=JSON.parse(this._response)}catch(g){f=g}return this._rawResponse=this._response,this._response=f,!0}return!0},b._parseXML=function(a,b){var c=null;try{if(window.DOMParser){var d=new DOMParser;c=d.parseFromString(a,b)}else c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)}catch(e){}return c},b._handleTagReady=function(){this._sendComplete()},b.toString=function(){return"[PreloadJS XHRLoader]"},createjs.XHRLoader=a}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();

/* SOURCE FILE: captionator-min.js (e190e16a) 9/9/2014 2:09:00 PM */


/*
	Captionator 0.6 [CaptionPlanet]
	Christopher Giffard, 2011
	Share and enjoy

	https://github.com/cgiffard/Captionator
*/
/*global HTMLVideoElement: true, NodeList: true, Audio: true, HTMLElement: true, document:true, window:true, XMLHttpRequest:true, navigator:true, VirtualMediaContainer:true */
/*jshint strict:true */
/*Tab indented, tab = 4 spaces*/



;(function(){"use strict";var e=10,t=16,n=4.5,r=1.5,i=[0,0,0,.5],s=!1,o={};window.captionator=o,o.CaptionatorCueStructure=function(t,n){var r=this;this.isTimeDependent=!1,this.cueSource=t,this.options=n,this.processedCue=null,this.toString=function i(e){if(n.processCueHTML!==!1){var i=function(t,n){if(r.processedCue===null){var s="",o,u;for(o in t)if(o.match(/^\d+$/)&&t.hasOwnProperty(o)){u=t[o];if(u instanceof Object&&u.children&&u.children.length)u.token==="v"?s+='<q data-voice="'+u.voice.replace(/[\"]/g,"")+"\" class='voice "+"speaker-"+u.voice.replace(/[^a-z0-9]+/ig,"-").toLowerCase()+" webvtt-span' "+'title="'+u.voice.replace(/[\"]/g,"")+'">'+i(u.children,n+1)+"</q>":u.token==="c"?s+="<span class='webvtt-span webvtt-class-span "+u.classes.join(" ")+"'>"+i(u.children,n+1)+"</span>":u.timeIn>0?e===null||e===undefined||e>0&&e>=u.timeIn?s+="<span class='webvtt-span webvtt-timestamp-span' data-timestamp='"+u.token+"' data-timestamp-seconds='"+u.timeIn+"'>"+i(u.children,n+1)+"</span>":e<u.timeIn&&(s+="<span class='webvtt-span webvtt-timestamp-span webvtt-cue-future' aria-hidden='true' style='opacity: 0;' data-timestamp='"+u.token+"' data-timestamp-seconds='"+u.timeIn+"'>"+i(u.children,n+1)+"</span>"):s+=u.rawToken+i(u.children,n+1)+"</"+u.token+">";else if(u instanceof String||typeof u=="string"||typeof u=="number")s+=u}return!r.isTimeDependent&&n===0&&(r.processedCue=s),s}return r.processedCue};return i(this,0)}return t},this.getPlain=function(e){if(n.processCueHTML!==!1){var r=function(t,n){var i="",s,o;for(s in t)if(s.match(/^\d+$/)&&t.hasOwnProperty(s)){o=t[s];if(o instanceof Object&&o.children&&o.children.length)if(o.timeIn>0){if(e===null||e===undefined||e>0&&e>=o.timeIn)i+=r(o.children,n+1)}else i+=r(o.children,n+1);else if(o instanceof String||typeof o=="string"||typeof o=="number")i+=o}return i};return r(this,0)}return t.replace(/<[^>]*>/ig,"")}},o.CaptionatorCueStructure.prototype=[],o.TextTrack=function(t,n,r,i,s,u){this.onload=function(){},this.onerror=function(){},this.oncuechange=function(){},this.id=t||"",this.internalMode=o.TextTrack.OFF,this.cues=new o.TextTrackCueList(this),this.activeCues=new o.ActiveTextTrackCueList(this.cues,this),this.kind=n||"subtitles",this.label=r||"",this.language=i||"",this.src=s||"",this.readyState=o.TextTrack.NONE,this.internalDefault=u||!1,this.getMode=function(){return this.internalMode},this.setMode=function(e){var t=[o.TextTrack.OFF,o.TextTrack.HIDDEN,o.TextTrack.SHOWING],n,r;if(t.indexOf(e)===-1)throw new Error("Illegal mode value for track: "+e);e!==this.internalMode&&(this.internalMode=e,this.readyState===o.TextTrack.NONE&&this.src.length>0&&e>o.TextTrack.OFF&&this.loadTrack(this.src,null),this.videoNode._captionator_dirtyBit=!0,o.rebuildCaptions(this.videoNode),e===o.TextTrack.OFF&&(this.cues.length=0,this.readyState=o.TextTrack.NONE))},this.getDefault=function(){return this.internalDefault},Object.prototype.__defineGetter__?(this.__defineGetter__("mode",this.getMode),this.__defineSetter__("mode",this.setMode),this.__defineGetter__("default",this.getDefault)):Object.defineProperty&&(Object.defineProperty(this,"mode",{get:this.getMode,set:this.setMode}),Object.defineProperty(this,"default",{get:this.getDefault})),this.loadTrack=function(e,t){var n,r=new XMLHttpRequest;if(this.readyState===o.TextTrack.LOADED)t instanceof Function&&t(n);else{this.src=e,this.readyState=o.TextTrack.LOADING;var i=this;r.open("GET",e,!0),r.onreadystatechange=function(e){if(r.readyState===4)if(r.status===200){var s=i.videoNode._captionatorOptions||{};i.kind==="metadata"&&(s.processCueHTML=!1,s.sanitiseCueHTML=!1),n=o.parseCaptions(r.responseText,s),i.readyState=o.TextTrack.LOADED,i.cues.loadCues(n),i.activeCues.refreshCues.apply(i.activeCues),i.videoNode._captionator_dirtyBit=!0,o.rebuildCaptions(i.videoNode),i.onload.call(this),t instanceof Function&&t.call(i,n)}else i.readyState=o.TextTrack.ERROR,i.onerror()};try{r.send(null)}catch(s){i.readyState=o.TextTrack.ERROR,i.onerror(s)}}},this.addCue=function(e){if(!(e&&e instanceof o.TextTrackCue))throw new Error("The argument is null or not an instance of TextTrackCue.");this.cues.addCue(e)},this.removeCue=function(){}},o.TextTrack.NONE=0,o.TextTrack.LOADING=1,o.TextTrack.LOADED=2,o.TextTrack.ERROR=3,o.TextTrack.OFF=0,o.TextTrack.HIDDEN=1,o.TextTrack.SHOWING=2,o.TextTrackCue=function(t,n,r,i,s,u,a){this.id=t,this.track=a instanceof o.TextTrack?a:null,this.startTime=parseFloat(n),this.endTime=parseFloat(r)>=this.startTime?parseFloat(r):this.startTime,this.text=typeof i=="string"||i instanceof o.CaptionatorCueStructure?i:"",this.settings=typeof s=="string"?s:"",this.intSettings={},this.pauseOnExit=!!u,this.wasActive=!1,this.direction="horizontal",this.snapToLines=!0,this.linePosition="auto",this.textPosition=50,this.size=0,this.alignment="middle";if(this.settings.length){var f=this.intSettings,l=this;s=s.split(/\s+/).filter(function(e){return e.length>0}),s instanceof Array&&s.forEach(function(e){var t={D:"direction",L:"linePosition",T:"textPosition",A:"alignment",S:"size"};e=e.split(":"),t[e[0]]&&(f[t[e[0]]]=e[1]),t[e[0]]in l&&(l[t[e[0]]]=e[1])})}this.linePosition.match(/\%/)&&(this.snapToLines=!1),this.getCueAsSource=function(){return String(this.text)},this.getCueAsHTML=function(){var t=document.createDocumentFragment(),n=document.createElement("div");return n.innerHTML=String(this.text),Array.prototype.forEach.call(n.childNodes,function(e){t.appendChild(e.cloneNode(!0))}),t},this.isActive=function(){var e=0;if(this.track instanceof o.TextTrack&&(this.track.mode===o.TextTrack.SHOWING||this.track.mode===o.TextTrack.HIDDEN)&&this.track.readyState===o.TextTrack.LOADED)try{e=this.track.videoNode.currentTime;if(this.startTime<=e&&this.endTime>=e)return this.wasActive||(this.wasActive=!0,this.onenter()),!0}catch(t){return!1}return this.wasActive&&(this.wasActive=!1,this.onexit()),!1},Object.prototype.__defineGetter__?this.__defineGetter__("active",this.isActive):Object.defineProperty&&Object.defineProperty(this,"active",{get:this.isActive}),this.toString=function c(){return"TextTrackCue:"+this.id+"\n"+String(this.text)},this.onenter=function(){},this.onexit=function(){}},o.TextTrackCueList=function(t){this.track=t instanceof o.TextTrack?t:null,this.getCueById=function(e){return this.filter(function(t){return t.id===e})[0]},this.loadCues=function(e){for(var t=0;t<e.length;t++)e[t].track=this.track,Array.prototype.push.call(this,e[t])},this.addCue=function(e){if(!(e&&e instanceof o.TextTrackCue))throw new Error("The argument is null or not an instance of TextTrackCue.");if(e.track!==this.track&&!!e.track)throw new Error("This cue is associated with a different track!");Array.prototype.push.call(this,e)},this.toString=function(){return"[TextTrackCueList]"}},o.TextTrackCueList.prototype=[],o.ActiveTextTrackCueList=function(t,n){this.refreshCues=function(){if(t.length){var e=this,r=!1,i=[].slice.call(this,0);this.length=0,t.forEach(function(t){t.active&&(e.push(t),e[e.length-1]!==i[e.length-1]&&(r=!0))});if(r)try{n.oncuechange()}catch(s){}}},this.toString=function(){return"[ActiveTextTrackCueList]"},this.refreshCues()},o.ActiveTextTrackCueList.prototype=new o.TextTrackCueList(null);var u=function(e){this.targetObject=e,this.currentTime=0;var t=function(){};this.addEventListener=function(e,t,n){e==="timeupdate"&&t instanceof Function&&(this.timeupdateEventHandler=t)},this.attachEvent=function(e,t){e==="timeupdate"&&t instanceof Function&&(this.timeupdateEventHandler=t)},this.updateTime=function(e){isNaN(e)||(this.currentTime=e,t())}};o.rebuildCaptions=function(e){var t=e.textTracks||[],n=e._captionatorOptions instanceof Object?e._captionatorOptions:{},r=e.currentTime,i=[],s=!1,u=[],a=[];t.forEach(function(e,t){e.mode===o.TextTrack.SHOWING&&e.readyState===o.TextTrack.LOADED&&(a=[].slice.call(e.activeCues,0),a=a.sort(function(e,t){return e.startTime>t.startTime?-1:1}),i=i.concat(a))}),u=i.map(function(e){return e.track.id+"."+e.id+":"+e.text.toString(r).length}),s=!o.compareArray(u,e._captionator_previousActiveCues);if(s||e._captionator_dirtyBit){e._captionator_dirtyBit=!1,e._captionator_availableCueArea=null,e._captionator_previousActiveCues=u,o.styleCueCanvas(e);var f=[].slice.call(e._descriptionContainerObject.getElementsByTagName("div"),0).concat([].slice.call(e._containerObject.getElementsByTagName("div"),0));f.forEach(function(e){e.cueObject&&!e.cueObject.active&&(e.cueObject.rendered=!1,e.cueObject.domNode=null,e.parentElement.removeChild(e))}),i.forEach(function(t){var n,i;t.track.kind!=="metadata"&&t.mode!==o.TextTrack.HIDDEN&&(t.rendered?(n=t.domNode,i=n.getElementsByClassName("captionator-cue-inner")[0],t.text.toString(r)!==n.currentText&&(n.currentText=t.text.toString(r),i.innerHTML=n.currentText,i.spanified=!1)):(n=document.createElement("div"),i=document.createElement("span"),i.className="captionator-cue-inner",n.id=String(t.id).length?t.id:o.generateID(),n.className="captionator-cue",n.appendChild(i),n.cueObject=t,t.domNode=n,n.setAttribute("lang",t.track.language),n.currentText=t.text.toString(r),i.innerHTML=n.currentText,t.rendered=!0,t.track.kind==="descriptions"?e._descriptionContainerObject.appendChild(n):e._containerObject.appendChild(n)),t.track.kind!=="descriptions"&&o.styleCue(n,t,e))})}},o.captionify=function(a,f,l){var c=[],h=0;l=l instanceof Object?l:{},l.minimumFontSize&&typeof l.minimumFontSize=="number"&&(e=l.minimumFontSize),l.minimumLineHeight&&typeof l.minimumLineHeight=="number"&&(t=l.minimumLineHeight),l.fontSizeVerticalPercentage&&typeof l.fontSizeVerticalPercentage=="number"&&(n=l.fontSizeVerticalPercentage),l.lineHeightRatio&&typeof l.lineHeightRatio!="number"&&(r=l.lineHeightRatio),l.cueBackgroundColour&&l.cueBackgroundColour instanceof Array&&(i=l.cueBackgroundColour);if(!!HTMLVideoElement||a instanceof u||!!l.forceCaptionify){if(typeof document.createElement("video").addTextTrack!="function"&&typeof document.createElement("video").addTrack!="function"||!!l.forceCaptionify){!s&&l.exportObjects&&(window.TextTrack=o.TextTrack,window.TextTrackCueList=o.TextTrackCueList,window.ActiveTextTrackCueList=o.ActiveTextTrackCueList,window.TextTrackCue=o.TextTrackCue,s=!0);if(!a||a===!1||a===undefined||a===null)c=[].slice.call(document.getElementsByTagName("video"),0);else if(a instanceof Array)for(h=0;h<a.length;h++)typeof a[h]=="string"?c=c.concat([].slice.call(document.querySelectorAll(a[h]),0)):a[h].constructor===HTMLVideoElement&&c.push(a[h]);else typeof a=="string"?c=[].slice.call(document.querySelectorAll(a),0):a.constructor===HTMLVideoElement&&c.push(a);return c.length?(c.forEach(function(e){e.addTextTrack=function(t,n,r,i,s,u,a){var f=["subtitles","captions","descriptions","captions","metadata","chapters"],l=f.slice(0,7),c;t=typeof t=="string"?t:"",r=typeof r=="string"?r:"",i=typeof i=="string"?i:"",a=typeof a=="boolean"?a:!1;if(!f.filter(function(e){return n===e?!0:!1}).length)throw o.createDOMException(12,"DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedTextTrack.","SYNTAX_ERR");return c=new o.TextTrack(t,n,r,i,s,null),c?(e.textTracks instanceof Array||(e.textTracks=[]),e.textTracks.push(c),c):!1},o.processVideoElement(c[h],f,l)}),!0):!1}return!1}return!1},o.parseCaptions=function(e,t){t=t instanceof Object?t:{};var n="",r=[],i="",s=[],u=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\,(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,a=/^(\d+)?:?(\d{2}):(\d{2})\.(\d+)\,(\d+)?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,f=/^(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s*(.*)/,l=/(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)/,c=/^([\d\.]+)\s+\+([\d\.]+)\s*(.*)/,h=/^\[(\d{2})?:?(\d{2})\:(\d{2})\.(\d{2,3})\]\s*(.*?)$/,p=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,d=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,v=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g,m=/<tt\s+xml/ig,g=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)/,y=/^([\d\.]+)[smhdwy]/ig;if(e){var b=function(n){var r=new o.CaptionatorCueStructure(n,t),i=[],s,u,a,f=[],c=0,h,p,d,v=function(e){return!!e.replace(/[^a-z0-9]+/ig,"").length};i=n.split(/(<\/?[^>]+>)/ig),a=r;for(s in i)if(i.hasOwnProperty(s)){u=i[s];if(u.substr(0,1)==="<"){if(u.substr(1,1)==="/"){var m=u.substr(2).split(/[\s>]+/g)[0];if(f.length>0){var g=0;for(c=f.length-1;c>=0;c--){var y=f[c][f[c].length-1];g=c;if(y.token===m)break}a=f[g],f=f.slice(0,g)}}else if(u.substr(1).match(l)||u.match(/^<v\s+[^>]+>/i)||u.match(/^<c[a-z0-9\-\_\.]+>/)||u.match(/^<(b|i|u|ruby|rt)>/)||t.sanitiseCueHTML!==!1){var b={token:u.replace(/[<\/>]+/ig,"").split(/[\s\.]+/)[0],rawToken:u,children:[]};b.token==="v"?b.voice=u.match(/^<v\s*([^>]+)>/i)[1]:b.token==="c"?b.classes=u.replace(/[<\/>\s]+/ig,"").split(/[\.]+/ig).slice(1).filter(v):!(h=b.rawToken.match(l))||(r.isTimeDependent=!0,p=h.slice(1),b.timeIn=parseInt((p[0]||0)*60*60,10)+parseInt((p[1]||0)*60,10)+parseInt(p[2]||0,10)+parseFloat("0."+(p[3]||0))),a.push(b),f.push(a),a=b.children}}else t.sanitiseCueHTML!==!1&&(u=u.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\&/g,"&amp;"),t.ignoreWhitespace||(u=u.replace(/\n+/g,"<br />"))),a.push(u)}return r},w=function(r,l){var m,g,y,w,E,S,x="",T,N,C,k;if(N=p.exec(r))return s=N.slice(2).join(""),s=s.split(/\s+/g).filter(function(e){return e&&!!e.length}),null;if(N=d.exec(r))return i+=N[N.length-1],null;if(N=v.exec(r))return null;n==="LRC"?m=[r.substr(0,r.indexOf("]")+1),r.substr(r.indexOf("]")+1)]:m=r.split(/\n/g);while(!m[0].replace(/\s+/ig,"").length&&m.length>0)m.shift();m[0].match(/^\s*[a-z0-9\-]+\s*$/ig)?T=String(m.shift().replace(/\s*/ig,"")):T=l;for(S=0;S<m.length;S++){var L=m[S];(C=f.exec(L))||(C=u.exec(L))||(C=a.exec(L))?(E=C.slice(1),g=parseInt((E[0]||0)*60*60,10)+parseInt((E[1]||0)*60,10)+parseInt(E[2]||0,10)+parseFloat("0."+(E[3]||0)),y=parseInt((E[4]||0)*60*60,10)+parseInt((E[5]||0)*60,10)+parseInt(E[6]||0,10)+parseFloat("0."+(E[7]||0)),E[8]&&(x=E[8])):(C=c.exec(L))?(E=C.slice(1),g=parseFloat(E[0]),y=g+parseFloat(E[1]),E[2]&&(x=E[2])):!(C=h.exec(L))||(E=C.slice(1,C.length-1),g=parseInt((E[0]||0)*60*60,10)+parseInt((E[1]||0)*60,10)+parseInt(E[2]||0,10)+parseFloat("0."+(E[3]||0)),y=g),m=m.slice(0,S).concat(m.slice(S+1));break}if(!g&&!y)return null;var A=s.reduce(function(e,t,n,r){return e[t.split(":")[0]]=t.split(":")[1],e},{});A=x.split(/\s+/g).filter(function(e){return e&&!!e.length}).reduce(function(e,t,n,r){return e[t.split(":")[0]]=t.split(":")[1],e},A),x="";for(var O in A)A.hasOwnProperty(O)&&(x+=x.length?" ":"",x+=O+":"+A[O]);return w=t.processCueHTML===!1?m.join("\n"):b(m.join("\n")),k=new o.TextTrackCue(T,g,y,w,x,!1,null),k.styleData=i,k},E=function(t){var n,r=0;if(typeof t!="string")return 0;if(n=g.exec(t))n=n.slice(1),r=parseInt((n[0]||0)*60*60,10)+parseInt((n[1]||0)*60,10)+parseInt(n[2]||0,10)+parseFloat("0."+(n[3]||0));return r},S=function(n,r){var i,s,u,a,f=0,l=0,c=String(n.getAttribute("begin")),h=String(n.getAttribute("end")),p=n.getAttribute("id")||r;return f=E(c),l=E(h),u=t.processCueHTML===!1?n.innerHTML:b(n.innerHTML),new o.TextTrackCue(p,f,l,u,{},!1,null)};r=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(m.exec(e)){var x=document.createElement("ttml");x.innerHTML=e;var T=[].slice.call(x.querySelectorAll("[begin],[end]"),0),N=T.map(S);return N}return e.split(/\n+/g).reduce(function(e,t,n,r){return e||!!h.exec(t)},!1)?(r=r.split(/\n+/g),n="LRC"):r=r.split(/\n\n+/g),r=r.filter(function(e){return e.match(/^WEBVTT(\s*FILE)?/ig)?(n="WebVTT",!1):e.replace(/\s*/ig,"").length?!0:!1}).map(w).filter(function(e){return e!==null?!0:!1}),n==="LRC"&&(r.forEach(function(e,t){var n=0,i;t>0&&(n=e.startTime,i=r[--t],i.endTime<n&&(i.endTime=n))}),r=r.filter(function(e){return e.text.toString().replace(/\s*/,"").length>0?!0:!1})),r}throw new Error("Required parameter captionData not supplied.")},o.processVideoElement=function(e,t,n){var r=[],i=navigator.language||navigator.userLanguage,s=t||i.split("-")[0];n=n instanceof Object?n:{};if(!e.captioned){e._captionatorOptions=n,e.className+=(e.className.length?" ":"")+"captioned",e.captioned=!0,e.id.length===0&&(e.id=o.generateID());var u=!1;[].slice.call(e.querySelectorAll("track"),0).forEach(function(i){var s=null;i.querySelectorAll("source").length>0?s=i.querySelectorAll("source"):s=i.getAttribute("src");var u=e.addTextTrack(i.getAttribute("id")||o.generateID(),i.getAttribute("kind"),i.getAttribute("label"),i.getAttribute("srclang").split("-")[0],s,i.getAttribute("type"),i.hasAttribute("default"));i.track=u,u.trackNode=i,u.videoNode=e,r.push(u);var a=!1;(u.kind==="subtitles"||u.kind==="captions")&&t===u.language&&n.enableCaptionsByDefault&&(r.filter(function(e){return e.kind!=="captions"&&e.kind!=="subtitles"||t!==e.language||e.mode!==o.TextTrack.SHOWING?!1:!0}).length||(a=!0)),u.kind==="chapters"&&t===u.language&&(r.filter(function(e){return e.kind==="chapters"&&e.mode===o.TextTrack.SHOWING?!0:!1}).length||(a=!0)),u.kind==="descriptions"&&n.enableDescriptionsByDefault===!0&&t===u.language&&(r.filter(function(e){return e.kind==="descriptions"&&e.mode===o.TextTrack.SHOWING?!0:!1}).length||(a=!0)),a===!0&&r.forEach(function(e){e.trackNode.hasAttribute("default")&&e.mode===o.TextTrack.SHOWING&&(e.mode=o.TextTrack.HIDDEN)}),i.hasAttribute("default")&&(r.filter(function(e){return e.trackNode.hasAttribute("default")&&e.trackNode!==i?!0:!1}).length||(a=!0,u.internalDefault=!0)),a===!0&&(u.mode=o.TextTrack.SHOWING)}),e.addEventListener("timeupdate",function(e){var t=e.target;try{t.textTracks.forEach(function(e){e.activeCues.refreshCues.apply(e.activeCues)})}catch(r){}n.renderer instanceof Function?n.renderer.call(o,t):o.rebuildCaptions(t)},!1),window.addEventListener("resize",function(t){e._captionator_dirtyBit=!0,o.rebuildCaptions(e)},!1),n.enableHighResolution===!0&&window.setInterval(function(){try{e.textTracks.forEach(function(e){e.activeCues.refreshCues.apply(e.activeCues)})}catch(r){}n.renderer instanceof Function?n.renderer.call(o,e):o.rebuildCaptions(e)},20)}return e},o.getNodeMetrics=function(e){var t=window.getComputedStyle(e,null),n=e,r=e.offsetTop,i=e.offsetLeft,s=e,o=0,u=0;s=parseInt(t.getPropertyValue("width"),10),o=parseInt(t.getPropertyValue("height"),10);while(!!(n=n.offsetParent))r+=n.offsetTop,i+=n.offsetLeft;if(e.hasAttribute("controls")){var a=navigator.userAgent.toLowerCase();a.indexOf("chrome")!==-1?u=32:a.indexOf("opera")!==-1?u=25:a.indexOf("firefox")!==-1?u=28:a.indexOf("ie 9")!==-1||a.indexOf("ipad")!==-1?u=44:a.indexOf("safari")!==-1&&(u=25)}else if(e._captionatorOptions){var f=e._captionatorOptions;f.controlHeight&&(u=parseInt(f.controlHeight,10))}return{left:i,top:r,width:s,height:o,controlHeight:u}},o.applyStyles=function(e,t){for(var n in t)(({})).hasOwnProperty.call(t,n)&&(e.style[n]=t[n])},o.checkDirection=function(e){var t="A-Za-zÃ€-Ã–Ã˜-Ã¶Ã¸-Ê¸Ì€-Öà €-á¿¿â°€-ï¬œï·¾-ï¹¯ï»½-ï¿¿",n="Ö‘-ß¿ï¬-ï·½ï¹°-ï»¼",r=new RegExp("^[^"+n+"]*["+t+"]"),i=new RegExp("^[^"+t+"]*["+n+"]");return i.test(e)?"rtl":r.test(e)?"ltr":""},o.styleCue=function(s,u,a){var f=0,l=0,c=0,h=0,p,d,v=0,m=0,g,y,b,w,E,S,x,T,N=0,C=0,k=0,L=0,A=0,O=0,M=0,_,D,P=0,H=a._captionatorOptions||{},B,j=100,F=50,I=0,q=0,R=!0,U="",z,W=u.track.language,X=function(e){if(e.spanified)return e.characterCount;var t=function(e){return!!e.length},n="<span class='captionator-cue-character'>",r,i,s,u,a=0,f=function(e){a++,o.applyStyles(e,{display:"block",lineHeight:"auto",height:y+"px",width:T+"px",textAlign:"center"})};for(r in e.childNodes)e.childNodes.hasOwnProperty(r)&&!e.childNodes[r].nospan&&(i=e.childNodes[r],i.nodeType===3?(u=document.createDocumentFragment(),s=i.nodeValue,u.appendChild(document.createElement("span")),u.childNodes[0].innerHTML=n+s.split(/(.)/).filter(t).join("</span>"+n)+"</span>",[].slice.call(u.querySelectorAll("span.captionator-cue-character"),0).forEach(f),i.parentNode.replaceChild(u,i)):e.childNodes[r].nodeType===1&&(a+=X(e.childNodes[r])));return e.characterCount=a,e.spanified=!0,a};B=o.getNodeMetrics(a),a._captionator_availableCueArea||(a._captionator_availableCueArea={bottom:B.height-B.controlHeight,right:B.width,top:0,left:0,height:B.height-B.controlHeight,width:B.width}),u.direction==="horizontal"&&(o.applyStyles(s,{width:"auto",position:"static",display:"inline-block",padding:"1em"}),I=parseInt(s.offsetWidth,10),q=Math.floor(I/a._captionator_availableCueArea.width*100),q=q<=100?q:100),g=B.height*(n/100)/96*72,g=g>=e?g:e,y=Math.floor(g/72*96),b=Math.floor(g*r),b=b>t?b:t,x=Math.ceil(b/72*96),T=x,x*Math.floor(B.height/x)<B.height&&(x=Math.floor(B.height/Math.floor(B.height/x)),b=Math.ceil(x/96*72)),x*Math.floor(B.width/x)<B.width&&(T=Math.ceil(B.width/Math.floor(B.width/x))),E=Math.floor(a._captionator_availableCueArea.height/x),S=Math.floor(a._captionator_availableCueArea.width/T),parseFloat(String(u.size).replace(/[^\d\.]/ig,""))===0?H.sizeCuesByTextBoundingBox===!0?p=q:(p=100,R=!1):(R=!1,p=parseFloat(String(u.size).replace(/[^\d\.]/ig,"")),p=p<=100?p:100),v=u.direction==="horizontal"?Math.floor(B.width*.01):0,m=u.direction==="horizontal"?0:Math.floor(B.height*.01),u.linePosition==="auto"?u.linePosition=u.direction==="horizontal"?E:S:String(u.linePosition).match(/\%/)&&(u.snapToLines=!1,u.linePosition=parseFloat(String(u.linePosition).replace(/\%/ig,"")));if(u.direction==="horizontal")h=x,u.textPosition!=="auto"&&R&&(F=parseFloat(String(u.textPosition).replace(/[^\d\.]/ig,"")),p-F>q?p-=F:p=q),u.snapToLines===!0?c=a._captionator_availableCueArea.width*(p/100):c=B.width*(p/100),u.textPosition==="auto"?f=(a._captionator_availableCueArea.right-c)/2+a._captionator_availableCueArea.left:(F=parseFloat(String(u.textPosition).replace(/[^\d\.]/ig,"")),f=(a._captionator_availableCueArea.right-c)*(F/100)+a._captionator_availableCueArea.left),u.snapToLines===!0?l=(E-1)*x+a._captionator_availableCueArea.top:(w=B.controlHeight+x+m*2,l=(B.height-w)*(u.linePosition/100));else{l=a._captionator_availableCueArea.top,f=a._captionator_availableCueArea.right-T,c=T,h=a._captionator_availableCueArea.height*(p/100),C=X(s),k=[].slice.call(s.querySelectorAll("span.captionator-cue-character"),0),N=Math.floor((h-m*2)/y),c=Math.ceil(C/N)*T,L=Math.ceil(C/N),A=C-N*(L-1),O=A*y;if(u.snapToLines===!0)f=u.direction==="vertical-lr"?a._captionator_availableCueArea.left:a._captionator_availableCueArea.right-c;else{var V=c+v*2;u.direction==="vertical-lr"?f=(B.width-V)*(u.linePosition/100):f=B.width-V-(B.width-V)*(u.linePosition/100)}u.textPosition==="auto"?l=(a._captionator_availableCueArea.bottom-h)/2+a._captionator_availableCueArea.top:(u.textPosition=parseFloat(String(u.textPosition).replace(/[^\d\.]/ig,"")),l=(a._captionator_availableCueArea.bottom-h)*(u.textPosition/100)+a._captionator_availableCueArea.top),M=0,P=0,_=0,D=0,k.forEach(function(e,t){u.direction==="vertical-lr"?_=T*M:_=c-T*(M+1),u.alignment==="start"||u.alignment!=="start"&&M<L-1?D=P*y+m:u.alignment==="end"?D=P*y-y+(h+m*2-O):u.alignment==="middle"&&(D=(h-m*2-O)/2+P*y),e.setAttribute("aria-hidden","true"),o.applyStyles(e,{position:"absolute",top:D+"px",left:_+"px"}),P>=N-1?(P=0,M++):P++}),s.accessified||(U=u.text.getPlain(a.currentTime),z=document.createElement("div"),z.innerHTML=U,z.nospan=!0,s.appendChild(z),s.accessified=!0,o.applyStyles(z,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"}))}u.direction==="horizontal"&&(o.checkDirection(String(u.text))==="rtl"?d={start:"right",middle:"center",end:"left"}[u.alignment]:d={start:"left",middle:"center",end:"right"}[u.alignment]),o.applyStyles(s,{position:"absolute",overflow:"hidden",width:c+"px",height:h+"px",top:l+"px",left:f+"px",padding:m+"px "+v+"px",textAlign:d,backgroundColor:"rgba("+i.join(",")+")",direction:o.checkDirection(String(u.text)),lineHeight:b+"pt",boxSizing:"border-box"});if(u.direction==="vertical"||u.direction==="vertical-lr")f-a._captionator_availableCueArea.left-a._captionator_availableCueArea.left>=a._captionator_availableCueArea.right-(f+c)?a._captionator_availableCueArea.right=f:a._captionator_availableCueArea.left=f+c,a._captionator_availableCueArea.width=a._captionator_availableCueArea.right-a._captionator_availableCueArea.left;else{if(s.scrollHeight>s.offsetHeight*1.2)if(u.snapToLines){var $=0;while(s.scrollHeight>s.offsetHeight*1.2)h+=x,s.style.height=h+"px",$++;l-=$*x,s.style.top=l+"px"}else{var J=s.scrollHeight-h;h=s.scrollHeight+m,w=B.controlHeight+h+m*2,l=(B.height-w)*(u.linePosition/100),s.style.height=h+"px",s.style.top=l+"px"}l-a._captionator_availableCueArea.top-a._captionator_availableCueArea.top>=a._captionator_availableCueArea.bottom-(l+h)&&a._captionator_availableCueArea.bottom>l?a._captionator_availableCueArea.bottom=l:a._captionator_availableCueArea.top<l+h&&(a._captionator_availableCueArea.top=l+h),a._captionator_availableCueArea.height=a._captionator_availableCueArea.bottom-a._captionator_availableCueArea.top}},o.styleCueCanvas=function(i){var s,u,a,f,l,c,h=i._captionatorOptions instanceof Object?i._captionatorOptions:{};if(!(i instanceof HTMLVideoElement))throw new Error("Cannot style a cue canvas for a non-video node!");i._containerObject&&(a=i._containerObject,l=a.id),i._descriptionContainerObject&&(f=i._descriptionContainerObject,c=f.id),f?f.parentNode||document.body.appendChild(f):(f=document.createElement("div"),f.className="captionator-cue-descriptive-container",c=o.generateID(),f.id=c,i._descriptionContainerObject=f,f.setAttribute("aria-live","polite"),f.setAttribute("aria-atomic","true"),f.setAttribute("role","region"),document.body.appendChild(f),o.applyStyles(f,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"}));if(!a){a=document.createElement("div"),a.className="captionator-cue-canvas",l=o.generateID(),a.id=l;if(h.appendCueCanvasTo){var p=null;if(h.appendCueCanvasTo instanceof HTMLElement)p=h.appendCueCanvasTo;else if(typeof h.appendCueCanvasTo=="string")try{var d=document.querySelectorAll(h.appendCueCanvasTo);if(!(d.length>0))throw null;p=d[0]}catch(v){p=document.body,h.appendCueCanvasTo=!1}else p=document.body,h.appendCueCanvasTo=!1;p.appendChild(a)}else document.body.appendChild(a);i._containerObject=a}else a.parentNode||document.body.appendChild(a);var m=o.getNodeMetrics(i);s=m.height*(n/100)/96*72,s=s>=e?s:e,u=Math.floor(s*r),u=u>t?u:t,o.applyStyles(a,{position:"absolute",overflow:"hidden",zIndex:100,height:m.height-m.controlHeight+"px",width:m.width+"px",top:(h.appendCueCanvasTo?0:m.top)+"px",left:(h.appendCueCanvasTo?0:m.left)+"px",color:"white",fontFamily:"Verdana, Helvetica, Arial, sans-serif",fontSize:s+"pt",lineHeight:u+"pt",boxSizing:"border-box"})},o.createDOMException=function(e,t,n){try{document.querySelectorAll("div/[]")}catch(r){var i=function(t,n,r){this.code=t,this.message=n,this.name=r};return i.prototype=r,new i(e,t,n)}},o.compareArray=function(t,n){if(t instanceof Array&&n instanceof Array){if(t.length!==n.length)return!1;for(var r in t)if(t.hasOwnProperty(r)&&t[r]!==n[r])return!1;return!0}return!1},o.generateID=function(e){var t="";e=e?e:10;while(t.length<e)t+=String.fromCharCode(65+Math.floor(Math.random()*26));return"captionator"+t}})()
;
/* SOURCE FILE: b64.js (c752b311) 9/9/2014 2:09:05 PM */

; (function (exports) {
'use strict';
var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
var Arr = (typeof Uint8Array !== 'undefined')
? Uint8Array
: Array
var PLUS = '+'.charCodeAt(0)
var SLASH = '/'.charCodeAt(0)
var NUMBER = '0'.charCodeAt(0)
var LOWER = 'a'.charCodeAt(0)
var UPPER = 'A'.charCodeAt(0)
function decode(elt) {
var code = elt.charCodeAt(0)
if (code === PLUS)
return 62
if (code === SLASH)
return 63
if (code < NUMBER)
return -1
if (code < NUMBER + 10)
return code - NUMBER + 26 + 26
if (code < UPPER + 26)
return code - UPPER
if (code < LOWER + 26)
return code - LOWER + 26
}
function b64ToByteArray(b64) {
var i, j, l, tmp, placeHolders, arr
if (b64.length % 4 > 0) {
throw new Error('Invalid string. Length must be a multiple of 4')
}
var len = b64.length
placeHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0
arr = new Arr(b64.length * 3 / 4 - placeHolders)
l = placeHolders > 0 ? b64.length - 4 : b64.length
var L = 0
function push(v) {
arr[L++] = v
}
for (i = 0, j = 0; i < l; i += 4, j += 3) {
tmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))
push((tmp & 0xFF0000) >> 16)
push((tmp & 0xFF00) >> 8)
push(tmp & 0xFF)
}
if (placeHolders === 2) {
tmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)
push(tmp & 0xFF)
} else if (placeHolders === 1) {
tmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)
push((tmp >> 8) & 0xFF)
push(tmp & 0xFF)
}
return arr
}
function uint8ToBase64(uint8) {
var i,
extraBytes = uint8.length % 3,
output = "",
temp, length
function encode(num) {
return lookup.charAt(num)
}
function tripletToBase64(num) {
return encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)
}
for (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {
temp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])
output += tripletToBase64(temp)
}
switch (extraBytes) {
case 1:
temp = uint8[uint8.length - 1]
output += encode(temp >> 2)
output += encode((temp << 4) & 0x3F)
output += '=='
break
case 2:
temp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])
output += encode(temp >> 10)
output += encode((temp >> 4) & 0x3F)
output += encode((temp << 2) & 0x3F)
output += '='
break
}
return output
}
exports.toByteArray = b64ToByteArray
exports.fromByteArray = uint8ToBase64
}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))
;
/* SOURCE FILE: webaudio.js (a6dede23) 9/9/2014 2:09:05 PM */

(function (window) {
"use strict";
var defaultOptions = {
recording: true,
recordingSources: false,
processing: true
},
_missingApis,
_error,
_options,
_requirements = [],
_polyfills = {},
_ready;
function normalize(name) {
var prefixes = ['webkit', 'moz', 'ms'],
obj;
if (!name) {
obj = window;
} else {
obj = name.split('.').reduce(function (current, next) {
if (!current) {
return undefined;
}
var name = next.charAt(0).toUpperCase() + next.substr(1),
ret = current[next], i;
if (!ret) {
for (i = 0; i < prefixes.length && !ret; ++i) {
if (ret = current[prefixes[i] + name])
break;
}
current[next] = ret
}
return ret;
}, window);
}
return {
supported: !!obj,
api: name,
obj: obj
};
}
function addRequirement(api, required) {
var polyfills, requirement;
if (typeof required !== 'boolean') {
required = true;
}
polyfills = _polyfills[api] || [];
requirement = normalize(api);
polyfills = polyfills.filter(function (polyfill) {
return !requirement.supported || !!polyfill.fixesApi;
});
if (polyfills.length > 0) {
var tokens = api.split('.'),
ownerName = tokens.slice(0, tokens.length - 1).join('.'),
owner = normalize(ownerName);
if (owner.supported) {
var name = tokens[tokens.length - 1],
i, polyfillInfo;
for (i = 0; i < polyfills.length; ++i) {
polyfillInfo = polyfills[i];
if (polyfillInfo.isSupported(normalize, requirement.obj)) {
var polyfill = polyfillInfo.bindToSelf ? polyfillInfo.polyfill.bind(polyfillInfo) : polyfillInfo.polyfill;
owner.obj[name] = polyfill;
break;
}
}
requirement = normalize(api);
}
}
requirement.required = required;
_requirements[_requirements.length] = requirement;
}
var webAudio = {
init: function (settings) {
if (_ready) {
return;
}
_ready = true;
try
{
_options = defaultOptions;
addRequirement('Worker');
addRequirement('AudioContext');
addRequirement('AudioContext.prototype.decodeAudioData');
addRequirement('OfflineAudioContext', _options.processing || _options.recording);
addRequirement('AudioContext.prototype.createBiquadFilter', _options.recording);
addRequirement('AudioContext.prototype.createScriptProcessor', _options.recording);
addRequirement('Blob', _options.recording);
addRequirement('ArrayBuffer', _options.recording);
addRequirement('Float32Array', _options.recording);
addRequirement('Uint8Array', _options.recording);
addRequirement('navigator.getUserMedia', _options.recording);
addRequirement('navigator.getMediaDevices', _options.recording && _options.recordingSources);
addRequirement('AudioContext.prototype.createVolumeAnalyser', false);
addRequirement('AudioContext.prototype.createVoiceActivityDetector', _options.recording);
}
catch (error)
{
console.error(error.message, error.stack);
_error = error;
_ready = false;
}
_missingApis = _requirements.filter(function (r) {
return r.required && !r.supported;
}).map(function (r) {
return r.api;
}).sort();
_ready = _ready && _missingApis.length === 0;
if (!_ready) {
return;
}
this.context = new AudioContext();
if (webAudio.encoding) {
webAudio.encoding.init(settings.workerFactory, settings.encodingWorkerUrl);
}
},
isReady: function () {
return !!_ready;
},
getStatus: function (endl) {
if (this.isReady()) {
return 'ready';
}
endl = endl || '\n';
if (_missingApis.length > 0) {
return ['not supported: missing apis'].concat(_missingApis).join(endl);
} else if (_error) {
return 'not supported: ' + _error.message + endl + _error.stack.replace(/\n/g, endl);
} else {
return 'not supported: unkown error';
}
},
addPolyfill: function (api, polyfill) {
var polyfills = _polyfills[api];
if (!polyfills) {
polyfills = [];
_polyfills[api] = polyfills;
}
polyfills[polyfills.length] = polyfill;
}
};
window.webAudio = webAudio;
})(window);

/* SOURCE FILE: webaudio.resampler.js (74d2ed6a) 9/9/2014 2:09:05 PM */

(function (window, webAudio) {
'use strict';
function resample(channelData, sampleRate, encodeRate, numberOfChannels, callback) {
if (sampleRate === encodeRate) {
callback(channelData);
return;
}
var length = channelData[0].length * (encodeRate / sampleRate),
buffer, input, channel, context;
context = new OfflineAudioContext(numberOfChannels, length, sampleRate);
buffer = context.createBuffer(numberOfChannels, length, sampleRate);
for (channel = 0; channel < numberOfChannels; ++channel) {
buffer.getChannelData(channel).set(channelData[channel], 0);
}
input = context.createBufferSource();
input.buffer = buffer;
input.connect(context.destination);
context.oncomplete = function (event) {
var channelData = [],
channel;
for (channel = 0; channel < numberOfChannels; ++channel) {
channelData[channel] = new Float32Array(event.renderedBuffer.getChannelData(channel));
}
callback(channelData);
};
input.start(context.currentTime);
context.startRendering();
}
webAudio.Resampler = {
resample: resample
};
})(window, webAudio);

/* SOURCE FILE: webaudio.player.js (a2b0956d) 9/9/2014 2:09:05 PM */

(function (window, webAudio) {
"use strict";
function Player(continuousPlay) {
this.playlist = new webAudio.Playlist();
this.context = webAudio.context;
this.pauseInfo = {
lastStartTime: null,
elapsedTime: 0,
track: null
};
this.playing = false;
this.hasStarted = false;
this._continuousPlay = !!continuousPlay;
}
Player.prototype.handleEvent = function (event) {
var handler = this['on' + event.type];
if (typeof handler === 'function') {
return handler.call(this, event);
}
};
Player.prototype.getCurrentTrack = function () {
return this.playlist.getCurrentTrack();
};
Player.prototype.play = function () {
if (this.playing) {
return;
}
this.changeTrack(this.getCurrentTrack(), false);
this.playing = true;
this._input.start(this.context.currentTime, this.pauseInfo.elapsedTime);
this.pauseInfo.lastStartTime = this.context.currentTime;
};
Player.prototype._stopInput = function () {
if (this._input) {
this._input.onended = null;
this._input.stop();
this._input.disconnect();
this._input = null;
}
};
Player.prototype.pause = function () {
this._stopInput();
this.pauseInfo.elapsedTime += this.context.currentTime - this.pauseInfo.lastStartTime;
this.playing = false;
};
Player.prototype.stop = function () {
this._stopInput();
this.pauseInfo.elapsedTime = 0;
this.playing = false;
};
Player.prototype.seek = function (time) {
};
Player.prototype.volume = function (volume) {
};
Player.prototype.createInput = function (buffer) {
this._input = this.context.createBufferSource();
this._input.connect(this.context.destination);
this._input.buffer = buffer;
};
Player.prototype.changeTrack = function (track, autoPlay) {
var wasPlaying = this.playing,
self = this,
onended, buffer;
if (typeof track === 'number') {
track = this.playlist.getTrack(track);
}
if (track === null) {
return;
}
this.playlist.setTrack(track);
buffer = track.toAudioBuffer(this.context);
if (typeof autoPlay !== 'boolean') {
autoPlay = true;
}
if (wasPlaying && this.pauseInfo.elapsedTime === 0) {
this.stop();
}
this.createInput(buffer);
this._input.onended = function (e) {
if (typeof self.ontrackend === 'function') {
self.ontrackend(track);
}
self.stop();
self.advanceTrack();
};
if (autoPlay) {
this.play();
}
};
Player.prototype.advanceTrack = function () {
var track = this.playlist.advanceTrack();
if (track === null) {
if (typeof this.onplaylistend === 'function') {
this.onplaylistend();
}
} else if (this._continuousPlay) {
this.changeTrack(track);
}
};
Player.prototype.ontrackend = null;
Player.prototype.onplaylistend = null;
webAudio.Player = Player;
})(window, webAudio);

/* SOURCE FILE: webaudio.playlist.js (81dbd3f5) 9/9/2014 2:09:05 PM */

(function (window, webAudio) {
"use strict";
function Playlist() {
this._playlist = [];
this._nextId = 0;
this._currentIndex = -1;
}
Playlist.prototype.addTracks = function () {
var tracks = Array.prototype.slice.call(arguments),
i, id, track, name, duration;
for (i = 0; i < tracks.length; ++i) {
track = tracks[i];
id = this._nextId++;
track.id = id;
track.name = track.name || ('Track ' + (id + 1));
this._playlist.push(track);
}
if (this._currentIndex < 0 && this._playlist.length > 0) {
this._currentIndex = 0;
}
};
Playlist.prototype.setTrack = function (track) {
if (!this.getTrack(track.id)) {
this.addTracks(track);
}
var i;
for (i = 0; i < this._playlist.length; ++i) {
if (track === this._playlist[i]) {
this._currentIndex = i;
break;
}
}
};
Playlist.prototype.removeTracks = function () {
var ids = Array.prototype.slice.call(arguments),
i, track;
for (i = 0; i < this._playlist.length; ++i) {
track = this._playlist[i];
if (ids.indexOf(track.id) !== -1) {
this._playlist.splice(i, 1);
if (this._currentIndex > i) {
--this._currentIndex;
}
--i;
}
}
if (this._playlist.length === 0) {
this._currentIndex = -1;
}
};
Playlist.prototype.removeAllTracks = function () {
var ids = this._playlist.map(function (track) {
return track.id;
});
this.removeTracks.apply(this, ids);
};
Playlist.prototype.getTrack = function (id) {
var matches = this._playlist.filter(function (track) {
return track.id === id;
});
return matches.length ? matches[0] : null;
};
Playlist.prototype.getCurrentTrack = function () {
if (this._currentIndex < 0) {
return null;
}
return this._playlist.length ? this._playlist[this._currentIndex] : null;
};
Playlist.prototype.advanceTrack = function () {
if (this._currentIndex < 0) {
return null;
}
if (this._currentIndex === this._playlist.length - 1) {
if (this.loop) {
this._currentIndex = 0;
} else {
return null;
}
} else {
++this._currentIndex;
}
return this.getCurrentTrack();
};
webAudio.Playlist = Playlist;
})(window, window.webAudio);

/* SOURCE FILE: webaudio.track.js (9efb2fa7) 9/9/2014 2:09:05 PM */

(function (window, webAudio) {
"use strict";
function Track(audioBuffer) {
this.audioBuffer = audioBuffer;
Object.defineProperties(this, {
audioBuffer: { value: audioBuffer, writeable: false, enumerable: true, configurable: false },
sampleRate: {
enumerable: true, configurable: false,
get: function () {
return this.audioBuffer.sampleRate;
}
}
});
};
Track.fromPCM = function (channelData, sampleRate, context) {
var numberOfChannels = channelData.length,
audioBuffer = context.createBuffer(numberOfChannels, channelData[0].length, sampleRate),
channel;
for (channel = 0; channel < numberOfChannels; ++channel) {
audioBuffer.getChannelData(channel).set(channelData[channel], 0);
}
return new Track(audioBuffer);
};
Track.prototype.toPCM = function () {
var numberOfChannels = this.audioBuffer.numberOfChannels,
channelData = [],
currentChannel, channel;
for (channel = 0; channel < numberOfChannels; ++channel) {
currentChannel = this.audioBuffer.getChannelData(channel);
channelData[channel] = new Float32Array(currentChannel.length);
channelData[channel].set(currentChannel, 0);
}
return {
channelData: channelData,
sampleRate: this.audioBuffer.sampleRate
};
};
Track.prototype.toAudioBuffer = function (context) {
return this.audioBuffer;
};
Track.fromArrayBuffer = function (buffer, context, format, callback, errorCallback) {
var success, failure;
success = function (audioBuffer) {
var track = new Track(audioBuffer);
callback(track);
};
failure = function () {
webAudio.encoding.decode(buffer, format, function (track) {
callback(track);
}, function (error) {
if (errorCallback) {
errorCallback(error);
}
});
};
context.decodeAudioData(buffer, success, failure);
};
Track.fromBlob = function (blob, context, callback) {
var reader = new FileReader();
reader.addEventListener('loadend', function () {
Track.fromArrayBuffer(reader.result, context, null, callback);
});
reader.readAsArrayBuffer(blob);
};
webAudio.Track = Track;
})(window, webAudio);

/* SOURCE FILE: webaudio.recorder.js (fbed7ccb) 10/26/2014 1:27:06 PM */

(function (window, webAudio) {
"use strict";
function Recorder(options) {
this._options = options || {};
this._initialized = false;
this._context = webAudio.context;
this._input = null;
this._inputMediaStream = null;
this._active = false;
this._channelBuffers = [];
this._bufferCount = 0;
this.encoder = null;
this._isRecording = false;
this._initOptions();
}
Recorder.prototype.handleEvent = function (event) {
var handler = this['on' + event.type];
if (typeof handler === 'function') {
return handler.call(this, event);
}
};
var defaultOptions = {
bufferSize: 16384
};
Recorder.prototype._initOptions = function () {
this._options.bufferSize = this._options.bufferSize || defaultOptions.bufferSize;
this.setSource(this._options.source);
};
Recorder.prototype.setSource = function (source) {
this._options.source = source instanceof webAudio.RecorderSource ? source : new webAudio.RecorderSource();
this._initialized = false;
this._inputMediaStream && this._inputMediaStream.stop && this._inputMediaStream.stop();
this._input && this._input.disconnect();
};
Recorder.prototype.setSourceDevice = function (device) {
this.setSource(new webAudio.RecorderSource(device));
};
Recorder.prototype.startRecording = function (callback, errorCallback, mediaDeviceErrorCallback) {
try {
if (!this._initialized) {
this.initiateRecording(callback, mediaDeviceErrorCallback);
return;
}
if (this._active) {
return;
}
this.filter = this._context.createBiquadFilter();
this.filter.type = 'lowpass';
this.filter.frequency.value = 4000;
this.filter.channelCount = 1;
this._vadNode = this._context.createVoiceActivityDetector();
this._input.connect(this.filter);
this._input.connect(this._vadNode.head);
this._active = true;
this._initiateStreamingEncoder(this._options.streamingEncoderFormat);
this._isRecording = true;
if (typeof callback === 'function') {
callback();
}
} catch (error) {
errorCallback(error.stack || error.message || error.toString());
}
};
Recorder.prototype._initiateStreamingEncoder = function (format) {
this.encoder = webAudio.encoding.createEncoder(this._options.streamingEncoderFormat);
var self = this;
this.encoder.onencodingcomplete = function (buffer) {
self._oncomplete(buffer);
};
this.encoder.onencodingerror = function (error) {
self._onerror(error);
};
this.encoder.start(this.filter);
};
Recorder.prototype.initiateRecording = function (callback, errorCallback) {
var self = this;
this._options.source.getStreamContainer(function (streamContainer) {
self._inputMediaStream = streamContainer.stream;
self._input = streamContainer.streamSourceNode;
self._inputMediaStream.enabled = false;
self._initialized = true;
self.startRecording(callback);
}, errorCallback);
};
Recorder.prototype.stopRecording = function () {
this._active = false;
this._vadNode.disconnect();
if (typeof this.onbeforestop === 'function') {
this.onbeforestop();
}
this.encoder.stop();
this.encoder = null;
this._isRecording = false;
};
Recorder.prototype.getQuality = function () {
return (this._vadNode && this._vadNode.getQuality()) || null;
};
Recorder.prototype.isRecording = function () {
return this._isRecording;
};
Recorder.prototype.onbeforestop = function () {
};
Recorder.prototype._oncomplete = function (buffer) {
this._input.disconnect();
if (typeof this.oncomplete === 'function') {
this.oncomplete(buffer);
}
};
Recorder.prototype.oncomplete = function () {
};
Recorder.prototype._onerror = function (error) {
this._input.disconnect();
this._vadNode.disconnect();
if (typeof this.onerror === 'function') {
this.onerror(error);
}
};
Recorder.prototype.onerror = function () {
};
webAudio.addPolyfill('AudioContext.prototype.createScriptProcessor', {
fixesApi: false,
bindToSelf: false,
isSupported: function (normalize) {
var normalized = normalize('AudioContext.prototype.createJavaScriptNode');
this.polyfill = normalized.obj;
return normalized.supported;
}
});
webAudio.Recorder = Recorder;
})(window, webAudio);

/* SOURCE FILE: webaudio.recorder.polyfills.chrome.js (df9350fc) 9/9/2014 2:09:05 PM */

(function (window, webAudio) {
'use strict';
webAudio.addPolyfill('navigator.getUserMedia', {
fixesApi: true,
bindToSelf: true,
isSupported: function (normalize, native) {
if (normalize('MediaStreamTrack.getSources').supported) {
this.getUserMedia = native;
return true;
}
return false;
},
polyfill: function (constraints, successCallback, errorCallback) {
if (typeof constraints.audio === 'object' && constraints.audio.sourceId) {
constraints.audio.optional = constraints.audio.optional || [];
constraints.audio.optional.push({ sourceId: constraints.audio.sourceId });
delete constraints.audio.sourceId;
}
this.getUserMedia.call(navigator, constraints, successCallback, errorCallback);
}
});
webAudio.addPolyfill('navigator.getMediaDevices', {
fixesApi: false,
bindToSelf: false,
isSupported: function (normalize) {
return normalize('MediaStreamTrack.getSources').supported;
},
polyfill: function (callback) {
window.MediaStreamTrack.getSources(function (devices) {
devices = devices.map(function (d) {
return {
deviceId: d.id,
kind: d.kind + 'input',
label: d.label,
groupId: null
};
});
callback(devices);
});
}
});
})(window, webAudio);

/* SOURCE FILE: webaudio.recorder.polyfills.securebrowser.js (37aa67cc) 10/26/2014 1:27:06 PM */

(function (window, webAudio) {
var devicesAvailable = false,
deviceCache,
requestsForDevice = [];
window.AIRAudioRecorder = {
audioDevicesAvailable: function () {
devicesAvailable = true;
deviceCache = SecureBrowser.audioDevices.slice();
if (requestsForDevice.length) {
var request = requestsForDevice.shift();
grantPermissionForDevice(request.constraints, request.device);
}
}
};
function getDeviceList() {
var deviceList = SecureBrowser.audioDevices.length ? SecureBrowser.audioDevices :
deviceCache && deviceCache.length ? deviceCache :
[];
return deviceList;
}
function grantPermissionForDevice(constraints, device) {
if (!device) {
var kind = constraints.video ? 'video' : 'audio';
var devices = getDeviceList().filter(function (device) {
return device.type === kind;
});
var preferredDevices = devices.map(function (device) {
var match = device.name.match(/(default|usb)/i);
return {
match: match,
device: device
};
}).filter(function (obj) {
return !!obj.match;
}).sort(function (obj1, obj2) {
if (obj1.match[1] === obj2.match[1]) {
return 0;
} else if (obj1.match[1].toLowerCase() === 'default') {
return -1;
} else if (obj2.match[1].toLowerCase() === 'default') {
return 1;
}
throw new Error('invalid matched value in device name');
}).map(function (obj) {
return obj.device;
});
device = preferredDevices.length ? preferredDevices[0] : devices[0];
}
SecureBrowser.selectAudioDevice(device);
}
function checkForAudioDevices(callback, timeout) {
if (!devicesAvailable) {
setTimeout(checkForAudioDevices.bind(null, callback, timeout), timeout);
return;
}
var devices = getDeviceList().map(function (d) {
return {
deviceId: d.id,
kind: d.type + 'input',
label: d.name,
groupId: null
};
});
callback(devices);
}
webAudio.addPolyfill('navigator.getUserMedia', {
fixesApi: true,
bindToSelf: true,
isSupported: function (normalize, native) {
if (typeof SecureBrowser !== 'undefined' && SecureBrowser.audioDevices && SecureBrowser.selectAudioDevice) {
this.getUserMedia = native;
return true;
}
return false;
},
polyfill: function (constraints, successCallback, errorCallback) {
var device = null;
if (constraints.audio && constraints.audio.sourceId) {
device = getDeviceList().filter(function (device) {
return device.id === constraints.audio.sourceId;
})[0];
if (!device) {
console.warn('unknown device requested, deviceId: "' + constraints.audio.sourceId + '"');
}
delete constraints.audio.sourceId;
}
requestsForDevice.push({
constraints: constraints,
device: device
});
this.getUserMedia.call(navigator, constraints, successCallback, errorCallback);
}
});
webAudio.addPolyfill('navigator.getMediaDevices', {
fixesApi: false,
bindToSelf: false,
isSupported: function (normalize) {
if (typeof SecureBrowser !== 'undefined' && SecureBrowser.audioDevices) {
return true;
}
return false;
},
polyfill: function (callback) {
window.navigator.getUserMedia({ audio: true }, function (stream) {
stream.stop();
}, function (error) {
console.error('error enumerating devices for navigator.getUserMedia: ', error);
devicesAvailable = true;
deviceCache = [];
});
checkForAudioDevices(callback, 1000);
}
});
})(window, webAudio);

/* SOURCE FILE: webaudio.recorder.source.js (f70286bf) 10/26/2014 1:27:06 PM */

(function (window, webAudio) {
'use strict';
function StreamContainer(stream) {
this.stream = stream;
this.streamSourceNode = webAudio.context.createMediaStreamSource(stream);
}
function RecorderSource(device) {
device = device || {
deviceId: null,
label: ''
};
this.deviceId = device.deviceId;
this.label = device.label;
this._streamContainer = null;
}
RecorderSource.prototype.getStreamContainer = function (successCallback, errorCallback) {
var constraints = {
audio: {
}
};
if (this.deviceId !== null) {
constraints.audio.sourceId = this.deviceId;
}
var self = this;
window.navigator.getUserMedia(constraints, function (stream) {
self._streamContainer = new StreamContainer(stream);
successCallback(self._streamContainer);
}, function (error) {
if (typeof error !== 'string') {
error = error.name;
}
if (typeof error !== 'string') {
error = 'Unkown error';
}
errorCallback(error);
});
};
RecorderSource.getAudioSources = function (callback) {
if (typeof window.navigator.getMediaDevices !== 'function') {
console.warn('device enumeration is not supported on this browser');
callback([ new RecorderSource() ]);
return;
}
window.navigator.getMediaDevices(function (devices) {
var recorderSources, i = 0;
recorderSources = devices.filter(function (d) {
return d.kind === 'audioinput';
}).map(function (d) {
if (!d.label) {
d.label = 'audioinput' + (i++);
}
return new RecorderSource(d);
});
callback(recorderSources);
});
}
webAudio.RecorderSource = RecorderSource;
})(window, webAudio);

/* SOURCE FILE: webaudio.encoding.js (a028e6c3) 9/9/2014 2:09:05 PM */

(function (window, webAudio) {
"use strict";
var containerFormats = {
wav: {
name: 'wav',
extension: 'wav',
type: 'audio/wav',
format: 'int16'
},
opus: {
name: 'opus',
extension: 'ogg',
type: 'audio/ogg; codecs="opus"',
format: 'int16'
}
};
var encodingWorker,
nextId = 0,
callbacks = {};
function encode(track, encoder, options, complete, error, progress) {
var id = nextId++;
if (typeof options === 'function') {
progress = error;
error = complete;
complete = options;
options = {};
}
callbacks[id] = {
complete: complete,
encoder: encoder,
error: error,
progress: progress
};
var pcm = track.toPCM();
var transferrable = pcm.channelData.map(function (typed) {
return typed.buffer;
});
encodingWorker.postMessage({ command: 'encode', encoderName: encoder.name, track: pcm, options: options, id: id }, transferrable);
}
function createEncoder(format) {
var id = nextId++;
var encoder = new webAudio.Encoder(id, format, {
start: startEncoding,
append: appendData,
end: endEncoding
});
callbacks[id] = encoder;
return encoder;
}
function startEncoding(id, sampleRate, numberOfChannels) {
var encoder = callbacks[id];
encodingWorker.postMessage({
command: 'start',
encoderName: encoder.format.name,
format: encoder.format.format,
id: id,
sampleRate: sampleRate,
numberOfChannels: numberOfChannels
});
}
function appendData(id, channelData) {
var encoder = callbacks[id];
var buffers = channelData.map(function (typedArray) {
return typedArray.buffer;
});
encodingWorker.postMessage({
command: 'append',
encoderName: encoder.format.name,
id: id,
channelData: channelData
}, buffers);
}
function endEncoding(id) {
var encoder = callbacks[id];
encodingWorker.postMessage({
command: 'end',
encoderName: encoder.format.name,
id: id
});
}
function decode(buffer, encoding, options, complete, error, progress) {
var id = nextId++;
if (typeof options === 'function') {
progress = error;
error = complete;
complete = options;
options = {};
}
callbacks[id] = {
complete: complete,
encoder: encoding,
error: error,
progress: progress
};
encodingWorker.postMessage({ command: 'decode', encoderName: encoding.name, track: buffer, options: options, id: id }, [buffer]);
}
function init(workerFactory, workerUrl) {
encodingWorker = workerFactory.create(workerUrl);
encodingWorker.addEventListener('message', function (event) {
switch (event.data.command) {
case 'log':
console.log(event.data.message);
break;
case 'encode':
case 'end':
switch (event.data.status) {
case 'complete':
encodingComplete(event.data.result, event.data.id, event.data.time);
break;
case 'error':
encodingError(event.data.error, event.data.id);
break;
}
break;
case 'decode':
switch (event.data.status) {
case 'complete':
decodingComplete(event.data.result, event.data.id, event.data.time);
break;
case 'error':
decodingError(event.data.error, event.data.id);
break;
}
break;
case 'resamplerequest':
var channelData = event.data.channelData,
sampleRate = event.data.sampleRate,
encodeRate = event.data.encodeRate,
numberOfChannels = event.data.numberOfChannels;
webAudio.Resampler.resample(channelData, sampleRate, encodeRate, numberOfChannels, function (channelData) {
var transferrables = channelData.map(function (typedArray) {
return typedArray.buffer;
});
encodingWorker.postMessage({ command: 'resampleresult', id: event.data.id, channelData: channelData }, transferrables);
});
break;
}
});
encodingWorker.addEventListener('error', function (event) {
console.log('encodingWorker error: ', event);
});
}
function encodingComplete(buffer, id, time) {
var callbackInfo;
callbackInfo = callbacks[id];
if (callbackInfo instanceof webAudio.Encoder) {
callbackInfo._notify(buffer);
} else {
callbackInfo.complete(buffer, callbackInfo.encoder);
delete callbacks[id];
}
}
function encodingError(error, id) {
var callbackInfo = callbacks[id];
delete callbacks[id];
if (callbackInfo instanceof webAudio.Encoder) {
callbackInfo._notify(error);
} else if (typeof callbackInfo.error === 'function') {
callbackInfo.error(error);
} else {
console.error(error);
}
}
function decodingComplete(track, id, time) {
var callbackInfo,
track = new webAudio.Track.fromPCM(track.channelData, track.sampleRate, webAudio.context);
callbackInfo = callbacks[id];
delete callbacks[id];
callbackInfo.complete(track, callbackInfo.encoder);
}
function decodingError(error, id) {
var callbackInfo = callbacks[id];
delete callbacks[id];
if (typeof callbackInfo.error === 'function') {
callbackInfo.error(error);
} else {
console.error(error);
}
}
function saveAs(filename) {
return function (buffer, format) {
var blob = new Blob([buffer], { type: format.type }),
url = (window.URL || window.webkitURL).createObjectURL(blob),
link = window.document.createElement('a'),
click = document.createEvent("MouseEvents");
link.href = url;
link.download = filename + '.' + format.extension;
click.initMouseEvent("click", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
link.dispatchEvent(click);
};
}
webAudio.encoding = {
encode: encode,
createEncoder: createEncoder,
decode: decode,
saveAs: saveAs,
format: containerFormats,
init: init
};
})(window, webAudio);

/* SOURCE FILE: webaudio.encoder.js (09bf7eb5) 9/9/2014 2:09:05 PM */

(function (webAudio) {
'use strict';
function Encoder(id, format, worker) {
this._worker = worker;
this.format = format;
this.id = id;
this._processor = null;
this._disconnected = true;
this._channelCount = null;
this._sampleRate = null;
this._durationOfSilenceToAppend = null;
}
Encoder.prototype.start = function (audioNode) {
this._disconnected = false;
this._channelCount = audioNode.channelCount;
this._sampleRate = audioNode.context.sampleRate;
this._worker.start(this.id, this._sampleRate, this._channelCount);
this._processor = audioNode.context.createScriptProcessor(16384, this._channelCount, 1);
var self = this;
this._processor.onaudioprocess = function (e) {
var input = e.inputBuffer;
var channelData = [],
channel, buffer;
for (channel = 0; channel < e.inputBuffer.numberOfChannels; ++channel) {
channelData[channel] = new Float32Array(e.inputBuffer.getChannelData(channel));
}
self._append(channelData);
if (self._disconnected) {
self._end();
self._processor.disconnect();
audioNode.disconnect();
}
};
audioNode.connect(this._processor);
this._processor.connect(audioNode.context.destination);
};
Encoder.prototype.appendSilence = function (duration) {
this._durationOfSilenceToAppend = duration;
};
Encoder.prototype._appendSilence = function () {
var duration = this._durationOfSilenceToAppend,
channelData = [],
samples = duration * this._sampleRate,
i;
for (i = 0; i < this._channelCount; ++i) {
channelData[channelData.length] = new Float32Array(samples);
}
this._append(channelData);
};
Encoder.prototype._append = function (channelData) {
this._worker.append(this.id, channelData);
};
Encoder.prototype._end = function () {
if (this._durationOfSilenceToAppend !== null) {
this._appendSilence();
}
this._worker.end(this.id);
};
Encoder.prototype.stop = function () {
this._disconnected = true;
};
Encoder.prototype._notify = function (buffer) {
if (buffer instanceof ArrayBuffer) {
this.onencodingcomplete(buffer, this.format);
} else {
this.onencodingerror(buffer);
}
};
Encoder.prototype.onencodingcomplete = function (buffer, format) {
};
Encoder.prototype.onencodingerror = function (error) {
};
webAudio.Encoder = Encoder;
})(webAudio);

/* SOURCE FILE: webaudio.sampledeque.js (2b3ce056) 9/9/2014 2:09:05 PM */

(function (exports) {
'use strict';
function SampleDeque(numberOfChannels, TypedArrayConstructor) {
this.numberOfChannels = numberOfChannels;
this.length = 0;
this.TypedArray = TypedArrayConstructor;
this._queue = [];
}
SampleDeque.prototype.enqueue = function (samples) {
this._queue.push(samples);
this.length += samples.length / this.numberOfChannels;
};
SampleDeque.prototype.tryDequeue = function (numberOfSamples, usePadding) {
if (typeof usePadding !== 'boolean') {
usePadding = false;
}
if (this.length <= 0 || (numberOfSamples > this.length && !usePadding)) {
return false;
}
var TypedArray = this.TypedArray,
sampleTotal = numberOfSamples * this.numberOfChannels,
lengthTotal = this.length * this.numberOfChannels,
samples = new TypedArray(sampleTotal),
count = 0,
length,
current,
n, segment;
do {
n = sampleTotal - count;
current = this._queue[0];
length = current.length;
if (length <= n) {
segment = current;
this._queue.shift();
} else                     {
segment = current.subarray(0, n);
this._queue[0] = current.subarray(n);
}
samples.set(segment, count);
lengthTotal -= segment.length;
count += segment.length;
} while (count < sampleTotal && lengthTotal > 0);
this.length = lengthTotal / this.numberOfChannels;
return samples;
};
exports.SampleDeque = SampleDeque;
})(typeof window !== 'undefined' ? window : self);

/* SOURCE FILE: volumeAnalyserNode.js (4e6fd0c7) 9/9/2014 2:09:05 PM */

(function (window, webAudio) {
'use strict';
function VolumeAnalyserNode(context) {
var analyser = context.createAnalyser(),
scriptProcessor = context.createScriptProcessor(2048, 1, 1),
frequencyData;
analyser.channelCount = 1;
analyser.smoothingTimeConstant = 0.60;
analyser.fftSize = 512;
frequencyData = new Uint8Array(analyser.frequencyBinCount);
var self = this,
max = Math.sqrt(255) * Math.LN2;
scriptProcessor.onaudioprocess = function () {
var length = frequencyData.length,
i = length,
volumeSum = 0,
volumeAverage;
analyser.getByteFrequencyData(frequencyData);
for (; i--;) {
volumeSum += frequencyData[i];
}
volumeAverage = Math.sqrt(volumeSum / length) * Math.LN2 / max;
if (typeof self.onvolumeprocess === 'function' && self.onvolumeprocess !== VolumeAnalyserNode.prototype.onvolumeprocess) {
self.onvolumeprocess(volumeAverage);
}
self.volume = volumeAverage;
};
this._analyser = analyser;
this._scriptProcessor = scriptProcessor;
Object.defineProperties(this, {
context: { value: context, writeable: false, enumerable: true, configurable: false },
numberOfInputs: { value: 1, writeable: false, enumerable: true, configurable: false },
numberOfOutputs: { value: 0, writeable: false, enumerable: true, configurable: false },
head: { value: analyser, writeable: false, enumerable: true, configurable: false },
tail: { value: analyser, writeable: false, enumerable: true, configurable: false }
});
this.connect(null);
this.volume = 0;
}
VolumeAnalyserNode.prototype.onvolumeprocess = function (averageVolume) {
};
VolumeAnalyserNode.prototype.connect = function (next) {
this._analyser.connect(this._scriptProcessor);
this._scriptProcessor.connect(this.context.destination);
};
VolumeAnalyserNode.prototype.disconnect = function () {
this._analyser.disconnect();
this._scriptProcessor.disconnect();
};
webAudio.addPolyfill('AudioContext.prototype.createVolumeAnalyser', {
fixesApi: false,
isSupported: function () {
return true;
},
polyfill: function () {
return new VolumeAnalyserNode(this);
}
});
})(window, webAudio);

/* SOURCE FILE: voiceActivityDetectionNode.js (9cfe0970) 10/26/2014 1:27:06 PM */

(function () {
'use strict';
function getPeakLevel(buffer) {
var max = 0,
i = buffer.length;
for (; i--;) {
var sample = Math.abs(buffer[i]);
if (sample > max) {
max = sample;
}
}
return max;
}
function VoiceActivityDetector(sampleRate) {
this._sampleRate = sampleRate;
this._ended = true;
this.start();
}
VoiceActivityDetector.prototype.processData = function (samples, singleSampleSet) {
if (singleSampleSet) {
this.start();
this.end();
}
this._sampleDeque.enqueue(new Float32Array(samples));
this._processData();
};
VoiceActivityDetector.prototype._processData = function () {
while (true) {
var chunkSamples = this._sampleDeque.tryDequeue(this._samplesPerChunk, this._ended);
if (!chunkSamples) {
break;
}
var peakLevel = getPeakLevel(chunkSamples);
if (this._haveFloor) {
this.chunkCount++;
if (peakLevel > this._noiseFloor) {
this.chunkOverFloorCount++;
}
} else {
this._haveFloor = true;
this._noiseFloor = peakLevel * 2;
}
}
};
VoiceActivityDetector.prototype.getQuality = function () {
this._processData();
if (this.chunkOverFloorCount > 30 || (this.chunkOverFloorCount / this.chunkCount > 0.15)) {
return 'GOOD';
} else {
return 'POOR';
}
};
VoiceActivityDetector.prototype.start = function () {
this._sampleDeque = new SampleDeque(1, Float32Array);
this._haveFloor = false;
this._noiseFloor = 0;
this._samplesPerChunk = this._sampleRate / 2,
this.chunkCount = 0;
this.chunkOverFloorCount = 0;
this._ended = false;
};
VoiceActivityDetector.prototype.end = function () {
this._ended = true;
};
function VoiceActivityDetectionNode(context) {
var downmixer = context.createGain(),
filter = context.createBiquadFilter(),
scriptProcessor = context.createScriptProcessor(1024, 1, 1);
var self = this;
self._detector = new VoiceActivityDetector(context.sampleRate);
downmixer.channelCount = 1;
filter.type = 'bandpass';
filter.frequency.value = 2750;
filter.Q.value = 2;
scriptProcessor.onaudioprocess = function (event) {
var buffer = event.inputBuffer.getChannelData(0);
self._detector.processData(buffer, false);
};
this._downmixer = downmixer;
this._filter = filter;
this._scriptProcessor = scriptProcessor;
Object.defineProperties(this, {
context: { value: context, writeable: false, enumerable: true, configurable: false },
numberOfInputs: { value: 1, writeable: false, enumerable: true, configurable: false },
numberOfOutputs: { value: 0, writeable: false, enumerable: true, configurable: false },
head: { value: downmixer, writeable: false, enumerable: true, configurable: false },
tail: { value: scriptProcessor, writeable: false, enumerable: true, configurable: false }
});
this.connect(null);
this.volume = 0;
}
VoiceActivityDetectionNode.prototype.getQuality = function () {
return this._detector.getQuality();
};
VoiceActivityDetectionNode.prototype.connect = function (next) {
this._downmixer.connect(this._filter);
this._filter.connect(this._scriptProcessor);
this._scriptProcessor.connect(this.context.destination);
this._detector.start();
};
VoiceActivityDetectionNode.prototype.disconnect = function () {
this._scriptProcessor.disconnect();
this._filter.disconnect();
this._downmixer.disconnect();
this._detector.end();
};
['AudioContext.prototype.createVoiceActivityDetector', 'OfflineAudioContext.prototype.createVoiceActivityDetector'].forEach(function (api) {
webAudio.addPolyfill(api, {
fixesApi: false,
isSupported: function () {
return true;
},
polyfill: function () {
return new VoiceActivityDetectionNode(this);
}
});
});
webAudio.VoiceActivityDetector = VoiceActivityDetector;
})();

/* SOURCE FILE: audio.js (706a3056) 9/9/2014 2:08:50 PM */

TDS = window.TDS || {};
TDS.Audio = TDS.Audio || {};
(function(Audio) {
Audio.isActive = function() {
if (Audio.Player && Audio.Player.isPlaying()) {
return true;
}
if (Audio.Recorder && (Audio.Recorder.isCapturing() || Audio.Recorder.isPlaying())) {
return true;
}
return false;
};
Audio.stopAll = function() {
if (Audio.Player && Audio.Player.isPlaying()) {
Audio.Player.stopAll();
}
if (Audio.Recorder) {
if (Audio.Recorder.isCapturing()) {
Audio.Recorder.stopCapture();
}
else if (Audio.Recorder.isPlaying()) {
Audio.Recorder.stopAudio();
}
}
};
})(TDS.Audio);

/* SOURCE FILE: java.js (f4128ba5) 9/9/2014 2:08:50 PM */

TDS = window.TDS || {};
TDS.Audio = TDS.Audio || {};
(function(Audio) {
var appletPath = null;
var initialized = false;
var setupDelay = 1000;
var appletEl = null;
var appletTimer = null;
var appletInterval = 5000;
var processTimer = null;
var processTimeout = 30000;
var processFailed = false;
var socketTimeout = 90;
var playing = false;
var recording = false;
var activeID = null;
var callbacks = {};
var initCallbacks = [];
var loadCallbacks = [];
function isReady() {
return (appletEl != null);
}
function setApplet(applet) {
if (isReady()) return;
if (appletTimer) {
appletTimer.cancel();
}
if (processTimer) {
processTimer.cancel();
}
appletEl = applet;
var timeoutMillis = socketTimeout * 1000;
setTimeout(function() {
applet.setSocketParameters(timeoutMillis, timeoutMillis);
}, 0);
for (var i = 0; i < initCallbacks.length; i++) {
initCallbacks[i]();
}
}
function getAppletFrame() {
return document.getElementById('audioFrame');
}
function getApplet() {
var audioFrame = getAppletFrame();
if (audioFrame) {
var frameDoc = Util.Dom.getFrameContentDocument(audioFrame);
if (frameDoc) {
return frameDoc.getElementById('AIRAudio');
}
}
return null;
}
function injectApplet() {
var appletConfig = {
id: 'AIRAudio',
codebase: appletPath + 'AIRAudio',
code: 'AIRAudio/AudioApplet.class',
archive: 'AIRAudio_Combined.jar',
callback: 'tdsFireAudioEvent'
};
return Util.Frame.injectApplet('audioFrame', appletConfig);
}
function removeApplet() {
var audioFrame = getAppletFrame();
Util.Dom.removeNode(audioFrame);
};
function checkApplet() {
if (isReady()) return;
try {
var applet = getApplet();
if (applet && typeof applet.getCurrentState == 'function') {
if (applet.getCurrentState() == 'READY') {
console.log('AUDIO APPLET POLLING READY');
setApplet(applet);
}
}
} catch(ex) {
console.error(ex);
}
if (!isReady()) {
startAppletTimer();
}
}
function checkProcess() {
if (isReady()) return;
var javaRequired = false;
var javaFound = false;
if (Util.Browser.isWindows() && Util.Browser.isSecure()) {
javaRequired = true;
var processList = Util.SecureBrowser.getProcessList();
if (processList.length > 0) {
for (var i = 0; i < processList.length; i++) {
if (processList[i] == 'java.exe') {
javaFound = true;
break;
}
}
}
}
if (javaRequired && !javaFound) {
processFailed = true;
removeApplet();
injectApplet();
}
};
function startAppletTimer() {
appletTimer = window.YAHOO.lang.later(appletInterval, this, checkApplet);
}
function startProcessTimer() {
processTimer = window.YAHOO.lang.later(processTimeout, this, checkProcess);
}
var Java = {};
Java.Type = {
SOUNDCUE: 'SOUNDCUE',
CONTENTAUDIO: 'CONTENTAUDIO',
STUDENTRECORDING: 'STUDENTRECORDING',
UNKNOWN: 'UNKNOWN'
};
Java.Status = {
INITIALIZING: 'INITIALIZING',
READY: 'READY',
PLAYINPROGRESS: 'PLAYINPROGRESS',
CAPTUREINPROGRESS: 'CAPTUREINPROGRESS',
STOPPINGCAPTURE: 'STOPPINGCAPTURE',
PAUSED: 'PAUSED',
UNDEFINED: 'UNDEFINED'
};
Java.Format = {
SPX: 'SPX',
OGG: 'OGG',
WAVE: 'WAVE'
};
Java.Event = {
INITIALIZED: 'INITIALIZED',
LOAD_START: 'LOAD_START',
LOAD_COMPLETE: 'LOAD_COMPLETE',
LOAD_FAIL: 'LOAD_FAIL',
DECODE_START: 'DECODE_START',
DECODE_COMPLETE: 'DECODE_COMPLETE',
DECODE_FAIL: 'DECODE_FAIL',
RECORDING_START: 'RECORDING_START',
RECORDING_PROGRESS: 'RECORDING_PROGRESS',
RECORDING_STOPPING: 'RECORDING_STOPPING',
RECORDING_DONE: 'RECORDING_DONE',
RECORDING_FAIL: 'RECORDING_FAIL',
PLAYING_START: 'PLAYING_START',
PLAYING_FAIL: 'PLAYING_FAIL',
PLAYING_PROGRESS: 'PLAYING_PROGRESS',
PLAYING_DONE: 'PLAYING_DONE',
PLAYING_STOPPED: 'PLAYING_STOPPED',
PLAYING_PAUSED: 'PLAYING_PAUSED'
};
Java.setAppletPath = function(path) {
appletPath = path;
};
Java.initialize = function(eventListener) {
if (typeof eventListener == 'function') {
initCallbacks.push(eventListener);
}
if (initialized) return false;
appletPath = appletPath || window.javaFolder;
if (typeof appletPath != 'string') {
console.warn('Could not initialize java audio applet. No applet path set.');
return false;
}
YAHOO.lang.later(setupDelay, this, function() {
startAppletTimer();
startProcessTimer();
injectApplet();
});
initialized = true;
return true;
};
Java.isInitialized = function() {
return initialized;
};
Java.isReady = isReady;
Java.dispose = function() {
var audioFrame = document.getElementById('audioFrame');
if (audioFrame == null) return;
YUD.setStyle(audioFrame, 'display', 'none');
if (appletEl && appletEl.parentNode) {
appletEl.parentNode.removeChild(appletEl);
}
};
function processEvent(id, type) {
if (id == null) {
console.warn('AudioApplet: Invalid event audio ID');
return;
}
var data = null;
if (type == Java.Event.RECORDING_PROGRESS) {
data = id;
id = activeID;
} else {
console.log('AudioApplet: processEvent', arguments);
}
var failEvent = (type.indexOf('_FAIL') != -1);
var terminalEvent = (failEvent ||
type == Java.Event.PLAYING_DONE ||
type == Java.Event.PLAYING_STOPPED ||
type == Java.Event.RECORDING_DONE);
var loadListener = loadCallbacks[id];
if (loadListener) {
loadListener(id, type);
if (failEvent || type == Java.Event.DECODE_COMPLETE) {
delete loadListener[id];
}
return;
}
var eventListener = callbacks[id];
if (eventListener) {
eventListener(id, type, data);
}
if (terminalEvent) {
if (id == activeID) {
playing = false;
recording = false;
activeID = null;
}
delete callbacks[id];
}
}
window.tdsFireAudioEvent = function(applet, event, data, sequenceNumber, logSeqNumber) {
if (event == Java.Event.INITIALIZED) {
if (isReady()) return;
if (applet != null && typeof applet.getCurrentState == 'function') {
if (applet.getCurrentState() == 'READY') {
console.log('AUDIO APPLET EVENT READY');
setApplet(applet);
}
}
} else {
processEvent(data, event);
}
};
Java.isPlaying = function() {
return playing;
};
Java.isRecording = function() {
return recording;
};
Java.getState = function() {
return appletEl.getCurrentState();
};
Java.playAudioClip = function(audioID, format, type, eventListener) {
if (!isReady() || playing || recording) return false;
if (appletEl.playAudioClip(audioID, format, type)) {
playing = true;
activeID = audioID;
if (typeof eventListener == 'function') {
callbacks[audioID] = eventListener;
}
return true;
} else {
return false;
}
};
Java.stopAudioClip = function() {
if (!isReady()) return false;
return appletEl.stopAudioClip();
};
Java.startCapture = function(audioID, duration, format, eventListener) {
if (!isReady() || playing || recording) return false;
if (appletEl.startCapture(audioID, duration, format)) {
recording = true;
activeID = audioID;
if (typeof eventListener == 'function') {
callbacks[audioID] = eventListener;
}
return true;
} else {
return false;
}
};
Java.stopCapture = function() {
if (!isReady()) return false;
return appletEl.stopCapture();
};
Java.loadBase64Audio = function(audioID, format, type, base64, eventListener) {
if (!isReady()) return false;
appletEl.loadBase64Audio(audioID, format, type, base64);
if (typeof eventListener == 'function') {
loadCallbacks[audioID] = eventListener;
}
return true;
};
Java.retrieveBase64Audio = function(audioID, format) {
if (!isReady()) return null;
var base64 = appletEl.retrieveBase64Audio(audioID, format);
if (base64 != null && typeof (base64) == 'object') {
base64 = new String(base64).toString();
}
return base64;
};
Java.estimateQuality = function (audioID) {
if (!isReady()) return null;
return appletEl.estimateQuality(audioID);
};
Audio.Java = Java;
})(TDS.Audio);

/* SOURCE FILE: services.js (786b3a93) 9/9/2014 2:08:50 PM */

TDS = window.TDS || {};
TDS.Audio = TDS.Audio || {};
TDS.Audio.Services = function() {
this._initialized = false;
this._list = [];
this._lookup = {};
};
TDS.Audio.Services.prototype.register = function(service) {
var name = service.getName();
console.info('AudioService Register: ' + name);
this._list.push(service);
this._lookup[name] = service;
};
TDS.Audio.Services.prototype.getList = function() {
return this._list;
};
TDS.Audio.Services.prototype.get = function(name) {
return this._lookup[name];
};
TDS.Audio.Services.prototype.remove = function(name) {
var service = this.getService(name);
Util.Array.remove(this._list, service);
delete this._lookup[name];
};
TDS.Audio.Services.prototype.prioritize = function(names          ) {
names = names || [];
for (var i = 0; i < this._list.length; i++) {
var name = this._list[i].getName();
if (names.indexOf(name) == -1) {
names.push(name);
}
}
Util.Array.sort(this._list, function(recA, recB) {
var idxA = names.indexOf(recA.getName());
var idxB = names.indexOf(recB.getName());
return idxA > idxB ? 1 : idxA < idxB ? -1 : 0;
});
return this._list;
};
TDS.Audio.Services.prototype.getSupported = function() {
var services = this.getList();
for (var i = 0; i < services.length; i++) {
var service = services[i];
if (service.isSupported()) {
return service;
}
}
return null;
};

/* SOURCE FILE: recorder.js (44ab8e55) 9/9/2014 2:08:50 PM */

TDS = window.TDS || {};
TDS.Audio = TDS.Audio || {};
(function(Audio) {
var services = new TDS.Audio.Services();
var service = null;
var Recorder = {};
function createEvent(fireOnce) {
return new Util.Event.Custom(Recorder, fireOnce);
}
Recorder.onDeviceInit = createEvent();
Recorder.onDeviceReady = createEvent(true);
Recorder.onDeviceError = createEvent();
Recorder.onDeviceException = createEvent();
Recorder.onCaptureLoad = createEvent();
Recorder.onCaptureStart = createEvent();
Recorder.onCaptureProgress = createEvent();
Recorder.onCaptureStop = createEvent();
Recorder.onPlayStart = createEvent();
Recorder.onPlayStop = createEvent();
var capturing = false;
var playing = false;
Recorder.onCaptureStop.subscribe(function() {
capturing = false;
});
Recorder.onPlayStop.subscribe(function() {
playing = false;
});
Recorder.onDeviceError.subscribe(function(id, detail) {
capturing = false;
playing = false;
reinitialize();
});
function processException(id, ex, fatal) {
setTimeout(function() {
Recorder.onDeviceException.fire(id, ex, fatal);
}, 0);
}
var deviceBroken = false;
Recorder.isDeviceBroken = function() {
return deviceBroken;
};
Recorder.onDeviceException.subscribe(function(id, ex, fatal) {
capturing = false;
playing = false;
if (ex) {
console.error(ex);
}
capturing = false;
playing = false;
if (fatal) {
deviceBroken = true;
}
else {
reinitialize();
}
});
Recorder.getServices = function() {
return services;
};
Recorder.getSupportedService = function() {
return service;
};
Recorder.isCapturing = function() {
return capturing;
};
Recorder.isPlaying = function() {
return playing;
};
Recorder.register = services.register.bind(services);
Recorder.isInitialized = function() {
return service && service.isReady();
};
Recorder.initialize = function() {
services.prioritize(['webaudio', 'sb']);
service = services.getSupported();
if (service) {
console.info('Recorder service initializing: ' + service.getName());
service.initialize();
Recorder.loadSourceFromSessionStorage();
return true;
} else {
console.warn('Recorder service not found');
return false;
}
};
function reinitialize() {
setTimeout(function() {
try {
Recorder.initialize();
} catch(ex) {
processException(id, ex, true);
}
}, 0);
}
Recorder.isReady = function() {
return service && service.isReady();
};
Recorder.startCapture = function(id, duration) {
if (capturing || playing) return false;
if (Recorder.isReady()) {
try {
return service.startCapture(id, duration) && (capturing = true);
} catch(ex) {
processException(id, ex);
}
}
return false;
};
Recorder.stopCapture = function() {
if (Recorder.isReady() && capturing) {
try {
return service.stopCapture() && (capturing = false);
} catch(ex) {
processException(null, ex);
}
}
return false;
};
Recorder.playAudio = function(id) {
if (capturing || playing) return false;
if (Recorder.isReady()) {
try {
return service.playAudio(id) && (playing = true);
} catch(ex) {
processException(id, ex);
}
}
return false;
};
Recorder.stopAudio = function() {
if (Recorder.isReady() && playing) {
try {
return service.stopAudio() && (playing = false);
} catch(ex) {
processException(null, ex);
}
}
return false;
};
Recorder.loadBase64Audio = function(id, base64) {
return (Recorder.isReady() && service.loadBase64Audio(id, base64));
};
Recorder.retrieveBase64Audio = function(id, eventListener) {
return (Recorder.isReady() && service.retrieveBase64Audio(id, eventListener));
};
Recorder.retrieveQuality = function (id, eventListener) {
return (Recorder.isReady() && service.retrieveQuality(id, eventListener));
};
Recorder.getSources = function (callback) {
return (Recorder.isReady() && service.getSources(callback)) || [];
};
Recorder.setSource = function (deviceId) {
return Recorder.isReady() && service.setSource(deviceId);
};
var sessionStorageKey = 'Recorder-deviceId';
Recorder.saveSourceInSessionStorage = function (deviceId) {
Util.Storage.set(sessionStorageKey, deviceId);
};
Recorder.loadSourceFromSessionStorage = function () {
Recorder.getSources(function () {
var deviceId = Util.Storage.get(sessionStorageKey);
Recorder.setSource(deviceId);
});
};
Recorder.removeSourceFromSessionStorage = function () {
Util.Storage.remove(sessionStorageKey);
};
Audio.Recorder = Recorder;
})(TDS.Audio);
(function(Diagnostics, Recorder) {
if (!Diagnostics) return;
function getLogs() {
var logFormatter = [];
var service = Recorder.getSupportedService();
if (service && service.getName() == 'sb') {
var logs = service.getLogs();
for (var i = 0; i < logs.length; i++) {
var log = logs[i];
logFormatter.push(Util.Date.formatTime(log.timestamp));
logFormatter.push(' - ');
logFormatter.push(log.message);
logFormatter.push('\n');
}
}
return logFormatter.join('');
}
Recorder.onDeviceError.subscribe(function(id, detail) {
var message = 'Recorder Error: ' + detail;
if (id) {
message += ' (' + id + ')';
}
Diagnostics.logServerError(message, getLogs());
});
Recorder.onDeviceException.subscribe(function(id, ex) {
if (ex) {
Diagnostics.report(ex);
}
});
})(TDS.Diagnostics, TDS.Audio.Recorder);

/* SOURCE FILE: recorder.sb.js (a5729039) 9/9/2014 2:08:50 PM */

(function(Audio) {
var Recorder = Audio.Recorder;
var SBEvent = TDS.SecureBrowser.Base.Recorder.Event;
var SBAPI = null;
var SBService = {};
var ready = false;
var defaultDuration = 30;
var defaultOptions = null;
function initDefaultOptions() {
if (defaultOptions === null) {
setDefaultOptions();
}
}
function setDefaultOptions() {
var capabilities = SBAPI.getCapabilities();
var devices = capabilities.supportedInputDevices;
if (devices == null || devices.length == 0) {
throw new Error('There are no supported input devices.');
}
var device = devices[0];
var channelCount = device.channelCounts[0];
var sampleRate = device.sampleRates[0];
var sampleSize = device.sampleSizes[0];
defaultOptions = {
captureDevice: device.id,
channelCount: channelCount,
sampleRate: sampleRate,
sampleSize: sampleSize,
encodingFormat: 'OPUS',
qualityIndicator: true
};
console.log('SB Recorder Device: ', device);
}
SBService.getName = function() {
return 'sb';
};
SBService.isSupported = function() {
return (TDS.SecureBrowser.getRecorder() != null);
};
SBService.getLogs = function() {
return SBAPI.getLogs();
};
SBService.initialize = function () {
ready = false;
SBAPI = TDS.SecureBrowser.getRecorder();
Recorder.onDeviceInit.fire();
SBAPI.initialize(function (event) {
if (event.type == SBEvent.DEVICE_READY) {
try {
ready = true;
Recorder.onDeviceReady.fire();
} catch(ex) {
Recorder.onDeviceException.fire(null, ex, true);
}
}
else if (event.type == SBEvent.DEVICE_ERROR && Util.String.contains(event.data, 'Error during initialize')) {
Recorder.onDeviceException.fire(null, null, true);
}
});
};
SBService.isReady = function() {
return ready;
};
SBService.startCapture = function(id, duration) {
initDefaultOptions();
var options = JSON.parse(JSON.stringify(defaultOptions));
options = YAHOO.lang.augmentObject(options, {
filename: id,
captureLimit: {
duration: (YAHOO.lang.isNumber(duration) ? duration : defaultDuration)
},
progressFrequency: {
type: 'time',
interval: 99999
}
});
console.log('SB Recorder Capture: ', options);
SBAPI.startCapture(options, function(event) {
if (event.type == SBEvent.CAPTURE_START) {
Recorder.onCaptureStart.fire(id);
} else if (event.type == SBEvent.CAPTURE_END) {
Recorder.onCaptureStop.fire(id);
} else if (event.type == SBEvent.DEVICE_ERROR) {
Recorder.onDeviceError.fire(id, event.data);
}
});
return true;
};
SBService.stopCapture = function() {
SBAPI.stopCapture();
return true;
};
SBService.playAudio = function(id) {
var audioData = {
type: 'filename',
filename: id
};
SBAPI.play(audioData, function(event) {
if (event.type == SBEvent.PLAYBACK_START) {
Recorder.onPlayStart.fire(id);
} else if (event.type == SBEvent.PLAYBACK_STOPPED) {
Recorder.onPlayStop.fire(id);
} else if (event.type == SBEvent.DEVICE_ERROR) {
Recorder.onDeviceError.fire(id, event.data);
}
});
return true;
};
SBService.stopAudio = function() {
SBAPI.stopPlay();
return true;
};
SBService.loadBase64Audio = function(id, base64) {
return SBAPI.loadAudioFile(id, base64, function() {
Recorder.onCaptureLoad.fire(id);
});
};
SBService.retrieveBase64Audio = function(id) {
var data = SBAPI.retrieveAudioFile(id);
if (data && data.base64) {
return data.base64;
}
return null;
};
SBService.retrieveQuality = function (id) {
var data = SBAPI.retrieveAudioFile(id);
if (data && data.qualityIndicator) {
return data.qualityIndicator;
}
return null;
};
SBService.getSources = function (callback) {
if (typeof callback === 'function') {
initDefaultOptions();
callback([defaultOptions.captureDevice]);
}
};
SBService.setSource = function (deviceId) {
initDefaultOptions();
return defaultOptions.captureDevice === deviceId;
};
Recorder.register(SBService);
})(TDS.Audio);

/* SOURCE FILE: recorder.webaudio.js (46fed068) 9/9/2014 2:08:50 PM */

(function (audio, webAudio) {
function initWebAudio() {
webAudio.init({
workerFactory: Util.workerFactory,
encodingWorkerUrl: TDS.resolveBaseUrl('Scripts/combined/webaudio-worker.js')
});
}
var RecorderSingleton = audio.Recorder;
var _recorders = {},
_sources = [],
_sourceDevice = null,
_player;
function createAndAddRecorder(id) {
if (_recorders[id]) {
return _recorders[id];
}
var recorder = new webAudio.Recorder({
source: new webAudio.RecorderSource(_sourceDevice),
streamingEncoderFormat: webAudio.encoding.format.opus
});
var wrapper = _recorders[id] = {
id: id,
recorder: recorder,
timeout: null,
encodedData: null
};
recorder.onbeforestop = function () {
recorder.encoder.appendSilence(1.0);
};
recorder.oncomplete = function (buffer) {
var bytes = new Uint8Array(buffer),
base64 = base64js.fromByteArray(bytes);
wrapper.encodedData = base64;
wrapper.track = null;
RecorderSingleton.onCaptureStop.fire(id);
};
recorder.onerror = function (error) {
RecorderSingleton.onDeviceError.fire(id, error);
};
return wrapper;
}
function decodeBase64OggOpus(wrapper, callback, errorCallback) {
if (wrapper.track instanceof webAudio.Track) {
callback(wrapper.track);
return;
}
var bytes;
try {
bytes = base64js.toByteArray(wrapper.encodedData);
} catch (error) {
errorCallback(error.toString());
return;
}
webAudio.Track.fromArrayBuffer(bytes.buffer, webAudio.context, webAudio.encoding.format.opus, function (track) {
if (track === null) {
return;
}
track.name = wrapper.id;
wrapper.track = track;
callback(track);
}, function (error) {
errorCallback(error);
});
}
var webAudioService = {
getName: function () {
return 'webaudio';
},
isSupported: function () {
initWebAudio();
return webAudio.isReady();
},
getLogs: function () {
return [];
},
initialize: function () {
initWebAudio();
var isReady = webAudio.isReady();
if (!isReady) {
return;
}
_player = new webAudio.Player();
_player.ontrackend = function (track) {
var id = track.name;
RecorderSingleton.onPlayStop.fire(id);
};
RecorderSingleton.onDeviceReady.fire();
},
isReady: function () {
return webAudio.isReady();
},
startCapture: function (id, duration) {
var service = this,
wrapper = createAndAddRecorder(id),
recorder = wrapper.recorder;
recorder.startRecording(function () {
if (typeof duration !== 'number') {
duration = 30;
}
wrapper.timeout = setTimeout(function () {
service.stopCapture();
}, 1000 * duration);
RecorderSingleton.onCaptureStart.fire(id);
}, function (error) {
RecorderSingleton.onDeviceError.fire(id, 'error starting capture:\n' + error.toString());
}, function (error) {
RecorderSingleton.onDeviceError.fire(id, 'error acquiring capture device:\n' + error.toString());
});
return true;
},
stopCapture: function () {
var wrappers = Object.keys(_recorders).map(function (id) {
return _recorders[id];
});
wrappers.forEach(function (wrapper) {
var recorder = wrapper.recorder,
id = wrapper.id;
if (recorder.isRecording()) {
if (wrapper.timeout !== null) {
clearTimeout(wrapper.timeout);
wrapper.timeout = null;
}
recorder.stopRecording();
}
});
return true;
},
playAudio: function (id) {
var wrapper = _recorders[id];
if (wrapper.encodedData === null) {
return false;
}
decodeBase64OggOpus(wrapper, function (track) {
_player.changeTrack(track, true);
RecorderSingleton.onPlayStart.fire(id);
}, function (error) {
RecorderSingleton.onDeviceError.fire(id, (error || 'unknown error').toString());
});
return true;
},
stopAudio: function () {
var track = _player.getCurrentTrack(),
id = track.name;
_player.stop();
RecorderSingleton.onPlayStop.fire(id);
return true;
},
loadBase64Audio: function (id, data) {
var wrapper = createAndAddRecorder(id);
wrapper.encodedData = data;
wrapper.track = null;
if (data.length === 0) {
wrapper.encodedData = null;
RecorderSingleton.onCaptureLoad.fire(id);
return;
}
decodeBase64OggOpus(wrapper, function (track) {
var analyser = new webAudio.VoiceActivityDetector(track.sampleRate),
pcm = track.toPCM().channelData[0];
analyser.processData(pcm, true);
wrapper.loadedQuality = analyser.getQuality();
RecorderSingleton.onCaptureLoad.fire(id);
}, function (error) {
RecorderSingleton.onDeviceError.fire(id, (error || 'unknown error').toString());
});
},
retrieveBase64Audio: function (id) {
var wrapper = _recorders[id];
return (wrapper && wrapper.encodedData) || null;
},
retrieveQuality: function (id) {
var wrapper = _recorders[id];
var quality = wrapper.recorder.getQuality();
if (!quality) {
quality = wrapper.loadedQuality;
}
return quality;
},
getSources: function (callback) {
if (typeof callback !== 'function') {
return;
}
webAudio.RecorderSource.getAudioSources(function (sources) {
_sources = sources.slice();
callback(sources);
});
},
setSource: function (deviceId) {
var sources = _sources.filter(function (source) {
return source.deviceId === deviceId;
});
if (sources.length === 0) {
console.warn('invalid audio source device id "' + deviceId + '"');
_sourceDevice = null;
return;
}
var device = sources[0];
_sourceDevice = {
deviceId: device.deviceId,
label: device.label
};
Object.keys(_recorders).forEach(function (key) {
_recorders[key].recorder.setSourceDevice(_sourceDevice);
});
}
};
audio.Recorder.register(webAudioService);
})(TDS.Audio, webAudio);

/* SOURCE FILE: plugin.js (147267e9) 9/9/2014 2:08:50 PM */

(function (audio) {
function PlayerPlugin() {
this._publicApi = [];
}
Object.defineProperties(PlayerPlugin.prototype, {
publicApi: {
get: function () {
return this._publicApi;
},
enumerable: true, configurable: false
}
});
PlayerPlugin.prototype.expose = function (name, publicName) {
this.publicApi.push({
plugin: this,
name: name,
publicName: publicName || name,
isFunction: typeof this[name] === 'function'
});
};
PlayerPlugin.prototype.initialize = function (player) {
this.player = player;
};
PlayerPlugin.prototype.player = null;
PlayerPlugin.prototype.onSoundCreated = function (source) {
};
PlayerPlugin.prototype.parseSource = function (element, source) {
};
audio.PlayerPlugin = PlayerPlugin;
})(TDS.Audio);

/* SOURCE FILE: player.js (fc2b35c8) 9/9/2014 2:08:49 PM */

(function (tds) {
var _services = new TDS.Audio.Services(),
player = new Player(),
_plugins = [],
_impl;
function parseMIMEType(url) {
if (url) {
if (Util.String.contains(url, '.mp3')) {
return 'audio/mpeg';
} else if (Util.String.contains(url, '.m4a')) {
return 'audio/mp4';
} else if (Util.String.contains(url, '.ogg')) {
return 'audio/ogg';
} else if (Util.String.contains(url, '.oga')) {
return 'audio/ogg';
} else if (Util.String.contains(url, '.webma')) {
return 'audio/webm';
} else if (Util.String.contains(url, '.wav')) {
return 'audio/wav';
}
}
return '';
}
function parseSources(el) {
var sources = [],
source;
function parseSourceWithPlugins(source) {
_plugins.forEach(function (plugin) {
plugin.parseSource(el, source);
});
}
if (el.nodeName == 'A') {
source = {
url: decodeURIComponent(el.href),
};
source.type = parseMIMEType(source.url) || el.getAttribute('type') || '';
parseSourceWithPlugins(source);
sources.push(source);
} else if (el.nodeName == 'AUDIO') {
var sourceElements = el.getElementsByTagName('source'),
sourceElement;
for (var i = 0; i < sourceElements.length; ++i) {
sourceElement = sourceElements[i];
source = {
url: decodeURIComponent(sourceElement.src),
type: sourceElement.type
};
parseSourceWithPlugins(source);
sources.push(source);
}
}
return sources;
};
function Player() {
}
YAHOO.lang.augmentObject(Player.prototype, {
setup: function (servicePriorities) {
if (_impl) {
return true;
}
if (!Array.isArray(servicePriorities)) {
servicePriorities = ['createjs', 'sm2'];
}
_services.prioritize(servicePriorities);
_impl = _services.getSupported();
if (_impl) {
console.info('Player service initializing: ' + _impl.getName());
_impl.initialize();
this._initializePlugins();
Object.freeze(player);
return true;
} else {
console.warn('Player service not found');
return false;
}
},
_initializePlugins: function () {
_plugins.forEach(function (plugin) {
plugin.initialize(player);
plugin.publicApi.forEach(function (api) {
if (api.isFunction) {
player[api.publicName] = function () {
return api.plugin[api.name].apply(api.plugin, Array.prototype.slice.apply(arguments));
};
} else {
Object.defineProperty(player, api.publicName, {
get: function () {
return api.plugin[api.name];
}
});
}
});
});
},
teardown: function () {
if (_impl) {
_impl.teardown();
_impl = null;
}
},
register: function (service) {
if (service instanceof tds.Audio.PlayerPlugin) {
_plugins.push(service);
} else {
_services.register(service);
}
},
getServices: function () {
return _services;
},
_findPlayableSource: function (el) {
var sources = parseSources(el);
for (var i = 0; i < sources.length; i++) {
var source = sources[i];
if (this.canPlaySource(source)) {
return source;
}
}
return null;
},
_createSoundFromSource: function (id, source) {
var result = this.createSoundFromSource(id, source);
if (result !== false) {
_plugins.forEach(function (plugin) {
plugin.onSoundCreated(id, source);
});
}
return result;
},
createSound: function (id, url) {
var source = {
url: url,
type: parseMIMEType(url)
};
return this._createSoundFromSource(id, source);
},
createSoundFromElement: function (id, options) {
var el = YUD.get(id);
if (el == null) return false;
if (!YAHOO.lang.isString(id)) {
if (el.id && el.id != '') {
id = el.id;
} else {
return false;
}
}
var source = this._findPlayableSource(el);
if (!source) {
return false;
}
return this._createSoundFromSource(id, source, options);
}
});
var delegatedFunctions = [
'onReady',
'play', 'stop', 'pause', 'resume', 'stopAll',
'isPlaying', 'isPaused',
'canPlaySource', 'createSoundFromSource'
];
delegatedFunctions.forEach(function (api) {
Player.prototype[api] = function () {
if (_impl) {
return _impl[api].apply(_impl, Array.prototype.slice.apply(arguments));
} else {
console.warn('Player service not found');
return null;
}
}
});
var delegatedProperties = [
'onBeforePlay', 'onPlay', 'onStop', 'onPause', 'onBeforeResume', 'onResume', 'onFinish', 'onIdle', 'onFail', 'onTimeUpdate'
];
delegatedProperties.forEach(function (api) {
Object.defineProperty(Player.prototype, api, {
get: function () {
if (_impl) {
return _impl[api];
} else {
console.warn('Player service not found');
return null;
}
}
});
});
Object.freeze(Player.prototype);
tds.Audio = tds.Audio || {};
Object.defineProperty(tds.Audio, 'Player', {
value: player,
writable: false,
enumerable: true,
configurable: false
});
})(window.TDS);

/* SOURCE FILE: player.createjs.js (78694057) 10/26/2014 1:27:05 PM */

(function (audio) {
createjs.Sound.initializeDefaultPlugins();
function _parseSources(el) {
var sources = [];
if (el.nodeName == 'A') {
var url = decodeURIComponent(el.href);
sources.push(url);
} else if (el.nodeName == 'AUDIO') {
for (var i = 0; i < el.children.length; ++i) {
var source = el.children[i];
sources.push(decodeURIComponent(source.src));
}
}
return sources;
};
function _findPlayableSource(element) {
var sources = _parseSources(element);
for (var i = 0; i < sources.length; i++) {
var source = sources[i];
if (source) {
return source;
}
}
return null;
};
createjs.WebAudioPlugin.Loader.prototype.onerror = function (m) {
createjs.Sound._sendFileLoadError(this.src, m);
};
createjs.Sound._sendFileLoadError = function (a) {
if (createjs.Sound._preloadHash[a]) {
for (var b = 0, c = createjs.Sound._preloadHash[a].length; c > b; b++) {
var d = createjs.Sound._preloadHash[a][b];
if (createjs.Sound._preloadHash[a][b] = !0, createjs.Sound.hasEventListener("error")) {
var f = new createjs.Event("error");
f.src = d.src, f.id = d.id, f.data = 'error', createjs.Sound.dispatchEvent(f)
}
}
}
};
function WebAudioTimeUpdateNode(inputNode, soundId) {
var context = inputNode.context,
createScriptProcessor = context.createScriptProcessor || context.createJavaScriptNode,
self = this;
this._lastStopPosition = null;
this._processor = createScriptProcessor.call(context, this._selectBufferSize(context.sampleRate), inputNode.channelCount, 1);
this._processor.onaudioprocess = function (event) {
var eventEmitter = player.onTimeUpdate[soundId];
if (eventEmitter) {
var timeSinceStarted = context.currentTime - self._startTime;
eventEmitter.fire(self._lastStopPosition + timeSinceStarted);
}
};
this._inputNode = context.createGain();
this.head = this._processor;
this._sourceNode = null;
}
WebAudioTimeUpdateNode.prototype._selectBufferSize = function (sampleRate) {
var maxTimeBetweenUpdates = .250;
var size = [256, 512, 1024, 2048, 4096, 8192, 16384].filter(function (s) {
return (s / sampleRate) < maxTimeBetweenUpdates;
}).pop();
return size;
};
WebAudioTimeUpdateNode.prototype.start = function (sourceNode, resume) {
this._sourceNode = sourceNode;
this._startTime = this._processor.context.currentTime;
if (!resume || !this._lastStopPosition) {
this._lastStopPosition = 0;
}
this._sourceNode.connect(this._inputNode);
this._inputNode.connect(this._processor);
this._processor.connect(this._processor.context.destination);
};
WebAudioTimeUpdateNode.prototype.stop = function () {
this._lastStopPosition = this._lastStopPosition + this._processor.context.currentTime - this._startTime;
this._processor.disconnect();
this._inputNode.disconnect();
this._sourceNode = null;
};
var player = {
_sounds: {},
getName: function () {
return 'createjs';
},
_initialized: false,
initialize: function () {
this._initialized = true;
createjs.Sound.FILE_PATTERN = /()()().*\??.*(?:file=|\/|^)([^&]+\.(\w+))()/;
createjs.Sound.on('fileload', this._onSoundLoad, this, false);
createjs.Sound.on('error', this._onSoundLoadError, this, false);
this._initializeTimeUpdateEvent();
var self = this;
setTimeout(function () {
self._onReady.fire();
}, 1);
},
_onSoundLoad: function (event) {
var id = event.id,
sound = this._sounds[id],
commands = sound.commands;
this._sounds[id] = sound = createjs.Sound.createInstance(id);
var self = this;
sound.on('succeeded', function (event, id) {
sound.timeupdateNode = new WebAudioTimeUpdateNode(sound.panNode, id);
this.onPlay.fire(id);
}, this, false, id);
sound.on('complete', function (event, id) {
this.onFinish.fire(id);
this.onIdle.fire(id);
sound.air_playState = '';
}, this, false, id);
for (var i = 0; i < commands.length; ++i) {
this[commands[i]](id);
}
},
_onSoundLoadError: function (event) {
var id = event.id;
this.onFail.fire(id);
},
_initializeTimeUpdateEvent: function () {
var self = this;
function makeStartTimeUpdateCallback(resume) {
return function startTimeUpdate(id) {
var sound = self._sounds[id];
sound.timeupdateNode.start(sound.sourceNode, resume);
};
}
function stopTimeUpdate(id) {
var sound = self._sounds[id];
sound.timeupdateNode.stop();
}
this.onPlay.subscribe(makeStartTimeUpdateCallback(false));
this.onResume.subscribe(makeStartTimeUpdateCallback(true));
this.onIdle.subscribe(stopTimeUpdate);
this.onPause.subscribe(stopTimeUpdate);
},
teardown: function () {
createjs.Sound.removeAllSounds();
createjs.Sound.removeAllEventListeners();
this.onBeforePlay.unsubscribeAll();
this.onPlay.unsubscribeAll();
this.onPause.unsubscribeAll();
this.onBeforeResume.unsubscribeAll();
this.onResume.unsubscribeAll();
this.onStop.unsubscribeAll();
this.onFinish.unsubscribeAll();
this.onFail.unsubscribeAll();
this.onIdle.unsubscribeAll();
var self = this;
Object.keys(this.onTimeUpdate).forEach(function (key) {
self.onTimeUpdate[key].unsubscribeAll();
delete self.onTimeUpdate[key];
});
this._onReady.unsubscribeAll();
this._initialized = false;
},
_onReady: new Util.Event.Custom(null, true),
onReady: function (callback) {
this._onReady.subscribe(callback);
},
isSupported: function () {
return createjs.Sound.isReady() && createjs.Sound.activePlugin instanceof createjs.WebAudioPlugin;
},
play: function (id) {
var sound = this._sounds[id];
if (!sound) {
return false;
}
if (sound.loading) {
sound.commands.push('play');
} else {
var success = this.onBeforePlay.fire(id);
if (success === false) {
return false;
}
sound.play();
}
sound.air_playState = 'playing';
return true;
},
stop: function (id) {
var sound = this._sounds[id];
if (!sound) {
return false;
}
var wasPlaying;
if (sound.loading) {
var lastCommand = sound.commands[sound.commands.length - 1];
wasPlaying = lastCommand === 'play' || lastCommand === 'resume';
sound.commands.push('stop');
} else {
wasPlaying = sound.pause();
sound.stop();
if (wasPlaying) {
this.onStop.fire(id);
this.onIdle.fire(id);
}
}
sound.air_playState = '';
return true;
},
stopAll: function () {
var self = this;
Object.keys(this._sounds).forEach(function (id) {
self.stop(id);
});
},
resume: function (id) {
var sound = this._sounds[id];
if (!sound) {
return false;
}
var ret;
if (sound.loading) {
ret = sound.commands[sound.commands.length - 1] === 'pause';
sound.commands.push('resume');
} else {
var success = this.onBeforeResume.fire(id);
if (success === false) {
return false;
}
ret = sound.resume();
if (ret) {
this.onResume.fire(id);
}
}
sound.air_playState = 'playing';
return true;
},
pause: function (id) {
var sound = this._sounds[id];
if (!sound) {
return false;
}
var wasPlaying;
if (sound.loading) {
var lastCommand = sound.commands[sound.commands.length - 1];
wasPlaying = lastCommand === 'play' || lastCommand === 'resume';
sound.commands.push('pause');
} else {
wasPlaying = sound.pause();
if (wasPlaying) {
this.onPause.fire(id);
}
}
sound.air_playState = '';
return wasPlaying;
},
isPlaying: function () {
var self = this,
ids = Object.keys(self._sounds);
return !!ids.length && ids.some(function(id) {
var sound = self._sounds[id];
return (sound.loading ? sound.commands[sound.commands.length - 1] === 'play' : sound.air_playState === 'playing');
});
},
isPaused: function () {
},
canPlaySource: function (source) {
var m = source.type.match(/^(?:(?:audio|video)\/)?(\w+)$/);
if (!m) {
return false;
}
return createjs.Sound.getCapability(m[1]);
},
createSoundFromSource: function (id, source, options) {
if (this._sounds[id]) {
return false;
}
if (!this.canPlaySource(source)) {
return false;
}
var sound = createjs.Sound.registerSound(source.url, id, null, true);
if (sound === true) {
source.url += (source.url.match(/#/) ? (source.url.match(/#.*\?/) ? '&' : '?') : '#?') + 'createjsuniqueid=' + id;
sound = createjs.Sound.registerSound(source.url, id, null, true);
}
if (sound === false) {
return false;
}
this._sounds[id] = {
loading: true,
air_playState: '',
commands: []
};
this.onTimeUpdate[id] = new Util.Event.Custom();
return id;
},
onBeforePlay: new Util.Event.Custom(),
onPlay: new Util.Event.Custom(),
onPause: new Util.Event.Custom(),
onBeforeResume: new Util.Event.Custom(),
onResume: new Util.Event.Custom(),
onStop: new Util.Event.Custom(),
onFinish: new Util.Event.Custom(),
onIdle: new Util.Event.Custom(),
onFail: new Util.Event.Custom(),
onTimeUpdate: {}
};
audio._createjs = audio._createjs || {};
Object.defineProperty(audio._createjs, 'player', { value: player, writeable: false, enumerable: false, configurable: false });
audio.Player.register(player);
})(window.TDS.Audio);

/* SOURCE FILE: player.sm2.js (37ddfac9) 9/9/2014 2:08:49 PM */

(function (audio) {
var SM = window.soundManager;
var rebooted = false;
var Player = {};
function createEvent() {
return new Util.Event.Custom(this);
}
Player.onBeforePlay = createEvent();
Player.onPlay = createEvent();
Player.onPause = createEvent();
Player.onBeforeResume = createEvent();
Player.onResume = createEvent();
Player.onStop = createEvent();
Player.onFinish = createEvent();
Player.onIdle = createEvent();
Player.onFail = createEvent();
Player.onTimeUpdate = {};
function setup(flashPath) {
SM.audioFormats.mp3.required = false;
SM.setup({
url: flashPath,
flashVersion: 9,
preferFlash: false,
useHTML5Audio: true
});
SM.ontimeout(function () {
console.warn('AudioManager Error: SM2 timeout');
if (!rebooted) {
rebooted = true;
setTimeout(function () {
SM.reboot();
}, 1000);
}
});
}
function _onLoad(success) {
if (success === false) {
console.log('AUDIO FAILED: ' + this.id);
YAHOO.lang.later(0, Player.onFail, Player.onFail.fire, this.id);
}
}
function _onPlay() {
console.log('AUDIO PLAY: ' + this.id);
YAHOO.lang.later(0, Player.onPlay, Player.onPlay.fire, this.id);
}
function _onPause() {
console.log('AUDIO PAUSE: ' + this.id);
YAHOO.lang.later(0, Player.onPause, Player.onPause.fire, this.id);
};
function _onResume() {
console.log('AUDIO RESUME: ' + this.id);
YAHOO.lang.later(0, Player.onResume, Player.onResume.fire, this.id);
};
function _onStop() {
console.log('AUDIO STOP: ' + this.id);
YAHOO.lang.later(0, Player.onStop, Player.onStop.fire, this.id);
YAHOO.lang.later(0, Player.onIdle, Player.onIdle.fire, this.id);
}
function _onFinish() {
console.log('AUDIO FINISH: ' + this.id);
YAHOO.lang.later(0, Player.onFinish, Player.onFinish.fire, this.id);
YAHOO.lang.later(0, Player.onIdle, Player.onIdle.fire, this.id);
};
function _onFailure() {
console.log('AUDIO FAILURE: ' + this.id);
YAHOO.lang.later(0, Player.onFail, Player.onFail.fire, this.id);
};
function _onTimeUpdate() {
var position = SM.getSoundById(this.id).position / 1000; // playback position, in ms
Player.onTimeUpdate[this.id].fire(position);
}
function attachEvents(options) {
options.onload = _onLoad;
options.onplay = _onPlay;
options.onpause = _onPause;
options.onresume = _onResume;
options.onstop = _onStop;
options.onfinish = _onFinish;
options.onfailure = _onFailure;
options.whileplaying = _onTimeUpdate;
}
function createSoundFromSource(id, source, options) {
if (SM.getSoundById(id, true)) {
return false;
}
if (source == null) {
return false;
}
if (!canPlaySource(source)) {
return false;
}
options = options || {};
if (!options.id) {
options.id = id;
}
options = YAHOO.lang.augmentObject(options, source);
attachEvents(options);
SM.createSound(options);
Player.onTimeUpdate[id] = createEvent();
if (Util.Browser.isMacPPC()) {
SM.play(id);
SM.stop(id);
}
return id;
}
function canPlaySource(source) {
return SM.canPlayURL(source.url) || SM.canPlayMIME(source.type);
}
Player.onReady = SM.onready;
Player.canPlaySource = canPlaySource;
Player.createSoundFromSource = createSoundFromSource;
Player.play = function (id) {
var success = Player.onBeforePlay.fire(id);
if (success === false) {
return false;
}
var sound = SM.play(id);
return sound && sound.playState !== 0;
};
Player.stop = function (id) {
var sound = SM.stop(id);
return (sound !== false);
};
Player.pause = function (id) {
var sound = SM.pause(id);
return sound && sound.paused;
};
Player.resume = function (id) {
var success = Player.onBeforeResume.fire(id);
if (success === false) {
return false;
}
var sound = SM.resume(id);
return (sound !== false);
};
Player.isPaused = function () {
var ids = SM.soundIDs;
for (var i = 0; i < ids.length; i++) {
var sound = SM.sounds[ids[i]];
if (sound.paused) {
return true;
}
}
return false;
};
Player.isPlaying = function () {
var ids = SM.soundIDs;
for (var i = 0; i < ids.length; i++) {
var sound = SM.sounds[ids[i]];
if (!sound.paused && sound.playState > 0) {
return true;
}
}
return false;
};
Player.stopAll = function () {
SM.stopAll();
};
Player.isSupported = function () {
return !!SM;
};
Player.initialize = function () {
var flashPath = TDS.resolveBaseUrl('Scripts/Libraries/soundmanager2/swf/');
setup(flashPath);
};
Player.teardown = function () {
Player.stopAll();
var ids = SM.soundIDs.slice();
for (var i = 0; i < ids.length; i++) {
SM.unload(ids[i]);
}
Player.onBeforePlay.unsubscribeAll();
Player.onPlay.unsubscribeAll();
Player.onPause.unsubscribeAll();
Player.onBeforeResume.unsubscribeAll();
Player.onResume.unsubscribeAll();
Player.onStop.unsubscribeAll();
Player.onFinish.unsubscribeAll();
Player.onFail.unsubscribeAll();
Player.onIdle.unsubscribeAll();
Object.keys(Player.onTimeUpdate).forEach(function (key) {
Player.onTimeUpdate[key].unsubscribeAll();
delete Player.onTimeUpdate[key];
});
};
Player.getName = function () {
return 'sm2';
};
audio._soundManager = audio._soundManager || {};
Object.defineProperty(audio._soundManager, 'player', { value: Player, writeable: false, enumerable: false, configurable: false });
audio.Player.register(Player);
})(window.TDS.Audio);

/* SOURCE FILE: queue.js (d5722ecc) 9/9/2014 2:08:50 PM */

(function (audio) {
var numInstances = 0;
var Queue = function (player) {
this._instance = ++numInstances;
this._isStarted = false;
this._player = player;
this._playerIDs = [];
this._currentID = null;
this.onStart = new Util.Event.Custom(this);
this.onStop = new Util.Event.Custom(this);
};
Queue.prototype._log = function (name, id) {
var msg = 'AUDIO QUEUE ' + this._instance + ': ' + name;
if (id) {
msg += ' - ' + id;
}
};
Queue.prototype._setStarted = function (id) {
if (this._isStarted) return;
this._log('Start', id);
this._isStarted = true;
this._player.onStop.subscribe(this._onStop, this, true);
this._player.onIdle.subscribe(this._onIdle, this, true);
this.onStart.fire(this);
};
Queue.prototype._setStopped = function (id) {
if (!this._isStarted) return;
this._log('Stop', id);
this._isStarted = false;
this._player.onStop.unsubscribe(this._onStop, this, true);
this._player.onIdle.unsubscribe(this._onIdle, this, true);
this.onStop.fire(this);
};
Queue.prototype._play = function (id) {
if (this._player.play(id)) {
this._currentID = id;
return true;
} else {
return false;
}
};
Queue.prototype._onStop = function (id) {
if (this._currentID == id) {
this._currentID = null;
this._setStopped(id);
}
};
Queue.prototype._onIdle = function (id) {
if (!this._isStarted) return;
this._currentID = null;
var inactiveIdx = this._playerIDs.indexOf(id);
if (inactiveIdx == -1) return;
var nextID = this._playerIDs[inactiveIdx + 1];
if (nextID) {
if (!this._play(nextID)) {
this._setStopped(id);
}
} else {
this._setStopped(id);
}
};
Queue.prototype.isStarted = function () {
return this._isStarted;
};
Queue.prototype.start = function () {
if (this._playerIDs.length == 0) {
return false;
}
var firstID = this._playerIDs[0];
if (this._play(firstID)) {
this._setStarted();
return true;
}
return false;
};
Queue.prototype.stop = function () {
if (this.isStarted()) {
this._player.stop(this._currentID);
}
};
Queue.prototype.insert = function (id, pos) {
Util.Array.insertAt(this._playerIDs, id, (pos || 0));
};
Queue.prototype.append = function (id) {
this._playerIDs.push(id);
};
Queue.prototype.remove = function (id) {
Util.Array.remove(this._playerIDs, id);
};
Queue.prototype.clear = function () {
var ids = this._playerIDs.slice();
for (var i = 0; i < ids.length; i++) {
this.remove(ids[i]);
}
};
Queue.prototype.dispose = function () {
this.stop();
this.clear();
this.onStart.unsubscribeAll();
this.onStop.unsubscribeAll();
};
function QueuePlugin() {
QueuePlugin.superclass.constructor.call(this);
this.expose('createQueue');
}
YAHOO.lang.extend(QueuePlugin, audio.PlayerPlugin);
QueuePlugin.prototype.createQueue = function (ids) {
var queue = new Queue(this.player);
if (ids) {
for (var i = 0; i < ids.length; i++) {
queue.append(ids[i]);
}
}
return queue;
};
audio.Player.register(new QueuePlugin());
})(window.TDS.Audio);

/* SOURCE FILE: closedcaptioning.js (f3ed7747) 10/26/2014 1:27:05 PM */

(function (audio) {
var _tracks = {};
var _allowedKinds = ["subtitles", "captions", "descriptions", "captions", "metadata", "chapters"];
function VirtualMediaContainer() {
this.currentTime = 0;
var timeupdateEventHandlers = [];
this.addEventListener = function (event, handler, ignore) {
if (event === "timeupdate" && handler instanceof Function) {
timeupdateEventHandlers.push(handler);
}
};
this.updateTime = function (newTime) {
if (!isNaN(newTime)) {
this.currentTime = newTime;
timeupdateEventHandlers.forEach(function (handler) {
handler();
});
}
};
this._captionatorOptions = {
processCueHTML: false
};
};
VirtualMediaContainer.prototype.addTextTrack = function (id, kind, label, language, src, isDefault) {
var newTrack;
id = typeof (id) === "string" ? id : "";
label = typeof (label) === "string" ? label : "";
language = typeof (language) === "string" ? language : "";
isDefault = typeof (isDefault) === "boolean" ? isDefault : false;
if (!_allowedKinds.indexOf(kind) === -1) {
throw new Error("DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedTextTrack.");
} else {
newTrack = new captionator.TextTrack(id, kind, label, language, src, isDefault);
if (newTrack) {
if (!(this.textTracks instanceof Array)) {
this.textTracks = [];
}
this.textTracks.push(newTrack);
newTrack.videoNode = this;
return newTrack;
} else {
return false;
}
}
};
captionator.rebuildCaptions = function () {
};
function ClosedCaptioningPlugin() {
ClosedCaptioningPlugin.superclass.constructor.call(this);
this.expose('getTextTracks');
this.expose('onAddTrack');
}
YAHOO.lang.extend(ClosedCaptioningPlugin, audio.PlayerPlugin);
ClosedCaptioningPlugin.prototype.parseSource = function (element, source) {
var haveTextTrack = false;
if (element instanceof HTMLAudioElement) {
source.tracks = Array.prototype.map.call(element.getElementsByTagName('track'), function (track) {
return {
src: track.src,
kind: track.kind,
lang: track.srclang,
label: track.label,
isDefault: track.default
};
});
} else if (element instanceof HTMLAnchorElement && element.getAttribute('texttrack') !== null) {
source.tracks = [{
src: source.url.replace(/(file=\w+.)(?:\w+)/, '$1vtt'),
kind: 'captions',
lang: 'en',
label: 'Captions',
isDefault: true
}];
} else {
source.tracks = [];
console.warn('TDS.Audio.ClosedCaptioningPlugin: invalid item source element');
}
};
ClosedCaptioningPlugin.prototype.onSoundCreated = function (id, source) {
if (!source.tracks.length) {
return;
}
var media = new VirtualMediaContainer(),
player = this.player,
self = this;
var tracks = source.tracks.map(function (track, i) {
return media.addTextTrack(id + '_track' + i, track.kind, track.label, track.lang, track.src, track.isDefault);
});
tracks.forEach(function (track) {
track.loadTrack(track.src, function (cues) {
var track = this;
track.mode = track.default ? captionator.TextTrack.SHOWING : captionator.TextTrack.HIDDEN;
player.onTimeUpdate[id].subscribe(function (time) {
media.updateTime(time);
});
media.addEventListener('timeupdate', function () {
try {
track.activeCues.refreshCues();
} catch (error) { }
});
self.onAddTrack.fire(track);
});
});
_tracks[id] = tracks;
};
ClosedCaptioningPlugin.prototype.getTextTracks = function (id) {
return _tracks[id] || [];
};
ClosedCaptioningPlugin.prototype.onAddTrack = new Util.Event.Custom();
audio.Player.register(new ClosedCaptioningPlugin());
})(TDS.Audio);

/* SOURCE FILE: ui.js (5132fdb9) 10/26/2014 1:27:05 PM */

(function (Audio) {
var eventMap = {
'playing_start': {
playPause: '',
rewind: ''
},
'playing_pause': {
playPause: '',
rewind: ''
},
'playing_resume': {
playPause: '',
rewind: ''
},
'playing_done': {
playPause: '',
rewind: ''
},
'playing_fail': {
playPause: '',
rewind: ''
}
};
var CSS_DISABLED = 'disabled';
var Recorder = Audio.Recorder;
var Player = Audio.Player;
var widgetList = [];
var recorderList = [];
var recorderLookup = {};
var playerList = [];
var playerLookup = {};
function updateProgressLevel(id, level) {
var micDiv = YUD.get(id);
if (!YAHOO.lang.isNumber(level)) return;
level = level * 1;
if (micDiv) {
var soundLevelWrapEl = YUD.getFirstChild(micDiv);
var soundLevelIndicatorEl = YUD.getFirstChild(soundLevelWrapEl);
soundLevelIndicatorEl.style.width = (level + '%');
}
};
function enableAll() {
for (var i = 0; i < widgetList.length; i++) {
var el = YUD.get(widgetList[i]);
YUD.removeClass(el, CSS_DISABLED);
}
}
function disableAll(id) {
for (var i = 0; i < widgetList.length; i++) {
if (widgetList[i] != id) {
var el = YUD.get(widgetList[i]);
YUD.addClass(el, CSS_DISABLED);
}
}
}
var ATTRIB_AUDIO_EVENT = 'data-audio-event';
function setEventClass(id, type) {
var el = YUD.get(id);
if (el == null) return;
type = type.toLowerCase();
var lastEvent = el.getAttribute(ATTRIB_AUDIO_EVENT);
if (lastEvent) {
YUD.removeClass(el, lastEvent);
}
el.setAttribute(ATTRIB_AUDIO_EVENT, type);
YUD.addClass(el, type);
}
function setEventClassAll(type) {
for (var i = 0; i < recorderList.length; i++) {
setEventClass(recorderList[i].id, type);
}
}
function setupRecorderEvents() {
Recorder.onDeviceInit.subscribe(function () {
enableAll();
setEventClassAll('load_start');
});
Recorder.onDeviceReady.subscribe(function () {
enableAll();
for (var i = 0; i < recorderList.length; i++) {
if (recorderList[i].loaded) {
setEventClass(recorderList[i].id, 'recording_done');
} else {
setEventClass(recorderList[i].id, 'recording_ready');
}
}
});
Recorder.onDeviceError.subscribe(function (id) {
enableAll();
setEventClassAll('recording_fail');
});
Recorder.onDeviceException.subscribe(function (id) {
enableAll();
setEventClassAll('recording_fail');
});
Recorder.onCaptureLoad.subscribe(function (id) {
if (recorderLookup[id]) {
recorderLookup[id].loaded = true;
}
setEventClass(id, 'recording_done');
});
Recorder.onCaptureStart.subscribe(function (id) {
disableAll(id);
setEventClass(id, 'recording_start');
});
Recorder.onCaptureStop.subscribe(function (id) {
if (recorderLookup[id]) {
recorderLookup[id].loaded = true;
recorderLookup[id].dirty = true;
}
enableAll();
setEventClass(id, 'recording_done');
if (Util.Browser.isMacPPC()){
Recorder.playAudio(id);
Recorder.stopAudio();
}
});
Recorder.onPlayStart.subscribe(function (id) {
disableAll(id);
setEventClass(id, 'playing_start');
});
Recorder.onPlayStop.subscribe(function (id) {
enableAll();
setEventClass(id, 'playing_done');
});
}
function createRecorderWidget(id, duration) {
var recorderEl = YUD.get(id);
if (!recorderEl) {
console.warn('Could not find recorder id \'' + id + '\'');
return;
}
id = recorderEl.id;
widgetList.push(id);
recorderList.push(
recorderLookup[id] = {
id: id,
el: recorderEl,
loaded: false,
dirty: false
}
);
recorderEl.setAttribute(ATTRIB_AUDIO_EVENT, 'recording_ready');
var btnRecord = YUD.getElementsByClassName('btnRecord', 'a', recorderEl)[0];
var btnPlayPause = YUD.getElementsByClassName('btnPlayPause', 'a', recorderEl)[0];
YUE.addListener(btnRecord, 'click', function (evt) {
YUE.stopEvent(evt);
if (YUD.hasClass(recorderEl, CSS_DISABLED)) return;
if (Player.isPlaying()) return;
if (YUD.hasClass(recorderEl, 'recording_start')) {
Recorder.stopCapture();
} else {
Recorder.startCapture(id, duration);
}
});
YUE.addListener(btnPlayPause, 'click', function (evt) {
YUE.stopEvent(evt);
if (YUD.hasClass(recorderEl, CSS_DISABLED)) return;
if (Player.isPlaying()) return;
if (YUD.hasClass(recorderEl, 'playing_start')) {
Recorder.stopAudio();
} else {
Recorder.playAudio(id);
}
});
if (Recorder.isDeviceBroken()) {
YUD.addClass(recorderEl, 'recording_fail');
}
else if (Recorder.isReady() && !Audio.isActive()) {
YUD.removeClass(recorderEl, CSS_DISABLED);
}
return {
id: id,
controls: [btnRecord, btnPlayPause]
};
}
function setupPlayerEvents() {
Player.onPlay.subscribe(function (id) {
disableAll(id);
setEventClass(id, 'playing_start');
});
Player.onPause.subscribe(function (id) {
enableAll();
setEventClass(id, 'playing_pause');
});
Player.onResume.subscribe(function (id) {
disableAll(id);
setEventClass(id, 'playing_start');
});
Player.onIdle.subscribe(function (id) {
enableAll();
setEventClass(id, 'playing_done');
});
Player.onFail.subscribe(function (id) {
enableAll();
setEventClass(id, 'playing_fail');
});
}
var playerCount = 0;
function createPlayerWidget(id) {
var linkEl = YUD.get(id);
if (!linkEl) return null;
var id;
if (linkEl.id) {
id = linkEl.id;
} else {
id = 'sound-' + (++playerCount);
linkEl.id = id;
}
var playStopEl = document.createElement('a');
playStopEl.id = id;
playStopEl.className = 'playPause';
playStopEl.setAttribute('href', '#');
playStopEl.className = linkEl.className + ' ' + CSS_DISABLED;
YUE.addListener(playStopEl, 'click', function (ev) {
YUE.stopEvent(ev);
if (YUD.hasClass(playStopEl, CSS_DISABLED)) return;
if (Recorder.isCapturing() || Recorder.isPlaying()) return;
if (YUD.hasClass(playStopEl, 'playing_start')) {
Player.stop(playStopEl.id);
} else {
Player.play(playStopEl.id);
}
});
YUD.addClass(playStopEl, CSS_DISABLED);
playStopEl.setAttribute('title', 'Play or stop recorded audio.');
Player.onReady(function () {
if (Player.createSoundFromElement(linkEl)) {
widgetList.push(playStopEl.id);
YUD.removeClass(playStopEl, CSS_DISABLED);
}
});
$(linkEl).replaceWith(playStopEl);
return {
id: playStopEl.id,
controls: [playStopEl]
};
}
function createPlayerRewindWidget(target) {
var linkEl = YUD.get(target);
if (!linkEl) return null;
var id;
if (linkEl.id) {
id = linkEl.id;
} else {
id = 'sound-' + (++playerCount);
linkEl.id = id;
}
var audioControlsEl = document.createElement('div');
audioControlsEl.id = id;
audioControlsEl.className = 'audioControls ' + CSS_DISABLED;
var playPauseEl = document.createElement('a');
playPauseEl.className = 'playPause';
playPauseEl.setAttribute('href', '#');
playPauseEl.setAttribute('title', 'Play or pause recorded audio.');
YUE.addListener(playPauseEl, 'click', function (ev) {
YUE.stopEvent(ev);
if (YUD.hasClass(audioControlsEl, CSS_DISABLED)) return;
if (Recorder.isCapturing() || Recorder.isPlaying()) return;
if (YUD.hasClass(audioControlsEl, 'playing_start') ||
YUD.hasClass(audioControlsEl, 'playing_resume')) {
Player.pause(id);
}
else if (YUD.hasClass(audioControlsEl, 'playing_pause')) {
Player.resume(id);
}
else if (YUD.hasClass(audioControlsEl, 'playing_done') ||
(!YUD.hasClass(audioControlsEl, 'playing_start') || !YUD.hasClass(audioControlsEl, 'playing_resume'))) {
Player.play(id);
}
else {
Player.stop(id);
}
});
audioControlsEl.appendChild(playPauseEl);
var rewindEl = document.createElement('a');
rewindEl.className = 'rewind';
rewindEl.setAttribute('href', '#');
rewindEl.setAttribute('title', 'Go back to the beginning of the audio.');
YUE.addListener(rewindEl, 'click', function (ev) {
YUE.stopEvent(ev);
if (!YUD.hasClass(audioControlsEl, 'playing_done')) {
Player.stop(id);
}
});
audioControlsEl.appendChild(rewindEl);
Player.onReady(function () {
if (Player.createSoundFromElement(linkEl)) {
widgetList.push(id);
YUD.removeClass(audioControlsEl, CSS_DISABLED);
}
});
$(linkEl).replaceWith(audioControlsEl);
return {
id: id,
controls: [playPauseEl, rewindEl]
};
}
var _trackWrappers = {},
_closedCaptioningContainer;
function getClosedCaptioningContainer() {
_closedCaptioningContainer = _closedCaptioningContainer || $(document.getElementById('tool-ClosedCaptioning'));
return _closedCaptioningContainer;
}
function renderTracksForSound(id, fireCueChange) {
var visibleTracks = Player.getTextTracks(id).filter(function (track) {
return track.mode === captionator.TextTrack.SHOWING;
});
var showClosedCaptions = TDS.getAccommodationProperties().hasClosedCaptioning() &&
visibleTracks.length > 0;
getClosedCaptioningContainer()
.html('')
.toggleClass('tdsClosedCaptioningActive', showClosedCaptions)
.clearQueue('closedCaptionQueue');
visibleTracks.forEach(function (track) {
var container = getClosedCaptioningContainer(),
wrapper = $('<div class="ccWrapper">').appendTo(container);
track.oncuechange = function () {
var visibleCues = track.activeCues.map(function (cue) {
return '<p class="currentText">' + cue.text + '</p>';
}).join();
wrapper.html(visibleCues);
};
if (fireCueChange) {
track.oncuechange();
}
});
}
function createClosedCaptionWidget() {
Player.onStop.subscribe(function (id) {
getClosedCaptioningContainer().toggleClass('tdsClosedCaptioningActive', false);
});
Player.onFinish.subscribe(function (id) {
getClosedCaptioningContainer().delay(3000, 'closedCaptionQueue').toggleClass('tdsClosedCaptioningActive', false);
});
Player.onPlay.subscribe(function (id) {
renderTracksForSound(id, false);
});
Player.onResume.subscribe(function (id) {
renderTracksForSound(id, true);
});
}
function createSourceSelect(id, onselect) {
'use strict';
var sourcesContainer = YUD.get(id);
if (!sourcesContainer) {
console.warn('could not find audio recording source select element');
return null;
}
var direction = 'horizontal';
var meters = [],
activeMeter = null,
animating = false,
disposed = false;
function stopMeter(meter) {
meter.analyser && meter.analyser.disconnect();
meter.analyser = null;
meter.streamContainer && stopStream(meter.streamContainer.stream);
meter.streamContainer = null;
}
function stopStream(stream) {
if (typeof stream.stop === 'function') {
stream.stop();
return;
}
[].forEach.call(stream.getAudioTracks(), function (track) {
track.stop();
});
[].forEach.call(stream.getVideoTracks(), function (track) {
track.stop();
});
}
function updateVolumeMeter(meter, volume) {
volume = (100 * volume).toFixed(0) + '%';
meter.element.textContent = volume;
if (direction === 'horizontal') {
meter.element.style.width = volume;
} else if (direction === 'vertical') {
meter.element.style.height = volume;
}
}
function animateVolumeMeter() {
if (disposed) {
return;
}
if (animating && activeMeter && activeMeter.analyser) {
updateVolumeMeter(activeMeter, activeMeter.analyser.volume);
}
requestAnimationFrame(animateVolumeMeter);
}
function startVolumeAnalyserFor(meter) {
function success(streamContainer) {
var stream = streamContainer.stream,
audioTracks = stream.getAudioTracks();
if (audioTracks.length === 0) {
console.log('no audio tracks for source', stream);
stopStream(stream);
return;
}
meter.analyser = webAudio.context.createVolumeAnalyser();
meter.streamContainer = streamContainer;
streamContainer.streamSourceNode.connect(meter.analyser.head);
}
function failure(error) {
console.warn('Recorder.createSourceSelector: failed to get stream for a device; ' + error);
}
meter.source.getStreamContainer(success, failure);
}
function createVolumeMeter(source) {
var container = document.createElement('div'),
label = document.createElement('div'),
meter = document.createElement('div'),
volumeLevel = document.createElement('div');
YUD.addClass(label, 'label');
label.textContent = source.label;
YUD.addClass(meter, 'meter');
meter.appendChild(volumeLevel);
YUD.addClass(volumeLevel, 'volumeLevel');
YUD.addClass(container, 'device');
container.setAttribute('role', 'radio');
container.tabIndex = 0;
container.appendChild(label);
container.appendChild(meter);
var meter = {
container: container,
element: volumeLevel,
analyser: null,
source: source,
streamContainer: null
};
YUE.addListener(container, 'click', function (event) {
if (activeMeter) {
stopMeter(activeMeter);
}
activeMeter = meter;
meters.forEach(function (meter) {
YUD.removeClass(meter.container, 'selected');
meter.container.setAttribute('aria-checked', 'false');
});
YUD.addClass(container, 'selected');
container.setAttribute('aria-checked', 'true');
startVolumeAnalyserFor(meter);
if (typeof onselect === 'function') {
onselect(source.deviceId);
}
});
sourcesContainer.appendChild(container);
return meter;
}
var sourceSelectController = {
show: function () {
animating = true;
},
hide: function () {
animating = false;
meters.forEach(function (meter) {
updateVolumeMeter(meter, 0);
});
},
buildDeviceList: function () {
var deferred = Util.Promise.defer();
Recorder.getSources(function (sources) {
var length = sources.length,
i = 0,
source, meter;
if (length === 0) {
deferred.reject();
return;
}
for (; i < length; ++i) {
source = sources[i]
meter = createVolumeMeter(source);
meters.push(meter);
}
deferred.resolve();
});
requestAnimationFrame(animateVolumeMeter);
return deferred.promise;
},
dispose: function () {
disposed = true;
this.hide();
meters.forEach(stopMeter);
}
};
return sourceSelectController;
}
TDS.Audio.Widget = {};
if (Recorder) {
setupRecorderEvents();
TDS.Audio.Widget.createRecorder = createRecorderWidget;
TDS.Audio.Widget.getRecorder = function (id) {
return recorderLookup[id];
};
TDS.Audio.Widget.createSourceSelect = createSourceSelect;
}
if (Player) {
Player.setup();
setupPlayerEvents();
TDS.Audio.Widget.createPlayer = createPlayerWidget;
TDS.Audio.Widget.createPlayerRewind = createPlayerRewindWidget;
TDS.Audio.Widget.getPlayer = function (id) {
return playerLookup[id];
};
createClosedCaptionWidget();
}
TDS.Audio.Widget.getIDs = function () {
return widgetList;
};
})(TDS.Audio);

/* SOURCE FILE: config.js (de132327) 10/26/2014 1:27:05 PM */

TTS = window.TTS || {};
TTS.Config = {
PlayDelay: 200,
DefaultManager: 'TTS.Manager',
DefaultToSelection: true,
DefaultLanguage: 'ENU',
NoInit: false,
Debug: false,
i18n: {
ESN:{
option: 'opciÃ³n'
},
ENU: {
option: 'option'
}
},
isTrackingEnabled: function() {
return false;
},
shouldSanitizeTextForTTS: function() {
var ttxRule = TDS.getAccommodationProperties() != null ? TDS.getAccommodationProperties().getTTXBusinessRules() : null;
if (ttxRule != null && ttxRule.indexOf("TDS_TTX_M") != -1) {
return true;
}
return false;
},
getText: function(key, lang){
lang = lang || 'ENU';
return TTS.Config.i18n[lang] ? TTS.Config.i18n[lang][key] : key;
},
User: {
reset: function () {
var langs = [TTS.Config.Lang.ESN.Code, TTS.Config.Lang.ENU.Code];
langs.forEach(function (lang) {
TTS.Config.User.setVolume(TTS.Config.UserSet.Volume, lang);
TTS.Config.User.setRate(TTS.Config.UserSet.Rate, lang);
TTS.Config.User.setPitch(TTS.Config.UserSet.Pitch, lang);
});
TTS.Config.User.setVoice('', langs);
},
getVoice: function(lang){
return TTS.Config.User.getLocalStorage('Voice', lang);
},
setVoice: function(val, langs){
langs = langs || [TTS.Config.Lang.ENU.Code];
for(var k in langs){
var lang = langs[k];
TTS.getInstance().setVoice(val, lang);
}
TTS.Config.User.setLocalStorage('Voice', val, langs);
},
getRate: function (lang) {
lang = lang || TTS.Config.Lang.ENU.Code;
return TTS.Config.User.getLocalStorage('Rate', lang);
},
setRate: function(val, lang){
lang = lang || TTS.Config.Lang.ENU.Code;
TTS.getInstance().setRate(val);
TTS.Config.User.setLocalStorage('Rate', val, lang);
},
getPitch: function(lang){
lang = lang || TTS.Config.Lang.ENU.Code;
return TTS.Config.User.getLocalStorage('Pitch', lang);
},
setPitch: function(val, lang){
lang = lang || TTS.Config.Lang.ENU.Code;
TTS.getInstance().setPitch(val);
TTS.Config.User.setLocalStorage('Pitch', val, lang);
},
getVolume: function(lang){
lang = lang || TTS.Config.Lang.ENU.Code;
return TTS.Config.User.getLocalStorage('Volume', lang);
},
setVolume: function(val, lang){
lang = lang || TTS.Config.Lang.ENU.Code;
TTS.getInstance().setVolume(val);
TTS.Config.User.setLocalStorage('Volume', val, lang);
},
resetToDefaults: function(cfg, lang){
lang = lang || TTS.Config.Lang.ENU.Code;
cfg = cfg || TTS.Config.UserSet;
TTS.Config.User.setVolume(cfg.Volume, lang);
TTS.Config.User.setRate(cfg.Rate, lang);
TTS.Config.User.setPitch(cfg.Pitch, lang);
},
getKey: function(val, lang){
lang = lang || TTS.Config.Lang.ENU.Code;
return 'TTS_' + val + '_' + lang;
},
getLocalStorage: function(str, lang){
lang = lang || TTS.Config.Lang.ENU.Code;
var key = TTS.Config.User.getKey(str, lang);
var ret = null;
if(window.Util && Util.Storage){
ret = Util.Storage.get(key);
}
if(typeof ret == 'undefined' || ret == null){
ret = TTS.Config.User.Store[key];
}
if(typeof ret == 'undefined' || ret == null){
ret = TTS.Config.UserSet[str];
}
TTS.Config.Debug && console.log("TTS: Get this value (str, lang, key, ret)", str, lang, key, ret);
return ret;
},
setLocalStorage: function(str, val, langs){
if(typeof langs == 'string'){
langs = [langs];
}else if(!langs){
langs = [TTS.Config.Lang.ENU.Code];
}
for(var i = 0; i < langs.length; ++i){
var lang = langs[i];
var key  = TTS.Config.User.getKey(str, lang);
TTS.Config.Debug && console.log("TTS: SET this local store value (str, lang, key)", str, lang, key, val);
if(window.Util && Util.Storage){
Util.Storage.set(key, val);
}else{
TTS.Config.User.Store[key] = val;
}
}
},
Store: {}
},
UserSet: {
ShowVoicePacks: true,
ShowAdjustments: true,
ShowVolume: true,
MinVolume: 20,
MaxVolume: 10,
Volume: 10,
ShowPitch: true,
MinPitch: 0,
MaxPitch: 20,
Pitch: 10,
ShowRate: true,
MinRate: 0,
MaxRate: 20,
Rate: 10,
TickSize: 20,
LengthInPixels: 200
},
Lang:{
ENU: {
Code: 'ENU',
Enabled: true,
Label: 'English'
},
ESN: {
Code: 'ESN',
Enabled: true,
Label: 'EspaÃ±ol'
}
},
DefaultVoices: [
{ name: "MS_EN-US_DAVID", priority: 3, language: "ENU" },
{ name: "MS_EN-US_ZIRA", priority: 3, language: "ENU" },
{ name: "MS_EN-GB_HAZEL", priority: 4, language: "ENU" },
{ name: "MSSam", priority: 3, language: "ENU" },
{ name: "MSAnna", priority: 3, language: "ENU" },
{ name: "MS-Anna", priority: 3, language: "ENU" },
{ name: "MSMike", priority: 3, language: "ENU" },
{ name: "MSMary", priority: 3, language: "ENU" },
{ name: "MICHAEL", priority: 2, language: "ENU" },
{ name: "MICHELLE", priority: 2, language: "ENU" },
{ name: "VW Julie", priority: 1, language: "ENU" },
{ name: "Julie", priority: 1, language: "ENU" },
{ name: "Kate", priority: 1, language: "ENU" },
{ name: "Paul", priority: 1, language: "ENU" },
{ name: "Cepstral_Marta", priority: 1, language: "ESN" },
{ name: "Cepstral_David", priority: 1, language: "ENU" },
{ name: "Cepstral_Miguel", priority: 2, language: "ESN" },
{ name: "Violeta", priority: 2, language: "ESN" },
{ name: "kal_diphone", priority: 3, language: "ENU" },
{ name: "el_diphone",  priority: 3, language: "ESN" },
{ name: "ked_diphone", priority: 4, language: "ENU" },
{ name: "cmu_us_awb_arctic_hts", priority: 5, language: "ENU" },
{ name: "cmu_us_slt_arctic_hts", priority: 6, language: "ENU" },
{ name: "cmu_us_jmk_arctic_hts", priority: 7, language: "ENU" },
{ name: "cmu_us_bdl_arctic_hts", priority: 8, language: "ENU" },
{ name: "Agnes", priority: 9, language: "ENU" },
{ name: "Alex", priority: 11, language: "ENU" },
{ name: "Bruce", priority: 16, language: "ENU" },
{ name: "Fred", priority: 20, language: "ENU" },
{ name: "Junior", priority: 23, language: "ENU" },
{ name: "Kathy", priority: 24, language: "ENU" },
{ name: "Princess", priority: 26, language: "ENU" },
{ name: "Ralph", priority: 27, language: "ENU" },
{ name: "Vicki", priority: 29, language: "ENU" },
{ name: "Victoria", priority: 30, language: "ENU" },
{ name: "Rosa Infovox iVox HQ", priority: 1, language: "ESN" },
{ name: "Heather Infovox iVox HQ", priority: 1, language: "ENU" },
{ name: "Javier", priority: 9, language: "ESN" },
{ name: "Monica", priority: 9, language: "ESN" },
{ name: "Paulina", priority: 9, language: "ESN" },
{ name: "US English Female TTS (by google)", priority: 9, language: "ENU" },
{ name: "Chrome OS US English Voice", priority: 9, language: "ENU" },
{ name: "native", priority: 9, language: "ENU" },
{ name: "Chrome OS US English", priority: 9, language: "ENU" },
{ name: "android", priority: 9, language: "ENU" },
{ name: "julie", priority: 9, language: "ENU" },
{ name: "violeta", priority: 9, language: "ESN" },
{ name: "eng", priority: 9, language: "ENU" },
{ name: "spa", priority: 9, language: "ESN" }
],
getVoices: function () {
if (window.TDS && TDS.Config && TDS.Config.voicePacks && TDS.Config.voicePacks.length) {
return TDS.Config.voicePacks;
} else {
return TTS.Config.DefaultVoices;
}
}
};

/* SOURCE FILE: util.js (f1c3c6dc) 9/9/2014 2:09:05 PM */

YUD = YAHOO.util.Dom;
TTS.Util = {
createDiv: function(strOrHtml) {
var newdiv = document.createElement('div');
newdiv.innerHTML = strOrHtml || '';
return newdiv;
},
getSub: function(elmObj, attrTag, lang) {
if (!elmObj) {
return;
}
lang = lang || 'ENU';
attrTag = attrTag || 'ssml';
if (elmObj.nodeName == 'SPAN') {
if (YUD.hasClass(elmObj, 'tts') || YUD.hasClass(elmObj, 'TTS')) {
if (elmObj.attributes != null && elmObj.attributes.getNamedItem("ssml") != null) {
var ssmlType = elmObj.attributes.getNamedItem("ssml").nodeValue;
if (ssmlType == "sub") {
var ssmlAlias = "";
if (elmObj.attributes.getNamedItem(attrTag) != null) {
ssmlAlias = elmObj.attributes.getNamedItem(attrTag).nodeValue;
}
return ssmlAlias + " ";
}
}
}
} else if (elmObj.nodeName == 'INPUT') {
if (YUD.hasClass(elmObj, 'tts')) {
if (elmObj.attributes != null && elmObj.attributes.getNamedItem(lang) != null) {
return elmObj.attributes.getNamedItem(lang).nodeValue + ' ';
}
}
}
return null;
},
ignore: function(node) {
if (node && YUD.getAttribute(node, 'data-tts-skip') == 'true') {
return true;
}
},
sanitizeLang: function(lang) {
if (lang == 'ENU') {
return 'en-us';
} else if (lang == 'ESN') {
return 'es-mx';
}
},
markLang: function(node, lang) {
if (node && node.nodeType != 3 && lang) {
YUD.setAttribute(node, 'lang', lang);
}
},
isLang: function(node, lang) {
lang = TTS.Util.sanitizeLang(lang);
if (TTS.Util.getLang(node) == lang) {
return true;
}
return false;
},
getLang: function(node) {
if (node) {
if (node.nodeType == 3) {
return TTS.Util.getLang(node.parentNode);
} else {
return YUD.getAttribute(node, 'lang');
}
}
},
hasAlt: function(node) {
if (node && node.nodeType != 3) {
if (YUD.hasClass(node, 'hasAlt') || YUD.hasClass(node, 'contextAreaAlt')) {
return true;
}
}
},
hasLanguageAttr: function(node) {
if (node && node.nodeType == Node.ELEMENT_NODE && YUD.hasClass(node, 'languagedivider')) {
return node;
}
return null;
},
hasLanguageAttributes: function(domNodesArray) {
for (var i = 0; i < domNodesArray.length; ++i) {
var domNode = domNodesArray[i];
if (domNode != null && domNode.nodeType == Node.ELEMENT_NODE) {
if (YUD.hasClass(domNode, 'languagedivider')) {
return domNode;
}
}
}
return null;
},
bubble: function(node, match, results) {
results = results || {};
if (node && typeof match == 'function') {
if (match(node)) {
results.node = node;
} else if (node.parentNode && node.nodeName != "BODY" && node.nodeName != 'IFRAME') {
TTS.Util.bubble(node.parentNode, match, results);
}
}
return results.node;
},
dfs: function(nodes, match, results) {
if (!nodes) {
return;
}
results = results || {};
for (var i = 0; i < nodes.length; ++i) {
var node = nodes[i];
if (results.node) {
break;
} else if (match(node)) {
results.node = node;
break;
} else {
TTS.Util.dfs(node.childNodes, match, results);
}
}
return results.node;
},
cleanText: function(text, addHacks) {
text = text.replace(/"/g, " ");
text = text.replace(/\u201C/g, " ");
text = text.replace(/\u201D/g, " ");
text = text.replace(/\u2019/g, "'");
if (TTS.Config.shouldSanitizeTextForTTS()) {
text = text.replace(/[^\u0000-\u0081\u00C1\u00E1\u00C9\u00E9\u00CD\u00ED\u00D1\u00F1\u00D3\u00F3\u00DA\u00FA\u00DC\u00FC\u00AB\u00BB\u00BF\u00A1\u2047]+/g, "");
}
if (text != null && text != '' && addHacks) {
text = TTS.Util.addTagsAndHacks(text);
}
text = text.replace(/{silence}/g, "{silence:200}");
if (Util.Browser.isWindows()) {
text = text.replace(/{silence:([0-9]+)}/g, ',<silence msec="$1"/>');
} else if (Util.Browser.isMac()) {
text = text.replace(/\u00A0/g, " ");
text = text.replace(/{silence:([0-9]+)}/g, "[[slnc $1]]");
} else {
text = text.replace(/{silence:([0-9]+)}/g, " ; ");
}
return text;
},
replaceLeadDirectives: function (text) {
var replaceText = function (expString, target) {
var exp = new RegExp(expString);
var prefix = TTS.Util.getTTSPrefix();
var prefixRegExp = new RegExp('^' + prefix + '\\s*' + expString);
var replacement = prefixRegExp.exec(target);
if (replacement && replacement[0]) {
var spaces = exp.exec(replacement[0]);
if (spaces && spaces[0]) {
spaces = spaces[0].replace(/\S/g, ' ');
replacement = replacement[0].replace(exp, spaces);
}
}
target = target.replace(prefixRegExp, replacement);
return target;
};
var expString = ';';
text = replaceText(expString, text);
expString = ',<silence msec="[0-9]*"\/>';
text = replaceText(expString, text);
return text;
},
shortenSilence: function (text) {
if (Util.Browser.isWindows()) {
var shortenSilence = text.split('/>');
var filteredSilence = /<silencemsec="200"/g;
var silence = /<silence msec="200"/g;
for (var i = shortenSilence.length - 1 ; i > 0; i--) {
var filteredShortenSilence = i > 0 ? shortenSilence[i - 1].replace(/[ ,]/g, '') : null;
if (filteredShortenSilence && filteredShortenSilence.search(filteredSilence) == 0) {
shortenSilence[i] = shortenSilence[i].replace(silence, '<silence msec="1"  ');
}
}
text = shortenSilence.join('/>');
} else if (Util.Browser.isMac()) {
shortenSilence = text.split(']]');
filteredSilence = /\[\[slnc200/g;
silence = /\[\[slnc 200/g;
for (i = shortenSilence.length - 1 ; i > 0; i--) {
filteredShortenSilence = i > 0 ? shortenSilence[i - 1].replace(/[ ,]/g, '') : null;
if (filteredShortenSilence && filteredShortenSilence.search(filteredSilence) == 0) {
shortenSilence[i] = shortenSilence[i].replace(silence, '[[slnc 1  ');
}
}
text = shortenSilence.join(']]');
}
return text;
},
getTTSPrefix: function () {
var text = '';
if (Util.Browser.isWindows()) {
return '<bookmark mark="start"/> ';
} else if (Util.Browser.isMac()) {
text = "[[sync 0x000000A1]] ";
}
return text;
},
getTTSPostscript: function() {
var text = '';
if (Util.Browser.isMac()) {
text = " [[sync 0x000000A2]]";
}
return text;
},
getDisplayType: function(element) {
if (element.nodeType != Node.ELEMENT_NODE) {
return 'inline';
}
var cStyle = element.currentStyle || window.getComputedStyle(element, "");
return cStyle.display;
}
};

/* SOURCE FILE: tts.js (b94ff2a9) 10/26/2014 1:27:05 PM */

TTS.Status = {
NotSupported: 'NotSupported',
Uninitialized: 'Uninitialized',
Initializing: 'Initializing',
Stopped: 'Stopped',
Playing: 'Playing',
Paused: 'Paused',
Unknown: 'Unknown'
};
TTS.VoicePack = function(voicename, priority, language, available, isDefault){
this.Voicename = voicename;
this.Priority = priority;
this.Language = language;
this.Available = available;
this.IsDefault = isDefault;
};
TTS.Manager ={
Events: {
onServiceLoad: new YAHOO.util.CustomEvent('onServiceLoad', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onInitSuccess: new YAHOO.util.CustomEvent('onInitSuccess', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onInitFailure: new YAHOO.util.CustomEvent('onInitFailure', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onStatusChange: new YAHOO.util.CustomEvent('onStatusChange', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onVolumeChange: new YAHOO.util.CustomEvent('onVolumeChange', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onPitchChange: new YAHOO.util.CustomEvent('onPitchChange', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onRateChange: new YAHOO.util.CustomEvent('onRateChange', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onVoiceChange: new YAHOO.util.CustomEvent('onVoiceChange', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onError: new YAHOO.util.CustomEvent('onError', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onWord: new YAHOO.util.CustomEvent('onWord', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT),
onLog: new YAHOO.util.CustomEvent('onLog', TTS.Manager, false, YAHOO.util.CustomEvent.FLAT)
},
_debugging: false,
_service: null,
_lastStatus: TTS.Status.Uninitialized,
_lastVolume: -1,
_lastPitch: -1,
_lastRate: -1,
_lastVoice: null,
_lastVoiceLanguage: null,
_serviceEvents: ['play', 'pause', 'resume', 'stop', 'setVolume', 'setVoice'],
_statusPollingTimer: null,
_statusPollingInterval: 0,
_statusPollingIntervalActive: 500,
_statusPollingIntervalIdle: 30000,
_statusPollingMinActive: 3000,
_statusPollingDateActive: null,
_volumeFix: false,
_knownVoicePacks: [],
_knownLanguages: {},
_initialized: false
};
TTS.Manager._addKnownLanguage = function(languageCode) {
languageCode = languageCode.toUpperCase();
TTS.Manager._knownLanguages[languageCode] = languageCode;
};
TTS.Manager.isKnownLanguage = function(languageCode) {
languageCode = languageCode.toUpperCase();
if (TTS.Manager._knownLanguages[languageCode] != null) {
return true;
}
return false;
};
TTS.Manager.log = function(message) {
if (TTS.Manager._debugging) {
Util.log(message);
}
TTS.Manager.Events.onLog.fire(message);
};
TTS.Manager.init = function (forceInit) {
TTS.Manager.Events.onServiceLoad.subscribe(function(service){
var initSuccess = false;
initSuccess = TTS.Manager._initService(service);
if (!initSuccess){
TTS.Manager._lastStatus = TTS.Status.NotSupported;
TTS.Manager.Events.onInitFailure.fire();
}else{
TTS.Manager._initialized = true;
}
});
if (forceInit != true){
if (TTS.Manager.getStatus() != TTS.Status.Uninitialized) {
return;
}
}else{
TTS.Manager._service = null;
delete TTS.Manager._service;
TTS.Manager._changeStatus(TTS.Status.Uninitialized);
TTS.Manager.Events.onServiceLoad.unsubscribeAll();
}
try{
var service = null;
if (Util.Browser.isSecure() && Util.Browser.getSecureVersion() > 0 &&
YAHOO.lang.isFunction(TTSService_SB) && !Util.Browser.isMobile()) {
service = new TTSService_SB();
}
else if (typeof TTSService_Applet != 'undefined' && YAHOO.lang.isFunction(TTSService_Applet)){
service = new TTSService_Applet();
}
else if (Util.Browser.isSecure() && (Util.Browser.isAndroid() || (Util.Browser.isIOS() && (Util.Browser.getSecureVersion() >= 2)))) {
service = new TTSService_Generic();
}
else if (Util.Browser.isSecure() && Util.Browser.isChrome()) {
service = new TTSService_Chrome();
}
if (!service || !service.isSupported()){
TTS.Manager._changeStatus(TTS.Status.NotSupported);
return false;
}
TTS.Manager._service = service;
TTS.Manager.log('initializing');
TTS.Manager._changeStatus(TTS.Status.Initializing);
if (!service || !service.load()) {
return false;
}
} catch (ex) {
console.error("Failed to load a service.", ex);
TTS.Manager.log(ex);
}
return;
};
TTS.Manager._initService = function() {
TTS.Manager._initializeAvailableVoices();
TTS.Manager._updateStatus();
TTS.Manager.loadUserSettings();
TTS.Manager.Events.onInitSuccess.fire();
TTS.Manager._lastVolume = TTS.Manager.getVolume();
TTS.Manager.Events.onVolumeChange.fire(TTS.Manager._lastVolume);
TTS.Manager._lastPitch = TTS.Manager.getPitch();
TTS.Manager.Events.onPitchChange.fire(TTS.Manager._lastPitch);
TTS.Manager._lastRate = TTS.Manager.getRate();
TTS.Manager.Events.onRateChange.fire(TTS.Manager._lastRate);
TTS.Manager._lastVoice = TTS.Manager.getVoice();
TTS.Manager.Events.onVoiceChange.fire(TTS.Manager._lastVoice);
var service = TTS.Manager._service;
if(service && service.subscribe){
TTS.Manager._service.subscribe(TTS.Manager.Events.onWord);
}
return true;
};
TTS.Manager._serviceFuncExists = function (functionName){
if (TTS.Manager._service == null) {
return false;
}
return (typeof(TTS.Manager._service[functionName]) == 'function');
};
TTS.Manager.getStatus = function(){
if (!TTS.Manager._serviceFuncExists('getStatus')) {
return TTS.Manager._lastStatus;
}
try{
return TTS.Manager._service.getStatus();
}catch (ex){
return TTS.Status.Unknown;
}
};
TTS.Manager.supportsVolumeControl = function () {
if (!TTS.Manager._serviceFuncExists('supportsVolumeControl')) {
return false;
} else {
return TTS.Manager._service.supportsVolumeControl();
}
};
TTS.Manager.supportsPitchControl = function () {
if (!TTS.Manager._serviceFuncExists('supportsPitchControl')) {
return false;
} else {
return TTS.Manager._service.supportsPitchControl();
}
};
TTS.Manager.supportsRateControl = function () {
if (!TTS.Manager._serviceFuncExists('supportsRateControl')) {
return false;
} else {
return TTS.Manager._service.supportsRateControl();
}
};
TTS.Manager.play = function (text, language){
language = language || 'ENU';
var played = false;
try{
if (text == null || text.length == 0){
return false;
}
if(!TTS.Manager._serviceFuncExists('play')){
return false;
}
if(!TTS.Manager.isLanguageSupported(language)){
return false;
}
var currentStatus = TTS.Manager.getStatus();
if (currentStatus == TTS.Status.Playing){
return false;
}
if (currentStatus == TTS.Status.Unknown) {
TTS.Manager.stop();
}
TTS.Manager.setVoiceForLanguage(language);
played = TTS.Manager._service.play(text);
if (currentStatus != TTS.Status.Unknown) {
TTS.Manager._statusPollingDateActive = new Date();
TTS.Manager._statusPollingInterval = TTS.Manager._statusPollingIntervalActive;
TTS.Manager._updateStatus();
}
}catch(ex) {
console.error("Failed to play the sound.", ex);
TTS.Manager.log(ex);
}
return played;
};
TTS.Manager.stop = function() {
if (!TTS.Manager._serviceFuncExists('stop')) {
return false;
}
var currentStatus = TTS.Manager.getStatus();
if (currentStatus != TTS.Status.Playing && currentStatus != TTS.Status.Unknown && currentStatus != TTS.Status.Paused) {
return false;
}
try {
return TTS.Manager._service.stop();
} catch(ex) {
TTS.Manager.log(ex);
return false;
}
};
TTS.Manager.pause = function(){
if (!TTS.Manager._serviceFuncExists('pause')) {
return false;
}
if (TTS.Manager.getStatus() != TTS.Status.Playing) {
return false;
}
return TTS.Manager._service.pause();
};
TTS.Manager.resume = function () {
if (!TTS.Manager._serviceFuncExists('resume')) {
return false;
}
if (TTS.Manager.getStatus() != TTS.Status.Paused) {
return false;
}
if (TTS.Manager.getStatus() != TTS.Status.Unknown) {
TTS.Manager._statusPollingDateActive = new Date();
TTS.Manager._statusPollingInterval = TTS.Manager._statusPollingIntervalActive;
TTS.Manager._updateStatus();
}
return TTS.Manager._service.resume();
};
TTS.Manager.getVoices = function(){
if (!TTS.Manager._serviceFuncExists('getVoices')) {
return [];
}
var voices = TTS.Manager._service.getVoices();
TTS.Config.Debug && console.log("getVoice call returned.", voices, TTS.Manager._service);
return voices;
};
TTS.Manager.getVoice = function(){
if (!TTS.Manager._serviceFuncExists('getVoice')) {
return null;
}
return TTS.Manager._service.getVoice();
};
TTS.Manager.loadUserSettings = function(){
try{
if (!Util || !Util.Storage) {
return;
}
var curLang;
var curVoicePack = TTS.Manager.getCurrentVoicePack();
if (curVoicePack) {
curLang = curVoicePack.Language;
}
TTS.Manager.setVolume(TTS.Config.User.getVolume(curLang));
TTS.Manager.setPitch(TTS.Config.User.getPitch(curLang));
TTS.Manager.setRate(TTS.Config.User.getRate(curLang));
var langCodes = TTS.Manager.getKnownLanguageCodes();
for (var i = 0; i < langCodes.length; i++) {
var langVoicePref = TTS.Config.User.getVoice(langCodes[i]);
if(langVoicePref) {
TTS.Config.Debug && console.log("Setting a user preference for the language.", langVoicePref);
var voicePacks = TTS.Manager.getVoicesForLanguage(langCodes[i]);
for (var j = 0; j < voicePacks.length; j++) {
var voicePack = voicePacks[j];
if (voicePack.ServiceVoiceName == langVoicePref){
TTS.Manager.setAsPreferredVoicePack(voicePack);
TTS.Manager.setVoice(voicePack.ServiceVoiceName);
}
}
}
}
}catch(e){
console.error("Failed to load user settings.", e);
}
};
TTS.Manager.setVoice = function (name) {
if (!TTS.Manager._serviceFuncExists('setVoice')) {
return null;
}
if (!YAHOO.util.Lang.isString(name)) {
throw new Error('Invalid voice name');
}
try {
TTS.Manager._service.setVoice(name);
TTS.Manager.Events.onVoiceChange.fire(name);
} catch(ex) {
console.error("Failed to set the voice.", name);
}
};
TTS.Manager.getVolume = function() {
if (!TTS.Manager._serviceFuncExists('getVolume')) {
return -1;
}
return TTS.Manager._service.getVolume();
};
TTS.Manager.setVolume = function(level) {
if (!TTS.Manager._serviceFuncExists('setVolume')) {
return false;
}
if (!YAHOO.util.Lang.isNumber(level)) {
throw new Error('Invalid volume level: value=' + level + ' type=' + typeof level);
}
try{
TTS.Manager._service.setVolume(level);
TTS.Manager.Events.onVolumeChange.fire(level);
}catch (ex){
console.error("Failed to set the volume.", ex, level);
}
};
TTS.Manager.increaseVolume = function() {
var current = TTS.Manager.getVolume();
if (current == 10) {
return false;
} else {
TTS.Manager.setVolume(current + 1);
}
return true;
};
TTS.Manager.decreaseVolume = function() {
var current = TTS.Manager.getVolume();
if (current == 0) {
return false;
} else {
TTS.Manager.setVolume(current - 1);
}
return true;
};
TTS.Manager.getPitch = function() {
if (!TTS.Manager._serviceFuncExists('getPitch')) {
return -1;
}
return TTS.Manager._service.getPitch();
};
TTS.Manager.setPitch = function(level) {
if (!TTS.Manager._serviceFuncExists('setPitch')) {
return false;
}
if (!YAHOO.util.Lang.isNumber(level)) {
throw new Error('Invalid pitch level: value=' + level + ' type=' + typeof level);
}
try{
TTS.Manager._service.setPitch(level);
TTS.Manager.Events.onPitchChange.fire(level);
} catch(ex) {
console.error("Failed to set the pitch", ex, level);
TTS.Manager.log(ex);
}
};
TTS.Manager.getRate = function() {
if (!TTS.Manager._serviceFuncExists('getRate')) {
return -1;
}
return TTS.Manager._service.getRate();
};
TTS.Manager.setRate = function(level) {
if (!TTS.Manager._serviceFuncExists('setRate')) {
return false;
}
if (!YAHOO.util.Lang.isNumber(level)) {
throw new Error('Invalid rate level: value=' + level + ' type=' + typeof level);
}
try{
TTS.Manager._service.setRate(level);
TTS.Manager.Events.onRateChange.fire(level);
}catch(ex){
console.error("Failed to set the TTS Manager Rate information.", ex, level);
TTS.Manager.log(ex);
}
};
TTS.Manager.isAvailable = function() {
var ttsStatus = TTS.Manager.getStatus();
return ttsStatus == TTS.Status.Stopped || ttsStatus == TTS.Status.Playing || ttsStatus == TTS.Status.Paused;
};
TTS.Manager._updateStatus = function() {
if (TTS.Manager._statusPollingTimer != null) {
TTS.Manager._statusPollingTimer.cancel();
}
var currentStatus = TTS.Manager.getStatus();
if (currentStatus != TTS.Manager._lastStatus) {
this._changeStatus(currentStatus);
}
if (currentStatus == TTS.Status.Playing) {
TTS.Manager._statusPollingInterval = TTS.Manager._statusPollingIntervalActive;
} else if (currentStatus == TTS.Status.Stopped || currentStatus == TTS.Status.Paused) {
var diffPollingActive = (new Date() - (TTS.Manager._statusPollingDateActive || 0));
if (TTS.Manager._statusPollingMinActive == 0 || diffPollingActive > TTS.Manager._statusPollingMinActive) {
TTS.Manager._statusPollingDateActive = null;
TTS.Manager._statusPollingInterval = TTS.Manager._statusPollingIntervalIdle;
}
}
if (this._statusPollingInterval > 0) {
TTS.Manager._statusPollingTimer = YAHOO.lang.later(this._statusPollingInterval, TTS.Manager, TTS.Manager._updateStatus);
}
};
TTS.Manager._changeStatus = function(currentStatus) {
TTS.Manager._lastStatus = currentStatus;
if (currentStatus == TTS.Status.Playing && !TTS.Manager._volumeFix) {
if (!TTS.Manager._volumeFix) {
var volume = TTS.Manager._lastVolume > 0 ? TTS.Manager._lastVolume : 10;
TTS.Manager.setVolume(volume);
TTS.Manager._volumeFix = true;
}
}
TTS.Manager.Events.onStatusChange.fire(currentStatus);
};
TTS.Manager._initializeAvailableVoices = function () {
var availableVoices = TTS.Manager.getVoices();
TTS.Config.Debug && console.log("TTS.Manager Available Voices: ", availableVoices);
if (availableVoices == null || typeof (availableVoices) == 'undefined') {
return;
}
for (var counter1 = 0; counter1 < TTS.Manager._knownVoicePacks.length; ++counter1) {
var voicePackElement = TTS.Manager._knownVoicePacks[counter1];
for (var counter2 = 0; counter2 < availableVoices.length; ++counter2) {
var availableVoice = availableVoices[counter2];
var availableVoiceLower = availableVoice.toLowerCase();
var voicePackVoiceNameLower = voicePackElement.Voicename.toLowerCase();
if (availableVoiceLower.indexOf(voicePackVoiceNameLower, 0) >= 0) {
voicePackElement.Available = true;
voicePackElement.ServiceVoiceName = availableVoice;
break;
}
}
}
var defaultVoice = TTS.Manager.getVoice();
for (var counter1 = 0; counter1 < TTS.Manager._knownVoicePacks.length; ++counter1) {
var voicePackElement = TTS.Manager._knownVoicePacks[counter1];
if (defaultVoice.indexOf(voicePackElement.Voicename, 0) >= 0) {
voicePackElement.IsDefault = true;
voicePackElement.Priority = 1;
} else {
voicePackElement.IsDefault = false;
voicePackElement.Priority = voicePackElement.Priority + 1;
}
}
};
TTS.Manager.clearVoicePacks = function() {
TTS.Manager._knownVoicePacks = [];
};
TTS.Manager.registerVoicePack = function (voicename, priority, language) {
TTS.Manager._knownVoicePacks.push(new TTS.VoicePack(voicename, priority, language, false, false));
TTS.Manager._addKnownLanguage(language);
};
TTS.Manager.getVoicesForLanguage = function (language) {
var availableVoices = TTS.Manager.getVoices();
var availableVoicesForLanguage = [];
if (availableVoices == null || typeof (availableVoices) == 'undefined') {
return;
}
for (var counter = 0; counter < TTS.Manager._knownVoicePacks.length; ++counter) {
var voicePackElement = TTS.Manager._knownVoicePacks[counter];
if (voicePackElement.Language == language && voicePackElement.Available) {
availableVoicesForLanguage.push(voicePackElement);
}
}
return availableVoicesForLanguage;
};
TTS.Manager.getVoiceForLanguage = function(language) {
var defaultVoice = null;
var selectedVoice = new TTS.VoicePack(null, 100, null, false, false);
for (var counter1 = 0; counter1 < TTS.Manager._knownVoicePacks.length; ++counter1) {
var thisVoice = TTS.Manager._knownVoicePacks[counter1];
if (thisVoice.IsDefault) {
defaultVoice = thisVoice;
}
if (thisVoice.Language == language && thisVoice.Available) {
if (selectedVoice.Priority > thisVoice.Priority) {
selectedVoice = thisVoice;
}
}
}
if (!selectedVoice.Available) {
selectedVoice = defaultVoice;
}
return selectedVoice;
};
TTS.Manager.setVoiceForLanguage = function (language) {
var selectedVoice = TTS.Manager.getVoiceForLanguage(language);
var currentVoicePack = TTS.Manager.getCurrentVoicePack();
if (!selectedVoice || selectedVoice == currentVoicePack) {
return;
} else {
if (currentVoicePack && (selectedVoice.Language == currentVoicePack.Language)) {
if (selectedVoice.ServiceVoiceName != TTS.Manager.getCurrentVoicePack().ServiceVoiceName) {
selectedVoice = TTS.Manager.getCurrentVoicePack();
}
}
}
TTS.Manager.setVoice(selectedVoice.ServiceVoiceName);
TTS.Manager.setVolume(TTS.Config.User.getVolume(language));
TTS.Manager.setPitch(TTS.Config.User.getPitch(language));
TTS.Manager.setRate(TTS.Config.User.getRate(language));
TTS.Manager._lastVoiceLanguage = language;
};
TTS.Manager.getCurrentVoicePack = function () {
var voiceName = TTS.Manager.getVoice();
for (var i = 0; i < TTS.Manager._knownVoicePacks.length; i++) {
var voicePack = TTS.Manager._knownVoicePacks[i];
if (voiceName.toLowerCase().indexOf(voicePack.Voicename.toLowerCase()) >= 0) {
return voicePack;
}
}
return null;
};
TTS.Manager.isLanguageSupported = function(languageCode) {
for (var counter1 = 0; counter1 < TTS.Manager._knownVoicePacks.length; ++counter1) {
var thisVoice = TTS.Manager._knownVoicePacks[counter1];
if (thisVoice.Language == languageCode && thisVoice.Available) {
return true;
}
}
return false;
};
TTS.Manager.getKnownLanguageCodes = function() {
var languages = [];
for (var lang in TTS.Manager._knownLanguages) {
languages.push(lang);
}
return languages;
};
TTS.Manager.setAsPreferredVoicePack = function(voicePack) {
if (voicePack.Available) {
voicePack.Priority = 0;
}
};
TTS.Manager.Events.onStatusChange.subscribe(function(currentStatus){
var getStatusName = function(status){
if (status == TTS.Status.Stopped) {
return 'Stopped';
} else if (status == TTS.Status.Playing) {
return 'Playing';
} else if (status == TTS.Status.Paused) {
return 'Paused';
}
return 'Uninitialized';
};
TTS.Manager.log('status change: \'' + getStatusName(currentStatus) + '\'');
});
TTS.Manager.Events.onVolumeChange.subscribe(function(volume) {
TTS.Manager.log('volume change - ' + volume);
});
TTS.Manager.Events.onVoiceChange.subscribe(function(voice) {
TTS.Manager.log('voice change - \'' + voice + '\'');
});
TTSManager = TTS.Manager;
TTSStatus = TTS.Status;

/* SOURCE FILE: control.js (2f7c1ba8) 9/9/2014 2:09:05 PM */

TDS = window.TDS || {};
TTS = window.TTS || {};
TTS.version = 2.0;
TTS.Store = TTS.Store || {
count: 0,
Instances: {}
};
TTS.Singleton = null;
TTS.createSingleton = function (NoInit) {
if (!TTS.Singleton) {
var cfg = JSON.parse(JSON.stringify(TTS.Config));
cfg.NoInit = NoInit;
TTS.Singleton = new TTS.Control(cfg);
TTS.Singleton.init();
}
}
TTS.getInstance = function (NoInit) {
if (!TTS.Singleton) {
TTS.createSingleton(NoInit);
}
return TTS.Singleton;
};
TTS.Control = function(cfg) {
var _cfg = cfg || JSON.parse(JSON.stringify(TTS.Config));
var _eM = this.getEventManager();
var _highObj = new TTS.Parse.Highlighter();
var _manager = null;
this.languageManager = new TTS.Parse.LanguageManager();
var _currentDomEntity = null;
_highObj.subscribe(_eM);
this.getConfig = function(){
return _cfg;
};
this.getHighlighter = function() {
return _highObj;
};
var getManager = function () {
if (!_manager) {
_manager = window[_cfg.DefaultManager] || window.TTS.Manager;
}
return _manager;
};
this.getCurrentDomEntity = function(){
return _currentDomEntity;
};
this.setCurrentDomEntity = function(node) {
_currentDomEntity = node;
};
this.getMarkedLanguage = function (node, failIfNotFound) {
if (!node) {
return null;
}
if ((node.nodeType == 3) || (node.nodeType == 4) || (node.nodeType == 8)) {
return this.getMarkedLanguage(node.parentNode);
}
var language = node.getAttribute('lang');
if (language) {
return language;
} else {
if (failIfNotFound) return null;
var entity = this.getCurrentDomEntity();
if (entity) {
this.languageManager.addLanguageTags(entity.getElement());
}
return this.getMarkedLanguage(node, true);
}
};
this.init = function (cb) {
if (_cfg.NoInit) return;
this.eventSubscribe(cb);
this.OSHacks();
this.registerVoices(TTS.Config.getVoices());
getManager().init();
};
var removeHighlighter = function () {
if (_highObj) {
_highObj.unsubscribe();
_highObj = null;
}
};
TTS.Store.Instances[TTS.Store.count++] = this;
};
TTS.Control.prototype.runOnInit = function(cb){
if(typeof cb != 'function'){return;}
var state = TTS.Manager.getStatus();
if(TTS.Manager._initialized ||state == TTS.Status.NotSupported){
cb(state);
}else{
this.getEventManager().onInitSuccess.subscribe(cb);
}
};
TTS.Control.prototype.isLanguageSupported = function(langCode){
return TTS.Manager.isLanguageSupported(langCode);
};
TTS.Control.prototype.getVoicesForLanguage = function(lang){
lang = lang || TTS.Config.Lang.ENU.Code;
return TTS.Manager.getVoicesForLanguage(lang);
};
TTS.Control.prototype.getVoiceForLanguage = function(lang){
lang = lang || TTS.Config.Lang.ENU.Code;
return TTS.Manager.getVoiceForLanguage(lang);
};
TTS.Control.prototype.getStatus = function(){
return TTS.Manager.getStatus();
};
TTS.Control.prototype.getVoice = function(){
return TTS.Manager.getVoice();
};
TTS.Control.prototype.getVoices = function(){
return TTS.Manager.getVoices();
};
TTS.Control.prototype.registerVoices = function (voices) {
voices = voices || TTS.Config.getVoices();
if (!voices || !voices.length) { return; }
TTS.Manager.clearVoicePacks();
for (var i = 0; i < voices.length; i++) {
var voicePack = voices[i];
TTS.Manager.registerVoicePack(voicePack.name, voicePack.priority, voicePack.language);
}
if (TTS.Manager._initialized) {
TTS.Manager._initializeAvailableVoices();
}
};
TTS.Control.prototype.setManager = function (manager) {
this._manager = manager;
};
TTS.Control.prototype.OSHacks = function () {
if (Util.Browser.isLinux()) {
this.speak = function (text, language){
TTS.Manager.play(text, language);
};
} else {
this.speak = function (text, language){
setTimeout(function () {
TTS.Manager.play(text, language);
}, this.getConfig().PlayDelay || 0);
};
}
};
TTS.Control.prototype.speak = function (dom, parseType, language, selection) {
this.Error(new Error("If this is in the message, then the TTS.Manager did not init correctly."));
};
TTS.Control.prototype.eventSubscribe = function (cb) {
var eventManager = this.getEventManager();
eventManager.onStatusChange.subscribe(function (newStatus) {
TTS.Config.Debug && console.log("TTS Status Change.", newStatus);
}.bind(this));
eventManager.onInitSuccess.subscribe(function (cb) {
TTS.Config.Debug && console.log("Initializing TTS: Success.");
if (typeof cb == 'function') cb();
this.initSuccess();
}.bind(this, cb));
eventManager.onInitFailure.subscribe(function () {
console.error("Initializing TTS: Failed.");
if (typeof cb == 'function') cb();
}.bind(this, cb));
};
TTS.Control.prototype.initSuccess = function () {
try {
this.INIT_SUCCESS = true;
} catch (e) {
this.Error(e);
}
};
TTS.Control.prototype.play = function (domNode,language) {
var speakString = null;
try {
this.stop();
if (!language) language = this.getMarkedLanguage(domNode);
if (!language) language = this.languageManager.getDefaultLanguage();
var pn = new TTS.Parse.ParseNode(language, domNode);
this.playParseNode(pn,language);
} catch (e) {
this.Error(e);
}
return speakString;
};
TTS.Control.prototype.playSelection = function(sel,language){
var speakString = null;
try {
this.stop();
if (!language) language = this.languageManager.getDefaultLanguage();
var selector = new TTS.Parse.Selector(sel, language);
if (selector==null) return null;
var pn = selector.collectNodes();
this.playParseNode(pn, language);
} catch (e) {
this.Error(e);
}
return speakString;
};
TTS.Control.prototype.playParseNode = function (pn, language) {
try {
var speakString = pn.CompileSpeakString();
speakString = TTS.Util.replaceLeadDirectives(speakString);
speakString = TTS.Util.shortenSilence(speakString);
this.getHighlighter().setSpeakString(speakString, pn);
this.speak(speakString, language);
} catch (e) {
this.Error(e);
}
};
TTS.Control.prototype.hasActualWords = function (text) {
if (!text) return false;
var rslt = text.search(/[\S]/g);
return (rslt > -1);
};
TTS.Control.prototype.isPlaying = function(){
var state = TTS.Manager.getStatus();
if(state == TTS.Status.NotSupported){
return false;
}
return  state == TTS.Status.Playing || state == TTS.Status.Unknown;
};
TTS.Control.prototype.isAvailable = function(){
return TTS.Manager.isAvailable();
};
TTS.Control.prototype.resume = function(){
TTS.Manager.resume();
};
TTS.Control.prototype.stop = function ()
{
TTS.Manager.stop();
};
TTS.Control.prototype.pause = function(){
TTS.Manager.pause();
};
TTS.Control.prototype.getEventManager = function(){
return TTS.Manager.Events;
};
TTS.Control.prototype.setVoice = function(val, langs){
TTS.Manager.setVoice(val);
};
TTS.Control.prototype.setVolume = function(val){
TTS.Manager.setVolume(val);
};
TTS.Control.prototype.setRate = function(val){
TTS.Manager.setRate(val);
};
TTS.Control.prototype.setPitch = function(val){
TTS.Manager.setPitch(val);
};
TTS.Control.prototype.Error = function(exception) {
if (TTS.Config.Debug) {
console.log(exception);
}
TDS.Diagnostics.report(exception);
};

/* SOURCE FILE: parse.js (3ad29517) 9/9/2014 2:09:05 PM */

TTS = window.TTS || {};
TTS.Parse = window.TTS.Parse || {};
TTS.Parse.TTSNodeTypes = { Speak: 0, DoNotSpeak: 1, Alt: 2, CompoundSpeak: 3, ContainerWithPause: 4, Silence: 5, SpeakableInput: 6, Image: 7, Other: 8 };
TTS.Parse.ParseNode = function (lang, node, offset, startIndex, endOffset, doNotAssemble, insertPrecedingSpace) {
var _lang = lang;
var _ttsNodeType = TTS.Parse.TTSNodeTypes.Other;
var _speakString = "";
var _children = new Array();
var _offset = ((offset == null) || !(offset)) ? 0 : offset;
var _domNode = node;
var _startIndex = (startIndex == null) ? 0 : startIndex;
var _endIndex = _startIndex;
var _cutoff = null;
var _prefix = '';
var _postscript = '';
if (!(endOffset) || (endOffset == -1)) {
endOffset = null;
}
var isFirst = ((_offset == 0) && (endOffset == null));
var Debug = function(string) {
if (TTS.Config.Debug) {
console.log(string);
}
};
var assembleNode = function(node, isFirst) {
_ttsNodeType = TTS.Parse.ParseNode.classifyTTSNode(node, _offset, isFirst);
if (!TTS.Parse.nodeAccommodatesLanguage(node, _ttsNodeType, _lang)) {
createParseNodeChildren(node, 0, _endIndex, insertPrecedingSpace);
return;
}
var start = _endIndex;
var child;
var pn;
switch (_ttsNodeType) {
case TTS.Parse.TTSNodeTypes.Speak:
createSpeakableNode(node, _offset, endOffset, insertPrecedingSpace);
Debug("start: " + _startIndex + " end: " + _endIndex + " " + _speakString);
break;
case TTS.Parse.TTSNodeTypes.Alt:
_speakString = getSpeakAsText(node);
_speakString = _speakString.replace(/\s{2,}/g, ' ').trim() + ' ';
_speakString = TTS.Util.cleanText(_speakString);
_endIndex = _startIndex + _speakString.length;
Debug("start: " + _startIndex + " end: " + _endIndex + " " + _speakString);
break;
case TTS.Parse.TTSNodeTypes.Image:
_speakString = getAltText(node);
_speakString = _speakString.replace(/\s{2,}/g, ' ').trim() + ' ';
_speakString = TTS.Util.cleanText(_speakString);
_endIndex = _startIndex + _speakString.length;
Debug("start: " + _startIndex + " end: " + _endIndex + " " + _speakString);
break;
case TTS.Parse.TTSNodeTypes.DoNotSpeak:
_speakString = TTS.Util.cleanText(' {silence} ');
_endIndex = _startIndex + _speakString.length;
break;
case TTS.Parse.TTSNodeTypes.CompoundSpeak:
var nextStart = _startIndex;
var offset = _offset;
var speakText;
if (!_cutoff) {
speakText = node.nodeValue.substring(_offset);
} else {
speakText = node.nodeValue.substring(_offset, _cutoff);
}
var idx = speakText.search(/\s{2,}/);
var idx2 = speakText.search(/\S+/);
var i = 0;
while ((idx > -1) || (idx2 > -1)) {
if (idx == 0) {
if (idx2 == -1) {
pn = new TTS.Parse.ParseNode(_lang, node, offset, nextStart, -1);
speakText = '';
} else {
pn = new TTS.Parse.ParseNode(_lang, node, offset, nextStart, offset + idx2);
speakText = speakText.substring(idx2);
offset = offset + idx2;
nextStart = pn.getEndIndex();
}
} else {
if (idx == -1) {
pn = new TTS.Parse.ParseNode(_lang, node, offset, nextStart, (!_cutoff) ? -1 : _cutoff);
speakText = '';
} else {
pn = new TTS.Parse.ParseNode(_lang, node, offset, nextStart, offset + idx);
speakText = speakText.substring(idx);
offset = offset + idx;
nextStart = pn.getEndIndex();
}
}
_children[i] = pn;
i = i + 1;
idx = speakText.search(/\s{2,}/);
idx2 = speakText.search(/\S+/);
_endIndex = pn.getEndIndex();
}
Debug("wrote a compound speak");
break;
case TTS.Parse.TTSNodeTypes.ContainerWithPause:
createParseNodeChildren(node, Math.max(0, _offset - start), start, insertPrecedingSpace);
_children[_children.length] = silentParseNode(_endIndex);
_endIndex = _children[_children.length - 1].getEndIndex();
break;
case TTS.Parse.TTSNodeTypes.SpeakableInput:
createSpeakableInputNode(node, _lang);
break;
case TTS.Parse.TTSNodeTypes.Other:
createParseNodeChildren(node, Math.max(0, _offset - start), start, insertPrecedingSpace);
break;
}
};
var createParseNodeChildren = function(node, offset, start, insertSpace) {
var insertSpace = (insertSpace || (TTS.Util.getDisplayType(node) == 'block'));
var pn = null;
var child;
for (var i = 0; i < node.childNodes.length; i++) {
child = node.childNodes[i];
pn = new TTS.Parse.ParseNode(_lang, child, offset, start, null, false, insertSpace);
_children[i] = pn;
if (insertSpace) {
if (pn.getStringLength() > 0) {
insertSpace = false;
} else {
insertSpace = true;
}
}
insertSpace = insertSpace || (TTS.Util.getDisplayType(child) == 'block') || $(child).hasClass('draggable');
start = pn.getEndIndex();
_endIndex = pn.getEndIndex();
Debug("start: " + _startIndex + " end: " + _endIndex + " " + " chunk" + '--Dom Node--' + _domNode);
}
};
var silentParseNode = function(start) {
var pn = new TTS.Parse.ParseNode(_lang, null, 0, start, null, true, false);
pn.setSpeakString(" {silence} ");
return pn;
};
var createSpeakableNode = function(node, offset, endOffset, insertPrecedingSpace) {
_speakString = (insertPrecedingSpace) ? ' ' : '';
if ((offset == 0) && (endOffset == null) && (node.nodeValue.search(/\S+/) > -1)) {
_speakString += node.nodeValue;
} else {
var substring = (endOffset == null) ? node.nodeValue.substring(offset) : node.nodeValue.substring(offset, endOffset);
if (substring.search(/\S+/) > -1) {
if (endOffset == null) {
_speakString += node.nodeValue.substring(offset);
} else {
_speakString += node.nodeValue.substring(offset, endOffset);
}
} else {
_speakString += " ";
}
}
_speakString = TTS.Util.cleanText(_speakString);
_endIndex = _startIndex + _speakString.length;
if (insertPrecedingSpace) {
_startIndex = _startIndex + 1;
}
Debug("Speakable Node: " + node.nodeValue + " _speakString: " + _speakString + " start: " + _startIndex + " end: " + _endIndex);
};
var createSpeakableInputNode = function(node, lang) {
var val = node.getAttribute('value');
var ttsKey = node.getAttribute('data-tts-prefix');
if (ttsKey == null) {
ttsKey = 'TDSTTS.Speak.Option' + val;
}
_speakString = TTS.Util.cleanText(Messages.getAlt(ttsKey + "." + lang, " "));
_endIndex = _startIndex + _speakString.length;
Debug("Speakable INPUT Node: " + node.nodeValue + " _speakString: " + _speakString + " start: " + _startIndex + " end: " + _endIndex + "-Dom-" + _domNode.nodeName);
};
this.CompileSpeakString = function() {
var finalString = _prefix + _speakString;
for (var i = 0; i < _children.length; i++) {
var pn = _children[i];
var string = pn.CompileSpeakString();
finalString += string;
}
return finalString + _postscript;
};
this.getChildren = function() {
return _children;
};
this.getEndIndex = function() {
return _endIndex;
};
this.getStartIndex = function() {
return _startIndex;
};
this.getChildCount = function() {
return _children.length;
};
this.getNodeID = function() {
return _domNode.id;
};
this.getOwnerDocument = function() {
return _domNode.ownerDocument;
};
this.getStringLength = function() {
return _endIndex - _startIndex;
};
this.addChild = function(pn) {
_children[_children.length] = pn;
_endIndex = pn.getEndIndex();
};
this.setCutoff = function(cutoff) {
_cutoff = cutoff;
};
this.assembleNodeForSelector = function() {
assembleNode(_domNode, true);
};
this.setEndIndex = function(idx) {
_endIndex = idx;
};
this.setSpeakString = function(string) {
_speakString = TTS.Util.cleanText(string);
_endIndex = _startIndex + _speakString.length;
};
this.createSilentParseNode = function(start) {
return silentParseNode(start);
};
var getSpeakAsText = function(node) {
if (node.className && node.className.indexOf("TTS speakAs") >= 0) {
return node.getAttribute('ssml_alias');
}
};
var getAltText = function(node) {
var txt = node.getAttribute('alt');
return (txt) ? txt : '';
};
this.getLocation = function(idx, isStart) {
if (idx < _startIndex) {
return null;
}
if (isStart) {
if (idx >= _endIndex) {
return null;
}
} else if (idx > _endIndex) {
return null;
}
if (_startIndex == _endIndex) {
return null;
}
switch (_ttsNodeType) {
case TTS.Parse.TTSNodeTypes.Speak:
return new TTS.Parse.Location(_domNode, Math.min(idx - _startIndex + _offset, _domNode.nodeValue.length));
case TTS.Parse.TTSNodeTypes.SpeakableInput:
case TTS.Parse.TTSNodeTypes.Image:
case TTS.Parse.TTSNodeTypes.Alt:
return new TTS.Parse.Location(_domNode, null);
default:
for (var i = 0; i < _children.length; i++) {
var loc = _children[i].getLocation(idx, isStart);
if (loc != null) {
return loc;
}
}
return null;
}
};
this.containsSpeakableText = function(text) {
if (!text) {
text = this.CompileSpeakString();
}
var start = 0;
if (_prefix) {
start = _prefix.length;
}
var substring = text.substring(start);
if (_postscript) {
if (substring.length == _postscript.length) {
return false;
}
}
if (Util.Browser.isWindows()) {
substring = substring.replace(/<silence msec="([0-9]+)"\/>/g, "");
} else if (Util.Browser.isMac()) {
substring = substring.replace(/\[\[slnc ([0-9]+)\]\]/g, "");
substring = substring.substring(0, substring.length - _postscript.length);
}
var index = substring.search(/[\r\t ,.;()]*[a-zA-Z0-9]/g);
return (index > -1);
};
if (_startIndex == 0) {
_prefix = TTS.Util.getTTSPrefix();
_endIndex = _prefix.length;
_postscript = TTS.Util.getTTSPostscript();
}
if (node && YAHOO.lang.isArray(node)) {
_domNode = node[0];
var start = _endIndex;
for (var i = 0; i < node.length; i++) {
var next = node[i];
var pn = new TTS.Parse.ParseNode(_lang, next, Math.max(0, _offset - start), start, null, false, true);
_children[i] = pn;
start = pn.getEndIndex();
_endIndex = pn.getEndIndex();
Debug("start: " + _startIndex + " end: " + _endIndex + " " + " Dom Node" + _domNode);
}
doNotAssemble = true;
}
if (!doNotAssemble) {
assembleNode(node, isFirst);
}
return this;
};
TTS.Parse.ParseNode.classifyTTSNode = function (node, offset, isFirst) {
if (node.nodeType == Node.ELEMENT_NODE) {
if (node.className && node.className.indexOf("TTS speakAs") >=0) {
return TTS.Parse.TTSNodeTypes.Alt;
} else {
var skip = node.getAttribute('data-tts-skip');
if (skip && (skip == 'true')) {
return TTS.Parse.TTSNodeTypes.DoNotSpeak;
}
}
var nme = node.nodeName.toLowerCase();
switch (nme) {
case 'td':
case 'th':
case 'dt':
case 'dd':
return TTS.Parse.TTSNodeTypes.ContainerWithPause;
case 'input':
if (node.getAttribute('value') != null) {
return TTS.Parse.TTSNodeTypes.SpeakableInput;
}
case 'img':
case 'math':
return TTS.Parse.TTSNodeTypes.Image;
}
}
if (node.nodeType == 3) {
var idx = node.nodeValue.substring(offset).search(/\s{2,}\S/);
if ((idx > -1) && isFirst) {
return TTS.Parse.TTSNodeTypes.CompoundSpeak;
}
return TTS.Parse.TTSNodeTypes.Speak;
}
return TTS.Parse.TTSNodeTypes.Other;
};
TTS.Parse.ParseNode.getEnclosingAltNode = function(node) {
if (!node) {
return null;
}
if ((node.nodeType == Node.ELEMENT_NODE) && (node.className && node.className.indexOf("TTS speakAs") >= 0)) {
return node;
} else {
return TTS.Parse.ParseNode.getEnclosingAltNode(node.parentNode);
}
};
TTS.Parse.Location = function(node, offset) {
var _node = node;
var _offset = offset;
this.getNode = function() {
return _node;
};
this.getOffset = function() {
return _offset;
};
};
TTS.Parse.nodeAccommodatesLanguage = function(node, ttsNodeType, lang) {
if (ttsNodeType == TTS.Parse.TTSNodeTypes.SpeakableInput) {
return true;
}
var nodeLang = TTS.getInstance().getMarkedLanguage(node);
return ((nodeLang != null) && (nodeLang == lang));
};

/* SOURCE FILE: highlighter.js (394a8153) 10/26/2014 1:27:05 PM */

TTS = window.TTS || {};
TTS.Parse = window.TTS.Parse || {};
TTS.Parse.Highlighter = function (doc) {
var _textHighlighterClass = 'tts-highlight';
var _nonTextHighlighterClass = 'tts-highlight';
var _speakString = "";
var _parseNodeRoot = null;
var _document = doc ? doc : document;
var _wordEndingPattern = null;
var _textClassApplier = rangy.createCssClassApplier(_textHighlighterClass, { normalize: true });
var _currentRange = null;
var _chromebookOffset = 0;
var _prevStatus = null;
var Debug = function(string) {
if (TTS.Config.Debug) {
console.log(string);
}
};
var highliteRange = function (pn, start, end) {
if (pn == null || start == null || end == null) return;
clearCurrentRange();
start = pn.getLocation(start, true);
var endIndex = pn.getEndIndex();
end = end > endIndex ? endIndex : end;
end = pn.getLocation(end, false);
if(start == null || end == null) return;
var ownerDoc = pn.getOwnerDocument();
if (!ownerDoc) {
ownerDoc = document;
}
_currentRange = rangy.createRange(ownerDoc);
if (start.getOffset() != null) {
_currentRange.setStart(start.getNode(), start.getOffset());
} else {
_currentRange.setStart(start.getNode());
}
if (end.getOffset() != null) {
_currentRange.setEnd(end.getNode(), end.getOffset());
} else {
_currentRange.setEndAfter(end.getNode());
}
var state = TTS.Manager.getStatus();
if (state && state != TTS.Status.Paused) {
highlightRange(_currentRange);
}
};
var highlightRange = function (range) {
var nodes = getHighlightRangeNodes(range);
if (nodes.length == 0) {
_textClassApplier.applyToRange(range);
} else {
nodes.forEach(function (node) {
YUD.addClass(node, _nonTextHighlighterClass);
});
}
};
var unhighlightRange = function (range) {
var nodes = getHighlightRangeNodes(range);
if (nodes.length == 0) {
_textClassApplier.undoToRange(range);
} else {
nodes.forEach(function (node) {
YUD.removeClass(node, _nonTextHighlighterClass);
});
}
};
var highlightNodeNames = ['img','math','input'];
var getHighlightRangeNodes = function (range) {
return range.getNodes([1],
function (node) {
var nodeName = node.nodeName.toLowerCase();
return highlightNodeNames.filter(function(element){return element == nodeName;}).length > 0;
});
};
var clearCurrentRange = function() {
if (_currentRange == null) {
return;
}
unhighlightRange(_currentRange);
_currentRange = null;
};
TTS.Manager.Events.onStatusChange.subscribe(function (currentStatus) {
if (currentStatus && currentStatus == TTS.Status.Paused) {
if (_currentRange != null) {
unhighlightRange(_currentRange);
}
}
});
this.setSpeakString = function (speakString, pn) {
_speakString = speakString;
_parseNodeRoot = pn;
var leadingSpaces = _speakString.match(/^ +/) || [''];
_chromebookOffset = leadingSpaces[0].length + 1;
};
this.highlightCallback = function (obj1) {
if (!TTS.Config.isTrackingEnabled()) return;
var start = parseInt(obj1.index);
if (Util.Browser.isChromeOS() && Util.Browser.getChromeVersion() >= 34) {
start += _chromebookOffset;
}
var part = _speakString.substring(start);
var match = _wordEndingPattern.exec(part);
var end;
if ((match != null) && (match.length > 0)) {
end = start + match[0].length - 1;
Debug('********' + match[0] + " start: " + start + " len: " + match[0].length + " string: " + part);
} else {
end = start + part.length;
Debug("******** start: " + start + " string: " + part);
}
highliteRange(_parseNodeRoot, start, end);
};
this.statusChangeCallback = function (currentStatus) {
if (!TTS.Config.isTrackingEnabled()) return;
if (currentStatus == TTS.Status.Stopped) {
clearCurrentRange();
_speakString = "";
_parseNodeRoot = null;
}
};
this.subscribe = function (eM) {
if (eM) {
if (eM.onWord) {
eM.onWord.subscribe(this.highlightCallback);
}
if (eM.onStatusChange) {
eM.onStatusChange.subscribe(this.statusChangeCallback);
}
}
};
this.unsubscribe = function (eM) {
if (eM) {
if (eM.onWord && this.highlightCallback) {
eM.onWord.unsubscribe(this.highlightCallback);
}
if (eM.onStatusChange && this.statusChangeCallback) {
eM.onStatusChange.subscribe(this.statusChangeCallback);
}
}
};
this.setTextHighlighterClass = function(name) {
_textHighlighterClass = name;
_textClassApplier = rangy.createCssClassApplier(_textHighlighterClass, { normalize: true });
};
this.setNonTextHighlighterClass = function (name) {
_nonTextHighlighterClass = name;
};
var getWordEndingPattern = function () {
return new RegExp("[\s.;()]*[a-zA-Z0-9,\'\-]+[\r\t .:;()?]", 'm');
};
_wordEndingPattern = getWordEndingPattern();
};

/* SOURCE FILE: selector.js (9158f3e1) 9/9/2014 2:09:05 PM */

TTS = window.TTS || {};
TTS.Parse = window.TTS.Parse || {};
TTS.Parse.Selector = function (sel, lang) {
if (sel.rangeCount == 0) {
if (TTS.Config.Debug) {
}
return null;
}
var _lang = lang;
var selection = sel.getRangeAt(0);
var _start = selection.startContainer;
var altParent = TTS.Parse.ParseNode.getEnclosingAltNode(_start);
if ((altParent != null) && (altParent != _start)) {
selection.setStartBefore(altParent);
}
_start = selection.startContainer;
var _end = selection.endContainer;
var _commonAncestor = selection.commonAncestorContainer;
var _parseTreeRoot = new TTS.Parse.ParseNode(_lang, _commonAncestor, null, 0, 0, true);
var _startOffset = selection.startOffset;
var _endOffset = selection.endOffset;
var _startNodeType = TTS.Parse.ParseNode.classifyTTSNode(_start, _startOffset, true);
var _endNodeType = TTS.Parse.ParseNode.classifyTTSNode(_end, 0, true);
var _nextStart = _parseTreeRoot.getEndIndex();
var _foundStart = false;
var _foundEnd = false;
var Debug = function(string) {
if (TTS.Config.Debug) {
console.log(string);
}
};
this.collectNodes = function (node, offset) {
return _collectNodes(node, offset);
};
var _collectNodes = function (node, offset) {
if (!node) {
node = _commonAncestor;
}
if (!_foundStart) {
_foundStart = ttsSameNode(node, _start);
if (_foundStart) {
offset = _startOffset;
}
}
if (_foundStart && !_foundEnd) {
var pn = null;
var startAt = (node == _start) ? _startOffset : 0;
var ttsNodeType = TTS.Parse.ParseNode.classifyTTSNode(node, startAt, true);
switch (ttsNodeType) {
case TTS.Parse.TTSNodeTypes.Speak:
if (differentLanguage(node)) {
break;
}
if (ttsSameNode(node, _end)) {
pn = new TTS.Parse.ParseNode(_lang, node, offset, _nextStart, _endOffset, null, true);
} else {
pn = new TTS.Parse.ParseNode(_lang, node, offset, _nextStart, null, null, true);
}
break;
case TTS.Parse.TTSNodeTypes.CompoundSpeak:
if (differentLanguage(node)) {
break;
}
pn = new TTS.Parse.ParseNode(_lang, node, startAt, _nextStart, null, true);
if (node == _end) {
pn.setCutoff(_endOffset);
}
pn.assembleNodeForSelector();
break;
case TTS.Parse.TTSNodeTypes.Image:
case TTS.Parse.TTSNodeTypes.Alt:
if (differentLanguage(node)) {
break;
}
pn = new TTS.Parse.ParseNode(_lang, node, 0, _nextStart);
break;
case TTS.Parse.TTSNodeTypes.DoNotSpeak:
break;
case TTS.Parse.TTSNodeTypes.ContainerWithPause:
collectChildren(node, offset);
pn = _parseTreeRoot.createSilentParseNode(_nextStart);
break;
case TTS.Parse.TTSNodeTypes.SpeakableInput:
pn = new TTS.Parse.ParseNode(_lang, node, 0, _nextStart, null);
break;
case TTS.Parse.TTSNodeTypes.Other:
collectChildren(node, offset);
break;
default:
TTS.getInstance().Error(new Error('Error in TTSSelector.  Unexpected node type in collect nodes: ' + ttsNodeType));
}
if (pn != null) {
_parseTreeRoot.addChild(pn);
_nextStart = pn.getEndIndex();
}
if (pn != null) {
Debug("PN: " + pn.CompileSpeakString() + " start: " + pn.getStartIndex() + " end: " + pn.getEndIndex());
}
if (ttsSameNode(node, _end)) {
_foundEnd = true;
}
_parseTreeRoot.setEndIndex(_nextStart);
} else {
for (var j = 0; j < node.childNodes.length; j++) {
if (_foundEnd) {
return _parseTreeRoot;
}
_collectNodes(node.childNodes[j], offset);
if (ttsSameNode(node.childNodes[j], _end)) {
_foundEnd = true;
}
}
}
return _parseTreeRoot;
};
var collectChildren = function(node, offset) {
var i = 0;
if (((_startNodeType == TTS.Parse.TTSNodeTypes.Other) || (_startNodeType == TTS.Parse.TTSNodeTypes.ContainerWithPause)) && (_startOffset)) {
i = _startOffset;
}
for (i = i; i < node.childNodes.length; i++) {
_collectNodes(node.childNodes[i], offset, _foundStart);
}
};
var ttsSameNode = function(outer, other) {
if (TTS.Parse.ParseNode.classifyTTSNode(outer) == TTS.Parse.TTSNodeTypes.Alt) {
if (!outer.contains) {
var result = outer.compareDocumentPosition(other);
return !!(result & 16);
} else {
return outer.contains(other);
}
}
return (outer == other);
};
var differentLanguage = function(node) {
return (_lang != TTS.getInstance().getMarkedLanguage(node));
};
this.getParseNode = function () {
return _parseTreeRoot;
};
};

/* SOURCE FILE: languagemanager.js (d86cd483) 9/9/2014 2:09:05 PM */

TTS = window.TTS || {};
TTS.Parse = window.TTS.Parse || {};
TTS.Parse.LanguageManager = function() {
var chk = Accommodations.Manager;
this.getOtherLanguage = function (lang, standardNames) {
var defaultLang = ContentManager.getLanguage();
return (lang == defaultLang) ? this.getAltLanguage(standardNames) : (standardNames) ? standardNames(defaultLang) : defaultLang;
};
this.getDefaultLanguage = function(standardNames) {
var defaultLang = ContentManager.getLanguage();
return (standardNames) ? standardNames(defaultLang) : defaultLang;
};
this.getAltLanguage = function (standardNames) {
var defaultLang = ContentManager.getLanguage();
return (defaultLang == 'ENU') ? null : 'ENU';
};
var standardNames = function(langString) {
switch (langString) {
case 'ENU':
return 'en-us';
case 'ESN':
return 'es-mx';
default:
return langString;
}
};
};
TTS.Parse.LanguageManager.prototype.markLanguage= function(node, lang){
if (node && ((node.nodeType != 3) && (node.nodeType != 4) && (node.nodeType != 8)) && lang && !TTS.Util.hasLanguageAttr(node)) {
node.setAttribute('lang',lang);
}
};
TTS.Parse.LanguageManager.prototype.addLanguageTags = function (domNode, currentLanguage) {
if (currentLanguage == null) currentLanguage = this.getDefaultLanguage(false);
this.markLanguage(domNode, currentLanguage);
for (var i = 0; i < domNode.childNodes.length; ++i) {
var child = domNode.childNodes[i];
if (TTS.Util.hasLanguageAttr(child)) {
currentLanguage = this.getOtherLanguage(currentLanguage);
} else {
this.addLanguageTags(child, currentLanguage);
}
}
};

/* SOURCE FILE: ui.js (c904714b) 10/26/2014 1:27:05 PM */

TTS = window.TTS || {};
TTS.Config = TTS.Config || {};
TTS.Config.UI = function(cfg){
this.cfg = TTS.Config.UserSet || {};
this.setCfg(cfg);
this.DOM = {};
this.next = null;
this.back = null;
};
TTS.Config.UI.prototype.getCfg = function(){
return this.cfg;
};
TTS.Config.UI.prototype.setCfg = function(cfg){
if(!cfg){return;}
for(var key in cfg){
if(typeof cfg[key] != 'undefined' && typeof cfg[key] != 'function'){
this.cfg[key] = cfg[key];
}
}
};
TTS.Config.UI.prototype.init = function(){
var YUD = YAHOO.util.Dom;
this.section = TTS.Config.Lang.ENU.Code;
this.DOM = {
ENU:    YUD.get('englishTTSTest'),
ESN:    YUD.get('spanishTTSTest'),
ERROR:  YUD.get('checkErrorDiv'),
NONE:   YUD.get('ttsNotAvailable'),
ADJUST: YUD.get('TTS_Adjustments'),
RATE:   YUD.get('TTS_Adjust_Rate'),
VOLUME: YUD.get('TTS_Adjust_Volume'),
PITCH:  YUD.get('TTS_Adjust_Pitch'),
VOICE:      YUD.get('TTS_Select_VoicePack'),
VOICE_NAME: YUD.get('TTS_Voice_Name'),
NO_SUP: YUD.get('checkErrorDiv'),
NO_ESN: YUD.get('ESNVoicePack'),
NO_ENU: YUD.get('ENUVoicePack'),
DEFAULTS: YUD.get('TTS_Set_Defaults')
};
this.connectEvents();
this.buildSliders();
this.render();
};
TTS.Config.UI.prototype.connectEvents = function(){
var YUE = YAHOO.util.Event;
YUE.addListener('clickToHearEnglish', 'click',    this.runSpeechEnglish.bind(this));
YUE.addListener('btnSoundEnglishYes', 'click',    this.soundOK.bind(this));
YUE.addListener('btnSoundEnglishNo', 'click',     this.noSound.bind(this));
YUE.addListener('skipEnglish', 'click',           this.soundOK.bind(this));
YUE.addListener('logoutOnErrorButton', 'click',   this.gotoLogin.bind(this));
YUE.addListener('btnErrorTryAgain', 'click',      this.tryAgain.bind(this));
YUE.addListener('noAudioLogout', 'click',         this.gotoLogin.bind(this));
YUE.addListener('clickToHearSpanish', 'click',    this.runSpeechSpanish.bind(this));
YUE.addListener('btnSoundSpanishYes', 'click',    this.soundOK.bind(this));
YUE.addListener('btnSoundSpanishNo', 'click',     this.noSound.bind(this));
YUE.addListener('skipSpanish', 'click',           this.soundOK.bind(this));
YUE.addListener('continueNoAudio', 'click',       this.gotoInstructions.bind(this));
YUE.addListener('continueError', 'click',         this.soundOK.bind(this));
YUE.addListener('TTS_Set_Defaults', 'click',          this.reset.bind(this));
YUE.addListener('TTS_Select_VoicePack', 'change',     this.setVoicePack.bind(this));
};
TTS.Config.UI.prototype.buildSliders = function(){
TTS.Config.Debug && console.log("TTS: Build the sliders", this.cfg);
this.volumeSlider = YAHOO.widget.Slider.getHorizSlider(
'TTS_Adjust_Volume',
'volumeThumb',
0,
this.cfg.LengthInPixels,
25
);
this.subscribeToEvents('Volume', this.volumeSlider);
this.pitchSlider = YAHOO.widget.Slider.getHorizSlider(
'TTS_Adjust_Pitch',
'pitchThumb',
0,
this.cfg.LengthInPixels,
this.cfg.TickSize
);
this.subscribeToEvents('Pitch', this.pitchSlider);
this.rateSlider = YAHOO.widget.Slider.getHorizSlider(
'TTS_Adjust_Rate',
'rateThumb',
0,
this.cfg.LengthInPixels,
this.cfg.TickSize
);
this.subscribeToEvents('Rate', this.rateSlider);
};
TTS.Config.UI.prototype.subscribeToEvents = function (property, thisSlider) {
thisSlider.subscribe('change', function (newOffset) {
var val = this.calculateValue(property, newOffset);
document.getElementById(property + '_Value').innerHTML = val;
}.bind(this));
thisSlider.subscribe('slideEnd', function () {
try{
var language = this.getLangCode();
var value = (TTS.Config.User['get' + property])(language);
if (thisSlider.valueChangeSource == 1 || thisSlider.valueChangeSource == 3) {
value = this.calculateValue(property, thisSlider.getValue());
var func = TTS.Config.User['set' + property];
if(typeof func == 'function'){
func(value, language);
this.changed();
}
}
document.getElementById(property + '_Value').innerHTML = value.toString();
}catch(e){
console.error('Slider Error: (property, value)', property, value, e);
}
}.bind(this));
};
TTS.Config.UI.prototype.calculateValue = function (property, inputValue){
var returnValue = inputValue;
switch (property) {
case 'Volume':
returnValue = parseInt(2 + (inputValue / 25)); // volume is never supposed to be allowed to go to 0 so we establish a floor of 2. Max volume is restricted to 10
break;
case 'Pitch':
returnValue = parseInt(inputValue / this.cfg.TickSize * 2); // divide by 2 because the rate has a range from 0-20
break;
case 'Rate':
returnValue = parseInt(inputValue / this.cfg.TickSize * 2); // divide by 2 because the rate has a range from 0-20
break;
default:
break;
}
return returnValue;
};
TTS.Config.UI.prototype.getLangCode = function(){
return YAHOO.util.Dom.hasClass(this.DOM.ESN, 'hidden') ? 'ENU' : 'ESN';
};
TTS.Config.UI.prototype.reset = function(){
TTS.Config.User.reset();
this.section = 'ENU';
this.changed(true);
this.render();
};
TTS.Config.UI.prototype.render = function(){
this.hideAll();
if(!this.renderErrors()){
this.renderSections();
this.renderSliders();
this.renderVoice();
this.show(this.DOM.DEFAULTS);
}
};
TTS.Config.UI.prototype.renderErrors = function(){
var state = TTS.getInstance().getStatus();
if(state == TTS.Status.NotSupported){
this.hideAll();
this.show(this.DOM.NONE);
return true;
}
var lang = this.section;
if(!TTS.getInstance().isLanguageSupported(lang)){
this.hideAll();
this.show(this.DOM.NO_SUP);
this.show(this.DOM['NO_' + lang]);
return true;
}
}
TTS.Config.UI.prototype.renderSections = function(){
this.show(this.DOM[this.section]);
this.cfg.ShowAdjust ? this.show(this.DOM.ADJUST) : this.hide(this.DOM.ADJUST);
};
TTS.Config.UI.prototype.changed = function(checked){
this.DOM.DEFAULTS.checked = checked;
};
TTS.Config.UI.prototype.renderSliders = function(){
var YUD = YAHOO.util.Dom;
var ctn = this.DOM.ADJUST;
this.cfg.ShowAdjustments ? this.show(ctn) : this.hide(ctn);
this.cfg.ShowVolume ? this.show(this.DOM.VOLUME) : this.hide(this.DOM.VOLUME.parentNode);
this.cfg.ShowRate   ? this.show(this.DOM.RATE)   : this.hide(this.DOM.RATE.parentNode);
this.cfg.ShowPitch  ? this.show(this.DOM.PITCH)  : this.hide(this.DOM.PITCH.parentNode);
var language = this.getLangCode();
var volume = TTS.Config.User.getVolume(language);
var rate = TTS.Config.User.getRate(language);
var pitch = TTS.Config.User.getPitch(language);
TTS.Manager.setVolume(volume);
TTS.Manager.setPitch(pitch);
TTS.Manager.setRate(rate);
this.volumeSlider && this.volumeSlider.setValue(parseInt((volume - 2) * (this.cfg.LengthInPixels / 8)));
this.rateSlider && this.rateSlider.setValue(parseInt(rate * (this.cfg.LengthInPixels / 20)));
this.pitchSlider && this.pitchSlider.setValue(parseInt(pitch * (this.cfg.LengthInPixels / 20)));
};
TTS.Config.UI.prototype.show = function(els) {
if(!els){return;}
var YUD = YAHOO.util.Dom;
if(!YAHOO.lang.isArray(els)){
els = [els];
}
for(var key in els){
if(els[key] && typeof els[key] != 'function'){
YUD.removeClass(els[key], 'hidden');
}
}
};
TTS.Config.UI.prototype.hide = function(els) {
if(!els){return;}
var YUD = YAHOO.util.Dom;
if(!YAHOO.lang.isArray(els)){
els = [els];
}
for(var key in els){
if(els[key] && typeof els[key] != 'function'){
YUD.addClass(els[key], 'hidden');
}
}
};
TTS.Config.UI.prototype.hideAll = function(){
for(key in this.DOM){
YUD.addClass(this.DOM[key], 'hidden');
}
};
TTS.Config.UI.prototype.error = function(){
this.hideAll();
this.show(this.DOM.ERROR);
};
TTS.Config.UI.prototype.renderVoice = function(){
var langCode = this.getLangCode();
var ctrl     = TTS.getInstance();
var voices   = ctrl.getVoicesForLanguage(langCode);
var vPack    = ctrl.getVoiceForLanguage(langCode);
var voice = vPack ? vPack.ServiceVoiceName : null;
if (this.cfg.ShowVoicePacks) {
this.renderVoicePacks(voices, voice, langCode);
}else{
this.renderVoiceName(vPack, voice, langCode);
}
};
TTS.Config.UI.prototype.renderVoiceName = function(vPack, voice, langCode){
this.show(this.DOM.VOICE_NAME);
this.DOM.VOICE_NAME.innerHTML = vPack ? vPack.Voicename : '';
TTS.Config.User.setVoice(voice, langCode);
};
TTS.Config.UI.prototype.renderVoicePacks = function(voices, voice, langCode){
try{
var sel = this.DOM.VOICE;
sel.innerHTML = '';
this.show(this.DOM.VOICE);
for(var i=0; i<voices.length; ++i){
var vConfig = voices[i];
if(vConfig && vConfig.Available){
var option = document.createElement('option');
option.value     = vConfig.ServiceVoiceName;
option.innerHTML = vConfig.Voicename || vConfig.ServiceVoiceName;
if(voice == vConfig.ServiceVoiceName){
option.selected  = true;
TTS.Config.User.setVoice(voice, langCode);
}
sel.appendChild(option);
}
}
}catch(e){
console.error("failed to render the voice packs.", e);
}
};
TTS.Config.UI.prototype.setVoicePack = function(evt) {
this.changed();
TTS.Config.User.setVoice(this.DOM.VOICE.value);
};
TTS.Config.UI.prototype.runSpeechEnglish = function(){
TTS.Config.Debug && console.log("TTS: Run speech english");
TTS.getInstance().play(document.getElementById('englishMessageDiv'),"ENU");
};
TTS.Config.UI.prototype.runSpeechSpanish = function(){
TTS.Config.Debug && console.log("TTS: Run speech Spanish");
TTS.getInstance().play(document.getElementById('spanishMessageDiv'), 'ESN');
};
TTS.Config.UI.prototype.stopSpeech = function(){
TTS.Config.Debug && console.log("TTS: Stop speech Spanish");
TTS.getInstance().stop();
};
TTS.Config.UI.prototype.nextLang = function(){
if(this.section == 'ENU' && TTS.Config.Lang.ESN.Enabled){
this.section  = 'ESN';
this.render();
return true;
}
};
TTS.Config.UI.prototype.prevLang = function(){
if(this.section == 'ESN'){
this.section  = 'ENU';
this.render();
return true;
}
};
TTS.Config.UI.prototype.soundOK = function(){
TTS.getInstance().stop();
if(!this.nextLang()){
this.gotoInstructions();
}
};
TTS.Config.UI.prototype.noSound = function() {
console.log("No sound playing");
this.error();
};
TTS.Config.UI.prototype.tryAgain = function(){
this.reset();
};
TTS.Config.UI.prototype.gotoInstructions = function(){
if(typeof this.next == 'function'){
this.next();
}
};
TTS.Config.UI.prototype.gotoLogin = function() {
console.log("Go to the login?");
if(typeof this.back == 'function'){
this.back();
}
};

/* SOURCE FILE: menu.js (793240cb) 10/26/2014 1:27:05 PM */

var YUD = YAHOO.util.Dom;
var CFG = {
PRI: {
Label: 'TDSTTS.Label.Speak',
cb: false
},
SEC: {
Label: 'TDSTTS.Label.Speak',
cb: false
},
PRI_OP: {
Label: 'TDSTTS.Label.SpeakStemAndOptionsPrimary',
cb: false
},
SEC_OP: {
Label: 'TDSTTS.Label.SpeakStemAndOptionsSecondary',
cb: false
},
SEL_PRI: {
Label: 'TDSTTS.Label.SpeakTextPrimary',
cb: false
},
SEL_SEC: {
Label: 'TDSTTS.Label.SpeakTextSecondary',
cb: false
},
STOP: {
Label: 'TDSTTS.Label.StopSpeaking',
css: 'stopspeaking',
cb: false
},
PAUSE: {
Label: 'TDSTTS.Label.PauseSpeaking',
css: 'pausespeaking',
cb: false
},
RESUME: {
Label: 'TDSTTS.Label.ResumeSpeaking',
css: 'resumespeaking',
cb: false
},
MODE: {
Label: 'TDSTTS.Label.SpeakOption',
cb: false
},
ORDER: [
'PRI', 'SEC', 'PRI_OP', 'SEC_OP', 'SEL_PRI', 'SEL_SEC', 'STOP', 'PAUSE', 'RESUME', 'MODE'
]
};
TTS.Menu = function() {
this.hasPauseSupport = !Util.Browser.isChrome() &&
!Util.Browser.isIOS() &&
!(Util.Browser.getOSXVersion() >= 10.9 && Util.Browser.getSecureVersion() < 6.5) &&
!(Util.Browser.isAndroid() && Util.Browser.getSecureVersion() < 2);
this.assembleContent = function(cfg, node) {
if (!node) {
return;
}
var ctrl = TTS.getInstance();
if (ctrl.isPlaying()) {
return;
}
var anyNode = YAHOO.lang.isArray(node) ? node[0] : node;
var lang = ctrl.getMarkedLanguage(anyNode);
this.assembleLanguageContent(node, cfg.PRI, cfg.PRI_OP, ctrl.languageManager.getDefaultLanguage());
this.assembleLanguageContent(node, cfg.SEC, cfg.SEC_OP, ctrl.languageManager.getAltLanguage());
};
this.assembleLanguageContent = function (node, cfgLangOb, cfgLangOpOb, language) {
var ctrl = TTS.getInstance();
var pnResponseArea = null;
var pnContent = null;
cfgLangOb.cb = false;
cfgLangOb.Label = this.getDomTitle(node, cfgLangOb.Label, language);
cfgLangOb.contain = null;
cfgLangOpOb.cb = false;
cfgLangOpOb.Label = this.getDomTitle(null, cfgLangOpOb.Label, language);
cfgLangOpOb.contain = null;
if (ctrl.isLanguageSupported(language)) {
if (language && ctrl.isLanguageSupported(language)) {
pnContent = new TTS.Parse.ParseNode(language, node);
cfgLangOb.cb = this.getPlayFunction(pnContent, language);
cfgLangOb.contain = pnContent;
if (TTS.getInstance().getCurrentDomEntity() instanceof ContentItem) {
var raNode = ctrl.getCurrentDomEntity().getResponseArea();
if (raNode) {
raNode.splice(0, 0, node);
pnResponseArea = new TTS.Parse.ParseNode(language, raNode);
cfgLangOpOb.cb = this.getPlayFunction(pnResponseArea, language);
cfgLangOpOb.contain = pnResponseArea;
}
}
}
}
};
this.reset();
};
TTS.Menu.prototype.reset = function() {
this.cfg = JSON.parse(JSON.stringify(CFG));
return this.cfg;
};
TTS.Menu.prototype.getMenuCfg = function(dom, selection, win, explicitText, page, entity) {
var cfg = this.reset();
var ctrl = TTS.getInstance();
if (!ctrl.isPlaying()) {
ctrl.setCurrentDomEntity(entity);
this.assembleContent(cfg, dom);
this.checkSelection(cfg, dom, selection, win || window);
}
this.checkServiceStates(cfg);
return cfg;
};
TTS.Menu.prototype.checkAlt = function(cfg, text) {
var ctrl = TTS.getInstance();
cfg.PRI.cb = this.getPlayFunction(text, TTS.Parser.Types.HTML, this.pri);
};
TTS.Menu.prototype.getGlobalMenuCfg = function(dom, selection) {
};
TTS.Menu.prototype.checkSelection = function (cfg, dom, sel, win) {
var ctrl = TTS.getInstance();
var win = win && win.document ? win.document : win;
if (!dom || !sel || (sel.rangeCount == 0) || sel.getRangeAt(0).collapsed) {
return;
}
var priLang = ctrl.languageManager.getDefaultLanguage();
var secLang = ctrl.languageManager.getAltLanguage();
var priSelector = new TTS.Parse.Selector(sel, priLang);
var pnPrimary = (priSelector) ? priSelector.collectNodes() : null;
var pnSecondary = null;
if (secLang) {
var secSelector = new TTS.Parse.Selector(sel, secLang);
pnSecondary = (secSelector) ? secSelector.collectNodes() : null;
}
cfg.SEL_PRI.cb = this.getPlayFunction(pnPrimary, priLang);
cfg.SEL_SEC.cb = this.getPlayFunction(pnSecondary, secLang);
};
TTS.Menu.prototype.addMode = function(cfg, cb) {
cfg = cfg || this.cfg;
var ctrl = TTS.getInstance();
if (ctrl.isPlaying()) {
return;
}
cfg.MODE.cb = cb;
return cfg;
};
TTS.Menu.prototype.addOptions = function (cfg, dom) {
cfg = cfg || this.cfg;
var ctrl = TTS.getInstance();
if (ctrl.isPlaying()) {
return;
}
var priLang = ctrl.languageManager.getDefaultLanguage();
var pnPrimary = new TTS.Parse.ParseNode(priLang, dom);
var pnSecondary = null;
var secLang = ctrl.languageManager.getAltLanguage();
if (secLang) {
pnSecondary = new TTS.Parse.ParseNode(secLang, dom);
}
cfg.PRI_OP.cb = this.getPlayFunction(pnPrimary, priLang);
cfg.PRI_OP.Label = this.getDomTitle(null, cfg.PRI_OP.Label, priLang);
cfg.PRI_OP.contain = pnPrimary;
cfg.SEC_OP.cb = this.getPlayFunction(pnSecondary, secLang);
cfg.SEC_OP.Label = this.getDomTitle(null, cfg.SEC_OP.Label, secLang);
cfg.SEC_OP.contain = pnSecondary;
};
TTS.Menu.prototype.addFocusedOption = function (cfg, dom) {
if (!dom) {
return;
}
cfg = cfg || this.cfg;
var ctrl = TTS.getInstance();
if (ctrl.isPlaying()) {
return;
}
var priLang = ctrl.languageManager.getDefaultLanguage();
var pnPrimary = new TTS.Parse.ParseNode(priLang, dom);
var pnSecondary = null;
var secLang = ctrl.languageManager.getAltLanguage();
if (secLang) {
pnSecondary = new TTS.Parse.ParseNode(secLang, dom);
}
cfg.PRI.cb = this.getPlayFunction(pnPrimary, priLang);
cfg.PRI.Label = this.getDomTitle(dom, cfg.PRI.Label, priLang);
cfg.PRI.contain = pnPrimary;
cfg.SEC.cb = this.getPlayFunction(pnSecondary, secLang);
cfg.SEC.Label = this.getDomTitle(dom, cfg.SEC.Label, secLang);
cfg.SEC.contain = pnSecondary;
return cfg;
};
TTS.Menu.prototype.getPlayFunction = function(parseNode, language) {
var ctrl = TTS.getInstance();
if (parseNode && ctrl.isLanguageSupported(language)) {
if (parseNode.containsSpeakableText()) {
return function() {
ctrl.playParseNode(parseNode, language);
};
} else {
return false;
}
}
return false;
};
TTS.Menu.prototype.checkServiceStates = function (cfg) {
var ctrl = TTS.getInstance();
if (ctrl.isPlaying()) {
cfg.STOP.cb = function() { TTS.getInstance().stop(); };
}
if (this.hasPauseSupport) {
if (ctrl.isPlaying()) {
cfg.PAUSE.cb = function() { TTS.getInstance().pause(); };
} else if (ctrl.getStatus() == TTS.Status.Paused) {
cfg.RESUME.cb = function() { TTS.getInstance().resume(); };
}
}
};
TTS.Menu.prototype.getDomTitle = function (dom, label, lang) {
if (!dom) {
return label;
}
if (YAHOO.lang.isArray(dom) && dom.length > 0) {
dom = dom[0];
}
if (!Util.Dom.isElement(dom)) {
return label;
}
var key = dom.getAttribute('data-menu-prefix');
if (!key) {
key = 'TDSTTS.Label.Speak';
if (dom.title) {
key += dom.title.replace(/\s+/g, '');
} else {
key += 'Question';
}
}
key += lang;
return key;
};

/* SOURCE FILE: securebrowser.js (c69f07fb) 9/9/2014 2:09:05 PM */

function TTSService_Generic() {
var that = this;
this.status = TTS.Status.Uninitialized;
this.browserComponent = null;
this.rate = 20;
this.pitch = 20;
this.currentVolume = 10;
this.voicepacks = [];
this.currentVoice = '';
this.pauseEnabled = (Util.Browser.getSecureVersion() < 2) ? false : true;
function convertDeviceStatusToTTStatus(deviceStatus) {
if ('idle' == deviceStatus)
return TTS.Status.Stopped;
else if ('playing' == deviceStatus)
return TTS.Status.Playing;
else if ('unavailable' == deviceStatus)
return TTS.Status.NotSupported;
else
return TTS.Status.Unknown;
};
this.supportsVolumeControl = function () {
return false;
};
this.supportsPitchControl = function () {
return false;
};
this.supportsRateControl = function () {
return false;
};
this.isSupported = function () {
if (this.status != TTS.Status.NotSupported)
return true;
else
return false;
};
this.subscribe = function(EventManager){
};
this.loadVoices = function () {
this.voicepacks = [];
var voices = AIRMobile.tts.getVoices();
if (voices) {
for (var i = 0; i < voices.length; i++) {
var voice = voices[i];
if (voice.language) {
this.voicepacks.push(voice.language);
}
}
}
};
this.hasVoicepack = function (language) {
if (this.voicepacks.length == 0) return false;
for (var i = 0; i < this.voicepacks.length; i++) {
if (this.voicepacks[i] == language) {
return true;
}
}
return false;
};
this.load = function () {
this.browserComponent = Util.SecureBrowser.getRunTime();
this.browserComponent.checkTextToSpeechStatus(null, (function () {
var service = that;
return function (statusData) {
if (statusData.ttsEngineStatus == 'idle') {
service.status = TTS.Status.Stopped;
service.loadVoices();
} else {
service.status = TTS.Status.NotSupported;
}
TTS.Manager.Events.onServiceLoad.fire();
};
})());
this.browserComponent.listen(this.browserComponent.EVENT_TTS_CHANGED, document, function () {
var service = that;
var deviceStatus = service.browserComponent.device.ttsEngineStatus;
service.status = convertDeviceStatusToTTStatus(deviceStatus);
});
return true;
};
this.getStatus = function () {
return this.status;
};
this.subscribe = function (EventManager) {
try {
if (!EventManager) return;
this.eM = EventManager;
this.browserComponent.listen(this.browserComponent.EVENT_TTS_SYNCHRONIZED, document, function (result) {
service = that;
if ((result) && (result.data)) {
service.eM.fire({ index: result.data.location, length: result.data.length });
}
});
} catch (e) {
console.error("Failed to subscribe to EventManager MSB tts events", e);
}
};
this.play = function (text) {
try {
var options = {
language: this.currentVoice
};
if (this.browserComponent.tts.getVoices() == null) {
options = null;
}
this.browserComponent.tts.speak(text, options, function () {
var service = that;
service.status = convertDeviceStatusToTTStatus(service.browserComponent.device.ttsEngineStatus);
});
}
catch (ex) {
this.status = TTS.Status.Unknown;
return false;
}
return true;
};
this.pause = function () {
if (this.pauseEnabled) {
this.browserComponent.tts.pause();
this.status = TTS.Status.Paused;
return true;
} else {
this.stop();
}
};
this.resume = function () {
if (this.pauseEnabled) {
this.browserComponent.tts.resume();
this.status = TTS.Status.Playing;
return true;
} else {
return false;
}
};
this.stop = function () {
try {
this.browserComponent.tts.stop(null, (function () {
var service = that;
return function (data) {
service.status = convertDeviceStatusToTTStatus(data.ttsEngineStatus);
};
})());
}
catch (ex) {
this.status = TTS.Status.Stopped;
return false;
}
return true;
};
this.getVolume = function () {
return this.currentVolume;
};
this.setVolume = function (level) {
this.currentVolume = level;
return true;
};
this.getPitch = function () {
return this.pitch;
};
this.setPitch = function (level) {
this.pitch = level;
return true;
};
this.getRate = function () {
return this.rate;
};
this.setRate = function (level) {
this.rate = level;
return true;
};
this.getVoices = function () {
if (this.voicepacks.length == 0) {
return ['eng'];
} else {
return this.voicepacks;
}
};
this.getVoice = function () {
return this.currentVoice;
};
this.setVoice = function (voice) {
this.currentVoice = voice;
return true;
};
}

/* SOURCE FILE: firefox.js (d73bed7d) 9/9/2014 2:09:05 PM */

function TTSService_SB()
{
this.runtime = null;
this.wordBoundaryRegex = new RegExp(/<[^>]+>|[\s,.;]+|[^<^ ]+/g);
this.isSpeakable = new RegExp(/[A-Za-z0-9_]+/);
this.BOOKMARK_TAG = '<bookmark mark="start"/> ';
this.bookmarks = [];
this.supportsVolumeControl = function() {
return true;
};
this.supportsPitchControl = function () {
return true;
};
this.supportsRateControl = function() {
return true;
};
this.isSupported = function ()
{
return typeof (Runtime) == 'function' || (Components && Components.classes["@mozilla.org/securebrowser;1"]);
};
this.load = function () {
try {
if (!this.isSupported()) {
return false;
}
if (typeof(Runtime) == 'function') {
this.runtime = new Runtime();
} else {
var success = Mozilla.execPrivileged(function() {
var sbClass = Components.classes["@mozilla.org/securebrowser;1"];
if (sbClass) {
this.runtime = sbClass.createInstance(Components.interfaces.mozISecureBrowser);
}
}.bind(this));
if (!success) {
console.log('SB runtime component failed to load');
}
}
if (!this.runtime) {
return false;
}
YUE.on(window, 'beforeunload', this.dispose.bind(this));
this.runtime.initialize();
this.osHacks();
setTimeout(function() { TTS.Manager.Events.onServiceLoad.fire(); }, 0);
return true;
}
catch (ex) {
return false;
}
};
this.dispose = function () {
console.log('Disposing TTS Runtime...');
if (this.runtime != null) {
delete this.runtime;
this.runtime = null;
}
};
this.osHacks = function () {
this.pluginWordBoundaryFunction = null;
if(Util.Browser.isLinux()){
this.pluginWordBoundaryFunction = null;
return;
}else if(Util.Browser.isWindows() && Util.Browser.getSecureVersion() >= 6.4){
this.pluginWordBoundaryFunction = 'SPEI_WORD_BOUNDARY';
}else if(Util.Browser.isWindows()){
this.pluginWordBoundaryFunction = 'SPEI_TTS_BOOKMARK';
}else if(Util.Browser.isMac()){
this.pluginWordBoundaryFunction = 'soWordCallBack';
}
};
this.subscribe = function(EventManager){
try{
if(!EventManager) return;
this.unregisterAll();
this.eM = EventManager;
var os = Components.classes["@mozilla.org/observer-service;1"].getService(
Components.interfaces.nsIObserverService
);
os.addObserver(this, 'sb-word-speak', false);
this.runtime.initializeListener(this.pluginWordBoundaryFunction);
}catch(e){
console.error("Failed to subscribe to EventManager firefox tts events", e);
}
};
this.unregisterAll = function(){
try{
var os = Components.classes["@mozilla.org/observer-service;1"].getService(
Components.interfaces.nsIObserverService
);
var deadButNotTruly = os.enumerateObservers('sb-word-speak');
while(deadButNotTruly.hasMoreElements()){
os.removeObserver(deadButNotTruly.getNext(), 'sb-word-speak');
}
}catch(e){
console.error("Remove listeners that may actually be listening.", e);
}
};
this.unregister = function(ref){
var os = Components.classes["@mozilla.org/observer-service;1"].getService(
Components.interfaces.nsIObserverService
);
os.removeObserver(ref || this, 'sb-word-speak', false);
};
this.observe = function (subject, topic, data) {
if (topic == 'sb-word-speak' && this.eM) {
if(this.pluginWordBoundaryFunction == 'SPEI_TTS_BOOKMARK') {
var syncpoint = this.bookmarks.shift();
if (!syncpoint || syncpoint.indexOf("-1") > 0)
return;
data = syncpoint;
}
var dataArray = data.split(',');
var parsedData = {};
for (var i = 0; i < dataArray.length; i++) {
var dataField = dataArray[i].split(':');
parsedData[dataField[0]] = parseInt(dataField[1]);
}
var index = parsedData.WordStart ? parsedData.WordStart : null;
this.eM.fire({subject: subject, topic: topic, data: data, index: index});
}
};
this.getStatus = function()
{
if (this.runtime)
{
var currentStatus = this.runtime.status;
if (currentStatus == 'Stopped') return TTS.Status.Stopped;
else if (currentStatus == 'Playing') return TTS.Status.Playing;
else if (currentStatus == 'Paused') return TTS.Status.Paused;
else if (currentStatus == null || currentStatus == '') return TTS.Status.Unknown;
}
return TTS.Status.Uninitialized;
};
this.play = function(text)
{
if (!this.runtime) return false;
if(this.pluginWordBoundaryFunction == 'SPEI_TTS_BOOKMARK') {
text = this._injectSyncTags(text);
}
this.runtime.play(text);
return true;
};
this.pause = function()
{
if (!this.runtime) return false;
this.runtime.pause();
return true;
};
this.resume = function()
{
if (!this.runtime) return false;
this.runtime.resume();
return true;
};
this.stop = function()
{
if (!this.runtime) return false;
this.runtime.stop();
return true;
};
this.getVolume = function()
{
if (!this.runtime) return -1;
return Math.min(this.runtime.volume, 10);
};
this.setVolume = function(level)
{
if (!this.runtime) return false;
if (typeof(level) != 'number') return false;
if (level < 0 || level > 10) return false;
if (this.runtime.volume == level) return false;
this.runtime.volume = level;
return true;
};
this.getPitch = function()
{
if (!this.runtime) return -1;
return Math.min(this.runtime.pitch, 20);
};
this.setPitch = function (level) {
if (!this.runtime) return false;
if (typeof (level) != 'number') return false;
if (level < 0 || level > 20) return false;
var oldPitch = this.runtime.pitch;
this.runtime.pitch = level;
if (oldPitch != level)
return true;
return false;
};
this.getRate = function()
{
if (!this.runtime) return -1;
return Math.min(this.runtime.rate, 20);
};
this.setRate = function (level)
{
if (!this.runtime) return false;
if (typeof (level) != 'number') return false;
if (level < 0 || level > 20) return false;
var oldRate = this.runtime.rate;
this.runtime.rate = level;
if (oldRate != level)
return true;
return false;
};
this.getVoices = function()
{
if (!this.runtime) return null;
var voicesData = this.runtime.voices;
if (voicesData == null || voicesData.length == 0) return [];
return voicesData.split(',');
};
this.getVoice = function()
{
if (!this.runtime) return null;
return this.runtime.voiceName;
};
this.setVoice = function (voice) {
if (!this.runtime){return false;}
this.runtime.voiceName = voice;
return true;
};
this._injectSyncTags = function(inputText) {
var text = inputText.indexOf(this.BOOKMARK_TAG) == 0 ?
inputText.substring(this.BOOKMARK_TAG.length)
: inputText;
this.bookmarks = [];
var pos = this.BOOKMARK_TAG.length;
var matches = text.match(this.wordBoundaryRegex);
var newText = "";
for (var i = 0; matches != null && i < matches.length; i++) {
var match = matches[i];
if (match.trim().length > 0 && match.indexOf('<') < 0 && this.isSpeakable.test(match)) {
newText += this.BOOKMARK_TAG;
this.bookmarks.push("WordStart:" + pos + ", WordLength:" + match.length);
}
pos += match.length;
newText += match;
}
return this.BOOKMARK_TAG + newText;
};
}

/* SOURCE FILE: chrome.js (38857239) 9/9/2014 2:09:05 PM */

function TTSService_Chrome()
{
this.runtime = null;
this.voices = [];
this.status = TTS.Status.unknown;
this.currentVoice = '';
this.volume = 10;
this.rate = 10;
this.pitch = 10;
this.supportsVolumeControl = function () {
return true;
};
this.supportsPitchControl = function () {
return true;
};
this.supportsRateControl = function () {
return true;
};
this.isSupported = function()
{
return Util.Browser.isChrome();
};
this.load = function()
{
if (!this.isSupported()) return false;
var thisObj = this;
this.status = TTS.Status.Initializing;
window.addEventListener("message", function (event) {
try{
if (event.data.type && (event.data.type == "CHROME RESPONSE" && event.data.status == "OK")) {
switch (event.data.command) {
case 'TTS INIT':
if (thisObj.status == TTS.Status.Initializing) {
thisObj.voices = event.data.result.split(',');
thisObj.status = TTS.Status.Stopped;
setTimeout(function() { TTS.Manager.Events.onServiceLoad.fire(); }, 2);
}
break;
case 'TTS STATUS':
thisObj.status = event.data.result;
break;
case 'TTS WORD':
thisObj.EventManager && thisObj.EventManager.fire({subject: 'TTS WORD', index: event.data.result});
break;
}
}
}catch(e){
console.error("Failed to add a message listener.", e);
}
}, false);
var nativeInit = function () {
if (this.status == TTS.Status.Initializing) {
TDS.AppWindow.postMessage({ type: "CHROME COMMAND", command: "TTS INIT", params: "" }, "*");
} else {
if(timer) clearInterval(timer);
}
};
nativeInit();
var timer = setInterval(nativeInit.bind(this), 1000);
return true;
};
this.subscribe = function(EventManager){
this.EventManager = EventManager;
};
this.getStatus = function () {
if (this.status == TTS.Status.Initializing)
return this.status;
var params = { type: "CHROME COMMAND", command: "TTS STATUS", params: "" };
TDS.AppWindow.postMessage(params, "*");
return this.status;
};
this.play = function(text)
{
console.log("We never actually get to the play?.", text, this.currentVoice);
var param = [text, {
rate: (this.rate / 10) * 1,
voiceName: this.currentVoice,
lang: this._extractLangCode(this.currentVoice),
pitch: (this.pitch / 10) * 1,
volume: (this.volume / 10) * 1
}];
TDS.AppWindow.postMessage({ type: "CHROME COMMAND", command: "TTS SPEAK", params: param }, "*");
if (Util.Browser.isChromeOS()) {
if (Util.Browser.getChromeVersion() < 34) {
this.status = TTS.Status.Playing;
} else {
this.EventManager && this.EventManager.fire({ subject: 'TTS WORD', index: 0 });
}
}
return true;
};
this.pause = function()
{
TDS.AppWindow.postMessage({ type: "CHROME COMMAND", command: "TTS PAUSE", params: "" }, "*");
return true;
};
this.resume = function()
{
TDS.AppWindow.postMessage({ type: "CHROME COMMAND", command: "TTS RESUME", params: "" }, "*");
return true;
};
this.stop = function()
{
TDS.AppWindow.postMessage({ type: "CHROME COMMAND", command: "TTS STOP", params: "" }, "*");
return true;
};
this.getVolume = function()
{
return this.volume;
};
this.setVolume = function(level)
{
this.volume = level;
return true;
};
this.getPitch = function()
{
return this.pitch;
};
this.setPitch = function (level) {
this.pitch = level;
return true;
};
this.getRate = function()
{
return this.rate;
};
this.setRate = function (level)
{
this.rate = level;
return true;
};
this.getVoices = function()
{
return this.voices;
};
this.getVoice = function()
{
return this.currentVoice;
};
this.setVoice = function (voice) {
this.currentVoice = voice;
return true;
};
this._extractLangCode = function (voiceName) {
if (voiceName && voiceName == 'native') return '';
if (voiceName && voiceName.indexOf("Spanish") >= 0) return 'es-ES';
return 'en-US';
};
}

/* SOURCE FILE: content_manager.js (5e8c47c0) 9/9/2014 2:08:51 PM */

(function() {
var CM = {
accessibilityEnabled: false,
enableKeyEvents: true,
enableMouseEvents: true,
enableARIA: false,
_readOnly: false,
_debug: true,
_zoom: null
};
Util.Event.Emitter(CM);
CM.setReadOnly = function (value) {
this._readOnly = value;
};
CM.isReadOnly = function () {
return this._readOnly;
};
CM._baseUrl = '';
CM.getBaseUrl = function () {
return this._baseUrl;
};
CM.setBaseUrl = function (baseUrl) {
this._baseUrl = baseUrl;
};
CM.resolveBaseUrl = function (url) {
if (Util.String.isHttpProtocol(url)) {
return url;
}
return this._baseUrl + url;
};
CM.enableAccessibility = function () {
this.accessibilityEnabled = true;
this.enableKeyEvents = false;
this.enableMouseEvents = false;
this.enableARIA = true;
};
CM.isAccessibilityEnabled = function () {
return this.accessibilityEnabled;
};
CM.init = function (baseUrl) {
if (YAHOO.lang.isString(baseUrl)) {
CM.setBaseUrl(baseUrl);
}
if (typeof CM.addKeyEvents == 'function') {
CM.addKeyEvents(document);
}
if (window != parent) {
try {
CM.addKeyEvents(parent.document);
CM.Menu.applyDocFix(parent);
} catch (ex) {
}
}
CM.Menu.init();
if (Util.Browser.isTouchDevice()) {
CM.listenForFocus(document);
}
var defaultZoom = null;
var accProps = ContentManager.getAccProps();
if (accProps) {
defaultZoom = accProps.getPrintSize();
}
CM._zoom = new ContentZoom(defaultZoom);
CM._zoom.addDocument(document, {
includeElements: false
});
CM.fire('init');
};
CM.getZoom = function () {
return this._zoom;
};
CM.getZoomFactor = function () {
var zoomInfo = CM.getZoom();
return (zoomInfo) ? zoomInfo.getFactor() : 1;
};
CM.getAccommodations = function () {
return Accommodations.Manager.getDefault();
};
CM.getAccs = CM.getAccommodations;
CM.getAccommodationProperties = function () {
var accommodations = this.getAccommodations();
return new Accommodations.Properties(accommodations);
};
CM.getAccProps = CM.getAccommodationProperties;
CM.getLanguage = function () {
var accProps = this.getAccommodationProperties();
var language = accProps.getSelectedCode('Language');
return (language) ? language : 'ENU';
};
var supportHandlerLookup = {};
CM.registerSupportHandler = function (responseType, check) {
supportHandlerLookup[responseType.toLowerCase()] = check;
};
CM.getSupportHandler = function (responseType) {
return supportHandlerLookup[responseType.toLowerCase()];
};
CM.getSupportHandlers = function () {
return Util.Object.getValues(supportHandlerLookup);
};
CM.removeSupportHandler = function (responseType) {
return Util.Object.remove(supportHandlerLookup, responseType);
};
CM.removeSupportHandlers = function () {
var responseTypes = Util.Object.keys(supportHandlerLookup);
for (var i = 0; i < responseTypes.length; i++) {
CM.removeSupportHandler(responseTypes[i]);
}
};
CM.addMouseEvents = function (entity, element) {
if (!this.enableMouseEvents) {
return false;
}
if (element == null) {
return false;
}
if (element.__tds_mouseEventsEnabled === true) {
return false;
}
function setActive(evt) {
var entityChanged = entity.setActive(evt);
var targetEl = YUE.getTarget(evt);
var clickedComponent = entity.findComponent(targetEl);
if (clickedComponent) {
entity.setActiveComponent(clickedComponent);
}
if (entity.getActiveComponent() == null) {
entity.resetComponent();
}
}
function checkForMenu(evt) {
if (Util.Browser.isSecure() && Util.Browser.isMac()) {
if (evt.type == 'mousedown' && evt.button == 2) {
setTimeout(function () {
CM.Menu.show({ evt: evt });
}, 0);
}
} else if (evt.type == 'contextmenu') {
CM.Menu.show({ evt: evt });
}
};
var activeElementEvent = Util.Browser.isIOS() ? 'touchstart' : 'mousedown';
YUE.on(element, activeElementEvent, setActive, this, true);
YUE.on(element, 'mousedown', checkForMenu, this, true);
YUE.on(element, 'contextmenu', checkForMenu, this, true);
element.__tds_mouseEventsEnabled = true;
return true;
};
CM.CSS = {
CONTEXT_AREA: 'contextArea',
CONTEXT_AREA_ALT: 'contextArea-hasalt',
CONTEXT_AREA_FOCUS: 'contextArea-focused',
CONTEXT_BODY_FOCUS: 'contextBody-focused',
CONTEXT_AREA_SELECT: 'contextArea-selected',
CONTEXT_BODY_SELECT: 'contextBody-selected',
MARK_REVIEW_OFF: 'markReview',
MARK_REVIEW_ON: 'markReviewMarked',
HIGHLIGHT: 'highlight'
};
CM._labels = {};
CM._labels['TTS_SPEAKTEXT'] = { classname: 'speaktext', text: 'TDSContentJS.Label.SpeakSelected' };
CM._labels['TTS_SPEAKSECTION'] = { classname: 'speaksection', text: 'Speak {title}' };
CM._labels['TTS_SPEAKSECTION_ALT'] = { classname: 'speaksection', text: 'Speak {title}' };
CM._labels['TTS_STOP'] = { classname: 'speakstop', text: 'TDSContentJS.Label.StopSpeaking' };
CM._labels['HIGHLIGHT_TEXT'] = { classname: 'highlighttext', text: 'TDSContentJS.Label.Highlight' };
CM._labels['HIGHLIGHT_CLEAR'] = { classname: 'highlightclear', text: 'TDSContentJS.Label.ResetHighlight' };
CM.getLabel = function (id) {
var label = CM._labels[id.toUpperCase()];
if (label) {
return { classname: label.classname, text: Messages.get(label.text) };
}
return null;
};
CM.getCommentCode = function () {
var accProps = Accommodations.Manager.getCurrentProperties();
return accProps.getStudentComments();
};
CM.getCommentLabel = function () {
var commentCode = CM.getCommentCode();
var label = 'Comments';
if (commentCode == 'TDS_SCDropDown') {
label = Messages.getAlt('TestShell.Comments.DropDown', 'Comments');
} else if (commentCode == 'TDS_SCNotepad') {
label = Messages.getAlt('TestShell.Comments.Notepad', 'Notepad');
} else if (commentCode == 'TDS_SCTextArea') {
label = Messages.getAlt('TestShell.Comments.TextArea', 'Comments');
}
return label;
};
CM.clear = function () {
CM._zoom.setLevel(CM._zoom.defaultLevel);
CM.clearPagePlugins();
CM.clearEntityPlugins();
}
window.ContentManager = CM;
})();

/* SOURCE FILE: content_utils.js (5379b846) 9/9/2014 2:08:51 PM */

(function (CM) {
CM.getElementById = function (id, obj) {
var el = document.getElementById(id);
var parentEl;
if (parent instanceof ContentPage ||
parent instanceof ContentEntity) {
parentEl = parent.getElement();
} else if (Util.Dom.isElement(parent)) {
parentEl = parent;
} else {
parentEl = document;
}
if (parentEl == document || parentEl.contains(el)) {
return el;
}
return null;
}
CM.getEventXY = function (domEvent, clickXY) {
var element = YUE.getTarget(domEvent);
if (!clickXY) {
clickXY = YUE.getXY(domEvent);
}
while (Util.Dom.getWindow(element.ownerDocument).frameElement &&
!Util.Dom.getWindow(element.ownerDocument).its) {
element = Util.Dom.getWindow(element.ownerDocument).frameElement;
var elementXY = YUD.getXY(element);
clickXY[0] = clickXY[0] + elementXY[0];
clickXY[1] = clickXY[1] + elementXY[1];
}
return clickXY;
};
CM.getJavaString = function (value) {
if (value != null && typeof (value) == 'object') {
value = new String(value).toString();
}
return value;
};
CM.focus = function (obj) {
if (CM.enableARIA) {
return false;
}
return Util.Dom.focus(obj);
};
CM.blur = function (obj) {
if (CM.enableARIA) {
return false;
}
return Util.Dom.blur(obj);
};
CM.preventFocus = function (el) {
YUE.onFocus(el, function () {
CM.blur(el);
});
};
CM.isLinkClickable = function (link) {
var mediaType = link.getAttribute('type');
if (mediaType == null) {
return false;
}
var supportedMediaTypes = ['application/rtf', 'application/pdf'];
return (supportedMediaTypes.indexOf(mediaType) != -1);
};
CM.getAncestor = Util.Dom.getAncestor;
CM.isElement = Util.Dom.isElement;
CM.isVisible = Util.Dom.isVisible;
CM.isDialogShowing = function () {
return YUD.hasClass(document.body, 'showingLoading') ||
YUD.hasClass(document.body, 'showingDialog');
};
CM.log = function (message) {
if (typeof Util == 'object') {
Util.log(message);
}
else if (typeof console == 'object') {
console.log(message);
}
};
CM.requiresSelectionFix = function () {
return (Util.Browser.isMac() &&
Util.Browser.getSecureVersion() > 0 &&
Util.Browser.getSecureVersion() < 4.0);
};
CM.fixItemFrame = function (item, win, doc) {
CM.Menu.applyDocFix(win);
CM.addMouseEvents(item, doc);
CM.addKeyEvents(doc);
Util.Dom.stopAllEvents(doc, 'contextmenu');
if (CM.requiresSelectionFix()) {
YUE.addListener(doc, 'mousedown', function (e) {
CM.focus(top);
});
YUE.addListener(doc, 'mouseup', function (e) {
CM.focus(win);
});
}
var page = item.getPage();
var pageAccommodations = page.getAccommodations();
pageAccommodations.applyCSS(doc.body);
var zoom = page.getZoom();
zoom.addDocument(doc);
zoom.refresh();
};
CM.setReadOnlyKeyEvent = function (item, input) {
var readOnlyFunc = function (evt) {
if (item.isReadOnly()) {
YUE.stopEvent(evt);
}
};
YUE.on(input, 'keypress', readOnlyFunc);
YUE.on(input, 'mousedown', readOnlyFunc);
};
CM.createRange = function (doc) {
if (typeof window.rangy == 'object') {
try {
return window.rangy.createRange(doc);
} catch (ex) {
}
}
return null;
};
CM.getSelection = function (doc) {
if (typeof window.rangy == 'object') {
try {
return window.rangy.getSelection(doc);
} catch (ex) {
}
}
return null;
};
CM.applyRedrawFix = function () {
setTimeout(function () {
YUD.addClass(document.body, 'forceRedraw');
setTimeout(function () {
YUD.removeClass(document.body, 'forceRedraw');
}, 0);
}, 0);
};
CM.listenForFocus = function (doc) {
var focused = false;
var setFocused = function () {
YUD.addClass(document.body, 'inputFocus');
focused = true;
};
var setBlurred = function () {
YUD.removeClass(document.body, 'inputFocus');
focused = false;
};
YUE.onFocus(doc, function (ev) {
if (Util.Event.inTextInput(ev)) {
var targetEl = YUE.getTarget(ev);
if (YUD.getAttribute(targetEl, 'autocorrect') != 'off') {
YUD.setAttribute(targetEl, 'autocorrect', 'off');
YUD.setAttribute(targetEl, 'autocapitalize', 'off');
YUD.setAttribute(targetEl, 'autocomplete', 'off');
}
CM.applyRedrawFix();
setFocused();
}
});
YUE.onBlur(doc, function (ev) {
setBlurred();
});
var win = Util.Dom.getWindow(doc);
YUE.on(win, 'scroll', function (ev) {
if (focused && !Util.Dom.isTextInput(document.activeElement)) {
setBlurred();
}
});
};
YUD.toggleClass = function (node, className, force) {
var add = (force !== undefined) ? force : !(YUD.hasClass(node, className));
if (add) {
YUD.addClass(node, className);
} else {
YUD.removeClass(node, className);
}
};
})(ContentManager);

/* SOURCE FILE: content_renderer.js (57c03d56) 9/9/2014 2:08:51 PM */

(function(CM) {
var IMAGE_TIMEOUT = 90;
var IMAGE_MAX_RETRY = 2;
var State = {
Init: 0,
Rendering: 1,
Rendered: 2,
Available: 3,
Loaded: 4
};
var StateNames = {};
StateNames[State.Init] = 'init';
StateNames[State.Rendering] = 'rendering';
StateNames[State.Rendered] = 'rendered';
StateNames[State.Available] = 'available';
StateNames[State.Loaded] = 'loaded';
function Renderer(parentEl, id, html) {
this.id = id;
this._parentEl = parentEl;
this._pageEl = null;
this._html = html;
this._imagesLoading = [];
this._imagesLoaded = [];
this._imagesFailed = [];
this._imagesAborted = [];
this._imagesTimer = null;
this._imagesRetry = 0;
this._resourceCollection = new ResourceLoader.Collection();
this._status = State.Init;
Util.Event.Emitter(this);
}
Renderer.State = State;
Renderer.getStateNames = function() {
return Util.Object.values(StateNames);
}
Renderer.init = function () {
}
Renderer.isDirect = function() {
return true;
}
Renderer.writeHtml = function (parentEl, html) {
var parentDoc = Util.Dom.getOwnerDocument(parentEl);
var pageWrapper = parentDoc.createElement('div');
YUD.addClass(pageWrapper, 'pageWrapper');
if (html) {
if (html.documentElement) {
html = html.documentElement;
}
if (html.nodeType > 0) {
pageWrapper.appendChild(html);
} else {
pageWrapper.innerHTML = html;
}
}
pageWrapper.setAttribute('aria-hidden', 'true');
parentEl.appendChild(pageWrapper);
return pageWrapper;
};
Renderer.show = function (el) {
if (el) {
el.setAttribute('aria-hidden', 'false');
YUD.removeClass(el, 'hiding');
YUD.addClass(el, 'showing');
}
};
Renderer.hide = function (el) {
if (el) {
el.setAttribute('aria-hidden', 'true');
YUD.removeClass(el, 'showing');
YUD.addClass(el, 'hiding');
}
};
Renderer.remove = function(page) {
var pageContainer = page.getContainer();
Util.Dom.removeNode(pageContainer);
}
Renderer.prototype._log = function (message) {
if (!CM._debug) {
return;
}
CM.log('RENDERER ' + this.id + ': ' + message);
};
Renderer.prototype.getState = function () {
return this._status;
};
Renderer.prototype.setState = function (newState) {
if (!YAHOO.lang.isNumber(newState) ||
newState < State.Init ||
newState > State.Loaded) {
throw 'Invalid page state';
}
var currentState = this.getState();
var currentStateName = StateNames[currentState];
var newStateName = StateNames[newState];
if (newStateName == null) {
throw 'No page state name found';
}
var statusError = 'Invalid page state transition (' + currentStateName + ' --> ' + newStateName + ')';
if (newState == State.Init && currentState >= State.Init) {
throw statusError;
} else if (newState == State.Rendering &&
currentState != State.Init) {
throw statusError;
} else if (newState == State.Rendered &&
currentState != State.Rendering) {
throw statusError;
} else if (newState == State.Available &&
currentState != State.Rendered) {
throw statusError;
} else if (newState == State.Loaded &&
currentState != State.Available) {
throw statusError;
}
this._status = newState;
this._log(newStateName);
this.fire(newStateName);
};
Renderer.prototype.getHtml = function () { return this._html; };
Renderer.prototype.setHtml = function (html) {
if (this.getState() <= State.Rendering) {
this._html = html;
return true;
}
return false;
};
Renderer.prototype.getContainer = function () {
return this._pageEl;
};
Renderer.prototype.getWin = function () {
return document.parentWindow || document.defaultView;
};
Renderer.prototype.getElement = function () {
return document.getElementById('Page_' + this.id);
};
Renderer.prototype.render = function () {
if (this.getState() > State.Init) {
return this._pageEl;
}
this.setState(State.Rendering);
var pageEl = Renderer.writeHtml(this._parentEl, this.getHtml());
this._pageEl = pageEl;
Renderer.hide(pageEl);
YUD.addClass(document.body, 'yui-skin-sam');
YUD.addClass(document.body, Util.Browser.isTouchDevice() ? 'touch' : 'no-touch');
var pageElement = this.getElement();
if (pageElement == null) {
throw new Error('The page element could not be found.');
}
YUD.batch(pageElement.getElementsByTagName('img'), this.addImage, this, true);
this.setState(State.Rendered);
YAHOO.lang.later(1, this, this.onAvailable);
return pageEl;
};
function process(renderer) {
var pageWin = renderer.getWin();
if (pageWin.__tds_processed) {
return;
}
ContentManager.Menu.applyDocFix(document);
if (typeof CM.addKeyEvents == 'function') {
CM.addKeyEvents(document);
}
Util.Dom.stopDragEvents(document);
Util.Dom.stopAllEvents(document, 'contextmenu');
YUE.on(document, 'mousedown', function (ev) {
if (ev.button == 1) {
YUE.stopEvent(ev);
}
});
pageWin.__tds_processed = true;
};
Renderer.prototype.onAvailable = function () {
process(this);
var pageElement = this.getElement();
this.setState(State.Available);
YUD.batch(pageElement.getElementsByTagName('a'), function (link) {
if (!CM.isLinkClickable(link)) {
YUE.on(link, 'click', function(ev) {
YUE.stopEvent(ev);
});
}
});
if (this._resourceCollection.hasLoaders()) {
this._resourceCollection.subscribe(ResourceLoader.Status.COMPLETE, this.checkLoaded, this);
this._resourceCollection.subscribe(ResourceLoader.Status.ERROR, this.checkLoaded, this);
this._resourceCollection.subscribe(ResourceLoader.Status.ABORT, this.checkLoaded, this);
this._resourceCollection.load();
}
YAHOO.lang.later(1, this, this.checkLoaded);
};
Renderer.prototype.checkLoaded = function () {
if (this._imagesLoading.length > 0) {
return;
}
if (this._imagesTimer != null) {
this._imagesTimer.cancel();
this._imagesTimer = null;
}
if (this._resourceCollection.hasLoaders() &&
this._resourceCollection.getStatus() == ResourceLoader.Status.LOADING) {
return;
}
if (this.getState() == State.Available) {
this.setState(State.Loaded);
}
};
Renderer.prototype.getResourceLoaders = function() {
return this._resourceCollection;
};
Renderer.prototype.addResourceLoader = function (resource) {
this._resourceCollection.add(resource);
};
Renderer.prototype.getImagesLoading = function() {
return this._imagesLoading;
};
Renderer.prototype.getImagesLoaded = function() {
return this._imagesLoaded;
};
Renderer.prototype.getImagesFailed = function() {
return this._imagesFailed;
};
Renderer.prototype.getImagesAborted = function() {
return this._imagesAborted;
};
Renderer.prototype.addImage = function (image) {
if (image.id == '') {
image.id = YUD.generateId();
}
this._imagesLoading.push(image);
var loadEvent = YAHOO.env.ua.ie ? 'readystatechange' : 'load';
YUE.addListener(image, loadEvent, this._onImageEvent, image, this);
YUE.addListener(image, 'abort', this._onImageEvent, image, this);
YUE.addListener(image, 'error', this._onImageEvent, image, this);
image.dateRequested = Util.Date.now();
this._startImageTimer();
};
Renderer.prototype._startImageTimer = function () {
if (this._imagesTimer != null) {
this._imagesTimer.cancel();
}
this._imagesTimer = YAHOO.lang.later((IMAGE_TIMEOUT * 1000), this, this._onImagesTimeout);
};
Renderer.prototype._onImagesTimeout = function () {
Util.log('image timeout');
if (this._imagesRetry < IMAGE_MAX_RETRY) {
this._imagesRetry++;
Util.Array.each(this._imagesLoading, function (image) {
image.src = image.src;
image.dateRequested = Util.Date.now();
});
this._startImageTimer();
} else {
Util.Array.each(this._imagesLoading, function (image) {
var evt = { type: 'abort' };
this._onImageEvent(evt, image);
}, this);
}
};
Renderer.prototype._onImageEvent = function (evt, image) {
if (!Util.Array.contains(this._imagesLoading, image)) {
return;
}
if (evt.type == 'readystatechange') {
if (image.readyState == 'complete') {
evt = { type: 'load' };
} else {
return;
}
}
if (typeof image.naturalWidth == 'undefined') {
if (evt.type == 'load') {
image.naturalWidth = image.width;
image.naturalHeight = image.height;
} else {
image.naturalWidth = 0;
image.naturalHeight = 0;
}
}
var loadEvent = YAHOO.env.ua.ie ? 'readystatechange' : 'load';
YUE.removeListener(image, loadEvent, this._onImageEvent);
YUE.removeListener(image, 'abort', this._onImageEvent);
YUE.removeListener(image, 'error', this._onImageEvent);
Util.Array.remove(this._imagesLoading, image);
if (evt.type == 'load') {
this._imagesLoaded.push(image);
} else if (evt.type == 'abort') {
this._imagesAborted.push(image);
} else {
this._imagesFailed.push(image);
}
image.dateCompleted = Util.Date.now();
this.checkLoaded();
};
Renderer.prototype.dispose = function () {
this.id = null;
this._html = null;
this._container = null;
this._doc = null;
this._imagesLoading = null;
this._imagesLoaded = null;
this._imagesFailed = null;
this._imagesAborted = null;
this._imagesTimer = null;
this._imagesRetry = null;
this.fire('dispose');
this.removeAllListeners();
};
CM.Renderer = Renderer;
})(ContentManager);

/* SOURCE FILE: content_pages.js (f9b7dab1) 9/9/2014 2:08:51 PM */

(function(CM) {
var Renderer = CM.Renderer;
function createPassage(page, itsPassage) {
var passage = new ContentPassage(page, itsPassage.bankKey, itsPassage.itemKey, itsPassage.filePath);
page.setPassage(passage);
passage.stemTTS = itsPassage.stemTTS;
passage.printed = itsPassage.printed;
passage.resources = itsPassage.resources;
passage.attachments = itsPassage.attachments;
passage.specs = itsPassage.specs;
return passage;
}
function createItem(page, itsItem) {
var item = new ContentItem(page, itsItem.bankKey, itsItem.itemKey, itsItem.filePath,
itsItem.format, itsItem.responseType, itsItem.grade, itsItem.subject, itsItem.position);
item.disabled = itsItem.disabled;
page.addItem(item);
item.stemTTS = itsItem.stemTTS;
item.illustrationTTS = itsItem.illustrationTTS;
item.rendererSpec = itsItem.rendererSpec || null;
item.gridAnswerSpace = itsItem.gridAnswerSpace;
item.tutorial = itsItem.tutorial;
item.resources = itsItem.resources;
item.attachments = itsItem.attachments;
if (itsItem.resources) {
item.gtr = itsItem.resources['guideToRevision'];
item.coverPage = itsItem.resources['coverPage'];
}
item.value = itsItem.value;
item.printed = itsItem.printed;
item.rubric = itsItem.rubric;
if (itsItem.qti) {
item.qti = itsItem.qti;
}
item.specs = itsItem.specs;
return item;
}
function createPage(pages, content) {
Util.Assert.isObject(content);
Util.Assert.isString(content.id);
var pageID = content.id;
var page = pages.get(pageID);
if (page) {
return page;
}
var pagesEl = pages.getElement();
var renderer = new Renderer(pagesEl, pageID, content.html);
var eventQueue = [];
page = new ContentPage(pages, renderer, pageID, content.segmentID, content.layout);
page.soundCue = content.soundCue || null;
eventQueue.push(pages.fire.bind(pages, 'pageCreated', page, content));
pages._lookup.set(pageID, page);
if (content.passage) {
var passage = createPassage(page, content.passage);
eventQueue.push(page.fire.bind(page, 'passageCreated', passage, content.passage));
}
if (content.items) {
content.items.forEach(function (itemContent) {
var item = createItem(page, itemContent);
eventQueue.push(page.fire.bind(page, 'itemCreated', item, itemContent));
});
}
eventQueue.forEach(function (func) {
func();
});
return page;
}
function Pages(id) {
this._id = id;
this._currentPage = null;
this._lookup = new Util.Structs.Map();
Util.Event.Emitter(this);
}
Pages.prototype.create = function (content) {
return createPage(this, content);
};
Pages.prototype.getElement = function() {
return document.getElementById(this._id);
}
Pages.prototype.list = function () {
return this._lookup.getValues();
};
Pages.prototype.get = function (id) {
return this._lookup.get(id);
};
Pages.prototype.setCurrent = function (page) {
this._currentPage = page;
};
Pages.prototype.getCurrent = function () {
return this._currentPage;
};
Pages.prototype.getItem = function (position) {
var pages = this.list();
for (var i = 0; i < pages.length; i++) {
var page = pages[i];
var item = page.getItem(position);
if (item) {
return item;
}
}
return null;
};
Pages.prototype.remove = function (page) {
if (page.isShowing()) {
page.hide();
}
Renderer.remove(page);
this._lookup.remove(page.id);
page.dispose();
};
Pages.prototype.dispose = function() {
var list = this.list();
list.forEach(function(page) {
page.dispose();
});
this._lookup.clear();
this._currentPage = null;
this.getElement().innerHTML = '';
this.fire('dispose');
this.removeAllListeners();
}
CM.Pages = Pages;
var list = [];
CM.createPages = function (id) {
var pages = new Pages(id);
list.push(pages);
pages.once('dipose', function() {
Util.Array.remove(list, pages);
});
CM.fire('pagesCreated', pages);
return pages;
}
CM.getPages = function() {
return list;
}
CM.createPassage = createPassage;
CM.createItem = createItem;
})(ContentManager);

/* SOURCE FILE: content_page.js (dbdab7fd) 10/26/2014 1:27:05 PM */

(function(CM) {
var Renderer = CM.Renderer;
function Page(pages, renderer, pageID, segmentID, layoutName) {
Util.Assert.isInstanceOf(CM.Pages, pages);
Util.Assert.isInstanceOf(Renderer, renderer);
Util.Assert.isString(pageID);
Util.Assert.isString(segmentID);
Util.Assert.isString(layoutName);
this.id = pageID;
this.segmentID = segmentID;
this.layout = layoutName;
this._pages = pages;
this._renderer = renderer;
this.soundCue = null;
this.autoPlayQueue = TDS.Audio.Player.createQueue();
this._container = null;
this._doc = null;
this._passage = null;
this._items = [];
this._itemHash = {};
this._activeEntity = null;
this._lastEntity = null;
this._enableScroll = true;
this.zoomFactor = 0;
this.plugins = new CM.Plugins();
Util.Event.Emitter(this);
this.init();
};
Page.prototype.getParent = function() {
return this._pages;
}
Page.prototype.onAvailable = function () {
this.getEntities().forEach(function (entity) {
var entityEl = entity.getElement();
if (entityEl) {
Renderer.hide(entityEl);
ContentManager.addMouseEvents(entity, entityEl);
} else {
console.warn('On available can\'t hide entity element.', entity);
}
});
}
Page.prototype.onLoaded = function () {
this.getEntities().forEach(function (entity) {
if (!entity.getText()) {
$(entity.getElement()).addClass('contentEmpty');
}
});
}
Page.prototype.onStatusChange = function(status) {
var funcName = 'on' + Util.String.capitalize(status);
if (typeof this[funcName] == 'function') {
this[funcName]();
}
this.fire(status);
this.getEntities().forEach(function(entity) {
entity.fire(status);
});
}
Page.prototype.init = function() {
var stateNames = Renderer.getStateNames();
stateNames.forEach(function pageEvent(status) {
this._renderer.once(status, this.onStatusChange.bind(this, status));
}.bind(this));
}
Page.prototype.getRenderer = function() {
return this._renderer;
}
Page.prototype.getContainer = function () {
return this._container;
};
Page.prototype.getDoc = function () {
return document;
};
Page.prototype.getActiveDoc = function () {
var activeEntity = this.getActiveEntity();
if (activeEntity != null) {
var activeComponent = activeEntity.getActiveComponent();
if (activeComponent != null && YAHOO.lang.isFunction(activeComponent.getDoc)) {
return activeComponent.getDoc();
}
}
return this.getDoc();
};
Page.prototype.getBody = function () {
var doc = this.getDoc();
return doc ? doc.body : null;
};
Page.prototype.getWin = function () {
var doc = this.getDoc();
return doc ? (doc.parentWindow || doc.defaultView) : null;
};
Page.prototype.getActiveWin = function () {
var activeEntity = this.getActiveEntity();
if (activeEntity != null) {
var activeComponent = activeEntity.getActiveComponent();
if (activeComponent != null && YAHOO.lang.isFunction(activeComponent.getWin)) {
return activeComponent.getWin();
}
}
return this.getWin();
};
Page.prototype.getFrameElement = function () {
var win = this.getWin();
return win ? win.frameElement : null;
};
Page.prototype.getElement = function () {
return document.getElementById('Page_' + this.id);
};
Page.prototype.getCompoundElement = function () {
var pageDoc = this.getDoc();
var items = this.getItems();
if (pageDoc && items.length > 0) {
var firstItem = items[0];
return pageDoc.getElementById('compound_' + firstItem.position);
}
return null;
};
Page.prototype.getHeader = function () {
var pageElement = this.getElement();
var headers = pageElement.getElementsByTagName('h3');
if (headers.length > 0) {
return headers[0];
}
return null;
};
Page.prototype.getAccommodations = function () {
return Accommodations.Manager.get(this.segmentID);
};
Page.prototype.getAccs = Page.prototype.getAccommodations;
Page.prototype.getAccommodationProperties = function () {
return Accommodations.Manager.getProperties(this.segmentID);
};
Page.prototype.getAccProps = Page.prototype.getAccommodationProperties;
Page.prototype._fireBeforeZoom = function() {
var level = this.getZoomFactor();
return this.fire('beforeZoom', level);
}
Page.prototype._fireZoom = function () {
var level = this.getZoomFactor();
return this.fire('zoom', level);
}
Page.prototype.getZoom = function () {
return CM.getZoom();
};
Page.prototype.getZoomFactor = function () {
return CM.getZoomFactor();
};
Page.prototype.zoomIn = function () {
var zoom = CM.getZoom();
if (zoom && this._fireBeforeZoom() && zoom.zoomIn()) {
this._fireZoom();
return true;
}
return false;
};
Page.prototype.zoomOut = function () {
var zoom = CM.getZoom();
if (zoom && this._fireBeforeZoom() && zoom.zoomOut()) {
this._fireZoom();
return true;
}
return false;
};
Page.prototype.updateElementsZoom = function () {
var zoom = CM.getZoom();
var factor = zoom.getFactor();
if (zoom && factor != this.zoomFactor) {
var pageEl = this.getElement();
zoom.updateElements(pageEl);
}
};
Page.prototype.setPassage = function (passage) {
this._passage = passage;
};
Page.prototype.getPassage = function (showing) {
if (this._passage && showing && !this._passage.isShowing()) {
return null;
}
return this._passage;
};
Page.prototype.addItem = function (item) {
this._items.push(item);
this._itemHash[item.position] = item;
};
Page.prototype.getItems = function (showing) {
if (showing) {
return this._items.filter(function(item) {
return item.isShowing();
});
} else {
return this._items.slice(0);
}
};
Page.prototype.getItem = function (position) {
return this._itemHash[position];
};
Page.prototype.getEntities = function (showing) {
var passage = this.getPassage(showing);
var items = this.getItems(showing);
if (passage) {
return Util.Array.concat(passage, items);
}
return items;
};
Page.prototype.getActiveEntity = function () {
return this._activeEntity;
};
Page.prototype.clearEntity = function () {
var activeEntity = this.getActiveEntity();
if (activeEntity == null) {
return false;
}
activeEntity.clearActive();
return true;
};
Page.prototype.prevEntity = function () {
var items = this.getItems(true);
var currentEntity = this.getActiveEntity();
if (currentEntity == null || currentEntity instanceof ContentPassage) {
currentEntity = items[items.length - 1];
} else {
for (var i = 0; i < items.length; i++) {
var item = items[i];
if (currentEntity == item) {
currentEntity = items[i - 1] || this.getPassage(true) || items[items.length - 1];
break;
}
}
}
if (currentEntity) {
currentEntity.setActive();
return currentEntity;
} else {
return null;
}
};
Page.prototype.nextEntity = function () {
var items = this.getItems(true);
var currentEntity = this.getActiveEntity();
if (currentEntity == null || currentEntity instanceof ContentPassage) {
currentEntity = items[0];
} else {
for (var i = 0; i < items.length; i++) {
var item = items[i];
if (currentEntity == item) {
currentEntity = items[i + 1] || this.getPassage(true) || items[0];
break;
}
}
}
if (currentEntity) {
currentEntity.setActive();
return currentEntity;
} else {
return null;
}
};
Page.prototype.getComponents = function() {
var lookup = [];
var mapping = [];
var entities = this.getEntities(true);
entities.forEach(function (entity) {
var components = entity.getComponents(true);
components.forEach(function (component) {
if (lookup.indexOf(component) != -1) return;
lookup.push(component);
mapping.push({
entity: entity,
component: component
});
});
});
return mapping;
}
Page.prototype.isShowing = function () {
return (this == this._pages.getCurrent());
};
Page.prototype.collapseSelection = function () {
var pageDoc = this.getActiveDoc();
var pageSelection = CM.getSelection(pageDoc);
if (pageSelection && pageSelection.rangeCount > 0) {
pageSelection.collapseToStart();
}
};
Page.prototype.getScrollableElement = function () {
var pageElement = this.getElement();
if (pageElement) {
var entity = this.getActiveEntity();
if (this.layout == '12') {
return Util.Dom.getElementByClassName('writeWrap', 'div', pageElement);
}
else if (entity instanceof ContentPassage) {
return entity.getElement();
}
else if (entity instanceof ContentItem) {
return Util.Dom.getElementByClassName('theQuestions', 'div', pageElement);
}
}
return null;
};
Page.prototype.enableScroll = function () {
this._enableScroll = true;
};
Page.prototype.disableScroll = function () {
this._enableScroll = false;
};
Page.prototype.scroll = function (direction) {
var el = this.getScrollableElement();
if (el == null || !this._enableScroll) {
return;
}
var scrollAmount = 25;
switch (direction) {
case 'Up':
el.scrollTop -= scrollAmount;
break;
case 'Down':
el.scrollTop += scrollAmount;
break;
case 'Left':
el.scrollLeft -= scrollAmount;
break;
case 'Right':
el.scrollLeft += scrollAmount;
break;
}
};
Page.prototype.toString = function() {
return 'Page ' + this.id;
};
Page.prototype.render = function () {
if (!this._container) {
this._container = this._renderer.render();
return true;
}
return false;
};
Page.prototype.wait = function(eventName) {
var deferred = Q.defer();
this.once(eventName, function () {
deferred.resolve();
});
return deferred.promise;
}
Page.prototype.hide = function () {
if (!this.isShowing()) {
return false;
}
var containerEl = this.getContainer();
if (containerEl) {
this.fire('beforeHide');
Renderer.hide(containerEl);
} else {
return false;
}
this.clearEntity();
var currentPage = this._pages.getCurrent();
if (currentPage == this) {
this._pages.setCurrent(null);
}
this.getEntities().forEach(function (entity) {
entity.hide();
});
this.fire('hide');
YAHOO.lang.later(1, this, function () {
this.fire('afterHide');
});
return true;
};
Page.prototype.show = function () {
if (this.isShowing()) {
return false;
}
var containerEl = this.getContainer();
if (containerEl == null) {
return false;
}
var cancelShow = this.fire('beforeShow');
if (cancelShow === false) {
return false;
}
var currentPage = this._pages.getCurrent();
if (currentPage && currentPage != this) {
currentPage.hide();
}
Renderer.show(containerEl);
this._pages.setCurrent(this);
var plugins = this.plugins.getAll();
var entities = Util.Array.findWhere(plugins, function(plugin) {
return plugin.getEntitiesToShow();
});
if (!entities) {
entities = this.getEntities();
}
entities.forEach(function (entity) {
entity.show();
});
var activeEntity = Util.Array.findWhere(plugins, function(plugin) {
return plugin.getEntityForFocus();
});
if (!activeEntity) {
if (this._lastEntity && this._lastEntity.isShowing()) {
activeEntity = this._lastEntity;
} else {
var items = this.getItems(true);
if (items.length > 0) {
activeEntity = items[0];
} else {
var passage = this.getPassage(true);
if (passage) {
activeEntity = passage;
}
}
}
}
if (activeEntity) {
activeEntity.setActive(null, true);
}
this.fire('show');
YAHOO.lang.later(1, this, function () {
this.fire('afterShow');
});
return true;
};
Page.prototype.getLastActive = function() {
return this._lastEntity;
};
Page.prototype.dispose = function () {
this.plugins.getAll().forEach(function(plugin) {
plugin.dispose();
});
this.plugins.clear();
if (this._passage) {
this._passage.dispose();
delete this._passage;
}
if (this._items) {
this._items.forEach(function(item) {
item.dispose();
});
Util.Array.clear(this._items);
}
this._pages = null;
this.id = null;
this.segmentID = null;
this.layout = null;
this.soundCue = null;
this.autoPlayQueue = TDS.Audio.Player.createQueue();
this._container = null;
this._doc = null;
this._passage = null;
this._items = null;
this._itemHash = null;
this._html = null;
this._activeEntity = null;
this._zoom = null;
this._lastEntity = null;
var stateNames = Renderer.getStateNames();
stateNames.forEach(function pageEvent(status) {
this._renderer.removeListener(status, this.onRendererStatus);
}.bind(this));
this._renderer = null;
this.fire('dispose');
this.removeAllListeners();
};
window.ContentPage = Page;
})(ContentManager);

/* SOURCE FILE: content_entity.js (6dc31491) 10/26/2014 1:27:05 PM */

(function(CM) {
function Entity(page, bankKey, itemKey, filePath) {
this._errors = [];
this._page = page;
this._showing = false;
this.bankKey = bankKey;
this.itemKey = itemKey;
this.filePath = filePath;
this.audioLinks = [];
this.printed = false;
this._components = [];
this._activeComponent = null;
this.plugins = new CM.Plugins();
this.orderedPlugins = [];
this.plugins.on('add', function (plugin) {
this.orderedPlugins.push(plugin);
}.bind(this));
this.plugins.on('remove', function (plugin) {
Util.Array.remove(this.orderedPlugins, plugin);
}.bind(this));
Util.Event.Emitter(this);
this.init();
};
Entity.prototype.init = function () { };
Entity.prototype.addError = function(ex, details) {
this._errors.push({
ex: ex,
details: details
});
};
Entity.prototype.getErrors = function () {
return this._errors;
};
Entity.prototype.clearErrors = function () {
Util.Array.clear(this._errors);
};
Entity.prototype.getElement = function() {
return undefined;
};
Entity.prototype.getToolsElement = function () {
return undefined;
};
Entity.prototype.getToolElement = function (name) {
var toolsEl = this.getToolsElement();
if (toolsEl) {
return $('.' + name, toolsEl).get(0);
}
};
Entity.prototype.addToolElement = function (obj) {
Util.Assert.isObject(obj);
Util.Assert.isString(obj.classname);
var toolsEl = this.getToolsElement();
if (!toolsEl) return undefined;
var toolEl = this.getToolElement(obj.classname);
if (toolEl) return toolEl;
toolEl = document.createElement('a');
toolEl.className = obj.classname;
toolEl.setAttribute('href', '#');
toolEl.setAttribute('tabindex', '0');
if (obj.text) {
toolEl.setAttribute('aria-label', obj.text);
}
if (obj.hasPopup) {
toolEl.setAttribute('aria-haspopup', 'true');
}
if (obj.fn) {
var callback = function(evt) {
var currentPage = this.getPage().getParent().getCurrent();
if (currentPage) {
var currentEntity = currentPage.getActiveEntity();
if (currentEntity == this) {
YUE.stopEvent(evt);
}
}
function execTool() {
obj.fn.call(this, toolEl, evt);
}
if (obj.delay) {
var timeout = (obj.delay === true) ? 0 : obj.delay;
setTimeout(execTool.bind(this), timeout);
} else {
execTool();
}
}.bind(this);
Util.Event.addTouchMouse('start', toolEl, callback);
(new YAHOO.util.KeyListener(toolEl, {
keys: 13
}, {
fn: callback
})).enable();
}
toolsEl.appendChild(toolEl);
this.addComponent(toolEl);
return toolEl;
};
Entity.prototype.getText = function() {
var el = this.getElement();
var text = $(el).text();
text = $.trim(text);
return text;
};
Entity.prototype.isEmpty = function() {
if (this.getText().length === 0) {
return !$(this.getElement()).has('img, audio, video').length;
}
return false;
};
Entity.prototype.getPage = function() {
return this._page;
};
Entity.prototype.getResource = function(type) {
return (this.resources) ? this.resources[type] : null;
};
Entity.prototype.isVisible = function() {
var element = this.getElement();
return Util.Dom.isVisible(element);
};
Entity.prototype.isShowing = function () {
return this._showing;
}
Entity.prototype.show = function () {
if (this.isShowing()) {
return false;
}
this._showing = true;
var entityEl = this.getElement();
CM.Renderer.show(entityEl);
this.fire('show');
return true;
}
Entity.prototype.hide = function () {
if (!this.isShowing()) {
return false;
}
this._showing = false;
var entityEl = this.getElement();
CM.Renderer.hide(entityEl);
this.fire('hide');
return true;
}
Entity.prototype.isActive = function() {
return this == this._page._activeEntity;
};
Entity.prototype.clearActive = function () {
var activeEntity = this._page.getActiveEntity();
if (!activeEntity || activeEntity != this) return false;
this._log('blur entity');
var element = activeEntity.getElement();
CM.blur(element);
this._page.collapseSelection();
this._page._activeEntity = null;
this.fire('blur');
return true;
};
Entity.prototype.setActive = function(domEvent, force)
{
var previousEntity = this._page.getActiveEntity() || null;
if (!force && this == previousEntity) {
return false;
}
this._page.clearEntity();
this._log('focus entity');
this._page._activeEntity = this;
this._page._lastEntity = this;
this.focus();
if (typeof(domEvent) == 'undefined') {
}
this.fire('focus', previousEntity, domEvent);
return true;
};
Entity.prototype.focus = function() {
var entityElement = this.getElement();
CM.focus(entityElement);
};
Entity.prototype.scrollTo = function() {
var element = this.getElement();
element.scrollIntoView(false);
};
Entity.prototype.addComponent = function (el) {
if (!el) return false;
if (Util.Dom.isElement(el)) {
el.setAttribute('tabindex', '0');
}
if (this._components) {
this._components.push(el);
return true;
}
return false;
};
Entity.prototype.getComponents = function (visible) {
var components;
if (visible) {
components = Util.Array.filter(this._components, function (component) {
if (typeof component.isVisible == 'function') {
return component.isVisible();
} else if (Util.Dom.isElement(component)) {
return Util.Dom.isVisible(component);
}
return true;
});
} else {
components = Util.Array.clone(this._components);
}
Util.Dom.sort(components);
return components;
};
Entity.prototype.findComponent = function(element) {
return CM.getAncestor(element, this._components);
};
Entity.prototype.getActiveComponent = function() {
return this._activeComponent;
};
Entity.prototype.setActiveComponent = function(component, force) {
if (!force && this._activeComponent == component) {
return;
}
if (this._activeComponent != null) {
this._log('blur component - \'' + this._activeComponent.id + '\'');
CM.blur(this._activeComponent);
CM.fireComponentEvent('blur', this, this._activeComponent);
this.fire('blurComponent', this._activeComponent);
this._activeComponent = null;
}
if (component == null) {
return;
}
if (!this.isActive()) {
throw new Error('The entity must have focus before setting a component.');
}
var components = this.getComponents();
var componentFound = false;
for (var i = 0; i < components.length; i++) {
if (component == components[i]) {
componentFound = true;
break;
}
}
if (!componentFound) {
throw new Error('Component not found for this item.');
}
this._activeComponent = component;
this._log('focus component - \'' + this._activeComponent.id + '\'');
CM.focus(this._activeComponent);
CM.fireComponentEvent('focus', this, this._activeComponent);
this.fire('focusComponent', this._activeComponent);
};
Entity.prototype.clearComponent = function() {
this.setActiveComponent(null);
};
Entity.prototype.resetComponent = function () {
var firstComponent = Util.Array.pick(this.getComponents());
if (firstComponent) {
this.setActiveComponent(firstComponent);
}
};
Entity.prototype.resetCaretPosition = function () {
var page = this.getPage();
var pageWin = page.getWin();
var pageDoc = page.getDoc();
var element = this.getActiveComponent();
if (!CM.isElement(element)) {
return false;
}
if (!YUD.inDocument(element, pageDoc)) {
return false;
}
CM.focus(pageWin);
var xPathResult = pageDoc.evaluate(".//text()", element, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
var textNode = null;
for (var i = 0, l = xPathResult.snapshotLength; i < l; i++) {
var node = xPathResult.snapshotItem(i);
var text = node.textContent;
text = text.replace(/\s+/g, ' ');
text = text.replace(/^\s+|\s+$/g, '');
textNode = node;
if (text.length > 0) {
break;
}
}
if (!textNode) {
return false;
}
var selection = pageWin.getSelection();
selection.removeAllRanges();
var range = pageDoc.createRange();
range.setStart(textNode, 0);
range.setEnd(textNode, 0);
selection.addRange(range);
selection.collapseToStart();
return true;
};
Entity.prototype.dispose = function () {
this.plugins.getAll().forEach(function (plugin) {
plugin.dispose();
});
this.plugins.clear();
this._activeComponent = null;
if (this._components) {
for (var i = 0; i < this._components.length; i++) {
if (this._components[i].dispose) {
this._components[i].dispose();
}
delete this._components[i];
}
}
this._components = null;
this._page = null;
this.bankKey = null;
this.itemKey = null;
this.audioLinks = null;
this.fire('dispose');
this.removeAllListeners();
};
window.ContentEntity = Entity;
})(ContentManager);

/* SOURCE FILE: content_passage.js (8944891c) 9/9/2014 2:08:51 PM */

var ContentPassage = function(page, bankKey, itemKey, filePath) {
ContentPassage.superclass.constructor.call(this, page, bankKey, itemKey, filePath);
};
YAHOO.lang.extend(ContentPassage, ContentEntity);
ContentPassage.prototype.getID = function() {
return 'G-' + this.bankKey + '-' + this.itemKey;
};
ContentPassage.prototype.getElement = function() {
var pageElement = this.getPage().getElement();
return Util.Dom.getElementByClassName('thePassage', 'div', pageElement);
};
ContentPassage.prototype.getToolsElement = function () {
var pageElement = this.getPage().getElement();
return Util.Dom.getElementByClassName('passageTools', 'div', pageElement);
};
ContentPassage.prototype.clearActive = function() {
var itemElement = this.getElement();
YUD.removeClass(itemElement, 'activePassage');
ContentPassage.superclass.clearActive.call(this);
};
ContentPassage.prototype.setActive = function(domEvent, force)
{
var activated = ContentPassage.superclass.setActive.call(this, domEvent, force);
if (activated) {
var element = this.getElement();
YUD.addClass(element, 'activePassage');
}
return activated;
};
ContentPassage.prototype._log = function(message) {
if (ContentManager._debug) {
ContentManager.log('PASSAGE G-' + this.bankKey + '-' + this.itemKey + ': ' + message);
}
};
ContentPassage.prototype.toString = function() {
return 'Passage G-' + this.bankKey + '-' + this.itemKey;
};

/* SOURCE FILE: content_item.js (69d73768) 10/26/2014 1:27:05 PM */

(function(CM, Entity) {
function Item(page, bankKey, itemKey, filePath, format, responseType, grade, subject, position) {
this.format = format;
this.responseType = responseType;
this.grade = grade;
this.subject = subject;
this.position = position;
this.isDirty = false;
this.value = null;
this.disabled = false;
this.stemTTS = null;
this.illustrationTTS = null;
this.gridAnswerSpace = null;
this.tutorial = null;
this.gtr = null;
Item.superclass.constructor.call(this, page, bankKey, itemKey, filePath);
this.widgets = new CM.Widgets();
this.widgets.on('add', function (widget) {
this.orderedPlugins.push(widget);
}.bind(this));
this.widgets.on('remove', function (widget) {
Util.Array.remove(this.orderedPlugins, widget);
}.bind(this));
};
YAHOO.lang.extend(Item, Entity);
Item.prototype.getParentPage = function() {
return this._page;
};
Item.prototype.getID = function () {
return 'I-' + this.bankKey + '-' + this.itemKey;
};
Item.prototype.init = function () {};
Item.prototype.isReadOnly = function () {
if (CM.isReadOnly()) {
return true;
}
return this.disabled;
};
Item.prototype.isResponseType = function (type) {
return type.toLowerCase() == this.responseType.toLowerCase();
};
Item.prototype.getElement = function () {
var compoundEl = this._page.getCompoundElement();
if (compoundEl) {
return compoundEl;
} else {
var doc = this._page.getDoc();
if (doc) {
return doc.getElementById('Item_' + this.position);
}
}
return null;
};
Item.prototype.getIllustrationElement = function () {
var doc = this._page.getDoc();
return doc ? doc.getElementById('Illustration_' + this.position) : null;
};
Item.prototype.getStemElement = function () {
var doc = this._page.getDoc();
return doc ? doc.getElementById('Stem_' + this.position) : null;
};
Item.prototype.getResponseArea = function () {
var doc = this._page.getDoc();
if (!doc) return null;
var pageEl = this._page.getElement();
var mcWidgets = this.widgets.get('mc');
if (mcWidgets.length) {
var mcWidget = mcWidgets[0];
var optionGroup = mcWidget._group;
var options = optionGroup.getOptions();
var optionElements = [];
if (options && options.length > 0) {
for (var i = 0; i < options.length; i++) {
var optionEl = options[i].getElement();
if (optionEl) {
optionElements.push(optionEl);
}
}
}
return optionElements;
}
return null;
};
Item.prototype.clearActive = function () {
var itemElement = this.getElement();
YUD.removeClass(itemElement, 'activeItem');
Item.superclass.clearActive.call(this);
};
Item.prototype.setActive = function (domEvent, force) {
var activated = Item.superclass.setActive.call(this, domEvent, force);
if (activated) {
var element = this.getElement();
YUD.addClass(element, 'activeItem');
}
return activated;
};
Item.prototype.showFeedback = function () {
var itemEl = this.getElement();
if (itemEl) {
YUD.addClass(itemEl, 'showFeedback');
}
};
Item.prototype.hideFeedback = function () {
var itemEl = this.getElement();
if (itemEl) {
YUD.removeClass(itemEl, 'showFeedback');
}
};
Item.prototype.getToolsElement = function () {
return $('.itemTools', this.getElement()).get(0);
};
Item.prototype._log = function (message) {
if (CM._debug) {
CM.log('ITEM I-' + this.bankKey + '-' + this.itemKey + ' (' + this.position + '): ' + message);
}
};
Item.prototype.toString = function () {
return 'Item I-' + this.bankKey + '-' + this.itemKey;
};
window.ContentItem = Item;
})(ContentManager, ContentEntity);

/* SOURCE FILE: content_response.js (a00bc2b0) 10/26/2014 1:27:05 PM */

(function(CM, CI) {
var DataType = {
Unknown: 'unknown',
String: 'string',
Array: 'array',
Xml: 'xml'
}
CM.DataType = DataType;
var Response = function(id, value, valid, selected) {
Util.Assert.isString(id);
Util.Assert.isNotUndefined(value);
Util.Assert.isBoolean(valid);
var created = new Date();
selected = (typeof selected == 'boolean') ? selected : valid;
Object.defineProperties(this, {
'id': {
get: function () {
return id;
}
},
'created': {
get: function () {
return created;
}
},
'value': {
get: function () {
return value;
}
},
'valid': {
get: function () {
return valid;
}
},
'selected': {
get: function () {
return selected;
}
}
});
Object.defineProperties(this, {
'isValid': {
get: function () {
return valid;
}
},
'isSelected': {
get: function () {
return selected;
}
}
});
}
Response.parseDataType = function(value) {
if (typeof value === 'string') {
return DataType.String;
} else if ($.isArray(value)) {
return DataType.Array;
} else if ($.isXMLDoc(value)) {
return DataType.Xml;
}
return DataType.Unknown;
}
Object.defineProperty(Response.prototype, 'dataType', {
get: function () {
return Response.parseDataType(this.value);
}
});
Response.prototype.toString = function (delimiter) {
var type = dataType;
if (this.value == null) {
return '';
} else if (type == DataType.String) {
return this.value;
} else if (type == DataType.Array) {
return this.value.join(delimiter || ',');
} else if (type == DataType.Xml) {
return Util.Xml.serializeToString(this.value);
} else {
return JSON.stringify(this.value);
}
}
CM.Response = Response;
function Container() {
}
Container.prototype.validate = function() {
}
Container.prototype.load = function () {
throw new Error('Container load not implemented.');
}
Container.prototype.create = function (responses) {
throw new Error('Container create not implemented.');
}
var containerLookup = new Util.Structs.Map();
var containerMap = new Util.Structs.Map();
CM.registerResponseContainer = function (name, cls) {
YAHOO.lang.extend(cls, Container);
containerLookup.set(name.toLowerCase(), cls);
}
CM.mapResponseContainer = function (format, name) {
containerMap.set(format.toLowerCase(), name.toLowerCase());
}
CM.createResponseContainer = function (format) {
var name = containerMap.get(format.toLowerCase());
if (name) {
var cls = containerLookup.get(name);
var instance = new cls();
cls.superclass.constructor.call(instance);
return instance;
}
return null;
}
CI.prototype.isResponseAvailable = function () {
var widgets = this.widgets.getAll();
if (!widgets.length) {
return false;
}
return widgets.every(function(widget) {
return widget.isResponseAvailable();
});
};
CI.prototype.getResponse = function () {
if (!this.isResponseAvailable()) {
return null;
}
var widgets = this.widgets.getAll();
var responses = widgets.map(function (widget) {
var response = widget.getResponse();
if (!(response instanceof Response)) {
throw new Error('No response object returned from response \'' + response.id + '\'.');
}
if (response.value != null && response.dataType != widget.dataType) {
throw new Error('The response data type \'' + response.dataType + '\' does not match the widget data type \'' + widget.dataType + ' \'.');
}
return response;
});
var container = CM.createResponseContainer(this.format);
if (container == null) {
return responses[0];
}
var value = container.create(responses);
var valid = responses.every(function(response) {
return response.valid;
});
var selected = responses.every(function (response) {
return response.selected;
});
return new CM.Response(this.getID(), value, valid, selected);
};
CI.prototype.setResponse = function (value, autoLoad) {
var widgets = this.widgets.getAll();
if (widgets.length == 0) {
throw new Error('No item widgets found');
}
if (autoLoad) {
widgets = widgets.filter(function(widget) {
return widget.options.autoLoad;
});
if (widgets.length == 0) {
return false;
}
}
var container = CM.createResponseContainer(this.format);
if (container == null) {
return widgets[0].setResponse(value);
}
return container.load(value, widgets);
};
})(ContentManager, ContentItem);

/* SOURCE FILE: content_xml.js (7750ad19) 9/9/2014 2:08:51 PM */

(function(CM) {
var getNode = Util.Dom.queryTag;
var getNodes = Util.Dom.queryTags;
var batchNodes = Util.Dom.queryTagsBatch;
var getAttribInt = Util.Xml.getAttributeInt;
var getAttribBool = Util.Xml.getAttributeBool;
var getAttrib = Util.Xml.getAttribute;
var getText = Util.Xml.getNodeText;
var getCData = Util.Xml.getCData;
function parse(contentsNode) {
var contents = [];
batchNodes('content', contentsNode, function(contentNode) {
var content = parseContent(contentNode);
contents.push(content);
});
return contents;
};
function parseContent(contentNode) {
var content = {
id: getAttrib(contentNode, 'groupID'),
segmentID: getAttrib(contentNode, 'segmentID'),
layout: getAttrib(contentNode, 'layout'),
language: getAttrib(contentNode, 'language'),
passage: null,
items: []
};
var soundCueNode = getNode('soundCue', contentNode);
if (soundCueNode) {
content.soundCue = {
bankKey: getAttribInt(soundCueNode, 'bankKey'),
itemKey: getAttribInt(soundCueNode, 'itemKey')
};
}
var passageNode = getNode('passage', contentNode);
if (passageNode) {
content.passage = parsePassage(passageNode);
}
var itemsNode = getNode('items', contentNode);
if (itemsNode) {
batchNodes('item', itemsNode, function(itemNode) {
var item = parseItem(itemNode);
content.items.push(item);
});
}
content.html = getCData(contentNode, 'html');
return content;
};
function parseResources(contentNode)
{
var resources = {};
var resourcesNode = getNode('resources',contentNode);
if (resourcesNode) {
batchNodes('resource', resourcesNode, function (resourceNode) {
var resourceType = getAttrib(resourceNode, 'type');
var resource = {
bankKey: getAttribInt(resourceNode, 'bankKey'),
itemKey: getAttribInt(resourceNode, 'itemKey')
};
resources[resourceType] = resource;
});
}
return resources;
};
function parseAttachments(contentNode) {
var attachments = [];
var attachmentsNode = getNode('attachments', contentNode);
if (attachmentsNode) {
batchNodes('attachment', attachmentsNode, function (attachmentNode) {
var attachment = {
id: getAttrib(attachmentNode, 'id'),
type: getAttrib(attachmentNode, 'type'),
subType: getAttrib(attachmentNode, 'subType'),
target: getAttrib(attachmentNode, 'target'),
url: getAttrib(attachmentNode, 'url')
};
attachments.push(attachment);
});
}
return attachments;
};
function parseMedia(contentNode) {
var mediaResources = [];
var mediaNode = getNode('media', contentNode);
if (mediaNode) {
batchNodes('resource', mediaNode, function (resourceNode) {
var mediaResource = {
file: getAttrib(resourceNode, 'file'),
type: getAttrib(resourceNode, 'type'),
data: getText(resourceNode)
};
mediaResources.push(mediaResource);
});
}
return mediaResources;
};
function parseSpecs(node) {
var specs = [];
var constraintsNode = getNode('constraints', node);
if (constraintsNode != null) {
constraintsNode.parentNode.removeChild(constraintsNode);
specs.push(constraintsNode);
}
var searchNode = getNode('search', node);
if (searchNode != null) {
searchNode.parentNode.removeChild(searchNode);
specs.push(searchNode);
}
return specs;
}
function parsePassage(passageNode) {
var passage = {
bankKey: getAttribInt(passageNode, 'bankKey'),
itemKey: getAttribInt(passageNode, 'itemKey'),
printed: getAttribBool(passageNode, 'printed'),
filePath: getCData(passageNode, 'filePath')
};
passage.resources = parseResources(passageNode);
passage.attachments = parseAttachments(passageNode);
passage.media = parseMedia(passageNode);
passage.specs = parseSpecs(passageNode);
return passage;
}
function parseItem(itemNode)
{
var item = {
bankKey: getAttribInt(itemNode, 'bankKey'),
itemKey: getAttribInt(itemNode, 'itemKey'),
subject: getAttrib(itemNode, 'subject'),
grade: getAttrib(itemNode, 'grade'),
format: getAttrib(itemNode, 'format'),
marked: getAttribBool(itemNode, 'marked'),
disabled: getAttribBool(itemNode, 'disabled'),
responseType: getAttrib(itemNode, 'responseType'),
position: getAttribInt(itemNode, 'position'),
positionOnPage: getAttribInt(itemNode, 'positionOnPage'),
filePath: getCData(itemNode, 'filePath'),
printable: getAttribBool(itemNode, 'printable'),
printed: getAttribBool(itemNode, 'printed')
};
var tutorialNode = getNode('tutorial', itemNode);
if (tutorialNode) {
item.tutorial = {
bankKey: getAttribInt(tutorialNode, 'bankKey'),
itemKey: getAttribInt(tutorialNode, 'itemKey')
};
}
item.resources = parseResources(itemNode);
item.attachments = parseAttachments(itemNode);
item.media = parseMedia(itemNode);
item.rendererSpec = getCData(itemNode, 'rendererSpec');
item.gridAnswerSpace = getCData(itemNode, 'gridAnswerSpace');
var optionsNode = getNode('options', itemNode);
if (optionsNode) {
item.optionsConfig = {
minChoices: getAttribInt(optionsNode, 'minChoices'),
maxChoices: getAttribInt(optionsNode, 'maxChoices')
};
item.options = [];
batchNodes('option', optionsNode, function(optionNode) {
var option = parseOption(optionNode);
item.options.push(option);
});
}
item.value = getCData(itemNode, 'response');
var rubricNode = getNode('rubric', itemNode);
if (rubricNode) {
item.rubric = {
type: getAttrib(rubricNode, 'type'),
data: getText(rubricNode)
};
}
var qtiNode = getNode('qti', itemNode);
if (qtiNode) {
var qtiSpec = getAttrib(qtiNode, 'spec');
var qtiXml = getText(qtiNode);
item.qti = { spec: qtiSpec, xml: qtiXml };
}
item.specs = parseSpecs(itemNode);
return item;
};
function parseOption(optionNode)
{
var option = {
key: getAttrib(optionNode, 'key')
};
option.value = getCData(optionNode, 'value');
option.sound = getCData(optionNode, 'sound');
option.feedback = getCData(optionNode, 'feedback');
return option;
};
function create (root) {
var contentsNode = getNode('contents', root);
var contents = parse(contentsNode);
return contents;
};
CM.Xml = {};
CM.Xml.create = create;
})(ContentManager);

/* SOURCE FILE: content_qti.js (13e167a7) 9/9/2014 2:08:51 PM */

(function (CM) {
var QTI = {};
var validHtmlTags = [
'abbr', 'acronym', 'address', 'blockquote', 'br', 'cite', 'code', 'dfn', 'div', 'em',
'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'kbd', 'p', 'pre', 'q', 'samp', 'span', 'strong', 'var',
'dl', 'dlElement', 'dt', 'dd', 'ol', 'ul', 'li',
'b', 'big', 'hr', 'i', 'small', 'sub', 'sup', 'tt',
'caption', 'col', 'colgroup', 'table', 'tableCell', ' tableCellScope', 'tbody', 'td', 'tfoot',
'th', 'thead', 'tr',
'img',
'a'
];
function adopt(oldParent, newParent) {
if (oldParent && newParent) {
var orphans = YUD.getChildren(oldParent);
if (orphans && orphans.length) {
var orphanCount = orphans.length;
for (var j = 0; j < orphanCount; j++) {
var orphan = orphans[j];
newParent.appendChild(oldParent.removeChild(orphan));
}
}
}
};
function pruneNonHtml(doc) {
var allNodes = [];
var traverseTreeRecursive = function (parentNode) {
if (parentNode) {
allNodes.push(parentNode);
var children = YUD.getChildren(parentNode);
if (children) {
for (var i = 0; i < children.length; i++) {
traverseTreeRecursive(children[i]);
}
}
}
};
var itemNode = doc.documentElement;
traverseTreeRecursive(itemNode);
var nodeCount = allNodes.length;
for (var i = 0; i < nodeCount; i++) {
var currentNode = allNodes.pop();
if ((validHtmlTags.indexOf(currentNode.nodeName) < 0) &&
(currentNode.parentNode != doc)) {
var grandParentNode = currentNode.parentNode;
adopt(currentNode, grandParentNode);
grandParentNode.removeChild(currentNode);
};
}
};
function loadStem(item) {
var stemEl = item.getStemElement();
var xmlString = item.qti.xml;
xmlString = xmlString.replace(/<prompt/g, '<p');
xmlString = xmlString.replace(/<\/prompt/g, '<\/p');
var xmlDoc = Util.Xml.parseFromString(xmlString);
pruneNonHtml(xmlDoc);
adopt(xmlDoc.documentElement, stemEl);
};
QTI.validHtmlTags = validHtmlTags;
QTI.loadStem = loadStem;
function mapInteractionsToWidgetConfigs(item, type, custom) {
var stemEl = item.getStemElement();
var selector = '*[data-qti-type=' + type + ']';
if (custom) {
selector += '[data-qti-custom=' + custom + ']';
}
return $(selector, stemEl).map(function(idx, interactionEl) {
var scriptEl = $(interactionEl).children().get(0);
var interactionId = interactionEl.getAttribute('data-qti-identifier');
var interactionXml = scriptEl.innerHTML;
var interactionDoc = Util.Xml.parseFromString(interactionXml);
var interactionNode = interactionDoc.documentElement;
return new CM.WidgetConfig(interactionId, interactionEl, interactionNode);
}).get();
}
QTI.createWidgetMatch = function (type, custom) {
return function(page, item, content) {
if (item.isResponseType('QTI')) {
return mapInteractionsToWidgetConfigs(item, type, custom);
}
return false;
}
}
QTI.moveContents = function(fromNode, toNode) {
$(fromNode).contents().each(function (idx, childNode) {
$(toNode).append(childNode);
});
}
QTI.replaceNodes = function (parentNode, selector, replacer) {
return $(selector, parentNode).map(function (idx, currentNode) {
var newNode = replacer(currentNode);
QTI.moveContents(currentNode, newNode);
$(currentNode).replaceWith(newNode);
return newNode;
}).get();
}
QTI.replacePrompt = function (parentNode) {
var doc = parentNode.ownerDocument;
var prompts = QTI.replaceNodes(parentNode, 'prompt', function(promptNode) {
var promptEl = doc.createElement('div');
promptEl.setAttribute('class', 'interactionPrompt');
return promptEl;
});
if (prompts.length > 0) {
return prompts[0];
} else {
return null;
}
}
QTI.createInteractionElement = function (interactionNode, nodeName) {
var interactionEl = document.createElement(nodeName || 'div');
interactionEl.innerHTML = Util.Xml.innerHTML(interactionNode);
return interactionEl;
}
CM.QTI = QTI;
})(window.ContentManager);

/* SOURCE FILE: content_plugin_page.js (28d89be0) 9/9/2014 2:08:51 PM */

(function(CM) {
function PagePlugin(page, config) {
Util.Assert.isInstanceOf(ContentPage, page);
Util.Event.Emitter(this);
this.page = page;
this.config = config;
YAHOO.lang.augmentObject(this, {
delay: false,
});
this.init(config);
}
PagePlugin.prototype.getName = function() {
return 'default';
};
PagePlugin.prototype.getResources = function() {
return [];
};
PagePlugin.prototype.init = function(config) {
};
PagePlugin.prototype.load = function () {
};
PagePlugin.prototype.beforeShow = function() {
};
PagePlugin.prototype.show = function() {
};
PagePlugin.prototype.beforeHide = function() {
};
PagePlugin.prototype.hide = function() {
};
PagePlugin.prototype.zoom = function(level) {
};
PagePlugin.prototype.dispose = function () {
};
PagePlugin.prototype.getEntitiesToShow = function () {
return undefined;
}
PagePlugin.prototype.getEntityForFocus = function () {
return null;
}
PagePlugin.prototype.getString = function() {
return 'PLUGIN [' + this.getName() + ']';
}
CM.PagePlugin = PagePlugin;
})(ContentManager);

/* SOURCE FILE: content_plugin_entity.js (5a34f357) 9/9/2014 2:08:51 PM */

(function(CM) {
function EntityPlugin(page, entity, config) {
Util.Assert.isInstanceOf(ContentPage, page);
Util.Assert.isInstanceOf(ContentEntity, entity);
Util.Event.Emitter(this);
this.page = page;
this.entity = entity;
this.config = config;
this.init(config);
}
EntityPlugin.prototype.getResources = function () {
return [];
}
EntityPlugin.prototype.getComponents = function () {
return [];
}
EntityPlugin.prototype.init = function () {
}
EntityPlugin.prototype.load = function (el) {
}
EntityPlugin.prototype.show = function () {
}
EntityPlugin.prototype.hide = function () {
}
EntityPlugin.prototype.focus = function () {
}
EntityPlugin.prototype.blur = function () {
}
EntityPlugin.prototype.zoom = function (level) {
}
EntityPlugin.prototype.keyEvent = function (ev) {
}
EntityPlugin.prototype.showMenu = function (menu, evt) {
}
EntityPlugin.prototype.dispose = function () {
}
CM.EntityPlugin = EntityPlugin;
})(ContentManager);

/* SOURCE FILE: content_widget.js (5a879014) 9/9/2014 2:08:51 PM */

(function(CM) {
function WidgetConfig(id           , element                , data                   ) {
Util.Assert.isInstanceOf(WidgetConfig, this, 'WidgetConfig is a class.');
Util.Assert.isString(id, 'WidgetConfig requires string id.');
Util.Assert.isElement(element, 'WidgetConfig requires HTMLElement.');
this.id = id;
this.element = element;
this.data = data;
}
CM.WidgetConfig = WidgetConfig;
var DefaultProps = {
dataType: CM.DataType.String
};
var DefaultOptions = {
autoLoad: false,
};
function ItemWidget(page                , item                , config                 ) {
Util.Assert.isInstanceOf(ContentPage, page);
Util.Assert.isInstanceOf(ContentItem, item);
Util.Assert.isInstanceOf(WidgetConfig, config);
this.id = config.id;
this.element = config.element;
YAHOO.lang.augmentObject(this, DefaultProps);
if (!this.options) {
this.options = {};
}
YAHOO.lang.augmentObject(this.options, DefaultOptions);
ItemWidget.superclass.constructor.call(this, page, item, config.data);
}
YAHOO.lang.extend(ItemWidget, CM.EntityPlugin);
ItemWidget.prototype.createResponse = function(value, isValid, isSelected) {
return new CM.Response(this.id, value, isValid, isSelected);
};
ItemWidget.prototype.isResponseAvailable = function() {
return true;
};
ItemWidget.prototype.getResponse = function () {
return null;
};
ItemWidget.prototype.setResponse = function (value) {
return false;
};
CM.ItemWidget = ItemWidget;
})(ContentManager);

/* SOURCE FILE: content_plugins.js (d230484a) 10/26/2014 1:27:05 PM */

ContentManager.Plugins = (function () {
function Plugins() {
this._lookup = new Util.Structs.Map();
Util.Event.Emitter(this);
}
Plugins.prototype.remove = function(plugin) {
return Util.Array.remove(this._lookup, plugin);
};
Plugins.prototype.add = function(name, plugin) {
this._lookup.set(name, plugin);
this.fire('add', plugin);
};
Plugins.prototype.getNames = function() {
return this._lookup.getKeys();
};
Plugins.prototype.getAll = function () {
return this._lookup.getValues();
};
Plugins.prototype.has = function(name) {
return this._lookup.containsKey(name);
};
Plugins.prototype.get = function(name) {
return this._lookup.get(name);
};
Plugins.prototype.remove = function (name) {
var removed = this._lookup.remove(name);
if (removed) {
this.fire('remove', plugin);
}
};
Plugins.prototype.clear = function() {
this._lookup.clear();
};
return Plugins;
})();

/* SOURCE FILE: content_plugins_manager.js (41e06432) 10/26/2014 1:27:05 PM */

(function (CM) {
var lookup = new Util.Structs.Map();
function getValues() {
return lookup.getValues();
}
function get(name) {
return lookup.get(name);
}
function clear() {
lookup.clear();
}
function register(name, cls, match) {
Util.Assert.isString(name, 'Name should be a string.');
Util.Assert.isFunction(cls);
Util.Assert.isFunction(match);
if (typeof cls.superclass != 'object' ||
typeof cls.superclass.constructor != 'function') {
YAHOO.lang.extend(cls, CM.PagePlugin);
}
lookup.set(name, {
name: name,
cls: cls,
match: match
});
}
function create(reg, page, config) {
var instance = new reg.cls(page, config);
reg.cls.superclass.constructor.call(instance, page, config);
return instance;
}
function findMatches(page, content) {
function configure(reg, config) {
var instance = create(reg, page, config);
page.plugins.add(reg.name, instance);
}
getValues().forEach(function (reg) {
if (typeof reg.match != 'function') return;
var configs = reg.match(page, content);
if (configs) {
configure(reg, configs);
}
});
var pluginNames = page.plugins.getNames();
if (pluginNames.length > 0) {
console.log('Page Plugins: ' + pluginNames.join(', '));
}
}
function eachPlugin(page, callback) {
page.plugins.getAll().forEach(callback);
}
function onPageCreated(page, content) {
page.on('rendered', function () {
findMatches(page, content);
});
page.on('available', function () {
eachPlugin(page, function (plugin) {
if (!plugin.delay) {
plugin.load();
}
});
});
page.on('loaded', function () {
eachPlugin(page, function (plugin) {
if (plugin.delay) {
plugin.load();
}
});
});
page.on('show', function () {
eachPlugin(page, function (plugin) {
plugin.show();
});
});
page.on('beforeShow', function () {
eachPlugin(page, function (plugin) {
plugin.beforeShow();
});
});
page.on('beforeHide', function () {
eachPlugin(page, function (plugin) {
plugin.beforeHide();
});
});
page.on('hide', function () {
eachPlugin(page, function (plugin) {
plugin.hide();
});
});
page.on('zoom', function (level) {
eachPlugin(page, function (plugin) {
plugin.zoom(level);
});
});
}
CM.on('pagesCreated', function (pages) {
pages.on('pageCreated', onPageCreated);
});
CM.registerPagePlugin = register;
CM.getPagePlugin = get;
CM.getPagePlugins = getValues;
CM.clearPagePlugins = clear;
})(ContentManager);

/* SOURCE FILE: content_widgets.js (4f506b0e) 10/26/2014 1:27:05 PM */

ContentManager.Widgets = (function () {
function Widgets() {
this._list = [];
this._groups = {};
Util.Event.Emitter(this);
}
Widgets.prototype.add = function(name, widget) {
if (this._list.indexOf(widget) != -1) {
throw new Error('The widget \'' + widget.id + '\' is already added');
}
this._list.push(widget);
var group = this._groups[name];
if (!group) {
group = [];
this._groups[name] = group;
}
group.push(widget);
this._list.sort(function(w1, w2) {
var e1 = w1.element;
var e2 = w2.element;
return e1.compareDocumentPosition(e2) & 2 ? 1 : -1;
});
this.fire('add', widget);
};
Widgets.prototype.getAll = function () {
return this._list;
};
Widgets.prototype.getNames = function() {
return Util.Object.keys(this._groups);
};
Widgets.prototype.has = function(name) {
return !!this._groups[name];
};
Widgets.prototype.get = function(name, id) {
var group = this._groups[name] || [];
if (typeof id == 'string') {
return Util.Array.find(group, function (widget) {
return widget.id == id;
});
} else if (typeof id == 'number') {
return group[id];
} else {
return group;
}
};
Widgets.prototype.remove = function (widget) {
var removed = Util.Array.remove(this._list, widget);
Util.Object.each(this._groups, function (widgets, name) {
if (Util.Array.remove(widgets, widget)) {
if (!widgets.length) {
delete this._groups[name];
}
}
}, this);
if (removed) {
this.fire('remove', widget);
}
return removed;
};
Widgets.prototype.clear = function () {
Util.Array.clear(this._list);
Object.keys(this._groups).forEach(function (group) {
Util.Array.clear(group);
});
Util.Object.clear(this._groups);
};
return Widgets;
})();

/* SOURCE FILE: content_widgets_manager.js (fc7c0cb1) 10/26/2014 1:27:05 PM */

(function (CM) {
var registrations = [];
function sort(arr) {
Util.Array.sort(arr, function (obj1, obj2) {
return Util.Array.numericSort(obj1.priority, obj2.priority);
});
}
function addRegistration(name, cls, match, opts, defaults) {
var reg = {
name: name,
cls: cls,
match: match
}
if (opts) {
YAHOO.util.Lang.augmentObject(reg, opts);
}
if (defaults) {
YAHOO.util.Lang.augmentObject(reg, defaults);
}
registrations.push(reg);
sort(registrations);
}
function extendPlugin(cls) {
if (typeof cls.superclass != 'object' ||
typeof cls.superclass.constructor != 'function') {
YAHOO.lang.extend(cls, CM.EntityPlugin);
}
}
function extendWidget(cls) {
YAHOO.lang.extend(cls, CM.ItemWidget);
}
function registerPlugin(name, cls, match, opts) {
extendPlugin(cls);
addRegistration(name, cls, match, opts, {
widget: false,
priority: 100,
defer: false
});
}
function registerWidget(name, cls, match, opts) {
extendWidget(cls);
addRegistration(name, cls, match, opts, {
widget: true,
priority: 200,
defer: false
});
}
function create(cls, page, entity, config) {
var instance = new cls(page, entity, config);
cls.superclass.constructor.call(instance, page, entity, config);
return instance;
}
function findMatches(page, entity, content, list) {
var errors = [],
instances = [],
entityEl = entity.getElement(),
isItem = (entity instanceof ContentItem);
if (!entityEl) return instances;
function configure(reg, config) {
if (reg.widget) {
Util.Assert.isInstanceOf(CM.WidgetConfig, config, 'The match() function must return a WidgetConfig.');
}
var instance = create(reg.cls, page, entity, config);
instances.push(instance);
if (instance instanceof CM.ItemWidget) {
entity.widgets.add(reg.name, instance);
} else {
entity.plugins.add(reg.name, instance);
}
}
list.forEach(function (reg) {
if (reg.widget && !isItem) {
return;
}
var configs;
try {
configs = reg.match(page, entity, content);
} catch (ex) {
errors.push(ex);
}
if (configs) {
if (reg.widget && $.isArray(configs)) {
configs.forEach(function (config) {
configure(reg, config);
});
} else {
configure(reg, configs);
}
}
});
errors.forEach(function (ex) {
entity.addError(ex);
console.error(ex);
});
var pluginNames = entity.plugins.getNames();
if (pluginNames.length > 0) {
console.log('Entity Plugins: ' + pluginNames.join(', '));
}
if (isItem) {
var widgetNames = entity.widgets.getNames();
if (widgetNames.length > 0) {
var sbWidget = new Util.StringBuilder('Item Widgets: ');
widgetNames.forEach(function (name, widx) {
if (widx > 0) {
sbWidget.append(', ');
}
sbWidget.append(name);
var widgets = entity.widgets.get(name);
if (widgets) {
sbWidget.append(' [');
widgets.forEach(function (widget, idx) {
if (idx > 0) {
sbWidget.append(', ');
}
sbWidget.append(widget.id);
});
sbWidget.append(']');
}
});
console.log(sbWidget.toString());
}
}
return instances;
}
function loadInstances(page, entity, instances) {
var errors = [];
instances.forEach(function (instance) {
var result;
try {
result = instance.load();
} catch (ex) {
errors.push(ex);
Util.Array.remove(entity.orderedPlugins, instance);
if (instance instanceof CM.ItemWidget) {
entity.widgets.remove(instance);
} else {
entity.plugins.remove(instance);
}
return;
}
if (Util.Promise.isPromise(result)) {
var rlp = new ResourceLoader.Promise(result);
page.addResourceLoader(rlp);
}
var components = instance.getComponents();
components.forEach(function (component) {
entity.addComponent(component);
});
});
errors.forEach(function (ex) {
entity.addError(ex);
console.error(ex);
});
}
function eachPlugin(entity, callback) {
entity.orderedPlugins.forEach(callback);
}
function onEntityCreated(entity, content) {
entity.on('rendered', function () {
var filteredRegs = registrations.filter(function(reg) {
return !reg.defer;
});
findMatches(this, entity, content, filteredRegs);
}.bind(this));
entity.on('show', function () {
eachPlugin(entity, function (obj) {
obj.show();
});
});
entity.on('hide', function () {
eachPlugin(entity, function (obj) {
obj.hide();
});
});
entity.on('focus', function (previousEntity, domEvent) {
eachPlugin(entity, function (obj) {
obj.focus(previousEntity, domEvent);
});
});
entity.on('blur', function () {
eachPlugin(entity, function (obj) {
obj.blur();
});
});
entity.on('keyevent', function (evt) {
eachPlugin(entity, function (obj) {
obj.keyEvent(evt);
});
});
entity.on('menushow', function (contentMenu, evt, pageSelection) {
eachPlugin(entity, function (obj) {
obj.showMenu(contentMenu, evt, pageSelection);
});
});
}
function onPageCreated(page, content) {
page.on('passageCreated', onEntityCreated);
page.on('itemCreated', onEntityCreated);
page.on('available', function () {
page.getEntities().forEach(function (entity) {
loadInstances(page, entity, entity.orderedPlugins);
var deferredRegs = registrations.filter(function (reg) {
return reg.defer;
});
var deferredInstances = findMatches(page, entity, content, deferredRegs);
loadInstances(page, entity, deferredInstances);
});
});
page.on('loaded', function () {
page.getItems().forEach(function (item) {
if (item.value) {
item.setResponse(item.value, true);
}
});
});
page.on('beforeShow', function () {
var zoom = CM.getZoom();
var factor = zoom.getFactor();
if (!zoom || factor == this.zoomFactor) {
return;
}
page.getEntities().forEach(function (entity) {
eachPlugin(entity, function (obj) {
obj.zoom(factor);
});
});
});
page.on('zoom', function (level) {
page.getEntities().forEach(function (entity) {
eachPlugin(entity, function (obj) {
obj.zoom(level);
});
});
});
}
CM.on('pagesCreated', function (pages) {
pages.on('pageCreated', onPageCreated);
});
CM.extendEntityPlugin = extendPlugin;
CM.registerEntityPlugin = registerPlugin;
CM.extendWidget = extendWidget;
CM.registerWidget = registerWidget;
CM.createWidget = create;
CM.getEntityPlugins = function () {
return registrations;
};
CM.clearEntityPlugins = function () {
Util.Array.clear(registrations);
};
})(ContentManager);

/* SOURCE FILE: content_events.js (92f88671) 9/9/2014 2:08:51 PM */

(function (CM) {
var pageEvents = new Util.Event.Emitter(CM);
var entityEvents = new Util.Event.Emitter(CM);
var itemEvents = new Util.Event.Emitter(CM);
var passageEvents = new Util.Event.Emitter(CM);
var componentEvents = new Util.Event.Emitter(CM);
CM.onPageEvent = function (name, callback) {
pageEvents.on(name, callback, null, false);
};
CM.oncePageEvent = function (name, callback) {
pageEvents.once(name, callback, null, true);
};
CM.removePageEvent = function(name, callback) {
pageEvents.removeListener(name, callback);
}
CM.onEntityEvent = function (name, callback) {
entityEvents.on(name, callback, null, false);
};
CM.onceEntityEvent = function (name, callback) {
entityEvents.once(name, callback, null, true);
};
CM.removeEntityEvent = function (name, callback) {
entityEvents.removeListener(name, callback);
};
CM.onItemEvent = function (name, callback) {
itemEvents.on(name, callback, null, false);
};
CM.onceItemEvent = function (name, callback) {
itemEvents.once(name, callback, null, true);
};
CM.removeItemEvent = function (name, callback) {
itemEvents.removeListener(name, callback);
};
CM.onPassageEvent = function (name, callback) {
passageEvents.on(name, callback, null, false);
};
CM.oncePassageEvent = function (name, callback) {
passageEvents.once(name, callback, null, true);
};
CM.removePassageEvent = function (name, callback) {
passageEvents.removeListener(name, callback);
};
CM.onComponentEvent = function (name, callback) {
componentEvents.on(name, callback, null, false);
};
CM.onceComponentEvent = function (name, callback) {
componentEvents.once(name, callback, null, true);
};
CM.removeComponentEvent = function (name, callback) {
componentEvents.removeListener(name, callback);
};
CM.firePageEvent = function (name, page, args, fireEntityEvents) {
if (typeof page == 'string') {
page = CM.getPage(page);
}
Util.Assert.isString(name);
Util.Assert.isInstanceOf(ContentPage, page);
var pageArgs = [page].concat(args || []);
var ret = pageEvents.fireArgs(name, pageArgs);
if (fireEntityEvents === true && ret !== false) {
var passage = page.getPassage();
if (passage) {
CM.fireEntityEvent(name, passage, args);
}
var items = page.getItems();
for (var i = 0; i < items.length; i++) {
CM.fireEntityEvent(name, items[i], args);
}
}
return ret;
};
CM.fireEntityEvent = function (name, entity, args) {
Util.Assert.isString(name);
Util.Assert.isInstanceOf(ContentEntity, entity);
var page = entity.getPage();
var entityArgs = [page, entity].concat(args || []);
entityEvents.fireArgs(name, entityArgs);
if (entity instanceof ContentItem) {
itemEvents.fireArgs(name, entityArgs);
} else if (entity instanceof ContentPassage) {
passageEvents.fireArgs(name, entityArgs);
}
};
CM.fireComponentEvent = function (name, entity, component, args) {
var page = entity.getPage();
var componentArgs = [page, entity, component].concat(args || []);
componentEvents.fireArgs(name, componentArgs);
};
function onEntityCreated(entity, content) {
entity.on('show', function () {
return CM.fireEntityEvent('show', entity);
});
entity.on('hide', function () {
return CM.fireEntityEvent('hide', entity);
});
entity.on('focus', function (previousEntity) {
return CM.fireEntityEvent('focus', entity, previousEntity);
});
entity.on('blur', function () {
return CM.fireEntityEvent('blur', entity);
});
entity.on('menushow', function(contentMenu, evt, pageSelection) {
return CM.fireEntityEvent('menushow', entity, [contentMenu, evt, pageSelection]);
});
return CM.fireEntityEvent('init', entity, [content]);
}
function onPageCreated(page, content) {
var stateNames = CM.Renderer.getStateNames();
stateNames.forEach(function pageEvent(status) {
page.once(status, function() {
return CM.firePageEvent(status, page, null, true);
});
});
page.on('passageCreated', onEntityCreated);
page.on('itemCreated', onEntityCreated);
page.on('beforeShow', function () {
return CM.firePageEvent('beforeShow', page);
});
page.on('show', function () {
return CM.firePageEvent('show', page);
});
page.on('afterShow', function () {
return CM.firePageEvent('afterShow', page);
});
page.on('beforeHide', function () {
return CM.firePageEvent('beforeHide', page);
});
page.on('hide', function () {
return CM.firePageEvent('hide', page);
});
page.on('beforeZoom', function (level) {
return CM.firePageEvent('beforeZoom', page, [level], true);
});
page.on('zoom', function (level) {
return CM.firePageEvent('zoom', page, [level], true);
});
page.on('keyevent', function (evt) {
return CM.firePageEvent('keyevent', page, [evt], true);
});
return CM.firePageEvent('init', page, [content], false);
}
CM.on('pagesCreated', function (pages) {
pages.on('pageCreated', onPageCreated);
});
})(ContentManager);

/* SOURCE FILE: content_keyboard.js (40f9bcf0) 10/26/2014 1:27:05 PM */

(function(CM) {
function onKeyEvent(evt) {
if (evt.ctrlKey && !Util.Browser.supportsModifierKeys()) {
return;
}
if (CM.isDialogShowing()) return;
if (evt.ctrlKey && evt.keyCode == 77) {
YUE.stopEvent(evt);
if (evt.type == 'keydown') {
CM.Menu.show({ evt: evt });
}
};
if (CM.Menu.isShowing()) return;
if (CM.isDialogShowing()) return;
if (evt.keyCode == 9) {
YUE.stopEvent(evt);
}
var currentPage = CM.getCurrentPage();
if (currentPage == null) return;
var currentEntity = currentPage.getActiveEntity();
if (currentEntity == null) return;
if (!evt.key) {
switch (evt.keyCode) {
case 9: evt.key = 'Tab'; break;
case 13: evt.key = 'Enter'; break;
case 27: evt.key = 'Esc'; break;
case 32: evt.key = 'Space'; break;
case 37: evt.key = 'Left'; break;
case 38: evt.key = 'Up'; break;
case 39: evt.key = 'Right'; break;
case 40: evt.key = 'Down'; break;
}
}
currentPage.fire('keyevent', evt);
currentEntity.fire('keyevent', evt);
}
CM.addKeyEvents = function (keyEventObj) {
if (!CM.enableKeyEvents) return false;
if (keyEventObj == null) return false;
if (keyEventObj.__tds_keyEventsEnabled === true) return false;
YUE.addListener(keyEventObj, "keydown", onKeyEvent);
YUE.addListener(keyEventObj, "keypress", onKeyEvent);
YUE.addListener(keyEventObj, "keyup", onKeyEvent);
keyEventObj.__tds_keyEventsEnabled = true;
return true;
};
function processTab(page, evt) {
var moveBack = evt && evt.shiftKey;
var mapping = page.getComponents();
var currentEntity = page.getActiveEntity();
var currentComponent = currentEntity.getActiveComponent();
var currentIC = Util.Array.find(mapping, function (ic) {
return ic.entity == currentEntity && ic.component == currentComponent;
});
var nextIC;
var iter = Util.Iterator(mapping);
iter.jumpTo(currentIC);
if (moveBack) {
nextIC = iter.prev();
} else {
nextIC = iter.next();
}
var nextEntity = nextIC.entity;
var nextComponent = nextIC.component;
if (nextEntity && nextEntity != currentEntity) {
nextEntity.setActive(evt);
}
if (nextComponent && nextComponent != currentComponent) {
nextEntity.setActiveComponent(nextComponent);
}
}
CM.onPageEvent('keyevent', function (page, evt) {
if (evt.type != 'keydown') return;
if (evt.key == 'Tab' && !evt.ctrlKey && !evt.altKey) {
processTab(page, evt);
}
});
CM.onPageEvent('keyevent', function (page, evt) {
var keyCode = evt.keyCode;
var arrowKeys = (keyCode >= 37 && keyCode <= 40);
if (!arrowKeys) return;
if (Util.Event.hasModifier(evt)) return;
if (Mozilla.inCaretMode()) return;
var targetEl = YAHOO.util.Event.getTarget(evt);
if (Util.Event.inTextInput(evt)) return;
if (Util.Dom.isFormElement(targetEl)) return;
if (targetEl.tagName == 'svg') return;
YUE.stopEvent(evt);
if (evt.type != 'keydown') return;
page.scroll(evt.key);
});
var lastRange = null;
CM.onEntityEvent('keyevent', function (page, entity, evt) {
if (!Mozilla.inCaretMode()) return;
var caretMoveKey = (evt.key == 'Up' || evt.key == 'Down' || evt.key == 'Left' || evt.key == 'Right');
if (!caretMoveKey) return;
var pageWin = entity.getPage().getWin();
var selection = pageWin.getSelection();
var range;
try {
range = selection.getRangeAt(0);
}
catch (ex) { return; }
if (!range) return;
var activeElement = entity.getActiveComponent();
var startElement = range.startContainer;
var endElement = range.endContainer;
var outOfBounds = (CM.getAncestor(startElement, [activeElement]) == null);
if (!outOfBounds) outOfBounds = (CM.getAncestor(endElement, [activeElement]) == null);
if (outOfBounds) {
if (!lastRange) return;
try {
selection.collapseToStart();
selection.removeAllRanges();
selection.addRange(lastRange);
}
catch (ex) { return; }
}
else {
lastRange = range.cloneRange();
}
});
})(ContentManager);

/* SOURCE FILE: content_zoom.js (e823f3a6) 9/9/2014 2:08:51 PM */

(function (CM) {
var ORIG_WIDTH = 'data-width';
var ORIG_HEIGHT = 'data-height';
var ZOOM_LEVEL = 'data-zoom';
var LEVELS = [
{ css: 'TDS_PS_L0', factor: 1 },
{ css: 'TDS_PS_L1', factor: 1.25 },
{ css: 'TDS_PS_L2', factor: 1.5 },
{ css: 'TDS_PS_L3', factor: 1.75 },
{ css: 'TDS_PS_L4', factor: 2 }
];
function getLevelClass(level) {
if (LEVELS[level]) {
return LEVELS[level].css;
}
return undefined;
};
function getFactor(level) {
if (LEVELS[level]) {
return LEVELS[level].factor;
}
return -1;
};
function parseLevelFromEl(el, defaultValue) {
if (Util.Dom.isDocument(el)) {
el = el.body;
}
if (hasAttribute(el, ZOOM_LEVEL)) {
return el.getAttribute(ZOOM_LEVEL) * 1;
}
return typeof defaultValue == 'number' ? defaultValue : -1;
}
function parseLevelFromClass(name, defaultValue) {
for (var i = 0; i < LEVELS.length; i++) {
if (LEVELS[i].css == name) {
return i;
}
}
return typeof defaultValue == 'number' ? defaultValue : - 1;
}
function hasAttribute(ele, attr) {
if (ele.hasAttribute) {
return ele.hasAttribute(attr);
} else {
return ele.getAttribute(attr) != null;
}
}
function removeClasses(el) {
LEVELS.forEach(function (level) {
$(el).removeClass(level.css);
});
}
function getImages(parentEl) {
if (!parentEl) return [];
return $('img', parentEl).toArray();
}
function getFlashObjects(parentEl) {
if (!parentEl) return [];
return $('embed, object', parentEl).filter(function (idx, el) {
if (el.type == 'application/x-shockwave-flash') {
if (el.nodeName == 'OBJECT' && el.data && el.data.indexOf('jwplayer') != -1) {
return false;
}
return true;
}
}).map(function (idx, el) {
if (el.nodeName == 'EMBED') {
return el.parentNode;
} else {
return el;
}
}).toArray();
}
function getElements(parentEl) {
return Util.Array.concat(
getImages(parentEl),
getFlashObjects(parentEl));
}
function saveImageDimensions(image) {
if (!image) {
return;
}
if (hasAttribute(image, ORIG_HEIGHT)) {
return;
}
if (image.width > 0 && image.height > 0) {
image.setAttribute(ORIG_WIDTH, image.width);
image.setAttribute(ORIG_HEIGHT, image.height);
}
};
function saveElementDimensions(el) {
if (!el) {
return;
}
if (hasAttribute(el, ORIG_HEIGHT)) {
return;
}
var width, height;
if (hasAttribute(el, 'width') &&
hasAttribute(el, 'height')) {
width = el.getAttribute('width') * 1;
height = el.getAttribute('height') * 1;
} else {
width = $(el).width();
height = $(el).height();
}
if (width > 0 && height > 0) {
el.setAttribute(ORIG_WIDTH, width);
el.setAttribute(ORIG_HEIGHT, height);
}
}
function saveDimensions(parentEl) {
if (!parentEl) {
return;
}
getImages(parentEl).forEach(function (el) {
saveImageDimensions(el);
});
getFlashObjects(parentEl).forEach(function (el) {
saveElementDimensions(el);
});
}
function styleElement(el, level) {
var className = getLevelClass(level);
if (className && !$(el).hasClass(className)) {
removeClasses(el);
$(el).addClass(className);
return true;
} else {
return false;
}
}
function zoomElement(el, level) {
if (!hasAttribute(el, ORIG_WIDTH)) {
return false;
}
var factor = getFactor(level);
if (!(factor > 0)) {
return false;
}
var zoomWidth = el.getAttribute(ORIG_WIDTH) * factor;
var zoomHeight = el.getAttribute(ORIG_HEIGHT) * factor;
if (el.nodeName == 'IMG') {
el.width = zoomWidth;
el.height = zoomHeight;
} else {
$(el).css('width', zoomWidth + 'px');
$(el).css('height', zoomHeight + 'px');
}
return true;
}
function zoomElements(parentEl, level) {
var prevLevel = parseLevelFromEl(parentEl);
if (prevLevel === level) return false;
saveDimensions(parentEl);
getElements(parentEl).forEach(function (el) {
zoomElement(el, level);
});
parentEl.setAttribute(ZOOM_LEVEL, level);
return true;
}
function Zoom(defaultZoomCSS) {
Util.Event.Emitter(this);
this._zoomables = [];
this.previousLevel = -1;
this.defaultLevel = parseLevelFromClass(defaultZoomCSS, 0);
this.currentLevel = this.defaultLevel;
}
Zoom.prototype.getCSS = function () {
return LEVELS[this.currentLevel].css;
};
Zoom.prototype.getFactor = function() {
return LEVELS[this.currentLevel].factor;
};
Zoom.prototype.addDocument = function (doc, options) {
doc = doc || document;
options = options || {};
YAHOO.lang.augmentObject(options, {
cleanClasses: true,
includeElements: true
});
if (this._zoomables.some(function (obj) {
return (obj.document == doc);
})) {
return false;
}
if (options.cleanClasses) {
removeClasses(doc);
}
var obj = {
document: doc,
options: options
};
this._zoomables.push(obj);
this._updateLevel(obj);
return true;
};
Zoom.prototype._updateLevel = function(obj) {
var level = this.currentLevel;
var el = obj.document.body;
styleElement(el, level);
if (obj.options.includeElements) {
zoomElements(el, level);
}
};
Zoom.prototype.setLevel = function (level, force) {
if (typeof level == 'string') {
level = parseLevelFromClass(level, 0);
} else if (typeof level != 'number') {
return false;
}
if (!force && this.currentLevel === level) {
return false;
}
this.previousLevel = this.currentLevel;
this.currentLevel = level;
this._zoomables.forEach(this._updateLevel.bind(this));
this.fire('change', level);
return true;
};
Zoom.prototype.zoomIn = function () {
if (this.currentLevel < LEVELS.length - 1) {
return this.setLevel(this.currentLevel + 1);
} else {
return false;
}
};
Zoom.prototype.zoomOut = function () {
if (this.currentLevel > 0) {
return this.setLevel(this.currentLevel - 1);
} else {
return false;
}
};
Zoom.prototype.reset = function (force) {
this.setLevel(this.defaultLevel, force);
};
Zoom.prototype.refresh = function () {
return this.setLevel(this.currentLevel, true);
};
Zoom.prototype.updateElements = function(parentEl) {
zoomElements(parentEl, this.currentLevel);
};
Zoom.prototype.updateElement = function(el) {
zoomElement(el, this.currentLevel);
};
window.ContentZoom = Zoom;
})(window.ContentManager);
(function(CM) {
if (!CM) return;
CM.onPageEvent('beforeShow', function (page) {
page.updateElementsZoom();
});
CM.onPageEvent('zoom', function (page, level) {
if (page == CM.getCurrentPage()) {
page.zoomLevel = level;
page.updateElementsZoom();
}
});
})(window.ContentManager);

/* SOURCE FILE: content_menu.js (704e7e2f) 10/26/2014 1:27:05 PM */

(function(CM) {
function MenuCollection() {
this._global = [];
this._entity = [];
this._component = [];
this.cancel = false;
};
MenuCollection.prototype.getMenuItems = function() {
if (this._entity.length > 0 || this._component.length > 0) {
return Util.Array.concat(this._entity, this._component);
} else if (this._global.length > 0) {
return this._global;
}
return [];
};
MenuCollection.prototype.addMenuItem = function(level, label, fn, disabled, checked, insert) {
var menuItem;
if (YAHOO.lang.isString(label)) {
menuItem = { text: label };
} else if (YAHOO.lang.isObject(label)) {
menuItem = label;
} else {
return;
}
if (YAHOO.lang.isFunction(fn)) {
if (YAHOO.env.ua.gecko) {
var scheduledFunc = function() {
YAHOO.lang.later(0, this, fn);
};
menuItem.onclick = { fn: scheduledFunc };
} else {
menuItem.onclick = { fn: fn };
}
}
if (YAHOO.lang.isBoolean(disabled)) {
menuItem.disabled = disabled;
}
if (YAHOO.lang.isBoolean(checked)) {
menuItem.checked = checked;
}
var collection = this['_' + level];
if (collection) {
if (insert) {
collection.unshift(menuItem);
} else {
collection.push(menuItem);
}
}
};
MenuCollection.prototype.insertMenuItem = function(level, label, fn, disabled, checked) {
this.addMenuItem(level, label, fn, disabled, checked, true);
};
var menuInstance = null;
var MenuManager = {};
MenuManager.getInstance = function() {
return menuInstance;
};
MenuManager.init = function() {
var menuId = "menu_" + Math.random().toString().split('.')[1];
var contextMenu = new YAHOO.widget.ContextMenu(menuId, {
zindex: 1000,
iframe: false,
shadow: false
});
menuInstance = contextMenu;
contextMenu.showEvent.subscribe(function() {
setTimeout(function() {
this.cfg.setProperty('clicktohide', true);
}.bind(this), 500);
});
contextMenu.beforeHideEvent.subscribe(function() {
if (contextMenu.activeItem &&
contextMenu.activeItem._oAnchor) {
Util.Dom.blur(contextMenu.activeItem._oAnchor);
}
if (document.activeElement &&
YUD.hasClass(document.activeElement, 'yuimenuitemlabel')) {
Util.Dom.blur(document.activeElement);
}
contextMenu.clearActiveItem();
});
contextMenu.hideEvent.subscribe(function () {
this.cfg.setProperty('clicktohide', false);
});
MenuManager.applyTextSelectionFix(contextMenu);
if (Util.Browser.isOnlyTouchDevice()) {
menuInstance.setInitialFocus = function () { };
menuInstance.setInitialSelection = function () { };
}
};
MenuManager.isShowing = function() {
return (menuInstance && menuInstance.cfg.getProperty('visible'));
};
MenuManager.show = function (opts) {
opts = opts || {};
YAHOO.lang.augmentObject(opts, {
custom: [],
xy: null,
location: 'top',
target: null,
evt: null,
entity: null,
component: null
});
var menuItems = opts.custom;
if (!menuInstance) {
return false;
}
if (MenuManager.hide()) {
return false;
}
if (menuItems.length == 0 && CM.isReadOnly()) {
return false;
}
var entity = opts.entity;
if (!entity) {
var page = CM.getCurrentPage();
if (page) {
entity = page.getActiveEntity();
}
}
var component = opts.component;
if (!component && entity) {
component = entity.getActiveComponent();
}
var targetEl = opts.target;
var domEvent = opts.evt;
var menuXY = opts.xy;
if (!menuXY) {
var fromElement = null;
if (targetEl) {
fromElement = targetEl;
} else if (component && component.getXY) {
menuXY = component.getXY();
} else if (domEvent && !domEvent.keyCode) {
menuXY = CM.getEventXY(domEvent);
} else if (Util.Dom.isElement(component)) {
fromElement = component;
} else if (entity) {
fromElement = entity.getElement();
}
if (fromElement) {
menuXY = YUD.getXY(fromElement);
if (opts.location == 'bottom') {
var region = YUD.getRegion(fromElement);
menuXY[1] += region.height;
}
}
}
if (entity) {
var frameEl = entity.getPage().getFrameElement();
if (frameEl) {
var frameXY = YUD.getXY(frameEl);
menuXY = [menuXY[0] + frameXY[0], menuXY[1] + frameXY[1]];
}
}
if (menuItems.length == 0) {
var contentMenu = new MenuCollection();
var pageSelection = CM.getSelection(document);
entity.fire('menushow', contentMenu, domEvent, pageSelection);
if (contentMenu.cancel) {
return false;
}
menuItems = contentMenu.getMenuItems();
}
if (menuItems.length == 0) {
menuItems.push({
text: Messages.getAlt('TDSContentEventsJS.Label.EmptyMenu', 'Empty'),
disabled: true
});
}
menuInstance.clearContent();
menuInstance.contextEventTarget = targetEl;
menuInstance.cfg.setProperty('xy', menuXY);
menuInstance.addItems(menuItems);
menuInstance.render(document.body);
menuInstance.show();
return true;
};
MenuManager.hide = function() {
if (menuInstance && MenuManager.isShowing()) {
menuInstance.hide();
return true;
}
return false;
};
MenuManager.applyDocFix = function(contentDoc) {
if (document == contentDoc) {
return;
}
new YAHOO.widget.Menu('preload');
var docListeners = YAHOO.util.Event.getListeners(document);
if (docListeners == null) {
return;
}
var focusBlurAssigned = false;
for (var i = 0; i < docListeners.length; i++) {
var listener = docListeners[i];
if (listener.obj == YAHOO.widget.MenuManager) {
YUE.on(contentDoc, listener.type, listener.fn, YAHOO.widget.MenuManager, true);
if (!focusBlurAssigned) {
YUE.onFocus(contentDoc, listener.fn, YAHOO.widget.MenuManager, true);
YUE.onBlur(contentDoc, listener.fn, YAHOO.widget.MenuManager, true);
focusBlurAssigned = true;
}
}
}
};
MenuManager.applyTextSelectionFix = function(contextMenu) {
if (YAHOO.env.ua.ie) {
return;
}
var makeSelection = function(rangeData) {
var range = document.createRange();
if (range) {
range.setStart(rangeData.anchorNode, rangeData.anchorOffset);
range.setEnd(rangeData.focusNode, rangeData.focusOffset);
var selection = window.getSelection();
if (selection) {
if (selection.removeAllRanges) {
selection.removeAllRanges();
}
else if (selection.empty) {
selection.empty();
}
selection.addRange(range);
}
}
};
var onFocus = function(type, args, rangeData) {
this.unsubscribe('focus', onFocus);
setTimeout(function() {
try {
makeSelection(rangeData);
} catch (ex) {
}
}, 0);
};
var onBeforeShow = function() {
var selection = window.getSelection(),
rangeData;
if (selection && !selection.isCollapsed) {
rangeData = {
anchorNode: selection.anchorNode,
anchorOffset: selection.anchorOffset,
focusNode: selection.focusNode,
focusOffset: selection.focusOffset
};
this.subscribe('focus', onFocus, rangeData);
}
};
contextMenu.subscribe('beforeShow', onBeforeShow);
};
MenuManager.isContextEvent = function (evt) {
var target = evt.currentTarget || YUE.getTarget(evt);
if (target.id == 'btnContext') {
return true;
}
return (evt.type == 'contextmenu') ||
(evt.type == 'mousedown' && evt.button == 2) ||
(evt.type == 'keydown' && evt.ctrlKey && evt.keyCode == 77);
};
CM.Menu = MenuManager;
CM.Menu.Collection = MenuCollection;
})(window.ContentManager);

/* SOURCE FILE: content_dialog.js (61439d07) 10/26/2014 1:27:05 PM */

(function(CM) {
var currentFrame = null;
var Dialog = {
urlFrame: null,
onBeforeShow: new Util.Event.Custom(),
onShow: new Util.Event.Custom(),
onBeforeHide: new Util.Event.Custom(),
onHide: new Util.Event.Custom(),
onLoad: new Util.Event.Custom()
};
function update() {
if (currentFrame == null ||
currentFrame.loadState != 2) {
return;
}
Util.Dom.copyCSSFrame(currentFrame);
var frameWin = currentFrame.getWindow();
if (frameWin) {
setTimeout(function () { CM.focus(frameWin); }, 0);
}
}
function load(id, bankKey, itemKey) {
var frame = YUD.get(id);
if (frame != null) {
return frame;
}
if (Dialog.urlFrame == null) {
throw new Error('There is no url defined for content dialog frame.');
}
var accProps = Accommodations.Manager.getDefaultProps();
var lang = accProps ? accProps.getLanguage() : 'ENU';
var url = Dialog.urlFrame;
url += '?language=' + lang;
url += '&bankKey=' + bankKey;
url += '&itemKey=' + itemKey;
var dialogsEl = YUD.get('dialogContentFrames');
if (dialogsEl == null) {
dialogsEl = document.createElement('div');
dialogsEl.id = 'dialogContentFrames';
document.body.appendChild(dialogsEl);
}
frame = Util.Frame.create(id, dialogsEl);
frame.load(url);
frame.onLoaded.subscribe(function() {
var frameWin = frame.getWindow();
var frameDoc = frame.getDocument();
if (typeof KeyManager == 'object') {
KeyManager.attachListener(YAHOO.env.ua.gecko ? frameWin : frameDoc);
}
update();
Dialog.onLoad.fire(frame);
});
return frame;
}
Dialog.show = function(id, bankKey, itemKey) {
if (TDS.Audio.isActive()) {
if (window.TestShell) {
TestShell.UI.showWarning(ErrorCodes.get('NavigateAudioPlaying'));
}
return;
}
if (TTS.getInstance().isPlaying()) {
TTS.getInstance().stop();
}
CM.Menu.hide();
var frame = load(id, bankKey, itemKey);
Dialog.onBeforeShow.fire(frame);
frame.show();
YUD.addClass('dialogContent', 'enable');
YUE.addListener('dialogContentClose', 'click', Dialog.hide);
currentFrame = frame;
update();
Dialog.onShow.fire(frame);
};
Dialog.hide = function() {
if (currentFrame == null) return;
Dialog.onBeforeHide.fire(currentFrame);
currentFrame.hide();
YUD.removeClass('dialogContent', 'enable');
YUE.purgeElement('dialogContentClose');
Dialog.onHide.fire(currentFrame);
currentFrame = null;
Util.Dom.focusWindow(2);
};
Dialog.isShowing = function() {
return YUD.hasClass('dialogContent', 'enable');
};
Dialog.containsElement = function(el) {
if (!currentFrame || !el || !el.ownerDocument) {
return false;
}
var frameDoc = currentFrame.getDocument();
return (frameDoc == el.ownerDocument);
};
Dialog.onLoad.subscribe(function(frame)
{
var frameWin = frame.getWindow();
var frameDoc = frame.getDocument();
if (frame.id.indexOf('gtr', 0) != -1)
{
var container = frameDoc.getElementById('pageLayout');
YUE.delegate(container, 'click', function(ev, li, container) {
YUD.toggleClass(li, 'checked');
}, 'li');
}
});
CM.Dialog = Dialog;
window.DialogContent = Dialog;
})(ContentManager);
function tdsItemResource(name, bankKey, itemKey)
{
TDS.ToolManager.hideAll();
if (ContentManager.Dialog.isShowing()) {
ContentManager.Dialog.hide();
} else {
var id = name + '_' + bankKey + '_' + itemKey;
ContentManager.Dialog.show(id, bankKey, itemKey);
}
}

/* SOURCE FILE: content_singleton.js (876bdd52) 10/26/2014 1:27:05 PM */

(function (CM) {
var pages = CM.createPages('contents');
CM.createPage = function (content) {
return pages.create(content);
}
CM.getPage = function (id) {
return pages.get(id);
}
CM.getPages = function () {
return pages.list();
}
CM.getCurrentPage = function() {
return pages.getCurrent();
}
CM.getCurrentEntity = function() {
var page = CM.getCurrentPage();
return page ? page.getActiveEntity() : null;
}
CM.removePage = function(page) {
return pages.remove(page);
}
CM.enableCaretMode = function (enable) {
var enabled = Mozilla.enableCaretMode(enable);
if (enabled) {
var page = pages.getCurrent();
if (page) {
var entity = page.getActiveEntity();
if (entity) {
entity.resetCaretPosition();
}
}
}
};
CM.resetActiveComponent = function () {
var page = pages.getCurrent();
if (page) {
var entity = page.getActiveEntity();
if (entity instanceof ContentItem) {
entity.resetComponent();
}
}
};
CM.requestNextPage = function (verify) {
var page = CM.getCurrentPage();
if (page) {
return CM.fire('requestNextPage', page, verify);
} else {
return true;
}
};
CM.requestPreviousPage = function (verify) {
var page = CM.getCurrentPage();
if (page) {
return CM.fire('requestPreviousPage', page, verify);
} else {
return true;
}
};
CM.setItemCompleted = function (item) {
if (!item) return;
CM.fireEntityEvent('completed', item);
var page = item.getPage();
var items = page.getItems();
if (items.length == 1) {
CM.firePageEvent('completed', page);
}
};
})(ContentManager);
(function (CP) {
CP.prototype.addResourceLoader = function (resource) {
this._renderer.addResourceLoader(resource);
}
})(ContentPage);

/* SOURCE FILE: content_modes.js (44f489ef) 10/26/2014 1:27:05 PM */

ContentManager.Modes = (function(CM) {
function Mode(entity) {
this.entity = entity;
}
Mode.prototype.select = function() {};
Mode.prototype.enable = function() {};
Mode.prototype.dispose = function() {};
var Modes = {};
var lookup = new Util.Structs.Map();
var current = null,
mouseListener;
var keyListener = new YAHOO.util.KeyListener(document, {
keys: 27
}, {
fn: disableMode
});
Util.Event.Emitter(Modes);
function registerMode(name, cls) {
if (typeof cls.superclass != 'object' ||
typeof cls.superclass.constructor != 'function') {
YAHOO.lang.extend(cls, Mode);
}
lookup.set(name, cls);
}
function createInstance(cls, entity) {
var instance = new cls(entity);
cls.superclass.constructor.call(instance, entity);
return instance;
}
function isModeEnabled() {
return current != null;
}
function onSelect(mode, el, evt) {
YUE.stopEvent(evt);
mode.select(el, evt);
}
function addListeners(mode, elements) {
return elements.map(function (element) {
return Util.Event.addTouchMouse('start', element, onSelect.bind(null, mode, element));
});
}
function enableMode(name, entity) {
disableMode();
entity = entity || CM.getCurrentEntity();
var cls = lookup.get(name);
if (!entity || !cls) {
return null;
}
var mode = createInstance(cls, entity);
var elements = mode.enable();
if (!elements || !elements.length) {
return null;
}
console.log('mode enabled: ' + name);
CM.setReadOnly(true);
var listeners = addListeners(mode, elements);
current = {
name: name,
entity: entity,
mode: mode,
listeners: listeners
};
mouseListener = Util.Event.addTouchMouse('start', document.body, function (evt) {
YUE.stopEvent(evt);
disableMode();
});
keyListener.enable();
$(document.body).addClass('modeEnabled');
$(entity.getElement()).addClass('mode-' + name);
Modes.fire('enabled', name, mode);
return mode;
}
function disableMode() {
if (!current) return false;
console.log('mode disabled: ' + current.name);
$(document.body).removeClass('modeEnabled');
$(current.entity.getElement()).removeClass('mode-' + current.name);
current.listeners.forEach(function (listener) {
listener.destroy();
});
if (mouseListener) {
mouseListener.destroy();
mouseListener = null;
}
keyListener.disable();
current.mode.dispose();
current = null;
setTimeout(function() {
CM.setReadOnly(false);
}, 250);
return true;
}
$.extend(Modes, {
register: registerMode,
isEnabled: isModeEnabled,
enable: enableMode,
disable: disableMode
});
CM.onEntityEvent('hide', function() {
disableMode();
});
return Modes;
})(window.ContentManager);

/* SOURCE FILE: module_asl.js (7a2701b3) 9/9/2014 2:08:51 PM */

ContentManager.onItemEvent('menushow', function (page, item, menu, evt) {
if (!item)
return;
var accProps = TDS.getAccommodationProperties();
if (!accProps.hasASL())
return;
var menuType = 'entity';
var optionGroup = item.MC;
var subType = 'STEM';
if (optionGroup) {
var focusedOption = optionGroup.getFocusedOption();
if (focusedOption) {
menuType = 'component';
subType = 'Option ' + focusedOption.key;
}
}
AslModule.addEntityToMenu(item, subType, menu, menuType);
});
ContentManager.onPassageEvent('menushow', function (page, item, menu, evt) {
var accProps = TDS.getAccommodationProperties();
if (!accProps.hasASL())
return;
var menuType = 'entity';
var subType = null;
AslModule.addEntityToMenu(item, subType, menu, menuType);
});
AslModule = {};
AslModule.addEntityToMenu = function (entity, subtype, menu, menuType) {
var addMenu = function(messageKey, menuClass, menuFunc) {
var menuItem = {
text: Messages.get(messageKey),
classname: menuClass,
onclick: { fn: menuFunc }
};
menu.addMenuItem(menuType, menuItem);
};
if (entity.hasAslAttachments(subtype)) {
addMenu('TDSContentEventJS.Label.ASLItem', 'ASL', function() {
var att = entity.getAslAttachments()[0];
var link = att['url'];
AslModule.showImageDialog(link,entity.getPage().getZoomFactor());
});
}
};
AslModule.showImageDialog = function(url,zoomFactor) {
var anchor = document.createElement('a');
anchor.href = url;
VideoManager.openDialog(null, anchor, zoomFactor);
};
ContentEntity.prototype.getAslAttachments = function (st) {
var rv = [];
Util.Array.each(this.attachments, function (att) {
if ((att['type']) && (att['type'] == 'ASL')) {
if ((st == null) || (st.length == 0) ||
(att['subType'] == null) || (st == att['subType']))
rv.push(att);
}
});
return rv;
};
ContentEntity.prototype.hasAslAttachments = function (st) {
return this.getAslAttachments(st).length != 0;
};

/* SOURCE FILE: illustration.js (8e0c98d3) 9/9/2014 2:08:51 PM */

(function (CM) {
function match(page, content) {
var passage = page.getPassage();
var pageEl = page.getElement();
var passageEl = Util.Dom.getElementByClassName('thePassage', 'div', pageEl);
return (!passage && passageEl);
}
function Plugin_FakePass(page, config) {
}
CM.registerPagePlugin('fakepassage', Plugin_FakePass, match);
Plugin_FakePass.prototype.load = function () {
var page = this.page;
var items = page.getItems();
var firstItem = items[0];
var passage = ContentManager.createPassage(page, {
bankKey: firstItem.bankKey,
itemKey: 0
});
page.setPassage(passage);
}
})(ContentManager);

/* SOURCE FILE: tools.js (38562a0d) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity, content) {
if (entity instanceof ContentPassage) {
var passageEl = entity.getElement();
if (passageEl) {
if (entity.getToolsElement()) {
return false;
}
var paddingEl = Util.Dom.getElementByClassName('padding', 'div', passageEl);
if (paddingEl) {
return paddingEl;
}
}
}
return false;
}
function Plugin_PTools(page, entity, el) {
this.el = el;
}
CM.registerEntityPlugin('passage.tools', Plugin_PTools, match);
Plugin_PTools.prototype.load = function () {
var passage = this.entity;
var passageEl = passage.getElement();
var controlsEl = document.createElement('div');
controlsEl.className = 'passageTools';
$(passageEl).prepend(controlsEl);
}
})(window.ContentManager);

/* SOURCE FILE: menu.js (d9a2ac79) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity, content) {
if (entity instanceof ContentPassage) {
var accProps = page.getAccProps();
return accProps.showItemToolsMenu();
}
return false;
}
function Plugin_Menu(page, entity, el) {
this.el = el;
}
CM.registerEntityPlugin('passage.menu', Plugin_Menu, match);
Plugin_Menu.prototype.load = function () {
var entity = this.entity;
var messageKey = 'TDSContentEventsJS.Label.ContextMenu';
entity.addToolElement({
classname: 'passageMenu',
text: Messages.getAlt(messageKey, 'Menu'),
stopEvent: true,
hasPopup: true,
delay: true,
fn: function (menuEl, evt) {
CM.Menu.show({
entity: entity,
evt: evt,
target: menuEl,
location: 'bottom'
});
}
});
}
})(window.ContentManager);

/* SOURCE FILE: expand.js (04beae57) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity) {
if (entity instanceof ContentPassage && page.getPassage()) {
var accProps = page.getAccommodationProperties();
if (accProps && accProps.showExpandablePassages()) return true;
}
return false;
}
var CSS_COLLAPSED = 'passage-collapsed';
var CSS_EXPANDED = 'passage-expanded';
function Plugin_Expand(page, config) {
}
CM.registerEntityPlugin('passage.expandable', Plugin_Expand, match);
Plugin_Expand.prototype.load = function () {
var page = this.page;
var pageEl = page.getElement();
var passage = page.getPassage();
var passageEl = passage.getElement();
if (passageEl == null) return;
YUD.addClass(pageEl, CSS_COLLAPSED);
var expandLink = document.createElement('a');
YUD.setAttribute(expandLink, 'href', '#');
YUD.addClass(expandLink, 'expand-collapse-passage');
YUE.on(expandLink, 'click', function (clickEv) {
YUE.stopEvent(clickEv);
if (YUD.hasClass(pageEl, CSS_EXPANDED)) {
YUD.removeClass(pageEl, CSS_EXPANDED);
YUD.addClass(pageEl, CSS_COLLAPSED);
}
else if (YUD.hasClass(pageEl, CSS_COLLAPSED)) {
YUD.removeClass(pageEl, CSS_COLLAPSED);
YUD.addClass(pageEl, CSS_EXPANDED);
}
});
var toolsEl = passage.getToolsElement();
if (toolsEl) {
toolsEl.appendChild(expandLink);
}
}
})(ContentManager);

/* SOURCE FILE: print.js (619e493c) 10/26/2014 1:27:05 PM */

(function(CM) {
function match(page, entity) {
if (typeof (window.tdsPassagePrint) != 'function') {
return false;
}
if (YUD.hasClass(document.body, 'unproctored')) {
return false;
}
if (entity instanceof ContentPassage) {
var accProps = page.getAccProps();
return accProps.hasPrintStimulus();
}
return false;
}
function Plugin() { }
CM.registerEntityPlugin('passage.print', Plugin, match);
Plugin.prototype.showMenu = function(menu, evt) {
var menuText = Messages.get('TDSContentEventsJS.Label.PrintPassage');
var menuItem = {
text: menuText,
classname: 'printPassage',
onclick: { fn: window.tdsPassagePrint }
};
menu.addMenuItem('entity', menuItem);
}
})(window.ContentManager);

/* SOURCE FILE: tools.js (2f2402a7) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity, content) {
return (entity instanceof ContentItem);
}
function Plugin_ITools(page, entity, el) {
this.el = el;
}
CM.registerEntityPlugin('item.tools', Plugin_ITools, match);
Plugin_ITools.prototype.load = function () {
var item = this.entity;
var itemEl = item.getElement();
var commentBoxEl = document.getElementById('Item_CommentBox_' + item.position);
$(commentBoxEl).remove();
var toolsEl = $('.itemTools', itemEl).get(0);
if (toolsEl) return;
var markCommentEl = $('.markComment', itemEl).get(0);
if (!markCommentEl) return;
toolsEl = document.createElement('div');
toolsEl.className = 'itemTools markComment';
$(markCommentEl).after(toolsEl);
$(markCommentEl).remove();
}
})(window.ContentManager);

/* SOURCE FILE: menu.js (5359c06e) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity, content) {
if (entity instanceof ContentItem) {
var accProps = page.getAccProps();
return accProps.showItemToolsMenu();
}
return false;
}
function Plugin_Menu(page, entity, el) {
this.el = el;
}
CM.registerEntityPlugin('item.menu', Plugin_Menu, match);
Plugin_Menu.prototype.load = function () {
var entity = this.entity;
var messageKey = 'TDSContentEventsJS.Label.ContextMenu';
entity.addToolElement({
classname: 'itemMenu',
text: Messages.getAlt(messageKey, 'Menu'),
stopEvent: true,
hasPopup: true,
delay: true,
fn: function (menuEl, evt) {
CM.Menu.show({
entity: entity,
evt: evt,
target: menuEl,
location: 'bottom'
});
}
});
}
})(window.ContentManager);

/* SOURCE FILE: tutorial.js (30468c04) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity, content) {
if (entity instanceof ContentItem && content.tutorial) {
var accProps = page.getAccProps();
if (accProps.hasTutorial()) {
return content.tutorial;
}
}
return false;
}
function Plugin_Tut(page, entity, tutorial) {
}
CM.registerEntityPlugin('item.tutorial', Plugin_Tut, match);
Plugin_Tut.prototype.open = function () {
var item = this.entity;
console.log('Item Tool: Tutorial', this.config, item);
if (typeof (window.tdsItemResource) == 'function') {
window.tdsItemResource('help', item.tutorial.bankKey, item.tutorial.itemKey);
}
}
Plugin_Tut.prototype.load = function () {
var accProps = this.page.getAccProps();
if (accProps.showItemToolsMenu()) {
return;
}
var messageKey = 'TDSContentEventsJS.Label.HelpItem';
this.entity.addToolElement({
classname: 'contexthelp',
text: Messages.get(messageKey),
fn: this.open.bind(this)
});
}
Plugin_Tut.prototype.showMenu = function (menu, evt) {
var messageKey = 'TDSContentEventsJS.Label.HelpItem';
menu.addMenuItem('entity', {
text: Messages.get(messageKey),
classname: 'helpItem',
hasPopup: true,
onclick: { fn: this.open.bind(this) }
});
}
})(window.ContentManager);

/* SOURCE FILE: print.js (53442780) 10/26/2014 1:27:05 PM */

(function(CM) {
function match(page, entity, content) {
if (entity instanceof ContentItem && content.printable) {
var accProps = page.getAccProps();
return accProps.hasPrintItem();
}
return false;
}
function Plugin_Print(page, entity) {
this.element = null;
}
CM.registerEntityPlugin('item.print', Plugin_Print, match);
Plugin_Print.prototype.send = function() {
var item = this.entity;
console.log('Item Tool: Print', item);
if (typeof (window.tdsItemPrint) == 'function') {
window.tdsItemPrint(item.position);
}
};
Plugin_Print.prototype.load = function() {
var accProps = this.page.getAccProps();
if (accProps.showItemToolsMenu()) {
return;
}
var messageKey = 'TDSContentEventsJS.Label.PrintItem';
this.element = this.entity.addToolElement({
classname: 'printItem',
text: Messages.get(messageKey),
fn: this.send.bind(this)
});
};
Plugin_Print.prototype.showMenu = function(menu, evt) {
var messageKey = 'TDSContentEventsJS.Label.PrintItem';
menu.addMenuItem('entity', {
text: Messages.get(messageKey),
classname: 'printItem',
onclick: { fn: this.send.bind(this) }
});
};
Plugin_Print.prototype.dispose = function() {
if (this.element) {
$(this.element).remove();
this.element = null;
}
};
})(window.ContentManager);

/* SOURCE FILE: gtr.js (f27d6265) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity, content) {
if (entity instanceof ContentItem) {
var gtr = content.resources['guideToRevision'];
if (gtr) {
var accProps = page.getAccProps();
if (accProps.hasGuideForRevision()) {
return gtr;
}
}
}
return false;
}
function Plugin_GTR(page, entity, config) {
}
CM.registerEntityPlugin('item.gtr', Plugin_GTR, match);
Plugin_GTR.prototype.open = function () {
var item = this.entity;
console.log('Item Tool: GTR', this.config, item);
if (typeof (window.tdsItemResource) == 'function') {
window.tdsItemResource('gtr_' + item.position, item.gtr.bankKey, item.gtr.itemKey);
}
}
Plugin_GTR.prototype.load = function () {
var accProps = this.page.getAccProps();
if (accProps.showItemToolsMenu()) {
return;
}
var messageKey = 'TDSContentEventsJS.Label.GTRItem';
this.entity.addToolElement({
classname: 'guideToRevision',
text: Messages.get(messageKey),
hasPopup: true,
fn: this.open.bind(this)
});
}
Plugin_GTR.prototype.showMenu = function (menu, evt) {
var messageKey = 'TDSContentEventsJS.Label.GTRItem';
menu.addMenuItem('entity', {
text: Messages.get(messageKey),
classname: 'gtrItem',
onclick: { fn: this.open.bind(this) }
});
}
})(window.ContentManager);

/* SOURCE FILE: comment.js (db24f7c1) 10/26/2014 1:27:05 PM */

(function(CM) {
function match(page, entity, content) {
if (entity instanceof ContentItem) {
var accProps = page.getAccProps();
return accProps.hasStudentComments();
}
return false;
}
function Plugin_IC(page, entity) {
}
CM.registerEntityPlugin('item.comment', Plugin_IC, match);
Plugin_IC.prototype.toggle = function () {
var item = this.entity;
console.log('Item Tool: Comment', item);
CM.fireEntityEvent('comment', item);
}
Plugin_IC.prototype.load = function () {
var accProps = this.page.getAccProps();
if (accProps.showItemToolsMenu()) {
return;
}
var messageLabel = CM.getCommentLabel();
this.entity.addToolElement({
classname: 'commentItem',
text: Messages.get(messageLabel),
fn: this.toggle.bind(this)
});
}
Plugin_IC.prototype.showMenu = function (menu, evt) {
var messageLabel = CM.getCommentLabel();
menu.addMenuItem('entity', {
text: Messages.get(messageLabel),
classname: 'comment',
onclick: { fn: this.toggle.bind(this) }
});
}
})(window.ContentManager);

/* SOURCE FILE: mark.js (85396cfe) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity, content) {
if (entity instanceof ContentItem) {
var accProps = page.getAccProps();
if (accProps.hasMarkForReview()) {
return {
marked: content.marked
}
}
}
return false;
}
function Plugin_Mark(page, entity, config) {
this.marked = config.marked;
}
CM.registerEntityPlugin('item.mark', Plugin_Mark, match);
Plugin_Mark.prototype.update = function () {
var item = this.entity;
var itemEl = item.getElement();
if (this.marked) {
YUD.addClass(itemEl, 'itemMarked');
} else {
YUD.removeClass(itemEl, 'itemMarked');
}
var markLinkEl = item.getToolElement('markReview');
if (markLinkEl) {
if (this.marked) {
YUD.addClass(markLinkEl, 'markReviewMarked');
markLinkEl.setAttribute('aria-checked', 'true');
} else {
YUD.removeClass(markLinkEl, 'markReviewMarked');
markLinkEl.setAttribute('aria-checked', 'false');
}
}
}
Plugin_Mark.prototype.toggle = function () {
this.marked = !this.marked;
this.update();
var item = this.entity;
console.log('Item Tool: Mark', this.marked, item);
if (typeof (window.tdsUpdateItemMark) == 'function') {
window.tdsUpdateItemMark(item.position, this.marked);
}
}
Plugin_Mark.prototype.load = function () {
var accProps = this.page.getAccProps();
if (accProps.showItemToolsMenu()) {
return;
}
var messageKey = 'TDSContentEventsJS.Label.MarkForReview';
this.entity.addToolElement({
classname: 'markReview',
text: Messages.get(messageKey),
fn: this.toggle.bind(this)
});
this.update();
}
Plugin_Mark.prototype.showMenu = function (menu, evt) {
var messageKey = this.marked ? 'TDSContentEventsJS.Label.UnmarkForReview' : 'TDSContentEventsJS.Label.MarkForReview';
menu.addMenuItem('entity', {
text: Messages.get(messageKey),
classname: 'markReview',
onclick: { fn: this.toggle.bind(this) }
});
}
})(window.ContentManager);

/* SOURCE FILE: reset.js (c2aba638) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, entity, content) {
if (entity instanceof ContentItem) {
var accProps = page.getAccProps();
return accProps.hasResponseReset();
}
return false;
}
function Plugin_GTR(page, entity) {
}
CM.registerEntityPlugin('item.reset', Plugin_GTR, match);
Plugin_GTR.prototype.send = function () {
var item = this.entity;
console.log('Item Tool: Reset', item);
if (typeof (window.tdsRemoveResponse) == 'function') {
window.tdsRemoveResponse(item.position);
}
}
Plugin_GTR.prototype.load = function () {
var accProps = this.page.getAccProps();
if (accProps.showItemToolsMenu()) {
return;
}
var messageKey = 'TDSContentEventsJS.Label.ResetItem';
this.entity.addToolElement({
classname: 'removeResponse',
text: Messages.get(messageKey),
fn: this.send.bind(this)
});
}
Plugin_GTR.prototype.showMenu = function (menu, evt) {
var messageKey = 'TDSContentEventsJS.Label.ResetItem';
menu.addMenuItem('entity', {
text: Messages.get(messageKey),
classname: 'resetItem',
onclick: { fn: this.send.bind(this) }
});
}
})(window.ContentManager);

/* SOURCE FILE: pagination.js (ea8e7f9a) 10/26/2014 1:27:05 PM */

(function (CM) {
var CSS_WIDGET = 'multi-page';
var CSS_ITEMACTIVE = 'page-active';
var CSS_ITEMANSWERED = 'page-answered';
var paginatedPages = [];
function getTabEl(item) {
return document.getElementById('itemTab-' + item.position);
}
function createTabEl(item) {
var itemTabEl = document.createElement('li');
itemTabEl.setAttribute('id', 'itemTab-' + item.position);
var itemLinkEl = document.createElement('a');
itemLinkEl.setAttribute('href', '#');
itemLinkEl.setAttribute('tabindex', '0');
var tabData = { item: item };
$(itemLinkEl).on('click', tabData, onTabClick);
$(itemLinkEl).text(item.position);
itemTabEl.appendChild(itemLinkEl);
return itemTabEl;
}
function createWidgetEl(items) {
var containerEl = document.createElement('ul');
containerEl.className = CSS_WIDGET;
items.forEach(function(item) {
var itemTabEl = createTabEl(item);
containerEl.appendChild(itemTabEl);
});
return containerEl;
}
function onTabClick(evt) {
var item = evt.data.item;
item.setActive();
}
function updateItemAnswered(item) {
var tabEl = getTabEl(item);
var response = item.getResponse();
if (response && response.isValid) {
YUD.addClass(tabEl, CSS_ITEMANSWERED);
} else {
YUD.removeClass(tabEl, CSS_ITEMANSWERED);
}
}
function allowPagination(page) {
if (ContentManager.isAccessibilityEnabled()) {
return false;
}
var compoundEl = page.getCompoundElement();
if (compoundEl) {
return false;
}
var passage = page.getPassage();
var items = page.getItems();
if (passage == null || items.length < 2) {
return false;
}
var accProps = page.getAccommodationProperties();
if (accProps == null || !accProps.isPaginatedItemGroupsEnabled()) {
return false;
}
return true;
}
function match(page) {
return allowPagination(page);
}
function Plugin_Paginate(page) {
this.delay = true;
this.lastTab = null;
}
CM.registerPagePlugin('pagination', Plugin_Paginate, match);
Plugin_Paginate.prototype.getTabableItems = function () {
var page = this.page;
var items = page.getItems();
if (page.layout == '28' ||
page.layout == '29') {
items = items.filter(function (item) {
return item.format.toUpperCase() != 'SIM';
});
}
return items;
}
Plugin_Paginate.prototype.showItem = function (item) {
item.show();
var tabEl = getTabEl(item);
YUD.addClass(tabEl, CSS_ITEMACTIVE);
var scrollEl = this.page.getScrollableElement();
if (scrollEl) {
scrollEl.scrollTop = 0;
scrollEl.scrollLeft = 0;
}
}
Plugin_Paginate.prototype.hideItem = function (item) {
item.hide();
var tabEl = getTabEl(item);
YUD.removeClass(tabEl, CSS_ITEMACTIVE);
updateItemAnswered(item);
}
Plugin_Paginate.prototype.onFocusItem = function(focusItem) {
var tabableItems = this.getTabableItems();
if (tabableItems.indexOf(focusItem) == -1) return;
tabableItems.forEach(function (item) {
if (item == focusItem) {
this.showItem(item);
} else {
this.hideItem(item);
}
}.bind(this));
};
Plugin_Paginate.prototype.load = function () {
var page = this.page;
var tabableItems = this.getTabableItems();
var widgetEl = createWidgetEl(tabableItems);
$(page.getPassage().getElement()).parent().prepend(widgetEl);
tabableItems.forEach(function (item) {
item.on('focus', this.onFocusItem.bind(this, item));
}.bind(this));
}
Plugin_Paginate.prototype.getEntitiesToShow = function() {
var page = this.page;
var entities = page.getEntities();
var tabableItems = this.getTabableItems();
return entities.filter(function (entity) {
if (entity instanceof ContentPassage && entity.isEmpty()) {
return false;
}
return (tabableItems.indexOf(entity) == -1);
});
};
Plugin_Paginate.prototype.getEntityForFocus = function () {
var page = this.page;
var tabableItems = this.getTabableItems();
var lastActive = page.getLastActive();
if (tabableItems.indexOf(lastActive) != -1) {
return lastActive;
} else {
return tabableItems[0];
}
};
function requestPage(direction, page, verify) {
var pagination = page.plugins.get('pagination');
if (!pagination) return true;
var tabableItems = pagination.getTabableItems();
var iterator = Util.Iterator(tabableItems, { limits: true, pit: true });
var currentItem = Util.Array.find(tabableItems, function(item) {
return item.isShowing();
});
iterator.jumpTo(currentItem);
var nextItem = (direction == 'next') ? iterator.next() : iterator.prev();
if (nextItem) {
if (verify) {
return false;
} else {
if (nextItem.setActive()) {
return false;
}
}
}
return true;
}
CM.on('requestNextPage', requestPage.bind(null, 'next'));
CM.on('requestPreviousPage', requestPage.bind(null, 'back'));
})(ContentManager);

/* SOURCE FILE: components.js (f28a3880) 9/9/2014 2:08:51 PM */

(function (CM) {
function match(page, entity, content) {
return true;
}
function Plugin_Comp(page, entity, config) {
}
CM.registerEntityPlugin('components', Plugin_Comp, match);
Plugin_Comp.prototype.findPassageComponents = function(passage) {
var passageEl = passage.getElement();
if (passageEl != null) {
passage.addComponent(passageEl);
}
}
Plugin_Comp.prototype.findItemComponents = function (item) {
var itemEl = item.getElement();
item.addComponent(itemEl);
}
Plugin_Comp.prototype.load = function () {
var entity = this.entity;
if (entity instanceof ContentItem) {
this.findItemComponents(entity);
} else if (entity instanceof ContentPassage) {
this.findPassageComponents(entity);
}
entity.on('focusComponent', function(component) {
if (ContentManager.isElement(component)) {
YUD.addClass(component, 'contextAreaFocus');
}
});
entity.on('blurComponent', function (component) {
if (ContentManager.isElement(component)) {
YUD.removeClass(component, 'contextAreaFocus');
}
ContentManager.enableCaretMode(false);
});
}
Plugin_Comp.prototype.focus = function (previousComponent, domEvent) {
if (!domEvent || domEvent.keyCode) {
this.entity.resetComponent();
}
}
Plugin_Comp.prototype.blur = function () {
this.entity.clearComponent();
}
})(ContentManager);

/* SOURCE FILE: accommodations.js (5bf35dff) 9/9/2014 2:08:51 PM */

(function (CM) {
function match(page, content) {
return page.getAccommodations() != null;
}
function Plugin_Accs(page, config) {
}
CM.registerPagePlugin('accommodations', Plugin_Accs, match);
Plugin_Accs.prototype.beforeShow = function () {
var page = this.page;
var pageAccs = page.getAccommodations();
Accommodations.Manager.updateCSS(page.getBody(), pageAccs.getId());
}
})(ContentManager);

/* SOURCE FILE: highlighter.js (858c4866) 9/9/2014 2:08:51 PM */

(function (rangy, CM) {
if (!rangy) return;
if (rangy.config) {
rangy.config.alertOnFail = false;
rangy.config.alertOnWarn = false;
}
var globalClassApplier;
function getSelfOrAncestorWithClass(node, cssClass) {
while (node) {
if (YUD.hasClass(node, cssClass)) {
return node;
}
node = node.parentNode;
}
return null;
};
function checkMathML(node) {
var mathTypes = /mfrac|msup|mfenced|msqrt|msubsup|msub|mover|munder|msubsup|mlongdiv|munderover|mroot/;
if (mathTypes.test(node)) {
return true;
}
return false;
};
function createCSSClassApplier() {
var cssClassApplier = rangy.createCssClassApplier('highlight', {
ignoreWhiteSpace: true,
useExistingElements: false,
removeEmptyElements: false,
tagNames: ['span']
});
cssClassApplier.isModifiable = function(textNode) {
if (getSelfOrAncestorWithClass(textNode.parentNode, 'no-highlight') != null ||
checkMathML(textNode.parentNode.nodeName)) {
return false;
}
return true;
};
return cssClassApplier;
}
function getCSSClassApplier() {
if (!globalClassApplier) {
globalClassApplier = createCSSClassApplier();
}
return globalClassApplier;
}
function setHighlight(selection) {
if (selection.rangeCount > 0) {
var cssClassApplier = getCSSClassApplier();
cssClassApplier.applyToRanges(selection.getAllRanges());
selection.collapseToStart();
}
}
function clearHighlighting(el) {
var range = rangy.createRange();
range.selectNode(el);
var cssClassApplier = getCSSClassApplier();
cssClassApplier.undoToRange(range);
}
function hasSelection(selection) {
var text = selection.toString();
text = YAHOO.lang.trim(text);
return (text.length > 0);
}
function Plugin_High(page, entity, config) {
}
CM.registerEntityPlugin('highlighter', Plugin_High, function match(page, entity) {
var accProps = page.getAccommodationProperties();
return accProps && accProps.hasHighlighting();
});
Plugin_High.prototype.showMenu = function(menu, evt, selection) {
var page = this.page;
var entity = this.entity;
var hasSelectedText = hasSelection(selection);
if (hasSelectedText) {
var lblHighlightText = CM.getLabel('HIGHLIGHT_TEXT');
menu.addMenuItem('entity', lblHighlightText, function () {
setHighlight(selection);
CM.enableCaretMode(false);
});
}
var activeDoc = page.getActiveDoc();
var highlightedElement = entity.getElement();
if (highlightedElement && highlightedElement.ownerDocument != activeDoc) {
highlightedElement = activeDoc.body;
}
var highlightedNodes = YAHOO.util.Dom.getElementsByClassName(CM.CSS.HIGHLIGHT, null, highlightedElement);
var hasHighlightedText = (highlightedNodes.length > 0);
if (hasHighlightedText) {
var lblHighlightClr = CM.getLabel('HIGHLIGHT_CLEAR');
menu.addMenuItem('entity', lblHighlightClr, function () {
clearHighlighting(highlightedElement);
}, !hasHighlightedText);
}
};
})(window.rangy, window.ContentManager);

/* SOURCE FILE: attachments.js (9c37437b) 9/9/2014 2:08:51 PM */

(function(CM) {
function match(page) {
var pageEl = page.getElement();
var links = Util.Dom.getElementsByTagName('a', pageEl);
var attachments = links.filter(function (linkEl) {
return '.pdf .rtf'.indexOf(linkEl.href) != -1;
});
return (attachments.length > 0) ? attachments : null;
}
function Plugin(page) {}
CM.registerPagePlugin('attachments', Plugin, match);
Plugin.prototype.init = function(links) {
links.forEach(function(linkEl) {
linkEl.target = '_blank';
});
}
})(window.ContentManager);

/* SOURCE FILE: media.js (46f79151) 10/26/2014 1:27:05 PM */

(function(CM) {
var getMediaResources = function(content) {
if (content.media) {
return content.media;
}
var mediaResources = [];
if (content.passage && content.passage.media) {
mediaResources = Util.Array.concat(mediaResources, content.passage.media);
}
if (content.items) {
for (var i = 0; i < content.items.length; i++) {
var item = content.items[i];
if (item.media) {
mediaResources = Util.Array.concat(mediaResources, item.media);
}
}
}
return mediaResources;
};
var findMediaResource = function(content, url) {
var mediaResources = getMediaResources(content);
for (var i = 0; i < mediaResources.length; i++) {
var mediaResource = mediaResources[i];
if (url.indexOf(mediaResource.file) != -1) {
return mediaResource;
}
}
return null;
};
var cleanXml = function(xmlStr) {
xmlStr = xmlStr.replace('<?xml version="1.0" encoding="UTF-8"?>', '');
return xmlStr;
};
var cleanMathML = function(mathMLStr) {
mathMLStr = mathMLStr.replace('<!DOCTYPE math:math PUBLIC "-//OpenOffice.org//DTD Modified W3C MathML 1.01//EN" "math.dtd">', '');
mathMLStr = mathMLStr.replace(/math:/g, '');
mathMLStr = mathMLStr.replace(/:math/g, '');
return mathMLStr;
};
var isMathMLSymbol = function(text) {
if (text) {
var code = text.charCodeAt(0);
if (code >= 0x00A0 && code <= 0x00FF) {
return true;
}
else if (code >= 0x2190 && code <= 0x21FF) {
return true;
}
else if (code >= 0x2300 && code <= 0x23FF) {
return true;
}
else if (code >= 0x2022 && code <= 0x22FF) {
return true;
}
else if (code >= 0x25A0 && code <= 0x25FF) {
return true;
}
else if (code == 0x03C0) {
return true;
}
}
return false;
};
var processMathML = function (mathMLDoc) {
Util.Dom.querySelectorBatch('mi, mo', mathMLDoc, function(el) {
var text = Util.Dom.getTextContent(el);
if (isMathMLSymbol(text)) {
YUD.addClass(el, 'symbol');
YUD.addClass(el, 'symbol_' + text.charCodeAt(0));
if (el.getAttribute('lspace')) {
el.removeAttribute('lspace');
}
if (el.getAttribute('rspace')) {
el.removeAttribute('rspace');
}
}
});
};
var supportsMathML = function() {
if (Util.Browser.isSecure() && (YAHOO.env.ua.android || YAHOO.env.ua.ios)) {
return false;
}
if (Util.Browser.getFirefoxVersion() > 0) {
return (Util.Browser.getFirefoxVersion() >= 4.0);
}
if (YAHOO.env.ua.chrome > 0) {
return false;
}
if (YAHOO.env.ua.webkit >= 534) {
return true;
}
return false;
};
var processPageImageXml = function(pageXmlDoc, imgNode, mediaResource) {
var mediaData = mediaResource.data;
if (mediaData.indexOf('MathML') != -1) {
if (!supportsMathML()) return false;
mediaData = cleanMathML(mediaData);
}
mediaData = cleanXml(mediaData);
var mediaDoc = Util.Xml.parseFromString(mediaData);
if (mediaData.indexOf('MathML') != -1) {
processMathML(mediaDoc);
}
var mediaNode = pageXmlDoc.importNode(mediaDoc.documentElement, true);
var imgAlt = imgNode.getAttribute('alt');
if (imgAlt) {
mediaNode.setAttribute('alt', imgAlt);
}
YUD.insertBefore(mediaNode, imgNode);
Util.Dom.removeNode(imgNode);
return true;
};
var processPageImageBase64 = function(pageXmlDoc, imgNode, mediaResource) {
imgNode.src = 'data:' + mediaResource.type + ';base64,' + mediaResource.data;
return true;
};
var serializeToHtmlString = function(node) {
var div = document.createElement('div');
div.appendChild(node);
return div.innerHTML;
};
var processXml = function (xmlDoc, content) {
var imageNodes = xmlDoc.getElementsByTagName('img');
imageNodes = Util.Array.slice(imageNodes);
for (var i = 0; i < imageNodes.length; i++) {
var imgNode = imageNodes[i];
var imgUrl = imgNode.getAttribute('src');
var mediaResource = findMediaResource(content, imgUrl);
if (mediaResource == null ||
mediaResource.data == null) continue;
if (mediaResource.type == 'application/mathml+xml') {
processPageImageXml(xmlDoc, imgNode, mediaResource);
}
else if (mediaResource.type == 'image/png') {
processPageImageBase64(xmlDoc, imgNode, mediaResource);
}
}
};
var processPageMedia = function(page, content) {
if (YAHOO.env.ua.ie) return;
if (getMediaResources(content).length == 0) return;
var pageRenderer = page.getRenderer();
var pageHtml = pageRenderer.getHtml();
pageHtml = YAHOO.lang.trim(pageHtml);
var pageXmlDoc = null;
try {
pageXmlDoc = Util.Xml.parseFromString(pageHtml, 'application/xml');
} catch(ex) {
console.error(ex);
return;
}
processXml(pageXmlDoc, content);
pageHtml = serializeToHtmlString(pageXmlDoc.documentElement);
pageRenderer.setHtml(pageHtml);
};
var processQTI = function(qti, content) {
if (YAHOO.env.ua.ie) return;
if (getMediaResources(content).length == 0) return;
var qtiXmlDoc = null;
try {
qtiXmlDoc = Util.Xml.parseFromString(qti.xml, 'application/xml');
} catch (ex) {
console.error(ex);
return;
}
processXml(qtiXmlDoc, content);
qti.xml = Util.Xml.serializeToString(qtiXmlDoc.documentElement);
};
var processItemMedia = function(page, item, content) {
if (item.qti && item.qti.xml) {
processQTI(item.qti, content);
}
};
CM.onPageEvent('init', processPageMedia);
CM.onItemEvent('init', processItemMedia);
})(window.ContentManager);

/* SOURCE FILE: caretbrowser.js (237e7d27) 9/9/2014 2:08:51 PM */

(function (CM) {
function allowCaret(page, entity) {
var isPassage = (entity instanceof ContentPassage);
var isStem = (entity instanceof ContentItem) && (entity.getStemElement() == entity.getActiveComponent());
if (!isPassage && !isStem) {
return false;
}
var allowedAccommodation = false;
var accProps = page.getAccommodationProperties();
if (accProps.hasHighlighting()) {
allowedAccommodation = true;
} else if (isPassage && accProps.hasTTSStimulus()) {
allowedAccommodation = true;
} else if (isStem && accProps.hasTTSItem()) {
allowedAccommodation = true;
}
return allowedAccommodation;
}
function match(page) {
return Mozilla.execPrivileged();
}
function Plugin(page) { }
CM.registerEntityPlugin('caretbrowser', Plugin, match);
Plugin.prototype.showMenu = function(menu, evt) {
var page = this.page;
var entity = this.entity;
if (!evt.keyCode || !allowCaret(page, entity)) {
return;
}
var menuFunc, menuItem;
if (Mozilla.inCaretMode()) {
menuFunc = function () {
ContentManager.enableCaretMode(false);
};
menuItem = {
text: Messages.get('TDSContentEventsJS.Link.DisableTextSelection'),
classname: 'caretMode',
onclick: { fn: menuFunc }
};
} else {
menuFunc = function () {
var focusedComponent = entity.getActiveComponent();
if (focusedComponent && focusedComponent.focus) {
entity.clearComponent();
entity.setActiveComponent(focusedComponent);
ContentManager.enableCaretMode(true);
}
};
menuItem = {
text: Messages.get('TDSContentEventsJS.Link.EnableTextSelection'),
classname: 'caretMode',
onclick: { fn: menuFunc }
};
}
menu.addMenuItem('entity', menuItem);
}
})(window.ContentManager);

/* SOURCE FILE: strikethrough.js (899a4577) 10/26/2014 1:27:05 PM */

(function(CM, Modes) {
var CSS_STRIKETHROUGH = 'strikethrough';
var SELECTOR_STRIKEABLE = 'div.optionContainer';
function getStrikeables(entity) {
var entityEl = entity.getElement();
return $(SELECTOR_STRIKEABLE, entityEl).get();
}
function isStrikeable(el) {
return $(el).is(SELECTOR_STRIKEABLE);
}
function hasStrikethrough(el) {
return $(el).hasClass(CSS_STRIKETHROUGH);
}
function toggleStrikethrough(el) {
$(el).toggleClass(CSS_STRIKETHROUGH);
}
function Mode_Strike() {}
Modes.register('strikethrough', Mode_Strike);
Mode_Strike.prototype.select = function (el) {
toggleStrikethrough(el);
};
Mode_Strike.prototype.enable = function () {
return getStrikeables(this.entity);
};
function match(page, entity) {
if (entity instanceof ContentItem) {
var accProps = page.getAccommodationProperties();
if (accProps.hasStrikethrough()) {
return ['mc', 'ebsr', 'qti.choice'].some(function (widgetName) {
return entity.widgets.has(widgetName);
});
}
}
return false;
}
function Plugin_Strike(page, entity) {}
CM.registerEntityPlugin('strikethrough', Plugin_Strike, match, {
priority: 300
});
Plugin_Strike.prototype.showMenu = function (menu, evt) {
var component = this.entity.getActiveComponent();
var accProps = this.page.getAccProps();
var hasMenuButton = accProps.showItemToolsMenu();
if (isStrikeable(component) && CM.Menu.isContextEvent(evt)) {
var striked = hasStrikethrough(component);
var strikeText = striked ? Messages.get('TDSMC.MenuLabel.UndoStrikethrough') : Messages.get('TDSMC.MenuLabel.Strikethrough');
var menuLabel = {
text: strikeText,
classname: CSS_STRIKETHROUGH
};
menu.addMenuItem('component', menuLabel, function() {
toggleStrikethrough(component);
});
} else if (hasMenuButton) {
var menuLabel = {
text: Messages.get('TDSMC.MenuLabel.Strikethrough'),
classname: CSS_STRIKETHROUGH
};
menu.addMenuItem('component', menuLabel, function () {
CM.Modes.enable('strikethrough');
});
}
};
})(window.ContentManager, window.ContentManager.Modes);

/* SOURCE FILE: plugin.js (0553495b) 10/26/2014 1:27:05 PM */

(function (Audio, CM) {
var Player = Audio.Player;
var Recorder = Audio.Recorder;
var Widget = Audio.Widget;
function Player_Plugin(page, config) {}
function match(page, entity, content) {
var entityEl = entity.getElement();
if (entityEl) {
var audioElements = $('audio', entityEl)
.not('.slides_audio')
.add('a.sound_explicit, a.sound_repeat, a.sound_cue', entityEl)
.get();
if (audioElements.length > 0) {
return audioElements;
};
}
return false;
}
CM.registerEntityPlugin('audio.player', Player_Plugin, match, {
priority: 300,
defer: true
});
Player_Plugin.prototype.load = function () {
var page = this.page,
entity = this.entity,
audioElements = this.config;
audioElements.forEach(function (audioEl) {
var $audio = $(audioEl);
if ($audio.hasClass('sound_explicit')) {
$audio.addClass('sound_repeat');
}
var autoplay = audioEl.getAttribute('autoplay');
autoplay = (autoplay) ? (autoplay.toLowerCase() == 'true') : false;
var audio,
isMCOption = $audio.closest('.optionSound').length > 0,
accProps = page.getAccommodationProperties();
if (!isMCOption && accProps && accProps.isAudioRewindEnabled()) {
audio = Widget.createPlayerRewind(audioEl);
} else {
audio = Widget.createPlayer(audioEl);
}
audio.controls.forEach(function (el) {
entity.addComponent(el);
});
if (audio) {
entity.audioLinks.push(audio.id);
if (autoplay && !CM.isAccessibilityEnabled()) {
page.autoPlayQueue.append(audio.id);
}
} else {
$audio.addClass('disabled');
}
});
};
Player_Plugin.prototype.hide = function () {
if (Player.isPlaying()) {
Player.stopAll();
}
};
})(TDS.Audio, window.ContentManager);

/* SOURCE FILE: widget.js (b514bc62) 9/9/2014 2:08:50 PM */

(function(Audio, CM) {
var Player = Audio.Player;
var Recorder = Audio.Recorder;
var Widget = Audio.Widget;
function Recorder_Widget(page, item, config) {
}
CM.registerWidget('audio.recorder', Recorder_Widget, function (page, item) {
var id = 'elicited_' + item.position;
var el = document.getElementById(id);
if (el) {
return new CM.WidgetConfig(id, el, {
});
}
return false;
});
Recorder_Widget.prototype.init = function () {
};
Recorder_Widget.prototype.load = function () {
var item = this.entity,
recorderID = this.id;
if (!Recorder.isInitialized()) {
Recorder.initialize();
}
var duration = (item.format.toUpperCase() == 'SER') ? 120 : 30;
var recorder = Widget.createRecorder(recorderID, duration);
item.recorder = recorderID;
recorder.controls.forEach(function (el) {
item.addComponent(el);
});
if (item.value && item.value.length > 0) {
Recorder.onDeviceReady.subscribe(function () {
Recorder.loadBase64Audio(recorderID, item.value);
});
}
};
Recorder_Widget.prototype.showMenu = function (contentMenu, evt, pageSelection) {
var menu = contentMenu,
item = this.entity;
if (Player.isPlaying()) {
return;
}
var micDiv = YUD.get(this.id);
var id = micDiv.id;
var recorderMenuItems = [];
if (Recorder.isCapturing()) {
var menuLabel = Messages.get('TDSAudioJS.Label.StopRecording');
recorderMenuItems.push({
text: menuLabel, classname: 'stoprecording', onclick: {
fn: function () {
Recorder.stopCapture(id);
}
}
});
} else {
if (Recorder.isPlaying()) {
if (YUD.hasClass(micDiv, 'playing_start')) {
var menuLabel = Messages.get('TDSAudioJS.Label.StopPlayRecording');
recorderMenuItems.push({
text: menuLabel, classname: 'stopquestion', onclick: {
fn: function () {
Recorder.stopAudio(id);
}
}
});
}
} else {
var menuLabel = Messages.get('TDSAudioJS.Label.StartRecording');
recorderMenuItems.push({
text: menuLabel, classname: 'startrecording', onclick: {
fn: function () {
Recorder.startCapture(id);
}
}
});
if (YUD.hasClass(micDiv, 'decode_complete') ||
YUD.hasClass(micDiv, 'recording_done') ||
YUD.hasClass(micDiv, 'playing_done') ||
YUD.hasClass(micDiv, 'playing_stopped')) {
var menuLabel = Messages.get('TDSAudioJS.Label.PlayRecording');
recorderMenuItems.push({
text: menuLabel, classname: 'playrecording', onclick: {
fn: function () {
Recorder.playAudio(id);
}
}
});
}
}
}
for (var i = 0; i < recorderMenuItems.length; i++) {
menu._entity.push(recorderMenuItems[i]);
}
};
Recorder_Widget.prototype.hide = function () {
if (Recorder.isPlaying()) {
Recorder.stopAudio();
}
if (Recorder.isCapturing()) {
Recorder.stopCapture();
}
};
Recorder_Widget.prototype.getResponse = function () {
var value = Recorder.retrieveBase64Audio(this.id) || '',
haveSound = value.length > 0;
return this.createResponse(value, haveSound, haveSound);
};
Recorder_Widget.prototype.setResponse = function (value) {
Recorder.loadBase64Audio(this.id, value);
};
})(TDS.Audio, window.ContentManager);

/* SOURCE FILE: plugin.js (dd8e5a2c) 10/26/2014 1:27:05 PM */

(function (CM) {
if (!CM) return;
TTS.MenuSystem = {
Last: null,
addMenuSetup: function (menu, playCfg) {
try {
if (!menu || !playCfg || !playCfg.ORDER) {
return;
}
TTS.MenuSystem.Last = playCfg;
var order = playCfg.ORDER;
for (var i = 0; i < order.length; ++i) {
var entryName = order[i];
var entry = playCfg[entryName];
if (entry && (typeof entry.cb == 'function' || entry.allowDisabled)) {
menu.addMenuItem(entry.level || 'entity', {
text: Messages.get(entry.Label || 'TTS'),
onclick: { fn: entry.cb },
disabled: typeof entry.cb == 'function' ? TDS.Audio.isActive() : entry.allowDisabled,
classname: entry.css || 'speaksection'
});
}
}
} catch (e) {
console.error("Failed to create menu item.", e);
}
}
};
function hasTTSItemEnabled(page) {
var accProps = page.getAccommodationProperties();
return accProps && accProps.hasTTSItem();
}
function hasTTSPassageEnabled(page) {
var accProps = page.getAccommodationProperties();
return accProps && accProps.hasTTSStimulus();
}
function hasTTSEnabled(page) {
return hasTTSItemEnabled(page) || hasTTSPassageEnabled(page);
}
function ItemPlugin_TTS(page, entity, config) {
}
TTS.Config.isTrackingEnabled = function () {
return window.ContentManager != null && window.ContentManager.getAccommodationProperties().isTTSTrackingEnabled();
};
function itemMatch(page, entity) {
var accProps = page.getAccommodationProperties();
if (accProps && entity instanceof ContentItem) {
if (entity.isResponseType('EBSR')) return false;
return accProps.hasTTSItem();
}
return false;
}
CM.registerEntityPlugin('item.tts', ItemPlugin_TTS, itemMatch, {
priority: 299
});
ItemPlugin_TTS.prototype.load = function () {
var page = this.page;
var item = this.entity;
var itemEl = item.getElement();
if (itemEl) {
var markCommentEl = Util.Dom.getElementByClassName('markComment', 'span', itemEl);
if (markCommentEl) {
markCommentEl.setAttribute('data-tts-skip', 'true');
}
var posEl = Util.Dom.queryTag('h2', itemEl);
if (posEl && Util.Dom.getTextContent(posEl) == item.position) {
posEl.setAttribute('data-tts-skip', 'true');
}
}
TTS.createSingleton();
var pageDoc = page.getDoc();
if (pageDoc) {
var commentBoxEl = pageDoc.getElementById('Item_CommentBox_' + item.position);
if (commentBoxEl) {
commentBoxEl.setAttribute('data-tts-skip', 'true');
}
}
}
ItemPlugin_TTS.prototype.showMenu = function(menu, evt, selection) {
var page = this.page;
var item = this.entity;
var ctrl = TTS.getInstance();
if (!ctrl.isAvailable()) return;
var isMC = item.widgets.has('mc');
if (isMC) {
}
var pageWin = page.getActiveWin();
var languages = CM.getLanguage() != 'ENU' ? ['ESN', 'ENU'] : ['ENU'];
var domToParse = [];
var stem = item.getStemElement();
if (stem) {
domToParse.push(stem);
}
var illustration = item.getIllustrationElement();
if (illustration) {
domToParse.push(illustration);
}
var ttsMenu = new TTS.Menu(languages);
var menuCfg = ttsMenu.getMenuCfg(domToParse, selection, pageWin, item.stemTTS, page, item);
TTS.MenuSystem.addMenuSetup(menu, menuCfg);
TTS.Config.Debug && console.log("TTS On Item Menushow config", menuCfg);
}
ItemPlugin_TTS.prototype.hide = function () {
TTS.getInstance().stop();
};
function PassagePlugin_TTS(page, entity, config) {
}
CM.registerEntityPlugin('passage.tts', PassagePlugin_TTS, function itemMatch(page, entity) {
var accProps = page.getAccommodationProperties();
if (accProps && entity instanceof ContentPassage) {
return accProps.hasTTSStimulus();
}
return false;
});
PassagePlugin_TTS.prototype.showMenu = function (menu, evt, selection) {
var page = this.page;
var passage = this.entity;
if (!TTS.Manager.isAvailable()) return;
var languages = CM.getLanguage() != 'ENU' ? ['ESN', 'ENU'] : ['ENU'];
var ttsMenu = new TTS.Menu(languages);
var menuCfg = ttsMenu.getMenuCfg(
passage.getElement(),
selection,
page.getActiveWin(),
passage.stemTTS,
page,
passage
);
TTS.Config.Debug && console.log("Passage menu show.", menuCfg);
TTS.MenuSystem.addMenuSetup(menu, menuCfg);
}
PassagePlugin_TTS.prototype.hide = function () {
TTS.getInstance().stop();
};
function PagePlugin_TTS(page, config) {
}
CM.registerPagePlugin('tts-page', PagePlugin_TTS, function pageMatch(page) {
return hasTTSEnabled(page);
});
function ttsNotSpeaking() {
var ttsInstance = TTS.getInstance();
if (ttsInstance && ttsInstance.isPlaying()) {
return false;
} else {
return true;
}
}
TDS.Audio.Player.onBeforePlay.subscribe(function () {
return ttsNotSpeaking();
});
TDS.Audio.Player.onBeforeResume.subscribe(function () {
return ttsNotSpeaking();
});
CM.onPageEvent('hide', function (page) {
TTS.getInstance().stop();
});
})(window.ContentManager);

/* SOURCE FILE: plugins.option.js (f24fb611) 10/26/2014 1:27:05 PM */

(function (CM, Modes) {
var CSS_TTSOPTION = 'speaksection';
var SELECTOR_TTSOPTION = 'div.optionContainer';
function getSpeakables(entity) {
var entityEl = entity.getElement();
return $(SELECTOR_TTSOPTION, entityEl).get();
}
function isSpeakable(el) {
return $(el).is(SELECTOR_TTSOPTION);
}
function isTTSAvailable() {
var ctrl = TTS.getInstance();
if (!ctrl.isAvailable()) {
return false;
} else {
return true;
}
}
function Mode_TTSOption() { }
Modes.register('tts-option', Mode_TTSOption);
Mode_TTSOption.prototype.select = function (el) {
var languages = CM.getLanguage() == 'ESN' ? ['ESN', 'ENU'] : ['ENU'];
var ttsMenu = new TTS.Menu(languages);
var menuCfg = ttsMenu.addFocusedOption(null, el);
if (menuCfg && menuCfg.PRI && menuCfg.PRI.cb) {
menuCfg.PRI.cb();
}
CM.Modes.disable('tts-option');
};
Mode_TTSOption.prototype.enable = function () {
if (isTTSAvailable()) {
return getSpeakables(this.entity);
} else {
return null;
}
};
function match(page, entity) {
if (entity instanceof ContentItem) {
var accProps = page.getAccommodationProperties();
if (accProps.hasTTSItem()) {
return ['mc', 'ebsr', 'choice'].some(function (widgetName) {
return entity.widgets.has(widgetName);
});
}
}
return false;
}
function Plugin_TTSOption(page, entity) { }
CM.registerEntityPlugin('tts-option', Plugin_TTSOption, match, {
priority: 299
});
Plugin_TTSOption.prototype.showMenu = function (menu, evt) {
var component = this.entity.getActiveComponent();
var accProps = this.page.getAccProps();
var hasMenuButton = accProps.showItemToolsMenu();
if (component && isSpeakable(component)) {
}
var languages = CM.getLanguage() != 'ENU' ? ['ESN', 'ENU'] : ['ENU'];
var ttsMenu = new TTS.Menu(languages);
var menuCfg;
if (component && isSpeakable(component) && CM.Menu.isContextEvent(evt)) {
menuCfg = ttsMenu.addFocusedOption(null, component);
} else if (hasMenuButton) {
menuCfg = ttsMenu.addMode(null, function() {
CM.Modes.enable('tts-option');
});
}
TTS.MenuSystem.addMenuSetup(menu, menuCfg);
};
})(window.ContentManager, window.ContentManager.Modes);

/* SOURCE FILE: base.js (1443f1cc) 9/9/2014 2:09:01 PM */

(function(CM) {
var inlineInteractions = [
'textEntryInteraction',
'inlineChoiceInteraction'
];
function processQTI(page, item) {
var qtiDoc = Util.Xml.parseFromString(item.qti.xml);
var itemBodyNode = Util.Dom.getElementByTagName('itemBody', qtiDoc);
var itemBodyChildren = Util.Dom.getElementsByTagName('*', itemBodyNode);
itemBodyChildren.forEach(function (itemBodyChild) {
if (!Util.String.contains(itemBodyChild.nodeName, 'Interaction')) return;
var interactionType = itemBodyChild.nodeName;
var inline = inlineInteractions.indexOf(interactionType) != -1;
var nodeName = inline ? 'span' : 'div';
var interactionEl = qtiDoc.createElement(nodeName);
var interactionId = itemBodyChild.getAttribute('responseIdentifier');
interactionEl.className = 'qti-interaction';
interactionEl.setAttribute('data-qti-type', interactionType);
interactionEl.setAttribute('data-qti-identifier', interactionId);
var customData = itemBodyChild.getAttribute('class');
if (customData) {
interactionEl.setAttribute('data-qti-custom', customData);
}
$(itemBodyChild).replaceWith(interactionEl);
var scriptEl = qtiDoc.createElement('script');
if (itemBodyChild.nodeName == 'customInteraction') {
scriptEl.setAttribute('type', 'text/xml');
scriptEl.appendChild($(itemBodyChild).children().get(0));
} else {
scriptEl.setAttribute('type', 'text/qti');
scriptEl.appendChild(itemBodyChild);
}
interactionEl.appendChild(scriptEl);
});
var itemBodyHtml = Util.Xml.innerHTML(itemBodyNode);
var stemEl = item.getStemElement();
stemEl.innerHTML = itemBodyHtml;
}
function match(page, entity) {
return (entity instanceof ContentItem &&
entity.isResponseType('QTI'));
}
function Plugin_QTI(page, item, config) {
}
CM.registerEntityPlugin('qti', Plugin_QTI, match);
Plugin_QTI.prototype.init = function () {
processQTI(this.page, this.entity);
}
function Container_QTI(widgets) {
}
CM.registerResponseContainer('qti', Container_QTI);
Container_QTI.prototype.create = function (responses) {
var xmlDoc = Util.Xml.parseFromString('<itemResponse></itemResponse>');
var rootNode = xmlDoc.documentElement;
function addValue(responseNode, value) {
if (value == null) return;
var valueNode = xmlDoc.createElement('value');
valueNode.appendChild(document.createTextNode(value));
responseNode.appendChild(valueNode);
}
responses.forEach(function (response) {
var responseNode = xmlDoc.createElement('response');
responseNode.setAttribute('id', response.id);
if (response.dataType == 'array') {
response.value.forEach(function (value) {
addValue(responseNode, value);
});
} else {
addValue(responseNode, response.value);
}
rootNode.appendChild(responseNode);
});
return Util.Xml.serializeToString(xmlDoc);
}
Container_QTI.prototype.load = function (value, widgets) {
var xmlDoc = Util.Xml.parseFromString(value);
var rootNode = xmlDoc.documentElement;
$('response', rootNode).each(function (idx, responseNode) {
var values = $('value', responseNode).map(function (valueIdx, valueNode) {
return Util.Xml.getNodeText(valueNode);
}).get();
if (values.length > 0) {
var id = responseNode.getAttribute('id');
var widget = Util.Array.find(widgets, function (widget) {
return widget.id == id;
});
if (widget) {
if (widget.dataType == 'array') {
widget.setResponse(values);
} else {
widget.setResponse(values[0]);
}
}
}
});
}
CM.mapResponseContainer('QTI', 'QTI');
})(window.ContentManager);

/* SOURCE FILE: textEntry.js (2cdb08b3) 10/26/2014 1:27:05 PM */

(function(CM) {
var match = CM.QTI.createWidgetMatch('textEntryInteraction');
function Widget_TE(page, item, config) {
this.options = {
autoLoad: true
}
this.inputEl = null;
}
CM.registerWidget('qti.textentry', Widget_TE, match);
Widget_TE.prototype.load = function() {
var teEl = this.element;
var teNode = this.config;
var teInput = document.createElement('input');
teInput.type = 'text';
teInput.className = 'textEntry';
teEl.appendChild(teInput);
var expectedLength = teNode.getAttribute('expectedLength') * 1;
if (expectedLength > 0) {
teInput.setAttribute('size', expectedLength);
teInput.setAttribute('maxlength', expectedLength);
}
this.inputEl = teInput;
}
Widget_TE.prototype.getComponents = function () {
return [this.inputEl];
}
Widget_TE.prototype.getResponse = function() {
var value = this.inputEl.value;
var isValid = YAHOO.lang.trim(value).length > 0;
return this.createResponse(value, isValid);
}
Widget_TE.prototype.setResponse = function (value) {
this.inputEl.value = value;
}
})(window.ContentManager);

/* SOURCE FILE: inlineChoice.js (1a524352) 10/26/2014 1:27:05 PM */

(function(CM) {
var match = CM.QTI.createWidgetMatch('inlineChoiceInteraction');
function Widget_IC(page, item, config) {
this.options = {
autoLoad: true
}
this.selectEl = null;
}
CM.registerWidget('qti.inlinechoice', Widget_IC, match);
Widget_IC.prototype.load = function () {
var containerEl = this.element;
var interactionNode = this.config;
var selectEl = document.createElement('select');
this.selectEl = selectEl;
$('inlineChoice', interactionNode).each(function(idx, icNode) {
var id = icNode.getAttribute('identifier');
var text = Util.Xml.getNodeText(icNode);
var optionEl = new Option(text, id);
selectEl.options[idx] = optionEl;
});
containerEl.appendChild(selectEl);
}
Widget_IC.prototype.getComponents = function () {
return [this.selectEl];
}
Widget_IC.prototype.getResponse = function() {
var value = this.selectEl.value;
var isValid = this.selectEl.selectedIndex > 0;
return this.createResponse(value, isValid);
}
Widget_IC.prototype.setResponse = function (value) {
this.selectEl.value = value;
}
})(window.ContentManager);

/* SOURCE FILE: animation_manager.js (bfb84190) 9/9/2014 2:08:49 PM */

(function() {
var CSS_FRAME_ANIMATION = 'frame-anim-html5';
var AnimationManager = {};
AnimationManager.canPlayHTML5 = function (pageLink) {
var animData = VideoManager.SWF.parseData(pageLink);
if (animData.html5) {
if (YAHOO.env.ua.ie > 0 &&
YAHOO.env.ua.ie < 9) {
return false;
}
if (Util.Browser.getFirefoxVersion() > 0 &&
Util.Browser.getFirefoxVersion() < 4) {
return false;
}
return true;
}
return false;
};
AnimationManager.injectHTML5 = function (pageLink, scriptUrl) {
var animData = VideoManager.SWF.parseData(pageLink);
var animUrl = animData.url.replace('.swf', '.html');
if (animUrl.indexOf('?') != -1) {
var id = Util.Date.now();
if (typeof TDS == 'object') {
if (TDS.buildNumber) {
id = TDS.buildNumber;
} else if (TDS.Cache && TDS.Cache.id) {
id = TDS.Cache.id;
}
}
animUrl = animUrl.replace('?', '?cid=' + id + '&');
}
if (scriptUrl && animUrl.indexOf('?') != -1) {
scriptUrl = encodeURIComponent(scriptUrl);
animUrl = animUrl.replace('?', '?scriptUrl=' + scriptUrl + '&');
}
var animWidth = (animData.width || 400);
var animHeight = (animData.height || 400);
var animDoc = Util.Dom.getOwnerDocument(pageLink);
var animFrame = animDoc.createElement('iframe');
animFrame.className = CSS_FRAME_ANIMATION;
animFrame.setAttribute('width', animWidth + 'px');
animFrame.setAttribute('height', animHeight + 'px');
animFrame.setAttribute('src', animUrl);
pageLink.parentNode.replaceChild(animFrame, pageLink);
return animFrame;
};
AnimationManager.reloadHTML5 = function(currentFrame) {
var animUrl = YUD.getAttribute(currentFrame, 'src');
var animWidth = YUD.getAttribute(currentFrame, 'width');
var animHeight = YUD.getAttribute(currentFrame, 'height');
var animDoc = Util.Dom.getOwnerDocument(currentFrame);
var animFrame = animDoc.createElement('iframe');
animFrame.className = CSS_FRAME_ANIMATION;
animFrame.setAttribute('width', animWidth);
animFrame.setAttribute('height', animHeight);
animFrame.setAttribute('src', animUrl);
currentFrame.parentNode.replaceChild(animFrame, currentFrame);
return animFrame;
};
AnimationManager.getHTML5Frames = function(el) {
var animFrames = [],
frames = el.getElementsByTagName('iframe');
YUD.batch(frames, function(frame) {
if (YUD.hasClass(frame, CSS_FRAME_ANIMATION)) {
animFrames.push(frame);
}
});
return animFrames;
};
AnimationManager.stop = function(animFrame) {
console.log('Content Dialog: Stop HTML5 animation');
var animWin = Util.Dom.getFrameContentWindow(animFrame);
if (animWin) {
if (typeof animWin.stopAnimation == 'function') {
animWin.stopAnimation();
} else {
}
}
};
AnimationManager.resume = function(animFrame) {
console.log('Content Dialog: Resume HTML5 animation');
var animWin = Util.Dom.getFrameContentWindow(animFrame);
if (animWin) {
if (typeof animWin.playAnimation == 'function') {
setTimeout(function() {
animWin.playAnimation();
}, 30);
} else {
}
}
};
window.AnimationManager = AnimationManager;
})();

/* SOURCE FILE: module_animation.js (6e8fc5bd) 9/9/2014 2:08:51 PM */

(function ()
{
function processLinks(parentEl) {
var processed = false;
var scriptUrl = ContentManager.resolveBaseUrl('Scripts/Libraries/');
var pageLinks = parentEl.getElementsByTagName('a');
YUD.batch(pageLinks, function (pageLink) {
if (AnimationManager.canPlayHTML5(pageLink)) {
AnimationManager.injectHTML5(pageLink, scriptUrl);
processed = true;
}
});
return processed;
}
ContentManager.onPageEvent('available', function (page) {
var pageEl = page.getElement();
processLinks(pageEl);
});
ContentManager.onPageEvent('show', function (page) {
var pageEl = page.getElement();
var animFrames = AnimationManager.getHTML5Frames(pageEl);
if (animFrames.length > 0) {
AnimationManager.reloadHTML5(animFrames[0]);
}
});
ContentManager.Dialog.onLoad.subscribe(function(frame) {
var frameDoc = frame.getDocument();
if (Util.String.contains(frame.id, 'help')) {
processLinks(frameDoc);
}
});
ContentManager.Dialog.onBeforeHide.subscribe(function(frame) {
var dialogFrame = frame.getDocument();
if (dialogFrame) {
var animFrames = AnimationManager.getHTML5Frames(dialogFrame);
if (animFrames.length > 0) {
AnimationManager.stop(animFrames[0]);
}
}
});
ContentManager.Dialog.onShow.subscribe(function(frame) {
var dialogFrame = frame.getDocument();
if (dialogFrame) {
var animFrames = AnimationManager.getHTML5Frames(dialogFrame);
if (animFrames.length > 0) {
AnimationManager.resume(animFrames[0]);
}
}
});
})();

/* SOURCE FILE: jwplayer.js (fa259275) 9/9/2014 2:09:01 PM */

if(typeof jwplayer=="undefined"){var jwplayer=function(a){if(jwplayer.api){return jwplayer.api.selectPlayer(a)}};var $jw=jwplayer;jwplayer.version="5.10.2295 (Licensed version)";jwplayer.vid=document.createElement("video");jwplayer.audio=document.createElement("audio");jwplayer.source=document.createElement("source");(function(b){b.utils=function(){};b.utils.typeOf=function(d){var c=typeof d;if(c==="object"){if(d){if(d instanceof Array){c="array"}}else{c="null"}}return c};b.utils.extend=function(){var c=b.utils.extend["arguments"];if(c.length>1){for(var e=1;e<c.length;e++){for(var d in c[e]){c[0][d]=c[e][d]}}return c[0]}return null};b.utils.clone=function(f){var c;var d=b.utils.clone["arguments"];if(d.length==1){switch(b.utils.typeOf(d[0])){case"object":c={};for(var e in d[0]){c[e]=b.utils.clone(d[0][e])}break;case"array":c=[];for(var e in d[0]){c[e]=b.utils.clone(d[0][e])}break;default:return d[0];break}}return c};b.utils.extension=function(c){if(!c){return""}c=c.substring(c.lastIndexOf("/")+1,c.length);c=c.split("?")[0];if(c.lastIndexOf(".")>-1){return c.substr(c.lastIndexOf(".")+1,c.length).toLowerCase()}return};b.utils.html=function(c,d){c.innerHTML=d};b.utils.wrap=function(c,d){if(c.parentNode){c.parentNode.replaceChild(d,c)}d.appendChild(c)};b.utils.ajax=function(g,f,c){var e;if(window.XMLHttpRequest){e=new XMLHttpRequest()}else{e=new ActiveXObject("Microsoft.XMLHTTP")}e.onreadystatechange=function(){if(e.readyState===4){if(e.status===200){if(f){if(!b.utils.exists(e.responseXML)){try{if(window.DOMParser){var h=(new DOMParser()).parseFromString(e.responseText,"text/xml");if(h){e=b.utils.extend({},e,{responseXML:h})}}else{h=new ActiveXObject("Microsoft.XMLDOM");h.async="false";h.loadXML(e.responseText);e=b.utils.extend({},e,{responseXML:h})}}catch(j){if(c){c(g)}}}f(e)}}else{if(c){c(g)}}}};try{e.open("GET",g,true);e.send(null)}catch(d){if(c){c(g)}}return e};b.utils.load=function(d,e,c){d.onreadystatechange=function(){if(d.readyState===4){if(d.status===200){if(e){e()}}else{if(c){c()}}}}};b.utils.find=function(d,c){return d.getElementsByTagName(c)};b.utils.append=function(c,d){c.appendChild(d)};b.utils.isIE=function(){return((!+"\v1")||(typeof window.ActiveXObject!="undefined"))};b.utils.userAgentMatch=function(d){var c=navigator.userAgent.toLowerCase();return(c.match(d)!==null)};b.utils.isIOS=function(){return b.utils.userAgentMatch(/iP(hone|ad|od)/i)};b.utils.isIPad=function(){return b.utils.userAgentMatch(/iPad/i)};b.utils.isIPod=function(){return b.utils.userAgentMatch(/iP(hone|od)/i)};b.utils.isAndroid=function(){return b.utils.userAgentMatch(/android/i)};b.utils.isLegacyAndroid=function(){return b.utils.userAgentMatch(/android 2.[012]/i)};b.utils.isBlackberry=function(){return b.utils.userAgentMatch(/blackberry/i)};b.utils.isMobile=function(){return b.utils.userAgentMatch(/(iP(hone|ad|od))|android/i)};b.utils.getFirstPlaylistItemFromConfig=function(c){var d={};var e;if(c.playlist&&c.playlist.length){e=c.playlist[0]}else{e=c}d.file=e.file;d.levels=e.levels;d.streamer=e.streamer;d.playlistfile=e.playlistfile;d.provider=e.provider;if(!d.provider){if(d.file&&(d.file.toLowerCase().indexOf("youtube.com")>-1||d.file.toLowerCase().indexOf("youtu.be")>-1)){d.provider="youtube"}if(d.streamer&&d.streamer.toLowerCase().indexOf("rtmp://")==0){d.provider="rtmp"}if(e.type){d.provider=e.type.toLowerCase()}}if(d.provider=="audio"){d.provider="sound"}return d};b.utils.getOuterHTML=function(c){if(c.outerHTML){return c.outerHTML}else{try{return new XMLSerializer().serializeToString(c)}catch(d){return""}}};b.utils.setOuterHTML=function(f,e){if(f.outerHTML){f.outerHTML=e}else{var g=document.createElement("div");g.innerHTML=e;var c=document.createRange();c.selectNodeContents(g);var d=c.extractContents();f.parentNode.insertBefore(d,f);f.parentNode.removeChild(f)}};b.utils.hasFlash=function(){if(typeof navigator.plugins!="undefined"&&typeof navigator.plugins["Shockwave Flash"]!="undefined"){return true}if(typeof window.ActiveXObject!="undefined"){try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return true}catch(c){}}return false};b.utils.getPluginName=function(c){if(c.lastIndexOf("/")>=0){c=c.substring(c.lastIndexOf("/")+1,c.length)}if(c.lastIndexOf("-")>=0){c=c.substring(0,c.lastIndexOf("-"))}if(c.lastIndexOf(".swf")>=0){c=c.substring(0,c.lastIndexOf(".swf"))}if(c.lastIndexOf(".js")>=0){c=c.substring(0,c.lastIndexOf(".js"))}return c};b.utils.getPluginVersion=function(c){if(c.lastIndexOf("-")>=0){if(c.lastIndexOf(".js")>=0){return c.substring(c.lastIndexOf("-")+1,c.lastIndexOf(".js"))}else{if(c.lastIndexOf(".swf")>=0){return c.substring(c.lastIndexOf("-")+1,c.lastIndexOf(".swf"))}else{return c.substring(c.lastIndexOf("-")+1)}}}return""};b.utils.getAbsolutePath=function(j,h){if(!b.utils.exists(h)){h=document.location.href}if(!b.utils.exists(j)){return undefined}if(a(j)){return j}var k=h.substring(0,h.indexOf("://")+3);var g=h.substring(k.length,h.indexOf("/",k.length+1));var d;if(j.indexOf("/")===0){d=j.split("/")}else{var e=h.split("?")[0];e=e.substring(k.length+g.length+1,e.lastIndexOf("/"));d=e.split("/").concat(j.split("/"))}var c=[];for(var f=0;f<d.length;f++){if(!d[f]||!b.utils.exists(d[f])||d[f]=="."){continue}else{if(d[f]==".."){c.pop()}else{c.push(d[f])}}}return k+g+"/"+c.join("/")};function a(d){if(!b.utils.exists(d)){return}var e=d.indexOf("://");var c=d.indexOf("?");return(e>0&&(c<0||(c>e)))}b.utils.pluginPathType={ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE",CDN:"CDN"};b.utils.getPluginPathType=function(d){if(typeof d!="string"){return}d=d.split("?")[0];var e=d.indexOf("://");if(e>0){return b.utils.pluginPathType.ABSOLUTE}var c=d.indexOf("/");var f=b.utils.extension(d);if(e<0&&c<0&&(!f||!isNaN(f))){return b.utils.pluginPathType.CDN}return b.utils.pluginPathType.RELATIVE};b.utils.mapEmpty=function(c){for(var d in c){return false}return true};b.utils.mapLength=function(d){var c=0;for(var e in d){c++}return c};b.utils.log=function(d,c){if(typeof console!="undefined"&&typeof console.log!="undefined"){if(c){console.log(d,c)}else{console.log(d)}}};b.utils.css=function(d,g,c){if(b.utils.exists(d)){for(var e in g){try{if(typeof g[e]==="undefined"){continue}else{if(typeof g[e]=="number"&&!(e=="zIndex"||e=="opacity")){if(isNaN(g[e])){continue}if(e.match(/color/i)){g[e]="#"+b.utils.strings.pad(g[e].toString(16),6)}else{g[e]=Math.ceil(g[e])+"px"}}}d.style[e]=g[e]}catch(f){}}}};b.utils.isYouTube=function(c){return(c.indexOf("youtube.com")>-1||c.indexOf("youtu.be")>-1)};b.utils.transform=function(e,d,c,g,h){if(!b.utils.exists(d)){d=1}if(!b.utils.exists(c)){c=1}if(!b.utils.exists(g)){g=0}if(!b.utils.exists(h)){h=0}if(d==1&&c==1&&g==0&&h==0){e.style.webkitTransform="";e.style.MozTransform="";e.style.OTransform=""}else{var f="scale("+d+","+c+") translate("+g+"px,"+h+"px)";e.style.webkitTransform=f;e.style.MozTransform=f;e.style.OTransform=f}};b.utils.stretch=function(k,q,p,g,n,h){if(typeof p=="undefined"||typeof g=="undefined"||typeof n=="undefined"||typeof h=="undefined"){return}var d=p/n;var f=g/h;var m=0;var l=0;var e=false;var c={};if(q.parentElement){q.parentElement.style.overflow="hidden"}b.utils.transform(q);switch(k.toUpperCase()){case b.utils.stretching.NONE:c.width=n;c.height=h;c.top=(g-c.height)/2;c.left=(p-c.width)/2;break;case b.utils.stretching.UNIFORM:if(d>f){c.width=n*f;c.height=h*f;if(c.width/p>0.95){e=true;d=Math.ceil(100*p/c.width)/100;f=1;c.width=p}}else{c.width=n*d;c.height=h*d;if(c.height/g>0.95){e=true;d=1;f=Math.ceil(100*g/c.height)/100;c.height=g}}c.top=(g-c.height)/2;c.left=(p-c.width)/2;break;case b.utils.stretching.FILL:if(d>f){c.width=n*d;c.height=h*d}else{c.width=n*f;c.height=h*f}c.top=(g-c.height)/2;c.left=(p-c.width)/2;break;case b.utils.stretching.EXACTFIT:c.width=n;c.height=h;var o=Math.round((n/2)*(1-1/d));var j=Math.round((h/2)*(1-1/f));e=true;c.top=c.left=0;break;default:break}if(e){b.utils.transform(q,d,f,o,j)}b.utils.css(q,c)};b.utils.stretching={NONE:"NONE",FILL:"FILL",UNIFORM:"UNIFORM",EXACTFIT:"EXACTFIT"};b.utils.deepReplaceKeyName=function(k,e,c){switch(b.utils.typeOf(k)){case"array":for(var g=0;g<k.length;g++){k[g]=b.utils.deepReplaceKeyName(k[g],e,c)}break;case"object":for(var f in k){var j,h;if(e instanceof Array&&c instanceof Array){if(e.length!=c.length){continue}else{j=e;h=c}}else{j=[e];h=[c]}var d=f;for(var g=0;g<j.length;g++){d=d.replace(new RegExp(e[g],"g"),c[g])}k[d]=b.utils.deepReplaceKeyName(k[f],e,c);if(f!=d){delete k[f]}}break}return k};b.utils.isInArray=function(e,d){if(!(e)||!(e instanceof Array)){return false}for(var c=0;c<e.length;c++){if(d===e[c]){return true}}return false};b.utils.exists=function(c){switch(typeof(c)){case"string":return(c.length>0);break;case"object":return(c!==null);case"undefined":return false}return true};b.utils.empty=function(c){if(typeof c.hasChildNodes=="function"){while(c.hasChildNodes()){c.removeChild(c.firstChild)}}};b.utils.parseDimension=function(c){if(typeof c=="string"){if(c===""){return 0}else{if(c.lastIndexOf("%")>-1){return c}else{return parseInt(c.replace("px",""),10)}}}return c};b.utils.getDimensions=function(c){if(c&&c.style){return{x:b.utils.parseDimension(c.style.left),y:b.utils.parseDimension(c.style.top),width:b.utils.parseDimension(c.style.width),height:b.utils.parseDimension(c.style.height)}}else{return{}}};b.utils.getElementWidth=function(c){if(!c){return null}else{if(c==document.body){return b.utils.parentNode(c).clientWidth}else{if(c.clientWidth>0){return c.clientWidth}else{if(c.style){return b.utils.parseDimension(c.style.width)}else{return null}}}}};b.utils.getElementHeight=function(c){if(!c){return null}else{if(c==document.body){return b.utils.parentNode(c).clientHeight}else{if(c.clientHeight>0){return c.clientHeight}else{if(c.style){return b.utils.parseDimension(c.style.height)}else{return null}}}}};b.utils.timeFormat=function(c){str="00:00";if(c>0){str=Math.floor(c/60)<10?"0"+Math.floor(c/60)+":":Math.floor(c/60)+":";str+=Math.floor(c%60)<10?"0"+Math.floor(c%60):Math.floor(c%60)}return str};b.utils.useNativeFullscreen=function(){return(navigator&&navigator.vendor&&navigator.vendor.indexOf("Apple")==0)};b.utils.parentNode=function(c){if(!c){return document.body}else{if(c.parentNode){return c.parentNode}else{if(c.parentElement){return c.parentElement}else{return c}}}};b.utils.getBoundingClientRect=function(c){if(typeof c.getBoundingClientRect=="function"){return c.getBoundingClientRect()}else{return{left:c.offsetLeft+document.body.scrollLeft,top:c.offsetTop+document.body.scrollTop,width:c.offsetWidth,height:c.offsetHeight}}};b.utils.translateEventResponse=function(e,c){var g=b.utils.extend({},c);if(e==b.api.events.JWPLAYER_FULLSCREEN&&!g.fullscreen){g.fullscreen=g.message=="true"?true:false;delete g.message}else{if(typeof g.data=="object"){g=b.utils.extend(g,g.data);delete g.data}else{if(typeof g.metadata=="object"){b.utils.deepReplaceKeyName(g.metadata,["__dot__","__spc__","__dsh__"],["."," ","-"])}}}var d=["position","duration","offset"];for(var f in d){if(g[d[f]]){g[d[f]]=Math.round(g[d[f]]*1000)/1000}}return g};b.utils.saveCookie=function(c,d){document.cookie="jwplayer."+c+"="+d+"; path=/"};b.utils.getCookies=function(){var f={};var e=document.cookie.split("; ");for(var d=0;d<e.length;d++){var c=e[d].split("=");if(c[0].indexOf("jwplayer.")==0){f[c[0].substring(9,c[0].length)]=c[1]}}return f};b.utils.readCookie=function(c){return b.utils.getCookies()[c]}})(jwplayer);(function(a){a.events=function(){};a.events.COMPLETE="COMPLETE";a.events.ERROR="ERROR"})(jwplayer);(function(jwplayer){jwplayer.events.eventdispatcher=function(debug){var _debug=debug;var _listeners;var _globallisteners;this.resetEventListeners=function(){_listeners={};_globallisteners=[]};this.resetEventListeners();this.addEventListener=function(type,listener,count){try{if(!jwplayer.utils.exists(_listeners[type])){_listeners[type]=[]}if(typeof(listener)=="string"){eval("listener = "+listener)}_listeners[type].push({listener:listener,count:count})}catch(err){jwplayer.utils.log("error",err)}return false};this.removeEventListener=function(type,listener){if(!_listeners[type]){return}try{for(var listenerIndex=0;listenerIndex<_listeners[type].length;listenerIndex++){if(_listeners[type][listenerIndex].listener.toString()==listener.toString()){_listeners[type].splice(listenerIndex,1);break}}}catch(err){jwplayer.utils.log("error",err)}return false};this.addGlobalListener=function(listener,count){try{if(typeof(listener)=="string"){eval("listener = "+listener)}_globallisteners.push({listener:listener,count:count})}catch(err){jwplayer.utils.log("error",err)}return false};this.removeGlobalListener=function(listener){if(!listener){return}try{for(var globalListenerIndex=0;globalListenerIndex<_globallisteners.length;globalListenerIndex++){if(_globallisteners[globalListenerIndex].listener.toString()==listener.toString()){_globallisteners.splice(globalListenerIndex,1);break}}}catch(err){jwplayer.utils.log("error",err)}return false};this.sendEvent=function(type,data){if(!jwplayer.utils.exists(data)){data={}}if(_debug){jwplayer.utils.log(type,data)}if(typeof _listeners[type]!="undefined"){for(var listenerIndex=0;listenerIndex<_listeners[type].length;listenerIndex++){try{_listeners[type][listenerIndex].listener(data)}catch(err){jwplayer.utils.log("There was an error while handling a listener: "+err.toString(),_listeners[type][listenerIndex].listener)}if(_listeners[type][listenerIndex]){if(_listeners[type][listenerIndex].count===1){delete _listeners[type][listenerIndex]}else{if(_listeners[type][listenerIndex].count>0){_listeners[type][listenerIndex].count=_listeners[type][listenerIndex].count-1}}}}}for(var globalListenerIndex=0;globalListenerIndex<_globallisteners.length;globalListenerIndex++){try{_globallisteners[globalListenerIndex].listener(data)}catch(err){jwplayer.utils.log("There was an error while handling a listener: "+err.toString(),_globallisteners[globalListenerIndex].listener)}if(_globallisteners[globalListenerIndex]){if(_globallisteners[globalListenerIndex].count===1){delete _globallisteners[globalListenerIndex]}else{if(_globallisteners[globalListenerIndex].count>0){_globallisteners[globalListenerIndex].count=_globallisteners[globalListenerIndex].count-1}}}}}}})(jwplayer);(function(a){var b={};a.utils.animations=function(){};a.utils.animations.transform=function(c,d){c.style.webkitTransform=d;c.style.MozTransform=d;c.style.OTransform=d;c.style.msTransform=d};a.utils.animations.transformOrigin=function(c,d){c.style.webkitTransformOrigin=d;c.style.MozTransformOrigin=d;c.style.OTransformOrigin=d;c.style.msTransformOrigin=d};a.utils.animations.rotate=function(c,d){a.utils.animations.transform(c,["rotate(",d,"deg)"].join(""))};a.utils.cancelAnimation=function(c){delete b[c.id]};a.utils.fadeTo=function(m,f,e,j,h,d){if(b[m.id]!=d&&a.utils.exists(d)){return}if(m.style.opacity==f){return}var c=new Date().getTime();if(d>c){setTimeout(function(){a.utils.fadeTo(m,f,e,j,0,d)},d-c)}if(m.style.display=="none"){m.style.display="block"}if(!a.utils.exists(j)){j=m.style.opacity===""?1:m.style.opacity}if(m.style.opacity==f&&m.style.opacity!==""&&a.utils.exists(d)){if(f===0){m.style.display="none"}return}if(!a.utils.exists(d)){d=c;b[m.id]=d}if(!a.utils.exists(h)){h=0}var k=(e>0)?((c-d)/(e*1000)):0;k=k>1?1:k;var l=f-j;var g=j+(k*l);if(g>1){g=1}else{if(g<0){g=0}}m.style.opacity=g;if(h>0){b[m.id]=d+h*1000;a.utils.fadeTo(m,f,e,j,0,b[m.id]);return}setTimeout(function(){a.utils.fadeTo(m,f,e,j,0,d)},10)}})(jwplayer);(function(a){a.utils.arrays=function(){};a.utils.arrays.indexOf=function(c,d){for(var b=0;b<c.length;b++){if(c[b]==d){return b}}return -1};a.utils.arrays.remove=function(c,d){var b=a.utils.arrays.indexOf(c,d);if(b>-1){c.splice(b,1)}}})(jwplayer);(function(a){a.utils.extensionmap={"3gp":{html5:"video/3gpp",flash:"video"},"3gpp":{html5:"video/3gpp"},"3g2":{html5:"video/3gpp2",flash:"video"},"3gpp2":{html5:"video/3gpp2"},flv:{flash:"video"},f4a:{html5:"audio/mp4"},f4b:{html5:"audio/mp4",flash:"video"},f4v:{html5:"video/mp4",flash:"video"},mov:{html5:"video/quicktime",flash:"video"},m4a:{html5:"audio/mp4",flash:"video"},m4b:{html5:"audio/mp4"},m4p:{html5:"audio/mp4"},m4v:{html5:"video/mp4",flash:"video"},mp4:{html5:"video/mp4",flash:"video"},rbs:{flash:"sound"},aac:{html5:"audio/aac",flash:"video"},mp3:{html5:"audio/mp3",flash:"sound"},ogg:{html5:"audio/ogg"},oga:{html5:"audio/ogg"},ogv:{html5:"video/ogg"},webm:{html5:"video/webm"},m3u8:{html5:"audio/x-mpegurl"},gif:{flash:"image"},jpeg:{flash:"image"},jpg:{flash:"image"},swf:{flash:"image"},png:{flash:"image"},wav:{html5:"audio/x-wav"}}})(jwplayer);(function(e){e.utils.mediaparser=function(){};var g={element:{width:"width",height:"height",id:"id","class":"className",name:"name"},media:{src:"file",preload:"preload",autoplay:"autostart",loop:"repeat",controls:"controls"},source:{src:"file",type:"type",media:"media","data-jw-width":"width","data-jw-bitrate":"bitrate"},video:{poster:"image"}};var f={};e.utils.mediaparser.parseMedia=function(j){return d(j)};function c(k,j){if(!e.utils.exists(j)){j=g[k]}else{e.utils.extend(j,g[k])}return j}function d(n,j){if(f[n.tagName.toLowerCase()]&&!e.utils.exists(j)){return f[n.tagName.toLowerCase()](n)}else{j=c("element",j);var o={};for(var k in j){if(k!="length"){var m=n.getAttribute(k);if(e.utils.exists(m)){o[j[k]]=m}}}var l=n.style["#background-color"];if(l&&!(l=="transparent"||l=="rgba(0, 0, 0, 0)")){o.screencolor=l}return o}}function h(n,k){k=c("media",k);var l=[];var j=e.utils.selectors("source",n);for(var m in j){if(!isNaN(m)){l.push(a(j[m]))}}var o=d(n,k);if(e.utils.exists(o.file)){l[0]={file:o.file}}o.levels=l;return o}function a(l,k){k=c("source",k);var j=d(l,k);j.width=j.width?j.width:0;j.bitrate=j.bitrate?j.bitrate:0;return j}function b(l,k){k=c("video",k);var j=h(l,k);return j}f.media=h;f.audio=h;f.source=a;f.video=b})(jwplayer);(function(a){a.utils.loaderstatus={NEW:"NEW",LOADING:"LOADING",ERROR:"ERROR",COMPLETE:"COMPLETE"};a.utils.scriptloader=function(c){var d=a.utils.loaderstatus.NEW;var b=new a.events.eventdispatcher();a.utils.extend(this,b);this.load=function(){if(d==a.utils.loaderstatus.NEW){d=a.utils.loaderstatus.LOADING;var e=document.createElement("script");e.onload=function(f){d=a.utils.loaderstatus.COMPLETE;b.sendEvent(a.events.COMPLETE)};e.onerror=function(f){d=a.utils.loaderstatus.ERROR;b.sendEvent(a.events.ERROR)};e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){d=a.utils.loaderstatus.COMPLETE;b.sendEvent(a.events.COMPLETE)}};document.getElementsByTagName("head")[0].appendChild(e);e.src=c}};this.getStatus=function(){return d}}})(jwplayer);(function(a){a.utils.selectors=function(b,e){if(!a.utils.exists(e)){e=document}b=a.utils.strings.trim(b);var c=b.charAt(0);if(c=="#"){return e.getElementById(b.substr(1))}else{if(c=="."){if(e.getElementsByClassName){return e.getElementsByClassName(b.substr(1))}else{return a.utils.selectors.getElementsByTagAndClass("*",b.substr(1))}}else{if(b.indexOf(".")>0){var d=b.split(".");return a.utils.selectors.getElementsByTagAndClass(d[0],d[1])}else{return e.getElementsByTagName(b)}}}return null};a.utils.selectors.getElementsByTagAndClass=function(e,h,g){var j=[];if(!a.utils.exists(g)){g=document}var f=g.getElementsByTagName(e);for(var d=0;d<f.length;d++){if(a.utils.exists(f[d].className)){var c=f[d].className.split(" ");for(var b=0;b<c.length;b++){if(c[b]==h){j.push(f[d])}}}}return j}})(jwplayer);(function(a){a.utils.strings=function(){};a.utils.strings.trim=function(b){return b.replace(/^\s*/,"").replace(/\s*$/,"")};a.utils.strings.pad=function(c,d,b){if(!b){b="0"}while(c.length<d){c=b+c}return c};a.utils.strings.serialize=function(b){if(b==null){return null}else{if(b=="true"){return true}else{if(b=="false"){return false}else{if(isNaN(Number(b))||b.length>5||b.length==0){return b}else{return Number(b)}}}}};a.utils.strings.seconds=function(d){d=d.replace(",",".");var b=d.split(":");var c=0;if(d.substr(-1)=="s"){c=Number(d.substr(0,d.length-1))}else{if(d.substr(-1)=="m"){c=Number(d.substr(0,d.length-1))*60}else{if(d.substr(-1)=="h"){c=Number(d.substr(0,d.length-1))*3600}else{if(b.length>1){c=Number(b[b.length-1]);c+=Number(b[b.length-2])*60;if(b.length==3){c+=Number(b[b.length-3])*3600}}else{c=Number(d)}}}}return c};a.utils.strings.xmlAttribute=function(b,c){for(var d=0;d<b.attributes.length;d++){if(b.attributes[d].name&&b.attributes[d].name.toLowerCase()==c.toLowerCase()){return b.attributes[d].value.toString()}}return""};a.utils.strings.jsonToString=function(f){var h=h||{};if(h&&h.stringify){return h.stringify(f)}var c=typeof(f);if(c!="object"||f===null){if(c=="string"){f='"'+f.replace(/"/g,'\\"')+'"'}else{return String(f)}}else{var g=[],b=(f&&f.constructor==Array);for(var d in f){var e=f[d];switch(typeof(e)){case"string":e='"'+e.replace(/"/g,'\\"')+'"';break;case"object":if(a.utils.exists(e)){e=a.utils.strings.jsonToString(e)}break}if(b){if(typeof(e)!="function"){g.push(String(e))}}else{if(typeof(e)!="function"){g.push('"'+d+'":'+String(e))}}}if(b){return"["+String(g)+"]"}else{return"{"+String(g)+"}"}}}})(jwplayer);(function(c){var d=new RegExp(/^(#|0x)[0-9a-fA-F]{3,6}/);c.utils.typechecker=function(g,f){f=!c.utils.exists(f)?b(g):f;return e(g,f)};function b(f){var g=["true","false","t","f"];if(g.toString().indexOf(f.toLowerCase().replace(" ",""))>=0){return"boolean"}else{if(d.test(f)){return"color"}else{if(!isNaN(parseInt(f,10))&&parseInt(f,10).toString().length==f.length){return"integer"}else{if(!isNaN(parseFloat(f))&&parseFloat(f).toString().length==f.length){return"float"}}}}return"string"}function e(g,f){if(!c.utils.exists(f)){return g}switch(f){case"color":if(g.length>0){return a(g)}return null;case"integer":return parseInt(g,10);case"float":return parseFloat(g);case"boolean":if(g.toLowerCase()=="true"){return true}else{if(g=="1"){return true}}return false}return g}function a(f){switch(f.toLowerCase()){case"blue":return parseInt("0000FF",16);case"green":return parseInt("00FF00",16);case"red":return parseInt("FF0000",16);case"cyan":return parseInt("00FFFF",16);case"magenta":return parseInt("FF00FF",16);case"yellow":return parseInt("FFFF00",16);case"black":return parseInt("000000",16);case"white":return parseInt("FFFFFF",16);default:f=f.replace(/(#|0x)?([0-9A-F]{3,6})$/gi,"$2");if(f.length==3){f=f.charAt(0)+f.charAt(0)+f.charAt(1)+f.charAt(1)+f.charAt(2)+f.charAt(2)}return parseInt(f,16)}return parseInt("000000",16)}})(jwplayer);(function(a){a.utils.parsers=function(){};a.utils.parsers.localName=function(b){if(!b){return""}else{if(b.localName){return b.localName}else{if(b.baseName){return b.baseName}else{return""}}}};a.utils.parsers.textContent=function(b){if(!b){return""}else{if(b.textContent){return b.textContent}else{if(b.text){return b.text}else{return""}}}}})(jwplayer);(function(a){a.utils.parsers.jwparser=function(){};a.utils.parsers.jwparser.PREFIX="jwplayer";a.utils.parsers.jwparser.parseEntry=function(c,d){for(var b=0;b<c.childNodes.length;b++){if(c.childNodes[b].prefix==a.utils.parsers.jwparser.PREFIX){d[a.utils.parsers.localName(c.childNodes[b])]=a.utils.strings.serialize(a.utils.parsers.textContent(c.childNodes[b]));if(a.utils.parsers.localName(c.childNodes[b])=="file"&&d.levels){delete d.levels}}if(!d.file&&String(d.link).toLowerCase().indexOf("youtube")>-1){d.file=d.link}}return d};a.utils.parsers.jwparser.getProvider=function(c){if(c.type){return c.type}else{if(c.file.indexOf("youtube.com/w")>-1||c.file.indexOf("youtube.com/v")>-1||c.file.indexOf("youtu.be/")>-1){return"youtube"}else{if(c.streamer&&c.streamer.indexOf("rtmp")==0){return"rtmp"}else{if(c.streamer&&c.streamer.indexOf("http")==0){return"http"}else{var b=a.utils.strings.extension(c.file);if(extensions.hasOwnProperty(b)){return extensions[b]}}}}}return""}})(jwplayer);(function(a){a.utils.parsers.mediaparser=function(){};a.utils.parsers.mediaparser.PREFIX="media";a.utils.parsers.mediaparser.parseGroup=function(d,f){var e=false;for(var c=0;c<d.childNodes.length;c++){if(d.childNodes[c].prefix==a.utils.parsers.mediaparser.PREFIX){if(!a.utils.parsers.localName(d.childNodes[c])){continue}switch(a.utils.parsers.localName(d.childNodes[c]).toLowerCase()){case"content":if(!e){f.file=a.utils.strings.xmlAttribute(d.childNodes[c],"url")}if(a.utils.strings.xmlAttribute(d.childNodes[c],"duration")){f.duration=a.utils.strings.seconds(a.utils.strings.xmlAttribute(d.childNodes[c],"duration"))}if(a.utils.strings.xmlAttribute(d.childNodes[c],"start")){f.start=a.utils.strings.seconds(a.utils.strings.xmlAttribute(d.childNodes[c],"start"))}if(d.childNodes[c].childNodes&&d.childNodes[c].childNodes.length>0){f=a.utils.parsers.mediaparser.parseGroup(d.childNodes[c],f)}if(a.utils.strings.xmlAttribute(d.childNodes[c],"width")||a.utils.strings.xmlAttribute(d.childNodes[c],"bitrate")||a.utils.strings.xmlAttribute(d.childNodes[c],"url")){if(!f.levels){f.levels=[]}f.levels.push({width:a.utils.strings.xmlAttribute(d.childNodes[c],"width"),bitrate:a.utils.strings.xmlAttribute(d.childNodes[c],"bitrate"),file:a.utils.strings.xmlAttribute(d.childNodes[c],"url")})}break;case"title":f.title=a.utils.parsers.textContent(d.childNodes[c]);break;case"description":f.description=a.utils.parsers.textContent(d.childNodes[c]);break;case"keywords":f.tags=a.utils.parsers.textContent(d.childNodes[c]);break;case"thumbnail":f.image=a.utils.strings.xmlAttribute(d.childNodes[c],"url");break;case"credit":f.author=a.utils.parsers.textContent(d.childNodes[c]);break;case"player":var b=d.childNodes[c].url;if(b.indexOf("youtube.com")>=0||b.indexOf("youtu.be")>=0){e=true;f.file=a.utils.strings.xmlAttribute(d.childNodes[c],"url")}break;case"group":a.utils.parsers.mediaparser.parseGroup(d.childNodes[c],f);break}}}return f}})(jwplayer);(function(b){b.utils.parsers.rssparser=function(){};b.utils.parsers.rssparser.parse=function(f){var c=[];for(var e=0;e<f.childNodes.length;e++){if(b.utils.parsers.localName(f.childNodes[e]).toLowerCase()=="channel"){for(var d=0;d<f.childNodes[e].childNodes.length;d++){if(b.utils.parsers.localName(f.childNodes[e].childNodes[d]).toLowerCase()=="item"){c.push(a(f.childNodes[e].childNodes[d]))}}}}return c};function a(d){var e={};for(var c=0;c<d.childNodes.length;c++){if(!b.utils.parsers.localName(d.childNodes[c])){continue}switch(b.utils.parsers.localName(d.childNodes[c]).toLowerCase()){case"enclosure":e.file=b.utils.strings.xmlAttribute(d.childNodes[c],"url");break;case"title":e.title=b.utils.parsers.textContent(d.childNodes[c]);break;case"pubdate":e.date=b.utils.parsers.textContent(d.childNodes[c]);break;case"description":e.description=b.utils.parsers.textContent(d.childNodes[c]);break;case"link":e.link=b.utils.parsers.textContent(d.childNodes[c]);break;case"category":if(e.tags){e.tags+=b.utils.parsers.textContent(d.childNodes[c])}else{e.tags=b.utils.parsers.textContent(d.childNodes[c])}break}}e=b.utils.parsers.mediaparser.parseGroup(d,e);e=b.utils.parsers.jwparser.parseEntry(d,e);return new b.html5.playlistitem(e)}})(jwplayer);(function(a){var c={};var b={};a.plugins=function(){};a.plugins.loadPlugins=function(e,d){b[e]=new a.plugins.pluginloader(new a.plugins.model(c),d);return b[e]};a.plugins.registerPlugin=function(h,f,e){var d=a.utils.getPluginName(h);if(c[d]){c[d].registerPlugin(h,f,e)}else{a.utils.log("A plugin ("+h+") was registered with the player that was not loaded. Please check your configuration.");for(var g in b){b[g].pluginFailed()}}}})(jwplayer);(function(a){a.plugins.model=function(b){this.addPlugin=function(c){var d=a.utils.getPluginName(c);if(!b[d]){b[d]=new a.plugins.plugin(c)}return b[d]}}})(jwplayer);(function(a){a.plugins.pluginmodes={FLASH:"FLASH",JAVASCRIPT:"JAVASCRIPT",HYBRID:"HYBRID"};a.plugins.plugin=function(b){var d="http://lp.longtailvideo.com";var j=a.utils.loaderstatus.NEW;var k;var h;var l;var c=new a.events.eventdispatcher();a.utils.extend(this,c);function e(){switch(a.utils.getPluginPathType(b)){case a.utils.pluginPathType.ABSOLUTE:return b;case a.utils.pluginPathType.RELATIVE:return a.utils.getAbsolutePath(b,window.location.href);case a.utils.pluginPathType.CDN:var o=a.utils.getPluginName(b);var n=a.utils.getPluginVersion(b);var m=(window.location.href.indexOf("https://")==0)?d.replace("http://","https://secure"):d;return m+"/"+a.version.split(".")[0]+"/"+o+"/"+o+(n!==""?("-"+n):"")+".js"}}function g(m){l=setTimeout(function(){j=a.utils.loaderstatus.COMPLETE;c.sendEvent(a.events.COMPLETE)},1000)}function f(m){j=a.utils.loaderstatus.ERROR;c.sendEvent(a.events.ERROR)}this.load=function(){if(j==a.utils.loaderstatus.NEW){if(b.lastIndexOf(".swf")>0){k=b;j=a.utils.loaderstatus.COMPLETE;c.sendEvent(a.events.COMPLETE);return}j=a.utils.loaderstatus.LOADING;var m=new a.utils.scriptloader(e());m.addEventListener(a.events.COMPLETE,g);m.addEventListener(a.events.ERROR,f);m.load()}};this.registerPlugin=function(o,n,m){if(l){clearTimeout(l);l=undefined}if(n&&m){k=m;h=n}else{if(typeof n=="string"){k=n}else{if(typeof n=="function"){h=n}else{if(!n&&!m){k=o}}}}j=a.utils.loaderstatus.COMPLETE;c.sendEvent(a.events.COMPLETE)};this.getStatus=function(){return j};this.getPluginName=function(){return a.utils.getPluginName(b)};this.getFlashPath=function(){if(k){switch(a.utils.getPluginPathType(k)){case a.utils.pluginPathType.ABSOLUTE:return k;case a.utils.pluginPathType.RELATIVE:if(b.lastIndexOf(".swf")>0){return a.utils.getAbsolutePath(k,window.location.href)}return a.utils.getAbsolutePath(k,e());case a.utils.pluginPathType.CDN:if(k.indexOf("-")>-1){return k+"h"}return k+"-h"}}return null};this.getJS=function(){return h};this.getPluginmode=function(){if(typeof k!="undefined"&&typeof h!="undefined"){return a.plugins.pluginmodes.HYBRID}else{if(typeof k!="undefined"){return a.plugins.pluginmodes.FLASH}else{if(typeof h!="undefined"){return a.plugins.pluginmodes.JAVASCRIPT}}}};this.getNewInstance=function(n,m,o){return new h(n,m,o)};this.getURL=function(){return b}}})(jwplayer);(function(a){a.plugins.pluginloader=function(h,e){var g={};var k=a.utils.loaderstatus.NEW;var d=false;var b=false;var c=new a.events.eventdispatcher();a.utils.extend(this,c);function f(){if(!b){b=true;k=a.utils.loaderstatus.COMPLETE;c.sendEvent(a.events.COMPLETE)}}function j(){if(!b){var m=0;for(plugin in g){var l=g[plugin].getStatus();if(l==a.utils.loaderstatus.LOADING||l==a.utils.loaderstatus.NEW){m++}}if(m==0){f()}}}this.setupPlugins=function(n,l,s){var m={length:0,plugins:{}};var p={length:0,plugins:{}};for(var o in g){var q=g[o].getPluginName();if(g[o].getFlashPath()){m.plugins[g[o].getFlashPath()]=l.plugins[o];m.plugins[g[o].getFlashPath()].pluginmode=g[o].getPluginmode();m.length++}if(g[o].getJS()){var r=document.createElement("div");r.id=n.id+"_"+q;r.style.position="absolute";r.style.zIndex=p.length+10;p.plugins[q]=g[o].getNewInstance(n,l.plugins[o],r);p.length++;if(typeof p.plugins[q].resize!="undefined"){n.onReady(s(p.plugins[q],r,true));n.onResize(s(p.plugins[q],r))}}}n.plugins=p.plugins;return m};this.load=function(){k=a.utils.loaderstatus.LOADING;d=true;for(var l in e){if(a.utils.exists(l)){g[l]=h.addPlugin(l);g[l].addEventListener(a.events.COMPLETE,j);g[l].addEventListener(a.events.ERROR,j)}}for(l in g){g[l].load()}d=false;j()};this.pluginFailed=function(){f()};this.getStatus=function(){return k}}})(jwplayer);(function(b){var a=[];b.api=function(d){this.container=d;this.id=d.id;var m={};var t={};var p={};var c=[];var g=undefined;var k=false;var h=[];var r=undefined;var o=b.utils.getOuterHTML(d);var s={};var j={};this.getBuffer=function(){return this.callInternal("jwGetBuffer")};this.getContainer=function(){return this.container};function e(v,u){return function(A,w,x,y){if(v.renderingMode=="flash"||v.renderingMode=="html5"){var z;if(w){j[A]=w;z="jwplayer('"+v.id+"').callback('"+A+"')"}else{if(!w&&j[A]){delete j[A]}}g.jwDockSetButton(A,z,x,y)}return u}}this.getPlugin=function(u){var w=this;var v={};if(u=="dock"){return b.utils.extend(v,{setButton:e(w,v),show:function(){w.callInternal("jwDockShow");return v},hide:function(){w.callInternal("jwDockHide");return v},onShow:function(x){w.componentListener("dock",b.api.events.JWPLAYER_COMPONENT_SHOW,x);return v},onHide:function(x){w.componentListener("dock",b.api.events.JWPLAYER_COMPONENT_HIDE,x);return v}})}else{if(u=="controlbar"){return b.utils.extend(v,{show:function(){w.callInternal("jwControlbarShow");return v},hide:function(){w.callInternal("jwControlbarHide");return v},onShow:function(x){w.componentListener("controlbar",b.api.events.JWPLAYER_COMPONENT_SHOW,x);return v},onHide:function(x){w.componentListener("controlbar",b.api.events.JWPLAYER_COMPONENT_HIDE,x);return v}})}else{if(u=="display"){return b.utils.extend(v,{show:function(){w.callInternal("jwDisplayShow");return v},hide:function(){w.callInternal("jwDisplayHide");return v},onShow:function(x){w.componentListener("display",b.api.events.JWPLAYER_COMPONENT_SHOW,x);return v},onHide:function(x){w.componentListener("display",b.api.events.JWPLAYER_COMPONENT_HIDE,x);return v}})}else{return this.plugins[u]}}}};this.callback=function(u){if(j[u]){return j[u]()}};this.getDuration=function(){return this.callInternal("jwGetDuration")};this.getFullscreen=function(){return this.callInternal("jwGetFullscreen")};this.getHeight=function(){return this.callInternal("jwGetHeight")};this.getLockState=function(){return this.callInternal("jwGetLockState")};this.getMeta=function(){return this.getItemMeta()};this.getMute=function(){return this.callInternal("jwGetMute")};this.getPlaylist=function(){var v=this.callInternal("jwGetPlaylist");if(this.renderingMode=="flash"){b.utils.deepReplaceKeyName(v,["__dot__","__spc__","__dsh__"],["."," ","-"])}for(var u=0;u<v.length;u++){if(!b.utils.exists(v[u].index)){v[u].index=u}}return v};this.getPlaylistItem=function(u){if(!b.utils.exists(u)){u=this.getCurrentItem()}return this.getPlaylist()[u]};this.getPosition=function(){return this.callInternal("jwGetPosition")};this.getRenderingMode=function(){return this.renderingMode};this.getState=function(){return this.callInternal("jwGetState")};this.getVolume=function(){return this.callInternal("jwGetVolume")};this.getWidth=function(){return this.callInternal("jwGetWidth")};this.setFullscreen=function(u){if(!b.utils.exists(u)){this.callInternal("jwSetFullscreen",!this.callInternal("jwGetFullscreen"))}else{this.callInternal("jwSetFullscreen",u)}return this};this.setMute=function(u){if(!b.utils.exists(u)){this.callInternal("jwSetMute",!this.callInternal("jwGetMute"))}else{this.callInternal("jwSetMute",u)}return this};this.lock=function(){return this};this.unlock=function(){return this};this.load=function(u){this.callInternal("jwLoad",u);return this};this.playlistItem=function(u){this.callInternal("jwPlaylistItem",u);return this};this.playlistPrev=function(){this.callInternal("jwPlaylistPrev");return this};this.playlistNext=function(){this.callInternal("jwPlaylistNext");return this};this.resize=function(v,u){if(this.renderingMode=="html5"){g.jwResize(v,u)}else{this.container.width=v;this.container.height=u;var w=document.getElementById(this.id+"_wrapper");if(w){w.style.width=v+"px";w.style.height=u+"px"}}return this};this.play=function(u){if(typeof u=="undefined"){u=this.getState();if(u==b.api.events.state.PLAYING||u==b.api.events.state.BUFFERING){this.callInternal("jwPause")}else{this.callInternal("jwPlay")}}else{this.callInternal("jwPlay",u)}return this};this.pause=function(u){if(typeof u=="undefined"){u=this.getState();if(u==b.api.events.state.PLAYING||u==b.api.events.state.BUFFERING){this.callInternal("jwPause")}else{this.callInternal("jwPlay")}}else{this.callInternal("jwPause",u)}return this};this.stop=function(){this.callInternal("jwStop");return this};this.seek=function(u){this.callInternal("jwSeek",u);return this};this.setVolume=function(u){this.callInternal("jwSetVolume",u);return this};this.loadInstream=function(v,u){r=new b.api.instream(this,g,v,u);return r};this.onBufferChange=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_BUFFER,u)};this.onBufferFull=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_BUFFER_FULL,u)};this.onError=function(u){return this.eventListener(b.api.events.JWPLAYER_ERROR,u)};this.onFullscreen=function(u){return this.eventListener(b.api.events.JWPLAYER_FULLSCREEN,u)};this.onMeta=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_META,u)};this.onMute=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_MUTE,u)};this.onPlaylist=function(u){return this.eventListener(b.api.events.JWPLAYER_PLAYLIST_LOADED,u)};this.onPlaylistItem=function(u){return this.eventListener(b.api.events.JWPLAYER_PLAYLIST_ITEM,u)};this.onReady=function(u){return this.eventListener(b.api.events.API_READY,u)};this.onResize=function(u){return this.eventListener(b.api.events.JWPLAYER_RESIZE,u)};this.onComplete=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_COMPLETE,u)};this.onSeek=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_SEEK,u)};this.onTime=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_TIME,u)};this.onVolume=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_VOLUME,u)};this.onBeforePlay=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_BEFOREPLAY,u)};this.onBeforeComplete=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_BEFORECOMPLETE,u)};this.onBuffer=function(u){return this.stateListener(b.api.events.state.BUFFERING,u)};this.onPause=function(u){return this.stateListener(b.api.events.state.PAUSED,u)};this.onPlay=function(u){return this.stateListener(b.api.events.state.PLAYING,u)};this.onIdle=function(u){return this.stateListener(b.api.events.state.IDLE,u)};this.remove=function(){if(!k){throw"Cannot call remove() before player is ready";return}q(this)};function q(u){h=[];if(b.utils.getOuterHTML(u.container)!=o){b.api.destroyPlayer(u.id,o)}}this.setup=function(v){if(b.embed){var u=this.id;q(this);var w=b(u);w.config=v;return new b.embed(w)}return this};this.registerPlugin=function(w,v,u){b.plugins.registerPlugin(w,v,u)};this.setPlayer=function(u,v){g=u;this.renderingMode=v};this.stateListener=function(u,v){if(!t[u]){t[u]=[];this.eventListener(b.api.events.JWPLAYER_PLAYER_STATE,f(u))}t[u].push(v);return this};this.detachMedia=function(){if(this.renderingMode=="html5"){return this.callInternal("jwDetachMedia")}};this.attachMedia=function(){if(this.renderingMode=="html5"){return this.callInternal("jwAttachMedia")}};function f(u){return function(w){var v=w.newstate,y=w.oldstate;if(v==u){var x=t[v];if(x){for(var z=0;z<x.length;z++){if(typeof x[z]=="function"){x[z].call(this,{oldstate:y,newstate:v})}}}}}}this.componentListener=function(u,v,w){if(!p[u]){p[u]={}}if(!p[u][v]){p[u][v]=[];this.eventListener(v,l(u,v))}p[u][v].push(w);return this};function l(u,v){return function(x){if(u==x.component){var w=p[u][v];if(w){for(var y=0;y<w.length;y++){if(typeof w[y]=="function"){w[y].call(this,x)}}}}}}this.addInternalListener=function(u,v){try{u.jwAddEventListener(v,'function(dat) { jwplayer("'+this.id+'").dispatchEvent("'+v+'", dat); }')}catch(w){b.utils.log("Could not add internal listener")}};this.eventListener=function(u,v){if(!m[u]){m[u]=[];if(g&&k){this.addInternalListener(g,u)}}m[u].push(v);return this};this.dispatchEvent=function(w){if(m[w]){var v=_utils.translateEventResponse(w,arguments[1]);for(var u=0;u<m[w].length;u++){if(typeof m[w][u]=="function"){m[w][u].call(this,v)}}}};this.dispatchInstreamEvent=function(u){if(r){r.dispatchEvent(u,arguments)}};this.callInternal=function(){if(k){var w=arguments[0],u=[];for(var v=1;v<arguments.length;v++){u.push(arguments[v])}if(typeof g!="undefined"&&typeof g[w]=="function"){if(u.length==2){return(g[w])(u[0],u[1])}else{if(u.length==1){return(g[w])(u[0])}else{return(g[w])()}}}return null}else{h.push(arguments)}};this.playerReady=function(v){k=true;if(!g){this.setPlayer(document.getElementById(v.id))}this.container=document.getElementById(this.id);for(var u in m){this.addInternalListener(g,u)}this.eventListener(b.api.events.JWPLAYER_PLAYLIST_ITEM,function(w){s={}});this.eventListener(b.api.events.JWPLAYER_MEDIA_META,function(w){b.utils.extend(s,w.metadata)});this.dispatchEvent(b.api.events.API_READY);while(h.length>0){this.callInternal.apply(this,h.shift())}};this.getItemMeta=function(){return s};this.getCurrentItem=function(){return this.callInternal("jwGetPlaylistIndex")};function n(w,y,x){var u=[];if(!y){y=0}if(!x){x=w.length-1}for(var v=y;v<=x;v++){u.push(w[v])}return u}return this};b.api.selectPlayer=function(d){var c;if(!b.utils.exists(d)){d=0}if(d.nodeType){c=d}else{if(typeof d=="string"){c=document.getElementById(d)}}if(c){var e=b.api.playerById(c.id);if(e){return e}else{return b.api.addPlayer(new b.api(c))}}else{if(typeof d=="number"){return b.getPlayers()[d]}}return null};b.api.events={API_READY:"jwplayerAPIReady",JWPLAYER_READY:"jwplayerReady",JWPLAYER_FULLSCREEN:"jwplayerFullscreen",JWPLAYER_RESIZE:"jwplayerResize",JWPLAYER_ERROR:"jwplayerError",JWPLAYER_MEDIA_BEFOREPLAY:"jwplayerMediaBeforePlay",JWPLAYER_MEDIA_BEFORECOMPLETE:"jwplayerMediaBeforeComplete",JWPLAYER_COMPONENT_SHOW:"jwplayerComponentShow",JWPLAYER_COMPONENT_HIDE:"jwplayerComponentHide",JWPLAYER_MEDIA_BUFFER:"jwplayerMediaBuffer",JWPLAYER_MEDIA_BUFFER_FULL:"jwplayerMediaBufferFull",JWPLAYER_MEDIA_ERROR:"jwplayerMediaError",JWPLAYER_MEDIA_LOADED:"jwplayerMediaLoaded",JWPLAYER_MEDIA_COMPLETE:"jwplayerMediaComplete",JWPLAYER_MEDIA_SEEK:"jwplayerMediaSeek",JWPLAYER_MEDIA_TIME:"jwplayerMediaTime",JWPLAYER_MEDIA_VOLUME:"jwplayerMediaVolume",JWPLAYER_MEDIA_META:"jwplayerMediaMeta",JWPLAYER_MEDIA_MUTE:"jwplayerMediaMute",JWPLAYER_PLAYER_STATE:"jwplayerPlayerState",JWPLAYER_PLAYLIST_LOADED:"jwplayerPlaylistLoaded",JWPLAYER_PLAYLIST_ITEM:"jwplayerPlaylistItem",JWPLAYER_INSTREAM_CLICK:"jwplayerInstreamClicked",JWPLAYER_INSTREAM_DESTROYED:"jwplayerInstreamDestroyed"};b.api.events.state={BUFFERING:"BUFFERING",IDLE:"IDLE",PAUSED:"PAUSED",PLAYING:"PLAYING"};b.api.playerById=function(d){for(var c=0;c<a.length;c++){if(a[c].id==d){return a[c]}}return null};b.api.addPlayer=function(c){for(var d=0;d<a.length;d++){if(a[d]==c){return c}}a.push(c);return c};b.api.destroyPlayer=function(h,d){var g=-1;for(var l=0;l<a.length;l++){if(a[l].id==h){g=l;continue}}if(g>=0){try{a[g].callInternal("jwDestroy")}catch(k){}var c=document.getElementById(a[g].id);if(document.getElementById(a[g].id+"_wrapper")){c=document.getElementById(a[g].id+"_wrapper")}if(c){if(d){b.utils.setOuterHTML(c,d)}else{var j=document.createElement("div");var f=c.id;if(c.id.indexOf("_wrapper")==c.id.length-8){newID=c.id.substring(0,c.id.length-8)}j.setAttribute("id",f);c.parentNode.replaceChild(j,c)}}a.splice(g,1)}return null};b.getPlayers=function(){return a.slice(0)}})(jwplayer);var _userPlayerReady=(typeof playerReady=="function")?playerReady:undefined;playerReady=function(b){var a=jwplayer.api.playerById(b.id);if(a){a.playerReady(b)}else{jwplayer.api.selectPlayer(b.id).playerReady(b)}if(_userPlayerReady){_userPlayerReady.call(this,b)}};(function(a){a.api.instream=function(c,j,n,q){var h=c;var b=j;var g=n;var k=q;var e={};var p={};function f(){h.callInternal("jwLoadInstream",n,q)}function m(r,s){b.jwInstreamAddEventListener(s,'function(dat) { jwplayer("'+h.id+'").dispatchInstreamEvent("'+s+'", dat); }')}function d(r,s){if(!e[r]){e[r]=[];m(b,r)}e[r].push(s);return this}function o(r,s){if(!p[r]){p[r]=[];d(a.api.events.JWPLAYER_PLAYER_STATE,l(r))}p[r].push(s);return this}function l(r){return function(t){var s=t.newstate,v=t.oldstate;if(s==r){var u=p[s];if(u){for(var w=0;w<u.length;w++){if(typeof u[w]=="function"){u[w].call(this,{oldstate:v,newstate:s,type:t.type})}}}}}}this.dispatchEvent=function(u,t){if(e[u]){var s=_utils.translateEventResponse(u,t[1]);for(var r=0;r<e[u].length;r++){if(typeof e[u][r]=="function"){e[u][r].call(this,s)}}}};this.onError=function(r){return d(a.api.events.JWPLAYER_ERROR,r)};this.onFullscreen=function(r){return d(a.api.events.JWPLAYER_FULLSCREEN,r)};this.onMeta=function(r){return d(a.api.events.JWPLAYER_MEDIA_META,r)};this.onMute=function(r){return d(a.api.events.JWPLAYER_MEDIA_MUTE,r)};this.onComplete=function(r){return d(a.api.events.JWPLAYER_MEDIA_COMPLETE,r)};this.onSeek=function(r){return d(a.api.events.JWPLAYER_MEDIA_SEEK,r)};this.onTime=function(r){return d(a.api.events.JWPLAYER_MEDIA_TIME,r)};this.onVolume=function(r){return d(a.api.events.JWPLAYER_MEDIA_VOLUME,r)};this.onBuffer=function(r){return o(a.api.events.state.BUFFERING,r)};this.onPause=function(r){return o(a.api.events.state.PAUSED,r)};this.onPlay=function(r){return o(a.api.events.state.PLAYING,r)};this.onIdle=function(r){return o(a.api.events.state.IDLE,r)};this.onInstreamClick=function(r){return d(a.api.events.JWPLAYER_INSTREAM_CLICK,r)};this.onInstreamDestroyed=function(r){return d(a.api.events.JWPLAYER_INSTREAM_DESTROYED,r)};this.play=function(r){b.jwInstreamPlay(r)};this.pause=function(r){b.jwInstreamPause(r)};this.seek=function(r){b.jwInstreamSeek(r)};this.destroy=function(){b.jwInstreamDestroy()};this.getState=function(){return b.jwInstreamGetState()};this.getDuration=function(){return b.jwInstreamGetDuration()};this.getPosition=function(){return b.jwInstreamGetPosition()};f()}})(jwplayer);(function(a){var c=a.utils;a.embed=function(h){var k={width:400,height:300,components:{controlbar:{position:"over"}}};var g=c.mediaparser.parseMedia(h.container);var f=new a.embed.config(c.extend(k,g,h.config),this);var j=a.plugins.loadPlugins(h.id,f.plugins);function d(n,m){for(var l in m){if(typeof n[l]=="function"){(n[l]).call(n,m[l])}}}function e(){if(j.getStatus()==c.loaderstatus.COMPLETE){for(var n=0;n<f.modes.length;n++){if(f.modes[n].type&&a.embed[f.modes[n].type]){var p=f.modes[n].config;var t=f;if(p){t=c.extend(c.clone(f),p);var s=["file","levels","playlist"];for(var m=0;m<s.length;m++){var q=s[m];if(c.exists(p[q])){for(var l=0;l<s.length;l++){if(l!=m){var o=s[l];if(c.exists(t[o])&&!c.exists(p[o])){delete t[o]}}}}}}var r=new a.embed[f.modes[n].type](document.getElementById(h.id),f.modes[n],t,j,h);if(r.supportsConfig()){r.embed();d(h,f.events);return h}}}c.log("No suitable players found");new a.embed.logo(c.extend({hide:true},f.components.logo),"none",h.id)}}j.addEventListener(a.events.COMPLETE,e);j.addEventListener(a.events.ERROR,e);j.load();return h};function b(){if(!document.body){return setTimeout(b,15)}var d=c.selectors.getElementsByTagAndClass("video","jwplayer");for(var e=0;e<d.length;e++){var f=d[e];if(f.id==""){f.id="jwplayer_"+Math.round(Math.random()*100000)}a(f.id).setup({})}}b()})(jwplayer);(function(e){var k=e.utils;function h(m){var l=[{type:"flash",src:m?m:"/jwplayer/player.swf"},{type:"html5"},{type:"download"}];if(k.isAndroid()){l[0]=l.splice(1,1,l[0])[0]}return l}var a={players:"modes",autoplay:"autostart"};function b(o){var n=o.toLowerCase();var m=["left","right","top","bottom"];for(var l=0;l<m.length;l++){if(n==m[l]){return true}}return false}function c(m){var l=false;l=(m instanceof Array)||(typeof m=="object"&&!m.position&&!m.size);return l}function j(l){if(typeof l=="string"){if(parseInt(l).toString()==l||l.toLowerCase().indexOf("px")>-1){return parseInt(l)}}return l}var g=["playlist","dock","controlbar","logo","display"];function f(l){var o={};switch(k.typeOf(l.plugins)){case"object":for(var n in l.plugins){o[k.getPluginName(n)]=n}break;case"string":var p=l.plugins.split(",");for(var m=0;m<p.length;m++){o[k.getPluginName(p[m])]=p[m]}break}return o}function d(p,o,n,l){if(k.typeOf(p[o])!="object"){p[o]={}}var m=p[o][n];if(k.typeOf(m)!="object"){p[o][n]=m={}}if(l){if(o=="plugins"){var q=k.getPluginName(n);m[l]=p[q+"."+l];delete p[q+"."+l]}else{m[l]=p[n+"."+l];delete p[n+"."+l]}}}e.embed.deserialize=function(m){var n=f(m);for(var l in n){d(m,"plugins",n[l])}for(var q in m){if(q.indexOf(".")>-1){var p=q.split(".");var o=p[0];var q=p[1];if(k.isInArray(g,o)){d(m,"components",o,q)}else{if(n[o]){d(m,"plugins",n[o],q)}}}}return m};e.embed.config=function(l,v){var u=k.extend({},l);var s;if(c(u.playlist)){s=u.playlist;delete u.playlist}u=e.embed.deserialize(u);u.height=j(u.height);u.width=j(u.width);if(typeof u.plugins=="string"){var m=u.plugins.split(",");if(typeof u.plugins!="object"){u.plugins={}}for(var q=0;q<m.length;q++){var r=k.getPluginName(m[q]);if(typeof u[r]=="object"){u.plugins[m[q]]=u[r];delete u[r]}else{u.plugins[m[q]]={}}}}for(var t=0;t<g.length;t++){var p=g[t];if(k.exists(u[p])){if(typeof u[p]!="object"){if(!u.components[p]){u.components[p]={}}if(p=="logo"){u.components[p].file=u[p]}else{u.components[p].position=u[p]}delete u[p]}else{if(!u.components[p]){u.components[p]={}}k.extend(u.components[p],u[p]);delete u[p]}}if(typeof u[p+"size"]!="undefined"){if(!u.components[p]){u.components[p]={}}u.components[p].size=u[p+"size"];delete u[p+"size"]}}if(typeof u.icons!="undefined"){if(!u.components.display){u.components.display={}}u.components.display.icons=u.icons;delete u.icons}for(var o in a){if(u[o]){if(!u[a[o]]){u[a[o]]=u[o]}delete u[o]}}var n;if(u.flashplayer&&!u.modes){n=h(u.flashplayer);delete u.flashplayer}else{if(u.modes){if(typeof u.modes=="string"){n=h(u.modes)}else{if(u.modes instanceof Array){n=u.modes}else{if(typeof u.modes=="object"&&u.modes.type){n=[u.modes]}}}delete u.modes}else{n=h()}}u.modes=n;if(s){u.playlist=s}return u}})(jwplayer);(function(a){a.embed.download=function(c,g,b,d,f){this.embed=function(){var k=a.utils.extend({},b);var q={};var j=b.width?b.width:480;if(typeof j!="number"){j=parseInt(j,10)}var m=b.height?b.height:320;if(typeof m!="number"){m=parseInt(m,10)}var u,o,n;var s={};if(b.playlist&&b.playlist.length){s.file=b.playlist[0].file;o=b.playlist[0].image;s.levels=b.playlist[0].levels}else{s.file=b.file;o=b.image;s.levels=b.levels}if(s.file){u=s.file}else{if(s.levels&&s.levels.length){u=s.levels[0].file}}n=u?"pointer":"auto";var l={display:{style:{cursor:n,width:j,height:m,backgroundColor:"#000",position:"relative",textDecoration:"none",border:"none",display:"block"}},display_icon:{style:{cursor:n,position:"absolute",display:u?"block":"none",top:0,left:0,border:0,margin:0,padding:0,zIndex:3,width:50,height:50,backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAALdJREFUeNrs18ENgjAYhmFouDOCcQJGcARHgE10BDcgTOIosAGwQOuPwaQeuFRi2p/3Sb6EC5L3QCxZBgAAAOCorLW1zMn65TrlkH4NcV7QNcUQt7Gn7KIhxA+qNIR81spOGkL8oFJDyLJRdosqKDDkK+iX5+d7huzwM40xptMQMkjIOeRGo+VkEVvIPfTGIpKASfYIfT9iCHkHrBEzf4gcUQ56aEzuGK/mw0rHpy4AAACAf3kJMACBxjAQNRckhwAAAABJRU5ErkJggg==)"}},display_iconBackground:{style:{cursor:n,position:"absolute",display:u?"block":"none",top:((m-50)/2),left:((j-50)/2),border:0,width:50,height:50,margin:0,padding:0,zIndex:2,backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEpJREFUeNrszwENADAIA7DhX8ENoBMZ5KR10EryckCJiIiIiIiIiIiIiIiIiIiIiIh8GmkRERERERERERERERERERERERGRHSPAAPlXH1phYpYaAAAAAElFTkSuQmCC)"}},display_image:{style:{width:j,height:m,display:o?"block":"none",position:"absolute",cursor:n,left:0,top:0,margin:0,padding:0,textDecoration:"none",zIndex:1,border:"none"}}};var h=function(v,x,y){var w=document.createElement(v);if(y){w.id=y}else{w.id=c.id+"_jwplayer_"+x}a.utils.css(w,l[x].style);return w};q.display=h("a","display",c.id);if(u){q.display.setAttribute("href",a.utils.getAbsolutePath(u))}q.display_image=h("img","display_image");q.display_image.setAttribute("alt","Click to download...");if(o){q.display_image.setAttribute("src",a.utils.getAbsolutePath(o))}if(true){q.display_icon=h("div","display_icon");q.display_iconBackground=h("div","display_iconBackground");q.display.appendChild(q.display_image);q.display_iconBackground.appendChild(q.display_icon);q.display.appendChild(q.display_iconBackground)}_css=a.utils.css;_hide=function(v){_css(v,{display:"none"})};function r(v){_imageWidth=q.display_image.naturalWidth;_imageHeight=q.display_image.naturalHeight;t()}function t(){a.utils.stretch(a.utils.stretching.UNIFORM,q.display_image,j,m,_imageWidth,_imageHeight)}q.display_image.onerror=function(v){_hide(q.display_image)};q.display_image.onload=r;c.parentNode.replaceChild(q.display,c);var p=(b.plugins&&b.plugins.logo)?b.plugins.logo:{};q.display.appendChild(new a.embed.logo(b.components.logo,"download",c.id));f.container=document.getElementById(f.id);f.setPlayer(q.display,"download")};this.supportsConfig=function(){if(b){var j=a.utils.getFirstPlaylistItemFromConfig(b);if(typeof j.file=="undefined"&&typeof j.levels=="undefined"){return true}else{if(j.file){return e(j.file,j.provider,j.playlistfile)}else{if(j.levels&&j.levels.length){for(var h=0;h<j.levels.length;h++){if(j.levels[h].file&&e(j.levels[h].file,j.provider,j.playlistfile)){return true}}}}}}else{return true}};function e(j,l,h){if(h){return false}var k=["image","sound","youtube","http"];if(l&&(k.toString().indexOf(l)>-1)){return true}if(!l||(l&&l=="video")){var m=a.utils.extension(j);if(m&&a.utils.extensionmap[m]){return true}}return false}}})(jwplayer);(function(a){a.embed.flash=function(f,g,l,e,j){function m(o,n,p){var q=document.createElement("param");q.setAttribute("name",n);q.setAttribute("value",p);o.appendChild(q)}function k(o,p,n){return function(q){if(n){document.getElementById(j.id+"_wrapper").appendChild(p)}var s=document.getElementById(j.id).getPluginConfig("display");o.resize(s.width,s.height);var r={left:s.x,top:s.y};a.utils.css(p,r)}}function d(p){if(!p){return{}}var r={};for(var o in p){var n=p[o];for(var q in n){r[o+"."+q]=n[q]}}return r}function h(q,p){if(q[p]){var s=q[p];for(var o in s){var n=s[o];if(typeof n=="string"){if(!q[o]){q[o]=n}}else{for(var r in n){if(!q[o+"."+r]){q[o+"."+r]=n[r]}}}}delete q[p]}}function b(q){if(!q){return{}}var t={},s=[];for(var n in q){var p=a.utils.getPluginName(n);var o=q[n];s.push(n);for(var r in o){t[p+"."+r]=o[r]}}t.plugins=s.join(",");return t}function c(p){var n=p.netstreambasepath?"":"netstreambasepath="+encodeURIComponent(window.location.href.split("#")[0])+"&";for(var o in p){if(typeof(p[o])=="object"){n+=o+"="+encodeURIComponent("[[JSON]]"+a.utils.strings.jsonToString(p[o]))+"&"}else{n+=o+"="+encodeURIComponent(p[o])+"&"}}return n.substring(0,n.length-1)}this.embed=function(){l.id=j.id;var A;var r=a.utils.extend({},l);var o=r.width;var y=r.height;if(f.id+"_wrapper"==f.parentNode.id){A=document.getElementById(f.id+"_wrapper")}else{A=document.createElement("div");A.id=f.id+"_wrapper";a.utils.wrap(f,A);a.utils.css(A,{position:"relative",width:o,height:y})}var p=e.setupPlugins(j,r,k);if(p.length>0){a.utils.extend(r,b(p.plugins))}else{delete r.plugins}var s=["height","width","modes","events"];for(var v=0;v<s.length;v++){delete r[s[v]]}var q="opaque";if(r.wmode){q=r.wmode}h(r,"components");h(r,"providers");if(typeof r["dock.position"]!="undefined"){if(r["dock.position"].toString().toLowerCase()=="false"){r.dock=r["dock.position"];delete r["dock.position"]}}var x=a.utils.getCookies();for(var n in x){if(typeof(r[n])=="undefined"){r[n]=x[n]}}var z="#000000";var u;if(a.utils.isIE()){var w='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" bgcolor="'+z+'" width="100%" height="100%" id="'+f.id+'" name="'+f.id+'" tabindex=0"">';w+='<param name="movie" value="'+g.src+'">';w+='<param name="allowfullscreen" value="true">';w+='<param name="allowscriptaccess" value="always">';w+='<param name="seamlesstabbing" value="true">';w+='<param name="wmode" value="'+q+'">';w+='<param name="flashvars" value="'+c(r)+'">';w+="</object>";a.utils.setOuterHTML(f,w);u=document.getElementById(f.id)}else{var t=document.createElement("object");t.setAttribute("type","application/x-shockwave-flash");t.setAttribute("data",g.src);t.setAttribute("width","100%");t.setAttribute("height","100%");t.setAttribute("bgcolor","#000000");t.setAttribute("id",f.id);t.setAttribute("name",f.id);t.setAttribute("tabindex",0);m(t,"allowfullscreen","true");m(t,"allowscriptaccess","always");m(t,"seamlesstabbing","true");m(t,"wmode",q);m(t,"flashvars",c(r));f.parentNode.replaceChild(t,f);u=t}j.container=u;j.setPlayer(u,"flash")};this.supportsConfig=function(){if(a.utils.hasFlash()){if(l){var o=a.utils.getFirstPlaylistItemFromConfig(l);if(typeof o.file=="undefined"&&typeof o.levels=="undefined"){return true}else{if(o.file){return flashCanPlay(o.file,o.provider)}else{if(o.levels&&o.levels.length){for(var n=0;n<o.levels.length;n++){if(o.levels[n].file&&flashCanPlay(o.levels[n].file,o.provider)){return true}}}}}}else{return true}}return false};flashCanPlay=function(n,p){var o=["video","http","sound","image"];if(p&&(o.toString().indexOf(p)<0)){return true}var q=a.utils.extension(n);if(!q){return true}if(a.utils.exists(a.utils.extensionmap[q])&&!a.utils.exists(a.utils.extensionmap[q].flash)){return false}return true}}})(jwplayer);(function(a){a.embed.html5=function(c,g,b,d,f){function e(j,k,h){return function(l){var m=document.getElementById(c.id+"_displayarea");if(h){m.appendChild(k)}j.resize(m.clientWidth,m.clientHeight);k.left=m.style.left;k.top=m.style.top}}this.embed=function(){if(a.html5){d.setupPlugins(f,b,e);c.innerHTML="";var j=a.utils.extend({screencolor:"0x000000"},b);var h=["plugins","modes","events"];for(var k=0;k<h.length;k++){delete j[h[k]]}if(j.levels&&!j.sources){j.sources=b.levels}if(j.skin&&j.skin.toLowerCase().indexOf(".zip")>0){j.skin=j.skin.replace(/\.zip/i,".xml")}var l=new (a.html5(c)).setup(j);f.container=document.getElementById(f.id);f.setPlayer(l,"html5")}else{return null}};this.supportsConfig=function(){if(!!a.vid.canPlayType){if(b){var j=a.utils.getFirstPlaylistItemFromConfig(b);if(typeof j.file=="undefined"&&typeof j.levels=="undefined"){return true}else{if(j.file){return html5CanPlay(a.vid,j.file,j.provider,j.playlistfile)}else{if(j.levels&&j.levels.length){for(var h=0;h<j.levels.length;h++){if(j.levels[h].file&&html5CanPlay(a.vid,j.levels[h].file,j.provider,j.playlistfile)){return true}}}}}}else{return true}}return false};html5CanPlay=function(k,j,l,h){if(h){return false}if(l&&l=="youtube"){return true}if(l&&l!="video"&&l!="http"&&l!="sound"){return false}if(navigator.userAgent.match(/BlackBerry/i)!==null){return false}var m=a.utils.extension(j);if(!a.utils.exists(m)||!a.utils.exists(a.utils.extensionmap[m])){return true}if(!a.utils.exists(a.utils.extensionmap[m].html5)){return false}if(a.utils.isLegacyAndroid()&&m.match(/m4v|mp4/)){return true}return browserCanPlay(k,a.utils.extensionmap[m].html5)};browserCanPlay=function(j,h){if(!h){return true}if(j.canPlayType(h)){return true}else{if(h=="audio/mp3"&&navigator.userAgent.match(/safari/i)){return j.canPlayType("audio/mpeg")}else{return false}}}}})(jwplayer);(function(a){a.embed.logo=function(m,l,d){var j={prefix:"http://l.longtailvideo.com/"+l+"/",file:"",link:"",linktarget:"_top",margin:8,out:0.5,over:1,timeout:5,hide:false,position:"bottom-left"};_css=a.utils.css;var b;var h;k();function k(){o();c();f()}function o(){if(j.prefix){var q=a.version.split(/\W/).splice(0,2).join("/");if(j.prefix.indexOf(q)<0){j.prefix+=q+"/"}}h=a.utils.extend({},j,m)}function p(){var s={border:"none",textDecoration:"none",position:"absolute",cursor:"pointer",zIndex:10};s.display=h.hide?"none":"block";var r=h.position.toLowerCase().split("-");for(var q in r){s[r[q]]=h.margin}return s}function c(){b=document.createElement("img");b.id=d+"_jwplayer_logo";b.style.display="none";b.onload=function(q){_css(b,p());e()};if(!h.file){return}if(h.file.indexOf("http://")===0){b.src=h.file}else{b.src=h.prefix+h.file}}if(!h.file){return}function f(){if(h.link){b.onmouseover=g;b.onmouseout=e;b.onclick=n}else{this.mouseEnabled=false}}function n(q){if(typeof q!="undefined"){q.preventDefault();q.stopPropagation()}if(h.link){window.open(h.link,h.linktarget)}return}function e(q){if(h.link){b.style.opacity=h.out}return}function g(q){if(h.hide){b.style.opacity=h.over}return}return b}})(jwplayer);(function(a){a.html5=function(b){var c=b;this.setup=function(d){a.utils.extend(this,new a.html5.api(c,d));return this};return this}})(jwplayer);(function(a){var d=a.utils;var b=d.css;var c=d.isIOS();a.html5.view=function(n,H,h){var m=n;var y=H;var j=h;var R;var g;var t;var o;var F;var P;var O;var E=false;var x=false;var A,N;var f,S,u;function L(){R=document.createElement("div");R.id=y.id;R.className=y.className;_videowrapper=document.createElement("div");_videowrapper.id=R.id+"_video_wrapper";y.id=R.id+"_video";b(R,{position:"relative",height:j.height,width:j.width,padding:0,backgroundColor:U(),zIndex:0});function U(){if(m.skin.getComponentSettings("display")&&m.skin.getComponentSettings("display").backgroundcolor){return m.skin.getComponentSettings("display").backgroundcolor}return parseInt("000000",16)}b(y,{width:"100%",height:"100%",top:0,left:0,zIndex:1,margin:"auto",display:"block"});b(_videowrapper,{overflow:"hidden",position:"absolute",top:0,left:0,bottom:0,right:0});d.wrap(y,R);d.wrap(y,_videowrapper);o=document.createElement("div");o.id=R.id+"_displayarea";R.appendChild(o);_instreamArea=document.createElement("div");_instreamArea.id=R.id+"_instreamarea";b(_instreamArea,{overflow:"hidden",position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:100,background:"000000",display:"none"});R.appendChild(_instreamArea)}function K(){for(var U=0;U<j.plugins.order.length;U++){var V=j.plugins.order[U];if(d.exists(j.plugins.object[V].getDisplayElement)){j.plugins.object[V].height=d.parseDimension(j.plugins.object[V].getDisplayElement().style.height);j.plugins.object[V].width=d.parseDimension(j.plugins.object[V].getDisplayElement().style.width);j.plugins.config[V].currentPosition=j.plugins.config[V].position}}v()}function s(U){x=j.fullscreen}function p(U){if(S){return}switch(U.newstate){case a.api.events.state.PLAYING:if(j.getMedia()&&j.getMedia().hasChrome()){o.style.display="none"}break;default:o.style.display="block";break}l()}function v(V){var X=j.getMedia()?j.getMedia().getDisplayElement():null;if(d.exists(X)){if(O!=X){if(O&&O.parentNode){O.parentNode.replaceChild(X,O)}O=X}for(var U=0;U<j.plugins.order.length;U++){var W=j.plugins.order[U];if(d.exists(j.plugins.object[W].getDisplayElement)){j.plugins.config[W].currentPosition=j.plugins.config[W].position}}}G(j.width,j.height)}this.setup=function(){if(j&&j.getMedia()){y=j.getMedia().getDisplayElement()}L();K();m.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,p);m.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_LOADED,v);m.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_BEFOREPLAY,s);m.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_META,function(V){l()});var U;if(d.exists(window.onresize)){U=window.onresize}window.onresize=function(V){if(d.exists(U)){try{U(V)}catch(X){}}if(m.jwGetFullscreen()){if(!B()){var W=d.getBoundingClientRect(document.body);j.width=Math.abs(W.left)+Math.abs(W.right);j.height=window.innerHeight;G(j.width,j.height)}}else{G(j.width,j.height)}}};function M(U){switch(U.keyCode){case 27:if(m.jwGetFullscreen()){m.jwSetFullscreen(false)}break;case 32:if(m.jwGetState()!=a.api.events.state.IDLE&&m.jwGetState()!=a.api.events.state.PAUSED){m.jwPause()}else{m.jwPlay()}break}}function G(U,ad){if(R.style.display=="none"){return}var X=[].concat(j.plugins.order);X.reverse();F=X.length+2;if(x&&B()){try{if(j.fullscreen&&!j.getMedia().getDisplayElement().webkitDisplayingFullscreen){j.fullscreen=false}}catch(aa){}}if(!j.fullscreen){g=U;t=ad;if(typeof U=="string"&&U.indexOf("%")>0){g=d.getElementWidth(d.parentNode(R))*parseInt(U.replace("%"),"")/100}else{g=U}if(typeof ad=="string"&&ad.indexOf("%")>0){t=d.getElementHeight(d.parentNode(R))*parseInt(ad.replace("%"),"")/100}else{t=ad}var Y={top:0,bottom:0,left:0,right:0,width:g,height:t,position:"absolute"};b(o,Y);var ae={};var ab;try{ab=j.plugins.object.display.getDisplayElement()}catch(aa){}if(ab){ae.width=d.parseDimension(ab.style.width);ae.height=d.parseDimension(ab.style.height)}var ac=d.extend({},Y,ae,{zIndex:_instreamArea.style.zIndex,display:_instreamArea.style.display});b(_instreamArea,ac);b(R,{height:t,width:g});var Z=w(I,X);if(Z.length>0){F+=Z.length;var W=Z.indexOf("playlist"),V=Z.indexOf("controlbar");if(W>=0&&V>=0){Z[W]=Z.splice(V,1,Z[W])[0]}w(q,Z,true)}A=d.getElementWidth(o);N=d.getElementHeight(o)}else{if(!B()&&!c){w(e,X,true)}}l()}var r;function w(ab,X,Y){r=0;var Z=[];for(var W=0;W<X.length;W++){var aa=X[W];if(d.exists(j.plugins.object[aa].getDisplayElement)){if(j.plugins.config[aa].currentPosition!=a.html5.view.positions.NONE){var U=ab(aa,F--);if(!U){Z.push(aa)}else{var V=U.width;var ac=U.height;if(Y){delete U.width;delete U.height}b(j.plugins.object[aa].getDisplayElement(),U);j.plugins.object[aa].resize(V,ac)}}else{b(j.plugins.object[aa].getDisplayElement(),{display:"none"})}}}return Z}function I(V,W){if(d.exists(j.plugins.object[V].getDisplayElement)){if(j.plugins.config[V].position&&T(j.plugins.config[V].position)){if(!d.exists(j.plugins.object[V].getDisplayElement().parentNode)){R.appendChild(j.plugins.object[V].getDisplayElement())}var U=z(V);U.zIndex=W;return U}}return false}function q(U,V){if(!d.exists(j.plugins.object[U].getDisplayElement().parentNode)){o.appendChild(j.plugins.object[U].getDisplayElement())}return{position:"absolute",width:(d.getElementWidth(o)-d.parseDimension(o.style.right)),height:(d.getElementHeight(o)-d.parseDimension(o.style.bottom)),zIndex:V}}function e(U,V){return{position:"fixed",width:j.width,height:j.height,zIndex:V}}var l=this.resizeMedia=function(){o.style.position="absolute";var W=j.getMedia()?j.getMedia().getDisplayElement():u;if(!W){return}if(W&&W.tagName.toLowerCase()=="video"){if(!W.videoWidth||!W.videoHeight){W.style.width=o.style.width;W.style.height=o.style.height;return}W.style.position="absolute";d.fadeTo(W,1,0.25);if(W.parentNode){W.parentNode.style.left=o.style.left;W.parentNode.style.top=o.style.top}if(j.fullscreen&&m.jwGetStretching()==a.utils.stretching.EXACTFIT&&!d.isMobile()){var U=document.createElement("div");d.stretch(a.utils.stretching.UNIFORM,U,d.getElementWidth(o),d.getElementHeight(o),A,N);d.stretch(a.utils.stretching.EXACTFIT,W,d.parseDimension(U.style.width),d.parseDimension(U.style.height),W.videoWidth?W.videoWidth:400,W.videoHeight?W.videoHeight:300);b(W,{left:U.style.left,top:U.style.top})}else{if(!c){d.stretch(m.jwGetStretching(),W,d.getElementWidth(o),d.getElementHeight(o),W.videoWidth?W.videoWidth:400,W.videoHeight?W.videoHeight:300)}}}else{var V=j.plugins.object.display.getDisplayElement();if(V){j.getMedia().resize(d.parseDimension(V.style.width),d.parseDimension(V.style.height))}else{j.getMedia().resize(d.parseDimension(o.style.width),d.parseDimension(o.style.height))}}};var z=this.getComponentPosition=function(V){var W={position:"absolute",margin:0,padding:0,top:null};var U=j.plugins.config[V].currentPosition.toLowerCase();switch(U.toUpperCase()){case a.html5.view.positions.TOP:W.top=d.parseDimension(o.style.top);W.left=d.parseDimension(o.style.left);W.width=d.getElementWidth(o)-d.parseDimension(o.style.left)-d.parseDimension(o.style.right);W.height=j.plugins.object[V].height;o.style[U]=d.parseDimension(o.style[U])+j.plugins.object[V].height+"px";o.style.height=d.getElementHeight(o)-W.height+"px";break;case a.html5.view.positions.RIGHT:W.top=d.parseDimension(o.style.top);W.right=d.parseDimension(o.style.right);W.width=j.plugins.object[V].width;W.height=d.getElementHeight(o)-d.parseDimension(o.style.top)-d.parseDimension(o.style.bottom);o.style.width=d.getElementWidth(o)-W.width+"px";break;case a.html5.view.positions.BOTTOM:W.left=d.parseDimension(o.style.left);W.width=d.getElementWidth(o)-d.parseDimension(o.style.left)-d.parseDimension(o.style.right);W.height=j.plugins.object[V].height;W.bottom=d.parseDimension(o.style.bottom+r);r+=W.height;o.style.height=d.getElementHeight(o)-W.height+"px";break;case a.html5.view.positions.LEFT:W.top=d.parseDimension(o.style.top);W.left=d.parseDimension(o.style.left);W.width=j.plugins.object[V].width;W.height=d.getElementHeight(o)-d.parseDimension(o.style.top)-d.parseDimension(o.style.bottom);o.style[U]=d.parseDimension(o.style[U])+j.plugins.object[V].width+"px";o.style.width=d.getElementWidth(o)-W.width+"px";break;default:break}return W};this.resize=G;var J,k,Q;var C=this.fullscreen=function(W){if(c){return}var Y;try{Y=j.getMedia().getDisplayElement()}catch(X){}if(W){k=j.width;Q=j.height}var aa={position:"fixed",width:"100%",height:"100%",top:0,left:0,zIndex:2147483000},Z={position:"relative",height:k,width:Q,zIndex:0};if(B()&&Y&&Y.webkitSupportsFullscreen){if(W&&!Y.webkitDisplayingFullscreen){try{b(Y,aa);d.transform(Y);J=o.style.display;o.style.display="none";Y.webkitEnterFullscreen()}catch(V){}}else{if(!W){b(Y,Z);l();if(Y.webkitDisplayingFullscreen){try{Y.webkitExitFullscreen()}catch(V){}}o.style.display=J}}E=false}else{if(W){document.onkeydown=M;clearInterval(P);var U=d.getBoundingClientRect(document.body);j.width=Math.abs(U.left)+Math.abs(U.right);j.height=window.innerHeight;b(R,aa);aa.zIndex=1;if(j.getMedia()&&j.getMedia().getDisplayElement()){b(j.getMedia().getDisplayElement(),aa)}aa.zIndex=2;b(o,aa);E=true}else{document.onkeydown="";j.width=g;j.height=t;b(R,Z);E=false}G(j.width,j.height)}};function T(U){return([a.html5.view.positions.TOP,a.html5.view.positions.RIGHT,a.html5.view.positions.BOTTOM,a.html5.view.positions.LEFT].toString().indexOf(U.toUpperCase())>-1)}function B(){if(m.jwGetState()!=a.api.events.state.IDLE&&!E&&(j.getMedia()&&j.getMedia().getDisplayElement()&&j.getMedia().getDisplayElement().webkitSupportsFullscreen)&&d.useNativeFullscreen()){return true}return false}this.setupInstream=function(U,V){d.css(_instreamArea,{display:"block",position:"absolute"});o.style.display="none";_instreamArea.appendChild(U);u=V;S=true};var D=this.destroyInstream=function(){_instreamArea.style.display="none";_instreamArea.innerHTML="";o.style.display="block";u=null;S=false;G(j.width,j.height)}};a.html5.view.positions={TOP:"TOP",RIGHT:"RIGHT",BOTTOM:"BOTTOM",LEFT:"LEFT",OVER:"OVER",NONE:"NONE"}})(jwplayer);(function(a){var b={backgroundcolor:"",margin:10,font:"Arial,sans-serif",fontsize:10,fontcolor:parseInt("000000",16),fontstyle:"normal",fontweight:"bold",buttoncolor:parseInt("ffffff",16),position:a.html5.view.positions.BOTTOM,idlehide:false,hideplaylistcontrols:false,forcenextprev:false,layout:{left:{position:"left",elements:[{name:"play",type:"button"},{name:"divider",type:"divider"},{name:"prev",type:"button"},{name:"divider",type:"divider"},{name:"next",type:"button"},{name:"divider",type:"divider"},{name:"elapsed",type:"text"}]},center:{position:"center",elements:[{name:"time",type:"slider"}]},right:{position:"right",elements:[{name:"duration",type:"text"},{name:"blank",type:"button"},{name:"divider",type:"divider"},{name:"mute",type:"button"},{name:"volume",type:"slider"},{name:"divider",type:"divider"},{name:"fullscreen",type:"button"}]}}};_utils=a.utils;_css=_utils.css;_hide=function(c){_css(c,{display:"none"})};_show=function(c){_css(c,{display:"block"})};a.html5.controlbar=function(m,Y){window.controlbar=this;var l=m;var D=_utils.extend({},b,l.skin.getComponentSettings("controlbar"),Y);if(D.position==a.html5.view.positions.NONE||typeof a.html5.view.positions[D.position]=="undefined"){return}if(_utils.mapLength(l.skin.getComponentLayout("controlbar"))>0){D.layout=l.skin.getComponentLayout("controlbar")}var ag;var R;var af;var E;var w="none";var h;var k;var ah;var g;var f;var z;var S={};var q=false;var c={};var Q=-1;var ac;var j=false;var p;var d;var V=false;var G=false;var H;var aa=new a.html5.eventdispatcher();_utils.extend(this,aa);function K(){if(!ac){ac=l.skin.getSkinElement("controlbar","background");if(!ac){ac={width:0,height:0,src:null}}}return ac}function O(){af=0;E=0;R=0;if(!q){var ap={height:K().height,backgroundColor:D.backgroundcolor};ag=document.createElement("div");ag.id=l.id+"_jwplayer_controlbar";_css(ag,ap)}var ao=(l.skin.getSkinElement("controlbar","capLeft"));var an=(l.skin.getSkinElement("controlbar","capRight"));if(ao){y("capLeft","left",false,ag)}ad("background",ag,{position:"absolute",height:K().height,left:(ao?ao.width:0),zIndex:0},"img");if(K().src){S.background.src=K().src}ad("elements",ag,{position:"relative",height:K().height,zIndex:1});if(an){y("capRight","right",false,ag)}}this.getDisplayElement=function(){return ag};this.resize=function(ap,an){T();_utils.cancelAnimation(ag);f=ap;z=an;if(G!=l.jwGetFullscreen()){G=l.jwGetFullscreen();if(!G){Z()}d=undefined}var ao=x();J({id:l.id,duration:ah,position:k});v({id:l.id,bufferPercent:g});return ao};this.show=function(){if(j){j=false;_show(ag);W()}};this.hide=function(){if(!j){j=true;_hide(ag);ae()}};function r(){var ao=["timeSlider","volumeSlider","timeSliderRail","volumeSliderRail"];for(var ap in ao){var an=ao[ap];if(typeof S[an]!="undefined"){c[an]=_utils.getBoundingClientRect(S[an])}}}var e;function Z(an){if(j){return}clearTimeout(p);if(D.position==a.html5.view.positions.OVER||l.jwGetFullscreen()){switch(l.jwGetState()){case a.api.events.state.PAUSED:case a.api.events.state.IDLE:if(ag&&ag.style.opacity<1&&(!D.idlehide||_utils.exists(an))){e=false;setTimeout(function(){if(!e){X()}},100)}if(D.idlehide){p=setTimeout(function(){A()},2000)}break;default:e=true;if(an){X()}p=setTimeout(function(){A()},2000);break}}else{X()}}function A(){if(!j){ae();if(ag.style.opacity==1){_utils.cancelAnimation(ag);_utils.fadeTo(ag,0,0.1,1,0)}}}function X(){if(!j){W();if(ag.style.opacity==0){_utils.cancelAnimation(ag);_utils.fadeTo(ag,1,0.1,0,0)}}}function I(an){return function(){if(V&&d!=an){d=an;aa.sendEvent(an,{component:"controlbar",boundingRect:P()})}}}var W=I(a.api.events.JWPLAYER_COMPONENT_SHOW);var ae=I(a.api.events.JWPLAYER_COMPONENT_HIDE);function P(){if(D.position==a.html5.view.positions.OVER||l.jwGetFullscreen()){return _utils.getDimensions(ag)}else{return{x:0,y:0,width:0,height:0}}}function ad(ar,aq,ap,an){var ao;if(!q){if(!an){an="div"}ao=document.createElement(an);S[ar]=ao;ao.id=ag.id+"_"+ar;aq.appendChild(ao)}else{ao=document.getElementById(ag.id+"_"+ar)}if(_utils.exists(ap)){_css(ao,ap)}return ao}function N(){if(l.jwGetHeight()<=40){D.layout=_utils.clone(D.layout);for(var an=0;an<D.layout.left.elements.length;an++){if(D.layout.left.elements[an].name=="fullscreen"){D.layout.left.elements.splice(an,1)}}for(an=0;an<D.layout.right.elements.length;an++){if(D.layout.right.elements[an].name=="fullscreen"){D.layout.right.elements.splice(an,1)}}o()}am(D.layout.left);am(D.layout.center);am(D.layout.right)}function am(aq,an){var ar=aq.position=="right"?"right":"left";var ap=_utils.extend([],aq.elements);if(_utils.exists(an)){ap.reverse()}var aq=ad(aq.position+"Group",S.elements,{"float":"left",styleFloat:"left",cssFloat:"left",height:"100%"});for(var ao=0;ao<ap.length;ao++){C(ap[ao],ar,aq)}}function L(){return R++}function C(ar,au,aw){var aq,ao,ap,an,ax;if(!aw){aw=S.elements}if(ar.type=="divider"){y("divider"+L(),au,true,aw,undefined,ar.width,ar.element);return}switch(ar.name){case"play":y("playButton",au,false,aw);y("pauseButton",au,true,aw);U("playButton","jwPlay");U("pauseButton","jwPause");break;case"prev":y("prevButton",au,true,aw);U("prevButton","jwPlaylistPrev");break;case"stop":y("stopButton",au,true,aw);U("stopButton","jwStop");break;case"next":y("nextButton",au,true,aw);U("nextButton","jwPlaylistNext");break;case"elapsed":y("elapsedText",au,true,aw,null,null,l.skin.getSkinElement("controlbar","elapsedBackground"));break;case"time":ao=!_utils.exists(l.skin.getSkinElement("controlbar","timeSliderCapLeft"))?0:l.skin.getSkinElement("controlbar","timeSliderCapLeft").width;ap=!_utils.exists(l.skin.getSkinElement("controlbar","timeSliderCapRight"))?0:l.skin.getSkinElement("controlbar","timeSliderCapRight").width;aq=au=="left"?ao:ap;ax={height:K().height,position:"relative","float":"left",styleFloat:"left",cssFloat:"left"};var at=ad("timeSlider",aw,ax);y("timeSliderCapLeft",au,true,at,"relative");y("timeSliderRail",au,false,at,"relative");y("timeSliderBuffer",au,false,at,"absolute");y("timeSliderProgress",au,false,at,"absolute");y("timeSliderThumb",au,false,at,"absolute");y("timeSliderCapRight",au,true,at,"relative");ab("time");break;case"fullscreen":y("fullscreenButton",au,false,aw);y("normalscreenButton",au,true,aw);U("fullscreenButton","jwSetFullscreen",true);U("normalscreenButton","jwSetFullscreen",false);break;case"volume":ao=!_utils.exists(l.skin.getSkinElement("controlbar","volumeSliderCapLeft"))?0:l.skin.getSkinElement("controlbar","volumeSliderCapLeft").width;ap=!_utils.exists(l.skin.getSkinElement("controlbar","volumeSliderCapRight"))?0:l.skin.getSkinElement("controlbar","volumeSliderCapRight").width;aq=au=="left"?ao:ap;an=l.skin.getSkinElement("controlbar","volumeSliderRail").width+ao+ap;ax={height:K().height,position:"relative",width:an,"float":"left",styleFloat:"left",cssFloat:"left"};var av=ad("volumeSlider",aw,ax);y("volumeSliderCapLeft",au,false,av,"relative");y("volumeSliderRail",au,false,av,"relative");y("volumeSliderProgress",au,false,av,"absolute");y("volumeSliderThumb",au,false,av,"absolute");y("volumeSliderCapRight",au,false,av,"relative");ab("volume");break;case"mute":y("muteButton",au,false,aw);y("unmuteButton",au,true,aw);U("muteButton","jwSetMute",true);U("unmuteButton","jwSetMute",false);break;case"duration":y("durationText",au,true,aw,null,null,l.skin.getSkinElement("controlbar","durationBackground"));break}}function y(aq,au,ao,ax,ar,an,ap){if(_utils.exists(l.skin.getSkinElement("controlbar",aq))||aq.indexOf("Text")>0||aq.indexOf("divider")===0){var at={height:"100%",position:ar?ar:"relative",display:"block","float":"left",styleFloat:"left",cssFloat:"left"};if((aq.indexOf("next")===0||aq.indexOf("prev")===0)&&(l.jwGetPlaylist().length<2||D.hideplaylistcontrols.toString()=="true")){if(D.forcenextprev.toString()!="true"){ao=false;at.display="none"}}var ay;if(aq.indexOf("Text")>0){aq.innerhtml="00:00";at.font=D.fontsize+"px/"+(K().height+1)+"px "+D.font;at.color=D.fontcolor;at.textAlign="center";at.fontWeight=D.fontweight;at.fontStyle=D.fontstyle;at.cursor="default";if(ap){at.background="url("+ap.src+") no-repeat center";at.backgroundSize="100% "+K().height+"px"}at.padding="0 5px"}else{if(aq.indexOf("divider")===0){if(an){if(!isNaN(parseInt(an))){ay=parseInt(an)}}else{if(ap){var av=l.skin.getSkinElement("controlbar",ap);if(av){at.background="url("+av.src+") repeat-x center left";ay=av.width}}else{at.background="url("+l.skin.getSkinElement("controlbar","divider").src+") repeat-x center left";ay=l.skin.getSkinElement("controlbar","divider").width}}}else{at.background="url("+l.skin.getSkinElement("controlbar",aq).src+") repeat-x center left";ay=l.skin.getSkinElement("controlbar",aq).width}}if(au=="left"){if(ao){af+=ay}}else{if(au=="right"){if(ao){E+=ay}}}if(_utils.typeOf(ax)=="undefined"){ax=S.elements}at.width=ay;if(q){_css(S[aq],at)}else{var aw=ad(aq,ax,at);if(_utils.exists(l.skin.getSkinElement("controlbar",aq+"Over"))){aw.onmouseover=function(az){aw.style.backgroundImage=["url(",l.skin.getSkinElement("controlbar",aq+"Over").src,")"].join("")};aw.onmouseout=function(az){aw.style.backgroundImage=["url(",l.skin.getSkinElement("controlbar",aq).src,")"].join("")}}if(aq.indexOf("divider")==0){aw.setAttribute("class","divider")}aw.innerHTML="&nbsp;"}}}function F(){l.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,B);l.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_ITEM,t);l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_BUFFER,v);l.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,s);l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_TIME,J);l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_MUTE,al);l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_VOLUME,n);l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_COMPLETE,M)}function B(){if(!D.hideplaylistcontrols){if(l.jwGetPlaylist().length>1||D.forcenextprev.toString()=="true"){_show(S.nextButton);_show(S.prevButton)}else{_hide(S.nextButton);_hide(S.prevButton)}x();ai()}}function t(an){ah=l.jwGetPlaylist()[an.index].duration;Q=-1;J({id:l.id,duration:ah,position:0});v({id:l.id,bufferProgress:0})}function ai(){J({id:l.id,duration:l.jwGetDuration(),position:0});v({id:l.id,bufferProgress:0});al({id:l.id,mute:l.jwGetMute()});s({id:l.id,newstate:a.api.events.state.IDLE});n({id:l.id,volume:l.jwGetVolume()})}function U(ap,aq,ao){if(q){return}if(_utils.exists(l.skin.getSkinElement("controlbar",ap))){var an=S[ap];if(_utils.exists(an)){_css(an,{cursor:"pointer"});if(aq=="fullscreen"){an.onmouseup=function(ar){ar.stopPropagation();l.jwSetFullscreen(!l.jwGetFullscreen())}}else{an.onmouseup=function(ar){ar.stopPropagation();if(_utils.exists(ao)){l[aq](ao)}else{l[aq]()}}}}}}function ab(an){if(q){return}var ao=S[an+"Slider"];_css(S.elements,{cursor:"pointer"});_css(ao,{cursor:"pointer"});ao.onmousedown=function(ap){w=an};ao.onmouseup=function(ap){ap.stopPropagation();ak(ap.pageX)};ao.onmousemove=function(ap){if(w=="time"){h=true;var aq=ap.pageX-c[an+"Slider"].left-window.pageXOffset;_css(S[w+"SliderThumb"],{left:aq})}}}function ak(ao){h=false;var an;if(w=="time"){an=ao-c.timeSliderRail.left+window.pageXOffset;var aq=an/c.timeSliderRail.width*ah;if(aq<0){aq=0}else{if(aq>ah){aq=ah-3}}if(l.jwGetState()==a.api.events.state.PAUSED||l.jwGetState()==a.api.events.state.IDLE){l.jwPlay()}l.jwSeek(aq)}else{if(w=="volume"){an=ao-c.volumeSliderRail.left-window.pageXOffset;var ap=Math.round(an/c.volumeSliderRail.width*100);if(ap<10){ap=0}else{if(ap>100){ap=100}}if(l.jwGetMute()){l.jwSetMute(false)}l.jwSetVolume(ap)}}w="none"}function v(ao){if(_utils.exists(ao.bufferPercent)){g=ao.bufferPercent}if(c.timeSliderRail){var aq=l.skin.getSkinElement("controlbar","timeSliderCapLeft");var ap=c.timeSliderRail.width;var an=isNaN(Math.round(ap*g/100))?0:Math.round(ap*g/100);_css(S.timeSliderBuffer,{width:an,left:aq?aq.width:0})}}function al(an){if(an.mute){_hide(S.muteButton);_show(S.unmuteButton);_hide(S.volumeSliderProgress)}else{_show(S.muteButton);_hide(S.unmuteButton);_show(S.volumeSliderProgress)}}function s(an){if(an.newstate==a.api.events.state.BUFFERING||an.newstate==a.api.events.state.PLAYING){_show(S.pauseButton);_hide(S.playButton)}else{_hide(S.pauseButton);_show(S.playButton)}Z();if(an.newstate==a.api.events.state.IDLE){_hide(S.timeSliderBuffer);_hide(S.timeSliderProgress);_hide(S.timeSliderThumb);J({id:l.id,duration:l.jwGetDuration(),position:0})}else{_show(S.timeSliderBuffer);if(an.newstate!=a.api.events.state.BUFFERING){_show(S.timeSliderProgress);_show(S.timeSliderThumb)}}}function M(an){v({bufferPercent:0});J(_utils.extend(an,{position:0,duration:ah}))}function J(at){if(_utils.exists(at.position)){k=at.position}var ao=false;if(_utils.exists(at.duration)&&at.duration!=ah){ah=at.duration;ao=true}var aq=(k===ah===0)?0:k/ah;var av=c.timeSliderRail;if(av){var ap=isNaN(Math.round(av.width*aq))?0:Math.round(av.width*aq);var au=l.skin.getSkinElement("controlbar","timeSliderCapLeft");var ar=ap+(au?au.width:0);if(S.timeSliderProgress){_css(S.timeSliderProgress,{width:ap,left:au?au.width:0});if(!h){if(S.timeSliderThumb){S.timeSliderThumb.style.left=ar+"px"}}}}if(S.durationText){S.durationText.innerHTML=_utils.timeFormat(ah)}if(S.elapsedText){var an=_utils.timeFormat(k);S.elapsedText.innerHTML=an;if(Q!=an.length){ao=true;Q=an.length}}if(ao){x()}}function o(){var an=S.elements.childNodes;var at,aq;for(var ap=0;ap<an.length;ap++){var ar=an[ap].childNodes;for(var ao in ar){if(isNaN(parseInt(ao,10))){continue}if(ar[ao].id.indexOf(ag.id+"_divider")===0&&aq&&aq.id.indexOf(ag.id+"_divider")===0&&ar[ao].style.backgroundImage==aq.style.backgroundImage){ar[ao].style.display="none"}else{if(ar[ao].id.indexOf(ag.id+"_divider")===0&&at&&at.style.display!="none"){ar[ao].style.display="block"}}if(ar[ao].style.display!="none"){aq=ar[ao]}at=ar[ao]}}}function aj(){if(l.jwGetFullscreen()){_show(S.normalscreenButton);_hide(S.fullscreenButton)}else{_hide(S.normalscreenButton);_show(S.fullscreenButton)}if(l.jwGetState()==a.api.events.state.BUFFERING||l.jwGetState()==a.api.events.state.PLAYING){_show(S.pauseButton);_hide(S.playButton)}else{_hide(S.pauseButton);_show(S.playButton)}if(l.jwGetMute()==true){_hide(S.muteButton);_show(S.unmuteButton);_hide(S.volumeSliderProgress)}else{_show(S.muteButton);_hide(S.unmuteButton);_show(S.volumeSliderProgress)}}function x(){o();aj();var ap={width:f};var ax={"float":"left",styleFloat:"left",cssFloat:"left"};if(D.position==a.html5.view.positions.OVER||l.jwGetFullscreen()){ap.left=D.margin;ap.width-=2*D.margin;ap.top=z-K().height-D.margin;ap.height=K().height}var ar=l.skin.getSkinElement("controlbar","capLeft");var av=l.skin.getSkinElement("controlbar","capRight");ax.width=ap.width-(ar?ar.width:0)-(av?av.width:0);var aq=_utils.getBoundingClientRect(S.leftGroup).width;var au=_utils.getBoundingClientRect(S.rightGroup).width;var at=ax.width-aq-au-1;var ao=at;var an=l.skin.getSkinElement("controlbar","timeSliderCapLeft");var aw=l.skin.getSkinElement("controlbar","timeSliderCapRight");if(_utils.exists(an)){ao-=an.width}if(_utils.exists(aw)){ao-=aw.width}S.timeSlider.style.width=at+"px";S.timeSliderRail.style.width=ao+"px";_css(ag,ap);_css(S.elements,ax);_css(S.background,ax);r();return ap}function n(at){if(_utils.exists(S.volumeSliderRail)){var ap=isNaN(at.volume/100)?1:at.volume/100;var aq=_utils.parseDimension(S.volumeSliderRail.style.width);var an=isNaN(Math.round(aq*ap))?0:Math.round(aq*ap);var au=_utils.parseDimension(S.volumeSliderRail.style.right);var ao=(!_utils.exists(l.skin.getSkinElement("controlbar","volumeSliderCapLeft")))?0:l.skin.getSkinElement("controlbar","volumeSliderCapLeft").width;_css(S.volumeSliderProgress,{width:an,left:ao});if(S.volumeSliderThumb){var ar=(an-Math.round(_utils.parseDimension(S.volumeSliderThumb.style.width)/2));ar=Math.min(Math.max(ar,0),aq-_utils.parseDimension(S.volumeSliderThumb.style.width));_css(S.volumeSliderThumb,{left:ar})}if(_utils.exists(S.volumeSliderCapLeft)){_css(S.volumeSliderCapLeft,{left:0})}}}function T(){try{var ao=(l.id.indexOf("_instream")>0?l.id.replace("_instream",""):l.id);H=document.getElementById(ao);H.addEventListener("mousemove",Z)}catch(an){_utils.log("Could not add mouse listeners to controlbar: "+an)}}function u(){O();N();r();q=true;F();D.idlehide=(D.idlehide.toString().toLowerCase()=="true");if(D.position==a.html5.view.positions.OVER&&D.idlehide){ag.style.opacity=0;V=true}else{ag.style.opacity=1;setTimeout((function(){V=true;W()}),1)}T();ai()}u();return this}})(jwplayer);(function(b){var a=["width","height","state","playlist","item","position","buffer","duration","volume","mute","fullscreen"];var c=b.utils;b.html5.controller=function(o,K,f,h){var n=o,m=f,j=h,y=K,M=true,G=-1,A=false,d=false,P,C=[],q=false;var D=(c.exists(m.config.debug)&&(m.config.debug.toString().toLowerCase()=="console")),N=new b.html5.eventdispatcher(y.id,D);c.extend(this,N);function L(T){if(q){N.sendEvent(T.type,T)}else{C.push(T)}}function s(T){if(!q){q=true;N.sendEvent(b.api.events.JWPLAYER_READY,T);if(b.utils.exists(window.playerReady)){playerReady(T)}if(b.utils.exists(window[f.config.playerReady])){window[f.config.playerReady](T)}while(C.length>0){var V=C.shift();N.sendEvent(V.type,V)}if(f.config.autostart&&!b.utils.isIOS()){O()}while(x.length>0){var U=x.shift();B(U.method,U.arguments)}}}m.addGlobalListener(L);m.addEventListener(b.api.events.JWPLAYER_MEDIA_BUFFER_FULL,function(){m.getMedia().play()});m.addEventListener(b.api.events.JWPLAYER_MEDIA_TIME,function(T){if(T.position>=m.playlist[m.item].start&&G>=0){m.playlist[m.item].start=G;G=-1}});m.addEventListener(b.api.events.JWPLAYER_MEDIA_COMPLETE,function(T){setTimeout(E,25)});m.addEventListener(b.api.events.JWPLAYER_PLAYLIST_LOADED,O);m.addEventListener(b.api.events.JWPLAYER_FULLSCREEN,p);function F(){try{P=F;if(!A){A=true;N.sendEvent(b.api.events.JWPLAYER_MEDIA_BEFOREPLAY);A=false;if(d){d=false;P=null;return}}v(m.item);if(m.playlist[m.item].levels[0].file.length>0){if(M||m.state==b.api.events.state.IDLE){m.getMedia().load(m.playlist[m.item]);M=false}else{if(m.state==b.api.events.state.PAUSED){m.getMedia().play()}}}return true}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T);P=null}return false}function e(){try{if(m.playlist[m.item].levels[0].file.length>0){switch(m.state){case b.api.events.state.PLAYING:case b.api.events.state.BUFFERING:if(m.getMedia()){m.getMedia().pause()}break;default:if(A){d=true}}}return true}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return false}function z(T){try{if(m.playlist[m.item].levels[0].file.length>0){if(typeof T!="number"){T=parseFloat(T)}switch(m.state){case b.api.events.state.IDLE:if(G<0){G=m.playlist[m.item].start;m.playlist[m.item].start=T}if(!A){F()}break;case b.api.events.state.PLAYING:case b.api.events.state.PAUSED:case b.api.events.state.BUFFERING:m.seek(T);break}}return true}catch(U){N.sendEvent(b.api.events.JWPLAYER_ERROR,U)}return false}function w(T){P=null;if(!c.exists(T)){T=true}try{if((m.state!=b.api.events.state.IDLE||T)&&m.getMedia()){m.getMedia().stop(T)}if(A){d=true}return true}catch(U){N.sendEvent(b.api.events.JWPLAYER_ERROR,U)}return false}function k(){try{if(m.playlist[m.item].levels[0].file.length>0){if(m.config.shuffle){v(S())}else{if(m.item+1==m.playlist.length){v(0)}else{v(m.item+1)}}}if(m.state!=b.api.events.state.IDLE){var U=m.state;m.state=b.api.events.state.IDLE;N.sendEvent(b.api.events.JWPLAYER_PLAYER_STATE,{oldstate:U,newstate:b.api.events.state.IDLE})}F();return true}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return false}function I(){try{if(m.playlist[m.item].levels[0].file.length>0){if(m.config.shuffle){v(S())}else{if(m.item===0){v(m.playlist.length-1)}else{v(m.item-1)}}}if(m.state!=b.api.events.state.IDLE){var U=m.state;m.state=b.api.events.state.IDLE;N.sendEvent(b.api.events.JWPLAYER_PLAYER_STATE,{oldstate:U,newstate:b.api.events.state.IDLE})}F();return true}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return false}function S(){var T=null;if(m.playlist.length>1){while(!c.exists(T)){T=Math.floor(Math.random()*m.playlist.length);if(T==m.item){T=null}}}else{T=0}return T}function H(U){if(!m.playlist||!m.playlist[U]){return false}try{if(m.playlist[U].levels[0].file.length>0){var V=m.state;if(V!==b.api.events.state.IDLE){if(m.playlist[m.item]&&m.playlist[m.item].provider==m.playlist[U].provider){w(false)}else{w()}}v(U);F()}return true}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return false}function v(T){if(!m.playlist[T]){return}m.setActiveMediaProvider(m.playlist[T]);if(m.item!=T){m.item=T;M=true;N.sendEvent(b.api.events.JWPLAYER_PLAYLIST_ITEM,{index:T})}}function g(U){try{v(m.item);var V=m.getMedia();switch(typeof(U)){case"number":V.volume(U);break;case"string":V.volume(parseInt(U,10));break}m.setVolume(U);return true}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return false}function r(U){try{v(m.item);var V=m.getMedia();if(typeof U=="undefined"){V.mute(!m.mute);m.setMute(!m.mute)}else{if(U.toString().toLowerCase()=="true"){V.mute(true);m.setMute(true)}else{V.mute(false);m.setMute(false)}}return true}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return false}function J(U,T){try{m.width=U;m.height=T;j.resize(U,T);N.sendEvent(b.api.events.JWPLAYER_RESIZE,{width:m.width,height:m.height});return true}catch(V){N.sendEvent(b.api.events.JWPLAYER_ERROR,V)}return false}function u(U,V){try{if(typeof U=="undefined"){U=!m.fullscreen}if(typeof V=="undefined"){V=true}if(U!=m.fullscreen){m.fullscreen=(U.toString().toLowerCase()=="true");j.fullscreen(m.fullscreen);if(V){N.sendEvent(b.api.events.JWPLAYER_FULLSCREEN,{fullscreen:m.fullscreen})}N.sendEvent(b.api.events.JWPLAYER_RESIZE,{width:m.width,height:m.height})}return true}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return false}function R(T){try{w();if(A){d=false}m.loadPlaylist(T);if(m.playlist[m.item].provider){v(m.item);if(m.config.autostart.toString().toLowerCase()=="true"&&!c.isIOS()&&!A){F()}return true}else{return false}}catch(U){N.sendEvent(b.api.events.JWPLAYER_ERROR,U)}return false}function O(T){if(!c.isIOS()){v(m.item);if(m.config.autostart.toString().toLowerCase()=="true"&&!c.isIOS()){F()}}}function p(T){u(T.fullscreen,false)}function t(){try{return m.getMedia().detachMedia()}catch(T){return null}}function l(){try{var T=m.getMedia().attachMedia();if(typeof P=="function"){P()}}catch(U){return null}}b.html5.controller.repeatoptions={LIST:"LIST",ALWAYS:"ALWAYS",SINGLE:"SINGLE",NONE:"NONE"};function E(){if(m.state!=b.api.events.state.IDLE){return}P=E;switch(m.config.repeat.toUpperCase()){case b.html5.controller.repeatoptions.SINGLE:F();break;case b.html5.controller.repeatoptions.ALWAYS:if(m.item==m.playlist.length-1&&!m.config.shuffle){H(0)}else{k()}break;case b.html5.controller.repeatoptions.LIST:if(m.item==m.playlist.length-1&&!m.config.shuffle){w();v(0)}else{k()}break;default:w();break}}var x=[];function Q(T){return function(){if(q){B(T,arguments)}else{x.push({method:T,arguments:arguments})}}}function B(V,U){var T=[];for(i=0;i<U.length;i++){T.push(U[i])}V.apply(this,T)}this.play=Q(F);this.pause=Q(e);this.seek=Q(z);this.stop=Q(w);this.next=Q(k);this.prev=Q(I);this.item=Q(H);this.setVolume=Q(g);this.setMute=Q(r);this.resize=Q(J);this.setFullscreen=Q(u);this.load=Q(R);this.playerReady=s;this.detachMedia=t;this.attachMedia=l;this.beforePlay=function(){return A};this.destroy=function(){if(m.getMedia()){m.getMedia().destroy()}}}})(jwplayer);(function(a){a.html5.defaultSkin=function(){this.text='<?xml version="1.0" ?><skin author="LongTail Video" name="Five" version="1.1"><components><component name="controlbar"><settings><setting name="margin" value="20"/><setting name="fontsize" value="11"/><setting name="fontcolor" value="0x000000"/></settings><layout><group position="left"><button name="play"/><divider name="divider"/><button name="prev"/><divider name="divider"/><button name="next"/><divider name="divider"/><text name="elapsed"/></group><group position="center"><slider name="time"/></group><group position="right"><text name="duration"/><divider name="divider"/><button name="blank"/><divider name="divider"/><button name="mute"/><slider name="volume"/><divider name="divider"/><button name="fullscreen"/></group></layout><elements><element name="background" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAIAAABvFaqvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAElJREFUOI3t1LERACAMQlFgGvcfxNIhHMK4gsUvUviOmgtNsiAZkBSEKxKEnCYkkQrJn/YwbUNiSDDYRZaQRDaShv+oX9GBZEIuK+8hXVLs+/YAAAAASUVORK5CYII="/><element name="blankButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAYCAYAAAAyJzegAAAAFElEQVQYV2P8//8/AzpgHBUc7oIAGZdH0RjKN8EAAAAASUVORK5CYII="/><element name="capLeft" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAYCAYAAAA7zJfaAAAAQElEQVQIWz3LsRGAMADDQJ0XB5bMINABZ9GENGrszxhjT2WLSqxEJG2JQrTMdV2q5LpOAvyRaVmsi7WdeZ/7+AAaOTq7BVrfOQAAAABJRU5ErkJggg=="/><element name="capRight" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAYCAYAAAA7zJfaAAAAQElEQVQIWz3LsRGAMADDQJ0XB5bMINABZ9GENGrszxhjT2WLSqxEJG2JQrTMdV2q5LpOAvyRaVmsi7WdeZ/7+AAaOTq7BVrfOQAAAABJRU5ErkJggg=="/><element name="divider" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAYCAIAAAC0rgCNAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADhJREFUCB0FwcENgEAAw7Aq+893g8APUILNOQcbFRktVGqUVFRkWNz3xTa2sUaLNUosKlRUvvf5AdbWOTtzmzyWAAAAAElFTkSuQmCC"/><element name="playButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAANUlEQVR42u2RsQkAAAjD/NTTPaW6dXLrINJA1kBpGPMAjDWmOgp1HFQXx+b1KOefO4oxY57R73YnVYCQUCQAAAAASUVORK5CYII="/><element name="pauseButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAAIUlEQVQ4jWNgGAWjYOiD/0gYG3/U0FFDB4Oho2AUDAYAAEwiL9HrpdMVAAAAAElFTkSuQmCC"/><element name="prevButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAAQklEQVQ4y2NgGAWjYOiD/1AMA/JAfB5NjCJD/YH4PRaLyDa0H4lNNUP/DxlD59PCUBCIp3ZEwYA+NZLUKBgFgwEAAN+HLX9sB8u8AAAAAElFTkSuQmCC"/><element name="nextButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAAQElEQVQ4y2NgGAWjYOiD/0B8Hojl0cT+U2ooCL8HYn9qGwrD/bQw9P+QMXQ+tSMqnpoRBUpS+tRMUqNgFAwGAADxZy1/mHvFnAAAAABJRU5ErkJggg=="/><element name="timeSliderRail" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAOElEQVRIDe3BwQkAIRADwAhhw/nU/kWwUK+KPITMABFh19Y+F0acY8CJvX9wYpXgRElwolSIiMf9ZWEDhtwurFsAAAAASUVORK5CYII="/><element name="timeSliderBuffer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAN0lEQVRIDe3BwQkAMQwDMBcc55mRe9zi7RR+FCwBEWG39vcfGHFm4MTuhhMlwYlVBSdKhYh43AW/LQMKm1spzwAAAABJRU5ErkJggg=="/><element name="timeSliderProgress" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAIElEQVRIiWNgGAWjYBTQBfynMR61YCRYMApGwSigMQAAiVWPcbq6UkIAAAAASUVORK5CYII="/><element name="timeSliderThumb" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAYCAYAAAA/OUfnAAAAO0lEQVQYlWP4//8/Awwz0JgDBP/BeN6Cxf/hnI2btiI4u/fsQ3AOHjqK4Jw4eQbBOX/hEoKDYjSd/AMA4cS4mfLsorgAAAAASUVORK5CYII="/><element name="muteButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAYCAYAAADKx8xXAAAAJklEQVQ4y2NgGAUjDcwH4v/kaPxPikZkxcNVI9mBQ5XoGAWDFwAAsKAXKQQmfbUAAAAASUVORK5CYII="/><element name="unmuteButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAYCAYAAADKx8xXAAAAMklEQVQ4y2NgGAWDHPyntub5xBr6Hwv/Pzk2/yfVG/8psRFE25Oq8T+tQnsIaB4FVAcAi2YVysVY52AAAAAASUVORK5CYII="/><element name="volumeSliderRail" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYAgMAAACdGdVrAAAACVBMVEUAAACmpqampqbBXAu8AAAAAnRSTlMAgJsrThgAAAArSURBVAhbY2AgErBAyA4I2QEhOyBkB4TsYOhAoaCCUCUwDTDtMMNgRuMHAFB5FoGH5T0UAAAAAElFTkSuQmCC"/><element name="volumeSliderProgress" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYAgMAAACdGdVrAAAACVBMVEUAAAAAAAAAAACDY+nAAAAAAnRSTlMAgJsrThgAAAArSURBVAhbY2AgErBAyA4I2QEhOyBkB4TsYOhAoaCCUCUwDTDtMMNgRuMHAFB5FoGH5T0UAAAAAElFTkSuQmCC"/><element name="volumeSliderCapRight" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAYCAYAAAAyJzegAAAAFElEQVQYV2P8//8/AzpgHBUc7oIAGZdH0RjKN8EAAAAASUVORK5CYII="/><element name="fullscreenButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAQklEQVRIiWNgGAWjYMiD/0iYFDmSLbDHImdPLQtgBpEiR7Zl2NijAA5oEkT/0Whi5UiyAJ8BVMsHNMtoo2AUDAIAAGdcIN3IDNXoAAAAAElFTkSuQmCC"/><element name="normalscreenButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAP0lEQVRIx2NgGAWjYMiD/1RSQ5QB/wmIUWzJfzx8qhj+n4DYCAY0DyJ7PBbYU8sHMEvwiZFtODXUjIJRMJgBACpWIN2ZxdPTAAAAAElFTkSuQmCC"/></elements></component><component name="display"><elements><element name="background" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyAQMAAAAk8RryAAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlOZpuml+rYAAAASSURBVBhXY2AYJuA/GBwY6jQAyDyoK8QcL4QAAAAASUVORK5CYII="/><element name="playIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAiUlEQVR42u3XSw2AMBREURwgAQlIQAISKgUpSEFKJeCg5b0E0kWBTVcD9ySTsL0Jn9IBAAAA+K2UUrBlW/Rr5ZDoIeeuoFkxJD9ss03aIXXQqB9SttoG7ZA6qNcOKdttiwcJh9RB+iFl4SshkRBuLR72+9cvH0SOKI2HRo7x/Fi1/uoCAAAAwLsD8ki99IlO2dQAAAAASUVORK5CYII="/><element name="muteIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAVUlEQVR42u3WMQrAIAxAUW/g/SdvGmvpoOBeSHgPsjj5QTANAACARCJilIhYM0tEvJM+Ik3Id9E957kQIb+F3OdCPC0hPkQriqWx9hp/x/QGAABQyAPLB22VGrpLDgAAAABJRU5ErkJggg=="/><element name="errorIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAA/0lEQVR42u2U0QmEMBAF7cASLMESUoIlpARLSCkpwRJSgiWkhOvAXD4WsgRkyaG5DbyB+Yvg8KITAAAAAAAYk+u61mwk15EjPtlEfihmqIiZR1Qx80ghjgdUuiHXGHSVsoag0x6x8DUoyjD5KovmEJ9NTDMRPIT0mtdIUkjlonuNohO+Ha99DTmkuGgKCTcvebAzx82ZoCWC3/3aIMWSRucaxcjORSFY4xpFdjYJGp1rFGcyCYZ/RVh6AUnfcNZ2zih3/mGj1jVCdiNDwyrq1rA/xMdeEXvDVdnYc1vDc3uPkDObXrlaxbNHSOohQhr/WOeLEWfWTgAAAAAAADzNF9sHJ7PJ57MlAAAAAElFTkSuQmCC"/><element name="bufferIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAACBklEQVR42u3Zv0sCYRzH8USTzOsHHEWGkC1HgaDgkktGDjUYtDQ01RDSljQ1BLU02+rk1NTm2NLq4Nx/0L/h9fnCd3j4cnZe1/U8xiO8h3uurufF0/3COd/3/0UWYiEWYiEWYiGJQ+J8xuPxKhXjEMZANinjIZhkGuVRNioE4wVURo4JkHm0xKWmhRAc1bh1EyCUw5BcBIjHiApKa4CErko6DEJwuRo6IRKzyJD8FJAyI3Zp2zRImiBcRhlfo5RtlxCcE3CcDNpGrhYIT2IhAJKilO0VRmzJ32fAMTpBTS0QMfGwlcuKMRftE0DJ0wCJdcOsCkBdXP3Mh9CEFUBTPS9mDZJBG6io4aqVzMdCokCw9H3kT6j/C/9iDdSeUMNC7DkyyxAs/Rk6Qss8FPWRZgdVtUH4DjxEn1zxh+/zj1wHlf4MQhNGrwqA6sY40U8JonRJwEQh+AO3AvCG6gHv4U7IY4krxkroWoAOkoQMGfCBrgIm+YBGqPENpIJ66CJg3x66Y0gnSUidAEEnNr9jjLiWMn5DiWP0OC/oAsCgkq43xBdGDMQr7YASP/vEkHvdl1+JOCcEV5sC4hGEOzTlPuKgd0b0xD4JkRcOgnRRTjdErkYhAsQVq6IdUuPJtmk7BCL3t/h88cx91pKQkI/pkDx6pmYTIjEoxiHsN1YWYiEWYiEWknhflZ5IErA5nr8AAAAASUVORK5CYII="/></elements></component><component name="dock"><settings><setting name="fontcolor" value="0xffffff"/></settings><elements><element name="button" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyAQMAAAAk8RryAAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlOZpuml+rYAAAASSURBVBhXY2AYJuA/GBwY6jQAyDyoK8QcL4QAAAAASUVORK5CYII="/></elements></component><component name="playlist"><settings><setting name="backgroundcolor" value="0xe8e8e8"/></settings><elements><element name="item" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAIAAAC1nk4lAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHBJREFUaN7t2MENwCAMBEEe9N8wSKYC/D8YV7CyJoRkVtVImxkZPQInMxoP0XiIxkM0HsGbjjSNBx544IEHHnjggUe/6UQeey0PIh7XTftGxKPj4eXCtLsHHh+ZxkO0Iw8PR55Ni8ZD9Hu/EAoP0dc5RRg9qeRjVF8AAAAASUVORK5CYII="/><element name="sliderCapTop" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAHCAYAAADnCQYGAAAAFUlEQVQokWP8//8/A7UB46ihI9hQAKt6FPPXhVGHAAAAAElFTkSuQmCC"/><element name="sliderRail" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAUCAYAAABiS3YzAAAAKElEQVQ4y2P4//8/Az68bNmy/+iYkB6GUUNHDR01dNTQUUNHDaXcUABUDOKhcxnsSwAAAABJRU5ErkJggg=="/><element name="sliderThumb" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAUCAYAAABiS3YzAAAAJUlEQVQ4T2P4//8/Ay4MBP9xYbz6Rg0dNXTU0FFDRw0dNZRyQwHH4NBa7GJsXAAAAABJRU5ErkJggg=="/><element name="sliderCapBottom" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAHCAYAAADnCQYGAAAAFUlEQVQokWP8//8/A7UB46ihI9hQAKt6FPPXhVGHAAAAAElFTkSuQmCC"/></elements></component></components></skin>';this.xml=null;if(window.DOMParser){parser=new DOMParser();this.xml=parser.parseFromString(this.text,"text/xml")}else{this.xml=new ActiveXObject("Microsoft.XMLDOM");this.xml.async="false";this.xml.loadXML(this.text)}return this}})(jwplayer);(function(a){_utils=a.utils;_css=_utils.css;_hide=function(b){_css(b,{display:"none"})};_show=function(b){_css(b,{display:"block"})};a.html5.display=function(k,K){var j={icons:true,showmute:false};var X=_utils.extend({},j,K);var h=k;var W={};var e;var w;var z;var T;var u;var M;var E;var N=!_utils.exists(h.skin.getComponentSettings("display").bufferrotation)?15:parseInt(h.skin.getComponentSettings("display").bufferrotation,10);var s=!_utils.exists(h.skin.getComponentSettings("display").bufferinterval)?100:parseInt(h.skin.getComponentSettings("display").bufferinterval,10);var D=-1;var v=a.api.events.state.IDLE;var O=true;var d;var C=false,V=true;var p="";var g=false;var o=false;var m;var y,R;var L=new a.html5.eventdispatcher();_utils.extend(this,L);var H={display:{style:{cursor:"pointer",top:0,left:0,overflow:"hidden"},click:n},display_icon:{style:{cursor:"pointer",position:"absolute",top:((h.skin.getSkinElement("display","background").height-h.skin.getSkinElement("display","playIcon").height)/2),left:((h.skin.getSkinElement("display","background").width-h.skin.getSkinElement("display","playIcon").width)/2),border:0,margin:0,padding:0,zIndex:3,display:"none"}},display_iconBackground:{style:{cursor:"pointer",position:"absolute",top:((w-h.skin.getSkinElement("display","background").height)/2),left:((e-h.skin.getSkinElement("display","background").width)/2),border:0,backgroundImage:(["url(",h.skin.getSkinElement("display","background").src,")"]).join(""),width:h.skin.getSkinElement("display","background").width,height:h.skin.getSkinElement("display","background").height,margin:0,padding:0,zIndex:2,display:"none"}},display_image:{style:{display:"none",width:e,height:w,position:"absolute",cursor:"pointer",left:0,top:0,margin:0,padding:0,textDecoration:"none",zIndex:1}},display_text:{style:{zIndex:4,position:"relative",opacity:0.8,backgroundColor:parseInt("000000",16),color:parseInt("ffffff",16),textAlign:"center",fontFamily:"Arial,sans-serif",padding:"0 5px",fontSize:14}}};h.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,q);h.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_MUTE,q);h.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,P);h.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_ITEM,q);h.jwAddEventListener(a.api.events.JWPLAYER_ERROR,r);Q();function Q(){W.display=G("div","display");W.display_text=G("div","display_text");W.display.appendChild(W.display_text);W.display_image=G("img","display_image");W.display_image.onerror=function(Y){_hide(W.display_image)};W.display_image.onload=B;W.display_icon=G("div","display_icon");W.display_iconBackground=G("div","display_iconBackground");W.display.appendChild(W.display_image);W.display_iconBackground.appendChild(W.display_icon);W.display.appendChild(W.display_iconBackground);f();setTimeout((function(){o=true;if(X.icons.toString()=="true"){J()}}),1)}this.getDisplayElement=function(){return W.display};this.resize=function(Z,Y){if(h.jwGetFullscreen()&&_utils.isMobile()){return}_css(W.display,{width:Z,height:Y});_css(W.display_text,{width:(Z-10),top:((Y-_utils.getBoundingClientRect(W.display_text).height)/2)});_css(W.display_iconBackground,{top:((Y-h.skin.getSkinElement("display","background").height)/2),left:((Z-h.skin.getSkinElement("display","background").width)/2)});if(e!=Z||w!=Y){e=Z;w=Y;d=undefined;J()}if(!h.jwGetFullscreen()){y=Z;R=Y}c();q({})};this.show=function(){if(g){g=false;t(h.jwGetState())}};this.hide=function(){if(!g){F();g=true}};function B(Y){z=W.display_image.naturalWidth;T=W.display_image.naturalHeight;c();if(h.jwGetState()==a.api.events.state.IDLE||h.jwGetPlaylist()[h.jwGetPlaylistIndex()].provider=="sound"){_css(W.display_image,{display:"block",opacity:0});_utils.fadeTo(W.display_image,1,0.1)}C=false}function c(){if(h.jwGetFullscreen()&&h.jwGetStretching()==a.utils.stretching.EXACTFIT){var Y=document.createElement("div");_utils.stretch(a.utils.stretching.UNIFORM,Y,e,w,y,R);_utils.stretch(a.utils.stretching.EXACTFIT,W.display_image,_utils.parseDimension(Y.style.width),_utils.parseDimension(Y.style.height),z,T);_css(W.display_image,{left:Y.style.left,top:Y.style.top})}else{_utils.stretch(h.jwGetStretching(),W.display_image,e,w,z,T)}}function G(Y,aa){var Z=document.createElement(Y);Z.id=h.id+"_jwplayer_"+aa;_css(Z,H[aa].style);return Z}function f(){for(var Y in W){if(_utils.exists(H[Y].click)){W[Y].onclick=H[Y].click}}}function n(Y){if(typeof Y.preventDefault!="undefined"){Y.preventDefault()}else{Y.returnValue=false}if(typeof m=="function"){m(Y);return}else{if(h.jwGetState()!=a.api.events.state.PLAYING){h.jwPlay()}else{h.jwPause()}}}function U(Y){if(E){F();return}W.display_icon.style.backgroundImage=(["url(",h.skin.getSkinElement("display",Y).src,")"]).join("");_css(W.display_icon,{width:h.skin.getSkinElement("display",Y).width,height:h.skin.getSkinElement("display",Y).height,top:(h.skin.getSkinElement("display","background").height-h.skin.getSkinElement("display",Y).height)/2,left:(h.skin.getSkinElement("display","background").width-h.skin.getSkinElement("display",Y).width)/2});b();if(_utils.exists(h.skin.getSkinElement("display",Y+"Over"))){W.display_icon.onmouseover=function(Z){W.display_icon.style.backgroundImage=["url(",h.skin.getSkinElement("display",Y+"Over").src,")"].join("")};W.display_icon.onmouseout=function(Z){W.display_icon.style.backgroundImage=["url(",h.skin.getSkinElement("display",Y).src,")"].join("")}}else{W.display_icon.onmouseover=null;W.display_icon.onmouseout=null}}function F(){if(X.icons.toString()=="true"){_hide(W.display_icon);_hide(W.display_iconBackground);S()}}function b(){if(!g&&X.icons.toString()=="true"){_show(W.display_icon);_show(W.display_iconBackground);J()}}function r(Y){E=true;F();W.display_text.innerHTML=Y.message;_show(W.display_text);W.display_text.style.top=((w-_utils.getBoundingClientRect(W.display_text).height)/2)+"px"}function I(){V=false;W.display_image.style.display="none"}function P(){v=""}function q(Y){if((Y.type==a.api.events.JWPLAYER_PLAYER_STATE||Y.type==a.api.events.JWPLAYER_PLAYLIST_ITEM)&&E){E=false;_hide(W.display_text)}var Z=h.jwGetState();if(Z==v){return}v=Z;if(D>=0){clearTimeout(D)}if(O||h.jwGetState()==a.api.events.state.PLAYING||h.jwGetState()==a.api.events.state.PAUSED){t(h.jwGetState())}else{D=setTimeout(l(h.jwGetState()),500)}}function l(Y){return(function(){t(Y)})}function t(Y){if(_utils.exists(M)){clearInterval(M);M=null;_utils.animations.rotate(W.display_icon,0)}switch(Y){case a.api.events.state.BUFFERING:if(_utils.isIPod()){I();F()}else{if(h.jwGetPlaylist()[h.jwGetPlaylistIndex()].provider=="sound"){x()}u=0;M=setInterval(function(){u+=N;_utils.animations.rotate(W.display_icon,u%360)},s);U("bufferIcon");O=true}break;case a.api.events.state.PAUSED:if(!_utils.isIPod()){if(h.jwGetPlaylist()[h.jwGetPlaylistIndex()].provider!="sound"){_css(W.display_image,{background:"transparent no-repeat center center"})}U("playIcon");O=true}break;case a.api.events.state.IDLE:if(h.jwGetPlaylist()[h.jwGetPlaylistIndex()]&&h.jwGetPlaylist()[h.jwGetPlaylistIndex()].image){x()}else{I()}U("playIcon");O=true;break;default:if(h.jwGetPlaylist()[h.jwGetPlaylistIndex()]&&h.jwGetPlaylist()[h.jwGetPlaylistIndex()].provider=="sound"){if(_utils.isIPod()){I();O=false}else{x()}}else{I();O=false}if(h.jwGetMute()&&X.showmute){U("muteIcon")}else{F()}break}D=-1}function x(){if(h.jwGetPlaylist()[h.jwGetPlaylistIndex()]){var Y=h.jwGetPlaylist()[h.jwGetPlaylistIndex()].image;if(Y){if(Y!=p){p=Y;C=true;W.display_image.src=_utils.getAbsolutePath(Y)}else{if(!(C||V)){V=true;W.display_image.style.opacity=0;W.display_image.style.display="block";_utils.fadeTo(W.display_image,1,0.1)}}}}}function A(Y){return function(){if(!o){return}if(!g&&d!=Y){d=Y;L.sendEvent(Y,{component:"display",boundingRect:_utils.getDimensions(W.display_iconBackground)})}}}var J=A(a.api.events.JWPLAYER_COMPONENT_SHOW);var S=A(a.api.events.JWPLAYER_COMPONENT_HIDE);this.setAlternateClickHandler=function(Y){m=Y};this.revertAlternateClickHandler=function(){m=undefined};return this}})(jwplayer);(function(a){var c=a.utils;var b=c.css;a.html5.dock=function(w,D){function x(){return{align:a.html5.view.positions.RIGHT}}var n=c.extend({},x(),D);if(n.align=="FALSE"){return}var j={};var A=[];var k;var F;var f=false;var C=false;var g={x:0,y:0,width:0,height:0};var z;var o;var y;var m=new a.html5.eventdispatcher();c.extend(this,m);var r=document.createElement("div");r.id=w.id+"_jwplayer_dock";r.style.opacity=1;p();w.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,q);this.getDisplayElement=function(){return r};this.setButton=function(K,H,I,J){if(!H&&j[K]){c.arrays.remove(A,K);r.removeChild(j[K].div);delete j[K]}else{if(H){if(!j[K]){j[K]={}}j[K].handler=H;j[K].outGraphic=I;j[K].overGraphic=J;if(!j[K].div){A.push(K);j[K].div=document.createElement("div");j[K].div.style.position="absolute";r.appendChild(j[K].div);j[K].div.appendChild(document.createElement("div"));j[K].div.childNodes[0].style.position="relative";j[K].div.childNodes[0].style.width="100%";j[K].div.childNodes[0].style.height="100%";j[K].div.childNodes[0].style.zIndex=10;j[K].div.childNodes[0].style.cursor="pointer";j[K].div.appendChild(document.createElement("img"));j[K].div.childNodes[1].style.position="absolute";j[K].div.childNodes[1].style.left=0;j[K].div.childNodes[1].style.top=0;if(w.skin.getSkinElement("dock","button")){j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","button").src}j[K].div.childNodes[1].style.zIndex=9;j[K].div.childNodes[1].style.cursor="pointer";j[K].div.onmouseover=function(){if(j[K].overGraphic){j[K].div.childNodes[0].style.background=h(j[K].overGraphic)}if(w.skin.getSkinElement("dock","buttonOver")){j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","buttonOver").src}};j[K].div.onmouseout=function(){if(j[K].outGraphic){j[K].div.childNodes[0].style.background=h(j[K].outGraphic)}if(w.skin.getSkinElement("dock","button")){j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","button").src}};if(w.skin.getSkinElement("dock","button")){j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","button").src}}if(j[K].outGraphic){j[K].div.childNodes[0].style.background=h(j[K].outGraphic)}else{if(j[K].overGraphic){j[K].div.childNodes[0].style.background=h(j[K].overGraphic)}}if(H){j[K].div.onclick=function(L){L.preventDefault();a(w.id).callback(K);if(j[K].overGraphic){j[K].div.childNodes[0].style.background=h(j[K].overGraphic)}if(w.skin.getSkinElement("dock","button")){j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","button").src}}}}}l(k,F)};function h(H){return"url("+H+") no-repeat center center"}function t(H){}function l(H,T){p();if(A.length>0){var I=10;var S=I;var P=-1;var Q=w.skin.getSkinElement("dock","button").height;var O=w.skin.getSkinElement("dock","button").width;var M=H-O-I;var R,L;if(n.align==a.html5.view.positions.LEFT){P=1;M=I}for(var J=0;J<A.length;J++){var U=Math.floor(S/T);if((S+Q+I)>((U+1)*T)){S=((U+1)*T)+I;U=Math.floor(S/T)}var K=j[A[J]].div;K.style.top=(S%T)+"px";K.style.left=(M+(w.skin.getSkinElement("dock","button").width+I)*U*P)+"px";var N={x:c.parseDimension(K.style.left),y:c.parseDimension(K.style.top),width:O,height:Q};if(!R||(N.x<=R.x&&N.y<=R.y)){R=N}if(!L||(N.x>=L.x&&N.y>=L.y)){L=N}K.style.width=O+"px";K.style.height=Q+"px";S+=w.skin.getSkinElement("dock","button").height+I}g={x:R.x,y:R.y,width:L.x-R.x+L.width,height:R.y-L.y+L.height}}if(C!=w.jwGetFullscreen()||k!=H||F!=T){k=H;F=T;C=w.jwGetFullscreen();z=undefined;setTimeout(s,1)}}function d(H){return function(){if(!f&&z!=H&&A.length>0){z=H;m.sendEvent(H,{component:"dock",boundingRect:g})}}}function q(H){if(c.isMobile()){if(H.newstate==a.api.events.state.IDLE){v()}else{e()}}else{B()}}function B(H){if(f){return}clearTimeout(y);if(D.position==a.html5.view.positions.OVER||w.jwGetFullscreen()){switch(w.jwGetState()){case a.api.events.state.PAUSED:case a.api.events.state.IDLE:if(r&&r.style.opacity<1&&(!D.idlehide||c.exists(H))){E()}if(D.idlehide){y=setTimeout(function(){u()},2000)}break;default:if(c.exists(H)){E()}y=setTimeout(function(){u()},2000);break}}else{E()}}var s=d(a.api.events.JWPLAYER_COMPONENT_SHOW);var G=d(a.api.events.JWPLAYER_COMPONENT_HIDE);this.resize=l;var v=function(){b(r,{display:"block"});if(f){f=false;s()}};var e=function(){b(r,{display:"none"});if(!f){G();f=true}};function u(){if(!f){G();if(r.style.opacity==1){c.cancelAnimation(r);c.fadeTo(r,0,0.1,1,0)}}}function E(){if(!f){s();if(r.style.opacity==0){c.cancelAnimation(r);c.fadeTo(r,1,0.1,0,0)}}}function p(){try{o=document.getElementById(w.id);o.addEventListener("mousemove",B)}catch(H){c.log("Could not add mouse listeners to dock: "+H)}}this.hide=e;this.show=v;return this}})(jwplayer);(function(a){a.html5.eventdispatcher=function(d,b){var c=new a.events.eventdispatcher(b);a.utils.extend(this,c);this.sendEvent=function(e,f){if(!a.utils.exists(f)){f={}}a.utils.extend(f,{id:d,version:a.version,type:e});c.sendEvent(e,f)}}})(jwplayer);(function(a){var b=a.utils;a.html5.instream=function(y,m,x,z){var t={controlbarseekable:"always",controlbarpausable:true,controlbarstoppable:true,playlistclickable:true};var v,A,C=y,E=m,j=x,w=z,r,H,o,G,e,f,g,l,q,h=false,k,d,n=this;this.load=function(M,K){c();h=true;A=b.extend(t,K);v=a.html5.playlistitem(M);F();d=document.createElement("div");d.id=n.id+"_instream_container";w.detachMedia();r=g.getDisplayElement();f=E.playlist[E.item];e=C.jwGetState();if(e==a.api.events.state.BUFFERING||e==a.api.events.state.PLAYING){r.pause()}H=r.src?r.src:r.currentSrc;o=r.innerHTML;G=r.currentTime;q=new a.html5.display(n,b.extend({},E.plugins.config.display));q.setAlternateClickHandler(function(N){if(_fakemodel.state==a.api.events.state.PAUSED){n.jwInstreamPlay()}else{D(a.api.events.JWPLAYER_INSTREAM_CLICK,N)}});d.appendChild(q.getDisplayElement());if(!b.isMobile()){l=new a.html5.controlbar(n,b.extend({},E.plugins.config.controlbar,{}));if(E.plugins.config.controlbar.position==a.html5.view.positions.OVER){d.appendChild(l.getDisplayElement())}else{var L=E.plugins.object.controlbar.getDisplayElement().parentNode;L.appendChild(l.getDisplayElement())}}j.setupInstream(d,r);p();g.load(v)};this.jwInstreamDestroy=function(K){if(!h){return}h=false;if(e!=a.api.events.state.IDLE){g.load(f,false);g.stop(false)}else{g.stop(true)}g.detachMedia();j.destroyInstream();if(l){try{l.getDisplayElement().parentNode.removeChild(l.getDisplayElement())}catch(L){}}D(a.api.events.JWPLAYER_INSTREAM_DESTROYED,{reason:(K?"complete":"destroyed")},true);w.attachMedia();if(e==a.api.events.state.BUFFERING||e==a.api.events.state.PLAYING){r.play();if(E.playlist[E.item]==f){E.getMedia().seek(G)}}return};this.jwInstreamAddEventListener=function(K,L){k.addEventListener(K,L)};this.jwInstreamRemoveEventListener=function(K,L){k.removeEventListener(K,L)};this.jwInstreamPlay=function(){if(!h){return}g.play(true)};this.jwInstreamPause=function(){if(!h){return}g.pause(true)};this.jwInstreamSeek=function(K){if(!h){return}g.seek(K)};this.jwInstreamGetState=function(){if(!h){return undefined}return _fakemodel.state};this.jwInstreamGetPosition=function(){if(!h){return undefined}return _fakemodel.position};this.jwInstreamGetDuration=function(){if(!h){return undefined}return _fakemodel.duration};this.playlistClickable=function(){return(!h||A.playlistclickable.toString().toLowerCase()=="true")};function s(){_fakemodel=new a.html5.model(this,E.getMedia()?E.getMedia().getDisplayElement():E.container,E);k=new a.html5.eventdispatcher();C.jwAddEventListener(a.api.events.JWPLAYER_RESIZE,p);C.jwAddEventListener(a.api.events.JWPLAYER_FULLSCREEN,p)}function c(){_fakemodel.setMute(E.mute);_fakemodel.setVolume(E.volume)}function F(){if(!g){g=new a.html5.mediavideo(_fakemodel,E.getMedia()?E.getMedia().getDisplayElement():E.container);g.addGlobalListener(I);g.addEventListener(a.api.events.JWPLAYER_MEDIA_META,J);g.addEventListener(a.api.events.JWPLAYER_MEDIA_COMPLETE,u);g.addEventListener(a.api.events.JWPLAYER_MEDIA_BUFFER_FULL,B)}g.attachMedia()}function I(K){if(h){D(K.type,K)}}function B(K){if(h){g.play()}}function u(K){if(h){setTimeout(function(){n.jwInstreamDestroy(true)},10)}}function J(K){if(K.metadata.width&&K.metadata.height){j.resizeMedia()}}function D(K,L,M){if(h||M){k.sendEvent(K,L)}}function p(){var K=E.plugins.object.display.getDisplayElement().style;if(l){var L=E.plugins.object.controlbar.getDisplayElement().style;l.resize(b.parseDimension(K.width),b.parseDimension(K.height));_css(l.getDisplayElement(),b.extend({},L,{zIndex:1001,opacity:1}))}if(q){q.resize(b.parseDimension(K.width),b.parseDimension(K.height));_css(q.getDisplayElement(),b.extend({},K,{zIndex:1000}))}if(j){j.resizeMedia()}}this.jwPlay=function(K){if(A.controlbarpausable.toString().toLowerCase()=="true"){this.jwInstreamPlay()}};this.jwPause=function(K){if(A.controlbarpausable.toString().toLowerCase()=="true"){this.jwInstreamPause()}};this.jwStop=function(){if(A.controlbarstoppable.toString().toLowerCase()=="true"){this.jwInstreamDestroy();C.jwStop()}};this.jwSeek=function(K){switch(A.controlbarseekable.toLowerCase()){case"always":this.jwInstreamSeek(K);break;case"backwards":if(_fakemodel.position>K){this.jwInstreamSeek(K)}break}};this.jwGetPosition=function(){};this.jwGetDuration=function(){};this.jwGetWidth=C.jwGetWidth;this.jwGetHeight=C.jwGetHeight;this.jwGetFullscreen=C.jwGetFullscreen;this.jwSetFullscreen=C.jwSetFullscreen;this.jwGetVolume=function(){return E.volume};this.jwSetVolume=function(K){g.volume(K);C.jwSetVolume(K)};this.jwGetMute=function(){return E.mute};this.jwSetMute=function(K){g.mute(K);C.jwSetMute(K)};this.jwGetState=function(){return _fakemodel.state};this.jwGetPlaylist=function(){return[v]};this.jwGetPlaylistIndex=function(){return 0};this.jwGetStretching=function(){return E.config.stretching};this.jwAddEventListener=function(L,K){k.addEventListener(L,K)};this.jwRemoveEventListener=function(L,K){k.removeEventListener(L,K)};this.skin=C.skin;this.id=C.id+"_instream";s();return this}})(jwplayer);(function(a){var b={prefix:"",file:"",link:"",linktarget:"_top",margin:8,out:0.5,over:1,timeout:5,hide:true,position:"bottom-left"};_css=a.utils.css;a.html5.logo=function(n,r){var q=n;var u;var d;var t;var h=false;g();function g(){o();q.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,j);c();l()}function o(){if(b.prefix){var v=n.version.split(/\W/).splice(0,2).join("/");if(b.prefix.indexOf(v)<0){b.prefix+=v+"/"}}if(r.position==a.html5.view.positions.OVER){r.position=b.position}try{if(window.location.href.indexOf("https")==0){b.prefix=b.prefix.replace("http://l.longtailvideo.com","https://securel.longtailvideo.com")}}catch(w){}d=a.utils.extend({},b,r)}function c(){t=document.createElement("img");t.id=q.id+"_jwplayer_logo";t.style.display="none";t.onload=function(v){_css(t,k());p()};if(!d.file){return}if(d.file.indexOf("/")>=0){t.src=d.file}else{t.src=d.prefix+d.file}}if(!d.file){return}this.resize=function(w,v){};this.getDisplayElement=function(){return t};function l(){if(d.link){t.onmouseover=f;t.onmouseout=p;t.onclick=s}else{this.mouseEnabled=false}}function s(v){if(typeof v!="undefined"){v.stopPropagation()}if(!h){return}q.jwPause();q.jwSetFullscreen(false);if(d.link){window.open(d.link,d.linktarget)}return}function p(v){if(d.link&&h){t.style.opacity=d.out}return}function f(v){if(h){t.style.opacity=d.over}return}function k(){var x={textDecoration:"none",position:"absolute",cursor:"pointer"};x.display=(d.hide.toString()=="true"&&!h)?"none":"block";var w=d.position.toLowerCase().split("-");for(var v in w){x[w[v]]=parseInt(d.margin)}return x}function m(){if(d.hide.toString()=="true"){t.style.display="block";t.style.opacity=0;a.utils.fadeTo(t,d.out,0.1,parseFloat(t.style.opacity));u=setTimeout(function(){e()},d.timeout*1000)}h=true}function e(){h=false;if(d.hide.toString()=="true"){a.utils.fadeTo(t,0,0.1,parseFloat(t.style.opacity))}}function j(v){if(v.newstate==a.api.events.state.BUFFERING){clearTimeout(u);m()}}return this}})(jwplayer);(function(b){var d={ended:b.api.events.state.IDLE,playing:b.api.events.state.PLAYING,pause:b.api.events.state.PAUSED,buffering:b.api.events.state.BUFFERING};var f=b.utils;var a=f.isMobile();var g,e;var c={};b.html5.mediavideo=function(k,I){var M={abort:A,canplay:r,canplaythrough:r,durationchange:w,emptied:A,ended:r,error:q,loadeddata:w,loadedmetadata:w,loadstart:r,pause:r,play:A,playing:r,progress:G,ratechange:A,seeked:r,seeking:r,stalled:r,suspend:r,timeupdate:Q,volumechange:n,waiting:r,canshowcurrentframe:A,dataunavailable:A,empty:A,load:j,loadedfirstframe:A,webkitfullscreenchange:m};var E={};var N=new b.html5.eventdispatcher();f.extend(this,N);var l=k,D=I,o,h,F,W,H,P,O=false,v=false,z=false,L,J,T;U();this.load=function(Y,Z){if(typeof Z=="undefined"){Z=true}if(!v){return}W=Y;z=(W.duration>0);l.duration=W.duration;f.empty(o);o.style.display="block";o.style.opacity=1;if(g&&e){o.style.width=g;o.style.height=e;g=_previousHieght=0}T=0;s(Y.levels);if(Y.levels&&Y.levels.length>0){if(Y.levels.length==1||f.isIOS()){o.src=Y.levels[0].file}else{if(o.src){o.removeAttribute("src")}for(var X=0;X<Y.levels.length;X++){var aa=o.ownerDocument.createElement("source");aa.src=Y.levels[X].file;o.appendChild(aa);T++}}}else{o.src=Y.file}o.volume=l.volume/100;o.muted=l.mute;if(a){S()}L=J=F=false;l.buffer=0;if(!f.exists(Y.start)){Y.start=0}P=(Y.start>0)?Y.start:-1;u(b.api.events.JWPLAYER_MEDIA_LOADED);if((!a&&Y.levels.length==1)||!O){o.load()}O=false;if(Z){y(b.api.events.state.BUFFERING);u(b.api.events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:0});C()}if(o.videoWidth>0&&o.videoHeight>0){w()}};this.play=function(){if(!v){return}C();if(J){y(b.api.events.state.PLAYING)}else{o.load();y(b.api.events.state.BUFFERING)}o.play()};this.pause=function(){if(!v){return}o.pause();y(b.api.events.state.PAUSED)};this.seek=function(X){if(!v){return}if(!F&&o.readyState>0){if(!(l.duration<=0||isNaN(l.duration))&&!(l.position<=0||isNaN(l.position))){o.currentTime=X;o.play()}}else{P=X}};var B=this.stop=function(X){if(!v){return}if(!f.exists(X)){X=true}t();if(X){J=false;var Y=navigator.userAgent;if(o.webkitSupportsFullscreen){try{o.webkitExitFullscreen()}catch(Z){}}o.style.opacity=0;x();if(f.isIE()){o.src=""}else{o.removeAttribute("src")}f.empty(o);o.load();O=true}if(f.isIPod()){g=o.style.width;e=o.style.height;o.style.width=0;o.style.height=0}else{if(f.isIPad()){o.style.display="none";try{o.webkitExitFullscreen()}catch(aa){}}}y(b.api.events.state.IDLE)};this.fullscreen=function(X){if(X===true){this.resize("100%","100%")}else{this.resize(l.config.width,l.config.height)}};this.resize=function(Y,X){};this.volume=function(X){if(!a){o.volume=X/100;u(b.api.events.JWPLAYER_MEDIA_VOLUME,{volume:(X/100)})}};this.mute=function(X){if(!a){o.muted=X;u(b.api.events.JWPLAYER_MEDIA_MUTE,{mute:X})}};this.getDisplayElement=function(){return o};this.hasChrome=function(){return a&&(h==b.api.events.state.PLAYING)};this.detachMedia=function(){v=false;return this.getDisplayElement()};this.attachMedia=function(){v=true};this.destroy=function(){if(o&&o.parentNode){t();for(var X in M){o.removeEventListener(X,K(X,M[X]),true)}f.empty(o);D=o.parentNode;o.parentNode.removeChild(o);delete c[l.id];o=null}};function K(Y,X){if(E[Y]){return E[Y]}else{E[Y]=function(Z){if(f.exists(Z.target.parentNode)){X(Z)}};return E[Y]}}function U(){h=b.api.events.state.IDLE;v=true;o=p();o.setAttribute("x-webkit-airplay","allow");if(D.parentNode){o.id=D.id;D.parentNode.replaceChild(o,D)}}function p(){var X=c[l.id];if(!X){if(D.tagName.toLowerCase()=="video"){X=D}else{X=document.createElement("video")}c[l.id]=X;if(!X.id){X.id=D.id}}for(var Y in M){X.addEventListener(Y,K(Y,M[Y]),true)}return X}function y(X){if(X==b.api.events.state.PAUSED&&h==b.api.events.state.IDLE){return}if(a){switch(X){case b.api.events.state.PLAYING:S();break;case b.api.events.state.BUFFERING:case b.api.events.state.PAUSED:x();break}}if(h!=X){var Y=h;l.state=h=X;u(b.api.events.JWPLAYER_PLAYER_STATE,{oldstate:Y,newstate:X})}}function A(X){}function n(X){var Y=Math.round(o.volume*100);u(b.api.events.JWPLAYER_MEDIA_VOLUME,{volume:Y},true);u(b.api.events.JWPLAYER_MEDIA_MUTE,{mute:o.muted},true)}function G(Z){if(!v){return}var Y;if(f.exists(Z)&&Z.lengthComputable&&Z.total){Y=Z.loaded/Z.total*100}else{if(f.exists(o.buffered)&&(o.buffered.length>0)){var X=o.buffered.length-1;if(X>=0){Y=o.buffered.end(X)/o.duration*100}}}if(f.useNativeFullscreen()&&f.exists(o.webkitDisplayingFullscreen)){if(l.fullscreen!=o.webkitDisplayingFullscreen){u(b.api.events.JWPLAYER_FULLSCREEN,{fullscreen:o.webkitDisplayingFullscreen},true)}}if(J===false&&h==b.api.events.state.BUFFERING){u(b.api.events.JWPLAYER_MEDIA_BUFFER_FULL);J=true}if(!L){if(Y==100){L=true}if(f.exists(Y)&&(Y>l.buffer)){l.buffer=Math.round(Y);u(b.api.events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:Math.round(Y)})}}}function Q(Y){if(!v){return}if(f.exists(Y)&&f.exists(Y.target)){if(z>0){if(!isNaN(Y.target.duration)&&(isNaN(l.duration)||l.duration<1)){if(Y.target.duration==Infinity){l.duration=0}else{l.duration=Math.round(Y.target.duration*10)/10}}}if(!F&&o.readyState>0){y(b.api.events.state.PLAYING)}if(h==b.api.events.state.PLAYING){if(o.readyState>0&&(P>-1||!F)){F=true;try{if(o.currentTime!=P&&P>-1){o.currentTime=P;P=-1}}catch(X){}o.volume=l.volume/100;o.muted=l.mute}l.position=l.duration>0?(Math.round(Y.target.currentTime*10)/10):0;u(b.api.events.JWPLAYER_MEDIA_TIME,{position:l.position,duration:l.duration});if(l.position>=l.duration&&(l.position>0||l.duration>0)){R();return}}}G(Y)}function j(X){}function r(X){if(!v){return}if(g&&e){o.style.width=g;o.style.height=e;g=_previousHieght=0}if(d[X.type]){if(X.type=="ended"){R()}else{y(d[X.type])}}}function w(Y){if(!v){return}var X=Math.round(o.duration*10)/10;var Z={height:o.videoHeight,width:o.videoWidth,duration:X};if(!z){if((l.duration<X||isNaN(l.duration))&&o.duration!=Infinity){l.duration=X}}u(b.api.events.JWPLAYER_MEDIA_META,{metadata:Z})}function q(Z){if(!v){return}if(h==b.api.events.state.IDLE){return}var Y="There was an error: ";if((Z.target.error&&Z.target.tagName.toLowerCase()=="video")||Z.target.parentNode.error&&Z.target.parentNode.tagName.toLowerCase()=="video"){var X=!f.exists(Z.target.error)?Z.target.parentNode.error:Z.target.error;switch(X.code){case X.MEDIA_ERR_ABORTED:f.log("User aborted the video playback.");return;case X.MEDIA_ERR_NETWORK:Y="A network error caused the video download to fail part-way: ";break;case X.MEDIA_ERR_DECODE:Y="The video playback was aborted due to a corruption problem or because the video used features your browser did not support: ";break;case X.MEDIA_ERR_SRC_NOT_SUPPORTED:Y="The video could not be loaded, either because the server or network failed or because the format is not supported: ";break;default:Y="An unknown error occurred: ";break}}else{if(Z.target.tagName.toLowerCase()=="source"){T--;if(T>0){return}if(f.userAgentMatch(/firefox/i)){f.log("The video could not be loaded, either because the server or network failed or because the format is not supported.");B(false);return}else{Y="The video could not be loaded, either because the server or network failed or because the format is not supported: "}}else{f.log("An unknown error occurred.  Continuing...");return}}B(false);Y+=V();_error=true;u(b.api.events.JWPLAYER_ERROR,{message:Y});return}function V(){var Z="";for(var Y in W.levels){var X=W.levels[Y];var aa=D.ownerDocument.createElement("source");Z+=b.utils.getAbsolutePath(X.file);if(Y<(W.levels.length-1)){Z+=", "}}return Z}function C(){if(!f.exists(H)){H=setInterval(function(){G()},100)}}function t(){clearInterval(H);H=null}function R(){if(h==b.api.events.state.PLAYING){B(false);u(b.api.events.JWPLAYER_MEDIA_BEFORECOMPLETE);u(b.api.events.JWPLAYER_MEDIA_COMPLETE)}}function m(X){if(f.exists(o.webkitDisplayingFullscreen)){if(l.fullscreen&&!o.webkitDisplayingFullscreen){u(b.api.events.JWPLAYER_FULLSCREEN,{fullscreen:false},true)}}}function s(Z){if(Z.length>0&&f.userAgentMatch(/Safari/i)&&!f.userAgentMatch(/Chrome/i)){var X=-1;for(var Y=0;Y<Z.length;Y++){switch(f.extension(Z[Y].file)){case"mp4":if(X<0){X=Y}break;case"webm":Z.splice(Y,1);break}}if(X>0){var aa=Z.splice(X,1)[0];Z.unshift(aa)}}}function S(){setTimeout(function(){o.setAttribute("controls","controls")},100)}function x(){setTimeout(function(){o.removeAttribute("controls")},250)}function u(X,Z,Y){if(v||Y){if(Z){N.sendEvent(X,Z)}else{N.sendEvent(X)}}}}})(jwplayer);(function(a){var c={ended:a.api.events.state.IDLE,playing:a.api.events.state.PLAYING,pause:a.api.events.state.PAUSED,buffering:a.api.events.state.BUFFERING};var b=a.utils.css;a.html5.mediayoutube=function(j,e){var f=new a.html5.eventdispatcher();a.utils.extend(this,f);var l=j;var h=document.getElementById(e.id);var g=a.api.events.state.IDLE;var n,m;function k(p){if(g!=p){var q=g;l.state=p;g=p;f.sendEvent(a.api.events.JWPLAYER_PLAYER_STATE,{oldstate:q,newstate:p})}}this.getDisplayElement=this.detachMedia=function(){return h};this.attachMedia=function(){};this.play=function(){if(g==a.api.events.state.IDLE){f.sendEvent(a.api.events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:100});f.sendEvent(a.api.events.JWPLAYER_MEDIA_BUFFER_FULL);k(a.api.events.state.PLAYING)}else{if(g==a.api.events.state.PAUSED){k(a.api.events.state.PLAYING)}}};this.pause=function(){k(a.api.events.state.PAUSED)};this.seek=function(p){};this.stop=function(p){if(!_utils.exists(p)){p=true}l.position=0;k(a.api.events.state.IDLE);if(p){b(h,{display:"none"})}};this.volume=function(p){l.setVolume(p);f.sendEvent(a.api.events.JWPLAYER_MEDIA_VOLUME,{volume:Math.round(p)})};this.mute=function(p){h.muted=p;f.sendEvent(a.api.events.JWPLAYER_MEDIA_MUTE,{mute:p})};this.resize=function(q,p){if(q*p>0&&n){n.width=m.width=q;n.height=m.height=p}};this.fullscreen=function(p){if(p===true){this.resize("100%","100%")}else{this.resize(l.config.width,l.config.height)}};this.load=function(p){o(p);b(n,{display:"block"});k(a.api.events.state.BUFFERING);f.sendEvent(a.api.events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:0});f.sendEvent(a.api.events.JWPLAYER_MEDIA_LOADED);this.play()};this.hasChrome=function(){return(g!=a.api.events.state.IDLE)};function o(v){var s=v.levels[0].file;s=["http://www.youtube.com/v/",d(s),"&amp;hl=en_US&amp;fs=1&autoplay=1"].join("");n=document.createElement("object");n.id=h.id;n.style.position="absolute";var u={movie:s,allowfullscreen:"true",allowscriptaccess:"always"};for(var p in u){var t=document.createElement("param");t.name=p;t.value=u[p];n.appendChild(t)}m=document.createElement("embed");n.appendChild(m);var q={src:s,type:"application/x-shockwave-flash",allowfullscreen:"true",allowscriptaccess:"always",width:n.width,height:n.height};for(var r in q){m.setAttribute(r,q[r])}n.appendChild(m);n.style.zIndex=2147483000;if(h!=n&&h.parentNode){h.parentNode.replaceChild(n,h)}h=n}function d(q){var p=q.split(/\?|\#\!/);var s="";for(var r=0;r<p.length;r++){if(p[r].substr(0,2)=="v="){s=p[r].substr(2)}}if(s==""){if(q.indexOf("/v/")>=0){s=q.substr(q.indexOf("/v/")+3)}else{if(q.indexOf("youtu.be")>=0){s=q.substr(q.indexOf("youtu.be/")+9)}else{s=q}}}if(s.indexOf("?")>-1){s=s.substr(0,s.indexOf("?"))}if(s.indexOf("&")>-1){s=s.substr(0,s.indexOf("&"))}return s}this.embed=m;return this}})(jwplayer);(function(jwplayer){var _configurableStateVariables=["width","height","start","duration","volume","mute","fullscreen","item","plugins","stretching"];var _utils=jwplayer.utils;jwplayer.html5.model=function(api,container,options){var _api=api;var _container=container;var _cookies=_utils.getCookies();var _model={id:_container.id,playlist:[],state:jwplayer.api.events.state.IDLE,position:0,buffer:0,container:_container,config:{width:480,height:320,item:-1,skin:undefined,file:undefined,image:undefined,start:0,duration:0,bufferlength:5,volume:_cookies.volume?_cookies.volume:90,mute:_cookies.mute&&_cookies.mute.toString().toLowerCase()=="true"?true:false,fullscreen:false,repeat:"",stretching:jwplayer.utils.stretching.UNIFORM,autostart:false,debug:undefined,screencolor:undefined}};var _media;var _eventDispatcher=new jwplayer.html5.eventdispatcher();var _components=["display","logo","controlbar","playlist","dock"];jwplayer.utils.extend(_model,_eventDispatcher);for(var option in options){if(typeof options[option]=="string"){var type=/color$/.test(option)?"color":null;options[option]=jwplayer.utils.typechecker(options[option],type)}var config=_model.config;var path=option.split(".");for(var edge in path){if(edge==path.length-1){config[path[edge]]=options[option]}else{if(!jwplayer.utils.exists(config[path[edge]])){config[path[edge]]={}}config=config[path[edge]]}}}for(var index in _configurableStateVariables){var configurableStateVariable=_configurableStateVariables[index];_model[configurableStateVariable]=_model.config[configurableStateVariable]}var pluginorder=_components.concat([]);if(jwplayer.utils.exists(_model.plugins)){if(typeof _model.plugins=="string"){var userplugins=_model.plugins.split(",");for(var userplugin in userplugins){if(typeof userplugins[userplugin]=="string"){pluginorder.push(userplugins[userplugin].replace(/^\s+|\s+$/g,""))}}}}if(jwplayer.utils.isMobile()){pluginorder=["display","logo","dock","playlist"];if(!jwplayer.utils.exists(_model.config.repeat)){_model.config.repeat="list"}}else{if(_model.config.chromeless){pluginorder=["logo","dock","playlist"];if(!jwplayer.utils.exists(_model.config.repeat)){_model.config.repeat="list"}}}_model.plugins={order:pluginorder,config:{},object:{}};if(typeof _model.config.components!="undefined"){for(var component in _model.config.components){_model.plugins.config[component]=_model.config.components[component]}}var playlistVisible=false;for(var pluginIndex in _model.plugins.order){var pluginName=_model.plugins.order[pluginIndex];var pluginConfig=!jwplayer.utils.exists(_model.plugins.config[pluginName])?{}:_model.plugins.config[pluginName];_model.plugins.config[pluginName]=!jwplayer.utils.exists(_model.plugins.config[pluginName])?pluginConfig:jwplayer.utils.extend(_model.plugins.config[pluginName],pluginConfig);if(!jwplayer.utils.exists(_model.plugins.config[pluginName].position)){if(pluginName=="playlist"){_model.plugins.config[pluginName].position=jwplayer.html5.view.positions.NONE}else{_model.plugins.config[pluginName].position=jwplayer.html5.view.positions.OVER}}else{if(pluginName=="playlist"){playlistVisible=true}_model.plugins.config[pluginName].position=_model.plugins.config[pluginName].position.toString().toUpperCase()}}if(_model.plugins.config.controlbar&&playlistVisible){_model.plugins.config.controlbar.hideplaylistcontrols=true}if(typeof _model.plugins.config.dock!="undefined"){if(typeof _model.plugins.config.dock!="object"){var position=_model.plugins.config.dock.toString().toUpperCase();_model.plugins.config.dock={position:position}}if(typeof _model.plugins.config.dock.position!="undefined"){_model.plugins.config.dock.align=_model.plugins.config.dock.position;_model.plugins.config.dock.position=jwplayer.html5.view.positions.OVER}if(typeof _model.plugins.config.dock.idlehide=="undefined"){try{_model.plugins.config.dock.idlehide=_model.plugins.config.controlbar.idlehide}catch(e){}}}function _loadExternal(playlistfile){var loader=new jwplayer.html5.playlistloader();loader.addEventListener(jwplayer.api.events.JWPLAYER_PLAYLIST_LOADED,function(evt){_model.playlist=new jwplayer.html5.playlist(evt);_loadComplete(true)});loader.addEventListener(jwplayer.api.events.JWPLAYER_ERROR,function(evt){_model.playlist=new jwplayer.html5.playlist({playlist:[]});_loadComplete(false)});loader.load(playlistfile)}function _loadComplete(){if(_model.config.shuffle){_model.item=_getShuffleItem()}else{if(_model.config.item>=_model.playlist.length){_model.config.item=_model.playlist.length-1}else{if(_model.config.item<0){_model.config.item=0}}_model.item=_model.config.item}_model.position=0;_model.duration=_model.playlist.length>0?_model.playlist[_model.item].duration:0;_eventDispatcher.sendEvent(jwplayer.api.events.JWPLAYER_PLAYLIST_LOADED,{playlist:_model.playlist});_eventDispatcher.sendEvent(jwplayer.api.events.JWPLAYER_PLAYLIST_ITEM,{index:_model.item})}_model.loadPlaylist=function(arg){var input;if(typeof arg=="string"){if(arg.indexOf("[")==0||arg.indexOf("{")=="0"){try{input=eval(arg)}catch(err){input=arg}}else{input=arg}}else{input=arg}var config;switch(jwplayer.utils.typeOf(input)){case"object":config=input;break;case"array":config={playlist:input};break;default:config={file:input};break}_model.playlist=new jwplayer.html5.playlist(config);_model.item=_model.config.item>=0?_model.config.item:0;if(!_model.playlist[0].provider&&_model.playlist[0].file){_loadExternal(_model.playlist[0].file)}else{_loadComplete()}};function _getShuffleItem(){var result=null;if(_model.playlist.length>1){while(!jwplayer.utils.exists(result)){result=Math.floor(Math.random()*_model.playlist.length);if(result==_model.item){result=null}}}else{result=0}return result}function forward(evt){switch(evt.type){case jwplayer.api.events.JWPLAYER_MEDIA_LOADED:_container=_media.getDisplayElement();break;case jwplayer.api.events.JWPLAYER_MEDIA_MUTE:this.mute=evt.mute;break;case jwplayer.api.events.JWPLAYER_MEDIA_VOLUME:this.volume=evt.volume;break}_eventDispatcher.sendEvent(evt.type,evt)}var _mediaProviders={};_model.setActiveMediaProvider=function(playlistItem){if(playlistItem.provider=="audio"){playlistItem.provider="sound"}var provider=playlistItem.provider;var current=_media?_media.getDisplayElement():null;if(provider=="sound"||provider=="http"||provider==""){provider="video"}if(!jwplayer.utils.exists(_mediaProviders[provider])){switch(provider){case"video":_media=new jwplayer.html5.mediavideo(_model,current?current:_container);break;case"youtube":_media=new jwplayer.html5.mediayoutube(_model,current?current:_container);break}if(!jwplayer.utils.exists(_media)){return false}_media.addGlobalListener(forward);_mediaProviders[provider]=_media}else{if(_media!=_mediaProviders[provider]){if(_media){_media.stop()}_media=_mediaProviders[provider]}}return true};_model.getMedia=function(){return _media};_model.seek=function(pos){_eventDispatcher.sendEvent(jwplayer.api.events.JWPLAYER_MEDIA_SEEK,{position:_model.position,offset:pos});return _media.seek(pos)};_model.setVolume=function(newVol){_utils.saveCookie("volume",newVol);_model.volume=newVol};_model.setMute=function(state){_utils.saveCookie("mute",state);_model.mute=state};_model.setupPlugins=function(){if(!jwplayer.utils.exists(_model.plugins)||!jwplayer.utils.exists(_model.plugins.order)||_model.plugins.order.length==0){jwplayer.utils.log("No plugins to set up");return _model}for(var i=0;i<_model.plugins.order.length;i++){try{var pluginName=_model.plugins.order[i];if(jwplayer.utils.exists(jwplayer.html5[pluginName])){if(pluginName=="playlist"){_model.plugins.object[pluginName]=new jwplayer.html5.playlistcomponent(_api,_model.plugins.config[pluginName])}else{_model.plugins.object[pluginName]=new jwplayer.html5[pluginName](_api,_model.plugins.config[pluginName])}}else{_model.plugins.order.splice(plugin,plugin+1)}if(typeof _model.plugins.object[pluginName].addGlobalListener=="function"){_model.plugins.object[pluginName].addGlobalListener(forward)}}catch(err){jwplayer.utils.log("Could not setup "+pluginName)}}};return _model}})(jwplayer);(function(a){a.html5.playlist=function(b){var d=[];if(b.playlist&&b.playlist instanceof Array&&b.playlist.length>0){for(var c in b.playlist){if(!isNaN(parseInt(c))){d.push(new a.html5.playlistitem(b.playlist[c]))}}}else{d.push(new a.html5.playlistitem(b))}return d}})(jwplayer);(function(a){var c={size:180,position:a.html5.view.positions.NONE,itemheight:60,thumbs:true,fontcolor:"#000000",overcolor:"",activecolor:"",backgroundcolor:"#f8f8f8",font:"_sans",fontsize:"",fontstyle:"",fontweight:""};var b={_sans:"Arial, Helvetica, sans-serif",_serif:"Times, Times New Roman, serif",_typewriter:"Courier New, Courier, monospace"};_utils=a.utils;_css=_utils.css;_hide=function(d){_css(d,{display:"none"})};_show=function(d){_css(d,{display:"block"})};a.html5.playlistcomponent=function(r,C){var x=r;var e=a.utils.extend({},c,x.skin.getComponentSettings("playlist"),C);if(e.position==a.html5.view.positions.NONE||typeof a.html5.view.positions[e.position]=="undefined"){return}var y;var l;var D;var d;var g;var f;var k=-1;var h={background:undefined,item:undefined,itemOver:undefined,itemImage:undefined,itemActive:undefined};this.getDisplayElement=function(){return y};this.resize=function(G,E){l=G;D=E;if(x.jwGetFullscreen()){_hide(y)}else{var F={display:"block",width:l,height:D};_css(y,F)}};this.show=function(){_show(y)};this.hide=function(){_hide(y)};function j(){y=document.createElement("div");y.id=x.id+"_jwplayer_playlistcomponent";y.style.overflow="hidden";switch(e.position){case a.html5.view.positions.RIGHT:case a.html5.view.positions.LEFT:y.style.width=e.size+"px";break;case a.html5.view.positions.TOP:case a.html5.view.positions.BOTTOM:y.style.height=e.size+"px";break}B();if(h.item){e.itemheight=h.item.height}y.style.backgroundColor="#C6C6C6";x.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,s);x.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_ITEM,v);x.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,m)}function p(){var E=document.createElement("ul");_css(E,{width:y.style.width,minWidth:y.style.width,height:y.style.height,backgroundColor:e.backgroundcolor,backgroundImage:h.background?"url("+h.background.src+")":"",color:e.fontcolor,listStyle:"none",margin:0,padding:0,fontFamily:b[e.font]?b[e.font]:b._sans,fontSize:(e.fontsize?e.fontsize:11)+"px",fontStyle:e.fontstyle,fontWeight:e.fontweight,overflowY:"auto"});return E}function z(E){return function(){var F=f.getElementsByClassName("item")[E];var G=e.fontcolor;var H=h.item?"url("+h.item.src+")":"";if(E==x.jwGetPlaylistIndex()){if(e.activecolor!==""){G=e.activecolor}if(h.itemActive){H="url("+h.itemActive.src+")"}}_css(F,{color:e.overcolor!==""?e.overcolor:G,backgroundImage:h.itemOver?"url("+h.itemOver.src+")":H})}}function o(E){return function(){var F=f.getElementsByClassName("item")[E];var G=e.fontcolor;var H=h.item?"url("+h.item.src+")":"";if(E==x.jwGetPlaylistIndex()){if(e.activecolor!==""){G=e.activecolor}if(h.itemActive){H="url("+h.itemActive.src+")"}}_css(F,{color:G,backgroundImage:H})}}function q(J){var Q=d[J];var P=document.createElement("li");P.className="item";_css(P,{height:e.itemheight,display:"block",cursor:"pointer",backgroundImage:h.item?"url("+h.item.src+")":"",backgroundSize:"100% "+e.itemheight+"px"});P.onmouseover=z(J);P.onmouseout=o(J);var K=document.createElement("div");var G=new Image();var L=0;var M=0;var N=0;if(w()&&(Q.image||Q["playlist.image"]||h.itemImage)){G.className="image";if(h.itemImage){L=(e.itemheight-h.itemImage.height)/2;M=h.itemImage.width;N=h.itemImage.height}else{M=e.itemheight*4/3;N=e.itemheight}_css(K,{height:N,width:M,"float":"left",styleFloat:"left",cssFloat:"left",margin:"0 5px 0 0",background:"black",overflow:"hidden",margin:L+"px",position:"relative"});_css(G,{position:"relative"});K.appendChild(G);G.onload=function(){a.utils.stretch(a.utils.stretching.FILL,G,M,N,this.naturalWidth,this.naturalHeight)};if(Q["playlist.image"]){G.src=Q["playlist.image"]}else{if(Q.image){G.src=Q.image}else{if(h.itemImage){G.src=h.itemImage.src}}}P.appendChild(K)}var F=l-M-L*2;if(D<e.itemheight*d.length){F-=15}var E=document.createElement("div");_css(E,{position:"relative",height:"100%",overflow:"hidden"});var H=document.createElement("span");if(Q.duration>0){H.className="duration";_css(H,{fontSize:(e.fontsize?e.fontsize:11)+"px",fontWeight:(e.fontweight?e.fontweight:"bold"),width:"40px",height:e.fontsize?e.fontsize+10:20,lineHeight:24,"float":"right",styleFloat:"right",cssFloat:"right"});H.innerHTML=_utils.timeFormat(Q.duration);E.appendChild(H)}var O=document.createElement("span");O.className="title";_css(O,{padding:"5px 5px 0 "+(L?0:"5px"),height:e.fontsize?e.fontsize+10:20,lineHeight:e.fontsize?e.fontsize+10:20,overflow:"hidden","float":"left",styleFloat:"left",cssFloat:"left",width:((Q.duration>0)?F-50:F)-10+"px",fontSize:(e.fontsize?e.fontsize:13)+"px",fontWeight:(e.fontweight?e.fontweight:"bold")});O.innerHTML=Q?Q.title:"";E.appendChild(O);if(Q.description){var I=document.createElement("span");I.className="description";_css(I,{display:"block","float":"left",styleFloat:"left",cssFloat:"left",margin:0,paddingLeft:O.style.paddingLeft,paddingRight:O.style.paddingRight,lineHeight:(e.fontsize?e.fontsize+4:16)+"px",overflow:"hidden",position:"relative"});I.innerHTML=Q.description;E.appendChild(I)}P.appendChild(E);return P}function s(F){y.innerHTML="";d=t();if(!d){return}items=[];f=p();for(var G=0;G<d.length;G++){var E=q(G);E.onclick=A(G);f.appendChild(E);items.push(E)}k=x.jwGetPlaylistIndex();o(k)();y.appendChild(f);if(_utils.isIOS()&&window.iScroll){f.style.height=e.itemheight*d.length+"px";var H=new iScroll(y.id)}}function t(){var F=x.jwGetPlaylist();var G=[];for(var E=0;E<F.length;E++){if(!F[E]["ova.hidden"]){G.push(F[E])}}return G}function A(E){return function(){x.jwPlaylistItem(E);x.jwPlay(true)}}function n(){f.scrollTop=x.jwGetPlaylistIndex()*e.itemheight}function w(){return e.thumbs.toString().toLowerCase()=="true"}function v(E){if(k>=0){o(k)();k=E.index}o(E.index)();n()}function m(){if(e.position==a.html5.view.positions.OVER){switch(x.jwGetState()){case a.api.events.state.IDLE:_show(y);break;default:_hide(y);break}}}function B(){for(var E in h){h[E]=u(E)}}function u(E){return x.skin.getSkinElement("playlist",E)}j();return this}})(jwplayer);(function(b){b.html5.playlistitem=function(d){var e={author:"",date:"",description:"",image:"",link:"",mediaid:"",tags:"",title:"",provider:"",file:"",streamer:"",duration:-1,start:0,currentLevel:-1,levels:[]};var c=b.utils.extend({},e,d);if(c.type){c.provider=c.type;delete c.type}if(c.levels.length===0){c.levels[0]=new b.html5.playlistitemlevel(c)}if(!c.provider){c.provider=a(c.levels[0])}else{c.provider=c.provider.toLowerCase()}return c};function a(e){if(b.utils.isYouTube(e.file)){return"youtube"}else{var f=b.utils.extension(e.file);var c;if(f&&b.utils.extensionmap[f]){if(f=="m3u8"){return"video"}c=b.utils.extensionmap[f].html5}else{if(e.type){c=e.type}}if(c){var d=c.split("/")[0];if(d=="audio"){return"sound"}else{if(d=="video"){return d}}}}return""}})(jwplayer);(function(a){a.html5.playlistitemlevel=function(b){var d={file:"",streamer:"",bitrate:0,width:0};for(var c in d){if(a.utils.exists(b[c])){d[c]=b[c]}}return d}})(jwplayer);(function(a){a.html5.playlistloader=function(){var c=new a.html5.eventdispatcher();a.utils.extend(this,c);this.load=function(e){a.utils.ajax(e,d,b)};function d(g){var f=[];try{var f=a.utils.parsers.rssparser.parse(g.responseXML.firstChild);c.sendEvent(a.api.events.JWPLAYER_PLAYLIST_LOADED,{playlist:new a.html5.playlist({playlist:f})})}catch(h){b("Could not parse the playlist")}}function b(e){c.sendEvent(a.api.events.JWPLAYER_ERROR,{message:e?e:"Could not load playlist an unknown reason."})}}})(jwplayer);(function(a){a.html5.skin=function(){var b={};var c=false;this.load=function(d,e){new a.html5.skinloader(d,function(f){c=true;b=f;e()},function(){new a.html5.skinloader("",function(f){c=true;b=f;e()})})};this.getSkinElement=function(d,e){if(c){try{return b[d].elements[e]}catch(f){a.utils.log("No such skin component / element: ",[d,e])}}return null};this.getComponentSettings=function(d){if(c&&b&&b[d]){return b[d].settings}return null};this.getComponentLayout=function(d){if(c){return b[d].layout}return null}}})(jwplayer);(function(a){a.html5.skinloader=function(f,p,k){var o={};var c=p;var l=k;var e=true;var j;var n=f;var s=false;function m(){if(typeof n!="string"||n===""){d(a.html5.defaultSkin().xml)}else{a.utils.ajax(a.utils.getAbsolutePath(n),function(t){try{if(a.utils.exists(t.responseXML)){d(t.responseXML);return}}catch(u){h()}d(a.html5.defaultSkin().xml)},function(t){d(a.html5.defaultSkin().xml)})}}function d(y){var E=y.getElementsByTagName("component");if(E.length===0){return}for(var H=0;H<E.length;H++){var C=E[H].getAttribute("name");var B={settings:{},elements:{},layout:{}};o[C]=B;var G=E[H].getElementsByTagName("elements")[0].getElementsByTagName("element");for(var F=0;F<G.length;F++){b(G[F],C)}var z=E[H].getElementsByTagName("settings")[0];if(z&&z.childNodes.length>0){var K=z.getElementsByTagName("setting");for(var P=0;P<K.length;P++){var Q=K[P].getAttribute("name");var I=K[P].getAttribute("value");var x=/color$/.test(Q)?"color":null;o[C].settings[Q]=a.utils.typechecker(I,x)}}var L=E[H].getElementsByTagName("layout")[0];if(L&&L.childNodes.length>0){var M=L.getElementsByTagName("group");for(var w=0;w<M.length;w++){var A=M[w];o[C].layout[A.getAttribute("position")]={elements:[]};for(var O=0;O<A.attributes.length;O++){var D=A.attributes[O];o[C].layout[A.getAttribute("position")][D.name]=D.value}var N=A.getElementsByTagName("*");for(var v=0;v<N.length;v++){var t=N[v];o[C].layout[A.getAttribute("position")].elements.push({type:t.tagName});for(var u=0;u<t.attributes.length;u++){var J=t.attributes[u];o[C].layout[A.getAttribute("position")].elements[v][J.name]=J.value}if(!a.utils.exists(o[C].layout[A.getAttribute("position")].elements[v].name)){o[C].layout[A.getAttribute("position")].elements[v].name=t.tagName}}}}e=false;r()}}function r(){clearInterval(j);if(!s){j=setInterval(function(){q()},100)}}function b(y,x){var w=new Image();var t=y.getAttribute("name");var v=y.getAttribute("src");var A;if(v.indexOf("data:image/png;base64,")===0){A=v}else{var u=a.utils.getAbsolutePath(n);var z=u.substr(0,u.lastIndexOf("/"));A=[z,x,v].join("/")}o[x].elements[t]={height:0,width:0,src:"",ready:false,image:w};w.onload=function(B){g(w,t,x)};w.onerror=function(B){s=true;r();l()};w.src=A}function h(){for(var u in o){var w=o[u];for(var t in w.elements){var x=w.elements[t];var v=x.image;v.onload=null;v.onerror=null;delete x.image;delete w.elements[t]}delete o[u]}}function q(){for(var t in o){if(t!="properties"){for(var u in o[t].elements){if(!o[t].elements[u].ready){return}}}}if(e===false){clearInterval(j);c(o)}}function g(t,v,u){if(o[u]&&o[u].elements[v]){o[u].elements[v].height=t.height;o[u].elements[v].width=t.width;o[u].elements[v].src=t.src;o[u].elements[v].ready=true;r()}else{a.utils.log("Loaded an image for a missing element: "+u+"."+v)}}m()}})(jwplayer);(function(a){a.html5.api=function(c,p){var n={};var g=document.createElement("div");c.parentNode.replaceChild(g,c);g.id=c.id;n.version=a.version;n.id=g.id;var m=new a.html5.model(n,g,p);var k=new a.html5.view(n,g,m);var l=new a.html5.controller(n,g,m,k);n.skin=new a.html5.skin();n.jwPlay=function(q){if(typeof q=="undefined"){f()}else{if(q.toString().toLowerCase()=="true"){l.play()}else{l.pause()}}};n.jwPause=function(q){if(typeof q=="undefined"){f()}else{if(q.toString().toLowerCase()=="true"){l.pause()}else{l.play()}}};function f(){if(m.state==a.api.events.state.PLAYING||m.state==a.api.events.state.BUFFERING){l.pause()}else{l.play()}}n.jwStop=l.stop;n.jwSeek=l.seek;n.jwPlaylistItem=function(q){if(d){if(d.playlistClickable()){d.jwInstreamDestroy();return l.item(q)}}else{return l.item(q)}};n.jwPlaylistNext=l.next;n.jwPlaylistPrev=l.prev;n.jwResize=l.resize;n.jwLoad=l.load;n.jwDetachMedia=l.detachMedia;n.jwAttachMedia=l.attachMedia;function j(q){return function(){return m[q]}}function e(q,s,r){return function(){var t=m.plugins.object[q];if(t&&t[s]&&typeof t[s]=="function"){t[s].apply(t,r)}}}n.jwGetPlaylistIndex=j("item");n.jwGetPosition=j("position");n.jwGetDuration=j("duration");n.jwGetBuffer=j("buffer");n.jwGetWidth=j("width");n.jwGetHeight=j("height");n.jwGetFullscreen=j("fullscreen");n.jwSetFullscreen=l.setFullscreen;n.jwGetVolume=j("volume");n.jwSetVolume=l.setVolume;n.jwGetMute=j("mute");n.jwSetMute=l.setMute;n.jwGetStretching=function(){return m.stretching.toUpperCase()};n.jwGetState=j("state");n.jwGetVersion=function(){return n.version};n.jwGetPlaylist=function(){return m.playlist};n.jwAddEventListener=l.addEventListener;n.jwRemoveEventListener=l.removeEventListener;n.jwSendEvent=l.sendEvent;n.jwDockSetButton=function(t,q,r,s){if(m.plugins.object.dock&&m.plugins.object.dock.setButton){m.plugins.object.dock.setButton(t,q,r,s)}};n.jwControlbarShow=e("controlbar","show");n.jwControlbarHide=e("controlbar","hide");n.jwDockShow=e("dock","show");n.jwDockHide=e("dock","hide");n.jwDisplayShow=e("display","show");n.jwDisplayHide=e("display","hide");var d;n.jwLoadInstream=function(r,q){if(!d){d=new a.html5.instream(n,m,k,l)}setTimeout(function(){d.load(r,q)},10)};n.jwInstreamDestroy=function(){if(d){d.jwInstreamDestroy()}};n.jwInstreamAddEventListener=o("jwInstreamAddEventListener");n.jwInstreamRemoveEventListener=o("jwInstreamRemoveEventListener");n.jwInstreamGetState=o("jwInstreamGetState");n.jwInstreamGetDuration=o("jwInstreamGetDuration");n.jwInstreamGetPosition=o("jwInstreamGetPosition");n.jwInstreamPlay=o("jwInstreamPlay");n.jwInstreamPause=o("jwInstreamPause");n.jwInstreamSeek=o("jwInstreamSeek");function o(q){return function(){if(d&&typeof d[q]=="function"){return d[q].apply(this,arguments)}else{_utils.log("Could not call instream method - instream API not initialized")}}}n.jwDestroy=function(){l.destroy()};n.jwGetLevel=function(){};n.jwGetBandwidth=function(){};n.jwGetLockState=function(){};n.jwLock=function(){};n.jwUnlock=function(){};function b(){if(m.config.playlistfile){m.addEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,h);m.loadPlaylist(m.config.playlistfile)}else{if(typeof m.config.playlist=="string"){m.addEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,h);m.loadPlaylist(m.config.playlist)}else{m.loadPlaylist(m.config);setTimeout(h,25)}}}function h(q){m.removeEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,h);m.setupPlugins();k.setup();var q={id:n.id,version:n.version};l.playerReady(q)}if(m.config.chromeless&&!a.utils.isIOS()){b()}else{n.skin.load(m.config.skin,b)}return n}})(jwplayer)};

/* SOURCE FILE: video_manager.js (72a5176e) 10/26/2014 1:27:06 PM */

var VideoManager = {};
VideoManager.parseData = function(link)
{
if (link == null) return null;
var getAttrib = function(name) {
return YUD.getAttribute(link, 'data-' + name) ||
YUD.getAttribute(link, name);
};
var autoplay = getAttrib('autoplay');
autoplay = (autoplay) ? (autoplay.toLowerCase() == 'true') : false;
var dialog = getAttrib('dialog');
dialog = (dialog) ? (dialog.toLowerCase() == 'true') : false;
var controls = getAttrib('controls');
controls = (controls) ? (controls.toLowerCase() == 'true') : true;
return {
autoplay: autoplay,
dialog: dialog,
controls: controls,
url: YUD.getAttribute(link, 'href'),
type: YUD.getAttribute(link, 'type'),
width: (getAttrib('width') * 1),
height: (getAttrib('height') * 1)
};
};
VideoManager.canPlay = function(url)
{
if (typeof jwplayer != 'function') return false;
if (!jwplayer.utils.exists(url)) return false;
var extension = jwplayer.utils.extension(url);
if (!jwplayer.utils.exists(extension)) return false;
if (extension == 'm4a') return false;
var extPlayers = jwplayer.utils.extensionmap[extension];
if (!jwplayer.utils.exists(extPlayers)) return false;
return (Util.String.startsWith(extPlayers.html5, 'video') ||
Util.String.startsWith(extPlayers.flash, 'video'));
};
VideoManager.embed = function(pageWin, linkVideo,zoomFactor)
{
if (typeof pageWin.jwplayer != 'function') return false;
var id = YUD.generateId().replace('yui', 'video');
linkVideo.setAttribute('id', id);
var flashPath = ContentManager.resolveBaseUrl('Scripts/Libraries/jwplayer/player.swf');
var skinPath = ContentManager.resolveBaseUrl('Scripts/Libraries/jwplayer/skins/simple/simple.zip');
var videoData = VideoManager.parseData(linkVideo);
var config = {
provider: 'video',
autostart: videoData.autoplay,
fullscreen: false,
skin: skinPath
};
if (!videoData.controls) {
config['controlbar.position'] = 'none';
}
if (videoData.width > 0 && videoData.height > 0) {
config.width = videoData.width;
config.height = videoData.height;
} else {
config.width = 400;
config.height = 226;
}
var createAnArray = function() {
return (typeof pageWin.createAnArray == 'function') ? pageWin.createAnArray() : [];
};
config.levels = createAnArray();
config.levels.push({ file: videoData.url, type: videoData.type });
config.modes = createAnArray();
config.modes.push({ type: 'html5' });
config.modes.push({ type: 'flash', src: flashPath });
config.logo = {
file: '',
link: ''
};
config.abouttext = '';
config.aboutlink = '';
var player = pageWin.jwplayer(linkVideo).setup(config);
if (zoomFactor) {
var zoomWidth = config.width * zoomFactor;
var zoomHeight = config.height * zoomFactor;
player.resize(zoomWidth, zoomHeight);
}
return player;
};
VideoManager.stop = function(page)
{
VideoManager.SWF.forEach(page, function(swfAPI)
{
swfAPI.stop();
});
var pageWin = page.getWin();
if (YAHOO.lang.isFunction(pageWin.jwplayer))
{
var players = pageWin.jwplayer.getPlayers();
for (var i = 0; i < players.length; i++)
{
var player = players[i];
if (player.getState() == 'PLAYING') player.pause();
}
}
};
VideoManager.openDialog = function(ev, pageLink,zoomFactor)
{
TDS.ToolManager.hideAll();
var id = 'video-' + Util.String.hashCode(pageLink.href);
var videoDialog = TDS.ToolManager.get(id);
if (videoDialog == null)
{
var header = pageLink.title || '';
videoDialog = TDS.ToolManager.createPanel(id, 'video', header);
videoDialog.body.innerHTML = '';
var aslLink = pageLink.cloneNode(true);
videoDialog.body.appendChild(aslLink);
var videoPlayer = VideoManager.embed(window, aslLink, zoomFactor);
videoDialog.showEvent.subscribe(function()
{
videoPlayer.play();
});
videoDialog.hideEvent.subscribe(function()
{
videoPlayer.stop();
});
videoDialog.refresh = function()
{
var width = videoPlayer.getWidth();
var height = videoPlayer.getHeight();
if (width > 0 && height > 0)
{
height += videoDialog.header.offsetHeight;
height += (YUD.getStyle(videoDialog.body, 'padding-top').replace('px', '') * 1);
height += (YUD.getStyle(videoDialog.body, 'padding-bottom').replace('px', '') * 1);
width += (YUD.getStyle(videoDialog.body, 'padding-left').replace('px', '') * 1);
width += (YUD.getStyle(videoDialog.body, 'padding-right').replace('px', '') * 1);
videoDialog.cfg.setProperty('width', width + 'px');
videoDialog.cfg.setProperty('height', height + 'px');
}
};
videoPlayer.onReady(function()
{
videoDialog.refresh();
TDS.ToolManager.bottomLeft(videoDialog);
});
}
videoDialog.show();
};
VideoManager.patchJWPlayer = function(player)
{
if (player.__tds_fixedOuterHTML !== true)
{
player.utils.setOuterHTML = Util.Dom.setOuterHTML;
player.__tds_fixedOuterHTML = true;
}
if (player.__tds_fixedExt !== true)
{
player.utils.extension = function(path)
{
if (!path) { return ""; }
path = path.substring(path.lastIndexOf("/") + 1, path.length);
var pathPieces = path.split("?");
path = pathPieces[0];
if (pathPieces.length > 1)
{
var querystring = Util.QueryString.parse(pathPieces[1]);
if (querystring.file != null) path = querystring.file;
}
if (path.lastIndexOf('.') > -1) {
return path.substr(path.lastIndexOf('.') + 1, path.length).toLowerCase();
}
return null;
};
player.__tds_fixedExt = true;
}
};
(function()
{
if (typeof window.jwplayer == 'function')
{
VideoManager.patchJWPlayer(window.jwplayer);
}
})();

/* SOURCE FILE: video_swf.js (3b97c6a6) 9/9/2014 2:09:05 PM */

VideoManager.SWF = function(embed, data)
{
this._embed = embed;
this._data = data;
this._ready = false;
};
VideoManager.SWF.parseData = function(link)
{
if (link == null) return null;
var getAttrib = function(name) {
return YUD.getAttribute(link, 'data-' + name) ||
YUD.getAttribute(link, name);
};
var width = (getAttrib('width') * 1);
var height = (getAttrib('height') * 1);
var autoplay = getAttrib('autoplay');
autoplay = (autoplay) ? (autoplay.toLowerCase() == 'true') : false;
var html5 = getAttrib('anim-html5');
html5 = (html5) ? (html5.toLowerCase() == 'true') : false;
var flash = getAttrib('anim-flash');
flash = (flash) ? (flash.toLowerCase() == 'true') : YUD.hasClass(link, 'flashvideo');
var shell = getAttrib('anim-shell');
if (shell) {
shell = (shell.toLowerCase() == 'true');
} else {
if (html5) {
shell = false;
} else if (flash) {
shell = true;
} else {
shell = false;
}
}
return {
url: YUD.getAttribute(link, 'href'),
type: YUD.getAttribute(link, 'type'),
width: width,
height: height,
autoplay: autoplay,
shell: shell,
html5: html5,
flash: flash
};
};
VideoManager.SWF.prototype.getElement = function() { return this._embed; };
VideoManager.SWF.prototype.autoplay = function() { return this._data.autoplay; };
VideoManager.SWF.prototype.isReady = function() { return this._ready; };
VideoManager.SWF.prototype.getStatus = function()
{
if (!YAHOO.lang.isFunction(this._embed.getStatus))
{
return 'uninitialized';
}
var status = this._embed.getStatus();
if (status == 'notstarted') status = 'initialized';
return status;
};
VideoManager.SWF.prototype.isLoaded = function()
{
if (this.isReady()) return true;
return (this.getStatus() != 'uninitialized');
};
VideoManager.SWF.prototype.setReady = function() { this._ready = true; };
VideoManager.SWF.prototype.isPlaying = function()
{
return (this.getStatus() == 'playing');
};
VideoManager.SWF.prototype.play = function()
{
if (!this.isReady()) return false;
if (this.isPlaying()) return false;
if (YAHOO.lang.isFunction(this._embed.JSPlay))
{
this._embed.JSPlay();
return true;
}
return false;
};
VideoManager.SWF.prototype.stop = function()
{
if (!this.isReady()) return false;
if (!this.isPlaying()) return false;
if (YAHOO.lang.isFunction(this._embed.JSStop))
{
this._embed.JSStop();
return true;
}
return false;
};
VideoManager.SWF.collection = new Util.Structs.Map();
VideoManager.SWF.Status =
{
LOADING: 'loading',
LOADED: 'loaded',
PLAYING: 'playing',
PAUSED: 'paused',
STOPPED: 'stopped'
};
VideoManager.SWF.Events = new Util.EventManager();
VideoManager.SWF._animationStatusChange = function()
{
var data = [];
if (arguments.length == 1)
{
data.push(null);
data.push(arguments[0]);
}
else if (arguments.length == 2)
{
data.push(arguments[0]);
data.push(arguments[1]);
}
if (data.length == 0) return;
if (data[1] == 'notstarted') data[1] = 'initialized';
YAHOO.lang.later(0, VideoManager.SWF, VideoManager.SWF.processStatusChange, data);
};
VideoManager.SWF.processStatusChange = function(id, status)
{
if (status == 'initialized')
{
var apis = VideoManager.SWF.collection.getValues();
for (var i = 0; i < apis.length; i++)
{
var swfAPI = apis[i];
if (!swfAPI.isReady() && swfAPI.isLoaded())
{
swfAPI.setReady();
VideoManager.SWF.Events.fire(VideoManager.SWF.Status.LOADED, swfAPI);
}
}
}
if (status == 'playing')
{
VideoManager.SWF.Events.fire(VideoManager.SWF.Status.PLAYING, null);
}
if (status == 'stopped')
{
VideoManager.SWF.Events.fire(VideoManager.SWF.Status.STOPPED, null);
}
};
VideoManager.SWF.embed = function(win, linkVideo, overrideAutoplay, disableShell)
{
if (!YAHOO.lang.isFunction(win.animationStatusChange))
{
win.animationStatusChange = VideoManager.SWF._animationStatusChange;
win.checkAutoPlay = function() { return false; };
}
var id = 'Animation-' + YAHOO.util.Dom.generateId();
var animData = VideoManager.SWF.parseData(linkVideo);
if (YAHOO.lang.isBoolean(overrideAutoplay)) animData.autoplay = overrideAutoplay;
var linkDoc = Util.Dom.getOwnerDocument(linkVideo);
var divVideo = linkDoc.createElement('div');
YUD.addClass(divVideo, 'AnimationContainer');
YUD.setStyle(divVideo, 'width', animData.width + 'px');
YUD.setStyle(divVideo, 'height', animData.height + 'px');
divVideo.innerHTML = this.createHtml(id, animData, disableShell);
YUD.insertAfter(divVideo, linkVideo);
var parentNode = linkVideo.parentNode;
if (parentNode) {
parentNode.removeChild(linkVideo);
}
var children = YUD.getChildren(divVideo);
var embed = (children && children.length > 0) ? children[0] : null;
VideoManager.SWF.stopRightClick(embed);
var swfAPI = new VideoManager.SWF(embed, animData);
VideoManager.SWF.collection.set(id, swfAPI);
VideoManager.SWF.Events.fire(VideoManager.SWF.Status.LOADING, swfAPI);
return swfAPI;
};
VideoManager.SWF.createHtml = function(id, animData, disableShell)
{
var wmode;
if (Util.Browser.isMac() && Util.Browser.getFirefoxVersion() == 2)
{
wmode = 'window';
}
else
{
wmode = 'opaque';
}
var embedBuilder = [];
embedBuilder.push('<embed');
embedBuilder.push('id="' + id + '"');
embedBuilder.push('type="application/x-shockwave-flash"');
if (disableShell || !animData.shell)
{
embedBuilder.push('src="' + animData.url + '"');
}
else
{
var shellPath = ContentManager.resolveBaseUrl('Scripts/Video/AnimationShell.swf');
var animPath = encodeURIComponent(animData.url);
var vars = 'animID=' + id + '&animURL=' + animPath;
embedBuilder.push('src="' + shellPath + '"');
embedBuilder.push('flashvars="' + vars + '"');
}
embedBuilder.push('width="100%"');
embedBuilder.push('height="100%"');
embedBuilder.push('play="' + animData.autoplay + '"');
embedBuilder.push('loop="false"');
embedBuilder.push('menu="false"');
embedBuilder.push('allowscriptaccess="always"');
embedBuilder.push('allowfullscreen="false"');
embedBuilder.push('quality="autohigh"');
embedBuilder.push('wmode="' + wmode + '"');
embedBuilder.push('></embed>');
return embedBuilder.join(' ');
};
VideoManager.SWF.forEach = function(page, fn)
{
var pageEl = page.getElement();
var pageEmbeds = pageEl.getElementsByTagName('embed');
for (var i = 0; i < pageEmbeds.length; i++)
{
var embed = pageEmbeds[i];
var swfAPI = VideoManager.SWF.collection.get(embed.id);
if (swfAPI != null)
{
try { fn(swfAPI); }
catch (ex) { Util.log('SWF ERROR: ' + ex); }
}
}
};
VideoManager.SWF.stopPlaying = function()
{
var page = ContentManager.getCurrentPage();
if (page == null) return;
VideoManager.SWF.forEach(page, function(api)
{
if (api.isPlaying()) api.stop();
});
};
VideoManager.SWF.stopRightClick = function(embed)
{
var flashDoc = Util.Dom.getOwnerDocument(embed);
var flashWin = (flashDoc.parentWindow || flashDoc.defaultView);
if (flashWin.addEventListener)
{
flashWin.addEventListener('mousedown', VideoManager.SWF._onGeckoMouse, true);
}
else
{
embed.onmouseup = function() { embed.releaseCapture(); };
}
};
VideoManager.SWF._onGeckoMouse = function(evt)
{
var target = YUE.getTarget(evt);
if (target && target.type == 'application/x-shockwave-flash' && evt.button != 0)
{
VideoManager.SWF._killEvents(evt);
}
};
VideoManager.SWF._killEvents = function(evt)
{
if (evt)
{
if (evt.stopPropagation) evt.stopPropagation();
if (evt.preventDefault) evt.preventDefault();
if (evt.preventCapture) evt.preventCapture();
if (evt.preventBubble) evt.preventBubble();
}
};

/* SOURCE FILE: module_video.js (e2795b33) 9/9/2014 2:08:51 PM */

(function() {
ContentManager.onPageEvent('available', function(page) {
var pageWin = page.getWin();
if (typeof pageWin.jwplayer == 'function') {
VideoManager.patchJWPlayer(pageWin.jwplayer);
}
});
ContentManager.onPageEvent('available', function(page) {
var pageEl = page.getElement();
var pageWin = page.getWin();
var pageLinks = pageEl.getElementsByTagName('a');
YUD.batch(pageLinks, function(pageLink) {
var animData = VideoManager.SWF.parseData(pageLink);
if (animData.flash) {
var videoLoader = new ResourceLoader.Binary(pageLink.href, 180000, 2);
videoLoader.subscribe(ResourceLoader.Status.COMPLETE, function() {
VideoManager.SWF.embed(pageWin, pageLink);
});
page.addResourceLoader(videoLoader);
}
else if (VideoManager.canPlay(pageLink.href)) {
var videoData = VideoManager.parseData(pageLink);
if (videoData.dialog) {
YUE.on(pageLink, 'click', VideoManager.openDialog, pageLink);
} else {
VideoManager.embed(pageWin, pageLink,page.getZoomFactor());
}
}
});
});
ContentManager.onPageEvent('show', function(page) {
VideoManager.SWF.forEach(page, function(swfAPI) {
if (swfAPI.autoplay()) {
swfAPI.play();
}
});
});
ContentManager.onPageEvent('hide', function(page) {
VideoManager.stop(page);
});
ContentManager.onPageEvent('zoom', function(page) {
if (page.getWin().jwplayer) {
var players = page.getWin().jwplayer.getPlayers();
for (var i = 0; i < players.length; i++) {
var player = players[i];
if (!player.config.width) {
player.config.width = player.getWidth();
}
if (!player.config.height) {
player.config.height = player.getHeight();
}
var zoomFactor = page.getZoomFactor();
if ((player.config.width > 0) && (player.config.height > 0)) {
var zoomWidth = (player.config.width * zoomFactor);
var zoomHeight = (player.config.height * zoomFactor);
player.resize(zoomWidth, zoomHeight);
}
}
}
});
VideoManager.SWF.Events.subscribe('loaded', function(swfAPI) {
var currentPage = ContentManager.getCurrentPage();
if (currentPage == null) {
return;
}
VideoManager.SWF.forEach(currentPage, function(pageSwfAPI) {
if (swfAPI == pageSwfAPI && swfAPI.autoplay()) {
swfAPI.play();
}
});
});
ContentManager.Dialog.onLoad.subscribe(function(frame) {
var frameWin = frame.getWindow();
var frameDoc = frame.getDocument();
if (Util.String.contains(frame.id, 'help')) {
var flashLinks = YUD.getElementsByClassName('flashvideo', 'a', frameDoc);
for (var i = 0; i < flashLinks.length; i++) {
if (flashLinks[i].parentNode) {
VideoManager.SWF.embed(frameWin, flashLinks[i], true, true);
}
}
}
});
ContentManager.Dialog.onShow.subscribe(function(dialogFrame) {
var dialogDoc = Util.Dom.getFrameContentDocument(dialogFrame);
YUD.batch(dialogDoc.getElementsByTagName('embed'), function(embed) {
if (typeof embed.Play == 'function') {
embed.Play();
}
});
});
ContentManager.Dialog.onHide.subscribe(function(dialogFrame) {
var dialogDoc = Util.Dom.getFrameContentDocument(dialogFrame);
YUD.batch(dialogDoc.getElementsByTagName('embed'), function(embed) {
if (typeof embed.Rewind == 'function') {
embed.Rewind();
}
});
});
VideoManager.SWF.Events.subscribe('playing', function() {
TTS.getInstance().stop();
});
})();

/* SOURCE FILE: spellcheck.js (d63bc2fe) 9/9/2014 2:09:05 PM */

var SpellCheck = function(handler, node)
{
this._handler = handler;
this._rootNode = node;
this._doc = Util.Dom.getOwnerDocument(node);
this._elementsInserted = 0;
this._wordElements = {};
this._splitRegex = new RegExp(
'([^' + SpellCheck.WORD_BOUNDARY_CHARS + ']*)' +
'([' + SpellCheck.WORD_BOUNDARY_CHARS + ']*)', 'g');
this.wordClassName = 'spellcheck-word';
this.invalidWordCssText = 'background: yellow;';
this.onCheckStart = new YAHOO.util.CustomEvent('onCheckStart', this, false, YAHOO.util.CustomEvent.FLAT);
this.onCheckCompleted = new YAHOO.util.CustomEvent('onCheckCompleted', this, false, YAHOO.util.CustomEvent.FLAT);
this.onDone = new YAHOO.util.CustomEvent('onDone', this, false, YAHOO.util.CustomEvent.FLAT);
this.onWordChange = new YAHOO.util.CustomEvent('onWordChange', this, false, YAHOO.util.CustomEvent.FLAT);
}
SpellCheck.WordStatus =
{
UNKNOWN: 0,
VALID: 1,
INVALID: 2,
IGNORED: 3,
CORRECTED: 4
};
SpellCheck.WORD_BOUNDARY_CHARS = '\t\r\n\u00A0 !\"#$%&()*+,\-.\/:;<=>?@\[\\\]^_`{|}~';
SpellCheck._KEY_PREFIX = ':';
SpellCheck.prototype.getWordElements = function()
{
var wordElements = [];
for (var wordKey in this._wordElements)
{
Util.Array.each(this._wordElements[wordKey], function(wordElement)
{
wordElements.push(wordElement);
});
}
return wordElements;
};
SpellCheck.prototype.check = function()
{
this.onCheckStart.fire();
var words = this._getWords(this._rootNode);
var sc = this;
this._handler.onDictionaryReady.subscribe(sc._onDictionaryReady, sc, true);
this._handler.lookupWords(words);
};
SpellCheck.prototype._onDictionaryReady = function()
{
this._handler.onDictionaryReady.unsubscribe(this._onDictionaryReady);
this._wordElements = {};
this._elementsInserted = 0;
this._processHtml(this._rootNode);
};
SpellCheck.prototype.done = function()
{
this._wordElements = {};
this._elementsInserted = 0;
this._restoreHtml(this._rootNode);
};
SpellCheck.prototype._getWords = function(node)
{
var words = [];
while (node)
{
var next = this._nextNode(node);
if (node.nodeType == Util.Dom.NodeType.TEXT)
{
if (node.nodeValue)
{
var parsedWords = this._parseWords(node.nodeValue);
for (var i = 0; i < parsedWords.length; i++) words.push(parsedWords[i]);
}
}
else if (node.nodeType == Util.Dom.NodeType.ELEMENT)
{
if (node.firstChild)
{
next = node.firstChild;
}
}
node = next;
}
return words;
};
SpellCheck.prototype._parseWords = function(text)
{
var words = [];
this._splitRegex.lastIndex = 0;
var result;
while (result = this._splitRegex.exec(text))
{
if (result[0].length == 0) break;
var word = result[1];
if (word)
{
words.push(word);
}
}
return words;
};
SpellCheck.prototype._processHtml = function(node)
{
while (node)
{
var next = this._nextNode(node);
if (node.nodeType == Util.Dom.NodeType.TEXT)
{
var deleteNode = true;
if (node.nodeValue)
{
var currentElements = this._elementsInserted;
this._processText(node, node.nodeValue);
if (currentElements == this._elementsInserted)
{
deleteNode = false;
}
}
if (deleteNode)
{
Util.Dom.removeNode(node);
}
}
else if (node.nodeType == Util.Dom.NodeType.ELEMENT)
{
if (node.className == this.wordClassName)
{
var runner = node.firstChild;
while (runner)
{
if (this._isTextLeaf(runner))
{
while (this._isTextLeaf(runner.nextSibling))
{
runner.nodeValue += runner.nextSibling.nodeValue;
Util.Dom.removeNode(runner.nextSibling);
}
}
runner = runner.nextSibling;
}
if (node.firstChild)
{
next = node.firstChild;
while (node.firstChild)
{
node.parentNode.insertBefore(node.firstChild, node);
}
}
Util.Dom.removeNode(node);
}
else
{
if (node.firstChild)
{
next = node.firstChild;
}
}
}
node = next;
}
};
SpellCheck.prototype._processText = function(node, text)
{
this._splitRegex.lastIndex = 0;
var stringSegmentStart = 0;
var result;
while (result = this._splitRegex.exec(text))
{
if (result[0].length == 0) break;
var word = result[1];
if (word)
{
var status = this._handler.checkWord(word);
if (status != SpellCheck.WordStatus.VALID)
{
var preceedingText = text.substr(stringSegmentStart, result.index - stringSegmentStart);
if (preceedingText)
{
this._processRange(node, preceedingText);
}
stringSegmentStart = result.index + word.length;
this._processWord(node, word, status);
}
}
}
var leftoverText = text.substr(stringSegmentStart);
if (leftoverText)
{
this._processRange(node, leftoverText);
}
return true;
};
SpellCheck.prototype._processRange = function(node, text)
{
if (node.nodeType == Util.Dom.NodeType.TEXT && node.nodeValue.length == text.length)
{
return;
}
node.parentNode.insertBefore(this._doc.createTextNode(text), node);
this._elementsInserted++;
};
SpellCheck.prototype._processWord = function(node, word, status)
{
var el = this._doc.createElement('a');
el.setAttribute('id', this.wordClassName + '-' + YUD.generateId());
el.setAttribute('href', '#');
YUD.addClass(el, this.wordClassName);
el.appendChild(this._doc.createTextNode(word));
this._registerWordElement(word, el);
node.parentNode.insertBefore(el, node);
this._elementsInserted++;
};
SpellCheck.prototype._restoreHtml = function(node)
{
while (node)
{
if (node.nodeType == Util.Dom.NodeType.ELEMENT && node.className == this.wordClassName)
{
var firstElement = node.firstChild;
var next;
for (var child = firstElement; child; child = next)
{
next = child.nextSibling;
node.parentNode.insertBefore(child, node);
}
next = firstElement || node.nextSibling;
Util.Dom.removeNode(node);
node = next;
continue;
}
var textLeaf = this._isTextLeaf(node);
if (textLeaf)
{
var textNodes = 1;
var next = node.nextSibling;
while (this._isTextLeaf(node.previousSibling))
{
node = node.previousSibling;
++textNodes;
}
while (this._isTextLeaf(next))
{
next = next.nextSibling;
++textNodes;
}
if (textNodes > 1)
{
var workBuffer = [];
workBuffer.push(node.nodeValue);
while (this._isTextLeaf(node.nextSibling))
{
workBuffer.push(node.nextSibling.nodeValue);
Util.Dom.removeNode(node.nextSibling);
}
node.nodeValue = workBuffer.join('');
}
}
if (node.firstChild)
{
this._restoreHtml(node.firstChild);
}
node = node.nextSibling;
}
};
SpellCheck.prototype.replaceWord = function(el, old, word)
{
if (old == word) return;
Util.Dom.setTextContent(el, word);
var status = SpellCheck.WordStatus.VALID;
var oldIndex = SpellCheck._toInternalKey(old);
var newIndex = SpellCheck._toInternalKey(word);
var elements = this._wordElements[oldIndex];
Util.Array.remove(elements, el);
if (status != SpellCheck.WordStatus.VALID)
{
if (this._wordElements[newIndex])
{
this._wordElements[newIndex].push(el);
}
else
{
this._wordElements[newIndex] = [el];
}
}
this.updateElement(el, word, status);
this.onWordChange.fire(
{
element: el,
word: word,
status: status
});
};
SpellCheck.prototype.updateElement = function(el, word, status)
{
if (status == SpellCheck.WordStatus.VALID)
{
this.removeMarkup(el);
}
else
{
Util.Dom.setProperties(el, this.getElementProperties(status));
}
};
SpellCheck.prototype.removeMarkup = function(el)
{
var firstChild = el.firstChild;
var text = firstChild.nodeValue;
if (el.nextSibling && el.nextSibling.nodeType == Util.Dom.NodeType.TEXT)
{
if (el.previousSibling && el.previousSibling.nodeType == Util.Dom.NodeType.TEXT)
{
el.previousSibling.nodeValue = el.previousSibling.nodeValue + text + el.nextSibling.nodeValue;
Util.Dom.removeNode(el.nextSibling);
}
else
{
el.nextSibling.nodeValue = text + el.nextSibling.nodeValue;
}
}
else if (el.previousSibling && el.previousSibling.nodeType == Util.Dom.NodeType.TEXT)
{
el.previousSibling.nodeValue += text;
}
else
{
el.parentNode.insertBefore(firstChild, el);
}
Util.Dom.removeNode(el);
};
SpellCheck.prototype._registerWordElement = function(word, el)
{
var index = SpellCheck._toInternalKey(word);
if (this._wordElements[index])
{
this._wordElements[index].push(el);
}
else
{
this._wordElements[index] = [el];
}
};
SpellCheck._toInternalKey = function(word)
{
if (word in Object.prototype)
{
return SpellCheck._KEY_PREFIX + word;
}
return word;
};
SpellCheck.prototype._nextNode = function(node)
{
while (node != this._rootNode)
{
if (node.nextSibling)
{
return node.nextSibling;
}
node = node.parentNode;
}
return null;
};
SpellCheck.prototype._isTextLeaf = function(node)
{
return node != null && node.nodeType == Util.Dom.NodeType.TEXT && !node.firstChild;
};
SpellCheck.prototype.getElementProperties = function(status)
{
return {
'class': this.wordClassName,
'style': (status == SpellCheck.WordStatus.INVALID) ? this.invalidWordCssText : ''
};
};

/* SOURCE FILE: spellcheck_manager.js (c281adaa) 9/9/2014 2:09:05 PM */

var SpellCheckManager =
{
_language: 'ENU',
_lookupInProgress: false,
_unknownWords: [],
_cache: {},
onDictionaryReady: new YAHOO.util.CustomEvent('onDictionaryReady', SpellCheckManager, false, YAHOO.util.CustomEvent.FLAT),
_mozDictionary: null,
_cacheHolder: [],
_dictionaryHolder: []
};
SpellCheckManager.getLanguage = function()
{
return this._language;
};
SpellCheckManager.setLanguage = function(lang) {
this._language = lang;
if (this._cacheHolder[lang.toLowerCase()] == null) {
this._cacheHolder[lang.toLowerCase()] = {};
}
if (this._dictionaryHolder[lang.toLowerCase()] == null) {
this._dictionaryHolder[lang.toLowerCase()] = new MozSpellChecker(lang.toLowerCase());
}
this._mozDictionary = this._dictionaryHolder[lang.toLowerCase()];
this._cache = this._cacheHolder[lang.toLowerCase()];
};
SpellCheckManager._getCachedWord = function(word)
{
if (YAHOO.lang.hasOwnProperty(this._cache, word))
{
return this._cache[word];
}
return null;
};
SpellCheckManager.getSuggestions = function(word)
{
var cacheEntry = this._getCachedWord(word);
if (cacheEntry)
{
return cacheEntry['suggestions'];
}
return null;
};
SpellCheckManager.checkWord = function(word)
{
var cacheEntry = this._getCachedWord(word);
if (!cacheEntry)
{
this._unknownWords.push(word);
return SpellCheck.WordStatus.UNKNOWN;
}
return cacheEntry['status'];
};
SpellCheckManager.lookupWords = function(words)
{
words = Util.Array.unique(words);
for (var i = 0; i < words.length; i++)
{
var word = words[i];
var status = this.checkWord(word);
}
if (this._unknownWords.length > 0)
{
this._lookupInProgress = true;
this.processWords();
return true;
}
this.onDictionaryReady.fire();
return false;
};
SpellCheckManager.processWords = function()
{
var text = this._unknownWords.join(' ');
SpellCheck.XHR.getErrors(this._language, text, function(spellingErrors)
{
SpellCheckManager._receivedWordErrors(spellingErrors);
});
};
SpellCheckManager._receivedWords = function(misspelledWords)
{
if (misspelledWords)
{
for (var i = 0; i < this._unknownWords.length; i++)
{
var unknownWord = this._unknownWords[i];
var isMisspelled = false;
for (var j = 0; j < misspelledWords.length; j++)
{
var misspelledWord = misspelledWords[j];
if (unknownWord == misspelledWord)
{
isMisspelled = true;
break;
}
}
this._cache[unknownWord] =
{
status: isMisspelled ? SpellCheck.WordStatus.INVALID : SpellCheck.WordStatus.VALID
};
}
}
this._lookupInProgress = false;
this._unknownWords = [];
this.onDictionaryReady.fire();
};
SpellCheckManager._receivedWordErrors = function(spellingErrors)
{
if (spellingErrors)
{
for (var i = 0; i < this._unknownWords.length; i++)
{
var unknownWord = this._unknownWords[i];
var isMisspelled = false;
var spellingError = null;
for (var j = 0; j < spellingErrors.length; j++)
{
spellingError = spellingErrors[j];
if (unknownWord == spellingError.word)
{
isMisspelled = true;
break;
}
}
if (isMisspelled)
{
this._cache[unknownWord] =
{
status: SpellCheck.WordStatus.INVALID,
suggestions: spellingError.suggestions
};
}
else
{
this._cache[unknownWord] =
{
status: SpellCheck.WordStatus.VALID,
suggestions: null
};
}
}
}
this._lookupInProgress = false;
this._unknownWords = [];
this.onDictionaryReady.fire();
};

/* SOURCE FILE: spellcheck_server.js (b88e6fe0) 9/9/2014 2:09:05 PM */

SpellCheck.XHR = { };
SpellCheck.XHR.onRequest = new YAHOO.util.CustomEvent('onRequest', SpellCheck.XHR, false, YAHOO.util.CustomEvent.FLAT),
SpellCheck.XHR.onComplete = new YAHOO.util.CustomEvent('onComplete', SpellCheck.XHR, false, YAHOO.util.CustomEvent.FLAT),
SpellCheck.XHR.onSuccess = new YAHOO.util.CustomEvent('onSuccess', SpellCheck.XHR, false, YAHOO.util.CustomEvent.FLAT),
SpellCheck.XHR.onFailure = new YAHOO.util.CustomEvent('onFailure', SpellCheck.XHR, false, YAHOO.util.CustomEvent.FLAT),
SpellCheck.XHR._encodeText = function(text)
{
return encodeURIComponent(text).replace(/%20/g, '+');
};
SpellCheck.XHR._sendRequest = function(action, language, text, success, failure)
{
var spellCheckSuccess = function(xhrObj)
{
SpellCheck.XHR.onComplete.fire();
SpellCheck.XHR.onSuccess.fire();
var contentType = xhrObj.getResponseHeader['Content-Type'];
var responseText = xhrObj.responseText;
var data = null;
if (contentType == 'text/plain')
{
data = xhrObj.responseText;
}
else if (contentType == 'application/json')
{
var jsonString = xhrObj.responseText;
data = YAHOO.lang.JSON.parse(jsonString);
}
if (typeof (success) == 'function')
{
success(action, data);
}
};
var spellCheckFailure = function(xhrObj)
{
SpellCheck.XHR.onComplete.fire();
SpellCheck.XHR.onFailure.fire();
if (typeof (failure) == 'function')
{
failure(xhrObj);
}
};
var callback =
{
success: spellCheckSuccess,
failure: spellCheckFailure,
timeout: 30000
};
var url = 'SpellEngine.axd/' + action + '?lang=' + language;
var postData = 'text=' + this._encodeText(text);
var id = YAHOO.util.Connect.asyncRequest('POST', url, callback, postData);
SpellCheck.XHR.onRequest.fire();
return id;
};
SpellCheck.XHR.checkWord = function(language, word, success, failure)
{
return SpellCheck.XHR._sendRequest('checkWord', language, word, function(action, data)
{
success(data);
});
};
SpellCheck.XHR.checkText = function(language, text, success, failure)
{
return SpellCheck.XHR._sendRequest('checkText', language, text, function(action, data)
{
success(data);
});
};
SpellCheck.XHR.getSuggestions = function(language, word, success, failure)
{
return SpellCheck.XHR._sendRequest('getSuggestions', language, word, function(action, data)
{
success(data);
});
};
SpellCheck.XHR.getErrors = function(language, text, success, failure)
{
return SpellCheck.XHR._sendRequest('getErrors', language, text, function(action, data)
{
success(data);
});
};

/* SOURCE FILE: spellcheck_mozilla.js (a1d3ac53) 9/9/2014 2:09:05 PM */

function MozSpellChecker(language) {
this._lang = (language.length > 2) ? language.substr(0, 2) : language;
this._spellCheckEngine = null;
this._dictionaryLoaded = false;
this._init = function() {
try {
if (typeof (Components) != "object") {
this._spellCheckEngine = null;
return;
}
var spellclass = "@mozilla.org/spellchecker/engine;1";
this._spellCheckEngine = Components.classes[spellclass].createInstance(Components.interfaces.mozISpellCheckingEngine);
} catch (ex) {
this._spellCheckEngine = null;
}
}
this._findDictionary = function(lang) {
if (this._spellCheckEngine != null && lang != null) {
var dictList = new Array();
var dictListLength = new Object();
this._spellCheckEngine.getDictionaryList(dictList, dictListLength);
for (var d = 0; d < dictListLength.value; d++) {
if (dictList.value[d] == lang)
return dictList.value[d];
}
var shortLang
if (lang.indexOf("-") > -1) {
shortLang = lang.substring(0, lang.indexOf("-"));
} else {
shortLang = lang;
}
for (var d = 0; d < dictListLength.value; d++) {
var shortLangDict
if (dictList.value[d].indexOf("-") > -1) {
shortLangDict = dictList.value[d].substring(0, dictList.value[d].indexOf("-"));
} else {
shortLangDict = dictList.value[d]
}
if (shortLangDict == shortLang)
return dictList.value[d];
}
}
return null;
}
this._load = function() {
this._init()
var dict = this._findDictionary(this._lang);
if (dict != null && this._spellCheckEngine != null) {
this._spellCheckEngine.dictionary = dict;
this._dictionaryLoaded = true;
return true;
}
return false;
}
this.availableForUse = function() {
return this._dictionaryLoaded;
}
this.checkSpelling = function(wordList, provideSuggestions) {
var errors = new Array();
var numErrors = 0, wordsChecked = 0;
var status = "ERROR";
var len = (wordList != null) ? wordList.length : 0;
if (this._dictionaryLoaded) {
status = "SUCCESS";
for (var i = 0; i < len; i++) {
var word = wordList[i];
wordsChecked++;
if (!this._spellCheckEngine.check(word)) {
var suggestions = {};
if (provideSuggestions) {
this._spellCheckEngine.suggest(word, suggestions, {});
}
errors[numErrors] = { "word": word, "suggestions": suggestions.value };
numErrors++;
}
}
}
return errors;
}
this._load();
}

/* SOURCE FILE: base.js (d7874a5f) 9/9/2014 2:09:01 PM */

(function(TDS) {
var Mode = {
Single: 'single',
Multiple: 'multiple'
}
var Orientation = {
Vertical: 'vertical',
Horizontal: 'horizontal',
Stacked: 'stacked',
StackedB: 'stackedb'
};
function MS(name, minChoices, maxChoices, orientation) {
Util.Event.Emitter(this);
this.name = name;
this.title = '';
this.prompt = '';
this.options = [];
this.minChoices = minChoices || 0;
this.maxChoices = maxChoices || 0;
this.mode = this.maxChoices === 1 ? Mode.Single : Mode.Multiple;
this.orientation = orientation || Orientation.Vertical;
}
MS.Mode = Mode;
MS.Orientation = Orientation;
Object.defineProperty(MS.prototype, 'selectedOptions', {
get: function() {
return this.options.filter(function(option) {
return option.selected === true;
});
}
});
Object.defineProperty(MS.prototype, 'selectedKeys', {
get: function() {
return this.selectedOptions.map(function(option) {
return option.key;
});
}
});
MS.prototype.createOption = function(key, html, feedback, soundLink) {
var option = this.getOption(key);
if (option) {
throw new Error('An option with the key \'' + key + '\' already exists.');
}
option = new MS.Option(this, key, html);
if (feedback) {
option.feedback = feedback;
}
if (soundLink) {
option.soundLink = soundLink;
}
this.options.push(option);
return option;
}
MS.prototype.getOption = function(key) {
return Util.Array.find(this.options, function(option) {
return option.key === key;
});
}
MS.prototype.select = function(key) {
var option = this.getOption(key);
if (option) {
return option.select();
}
return false;
}
MS.prototype.deselect = function(key) {
var option = this.getOption(key);
if (option) {
return option.deselect();
}
return false;
}
MS.prototype.shuffle = function() {
this.options = Util.Array.shuffle(this.options);
}
TDS.MultipleSelect = MS;
})(window.TDS);

/* SOURCE FILE: option.js (1b37962e) 9/9/2014 2:09:01 PM */

TDS = window.TDS || {};
(function(TDS) {
var MS = TDS.MultipleSelect;
var Mode = MS.Mode;
function Option(parent, key, html) {
Util.Event.Emitter(this);
this.parent = parent;
this.selected = false;
this.key = key;
this.html = html;
this.feedback = null;
this.soundLink = null;
}
Object.defineProperty(Option.prototype, 'value', {
get: function() {
var idx = this.parent.options.indexOf(this);
if (idx != -1) {
if (this.parent.mode == Mode.Single) {
return String.fromCharCode(idx + 65);
} else {
return (idx + 1) + '';
}
} else {
return '';
}
}
});
Option.prototype.select = function() {
if (this.selected) {
if (this.parent.mode == Mode.Multiple) {
return this.deselect();
} else {
return false;
}
}
var maxChoices = this.parent.maxChoices;
var selectedOptions = this.parent.selectedOptions;
var selectedCount = selectedOptions.length;
if (maxChoices === 1 && selectedCount > 0) {
selectedOptions[0].deselect();
} else if (maxChoices > 0 && maxChoices <= selectedCount) {
return false;
}
this.selected = true;
this.onChanged();
return true;
}
Option.prototype.deselect = function() {
if (!this.selected) {
return false;
}
this.selected = false;
this.onChanged();
return true;
}
Option.prototype.onChanged = function() {
if (this.selected) {
this.fire('selected');
} else {
this.fire('deselected');
}
}
Option.prototype.toString = function() {
return this.key;
}
MS.Option = Option;
})(window.TDS);

/* SOURCE FILE: renderer.js (2e891247) 9/9/2014 2:09:01 PM */

MS = TDS.MultipleSelect || {};
(function(MS) {
var Mode = MS.Mode;
var Orientation = MS.Orientation;
function Renderer(ms) {
Util.Assert.isInstanceOf(MS, ms);
this.ms = ms;
this.useTable = (ms.orientation == Orientation.Horizontal);
}
Renderer.prototype.render = function(parentEl) {
var containerEl = this.createContainer();
var promptEl = this.createPrompt();
if (promptEl) {
containerEl.appendChild(promptEl);
}
var groupEl = this.createGroup();
var optionEls = this.createOptions();
optionEls.forEach(function(optionEl) {
if (this.useTable) {
var cellEl = document.createElement('td');
cellEl.appendChild(optionEl);
groupEl.appendChild(cellEl);
} else {
groupEl.appendChild(optionEl);
}
}.bind(this));
containerEl.appendChild(groupEl);
if (this.useTable) {
var tableEl = document.createElement('table');
tableEl.className = 'flat';
tableEl.appendChild(containerEl);
containerEl = tableEl;
}
parentEl.appendChild(containerEl);
}
Renderer.prototype.createContainer = function() {
var containerTag = this.useTable ? 'tr' : 'div';
var containerEl = document.createElement(containerTag);
containerEl.className = 'optionsContainer';
if (this.ms.mode == Mode.Single) {
$(containerEl).addClass('format_mc');
} else {
$(containerEl).addClass('format_ms');
}
return containerEl;
}
Renderer.prototype.createGroup = function() {
var groupEl = document.createElement('div');
groupEl.className = 'optionsGroup';
return groupEl;
}
Renderer.prototype.createPrompt = function() {
if (this.ms.prompt) {
var promptEl = document.createElement('div');
promptEl.className = 'optionsPrompt';
promptEl.innerHTML = this.ms.prompt;
return promptEl;
} else {
return null;
}
}
Renderer.prototype.createOptions = function() {
var optionEls = [];
this.ms.options.forEach(function(option) {
var optionEl = this.createOption(option);
optionEls.push(optionEl);
}.bind(this));
return optionEls;
}
Renderer.prototype.createOption = function(option) {
var optionEl = document.createElement('div');
$(optionEl).addClass('optionContainer');
$(optionEl).addClass('option' + option.value);
if (option.selected) {
$(optionEl).addClass('optionSelected');
}
var strikeEl = document.createElement('span');
strikeEl.className = 'striked';
optionEl.appendChild(strikeEl);
var clickerEl = document.createElement('span');
clickerEl.className = 'optionClicker';
optionEl.appendChild(clickerEl);
var inputEl = document.createElement('input');
inputEl.className = 'option';
inputEl.name = this.ms.name;
inputEl.type = (this.ms.mode == Mode.Single) ? 'radio' : 'checkbox';
inputEl.value = option.value;
inputEl.checked = option.selected;
optionEl.appendChild(inputEl);
inputEl.setAttribute('aria-label', 'Option ' + option.value);
var contentEl = document.createElement('div');
contentEl.className = 'optionContent';
$(contentEl).html(option.html);
optionEl.appendChild(contentEl);
if (option.feedback) {
var feedbackEl = document.createElement('div');
feedbackEl.className = 'optionFeedback';
optionEl.appendChild(feedbackEl);
}
this.addOptionEvents(option, optionEl, inputEl);
return optionEl;
}
Renderer.prototype.addOptionEvents = function(option, optionEl, inputEl) {
option.on('selected', function() {
$(optionEl).addClass('optionSelected');
if (!inputEl.checked) {
inputEl.checked = true;
}
});
option.on('deselected', function() {
$(optionEl).removeClass('optionSelected');
if (inputEl.checked) {
inputEl.checked = false;
}
});
$(inputEl).change(function(evt) {
if (inputEl.checked) {
if (!option.select()) {
inputEl.checked = false;
}
} else {
option.deselect();
}
});
$(optionEl).click(function(evt) {
option.select();
});
$(inputEl).click(function(evt) {
evt.stopPropagation();
});
}
MS.Renderer = Renderer;
})(TDS.MultipleSelect);

/* SOURCE FILE: widget.js (a77bd7fb) 10/26/2014 1:27:05 PM */

(function (CM) {
var MS = TDS.MultipleSelect;
var Renderer = TDS.MultipleSelect.Renderer;
function parseQTI(interactionNode) {
var responseIdentifier = interactionNode.getAttribute('responseIdentifier');
var minChoices = interactionNode.getAttribute('minChoices') * 1;
var maxChoices = interactionNode.getAttribute('maxChoices') * 1;
var orientation = interactionNode.getAttribute('orientation');
var ms = new MS(responseIdentifier, minChoices, maxChoices, orientation);
var promptNode = Util.Dom.getElementByTagName('prompt', interactionNode);
if (promptNode) {
ms.prompt = Util.Xml.innerHTML(promptNode);
}
var simpleChoiceNodes = Util.Dom.getElementsByTagName('simpleChoice', interactionNode);
simpleChoiceNodes.forEach(function (simpleChoiceNode) {
var identifier = simpleChoiceNode.getAttribute('identifier');
var html = Util.Xml.innerHTML(simpleChoiceNode);
ms.createOption(identifier, html);
});
var shuffle = interactionNode.getAttribute('shuffle') === 'true';
if (shuffle) {
ms.shuffle();
}
return ms;
}
function parseITS() {
}
var match = CM.QTI.createWidgetMatch('choiceInteraction');
function Widget_MS(page, item, config) {
this.dataType = CM.DataType.Array;
this.options = {
autoLoad: true
}
this.ms = null;
}
CM.registerWidget('qti.choice', Widget_MS, match);
Widget_MS.prototype.load = function() {
var ms = parseQTI(this.config);
var renderer = new Renderer(ms);
renderer.render(this.element);
this.ms = ms;
}
Widget_MS.prototype.getResponse = function () {
var values = this.ms.selectedKeys;
var isValid = values.length > 0;
return this.createResponse(values, isValid);
}
Widget_MS.prototype.setResponse = function (values) {
values.forEach(function(value) {
this.ms.select(value);
}.bind(this));
}
})(window.ContentManager);

/* SOURCE FILE: ckeditor.js (8247573f) 9/9/2014 2:09:00 PM */

(function(){if(window.CKEDITOR&&window.CKEDITOR.dom)return;window.CKEDITOR||(window.CKEDITOR=function(){var a={timestamp:"E6FD",version:"4.4.3",revision:"fd4f17c",rnd:Math.floor(900*Math.random())+100,_:{pending:[]},status:"unloaded",basePath:function(){var a=window.CKEDITOR_BASEPATH||"";if(!a)for(var d=document.getElementsByTagName("script"),e=0;e<d.length;e++){var b=d[e].src.match(/(^|.*[\\\/])ckeditor(?:_basic)?(?:_source)?.js(?:\?.*)?$/i);if(b){a=b[1];break}}-1==a.indexOf(":/")&&"//"!=a.slice(0,2)&&(a=0===a.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+
a:location.href.match(/^[^\?]*\/(?:)/)[0]+a);if(!a)throw'The CKEditor installation path could not be automatically detected. Please set the global variable "CKEDITOR_BASEPATH" before creating editor instances.';return a}(),getUrl:function(a){-1==a.indexOf(":/")&&0!==a.indexOf("/")&&(a=this.basePath+a);this.timestamp&&("/"!=a.charAt(a.length-1)&&!/[&?]t=/.test(a))&&(a+=(0<=a.indexOf("?")?"&":"?")+"t="+this.timestamp);return a},domReady:function(){function a(){try{document.addEventListener?(document.removeEventListener("DOMContentLoaded",
a,!1),d()):document.attachEvent&&"complete"===document.readyState&&(document.detachEvent("onreadystatechange",a),d())}catch(e){}}function d(){for(var a;a=e.shift();)a()}var e=[];return function(d){e.push(d);"complete"===document.readyState&&setTimeout(a,1);if(1==e.length)if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",a);window.attachEvent("onload",a);d=!1;try{d=
!window.frameElement}catch(b){}if(document.documentElement.doScroll&&d){var c=function(){try{document.documentElement.doScroll("left")}catch(d){setTimeout(c,1);return}a()};c()}}}}()},c=window.CKEDITOR_GETURL;if(c){var b=a.getUrl;a.getUrl=function(f){return c.call(a,f)||b.call(a,f)}}return a}());
CKEDITOR.event||(CKEDITOR.event=function(){},CKEDITOR.event.implementOn=function(a){var c=CKEDITOR.event.prototype,b;for(b in c)a[b]==void 0&&(a[b]=c[b])},CKEDITOR.event.prototype=function(){function a(a){var d=c(this);return d[a]||(d[a]=new b(a))}var c=function(a){a=a.getPrivate&&a.getPrivate()||a._||(a._={});return a.events||(a.events={})},b=function(a){this.name=a;this.listeners=[]};b.prototype={getListenerIndex:function(a){for(var d=0,e=this.listeners;d<e.length;d++)if(e[d].fn==a)return d;return-1}};
return{define:function(b,d){var e=a.call(this,b);CKEDITOR.tools.extend(e,d,true)},on:function(b,d,e,c,n){function h(a,m,o,p){a={name:b,sender:this,editor:a,data:m,listenerData:c,stop:o,cancel:p,removeListener:i};return d.call(e,a)===false?false:a.data}function i(){p.removeListener(b,d)}var m=a.call(this,b);if(m.getListenerIndex(d)<0){m=m.listeners;e||(e=this);isNaN(n)&&(n=10);var p=this;h.fn=d;h.priority=n;for(var s=m.length-1;s>=0;s--)if(m[s].priority<=n){m.splice(s+1,0,h);return{removeListener:i}}m.unshift(h)}return{removeListener:i}},
once:function(){var a=arguments[1];arguments[1]=function(d){d.removeListener();return a.apply(this,arguments)};return this.on.apply(this,arguments)},capture:function(){CKEDITOR.event.useCapture=1;var a=this.on.apply(this,arguments);CKEDITOR.event.useCapture=0;return a},fire:function(){var a=0,d=function(){a=1},e=0,b=function(){e=1};return function(n,h,i){var m=c(this)[n],n=a,p=e;a=e=0;if(m){var s=m.listeners;if(s.length)for(var s=s.slice(0),x,q=0;q<s.length;q++){if(m.errorProof)try{x=s[q].call(this,
i,h,d,b)}catch(o){}else x=s[q].call(this,i,h,d,b);x===false?e=1:typeof x!="undefined"&&(h=x);if(a||e)break}}h=e?false:typeof h=="undefined"?true:h;a=n;e=p;return h}}(),fireOnce:function(a,d,e){d=this.fire(a,d,e);delete c(this)[a];return d},removeListener:function(a,d){var e=c(this)[a];if(e){var b=e.getListenerIndex(d);b>=0&&e.listeners.splice(b,1)}},removeAllListeners:function(){var a=c(this),d;for(d in a)delete a[d]},hasListeners:function(a){return(a=c(this)[a])&&a.listeners.length>0}}}());
CKEDITOR.editor||(CKEDITOR.editor=function(){CKEDITOR._.pending.push([this,arguments]);CKEDITOR.event.call(this)},CKEDITOR.editor.prototype.fire=function(a,c){a in{instanceReady:1,loaded:1}&&(this[a]=true);return CKEDITOR.event.prototype.fire.call(this,a,c,this)},CKEDITOR.editor.prototype.fireOnce=function(a,c){a in{instanceReady:1,loaded:1}&&(this[a]=true);return CKEDITOR.event.prototype.fireOnce.call(this,a,c,this)},CKEDITOR.event.implementOn(CKEDITOR.editor.prototype));
CKEDITOR.env||(CKEDITOR.env=function(){var a=navigator.userAgent.toLowerCase(),c={ie:a.indexOf("trident/")>-1,webkit:a.indexOf(" applewebkit/")>-1,air:a.indexOf(" adobeair/")>-1,mac:a.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"&&(!document.documentMode||document.documentMode<10),mobile:a.indexOf("mobile")>-1,iOS:/(ipad|iphone|ipod)/.test(a),isCustomDomain:function(){if(!this.ie)return false;var a=document.domain,e=window.location.hostname;return a!=e&&a!="["+e+"]"},secure:location.protocol==
"https:"};c.gecko=navigator.product=="Gecko"&&!c.webkit&&!c.ie;if(c.webkit)a.indexOf("chrome")>-1?c.chrome=true:c.safari=true;var b=0;if(c.ie){b=c.quirks||!document.documentMode?parseFloat(a.match(/msie (\d+)/)[1]):document.documentMode;c.ie9Compat=b==9;c.ie8Compat=b==8;c.ie7Compat=b==7;c.ie6Compat=b<7||c.quirks}if(c.gecko){var f=a.match(/rv:([\d\.]+)/);if(f){f=f[1].split(".");b=f[0]*1E4+(f[1]||0)*100+(f[2]||0)*1}}c.air&&(b=parseFloat(a.match(/ adobeair\/(\d+)/)[1]));c.webkit&&(b=parseFloat(a.match(/ applewebkit\/(\d+)/)[1]));
c.version=b;c.isCompatible=c.iOS&&b>=534||!c.mobile&&(c.ie&&b>6||c.gecko&&b>=2E4||c.air&&b>=1||c.webkit&&b>=522||false);c.hidpi=window.devicePixelRatio>=2;c.needsBrFiller=c.gecko||c.webkit||c.ie&&b>10;c.needsNbspFiller=c.ie&&b<11;c.cssClass="cke_browser_"+(c.ie?"ie":c.gecko?"gecko":c.webkit?"webkit":"unknown");if(c.quirks)c.cssClass=c.cssClass+" cke_browser_quirks";if(c.ie)c.cssClass=c.cssClass+(" cke_browser_ie"+(c.quirks?"6 cke_browser_iequirks":c.version));if(c.air)c.cssClass=c.cssClass+" cke_browser_air";
if(c.iOS)c.cssClass=c.cssClass+" cke_browser_ios";if(c.hidpi)c.cssClass=c.cssClass+" cke_hidpi";return c}());
"unloaded"==CKEDITOR.status&&function(){CKEDITOR.event.implementOn(CKEDITOR);CKEDITOR.loadFullCore=function(){if(CKEDITOR.status!="basic_ready")CKEDITOR.loadFullCore._load=1;else{delete CKEDITOR.loadFullCore;var a=document.createElement("script");a.type="text/javascript";a.src=CKEDITOR.basePath+"ckeditor.js";document.getElementsByTagName("head")[0].appendChild(a)}};CKEDITOR.loadFullCoreTimeout=0;CKEDITOR.add=function(a){(this._.pending||(this._.pending=[])).push(a)};(function(){CKEDITOR.domReady(function(){var a=
CKEDITOR.loadFullCore,c=CKEDITOR.loadFullCoreTimeout;if(a){CKEDITOR.status="basic_ready";a&&a._load?a():c&&setTimeout(function(){CKEDITOR.loadFullCore&&CKEDITOR.loadFullCore()},c*1E3)}})})();CKEDITOR.status="basic_loaded"}();CKEDITOR.dom={};
(function(){var a=[],c=CKEDITOR.env.gecko?"-moz-":CKEDITOR.env.webkit?"-webkit-":CKEDITOR.env.ie?"-ms-":"",b=/&/g,f=/>/g,d=/</g,e=/"/g,g=/&amp;/g,n=/&gt;/g,h=/&lt;/g,i=/&quot;/g;CKEDITOR.on("reset",function(){a=[]});CKEDITOR.tools={arrayCompare:function(a,d){if(!a&&!d)return true;if(!a||!d||a.length!=d.length)return false;for(var e=0;e<a.length;e++)if(a[e]!=d[e])return false;return true},clone:function(a){var d;if(a&&a instanceof Array){d=[];for(var e=0;e<a.length;e++)d[e]=CKEDITOR.tools.clone(a[e]);
return d}if(a===null||typeof a!="object"||a instanceof String||a instanceof Number||a instanceof Boolean||a instanceof Date||a instanceof RegExp||a.nodeType||a.window===a)return a;d=new a.constructor;for(e in a)d[e]=CKEDITOR.tools.clone(a[e]);return d},capitalize:function(a,d){return a.charAt(0).toUpperCase()+(d?a.slice(1):a.slice(1).toLowerCase())},extend:function(a){var d=arguments.length,e,b;if(typeof(e=arguments[d-1])=="boolean")d--;else if(typeof(e=arguments[d-2])=="boolean"){b=arguments[d-1];
d=d-2}for(var c=1;c<d;c++){var o=arguments[c],f;for(f in o)if(e===true||a[f]==void 0)if(!b||f in b)a[f]=o[f]}return a},prototypedCopy:function(a){var d=function(){};d.prototype=a;return new d},copy:function(a){var d={},e;for(e in a)d[e]=a[e];return d},isArray:function(a){return Object.prototype.toString.call(a)=="[object Array]"},isEmpty:function(a){for(var d in a)if(a.hasOwnProperty(d))return false;return true},cssVendorPrefix:function(a,d,e){if(e)return c+a+":"+d+";"+a+":"+d;e={};e[a]=d;e[c+a]=
d;return e},cssStyleToDomStyle:function(){var a=document.createElement("div").style,d=typeof a.cssFloat!="undefined"?"cssFloat":typeof a.styleFloat!="undefined"?"styleFloat":"float";return function(a){return a=="float"?d:a.replace(/-./g,function(a){return a.substr(1).toUpperCase()})}}(),buildStyleHtml:function(a){for(var a=[].concat(a),d,e=[],b=0;b<a.length;b++)if(d=a[b])/@import|[{}]/.test(d)?e.push("<style>"+d+"</style>"):e.push('<link type="text/css" rel=stylesheet href="'+d+'">');return e.join("")},
htmlEncode:function(a){return(""+a).replace(b,"&amp;").replace(f,"&gt;").replace(d,"&lt;")},htmlDecode:function(a){return a.replace(g,"&").replace(n,">").replace(h,"<")},htmlEncodeAttr:function(a){return a.replace(e,"&quot;").replace(d,"&lt;").replace(f,"&gt;")},htmlDecodeAttr:function(a){return a.replace(i,'"').replace(h,"<").replace(n,">")},getNextNumber:function(){var a=0;return function(){return++a}}(),getNextId:function(){return"cke_"+this.getNextNumber()},override:function(a,d){var e=d(a);e.prototype=
a.prototype;return e},setTimeout:function(a,d,e,b,c){c||(c=window);e||(e=c);return c.setTimeout(function(){b?a.apply(e,[].concat(b)):a.apply(e)},d||0)},trim:function(){var a=/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g;return function(d){return d.replace(a,"")}}(),ltrim:function(){var a=/^[ \t\n\r]+/g;return function(d){return d.replace(a,"")}}(),rtrim:function(){var a=/[ \t\n\r]+$/g;return function(d){return d.replace(a,"")}}(),indexOf:function(a,d){if(typeof d=="function")for(var e=0,b=a.length;e<b;e++){if(d(a[e]))return e}else{if(a.indexOf)return a.indexOf(d);
e=0;for(b=a.length;e<b;e++)if(a[e]===d)return e}return-1},search:function(a,d){var e=CKEDITOR.tools.indexOf(a,d);return e>=0?a[e]:null},bind:function(a,d){return function(){return a.apply(d,arguments)}},createClass:function(a){var d=a.$,e=a.base,b=a.privates||a._,c=a.proto,a=a.statics;!d&&(d=function(){e&&this.base.apply(this,arguments)});if(b)var o=d,d=function(){var a=this._||(this._={}),d;for(d in b){var e=b[d];a[d]=typeof e=="function"?CKEDITOR.tools.bind(e,this):e}o.apply(this,arguments)};if(e){d.prototype=
this.prototypedCopy(e.prototype);d.prototype.constructor=d;d.base=e;d.baseProto=e.prototype;d.prototype.base=function(){this.base=e.prototype.base;e.apply(this,arguments);this.base=arguments.callee}}c&&this.extend(d.prototype,c,true);a&&this.extend(d,a,true);return d},addFunction:function(d,e){return a.push(function(){return d.apply(e||this,arguments)})-1},removeFunction:function(d){a[d]=null},callFunction:function(d){var e=a[d];return e&&e.apply(window,Array.prototype.slice.call(arguments,1))},cssLength:function(){var a=
/^-?\d+\.?\d*px$/,d;return function(e){d=CKEDITOR.tools.trim(e+"")+"px";return a.test(d)?d:e||""}}(),convertToPx:function(){var a;return function(d){if(!a){a=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(a)}if(!/%$/.test(d)){a.setStyle("width",d);return a.$.clientWidth}return d}}(),repeat:function(a,d){return Array(d+1).join(a)},tryThese:function(){for(var a,
d=0,e=arguments.length;d<e;d++){var b=arguments[d];try{a=b();break}catch(c){}}return a},genKey:function(){return Array.prototype.slice.call(arguments).join("-")},defer:function(a){return function(){var d=arguments,e=this;window.setTimeout(function(){a.apply(e,d)},0)}},normalizeCssText:function(a,d){var e=[],b,c=CKEDITOR.tools.parseCssText(a,true,d);for(b in c)e.push(b+":"+c[b]);e.sort();return e.length?e.join(";")+";":""},convertRgbToHex:function(a){return a.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,
function(a,d,e,b){a=[d,e,b];for(d=0;d<3;d++)a[d]=("0"+parseInt(a[d],10).toString(16)).slice(-2);return"#"+a.join("")})},parseCssText:function(a,d,e){var b={};if(e){e=new CKEDITOR.dom.element("span");e.setAttribute("style",a);a=CKEDITOR.tools.convertRgbToHex(e.getAttribute("style")||"")}if(!a||a==";")return b;a.replace(/&quot;/g,'"').replace(/\s*([^:;\s]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,e,m){if(d){e=e.toLowerCase();e=="font-family"&&(m=m.toLowerCase().replace(/["']/g,"").replace(/\s*,\s*/g,","));
m=CKEDITOR.tools.trim(m)}b[e]=m});return b},writeCssText:function(a,d){var e,b=[];for(e in a)b.push(e+":"+a[e]);d&&b.sort();return b.join("; ")},objectCompare:function(a,d,e){var b;if(!a&&!d)return true;if(!a||!d)return false;for(b in a)if(a[b]!=d[b])return false;if(!e)for(b in d)if(a[b]!=d[b])return false;return true},objectKeys:function(a){var d=[],e;for(e in a)d.push(e);return d},convertArrayToObject:function(a,d){var e={};arguments.length==1&&(d=true);for(var b=0,c=a.length;b<c;++b)e[a[b]]=d;
return e},fixDomain:function(){for(var a;;)try{a=window.parent.document.domain;break}catch(d){a=a?a.replace(/.+?(?:\.|$)/,""):document.domain;if(!a)break;document.domain=a}return!!a},eventsBuffer:function(a,d){function e(){c=(new Date).getTime();b=false;d()}var b,c=0;return{input:function(){if(!b){var d=(new Date).getTime()-c;d<a?b=setTimeout(e,a-d):e()}},reset:function(){b&&clearTimeout(b);b=c=0}}},enableHtml5Elements:function(a,d){for(var e=["abbr","article","aside","audio","bdi","canvas","data",
"datalist","details","figcaption","figure","footer","header","hgroup","mark","meter","nav","output","progress","section","summary","time","video"],b=e.length,c;b--;){c=a.createElement(e[b]);d&&a.appendChild(c)}},checkIfAnyArrayItemMatches:function(a,d){for(var e=0,b=a.length;e<b;++e)if(a[e].match(d))return true;return false},checkIfAnyObjectPropertyMatches:function(a,d){for(var e in a)if(e.match(d))return true;return false},transparentImageData:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="}})();
CKEDITOR.dtd=function(){var a=CKEDITOR.tools.extend,c=function(a,d){for(var e=CKEDITOR.tools.clone(a),b=1;b<arguments.length;b++){var d=arguments[b],c;for(c in d)delete e[c]}return e},b={},f={},d={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},e={command:1,link:1,meta:1,noscript:1,script:1,style:1},g={},n={"#":1},h={center:1,dir:1,noframes:1};
a(b,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,"var":1,video:1,wbr:1},n,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1});a(f,d,b,h);c={a:c(b,{a:1,button:1}),abbr:b,address:f,
area:g,article:a({style:1},f),aside:a({style:1},f),audio:a({source:1,track:1},f),b:b,base:g,bdi:b,bdo:b,blockquote:f,body:f,br:g,button:c(b,{a:1,button:1}),canvas:b,caption:f,cite:b,code:b,col:g,colgroup:{col:1},command:g,datalist:a({option:1},b),dd:f,del:b,details:a({summary:1},f),dfn:b,div:a({style:1},f),dl:{dt:1,dd:1},dt:f,em:b,embed:g,fieldset:a({legend:1},f),figcaption:f,figure:a({figcaption:1},f),footer:f,form:f,h1:b,h2:b,h3:b,h4:b,h5:b,h6:b,head:a({title:1,base:1},e),header:f,hgroup:{h1:1,
h2:1,h3:1,h4:1,h5:1,h6:1},hr:g,html:a({head:1,body:1},f,e),i:b,iframe:n,img:g,input:g,ins:b,kbd:b,keygen:g,label:b,legend:b,li:f,link:g,map:f,mark:b,menu:a({li:1},f),meta:g,meter:c(b,{meter:1}),nav:f,noscript:a({link:1,meta:1,style:1},b),object:a({param:1},b),ol:{li:1},optgroup:{option:1},option:n,output:b,p:b,param:g,pre:b,progress:c(b,{progress:1}),q:b,rp:b,rt:b,ruby:a({rp:1,rt:1},b),s:b,samp:b,script:n,section:a({style:1},f),select:{optgroup:1,option:1},small:b,source:g,span:b,strong:b,style:n,
sub:b,summary:b,sup:b,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:f,textarea:n,tfoot:{tr:1},th:f,thead:{tr:1},time:c(b,{time:1}),title:n,tr:{th:1,td:1},track:g,u:b,ul:{li:1},"var":b,video:a({source:1,track:1},f),wbr:g,acronym:b,applet:a({param:1},f),basefont:g,big:b,center:f,dialog:g,dir:{li:1},font:b,isindex:g,noframes:f,strike:b,tt:b};a(c,{$block:a({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},d,h),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,
div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,
wbr:1},$inline:b,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:a({body:1,head:1,html:1},c.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,
small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}});return c}();
CKEDITOR.dom.event=function(a){this.$=a};
CKEDITOR.dom.event.prototype={getKey:function(){return this.$.keyCode||this.$.which},getKeystroke:function(){var a=this.getKey();if(this.$.ctrlKey||this.$.metaKey)a=a+CKEDITOR.CTRL;this.$.shiftKey&&(a=a+CKEDITOR.SHIFT);this.$.altKey&&(a=a+CKEDITOR.ALT);return a},preventDefault:function(a){var c=this.$;c.preventDefault?c.preventDefault():c.returnValue=false;a&&this.stopPropagation()},stopPropagation:function(){var a=this.$;a.stopPropagation?a.stopPropagation():a.cancelBubble=true},getTarget:function(){var a=
this.$.target||this.$.srcElement;return a?new CKEDITOR.dom.node(a):null},getPhase:function(){return this.$.eventPhase||2},getPageOffset:function(){var a=this.getTarget().getDocument().$;return{x:this.$.pageX||this.$.clientX+(a.documentElement.scrollLeft||a.body.scrollLeft),y:this.$.pageY||this.$.clientY+(a.documentElement.scrollTop||a.body.scrollTop)}}};CKEDITOR.CTRL=1114112;CKEDITOR.SHIFT=2228224;CKEDITOR.ALT=4456448;CKEDITOR.EVENT_PHASE_CAPTURING=1;CKEDITOR.EVENT_PHASE_AT_TARGET=2;
CKEDITOR.EVENT_PHASE_BUBBLING=3;CKEDITOR.dom.domObject=function(a){if(a)this.$=a};
CKEDITOR.dom.domObject.prototype=function(){var a=function(a,b){return function(f){typeof CKEDITOR!="undefined"&&a.fire(b,new CKEDITOR.dom.event(f))}};return{getPrivate:function(){var a;if(!(a=this.getCustomData("_")))this.setCustomData("_",a={});return a},on:function(c){var b=this.getCustomData("_cke_nativeListeners");if(!b){b={};this.setCustomData("_cke_nativeListeners",b)}if(!b[c]){b=b[c]=a(this,c);this.$.addEventListener?this.$.addEventListener(c,b,!!CKEDITOR.event.useCapture):this.$.attachEvent&&
this.$.attachEvent("on"+c,b)}return CKEDITOR.event.prototype.on.apply(this,arguments)},removeListener:function(a){CKEDITOR.event.prototype.removeListener.apply(this,arguments);if(!this.hasListeners(a)){var b=this.getCustomData("_cke_nativeListeners"),f=b&&b[a];if(f){this.$.removeEventListener?this.$.removeEventListener(a,f,false):this.$.detachEvent&&this.$.detachEvent("on"+a,f);delete b[a]}}},removeAllListeners:function(){var a=this.getCustomData("_cke_nativeListeners"),b;for(b in a){var f=a[b];this.$.detachEvent?
this.$.detachEvent("on"+b,f):this.$.removeEventListener&&this.$.removeEventListener(b,f,false);delete a[b]}CKEDITOR.event.prototype.removeAllListeners.call(this)}}}();
(function(a){var c={};CKEDITOR.on("reset",function(){c={}});a.equals=function(a){try{return a&&a.$===this.$}catch(c){return false}};a.setCustomData=function(a,f){var d=this.getUniqueId();(c[d]||(c[d]={}))[a]=f;return this};a.getCustomData=function(a){var f=this.$["data-cke-expando"];return(f=f&&c[f])&&a in f?f[a]:null};a.removeCustomData=function(a){var f=this.$["data-cke-expando"],f=f&&c[f],d,e;if(f){d=f[a];e=a in f;delete f[a]}return e?d:null};a.clearCustomData=function(){this.removeAllListeners();
var a=this.$["data-cke-expando"];a&&delete c[a]};a.getUniqueId=function(){return this.$["data-cke-expando"]||(this.$["data-cke-expando"]=CKEDITOR.tools.getNextNumber())};CKEDITOR.event.implementOn(a)})(CKEDITOR.dom.domObject.prototype);
CKEDITOR.dom.node=function(a){return a?new CKEDITOR.dom[a.nodeType==CKEDITOR.NODE_DOCUMENT?"document":a.nodeType==CKEDITOR.NODE_ELEMENT?"element":a.nodeType==CKEDITOR.NODE_TEXT?"text":a.nodeType==CKEDITOR.NODE_COMMENT?"comment":a.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT?"documentFragment":"domObject"](a):this};CKEDITOR.dom.node.prototype=new CKEDITOR.dom.domObject;CKEDITOR.NODE_ELEMENT=1;CKEDITOR.NODE_DOCUMENT=9;CKEDITOR.NODE_TEXT=3;CKEDITOR.NODE_COMMENT=8;CKEDITOR.NODE_DOCUMENT_FRAGMENT=11;
CKEDITOR.POSITION_IDENTICAL=0;CKEDITOR.POSITION_DISCONNECTED=1;CKEDITOR.POSITION_FOLLOWING=2;CKEDITOR.POSITION_PRECEDING=4;CKEDITOR.POSITION_IS_CONTAINED=8;CKEDITOR.POSITION_CONTAINS=16;
CKEDITOR.tools.extend(CKEDITOR.dom.node.prototype,{appendTo:function(a,c){a.append(this,c);return a},clone:function(a,c){var b=this.$.cloneNode(a),f=function(d){d["data-cke-expando"]&&(d["data-cke-expando"]=false);if(d.nodeType==CKEDITOR.NODE_ELEMENT){c||d.removeAttribute("id",false);if(a)for(var d=d.childNodes,e=0;e<d.length;e++)f(d[e])}};f(b);return new CKEDITOR.dom.node(b)},hasPrevious:function(){return!!this.$.previousSibling},hasNext:function(){return!!this.$.nextSibling},insertAfter:function(a){a.$.parentNode.insertBefore(this.$,
a.$.nextSibling);return a},insertBefore:function(a){a.$.parentNode.insertBefore(this.$,a.$);return a},insertBeforeMe:function(a){this.$.parentNode.insertBefore(a.$,this.$);return a},getAddress:function(a){for(var c=[],b=this.getDocument().$.documentElement,f=this.$;f&&f!=b;){var d=f.parentNode;d&&c.unshift(this.getIndex.call({$:f},a));f=d}return c},getDocument:function(){return new CKEDITOR.dom.document(this.$.ownerDocument||this.$.parentNode.ownerDocument)},getIndex:function(a){var c=this.$,b=-1,
f;if(!this.$.parentNode)return b;do if(!a||!(c!=this.$&&c.nodeType==CKEDITOR.NODE_TEXT&&(f||!c.nodeValue))){b++;f=c.nodeType==CKEDITOR.NODE_TEXT}while(c=c.previousSibling);return b},getNextSourceNode:function(a,c,b){if(b&&!b.call)var f=b,b=function(a){return!a.equals(f)};var a=!a&&this.getFirst&&this.getFirst(),d;if(!a){if(this.type==CKEDITOR.NODE_ELEMENT&&b&&b(this,true)===false)return null;a=this.getNext()}for(;!a&&(d=(d||this).getParent());){if(b&&b(d,true)===false)return null;a=d.getNext()}return!a||
b&&b(a)===false?null:c&&c!=a.type?a.getNextSourceNode(false,c,b):a},getPreviousSourceNode:function(a,c,b){if(b&&!b.call)var f=b,b=function(a){return!a.equals(f)};var a=!a&&this.getLast&&this.getLast(),d;if(!a){if(this.type==CKEDITOR.NODE_ELEMENT&&b&&b(this,true)===false)return null;a=this.getPrevious()}for(;!a&&(d=(d||this).getParent());){if(b&&b(d,true)===false)return null;a=d.getPrevious()}return!a||b&&b(a)===false?null:c&&a.type!=c?a.getPreviousSourceNode(false,c,b):a},getPrevious:function(a){var c=
this.$,b;do b=(c=c.previousSibling)&&c.nodeType!=10&&new CKEDITOR.dom.node(c);while(b&&a&&!a(b));return b},getNext:function(a){var c=this.$,b;do b=(c=c.nextSibling)&&new CKEDITOR.dom.node(c);while(b&&a&&!a(b));return b},getParent:function(a){var c=this.$.parentNode;return c&&(c.nodeType==CKEDITOR.NODE_ELEMENT||a&&c.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT)?new CKEDITOR.dom.node(c):null},getParents:function(a){var c=this,b=[];do b[a?"push":"unshift"](c);while(c=c.getParent());return b},getCommonAncestor:function(a){if(a.equals(this))return this;
if(a.contains&&a.contains(this))return a;var c=this.contains?this:this.getParent();do if(c.contains(a))return c;while(c=c.getParent());return null},getPosition:function(a){var c=this.$,b=a.$;if(c.compareDocumentPosition)return c.compareDocumentPosition(b);if(c==b)return CKEDITOR.POSITION_IDENTICAL;if(this.type==CKEDITOR.NODE_ELEMENT&&a.type==CKEDITOR.NODE_ELEMENT){if(c.contains){if(c.contains(b))return CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING;if(b.contains(c))return CKEDITOR.POSITION_IS_CONTAINED+
CKEDITOR.POSITION_FOLLOWING}if("sourceIndex"in c)return c.sourceIndex<0||b.sourceIndex<0?CKEDITOR.POSITION_DISCONNECTED:c.sourceIndex<b.sourceIndex?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING}for(var c=this.getAddress(),a=a.getAddress(),b=Math.min(c.length,a.length),f=0;f<=b-1;f++)if(c[f]!=a[f]){if(f<b)return c[f]<a[f]?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING;break}return c.length<a.length?CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_IS_CONTAINED+
CKEDITOR.POSITION_FOLLOWING},getAscendant:function(a,c){var b=this.$,f;if(!c)b=b.parentNode;for(;b;){if(b.nodeName&&(f=b.nodeName.toLowerCase(),typeof a=="string"?f==a:f in a))return new CKEDITOR.dom.node(b);try{b=b.parentNode}catch(d){b=null}}return null},hasAscendant:function(a,c){var b=this.$;if(!c)b=b.parentNode;for(;b;){if(b.nodeName&&b.nodeName.toLowerCase()==a)return true;b=b.parentNode}return false},move:function(a,c){a.append(this.remove(),c)},remove:function(a){var c=this.$,b=c.parentNode;
if(b){if(a)for(;a=c.firstChild;)b.insertBefore(c.removeChild(a),c);b.removeChild(c)}return this},replace:function(a){this.insertBefore(a);a.remove()},trim:function(){this.ltrim();this.rtrim()},ltrim:function(){for(var a;this.getFirst&&(a=this.getFirst());){if(a.type==CKEDITOR.NODE_TEXT){var c=CKEDITOR.tools.ltrim(a.getText()),b=a.getLength();if(c){if(c.length<b){a.split(b-c.length);this.$.removeChild(this.$.firstChild)}}else{a.remove();continue}}break}},rtrim:function(){for(var a;this.getLast&&(a=
this.getLast());){if(a.type==CKEDITOR.NODE_TEXT){var c=CKEDITOR.tools.rtrim(a.getText()),b=a.getLength();if(c){if(c.length<b){a.split(c.length);this.$.lastChild.parentNode.removeChild(this.$.lastChild)}}else{a.remove();continue}}break}if(CKEDITOR.env.needsBrFiller)(a=this.$.lastChild)&&(a.type==1&&a.nodeName.toLowerCase()=="br")&&a.parentNode.removeChild(a)},isReadOnly:function(){var a=this;this.type!=CKEDITOR.NODE_ELEMENT&&(a=this.getParent());if(a&&typeof a.$.isContentEditable!="undefined")return!(a.$.isContentEditable||
a.data("cke-editable"));for(;a;){if(a.data("cke-editable"))break;if(a.getAttribute("contentEditable")=="false")return true;if(a.getAttribute("contentEditable")=="true")break;a=a.getParent()}return!a}});CKEDITOR.dom.window=function(a){CKEDITOR.dom.domObject.call(this,a)};CKEDITOR.dom.window.prototype=new CKEDITOR.dom.domObject;
CKEDITOR.tools.extend(CKEDITOR.dom.window.prototype,{focus:function(){this.$.focus()},getViewPaneSize:function(){var a=this.$.document,c=a.compatMode=="CSS1Compat";return{width:(c?a.documentElement.clientWidth:a.body.clientWidth)||0,height:(c?a.documentElement.clientHeight:a.body.clientHeight)||0}},getScrollPosition:function(){var a=this.$;if("pageXOffset"in a)return{x:a.pageXOffset||0,y:a.pageYOffset||0};a=a.document;return{x:a.documentElement.scrollLeft||a.body.scrollLeft||0,y:a.documentElement.scrollTop||
a.body.scrollTop||0}},getFrame:function(){var a=this.$.frameElement;return a?new CKEDITOR.dom.element.get(a):null}});CKEDITOR.dom.document=function(a){CKEDITOR.dom.domObject.call(this,a)};CKEDITOR.dom.document.prototype=new CKEDITOR.dom.domObject;
CKEDITOR.tools.extend(CKEDITOR.dom.document.prototype,{type:CKEDITOR.NODE_DOCUMENT,appendStyleSheet:function(a){if(this.$.createStyleSheet)this.$.createStyleSheet(a);else{var c=new CKEDITOR.dom.element("link");c.setAttributes({rel:"stylesheet",type:"text/css",href:a});this.getHead().append(c)}},appendStyleText:function(a){if(this.$.createStyleSheet){var c=this.$.createStyleSheet("");c.cssText=a}else{var b=new CKEDITOR.dom.element("style",this);b.append(new CKEDITOR.dom.text(a,this));this.getHead().append(b)}return c||
b.$.sheet},createElement:function(a,c){var b=new CKEDITOR.dom.element(a,this);if(c){c.attributes&&b.setAttributes(c.attributes);c.styles&&b.setStyles(c.styles)}return b},createText:function(a){return new CKEDITOR.dom.text(a,this)},focus:function(){this.getWindow().focus()},getActive:function(){return new CKEDITOR.dom.element(this.$.activeElement)},getById:function(a){return(a=this.$.getElementById(a))?new CKEDITOR.dom.element(a):null},getByAddress:function(a,c){for(var b=this.$.documentElement,f=
0;b&&f<a.length;f++){var d=a[f];if(c)for(var e=-1,g=0;g<b.childNodes.length;g++){var n=b.childNodes[g];if(!(c===true&&n.nodeType==3&&n.previousSibling&&n.previousSibling.nodeType==3)){e++;if(e==d){b=n;break}}}else b=b.childNodes[d]}return b?new CKEDITOR.dom.node(b):null},getElementsByTag:function(a,c){if((!CKEDITOR.env.ie||document.documentMode>8)&&c)a=c+":"+a;return new CKEDITOR.dom.nodeList(this.$.getElementsByTagName(a))},getHead:function(){var a=this.$.getElementsByTagName("head")[0];return a=
a?new CKEDITOR.dom.element(a):this.getDocumentElement().append(new CKEDITOR.dom.element("head"),true)},getBody:function(){return new CKEDITOR.dom.element(this.$.body)},getDocumentElement:function(){return new CKEDITOR.dom.element(this.$.documentElement)},getWindow:function(){return new CKEDITOR.dom.window(this.$.parentWindow||this.$.defaultView)},write:function(a){this.$.open("text/html","replace");CKEDITOR.env.ie&&(a=a.replace(/(?:^\s*<!DOCTYPE[^>]*?>)|^/i,'$&\n<script data-cke-temp="1">('+CKEDITOR.tools.fixDomain+
")();<\/script>"));this.$.write(a);this.$.close()},find:function(a){return new CKEDITOR.dom.nodeList(this.$.querySelectorAll(a))},findOne:function(a){return(a=this.$.querySelector(a))?new CKEDITOR.dom.element(a):null},_getHtml5ShivFrag:function(){var a=this.getCustomData("html5ShivFrag");if(!a){a=this.$.createDocumentFragment();CKEDITOR.tools.enableHtml5Elements(a,true);this.setCustomData("html5ShivFrag",a)}return a}});CKEDITOR.dom.nodeList=function(a){this.$=a};
CKEDITOR.dom.nodeList.prototype={count:function(){return this.$.length},getItem:function(a){if(a<0||a>=this.$.length)return null;return(a=this.$[a])?new CKEDITOR.dom.node(a):null}};CKEDITOR.dom.element=function(a,c){typeof a=="string"&&(a=(c?c.$:document).createElement(a));CKEDITOR.dom.domObject.call(this,a)};CKEDITOR.dom.element.get=function(a){return(a=typeof a=="string"?document.getElementById(a)||document.getElementsByName(a)[0]:a)&&(a.$?a:new CKEDITOR.dom.element(a))};
CKEDITOR.dom.element.prototype=new CKEDITOR.dom.node;CKEDITOR.dom.element.createFromHtml=function(a,c){var b=new CKEDITOR.dom.element("div",c);b.setHtml(a);return b.getFirst().remove()};
CKEDITOR.dom.element.setMarker=function(a,c,b,f){var d=c.getCustomData("list_marker_id")||c.setCustomData("list_marker_id",CKEDITOR.tools.getNextNumber()).getCustomData("list_marker_id"),e=c.getCustomData("list_marker_names")||c.setCustomData("list_marker_names",{}).getCustomData("list_marker_names");a[d]=c;e[b]=1;return c.setCustomData(b,f)};CKEDITOR.dom.element.clearAllMarkers=function(a){for(var c in a)CKEDITOR.dom.element.clearMarkers(a,a[c],1)};
CKEDITOR.dom.element.clearMarkers=function(a,c,b){var f=c.getCustomData("list_marker_names"),d=c.getCustomData("list_marker_id"),e;for(e in f)c.removeCustomData(e);c.removeCustomData("list_marker_names");if(b){c.removeCustomData("list_marker_id");delete a[d]}};
(function(){function a(a){var e=true;if(!a.$.id){a.$.id="cke_tmp_"+CKEDITOR.tools.getNextNumber();e=false}return function(){e||a.removeAttribute("id")}}function c(a,e){return"#"+a.$.id+" "+e.split(/,\s*/).join(", #"+a.$.id+" ")}function b(a){for(var e=0,b=0,c=f[a].length;b<c;b++)e=e+(parseInt(this.getComputedStyle(f[a][b])||0,10)||0);return e}CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_ELEMENT,addClass:function(a){var e=this.$.className;e&&(RegExp("(?:^|\\s)"+a+"(?:\\s|$)",
"").test(e)||(e=e+(" "+a)));this.$.className=e||a;return this},removeClass:function(a){var e=this.getAttribute("class");if(e){a=RegExp("(?:^|\\s+)"+a+"(?=\\s|$)","i");if(a.test(e))(e=e.replace(a,"").replace(/^\s+/,""))?this.setAttribute("class",e):this.removeAttribute("class")}return this},hasClass:function(a){return RegExp("(?:^|\\s+)"+a+"(?=\\s|$)","").test(this.getAttribute("class"))},append:function(a,e){typeof a=="string"&&(a=this.getDocument().createElement(a));e?this.$.insertBefore(a.$,this.$.firstChild):
this.$.appendChild(a.$);return a},appendHtml:function(a){if(this.$.childNodes.length){var e=new CKEDITOR.dom.element("div",this.getDocument());e.setHtml(a);e.moveChildren(this)}else this.setHtml(a)},appendText:function(a){this.$.text!=void 0?this.$.text=this.$.text+a:this.append(new CKEDITOR.dom.text(a))},appendBogus:function(a){if(a||CKEDITOR.env.needsBrFiller){for(a=this.getLast();a&&a.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.rtrim(a.getText());)a=a.getPrevious();if(!a||!a.is||!a.is("br")){a=this.getDocument().createElement("br");
CKEDITOR.env.gecko&&a.setAttribute("type","_moz");this.append(a)}}},breakParent:function(a){var e=new CKEDITOR.dom.range(this.getDocument());e.setStartAfter(this);e.setEndAfter(a);a=e.extractContents();e.insertNode(this.remove());a.insertAfterNode(this)},contains:CKEDITOR.env.ie||CKEDITOR.env.webkit?function(a){var e=this.$;return a.type!=CKEDITOR.NODE_ELEMENT?e.contains(a.getParent().$):e!=a.$&&e.contains(a.$)}:function(a){return!!(this.$.compareDocumentPosition(a.$)&16)},focus:function(){function a(){try{this.$.focus()}catch(d){}}
return function(e){e?CKEDITOR.tools.setTimeout(a,100,this):a.call(this)}}(),getHtml:function(){var a=this.$.innerHTML;return CKEDITOR.env.ie?a.replace(/<\?[^>]*>/g,""):a},getOuterHtml:function(){if(this.$.outerHTML)return this.$.outerHTML.replace(/<\?[^>]*>/,"");var a=this.$.ownerDocument.createElement("div");a.appendChild(this.$.cloneNode(true));return a.innerHTML},getClientRect:function(){var a=CKEDITOR.tools.extend({},this.$.getBoundingClientRect());!a.width&&(a.width=a.right-a.left);!a.height&&
(a.height=a.bottom-a.top);return a},setHtml:CKEDITOR.env.ie&&CKEDITOR.env.version<9?function(a){try{var e=this.$;if(this.getParent())return e.innerHTML=a;var b=this.getDocument()._getHtml5ShivFrag();b.appendChild(e);e.innerHTML=a;b.removeChild(e);return a}catch(c){this.$.innerHTML="";e=new CKEDITOR.dom.element("body",this.getDocument());e.$.innerHTML=a;for(e=e.getChildren();e.count();)this.append(e.getItem(0));return a}}:function(a){return this.$.innerHTML=a},setText:function(){var a=document.createElement("p");
a.innerHTML="x";a=a.textContent;return function(e){this.$[a?"textContent":"innerText"]=e}}(),getAttribute:function(){var a=function(a){return this.$.getAttribute(a,2)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(a){switch(a){case "class":a="className";break;case "http-equiv":a="httpEquiv";break;case "name":return this.$.name;case "tabindex":a=this.$.getAttribute(a,2);a!==0&&this.$.tabIndex===0&&(a=null);return a;case "checked":a=this.$.attributes.getNamedItem(a);
return(a.specified?a.nodeValue:this.$.checked)?"checked":null;case "hspace":case "value":return this.$[a];case "style":return this.$.style.cssText;case "contenteditable":case "contentEditable":return this.$.attributes.getNamedItem("contentEditable").specified?this.$.getAttribute("contentEditable"):null}return this.$.getAttribute(a,2)}:a}(),getChildren:function(){return new CKEDITOR.dom.nodeList(this.$.childNodes)},getComputedStyle:CKEDITOR.env.ie?function(a){return this.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(a)]}:
function(a){var e=this.getWindow().$.getComputedStyle(this.$,null);return e?e.getPropertyValue(a):""},getDtd:function(){var a=CKEDITOR.dtd[this.getName()];this.getDtd=function(){return a};return a},getElementsByTag:CKEDITOR.dom.document.prototype.getElementsByTag,getTabIndex:CKEDITOR.env.ie?function(){var a=this.$.tabIndex;a===0&&(!CKEDITOR.dtd.$tabIndex[this.getName()]&&parseInt(this.getAttribute("tabindex"),10)!==0)&&(a=-1);return a}:CKEDITOR.env.webkit?function(){var a=this.$.tabIndex;if(a==void 0){a=
parseInt(this.getAttribute("tabindex"),10);isNaN(a)&&(a=-1)}return a}:function(){return this.$.tabIndex},getText:function(){return this.$.textContent||this.$.innerText||""},getWindow:function(){return this.getDocument().getWindow()},getId:function(){return this.$.id||null},getNameAtt:function(){return this.$.name||null},getName:function(){var a=this.$.nodeName.toLowerCase();if(CKEDITOR.env.ie&&!(document.documentMode>8)){var e=this.$.scopeName;e!="HTML"&&(a=e.toLowerCase()+":"+a)}return(this.getName=
function(){return a})()},getValue:function(){return this.$.value},getFirst:function(a){var e=this.$.firstChild;(e=e&&new CKEDITOR.dom.node(e))&&(a&&!a(e))&&(e=e.getNext(a));return e},getLast:function(a){var e=this.$.lastChild;(e=e&&new CKEDITOR.dom.node(e))&&(a&&!a(e))&&(e=e.getPrevious(a));return e},getStyle:function(a){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(a)]},is:function(){var a=this.getName();if(typeof arguments[0]=="object")return!!arguments[0][a];for(var e=0;e<arguments.length;e++)if(arguments[e]==
a)return true;return false},isEditable:function(a){var e=this.getName();if(this.isReadOnly()||this.getComputedStyle("display")=="none"||this.getComputedStyle("visibility")=="hidden"||CKEDITOR.dtd.$nonEditable[e]||CKEDITOR.dtd.$empty[e]||this.is("a")&&(this.data("cke-saved-name")||this.hasAttribute("name"))&&!this.getChildCount())return false;if(a!==false){a=CKEDITOR.dtd[e]||CKEDITOR.dtd.span;return!(!a||!a["#"])}return true},isIdentical:function(a){var e=this.clone(0,1),a=a.clone(0,1);e.removeAttributes(["_moz_dirty",
"data-cke-expando","data-cke-saved-href","data-cke-saved-name"]);a.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]);if(e.$.isEqualNode){e.$.style.cssText=CKEDITOR.tools.normalizeCssText(e.$.style.cssText);a.$.style.cssText=CKEDITOR.tools.normalizeCssText(a.$.style.cssText);return e.$.isEqualNode(a.$)}e=e.getOuterHtml();a=a.getOuterHtml();if(CKEDITOR.env.ie&&CKEDITOR.env.version<9&&this.is("a")){var b=this.getParent();if(b.type==CKEDITOR.NODE_ELEMENT){b=
b.clone();b.setHtml(e);e=b.getHtml();b.setHtml(a);a=b.getHtml()}}return e==a},isVisible:function(){var a=(this.$.offsetHeight||this.$.offsetWidth)&&this.getComputedStyle("visibility")!="hidden",e,b;if(a&&CKEDITOR.env.webkit){e=this.getWindow();if(!e.equals(CKEDITOR.document.getWindow())&&(b=e.$.frameElement))a=(new CKEDITOR.dom.element(b)).isVisible()}return!!a},isEmptyInlineRemoveable:function(){if(!CKEDITOR.dtd.$removeEmpty[this.getName()])return false;for(var a=this.getChildren(),e=0,b=a.count();e<
b;e++){var c=a.getItem(e);if(!(c.type==CKEDITOR.NODE_ELEMENT&&c.data("cke-bookmark"))&&(c.type==CKEDITOR.NODE_ELEMENT&&!c.isEmptyInlineRemoveable()||c.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(c.getText())))return false}return true},hasAttributes:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(){for(var a=this.$.attributes,e=0;e<a.length;e++){var b=a[e];switch(b.nodeName){case "class":if(this.getAttribute("class"))return true;case "data-cke-expando":continue;default:if(b.specified)return true}}return false}:
function(){var a=this.$.attributes,e=a.length,b={"data-cke-expando":1,_moz_dirty:1};return e>0&&(e>2||!b[a[0].nodeName]||e==2&&!b[a[1].nodeName])},hasAttribute:function(){function a(d){var b=this.$.attributes.getNamedItem(d);if(this.getName()=="input")switch(d){case "class":return this.$.className.length>0;case "checked":return!!this.$.checked;case "value":d=this.getAttribute("type");return d=="checkbox"||d=="radio"?this.$.value!="on":!!this.$.value}return!b?false:b.specified}return CKEDITOR.env.ie?
CKEDITOR.env.version<8?function(e){return e=="name"?!!this.$.name:a.call(this,e)}:a:function(a){return!!this.$.attributes.getNamedItem(a)}}(),hide:function(){this.setStyle("display","none")},moveChildren:function(a,e){var b=this.$,a=a.$;if(b!=a){var c;if(e)for(;c=b.lastChild;)a.insertBefore(b.removeChild(c),a.firstChild);else for(;c=b.firstChild;)a.appendChild(b.removeChild(c))}},mergeSiblings:function(){function a(d,b,c){if(b&&b.type==CKEDITOR.NODE_ELEMENT){for(var f=[];b.data("cke-bookmark")||b.isEmptyInlineRemoveable();){f.push(b);
b=c?b.getNext():b.getPrevious();if(!b||b.type!=CKEDITOR.NODE_ELEMENT)return}if(d.isIdentical(b)){for(var i=c?d.getLast():d.getFirst();f.length;)f.shift().move(d,!c);b.moveChildren(d,!c);b.remove();i&&i.type==CKEDITOR.NODE_ELEMENT&&i.mergeSiblings()}}}return function(e){if(e===false||CKEDITOR.dtd.$removeEmpty[this.getName()]||this.is("a")){a(this,this.getNext(),true);a(this,this.getPrevious())}}}(),show:function(){this.setStyles({display:"",visibility:""})},setAttribute:function(){var a=function(a,
d){this.$.setAttribute(a,d);return this};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(e,b){e=="class"?this.$.className=b:e=="style"?this.$.style.cssText=b:e=="tabindex"?this.$.tabIndex=b:e=="checked"?this.$.checked=b:e=="contenteditable"?a.call(this,"contentEditable",b):a.apply(this,arguments);return this}:CKEDITOR.env.ie8Compat&&CKEDITOR.env.secure?function(b,c){if(b=="src"&&c.match(/^http:\/\//))try{a.apply(this,arguments)}catch(f){}else a.apply(this,arguments);
return this}:a}(),setAttributes:function(a){for(var b in a)this.setAttribute(b,a[b]);return this},setValue:function(a){this.$.value=a;return this},removeAttribute:function(){var a=function(a){this.$.removeAttribute(a)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(a){a=="class"?a="className":a=="tabindex"?a="tabIndex":a=="contenteditable"&&(a="contentEditable");this.$.removeAttribute(a)}:a}(),removeAttributes:function(a){if(CKEDITOR.tools.isArray(a))for(var b=0;b<
a.length;b++)this.removeAttribute(a[b]);else for(b in a)a.hasOwnProperty(b)&&this.removeAttribute(b)},removeStyle:function(a){var b=this.$.style;if(!b.removeProperty&&(a=="border"||a=="margin"||a=="padding")){var c=["top","left","right","bottom"],f;a=="border"&&(f=["color","style","width"]);for(var b=[],h=0;h<c.length;h++)if(f)for(var i=0;i<f.length;i++)b.push([a,c[h],f[i]].join("-"));else b.push([a,c[h]].join("-"));for(a=0;a<b.length;a++)this.removeStyle(b[a])}else{b.removeProperty?b.removeProperty(a):
b.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(a));this.$.style.cssText||this.removeAttribute("style")}},setStyle:function(a,b){this.$.style[CKEDITOR.tools.cssStyleToDomStyle(a)]=b;return this},setStyles:function(a){for(var b in a)this.setStyle(b,a[b]);return this},setOpacity:function(a){if(CKEDITOR.env.ie&&CKEDITOR.env.version<9){a=Math.round(a*100);this.setStyle("filter",a>=100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+a+")")}else this.setStyle("opacity",a)},unselectable:function(){this.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select",
"none"));if(CKEDITOR.env.ie){this.setAttribute("unselectable","on");for(var a,b=this.getElementsByTag("*"),c=0,f=b.count();c<f;c++){a=b.getItem(c);a.setAttribute("unselectable","on")}}},getPositionedAncestor:function(){for(var a=this;a.getName()!="html";){if(a.getComputedStyle("position")!="static")return a;a=a.getParent()}return null},getDocumentPosition:function(a){var b=0,c=0,f=this.getDocument(),h=f.getBody(),i=f.$.compatMode=="BackCompat";if(document.documentElement.getBoundingClientRect){var m=
this.$.getBoundingClientRect(),p=f.$.documentElement,s=p.clientTop||h.$.clientTop||0,x=p.clientLeft||h.$.clientLeft||0,q=true;if(CKEDITOR.env.ie){q=f.getDocumentElement().contains(this);f=f.getBody().contains(this);q=i&&f||!i&&q}if(q){b=m.left+(!i&&p.scrollLeft||h.$.scrollLeft);b=b-x;c=m.top+(!i&&p.scrollTop||h.$.scrollTop);c=c-s}}else{h=this;for(f=null;h&&!(h.getName()=="body"||h.getName()=="html");){b=b+(h.$.offsetLeft-h.$.scrollLeft);c=c+(h.$.offsetTop-h.$.scrollTop);if(!h.equals(this)){b=b+(h.$.clientLeft||
0);c=c+(h.$.clientTop||0)}for(;f&&!f.equals(h);){b=b-f.$.scrollLeft;c=c-f.$.scrollTop;f=f.getParent()}f=h;h=(m=h.$.offsetParent)?new CKEDITOR.dom.element(m):null}}if(a){h=this.getWindow();f=a.getWindow();if(!h.equals(f)&&h.$.frameElement){a=(new CKEDITOR.dom.element(h.$.frameElement)).getDocumentPosition(a);b=b+a.x;c=c+a.y}}if(!document.documentElement.getBoundingClientRect&&CKEDITOR.env.gecko&&!i){b=b+(this.$.clientLeft?1:0);c=c+(this.$.clientTop?1:0)}return{x:b,y:c}},scrollIntoView:function(a){var b=
this.getParent();if(b){do{(b.$.clientWidth&&b.$.clientWidth<b.$.scrollWidth||b.$.clientHeight&&b.$.clientHeight<b.$.scrollHeight)&&!b.is("body")&&this.scrollIntoParent(b,a,1);if(b.is("html")){var c=b.getWindow();try{var f=c.$.frameElement;f&&(b=new CKEDITOR.dom.element(f))}catch(h){}}}while(b=b.getParent())}},scrollIntoParent:function(a,b,c){var f,h,i,m;function p(b,e){if(/body|html/.test(a.getName()))a.getWindow().$.scrollBy(b,e);else{a.$.scrollLeft=a.$.scrollLeft+b;a.$.scrollTop=a.$.scrollTop+e}}
function s(a,b){var d={x:0,y:0};if(!a.is(q?"body":"html")){var e=a.$.getBoundingClientRect();d.x=e.left;d.y=e.top}e=a.getWindow();if(!e.equals(b)){e=s(CKEDITOR.dom.element.get(e.$.frameElement),b);d.x=d.x+e.x;d.y=d.y+e.y}return d}function x(a,b){return parseInt(a.getComputedStyle("margin-"+b)||0,10)||0}!a&&(a=this.getWindow());i=a.getDocument();var q=i.$.compatMode=="BackCompat";a instanceof CKEDITOR.dom.window&&(a=q?i.getBody():i.getDocumentElement());i=a.getWindow();h=s(this,i);var o=s(a,i),u=this.$.offsetHeight;
f=this.$.offsetWidth;var A=a.$.clientHeight,k=a.$.clientWidth;i=h.x-x(this,"left")-o.x||0;m=h.y-x(this,"top")-o.y||0;f=h.x+f+x(this,"right")-(o.x+k)||0;h=h.y+u+x(this,"bottom")-(o.y+A)||0;if(m<0||h>0)p(0,b===true?m:b===false?h:m<0?m:h);if(c&&(i<0||f>0))p(i<0?i:f,0)},setState:function(a,b,c){b=b||"cke";switch(a){case CKEDITOR.TRISTATE_ON:this.addClass(b+"_on");this.removeClass(b+"_off");this.removeClass(b+"_disabled");c&&this.setAttribute("aria-pressed",true);c&&this.removeAttribute("aria-disabled");
break;case CKEDITOR.TRISTATE_DISABLED:this.addClass(b+"_disabled");this.removeClass(b+"_off");this.removeClass(b+"_on");c&&this.setAttribute("aria-disabled",true);c&&this.removeAttribute("aria-pressed");break;default:this.addClass(b+"_off");this.removeClass(b+"_on");this.removeClass(b+"_disabled");c&&this.removeAttribute("aria-pressed");c&&this.removeAttribute("aria-disabled")}},getFrameDocument:function(){var a=this.$;try{a.contentWindow.document}catch(b){a.src=a.src}return a&&new CKEDITOR.dom.document(a.contentWindow.document)},
copyAttributes:function(a,b){for(var c=this.$.attributes,b=b||{},f=0;f<c.length;f++){var h=c[f],i=h.nodeName.toLowerCase(),m;if(!(i in b))if(i=="checked"&&(m=this.getAttribute(i)))a.setAttribute(i,m);else if(!CKEDITOR.env.ie||this.hasAttribute(i)){m=this.getAttribute(i);if(m===null)m=h.nodeValue;a.setAttribute(i,m)}}if(this.$.style.cssText!=="")a.$.style.cssText=this.$.style.cssText},renameNode:function(a){if(this.getName()!=a){var b=this.getDocument(),a=new CKEDITOR.dom.element(a,b);this.copyAttributes(a);
this.moveChildren(a);this.getParent()&&this.$.parentNode.replaceChild(a.$,this.$);a.$["data-cke-expando"]=this.$["data-cke-expando"];this.$=a.$;delete this.getName}},getChild:function(){function a(b,d){var c=b.childNodes;if(d>=0&&d<c.length)return c[d]}return function(b){var c=this.$;if(b.slice)for(;b.length>0&&c;)c=a(c,b.shift());else c=a(c,b);return c?new CKEDITOR.dom.node(c):null}}(),getChildCount:function(){return this.$.childNodes.length},disableContextMenu:function(){this.on("contextmenu",function(a){a.data.getTarget().hasClass("cke_enable_context_menu")||
a.data.preventDefault()})},getDirection:function(a){return a?this.getComputedStyle("direction")||this.getDirection()||this.getParent()&&this.getParent().getDirection(1)||this.getDocument().$.dir||"ltr":this.getStyle("direction")||this.getAttribute("dir")},data:function(a,b){a="data-"+a;if(b===void 0)return this.getAttribute(a);b===false?this.removeAttribute(a):this.setAttribute(a,b);return null},getEditor:function(){var a=CKEDITOR.instances,b,c;for(b in a){c=a[b];if(c.element.equals(this)&&c.elementMode!=
CKEDITOR.ELEMENT_MODE_APPENDTO)return c}return null},find:function(b){var e=a(this),b=new CKEDITOR.dom.nodeList(this.$.querySelectorAll(c(this,b)));e();return b},findOne:function(b){var e=a(this),b=this.$.querySelector(c(this,b));e();return b?new CKEDITOR.dom.element(b):null},forEach:function(a,b,c){if(!c&&(!b||this.type==b))var f=a(this);if(f!==false)for(var c=this.getChildren(),h=0;h<c.count();h++){f=c.getItem(h);f.type==CKEDITOR.NODE_ELEMENT?f.forEach(a,b):(!b||f.type==b)&&a(f)}}});var f={width:["border-left-width",
"border-right-width","padding-left","padding-right"],height:["border-top-width","border-bottom-width","padding-top","padding-bottom"]};CKEDITOR.dom.element.prototype.setSize=function(a,c,f){if(typeof c=="number"){if(f&&(!CKEDITOR.env.ie||!CKEDITOR.env.quirks))c=c-b.call(this,a);this.setStyle(a,c+"px")}};CKEDITOR.dom.element.prototype.getSize=function(a,c){var f=Math.max(this.$["offset"+CKEDITOR.tools.capitalize(a)],this.$["client"+CKEDITOR.tools.capitalize(a)])||0;c&&(f=f-b.call(this,a));return f}})();
CKEDITOR.dom.documentFragment=function(a){a=a||CKEDITOR.document;this.$=a.type==CKEDITOR.NODE_DOCUMENT?a.$.createDocumentFragment():a};
CKEDITOR.tools.extend(CKEDITOR.dom.documentFragment.prototype,CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,insertAfterNode:function(a){a=a.$;a.parentNode.insertBefore(this.$,a.nextSibling)}},!0,{append:1,appendBogus:1,getFirst:1,getLast:1,getParent:1,getNext:1,getPrevious:1,appendTo:1,moveChildren:1,insertBefore:1,insertAfterNode:1,replace:1,trim:1,type:1,ltrim:1,rtrim:1,getDocument:1,getChildCount:1,getChild:1,getChildren:1});
(function(){function a(a,b){var c=this.range;if(this._.end)return null;if(!this._.start){this._.start=1;if(c.collapsed){this.end();return null}c.optimize()}var d,e=c.startContainer;d=c.endContainer;var f=c.startOffset,m=c.endOffset,k,l=this.guard,j=this.type,v=a?"getPreviousSourceNode":"getNextSourceNode";if(!a&&!this._.guardLTR){var g=d.type==CKEDITOR.NODE_ELEMENT?d:d.getParent(),r=d.type==CKEDITOR.NODE_ELEMENT?d.getChild(m):d.getNext();this._.guardLTR=function(a,b){return(!b||!g.equals(a))&&(!r||
!a.equals(r))&&(a.type!=CKEDITOR.NODE_ELEMENT||!b||!a.equals(c.root))}}if(a&&!this._.guardRTL){var h=e.type==CKEDITOR.NODE_ELEMENT?e:e.getParent(),i=e.type==CKEDITOR.NODE_ELEMENT?f?e.getChild(f-1):null:e.getPrevious();this._.guardRTL=function(a,b){return(!b||!h.equals(a))&&(!i||!a.equals(i))&&(a.type!=CKEDITOR.NODE_ELEMENT||!b||!a.equals(c.root))}}var F=a?this._.guardRTL:this._.guardLTR;k=l?function(a,b){return F(a,b)===false?false:l(a,b)}:F;if(this.current)d=this.current[v](false,j,k);else{if(a)d.type==
CKEDITOR.NODE_ELEMENT&&(d=m>0?d.getChild(m-1):k(d,true)===false?null:d.getPreviousSourceNode(true,j,k));else{d=e;if(d.type==CKEDITOR.NODE_ELEMENT&&!(d=d.getChild(f)))d=k(e,true)===false?null:e.getNextSourceNode(true,j,k)}d&&k(d)===false&&(d=null)}for(;d&&!this._.end;){this.current=d;if(!this.evaluator||this.evaluator(d)!==false){if(!b)return d}else if(b&&this.evaluator)return false;d=d[v](false,j,k)}this.end();return this.current=null}function c(b){for(var d,c=null;d=a.call(this,b);)c=d;return c}
function b(a){if(i(a))return false;if(a.type==CKEDITOR.NODE_TEXT)return true;if(a.type==CKEDITOR.NODE_ELEMENT){if(a.is(CKEDITOR.dtd.$inline)||a.is("hr")||a.getAttribute("contenteditable")=="false")return true;var b;if(b=!CKEDITOR.env.needsBrFiller)if(b=a.is(m))a:{b=0;for(var d=a.getChildCount();b<d;++b)if(!i(a.getChild(b))){b=false;break a}b=true}if(b)return true}return false}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(a){this.range=a;this._={}},proto:{end:function(){this._.end=1},
next:function(){return a.call(this)},previous:function(){return a.call(this,1)},checkForward:function(){return a.call(this,0,1)!==false},checkBackward:function(){return a.call(this,1,1)!==false},lastForward:function(){return c.call(this)},lastBackward:function(){return c.call(this,1)},reset:function(){delete this.current;this._={}}}});var f={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,
"table-caption":1},d={absolute:1,fixed:1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(a){return this.getComputedStyle("float")=="none"&&!(this.getComputedStyle("position")in d)&&f[this.getComputedStyle("display")]?true:!!(this.is(CKEDITOR.dtd.$block)||a&&this.is(a))};CKEDITOR.dom.walker.blockBoundary=function(a){return function(b){return!(b.type==CKEDITOR.NODE_ELEMENT&&b.isBlockBoundary(a))}};CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})};CKEDITOR.dom.walker.bookmark=
function(a,b){function d(a){return a&&a.getName&&a.getName()=="span"&&a.data("cke-bookmark")}return function(c){var e,f;e=c&&c.type!=CKEDITOR.NODE_ELEMENT&&(f=c.getParent())&&d(f);e=a?e:e||d(c);return!!(b^e)}};CKEDITOR.dom.walker.whitespaces=function(a){return function(b){var d;b&&b.type==CKEDITOR.NODE_TEXT&&(d=!CKEDITOR.tools.trim(b.getText())||CKEDITOR.env.webkit&&b.getText()=="â€‹");return!!(a^d)}};CKEDITOR.dom.walker.invisible=function(a){var b=CKEDITOR.dom.walker.whitespaces();return function(d){if(b(d))d=
1;else{d.type==CKEDITOR.NODE_TEXT&&(d=d.getParent());d=!d.$.offsetHeight}return!!(a^d)}};CKEDITOR.dom.walker.nodeType=function(a,b){return function(d){return!!(b^d.type==a)}};CKEDITOR.dom.walker.bogus=function(a){function b(a){return!g(a)&&!n(a)}return function(d){var c=CKEDITOR.env.needsBrFiller?d.is&&d.is("br"):d.getText&&e.test(d.getText());if(c){c=d.getParent();d=d.getNext(b);c=c.isBlockBoundary()&&(!d||d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary())}return!!(a^c)}};CKEDITOR.dom.walker.temp=
function(a){return function(b){b.type!=CKEDITOR.NODE_ELEMENT&&(b=b.getParent());b=b&&b.hasAttribute("data-cke-temp");return!!(a^b)}};var e=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,g=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(),h=CKEDITOR.dom.walker.temp();CKEDITOR.dom.walker.ignored=function(a){return function(b){b=g(b)||n(b)||h(b);return!!(a^b)}};var i=CKEDITOR.dom.walker.ignored(),m=function(a){var b={},d;for(d in a)CKEDITOR.dtd[d]["#"]&&(b[d]=1);return b}(CKEDITOR.dtd.$block);CKEDITOR.dom.walker.editable=
function(a){return function(d){return!!(a^b(d))}};CKEDITOR.dom.element.prototype.getBogus=function(){var a=this;do a=a.getPreviousSourceNode();while(n(a)||g(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.is(CKEDITOR.dtd.$inline)&&!a.is(CKEDITOR.dtd.$empty));return a&&(CKEDITOR.env.needsBrFiller?a.is&&a.is("br"):a.getText&&e.test(a.getText()))?a:false}})();
CKEDITOR.dom.range=function(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;this.collapsed=true;var c=a instanceof CKEDITOR.dom.document;this.document=c?a:a.getDocument();this.root=c?a.getBody():a};
(function(){function a(){var a=false,b=CKEDITOR.dom.walker.whitespaces(),d=CKEDITOR.dom.walker.bookmark(true),c=CKEDITOR.dom.walker.bogus();return function(f){if(d(f)||b(f))return true;if(c(f)&&!a)return a=true;return f.type==CKEDITOR.NODE_TEXT&&(f.hasAscendant("pre")||CKEDITOR.tools.trim(f.getText()).length)||f.type==CKEDITOR.NODE_ELEMENT&&!f.is(e)?false:true}}function c(a){var b=CKEDITOR.dom.walker.whitespaces(),d=CKEDITOR.dom.walker.bookmark(1);return function(c){return d(c)||b(c)?true:!a&&g(c)||
c.type==CKEDITOR.NODE_ELEMENT&&c.is(CKEDITOR.dtd.$removeEmpty)}}function b(a){return function(){var b;return this[a?"getPreviousNode":"getNextNode"](function(a){!b&&i(a)&&(b=a);return h(a)&&!(g(a)&&a.equals(b))})}}var f=function(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer.equals(a.endContainer)&&a.startOffset==a.endOffset},d=function(a,b,d,c){a.optimizeBookmark();var e=a.startContainer,f=a.endContainer,u=a.startOffset,g=a.endOffset,k,l;if(f.type==CKEDITOR.NODE_TEXT)f=f.split(g);
else if(f.getChildCount()>0)if(g>=f.getChildCount()){f=f.append(a.document.createText(""));l=true}else f=f.getChild(g);if(e.type==CKEDITOR.NODE_TEXT){e.split(u);e.equals(f)&&(f=e.getNext())}else if(u)if(u>=e.getChildCount()){e=e.append(a.document.createText(""));k=true}else e=e.getChild(u).getPrevious();else{e=e.append(a.document.createText(""),1);k=true}var u=e.getParents(),g=f.getParents(),j,v,h;for(j=0;j<u.length;j++){v=u[j];h=g[j];if(!v.equals(h))break}for(var r=d,i,n,F,D=j;D<u.length;D++){i=
u[D];r&&!i.equals(e)&&(n=r.append(i.clone()));for(i=i.getNext();i;){if(i.equals(g[D])||i.equals(f))break;F=i.getNext();if(b==2)r.append(i.clone(true));else{i.remove();b==1&&r.append(i)}i=F}r&&(r=n)}r=d;for(d=j;d<g.length;d++){i=g[d];b>0&&!i.equals(f)&&(n=r.append(i.clone()));if(!u[d]||i.$.parentNode!=u[d].$.parentNode)for(i=i.getPrevious();i;){if(i.equals(u[d])||i.equals(e))break;F=i.getPrevious();if(b==2)r.$.insertBefore(i.$.cloneNode(true),r.$.firstChild);else{i.remove();b==1&&r.$.insertBefore(i.$,
r.$.firstChild)}i=F}r&&(r=n)}if(b==2){v=a.startContainer;if(v.type==CKEDITOR.NODE_TEXT){v.$.data=v.$.data+v.$.nextSibling.data;v.$.parentNode.removeChild(v.$.nextSibling)}a=a.endContainer;if(a.type==CKEDITOR.NODE_TEXT&&a.$.nextSibling){a.$.data=a.$.data+a.$.nextSibling.data;a.$.parentNode.removeChild(a.$.nextSibling)}}else{if(v&&h&&(e.$.parentNode!=v.$.parentNode||f.$.parentNode!=h.$.parentNode)){b=h.getIndex();k&&h.$.parentNode==e.$.parentNode&&b--;if(c&&v.type==CKEDITOR.NODE_ELEMENT){c=CKEDITOR.dom.element.createFromHtml('<span data-cke-bookmark="1" style="display:none">&nbsp;</span>',
a.document);c.insertAfter(v);v.mergeSiblings(false);a.moveToBookmark({startNode:c})}else a.setStart(h.getParent(),b)}a.collapse(true)}k&&e.remove();l&&f.$.parentNode&&f.remove()},e={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},g=CKEDITOR.dom.walker.bogus(),n=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,h=CKEDITOR.dom.walker.editable(),i=CKEDITOR.dom.walker.ignored(true);CKEDITOR.dom.range.prototype=
{clone:function(){var a=new CKEDITOR.dom.range(this.root);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},collapse:function(a){if(a){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=true},cloneContents:function(){var a=new CKEDITOR.dom.documentFragment(this.document);this.collapsed||
d(this,2,a);return a},deleteContents:function(a){this.collapsed||d(this,0,null,a)},extractContents:function(a){var b=new CKEDITOR.dom.documentFragment(this.document);this.collapsed||d(this,1,b,a);return b},createBookmark:function(a){var b,d,c,e,f=this.collapsed;b=this.document.createElement("span");b.data("cke-bookmark",1);b.setStyle("display","none");b.setHtml("&nbsp;");if(a){c="cke_bm_"+CKEDITOR.tools.getNextNumber();b.setAttribute("id",c+(f?"C":"S"))}if(!f){d=b.clone();d.setHtml("&nbsp;");a&&d.setAttribute("id",
c+"E");e=this.clone();e.collapse();e.insertNode(d)}e=this.clone();e.collapse(true);e.insertNode(b);if(d){this.setStartAfter(b);this.setEndBefore(d)}else this.moveToPosition(b,CKEDITOR.POSITION_AFTER_END);return{startNode:a?c+(f?"C":"S"):b,endNode:a?c+"E":d,serializable:a,collapsed:f}},createBookmark2:function(){function a(b){var d=b.container,c=b.offset,e;e=d;var f=c;e=e.type!=CKEDITOR.NODE_ELEMENT||f===0||f==e.getChildCount()?0:e.getChild(f-1).type==CKEDITOR.NODE_TEXT&&e.getChild(f).type==CKEDITOR.NODE_TEXT;
if(e){d=d.getChild(c-1);c=d.getLength()}d.type==CKEDITOR.NODE_ELEMENT&&c>1&&(c=d.getChild(c-1).getIndex(true)+1);if(d.type==CKEDITOR.NODE_TEXT){e=d;for(f=0;(e=e.getPrevious())&&e.type==CKEDITOR.NODE_TEXT;)f=f+e.getLength();c=c+f}b.container=d;b.offset=c}return function(b){var d=this.collapsed,c={container:this.startContainer,offset:this.startOffset},e={container:this.endContainer,offset:this.endOffset};if(b){a(c);d||a(e)}return{start:c.container.getAddress(b),end:d?null:e.container.getAddress(b),
startOffset:c.offset,endOffset:e.offset,normalized:b,collapsed:d,is2:true}}}(),moveToBookmark:function(a){if(a.is2){var b=this.document.getByAddress(a.start,a.normalized),d=a.startOffset,c=a.end&&this.document.getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(b,d);c?this.setEnd(c,a):this.collapse(true)}else{b=(d=a.serializable)?this.document.getById(a.startNode):a.startNode;a=d?this.document.getById(a.endNode):a.endNode;this.setStartBefore(b);b.remove();if(a){this.setEndBefore(a);a.remove()}else this.collapse(true)}},
getBoundaryNodes:function(){var a=this.startContainer,b=this.endContainer,d=this.startOffset,c=this.endOffset,e;if(a.type==CKEDITOR.NODE_ELEMENT){e=a.getChildCount();if(e>d)a=a.getChild(d);else if(e<1)a=a.getPreviousSourceNode();else{for(a=a.$;a.lastChild;)a=a.lastChild;a=new CKEDITOR.dom.node(a);a=a.getNextSourceNode()||a}}if(b.type==CKEDITOR.NODE_ELEMENT){e=b.getChildCount();if(e>c)b=b.getChild(c).getPreviousSourceNode(true);else if(e<1)b=b.getPreviousSourceNode();else{for(b=b.$;b.lastChild;)b=
b.lastChild;b=new CKEDITOR.dom.node(b)}}a.getPosition(b)&CKEDITOR.POSITION_FOLLOWING&&(a=b);return{startNode:a,endNode:b}},getCommonAncestor:function(a,b){var d=this.startContainer,c=this.endContainer,d=d.equals(c)?a&&d.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?d.getChild(this.startOffset):d:d.getCommonAncestor(c);return b&&!d.is?d.getParent():d},optimize:function(){var a=this.startContainer,b=this.startOffset;a.type!=CKEDITOR.NODE_ELEMENT&&(b?b>=a.getLength()&&this.setStartAfter(a):
this.setStartBefore(a));a=this.endContainer;b=this.endOffset;a.type!=CKEDITOR.NODE_ELEMENT&&(b?b>=a.getLength()&&this.setEndAfter(a):this.setEndBefore(a))},optimizeBookmark:function(){var a=this.startContainer,b=this.endContainer;a.is&&(a.is("span")&&a.data("cke-bookmark"))&&this.setStartAt(a,CKEDITOR.POSITION_BEFORE_START);b&&(b.is&&b.is("span")&&b.data("cke-bookmark"))&&this.setEndAt(b,CKEDITOR.POSITION_AFTER_END)},trim:function(a,b){var d=this.startContainer,c=this.startOffset,e=this.collapsed;
if((!a||e)&&d&&d.type==CKEDITOR.NODE_TEXT){if(c)if(c>=d.getLength()){c=d.getIndex()+1;d=d.getParent()}else{var f=d.split(c),c=d.getIndex()+1,d=d.getParent();if(this.startContainer.equals(this.endContainer))this.setEnd(f,this.endOffset-this.startOffset);else if(d.equals(this.endContainer))this.endOffset=this.endOffset+1}else{c=d.getIndex();d=d.getParent()}this.setStart(d,c);if(e){this.collapse(true);return}}d=this.endContainer;c=this.endOffset;if(!b&&!e&&d&&d.type==CKEDITOR.NODE_TEXT){if(c){c>=d.getLength()||
d.split(c);c=d.getIndex()+1}else c=d.getIndex();d=d.getParent();this.setEnd(d,c)}},enlarge:function(a,b){function d(a){return a&&a.type==CKEDITOR.NODE_ELEMENT&&a.hasAttribute("contenteditable")?null:a}var c=RegExp(/[^\s\ufeff]/);switch(a){case CKEDITOR.ENLARGE_INLINE:var e=1;case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)break;var f=this.getCommonAncestor(),u=this.root,i,k,l,j,v,g=false,r,h;r=this.startContainer;var n=this.startOffset;if(r.type==CKEDITOR.NODE_TEXT){if(n){r=!CKEDITOR.tools.trim(r.substring(0,
n)).length&&r;g=!!r}if(r&&!(j=r.getPrevious()))l=r.getParent()}else{n&&(j=r.getChild(n-1)||r.getLast());j||(l=r)}for(l=d(l);l||j;){if(l&&!j){!v&&l.equals(f)&&(v=true);if(e?l.isBlockBoundary():!u.contains(l))break;if(!g||l.getComputedStyle("display")!="inline"){g=false;v?i=l:this.setStartBefore(l)}j=l.getPrevious()}for(;j;){r=false;if(j.type==CKEDITOR.NODE_COMMENT)j=j.getPrevious();else{if(j.type==CKEDITOR.NODE_TEXT){h=j.getText();c.test(h)&&(j=null);r=/[\s\ufeff]$/.test(h)}else if((j.$.offsetWidth>
0||b&&j.is("br"))&&!j.data("cke-bookmark"))if(g&&CKEDITOR.dtd.$removeEmpty[j.getName()]){h=j.getText();if(c.test(h))j=null;else for(var n=j.$.getElementsByTagName("*"),F=0,D;D=n[F++];)if(!CKEDITOR.dtd.$removeEmpty[D.nodeName.toLowerCase()]){j=null;break}j&&(r=!!h.length)}else j=null;r&&(g?v?i=l:l&&this.setStartBefore(l):g=true);if(j){r=j.getPrevious();if(!l&&!r){l=j;j=null;break}j=r}else l=null}}l&&(l=d(l.getParent()))}r=this.endContainer;n=this.endOffset;l=j=null;v=g=false;var L=function(a,b){var d=
new CKEDITOR.dom.range(u);d.setStart(a,b);d.setEndAt(u,CKEDITOR.POSITION_BEFORE_END);var d=new CKEDITOR.dom.walker(d),e;for(d.guard=function(a){return!(a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary())};e=d.next();){if(e.type!=CKEDITOR.NODE_TEXT)return false;h=e!=a?e.getText():e.substring(b);if(c.test(h))return false}return true};if(r.type==CKEDITOR.NODE_TEXT)if(CKEDITOR.tools.trim(r.substring(n)).length)g=true;else{g=!r.getLength();if(n==r.getLength()){if(!(j=r.getNext()))l=r.getParent()}else L(r,
n)&&(l=r.getParent())}else(j=r.getChild(n))||(l=r);for(;l||j;){if(l&&!j){!v&&l.equals(f)&&(v=true);if(e?l.isBlockBoundary():!u.contains(l))break;if(!g||l.getComputedStyle("display")!="inline"){g=false;v?k=l:l&&this.setEndAfter(l)}j=l.getNext()}for(;j;){r=false;if(j.type==CKEDITOR.NODE_TEXT){h=j.getText();L(j,0)||(j=null);r=/^[\s\ufeff]/.test(h)}else if(j.type==CKEDITOR.NODE_ELEMENT){if((j.$.offsetWidth>0||b&&j.is("br"))&&!j.data("cke-bookmark"))if(g&&CKEDITOR.dtd.$removeEmpty[j.getName()]){h=j.getText();
if(c.test(h))j=null;else{n=j.$.getElementsByTagName("*");for(F=0;D=n[F++];)if(!CKEDITOR.dtd.$removeEmpty[D.nodeName.toLowerCase()]){j=null;break}}j&&(r=!!h.length)}else j=null}else r=1;r&&g&&(v?k=l:this.setEndAfter(l));if(j){r=j.getNext();if(!l&&!r){l=j;j=null;break}j=r}else l=null}l&&(l=d(l.getParent()))}if(i&&k){f=i.contains(k)?k:i;this.setStartBefore(f);this.setEndAfter(f)}break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:l=new CKEDITOR.dom.range(this.root);u=
this.root;l.setStartAt(u,CKEDITOR.POSITION_AFTER_START);l.setEnd(this.startContainer,this.startOffset);l=new CKEDITOR.dom.walker(l);var J,w,z=CKEDITOR.dom.walker.blockBoundary(a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),t=null,E=function(a){if(a.type==CKEDITOR.NODE_ELEMENT&&a.getAttribute("contenteditable")=="false")if(t){if(t.equals(a)){t=null;return}}else t=a;else if(t)return;var b=z(a);b||(J=a);return b},e=function(a){var b=E(a);!b&&(a.is&&a.is("br"))&&(w=a);return b};l.guard=E;l=l.lastBackward();
J=J||u;this.setStartAt(J,!J.is("br")&&(!l&&this.checkStartOfBlock()||l&&J.contains(l))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END);if(a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){l=this.clone();l=new CKEDITOR.dom.walker(l);var y=CKEDITOR.dom.walker.whitespaces(),C=CKEDITOR.dom.walker.bookmark();l.evaluator=function(a){return!y(a)&&!C(a)};if((l=l.previous())&&l.type==CKEDITOR.NODE_ELEMENT&&l.is("br"))break}l=this.clone();l.collapse();l.setEndAt(u,CKEDITOR.POSITION_BEFORE_END);l=new CKEDITOR.dom.walker(l);
l.guard=a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?e:E;J=t=w=null;l=l.lastForward();J=J||u;this.setEndAt(J,!l&&this.checkEndOfBlock()||l&&J.contains(l)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START);w&&this.setEndAfter(w)}},shrink:function(a,b,d){if(!this.collapsed){var a=a||CKEDITOR.SHRINK_TEXT,c=this.clone(),e=this.startContainer,f=this.endContainer,u=this.startOffset,g=this.endOffset,k=1,l=1;if(e&&e.type==CKEDITOR.NODE_TEXT)if(u)if(u>=e.getLength())c.setStartAfter(e);else{c.setStartBefore(e);
k=0}else c.setStartBefore(e);if(f&&f.type==CKEDITOR.NODE_TEXT)if(g)if(g>=f.getLength())c.setEndAfter(f);else{c.setEndAfter(f);l=0}else c.setEndBefore(f);var c=new CKEDITOR.dom.walker(c),j=CKEDITOR.dom.walker.bookmark();c.evaluator=function(b){return b.type==(a==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var v;c.guard=function(b,c){if(j(b))return true;if(a==CKEDITOR.SHRINK_ELEMENT&&b.type==CKEDITOR.NODE_TEXT||c&&b.equals(v)||d===false&&b.type==CKEDITOR.NODE_ELEMENT&&b.isBlockBoundary()||
b.type==CKEDITOR.NODE_ELEMENT&&b.hasAttribute("contenteditable"))return false;!c&&b.type==CKEDITOR.NODE_ELEMENT&&(v=b);return true};if(k)(e=c[a==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(e,b?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START);if(l){c.reset();(c=c[a==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(c,b?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)}return!(!k&&!l)}},insertNode:function(a){this.optimizeBookmark();this.trim(false,
true);var b=this.startContainer,d=b.getChild(this.startOffset);d?a.insertBefore(d):b.append(a);a.getParent()&&a.getParent().equals(this.endContainer)&&this.endOffset++;this.setStartBefore(a)},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(true)},moveToRange:function(a){this.setStart(a.startContainer,a.startOffset);this.setEnd(a.endContainer,a.endOffset)},selectNodeContents:function(a){this.setStart(a,0);this.setEnd(a,a.type==CKEDITOR.NODE_TEXT?a.getLength():a.getChildCount())},setStart:function(a,
b){if(a.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[a.getName()]){b=a.getIndex();a=a.getParent()}this.startContainer=a;this.startOffset=b;if(!this.endContainer){this.endContainer=a;this.endOffset=b}f(this)},setEnd:function(a,b){if(a.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[a.getName()]){b=a.getIndex()+1;a=a.getParent()}this.endContainer=a;this.endOffset=b;if(!this.startContainer){this.startContainer=a;this.startOffset=b}f(this)},setStartAfter:function(a){this.setStart(a.getParent(),a.getIndex()+
1)},setStartBefore:function(a){this.setStart(a.getParent(),a.getIndex())},setEndAfter:function(a){this.setEnd(a.getParent(),a.getIndex()+1)},setEndBefore:function(a){this.setEnd(a.getParent(),a.getIndex())},setStartAt:function(a,b){switch(b){case CKEDITOR.POSITION_AFTER_START:this.setStart(a,0);break;case CKEDITOR.POSITION_BEFORE_END:a.type==CKEDITOR.NODE_TEXT?this.setStart(a,a.getLength()):this.setStart(a,a.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(a);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(a)}f(this)},
setEndAt:function(a,b){switch(b){case CKEDITOR.POSITION_AFTER_START:this.setEnd(a,0);break;case CKEDITOR.POSITION_BEFORE_END:a.type==CKEDITOR.NODE_TEXT?this.setEnd(a,a.getLength()):this.setEnd(a,a.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(a);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(a)}f(this)},fixBlock:function(a,b){var d=this.createBookmark(),c=this.document.createElement(b);this.collapse(a);this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS);this.extractContents().appendTo(c);
c.trim();c.appendBogus();this.insertNode(c);this.moveToBookmark(d);return c},splitBlock:function(a){var b=new CKEDITOR.dom.elementPath(this.startContainer,this.root),d=new CKEDITOR.dom.elementPath(this.endContainer,this.root),c=b.block,e=d.block,f=null;if(!b.blockLimit.equals(d.blockLimit))return null;if(a!="br"){if(!c){c=this.fixBlock(true,a);e=(new CKEDITOR.dom.elementPath(this.endContainer,this.root)).block}e||(e=this.fixBlock(false,a))}a=c&&this.checkStartOfBlock();b=e&&this.checkEndOfBlock();
this.deleteContents();if(c&&c.equals(e))if(b){f=new CKEDITOR.dom.elementPath(this.startContainer,this.root);this.moveToPosition(e,CKEDITOR.POSITION_AFTER_END);e=null}else if(a){f=new CKEDITOR.dom.elementPath(this.startContainer,this.root);this.moveToPosition(c,CKEDITOR.POSITION_BEFORE_START);c=null}else{e=this.splitElement(c);c.is("ul","ol")||c.appendBogus()}return{previousBlock:c,nextBlock:e,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:f}},splitElement:function(a){if(!this.collapsed)return null;
this.setEndAt(a,CKEDITOR.POSITION_BEFORE_END);var b=this.extractContents(),d=a.clone(false);b.appendTo(d);d.insertAfter(a);this.moveToPosition(a,CKEDITOR.POSITION_AFTER_END);return d},removeEmptyBlocksAtEnd:function(){function a(c){return function(a){return b(a)||(d(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.isEmptyInlineRemoveable())||c.is("table")&&a.is("caption")?false:true}}var b=CKEDITOR.dom.walker.whitespaces(),d=CKEDITOR.dom.walker.bookmark(false);return function(b){for(var d=this.createBookmark(),
c=this[b?"endPath":"startPath"](),e=c.block||c.blockLimit,f;e&&!e.equals(c.root)&&!e.getFirst(a(e));){f=e.getParent();this[b?"setEndAt":"setStartAt"](e,CKEDITOR.POSITION_AFTER_END);e.remove(1);e=f}this.moveToBookmark(d)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,this.root)},checkBoundaryOfElement:function(a,b){var d=b==CKEDITOR.START,e=this.clone();e.collapse(d);e[d?"setStartAt":
"setEndAt"](a,d?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END);e=new CKEDITOR.dom.walker(e);e.evaluator=c(d);return e[d?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var b=this.startContainer,d=this.startOffset;if(CKEDITOR.env.ie&&d&&b.type==CKEDITOR.NODE_TEXT){b=CKEDITOR.tools.ltrim(b.substring(0,d));n.test(b)&&this.trim(0,1)}this.trim();b=new CKEDITOR.dom.elementPath(this.startContainer,this.root);d=this.clone();d.collapse(true);d.setStartAt(b.block||b.blockLimit,
CKEDITOR.POSITION_AFTER_START);b=new CKEDITOR.dom.walker(d);b.evaluator=a();return b.checkBackward()},checkEndOfBlock:function(){var b=this.endContainer,d=this.endOffset;if(CKEDITOR.env.ie&&b.type==CKEDITOR.NODE_TEXT){b=CKEDITOR.tools.rtrim(b.substring(d));n.test(b)&&this.trim(1,0)}this.trim();b=new CKEDITOR.dom.elementPath(this.endContainer,this.root);d=this.clone();d.collapse(false);d.setEndAt(b.block||b.blockLimit,CKEDITOR.POSITION_BEFORE_END);b=new CKEDITOR.dom.walker(d);b.evaluator=a();return b.checkForward()},
getPreviousNode:function(a,b,d){var c=this.clone();c.collapse(1);c.setStartAt(d||this.root,CKEDITOR.POSITION_AFTER_START);d=new CKEDITOR.dom.walker(c);d.evaluator=a;d.guard=b;return d.previous()},getNextNode:function(a,b,d){var c=this.clone();c.collapse();c.setEndAt(d||this.root,CKEDITOR.POSITION_BEFORE_END);d=new CKEDITOR.dom.walker(c);d.evaluator=a;d.guard=b;return d.next()},checkReadOnly:function(){function a(b,d){for(;b;){if(b.type==CKEDITOR.NODE_ELEMENT){if(b.getAttribute("contentEditable")==
"false"&&!b.data("cke-editable"))return 0;if(b.is("html")||b.getAttribute("contentEditable")=="true"&&(b.contains(d)||b.equals(d)))break}b=b.getParent()}return 1}return function(){var b=this.startContainer,d=this.endContainer;return!(a(b,d)&&a(d,b))}}(),moveToElementEditablePosition:function(a,b){if(a.type==CKEDITOR.NODE_ELEMENT&&!a.isEditable(false)){this.moveToPosition(a,b?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START);return true}for(var d=0;a;){if(a.type==CKEDITOR.NODE_TEXT){b&&this.endContainer&&
this.checkEndOfBlock()&&n.test(a.getText())?this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(a,b?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START);d=1;break}if(a.type==CKEDITOR.NODE_ELEMENT)if(a.isEditable()){this.moveToPosition(a,b?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START);d=1}else if(b&&a.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START);else if(a.getAttribute("contenteditable")=="false"&&
a.is(CKEDITOR.dtd.$block)){this.setStartBefore(a);this.setEndAfter(a);return true}var c=a,e=d,f=void 0;c.type==CKEDITOR.NODE_ELEMENT&&c.isEditable(false)&&(f=c[b?"getLast":"getFirst"](i));!e&&!f&&(f=c[b?"getPrevious":"getNext"](i));a=f}return!!d},moveToClosestEditablePosition:function(a,b){var d=new CKEDITOR.dom.range(this.root),c=0,e,f=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];d.moveToPosition(a,f[b?0:1]);if(a.is(CKEDITOR.dtd.$block)){if(e=d[b?"getNextEditableNode":"getPreviousEditableNode"]()){c=
1;if(e.type==CKEDITOR.NODE_ELEMENT&&e.is(CKEDITOR.dtd.$block)&&e.getAttribute("contenteditable")=="false"){d.setStartAt(e,CKEDITOR.POSITION_BEFORE_START);d.setEndAt(e,CKEDITOR.POSITION_AFTER_END)}else d.moveToPosition(e,f[b?1:0])}}else c=1;c&&this.moveToRange(d);return!!c},moveToElementEditStart:function(a){return this.moveToElementEditablePosition(a)},moveToElementEditEnd:function(a){return this.moveToElementEditablePosition(a,true)},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer.type!=
CKEDITOR.NODE_ELEMENT||a.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var a=new CKEDITOR.dom.walker(a),b=CKEDITOR.dom.walker.bookmark(false,true),d=CKEDITOR.dom.walker.whitespaces(true);a.evaluator=function(a){return d(a)&&b(a)};var c=a.next();a.reset();return c&&c.equals(a.previous())?c:null},getTouchedStartNode:function(){var a=this.startContainer;return this.collapsed||a.type!=CKEDITOR.NODE_ELEMENT?a:a.getChild(this.startOffset)||a},getTouchedEndNode:function(){var a=this.endContainer;
return this.collapsed||a.type!=CKEDITOR.NODE_ELEMENT?a:a.getChild(this.endOffset-1)||a},getNextEditableNode:b(),getPreviousEditableNode:b(1),scrollIntoView:function(){var a=new CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",this.document),b,d,c,e=this.clone();e.optimize();if(c=e.startContainer.type==CKEDITOR.NODE_TEXT){d=e.startContainer.getText();b=e.startContainer.split(e.startOffset);a.insertAfter(e.startContainer)}else e.insertNode(a);a.scrollIntoView();if(c){e.startContainer.setText(d);
b.remove()}a.remove()}}})();CKEDITOR.POSITION_AFTER_START=1;CKEDITOR.POSITION_BEFORE_END=2;CKEDITOR.POSITION_BEFORE_START=3;CKEDITOR.POSITION_AFTER_END=4;CKEDITOR.ENLARGE_ELEMENT=1;CKEDITOR.ENLARGE_BLOCK_CONTENTS=2;CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3;CKEDITOR.ENLARGE_INLINE=4;CKEDITOR.START=1;CKEDITOR.END=2;CKEDITOR.SHRINK_ELEMENT=1;CKEDITOR.SHRINK_TEXT=2;"use strict";
(function(){function a(a){if(!(arguments.length<1)){this.range=a;this.forceBrBreak=0;this.enlargeBr=1;this.enforceRealBlocks=0;this._||(this._={})}}function c(a,b,d){for(a=a.getNextSourceNode(b,null,d);!e(a);)a=a.getNextSourceNode(b,null,d);return a}function b(a){var b=[];a.forEach(function(a){if(a.getAttribute("contenteditable")=="true"){b.push(a);return false}},CKEDITOR.NODE_ELEMENT,true);return b}function f(a,d,c,e){a:{e==void 0&&(e=b(c));for(var g;g=e.shift();)if(g.getDtd().p){e={element:g,remaining:e};
break a}e=null}if(!e)return 0;if((g=CKEDITOR.filter.instances[e.element.data("cke-filter")])&&!g.check(d))return f(a,d,c,e.remaining);d=new CKEDITOR.dom.range(e.element);d.selectNodeContents(e.element);d=d.createIterator();d.enlargeBr=a.enlargeBr;d.enforceRealBlocks=a.enforceRealBlocks;d.activeFilter=d.filter=g;a._.nestedEditable={element:e.element,container:c,remaining:e.remaining,iterator:d};return 1}var d=/^[\r\n\t ]+$/,e=CKEDITOR.dom.walker.bookmark(false,true),g=CKEDITOR.dom.walker.whitespaces(true),
n=function(a){return e(a)&&g(a)};a.prototype={getNextParagraph:function(a){var b,g,p,s,x,a=a||"p";if(this._.nestedEditable){if(b=this._.nestedEditable.iterator.getNextParagraph(a)){this.activeFilter=this._.nestedEditable.iterator.activeFilter;return b}this.activeFilter=this.filter;if(f(this,a,this._.nestedEditable.container,this._.nestedEditable.remaining)){this.activeFilter=this._.nestedEditable.iterator.activeFilter;return this._.nestedEditable.iterator.getNextParagraph(a)}this._.nestedEditable=
null}if(!this.range.root.getDtd()[a])return null;if(!this._.started){var q=this.range.clone();q.shrink(CKEDITOR.SHRINK_ELEMENT,true);g=q.endContainer.hasAscendant("pre",true)||q.startContainer.hasAscendant("pre",true);q.enlarge(this.forceBrBreak&&!g||!this.enlargeBr?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS);if(!q.collapsed){g=new CKEDITOR.dom.walker(q.clone());var o=CKEDITOR.dom.walker.bookmark(true,true);g.evaluator=o;this._.nextNode=g.next();g=new CKEDITOR.dom.walker(q.clone());
g.evaluator=o;g=g.previous();this._.lastNode=g.getNextSourceNode(true);if(this._.lastNode&&this._.lastNode.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(this._.lastNode.getText())&&this._.lastNode.getParent().isBlockBoundary()){o=this.range.clone();o.moveToPosition(this._.lastNode,CKEDITOR.POSITION_AFTER_END);if(o.checkEndOfBlock()){o=new CKEDITOR.dom.elementPath(o.endContainer,o.root);this._.lastNode=(o.block||o.blockLimit).getNextSourceNode(true)}}if(!this._.lastNode||!q.root.contains(this._.lastNode)){this._.lastNode=
this._.docEndMarker=q.document.createText("");this._.lastNode.insertAfter(g)}q=null}this._.started=1;g=q}o=this._.nextNode;q=this._.lastNode;for(this._.nextNode=null;o;){var u=0,A=o.hasAscendant("pre"),k=o.type!=CKEDITOR.NODE_ELEMENT,l=0;if(k)o.type==CKEDITOR.NODE_TEXT&&d.test(o.getText())&&(k=0);else{var j=o.getName();if(CKEDITOR.dtd.$block[j]&&o.getAttribute("contenteditable")=="false"){b=o;f(this,a,b);break}else if(o.isBlockBoundary(this.forceBrBreak&&!A&&{br:1})){if(j=="br")k=1;else if(!g&&!o.getChildCount()&&
j!="hr"){b=o;p=o.equals(q);break}if(g){g.setEndAt(o,CKEDITOR.POSITION_BEFORE_START);if(j!="br")this._.nextNode=o}u=1}else{if(o.getFirst()){if(!g){g=this.range.clone();g.setStartAt(o,CKEDITOR.POSITION_BEFORE_START)}o=o.getFirst();continue}k=1}}if(k&&!g){g=this.range.clone();g.setStartAt(o,CKEDITOR.POSITION_BEFORE_START)}p=(!u||k)&&o.equals(q);if(g&&!u)for(;!o.getNext(n)&&!p;){j=o.getParent();if(j.isBlockBoundary(this.forceBrBreak&&!A&&{br:1})){u=1;k=0;p||j.equals(q);g.setEndAt(j,CKEDITOR.POSITION_BEFORE_END);
break}o=j;k=1;p=o.equals(q);l=1}k&&g.setEndAt(o,CKEDITOR.POSITION_AFTER_END);o=c(o,l,q);if((p=!o)||u&&g)break}if(!b){if(!g){this._.docEndMarker&&this._.docEndMarker.remove();return this._.nextNode=null}b=new CKEDITOR.dom.elementPath(g.startContainer,g.root);o=b.blockLimit;u={div:1,th:1,td:1};b=b.block;if(!b&&o&&!this.enforceRealBlocks&&u[o.getName()]&&g.checkStartOfBlock()&&g.checkEndOfBlock()&&!o.equals(g.root))b=o;else if(!b||this.enforceRealBlocks&&b.getName()=="li"){b=this.range.document.createElement(a);
g.extractContents().appendTo(b);b.trim();g.insertNode(b);s=x=true}else if(b.getName()!="li"){if(!g.checkStartOfBlock()||!g.checkEndOfBlock()){b=b.clone(false);g.extractContents().appendTo(b);b.trim();x=g.splitBlock();s=!x.wasStartOfBlock;x=!x.wasEndOfBlock;g.insertNode(b)}}else if(!p)this._.nextNode=b.equals(q)?null:c(g.getBoundaryNodes().endNode,1,q)}if(s)(s=b.getPrevious())&&s.type==CKEDITOR.NODE_ELEMENT&&(s.getName()=="br"?s.remove():s.getLast()&&s.getLast().$.nodeName.toLowerCase()=="br"&&s.getLast().remove());
if(x)(s=b.getLast())&&s.type==CKEDITOR.NODE_ELEMENT&&s.getName()=="br"&&(!CKEDITOR.env.needsBrFiller||s.getPrevious(e)||s.getNext(e))&&s.remove();if(!this._.nextNode)this._.nextNode=p||b.equals(q)||!q?null:c(b,1,q);return b}};CKEDITOR.dom.range.prototype.createIterator=function(){return new a(this)}})();
CKEDITOR.command=function(a,c){this.uiItems=[];this.exec=function(b){if(this.state==CKEDITOR.TRISTATE_DISABLED||!this.checkAllowed())return false;this.editorFocus&&a.focus();return this.fire("exec")===false?true:c.exec.call(this,a,b)!==false};this.refresh=function(a,b){if(!this.readOnly&&a.readOnly)return true;if(this.context&&!b.isContextFor(this.context)){this.disable();return true}if(!this.checkAllowed(true)){this.disable();return true}this.startDisabled||this.enable();this.modes&&!this.modes[a.mode]&&
this.disable();return this.fire("refresh",{editor:a,path:b})===false?true:c.refresh&&c.refresh.apply(this,arguments)!==false};var b;this.checkAllowed=function(c){return!c&&typeof b=="boolean"?b:b=a.activeFilter.checkFeature(this)};CKEDITOR.tools.extend(this,c,{modes:{wysiwyg:1},editorFocus:1,contextSensitive:!!c.context,state:CKEDITOR.TRISTATE_DISABLED});CKEDITOR.event.call(this)};
CKEDITOR.command.prototype={enable:function(){this.state==CKEDITOR.TRISTATE_DISABLED&&this.checkAllowed()&&this.setState(!this.preserveState||typeof this.previousState=="undefined"?CKEDITOR.TRISTATE_OFF:this.previousState)},disable:function(){this.setState(CKEDITOR.TRISTATE_DISABLED)},setState:function(a){if(this.state==a||a!=CKEDITOR.TRISTATE_DISABLED&&!this.checkAllowed())return false;this.previousState=this.state;this.state=a;this.fire("state");return true},toggleState:function(){this.state==CKEDITOR.TRISTATE_OFF?
this.setState(CKEDITOR.TRISTATE_ON):this.state==CKEDITOR.TRISTATE_ON&&this.setState(CKEDITOR.TRISTATE_OFF)}};CKEDITOR.event.implementOn(CKEDITOR.command.prototype);CKEDITOR.ENTER_P=1;CKEDITOR.ENTER_BR=2;CKEDITOR.ENTER_DIV=3;
CKEDITOR.config={customConfig:"config.js",autoUpdateElement:!0,language:"",defaultLanguage:"en",contentsLangDirection:"",enterMode:CKEDITOR.ENTER_P,forceEnterMode:!1,shiftEnterMode:CKEDITOR.ENTER_BR,docType:"<!DOCTYPE html>",bodyId:"",bodyClass:"",fullPage:!1,height:200,extraPlugins:"",removePlugins:"",protectedSource:[],tabIndex:0,width:"",baseFloatZIndex:1E4,blockedKeystrokes:[CKEDITOR.CTRL+66,CKEDITOR.CTRL+73,CKEDITOR.CTRL+85]};
(function(){function a(a,b,d,c,e){var f,o,a=[];for(f in b){o=b[f];o=typeof o=="boolean"?{}:typeof o=="function"?{match:o}:L(o);if(f.charAt(0)!="$")o.elements=f;if(d)o.featureName=d.toLowerCase();var j=o;j.elements=g(j.elements,/\s+/)||null;j.propertiesOnly=j.propertiesOnly||j.elements===true;var k=/\s*,\s*/,l=void 0;for(l in t){j[l]=g(j[l],k)||null;var v=j,r=E[l],y=g(j[E[l]],k),q=j[l],w=[],u=true,h=void 0;y?u=false:y={};for(h in q)if(h.charAt(0)=="!"){h=h.slice(1);w.push(h);y[h]=true;u=false}for(;h=
w.pop();){q[h]=q["!"+h];delete q["!"+h]}v[r]=(u?false:y)||null}j.match=j.match||null;c.push(o);a.push(o)}for(var b=e.elements,e=e.generic,i,d=0,c=a.length;d<c;++d){f=L(a[d]);o=f.classes===true||f.styles===true||f.attributes===true;j=f;l=r=k=void 0;for(k in t)j[k]=A(j[k]);v=true;for(l in E){k=E[l];r=j[k];y=[];q=void 0;for(q in r)q.indexOf("*")>-1?y.push(RegExp("^"+q.replace(/\*/g,".*")+"$")):y.push(q);r=y;if(r.length){j[k]=r;v=false}}j.nothingRequired=v;j.noProperties=!(j.attributes||j.classes||j.styles);
if(f.elements===true||f.elements===null)e[o?"unshift":"push"](f);else{j=f.elements;delete f.elements;for(i in j)if(b[i])b[i][o?"unshift":"push"](f);else b[i]=[f]}}}function c(a,d,c,e){if(!a.match||a.match(d))if(e||n(a,d)){if(!a.propertiesOnly)c.valid=true;if(!c.allAttributes)c.allAttributes=b(a.attributes,d.attributes,c.validAttributes);if(!c.allStyles)c.allStyles=b(a.styles,d.styles,c.validStyles);if(!c.allClasses){a=a.classes;d=d.classes;e=c.validClasses;if(a)if(a===true)a=true;else{for(var f=0,
o=d.length,j;f<o;++f){j=d[f];e[j]||(e[j]=a(j))}a=false}else a=false;c.allClasses=a}}}function b(a,b,d){if(!a)return false;if(a===true)return true;for(var c in b)d[c]||(d[c]=a(c));return false}function f(a,b,c){if(!a.match||a.match(b)){if(a.noProperties)return false;c.hadInvalidAttribute=d(a.attributes,b.attributes)||c.hadInvalidAttribute;c.hadInvalidStyle=d(a.styles,b.styles)||c.hadInvalidStyle;a=a.classes;b=b.classes;if(a){for(var e=false,f=a===true,o=b.length;o--;)if(f||a(b[o])){b.splice(o,1);e=
true}a=e}else a=false;c.hadInvalidClass=a||c.hadInvalidClass}}function d(a,b){if(!a)return false;var d=false,c=a===true,e;for(e in b)if(c||a(e)){delete b[e];d=true}return d}function e(a,b,d){if(a.disabled||a.customConfig&&!d||!b)return false;a._.cachedChecks={};return true}function g(a,b){if(!a)return false;if(a===true)return a;if(typeof a=="string"){a=J(a);return a=="*"?true:CKEDITOR.tools.convertArrayToObject(a.split(b))}if(CKEDITOR.tools.isArray(a))return a.length?CKEDITOR.tools.convertArrayToObject(a):
false;var d={},c=0,e;for(e in a){d[e]=a[e];c++}return c?d:false}function n(a,b){if(a.nothingRequired)return true;var d,c,e,f;if(e=a.requiredClasses){f=b.classes;for(d=0;d<e.length;++d){c=e[d];if(typeof c=="string"){if(CKEDITOR.tools.indexOf(f,c)==-1)return false}else if(!CKEDITOR.tools.checkIfAnyArrayItemMatches(f,c))return false}}return h(b.styles,a.requiredStyles)&&h(b.attributes,a.requiredAttributes)}function h(a,b){if(!b)return true;for(var d=0,c;d<b.length;++d){c=b[d];if(typeof c=="string"){if(!(c in
a))return false}else if(!CKEDITOR.tools.checkIfAnyObjectPropertyMatches(a,c))return false}return true}function i(a){if(!a)return{};for(var a=a.split(/\s*,\s*/).sort(),b={};a.length;)b[a.shift()]=w;return b}function m(a){for(var b,d,c,e,f={},o=1,a=J(a);b=a.match(y);){if(d=b[2]){c=p(d,"styles");e=p(d,"attrs");d=p(d,"classes")}else c=e=d=null;f["$"+o++]={elements:b[1],classes:d,styles:c,attributes:e};a=a.slice(b[0].length)}return f}function p(a,b){var d=a.match(C[b]);return d?J(d[1]):null}function s(a){var b=
a.styleBackup=a.attributes.style,d=a.classBackup=a.attributes["class"];if(!a.styles)a.styles=CKEDITOR.tools.parseCssText(b||"",1);if(!a.classes)a.classes=d?d.split(/\s+/):[]}function x(a,b,d,e){var j=0,k;if(e.toHtml)b.name=b.name.replace(ba,"$1");if(e.doCallbacks&&a.elementCallbacks){a:for(var l=a.elementCallbacks,g=0,r=l.length,y;g<r;++g)if(y=l[g](b)){k=y;break a}if(k)return k}if(e.doTransform)if(k=a._.transformations[b.name]){s(b);for(l=0;l<k.length;++l)v(a,b,k[l]);o(b)}if(e.doFilter){a:{l=b.name;
g=a._;a=g.allowedRules.elements[l];k=g.allowedRules.generic;l=g.disallowedRules.elements[l];g=g.disallowedRules.generic;r=e.skipRequired;y={valid:false,validAttributes:{},validClasses:{},validStyles:{},allAttributes:false,allClasses:false,allStyles:false,hadInvalidAttribute:false,hadInvalidClass:false,hadInvalidStyle:false};var q,w;if(!a&&!k)a=null;else{s(b);if(l){q=0;for(w=l.length;q<w;++q)if(f(l[q],b,y)===false){a=null;break a}}if(g){q=0;for(w=g.length;q<w;++q)f(g[q],b,y)}if(a){q=0;for(w=a.length;q<
w;++q)c(a[q],b,y,r)}if(k){q=0;for(w=k.length;q<w;++q)c(k[q],b,y,r)}a=y}}if(!a){d.push(b);return D}if(!a.valid){d.push(b);return D}w=a.validAttributes;var h=a.validStyles;k=a.validClasses;var l=b.attributes,E=b.styles,g=b.classes,r=b.classBackup,i=b.styleBackup,t,z,C=[];y=[];var I=/^data-cke-/;q=false;delete l.style;delete l["class"];delete b.classBackup;delete b.styleBackup;if(!a.allAttributes)for(t in l)if(!w[t])if(I.test(t)){if(t!=(z=t.replace(/^data-cke-saved-/,""))&&!w[z]){delete l[t];q=true}}else{delete l[t];
q=true}if(!a.allStyles||a.hadInvalidStyle){for(t in E)a.allStyles||h[t]?C.push(t+":"+E[t]):q=true;if(C.length)l.style=C.sort().join("; ")}else if(i)l.style=i;if(!a.allClasses||a.hadInvalidClass){for(t=0;t<g.length;++t)(a.allClasses||k[g[t]])&&y.push(g[t]);y.length&&(l["class"]=y.sort().join(" "));r&&y.length<r.split(/\s+/).length&&(q=true)}else r&&(l["class"]=r);q&&(j=D);if(!e.skipFinalValidation&&!u(b)){d.push(b);return D}}if(e.toHtml)b.name=b.name.replace(ca,"cke:$1");return j}function q(a){var b=
[],d;for(d in a)d.indexOf("*")>-1&&b.push(d.replace(/\*/g,".*"));return b.length?RegExp("^(?:"+b.join("|")+")$"):null}function o(a){var b=a.attributes,d;delete b.style;delete b["class"];if(d=CKEDITOR.tools.writeCssText(a.styles,true))b.style=d;a.classes.length&&(b["class"]=a.classes.sort().join(" "))}function u(a){switch(a.name){case "a":if(!a.children.length&&!a.attributes.name)return false;break;case "img":if(!a.attributes.src)return false}return true}function A(a){if(!a)return false;if(a===true)return true;
var b=q(a);return function(d){return d in a||b&&d.match(b)}}function k(){return new CKEDITOR.htmlParser.element("br")}function l(a){return a.type==CKEDITOR.NODE_ELEMENT&&(a.name=="br"||F.$block[a.name])}function j(a,b,d){var c=a.name;if(F.$empty[c]||!a.children.length)if(c=="hr"&&b=="br")a.replaceWith(k());else{a.parent&&d.push({check:"it",el:a.parent});a.remove()}else if(F.$block[c]||c=="tr")if(b=="br"){if(a.previous&&!l(a.previous)){b=k();b.insertBefore(a)}if(a.next&&!l(a.next)){b=k();b.insertAfter(a)}a.replaceWithChildren()}else{var c=
a.children,e;b:{e=F[b];for(var f=0,o=c.length,j;f<o;++f){j=c[f];if(j.type==CKEDITOR.NODE_ELEMENT&&!e[j.name]){e=false;break b}}e=true}if(e){a.name=b;a.attributes={};d.push({check:"parent-down",el:a})}else{e=a.parent;for(var f=e.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||e.name=="body",g,o=c.length;o>0;){j=c[--o];if(f&&(j.type==CKEDITOR.NODE_TEXT||j.type==CKEDITOR.NODE_ELEMENT&&F.$inline[j.name])){if(!g){g=new CKEDITOR.htmlParser.element(b);g.insertAfter(a);d.push({check:"parent-down",el:g})}g.add(j,0)}else{g=
null;j.insertAfter(a);e.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(j.type==CKEDITOR.NODE_ELEMENT&&!F[e.name][j.name])&&d.push({check:"el-up",el:j})}}a.remove()}}else if(c=="style")a.remove();else{a.parent&&d.push({check:"it",el:a.parent});a.replaceWithChildren()}}function v(a,b,d){var c,e;for(c=0;c<d.length;++c){e=d[c];if((!e.check||a.check(e.check,false))&&(!e.left||e.left(b))){e.right(b,G);break}}}function I(a,b){var d=b.getDefinition(),c=d.attributes,e=d.styles,f,o,j,k;if(a.name!=d.element)return false;
for(f in c)if(f=="class"){d=c[f].split(/\s+/);for(j=a.classes.join("|");k=d.pop();)if(j.indexOf(k)==-1)return false}else if(a.attributes[f]!=c[f])return false;for(o in e)if(a.styles[o]!=e[o])return false;return true}function r(a,b){var d,c;if(typeof a=="string")d=a;else if(a instanceof CKEDITOR.style)c=a;else{d=a[0];c=a[1]}return[{element:d,left:c,right:function(a,d){d.transform(a,b)}}]}function O(a){return function(b){return I(b,a)}}function S(a){return function(b,d){d[a](b)}}var F=CKEDITOR.dtd,
D=1,L=CKEDITOR.tools.copy,J=CKEDITOR.tools.trim,w="cke-test",z=["","p","br","div"];CKEDITOR.FILTER_SKIP_TREE=2;CKEDITOR.filter=function(a){this.allowedContent=[];this.disallowedContent=[];this.elementCallbacks=null;this.disabled=false;this.editor=null;this.id=CKEDITOR.tools.getNextNumber();this._={allowedRules:{elements:{},generic:[]},disallowedRules:{elements:{},generic:[]},transformations:{},cachedTests:{}};CKEDITOR.filter.instances[this.id]=this;if(a instanceof CKEDITOR.editor){a=this.editor=a;
this.customConfig=true;var b=a.config.allowedContent;if(b===true)this.disabled=true;else{if(!b)this.customConfig=false;this.allow(b,"config",1);this.allow(a.config.extraAllowedContent,"extra",1);this.allow(z[a.enterMode]+" "+z[a.shiftEnterMode],"default",1);this.disallow(a.config.disallowedContent)}}else{this.customConfig=false;this.allow(a,"default",1)}};CKEDITOR.filter.instances={};CKEDITOR.filter.prototype={allow:function(b,d,c){if(!e(this,b,c))return false;var f,o;if(typeof b=="string")b=m(b);
else if(b instanceof CKEDITOR.style){if(b.toAllowedContentRules)return this.allow(b.toAllowedContentRules(this.editor),d,c);f=b.getDefinition();b={};c=f.attributes;b[f.element]=f={styles:f.styles,requiredStyles:f.styles&&CKEDITOR.tools.objectKeys(f.styles)};if(c){c=L(c);f.classes=c["class"]?c["class"].split(/\s+/):null;f.requiredClasses=f.classes;delete c["class"];f.attributes=c;f.requiredAttributes=c&&CKEDITOR.tools.objectKeys(c)}}else if(CKEDITOR.tools.isArray(b)){for(f=0;f<b.length;++f)o=this.allow(b[f],
d,c);return o}a(this,b,d,this.allowedContent,this._.allowedRules);return true},applyTo:function(a,b,d,c){if(this.disabled)return false;var e=this,f=[],o=this.editor&&this.editor.config.protectedSource,k,l=false,g={doFilter:!d,doTransform:true,doCallbacks:true,toHtml:b};a.forEach(function(a){if(a.type==CKEDITOR.NODE_ELEMENT){if(a.attributes["data-cke-filter"]=="off")return false;if(!b||!(a.name=="span"&&~CKEDITOR.tools.objectKeys(a.attributes).join("|").indexOf("data-cke-"))){k=x(e,a,f,g);if(k&D)l=
true;else if(k&2)return false}}else if(a.type==CKEDITOR.NODE_COMMENT&&a.value.match(/^\{cke_protected\}(?!\{C\})/)){var d;a:{var c=decodeURIComponent(a.value.replace(/^\{cke_protected\}/,""));d=[];var j,v,r;if(o)for(v=0;v<o.length;++v)if((r=c.match(o[v]))&&r[0].length==c.length){d=true;break a}c=CKEDITOR.htmlParser.fragment.fromHtml(c);c.children.length==1&&(j=c.children[0]).type==CKEDITOR.NODE_ELEMENT&&x(e,j,d,g);d=!d.length}d||f.push(a)}},null,true);f.length&&(l=true);for(var v,a=[],c=z[c||(this.editor?
this.editor.enterMode:CKEDITOR.ENTER_P)];d=f.pop();)d.type==CKEDITOR.NODE_ELEMENT?j(d,c,a):d.remove();for(;v=a.pop();){d=v.el;if(d.parent)switch(v.check){case "it":F.$removeEmpty[d.name]&&!d.children.length?j(d,c,a):u(d)||j(d,c,a);break;case "el-up":d.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!F[d.parent.name][d.name]&&j(d,c,a);break;case "parent-down":d.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!F[d.parent.name][d.name]&&j(d.parent,c,a)}}return l},checkFeature:function(a){if(this.disabled||
!a)return true;a.toFeature&&(a=a.toFeature(this.editor));return!a.requiredContent||this.check(a.requiredContent)},disable:function(){this.disabled=true},disallow:function(b){if(!e(this,b,true))return false;typeof b=="string"&&(b=m(b));a(this,b,null,this.disallowedContent,this._.disallowedRules);return true},addContentForms:function(a){if(!this.disabled&&a){var b,d,c=[],e;for(b=0;b<a.length&&!e;++b){d=a[b];if((typeof d=="string"||d instanceof CKEDITOR.style)&&this.check(d))e=d}if(e){for(b=0;b<a.length;++b)c.push(r(a[b],
e));this.addTransformations(c)}}},addElementCallback:function(a){if(!this.elementCallbacks)this.elementCallbacks=[];this.elementCallbacks.push(a)},addFeature:function(a){if(this.disabled||!a)return true;a.toFeature&&(a=a.toFeature(this.editor));this.allow(a.allowedContent,a.name);this.addTransformations(a.contentTransformations);this.addContentForms(a.contentForms);return a.requiredContent&&(this.customConfig||this.disallowedContent.length)?this.check(a.requiredContent):true},addTransformations:function(a){var b,
d;if(!this.disabled&&a){var c=this._.transformations,e;for(e=0;e<a.length;++e){b=a[e];var f=void 0,o=void 0,j=void 0,k=void 0,l=void 0,g=void 0;d=[];for(o=0;o<b.length;++o){j=b[o];if(typeof j=="string"){j=j.split(/\s*:\s*/);k=j[0];l=null;g=j[1]}else{k=j.check;l=j.left;g=j.right}if(!f){f=j;f=f.element?f.element:k?k.match(/^([a-z0-9]+)/i)[0]:f.left.getDefinition().element}l instanceof CKEDITOR.style&&(l=O(l));d.push({check:k==f?null:k,left:l,right:typeof g=="string"?S(g):g})}b=f;c[b]||(c[b]=[]);c[b].push(d)}}},
check:function(a,b,d){if(this.disabled)return true;if(CKEDITOR.tools.isArray(a)){for(var c=a.length;c--;)if(this.check(a[c],b,d))return true;return false}var e,f;if(typeof a=="string"){f=a+"<"+(b===false?"0":"1")+(d?"1":"0")+">";if(f in this._.cachedChecks)return this._.cachedChecks[f];c=m(a).$1;e=c.styles;var j=c.classes;c.name=c.elements;c.classes=j=j?j.split(/\s*,\s*/):[];c.styles=i(e);c.attributes=i(c.attributes);c.children=[];j.length&&(c.attributes["class"]=j.join(" "));if(e)c.attributes.style=
CKEDITOR.tools.writeCssText(c.styles);e=c}else{c=a.getDefinition();e=c.styles;j=c.attributes||{};if(e){e=L(e);j.style=CKEDITOR.tools.writeCssText(e,true)}else e={};e={name:c.element,attributes:j,classes:j["class"]?j["class"].split(/\s+/):[],styles:e,children:[]}}var j=CKEDITOR.tools.clone(e),k=[],l;if(b!==false&&(l=this._.transformations[e.name])){for(c=0;c<l.length;++c)v(this,e,l[c]);o(e)}x(this,j,k,{doFilter:true,doTransform:b!==false,skipRequired:!d,skipFinalValidation:!d});b=k.length>0?false:
CKEDITOR.tools.objectCompare(e.attributes,j.attributes,true)?true:false;typeof a=="string"&&(this._.cachedChecks[f]=b);return b},getAllowedEnterMode:function(){var a=["p","div","br"],b={p:CKEDITOR.ENTER_P,div:CKEDITOR.ENTER_DIV,br:CKEDITOR.ENTER_BR};return function(d,c){var e=a.slice(),f;if(this.check(z[d]))return d;for(c||(e=e.reverse());f=e.pop();)if(this.check(f))return b[f];return CKEDITOR.ENTER_BR}}()};var t={styles:1,attributes:1,classes:1},E={styles:"requiredStyles",attributes:"requiredAttributes",
classes:"requiredClasses"},y=/^([a-z0-9*\s]+)((?:\s*\{[!\w\-,\s\*]+\}\s*|\s*\[[!\w\-,\s\*]+\]\s*|\s*\([!\w\-,\s\*]+\)\s*){0,3})(?:;\s*|$)/i,C={styles:/{([^}]+)}/,attrs:/\[([^\]]+)\]/,classes:/\(([^\)]+)\)/},ba=/^cke:(object|embed|param)$/,ca=/^(object|embed|param)$/,G=CKEDITOR.filter.transformationsTools={sizeToStyle:function(a){this.lengthToStyle(a,"width");this.lengthToStyle(a,"height")},sizeToAttribute:function(a){this.lengthToAttribute(a,"width");this.lengthToAttribute(a,"height")},lengthToStyle:function(a,
b,d){d=d||b;if(!(d in a.styles)){var c=a.attributes[b];if(c){/^\d+$/.test(c)&&(c=c+"px");a.styles[d]=c}}delete a.attributes[b]},lengthToAttribute:function(a,b,d){d=d||b;if(!(d in a.attributes)){var c=a.styles[b],e=c&&c.match(/^(\d+)(?:\.\d*)?px$/);e?a.attributes[d]=e[1]:c==w&&(a.attributes[d]=w)}delete a.styles[b]},alignmentToStyle:function(a){if(!("float"in a.styles)){var b=a.attributes.align;if(b=="left"||b=="right")a.styles["float"]=b}delete a.attributes.align},alignmentToAttribute:function(a){if(!("align"in
a.attributes)){var b=a.styles["float"];if(b=="left"||b=="right")a.attributes.align=b}delete a.styles["float"]},matchesStyle:I,transform:function(a,b){if(typeof b=="string")a.name=b;else{var d=b.getDefinition(),c=d.styles,e=d.attributes,f,j,o,k;a.name=d.element;for(f in e)if(f=="class"){d=a.classes.join("|");for(o=e[f].split(/\s+/);k=o.pop();)d.indexOf(k)==-1&&a.classes.push(k)}else a.attributes[f]=e[f];for(j in c)a.styles[j]=c[j]}}}})();
(function(){CKEDITOR.focusManager=function(a){if(a.focusManager)return a.focusManager;this.hasFocus=false;this.currentActive=null;this._={editor:a};return this};CKEDITOR.focusManager._={blurDelay:200};CKEDITOR.focusManager.prototype={focus:function(a){this._.timer&&clearTimeout(this._.timer);if(a)this.currentActive=a;if(!this.hasFocus&&!this._.locked){(a=CKEDITOR.currentInstance)&&a.focusManager.blur(1);this.hasFocus=true;(a=this._.editor.container)&&a.addClass("cke_focus");this._.editor.fire("focus")}},
lock:function(){this._.locked=1},unlock:function(){delete this._.locked},blur:function(a){function c(){if(this.hasFocus){this.hasFocus=false;var a=this._.editor.container;a&&a.removeClass("cke_focus");this._.editor.fire("blur")}}if(!this._.locked){this._.timer&&clearTimeout(this._.timer);var b=CKEDITOR.focusManager._.blurDelay;a||!b?c.call(this):this._.timer=CKEDITOR.tools.setTimeout(function(){delete this._.timer;c.call(this)},b,this)}},add:function(a,c){var b=a.getCustomData("focusmanager");if(!b||
b!=this){b&&b.remove(a);var b="focus",f="blur";if(c)if(CKEDITOR.env.ie){b="focusin";f="focusout"}else CKEDITOR.event.useCapture=1;var d={blur:function(){a.equals(this.currentActive)&&this.blur()},focus:function(){this.focus(a)}};a.on(b,d.focus,this);a.on(f,d.blur,this);if(c)CKEDITOR.event.useCapture=0;a.setCustomData("focusmanager",this);a.setCustomData("focusmanager_handlers",d)}},remove:function(a){a.removeCustomData("focusmanager");var c=a.removeCustomData("focusmanager_handlers");a.removeListener("blur",
c.blur);a.removeListener("focus",c.focus)}}})();CKEDITOR.keystrokeHandler=function(a){if(a.keystrokeHandler)return a.keystrokeHandler;this.keystrokes={};this.blockedKeystrokes={};this._={editor:a};return this};
(function(){var a,c=function(b){var b=b.data,d=b.getKeystroke(),c=this.keystrokes[d],g=this._.editor;a=g.fire("key",{keyCode:d,domEvent:b})===false;if(!a){c&&(a=g.execCommand(c,{from:"keystrokeHandler"})!==false);a||(a=!!this.blockedKeystrokes[d])}a&&b.preventDefault(true);return!a},b=function(b){if(a){a=false;b.data.preventDefault(true)}};CKEDITOR.keystrokeHandler.prototype={attach:function(a){a.on("keydown",c,this);if(CKEDITOR.env.gecko&&CKEDITOR.env.mac)a.on("keypress",b,this)}}})();
(function(){CKEDITOR.lang={languages:{af:1,ar:1,bg:1,bn:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,"en-au":1,"en-ca":1,"en-gb":1,en:1,eo:1,es:1,et:1,eu:1,fa:1,fi:1,fo:1,"fr-ca":1,fr:1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,is:1,it:1,ja:1,ka:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,ms:1,nb:1,nl:1,no:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,"sr-latn":1,sr:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,"zh-cn":1,zh:1},rtl:{ar:1,fa:1,he:1,ku:1,ug:1},load:function(a,c,b){if(!a||!CKEDITOR.lang.languages[a])a=this.detect(c,
a);var f=this,c=function(){f[a].dir=f.rtl[a]?"rtl":"ltr";b(a,f[a])};this[a]?c():CKEDITOR.scriptLoader.load(CKEDITOR.getUrl("lang/"+a+".js"),c,this)},detect:function(a,c){var b=this.languages,c=c||navigator.userLanguage||navigator.language||a,f=c.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),d=f[1],f=f[2];b[d+"-"+f]?d=d+"-"+f:b[d]||(d=null);CKEDITOR.lang.detect=d?function(){return d}:function(a){return a};return d||a}}})();
CKEDITOR.scriptLoader=function(){var a={},c={};return{load:function(b,f,d,e){var g=typeof b=="string";g&&(b=[b]);d||(d=CKEDITOR);var n=b.length,h=[],i=[],m=function(a){f&&(g?f.call(d,a):f.call(d,h,i))};if(n===0)m(true);else{var p=function(a,b){(b?h:i).push(a);if(--n<=0){e&&CKEDITOR.document.getDocumentElement().removeStyle("cursor");m(b)}},s=function(b,d){a[b]=1;var e=c[b];delete c[b];for(var f=0;f<e.length;f++)e[f](b,d)},x=function(b){if(a[b])p(b,true);else{var d=c[b]||(c[b]=[]);d.push(p);if(!(d.length>
1)){var e=new CKEDITOR.dom.element("script");e.setAttributes({type:"text/javascript",src:b});if(f)if(CKEDITOR.env.ie&&CKEDITOR.env.version<11)e.$.onreadystatechange=function(){if(e.$.readyState=="loaded"||e.$.readyState=="complete"){e.$.onreadystatechange=null;s(b,true)}};else{e.$.onload=function(){setTimeout(function(){s(b,true)},0)};e.$.onerror=function(){s(b,false)}}e.appendTo(CKEDITOR.document.getHead())}}};e&&CKEDITOR.document.getDocumentElement().setStyle("cursor","wait");for(var q=0;q<n;q++)x(b[q])}},
queue:function(){function a(){var b;(b=c[0])&&this.load(b.scriptUrl,b.callback,CKEDITOR,0)}var c=[];return function(d,e){var g=this;c.push({scriptUrl:d,callback:function(){e&&e.apply(this,arguments);c.shift();a.call(g)}});c.length==1&&a.call(this)}}()}}();CKEDITOR.resourceManager=function(a,c){this.basePath=a;this.fileName=c;this.registered={};this.loaded={};this.externals={};this._={waitingList:{}}};
CKEDITOR.resourceManager.prototype={add:function(a,c){if(this.registered[a])throw'[CKEDITOR.resourceManager.add] The resource name "'+a+'" is already registered.';var b=this.registered[a]=c||{};b.name=a;b.path=this.getPath(a);CKEDITOR.fire(a+CKEDITOR.tools.capitalize(this.fileName)+"Ready",b);return this.get(a)},get:function(a){return this.registered[a]||null},getPath:function(a){var c=this.externals[a];return CKEDITOR.getUrl(c&&c.dir||this.basePath+a+"/")},getFilePath:function(a){var c=this.externals[a];
return CKEDITOR.getUrl(this.getPath(a)+(c?c.file:this.fileName+".js"))},addExternal:function(a,c,b){for(var a=a.split(","),f=0;f<a.length;f++){var d=a[f];b||(c=c.replace(/[^\/]+$/,function(a){b=a;return""}));this.externals[d]={dir:c,file:b||this.fileName+".js"}}},load:function(a,c,b){CKEDITOR.tools.isArray(a)||(a=a?[a]:[]);for(var f=this.loaded,d=this.registered,e=[],g={},n={},h=0;h<a.length;h++){var i=a[h];if(i)if(!f[i]&&!d[i]){var m=this.getFilePath(i);e.push(m);m in g||(g[m]=[]);g[m].push(i)}else n[i]=
this.get(i)}CKEDITOR.scriptLoader.load(e,function(a,d){if(d.length)throw'[CKEDITOR.resourceManager.load] Resource name "'+g[d[0]].join(",")+'" was not found at "'+d[0]+'".';for(var e=0;e<a.length;e++)for(var q=g[a[e]],o=0;o<q.length;o++){var u=q[o];n[u]=this.get(u);f[u]=1}c.call(b,n)},this)}};CKEDITOR.plugins=new CKEDITOR.resourceManager("plugins/","plugin");
CKEDITOR.plugins.load=CKEDITOR.tools.override(CKEDITOR.plugins.load,function(a){var c={};return function(b,f,d){var e={},g=function(b){a.call(this,b,function(a){CKEDITOR.tools.extend(e,a);var b=[],n;for(n in a){var p=a[n],s=p&&p.requires;if(!c[n]){if(p.icons)for(var x=p.icons.split(","),q=x.length;q--;)CKEDITOR.skin.addIcon(x[q],p.path+"icons/"+(CKEDITOR.env.hidpi&&p.hidpi?"hidpi/":"")+x[q]+".png");c[n]=1}if(s){s.split&&(s=s.split(","));for(p=0;p<s.length;p++)e[s[p]]||b.push(s[p])}}if(b.length)g.call(this,
b);else{for(n in e){p=e[n];if(p.onLoad&&!p.onLoad._called){p.onLoad()===false&&delete e[n];p.onLoad._called=1}}f&&f.call(d||window,e)}},this)};g.call(this,b)}});CKEDITOR.plugins.setLang=function(a,c,b){var f=this.get(a),a=f.langEntries||(f.langEntries={}),f=f.lang||(f.lang=[]);f.split&&(f=f.split(","));CKEDITOR.tools.indexOf(f,c)==-1&&f.push(c);a[c]=b};CKEDITOR.ui=function(a){if(a.ui)return a.ui;this.items={};this.instances={};this.editor=a;this._={handlers:{}};return this};
CKEDITOR.ui.prototype={add:function(a,c,b){b.name=a.toLowerCase();var f=this.items[a]={type:c,command:b.command||null,args:Array.prototype.slice.call(arguments,2)};CKEDITOR.tools.extend(f,b)},get:function(a){return this.instances[a]},create:function(a){var c=this.items[a],b=c&&this._.handlers[c.type],f=c&&c.command&&this.editor.getCommand(c.command),b=b&&b.create.apply(this,c.args);this.instances[a]=b;f&&f.uiItems.push(b);if(b&&!b.type)b.type=c.type;return b},addHandler:function(a,c){this._.handlers[a]=
c},space:function(a){return CKEDITOR.document.getById(this.spaceId(a))},spaceId:function(a){return this.editor.id+"_"+a}};CKEDITOR.event.implementOn(CKEDITOR.ui);
(function(){function a(a,e,f){CKEDITOR.event.call(this);a=a&&CKEDITOR.tools.clone(a);if(e!==void 0){if(e instanceof CKEDITOR.dom.element){if(!f)throw Error("One of the element modes must be specified.");}else throw Error("Expect element of type CKEDITOR.dom.element.");if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&f==CKEDITOR.ELEMENT_MODE_INLINE)throw Error("Inline element mode is not supported on IE quirks.");if(!(f==CKEDITOR.ELEMENT_MODE_INLINE?e.is(CKEDITOR.dtd.$editable)||e.is("textarea"):f==CKEDITOR.ELEMENT_MODE_REPLACE?
!e.is(CKEDITOR.dtd.$nonBodyContent):1))throw Error('The specified element mode is not supported on element: "'+e.getName()+'".');this.element=e;this.elementMode=f;this.name=this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO&&(e.getId()||e.getNameAtt())}else this.elementMode=CKEDITOR.ELEMENT_MODE_NONE;this._={};this.commands={};this.templates={};this.name=this.name||c();this.id=CKEDITOR.tools.getNextId();this.status="unloaded";this.config=CKEDITOR.tools.prototypedCopy(CKEDITOR.config);this.ui=new CKEDITOR.ui(this);
this.focusManager=new CKEDITOR.focusManager(this);this.keystrokeHandler=new CKEDITOR.keystrokeHandler(this);this.on("readOnly",b);this.on("selectionChange",function(a){d(this,a.data.path)});this.on("activeFilterChange",function(){d(this,this.elementPath(),true)});this.on("mode",b);this.on("instanceReady",function(){this.config.startupFocus&&this.focus()});CKEDITOR.fire("instanceCreated",null,this);CKEDITOR.add(this);CKEDITOR.tools.setTimeout(function(){g(this,a)},0,this)}function c(){do var a="editor"+
++s;while(CKEDITOR.instances[a]);return a}function b(){var a=this.commands,b;for(b in a)f(this,a[b])}function f(a,b){b[b.startDisabled?"disable":a.readOnly&&!b.readOnly?"disable":b.modes[a.mode]?"enable":"disable"]()}function d(a,b,d){if(b){var c,e,f=a.commands;for(e in f){c=f[e];(d||c.contextSensitive)&&c.refresh(a,b)}}}function e(a){var b=a.config.customConfig;if(!b)return false;var b=CKEDITOR.getUrl(b),d=x[b]||(x[b]={});if(d.fn){d.fn.call(a,a.config);(CKEDITOR.getUrl(a.config.customConfig)==b||
!e(a))&&a.fireOnce("customConfigLoaded")}else CKEDITOR.scriptLoader.queue(b,function(){d.fn=CKEDITOR.editorConfig?CKEDITOR.editorConfig:function(){};e(a)});return true}function g(a,b){a.on("customConfigLoaded",function(){if(b){if(b.on)for(var d in b.on)a.on(d,b.on[d]);CKEDITOR.tools.extend(a.config,b,true);delete a.config.on}d=a.config;a.readOnly=!(!d.readOnly&&!(a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.element.is("textarea")?a.element.hasAttribute("disabled"):a.element.isReadOnly():a.elementMode==
CKEDITOR.ELEMENT_MODE_REPLACE&&a.element.hasAttribute("disabled")));a.blockless=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?!(a.element.is("textarea")||CKEDITOR.dtd[a.element.getName()].p):false;a.tabIndex=d.tabIndex||a.element&&a.element.getAttribute("tabindex")||0;a.activeEnterMode=a.enterMode=a.blockless?CKEDITOR.ENTER_BR:d.enterMode;a.activeShiftEnterMode=a.shiftEnterMode=a.blockless?CKEDITOR.ENTER_BR:d.shiftEnterMode;if(d.skin)CKEDITOR.skinName=d.skin;a.fireOnce("configLoaded");a.dataProcessor=
new CKEDITOR.htmlDataProcessor(a);a.filter=a.activeFilter=new CKEDITOR.filter(a);n(a)});if(b&&b.customConfig!=void 0)a.config.customConfig=b.customConfig;e(a)||a.fireOnce("customConfigLoaded")}function n(a){CKEDITOR.skin.loadPart("editor",function(){h(a)})}function h(a){CKEDITOR.lang.load(a.config.language,a.config.defaultLanguage,function(b,d){var c=a.config.title;a.langCode=b;a.lang=CKEDITOR.tools.prototypedCopy(d);a.title=typeof c=="string"||c===false?c:[a.lang.editor,a.name].join(", ");if(!a.config.contentsLangDirection)a.config.contentsLangDirection=
a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.element.getDirection(1):a.lang.dir;a.fire("langLoaded");i(a)})}function i(a){a.getStylesSet(function(b){a.once("loaded",function(){a.fire("stylesSet",{styles:b})},null,null,1);m(a)})}function m(a){var b=a.config,d=b.plugins,c=b.extraPlugins,e=b.removePlugins;if(c)var f=RegExp("(?:^|,)(?:"+c.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),d=d.replace(f,""),d=d+(","+c);if(e)var j=RegExp("(?:^|,)(?:"+e.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),d=d.replace(j,"");CKEDITOR.env.air&&
(d=d+",adobeair");CKEDITOR.plugins.load(d.split(","),function(d){var c=[],e=[],f=[];a.plugins=d;for(var k in d){var l=d[k],g=l.lang,h=null,u=l.requires,w;CKEDITOR.tools.isArray(u)&&(u=u.join(","));if(u&&(w=u.match(j)))for(;u=w.pop();)CKEDITOR.tools.setTimeout(function(a,b){throw Error('Plugin "'+a.replace(",","")+'" cannot be removed from the plugins list, because it\'s required by "'+b+'" plugin.');},0,null,[u,k]);if(g&&!a.lang[k]){g.split&&(g=g.split(","));if(CKEDITOR.tools.indexOf(g,a.langCode)>=
0)h=a.langCode;else{h=a.langCode.replace(/-.*/,"");h=h!=a.langCode&&CKEDITOR.tools.indexOf(g,h)>=0?h:CKEDITOR.tools.indexOf(g,"en")>=0?"en":g[0]}if(!l.langEntries||!l.langEntries[h])f.push(CKEDITOR.getUrl(l.path+"lang/"+h+".js"));else{a.lang[k]=l.langEntries[h];h=null}}e.push(h);c.push(l)}CKEDITOR.scriptLoader.load(f,function(){for(var d=["beforeInit","init","afterInit"],f=0;f<d.length;f++)for(var j=0;j<c.length;j++){var k=c[j];f===0&&(e[j]&&k.lang&&k.langEntries)&&(a.lang[k.name]=k.langEntries[e[j]]);
if(k[d[f]])k[d[f]](a)}a.fireOnce("pluginsLoaded");b.keystrokes&&a.setKeystroke(a.config.keystrokes);for(j=0;j<a.config.blockedKeystrokes.length;j++)a.keystrokeHandler.blockedKeystrokes[a.config.blockedKeystrokes[j]]=1;a.status="loaded";a.fireOnce("loaded");CKEDITOR.fire("instanceLoaded",null,a)})})}function p(){var a=this.element;if(a&&this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO){var b=this.getData();this.config.htmlEncodeOutput&&(b=CKEDITOR.tools.htmlEncode(b));a.is("textarea")?a.setValue(b):
a.setHtml(b);return true}return false}a.prototype=CKEDITOR.editor.prototype;CKEDITOR.editor=a;var s=0,x={};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{addCommand:function(a,b){b.name=a.toLowerCase();var d=new CKEDITOR.command(this,b);this.mode&&f(this,d);return this.commands[a]=d},_attachToForm:function(){var a=this,b=a.element,d=new CKEDITOR.dom.element(b.$.form);if(b.is("textarea")&&d){var c=function(d){a.updateElement();a._.required&&(!b.getValue()&&a.fire("required")===false)&&d.data.preventDefault()};
d.on("submit",c);if(d.$.submit&&d.$.submit.call&&d.$.submit.apply)d.$.submit=CKEDITOR.tools.override(d.$.submit,function(a){return function(){c();a.apply?a.apply(this):a()}});a.on("destroy",function(){d.removeListener("submit",c)})}},destroy:function(a){this.fire("beforeDestroy");!a&&p.call(this);this.editable(null);this.status="destroyed";this.fire("destroy");this.removeAllListeners();CKEDITOR.remove(this);CKEDITOR.fire("instanceDestroyed",null,this)},elementPath:function(a){if(!a){a=this.getSelection();
if(!a)return null;a=a.getStartElement()}return a?new CKEDITOR.dom.elementPath(a,this.editable()):null},createRange:function(){var a=this.editable();return a?new CKEDITOR.dom.range(a):null},execCommand:function(a,b){var d=this.getCommand(a),c={name:a,commandData:b,command:d};if(d&&d.state!=CKEDITOR.TRISTATE_DISABLED&&this.fire("beforeCommandExec",c)!==false){c.returnValue=d.exec(c.commandData);if(!d.async&&this.fire("afterCommandExec",c)!==false)return c.returnValue}return false},getCommand:function(a){return this.commands[a]},
getData:function(a){!a&&this.fire("beforeGetData");var b=this._.data;if(typeof b!="string")b=(b=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?b.is("textarea")?b.getValue():b.getHtml():"";b={dataValue:b};!a&&this.fire("getData",b);return b.dataValue},getSnapshot:function(){var a=this.fire("getSnapshot");if(typeof a!="string"){var b=this.element;b&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(a=b.is("textarea")?b.getValue():b.getHtml())}return a},loadSnapshot:function(a){this.fire("loadSnapshot",
a)},setData:function(a,b,d){var c=true,e=b;if(b&&typeof b=="object"){d=b.internal;e=b.callback;c=!b.noSnapshot}!d&&c&&this.fire("saveSnapshot");if(e||!d)this.once("dataReady",function(a){!d&&c&&this.fire("saveSnapshot");e&&e.call(a.editor)});a={dataValue:a};!d&&this.fire("setData",a);this._.data=a.dataValue;!d&&this.fire("afterSetData",a)},setReadOnly:function(a){a=a==void 0||a;if(this.readOnly!=a){this.readOnly=a;this.keystrokeHandler.blockedKeystrokes[8]=+a;this.editable().setReadOnly(a);this.fire("readOnly")}},
insertHtml:function(a,b){this.fire("insertHtml",{dataValue:a,mode:b})},insertText:function(a){this.fire("insertText",a)},insertElement:function(a){this.fire("insertElement",a)},focus:function(){this.fire("beforeFocus")},checkDirty:function(){return this.status=="ready"&&this._.previousValue!==this.getSnapshot()},resetDirty:function(){this._.previousValue=this.getSnapshot()},updateElement:function(){return p.call(this)},setKeystroke:function(){for(var a=this.keystrokeHandler.keystrokes,b=CKEDITOR.tools.isArray(arguments[0])?
arguments[0]:[[].slice.call(arguments,0)],d,c,e=b.length;e--;){d=b[e];c=0;if(CKEDITOR.tools.isArray(d)){c=d[1];d=d[0]}c?a[d]=c:delete a[d]}},addFeature:function(a){return this.filter.addFeature(a)},setActiveFilter:function(a){if(!a)a=this.filter;if(this.activeFilter!==a){this.activeFilter=a;this.fire("activeFilterChange");a===this.filter?this.setActiveEnterMode(null,null):this.setActiveEnterMode(a.getAllowedEnterMode(this.enterMode),a.getAllowedEnterMode(this.shiftEnterMode,true))}},setActiveEnterMode:function(a,
b){a=a?this.blockless?CKEDITOR.ENTER_BR:a:this.enterMode;b=b?this.blockless?CKEDITOR.ENTER_BR:b:this.shiftEnterMode;if(this.activeEnterMode!=a||this.activeShiftEnterMode!=b){this.activeEnterMode=a;this.activeShiftEnterMode=b;this.fire("activeEnterModeChange")}}})})();CKEDITOR.ELEMENT_MODE_NONE=0;CKEDITOR.ELEMENT_MODE_REPLACE=1;CKEDITOR.ELEMENT_MODE_APPENDTO=2;CKEDITOR.ELEMENT_MODE_INLINE=3;
CKEDITOR.htmlParser=function(){this._={htmlPartsRegex:RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:\"[^\"]*\")|(?:'[^']*')|[^\"'>])*)\\/?>))","g")}};
(function(){var a=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,c={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1};CKEDITOR.htmlParser.prototype={onTagOpen:function(){},onTagClose:function(){},onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(b){for(var f,d,e=0,g;f=this._.htmlPartsRegex.exec(b);){d=f.index;if(d>e){e=b.substring(e,d);if(g)g.push(e);else this.onText(e)}e=
this._.htmlPartsRegex.lastIndex;if(d=f[1]){d=d.toLowerCase();if(g&&CKEDITOR.dtd.$cdata[d]){this.onCDATA(g.join(""));g=null}if(!g){this.onTagClose(d);continue}}if(g)g.push(f[0]);else if(d=f[3]){d=d.toLowerCase();if(!/="/.test(d)){var n={},h;f=f[4];var i=!!(f&&f.charAt(f.length-1)=="/");if(f)for(;h=a.exec(f);){var m=h[1].toLowerCase();h=h[2]||h[3]||h[4]||"";n[m]=!h&&c[m]?m:CKEDITOR.tools.htmlDecodeAttr(h)}this.onTagOpen(d,n,i);!g&&CKEDITOR.dtd.$cdata[d]&&(g=[])}}else if(d=f[2])this.onComment(d)}if(b.length>
e)this.onText(b.substring(e,b.length))}}})();
CKEDITOR.htmlParser.basicWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[]}},proto:{openTag:function(a){this._.output.push("<",a)},openTagClose:function(a,c){c?this._.output.push(" />"):this._.output.push(">")},attribute:function(a,c){typeof c=="string"&&(c=CKEDITOR.tools.htmlEncodeAttr(c));this._.output.push(" ",a,'="',c,'"')},closeTag:function(a){this._.output.push("</",a,">")},text:function(a){this._.output.push(a)},comment:function(a){this._.output.push("<\!--",a,"--\>")},write:function(a){this._.output.push(a)},
reset:function(){this._.output=[];this._.indent=false},getHtml:function(a){var c=this._.output.join("");a&&this.reset();return c}}});"use strict";
(function(){CKEDITOR.htmlParser.node=function(){};CKEDITOR.htmlParser.node.prototype={remove:function(){var a=this.parent.children,c=CKEDITOR.tools.indexOf(a,this),b=this.previous,f=this.next;b&&(b.next=f);f&&(f.previous=b);a.splice(c,1);this.parent=null},replaceWith:function(a){var c=this.parent.children,b=CKEDITOR.tools.indexOf(c,this),f=a.previous=this.previous,d=a.next=this.next;f&&(f.next=a);d&&(d.previous=a);c[b]=a;a.parent=this.parent;this.parent=null},insertAfter:function(a){var c=a.parent.children,
b=CKEDITOR.tools.indexOf(c,a),f=a.next;c.splice(b+1,0,this);this.next=a.next;this.previous=a;a.next=this;f&&(f.previous=this);this.parent=a.parent},insertBefore:function(a){var c=a.parent.children,b=CKEDITOR.tools.indexOf(c,a);c.splice(b,0,this);this.next=a;(this.previous=a.previous)&&(a.previous.next=this);a.previous=this;this.parent=a.parent},getAscendant:function(a){var c=typeof a=="function"?a:typeof a=="string"?function(b){return b.name==a}:function(b){return b.name in a},b=this.parent;for(;b&&
b.type==CKEDITOR.NODE_ELEMENT;){if(c(b))return b;b=b.parent}return null},wrapWith:function(a){this.replaceWith(a);a.add(this);return a},getIndex:function(){return CKEDITOR.tools.indexOf(this.parent.children,this)},getFilterContext:function(a){return a||{}}}})();"use strict";CKEDITOR.htmlParser.comment=function(a){this.value=a;this._={isBlockLike:false}};
CKEDITOR.htmlParser.comment.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_COMMENT,filter:function(a,c){var b=this.value;if(!(b=a.onComment(c,b,this))){this.remove();return false}if(typeof b!="string"){this.replaceWith(b);return false}this.value=b;return true},writeHtml:function(a,c){c&&this.filter(c);a.comment(this.value)}});"use strict";
(function(){CKEDITOR.htmlParser.text=function(a){this.value=a;this._={isBlockLike:false}};CKEDITOR.htmlParser.text.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(a,c){if(!(this.value=a.onText(c,this.value,this))){this.remove();return false}},writeHtml:function(a,c){c&&this.filter(c);a.text(this.value)}})})();"use strict";
(function(){CKEDITOR.htmlParser.cdata=function(a){this.value=a};CKEDITOR.htmlParser.cdata.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(){},writeHtml:function(a){a.write(this.value)}})})();"use strict";CKEDITOR.htmlParser.fragment=function(){this.children=[];this.parent=null;this._={isBlockLike:true,hasInlineStarted:false}};
(function(){function a(a){return a.attributes["data-cke-survive"]?false:a.name=="a"&&a.attributes.href||CKEDITOR.dtd.$removeEmpty[a.name]}var c=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl),b={ol:1,ul:1},f=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1}),d={ul:"li",ol:"li",dl:"dd",table:"tbody",tbody:"tr",thead:"tr",tfoot:"tr",tr:"td"};CKEDITOR.htmlParser.fragment.fromHtml=
function(e,g,n){function h(a){var b;if(u.length>0)for(var d=0;d<u.length;d++){var c=u[d],e=c.name,f=CKEDITOR.dtd[e],j=k.name&&CKEDITOR.dtd[k.name];if((!j||j[e])&&(!a||!f||f[a]||!CKEDITOR.dtd[a])){if(!b){i();b=1}c=c.clone();c.parent=k;k=c;u.splice(d,1);d--}else if(e==k.name){p(k,k.parent,1);d--}}}function i(){for(;A.length;)p(A.shift(),k)}function m(a){if(a._.isBlockLike&&a.name!="pre"&&a.name!="textarea"){var b=a.children.length,d=a.children[b-1],c;if(d&&d.type==CKEDITOR.NODE_TEXT)(c=CKEDITOR.tools.rtrim(d.value))?
d.value=c:a.children.length=b-1}}function p(b,d,c){var d=d||k||o,e=k;if(b.previous===void 0){if(s(d,b)){k=d;q.onTagOpen(n,{});b.returnPoint=d=k}m(b);(!a(b)||b.children.length)&&d.add(b);b.name=="pre"&&(j=false);b.name=="textarea"&&(l=false)}if(b.returnPoint){k=b.returnPoint;delete b.returnPoint}else k=c?d:e}function s(a,b){if((a==o||a.name=="body")&&n&&(!a.name||CKEDITOR.dtd[a.name][n])){var d,c;return(d=b.attributes&&(c=b.attributes["data-cke-real-element-type"])?c:b.name)&&d in CKEDITOR.dtd.$inline&&
!(d in CKEDITOR.dtd.head)&&!b.isOrphan||b.type==CKEDITOR.NODE_TEXT}}function x(a,b){return a in CKEDITOR.dtd.$listItem||a in CKEDITOR.dtd.$tableContent?a==b||a=="dt"&&b=="dd"||a=="dd"&&b=="dt":false}var q=new CKEDITOR.htmlParser,o=g instanceof CKEDITOR.htmlParser.element?g:typeof g=="string"?new CKEDITOR.htmlParser.element(g):new CKEDITOR.htmlParser.fragment,u=[],A=[],k=o,l=o.name=="textarea",j=o.name=="pre";q.onTagOpen=function(d,e,g,o){e=new CKEDITOR.htmlParser.element(d,e);if(e.isUnknown&&g)e.isEmpty=
true;e.isOptionalClose=o;if(a(e))u.push(e);else{if(d=="pre")j=true;else{if(d=="br"&&j){k.add(new CKEDITOR.htmlParser.text("\n"));return}d=="textarea"&&(l=true)}if(d=="br")A.push(e);else{for(;;){o=(g=k.name)?CKEDITOR.dtd[g]||(k._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):f;if(!e.isUnknown&&!k.isUnknown&&!o[d])if(k.isOptionalClose)q.onTagClose(g);else if(d in b&&g in b){g=k.children;(g=g[g.length-1])&&g.name=="li"||p(g=new CKEDITOR.htmlParser.element("li"),k);!e.returnPoint&&(e.returnPoint=k);
k=g}else if(d in CKEDITOR.dtd.$listItem&&!x(d,g))q.onTagOpen(d=="li"?"ul":"dl",{},0,1);else if(g in c&&!x(d,g)){!e.returnPoint&&(e.returnPoint=k);k=k.parent}else{g in CKEDITOR.dtd.$inline&&u.unshift(k);if(k.parent)p(k,k.parent,1);else{e.isOrphan=1;break}}else break}h(d);i();e.parent=k;e.isEmpty?p(e):k=e}}};q.onTagClose=function(a){for(var b=u.length-1;b>=0;b--)if(a==u[b].name){u.splice(b,1);return}for(var d=[],c=[],e=k;e!=o&&e.name!=a;){e._.isBlockLike||c.unshift(e);d.push(e);e=e.returnPoint||e.parent}if(e!=
o){for(b=0;b<d.length;b++){var f=d[b];p(f,f.parent)}k=e;e._.isBlockLike&&i();p(e,e.parent);if(e==k)k=k.parent;u=u.concat(c)}a=="body"&&(n=false)};q.onText=function(a){if((!k._.hasInlineStarted||A.length)&&!j&&!l){a=CKEDITOR.tools.ltrim(a);if(a.length===0)return}var b=k.name,e=b?CKEDITOR.dtd[b]||(k._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):f;if(!l&&!e["#"]&&b in c){q.onTagOpen(d[b]||"");q.onText(a)}else{i();h();!j&&!l&&(a=a.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));a=new CKEDITOR.htmlParser.text(a);
if(s(k,a))this.onTagOpen(n,{},0,1);k.add(a)}};q.onCDATA=function(a){k.add(new CKEDITOR.htmlParser.cdata(a))};q.onComment=function(a){i();h();k.add(new CKEDITOR.htmlParser.comment(a))};q.parse(e);for(i();k!=o;)p(k,k.parent,1);m(o);return o};CKEDITOR.htmlParser.fragment.prototype={type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,add:function(a,b){isNaN(b)&&(b=this.children.length);var d=b>0?this.children[b-1]:null;if(d){if(a._.isBlockLike&&d.type==CKEDITOR.NODE_TEXT){d.value=CKEDITOR.tools.rtrim(d.value);if(d.value.length===
0){this.children.pop();this.add(a);return}}d.next=a}a.previous=d;a.parent=this;this.children.splice(b,0,a);if(!this._.hasInlineStarted)this._.hasInlineStarted=a.type==CKEDITOR.NODE_TEXT||a.type==CKEDITOR.NODE_ELEMENT&&!a._.isBlockLike},filter:function(a,b){b=this.getFilterContext(b);a.onRoot(b,this);this.filterChildren(a,false,b)},filterChildren:function(a,b,d){if(this.childrenFilteredBy!=a.id){d=this.getFilterContext(d);if(b&&!this.parent)a.onRoot(d,this);this.childrenFilteredBy=a.id;for(b=0;b<this.children.length;b++)this.children[b].filter(a,
d)===false&&b--}},writeHtml:function(a,b){b&&this.filter(b);this.writeChildrenHtml(a)},writeChildrenHtml:function(a,b,d){var c=this.getFilterContext();if(d&&!this.parent&&b)b.onRoot(c,this);b&&this.filterChildren(b,false,c);b=0;d=this.children;for(c=d.length;b<c;b++)d[b].writeHtml(a)},forEach:function(a,b,d){if(!d&&(!b||this.type==b))var c=a(this);if(c!==false)for(var d=this.children,f=0;f<d.length;f++){c=d[f];c.type==CKEDITOR.NODE_ELEMENT?c.forEach(a,b):(!b||c.type==b)&&a(c)}},getFilterContext:function(a){return a||
{}}}})();"use strict";
(function(){function a(){this.rules=[]}function c(b,c,d,e){var g,n;for(g in c){(n=b[g])||(n=b[g]=new a);n.add(c[g],d,e)}}CKEDITOR.htmlParser.filter=CKEDITOR.tools.createClass({$:function(b){this.id=CKEDITOR.tools.getNextNumber();this.elementNameRules=new a;this.attributeNameRules=new a;this.elementsRules={};this.attributesRules={};this.textRules=new a;this.commentRules=new a;this.rootRules=new a;b&&this.addRules(b,10)},proto:{addRules:function(a,f){var d;if(typeof f=="number")d=f;else if(f&&"priority"in
f)d=f.priority;typeof d!="number"&&(d=10);typeof f!="object"&&(f={});a.elementNames&&this.elementNameRules.addMany(a.elementNames,d,f);a.attributeNames&&this.attributeNameRules.addMany(a.attributeNames,d,f);a.elements&&c(this.elementsRules,a.elements,d,f);a.attributes&&c(this.attributesRules,a.attributes,d,f);a.text&&this.textRules.add(a.text,d,f);a.comment&&this.commentRules.add(a.comment,d,f);a.root&&this.rootRules.add(a.root,d,f)},applyTo:function(a){a.filter(this)},onElementName:function(a,c){return this.elementNameRules.execOnName(a,
c)},onAttributeName:function(a,c){return this.attributeNameRules.execOnName(a,c)},onText:function(a,c,d){return this.textRules.exec(a,c,d)},onComment:function(a,c,d){return this.commentRules.exec(a,c,d)},onRoot:function(a,c){return this.rootRules.exec(a,c)},onElement:function(a,c){for(var d=[this.elementsRules["^"],this.elementsRules[c.name],this.elementsRules.$],e,g=0;g<3;g++)if(e=d[g]){e=e.exec(a,c,this);if(e===false)return null;if(e&&e!=c)return this.onNode(a,e);if(c.parent&&!c.name)break}return c},
onNode:function(a,c){var d=c.type;return d==CKEDITOR.NODE_ELEMENT?this.onElement(a,c):d==CKEDITOR.NODE_TEXT?new CKEDITOR.htmlParser.text(this.onText(a,c.value)):d==CKEDITOR.NODE_COMMENT?new CKEDITOR.htmlParser.comment(this.onComment(a,c.value)):null},onAttribute:function(a,c,d,e){return(d=this.attributesRules[d])?d.exec(a,e,c,this):e}}});CKEDITOR.htmlParser.filterRulesGroup=a;a.prototype={add:function(a,c,d){this.rules.splice(this.findIndex(c),0,{value:a,priority:c,options:d})},addMany:function(a,
c,d){for(var e=[this.findIndex(c),0],g=0,n=a.length;g<n;g++)e.push({value:a[g],priority:c,options:d});this.rules.splice.apply(this.rules,e)},findIndex:function(a){for(var c=this.rules,d=c.length-1;d>=0&&a<c[d].priority;)d--;return d+1},exec:function(a,c){var d=c instanceof CKEDITOR.htmlParser.node||c instanceof CKEDITOR.htmlParser.fragment,e=Array.prototype.slice.call(arguments,1),g=this.rules,n=g.length,h,i,m,p;for(p=0;p<n;p++){if(d){h=c.type;i=c.name}m=g[p];if(!(a.nonEditable&&!m.options.applyToAll||
a.nestedEditable&&m.options.excludeNestedEditable)){m=m.value.apply(null,e);if(m===false||d&&m&&(m.name!=i||m.type!=h))return m;m!=void 0&&(e[0]=c=m)}}return c},execOnName:function(a,c){for(var d=0,e=this.rules,g=e.length,n;c&&d<g;d++){n=e[d];!(a.nonEditable&&!n.options.applyToAll||a.nestedEditable&&n.options.excludeNestedEditable)&&(c=c.replace(n.value[0],n.value[1]))}return c}}})();
(function(){function a(a,c){function l(a){return a||CKEDITOR.env.needsNbspFiller?new CKEDITOR.htmlParser.text("Â "):new CKEDITOR.htmlParser.element("br",{"data-cke-bogus":1})}function o(a,d){return function(c){if(c.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var j=[],k=b(c),o,g;if(k)for(r(k,1)&&j.push(k);k;){if(e(k)&&(o=f(k))&&r(o))if((g=f(o))&&!e(g))j.push(o);else{l(v).insertAfter(o);o.remove()}k=k.previous}for(k=0;k<j.length;k++)j[k].remove();if(j=(typeof d=="function"?d(c):d)!==false)if(!v&&!CKEDITOR.env.needsBrFiller&&
c.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)j=false;else if(!v&&!CKEDITOR.env.needsBrFiller&&(document.documentMode>7||c.name in CKEDITOR.dtd.tr||c.name in CKEDITOR.dtd.$listItem))j=false;else{j=b(c);j=!j||c.name=="form"&&j.name=="input"}j&&c.add(l(a))}}}function r(a,b){if((!v||CKEDITOR.env.needsBrFiller)&&a.type==CKEDITOR.NODE_ELEMENT&&a.name=="br"&&!a.attributes["data-cke-eol"])return true;var d;if(a.type==CKEDITOR.NODE_TEXT&&(d=a.value.match(u))){if(d.index){(new CKEDITOR.htmlParser.text(a.value.substring(0,
d.index))).insertBefore(a);a.value=d[0]}if(!CKEDITOR.env.needsBrFiller&&v&&(!b||a.parent.name in h))return true;if(!v)if((d=a.previous)&&d.name=="br"||!d||e(d))return true}return false}var w={elements:{}},v=c=="html",h=CKEDITOR.tools.extend({},j),t;for(t in h)"#"in k[t]||delete h[t];for(t in h)w.elements[t]=o(v,a.config.fillEmptyBlocks);w.root=o(v,false);w.elements.br=function(a){return function(b){if(b.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var c=b.attributes;if("data-cke-bogus"in c||"data-cke-eol"in
c)delete c["data-cke-bogus"];else{for(c=b.next;c&&d(c);)c=c.next;var j=f(b);!c&&e(b.parent)?g(b.parent,l(a)):e(c)&&(j&&!e(j))&&l(a).insertBefore(c)}}}}(v);return w}function c(a,b){return a!=CKEDITOR.ENTER_BR&&b!==false?a==CKEDITOR.ENTER_DIV?"div":"p":false}function b(a){for(a=a.children[a.children.length-1];a&&d(a);)a=a.previous;return a}function f(a){for(a=a.previous;a&&d(a);)a=a.previous;return a}function d(a){return a.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(a.value)||a.type==CKEDITOR.NODE_ELEMENT&&
a.attributes["data-cke-bookmark"]}function e(a){return a&&(a.type==CKEDITOR.NODE_ELEMENT&&a.name in j||a.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)}function g(a,b){var d=a.children[a.children.length-1];a.children.push(b);b.parent=a;if(d){d.next=b;b.previous=d}}function n(a){a=a.attributes;a.contenteditable!="false"&&(a["data-cke-editable"]=a.contenteditable?"true":1);a.contenteditable="false"}function h(a){a=a.attributes;switch(a["data-cke-editable"]){case "true":a.contenteditable="true";break;case "1":delete a.contenteditable}}
function i(a){return a.replace(S,function(a,b,d){return"<"+b+d.replace(F,function(a,b){return D.test(b)&&d.indexOf("data-cke-saved-"+b)==-1?" data-cke-saved-"+a+" data-cke-"+CKEDITOR.rnd+"-"+a:a})+">"})}function m(a,b){return a.replace(b,function(a,b,d){a.indexOf("<textarea")===0&&(a=b+x(d).replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</textarea>");return"<cke:encoded>"+encodeURIComponent(a)+"</cke:encoded>"})}function p(a){return a.replace(w,function(a,b){return decodeURIComponent(b)})}function s(a){return a.replace(/<\!--(?!{cke_protected})[\s\S]+?--\>/g,
function(a){return"<\!--"+A+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\>"})}function x(a){return a.replace(/<\!--\{cke_protected\}\{C\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)})}function q(a,b){var d=b._.dataStore;return a.replace(/<\!--\{cke_protected\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)}).replace(/\{cke_protected_(\d+)\}/g,function(a,b){return d&&d[b]||""})}function o(a,b){for(var d=[],c=b.config.protectedSource,e=b._.dataStore||(b._.dataStore=
{id:1}),f=/<\!--\{cke_temp(comment)?\}(\d*?)--\>/g,c=[/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi,/<meta[\s\S]*?\/?>/gi].concat(c),a=a.replace(/<\!--[\s\S]*?--\>/g,function(a){return"<\!--{cke_tempcomment}"+(d.push(a)-1)+"--\>"}),j=0;j<c.length;j++)a=a.replace(c[j],function(a){a=a.replace(f,function(a,b,c){return d[c]});return/cke_temp(comment)?/.test(a)?a:"<\!--{cke_temp}"+(d.push(a)-1)+"--\>"});a=a.replace(f,function(a,b,c){return"<\!--"+A+(b?"{C}":"")+encodeURIComponent(d[c]).replace(/--/g,
"%2D%2D")+"--\>"});a=a.replace(/<\w+(?:\s+(?:(?:[^\s=>]+\s*=\s*(?:[^'"\s>]+|'[^']*'|"[^"]*"))|[^\s=>]+))+\s*>/g,function(a){return a.replace(/<\!--\{cke_protected\}([^>]*)--\>/g,function(a,b){e[e.id]=decodeURIComponent(b);return"{cke_protected_"+e.id++ +"}"})});return a=a.replace(/<(title|iframe|textarea)([^>]*)>([\s\S]*?)<\/\1>/g,function(a,d,c,e){return"<"+d+c+">"+q(x(e),b)+"</"+d+">"})}CKEDITOR.htmlDataProcessor=function(b){var d,e,f=this;this.editor=b;this.dataFilter=d=new CKEDITOR.htmlParser.filter;
this.htmlFilter=e=new CKEDITOR.htmlParser.filter;this.writer=new CKEDITOR.htmlParser.basicWriter;d.addRules(v);d.addRules(I,{applyToAll:true});d.addRules(a(b,"data"),{applyToAll:true});e.addRules(r);e.addRules(O,{applyToAll:true});e.addRules(a(b,"html"),{applyToAll:true});b.on("toHtml",function(a){var a=a.data,d=a.dataValue,d=o(d,b),d=m(d,J),d=i(d),d=m(d,L),d=d.replace(z,"$1cke:$2"),d=d.replace(E,"<cke:$1$2></cke:$1>"),d=d.replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2"),d=d.replace(/([^a-z0-9<\-])(on\w{3,})(?!>)/gi,
"$1data-cke-"+CKEDITOR.rnd+"-$2"),e=a.context||b.editable().getName(),f;if(CKEDITOR.env.ie&&CKEDITOR.env.version<9&&e=="pre"){e="div";d="<pre>"+d+"</pre>";f=1}e=b.document.createElement(e);e.setHtml("a"+d);d=e.getHtml().substr(1);d=d.replace(RegExp("data-cke-"+CKEDITOR.rnd+"-","ig"),"");f&&(d=d.replace(/^<pre>|<\/pre>$/gi,""));d=d.replace(t,"$1$2");d=p(d);d=x(d);a.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(d,a.context,a.fixForBody===false?false:c(a.enterMode,b.config.autoParagraph))},null,null,
5);b.on("toHtml",function(a){a.data.filter.applyTo(a.data.dataValue,true,a.data.dontFilter,a.data.enterMode)&&b.fire("dataFiltered")},null,null,6);b.on("toHtml",function(a){a.data.dataValue.filterChildren(f.dataFilter,true)},null,null,10);b.on("toHtml",function(a){var a=a.data,b=a.dataValue,d=new CKEDITOR.htmlParser.basicWriter;b.writeChildrenHtml(d);b=d.getHtml(true);a.dataValue=s(b)},null,null,15);b.on("toDataFormat",function(a){var d=a.data.dataValue;a.data.enterMode!=CKEDITOR.ENTER_BR&&(d=d.replace(/^<br *\/?>/i,
""));a.data.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(d,a.data.context,c(a.data.enterMode,b.config.autoParagraph))},null,null,5);b.on("toDataFormat",function(a){a.data.dataValue.filterChildren(f.htmlFilter,true)},null,null,10);b.on("toDataFormat",function(a){a.data.filter.applyTo(a.data.dataValue,false,true)},null,null,11);b.on("toDataFormat",function(a){var d=a.data.dataValue,c=f.writer;c.reset();d.writeChildrenHtml(c);d=c.getHtml(true);d=x(d);d=q(d,b);a.data.dataValue=d},null,null,15)};CKEDITOR.htmlDataProcessor.prototype=
{toHtml:function(a,b,d,c){var e=this.editor,f,j,k;if(b&&typeof b=="object"){f=b.context;d=b.fixForBody;c=b.dontFilter;j=b.filter;k=b.enterMode}else f=b;!f&&f!==null&&(f=e.editable().getName());return e.fire("toHtml",{dataValue:a,context:f,fixForBody:d,dontFilter:c,filter:j||e.filter,enterMode:k||e.enterMode}).dataValue},toDataFormat:function(a,b){var d,c,e;if(b){d=b.context;c=b.filter;e=b.enterMode}!d&&d!==null&&(d=this.editor.editable().getName());return this.editor.fire("toDataFormat",{dataValue:a,
filter:c||this.editor.filter,context:d,enterMode:e||this.editor.enterMode}).dataValue}};var u=/(?:&nbsp;|\xa0)$/,A="{cke_protected}",k=CKEDITOR.dtd,l=["caption","colgroup","col","thead","tfoot","tbody"],j=CKEDITOR.tools.extend({},k.$blockLimit,k.$block),v={elements:{input:n,textarea:n}},I={attributeNames:[[/^on/,"data-cke-pa-on"],[/^data-cke-expando$/,""]]},r={elements:{embed:function(a){var b=a.parent;if(b&&b.name=="object"){var d=b.attributes.width,b=b.attributes.height;if(d)a.attributes.width=
d;if(b)a.attributes.height=b}},a:function(a){if(!a.children.length&&!a.attributes.name&&!a.attributes["data-cke-saved-name"])return false}}},O={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(a){var b=a.attributes;if(b){if(b["data-cke-temp"])return false;for(var d=["name","href","src"],c,e=0;e<d.length;e++){c="data-cke-saved-"+d[e];c in b&&delete b[d[e]]}}return a},table:function(a){a.children.slice(0).sort(function(a,
b){var d,c;if(a.type==CKEDITOR.NODE_ELEMENT&&b.type==a.type){d=CKEDITOR.tools.indexOf(l,a.name);c=CKEDITOR.tools.indexOf(l,b.name)}if(!(d>-1&&c>-1&&d!=c)){d=a.parent?a.getIndex():-1;c=b.parent?b.getIndex():-1}return d>c?1:-1})},param:function(a){a.children=[];a.isEmpty=true;return a},span:function(a){a.attributes["class"]=="Apple-style-span"&&delete a.name},html:function(a){delete a.attributes.contenteditable;delete a.attributes["class"]},body:function(a){delete a.attributes.spellcheck;delete a.attributes.contenteditable},
style:function(a){var b=a.children[0];if(b&&b.value)b.value=CKEDITOR.tools.trim(b.value);if(!a.attributes.type)a.attributes.type="text/css"},title:function(a){var b=a.children[0];!b&&g(a,b=new CKEDITOR.htmlParser.text);b.value=a.attributes["data-cke-title"]||""},input:h,textarea:h},attributes:{"class":function(a){return CKEDITOR.tools.ltrim(a.replace(/(?:^|\s+)cke_[^\s]*/g,""))||false}}};if(CKEDITOR.env.ie)O.attributes.style=function(a){return a.replace(/(^|;)([^\:]+)/g,function(a){return a.toLowerCase()})};
var S=/<(a|area|img|input|source)\b([^>]*)>/gi,F=/([\w-]+)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,D=/^(href|src|name)$/i,L=/(?:<style(?=[ >])[^>]*>[\s\S]*?<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,J=/(<textarea(?=[ >])[^>]*>)([\s\S]*?)(?:<\/textarea>)/gi,w=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,z=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,t=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,E=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi})();"use strict";
CKEDITOR.htmlParser.element=function(a,c){this.name=a;this.attributes=c||{};this.children=[];var b=a||"",f=b.match(/^cke:(.*)/);f&&(b=f[1]);b=!(!CKEDITOR.dtd.$nonBodyContent[b]&&!CKEDITOR.dtd.$block[b]&&!CKEDITOR.dtd.$listItem[b]&&!CKEDITOR.dtd.$tableContent[b]&&!(CKEDITOR.dtd.$nonEditable[b]||b=="br"));this.isEmpty=!!CKEDITOR.dtd.$empty[a];this.isUnknown=!CKEDITOR.dtd[a];this._={isBlockLike:b,hasInlineStarted:this.isEmpty||!b}};
CKEDITOR.htmlParser.cssStyle=function(a){var c={};((a instanceof CKEDITOR.htmlParser.element?a.attributes.style:a)||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,f,d){f=="font-family"&&(d=d.replace(/["']/g,""));c[f.toLowerCase()]=d});return{rules:c,populate:function(a){var c=this.toString();if(c)a instanceof CKEDITOR.dom.element?a.setAttribute("style",c):a instanceof CKEDITOR.htmlParser.element?a.attributes.style=c:a.style=c},toString:function(){var a=[],f;
for(f in c)c[f]&&a.push(f,":",c[f],";");return a.join("")}}};
(function(){function a(a){return function(b){return b.type==CKEDITOR.NODE_ELEMENT&&(typeof a=="string"?b.name==a:b.name in a)}}var c=function(a,b){a=a[0];b=b[0];return a<b?-1:a>b?1:0},b=CKEDITOR.htmlParser.fragment.prototype;CKEDITOR.htmlParser.element.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_ELEMENT,add:b.add,clone:function(){return new CKEDITOR.htmlParser.element(this.name,this.attributes)},filter:function(a,b){var c=this,g,n,b=c.getFilterContext(b);if(b.off)return true;
if(!c.parent)a.onRoot(b,c);for(;;){g=c.name;if(!(n=a.onElementName(b,g))){this.remove();return false}c.name=n;if(!(c=a.onElement(b,c))){this.remove();return false}if(c!==this){this.replaceWith(c);return false}if(c.name==g)break;if(c.type!=CKEDITOR.NODE_ELEMENT){this.replaceWith(c);return false}if(!c.name){this.replaceWithChildren();return false}}g=c.attributes;var h,i;for(h in g){i=h;for(n=g[h];;)if(i=a.onAttributeName(b,h))if(i!=h){delete g[h];h=i}else break;else{delete g[h];break}i&&((n=a.onAttribute(b,
c,i,n))===false?delete g[i]:g[i]=n)}c.isEmpty||this.filterChildren(a,false,b);return true},filterChildren:b.filterChildren,writeHtml:function(a,b){b&&this.filter(b);var e=this.name,g=[],n=this.attributes,h,i;a.openTag(e,n);for(h in n)g.push([h,n[h]]);a.sortAttributes&&g.sort(c);h=0;for(i=g.length;h<i;h++){n=g[h];a.attribute(n[0],n[1])}a.openTagClose(e,this.isEmpty);this.writeChildrenHtml(a);this.isEmpty||a.closeTag(e)},writeChildrenHtml:b.writeChildrenHtml,replaceWithChildren:function(){for(var a=
this.children,b=a.length;b;)a[--b].insertAfter(this);this.remove()},forEach:b.forEach,getFirst:function(b){if(!b)return this.children.length?this.children[0]:null;typeof b!="function"&&(b=a(b));for(var d=0,c=this.children.length;d<c;++d)if(b(this.children[d]))return this.children[d];return null},getHtml:function(){var a=new CKEDITOR.htmlParser.basicWriter;this.writeChildrenHtml(a);return a.getHtml()},setHtml:function(a){for(var a=this.children=CKEDITOR.htmlParser.fragment.fromHtml(a).children,b=0,
c=a.length;b<c;++b)a[b].parent=this},getOuterHtml:function(){var a=new CKEDITOR.htmlParser.basicWriter;this.writeHtml(a);return a.getHtml()},split:function(a){for(var b=this.children.splice(a,this.children.length-a),c=this.clone(),g=0;g<b.length;++g)b[g].parent=c;c.children=b;if(b[0])b[0].previous=null;if(a>0)this.children[a-1].next=null;this.parent.add(c,this.getIndex()+1);return c},addClass:function(a){if(!this.hasClass(a)){var b=this.attributes["class"]||"";this.attributes["class"]=b+(b?" ":"")+
a}},removeClass:function(a){var b=this.attributes["class"];if(b)(b=CKEDITOR.tools.trim(b.replace(RegExp("(?:\\s+|^)"+a+"(?:\\s+|$)")," ")))?this.attributes["class"]=b:delete this.attributes["class"]},hasClass:function(a){var b=this.attributes["class"];return!b?false:RegExp("(?:^|\\s)"+a+"(?=\\s|$)").test(b)},getFilterContext:function(a){var b=[];a||(a={off:false,nonEditable:false,nestedEditable:false});!a.off&&this.attributes["data-cke-processor"]=="off"&&b.push("off",true);!a.nonEditable&&this.attributes.contenteditable==
"false"?b.push("nonEditable",true):a.nonEditable&&(!a.nestedEditable&&this.attributes.contenteditable=="true")&&b.push("nestedEditable",true);if(b.length)for(var a=CKEDITOR.tools.copy(a),c=0;c<b.length;c=c+2)a[b[c]]=b[c+1];return a}},true)})();
(function(){var a={},c=/{([^}]+)}/g,b=/([\\'])/g,f=/\n/g,d=/\r/g;CKEDITOR.template=function(e){if(a[e])this.output=a[e];else{var g=e.replace(b,"\\$1").replace(f,"\\n").replace(d,"\\r").replace(c,function(a,b){return"',data['"+b+"']==undefined?'{"+b+"}':data['"+b+"'],'"});this.output=a[e]=Function("data","buffer","return buffer?buffer.push('"+g+"'):['"+g+"'].join('');")}}})();delete CKEDITOR.loadFullCore;CKEDITOR.instances={};CKEDITOR.document=new CKEDITOR.dom.document(document);
CKEDITOR.add=function(a){CKEDITOR.instances[a.name]=a;a.on("focus",function(){if(CKEDITOR.currentInstance!=a){CKEDITOR.currentInstance=a;CKEDITOR.fire("currentInstance")}});a.on("blur",function(){if(CKEDITOR.currentInstance==a){CKEDITOR.currentInstance=null;CKEDITOR.fire("currentInstance")}});CKEDITOR.fire("instance",null,a)};CKEDITOR.remove=function(a){delete CKEDITOR.instances[a.name]};
(function(){var a={};CKEDITOR.addTemplate=function(c,b){var f=a[c];if(f)return f;f={name:c,source:b};CKEDITOR.fire("template",f);return a[c]=new CKEDITOR.template(f.source)};CKEDITOR.getTemplate=function(c){return a[c]}})();(function(){var a=[];CKEDITOR.addCss=function(c){a.push(c)};CKEDITOR.getCss=function(){return a.join("\n")}})();CKEDITOR.on("instanceDestroyed",function(){CKEDITOR.tools.isEmpty(this.instances)&&CKEDITOR.fire("reset")});CKEDITOR.TRISTATE_ON=1;CKEDITOR.TRISTATE_OFF=2;
CKEDITOR.TRISTATE_DISABLED=0;
(function(){CKEDITOR.inline=function(a,c){if(!CKEDITOR.env.isCompatible)return null;a=CKEDITOR.dom.element.get(a);if(a.getEditor())throw'The editor instance "'+a.getEditor().name+'" is already attached to the provided element.';var b=new CKEDITOR.editor(c,a,CKEDITOR.ELEMENT_MODE_INLINE),f=a.is("textarea")?a:null;if(f){b.setData(f.getValue(),null,true);a=CKEDITOR.dom.element.createFromHtml('<div contenteditable="'+!!b.readOnly+'" class="cke_textarea_inline">'+f.getValue()+"</div>",CKEDITOR.document);
a.insertAfter(f);f.hide();f.$.form&&b._attachToForm()}else b.setData(a.getHtml(),null,true);b.on("loaded",function(){b.fire("uiReady");b.editable(a);b.container=a;b.setData(b.getData(1));b.resetDirty();b.fire("contentDom");b.mode="wysiwyg";b.fire("mode");b.status="ready";b.fireOnce("instanceReady");CKEDITOR.fire("instanceReady",null,b)},null,null,1E4);b.on("destroy",function(){if(f){b.container.clearCustomData();b.container.remove();f.show()}b.element.clearCustomData();delete b.element});return b};
CKEDITOR.inlineAll=function(){var a,c,b;for(b in CKEDITOR.dtd.$editable)for(var f=CKEDITOR.document.getElementsByTag(b),d=0,e=f.count();d<e;d++){a=f.getItem(d);if(a.getAttribute("contenteditable")=="true"){c={element:a,config:{}};CKEDITOR.fire("inline",c)!==false&&CKEDITOR.inline(a,c.config)}}};CKEDITOR.domReady(function(){!CKEDITOR.disableAutoInline&&CKEDITOR.inlineAll()})})();CKEDITOR.replaceClass="ckeditor";
(function(){function a(a,e,f,n){if(!CKEDITOR.env.isCompatible)return null;a=CKEDITOR.dom.element.get(a);if(a.getEditor())throw'The editor instance "'+a.getEditor().name+'" is already attached to the provided element.';var h=new CKEDITOR.editor(e,a,n);if(n==CKEDITOR.ELEMENT_MODE_REPLACE){a.setStyle("visibility","hidden");h._.required=a.hasAttribute("required");a.removeAttribute("required")}f&&h.setData(f,null,true);h.on("loaded",function(){b(h);n==CKEDITOR.ELEMENT_MODE_REPLACE&&(h.config.autoUpdateElement&&
a.$.form)&&h._attachToForm();h.setMode(h.config.startupMode,function(){h.resetDirty();h.status="ready";h.fireOnce("instanceReady");CKEDITOR.fire("instanceReady",null,h)})});h.on("destroy",c);return h}function c(){var a=this.container,b=this.element;if(a){a.clearCustomData();a.remove()}if(b){b.clearCustomData();if(this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE){b.show();this._.required&&b.setAttribute("required","required")}delete this.element}}function b(a){var b=a.name,c=a.element,n=a.elementMode,
h=a.fire("uiSpace",{space:"top",html:""}).html,i=a.fire("uiSpace",{space:"bottom",html:""}).html;f||(f=CKEDITOR.addTemplate("maincontainer",'<{outerEl} id="cke_{name}" class="{id} cke cke_reset cke_chrome cke_editor_{name} cke_{langDir} '+CKEDITOR.env.cssClass+'"  dir="{langDir}" lang="{langCode}" role="application" aria-labelledby="cke_{name}_arialbl"><span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span><{outerEl} class="cke_inner cke_reset" role="presentation">{topHtml}<{outerEl} id="{contentId}" class="cke_contents cke_reset" role="presentation"></{outerEl}>{bottomHtml}</{outerEl}></{outerEl}>'));
b=CKEDITOR.dom.element.createFromHtml(f.output({id:a.id,name:b,langDir:a.lang.dir,langCode:a.langCode,voiceLabel:[a.lang.editor,a.name].join(", "),topHtml:h?'<span id="'+a.ui.spaceId("top")+'" class="cke_top cke_reset_all" role="presentation" style="height:auto">'+h+"</span>":"",contentId:a.ui.spaceId("contents"),bottomHtml:i?'<span id="'+a.ui.spaceId("bottom")+'" class="cke_bottom cke_reset_all" role="presentation">'+i+"</span>":"",outerEl:CKEDITOR.env.ie?"span":"div"}));if(n==CKEDITOR.ELEMENT_MODE_REPLACE){c.hide();
b.insertAfter(c)}else c.append(b);a.container=b;h&&a.ui.space("top").unselectable();i&&a.ui.space("bottom").unselectable();c=a.config.width;n=a.config.height;c&&b.setStyle("width",CKEDITOR.tools.cssLength(c));n&&a.ui.space("contents").setStyle("height",CKEDITOR.tools.cssLength(n));b.disableContextMenu();CKEDITOR.env.webkit&&b.on("focus",function(){a.focus()});a.fireOnce("uiReady")}CKEDITOR.replace=function(b,c){return a(b,c,null,CKEDITOR.ELEMENT_MODE_REPLACE)};CKEDITOR.appendTo=function(b,c,f){return a(b,
c,f,CKEDITOR.ELEMENT_MODE_APPENDTO)};CKEDITOR.replaceAll=function(){for(var a=document.getElementsByTagName("textarea"),b=0;b<a.length;b++){var c=null,f=a[b];if(f.name||f.id){if(typeof arguments[0]=="string"){if(!RegExp("(?:^|\\s)"+arguments[0]+"(?:$|\\s)").test(f.className))continue}else if(typeof arguments[0]=="function"){c={};if(arguments[0](f,c)===false)continue}this.replace(f,c)}}};CKEDITOR.editor.prototype.addMode=function(a,b){(this._.modes||(this._.modes={}))[a]=b};CKEDITOR.editor.prototype.setMode=
function(a,b){var c=this,f=this._.modes;if(!(a==c.mode||!f||!f[a])){c.fire("beforeSetMode",a);if(c.mode){var h=c.checkDirty(),f=c._.previousModeData,i,m=0;c.fire("beforeModeUnload");c.editable(0);c._.previousMode=c.mode;c._.previousModeData=i=c.getData(1);if(c.mode=="source"&&f==i){c.fire("lockSnapshot",{forceUpdate:true});m=1}c.ui.space("contents").setHtml("");c.mode=""}else c._.previousModeData=c.getData(1);this._.modes[a](function(){c.mode=a;h!==void 0&&!h&&c.resetDirty();m?c.fire("unlockSnapshot"):
a=="wysiwyg"&&c.fire("saveSnapshot");setTimeout(function(){c.fire("mode");b&&b.call(c)},0)})}};CKEDITOR.editor.prototype.resize=function(a,b,c,f){var h=this.container,i=this.ui.space("contents"),m=CKEDITOR.env.webkit&&this.document&&this.document.getWindow().$.frameElement,f=f?h.getChild(1):h;f.setSize("width",a,true);m&&(m.style.width="1%");i.setStyle("height",Math.max(b-(c?0:(f.$.offsetHeight||0)-(i.$.clientHeight||0)),0)+"px");m&&(m.style.width="100%");this.fire("resize")};CKEDITOR.editor.prototype.getResizable=
function(a){return a?this.ui.space("contents"):this.container};var f;CKEDITOR.domReady(function(){CKEDITOR.replaceClass&&CKEDITOR.replaceAll(CKEDITOR.replaceClass)})})();CKEDITOR.config.startupMode="wysiwyg";
(function(){function a(a){var b=a.editor,d=a.data.path,e=d.blockLimit,l=a.data.selection,j=l.getRanges()[0],g;if(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)if(l=c(l,d)){l.appendBogus();g=CKEDITOR.env.ie}if(b.config.autoParagraph!==false&&b.activeEnterMode!=CKEDITOR.ENTER_BR&&b.editable().equals(e)&&!d.block&&j.collapsed&&!j.getCommonAncestor().isReadOnly()){d=j.clone();d.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS);e=new CKEDITOR.dom.walker(d);e.guard=function(a){return!f(a)||a.type==
CKEDITOR.NODE_COMMENT||a.isReadOnly()};if(!e.checkForward()||d.checkStartOfBlock()&&d.checkEndOfBlock()){b=j.fixBlock(true,b.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p");if(!CKEDITOR.env.needsBrFiller)(b=b.getFirst(f))&&(b.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(b.getText()).match(/^(?:&nbsp;|\xa0)$/))&&b.remove();g=1;a.cancel()}}g&&j.select()}function c(a,b){if(a.isFake)return 0;var c=b.block||b.blockLimit,d=c&&c.getLast(f);if(c&&c.isBlockBoundary()&&(!d||!(d.type==CKEDITOR.NODE_ELEMENT&&
d.isBlockBoundary()))&&!c.is("pre")&&!c.getBogus())return c}function b(a){var b=a.data.getTarget();if(b.is("input")){b=b.getAttribute("type");(b=="submit"||b=="reset")&&a.data.preventDefault()}}function f(a){return p(a)&&s(a)}function d(a,b){return function(c){var d=CKEDITOR.dom.element.get(c.data.$.toElement||c.data.$.fromElement||c.data.$.relatedTarget);(!d||!b.equals(d)&&!b.contains(d))&&a.call(this,c)}}function e(a){var b,c=a.getRanges()[0],d=a.root,e={table:1,ul:1,ol:1,dl:1};if(c.startPath().contains(e)){var a=
function(a){return function(c,d){d&&(c.type==CKEDITOR.NODE_ELEMENT&&c.is(e))&&(b=c);if(!d&&f(c)&&(!a||!i(c)))return false}},j=c.clone();j.collapse(1);j.setStartAt(d,CKEDITOR.POSITION_AFTER_START);d=new CKEDITOR.dom.walker(j);d.guard=a();d.checkBackward();if(b){j=c.clone();j.collapse();j.setEndAt(b,CKEDITOR.POSITION_AFTER_END);d=new CKEDITOR.dom.walker(j);d.guard=a(true);b=false;d.checkForward();return b}}return null}function g(a){a.editor.focus();a.editor.fire("saveSnapshot")}function n(a){var b=
a.editor;b.getSelection().scrollIntoView();setTimeout(function(){b.fire("saveSnapshot")},0)}function h(a,b,c){for(var d=a.getCommonAncestor(b),b=a=c?b:a;(a=a.getParent())&&!d.equals(a)&&a.getChildCount()==1;)b=a;b.remove()}CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(a,b){this.base(b.$||b);this.editor=a;this.status="unloaded";this.hasFocus=false;this.setup()},proto:{focus:function(){var a;if(CKEDITOR.env.webkit&&!this.hasFocus){a=this.editor._.previousActive||
this.getDocument().getActive();if(this.contains(a)){a.focus();return}}try{this.$[CKEDITOR.env.ie&&this.getDocument().equals(CKEDITOR.document)?"setActive":"focus"]()}catch(b){if(!CKEDITOR.env.ie)throw b;}if(CKEDITOR.env.safari&&!this.isInline()){a=CKEDITOR.document.getActive();a.equals(this.getWindow().getFrame())||this.getWindow().focus()}},on:function(a,b){var c=Array.prototype.slice.call(arguments,0);if(CKEDITOR.env.ie&&/^focus|blur$/.exec(a)){a=a=="focus"?"focusin":"focusout";b=d(b,this);c[0]=
a;c[1]=b}return CKEDITOR.dom.element.prototype.on.apply(this,c)},attachListener:function(a,b,c,d,e,f){!this._.listeners&&(this._.listeners=[]);var g=Array.prototype.slice.call(arguments,1),g=a.on.apply(a,g);this._.listeners.push(g);return g},clearListeners:function(){var a=this._.listeners;try{for(;a.length;)a.pop().removeListener()}catch(b){}},restoreAttrs:function(){var a=this._.attrChanges,b,c;for(c in a)if(a.hasOwnProperty(c)){b=a[c];b!==null?this.setAttribute(c,b):this.removeAttribute(c)}},attachClass:function(a){var b=
this.getCustomData("classes");if(!this.hasClass(a)){!b&&(b=[]);b.push(a);this.setCustomData("classes",b);this.addClass(a)}},changeAttr:function(a,b){var c=this.getAttribute(a);if(b!==c){!this._.attrChanges&&(this._.attrChanges={});a in this._.attrChanges||(this._.attrChanges[a]=c);this.setAttribute(a,b)}},insertHtml:function(a,b){g(this);x(this,b||"html",a)},insertText:function(a){g(this);var b=this.editor,c=b.getSelection().getStartElement().hasAscendant("pre",true)?CKEDITOR.ENTER_BR:b.activeEnterMode,
b=c==CKEDITOR.ENTER_BR,d=CKEDITOR.tools,a=d.htmlEncode(a.replace(/\r\n/g,"\n")),a=a.replace(/\t/g,"&nbsp;&nbsp; &nbsp;"),c=c==CKEDITOR.ENTER_P?"p":"div";if(!b){var e=/\n{2}/g;if(e.test(a))var f="<"+c+">",v="</"+c+">",a=f+a.replace(e,function(){return v+f})+v}a=a.replace(/\n/g,"<br>");b||(a=a.replace(RegExp("<br>(?=</"+c+">)"),function(a){return d.repeat(a,2)}));a=a.replace(/^ | $/g,"&nbsp;");a=a.replace(/(>|\s) /g,function(a,b){return b+"&nbsp;"}).replace(/ (?=<)/g,"&nbsp;");x(this,"text",a)},insertElement:function(a,
b){b?this.insertElementIntoRange(a,b):this.insertElementIntoSelection(a)},insertElementIntoRange:function(a,b){var c=this.editor,d=c.config.enterMode,e=a.getName(),f=CKEDITOR.dtd.$block[e];if(b.checkReadOnly())return false;b.deleteContents(1);b.startContainer.type==CKEDITOR.NODE_ELEMENT&&b.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})&&q(b);var g,h;if(f)for(;(g=b.getCommonAncestor(0,1))&&(h=CKEDITOR.dtd[g.getName()])&&(!h||!h[e]);)if(g.getName()in CKEDITOR.dtd.span)b.splitElement(g);else if(b.checkStartOfBlock()&&
b.checkEndOfBlock()){b.setStartBefore(g);b.collapse(true);g.remove()}else b.splitBlock(d==CKEDITOR.ENTER_DIV?"div":"p",c.editable());b.insertNode(a);return true},insertElementIntoSelection:function(a){g(this);var b=this.editor,c=b.activeEnterMode,b=b.getSelection(),d=b.getRanges()[0],e=a.getName(),e=CKEDITOR.dtd.$block[e];if(this.insertElementIntoRange(a,d)){d.moveToPosition(a,CKEDITOR.POSITION_AFTER_END);if(e)if((e=a.getNext(function(a){return f(a)&&!i(a)}))&&e.type==CKEDITOR.NODE_ELEMENT&&e.is(CKEDITOR.dtd.$block))e.getDtd()["#"]?
d.moveToElementEditStart(e):d.moveToElementEditEnd(a);else if(!e&&c!=CKEDITOR.ENTER_BR){e=d.fixBlock(true,c==CKEDITOR.ENTER_DIV?"div":"p");d.moveToElementEditStart(e)}}b.selectRanges([d]);n(this)},setData:function(a,b){b||(a=this.editor.dataProcessor.toHtml(a));this.setHtml(a);if(this.status=="unloaded")this.status="ready";this.editor.fire("dataReady")},getData:function(a){var b=this.getHtml();a||(b=this.editor.dataProcessor.toDataFormat(b));return b},setReadOnly:function(a){this.setAttribute("contenteditable",
!a)},detach:function(){this.removeClass("cke_editable");this.status="detached";var a=this.editor;this._.detach();delete a.document;delete a.window},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},setup:function(){var a=this.editor;this.attachListener(a,"beforeGetData",function(){var b=this.getData();this.is("textarea")||a.config.ignoreEmptyParagraph!==false&&(b=b.replace(m,function(a,b){return b}));a.setData(b,null,1)},this);this.attachListener(a,"getSnapshot",function(a){a.data=
this.getData(1)},this);this.attachListener(a,"afterSetData",function(){this.setData(a.getData(1))},this);this.attachListener(a,"loadSnapshot",function(a){this.setData(a.data,1)},this);this.attachListener(a,"beforeFocus",function(){var b=a.getSelection();(b=b&&b.getNative())&&b.type=="Control"||this.focus()},this);this.attachListener(a,"insertHtml",function(a){this.insertHtml(a.data.dataValue,a.data.mode)},this);this.attachListener(a,"insertElement",function(a){this.insertElement(a.data)},this);this.attachListener(a,
"insertText",function(a){this.insertText(a.data)},this);this.setReadOnly(a.readOnly);this.attachClass("cke_editable");this.attachClass(a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"cke_editable_inline":a.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE||a.elementMode==CKEDITOR.ELEMENT_MODE_APPENDTO?"cke_editable_themed":"");this.attachClass("cke_contents_"+a.config.contentsLangDirection);a.keystrokeHandler.blockedKeystrokes[8]=+a.readOnly;a.keystrokeHandler.attach(this);this.on("blur",function(){this.hasFocus=
false},null,null,-1);this.on("focus",function(){this.hasFocus=true},null,null,-1);a.focusManager.add(this);if(this.equals(CKEDITOR.document.getActive())){this.hasFocus=true;a.once("contentDom",function(){a.focusManager.focus()})}this.isInline()&&this.changeAttr("tabindex",a.tabIndex);if(!this.is("textarea")){a.document=this.getDocument();a.window=this.getWindow();var c=a.document;this.changeAttr("spellcheck",!a.config.disableNativeSpellChecker);var d=a.config.contentsLangDirection;this.getDirection(1)!=
d&&this.changeAttr("dir",d);var k=CKEDITOR.getCss();if(k){d=c.getHead();if(!d.getCustomData("stylesheet")){k=c.appendStyleText(k);k=new CKEDITOR.dom.element(k.ownerNode||k.owningElement);d.setCustomData("stylesheet",k);k.data("cke-temp",1)}}d=c.getCustomData("stylesheet_ref")||0;c.setCustomData("stylesheet_ref",d+1);this.setCustomData("cke_includeReadonly",!a.config.disableReadonlyStyling);this.attachListener(this,"click",function(a){var a=a.data,b=(new CKEDITOR.dom.elementPath(a.getTarget(),this)).contains("a");
b&&(a.$.button!=2&&b.isReadOnly())&&a.preventDefault()});var l={8:1,46:1};this.attachListener(a,"key",function(b){if(a.readOnly)return true;var c=b.data.domEvent.getKey(),d;if(c in l){var b=a.getSelection(),f,k=b.getRanges()[0],g=k.startPath(),h,i,m,c=c==8;if(CKEDITOR.env.ie&&CKEDITOR.env.version<11&&(f=b.getSelectedElement())||(f=e(b))){a.fire("saveSnapshot");k.moveToPosition(f,CKEDITOR.POSITION_BEFORE_START);f.remove();k.select();a.fire("saveSnapshot");d=1}else if(k.collapsed)if((h=g.block)&&(m=
h[c?"getPrevious":"getNext"](p))&&m.type==CKEDITOR.NODE_ELEMENT&&m.is("table")&&k[c?"checkStartOfBlock":"checkEndOfBlock"]()){a.fire("saveSnapshot");k[c?"checkEndOfBlock":"checkStartOfBlock"]()&&h.remove();k["moveToElementEdit"+(c?"End":"Start")](m);k.select();a.fire("saveSnapshot");d=1}else if(g.blockLimit&&g.blockLimit.is("td")&&(i=g.blockLimit.getAscendant("table"))&&k.checkBoundaryOfElement(i,c?CKEDITOR.START:CKEDITOR.END)&&(m=i[c?"getPrevious":"getNext"](p))){a.fire("saveSnapshot");k["moveToElementEdit"+
(c?"End":"Start")](m);k.checkStartOfBlock()&&k.checkEndOfBlock()?m.remove():k.select();a.fire("saveSnapshot");d=1}else if((i=g.contains(["td","th","caption"]))&&k.checkBoundaryOfElement(i,c?CKEDITOR.START:CKEDITOR.END))d=1}return!d});a.blockless&&(CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)&&this.attachListener(this,"keyup",function(b){if(b.data.getKeystroke()in l&&!this.getFirst(f)){this.appendBogus();b=a.createRange();b.moveToPosition(this,CKEDITOR.POSITION_AFTER_START);b.select()}});this.attachListener(this,
"dblclick",function(b){if(a.readOnly)return false;b={element:b.data.getTarget()};a.fire("doubleclick",b)});CKEDITOR.env.ie&&this.attachListener(this,"click",b);CKEDITOR.env.ie||this.attachListener(this,"mousedown",function(b){var c=b.data.getTarget();if(c.is("img","hr","input","textarea","select")&&!c.isReadOnly()){a.getSelection().selectElement(c);c.is("input","textarea","select")&&b.data.preventDefault()}});CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",function(b){if(b.data.$.button==2){b=
b.data.getTarget();if(!b.getOuterHtml().replace(m,"")){var c=a.createRange();c.moveToElementEditStart(b);c.select(true)}}});if(CKEDITOR.env.webkit){this.attachListener(this,"click",function(a){a.data.getTarget().is("input","select")&&a.data.preventDefault()});this.attachListener(this,"mouseup",function(a){a.data.getTarget().is("input","textarea")&&a.data.preventDefault()})}CKEDITOR.env.webkit&&this.attachListener(a,"key",function(b){b=b.data.domEvent.getKey();if(b in l){var c=b==8,d=a.getSelection().getRanges()[0],
b=d.startPath();if(d.collapsed){var e;a:{var f=b.block;if(f)if(d[c?"checkStartOfBlock":"checkEndOfBlock"]())if(!d.moveToClosestEditablePosition(f,!c)||!d.collapsed)e=false;else{if(d.startContainer.type==CKEDITOR.NODE_ELEMENT){var k=d.startContainer.getChild(d.startOffset-(c?1:0));if(k&&k.type==CKEDITOR.NODE_ELEMENT&&k.is("hr")){a.fire("saveSnapshot");k.remove();e=true;break a}}if((d=d.startPath().block)&&(!d||!d.contains(f))){a.fire("saveSnapshot");var g;(g=(c?d:f).getBogus())&&g.remove();e=a.getSelection();
g=e.createBookmarks();(c?f:d).moveChildren(c?d:f,false);b.lastElement.mergeSiblings();h(f,d,!c);e.selectBookmarks(g);e=true}}else e=false;else e=false}if(!e)return}else{c=d;e=b.block;g=c.endPath().block;if(!e||!g||e.equals(g))b=false;else{a.fire("saveSnapshot");(f=e.getBogus())&&f.remove();c.deleteContents();if(g.getParent()){g.moveChildren(e,false);b.lastElement.mergeSiblings();h(e,g,true)}c=a.getSelection().getRanges()[0];c.collapse(1);c.select();b=true}if(!b)return}a.getSelection().scrollIntoView();
a.fire("saveSnapshot");return false}},this,null,100)}}},_:{detach:function(){this.editor.setData(this.editor.getData(),0,1);this.clearListeners();this.restoreAttrs();var a;if(a=this.removeCustomData("classes"))for(;a.length;)this.removeClass(a.pop());if(!this.is("textarea")){a=this.getDocument();var b=a.getHead();if(b.getCustomData("stylesheet")){var c=a.getCustomData("stylesheet_ref");if(--c)a.setCustomData("stylesheet_ref",c);else{a.removeCustomData("stylesheet_ref");b.removeCustomData("stylesheet").remove()}}}this.editor.fire("contentDomUnload");
delete this.editor}}});CKEDITOR.editor.prototype.editable=function(a){var b=this._.editable;if(b&&a)return 0;if(arguments.length)b=this._.editable=a?a instanceof CKEDITOR.editable?a:new CKEDITOR.editable(this,a):(b&&b.detach(),null);return b};var i=CKEDITOR.dom.walker.bogus(),m=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,p=CKEDITOR.dom.walker.whitespaces(true),s=CKEDITOR.dom.walker.bookmark(false,true);CKEDITOR.on("instanceLoaded",
function(b){var c=b.editor;c.on("insertElement",function(a){a=a.data;if(a.type==CKEDITOR.NODE_ELEMENT&&(a.is("input")||a.is("textarea"))){a.getAttribute("contentEditable")!="false"&&a.data("cke-editable",a.hasAttribute("contenteditable")?"true":"1");a.setAttribute("contentEditable",false)}});c.on("selectionChange",function(b){if(!c.readOnly){var d=c.getSelection();if(d&&!d.isLocked){d=c.checkDirty();c.fire("lockSnapshot");a(b);c.fire("unlockSnapshot");!d&&c.resetDirty()}}})});CKEDITOR.on("instanceCreated",
function(a){var b=a.editor;b.on("mode",function(){var a=b.editable();if(a&&a.isInline()){var c=b.title;a.changeAttr("role","textbox");a.changeAttr("aria-label",c);c&&a.changeAttr("title",c);var d=b.fire("ariaEditorHelpLabel",{}).label;if(d)if(c=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents")){var e=CKEDITOR.tools.getNextId(),d=CKEDITOR.dom.element.createFromHtml('<span id="'+e+'" class="cke_voice_label">'+d+"</span>");c.append(d);a.changeAttr("aria-describedby",e)}}})});
CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}");var x=function(){function a(b){return b.type==CKEDITOR.NODE_ELEMENT}function b(c,d){var e,f,j,k,l=[],r=d.range.startContainer;e=d.range.startPath();for(var r=g[r.getName()],h=0,i=c.getChildren(),m=i.count(),n=-1,q=-1,p=0,s=e.contains(g.$list);h<m;++h){e=i.getItem(h);if(a(e)){j=e.getName();if(s&&j in CKEDITOR.dtd.$list)l=l.concat(b(e,d));else{k=!!r[j];if(j=="br"&&e.data("cke-eol")&&
(!h||h==m-1)){p=(f=h?l[h-1].node:i.getItem(h+1))&&(!a(f)||!f.is("br"));f=f&&a(f)&&g.$block[f.getName()]}n==-1&&!k&&(n=h);k||(q=h);l.push({isElement:1,isLineBreak:p,isBlock:e.isBlockBoundary(),hasBlockSibling:f,node:e,name:j,allowed:k});f=p=0}}else l.push({isElement:0,node:e,allowed:1})}if(n>-1)l[n].firstNotAllowed=1;if(q>-1)l[q].lastNotAllowed=1;return l}function c(b,d){var e=[],f=b.getChildren(),j=f.count(),k,l=0,r=g[d],h=!b.is(g.$inline)||b.is("br");for(h&&e.push(" ");l<j;l++){k=f.getItem(l);a(k)&&
!k.is(r)?e=e.concat(c(k,d)):e.push(k)}h&&e.push(" ");return e}function d(b){return b&&a(b)&&(b.is(g.$removeEmpty)||b.is("a")&&!b.isBlockBoundary())}function e(b,c,d,f){var j=b.clone(),k,g;j.setEndAt(c,CKEDITOR.POSITION_BEFORE_END);if((k=(new CKEDITOR.dom.walker(j)).next())&&a(k)&&h[k.getName()]&&(g=k.getPrevious())&&a(g)&&!g.getParent().equals(b.startContainer)&&d.contains(g)&&f.contains(k)&&k.isIdentical(g)){k.moveChildren(g);k.remove();e(b,c,d,f)}}function j(b,c){function d(b,c){if(c.isBlock&&c.isElement&&
!c.node.is("br")&&a(b)&&b.is("br")){b.remove();return 1}}var e=c.endContainer.getChild(c.endOffset),f=c.endContainer.getChild(c.endOffset-1);e&&d(e,b[b.length-1]);if(f&&d(f,b[0])){c.setEnd(c.endContainer,c.endOffset-1);c.collapse()}}var g=CKEDITOR.dtd,h={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},r={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},i=CKEDITOR.tools.extend({},g.$inline);delete i.br;return function(h,m,q){var p=h.editor;h.getDocument();var s=p.getSelection().getRanges()[0],
w=false;if(m=="unfiltered_html"){m="html";w=true}if(!s.checkReadOnly()){var z=(new CKEDITOR.dom.elementPath(s.startContainer,s.root)).blockLimit||s.root,m={type:m,dontFilter:w,editable:h,editor:p,range:s,blockLimit:z,mergeCandidates:[],zombies:[]},p=m.range,w=m.mergeCandidates,t,E,y,C;if(m.type=="text"&&p.shrink(CKEDITOR.SHRINK_ELEMENT,true,false)){t=CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",p.document);p.insertNode(t);p.setStartAfter(t)}E=new CKEDITOR.dom.elementPath(p.startContainer);
m.endPath=y=new CKEDITOR.dom.elementPath(p.endContainer);if(!p.collapsed){var z=y.block||y.blockLimit,I=p.getCommonAncestor();z&&(!z.equals(I)&&!z.contains(I)&&p.checkEndOfBlock())&&m.zombies.push(z);p.deleteContents()}for(;(C=a(p.startContainer)&&p.startContainer.getChild(p.startOffset-1))&&a(C)&&C.isBlockBoundary()&&E.contains(C);)p.moveToPosition(C,CKEDITOR.POSITION_BEFORE_END);e(p,m.blockLimit,E,y);if(t){p.setEndBefore(t);p.collapse();t.remove()}t=p.startPath();if(z=t.contains(d,false,1)){p.splitElement(z);
m.inlineStylesRoot=z;m.inlineStylesPeak=t.lastElement}t=p.createBookmark();(z=t.startNode.getPrevious(f))&&a(z)&&d(z)&&w.push(z);(z=t.startNode.getNext(f))&&a(z)&&d(z)&&w.push(z);for(z=t.startNode;(z=z.getParent())&&d(z);)w.push(z);p.moveToBookmark(t);if(t=q){t=m.range;if(m.type=="text"&&m.inlineStylesRoot){C=m.inlineStylesPeak;p=C.getDocument().createText("{cke-peak}");for(w=m.inlineStylesRoot.getParent();!C.equals(w);){p=p.appendTo(C.clone());C=C.getParent()}q=p.getOuterHtml().split("{cke-peak}").join(q)}C=
m.blockLimit.getName();if(/^\s+|\s+$/.test(q)&&"span"in CKEDITOR.dtd[C])var x='<span data-cke-marker="1">&nbsp;</span>',q=x+q+x;q=m.editor.dataProcessor.toHtml(q,{context:null,fixForBody:false,dontFilter:m.dontFilter,filter:m.editor.activeFilter,enterMode:m.editor.activeEnterMode});C=t.document.createElement("body");C.setHtml(q);if(x){C.getFirst().remove();C.getLast().remove()}if((x=t.startPath().block)&&!(x.getChildCount()==1&&x.getBogus()))a:{var G;if(C.getChildCount()==1&&a(G=C.getFirst())&&G.is(r)){x=
G.getElementsByTag("*");t=0;for(w=x.count();t<w;t++){p=x.getItem(t);if(!p.is(i))break a}G.moveChildren(G.getParent(1));G.remove()}}m.dataWrapper=C;t=q}if(t){G=m.range;var x=G.document,B,q=m.blockLimit;t=0;var K;C=[];var H,Q,w=p=0,M,T;E=G.startContainer;var z=m.endPath.elements[0],U;y=z.getPosition(E);I=!!z.getCommonAncestor(E)&&y!=CKEDITOR.POSITION_IDENTICAL&&!(y&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED);E=b(m.dataWrapper,m);for(j(E,G);t<E.length;t++){y=E[t];if(B=y.isLineBreak){B=
G;M=q;var N=void 0,W=void 0;if(y.hasBlockSibling)B=1;else{N=B.startContainer.getAscendant(g.$block,1);if(!N||!N.is({div:1,p:1}))B=0;else{W=N.getPosition(M);if(W==CKEDITOR.POSITION_IDENTICAL||W==CKEDITOR.POSITION_CONTAINS)B=0;else{M=B.splitElement(N);B.moveToPosition(M,CKEDITOR.POSITION_AFTER_START);B=1}}}}if(B)w=t>0;else{B=G.startPath();if(!y.isBlock&&m.editor.config.autoParagraph!==false&&(m.editor.activeEnterMode!=CKEDITOR.ENTER_BR&&m.editor.editable().equals(B.blockLimit)&&!B.block)&&(Q=m.editor.activeEnterMode!=
CKEDITOR.ENTER_BR&&m.editor.config.autoParagraph!==false?m.editor.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p":false)){Q=x.createElement(Q);Q.appendBogus();G.insertNode(Q);CKEDITOR.env.needsBrFiller&&(K=Q.getBogus())&&K.remove();G.moveToPosition(Q,CKEDITOR.POSITION_BEFORE_END)}if((B=G.startPath().block)&&!B.equals(H)){if(K=B.getBogus()){K.remove();C.push(B)}H=B}y.firstNotAllowed&&(p=1);if(p&&y.isElement){B=G.startContainer;for(M=null;B&&!g[B.getName()][y.name];){if(B.equals(q)){B=null;break}M=B;
B=B.getParent()}if(B){if(M){T=G.splitElement(M);m.zombies.push(T);m.zombies.push(M)}}else{M=q.getName();U=!t;B=t==E.length-1;M=c(y.node,M);for(var N=[],W=M.length,X=0,Z=void 0,$=0,aa=-1;X<W;X++){Z=M[X];if(Z==" "){if(!$&&(!U||X)){N.push(new CKEDITOR.dom.text(" "));aa=N.length}$=1}else{N.push(Z);$=0}}B&&aa==N.length&&N.pop();U=N}}if(U){for(;B=U.pop();)G.insertNode(B);U=0}else G.insertNode(y.node);if(y.lastNotAllowed&&t<E.length-1){(T=I?z:T)&&G.setEndAt(T,CKEDITOR.POSITION_AFTER_START);p=0}G.collapse()}}m.dontMoveCaret=
w;m.bogusNeededBlocks=C}K=m.range;var P;T=m.bogusNeededBlocks;for(U=K.createBookmark();H=m.zombies.pop();)if(H.getParent()){Q=K.clone();Q.moveToElementEditStart(H);Q.removeEmptyBlocksAtEnd()}if(T)for(;H=T.pop();)CKEDITOR.env.needsBrFiller?H.appendBogus():H.append(K.document.createText("Â "));for(;H=m.mergeCandidates.pop();)H.mergeSiblings();K.moveToBookmark(U);if(!m.dontMoveCaret){for(H=a(K.startContainer)&&K.startContainer.getChild(K.startOffset-1);H&&a(H)&&!H.is(g.$empty);){if(H.isBlockBoundary())K.moveToPosition(H,
CKEDITOR.POSITION_BEFORE_END);else{if(d(H)&&H.getHtml().match(/(\s|&nbsp;)$/g)){P=null;break}P=K.clone();P.moveToPosition(H,CKEDITOR.POSITION_BEFORE_END)}H=H.getLast(f)}P&&K.moveToRange(P)}s.select();n(h)}}}(),q=function(){function a(b){b=new CKEDITOR.dom.walker(b);b.guard=function(a,b){if(b)return false;if(a.type==CKEDITOR.NODE_ELEMENT)return a.is(CKEDITOR.dtd.$tableContent)};b.evaluator=function(a){return a.type==CKEDITOR.NODE_ELEMENT};return b}function b(a,c,d){c=a.getDocument().createElement(c);
a.append(c,d);return c}function c(a){var b=a.count(),d;for(b;b-- >0;){d=a.getItem(b);if(!CKEDITOR.tools.trim(d.getHtml())){d.appendBogus();CKEDITOR.env.ie&&(CKEDITOR.env.version<9&&d.getChildCount())&&d.getFirst().remove()}}}return function(d){var e=d.startContainer,f=e.getAscendant("table",1),g=false;c(f.getElementsByTag("td"));c(f.getElementsByTag("th"));f=d.clone();f.setStart(e,0);f=a(f).lastBackward();if(!f){f=d.clone();f.setEndAt(e,CKEDITOR.POSITION_BEFORE_END);f=a(f).lastForward();g=true}f||
(f=e);if(f.is("table")){d.setStartAt(f,CKEDITOR.POSITION_BEFORE_START);d.collapse(true);f.remove()}else{f.is({tbody:1,thead:1,tfoot:1})&&(f=b(f,"tr",g));f.is("tr")&&(f=b(f,f.getParent().is("thead")?"th":"td",g));(e=f.getBogus())&&e.remove();d.moveToPosition(f,g?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END)}}}()})();
(function(){function a(){var a=this._.fakeSelection,b;if(a){b=this.getSelection(1);if(!b||!b.isHidden()){a.reset();a=0}}if(!a){a=b||this.getSelection(1);if(!a||a.getType()==CKEDITOR.SELECTION_NONE)return}this.fire("selectionCheck",a);b=this.elementPath();if(!b.compare(this._.selectionPreviousPath)){if(CKEDITOR.env.webkit)this._.previousActive=this.document.getActive();this._.selectionPreviousPath=b;this.fire("selectionChange",{selection:a,path:b})}}function c(){s=true;if(!p){b.call(this);p=CKEDITOR.tools.setTimeout(b,
200,this)}}function b(){p=null;if(s){CKEDITOR.tools.setTimeout(a,0,this);s=false}}function f(a){function b(c,d){return!c||c.type==CKEDITOR.NODE_TEXT?false:a.clone()["moveToElementEdit"+(d?"End":"Start")](c)}if(!(a.root instanceof CKEDITOR.editable))return false;var c=a.startContainer,d=a.getPreviousNode(x,null,c),e=a.getNextNode(x,null,c);return b(d)||b(e,1)||!d&&!e&&!(c.type==CKEDITOR.NODE_ELEMENT&&c.isBlockBoundary()&&c.getBogus())?true:false}function d(a){return a.getCustomData("cke-fillingChar")}
function e(a,b){var c=a&&a.removeCustomData("cke-fillingChar");if(c){if(b!==false){var d,e=a.getDocument().getSelection().getNative(),f=e&&e.type!="None"&&e.getRangeAt(0);if(c.getLength()>1&&f&&f.intersectsNode(c.$)){d=[e.anchorOffset,e.focusOffset];f=e.focusNode==c.$&&e.focusOffset>0;e.anchorNode==c.$&&e.anchorOffset>0&&d[0]--;f&&d[1]--;var h;f=e;if(!f.isCollapsed){h=f.getRangeAt(0);h.setStart(f.anchorNode,f.anchorOffset);h.setEnd(f.focusNode,f.focusOffset);h=h.collapsed}h&&d.unshift(d.pop())}}c.setText(g(c.getText()));
if(d){c=e.getRangeAt(0);c.setStart(c.startContainer,d[0]);c.setEnd(c.startContainer,d[1]);e.removeAllRanges();e.addRange(c)}}}function g(a){return a.replace(/\u200B( )?/g,function(a){return a[1]?"Â ":""})}function n(a,b,c){var d=a.on("focus",function(a){a.cancel()},null,null,-100);if(CKEDITOR.env.ie)var e=a.getDocument().on("selectionchange",function(a){a.cancel()},null,null,-100);else{var f=new CKEDITOR.dom.range(a);f.moveToElementEditStart(a);var g=a.getDocument().$.createRange();g.setStart(f.startContainer.$,
f.startOffset);g.collapse(1);b.removeAllRanges();b.addRange(g)}c&&a.focus();d.removeListener();e&&e.removeListener()}function h(a){var b=CKEDITOR.dom.element.createFromHtml('<div data-cke-hidden-sel="1" data-cke-temp="1" style="'+(CKEDITOR.env.ie?"display:none":"position:fixed;top:0;left:-1000px")+'">&nbsp;</div>',a.document);a.fire("lockSnapshot");a.editable().append(b);var c=a.getSelection(1),d=a.createRange(),e=c.root.on("selectionchange",function(a){a.cancel()},null,null,0);d.setStartAt(b,CKEDITOR.POSITION_AFTER_START);
d.setEndAt(b,CKEDITOR.POSITION_BEFORE_END);c.selectRanges([d]);e.removeListener();a.fire("unlockSnapshot");a._.hiddenSelectionContainer=b}function i(a){var b={37:1,39:1,8:1,46:1};return function(c){var d=c.data.getKeystroke();if(b[d]){var e=a.getSelection().getRanges(),f=e[0];if(e.length==1&&f.collapsed)if((d=f[d<38?"getPreviousEditableNode":"getNextEditableNode"]())&&d.type==CKEDITOR.NODE_ELEMENT&&d.getAttribute("contenteditable")=="false"){a.getSelection().fake(d);c.data.preventDefault();c.cancel()}}}}
function m(a){for(var b=0;b<a.length;b++){var c=a[b];c.getCommonAncestor().isReadOnly()&&a.splice(b,1);if(!c.collapsed){if(c.startContainer.isReadOnly())for(var d=c.startContainer,e;d;){if((e=d.type==CKEDITOR.NODE_ELEMENT)&&d.is("body")||!d.isReadOnly())break;e&&d.getAttribute("contentEditable")=="false"&&c.setStartAfter(d);d=d.getParent()}d=c.startContainer;e=c.endContainer;var f=c.startOffset,g=c.endOffset,h=c.clone();d&&d.type==CKEDITOR.NODE_TEXT&&(f>=d.getLength()?h.setStartAfter(d):h.setStartBefore(d));
e&&e.type==CKEDITOR.NODE_TEXT&&(g?h.setEndAfter(e):h.setEndBefore(e));d=new CKEDITOR.dom.walker(h);d.evaluator=function(d){if(d.type==CKEDITOR.NODE_ELEMENT&&d.isReadOnly()){var e=c.clone();c.setEndBefore(d);c.collapsed&&a.splice(b--,1);if(!(d.getPosition(h.endContainer)&CKEDITOR.POSITION_CONTAINS)){e.setStartAfter(d);e.collapsed||a.splice(b+1,0,e)}return true}return false};d.next()}}return a}var p,s,x=CKEDITOR.dom.walker.invisible(1),q=function(){function a(b){return function(a){var c=a.editor.createRange();
c.moveToClosestEditablePosition(a.selected,b)&&a.editor.getSelection().selectRanges([c]);return false}}function b(a){return function(b){var c=b.editor,d=c.createRange(),e;if(!(e=d.moveToClosestEditablePosition(b.selected,a)))e=d.moveToClosestEditablePosition(b.selected,!a);e&&c.getSelection().selectRanges([d]);c.fire("saveSnapshot");b.selected.remove();if(!e){d.moveToElementEditablePosition(c.editable());c.getSelection().selectRanges([d])}c.fire("saveSnapshot");return false}}var c=a(),d=a(1);return{37:c,
38:c,39:d,40:d,8:b(),46:b(1)}}();CKEDITOR.on("instanceCreated",function(b){function d(){var a=f.getSelection();a&&a.removeAllRanges()}var f=b.editor;f.on("contentDom",function(){var b=f.document,d=CKEDITOR.document,g=f.editable(),k=b.getBody(),l=b.getDocumentElement(),h=g.isInline(),m,n;CKEDITOR.env.gecko&&g.attachListener(g,"focus",function(a){a.removeListener();if(m!==0)if((a=f.getSelection().getNative())&&a.isCollapsed&&a.anchorNode==g.$){a=f.createRange();a.moveToElementEditStart(g);a.select()}},
null,null,-2);g.attachListener(g,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){m&&CKEDITOR.env.webkit&&(m=f._.previousActive&&f._.previousActive.equals(b.getActive()));f.unlockSelection(m);m=0},null,null,-1);g.attachListener(g,"mousedown",function(){m=0});if(CKEDITOR.env.ie||h){var q=function(){n=new CKEDITOR.dom.selection(f.getSelection());n.lock()};o?g.attachListener(g,"beforedeactivate",q,null,null,-1):g.attachListener(f,"selectionCheck",q,null,null,-1);g.attachListener(g,CKEDITOR.env.webkit?
"DOMFocusOut":"blur",function(){f.lockSelection(n);m=1},null,null,-1);g.attachListener(g,"mousedown",function(){m=0})}if(CKEDITOR.env.ie&&!h){var w;g.attachListener(g,"mousedown",function(a){if(a.data.$.button==2){a=f.document.getSelection();if(!a||a.getType()==CKEDITOR.SELECTION_NONE)w=f.window.getScrollPosition()}});g.attachListener(g,"mouseup",function(a){if(a.data.$.button==2&&w){f.document.$.documentElement.scrollLeft=w.x;f.document.$.documentElement.scrollTop=w.y}w=null});if(b.$.compatMode!=
"BackCompat"){if(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)l.on("mousedown",function(a){function b(a){a=a.data.$;if(e){var c=k.$.createTextRange();try{c.moveToPoint(a.x,a.y)}catch(d){}e.setEndPoint(g.compareEndPoints("StartToStart",c)<0?"EndToEnd":"StartToStart",c);e.select()}}function c(){l.removeListener("mousemove",b);d.removeListener("mouseup",c);l.removeListener("mouseup",c);e.select()}a=a.data;if(a.getTarget().is("html")&&a.$.y<l.$.clientHeight&&a.$.x<l.$.clientWidth){var e=k.$.createTextRange();
try{e.moveToPoint(a.$.x,a.$.y)}catch(f){}var g=e.duplicate();l.on("mousemove",b);d.on("mouseup",c);l.on("mouseup",c)}});if(CKEDITOR.env.version>7&&CKEDITOR.env.version<11){l.on("mousedown",function(a){if(a.data.getTarget().is("html")){d.on("mouseup",z);l.on("mouseup",z)}});var z=function(){d.removeListener("mouseup",z);l.removeListener("mouseup",z);var a=CKEDITOR.document.$.selection,c=a.createRange();a.type!="None"&&c.parentElement().ownerDocument==b.$&&c.select()}}}}g.attachListener(g,"selectionchange",
a,f);g.attachListener(g,"keyup",c,f);g.attachListener(g,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){f.forceNextSelectionCheck();f.selectionChange(1)});if(h&&(CKEDITOR.env.webkit||CKEDITOR.env.gecko)){var t;g.attachListener(g,"mousedown",function(){t=1});g.attachListener(b.getDocumentElement(),"mouseup",function(){t&&c.call(f);t=0})}else g.attachListener(CKEDITOR.env.ie?g:b.getDocumentElement(),"mouseup",c,f);CKEDITOR.env.webkit&&g.attachListener(b,"keydown",function(a){switch(a.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:e(g)}},
null,null,-1);g.attachListener(g,"keydown",i(f),null,null,-1)});f.on("setData",function(){f.unlockSelection();CKEDITOR.env.webkit&&d()});f.on("contentDomUnload",function(){f.unlockSelection()});if(CKEDITOR.env.ie9Compat)f.on("beforeDestroy",d,null,null,9);f.on("dataReady",function(){delete f._.fakeSelection;delete f._.hiddenSelectionContainer;f.selectionChange(1)});f.on("loadSnapshot",function(){var a=f.editable().getLast(function(a){return a.type==CKEDITOR.NODE_ELEMENT});a&&a.hasAttribute("data-cke-hidden-sel")&&
a.remove()},null,null,100);f.on("key",function(a){if(f.mode=="wysiwyg"){var b=f.getSelection();if(b.isFake){var c=q[a.data.keyCode];if(c)return c({editor:f,selected:b.getSelectedElement(),selection:b,keyEvent:a})}}})});CKEDITOR.on("instanceReady",function(a){var b=a.editor;if(CKEDITOR.env.webkit){b.on("selectionChange",function(){var a=b.editable(),c=d(a);c&&(c.getCustomData("ready")?e(a):c.setCustomData("ready",1))},null,null,-1);b.on("beforeSetMode",function(){e(b.editable())},null,null,-1);var c,
f,a=function(){var a=b.editable();if(a)if(a=d(a)){var e=b.document.$.defaultView.getSelection();e.type=="Caret"&&e.anchorNode==a.$&&(f=1);c=a.getText();a.setText(g(c))}},h=function(){var a=b.editable();if(a)if(a=d(a)){a.setText(c);if(f){b.document.$.defaultView.getSelection().setPosition(a.$,a.getLength());f=0}}};b.on("beforeUndoImage",a);b.on("afterUndoImage",h);b.on("beforeGetData",a,null,null,0);b.on("getData",h)}});CKEDITOR.editor.prototype.selectionChange=function(b){(b?a:c).call(this)};CKEDITOR.editor.prototype.getSelection=
function(a){if((this._.savedSelection||this._.fakeSelection)&&!a)return this._.savedSelection||this._.fakeSelection;return(a=this.editable())&&this.mode=="wysiwyg"?new CKEDITOR.dom.selection(a):null};CKEDITOR.editor.prototype.lockSelection=function(a){a=a||this.getSelection(1);if(a.getType()!=CKEDITOR.SELECTION_NONE){!a.isLocked&&a.lock();this._.savedSelection=a;return true}return false};CKEDITOR.editor.prototype.unlockSelection=function(a){var b=this._.savedSelection;if(b){b.unlock(a);delete this._.savedSelection;
return true}return false};CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath};CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this)};CKEDITOR.dom.range.prototype.select=function(){var a=this.root instanceof CKEDITOR.editable?this.root.editor.getSelection():new CKEDITOR.dom.selection(this.root);a.selectRanges([this]);return a};CKEDITOR.SELECTION_NONE=1;CKEDITOR.SELECTION_TEXT=2;CKEDITOR.SELECTION_ELEMENT=3;var o=
typeof window.getSelection!="function",u=1;CKEDITOR.dom.selection=function(a){if(a instanceof CKEDITOR.dom.selection)var b=a,a=a.root;var c=a instanceof CKEDITOR.dom.element;this.rev=b?b.rev:u++;this.document=a instanceof CKEDITOR.dom.document?a:a.getDocument();this.root=a=c?a:this.document.getBody();this.isLocked=0;this._={cache:{}};if(b){CKEDITOR.tools.extend(this._.cache,b._.cache);this.isFake=b.isFake;this.isLocked=b.isLocked;return this}b=o?this.document.$.selection:this.document.getWindow().$.getSelection();
if(CKEDITOR.env.webkit)(b.type=="None"&&this.document.getActive().equals(a)||b.type=="Caret"&&b.anchorNode.nodeType==CKEDITOR.NODE_DOCUMENT)&&n(a,b);else if(CKEDITOR.env.gecko)b&&(this.document.getActive().equals(a)&&b.anchorNode&&b.anchorNode.nodeType==CKEDITOR.NODE_DOCUMENT)&&n(a,b,true);else if(CKEDITOR.env.ie){var d;try{d=this.document.getActive()}catch(e){}if(o)b.type=="None"&&(d&&d.equals(this.document.getDocumentElement()))&&n(a,null,true);else{(b=b&&b.anchorNode)&&(b=new CKEDITOR.dom.node(b));
d&&(d.equals(this.document.getDocumentElement())&&b&&(a.equals(b)||a.contains(b)))&&n(a,null,true)}}d=this.getNative();var f,g;if(d)if(d.getRangeAt)f=(g=d.rangeCount&&d.getRangeAt(0))&&new CKEDITOR.dom.node(g.commonAncestorContainer);else{try{g=d.createRange()}catch(h){}f=g&&CKEDITOR.dom.element.get(g.item&&g.item(0)||g.parentElement())}if(!f||!(f.type==CKEDITOR.NODE_ELEMENT||f.type==CKEDITOR.NODE_TEXT)||!this.root.equals(f)&&!this.root.contains(f)){this._.cache.type=CKEDITOR.SELECTION_NONE;this._.cache.startElement=
null;this._.cache.selectedElement=null;this._.cache.selectedText="";this._.cache.ranges=new CKEDITOR.dom.rangeList}return this};var A={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:function(){return this._.cache.nativeSel!==void 0?this._.cache.nativeSel:this._.cache.nativeSel=o?this.document.$.selection:this.document.getWindow().$.getSelection()},getType:o?function(){var a=
this._.cache;if(a.type)return a.type;var b=CKEDITOR.SELECTION_NONE;try{var c=this.getNative(),d=c.type;if(d=="Text")b=CKEDITOR.SELECTION_TEXT;if(d=="Control")b=CKEDITOR.SELECTION_ELEMENT;if(c.createRange().parentElement())b=CKEDITOR.SELECTION_TEXT}catch(e){}return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=CKEDITOR.SELECTION_TEXT,c=this.getNative();if(!c||!c.rangeCount)b=CKEDITOR.SELECTION_NONE;else if(c.rangeCount==1){var c=c.getRangeAt(0),d=c.startContainer;if(d==c.endContainer&&
d.nodeType==1&&c.endOffset-c.startOffset==1&&A[d.childNodes[c.startOffset].nodeName.toLowerCase()])b=CKEDITOR.SELECTION_ELEMENT}return a.type=b},getRanges:function(){var a=o?function(){function a(b){return(new CKEDITOR.dom.node(b)).getIndex()}var b=function(b,c){b=b.duplicate();b.collapse(c);var d=b.parentElement();if(!d.hasChildNodes())return{container:d,offset:0};for(var e=d.children,f,g,k=b.duplicate(),j=0,h=e.length-1,w=-1,i,t;j<=h;){w=Math.floor((j+h)/2);f=e[w];k.moveToElementText(f);i=k.compareEndPoints("StartToStart",
b);if(i>0)h=w-1;else if(i<0)j=w+1;else return{container:d,offset:a(f)}}if(w==-1||w==e.length-1&&i<0){k.moveToElementText(d);k.setEndPoint("StartToStart",b);k=k.text.replace(/(\r\n|\r)/g,"\n").length;e=d.childNodes;if(!k){f=e[e.length-1];return f.nodeType!=CKEDITOR.NODE_TEXT?{container:d,offset:e.length}:{container:f,offset:f.nodeValue.length}}for(d=e.length;k>0&&d>0;){g=e[--d];if(g.nodeType==CKEDITOR.NODE_TEXT){t=g;k=k-g.nodeValue.length}}return{container:t,offset:-k}}k.collapse(i>0?true:false);k.setEndPoint(i>
0?"StartToStart":"EndToStart",b);k=k.text.replace(/(\r\n|\r)/g,"\n").length;if(!k)return{container:d,offset:a(f)+(i>0?0:1)};for(;k>0;)try{g=f[i>0?"previousSibling":"nextSibling"];if(g.nodeType==CKEDITOR.NODE_TEXT){k=k-g.nodeValue.length;t=g}f=g}catch(m){return{container:d,offset:a(f)}}return{container:t,offset:i>0?-k:t.nodeValue.length+k}};return function(){var a=this.getNative(),c=a&&a.createRange(),d=this.getType();if(!a)return[];if(d==CKEDITOR.SELECTION_TEXT){a=new CKEDITOR.dom.range(this.root);
d=b(c,true);a.setStart(new CKEDITOR.dom.node(d.container),d.offset);d=b(c);a.setEnd(new CKEDITOR.dom.node(d.container),d.offset);a.endContainer.getPosition(a.startContainer)&CKEDITOR.POSITION_PRECEDING&&a.endOffset<=a.startContainer.getIndex()&&a.collapse();return[a]}if(d==CKEDITOR.SELECTION_ELEMENT){for(var d=[],e=0;e<c.length;e++){for(var f=c.item(e),g=f.parentNode,k=0,a=new CKEDITOR.dom.range(this.root);k<g.childNodes.length&&g.childNodes[k]!=f;k++);a.setStart(new CKEDITOR.dom.node(g),k);a.setEnd(new CKEDITOR.dom.node(g),
k+1);d.push(a)}return d}return[]}}():function(){var a=[],b,c=this.getNative();if(!c)return a;for(var d=0;d<c.rangeCount;d++){var e=c.getRangeAt(d);b=new CKEDITOR.dom.range(this.root);b.setStart(new CKEDITOR.dom.node(e.startContainer),e.startOffset);b.setEnd(new CKEDITOR.dom.node(e.endContainer),e.endOffset);a.push(b)}return a};return function(b){var c=this._.cache,d=c.ranges;if(!d)c.ranges=d=new CKEDITOR.dom.rangeList(a.call(this));return!b?d:m(new CKEDITOR.dom.rangeList(d.slice()))}}(),getStartElement:function(){var a=
this._.cache;if(a.startElement!==void 0)return a.startElement;var b;switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var c=this.getRanges()[0];if(c){if(c.collapsed){b=c.startContainer;b.type!=CKEDITOR.NODE_ELEMENT&&(b=b.getParent())}else{for(c.optimize();;){b=c.startContainer;if(c.startOffset==(b.getChildCount?b.getChildCount():b.getLength())&&!b.isBlockBoundary())c.setStartAfter(b);else break}b=c.startContainer;if(b.type!=CKEDITOR.NODE_ELEMENT)return b.getParent();
b=b.getChild(c.startOffset);if(!b||b.type!=CKEDITOR.NODE_ELEMENT)b=c.startContainer;else for(c=b.getFirst();c&&c.type==CKEDITOR.NODE_ELEMENT;){b=c;c=c.getFirst()}}b=b.$}}return a.startElement=b?new CKEDITOR.dom.element(b):null},getSelectedElement:function(){var a=this._.cache;if(a.selectedElement!==void 0)return a.selectedElement;var b=this,c=CKEDITOR.tools.tryThese(function(){return b.getNative().createRange().item(0)},function(){for(var a=b.getRanges()[0].clone(),c,d,e=2;e&&(!(c=a.getEnclosedNode())||
!(c.type==CKEDITOR.NODE_ELEMENT&&A[c.getName()]&&(d=c)));e--)a.shrink(CKEDITOR.SHRINK_ELEMENT);return d&&d.$});return a.selectedElement=c?new CKEDITOR.dom.element(c):null},getSelectedText:function(){var a=this._.cache;if(a.selectedText!==void 0)return a.selectedText;var b=this.getNative(),b=o?b.type=="Control"?"":b.createRange().text:b.toString();return a.selectedText=b},lock:function(){this.getRanges();this.getStartElement();this.getSelectedElement();this.getSelectedText();this._.cache.nativeSel=
null;this.isLocked=1},unlock:function(a){if(this.isLocked){if(a)var b=this.getSelectedElement(),c=!b&&this.getRanges(),d=this.isFake;this.isLocked=0;this.reset();if(a)(a=b||c[0]&&c[0].getCommonAncestor())&&a.getAscendant("body",1)&&(d?this.fake(b):b?this.selectElement(b):this.selectRanges(c))}},reset:function(){this._.cache={};this.isFake=0;var a=this.root.editor;if(a&&a._.fakeSelection&&this.rev==a._.fakeSelection.rev){delete a._.fakeSelection;var b=a._.hiddenSelectionContainer;if(b){var c=a.checkDirty();
a.fire("lockSnapshot");b.remove();a.fire("unlockSnapshot");!c&&a.resetDirty()}delete a._.hiddenSelectionContainer}this.rev=u++},selectElement:function(a){var b=new CKEDITOR.dom.range(this.root);b.setStartBefore(a);b.setEndAfter(a);this.selectRanges([b])},selectRanges:function(a){var b=this.root.editor,b=b&&b._.hiddenSelectionContainer;this.reset();if(b)for(var b=this.root,c,d=0;d<a.length;++d){c=a[d];if(c.endContainer.equals(b))c.endOffset=Math.min(c.endOffset,b.getChildCount())}if(a.length)if(this.isLocked){var g=
CKEDITOR.document.getActive();this.unlock();this.selectRanges(a);this.lock();!g.equals(this.root)&&g.focus()}else{var h;a:{var i,m;if(a.length==1&&!(m=a[0]).collapsed&&(h=m.getEnclosedNode())&&h.type==CKEDITOR.NODE_ELEMENT){m=m.clone();m.shrink(CKEDITOR.SHRINK_ELEMENT,true);if((i=m.getEnclosedNode())&&i.type==CKEDITOR.NODE_ELEMENT)h=i;if(h.getAttribute("contenteditable")=="false")break a}h=void 0}if(h)this.fake(h);else{if(o){m=CKEDITOR.dom.walker.whitespaces(true);i=/\ufeff|\u00a0/;b={table:1,tbody:1,
tr:1};if(a.length>1){h=a[a.length-1];a[0].setEnd(h.endContainer,h.endOffset)}h=a[0];var a=h.collapsed,n,q,p;if((c=h.getEnclosedNode())&&c.type==CKEDITOR.NODE_ELEMENT&&c.getName()in A&&(!c.is("a")||!c.getText()))try{p=c.$.createControlRange();p.addElement(c.$);p.select();return}catch(s){}if(h.startContainer.type==CKEDITOR.NODE_ELEMENT&&h.startContainer.getName()in b||h.endContainer.type==CKEDITOR.NODE_ELEMENT&&h.endContainer.getName()in b){h.shrink(CKEDITOR.NODE_ELEMENT,true);a=h.collapsed}p=h.createBookmark();
b=p.startNode;if(!a)g=p.endNode;p=h.document.$.body.createTextRange();p.moveToElementText(b.$);p.moveStart("character",1);if(g){i=h.document.$.body.createTextRange();i.moveToElementText(g.$);p.setEndPoint("EndToEnd",i);p.moveEnd("character",-1)}else{n=b.getNext(m);q=b.hasAscendant("pre");n=!(n&&n.getText&&n.getText().match(i))&&(q||!b.hasPrevious()||b.getPrevious().is&&b.getPrevious().is("br"));q=h.document.createElement("span");q.setHtml("&#65279;");q.insertBefore(b);n&&h.document.createText("ï»¿").insertBefore(b)}h.setStartBefore(b);
b.remove();if(a){if(n){p.moveStart("character",-1);p.select();h.document.$.selection.clear()}else p.select();h.moveToPosition(q,CKEDITOR.POSITION_BEFORE_START);q.remove()}else{h.setEndBefore(g);g.remove();p.select()}}else{g=this.getNative();if(!g)return;this.removeAllRanges();for(p=0;p<a.length;p++){if(p<a.length-1){n=a[p];q=a[p+1];i=n.clone();i.setStart(n.endContainer,n.endOffset);i.setEnd(q.startContainer,q.startOffset);if(!i.collapsed){i.shrink(CKEDITOR.NODE_ELEMENT,true);h=i.getCommonAncestor();
i=i.getEnclosedNode();if(h.isReadOnly()||i&&i.isReadOnly()){q.setStart(n.startContainer,n.startOffset);a.splice(p--,1);continue}}}h=a[p];q=this.document.$.createRange();if(h.collapsed&&CKEDITOR.env.webkit&&f(h)){n=this.root;e(n,false);i=n.getDocument().createText("â€‹");n.setCustomData("cke-fillingChar",i);h.insertNode(i);if((n=i.getNext())&&!i.getPrevious()&&n.type==CKEDITOR.NODE_ELEMENT&&n.getName()=="br"){e(this.root);h.moveToPosition(n,CKEDITOR.POSITION_BEFORE_START)}else h.moveToPosition(i,CKEDITOR.POSITION_AFTER_END)}q.setStart(h.startContainer.$,
h.startOffset);try{q.setEnd(h.endContainer.$,h.endOffset)}catch(w){if(w.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){h.collapse(1);q.setEnd(h.endContainer.$,h.endOffset)}else throw w;}g.addRange(q)}}this.reset();this.root.fire("selectionchange")}}},fake:function(a){var b=this.root.editor;this.reset();h(b);var c=this._.cache,d=new CKEDITOR.dom.range(this.root);d.setStartBefore(a);d.setEndAfter(a);c.ranges=new CKEDITOR.dom.rangeList(d);c.selectedElement=c.startElement=a;c.type=CKEDITOR.SELECTION_ELEMENT;
c.selectedText=c.nativeSel=null;this.isFake=1;this.rev=u++;b._.fakeSelection=this;this.root.fire("selectionchange")},isHidden:function(){var a=this.getCommonAncestor();a&&a.type==CKEDITOR.NODE_TEXT&&(a=a.getParent());return!(!a||!a.data("cke-hidden-sel"))},createBookmarks:function(a){a=this.getRanges().createBookmarks(a);this.isFake&&(a.isFake=1);return a},createBookmarks2:function(a){a=this.getRanges().createBookmarks2(a);this.isFake&&(a.isFake=1);return a},selectBookmarks:function(a){for(var b=
[],c=0;c<a.length;c++){var d=new CKEDITOR.dom.range(this.root);d.moveToBookmark(a[c]);b.push(d)}a.isFake?this.fake(b[0].getEnclosedNode()):this.selectRanges(b);return this},getCommonAncestor:function(){var a=this.getRanges();return!a.length?null:a[0].startContainer.getCommonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){this.type!=CKEDITOR.SELECTION_NONE&&this.getRanges()[0].scrollIntoView()},removeAllRanges:function(){if(this.getType()!=CKEDITOR.SELECTION_NONE){var a=this.getNative();
try{a&&a[o?"empty":"removeAllRanges"]()}catch(b){}this.reset()}}}})();"use strict";CKEDITOR.STYLE_BLOCK=1;CKEDITOR.STYLE_INLINE=2;CKEDITOR.STYLE_OBJECT=3;
(function(){function a(a,b){for(var c,d;a=a.getParent();){if(a.equals(b))break;if(a.getAttribute("data-nostyle"))c=a;else if(!d){var e=a.getAttribute("contentEditable");e=="false"?c=a:e=="true"&&(d=1)}}return c}function c(b){var d=b.document;if(b.collapsed){d=u(this,d);b.insertNode(d);b.moveToPosition(d,CKEDITOR.POSITION_BEFORE_END)}else{var e=this.element,g=this._.definition,h,i=g.ignoreReadonly,j=i||g.includeReadonly;j==void 0&&(j=b.root.getCustomData("cke_includeReadonly"));var k=CKEDITOR.dtd[e];
if(!k){h=true;k=CKEDITOR.dtd.span}b.enlarge(CKEDITOR.ENLARGE_INLINE,1);b.trim();var m=b.createBookmark(),l=m.startNode,n=m.endNode,p=l,q;if(!i){var o=b.getCommonAncestor(),i=a(l,o),o=a(n,o);i&&(p=i.getNextSourceNode(true));o&&(n=o)}for(p.getPosition(n)==CKEDITOR.POSITION_FOLLOWING&&(p=0);p;){i=false;if(p.equals(n)){p=null;i=true}else{var s=p.type==CKEDITOR.NODE_ELEMENT?p.getName():null,o=s&&p.getAttribute("contentEditable")=="false",r=s&&p.getAttribute("data-nostyle");if(s&&p.data("cke-bookmark")){p=
p.getNextSourceNode(true);continue}if(o&&j&&CKEDITOR.dtd.$block[s])for(var v=p,A=f(v),D=void 0,I=A.length,O=0,v=I&&new CKEDITOR.dom.range(v.getDocument());O<I;++O){var D=A[O],S=CKEDITOR.filter.instances[D.data("cke-filter")];if(S?S.check(this):1){v.selectNodeContents(D);c.call(this,v)}}A=s?!k[s]||r?0:o&&!j?0:(p.getPosition(n)|L)==L&&(!g.childRule||g.childRule(p)):1;if(A)if((A=p.getParent())&&((A.getDtd()||CKEDITOR.dtd.span)[e]||h)&&(!g.parentRule||g.parentRule(A))){if(!q&&(!s||!CKEDITOR.dtd.$removeEmpty[s]||
(p.getPosition(n)|L)==L)){q=b.clone();q.setStartBefore(p)}s=p.type;if(s==CKEDITOR.NODE_TEXT||o||s==CKEDITOR.NODE_ELEMENT&&!p.getChildCount()){for(var s=p,P;(i=!s.getNext(F))&&(P=s.getParent(),k[P.getName()])&&(P.getPosition(l)|J)==J&&(!g.childRule||g.childRule(P));)s=P;q.setEndAfter(s)}}else i=true;else i=true;p=p.getNextSourceNode(r||o)}if(i&&q&&!q.collapsed){for(var i=u(this,d),o=i.hasAttributes(),r=q.getCommonAncestor(),s={},A={},D={},I={},V,R,Y;i&&r;){if(r.getName()==e){for(V in g.attributes)if(!I[V]&&
(Y=r.getAttribute(R)))i.getAttribute(V)==Y?A[V]=1:I[V]=1;for(R in g.styles)if(!D[R]&&(Y=r.getStyle(R)))i.getStyle(R)==Y?s[R]=1:D[R]=1}r=r.getParent()}for(V in A)i.removeAttribute(V);for(R in s)i.removeStyle(R);o&&!i.hasAttributes()&&(i=null);if(i){q.extractContents().appendTo(i);q.insertNode(i);x.call(this,i);i.mergeSiblings();CKEDITOR.env.ie||i.$.normalize()}else{i=new CKEDITOR.dom.element("span");q.extractContents().appendTo(i);q.insertNode(i);x.call(this,i);i.remove(true)}q=null}}b.moveToBookmark(m);
b.shrink(CKEDITOR.SHRINK_TEXT);b.shrink(CKEDITOR.NODE_ELEMENT,true)}}function b(a){function b(){for(var a=new CKEDITOR.dom.elementPath(d.getParent()),c=new CKEDITOR.dom.elementPath(j.getParent()),e=null,f=null,g=0;g<a.elements.length;g++){var h=a.elements[g];if(h==a.block||h==a.blockLimit)break;k.checkElementRemovable(h)&&(e=h)}for(g=0;g<c.elements.length;g++){h=c.elements[g];if(h==c.block||h==c.blockLimit)break;k.checkElementRemovable(h)&&(f=h)}f&&j.breakParent(f);e&&d.breakParent(e)}a.enlarge(CKEDITOR.ENLARGE_INLINE,
1);var c=a.createBookmark(),d=c.startNode;if(a.collapsed){for(var e=new CKEDITOR.dom.elementPath(d.getParent(),a.root),f,g=0,h;g<e.elements.length&&(h=e.elements[g]);g++){if(h==e.block||h==e.blockLimit)break;if(this.checkElementRemovable(h)){var i;if(a.collapsed&&(a.checkBoundaryOfElement(h,CKEDITOR.END)||(i=a.checkBoundaryOfElement(h,CKEDITOR.START)))){f=h;f.match=i?"start":"end"}else{h.mergeSiblings();h.is(this.element)?s.call(this,h):q(h,l(this)[h.getName()])}}}if(f){h=d;for(g=0;;g++){i=e.elements[g];
if(i.equals(f))break;else if(i.match)continue;else i=i.clone();i.append(h);h=i}h[f.match=="start"?"insertBefore":"insertAfter"](f)}}else{var j=c.endNode,k=this;b();for(e=d;!e.equals(j);){f=e.getNextSourceNode();if(e.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(e)){e.getName()==this.element?s.call(this,e):q(e,l(this)[e.getName()]);if(f.type==CKEDITOR.NODE_ELEMENT&&f.contains(d)){b();f=d.getNext()}}e=f}}a.moveToBookmark(c);a.shrink(CKEDITOR.NODE_ELEMENT,true)}function f(a){var b=[];a.forEach(function(a){if(a.getAttribute("contenteditable")==
"true"){b.push(a);return false}},CKEDITOR.NODE_ELEMENT,true);return b}function d(a){var b=a.getEnclosedNode()||a.getCommonAncestor(false,true);(a=(new CKEDITOR.dom.elementPath(b,a.root)).contains(this.element,1))&&!a.isReadOnly()&&A(a,this)}function e(a){var b=a.getCommonAncestor(true,true);if(a=(new CKEDITOR.dom.elementPath(b,a.root)).contains(this.element,1)){var b=this._.definition,c=b.attributes;if(c)for(var d in c)a.removeAttribute(d,c[d]);if(b.styles)for(var e in b.styles)b.styles.hasOwnProperty(e)&&
a.removeStyle(e)}}function g(a){var b=a.createBookmark(true),c=a.createIterator();c.enforceRealBlocks=true;if(this._.enterMode)c.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var d,e=a.document,f;d=c.getNextParagraph();)if(!d.isReadOnly()&&(c.activeFilter?c.activeFilter.check(this):1)){f=u(this,e,d);h(d,f)}a.moveToBookmark(b)}function n(a){var b=a.createBookmark(1),c=a.createIterator();c.enforceRealBlocks=true;c.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var d,e;d=c.getNextParagraph();)if(this.checkElementRemovable(d))if(d.is("pre")){(e=
this._.enterMode==CKEDITOR.ENTER_BR?null:a.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))&&d.copyAttributes(e);h(d,e)}else s.call(this,d);a.moveToBookmark(b)}function h(a,b){var c=!b;if(c){b=a.getDocument().createElement("div");a.copyAttributes(b)}var d=b&&b.is("pre"),e=a.is("pre"),f=!d&&e;if(d&&!e){e=b;(f=a.getBogus())&&f.remove();f=a.getHtml();f=m(f,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");f=f.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");f=f.replace(/([ \t\n\r]+|&nbsp;)/g,
" ");f=f.replace(/<br\b[^>]*>/gi,"\n");if(CKEDITOR.env.ie){var g=a.getDocument().createElement("div");g.append(e);e.$.outerHTML="<pre>"+f+"</pre>";e.copyAttributes(g.getFirst());e=g.getFirst().remove()}else e.setHtml(f);b=e}else f?b=p(c?[a.getHtml()]:i(a),b):a.moveChildren(b);b.replace(a);if(d){var c=b,h;if((h=c.getPrevious(D))&&h.type==CKEDITOR.NODE_ELEMENT&&h.is("pre")){d=m(h.getHtml(),/\n$/,"")+"\n\n"+m(c.getHtml(),/^\n/,"");CKEDITOR.env.ie?c.$.outerHTML="<pre>"+d+"</pre>":c.setHtml(d);h.remove()}}else c&&
o(b)}function i(a){a.getName();var b=[];m(a.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(a,c){b.push(c)});return b}function m(a,b,c){var d="",e="",a=a.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(e=c);return""});return d+a.replace(b,c)+e}function p(a,b){var c;a.length>1&&(c=new CKEDITOR.dom.documentFragment(b.getDocument()));
for(var d=0;d<a.length;d++){var e=a[d],e=e.replace(/(\r\n|\r)/g,"\n"),e=m(e,/^[ \t]*\n/,""),e=m(e,/\n$/,""),e=m(e,/^[ \t]+|[ \t]+$/g,function(a,b){return a.length==1?"&nbsp;":b?" "+CKEDITOR.tools.repeat("&nbsp;",a.length-1):CKEDITOR.tools.repeat("&nbsp;",a.length-1)+" "}),e=e.replace(/\n/g,"<br>"),e=e.replace(/[ \t]{2,}/g,function(a){return CKEDITOR.tools.repeat("&nbsp;",a.length-1)+" "});if(c){var f=b.clone();f.setHtml(e);c.append(f)}else b.setHtml(e)}return c||b}function s(a,b){var c=this._.definition,
d=c.attributes,c=c.styles,e=l(this)[a.getName()],f=CKEDITOR.tools.isEmpty(d)&&CKEDITOR.tools.isEmpty(c),g;for(g in d)if(!((g=="class"||this._.definition.fullMatch)&&a.getAttribute(g)!=j(g,d[g]))&&!(b&&g.slice(0,5)=="data-")){f=a.hasAttribute(g);a.removeAttribute(g)}for(var h in c)if(!(this._.definition.fullMatch&&a.getStyle(h)!=j(h,c[h],true))){f=f||!!a.getStyle(h);a.removeStyle(h)}q(a,e,I[a.getName()]);f&&(this._.definition.alwaysRemoveElement?o(a,1):!CKEDITOR.dtd.$block[a.getName()]||this._.enterMode==
CKEDITOR.ENTER_BR&&!a.hasAttributes()?o(a):a.renameNode(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function x(a){for(var b=l(this),c=a.getElementsByTag(this.element),d,e=c.count();--e>=0;){d=c.getItem(e);d.isReadOnly()||s.call(this,d,true)}for(var f in b)if(f!=this.element){c=a.getElementsByTag(f);for(e=c.count()-1;e>=0;e--){d=c.getItem(e);d.isReadOnly()||q(d,b[f])}}}function q(a,b,c){if(b=b&&b.attributes)for(var d=0;d<b.length;d++){var e=b[d][0],f;if(f=a.getAttribute(e)){var g=b[d][1];(g===null||
g.test&&g.test(f)||typeof g=="string"&&f==g)&&a.removeAttribute(e)}}c||o(a)}function o(a,b){if(!a.hasAttributes()||b)if(CKEDITOR.dtd.$block[a.getName()]){var c=a.getPrevious(D),d=a.getNext(D);c&&(c.type==CKEDITOR.NODE_TEXT||!c.isBlockBoundary({br:1}))&&a.append("br",1);d&&(d.type==CKEDITOR.NODE_TEXT||!d.isBlockBoundary({br:1}))&&a.append("br");a.remove(true)}else{c=a.getFirst();d=a.getLast();a.remove(true);if(c){c.type==CKEDITOR.NODE_ELEMENT&&c.mergeSiblings();d&&(!c.equals(d)&&d.type==CKEDITOR.NODE_ELEMENT)&&
d.mergeSiblings()}}}function u(a,b,c){var d;d=a.element;d=="*"&&(d="span");d=new CKEDITOR.dom.element(d,b);c&&c.copyAttributes(d);d=A(d,a);b.getCustomData("doc_processing_style")&&d.hasAttribute("id")?d.removeAttribute("id"):b.setCustomData("doc_processing_style",1);return d}function A(a,b){var c=b._.definition,d=c.attributes,c=CKEDITOR.style.getStyleText(c);if(d)for(var e in d)a.setAttribute(e,d[e]);c&&a.setAttribute("style",c);return a}function k(a,b){for(var c in a)a[c]=a[c].replace(S,function(a,
c){return b[c]})}function l(a){if(a._.overrides)return a._.overrides;var b=a._.overrides={},c=a._.definition.overrides;if(c){CKEDITOR.tools.isArray(c)||(c=[c]);for(var d=0;d<c.length;d++){var e=c[d],f,g;if(typeof e=="string")f=e.toLowerCase();else{f=e.element?e.element.toLowerCase():a.element;g=e.attributes}e=b[f]||(b[f]={});if(g){var e=e.attributes=e.attributes||[],h;for(h in g)e.push([h.toLowerCase(),g[h]])}}}return b}function j(a,b,c){var d=new CKEDITOR.dom.element("span");d[c?"setStyle":"setAttribute"](a,
b);return d[c?"getStyle":"getAttribute"](a)}function v(a,b,c){for(var d=a.document,e=a.getRanges(),b=b?this.removeFromRange:this.applyToRange,f,g=e.createIterator();f=g.getNextRange();)b.call(this,f,c);a.selectRanges(e);d.removeCustomData("doc_processing_style")}var I={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},r=
{a:1,blockquote:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},O=/\s*(?:;\s*|$)/,S=/#\((.+?)\)/g,F=CKEDITOR.dom.walker.bookmark(0,1),D=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(a,b){if(typeof a.type=="string")return new CKEDITOR.style.customHandlers[a.type](a);var c=a.attributes;if(c&&c.style){a.styles=CKEDITOR.tools.extend({},a.styles,CKEDITOR.tools.parseCssText(c.style));delete c.style}if(b){a=CKEDITOR.tools.clone(a);k(a.attributes,
b);k(a.styles,b)}c=this.element=a.element?typeof a.element=="string"?a.element.toLowerCase():a.element:"*";this.type=a.type||(I[c]?CKEDITOR.STYLE_BLOCK:r[c]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE);if(typeof this.element=="object")this.type=CKEDITOR.STYLE_OBJECT;this._={definition:a}};CKEDITOR.style.prototype={apply:function(a){if(a instanceof CKEDITOR.dom.document)return v.call(this,a.getSelection());if(this.checkApplicable(a.elementPath(),a)){var b=this._.enterMode;if(!b)this._.enterMode=a.activeEnterMode;
v.call(this,a.getSelection(),0,a);this._.enterMode=b}},remove:function(a){if(a instanceof CKEDITOR.dom.document)return v.call(this,a.getSelection(),1);if(this.checkApplicable(a.elementPath(),a)){var b=this._.enterMode;if(!b)this._.enterMode=a.activeEnterMode;v.call(this,a.getSelection(),1,a);this._.enterMode=b}},applyToRange:function(a){this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?c:this.type==CKEDITOR.STYLE_BLOCK?g:this.type==CKEDITOR.STYLE_OBJECT?d:null;return this.applyToRange(a)},removeFromRange:function(a){this.removeFromRange=
this.type==CKEDITOR.STYLE_INLINE?b:this.type==CKEDITOR.STYLE_BLOCK?n:this.type==CKEDITOR.STYLE_OBJECT?e:null;return this.removeFromRange(a)},applyToObject:function(a){A(a,this)},checkActive:function(a,b){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,true,b);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:for(var c=a.elements,d=0,e;d<c.length;d++){e=c[d];if(!(this.type==CKEDITOR.STYLE_INLINE&&(e==a.block||e==a.blockLimit))){if(this.type==
CKEDITOR.STYLE_OBJECT){var f=e.getName();if(!(typeof this.element=="string"?f==this.element:f in this.element))continue}if(this.checkElementRemovable(e,true,b))return true}}}return false},checkApplicable:function(a,b,c){b&&b instanceof CKEDITOR.filter&&(c=b);if(c&&!c.check(this))return false;switch(this.type){case CKEDITOR.STYLE_OBJECT:return!!a.contains(this.element);case CKEDITOR.STYLE_BLOCK:return!!a.blockLimit.getDtd()[this.element]}return true},checkElementMatch:function(a,b){var c=this._.definition;
if(!a||!c.ignoreReadonly&&a.isReadOnly())return false;var d=a.getName();if(typeof this.element=="string"?d==this.element:d in this.element){if(!b&&!a.hasAttributes())return true;if(d=c._AC)c=d;else{var d={},e=0,f=c.attributes;if(f)for(var g in f){e++;d[g]=f[g]}if(g=CKEDITOR.style.getStyleText(c)){d.style||e++;d.style=g}d._length=e;c=c._AC=d}if(c._length){for(var h in c)if(h!="_length"){e=a.getAttribute(h)||"";if(h=="style")a:{d=c[h];typeof d=="string"&&(d=CKEDITOR.tools.parseCssText(d));typeof e==
"string"&&(e=CKEDITOR.tools.parseCssText(e,true));g=void 0;for(g in d)if(!(g in e&&(e[g]==d[g]||d[g]=="inherit"||e[g]=="inherit"))){d=false;break a}d=true}else d=c[h]==e;if(d){if(!b)return true}else if(b)return false}if(b)return true}else return true}return false},checkElementRemovable:function(a,b,c){if(this.checkElementMatch(a,b,c))return true;if(b=l(this)[a.getName()]){var d;if(!(b=b.attributes))return true;for(c=0;c<b.length;c++){d=b[c][0];if(d=a.getAttribute(d)){var e=b[c][1];if(e===null||typeof e==
"string"&&d==e||e.test(d))return true}}}return false},buildPreview:function(a){var b=this._.definition,c=[],d=b.element;d=="bdo"&&(d="span");var c=["<",d],e=b.attributes;if(e)for(var f in e)c.push(" ",f,'="',e[f],'"');(e=CKEDITOR.style.getStyleText(b))&&c.push(' style="',e,'"');c.push(">",a||b.name,"</",d,">");return c.join("")},getDefinition:function(){return this._.definition}};CKEDITOR.style.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",
d="";c.length&&(c=c.replace(O,";"));for(var e in b){var f=b[e],g=(e+":"+f).replace(O,";");f=="inherit"?d=d+g:c=c+g}c.length&&(c=CKEDITOR.tools.normalizeCssText(c,true));return a._ST=c+d};CKEDITOR.style.customHandlers={};CKEDITOR.style.addCustomHandler=function(a){var b=function(a){this._={definition:a};this.setup&&this.setup(a)};b.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.style.prototype),{assignedTo:CKEDITOR.STYLE_OBJECT},a,true);return this.customHandlers[a.type]=b};
var L=CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED,J=CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED})();CKEDITOR.styleCommand=function(a,c){this.requiredContent=this.allowedContent=this.style=a;CKEDITOR.tools.extend(this,c,true)};CKEDITOR.styleCommand.prototype.exec=function(a){a.focus();this.state==CKEDITOR.TRISTATE_OFF?a.applyStyle(this.style):this.state==CKEDITOR.TRISTATE_ON&&a.removeStyle(this.style)};
CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet");CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet);CKEDITOR.loadStylesSet=function(a,c,b){CKEDITOR.stylesSet.addExternal(a,c,"");CKEDITOR.stylesSet.load(a,b)};
CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{attachStyleStateChange:function(a,c){var b=this._.styleStateChangeCallbacks;if(!b){b=this._.styleStateChangeCallbacks=[];this.on("selectionChange",function(a){for(var c=0;c<b.length;c++){var e=b[c],g=e.style.checkActive(a.data.path,this)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;e.fn.call(this,g)}})}b.push({style:a,fn:c})},applyStyle:function(a){a.apply(this)},removeStyle:function(a){a.remove(this)},getStylesSet:function(a){if(this._.stylesDefinitions)a(this._.stylesDefinitions);
else{var c=this,b=c.config.stylesCombo_stylesSet||c.config.stylesSet;if(b===false)a(null);else if(b instanceof Array){c._.stylesDefinitions=b;a(b)}else{b||(b="default");var b=b.split(":"),f=b[0];CKEDITOR.stylesSet.addExternal(f,b[1]?b.slice(1).join(":"):CKEDITOR.getUrl("styles.js"),"");CKEDITOR.stylesSet.load(f,function(b){c._.stylesDefinitions=b[f];a(c._.stylesDefinitions)})}}}});
CKEDITOR.dom.comment=function(a,c){typeof a=="string"&&(a=(c?c.$:document).createComment(a));CKEDITOR.dom.domObject.call(this,a)};CKEDITOR.dom.comment.prototype=new CKEDITOR.dom.node;CKEDITOR.tools.extend(CKEDITOR.dom.comment.prototype,{type:CKEDITOR.NODE_COMMENT,getOuterHtml:function(){return"<\!--"+this.$.nodeValue+"--\>"}});"use strict";
(function(){var a={},c={},b;for(b in CKEDITOR.dtd.$blockLimit)b in CKEDITOR.dtd.$list||(a[b]=1);for(b in CKEDITOR.dtd.$block)b in CKEDITOR.dtd.$blockLimit||b in CKEDITOR.dtd.$empty||(c[b]=1);CKEDITOR.dom.elementPath=function(b,d){var e=null,g=null,n=[],h=b,i,d=d||b.getDocument().getBody();do if(h.type==CKEDITOR.NODE_ELEMENT){n.push(h);if(!this.lastElement){this.lastElement=h;if(h.is(CKEDITOR.dtd.$object)||h.getAttribute("contenteditable")=="false")continue}if(h.equals(d))break;if(!g){i=h.getName();
h.getAttribute("contenteditable")=="true"?g=h:!e&&c[i]&&(e=h);if(a[i]){var m;if(m=!e){if(i=i=="div"){a:{i=h.getChildren();m=0;for(var p=i.count();m<p;m++){var s=i.getItem(m);if(s.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$block[s.getName()]){i=true;break a}}i=false}i=!i}m=i}m?e=h:g=h}}}while(h=h.getParent());g||(g=d);this.block=e;this.blockLimit=g;this.root=d;this.elements=n}})();
CKEDITOR.dom.elementPath.prototype={compare:function(a){var c=this.elements,a=a&&a.elements;if(!a||c.length!=a.length)return false;for(var b=0;b<c.length;b++)if(!c[b].equals(a[b]))return false;return true},contains:function(a,c,b){var f;typeof a=="string"&&(f=function(b){return b.getName()==a});a instanceof CKEDITOR.dom.element?f=function(b){return b.equals(a)}:CKEDITOR.tools.isArray(a)?f=function(b){return CKEDITOR.tools.indexOf(a,b.getName())>-1}:typeof a=="function"?f=a:typeof a=="object"&&(f=
function(b){return b.getName()in a});var d=this.elements,e=d.length;c&&e--;if(b){d=Array.prototype.slice.call(d,0);d.reverse()}for(c=0;c<e;c++)if(f(d[c]))return d[c];return null},isContextFor:function(a){var c;if(a in CKEDITOR.dtd.$block){c=this.contains(CKEDITOR.dtd.$intermediate)||this.root.equals(this.block)&&this.block||this.blockLimit;return!!c.getDtd()[a]}return true},direction:function(){return(this.block||this.blockLimit||this.root).getDirection(1)}};
CKEDITOR.dom.text=function(a,c){typeof a=="string"&&(a=(c?c.$:document).createTextNode(a));this.$=a};CKEDITOR.dom.text.prototype=new CKEDITOR.dom.node;
CKEDITOR.tools.extend(CKEDITOR.dom.text.prototype,{type:CKEDITOR.NODE_TEXT,getLength:function(){return this.$.nodeValue.length},getText:function(){return this.$.nodeValue},setText:function(a){this.$.nodeValue=a},split:function(a){var c=this.$.parentNode,b=c.childNodes.length,f=this.getLength(),d=this.getDocument(),e=new CKEDITOR.dom.text(this.$.splitText(a),d);if(c.childNodes.length==b)if(a>=f){e=d.createText("");e.insertAfter(this)}else{a=d.createText("");a.insertAfter(e);a.remove()}return e},substring:function(a,
c){return typeof c!="number"?this.$.nodeValue.substr(a):this.$.nodeValue.substring(a,c)}});
(function(){function a(a,c,d){var e=a.serializable,g=c[d?"endContainer":"startContainer"],n=d?"endOffset":"startOffset",h=e?c.document.getById(a.startNode):a.startNode,a=e?c.document.getById(a.endNode):a.endNode;if(g.equals(h.getPrevious())){c.startOffset=c.startOffset-g.getLength()-a.getPrevious().getLength();g=a.getNext()}else if(g.equals(a.getPrevious())){c.startOffset=c.startOffset-g.getLength();g=a.getNext()}g.equals(h.getParent())&&c[n]++;g.equals(a.getParent())&&c[n]++;c[d?"endContainer":"startContainer"]=
g;return c}CKEDITOR.dom.rangeList=function(a){if(a instanceof CKEDITOR.dom.rangeList)return a;a?a instanceof CKEDITOR.dom.range&&(a=[a]):a=[];return CKEDITOR.tools.extend(a,c)};var c={createIterator:function(){var a=this,c=CKEDITOR.dom.walker.bookmark(),d=[],e;return{getNextRange:function(g){e=e==void 0?0:e+1;var n=a[e];if(n&&a.length>1){if(!e)for(var h=a.length-1;h>=0;h--)d.unshift(a[h].createBookmark(true));if(g)for(var i=0;a[e+i+1];){for(var m=n.document,g=0,h=m.getById(d[i].endNode),m=m.getById(d[i+
1].startNode);;){h=h.getNextSourceNode(false);if(m.equals(h))g=1;else if(c(h)||h.type==CKEDITOR.NODE_ELEMENT&&h.isBlockBoundary())continue;break}if(!g)break;i++}for(n.moveToBookmark(d.shift());i--;){h=a[++e];h.moveToBookmark(d.shift());n.setEnd(h.endContainer,h.endOffset)}}return n}}},createBookmarks:function(b){for(var c=[],d,e=0;e<this.length;e++){c.push(d=this[e].createBookmark(b,true));for(var g=e+1;g<this.length;g++){this[g]=a(d,this[g]);this[g]=a(d,this[g],true)}}return c},createBookmarks2:function(a){for(var c=
[],d=0;d<this.length;d++)c.push(this[d].createBookmark2(a));return c},moveToBookmarks:function(a){for(var c=0;c<this.length;c++)this[c].moveToBookmark(a[c])}}})();
(function(){function a(){return CKEDITOR.getUrl(CKEDITOR.skinName.split(",")[1]||"skins/"+CKEDITOR.skinName.split(",")[0]+"/")}function c(b){var c=CKEDITOR.skin["ua_"+b],d=CKEDITOR.env;if(c)for(var c=c.split(",").sort(function(a,b){return a>b?-1:1}),e=0,f;e<c.length;e++){f=c[e];if(d.ie&&(f.replace(/^ie/,"")==d.version||d.quirks&&f=="iequirks"))f="ie";if(d[f]){b=b+("_"+c[e]);break}}return CKEDITOR.getUrl(a()+b+".css")}function b(a,b){if(!e[a]){CKEDITOR.document.appendStyleSheet(c(a));e[a]=1}b&&b()}
function f(a){var b=a.getById(g);if(!b){b=a.getHead().append("style");b.setAttribute("id",g);b.setAttribute("type","text/css")}return b}function d(a,b,c){var d,e,f;if(CKEDITOR.env.webkit){b=b.split("}").slice(0,-1);for(e=0;e<b.length;e++)b[e]=b[e].split("{")}for(var g=0;g<a.length;g++)if(CKEDITOR.env.webkit)for(e=0;e<b.length;e++){f=b[e][1];for(d=0;d<c.length;d++)f=f.replace(c[d][0],c[d][1]);a[g].$.sheet.addRule(b[e][0],f)}else{f=b;for(d=0;d<c.length;d++)f=f.replace(c[d][0],c[d][1]);CKEDITOR.env.ie&&
CKEDITOR.env.version<11?a[g].$.styleSheet.cssText=a[g].$.styleSheet.cssText+f:a[g].$.innerHTML=a[g].$.innerHTML+f}}var e={};CKEDITOR.skin={path:a,loadPart:function(c,d){CKEDITOR.skin.name!=CKEDITOR.skinName.split(",")[0]?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(a()+"skin.js"),function(){b(c,d)}):b(c,d)},getPath:function(a){return CKEDITOR.getUrl(c(a))},icons:{},addIcon:function(a,b,c,d){a=a.toLowerCase();this.icons[a]||(this.icons[a]={path:b,offset:c||0,bgsize:d||"16px"})},getIconStyle:function(a,
b,c,d,e){var f;if(a){a=a.toLowerCase();b&&(f=this.icons[a+"-rtl"]);f||(f=this.icons[a])}a=c||f&&f.path||"";d=d||f&&f.offset;e=e||f&&f.bgsize||"16px";return a&&"background-image:url("+CKEDITOR.getUrl(a)+");background-position:0 "+d+"px;background-size:"+e+";"}};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{getUiColor:function(){return this.uiColor},setUiColor:function(a){var b=f(CKEDITOR.document);return(this.setUiColor=function(a){var c=CKEDITOR.skin.chameleon,e=[[h,a]];this.uiColor=a;d([b],c(this,
"editor"),e);d(n,c(this,"panel"),e)}).call(this,a)}});var g="cke_ui_color",n=[],h=/\$color/g;CKEDITOR.on("instanceLoaded",function(a){if(!CKEDITOR.env.ie||!CKEDITOR.env.quirks){var b=a.editor,a=function(a){a=(a.data[0]||a.data).element.getElementsByTag("iframe").getItem(0).getFrameDocument();if(!a.getById("cke_ui_color")){a=f(a);n.push(a);var c=b.getUiColor();c&&d([a],CKEDITOR.skin.chameleon(b,"panel"),[[h,c]])}};b.on("panelShow",a);b.on("menuShow",a);b.config.uiColor&&b.setUiColor(b.config.uiColor)}})})();
(function(){if(CKEDITOR.env.webkit)CKEDITOR.env.hc=false;else{var a=CKEDITOR.dom.element.createFromHtml('<div style="width:0;height:0;position:absolute;left:-10000px;border:1px solid;border-color:red blue"></div>',CKEDITOR.document);a.appendTo(CKEDITOR.document.getHead());try{var c=a.getComputedStyle("border-top-color"),b=a.getComputedStyle("border-right-color");CKEDITOR.env.hc=!!(c&&c==b)}catch(f){CKEDITOR.env.hc=false}a.remove()}if(CKEDITOR.env.hc)CKEDITOR.env.cssClass=CKEDITOR.env.cssClass+" cke_hc";
CKEDITOR.document.appendStyleText(".cke{visibility:hidden;}");CKEDITOR.status="loaded";CKEDITOR.fireOnce("loaded");if(a=CKEDITOR._.pending){delete CKEDITOR._.pending;for(c=0;c<a.length;c++){CKEDITOR.editor.prototype.constructor.apply(a[c][0],a[c][1]);CKEDITOR.add(a[c][0])}}})();
CKEDITOR.skin.name="moono";CKEDITOR.skin.ua_editor="ie,iequirks,ie7,ie8,gecko";CKEDITOR.skin.ua_dialog="ie,iequirks,ie7,ie8";
CKEDITOR.skin.chameleon=function(){var b=function(){return function(b,e){for(var a=b.match(/[^#]./g),c=0;3>c;c++){var f=a,h=c,d;d=parseInt(a[c],16);d=("0"+(0>e?0|d*(1+e):0|d+(255-d)*e).toString(16)).slice(-2);f[h]=d}return"#"+a.join("")}}(),c=function(){var b=new CKEDITOR.template("background:#{to};background-image:-webkit-gradient(linear,lefttop,leftbottom,from({from}),to({to}));background-image:-moz-linear-gradient(top,{from},{to});background-image:-webkit-linear-gradient(top,{from},{to});background-image:-o-linear-gradient(top,{from},{to});background-image:-ms-linear-gradient(top,{from},{to});background-image:linear-gradient(top,{from},{to});filter:progid:DXImageTransform.Microsoft.gradient(gradientType=0,startColorstr='{from}',endColorstr='{to}');");return function(c,
a){return b.output({from:c,to:a})}}(),f={editor:new CKEDITOR.template("{id}.cke_chrome [border-color:{defaultBorder};] {id} .cke_top [ {defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_bottom [{defaultGradient}border-top-color:{defaultBorder};] {id} .cke_resizer [border-right-color:{ckeResizer}] {id} .cke_dialog_title [{defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_dialog_footer [{defaultGradient}outline-color:{defaultBorder};border-top-color:{defaultBorder};] {id} .cke_dialog_tab [{lightGradient}border-color:{defaultBorder};] {id} .cke_dialog_tab:hover [{mediumGradient}] {id} .cke_dialog_contents [border-top-color:{defaultBorder};] {id} .cke_dialog_tab_selected, {id} .cke_dialog_tab_selected:hover [background:{dialogTabSelected};border-bottom-color:{dialogTabSelectedBorder};] {id} .cke_dialog_body [background:{dialogBody};border-color:{defaultBorder};] {id} .cke_toolgroup [{lightGradient}border-color:{defaultBorder};] {id} a.cke_button_off:hover, {id} a.cke_button_off:focus, {id} a.cke_button_off:active [{mediumGradient}] {id} .cke_button_on [{ckeButtonOn}] {id} .cke_toolbar_separator [background-color: {ckeToolbarSeparator};] {id} .cke_combo_button [border-color:{defaultBorder};{lightGradient}] {id} a.cke_combo_button:hover, {id} a.cke_combo_button:focus, {id} .cke_combo_on a.cke_combo_button [border-color:{defaultBorder};{mediumGradient}] {id} .cke_path_item [color:{elementsPathColor};] {id} a.cke_path_item:hover, {id} a.cke_path_item:focus, {id} a.cke_path_item:active [background-color:{elementsPathBg};] {id}.cke_panel [border-color:{defaultBorder};] "),
panel:new CKEDITOR.template(".cke_panel_grouptitle [{lightGradient}border-color:{defaultBorder};] .cke_menubutton_icon [background-color:{menubuttonIcon};] .cke_menubutton:hover .cke_menubutton_icon, .cke_menubutton:focus .cke_menubutton_icon, .cke_menubutton:active .cke_menubutton_icon [background-color:{menubuttonIconHover};] .cke_menuseparator [background-color:{menubuttonIcon};] a:hover.cke_colorbox, a:focus.cke_colorbox, a:active.cke_colorbox [border-color:{defaultBorder};] a:hover.cke_colorauto, a:hover.cke_colormore, a:focus.cke_colorauto, a:focus.cke_colormore, a:active.cke_colorauto, a:active.cke_colormore [background-color:{ckeColorauto};border-color:{defaultBorder};] ")};
return function(g,e){var a=g.uiColor,a={id:"."+g.id,defaultBorder:b(a,-0.1),defaultGradient:c(b(a,0.9),a),lightGradient:c(b(a,1),b(a,0.7)),mediumGradient:c(b(a,0.8),b(a,0.5)),ckeButtonOn:c(b(a,0.6),b(a,0.7)),ckeResizer:b(a,-0.4),ckeToolbarSeparator:b(a,0.5),ckeColorauto:b(a,0.8),dialogBody:b(a,0.7),dialogTabSelected:c("#FFFFFF","#FFFFFF"),dialogTabSelectedBorder:"#FFF",elementsPathColor:b(a,-0.6),elementsPathBg:a,menubuttonIcon:b(a,0.5),menubuttonIconHover:b(a,0.3)};return f[e].output(a).replace(/\[/g,
"{").replace(/\]/g,"}")}}();CKEDITOR.plugins.add("dialogui",{onLoad:function(){var h=function(b){this._||(this._={});this._["default"]=this._.initValue=b["default"]||"";this._.required=b.required||!1;for(var a=[this._],d=1;d<arguments.length;d++)a.push(arguments[d]);a.push(!0);CKEDITOR.tools.extend.apply(CKEDITOR.tools,a);return this._},r={build:function(b,a,d){return new CKEDITOR.ui.dialog.textInput(b,a,d)}},l={build:function(b,a,d){return new CKEDITOR.ui.dialog[a.type](b,a,d)}},n={isChanged:function(){return this.getValue()!=
this.getInitValue()},reset:function(b){this.setValue(this.getInitValue(),b)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._["default"]},getInitValue:function(){return this._.initValue}},o=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(b,a){this._.domOnChangeRegistered||(b.on("load",function(){this.getInputElement().on("change",function(){b.parts.dialog.isVisible()&&this.fire("change",{value:this.getValue()})},
this)},this),this._.domOnChangeRegistered=!0);this.on("change",a)}},!0),s=/^on([A-Z]\w+)/,p=function(b){for(var a in b)(s.test(a)||"title"==a||"type"==a)&&delete b[a];return b};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(b,a,d,f){if(!(4>arguments.length)){var c=h.call(this,a);c.labelId=CKEDITOR.tools.getNextId()+"_label";this._.children=[];var e={role:a.role||"presentation"};a.includeLabel&&(e["aria-labelledby"]=c.labelId);CKEDITOR.ui.dialog.uiElement.call(this,b,a,d,"div",null,
e,function(){var e=[],g=a.required?" cke_required":"";if(a.labelLayout!="horizontal")e.push('<label class="cke_dialog_ui_labeled_label'+g+'" ',' id="'+c.labelId+'"',c.inputId?' for="'+c.inputId+'"':"",(a.labelStyle?' style="'+a.labelStyle+'"':"")+">",a.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',a.controlStyle?' style="'+a.controlStyle+'"':"",' role="presentation">',f.call(this,b,a),"</div>");else{g={type:"hbox",widths:a.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+
g+'" id="'+c.labelId+'" for="'+c.inputId+'"'+(a.labelStyle?' style="'+a.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(a.label)+"</span>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(a.controlStyle?' style="'+a.controlStyle+'"':"")+">"+f.call(this,b,a)+"</span>"}]};CKEDITOR.dialog._.uiElementBuilders.hbox.build(b,g,e)}return e.join("")})}},textInput:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);var f=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",c={"class":"cke_dialog_ui_input_"+
a.type,id:f,type:a.type};a.validate&&(this.validate=a.validate);a.maxLength&&(c.maxlength=a.maxLength);a.size&&(c.size=a.size);a.inputStyle&&(c.style=a.inputStyle);var e=this,k=!1;b.on("load",function(){e.getInputElement().on("keydown",function(a){a.data.getKeystroke()==13&&(k=true)});e.getInputElement().on("keyup",function(a){if(a.data.getKeystroke()==13&&k){b.getButton("ok")&&setTimeout(function(){b.getButton("ok").click()},0);k=false}},null,null,1E3)});CKEDITOR.ui.dialog.labeledElement.call(this,
b,a,d,function(){var b=['<div class="cke_dialog_ui_input_',a.type,'" role="presentation"'];a.width&&b.push('style="width:'+a.width+'" ');b.push("><input ");c["aria-labelledby"]=this._.labelId;this._.required&&(c["aria-required"]=this._.required);for(var e in c)b.push(e+'="'+c[e]+'" ');b.push(" /></div>");return b.join("")})}},textarea:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);var f=this,c=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",e={};a.validate&&(this.validate=a.validate);
e.rows=a.rows||5;e.cols=a.cols||20;e["class"]="cke_dialog_ui_input_textarea "+(a["class"]||"");"undefined"!=typeof a.inputStyle&&(e.style=a.inputStyle);a.dir&&(e.dir=a.dir);CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){e["aria-labelledby"]=this._.labelId;this._.required&&(e["aria-required"]=this._.required);var a=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',c,'" '],b;for(b in e)a.push(b+'="'+CKEDITOR.tools.htmlEncode(e[b])+'" ');a.push(">",CKEDITOR.tools.htmlEncode(f._["default"]),
"</textarea></div>");return a.join("")})}},checkbox:function(b,a,d){if(!(3>arguments.length)){var f=h.call(this,a,{"default":!!a["default"]});a.validate&&(this.validate=a.validate);CKEDITOR.ui.dialog.uiElement.call(this,b,a,d,"span",null,null,function(){var c=CKEDITOR.tools.extend({},a,{id:a.id?a.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},true),e=[],d=CKEDITOR.tools.getNextId()+"_label",g={"class":"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":d};p(c);if(a["default"])g.checked=
"checked";if(typeof c.inputStyle!="undefined")c.style=c.inputStyle;f.checkbox=new CKEDITOR.ui.dialog.uiElement(b,c,e,"input",null,g);e.push(' <label id="',d,'" for="',g.id,'"'+(a.labelStyle?' style="'+a.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(a.label),"</label>");return e.join("")})}},radio:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);this._["default"]||(this._["default"]=this._.initValue=a.items[0][1]);a.validate&&(this.validate=a.valdiate);var f=[],c=this;a.role="radiogroup";
a.includeLabel=!0;CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){for(var e=[],d=[],g=(a.id?a.id:CKEDITOR.tools.getNextId())+"_radio",i=0;i<a.items.length;i++){var j=a.items[i],h=j[2]!==void 0?j[2]:j[0],l=j[1]!==void 0?j[1]:j[0],m=CKEDITOR.tools.getNextId()+"_radio_input",n=m+"_label",m=CKEDITOR.tools.extend({},a,{id:m,title:null,type:null},true),h=CKEDITOR.tools.extend({},m,{title:h},true),o={type:"radio","class":"cke_dialog_ui_radio_input",name:g,value:l,"aria-labelledby":n},q=[];if(c._["default"]==
l)o.checked="checked";p(m);p(h);if(typeof m.inputStyle!="undefined")m.style=m.inputStyle;m.keyboardFocusable=true;f.push(new CKEDITOR.ui.dialog.uiElement(b,m,q,"input",null,o));q.push(" ");new CKEDITOR.ui.dialog.uiElement(b,h,q,"label",null,{id:n,"for":o.id},j[0]);e.push(q.join(""))}new CKEDITOR.ui.dialog.hbox(b,f,e,d);return d.join("")});this._.children=f}},button:function(b,a,d){if(arguments.length){"function"==typeof a&&(a=a(b.getParentEditor()));h.call(this,a,{disabled:a.disabled||!1});CKEDITOR.event.implementOn(this);
var f=this;b.on("load",function(){var a=this.getElement();(function(){a.on("click",function(a){f.click();a.data.preventDefault()});a.on("keydown",function(a){a.data.getKeystroke()in{32:1}&&(f.click(),a.data.preventDefault())})})();a.unselectable()},this);var c=CKEDITOR.tools.extend({},a);delete c.style;var e=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,b,c,d,"a",null,{style:a.style,href:"javascript:void(0)",title:a.label,hidefocus:"true","class":a["class"],role:"button",
"aria-labelledby":e},'<span id="'+e+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(a.label)+"</span>")}},select:function(b,a,d){if(!(3>arguments.length)){var f=h.call(this,a);a.validate&&(this.validate=a.validate);f.inputId=CKEDITOR.tools.getNextId()+"_select";CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){var c=CKEDITOR.tools.extend({},a,{id:a.id?a.id+"_select":CKEDITOR.tools.getNextId()+"_select"},true),e=[],d=[],g={id:f.inputId,"class":"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};
e.push('<div class="cke_dialog_ui_input_',a.type,'" role="presentation"');a.width&&e.push('style="width:'+a.width+'" ');e.push(">");if(a.size!=void 0)g.size=a.size;if(a.multiple!=void 0)g.multiple=a.multiple;p(c);for(var i=0,j;i<a.items.length&&(j=a.items[i]);i++)d.push('<option value="',CKEDITOR.tools.htmlEncode(j[1]!==void 0?j[1]:j[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(j[0]));if(typeof c.inputStyle!="undefined")c.style=c.inputStyle;f.select=new CKEDITOR.ui.dialog.uiElement(b,
c,e,"select",null,g,d.join(""));e.push("</div>");return e.join("")})}},file:function(b,a,d){if(!(3>arguments.length)){void 0===a["default"]&&(a["default"]="");var f=CKEDITOR.tools.extend(h.call(this,a),{definition:a,buttons:[]});a.validate&&(this.validate=a.validate);b.on("load",function(){CKEDITOR.document.getById(f.frameId).getParent().addClass("cke_dialog_ui_input_file")});CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){f.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var b=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',
f.frameId,'" title="',a.label,'" src="javascript:void('];b.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})()":"0");b.push(')"></iframe>');return b.join("")})}},fileButton:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);var f=this;a.validate&&(this.validate=a.validate);var c=CKEDITOR.tools.extend({},a),e=c.onClick;c.className=(c.className?c.className+" ":"")+"cke_dialog_ui_button";c.onClick=function(c){var d=
a["for"];if(!e||e.call(this,c)!==false){b.getContentElement(d[0],d[1]).submit();this.disable()}};b.on("load",function(){b.getContentElement(a["for"][0],a["for"][1])._.buttons.push(f)});CKEDITOR.ui.dialog.button.call(this,b,c,d)}},html:function(){var b=/^\s*<[\w:]+\s+([^>]*)?>/,a=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,d=/\/$/;return function(f,c,e){if(!(3>arguments.length)){var k=[],g=c.html;"<"!=g.charAt(0)&&(g="<span>"+g+"</span>");var i=c.focus;if(i){var j=this.focus;this.focus=function(){("function"==
typeof i?i:j).call(this);this.fire("focus")};c.isFocusable&&(this.isFocusable=this.isFocusable);this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,f,c,k,"span",null,null,"");k=k.join("").match(b);g=g.match(a)||["","",""];d.test(g[1])&&(g[1]=g[1].slice(0,-1),g[2]="/"+g[2]);e.push([g[1]," ",k[1]||"",g[2]].join(""))}}}(),fieldset:function(b,a,d,f,c){var e=c.label;this._={children:a};CKEDITOR.ui.dialog.uiElement.call(this,b,c,f,"fieldset",null,null,function(){var a=[];e&&a.push("<legend"+
(c.labelStyle?' style="'+c.labelStyle+'"':"")+">"+e+"</legend>");for(var b=0;b<d.length;b++)a.push(d[b]);return a.join("")})}},!0);CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement;CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(b){var a=CKEDITOR.document.getById(this._.labelId);1>a.getChildCount()?(new CKEDITOR.dom.text(b,CKEDITOR.document)).appendTo(a):a.getChild(0).$.nodeValue=b;return this},getLabel:function(){var b=
CKEDITOR.document.getById(this._.labelId);return!b||1>b.getChildCount()?"":b.getChild(0).getText()},eventProcessors:o},!0);CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return!this._.disabled?this.fire("click",{dialog:this._.dialog}):!1},enable:function(){this._.disabled=!1;var b=this.getElement();b&&b.removeClass("cke_disabled")},disable:function(){this._.disabled=!0;this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},
isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(b,a){this.on("click",function(){a.apply(this,arguments)})}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0);CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},
focus:function(){var b=this.selectParentTab();setTimeout(function(){var a=b.getInputElement();a&&a.$.focus()},0)},select:function(){var b=this.selectParentTab();setTimeout(function(){var a=b.getInputElement();a&&(a.$.focus(),a.$.select())},0)},accessKeyUp:function(){this.select()},setValue:function(b){!b&&(b="");return CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},keyboardFocusable:!0},n,!0);CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput;CKEDITOR.ui.dialog.select.prototype=
CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(b,a,d){var f=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),c=this.getInputElement().$;f.$.text=b;f.$.value=void 0===a||null===a?b:a;void 0===d||null===d?CKEDITOR.env.ie?c.add(f.$):c.add(f.$,null):c.add(f.$,d);return this},remove:function(b){this.getInputElement().$.remove(b);return this},clear:function(){for(var b=this.getInputElement().$;0<
b.length;)b.remove(0);return this},keyboardFocusable:!0},n,!0);CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(b,a){this.getInputElement().$.checked=b;!a&&this.fire("change",{value:b})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(b,a){if(!CKEDITOR.env.ie||8<CKEDITOR.env.version)return o.onChange.apply(this,
arguments);b.on("load",function(){var a=this._.checkbox.getElement();a.on("propertychange",function(b){b=b.data.$;"checked"==b.propertyName&&this.fire("change",{value:a.$.checked})},this)},this);this.on("change",a);return null}},keyboardFocusable:!0},n,!0);CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(b,a){for(var d=this._.children,f,c=0;c<d.length&&(f=d[c]);c++)f.getElement().$.checked=f.getValue()==b;!a&&this.fire("change",{value:b})},
getValue:function(){for(var b=this._.children,a=0;a<b.length;a++)if(b[a].getElement().$.checked)return b[a].getValue();return null},accessKeyUp:function(){var b=this._.children,a;for(a=0;a<b.length;a++)if(b[a].getElement().$.checked){b[a].getElement().focus();return}b[0].getElement().focus()},eventProcessors:{onChange:function(b,a){if(CKEDITOR.env.ie)b.on("load",function(){for(var a=this._.children,b=this,c=0;c<a.length;c++)a[c].getElement().on("propertychange",function(a){a=a.data.$;"checked"==a.propertyName&&
this.$.checked&&b.fire("change",{value:this.getAttribute("value")})})},this),this.on("change",a);else return o.onChange.apply(this,arguments);return null}}},n,!0);CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,n,{getInputElement:function(){var b=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return 0<b.$.forms.length?new CKEDITOR.dom.element(b.$.forms[0].elements[0]):this.getElement()},submit:function(){this.getInputElement().getParent().$.submit();
return this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(b){var a=/^on([A-Z]\w+)/,d,f=function(a,b,c,d){a.on("formLoaded",function(){a.getInputElement().on(c,d,a)})},c;for(c in b)if(d=c.match(a))this.eventProcessors[c]?this.eventProcessors[c].call(this,this._.dialog,b[c]):f(this,this._.dialog,d[1].toLowerCase(),b[c]);return this},reset:function(){function b(){d.$.open();var b="";f.size&&(b=f.size-(CKEDITOR.env.ie?7:0));var h=a.frameId+"_input";
d.$.write(['<html dir="'+g+'" lang="'+i+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+g+'" lang="'+i+'" action="',CKEDITOR.tools.htmlEncode(f.action),'"><label id="',a.labelId,'" for="',h,'" style="display:none">',CKEDITOR.tools.htmlEncode(f.label),'</label><input style="width:100%" id="',h,'" aria-labelledby="',a.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(f.id||"cke_upload"),
'" size="',CKEDITOR.tools.htmlEncode(0<b?b:""),'" /></form></body></html><script>',CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+e+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+k+")}","<\/script>"].join(""));d.$.close();for(b=0;b<c.length;b++)c[b].enable()}var a=this._,d=CKEDITOR.document.getById(a.frameId).getFrameDocument(),f=a.definition,c=a.buttons,e=this.formLoadedNumber,k=this.formUnloadNumber,g=a.dialog._.editor.lang.dir,
i=a.dialog._.editor.langCode;e||(e=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this),k=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this),this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(e);CKEDITOR.tools.removeFunction(k)}));CKEDITOR.env.gecko?setTimeout(b,500):b()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=
""},eventProcessors:{onChange:function(b,a){this._.domOnChangeRegistered||(this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0);this.on("change",a)}},keyboardFocusable:!0},!0);CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button;CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype);CKEDITOR.dialog.addUIElement("text",r);CKEDITOR.dialog.addUIElement("password",
r);CKEDITOR.dialog.addUIElement("textarea",l);CKEDITOR.dialog.addUIElement("checkbox",l);CKEDITOR.dialog.addUIElement("radio",l);CKEDITOR.dialog.addUIElement("button",l);CKEDITOR.dialog.addUIElement("select",l);CKEDITOR.dialog.addUIElement("file",l);CKEDITOR.dialog.addUIElement("fileButton",l);CKEDITOR.dialog.addUIElement("html",l);CKEDITOR.dialog.addUIElement("fieldset",{build:function(b,a,d){for(var f=a.children,c,e=[],h=[],g=0;g<f.length&&(c=f[g]);g++){var i=[];e.push(i);h.push(CKEDITOR.dialog._.uiElementBuilders[c.type].build(b,
c,i))}return new CKEDITOR.ui.dialog[a.type](b,h,e,d,a)}})}});CKEDITOR.DIALOG_RESIZE_NONE=0;CKEDITOR.DIALOG_RESIZE_WIDTH=1;CKEDITOR.DIALOG_RESIZE_HEIGHT=2;CKEDITOR.DIALOG_RESIZE_BOTH=3;
(function(){function t(){for(var a=this._.tabIdList.length,b=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId)+a,c=b-1;c>b-a;c--)if(this._.tabs[this._.tabIdList[c%a]][0].$.offsetHeight)return this._.tabIdList[c%a];return null}function u(){for(var a=this._.tabIdList.length,b=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId),c=b+1;c<b+a;c++)if(this._.tabs[this._.tabIdList[c%a]][0].$.offsetHeight)return this._.tabIdList[c%a];return null}function G(a,b){for(var c=a.$.getElementsByTagName("input"),
e=0,d=c.length;e<d;e++){var g=new CKEDITOR.dom.element(c[e]);"text"==g.getAttribute("type").toLowerCase()&&(b?(g.setAttribute("value",g.getCustomData("fake_value")||""),g.removeCustomData("fake_value")):(g.setCustomData("fake_value",g.getAttribute("value")),g.setAttribute("value","")))}}function P(a,b){var c=this.getInputElement();c&&(a?c.removeAttribute("aria-invalid"):c.setAttribute("aria-invalid",!0));a||(this.select?this.select():this.focus());b&&alert(b);this.fire("validated",{valid:a,msg:b})}
function Q(){var a=this.getInputElement();a&&a.removeAttribute("aria-invalid")}function R(a){var a=CKEDITOR.dom.element.createFromHtml(CKEDITOR.addTemplate("dialog",S).output({id:CKEDITOR.tools.getNextNumber(),editorId:a.id,langDir:a.lang.dir,langCode:a.langCode,editorDialogClass:"cke_editor_"+a.name.replace(/\./g,"\\.")+"_dialog",closeTitle:a.lang.common.close,hidpi:CKEDITOR.env.hidpi?"cke_hidpi":""})),b=a.getChild([0,0,0,0,0]),c=b.getChild(0),e=b.getChild(1);if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var d=
"javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())";CKEDITOR.dom.element.createFromHtml('<iframe frameBorder="0" class="cke_iframe_shim" src="'+d+'" tabIndex="-1"></iframe>').appendTo(b.getParent())}c.unselectable();e.unselectable();return{element:a,parts:{dialog:a.getChild(0),title:c,close:e,tabs:b.getChild(2),contents:b.getChild([3,0,0,0]),footer:b.getChild([3,0,1,0])}}}function H(a,b,c){this.element=b;this.focusIndex=c;this.tabIndex=
0;this.isFocusable=function(){return!b.getAttribute("disabled")&&b.isVisible()};this.focus=function(){a._.currentFocusIndex=this.focusIndex;this.element.focus()};b.on("keydown",function(a){a.data.getKeystroke()in{32:1,13:1}&&this.fire("click")});b.on("focus",function(){this.fire("mouseover")});b.on("blur",function(){this.fire("mouseout")})}function T(a){function b(){a.layout()}var c=CKEDITOR.document.getWindow();c.on("resize",b);a.on("hide",function(){c.removeListener("resize",b)})}function I(a,b){this._=
{dialog:a};CKEDITOR.tools.extend(this,b)}function U(a){function b(b){var c=a.getSize(),i=CKEDITOR.document.getWindow().getViewPaneSize(),o=b.data.$.screenX,j=b.data.$.screenY,n=o-e.x,l=j-e.y;e={x:o,y:j};d.x+=n;d.y+=l;a.move(d.x+h[3]<f?-h[3]:d.x-h[1]>i.width-c.width-f?i.width-c.width+("rtl"==g.lang.dir?0:h[1]):d.x,d.y+h[0]<f?-h[0]:d.y-h[2]>i.height-c.height-f?i.height-c.height+h[2]:d.y,1);b.data.preventDefault()}function c(){CKEDITOR.document.removeListener("mousemove",b);CKEDITOR.document.removeListener("mouseup",
c);if(CKEDITOR.env.ie6Compat){var a=q.getChild(0).getFrameDocument();a.removeListener("mousemove",b);a.removeListener("mouseup",c)}}var e=null,d=null;a.getElement().getFirst();var g=a.getParentEditor(),f=g.config.dialog_magnetDistance,h=CKEDITOR.skin.margins||[0,0,0,0];"undefined"==typeof f&&(f=20);a.parts.title.on("mousedown",function(f){e={x:f.data.$.screenX,y:f.data.$.screenY};CKEDITOR.document.on("mousemove",b);CKEDITOR.document.on("mouseup",c);d=a.getPosition();if(CKEDITOR.env.ie6Compat){var h=
q.getChild(0).getFrameDocument();h.on("mousemove",b);h.on("mouseup",c)}f.data.preventDefault()},a)}function V(a){var b,c;function e(d){var e="rtl"==h.lang.dir,j=o.width,C=o.height,D=j+(d.data.$.screenX-b)*(e?-1:1)*(a._.moved?1:2),n=C+(d.data.$.screenY-c)*(a._.moved?1:2),x=a._.element.getFirst(),x=e&&x.getComputedStyle("right"),y=a.getPosition();y.y+n>i.height&&(n=i.height-y.y);if((e?x:y.x)+D>i.width)D=i.width-(e?x:y.x);if(f==CKEDITOR.DIALOG_RESIZE_WIDTH||f==CKEDITOR.DIALOG_RESIZE_BOTH)j=Math.max(g.minWidth||
0,D-m);if(f==CKEDITOR.DIALOG_RESIZE_HEIGHT||f==CKEDITOR.DIALOG_RESIZE_BOTH)C=Math.max(g.minHeight||0,n-k);a.resize(j,C);a._.moved||a.layout();d.data.preventDefault()}function d(){CKEDITOR.document.removeListener("mouseup",d);CKEDITOR.document.removeListener("mousemove",e);j&&(j.remove(),j=null);if(CKEDITOR.env.ie6Compat){var a=q.getChild(0).getFrameDocument();a.removeListener("mouseup",d);a.removeListener("mousemove",e)}}var g=a.definition,f=g.resizable;if(f!=CKEDITOR.DIALOG_RESIZE_NONE){var h=a.getParentEditor(),
m,k,i,o,j,n=CKEDITOR.tools.addFunction(function(f){o=a.getSize();var h=a.parts.contents;h.$.getElementsByTagName("iframe").length&&(j=CKEDITOR.dom.element.createFromHtml('<div class="cke_dialog_resize_cover" style="height: 100%; position: absolute; width: 100%;"></div>'),h.append(j));k=o.height-a.parts.contents.getSize("height",!(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.quirks));m=o.width-a.parts.contents.getSize("width",1);b=f.screenX;c=f.screenY;i=CKEDITOR.document.getWindow().getViewPaneSize();
CKEDITOR.document.on("mousemove",e);CKEDITOR.document.on("mouseup",d);CKEDITOR.env.ie6Compat&&(h=q.getChild(0).getFrameDocument(),h.on("mousemove",e),h.on("mouseup",d));f.preventDefault&&f.preventDefault()});a.on("load",function(){var b="";f==CKEDITOR.DIALOG_RESIZE_WIDTH?b=" cke_resizer_horizontal":f==CKEDITOR.DIALOG_RESIZE_HEIGHT&&(b=" cke_resizer_vertical");b=CKEDITOR.dom.element.createFromHtml('<div class="cke_resizer'+b+" cke_resizer_"+h.lang.dir+'" title="'+CKEDITOR.tools.htmlEncode(h.lang.common.resize)+
'" onmousedown="CKEDITOR.tools.callFunction('+n+', event )">'+("ltr"==h.lang.dir?"â—¢":"â—£")+"</div>");a.parts.footer.append(b,1)});h.on("destroy",function(){CKEDITOR.tools.removeFunction(n)})}}function E(a){a.data.preventDefault(1)}function J(a){var b=CKEDITOR.document.getWindow(),c=a.config,e=c.dialog_backgroundCoverColor||"white",d=c.dialog_backgroundCoverOpacity,g=c.baseFloatZIndex,c=CKEDITOR.tools.genKey(e,d,g),f=w[c];f?f.show():(g=['<div tabIndex="-1" style="position: ',CKEDITOR.env.ie6Compat?
"absolute":"fixed","; z-index: ",g,"; top: 0px; left: 0px; ",!CKEDITOR.env.ie6Compat?"background-color: "+e:"",'" class="cke_dialog_background_cover">'],CKEDITOR.env.ie6Compat&&(e="<html><body style=\\'background-color:"+e+";\\'></body></html>",g.push('<iframe hidefocus="true" frameborder="0" id="cke_dialog_background_iframe" src="javascript:'),g.push("void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.write( '"+e+"' );document.close();")+"})())"),g.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>')),
g.push("</div>"),f=CKEDITOR.dom.element.createFromHtml(g.join("")),f.setOpacity(void 0!=d?d:0.5),f.on("keydown",E),f.on("keypress",E),f.on("keyup",E),f.appendTo(CKEDITOR.document.getBody()),w[c]=f);a.focusManager.add(f);q=f;var a=function(){var a=b.getViewPaneSize();f.setStyles({width:a.width+"px",height:a.height+"px"})},h=function(){var a=b.getScrollPosition(),c=CKEDITOR.dialog._.currentTop;f.setStyles({left:a.x+"px",top:a.y+"px"});if(c){do{a=c.getPosition();c.move(a.x,a.y)}while(c=c._.parentDialog)
}};F=a;b.on("resize",a);a();(!CKEDITOR.env.mac||!CKEDITOR.env.webkit)&&f.focus();if(CKEDITOR.env.ie6Compat){var m=function(){h();arguments.callee.prevScrollHandler.apply(this,arguments)};b.$.setTimeout(function(){m.prevScrollHandler=window.onscroll||function(){};window.onscroll=m},0);h()}}function K(a){q&&(a.focusManager.remove(q),a=CKEDITOR.document.getWindow(),q.hide(),a.removeListener("resize",F),CKEDITOR.env.ie6Compat&&a.$.setTimeout(function(){window.onscroll=window.onscroll&&window.onscroll.prevScrollHandler||
null},0),F=null)}var r=CKEDITOR.tools.cssLength,S='<div class="cke_reset_all {editorId} {editorDialogClass} {hidpi}" dir="{langDir}" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><table class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}" style="position:absolute" role="presentation"><tr><td role="presentation"><div class="cke_dialog_body" role="presentation"><div id="cke_dialog_title_{id}" class="cke_dialog_title" role="presentation"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><table class="cke_dialog_contents" role="presentation"><tr><td id="cke_dialog_contents_{id}" class="cke_dialog_contents_body" role="presentation"></td></tr><tr><td id="cke_dialog_footer_{id}" class="cke_dialog_footer" role="presentation"></td></tr></table></div></td></tr></table></div>';
CKEDITOR.dialog=function(a,b){function c(){var a=l._.focusList;a.sort(function(a,b){return a.tabIndex!=b.tabIndex?b.tabIndex-a.tabIndex:a.focusIndex-b.focusIndex});for(var b=a.length,c=0;c<b;c++)a[c].focusIndex=c}function e(a){var b=l._.focusList,a=a||0;if(!(1>b.length)){var c=l._.currentFocusIndex;try{b[c].getInputElement().$.blur()}catch(f){}for(var d=c=(c+a+b.length)%b.length;a&&!b[d].isFocusable()&&!(d=(d+a+b.length)%b.length,d==c););b[d].focus();"text"==b[d].type&&b[d].select()}}function d(b){if(l==
CKEDITOR.dialog._.currentTop){var c=b.data.getKeystroke(),d="rtl"==a.lang.dir;o=j=0;if(9==c||c==CKEDITOR.SHIFT+9)c=c==CKEDITOR.SHIFT+9,l._.tabBarMode?(c=c?t.call(l):u.call(l),l.selectPage(c),l._.tabs[c][0].focus()):e(c?-1:1),o=1;else if(c==CKEDITOR.ALT+121&&!l._.tabBarMode&&1<l.getPageCount())l._.tabBarMode=!0,l._.tabs[l._.currentTabId][0].focus(),o=1;else if((37==c||39==c)&&l._.tabBarMode)c=c==(d?39:37)?t.call(l):u.call(l),l.selectPage(c),l._.tabs[c][0].focus(),o=1;else if((13==c||32==c)&&l._.tabBarMode)this.selectPage(this._.currentTabId),
this._.tabBarMode=!1,this._.currentFocusIndex=-1,e(1),o=1;else if(13==c){c=b.data.getTarget();if(!c.is("a","button","select","textarea")&&(!c.is("input")||"button"!=c.$.type))(c=this.getButton("ok"))&&CKEDITOR.tools.setTimeout(c.click,0,c),o=1;j=1}else if(27==c)(c=this.getButton("cancel"))?CKEDITOR.tools.setTimeout(c.click,0,c):!1!==this.fire("cancel",{hide:!0}).hide&&this.hide(),j=1;else return;g(b)}}function g(a){o?a.data.preventDefault(1):j&&a.data.stopPropagation()}var f=CKEDITOR.dialog._.dialogDefinitions[b],
h=CKEDITOR.tools.clone(W),m=a.config.dialog_buttonsOrder||"OS",k=a.lang.dir,i={},o,j;("OS"==m&&CKEDITOR.env.mac||"rtl"==m&&"ltr"==k||"ltr"==m&&"rtl"==k)&&h.buttons.reverse();f=CKEDITOR.tools.extend(f(a),h);f=CKEDITOR.tools.clone(f);f=new L(this,f);h=R(a);this._={editor:a,element:h.element,name:b,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:!1,focusList:[],
currentFocusIndex:0,hasFocus:!1};this.parts=h.parts;CKEDITOR.tools.setTimeout(function(){a.fire("ariaWidget",this.parts.contents)},0,this);h={position:CKEDITOR.env.ie6Compat?"absolute":"fixed",top:0,visibility:"hidden"};h["rtl"==k?"right":"left"]=0;this.parts.dialog.setStyles(h);CKEDITOR.event.call(this);this.definition=f=CKEDITOR.fire("dialogDefinition",{name:b,definition:f},a).definition;if(!("removeDialogTabs"in a._)&&a.config.removeDialogTabs){h=a.config.removeDialogTabs.split(";");for(k=0;k<
h.length;k++)if(m=h[k].split(":"),2==m.length){var n=m[0];i[n]||(i[n]=[]);i[n].push(m[1])}a._.removeDialogTabs=i}if(a._.removeDialogTabs&&(i=a._.removeDialogTabs[b]))for(k=0;k<i.length;k++)f.removeContents(i[k]);if(f.onLoad)this.on("load",f.onLoad);if(f.onShow)this.on("show",f.onShow);if(f.onHide)this.on("hide",f.onHide);if(f.onOk)this.on("ok",function(b){a.fire("saveSnapshot");setTimeout(function(){a.fire("saveSnapshot")},0);!1===f.onOk.call(this,b)&&(b.data.hide=!1)});if(f.onCancel)this.on("cancel",
function(a){!1===f.onCancel.call(this,a)&&(a.data.hide=!1)});var l=this,p=function(a){var b=l._.contents,c=!1,d;for(d in b)for(var f in b[d])if(c=a.call(this,b[d][f]))return};this.on("ok",function(a){p(function(b){if(b.validate){var c=b.validate(this),d="string"==typeof c||!1===c;d&&(a.data.hide=!1,a.stop());P.call(b,!d,"string"==typeof c?c:void 0);return d}})},this,null,0);this.on("cancel",function(b){p(function(c){if(c.isChanged())return!a.config.dialog_noConfirmCancel&&!confirm(a.lang.common.confirmCancel)&&
(b.data.hide=!1),!0})},this,null,0);this.parts.close.on("click",function(a){!1!==this.fire("cancel",{hide:!0}).hide&&this.hide();a.data.preventDefault()},this);this.changeFocus=e;var v=this._.element;a.focusManager.add(v,1);this.on("show",function(){v.on("keydown",d,this);if(CKEDITOR.env.gecko)v.on("keypress",g,this)});this.on("hide",function(){v.removeListener("keydown",d);CKEDITOR.env.gecko&&v.removeListener("keypress",g);p(function(a){Q.apply(a)})});this.on("iframeAdded",function(a){(new CKEDITOR.dom.document(a.data.iframe.$.contentWindow.document)).on("keydown",
d,this,null,0)});this.on("show",function(){c();if(a.config.dialog_startupFocusTab&&1<l._.pageCount)l._.tabBarMode=!0,l._.tabs[l._.currentTabId][0].focus();else if(!this._.hasFocus)if(this._.currentFocusIndex=-1,f.onFocus){var b=f.onFocus.call(this);b&&b.focus()}else e(1)},this,null,4294967295);if(CKEDITOR.env.ie6Compat)this.on("load",function(){var a=this.getElement(),b=a.getFirst();b.remove();b.appendTo(a)},this);U(this);V(this);(new CKEDITOR.dom.text(f.title,CKEDITOR.document)).appendTo(this.parts.title);
for(k=0;k<f.contents.length;k++)(i=f.contents[k])&&this.addPage(i);this.parts.tabs.on("click",function(a){var b=a.data.getTarget();b.hasClass("cke_dialog_tab")&&(b=b.$.id,this.selectPage(b.substring(4,b.lastIndexOf("_"))),this._.tabBarMode&&(this._.tabBarMode=!1,this._.currentFocusIndex=-1,e(1)),a.data.preventDefault())},this);k=[];i=CKEDITOR.dialog._.uiElementBuilders.hbox.build(this,{type:"hbox",className:"cke_dialog_footer_buttons",widths:[],children:f.buttons},k).getChild();this.parts.footer.setHtml(k.join(""));
for(k=0;k<i.length;k++)this._.buttons[i[k].id]=i[k]};CKEDITOR.dialog.prototype={destroy:function(){this.hide();this._.element.remove()},resize:function(){return function(a,b){if(!this._.contentSize||!(this._.contentSize.width==a&&this._.contentSize.height==b))CKEDITOR.dialog.fire("resize",{dialog:this,width:a,height:b},this._.editor),this.fire("resize",{width:a,height:b},this._.editor),this.parts.contents.setStyles({width:a+"px",height:b+"px"}),"rtl"==this._.editor.lang.dir&&this._.position&&(this._.position.x=
CKEDITOR.document.getWindow().getViewPaneSize().width-this._.contentSize.width-parseInt(this._.element.getFirst().getStyle("right"),10)),this._.contentSize={width:a,height:b}}}(),getSize:function(){var a=this._.element.getFirst();return{width:a.$.offsetWidth||0,height:a.$.offsetHeight||0}},move:function(a,b,c){var e=this._.element.getFirst(),d="rtl"==this._.editor.lang.dir,g="fixed"==e.getComputedStyle("position");CKEDITOR.env.ie&&e.setStyle("zoom","100%");if(!g||!this._.position||!(this._.position.x==
a&&this._.position.y==b))this._.position={x:a,y:b},g||(g=CKEDITOR.document.getWindow().getScrollPosition(),a+=g.x,b+=g.y),d&&(g=this.getSize(),a=CKEDITOR.document.getWindow().getViewPaneSize().width-g.width-a),b={top:(0<b?b:0)+"px"},b[d?"right":"left"]=(0<a?a:0)+"px",e.setStyles(b),c&&(this._.moved=1)},getPosition:function(){return CKEDITOR.tools.extend({},this._.position)},show:function(){var a=this._.element,b=this.definition;!a.getParent()||!a.getParent().equals(CKEDITOR.document.getBody())?a.appendTo(CKEDITOR.document.getBody()):
a.setStyle("display","block");this.resize(this._.contentSize&&this._.contentSize.width||b.width||b.minWidth,this._.contentSize&&this._.contentSize.height||b.height||b.minHeight);this.reset();this.selectPage(this.definition.contents[0].id);null===CKEDITOR.dialog._.currentZIndex&&(CKEDITOR.dialog._.currentZIndex=this._.editor.config.baseFloatZIndex);this._.element.getFirst().setStyle("z-index",CKEDITOR.dialog._.currentZIndex+=10);null===CKEDITOR.dialog._.currentTop?(CKEDITOR.dialog._.currentTop=this,
this._.parentDialog=null,J(this._.editor)):(this._.parentDialog=CKEDITOR.dialog._.currentTop,this._.parentDialog.getElement().getFirst().$.style.zIndex-=Math.floor(this._.editor.config.baseFloatZIndex/2),CKEDITOR.dialog._.currentTop=this);a.on("keydown",M);a.on("keyup",N);this._.hasFocus=!1;for(var c in b.contents)if(b.contents[c]){var a=b.contents[c],e=this._.tabs[a.id],d=a.requiredContent,g=0;if(e){for(var f in this._.contents[a.id]){var h=this._.contents[a.id][f];"hbox"==h.type||("vbox"==h.type||
!h.getInputElement())||(h.requiredContent&&!this._.editor.activeFilter.check(h.requiredContent)?h.disable():(h.enable(),g++))}!g||d&&!this._.editor.activeFilter.check(d)?e[0].addClass("cke_dialog_tab_disabled"):e[0].removeClass("cke_dialog_tab_disabled")}}CKEDITOR.tools.setTimeout(function(){this.layout();T(this);this.parts.dialog.setStyle("visibility","");this.fireOnce("load",{});CKEDITOR.ui.fire("ready",this);this.fire("show",{});this._.editor.fire("dialogShow",this);this._.parentDialog||this._.editor.focusManager.lock();
this.foreach(function(a){a.setInitValue&&a.setInitValue()})},100,this)},layout:function(){var a=this.parts.dialog,b=this.getSize(),c=CKEDITOR.document.getWindow().getViewPaneSize(),e=(c.width-b.width)/2,d=(c.height-b.height)/2;CKEDITOR.env.ie6Compat||(b.height+(0<d?d:0)>c.height||b.width+(0<e?e:0)>c.width?a.setStyle("position","absolute"):a.setStyle("position","fixed"));this.move(this._.moved?this._.position.x:e,this._.moved?this._.position.y:d)},foreach:function(a){for(var b in this._.contents)for(var c in this._.contents[b])a.call(this,
this._.contents[b][c]);return this},reset:function(){var a=function(a){a.reset&&a.reset(1)};return function(){this.foreach(a);return this}}(),setupContent:function(){var a=arguments;this.foreach(function(b){b.setup&&b.setup.apply(b,a)})},commitContent:function(){var a=arguments;this.foreach(function(b){CKEDITOR.env.ie&&this._.currentFocusIndex==b.focusIndex&&b.getInputElement().$.blur();b.commit&&b.commit.apply(b,a)})},hide:function(){if(this.parts.dialog.isVisible()){this.fire("hide",{});this._.editor.fire("dialogHide",
this);this.selectPage(this._.tabIdList[0]);var a=this._.element;a.setStyle("display","none");this.parts.dialog.setStyle("visibility","hidden");for(X(this);CKEDITOR.dialog._.currentTop!=this;)CKEDITOR.dialog._.currentTop.hide();if(this._.parentDialog){var b=this._.parentDialog.getElement().getFirst();b.setStyle("z-index",parseInt(b.$.style.zIndex,10)+Math.floor(this._.editor.config.baseFloatZIndex/2))}else K(this._.editor);if(CKEDITOR.dialog._.currentTop=this._.parentDialog)CKEDITOR.dialog._.currentZIndex-=
10;else{CKEDITOR.dialog._.currentZIndex=null;a.removeListener("keydown",M);a.removeListener("keyup",N);var c=this._.editor;c.focus();setTimeout(function(){c.focusManager.unlock()},0)}delete this._.parentDialog;this.foreach(function(a){a.resetInitValue&&a.resetInitValue()})}},addPage:function(a){if(!a.requiredContent||this._.editor.filter.check(a.requiredContent)){for(var b=[],c=a.label?' title="'+CKEDITOR.tools.htmlEncode(a.label)+'"':"",e=CKEDITOR.dialog._.uiElementBuilders.vbox.build(this,{type:"vbox",
className:"cke_dialog_page_contents",children:a.elements,expand:!!a.expand,padding:a.padding,style:a.style||"width: 100%;"},b),d=this._.contents[a.id]={},g=e.getChild(),f=0;e=g.shift();)!e.notAllowed&&("hbox"!=e.type&&"vbox"!=e.type)&&f++,d[e.id]=e,"function"==typeof e.getChild&&g.push.apply(g,e.getChild());f||(a.hidden=!0);b=CKEDITOR.dom.element.createFromHtml(b.join(""));b.setAttribute("role","tabpanel");e=CKEDITOR.env;d="cke_"+a.id+"_"+CKEDITOR.tools.getNextNumber();c=CKEDITOR.dom.element.createFromHtml(['<a class="cke_dialog_tab"',
0<this._.pageCount?" cke_last":"cke_first",c,a.hidden?' style="display:none"':"",' id="',d,'"',e.gecko&&!e.hc?"":' href="javascript:void(0)"',' tabIndex="-1" hidefocus="true" role="tab">',a.label,"</a>"].join(""));b.setAttribute("aria-labelledby",d);this._.tabs[a.id]=[c,b];this._.tabIdList.push(a.id);!a.hidden&&this._.pageCount++;this._.lastTab=c;this.updateStyle();b.setAttribute("name",a.id);b.appendTo(this.parts.contents);c.unselectable();this.parts.tabs.append(c);a.accessKey&&(O(this,this,"CTRL+"+
a.accessKey,Y,Z),this._.accessKeyMap["CTRL+"+a.accessKey]=a.id)}},selectPage:function(a){if(this._.currentTabId!=a&&!this._.tabs[a][0].hasClass("cke_dialog_tab_disabled")&&!1!==this.fire("selectPage",{page:a,currentPage:this._.currentTabId})){for(var b in this._.tabs){var c=this._.tabs[b][0],e=this._.tabs[b][1];b!=a&&(c.removeClass("cke_dialog_tab_selected"),e.hide());e.setAttribute("aria-hidden",b!=a)}var d=this._.tabs[a];d[0].addClass("cke_dialog_tab_selected");CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat?
(G(d[1]),d[1].show(),setTimeout(function(){G(d[1],1)},0)):d[1].show();this._.currentTabId=a;this._.currentTabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,a)}},updateStyle:function(){this.parts.dialog[(1===this._.pageCount?"add":"remove")+"Class"]("cke_single_page")},hidePage:function(a){var b=this._.tabs[a]&&this._.tabs[a][0];b&&(1!=this._.pageCount&&b.isVisible())&&(a==this._.currentTabId&&this.selectPage(t.call(this)),b.hide(),this._.pageCount--,this.updateStyle())},showPage:function(a){if(a=this._.tabs[a]&&
this._.tabs[a][0])a.show(),this._.pageCount++,this.updateStyle()},getElement:function(){return this._.element},getName:function(){return this._.name},getContentElement:function(a,b){var c=this._.contents[a];return c&&c[b]},getValueOf:function(a,b){return this.getContentElement(a,b).getValue()},setValueOf:function(a,b,c){return this.getContentElement(a,b).setValue(c)},getButton:function(a){return this._.buttons[a]},click:function(a){return this._.buttons[a].click()},disableButton:function(a){return this._.buttons[a].disable()},
enableButton:function(a){return this._.buttons[a].enable()},getPageCount:function(){return this._.pageCount},getParentEditor:function(){return this._.editor},getSelectedElement:function(){return this.getParentEditor().getSelection().getSelectedElement()},addFocusable:function(a,b){if("undefined"==typeof b)b=this._.focusList.length,this._.focusList.push(new H(this,a,b));else{this._.focusList.splice(b,0,new H(this,a,b));for(var c=b+1;c<this._.focusList.length;c++)this._.focusList[c].focusIndex++}}};
CKEDITOR.tools.extend(CKEDITOR.dialog,{add:function(a,b){if(!this._.dialogDefinitions[a]||"function"==typeof b)this._.dialogDefinitions[a]=b},exists:function(a){return!!this._.dialogDefinitions[a]},getCurrent:function(){return CKEDITOR.dialog._.currentTop},isTabEnabled:function(a,b,c){a=a.config.removeDialogTabs;return!(a&&a.match(RegExp("(?:^|;)"+b+":"+c+"(?:$|;)","i")))},okButton:function(){var a=function(a,c){c=c||{};return CKEDITOR.tools.extend({id:"ok",type:"button",label:a.lang.common.ok,"class":"cke_dialog_ui_button_ok",
onClick:function(a){a=a.data.dialog;!1!==a.fire("ok",{hide:!0}).hide&&a.hide()}},c,!0)};a.type="button";a.override=function(b){return CKEDITOR.tools.extend(function(c){return a(c,b)},{type:"button"},!0)};return a}(),cancelButton:function(){var a=function(a,c){c=c||{};return CKEDITOR.tools.extend({id:"cancel",type:"button",label:a.lang.common.cancel,"class":"cke_dialog_ui_button_cancel",onClick:function(a){a=a.data.dialog;!1!==a.fire("cancel",{hide:!0}).hide&&a.hide()}},c,!0)};a.type="button";a.override=
function(b){return CKEDITOR.tools.extend(function(c){return a(c,b)},{type:"button"},!0)};return a}(),addUIElement:function(a,b){this._.uiElementBuilders[a]=b}});CKEDITOR.dialog._={uiElementBuilders:{},dialogDefinitions:{},currentTop:null,currentZIndex:null};CKEDITOR.event.implementOn(CKEDITOR.dialog);CKEDITOR.event.implementOn(CKEDITOR.dialog.prototype);var W={resizable:CKEDITOR.DIALOG_RESIZE_BOTH,minWidth:600,minHeight:400,buttons:[CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton]},z=function(a,
b,c){for(var e=0,d;d=a[e];e++)if(d.id==b||c&&d[c]&&(d=z(d[c],b,c)))return d;return null},A=function(a,b,c,e,d){if(c){for(var g=0,f;f=a[g];g++){if(f.id==c)return a.splice(g,0,b),b;if(e&&f[e]&&(f=A(f[e],b,c,e,!0)))return f}if(d)return null}a.push(b);return b},B=function(a,b,c){for(var e=0,d;d=a[e];e++){if(d.id==b)return a.splice(e,1);if(c&&d[c]&&(d=B(d[c],b,c)))return d}return null},L=function(a,b){this.dialog=a;for(var c=b.contents,e=0,d;d=c[e];e++)c[e]=d&&new I(a,d);CKEDITOR.tools.extend(this,b)};
L.prototype={getContents:function(a){return z(this.contents,a)},getButton:function(a){return z(this.buttons,a)},addContents:function(a,b){return A(this.contents,a,b)},addButton:function(a,b){return A(this.buttons,a,b)},removeContents:function(a){B(this.contents,a)},removeButton:function(a){B(this.buttons,a)}};I.prototype={get:function(a){return z(this.elements,a,"children")},add:function(a,b){return A(this.elements,a,b,"children")},remove:function(a){B(this.elements,a,"children")}};var F,w={},q,s=
{},M=function(a){var b=a.data.$.ctrlKey||a.data.$.metaKey,c=a.data.$.altKey,e=a.data.$.shiftKey,d=String.fromCharCode(a.data.$.keyCode);if((b=s[(b?"CTRL+":"")+(c?"ALT+":"")+(e?"SHIFT+":"")+d])&&b.length)b=b[b.length-1],b.keydown&&b.keydown.call(b.uiElement,b.dialog,b.key),a.data.preventDefault()},N=function(a){var b=a.data.$.ctrlKey||a.data.$.metaKey,c=a.data.$.altKey,e=a.data.$.shiftKey,d=String.fromCharCode(a.data.$.keyCode);if((b=s[(b?"CTRL+":"")+(c?"ALT+":"")+(e?"SHIFT+":"")+d])&&b.length)b=b[b.length-
1],b.keyup&&(b.keyup.call(b.uiElement,b.dialog,b.key),a.data.preventDefault())},O=function(a,b,c,e,d){(s[c]||(s[c]=[])).push({uiElement:a,dialog:b,key:c,keyup:d||a.accessKeyUp,keydown:e||a.accessKeyDown})},X=function(a){for(var b in s){for(var c=s[b],e=c.length-1;0<=e;e--)(c[e].dialog==a||c[e].uiElement==a)&&c.splice(e,1);0===c.length&&delete s[b]}},Z=function(a,b){a._.accessKeyMap[b]&&a.selectPage(a._.accessKeyMap[b])},Y=function(){};(function(){CKEDITOR.ui.dialog={uiElement:function(a,b,c,e,d,g,
f){if(!(4>arguments.length)){var h=(e.call?e(b):e)||"div",m=["<",h," "],k=(d&&d.call?d(b):d)||{},i=(g&&g.call?g(b):g)||{},o=(f&&f.call?f.call(this,a,b):f)||"",j=this.domId=i.id||CKEDITOR.tools.getNextId()+"_uiElement";this.id=b.id;b.requiredContent&&!a.getParentEditor().filter.check(b.requiredContent)&&(k.display="none",this.notAllowed=!0);i.id=j;var n={};b.type&&(n["cke_dialog_ui_"+b.type]=1);b.className&&(n[b.className]=1);b.disabled&&(n.cke_disabled=1);for(var l=i["class"]&&i["class"].split?i["class"].split(" "):
[],j=0;j<l.length;j++)l[j]&&(n[l[j]]=1);l=[];for(j in n)l.push(j);i["class"]=l.join(" ");b.title&&(i.title=b.title);n=(b.style||"").split(";");b.align&&(l=b.align,k["margin-left"]="left"==l?0:"auto",k["margin-right"]="right"==l?0:"auto");for(j in k)n.push(j+":"+k[j]);b.hidden&&n.push("display:none");for(j=n.length-1;0<=j;j--)""===n[j]&&n.splice(j,1);0<n.length&&(i.style=(i.style?i.style+"; ":"")+n.join("; "));for(j in i)m.push(j+'="'+CKEDITOR.tools.htmlEncode(i[j])+'" ');m.push(">",o,"</",h,">");
c.push(m.join(""));(this._||(this._={})).dialog=a;"boolean"==typeof b.isChanged&&(this.isChanged=function(){return b.isChanged});"function"==typeof b.isChanged&&(this.isChanged=b.isChanged);"function"==typeof b.setValue&&(this.setValue=CKEDITOR.tools.override(this.setValue,function(a){return function(c){a.call(this,b.setValue.call(this,c))}}));"function"==typeof b.getValue&&(this.getValue=CKEDITOR.tools.override(this.getValue,function(a){return function(){return b.getValue.call(this,a.call(this))}}));
CKEDITOR.event.implementOn(this);this.registerEvents(b);this.accessKeyUp&&(this.accessKeyDown&&b.accessKey)&&O(this,a,"CTRL+"+b.accessKey);var p=this;a.on("load",function(){var b=p.getInputElement();if(b){var c=p.type in{checkbox:1,ratio:1}&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?"cke_dialog_ui_focused":"";b.on("focus",function(){a._.tabBarMode=false;a._.hasFocus=true;p.fire("focus");c&&this.addClass(c)});b.on("blur",function(){p.fire("blur");c&&this.removeClass(c)})}});CKEDITOR.tools.extend(this,
b);this.keyboardFocusable&&(this.tabIndex=b.tabIndex||0,this.focusIndex=a._.focusList.push(this)-1,this.on("focus",function(){a._.currentFocusIndex=p.focusIndex}))}},hbox:function(a,b,c,e,d){if(!(4>arguments.length)){this._||(this._={});var g=this._.children=b,f=d&&d.widths||null,h=d&&d.height||null,m,k={role:"presentation"};d&&d.align&&(k.align=d.align);CKEDITOR.ui.dialog.uiElement.call(this,a,d||{type:"hbox"},e,"table",{},k,function(){var a=['<tbody><tr class="cke_dialog_ui_hbox">'];for(m=0;m<c.length;m++){var b=
"cke_dialog_ui_hbox_child",e=[];0===m&&(b="cke_dialog_ui_hbox_first");m==c.length-1&&(b="cke_dialog_ui_hbox_last");a.push('<td class="',b,'" role="presentation" ');f?f[m]&&e.push("width:"+r(f[m])):e.push("width:"+Math.floor(100/c.length)+"%");h&&e.push("height:"+r(h));d&&void 0!=d.padding&&e.push("padding:"+r(d.padding));CKEDITOR.env.ie&&(CKEDITOR.env.quirks&&g[m].align)&&e.push("text-align:"+g[m].align);0<e.length&&a.push('style="'+e.join("; ")+'" ');a.push(">",c[m],"</td>")}a.push("</tr></tbody>");
return a.join("")})}},vbox:function(a,b,c,e,d){if(!(3>arguments.length)){this._||(this._={});var g=this._.children=b,f=d&&d.width||null,h=d&&d.heights||null;CKEDITOR.ui.dialog.uiElement.call(this,a,d||{type:"vbox"},e,"div",null,{role:"presentation"},function(){var b=['<table role="presentation" cellspacing="0" border="0" '];b.push('style="');d&&d.expand&&b.push("height:100%;");b.push("width:"+r(f||"100%"),";");CKEDITOR.env.webkit&&b.push("float:none;");b.push('"');b.push('align="',CKEDITOR.tools.htmlEncode(d&&
d.align||("ltr"==a.getParentEditor().lang.dir?"left":"right")),'" ');b.push("><tbody>");for(var e=0;e<c.length;e++){var i=[];b.push('<tr><td role="presentation" ');f&&i.push("width:"+r(f||"100%"));h?i.push("height:"+r(h[e])):d&&d.expand&&i.push("height:"+Math.floor(100/c.length)+"%");d&&void 0!=d.padding&&i.push("padding:"+r(d.padding));CKEDITOR.env.ie&&(CKEDITOR.env.quirks&&g[e].align)&&i.push("text-align:"+g[e].align);0<i.length&&b.push('style="',i.join("; "),'" ');b.push(' class="cke_dialog_ui_vbox_child">',
c[e],"</td></tr>")}b.push("</tbody></table>");return b.join("")})}}}})();CKEDITOR.ui.dialog.uiElement.prototype={getElement:function(){return CKEDITOR.document.getById(this.domId)},getInputElement:function(){return this.getElement()},getDialog:function(){return this._.dialog},setValue:function(a,b){this.getInputElement().setValue(a);!b&&this.fire("change",{value:a});return this},getValue:function(){return this.getInputElement().getValue()},isChanged:function(){return!1},selectParentTab:function(){for(var a=
this.getInputElement();(a=a.getParent())&&-1==a.$.className.search("cke_dialog_page_contents"););if(!a)return this;a=a.getAttribute("name");this._.dialog._.currentTabId!=a&&this._.dialog.selectPage(a);return this},focus:function(){this.selectParentTab().getInputElement().focus();return this},registerEvents:function(a){var b=/^on([A-Z]\w+)/,c,e=function(a,b,c,d){b.on("load",function(){a.getInputElement().on(c,d,a)})},d;for(d in a)if(c=d.match(b))this.eventProcessors[d]?this.eventProcessors[d].call(this,
this._.dialog,a[d]):e(this,this._.dialog,c[1].toLowerCase(),a[d]);return this},eventProcessors:{onLoad:function(a,b){a.on("load",b,this)},onShow:function(a,b){a.on("show",b,this)},onHide:function(a,b){a.on("hide",b,this)}},accessKeyDown:function(){this.focus()},accessKeyUp:function(){},disable:function(){var a=this.getElement();this.getInputElement().setAttribute("disabled","true");a.addClass("cke_disabled")},enable:function(){var a=this.getElement();this.getInputElement().removeAttribute("disabled");
a.removeClass("cke_disabled")},isEnabled:function(){return!this.getElement().hasClass("cke_disabled")},isVisible:function(){return this.getInputElement().isVisible()},isFocusable:function(){return!this.isEnabled()||!this.isVisible()?!1:!0}};CKEDITOR.ui.dialog.hbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getChild:function(a){if(1>arguments.length)return this._.children.concat();a.splice||(a=[a]);return 2>a.length?this._.children[a[0]]:this._.children[a[0]]&&this._.children[a[0]].getChild?
this._.children[a[0]].getChild(a.slice(1,a.length)):null}},!0);CKEDITOR.ui.dialog.vbox.prototype=new CKEDITOR.ui.dialog.hbox;(function(){var a={build:function(a,c,e){for(var d=c.children,g,f=[],h=[],m=0;m<d.length&&(g=d[m]);m++){var k=[];f.push(k);h.push(CKEDITOR.dialog._.uiElementBuilders[g.type].build(a,g,k))}return new CKEDITOR.ui.dialog[c.type](a,h,f,e,c)}};CKEDITOR.dialog.addUIElement("hbox",a);CKEDITOR.dialog.addUIElement("vbox",a)})();CKEDITOR.dialogCommand=function(a,b){this.dialogName=a;
CKEDITOR.tools.extend(this,b,!0)};CKEDITOR.dialogCommand.prototype={exec:function(a){a.openDialog(this.dialogName)},canUndo:!1,editorFocus:1};(function(){var a=/^([a]|[^a])+$/,b=/^\d*$/,c=/^\d*(?:\.\d+)?$/,e=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,d=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,g=/^(\s*[\w-]+\s*:\s*[^:;]+(?:;|$))*$/;CKEDITOR.VALIDATE_OR=1;CKEDITOR.VALIDATE_AND=2;CKEDITOR.dialog.validate={functions:function(){var a=arguments;return function(){var b=this&&this.getValue?this.getValue():
a[0],c=void 0,d=CKEDITOR.VALIDATE_AND,e=[],g;for(g=0;g<a.length;g++)if("function"==typeof a[g])e.push(a[g]);else break;g<a.length&&"string"==typeof a[g]&&(c=a[g],g++);g<a.length&&"number"==typeof a[g]&&(d=a[g]);var j=d==CKEDITOR.VALIDATE_AND?!0:!1;for(g=0;g<e.length;g++)j=d==CKEDITOR.VALIDATE_AND?j&&e[g](b):j||e[g](b);return!j?c:!0}},regex:function(a,b){return function(c){c=this&&this.getValue?this.getValue():c;return!a.test(c)?b:!0}},notEmpty:function(b){return this.regex(a,b)},integer:function(a){return this.regex(b,
a)},number:function(a){return this.regex(c,a)},cssLength:function(a){return this.functions(function(a){return d.test(CKEDITOR.tools.trim(a))},a)},htmlLength:function(a){return this.functions(function(a){return e.test(CKEDITOR.tools.trim(a))},a)},inlineStyle:function(a){return this.functions(function(a){return g.test(CKEDITOR.tools.trim(a))},a)},equals:function(a,b){return this.functions(function(b){return b==a},b)},notEqual:function(a,b){return this.functions(function(b){return b!=a},b)}};CKEDITOR.on("instanceDestroyed",
function(a){if(CKEDITOR.tools.isEmpty(CKEDITOR.instances)){for(var b;b=CKEDITOR.dialog._.currentTop;)b.hide();for(var c in w)w[c].remove();w={}}var a=a.editor._.storedDialogs,d;for(d in a)a[d].destroy()})})();CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{openDialog:function(a,b){var c=null,e=CKEDITOR.dialog._.dialogDefinitions[a];null===CKEDITOR.dialog._.currentTop&&J(this);if("function"==typeof e)c=this._.storedDialogs||(this._.storedDialogs={}),c=c[a]||(c[a]=new CKEDITOR.dialog(this,a)),b&&b.call(c,
c),c.show();else{if("failed"==e)throw K(this),Error('[CKEDITOR.dialog.openDialog] Dialog "'+a+'" failed when loading definition.');"string"==typeof e&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(e),function(){"function"!=typeof CKEDITOR.dialog._.dialogDefinitions[a]&&(CKEDITOR.dialog._.dialogDefinitions[a]="failed");this.openDialog(a,b)},this,0,1)}CKEDITOR.skin.loadPart("dialog");return c}})})();
CKEDITOR.plugins.add("dialog",{requires:"dialogui",init:function(t){t.on("doubleclick",function(u){u.data.dialog&&t.openDialog(u.data.dialog)},null,null,999)}});(function(){CKEDITOR.plugins.add("a11yhelp",{requires:"dialog",availableLangs:{ar:1,bg:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,en:1,"en-gb":1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,sr:1,"sr-latn":1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},init:function(b){var c=this;b.addCommand("a11yHelp",{exec:function(){var a=b.langCode,a=c.availableLangs[a]?a:c.availableLangs[a.replace(/-.*/,
"")]?a.replace(/-.*/,""):"en";CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(c.path+"dialogs/lang/"+a+".js"),function(){b.lang.a11yhelp=c.langEntries[a];b.openDialog("a11yHelp")})},modes:{wysiwyg:1,source:1},readOnly:1,canUndo:!1});b.setKeystroke(CKEDITOR.ALT+48,"a11yHelp");CKEDITOR.dialog.add("a11yHelp",this.path+"dialogs/a11yhelp.js");b.on("ariaEditorHelpLabel",function(a){a.data.label=b.lang.common.editorHelp})}})})();CKEDITOR.plugins.add("basicstyles",{init:function(c){var e=0,d=function(g,d,b,a){if(a){var a=new CKEDITOR.style(a),f=h[b];f.unshift(a);c.attachStyleStateChange(a,function(a){!c.readOnly&&c.getCommand(b).setState(a)});c.addCommand(b,new CKEDITOR.styleCommand(a,{contentForms:f}));c.ui.addButton&&c.ui.addButton(g,{label:d,command:b,toolbar:"basicstyles,"+(e+=10)})}},h={bold:["strong","b",["span",function(a){a=a.styles["font-weight"];return"bold"==a||700<=+a}]],italic:["em","i",["span",function(a){return"italic"==
a.styles["font-style"]}]],underline:["u",["span",function(a){return"underline"==a.styles["text-decoration"]}]],strike:["s","strike",["span",function(a){return"line-through"==a.styles["text-decoration"]}]],subscript:["sub"],superscript:["sup"]},b=c.config,a=c.lang.basicstyles;d("Bold",a.bold,"bold",b.coreStyles_bold);d("Italic",a.italic,"italic",b.coreStyles_italic);d("Underline",a.underline,"underline",b.coreStyles_underline);d("Strike",a.strike,"strike",b.coreStyles_strike);d("Subscript",a.subscript,
"subscript",b.coreStyles_subscript);d("Superscript",a.superscript,"superscript",b.coreStyles_superscript);c.setKeystroke([[CKEDITOR.CTRL+66,"bold"],[CKEDITOR.CTRL+73,"italic"],[CKEDITOR.CTRL+85,"underline"]])}});CKEDITOR.config.coreStyles_bold={element:"strong",overrides:"b"};CKEDITOR.config.coreStyles_italic={element:"em",overrides:"i"};CKEDITOR.config.coreStyles_underline={element:"u"};CKEDITOR.config.coreStyles_strike={element:"s",overrides:"strike"};CKEDITOR.config.coreStyles_subscript={element:"sub"};
CKEDITOR.config.coreStyles_superscript={element:"sup"};(function(){var c='<a id="{id}" class="cke_button cke_button__{name} cke_button_{state} {cls}"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' title="{title}" tabindex="-1" hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="{hasArrow}" aria-disabled="{ariaDisabled}"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(c+=' onkeypress="return false;"');CKEDITOR.env.gecko&&(c+=' onblur="this.style.cssText = this.style.cssText;"');var c=c+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+
(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span class="cke_button_icon cke_button__{iconName}_icon" style="{style}"'),c=c+'>&nbsp;</span><span id="{id}_label" class="cke_button_label cke_button__{name}_label" aria-hidden="false">{label}</span>{arrowHtml}</a>',m=CKEDITOR.addTemplate("buttonArrow",'<span class="cke_button_arrow">'+(CKEDITOR.env.hc?"&#9660;":"")+"</span>"),n=CKEDITOR.addTemplate("button",c);CKEDITOR.plugins.add("button",
{beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler)}});CKEDITOR.UI_BUTTON="button";CKEDITOR.ui.button=function(a){CKEDITOR.tools.extend(this,a,{title:a.label,click:a.click||function(b){b.execCommand(a.command)}});this._={}};CKEDITOR.ui.button.handler={create:function(a){return new CKEDITOR.ui.button(a)}};CKEDITOR.ui.button.prototype={render:function(a,b){var c=CKEDITOR.env,i=this._.id=CKEDITOR.tools.getNextId(),f="",e=this.command,k;this._.editor=a;var d={id:i,button:this,
editor:a,focus:function(){CKEDITOR.document.getById(i).focus()},execute:function(){this.button.click(a)},attach:function(a){this.button.attach(a)}},o=CKEDITOR.tools.addFunction(function(a){if(d.onkey)return a=new CKEDITOR.dom.event(a),!1!==d.onkey(d,a.getKeystroke())}),p=CKEDITOR.tools.addFunction(function(a){var b;d.onfocus&&(b=!1!==d.onfocus(d,new CKEDITOR.dom.event(a)));return b}),l=0;d.clickFn=k=CKEDITOR.tools.addFunction(function(){l&&(a.unlockSelection(1),l=0);d.execute()});if(this.modes){var j=
{},g=function(){var b=a.mode;b&&(b=this.modes[b]?void 0!=j[b]?j[b]:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,b=a.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:b,this.setState(b),this.refresh&&this.refresh())};a.on("beforeModeUnload",function(){a.mode&&this._.state!=CKEDITOR.TRISTATE_DISABLED&&(j[a.mode]=this._.state)},this);a.on("activeFilterChange",g,this);a.on("mode",g,this);!this.readOnly&&a.on("readOnly",g,this)}else if(e&&(e=a.getCommand(e)))e.on("state",function(){this.setState(e.state)},
this),f+=e.state==CKEDITOR.TRISTATE_ON?"on":e.state==CKEDITOR.TRISTATE_DISABLED?"disabled":"off";if(this.directional)a.on("contentDirChanged",function(b){var c=CKEDITOR.document.getById(this._.id),d=c.getFirst(),b=b.data;b!=a.lang.dir?c.addClass("cke_"+b):c.removeClass("cke_ltr").removeClass("cke_rtl");d.setAttribute("style",CKEDITOR.skin.getIconStyle(h,"rtl"==b,this.icon,this.iconOffset))},this);e||(f+="off");var h=g=this.name||this.command;this.icon&&!/\./.test(this.icon)&&(h=this.icon,this.icon=
null);c={id:i,name:g,iconName:h,label:this.label,cls:this.className||"",state:f,ariaDisabled:"disabled"==f?"true":"false",title:this.title,titleJs:c.gecko&&!c.hc?"":(this.title||"").replace("'",""),hasArrow:this.hasArrow?"true":"false",keydownFn:o,focusFn:p,clickFn:k,style:CKEDITOR.skin.getIconStyle(h,"rtl"==a.lang.dir,this.icon,this.iconOffset),arrowHtml:this.hasArrow?m.output():""};n.output(c,b);if(this.onRender)this.onRender();return d},setState:function(a){if(this._.state==a)return!1;this._.state=
a;var b=CKEDITOR.document.getById(this._.id);return b?(b.setState(a,"cke_button"),a==CKEDITOR.TRISTATE_DISABLED?b.setAttribute("aria-disabled",!0):b.removeAttribute("aria-disabled"),this.hasArrow?(a=a==CKEDITOR.TRISTATE_ON?this._.editor.lang.button.selectedLabel.replace(/%1/g,this.label):this.label,CKEDITOR.document.getById(this._.id+"_label").setText(a)):a==CKEDITOR.TRISTATE_ON?b.setAttribute("aria-pressed",!0):b.removeAttribute("aria-pressed"),!0):!1},getState:function(){return this._.state},toFeature:function(a){if(this._.feature)return this._.feature;
var b=this;!this.allowedContent&&(!this.requiredContent&&this.command)&&(b=a.getCommand(this.command)||b);return this._.feature=b}};CKEDITOR.ui.prototype.addButton=function(a,b){this.add(a,CKEDITOR.UI_BUTTON,b)}})();(function(){CKEDITOR.plugins.add("panel",{beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}});CKEDITOR.UI_PANEL="panel";CKEDITOR.ui.panel=function(a,b){b&&CKEDITOR.tools.extend(this,b);CKEDITOR.tools.extend(this,{className:"",css:[]});this.id=CKEDITOR.tools.getNextId();this.document=a;this.isFramed=this.forceIFrame||this.css.length;this._={blocks:{}}};CKEDITOR.ui.panel.handler={create:function(a){return new CKEDITOR.ui.panel(a)}};var f=CKEDITOR.addTemplate("panel",
'<div lang="{langCode}" id="{id}" dir={dir} class="cke cke_reset_all {editorId} cke_panel cke_panel {cls} cke_{dir}" style="z-index:{z-index}" role="presentation">{frame}</div>'),g=CKEDITOR.addTemplate("panel-frame",'<iframe id="{id}" class="cke_panel_frame" role="presentation" frameborder="0" src="{src}"></iframe>'),h=CKEDITOR.addTemplate("panel-frame-inner",'<!DOCTYPE html><html class="cke_panel_container {env}" dir="{dir}" lang="{langCode}"><head>{css}</head><body class="cke_{dir}" style="margin:0;padding:0" onload="{onload}"></body></html>');
CKEDITOR.ui.panel.prototype={render:function(a,b){this.getHolderElement=function(){var a=this._.holder;if(!a){if(this.isFramed){var a=this.document.getById(this.id+"_frame"),b=a.getParent(),a=a.getFrameDocument();CKEDITOR.env.iOS&&b.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"});b=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(){this.isLoaded=!0;if(this.onLoad)this.onLoad()},this));a.write(h.output(CKEDITOR.tools.extend({css:CKEDITOR.tools.buildStyleHtml(this.css),onload:"window.parent.CKEDITOR.tools.callFunction("+
b+");"},d)));a.getWindow().$.CKEDITOR=CKEDITOR;a.on("keydown",function(a){var b=a.data.getKeystroke(),c=this.document.getById(this.id).getAttribute("dir");this._.onKeyDown&&!1===this._.onKeyDown(b)?a.data.preventDefault():(27==b||b==("rtl"==c?39:37))&&this.onEscape&&!1===this.onEscape(b)&&a.data.preventDefault()},this);a=a.getBody();a.unselectable();CKEDITOR.env.air&&CKEDITOR.tools.callFunction(b)}else a=this.document.getById(this.id);this._.holder=a}return a};var d={editorId:a.id,id:this.id,langCode:a.langCode,
dir:a.lang.dir,cls:this.className,frame:"",env:CKEDITOR.env.cssClass,"z-index":a.config.baseFloatZIndex+1};if(this.isFramed){var e=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())":"";d.frame=g.output({id:this.id+"_frame",src:e})}e=f.output(d);b&&b.push(e);return e},addBlock:function(a,b){b=this._.blocks[a]=b instanceof CKEDITOR.ui.panel.block?b:new CKEDITOR.ui.panel.block(this.getHolderElement(),
b);this._.currentBlock||this.showBlock(a);return b},getBlock:function(a){return this._.blocks[a]},showBlock:function(a){var a=this._.blocks[a],b=this._.currentBlock,d=!this.forceIFrame||CKEDITOR.env.ie?this._.holder:this.document.getById(this.id+"_frame");b&&b.hide();this._.currentBlock=a;CKEDITOR.fire("ariaWidget",d);a._.focusIndex=-1;this._.onKeyDown=a.onKeyDown&&CKEDITOR.tools.bind(a.onKeyDown,a);a.show();return a},destroy:function(){this.element&&this.element.remove()}};CKEDITOR.ui.panel.block=
CKEDITOR.tools.createClass({$:function(a,b){this.element=a.append(a.getDocument().createElement("div",{attributes:{tabindex:-1,"class":"cke_panel_block"},styles:{display:"none"}}));b&&CKEDITOR.tools.extend(this,b);this.element.setAttributes({role:this.attributes.role||"presentation","aria-label":this.attributes["aria-label"],title:this.attributes.title||this.attributes["aria-label"]});this.keys={};this._.focusIndex=-1;this.element.disableContextMenu()},_:{markItem:function(a){-1!=a&&(a=this.element.getElementsByTag("a").getItem(this._.focusIndex=
a),CKEDITOR.env.webkit&&a.getDocument().getWindow().focus(),a.focus(),this.onMark&&this.onMark(a))}},proto:{show:function(){this.element.setStyle("display","")},hide:function(){(!this.onHide||!0!==this.onHide.call(this))&&this.element.setStyle("display","none")},onKeyDown:function(a,b){var d=this.keys[a];switch(d){case "next":for(var e=this._.focusIndex,d=this.element.getElementsByTag("a"),c;c=d.getItem(++e);)if(c.getAttribute("_cke_focus")&&c.$.offsetWidth){this._.focusIndex=e;c.focus();break}return!c&&
!b?(this._.focusIndex=-1,this.onKeyDown(a,1)):!1;case "prev":e=this._.focusIndex;for(d=this.element.getElementsByTag("a");0<e&&(c=d.getItem(--e));){if(c.getAttribute("_cke_focus")&&c.$.offsetWidth){this._.focusIndex=e;c.focus();break}c=null}return!c&&!b?(this._.focusIndex=d.count(),this.onKeyDown(a,1)):!1;case "click":case "mouseup":return e=this._.focusIndex,(c=0<=e&&this.element.getElementsByTag("a").getItem(e))&&(c.$[d]?c.$[d]():c.$["on"+d]()),!1}return!0}}})})();CKEDITOR.plugins.add("floatpanel",{requires:"panel"});
(function(){function r(a,b,c,i,f){var f=CKEDITOR.tools.genKey(b.getUniqueId(),c.getUniqueId(),a.lang.dir,a.uiColor||"",i.css||"",f||""),h=g[f];h||(h=g[f]=new CKEDITOR.ui.panel(b,i),h.element=c.append(CKEDITOR.dom.element.createFromHtml(h.render(a),b)),h.element.setStyles({display:"none",position:"absolute"}));return h}var g={};CKEDITOR.ui.floatPanel=CKEDITOR.tools.createClass({$:function(a,b,c,i){function f(){d.hide()}c.forceIFrame=1;c.toolbarRelated&&a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&
(b=CKEDITOR.document.getById("cke_"+a.name));var h=b.getDocument(),i=r(a,h,b,c,i||0),j=i.element,l=j.getFirst(),d=this;j.disableContextMenu();this.element=j;this._={editor:a,panel:i,parentElement:b,definition:c,document:h,iframe:l,children:[],dir:a.lang.dir};a.on("mode",f);a.on("resize",f);if(!CKEDITOR.env.iOS)h.getWindow().on("resize",f)},proto:{addBlock:function(a,b){return this._.panel.addBlock(a,b)},addListBlock:function(a,b){return this._.panel.addListBlock(a,b)},getBlock:function(a){return this._.panel.getBlock(a)},
showBlock:function(a,b,c,i,f,h){var j=this._.panel,l=j.showBlock(a);this.allowBlur(!1);a=this._.editor.editable();this._.returnFocus=a.hasFocus?a:new CKEDITOR.dom.element(CKEDITOR.document.$.activeElement);this._.hideTimeout=0;var d=this.element,a=this._.iframe,a=CKEDITOR.env.ie?a:new CKEDITOR.dom.window(a.$.contentWindow),g=d.getDocument(),o=this._.parentElement.getPositionedAncestor(),p=b.getDocumentPosition(g),g=o?o.getDocumentPosition(g):{x:0,y:0},m="rtl"==this._.dir,e=p.x+(i||0)-g.x,k=p.y+(f||
0)-g.y;if(m&&(1==c||4==c))e+=b.$.offsetWidth;else if(!m&&(2==c||3==c))e+=b.$.offsetWidth-1;if(3==c||4==c)k+=b.$.offsetHeight-1;this._.panel._.offsetParentId=b.getId();d.setStyles({top:k+"px",left:0,display:""});d.setOpacity(0);d.getFirst().removeStyle("width");this._.editor.focusManager.add(a);this._.blurSet||(CKEDITOR.event.useCapture=!0,a.on("blur",function(a){function q(){delete this._.returnFocus;this.hide()}this.allowBlur()&&a.data.getPhase()==CKEDITOR.EVENT_PHASE_AT_TARGET&&(this.visible&&!this._.activeChild)&&
(CKEDITOR.env.iOS?this._.hideTimeout||(this._.hideTimeout=CKEDITOR.tools.setTimeout(q,0,this)):q.call(this))},this),a.on("focus",function(){this._.focused=!0;this.hideChild();this.allowBlur(!0)},this),CKEDITOR.env.iOS&&(a.on("touchstart",function(){clearTimeout(this._.hideTimeout)},this),a.on("touchend",function(){this._.hideTimeout=0;this.focus()},this)),CKEDITOR.event.useCapture=!1,this._.blurSet=1);j.onEscape=CKEDITOR.tools.bind(function(a){if(this.onEscape&&this.onEscape(a)===false)return false},
this);CKEDITOR.tools.setTimeout(function(){var a=CKEDITOR.tools.bind(function(){d.removeStyle("width");if(l.autoSize){var a=l.element.getDocument(),a=(CKEDITOR.env.webkit?l.element:a.getBody()).$.scrollWidth;CKEDITOR.env.ie&&(CKEDITOR.env.quirks&&a>0)&&(a=a+((d.$.offsetWidth||0)-(d.$.clientWidth||0)+3));d.setStyle("width",a+10+"px");a=l.element.$.scrollHeight;CKEDITOR.env.ie&&(CKEDITOR.env.quirks&&a>0)&&(a=a+((d.$.offsetHeight||0)-(d.$.clientHeight||0)+3));d.setStyle("height",a+"px");j._.currentBlock.element.setStyle("display",
"none").removeStyle("display")}else d.removeStyle("height");m&&(e=e-d.$.offsetWidth);d.setStyle("left",e+"px");var b=j.element.getWindow(),a=d.$.getBoundingClientRect(),b=b.getViewPaneSize(),c=a.width||a.right-a.left,f=a.height||a.bottom-a.top,i=m?a.right:b.width-a.left,g=m?b.width-a.right:a.left;m?i<c&&(e=g>c?e+c:b.width>c?e-a.left:e-a.right+b.width):i<c&&(e=g>c?e-c:b.width>c?e-a.right+b.width:e-a.left);c=a.top;b.height-a.top<f&&(k=c>f?k-f:b.height>f?k-a.bottom+b.height:k-a.top);if(CKEDITOR.env.ie){b=
a=new CKEDITOR.dom.element(d.$.offsetParent);b.getName()=="html"&&(b=b.getDocument().getBody());b.getComputedStyle("direction")=="rtl"&&(e=CKEDITOR.env.ie8Compat?e-d.getDocument().getDocumentElement().$.scrollLeft*2:e-(a.$.scrollWidth-a.$.clientWidth))}var a=d.getFirst(),n;(n=a.getCustomData("activePanel"))&&n.onHide&&n.onHide.call(this,1);a.setCustomData("activePanel",this);d.setStyles({top:k+"px",left:e+"px"});d.setOpacity(1);h&&h()},this);j.isLoaded?a():j.onLoad=a;CKEDITOR.tools.setTimeout(function(){var a=
CKEDITOR.env.webkit&&CKEDITOR.document.getWindow().getScrollPosition().y;this.focus();l.element.focus();if(CKEDITOR.env.webkit)CKEDITOR.document.getBody().$.scrollTop=a;this.allowBlur(true);this._.editor.fire("panelShow",this)},0,this)},CKEDITOR.env.air?200:0,this);this.visible=1;this.onShow&&this.onShow.call(this)},focus:function(){if(CKEDITOR.env.webkit){var a=CKEDITOR.document.getActive();!a.equals(this._.iframe)&&a.$.blur()}(this._.lastFocused||this._.iframe.getFrameDocument().getWindow()).focus()},
blur:function(){var a=this._.iframe.getFrameDocument().getActive();a.is("a")&&(this._.lastFocused=a)},hide:function(a){if(this.visible&&(!this.onHide||!0!==this.onHide.call(this))){this.hideChild();CKEDITOR.env.gecko&&this._.iframe.getFrameDocument().$.activeElement.blur();this.element.setStyle("display","none");this.visible=0;this.element.getFirst().removeCustomData("activePanel");if(a=a&&this._.returnFocus)CKEDITOR.env.webkit&&a.type&&a.getWindow().$.focus(),a.focus();delete this._.lastFocused;
this._.editor.fire("panelHide",this)}},allowBlur:function(a){var b=this._.panel;void 0!=a&&(b.allowBlur=a);return b.allowBlur},showAsChild:function(a,b,c,g,f,h){this._.activeChild==a&&a._.panel._.offsetParentId==c.getId()||(this.hideChild(),a.onHide=CKEDITOR.tools.bind(function(){CKEDITOR.tools.setTimeout(function(){this._.focused||this.hide()},0,this)},this),this._.activeChild=a,this._.focused=!1,a.showBlock(b,c,g,f,h),this.blur(),(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&setTimeout(function(){a.element.getChild(0).$.style.cssText+=
""},100))},hideChild:function(a){var b=this._.activeChild;b&&(delete b.onHide,delete this._.activeChild,b.hide(),a&&this.focus())}}});CKEDITOR.on("instanceDestroyed",function(){var a=CKEDITOR.tools.isEmpty(CKEDITOR.instances),b;for(b in g){var c=g[b];a?c.destroy():c.element.hide()}a&&(g={})})})();CKEDITOR.plugins.add("menu",{requires:"floatpanel",beforeInit:function(g){for(var h=g.config.menu_groups.split(","),m=g._.menuGroups={},l=g._.menuItems={},a=0;a<h.length;a++)m[h[a]]=a+1;g.addMenuGroup=function(b,a){m[b]=a||100};g.addMenuItem=function(a,c){m[c.group]&&(l[a]=new CKEDITOR.menuItem(this,a,c))};g.addMenuItems=function(a){for(var c in a)this.addMenuItem(c,a[c])};g.getMenuItem=function(a){return l[a]};g.removeMenuItem=function(a){delete l[a]}}});
(function(){function g(a){a.sort(function(a,c){return a.group<c.group?-1:a.group>c.group?1:a.order<c.order?-1:a.order>c.order?1:0})}var h='<span class="cke_menuitem"><a id="{id}" class="cke_menubutton cke_menubutton__{name} cke_menubutton_{state} {cls}" href="{href}" title="{title}" tabindex="-1"_cke_focus=1 hidefocus="true" role="{role}" aria-haspopup="{hasPopup}" aria-disabled="{disabled}" {ariaChecked}';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(h+=' onkeypress="return false;"');CKEDITOR.env.gecko&&
(h+=' onblur="this.style.cssText = this.style.cssText;"');var h=h+(' onmouseover="CKEDITOR.tools.callFunction({hoverFn},{index});" onmouseout="CKEDITOR.tools.callFunction({moveOutFn},{index});" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},{index}); return false;">'),m=CKEDITOR.addTemplate("menuItem",h+'<span class="cke_menubutton_inner"><span class="cke_menubutton_icon"><span class="cke_button_icon cke_button__{iconName}_icon" style="{iconStyle}"></span></span><span class="cke_menubutton_label">{label}</span>{arrowHtml}</span></a></span>'),
l=CKEDITOR.addTemplate("menuArrow",'<span class="cke_menuarrow"><span>{label}</span></span>');CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(a,b){b=this._.definition=b||{};this.id=CKEDITOR.tools.getNextId();this.editor=a;this.items=[];this._.listeners=[];this._.level=b.level||1;var c=CKEDITOR.tools.extend({},b.panel,{css:[CKEDITOR.skin.getPath("editor")],level:this._.level-1,block:{}}),k=c.block.attributes=c.attributes||{};!k.role&&(k.role="menu");this._.panelDefinition=c},_:{onShow:function(){var a=
this.editor.getSelection(),b=a&&a.getStartElement(),c=this.editor.elementPath(),k=this._.listeners;this.removeAll();for(var e=0;e<k.length;e++){var j=k[e](b,a,c);if(j)for(var i in j){var f=this.editor.getMenuItem(i);if(f&&(!f.command||this.editor.getCommand(f.command).state))f.state=j[i],this.add(f)}}},onClick:function(a){this.hide();if(a.onClick)a.onClick();else a.command&&this.editor.execCommand(a.command)},onEscape:function(a){var b=this.parent;b?b._.panel.hideChild(1):27==a&&this.hide(1);return!1},
onHide:function(){this.onHide&&this.onHide()},showSubMenu:function(a){var b=this._.subMenu,c=this.items[a];if(c=c.getItems&&c.getItems()){b?b.removeAll():(b=this._.subMenu=new CKEDITOR.menu(this.editor,CKEDITOR.tools.extend({},this._.definition,{level:this._.level+1},!0)),b.parent=this,b._.onClick=CKEDITOR.tools.bind(this._.onClick,this));for(var k in c){var e=this.editor.getMenuItem(k);e&&(e.state=c[k],b.add(e))}var j=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+(""+a));setTimeout(function(){b.show(j,
2)},0)}else this._.panel.hideChild(1)}},proto:{add:function(a){a.order||(a.order=this.items.length);this.items.push(a)},removeAll:function(){this.items=[]},show:function(a,b,c,k){if(!this.parent&&(this._.onShow(),!this.items.length))return;var b=b||("rtl"==this.editor.lang.dir?2:1),e=this.items,j=this.editor,i=this._.panel,f=this._.element;if(!i){i=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),this._.panelDefinition,this._.level);i.onEscape=CKEDITOR.tools.bind(function(a){if(!1===
this._.onEscape(a))return!1},this);i.onShow=function(){i._.panel.getHolderElement().getParent().addClass("cke cke_reset_all")};i.onHide=CKEDITOR.tools.bind(function(){this._.onHide&&this._.onHide()},this);f=i.addBlock(this.id,this._.panelDefinition.block);f.autoSize=!0;var d=f.keys;d[40]="next";d[9]="next";d[38]="prev";d[CKEDITOR.SHIFT+9]="prev";d["rtl"==j.lang.dir?37:39]=CKEDITOR.env.ie?"mouseup":"click";d[32]=CKEDITOR.env.ie?"mouseup":"click";CKEDITOR.env.ie&&(d[13]="mouseup");f=this._.element=
f.element;d=f.getDocument();d.getBody().setStyle("overflow","hidden");d.getElementsByTag("html").getItem(0).setStyle("overflow","hidden");this._.itemOverFn=CKEDITOR.tools.addFunction(function(a){clearTimeout(this._.showSubTimeout);this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,j.config.menu_subMenuDelay||400,this,[a])},this);this._.itemOutFn=CKEDITOR.tools.addFunction(function(){clearTimeout(this._.showSubTimeout)},this);this._.itemClickFn=CKEDITOR.tools.addFunction(function(a){var b=
this.items[a];if(b.state==CKEDITOR.TRISTATE_DISABLED)this.hide(1);else if(b.getItems)this._.showSubMenu(a);else this._.onClick(b)},this)}g(e);for(var d=j.elementPath(),d=['<div class="cke_menu'+(d&&d.direction()!=j.lang.dir?" cke_mixed_dir_content":"")+'" role="presentation">'],h=e.length,m=h&&e[0].group,l=0;l<h;l++){var n=e[l];m!=n.group&&(d.push('<div class="cke_menuseparator" role="separator"></div>'),m=n.group);n.render(this,l,d)}d.push("</div>");f.setHtml(d.join(""));CKEDITOR.ui.fire("ready",
this);this.parent?this.parent._.panel.showAsChild(i,this.id,a,b,c,k):i.showBlock(this.id,a,b,c,k);j.fire("menuShow",[i])},addListener:function(a){this._.listeners.push(a)},hide:function(a){this._.onHide&&this._.onHide();this._.panel&&this._.panel.hide(a)}}});CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(a,b,c){CKEDITOR.tools.extend(this,c,{order:0,className:"cke_menubutton__"+b});this.group=a._.menuGroups[this.group];this.editor=a;this.name=b},proto:{render:function(a,b,c){var h=a.id+(""+
b),e="undefined"==typeof this.state?CKEDITOR.TRISTATE_OFF:this.state,j="",i=e==CKEDITOR.TRISTATE_ON?"on":e==CKEDITOR.TRISTATE_DISABLED?"disabled":"off";this.role in{menuitemcheckbox:1,menuitemradio:1}&&(j=' aria-checked="'+(e==CKEDITOR.TRISTATE_ON?"true":"false")+'"');var f=this.getItems,d="&#"+("rtl"==this.editor.lang.dir?"9668":"9658")+";",g=this.name;this.icon&&!/\./.test(this.icon)&&(g=this.icon);a={id:h,name:this.name,iconName:g,label:this.label,cls:this.className||"",state:i,hasPopup:f?"true":
"false",disabled:e==CKEDITOR.TRISTATE_DISABLED,title:this.label,href:"javascript:void('"+(this.label||"").replace("'")+"')",hoverFn:a._.itemOverFn,moveOutFn:a._.itemOutFn,clickFn:a._.itemClickFn,index:b,iconStyle:CKEDITOR.skin.getIconStyle(g,"rtl"==this.editor.lang.dir,g==this.icon?null:this.icon,this.iconOffset),arrowHtml:f?l.output({label:d}):"",role:this.role?this.role:"menuitem",ariaChecked:j};m.output(a,c)}}})})();CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div";CKEDITOR.plugins.add("contextmenu",{requires:"menu",onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(a){this.base.call(this,a,{panel:{className:"cke_menu_panel",attributes:{"aria-label":a.lang.contextmenu.options}}})},proto:{addTarget:function(a,e){a.on("contextmenu",function(a){var a=a.data,c=CKEDITOR.env.webkit?f:CKEDITOR.env.mac?a.$.metaKey:a.$.ctrlKey;if(!e||!c){a.preventDefault();if(CKEDITOR.env.mac&&CKEDITOR.env.webkit){var c=this.editor,
b=(new CKEDITOR.dom.elementPath(a.getTarget(),c.editable())).contains(function(a){return a.hasAttribute("contenteditable")},!0);b&&"false"==b.getAttribute("contenteditable")&&c.getSelection().fake(b)}var b=a.getTarget().getDocument(),d=a.getTarget().getDocument().getDocumentElement(),c=!b.equals(CKEDITOR.document),b=b.getWindow().getScrollPosition(),g=c?a.$.clientX:a.$.pageX||b.x+a.$.clientX,h=c?a.$.clientY:a.$.pageY||b.y+a.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(d,null,g,h)},CKEDITOR.env.ie?
200:0,this)}},this);if(CKEDITOR.env.webkit){var f,d=function(){f=0};a.on("keydown",function(a){f=CKEDITOR.env.mac?a.data.$.metaKey:a.data.$.ctrlKey});a.on("keyup",d);a.on("contextmenu",d)}},open:function(a,e,f,d){this.editor.focus();a=a||CKEDITOR.document.getDocumentElement();this.editor.selectionChange(1);this.show(a,e,f,d)}}})},beforeInit:function(a){var e=a.contextMenu=new CKEDITOR.plugins.contextMenu(a);a.on("contentDom",function(){e.addTarget(a.editable(),!1!==a.config.browserContextMenuOnCtrl)});
a.addCommand("contextMenu",{exec:function(){a.contextMenu.open(a.document.getBody())}});a.setKeystroke(CKEDITOR.SHIFT+121,"contextMenu");a.setKeystroke(CKEDITOR.CTRL+CKEDITOR.SHIFT+121,"contextMenu")}});CKEDITOR.plugins.add("divarea",{afterInit:function(a){a.addMode("wysiwyg",function(c){var b=CKEDITOR.dom.element.createFromHtml('<div class="cke_wysiwyg_div cke_reset" hidefocus="true"></div>');a.ui.space("contents").append(b);b=a.editable(b);b.detach=CKEDITOR.tools.override(b.detach,function(a){return function(){a.apply(this,arguments);this.remove()}});a.setData(a.getData(1),c);a.fire("contentDom")})}});(function(){function m(c,e,b){b=c.config.forceEnterMode||b;"wysiwyg"==c.mode&&(e||(e=c.activeEnterMode),c.elementPath().isContextFor("p")||(e=CKEDITOR.ENTER_BR,b=1),c.fire("saveSnapshot"),e==CKEDITOR.ENTER_BR?p(c,e,null,b):q(c,e,null,b),c.fire("saveSnapshot"))}function r(c){for(var c=c.getSelection().getRanges(!0),e=c.length-1;0<e;e--)c[e].deleteContents();return c[0]}CKEDITOR.plugins.add("enterkey",{init:function(c){c.addCommand("enter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(c){m(c)}});
c.addCommand("shiftEnter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(c){m(c,c.activeShiftEnterMode,1)}});c.setKeystroke([[13,"enter"],[CKEDITOR.SHIFT+13,"shiftEnter"]])}});var u=CKEDITOR.dom.walker.whitespaces(),v=CKEDITOR.dom.walker.bookmark();CKEDITOR.plugins.enterkey={enterBlock:function(c,e,b,h){if(b=b||r(c)){var f=b.document,i=b.checkStartOfBlock(),k=b.checkEndOfBlock(),j=c.elementPath(b.startContainer),a=j.block,l=e==CKEDITOR.ENTER_DIV?"div":"p",d;if(i&&k){if(a&&(a.is("li")||a.getParent().is("li"))){a.is("li")||
(a=a.getParent());b=a.getParent();d=b.getParent();var h=!a.hasPrevious(),n=!a.hasNext(),l=c.getSelection(),g=l.createBookmarks(),i=a.getDirection(1),k=a.getAttribute("class"),o=a.getAttribute("style"),m=d.getDirection(1)!=i,c=c.enterMode!=CKEDITOR.ENTER_BR||m||o||k;if(d.is("li"))if(h||n)a[h?"insertBefore":"insertAfter"](d);else a.breakParent(d);else{if(c)if(j.block.is("li")?(d=f.createElement(e==CKEDITOR.ENTER_P?"p":"div"),m&&d.setAttribute("dir",i),o&&d.setAttribute("style",o),k&&d.setAttribute("class",
k),a.moveChildren(d)):d=j.block,h||n)d[h?"insertBefore":"insertAfter"](b);else a.breakParent(b),d.insertAfter(b);else if(a.appendBogus(!0),h||n)for(;f=a[h?"getFirst":"getLast"]();)f[h?"insertBefore":"insertAfter"](b);else for(a.breakParent(b);f=a.getLast();)f.insertAfter(b);a.remove()}l.selectBookmarks(g);return}if(a&&a.getParent().is("blockquote")){a.breakParent(a.getParent());a.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||a.getPrevious().remove();a.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||
a.getNext().remove();b.moveToElementEditStart(a);b.select();return}}else if(a&&a.is("pre")&&!k){p(c,e,b,h);return}if(i=b.splitBlock(l)){e=i.previousBlock;a=i.nextBlock;j=i.wasStartOfBlock;c=i.wasEndOfBlock;if(a)g=a.getParent(),g.is("li")&&(a.breakParent(g),a.move(a.getNext(),1));else if(e&&(g=e.getParent())&&g.is("li"))e.breakParent(g),g=e.getNext(),b.moveToElementEditStart(g),e.move(e.getPrevious());if(!j&&!c)a.is("li")&&(d=b.clone(),d.selectNodeContents(a),d=new CKEDITOR.dom.walker(d),d.evaluator=
function(a){return!(v(a)||u(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in CKEDITOR.dtd.$inline&&!(a.getName()in CKEDITOR.dtd.$empty))},(g=d.next())&&(g.type==CKEDITOR.NODE_ELEMENT&&g.is("ul","ol"))&&(CKEDITOR.env.needsBrFiller?f.createElement("br"):f.createText("Â ")).insertBefore(g)),a&&b.moveToElementEditStart(a);else{if(e){if(e.is("li")||!s.test(e.getName())&&!e.is("pre"))d=e.clone()}else a&&(d=a.clone());d?h&&!d.is("li")&&d.renameNode(l):g&&g.is("li")?d=g:(d=f.createElement(l),e&&(n=e.getDirection())&&
d.setAttribute("dir",n));if(f=i.elementPath){h=0;for(l=f.elements.length;h<l;h++){g=f.elements[h];if(g.equals(f.block)||g.equals(f.blockLimit))break;CKEDITOR.dtd.$removeEmpty[g.getName()]&&(g=g.clone(),d.moveChildren(g),d.append(g))}}d.appendBogus();d.getParent()||b.insertNode(d);d.is("li")&&d.removeAttribute("value");if(CKEDITOR.env.ie&&j&&(!c||!e.getChildCount()))b.moveToElementEditStart(c?e:d),b.select();b.moveToElementEditStart(j&&!c?a:d)}b.select();b.scrollIntoView()}}},enterBr:function(c,e,
b,h){if(b=b||r(c)){var f=b.document,i=b.checkEndOfBlock(),k=new CKEDITOR.dom.elementPath(c.getSelection().getStartElement()),j=k.block,a=j&&k.block.getName();!h&&"li"==a?q(c,e,b,h):(!h&&i&&s.test(a)?(i=j.getDirection())?(f=f.createElement("div"),f.setAttribute("dir",i),f.insertAfter(j),b.setStart(f,0)):(f.createElement("br").insertAfter(j),CKEDITOR.env.gecko&&f.createText("").insertAfter(j),b.setStartAt(j.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(c=
"pre"==a&&CKEDITOR.env.ie&&8>CKEDITOR.env.version?f.createText("\r"):f.createElement("br"),b.deleteContents(),b.insertNode(c),CKEDITOR.env.needsBrFiller?(f.createText("ï»¿").insertAfter(c),i&&(j||k.blockLimit).appendBogus(),c.getNext().$.nodeValue="",b.setStartAt(c.getNext(),CKEDITOR.POSITION_AFTER_START)):b.setStartAt(c,CKEDITOR.POSITION_AFTER_END)),b.collapse(!0),b.select(),b.scrollIntoView())}}};var t=CKEDITOR.plugins.enterkey,p=t.enterBr,q=t.enterBlock,s=/^h[1-6]$/})();(function(){function j(a,b){var d={},e=[],f={nbsp:"Â ",shy:"Â­",gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},a=a.replace(/\b(nbsp|shy|gt|lt|amp|apos|quot)(?:,|$)/g,function(a,h){var c=b?"&"+h+";":f[h];d[c]=b?f[h]:"&"+h+";";e.push(c);return""});if(!b&&a){var a=a.split(","),c=document.createElement("div"),g;c.innerHTML="&"+a.join(";&")+";";g=c.innerHTML;c=null;for(c=0;c<g.length;c++){var i=g.charAt(c);d[i]="&"+a[c]+";";e.push(i)}}d.regex=e.join(b?"|":"");return d}CKEDITOR.plugins.add("entities",{afterInit:function(a){var b=
a.config;if(a=(a=a.dataProcessor)&&a.htmlFilter){var d=[];!1!==b.basicEntities&&d.push("nbsp,gt,lt,amp");b.entities&&(d.length&&d.push("quot,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,times,divide,fnof,bull,hellip,prime,Prime,oline,frasl,weierp,image,real,trade,alefsym,larr,uarr,rarr,darr,harr,crarr,lArr,uArr,rArr,dArr,hArr,forall,part,exist,empty,nabla,isin,notin,ni,prod,sum,minus,lowast,radic,prop,infin,ang,and,or,cap,cup,int,there4,sim,cong,asymp,ne,equiv,le,ge,sub,sup,nsub,sube,supe,oplus,otimes,perp,sdot,lceil,rceil,lfloor,rfloor,lang,rang,loz,spades,clubs,hearts,diams,circ,tilde,ensp,emsp,thinsp,zwnj,zwj,lrm,rlm,ndash,mdash,lsquo,rsquo,sbquo,ldquo,rdquo,bdquo,dagger,Dagger,permil,lsaquo,rsaquo,euro"),
b.entities_latin&&d.push("Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml,OElig,oelig,Scaron,scaron,Yuml"),b.entities_greek&&d.push("Alpha,Beta,Gamma,Delta,Epsilon,Zeta,Eta,Theta,Iota,Kappa,Lambda,Mu,Nu,Xi,Omicron,Pi,Rho,Sigma,Tau,Upsilon,Phi,Chi,Psi,Omega,alpha,beta,gamma,delta,epsilon,zeta,eta,theta,iota,kappa,lambda,mu,nu,xi,omicron,pi,rho,sigmaf,sigma,tau,upsilon,phi,chi,psi,omega,thetasym,upsih,piv"),
b.entities_additional&&d.push(b.entities_additional));var e=j(d.join(",")),f=e.regex?"["+e.regex+"]":"a^";delete e.regex;b.entities&&b.entities_processNumerical&&(f="[^ -~]|"+f);var f=RegExp(f,"g"),c=function(a){return b.entities_processNumerical=="force"||!e[a]?"&#"+a.charCodeAt(0)+";":e[a]},g=j("nbsp,gt,lt,amp,shy",!0),i=RegExp(g.regex,"g"),k=function(a){return g[a]};a.addRules({text:function(a){return a.replace(i,k).replace(f,c)}},{applyToAll:!0,excludeNestedEditable:!0})}}})})();
CKEDITOR.config.basicEntities=!0;CKEDITOR.config.entities=!0;CKEDITOR.config.entities_latin=!0;CKEDITOR.config.entities_greek=!0;CKEDITOR.config.entities_additional="#39";CKEDITOR.plugins.add("htmlwriter",{init:function(b){var a=new CKEDITOR.htmlWriter;a.forceSimpleAmpersand=b.config.forceSimpleAmpersand;a.indentationChars=b.config.dataIndentationChars||"\t";b.dataProcessor.writer=a}});
CKEDITOR.htmlWriter=CKEDITOR.tools.createClass({base:CKEDITOR.htmlParser.basicWriter,$:function(){this.base();this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.sortAttributes=1;this._.indent=0;this._.indentation="";this._.inPre=0;this._.rules={};var b=CKEDITOR.dtd,a;for(a in CKEDITOR.tools.extend({},b.$nonBodyContent,b.$block,b.$listItem,b.$tableContent))this.setRules(a,{indent:!b[a]["#"],breakBeforeOpen:1,breakBeforeClose:!b[a]["#"],breakAfterClose:1,needsSpace:a in
b.$block&&!(a in{li:1,dt:1,dd:1})});this.setRules("br",{breakAfterOpen:1});this.setRules("title",{indent:0,breakAfterOpen:0});this.setRules("style",{indent:0,breakBeforeClose:1});this.setRules("pre",{breakAfterOpen:1,indent:0})},proto:{openTag:function(b){var a=this._.rules[b];this._.afterCloser&&(a&&a.needsSpace&&this._.needsSpace)&&this._.output.push("\n");this._.indent?this.indentation():a&&a.breakBeforeOpen&&(this.lineBreak(),this.indentation());this._.output.push("<",b);this._.afterCloser=0},
openTagClose:function(b,a){var c=this._.rules[b];a?(this._.output.push(this.selfClosingEnd),c&&c.breakAfterClose&&(this._.needsSpace=c.needsSpace)):(this._.output.push(">"),c&&c.indent&&(this._.indentation+=this.indentationChars));c&&c.breakAfterOpen&&this.lineBreak();"pre"==b&&(this._.inPre=1)},attribute:function(b,a){"string"==typeof a&&(this.forceSimpleAmpersand&&(a=a.replace(/&amp;/g,"&")),a=CKEDITOR.tools.htmlEncodeAttr(a));this._.output.push(" ",b,'="',a,'"')},closeTag:function(b){var a=this._.rules[b];
a&&a.indent&&(this._.indentation=this._.indentation.substr(this.indentationChars.length));this._.indent?this.indentation():a&&a.breakBeforeClose&&(this.lineBreak(),this.indentation());this._.output.push("</",b,">");"pre"==b&&(this._.inPre=0);a&&a.breakAfterClose&&(this.lineBreak(),this._.needsSpace=a.needsSpace);this._.afterCloser=1},text:function(b){this._.indent&&(this.indentation(),!this._.inPre&&(b=CKEDITOR.tools.ltrim(b)));this._.output.push(b)},comment:function(b){this._.indent&&this.indentation();
this._.output.push("<\!--",b,"--\>")},lineBreak:function(){!this._.inPre&&0<this._.output.length&&this._.output.push(this.lineBreakChars);this._.indent=1},indentation:function(){!this._.inPre&&this._.indentation&&this._.output.push(this._.indentation);this._.indent=0},reset:function(){this._.output=[];this._.indent=0;this._.indentation="";this._.afterCloser=0;this._.inPre=0},setRules:function(b,a){var c=this._.rules[b];c?CKEDITOR.tools.extend(c,a,!0):this._.rules[b]=a}}});(function(){function k(a,b){var e,f;b.on("refresh",function(a){var b=[i],c;for(c in a.data.states)b.push(a.data.states[c]);this.setState(CKEDITOR.tools.search(b,m)?m:i)},b,null,100);b.on("exec",function(b){e=a.getSelection();f=e.createBookmarks(1);b.data||(b.data={});b.data.done=!1},b,null,0);b.on("exec",function(){a.forceNextSelectionCheck();e.selectBookmarks(f)},b,null,100)}var i=CKEDITOR.TRISTATE_DISABLED,m=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indent",{init:function(a){var b=CKEDITOR.plugins.indent.genericDefinition;
k(a,a.addCommand("indent",new b(!0)));k(a,a.addCommand("outdent",new b));a.ui.addButton&&(a.ui.addButton("Indent",{label:a.lang.indent.indent,command:"indent",directional:!0,toolbar:"indent,20"}),a.ui.addButton("Outdent",{label:a.lang.indent.outdent,command:"outdent",directional:!0,toolbar:"indent,10"}));a.on("dirChanged",function(b){var f=a.createRange(),j=b.data.node;f.setStartBefore(j);f.setEndAfter(j);for(var l=new CKEDITOR.dom.walker(f),c;c=l.next();)if(c.type==CKEDITOR.NODE_ELEMENT)if(!c.equals(j)&&
c.getDirection()){f.setStartAfter(c);l=new CKEDITOR.dom.walker(f)}else{var d=a.config.indentClasses;if(d)for(var g=b.data.dir=="ltr"?["_rtl",""]:["","_rtl"],h=0;h<d.length;h++)if(c.hasClass(d[h]+g[0])){c.removeClass(d[h]+g[0]);c.addClass(d[h]+g[1])}d=c.getStyle("margin-right");g=c.getStyle("margin-left");d?c.setStyle("margin-left",d):c.removeStyle("margin-left");g?c.setStyle("margin-right",g):c.removeStyle("margin-right")}})}});CKEDITOR.plugins.indent={genericDefinition:function(a){this.isIndent=
!!a;this.startDisabled=!this.isIndent},specificDefinition:function(a,b,e){this.name=b;this.editor=a;this.jobs={};this.enterBr=a.config.enterMode==CKEDITOR.ENTER_BR;this.isIndent=!!e;this.relatedGlobal=e?"indent":"outdent";this.indentKey=e?9:CKEDITOR.SHIFT+9;this.database={}},registerCommands:function(a,b){a.on("pluginsLoaded",function(){for(var a in b)(function(a,b){var e=a.getCommand(b.relatedGlobal),c;for(c in b.jobs)e.on("exec",function(d){d.data.done||(a.fire("lockSnapshot"),b.execJob(a,c)&&(d.data.done=
!0),a.fire("unlockSnapshot"),CKEDITOR.dom.element.clearAllMarkers(b.database))},this,null,c),e.on("refresh",function(d){d.data.states||(d.data.states={});d.data.states[b.name+"@"+c]=b.refreshJob(a,c,d.data.path)},this,null,c);a.addFeature(b)})(this,b[a])})}};CKEDITOR.plugins.indent.genericDefinition.prototype={context:"p",exec:function(){}};CKEDITOR.plugins.indent.specificDefinition.prototype={execJob:function(a,b){var e=this.jobs[b];if(e.state!=i)return e.exec.call(this,a)},refreshJob:function(a,
b,e){b=this.jobs[b];b.state=a.activeFilter.checkFeature(this)?b.refresh.call(this,a,e):i;return b.state},getContext:function(a){return a.contains(this.context)}}})();(function(){function h(b,c,a){if(!b.getCustomData("indent_processed")){var d=this.editor,f=this.isIndent;if(c){d=b.$.className.match(this.classNameRegex);a=0;d&&(d=d[1],a=CKEDITOR.tools.indexOf(c,d)+1);if(0>(a+=f?1:-1))return;a=Math.min(a,c.length);a=Math.max(a,0);b.$.className=CKEDITOR.tools.ltrim(b.$.className.replace(this.classNameRegex,""));0<a&&b.addClass(c[a-1])}else{var c=i(b,a),a=parseInt(b.getStyle(c),10),g=d.config.indentOffset||40;isNaN(a)&&(a=0);a+=(f?1:-1)*g;if(0>a)return;a=Math.max(a,
0);a=Math.ceil(a/g)*g;b.setStyle(c,a?a+(d.config.indentUnit||"px"):"");""===b.getAttribute("style")&&b.removeAttribute("style")}CKEDITOR.dom.element.setMarker(this.database,b,"indent_processed",1)}}function i(b,c){return"ltr"==(c||b.getComputedStyle("direction"))?"margin-left":"margin-right"}var j=CKEDITOR.dtd.$listItem,l=CKEDITOR.dtd.$list,f=CKEDITOR.TRISTATE_DISABLED,k=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentblock",{requires:"indent",init:function(b){function c(b,c){a.specificDefinition.apply(this,
arguments);this.allowedContent={"div h1 h2 h3 h4 h5 h6 ol p pre ul":{propertiesOnly:!0,styles:!d?"margin-left,margin-right":null,classes:d||null}};this.enterBr&&(this.allowedContent.div=!0);this.requiredContent=(this.enterBr?"div":"p")+(d?"("+d.join(",")+")":"{margin-left}");this.jobs={20:{refresh:function(a,b){var e=b.block||b.blockLimit;if(e.is(j))e=e.getParent();else if(e.getAscendant(j))return f;if(!this.enterBr&&!this.getContext(b))return f;if(d){var c;c=d;var e=e.$.className.match(this.classNameRegex),
g=this.isIndent;c=e?g?e[1]!=c.slice(-1):true:g;return c?k:f}return this.isIndent?k:e?CKEDITOR[(parseInt(e.getStyle(i(e)),10)||0)<=0?"TRISTATE_DISABLED":"TRISTATE_OFF"]:f},exec:function(a){var b=a.getSelection(),b=b&&b.getRanges()[0],c;if(c=a.elementPath().contains(l))h.call(this,c,d);else{b=b.createIterator();a=a.config.enterMode;b.enforceRealBlocks=true;for(b.enlargeBr=a!=CKEDITOR.ENTER_BR;c=b.getNextParagraph(a==CKEDITOR.ENTER_P?"p":"div");)c.isReadOnly()||h.call(this,c,d)}return true}}}}var a=
CKEDITOR.plugins.indent,d=b.config.indentClasses;a.registerCommands(b,{indentblock:new c(b,"indentblock",!0),outdentblock:new c(b,"outdentblock")});CKEDITOR.tools.extend(c.prototype,a.specificDefinition.prototype,{context:{div:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,p:1,pre:1,table:1},classNameRegex:d?RegExp("(?:^|\\s+)("+d.join("|")+")(?=$|\\s)"):null})}})})();(function(){function s(e){function g(b){for(var f=d.startContainer,a=d.endContainer;f&&!f.getParent().equals(b);)f=f.getParent();for(;a&&!a.getParent().equals(b);)a=a.getParent();if(!f||!a)return!1;for(var h=f,f=[],c=!1;!c;)h.equals(a)&&(c=!0),f.push(h),h=h.getNext();if(1>f.length)return!1;h=b.getParents(!0);for(a=0;a<h.length;a++)if(h[a].getName&&k[h[a].getName()]){b=h[a];break}for(var h=n.isIndent?1:-1,a=f[0],f=f[f.length-1],c=CKEDITOR.plugins.list.listToArray(b,o),g=c[f.getCustomData("listarray_index")].indent,
a=a.getCustomData("listarray_index");a<=f.getCustomData("listarray_index");a++)if(c[a].indent+=h,0<h){var l=c[a].parent;c[a].parent=new CKEDITOR.dom.element(l.getName(),l.getDocument())}for(a=f.getCustomData("listarray_index")+1;a<c.length&&c[a].indent>g;a++)c[a].indent+=h;f=CKEDITOR.plugins.list.arrayToList(c,o,null,e.config.enterMode,b.getDirection());if(!n.isIndent){var i;if((i=b.getParent())&&i.is("li"))for(var h=f.listNode.getChildren(),m=[],j,a=h.count()-1;0<=a;a--)(j=h.getItem(a))&&(j.is&&
j.is("li"))&&m.push(j)}f&&f.listNode.replace(b);if(m&&m.length)for(a=0;a<m.length;a++){for(j=b=m[a];(j=j.getNext())&&j.is&&j.getName()in k;)CKEDITOR.env.needsNbspFiller&&!b.getFirst(t)&&b.append(d.document.createText("Â ")),b.append(j);b.insertAfter(i)}f&&e.fire("contentDomInvalidated");return!0}for(var n=this,o=this.database,k=this.context,l=e.getSelection(),l=(l&&l.getRanges()).createIterator(),d;d=l.getNextRange();){for(var b=d.getCommonAncestor();b&&!(b.type==CKEDITOR.NODE_ELEMENT&&k[b.getName()]);)b=
b.getParent();b||(b=d.startPath().contains(k))&&d.setEndAt(b,CKEDITOR.POSITION_BEFORE_END);if(!b){var c=d.getEnclosedNode();c&&(c.type==CKEDITOR.NODE_ELEMENT&&c.getName()in k)&&(d.setStartAt(c,CKEDITOR.POSITION_AFTER_START),d.setEndAt(c,CKEDITOR.POSITION_BEFORE_END),b=c)}b&&(d.startContainer.type==CKEDITOR.NODE_ELEMENT&&d.startContainer.getName()in k)&&(c=new CKEDITOR.dom.walker(d),c.evaluator=i,d.startContainer=c.next());b&&(d.endContainer.type==CKEDITOR.NODE_ELEMENT&&d.endContainer.getName()in k)&&
(c=new CKEDITOR.dom.walker(d),c.evaluator=i,d.endContainer=c.previous());if(b)return g(b)}return 0}function p(e,g){g||(g=e.contains(this.context));return g&&e.block&&e.block.equals(g.getFirst(i))}function i(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is("li")}function t(e){return u(e)&&v(e)}var u=CKEDITOR.dom.walker.whitespaces(!0),v=CKEDITOR.dom.walker.bookmark(!1,!0),q=CKEDITOR.TRISTATE_DISABLED,r=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentlist",{requires:"indent",init:function(e){function g(e,
g){i.specificDefinition.apply(this,arguments);this.requiredContent=["ul","ol"];e.on("key",function(g){if("wysiwyg"==e.mode&&g.data.keyCode==this.indentKey){var d=this.getContext(e.elementPath());if(d&&(!this.isIndent||!p.call(this,e.elementPath(),d)))e.execCommand(this.relatedGlobal),g.cancel()}},this);this.jobs[this.isIndent?10:30]={refresh:this.isIndent?function(e,d){var b=this.getContext(d),c=p.call(this,d,b);return!b||!this.isIndent||c?q:r}:function(e,d){return!this.getContext(d)||this.isIndent?
q:r},exec:CKEDITOR.tools.bind(s,this)}}var i=CKEDITOR.plugins.indent;i.registerCommands(e,{indentlist:new g(e,"indentlist",!0),outdentlist:new g(e,"outdentlist")});CKEDITOR.tools.extend(g.prototype,i.specificDefinition.prototype,{context:{ol:1,ul:1}})}})})();(function(){function E(c,j,e){function b(b){if((d=a[b?"getFirst":"getLast"]())&&(!d.is||!d.isBlockBoundary())&&(m=j.root[b?"getPrevious":"getNext"](CKEDITOR.dom.walker.invisible(!0)))&&(!m.is||!m.isBlockBoundary({br:1})))c.document.createElement("br")[b?"insertBefore":"insertAfter"](d)}for(var k=CKEDITOR.plugins.list.listToArray(j.root,e),g=[],h=0;h<j.contents.length;h++){var f=j.contents[h];if((f=f.getAscendant("li",!0))&&!f.getCustomData("list_item_processed"))g.push(f),CKEDITOR.dom.element.setMarker(e,
f,"list_item_processed",!0)}f=null;for(h=0;h<g.length;h++)f=g[h].getCustomData("listarray_index"),k[f].indent=-1;for(h=f+1;h<k.length;h++)if(k[h].indent>k[h-1].indent+1){g=k[h-1].indent+1-k[h].indent;for(f=k[h].indent;k[h]&&k[h].indent>=f;)k[h].indent+=g,h++;h--}var a=CKEDITOR.plugins.list.arrayToList(k,e,null,c.config.enterMode,j.root.getAttribute("dir")).listNode,d,m;b(!0);b();a.replace(j.root);c.fire("contentDomInvalidated")}function x(c,j){this.name=c;this.context=this.type=j;this.allowedContent=
j+" li";this.requiredContent=j}function A(c,j,e,b){for(var k,g;k=c[b?"getLast":"getFirst"](F);)(g=k.getDirection(1))!==j.getDirection(1)&&k.setAttribute("dir",g),k.remove(),e?k[b?"insertBefore":"insertAfter"](e):j.append(k,b)}function B(c){var j;(j=function(e){var b=c[e?"getPrevious":"getNext"](q);b&&(b.type==CKEDITOR.NODE_ELEMENT&&b.is(c.getName()))&&(A(c,b,null,!e),c.remove(),c=b)})();j(1)}function C(c){return c.type==CKEDITOR.NODE_ELEMENT&&(c.getName()in CKEDITOR.dtd.$block||c.getName()in CKEDITOR.dtd.$listItem)&&
CKEDITOR.dtd[c.getName()]["#"]}function y(c,j,e){c.fire("saveSnapshot");e.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var b=e.extractContents();j.trim(!1,!0);var k=j.createBookmark(),g=new CKEDITOR.dom.elementPath(j.startContainer),h=g.block,g=g.lastElement.getAscendant("li",1)||h,f=new CKEDITOR.dom.elementPath(e.startContainer),a=f.contains(CKEDITOR.dtd.$listItem),f=f.contains(CKEDITOR.dtd.$list);h?(h=h.getBogus())&&h.remove():f&&(h=f.getPrevious(q))&&v(h)&&h.remove();(h=b.getLast())&&(h.type==
CKEDITOR.NODE_ELEMENT&&h.is("br"))&&h.remove();(h=j.startContainer.getChild(j.startOffset))?b.insertBefore(h):j.startContainer.append(b);if(a&&(b=w(a)))g.contains(a)?(A(b,a.getParent(),a),b.remove()):g.append(b);for(;e.checkStartOfBlock()&&e.checkEndOfBlock();){f=e.startPath();b=f.block;if(!b)break;b.is("li")&&(g=b.getParent(),b.equals(g.getLast(q))&&b.equals(g.getFirst(q))&&(b=g));e.moveToPosition(b,CKEDITOR.POSITION_BEFORE_START);b.remove()}e=e.clone();b=c.editable();e.setEndAt(b,CKEDITOR.POSITION_BEFORE_END);
e=new CKEDITOR.dom.walker(e);e.evaluator=function(a){return q(a)&&!v(a)};(e=e.next())&&(e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in CKEDITOR.dtd.$list)&&B(e);j.moveToBookmark(k);j.select();c.fire("saveSnapshot")}function w(c){return(c=c.getLast(q))&&c.type==CKEDITOR.NODE_ELEMENT&&c.getName()in r?c:null}var r={ol:1,ul:1},G=CKEDITOR.dom.walker.whitespaces(),D=CKEDITOR.dom.walker.bookmark(),q=function(c){return!(G(c)||D(c))},v=CKEDITOR.dom.walker.bogus();CKEDITOR.plugins.list={listToArray:function(c,
j,e,b,k){if(!r[c.getName()])return[];b||(b=0);e||(e=[]);for(var g=0,h=c.getChildCount();g<h;g++){var f=c.getChild(g);f.type==CKEDITOR.NODE_ELEMENT&&f.getName()in CKEDITOR.dtd.$list&&CKEDITOR.plugins.list.listToArray(f,j,e,b+1);if("li"==f.$.nodeName.toLowerCase()){var a={parent:c,indent:b,element:f,contents:[]};k?a.grandparent=k:(a.grandparent=c.getParent(),a.grandparent&&"li"==a.grandparent.$.nodeName.toLowerCase()&&(a.grandparent=a.grandparent.getParent()));j&&CKEDITOR.dom.element.setMarker(j,f,
"listarray_index",e.length);e.push(a);for(var d=0,m=f.getChildCount(),i;d<m;d++)i=f.getChild(d),i.type==CKEDITOR.NODE_ELEMENT&&r[i.getName()]?CKEDITOR.plugins.list.listToArray(i,j,e,b+1,a.grandparent):a.contents.push(i)}}return e},arrayToList:function(c,j,e,b,k){e||(e=0);if(!c||c.length<e+1)return null;for(var g,h=c[e].parent.getDocument(),f=new CKEDITOR.dom.documentFragment(h),a=null,d=e,m=Math.max(c[e].indent,0),i=null,n,l,p=b==CKEDITOR.ENTER_P?"p":"div";;){var o=c[d];g=o.grandparent;n=o.element.getDirection(1);
if(o.indent==m){if(!a||c[d].parent.getName()!=a.getName())a=c[d].parent.clone(!1,1),k&&a.setAttribute("dir",k),f.append(a);i=a.append(o.element.clone(0,1));n!=a.getDirection(1)&&i.setAttribute("dir",n);for(g=0;g<o.contents.length;g++)i.append(o.contents[g].clone(1,1));d++}else if(o.indent==Math.max(m,0)+1)o=c[d-1].element.getDirection(1),d=CKEDITOR.plugins.list.arrayToList(c,null,d,b,o!=n?n:null),!i.getChildCount()&&(CKEDITOR.env.needsNbspFiller&&!(7<h.$.documentMode))&&i.append(h.createText("Â ")),
i.append(d.listNode),d=d.nextIndex;else if(-1==o.indent&&!e&&g){r[g.getName()]?(i=o.element.clone(!1,!0),n!=g.getDirection(1)&&i.setAttribute("dir",n)):i=new CKEDITOR.dom.documentFragment(h);var a=g.getDirection(1)!=n,u=o.element,z=u.getAttribute("class"),v=u.getAttribute("style"),w=i.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(b!=CKEDITOR.ENTER_BR||a||v||z),s,x=o.contents.length,t;for(g=0;g<x;g++)if(s=o.contents[g],D(s)&&1<x)w?t=s.clone(1,1):i.append(s.clone(1,1));else if(s.type==CKEDITOR.NODE_ELEMENT&&
s.isBlockBoundary()){a&&!s.getDirection()&&s.setAttribute("dir",n);l=s;var y=u.getAttribute("style");y&&l.setAttribute("style",y.replace(/([^;])$/,"$1;")+(l.getAttribute("style")||""));z&&s.addClass(z);l=null;t&&(i.append(t),t=null);i.append(s.clone(1,1))}else w?(l||(l=h.createElement(p),i.append(l),a&&l.setAttribute("dir",n)),v&&l.setAttribute("style",v),z&&l.setAttribute("class",z),t&&(l.append(t),t=null),l.append(s.clone(1,1))):i.append(s.clone(1,1));t&&((l||i).append(t),t=null);i.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&
d!=c.length-1&&(CKEDITOR.env.needsBrFiller&&(n=i.getLast())&&(n.type==CKEDITOR.NODE_ELEMENT&&n.is("br"))&&n.remove(),n=i.getLast(q),(!n||!(n.type==CKEDITOR.NODE_ELEMENT&&n.is(CKEDITOR.dtd.$block)))&&i.append(h.createElement("br")));n=i.$.nodeName.toLowerCase();("div"==n||"p"==n)&&i.appendBogus();f.append(i);a=null;d++}else return null;l=null;if(c.length<=d||Math.max(c[d].indent,0)<m)break}if(j)for(c=f.getFirst();c;){if(c.type==CKEDITOR.NODE_ELEMENT&&(CKEDITOR.dom.element.clearMarkers(j,c),c.getName()in
CKEDITOR.dtd.$listItem&&(e=c,h=k=b=void 0,b=e.getDirection()))){for(k=e.getParent();k&&!(h=k.getDirection());)k=k.getParent();b==h&&e.removeAttribute("dir")}c=c.getNextSourceNode()}return{listNode:f,nextIndex:d}}};var H=/^h[1-6]$/,F=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);x.prototype={exec:function(c){this.refresh(c,c.elementPath());var j=c.config,e=c.getSelection(),b=e&&e.getRanges();if(this.state==CKEDITOR.TRISTATE_OFF){var k=c.editable();if(k.getFirst(q)){var g=1==b.length&&b[0];(j=
g&&g.getEnclosedNode())&&(j.is&&this.type==j.getName())&&this.setState(CKEDITOR.TRISTATE_ON)}else j.enterMode==CKEDITOR.ENTER_BR?k.appendBogus():b[0].fixBlock(1,j.enterMode==CKEDITOR.ENTER_P?"p":"div"),e.selectRanges(b)}for(var j=e.createBookmarks(!0),k=[],h={},b=b.createIterator(),f=0;(g=b.getNextRange())&&++f;){var a=g.getBoundaryNodes(),d=a.startNode,m=a.endNode;d.type==CKEDITOR.NODE_ELEMENT&&"td"==d.getName()&&g.setStartAt(a.startNode,CKEDITOR.POSITION_AFTER_START);m.type==CKEDITOR.NODE_ELEMENT&&
"td"==m.getName()&&g.setEndAt(a.endNode,CKEDITOR.POSITION_BEFORE_END);g=g.createIterator();for(g.forceBrBreak=this.state==CKEDITOR.TRISTATE_OFF;a=g.getNextParagraph();)if(!a.getCustomData("list_block")){CKEDITOR.dom.element.setMarker(h,a,"list_block",1);for(var i=c.elementPath(a),d=i.elements,m=0,i=i.blockLimit,n,l=d.length-1;0<=l&&(n=d[l]);l--)if(r[n.getName()]&&i.contains(n)){i.removeCustomData("list_group_object_"+f);(d=n.getCustomData("list_group_object"))?d.contents.push(a):(d={root:n,contents:[a]},
k.push(d),CKEDITOR.dom.element.setMarker(h,n,"list_group_object",d));m=1;break}m||(m=i,m.getCustomData("list_group_object_"+f)?m.getCustomData("list_group_object_"+f).contents.push(a):(d={root:m,contents:[a]},CKEDITOR.dom.element.setMarker(h,m,"list_group_object_"+f,d),k.push(d)))}}for(n=[];0<k.length;)if(d=k.shift(),this.state==CKEDITOR.TRISTATE_OFF)if(r[d.root.getName()]){b=c;f=d;d=h;g=n;m=CKEDITOR.plugins.list.listToArray(f.root,d);i=[];for(a=0;a<f.contents.length;a++)if(l=f.contents[a],(l=l.getAscendant("li",
!0))&&!l.getCustomData("list_item_processed"))i.push(l),CKEDITOR.dom.element.setMarker(d,l,"list_item_processed",!0);for(var l=f.root.getDocument(),p=void 0,o=void 0,a=0;a<i.length;a++){var u=i[a].getCustomData("listarray_index"),p=m[u].parent;p.is(this.type)||(o=l.createElement(this.type),p.copyAttributes(o,{start:1,type:1}),o.removeStyle("list-style-type"),m[u].parent=o)}d=CKEDITOR.plugins.list.arrayToList(m,d,null,b.config.enterMode);m=void 0;i=d.listNode.getChildCount();for(a=0;a<i&&(m=d.listNode.getChild(a));a++)m.getName()==
this.type&&g.push(m);d.listNode.replace(f.root);b.fire("contentDomInvalidated")}else{m=c;a=d;g=n;i=a.contents;b=a.root.getDocument();f=[];1==i.length&&i[0].equals(a.root)&&(d=b.createElement("div"),i[0].moveChildren&&i[0].moveChildren(d),i[0].append(d),i[0]=d);a=a.contents[0].getParent();for(l=0;l<i.length;l++)a=a.getCommonAncestor(i[l].getParent());p=m.config.useComputedState;m=d=void 0;p=void 0===p||p;for(l=0;l<i.length;l++)for(o=i[l];u=o.getParent();){if(u.equals(a)){f.push(o);!m&&o.getDirection()&&
(m=1);o=o.getDirection(p);null!==d&&(d=d&&d!=o?null:o);break}o=u}if(!(1>f.length)){i=f[f.length-1].getNext();l=b.createElement(this.type);g.push(l);for(p=g=void 0;f.length;)g=f.shift(),p=b.createElement("li"),g.is("pre")||H.test(g.getName())||"false"==g.getAttribute("contenteditable")?g.appendTo(p):(g.copyAttributes(p),d&&g.getDirection()&&(p.removeStyle("direction"),p.removeAttribute("dir")),g.moveChildren(p),g.remove()),p.appendTo(l);d&&m&&l.setAttribute("dir",d);i?l.insertBefore(i):l.appendTo(a)}}else this.state==
CKEDITOR.TRISTATE_ON&&r[d.root.getName()]&&E.call(this,c,d,h);for(l=0;l<n.length;l++)B(n[l]);CKEDITOR.dom.element.clearAllMarkers(h);e.selectBookmarks(j);c.focus()},refresh:function(c,j){var e=j.contains(r,1),b=j.blockLimit||j.root;e&&b.contains(e)?this.setState(e.is(this.type)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_OFF)}};CKEDITOR.plugins.add("list",{requires:"indentlist",init:function(c){c.blockless||(c.addCommand("numberedlist",new x("numberedlist","ol")),c.addCommand("bulletedlist",
new x("bulletedlist","ul")),c.ui.addButton&&(c.ui.addButton("NumberedList",{label:c.lang.list.numberedlist,command:"numberedlist",directional:!0,toolbar:"list,10"}),c.ui.addButton("BulletedList",{label:c.lang.list.bulletedlist,command:"bulletedlist",directional:!0,toolbar:"list,20"})),c.on("key",function(j){var e=j.data.domEvent.getKey();if(c.mode=="wysiwyg"&&e in{8:1,46:1}){var b=c.getSelection().getRanges()[0],k=b&&b.startPath();if(b&&b.collapsed){var g=e==8,h=c.editable(),f=new CKEDITOR.dom.walker(b.clone());
f.evaluator=function(a){return q(a)&&!v(a)};f.guard=function(a,b){return!(b&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("table"))};e=b.clone();if(g){var a,d;if((a=k.contains(r))&&b.checkBoundaryOfElement(a,CKEDITOR.START)&&(a=a.getParent())&&a.is("li")&&(a=w(a))){d=a;a=a.getPrevious(q);e.moveToPosition(a&&v(a)?a:d,CKEDITOR.POSITION_BEFORE_START)}else{f.range.setStartAt(h,CKEDITOR.POSITION_AFTER_START);f.range.setEnd(b.startContainer,b.startOffset);if((a=f.previous())&&a.type==CKEDITOR.NODE_ELEMENT&&(a.getName()in
r||a.is("li"))){if(!a.is("li")){f.range.selectNodeContents(a);f.reset();f.evaluator=C;a=f.previous()}d=a;e.moveToElementEditEnd(d)}}if(d){y(c,e,b);j.cancel()}else if((e=k.contains(r))&&b.checkBoundaryOfElement(e,CKEDITOR.START)){d=e.getFirst(q);if(b.checkBoundaryOfElement(d,CKEDITOR.START)){a=e.getPrevious(q);if(w(d)){if(a){b.moveToElementEditEnd(a);b.select()}}else c.execCommand("outdent");j.cancel()}}}else if(d=k.contains("li")){f.range.setEndAt(h,CKEDITOR.POSITION_BEFORE_END);h=(k=d.getLast(q))&&
C(k)?k:d;d=0;if((a=f.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in r&&a.equals(k)){d=1;a=f.next()}else b.checkBoundaryOfElement(h,CKEDITOR.END)&&(d=1);if(d&&a){b=b.clone();b.moveToElementEditStart(a);y(c,e,b);j.cancel()}}else{f.range.setEndAt(h,CKEDITOR.POSITION_BEFORE_END);if((a=f.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is(r)){a=a.getFirst(q);if(k.block&&b.checkStartOfBlock()&&b.checkEndOfBlock()){k.block.remove();b.moveToElementEditStart(a);b.select()}else if(w(a)){b.moveToElementEditStart(a);
b.select()}else{b=b.clone();b.moveToElementEditStart(a);y(c,e,b)}j.cancel()}}setTimeout(function(){c.selectionChange(1)})}}}))}})})();CKEDITOR.plugins.add("listblock",{requires:"panel",onLoad:function(){var f=CKEDITOR.addTemplate("panel-list",'<ul role="presentation" class="cke_panel_list">{items}</ul>'),g=CKEDITOR.addTemplate("panel-list-item",'<li id="{id}" class="cke_panel_listItem" role=presentation><a id="{id}_option" _cke_focus=1 hidefocus=true title="{title}" href="javascript:void(\'{val}\')"  {onclick}="CKEDITOR.tools.callFunction({clickFn},\'{val}\'); return false;" role="option">{text}</a></li>'),h=CKEDITOR.addTemplate("panel-list-group",
'<h1 id="{id}" class="cke_panel_grouptitle" role="presentation" >{label}</h1>'),i=/\'/g;CKEDITOR.ui.panel.prototype.addListBlock=function(a,b){return this.addBlock(a,new CKEDITOR.ui.listBlock(this.getHolderElement(),b))};CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(a,b){var b=b||{},c=b.attributes||(b.attributes={});(this.multiSelect=!!b.multiSelect)&&(c["aria-multiselectable"]=!0);!c.role&&(c.role="listbox");this.base.apply(this,arguments);this.element.setAttribute("role",
c.role);c=this.keys;c[40]="next";c[9]="next";c[38]="prev";c[CKEDITOR.SHIFT+9]="prev";c[32]=CKEDITOR.env.ie?"mouseup":"click";CKEDITOR.env.ie&&(c[13]="mouseup");this._.pendingHtml=[];this._.pendingList=[];this._.items={};this._.groups={}},_:{close:function(){if(this._.started){var a=f.output({items:this._.pendingList.join("")});this._.pendingList=[];this._.pendingHtml.push(a);delete this._.started}},getClick:function(){this._.click||(this._.click=CKEDITOR.tools.addFunction(function(a){var b=this.toggle(a);
if(this.onClick)this.onClick(a,b)},this));return this._.click}},proto:{add:function(a,b,c){var d=CKEDITOR.tools.getNextId();this._.started||(this._.started=1,this._.size=this._.size||0);this._.items[a]=d;var e;e=CKEDITOR.tools.htmlEncodeAttr(a).replace(i,"\\'");a={id:d,val:e,onclick:CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick",clickFn:this._.getClick(),title:CKEDITOR.tools.htmlEncodeAttr(c||a),text:b||a};this._.pendingList.push(g.output(a))},startGroup:function(a){this._.close();
var b=CKEDITOR.tools.getNextId();this._.groups[a]=b;this._.pendingHtml.push(h.output({id:b,label:a}))},commit:function(){this._.close();this.element.appendHtml(this._.pendingHtml.join(""));delete this._.size;this._.pendingHtml=[]},toggle:function(a){var b=this.isMarked(a);b?this.unmark(a):this.mark(a);return!b},hideGroup:function(a){var b=(a=this.element.getDocument().getById(this._.groups[a]))&&a.getNext();a&&(a.setStyle("display","none"),b&&"ul"==b.getName()&&b.setStyle("display","none"))},hideItem:function(a){this.element.getDocument().getById(this._.items[a]).setStyle("display",
"none")},showAll:function(){var a=this._.items,b=this._.groups,c=this.element.getDocument(),d;for(d in a)c.getById(a[d]).setStyle("display","");for(var e in b)a=c.getById(b[e]),d=a.getNext(),a.setStyle("display",""),d&&"ul"==d.getName()&&d.setStyle("display","")},mark:function(a){this.multiSelect||this.unmarkAll();var a=this._.items[a],b=this.element.getDocument().getById(a);b.addClass("cke_selected");this.element.getDocument().getById(a+"_option").setAttribute("aria-selected",!0);this.onMark&&this.onMark(b)},
unmark:function(a){var b=this.element.getDocument(),a=this._.items[a],c=b.getById(a);c.removeClass("cke_selected");b.getById(a+"_option").removeAttribute("aria-selected");this.onUnmark&&this.onUnmark(c)},unmarkAll:function(){var a=this._.items,b=this.element.getDocument(),c;for(c in a){var d=a[c];b.getById(d).removeClass("cke_selected");b.getById(d+"_option").removeAttribute("aria-selected")}this.onUnmark&&this.onUnmark()},isMarked:function(a){return this.element.getDocument().getById(this._.items[a]).hasClass("cke_selected")},
focus:function(a){this._.focusIndex=-1;var b=this.element.getElementsByTag("a"),c,d=-1;if(a)for(c=this.element.getDocument().getById(this._.items[a]).getFirst();a=b.getItem(++d);){if(a.equals(c)){this._.focusIndex=d;break}}else this.element.focus();c&&setTimeout(function(){c.focus()},0)}}})}});CKEDITOR.plugins.add("removeformat",{init:function(a){a.addCommand("removeFormat",CKEDITOR.plugins.removeformat.commands.removeformat);a.ui.addButton&&a.ui.addButton("RemoveFormat",{label:a.lang.removeformat.toolbar,command:"removeFormat",toolbar:"cleanup,10"})}});
CKEDITOR.plugins.removeformat={commands:{removeformat:{exec:function(a){for(var h=a._.removeFormatRegex||(a._.removeFormatRegex=RegExp("^(?:"+a.config.removeFormatTags.replace(/,/g,"|")+")$","i")),e=a._.removeAttributes||(a._.removeAttributes=a.config.removeFormatAttributes.split(",")),f=CKEDITOR.plugins.removeformat.filter,k=a.getSelection().getRanges(1),l=k.createIterator(),c;c=l.getNextRange();){c.collapsed||c.enlarge(CKEDITOR.ENLARGE_ELEMENT);var i=c.createBookmark(),b=i.startNode,j=i.endNode,
d=function(b){for(var c=a.elementPath(b),e=c.elements,d=1,g;(g=e[d])&&!g.equals(c.block)&&!g.equals(c.blockLimit);d++)h.test(g.getName())&&f(a,g)&&b.breakParent(g)};d(b);if(j){d(j);for(b=b.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT);b&&!b.equals(j);)d=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT),!("img"==b.getName()&&b.data("cke-realelement"))&&f(a,b)&&(h.test(b.getName())?b.remove(1):(b.removeAttributes(e),a.fire("removeFormatCleanup",b))),b=d}c.moveToBookmark(i)}a.forceNextSelectionCheck();a.getSelection().selectRanges(k)}}},
filter:function(a,h){for(var e=a._.removeFormatFilters||[],f=0;f<e.length;f++)if(!1===e[f](h))return!1;return!0}};CKEDITOR.editor.prototype.addRemoveFormatFilter=function(a){this._.removeFormatFilters||(this._.removeFormatFilters=[]);this._.removeFormatFilters.push(a)};CKEDITOR.config.removeFormatTags="b,big,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var";CKEDITOR.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign";CKEDITOR.plugins.add("richcombo",{requires:"floatpanel,listblock,button",beforeInit:function(d){d.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}});
(function(){var d='<span id="{id}" class="cke_combo cke_combo__{name} {cls}" role="presentation"><span id="{id}_label" class="cke_combo_label">{label}</span><a class="cke_combo_button" hidefocus=true title="{title}" tabindex="-1"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":'" href="javascript:void(\'{titleJs}\')"')+' hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="true"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(d+=' onkeypress="return false;"');CKEDITOR.env.gecko&&(d+=' onblur="this.style.cssText = this.style.cssText;"');
var d=d+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event,this);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span id="{id}_text" class="cke_combo_text cke_combo_inlinelabel">{label}</span><span class="cke_combo_open"><span class="cke_combo_arrow">'+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span>"),
i=CKEDITOR.addTemplate("combo",d);CKEDITOR.UI_RICHCOMBO="richcombo";CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(a){CKEDITOR.tools.extend(this,a,{canGroup:!1,title:a.label,modes:{wysiwyg:1},editorFocus:1});a=this.panel||{};delete this.panel;this.id=CKEDITOR.tools.getNextNumber();this.document=a.parent&&a.parent.getDocument()||CKEDITOR.document;a.className="cke_combopanel";a.block={multiSelect:a.multiSelect,attributes:a.attributes};a.toolbarRelated=!0;this._={panelDefinition:a,items:{}}},
proto:{renderHtml:function(a){var b=[];this.render(a,b);return b.join("")},render:function(a,b){function g(){if(this.getState()!=CKEDITOR.TRISTATE_ON){var c=this.modes[a.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;a.readOnly&&!this.readOnly&&(c=CKEDITOR.TRISTATE_DISABLED);this.setState(c);this.setValue("");c!=CKEDITOR.TRISTATE_DISABLED&&this.refresh&&this.refresh()}}var d=CKEDITOR.env,h="cke_"+this.id,e=CKEDITOR.tools.addFunction(function(b){j&&(a.unlockSelection(1),j=0);c.execute(b)},
this),f=this,c={id:h,combo:this,focus:function(){CKEDITOR.document.getById(h).getChild(1).focus()},execute:function(c){var b=f._;if(b.state!=CKEDITOR.TRISTATE_DISABLED)if(f.createPanel(a),b.on)b.panel.hide();else{f.commit();var d=f.getValue();d?b.list.mark(d):b.list.unmarkAll();b.panel.showBlock(f.id,new CKEDITOR.dom.element(c),4)}},clickFn:e};a.on("activeFilterChange",g,this);a.on("mode",g,this);a.on("selectionChange",g,this);!this.readOnly&&a.on("readOnly",g,this);var k=CKEDITOR.tools.addFunction(function(b,
d){var b=new CKEDITOR.dom.event(b),g=b.getKeystroke();if(40==g)a.once("panelShow",function(a){a.data._.panel._.currentBlock.onKeyDown(40)});switch(g){case 13:case 32:case 40:CKEDITOR.tools.callFunction(e,d);break;default:c.onkey(c,g)}b.preventDefault()}),l=CKEDITOR.tools.addFunction(function(){c.onfocus&&c.onfocus()}),j=0;c.keyDownFn=k;d={id:h,name:this.name||this.command,label:this.label,title:this.title,cls:this.className||"",titleJs:d.gecko&&!d.hc?"":(this.title||"").replace("'",""),keydownFn:k,
focusFn:l,clickFn:e};i.output(d,b);if(this.onRender)this.onRender();return c},createPanel:function(a){if(!this._.panel){var b=this._.panelDefinition,d=this._.panelDefinition.block,i=b.parent||CKEDITOR.document.getBody(),h="cke_combopanel__"+this.name,e=new CKEDITOR.ui.floatPanel(a,i,b),f=e.addListBlock(this.id,d),c=this;e.onShow=function(){this.element.addClass(h);c.setState(CKEDITOR.TRISTATE_ON);c._.on=1;c.editorFocus&&!a.focusManager.hasFocus&&a.focus();if(c.onOpen)c.onOpen();a.once("panelShow",
function(){f.focus(!f.multiSelect&&c.getValue())})};e.onHide=function(b){this.element.removeClass(h);c.setState(c.modes&&c.modes[a.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);c._.on=0;if(!b&&c.onClose)c.onClose()};e.onEscape=function(){e.hide(1)};f.onClick=function(a,b){c.onClick&&c.onClick.call(c,a,b);e.hide()};this._.panel=e;this._.list=f;e.getBlock(this.id).onHide=function(){c._.on=0;c.setState(CKEDITOR.TRISTATE_OFF)};this.init&&this.init()}},setValue:function(a,b){this._.value=a;var d=
this.document.getById("cke_"+this.id+"_text");d&&(!a&&!b?(b=this.label,d.addClass("cke_combo_inlinelabel")):d.removeClass("cke_combo_inlinelabel"),d.setText("undefined"!=typeof b?b:a))},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(a){this._.list.mark(a)},hideItem:function(a){this._.list.hideItem(a)},hideGroup:function(a){this._.list.hideGroup(a)},showAll:function(){this._.list.showAll()},add:function(a,b,d){this._.items[a]=d||a;this._.list.add(a,
b,d)},startGroup:function(a){this._.list.startGroup(a)},commit:function(){this._.committed||(this._.list.commit(),this._.committed=1,CKEDITOR.ui.fire("ready",this));this._.committed=1},setState:function(a){if(this._.state!=a){var b=this.document.getById("cke_"+this.id);b.setState(a,"cke_combo");a==CKEDITOR.TRISTATE_DISABLED?b.setAttribute("aria-disabled",!0):b.removeAttribute("aria-disabled");this._.state=a}},getState:function(){return this._.state},enable:function(){this._.state==CKEDITOR.TRISTATE_DISABLED&&
this.setState(this._.lastState)},disable:function(){this._.state!=CKEDITOR.TRISTATE_DISABLED&&(this._.lastState=this._.state,this.setState(CKEDITOR.TRISTATE_DISABLED))}},statics:{handler:{create:function(a){return new CKEDITOR.ui.richCombo(a)}}}});CKEDITOR.ui.prototype.addRichCombo=function(a,b){this.add(a,CKEDITOR.UI_RICHCOMBO,b)}})();(function(){function f(a,b,c){var e=CKEDITOR.document.getById(c),d;if(e&&(c=a.fire("uiSpace",{space:b,html:""}).html))a.on("uiSpace",function(a){a.data.space==b&&a.cancel()},null,null,1),d=e.append(CKEDITOR.dom.element.createFromHtml(g.output({id:a.id,name:a.name,langDir:a.lang.dir,langCode:a.langCode,space:b,spaceId:a.ui.spaceId(b),content:c}))),e.getCustomData("cke_hasshared")?d.hide():e.setCustomData("cke_hasshared",1),d.unselectable(),d.on("mousedown",function(a){a=a.data;a.getTarget().hasAscendant("a",
1)||a.preventDefault()}),a.focusManager.add(d,1),a.on("focus",function(){for(var a=0,b,c=e.getChildren();b=c.getItem(a);a++)b.type==CKEDITOR.NODE_ELEMENT&&(!b.equals(d)&&b.hasClass("cke_shared"))&&b.hide();d.show()}),a.on("destroy",function(){d.remove()})}var g=CKEDITOR.addTemplate("sharedcontainer",'<div id="cke_{name}" class="cke {id} cke_reset_all cke_chrome cke_editor_{name} cke_shared cke_detached cke_{langDir} '+CKEDITOR.env.cssClass+'" dir="{langDir}" title="'+(CKEDITOR.env.gecko?" ":"")+'" lang="{langCode}" role="presentation"><div class="cke_inner"><div id="{spaceId}" class="cke_{space}" role="presentation">{content}</div></div></div>');
CKEDITOR.plugins.add("sharedspace",{init:function(a){a.on("loaded",function(){var b=a.config.sharedSpaces;if(b)for(var c in b)f(a,c,b[c])},null,null,9)}})})();CKEDITOR.plugins.add("specialchar",{availableLangs:{ar:1,bg:1,ca:1,cs:1,cy:1,de:1,el:1,en:1,"en-gb":1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,he:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ku:1,lv:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ru:1,si:1,sk:1,sl:1,sq:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},requires:"dialog",init:function(a){var c=this;CKEDITOR.dialog.add("specialchar",this.path+"dialogs/specialchar.js");a.addCommand("specialchar",{exec:function(){var b=a.langCode,b=c.availableLangs[b]?
b:c.availableLangs[b.replace(/-.*/,"")]?b.replace(/-.*/,""):"en";CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(c.path+"dialogs/lang/"+b+".js"),function(){CKEDITOR.tools.extend(a.lang.specialchar,c.langEntries[b]);a.openDialog("specialchar")})},modes:{wysiwyg:1},canUndo:!1});a.ui.addButton&&a.ui.addButton("SpecialChar",{label:a.lang.specialchar.toolbar,command:"specialchar",toolbar:"insert,50"})}});CKEDITOR.config.specialChars="! &quot; # $ % &amp; ' ( ) * + - . / 0 1 2 3 4 5 6 7 8 9 : ; &lt; = &gt; ? @ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z [ ] ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z { | } ~ &euro; &lsquo; &rsquo; &ldquo; &rdquo; &ndash; &mdash; &iexcl; &cent; &pound; &curren; &yen; &brvbar; &sect; &uml; &copy; &ordf; &laquo; &not; &reg; &macr; &deg; &sup2; &sup3; &acute; &micro; &para; &middot; &cedil; &sup1; &ordm; &raquo; &frac14; &frac12; &frac34; &iquest; &Agrave; &Aacute; &Acirc; &Atilde; &Auml; &Aring; &AElig; &Ccedil; &Egrave; &Eacute; &Ecirc; &Euml; &Igrave; &Iacute; &Icirc; &Iuml; &ETH; &Ntilde; &Ograve; &Oacute; &Ocirc; &Otilde; &Ouml; &times; &Oslash; &Ugrave; &Uacute; &Ucirc; &Uuml; &Yacute; &THORN; &szlig; &agrave; &aacute; &acirc; &atilde; &auml; &aring; &aelig; &ccedil; &egrave; &eacute; &ecirc; &euml; &igrave; &iacute; &icirc; &iuml; &eth; &ntilde; &ograve; &oacute; &ocirc; &otilde; &ouml; &divide; &oslash; &ugrave; &uacute; &ucirc; &uuml; &yacute; &thorn; &yuml; &OElig; &oelig; &#372; &#374 &#373 &#375; &sbquo; &#8219; &bdquo; &hellip; &trade; &#9658; &bull; &rarr; &rArr; &hArr; &diams; &asymp;".split(" ");(function(){function i(c){return{editorFocus:!1,canUndo:!1,modes:{wysiwyg:1},exec:function(d){if(d.editable().hasFocus){var e=d.getSelection(),b;if(b=(new CKEDITOR.dom.elementPath(e.getCommonAncestor(),e.root)).contains({td:1,th:1},1)){var e=d.createRange(),a=CKEDITOR.tools.tryThese(function(){var a=b.getParent().$.cells[b.$.cellIndex+(c?-1:1)];a.parentNode.parentNode;return a},function(){var a=b.getParent(),a=a.getAscendant("table").$.rows[a.$.rowIndex+(c?-1:1)];return a.cells[c?a.cells.length-1:
0]});if(!a&&!c){for(var f=b.getAscendant("table").$,a=b.getParent().$.cells,f=new CKEDITOR.dom.element(f.insertRow(-1),d.document),g=0,h=a.length;g<h;g++)f.append((new CKEDITOR.dom.element(a[g],d.document)).clone(!1,!1)).appendBogus();e.moveToElementEditStart(f)}else if(a)a=new CKEDITOR.dom.element(a),e.moveToElementEditStart(a),(!e.checkStartOfBlock()||!e.checkEndOfBlock())&&e.selectNodeContents(a);else return!0;e.select(!0);return!0}}return!1}}}var h={editorFocus:!1,modes:{wysiwyg:1,source:1}},
g={exec:function(c){c.container.focusNext(!0,c.tabIndex)}},f={exec:function(c){c.container.focusPrevious(!0,c.tabIndex)}};CKEDITOR.plugins.add("tab",{init:function(c){for(var d=!1!==c.config.enableTabKeyTools,e=c.config.tabSpaces||0,b="";e--;)b+="Â ";if(b)c.on("key",function(a){9==a.data.keyCode&&(c.insertHtml(b),a.cancel())});if(d)c.on("key",function(a){(9==a.data.keyCode&&c.execCommand("selectNextCell")||a.data.keyCode==CKEDITOR.SHIFT+9&&c.execCommand("selectPreviousCell"))&&a.cancel()});c.addCommand("blur",
CKEDITOR.tools.extend(g,h));c.addCommand("blurBack",CKEDITOR.tools.extend(f,h));c.addCommand("selectNextCell",i());c.addCommand("selectPreviousCell",i(!0))}})})();
CKEDITOR.dom.element.prototype.focusNext=function(i,h){var g=void 0===h?this.getTabIndex():h,f,c,d,e,b,a;if(0>=g)for(b=this.getNextSourceNode(i,CKEDITOR.NODE_ELEMENT);b;){if(b.isVisible()&&0===b.getTabIndex()){d=b;break}b=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT)}else for(b=this.getDocument().getBody().getFirst();b=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!f)if(!c&&b.equals(this)){if(c=!0,i){if(!(b=b.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;f=1}}else c&&!this.contains(b)&&
(f=1);if(b.isVisible()&&!(0>(a=b.getTabIndex()))){if(f&&a==g){d=b;break}a>g&&(!d||!e||a<e)?(d=b,e=a):!d&&0===a&&(d=b,e=a)}}d&&d.focus()};
CKEDITOR.dom.element.prototype.focusPrevious=function(i,h){for(var g=void 0===h?this.getTabIndex():h,f,c,d,e=0,b,a=this.getDocument().getBody().getLast();a=a.getPreviousSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!f)if(!c&&a.equals(this)){if(c=!0,i){if(!(a=a.getPreviousSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;f=1}}else c&&!this.contains(a)&&(f=1);if(a.isVisible()&&!(0>(b=a.getTabIndex())))if(0>=g){if(f&&0===b){d=a;break}b>e&&(d=a,e=b)}else{if(f&&b==g){d=a;break}if(b<g&&(!d||b>e))d=a,e=b}}d&&d.focus()};CKEDITOR.plugins.add("table",{requires:"dialog",init:function(a){function e(a){return CKEDITOR.tools.extend(a||{},{contextSensitive:1,refresh:function(a,f){this.setState(f.contains("table",1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}if(!a.blockless){var c=a.lang.table;a.addCommand("table",new CKEDITOR.dialogCommand("table",{context:"table",allowedContent:"table{width,height}[align,border,cellpadding,cellspacing,summary];caption tbody thead tfoot;th td tr[scope];"+(a.plugins.dialogadvtab?
"table"+a.plugins.dialogadvtab.allowedContent():""),requiredContent:"table",contentTransformations:[["table{width}: sizeToStyle","table[width]: sizeToAttribute"]]}));a.addCommand("tableProperties",new CKEDITOR.dialogCommand("tableProperties",e()));a.addCommand("tableDelete",e({exec:function(a){var b=a.elementPath().contains("table",1);if(b){var d=b.getParent(),c=a.editable();1==d.getChildCount()&&(!d.is("td","th")&&!d.equals(c))&&(b=d);a=a.createRange();a.moveToPosition(b,CKEDITOR.POSITION_BEFORE_START);
b.remove();a.select()}}}));a.ui.addButton&&a.ui.addButton("Table",{label:c.toolbar,command:"table",toolbar:"insert,30"});CKEDITOR.dialog.add("table",this.path+"dialogs/table.js");CKEDITOR.dialog.add("tableProperties",this.path+"dialogs/table.js");a.addMenuItems&&a.addMenuItems({table:{label:c.menu,command:"tableProperties",group:"table",order:5},tabledelete:{label:c.deleteTable,command:"tableDelete",group:"table",order:1}});a.on("doubleclick",function(a){a.data.element.is("table")&&(a.data.dialog=
"tableProperties")});a.contextMenu&&a.contextMenu.addListener(function(){return{tabledelete:CKEDITOR.TRISTATE_OFF,table:CKEDITOR.TRISTATE_OFF}})}}});(function(){function p(e){function d(a){!(0<b.length)&&(a.type==CKEDITOR.NODE_ELEMENT&&y.test(a.getName())&&!a.getCustomData("selected_cell"))&&(CKEDITOR.dom.element.setMarker(c,a,"selected_cell",!0),b.push(a))}for(var e=e.getRanges(),b=[],c={},a=0;a<e.length;a++){var f=e[a];if(f.collapsed)f=f.getCommonAncestor(),(f=f.getAscendant("td",!0)||f.getAscendant("th",!0))&&b.push(f);else{var f=new CKEDITOR.dom.walker(f),g;for(f.guard=d;g=f.next();)if(g.type!=CKEDITOR.NODE_ELEMENT||!g.is(CKEDITOR.dtd.table))if((g=
g.getAscendant("td",!0)||g.getAscendant("th",!0))&&!g.getCustomData("selected_cell"))CKEDITOR.dom.element.setMarker(c,g,"selected_cell",!0),b.push(g)}}CKEDITOR.dom.element.clearAllMarkers(c);return b}function o(e,d){for(var b=p(e),c=b[0],a=c.getAscendant("table"),c=c.getDocument(),f=b[0].getParent(),g=f.$.rowIndex,b=b[b.length-1],h=b.getParent().$.rowIndex+b.$.rowSpan-1,b=new CKEDITOR.dom.element(a.$.rows[h]),g=d?g:h,f=d?f:b,b=CKEDITOR.tools.buildTableMap(a),a=b[g],g=d?b[g-1]:b[g+1],b=b[0].length,
c=c.createElement("tr"),h=0;a[h]&&h<b;h++){var i;1<a[h].rowSpan&&g&&a[h]==g[h]?(i=a[h],i.rowSpan+=1):(i=(new CKEDITOR.dom.element(a[h])).clone(),i.removeAttribute("rowSpan"),i.appendBogus(),c.append(i),i=i.$);h+=i.colSpan-1}d?c.insertBefore(f):c.insertAfter(f)}function q(e){if(e instanceof CKEDITOR.dom.selection){for(var d=p(e),b=d[0].getAscendant("table"),c=CKEDITOR.tools.buildTableMap(b),e=d[0].getParent().$.rowIndex,d=d[d.length-1],a=d.getParent().$.rowIndex+d.$.rowSpan-1,d=[],f=e;f<=a;f++){for(var g=
c[f],h=new CKEDITOR.dom.element(b.$.rows[f]),i=0;i<g.length;i++){var j=new CKEDITOR.dom.element(g[i]),l=j.getParent().$.rowIndex;1==j.$.rowSpan?j.remove():(j.$.rowSpan-=1,l==f&&(l=c[f+1],l[i-1]?j.insertAfter(new CKEDITOR.dom.element(l[i-1])):(new CKEDITOR.dom.element(b.$.rows[f+1])).append(j,1)));i+=j.$.colSpan-1}d.push(h)}c=b.$.rows;b=new CKEDITOR.dom.element(c[a+1]||(0<e?c[e-1]:null)||b.$.parentNode);for(f=d.length;0<=f;f--)q(d[f]);return b}e instanceof CKEDITOR.dom.element&&(b=e.getAscendant("table"),
1==b.$.rows.length?b.remove():e.remove());return null}function r(e,d){for(var b=d?Infinity:0,c=0;c<e.length;c++){var a;a=e[c];for(var f=d,g=a.getParent().$.cells,h=0,i=0;i<g.length;i++){var j=g[i],h=h+(f?1:j.colSpan);if(j==a.$)break}a=h-1;if(d?a<b:a>b)b=a}return b}function k(e,d){for(var b=p(e),c=b[0].getAscendant("table"),a=r(b,1),b=r(b),a=d?a:b,f=CKEDITOR.tools.buildTableMap(c),c=[],b=[],g=f.length,h=0;h<g;h++)c.push(f[h][a]),b.push(d?f[h][a-1]:f[h][a+1]);for(h=0;h<g;h++)c[h]&&(1<c[h].colSpan&&
b[h]==c[h]?(a=c[h],a.colSpan+=1):(a=(new CKEDITOR.dom.element(c[h])).clone(),a.removeAttribute("colSpan"),a.appendBogus(),a[d?"insertBefore":"insertAfter"].call(a,new CKEDITOR.dom.element(c[h])),a=a.$),h+=a.rowSpan-1)}function u(e,d){var b=e.getStartElement();if(b=b.getAscendant("td",1)||b.getAscendant("th",1)){var c=b.clone();c.appendBogus();d?c.insertBefore(b):c.insertAfter(b)}}function t(e){if(e instanceof CKEDITOR.dom.selection){var e=p(e),d=e[0]&&e[0].getAscendant("table"),b;a:{var c=0;b=e.length-
1;for(var a={},f,g;f=e[c++];)CKEDITOR.dom.element.setMarker(a,f,"delete_cell",!0);for(c=0;f=e[c++];)if((g=f.getPrevious())&&!g.getCustomData("delete_cell")||(g=f.getNext())&&!g.getCustomData("delete_cell")){CKEDITOR.dom.element.clearAllMarkers(a);b=g;break a}CKEDITOR.dom.element.clearAllMarkers(a);g=e[0].getParent();(g=g.getPrevious())?b=g.getLast():(g=e[b].getParent(),b=(g=g.getNext())?g.getChild(0):null)}for(g=e.length-1;0<=g;g--)t(e[g]);b?m(b,!0):d&&d.remove()}else e instanceof CKEDITOR.dom.element&&
(d=e.getParent(),1==d.getChildCount()?d.remove():e.remove())}function m(e,d){var b=e.getDocument(),c=CKEDITOR.document;CKEDITOR.env.ie&&10==CKEDITOR.env.version&&(c.focus(),b.focus());b=new CKEDITOR.dom.range(b);if(!b["moveToElementEdit"+(d?"End":"Start")](e))b.selectNodeContents(e),b.collapse(d?!1:!0);b.select(!0)}function v(e,d,b){e=e[d];if("undefined"==typeof b)return e;for(d=0;e&&d<e.length;d++){if(b.is&&e[d]==b.$)return d;if(d==b)return new CKEDITOR.dom.element(e[d])}return b.is?-1:null}function s(e,
d,b){var c=p(e),a;if((d?1!=c.length:2>c.length)||(a=e.getCommonAncestor())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("table"))return!1;var f,e=c[0];a=e.getAscendant("table");var g=CKEDITOR.tools.buildTableMap(a),h=g.length,i=g[0].length,j=e.getParent().$.rowIndex,l=v(g,j,e);if(d){var n;try{var m=parseInt(e.getAttribute("rowspan"),10)||1;f=parseInt(e.getAttribute("colspan"),10)||1;n=g["up"==d?j-m:"down"==d?j+m:j]["left"==d?l-f:"right"==d?l+f:l]}catch(z){return!1}if(!n||e.$==n)return!1;c["up"==d||"left"==
d?"unshift":"push"](new CKEDITOR.dom.element(n))}for(var d=e.getDocument(),o=j,m=n=0,q=!b&&new CKEDITOR.dom.documentFragment(d),s=0,d=0;d<c.length;d++){f=c[d];var k=f.getParent(),t=f.getFirst(),r=f.$.colSpan,u=f.$.rowSpan,k=k.$.rowIndex,w=v(g,k,f),s=s+r*u,m=Math.max(m,w-l+r);n=Math.max(n,k-j+u);if(!b){r=f;(u=r.getBogus())&&u.remove();r.trim();if(f.getChildren().count()){if(k!=o&&t&&(!t.isBlockBoundary||!t.isBlockBoundary({br:1})))(o=q.getLast(CKEDITOR.dom.walker.whitespaces(!0)))&&(!o.is||!o.is("br"))&&
q.append("br");f.moveChildren(q)}d?f.remove():f.setHtml("")}o=k}if(b)return n*m==s;q.moveChildren(e);e.appendBogus();m>=i?e.removeAttribute("rowSpan"):e.$.rowSpan=n;n>=h?e.removeAttribute("colSpan"):e.$.colSpan=m;b=new CKEDITOR.dom.nodeList(a.$.rows);c=b.count();for(d=c-1;0<=d;d--)a=b.getItem(d),a.$.cells.length||(a.remove(),c++);return e}function w(e,d){var b=p(e);if(1<b.length)return!1;if(d)return!0;var b=b[0],c=b.getParent(),a=c.getAscendant("table"),f=CKEDITOR.tools.buildTableMap(a),g=c.$.rowIndex,
h=v(f,g,b),i=b.$.rowSpan,j;if(1<i){j=Math.ceil(i/2);for(var i=Math.floor(i/2),c=g+j,a=new CKEDITOR.dom.element(a.$.rows[c]),f=v(f,c),l,c=b.clone(),g=0;g<f.length;g++)if(l=f[g],l.parentNode==a.$&&g>h){c.insertBefore(new CKEDITOR.dom.element(l));break}else l=null;l||a.append(c)}else{i=j=1;a=c.clone();a.insertAfter(c);a.append(c=b.clone());l=v(f,g);for(h=0;h<l.length;h++)l[h].rowSpan++}c.appendBogus();b.$.rowSpan=j;c.$.rowSpan=i;1==j&&b.removeAttribute("rowSpan");1==i&&c.removeAttribute("rowSpan");return c}
function x(e,d){var b=p(e);if(1<b.length)return!1;if(d)return!0;var b=b[0],c=b.getParent(),a=c.getAscendant("table"),a=CKEDITOR.tools.buildTableMap(a),f=v(a,c.$.rowIndex,b),g=b.$.colSpan;if(1<g)c=Math.ceil(g/2),g=Math.floor(g/2);else{for(var g=c=1,h=[],i=0;i<a.length;i++){var j=a[i];h.push(j[f]);1<j[f].rowSpan&&(i+=j[f].rowSpan-1)}for(a=0;a<h.length;a++)h[a].colSpan++}a=b.clone();a.insertAfter(b);a.appendBogus();b.$.colSpan=c;a.$.colSpan=g;1==c&&b.removeAttribute("colSpan");1==g&&a.removeAttribute("colSpan");
return a}var y=/^(?:td|th)$/;CKEDITOR.plugins.tabletools={requires:"table,dialog,contextmenu",init:function(e){function d(a){return CKEDITOR.tools.extend(a||{},{contextSensitive:1,refresh:function(a,b){this.setState(b.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function b(a,b){var c=e.addCommand(a,b);e.addFeature(c)}var c=e.lang.table;b("cellProperties",new CKEDITOR.dialogCommand("cellProperties",d({allowedContent:"td th{width,height,border-color,background-color,white-space,vertical-align,text-align}[colspan,rowspan]",
requiredContent:"table"})));CKEDITOR.dialog.add("cellProperties",this.path+"dialogs/tableCell.js");b("rowDelete",d({requiredContent:"table",exec:function(a){a=a.getSelection();m(q(a))}}));b("rowInsertBefore",d({requiredContent:"table",exec:function(a){a=a.getSelection();o(a,!0)}}));b("rowInsertAfter",d({requiredContent:"table",exec:function(a){a=a.getSelection();o(a)}}));b("columnDelete",d({requiredContent:"table",exec:function(a){for(var a=a.getSelection(),a=p(a),b=a[0],c=a[a.length-1],a=b.getAscendant("table"),
d=CKEDITOR.tools.buildTableMap(a),e,j,l=[],n=0,o=d.length;n<o;n++)for(var k=0,q=d[n].length;k<q;k++)d[n][k]==b.$&&(e=k),d[n][k]==c.$&&(j=k);for(n=e;n<=j;n++)for(k=0;k<d.length;k++)c=d[k],b=new CKEDITOR.dom.element(a.$.rows[k]),c=new CKEDITOR.dom.element(c[n]),c.$&&(1==c.$.colSpan?c.remove():c.$.colSpan-=1,k+=c.$.rowSpan-1,b.$.cells.length||l.push(b));j=a.$.rows[0]&&a.$.rows[0].cells;e=new CKEDITOR.dom.element(j[e]||(e?j[e-1]:a.$.parentNode));l.length==o&&a.remove();e&&m(e,!0)}}));b("columnInsertBefore",
d({requiredContent:"table",exec:function(a){a=a.getSelection();k(a,!0)}}));b("columnInsertAfter",d({requiredContent:"table",exec:function(a){a=a.getSelection();k(a)}}));b("cellDelete",d({requiredContent:"table",exec:function(a){a=a.getSelection();t(a)}}));b("cellMerge",d({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(a){m(s(a.getSelection()),!0)}}));b("cellMergeRight",d({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(a){m(s(a.getSelection(),
"right"),!0)}}));b("cellMergeDown",d({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(a){m(s(a.getSelection(),"down"),!0)}}));b("cellVerticalSplit",d({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(a){m(w(a.getSelection()))}}));b("cellHorizontalSplit",d({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(a){m(x(a.getSelection()))}}));b("cellInsertBefore",d({requiredContent:"table",exec:function(a){a=a.getSelection();u(a,!0)}}));
b("cellInsertAfter",d({requiredContent:"table",exec:function(a){a=a.getSelection();u(a)}}));e.addMenuItems&&e.addMenuItems({tablecell:{label:c.cell.menu,group:"tablecell",order:1,getItems:function(){var a=e.getSelection(),b=p(a);return{tablecell_insertBefore:CKEDITOR.TRISTATE_OFF,tablecell_insertAfter:CKEDITOR.TRISTATE_OFF,tablecell_delete:CKEDITOR.TRISTATE_OFF,tablecell_merge:s(a,null,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_right:s(a,"right",!0)?CKEDITOR.TRISTATE_OFF:
CKEDITOR.TRISTATE_DISABLED,tablecell_merge_down:s(a,"down",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_vertical:w(a,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_horizontal:x(a,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_properties:0<b.length?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}},tablecell_insertBefore:{label:c.cell.insertBefore,group:"tablecell",command:"cellInsertBefore",order:5},tablecell_insertAfter:{label:c.cell.insertAfter,
group:"tablecell",command:"cellInsertAfter",order:10},tablecell_delete:{label:c.cell.deleteCell,group:"tablecell",command:"cellDelete",order:15},tablecell_merge:{label:c.cell.merge,group:"tablecell",command:"cellMerge",order:16},tablecell_merge_right:{label:c.cell.mergeRight,group:"tablecell",command:"cellMergeRight",order:17},tablecell_merge_down:{label:c.cell.mergeDown,group:"tablecell",command:"cellMergeDown",order:18},tablecell_split_horizontal:{label:c.cell.splitHorizontal,group:"tablecell",
command:"cellHorizontalSplit",order:19},tablecell_split_vertical:{label:c.cell.splitVertical,group:"tablecell",command:"cellVerticalSplit",order:20},tablecell_properties:{label:c.cell.title,group:"tablecellproperties",command:"cellProperties",order:21},tablerow:{label:c.row.menu,group:"tablerow",order:1,getItems:function(){return{tablerow_insertBefore:CKEDITOR.TRISTATE_OFF,tablerow_insertAfter:CKEDITOR.TRISTATE_OFF,tablerow_delete:CKEDITOR.TRISTATE_OFF}}},tablerow_insertBefore:{label:c.row.insertBefore,
group:"tablerow",command:"rowInsertBefore",order:5},tablerow_insertAfter:{label:c.row.insertAfter,group:"tablerow",command:"rowInsertAfter",order:10},tablerow_delete:{label:c.row.deleteRow,group:"tablerow",command:"rowDelete",order:15},tablecolumn:{label:c.column.menu,group:"tablecolumn",order:1,getItems:function(){return{tablecolumn_insertBefore:CKEDITOR.TRISTATE_OFF,tablecolumn_insertAfter:CKEDITOR.TRISTATE_OFF,tablecolumn_delete:CKEDITOR.TRISTATE_OFF}}},tablecolumn_insertBefore:{label:c.column.insertBefore,
group:"tablecolumn",command:"columnInsertBefore",order:5},tablecolumn_insertAfter:{label:c.column.insertAfter,group:"tablecolumn",command:"columnInsertAfter",order:10},tablecolumn_delete:{label:c.column.deleteColumn,group:"tablecolumn",command:"columnDelete",order:15}});e.contextMenu&&e.contextMenu.addListener(function(a,b,c){return(a=c.contains({td:1,th:1},1))&&!a.isReadOnly()?{tablecell:CKEDITOR.TRISTATE_OFF,tablerow:CKEDITOR.TRISTATE_OFF,tablecolumn:CKEDITOR.TRISTATE_OFF}:null})},getSelectedCells:p};
CKEDITOR.plugins.add("tabletools",CKEDITOR.plugins.tabletools)})();CKEDITOR.tools.buildTableMap=function(p){for(var p=p.$.rows,o=-1,q=[],r=0;r<p.length;r++){o++;!q[o]&&(q[o]=[]);for(var k=-1,u=0;u<p[r].cells.length;u++){var t=p[r].cells[u];for(k++;q[o][k];)k++;for(var m=isNaN(t.colSpan)?1:t.colSpan,t=isNaN(t.rowSpan)?1:t.rowSpan,v=0;v<t;v++){q[o+v]||(q[o+v]=[]);for(var s=0;s<m;s++)q[o+v][k+s]=p[r].cells[u]}k+=m-1}}return q};(function(){function t(a){return CKEDITOR.env.ie?a.$.clientWidth:parseInt(a.getComputedStyle("width"),10)}function n(a,h){var b=a.getComputedStyle("border-"+h+"-width"),j={thin:"0px",medium:"1px",thick:"2px"};0>b.indexOf("px")&&(b=b in j&&"none"!=a.getComputedStyle("border-style")?j[b]:0);return parseInt(b,10)}function w(a){var h=[],b=-1,j="rtl"==a.getComputedStyle("direction"),c;c=a.$.rows;for(var p=0,g,d,e,i=0,o=c.length;i<o;i++)e=c[i],g=e.cells.length,g>p&&(p=g,d=e);c=d;p=new CKEDITOR.dom.element(a.$.tBodies[0]);
g=p.getDocumentPosition();d=0;for(e=c.cells.length;d<e;d++){var i=new CKEDITOR.dom.element(c.cells[d]),o=c.cells[d+1]&&new CKEDITOR.dom.element(c.cells[d+1]),b=b+(i.$.colSpan||1),k,f,l=i.getDocumentPosition().x;j?f=l+n(i,"left"):k=l+i.$.offsetWidth-n(i,"right");o?(l=o.getDocumentPosition().x,j?k=l+o.$.offsetWidth-n(o,"right"):f=l+n(o,"left")):(l=a.getDocumentPosition().x,j?k=l:f=l+a.$.offsetWidth);i=Math.max(f-k,3);h.push({table:a,index:b,x:k,y:g.y,width:i,height:p.$.offsetHeight,rtl:j})}return h}
function u(a){(a.data||a).preventDefault()}function A(a){function h(){i=0;e.setOpacity(0);k&&b();var v=g.table;setTimeout(function(){v.removeCustomData("_cke_table_pillars")},0);d.removeListener("dragstart",u)}function b(){for(var v=g.rtl,a=v?l.length:x.length,c=0;c<a;c++){var b=x[c],d=l[c],e=g.table;CKEDITOR.tools.setTimeout(function(a,c,b,d,g,j){a&&a.setStyle("width",f(Math.max(c+j,1)));b&&b.setStyle("width",f(Math.max(d-j,1)));g&&e.setStyle("width",f(g+j*(v?-1:1)))},0,this,[b,b&&t(b),d,d&&t(d),
(!b||!d)&&t(e)+n(e,"left")+n(e,"right"),k])}}function j(a){u(a);for(var a=g.index,b=CKEDITOR.tools.buildTableMap(g.table),j=[],h=[],f=Number.MAX_VALUE,n=f,s=g.rtl,r=0,w=b.length;r<w;r++){var m=b[r],q=m[a+(s?1:0)],m=m[a+(s?0:1)],q=q&&new CKEDITOR.dom.element(q),m=m&&new CKEDITOR.dom.element(m);if(!q||!m||!q.equals(m))q&&(f=Math.min(f,t(q))),m&&(n=Math.min(n,t(m))),j.push(q),h.push(m)}x=j;l=h;y=g.x-f;z=g.x+n;e.setOpacity(0.5);o=parseInt(e.getStyle("left"),10);k=0;i=1;e.on("mousemove",p);d.on("dragstart",
u);d.on("mouseup",c,this)}function c(a){a.removeListener();h()}function p(a){r(a.data.getPageOffset().x)}var g,d,e,i,o,k,x,l,y,z;d=a.document;e=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',d);a.on("destroy",function(){e.remove()});s||d.getDocumentElement().append(e);this.attachTo=function(a){i||
(s&&(d.getBody().append(e),k=0),g=a,e.setStyles({width:f(a.width),height:f(a.height),left:f(a.x),top:f(a.y)}),s&&e.setOpacity(0.25),e.on("mousedown",j,this),d.getBody().setStyle("cursor","col-resize"),e.show())};var r=this.move=function(a){if(!g)return 0;if(!i&&(a<g.x||a>g.x+g.width))return g=null,i=k=0,d.removeListener("mouseup",c),e.removeListener("mousedown",j),e.removeListener("mousemove",p),d.getBody().setStyle("cursor","auto"),s?e.remove():e.hide(),0;a-=Math.round(e.$.offsetWidth/2);if(i){if(a==
y||a==z)return 1;a=Math.max(a,y);a=Math.min(a,z);k=a-o}e.setStyle("left",f(a));return 1}}function r(a){var h=a.data.getTarget();if("mouseout"==a.name){if(!h.is("table"))return;for(var b=new CKEDITOR.dom.element(a.data.$.relatedTarget||a.data.$.toElement);b&&b.$&&!b.equals(h)&&!b.is("body");)b=b.getParent();if(!b||b.equals(h))return}h.getAscendant("table",1).removeCustomData("_cke_table_pillars");a.removeListener()}var f=CKEDITOR.tools.cssLength,s=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks);
CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(a){a.on("contentDom",function(){var h,b=a.editable();b.attachListener(b.isInline()?b:a.document,"mousemove",function(b){var b=b.data,c=b.getTarget();if(c.type==CKEDITOR.NODE_ELEMENT){var f=b.getPageOffset().x;if(h&&h.move(f))u(b);else if(c.is("table")||c.getAscendant("tbody",1)){c=c.getAscendant("table",1);if(!(b=c.getCustomData("_cke_table_pillars")))c.setCustomData("_cke_table_pillars",b=w(c)),c.on("mouseout",r),c.on("mousedown",
r);a:{for(var c=0,g=b.length;c<g;c++){var d=b[c];if(f>=d.x&&f<=d.x+d.width){f=d;break a}}f=null}f&&(!h&&(h=new A(a)),h.attachTo(f))}}})})}})})();(function(){function w(a){function d(){for(var b=g(),e=CKEDITOR.tools.clone(a.config.toolbarGroups)||n(a),f=0;f<e.length;f++){var k=e[f];if("/"!=k){"string"==typeof k&&(k=e[f]={name:k});var i,d=k.groups;if(d)for(var h=0;h<d.length;h++)i=d[h],(i=b[i])&&c(k,i);(i=b[k.name])&&c(k,i)}}return e}function g(){var b={},c,f,e;for(c in a.ui.items)f=a.ui.items[c],e=f.toolbar||"others",e=e.split(","),f=e[0],e=parseInt(e[1]||-1,10),b[f]||(b[f]=[]),b[f].push({name:c,order:e});for(f in b)b[f]=b[f].sort(function(b,
a){return b.order==a.order?0:0>a.order?-1:0>b.order?1:b.order<a.order?-1:1});return b}function c(c,e){if(e.length){c.items?c.items.push(a.ui.create("-")):c.items=[];for(var f;f=e.shift();)if(f="string"==typeof f?f:f.name,!b||-1==CKEDITOR.tools.indexOf(b,f))(f=a.ui.create(f))&&a.addFeature(f)&&c.items.push(f)}}function h(b){var a=[],e,d,h;for(e=0;e<b.length;++e)d=b[e],h={},"/"==d?a.push(d):CKEDITOR.tools.isArray(d)?(c(h,CKEDITOR.tools.clone(d)),a.push(h)):d.items&&(c(h,CKEDITOR.tools.clone(d.items)),
h.name=d.name,a.push(h));return a}var b=a.config.removeButtons,b=b&&b.split(","),e=a.config.toolbar;"string"==typeof e&&(e=a.config["toolbar_"+e]);return a.toolbar=e?h(e):d()}function n(a){return a._.toolbarGroups||(a._.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list",
"indent","blocks","align","bidi"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}])}var u=function(){this.toolbars=[];this.focusCommandExecuted=!1};u.prototype.focus=function(){for(var a=0,d;d=this.toolbars[a++];)for(var g=0,c;c=d.items[g++];)if(c.focus){c.focus();return}};var x={modes:{wysiwyg:1,source:1},readOnly:1,exec:function(a){a.toolbox&&(a.toolbox.focusCommandExecuted=!0,CKEDITOR.env.ie||CKEDITOR.env.air?setTimeout(function(){a.toolbox.focus()},
100):a.toolbox.focus())}};CKEDITOR.plugins.add("toolbar",{requires:"button",init:function(a){var d,g=function(c,h){var b,e="rtl"==a.lang.dir,j=a.config.toolbarGroupCycling,o=e?37:39,e=e?39:37,j=void 0===j||j;switch(h){case 9:case CKEDITOR.SHIFT+9:for(;!b||!b.items.length;)if(b=9==h?(b?b.next:c.toolbar.next)||a.toolbox.toolbars[0]:(b?b.previous:c.toolbar.previous)||a.toolbox.toolbars[a.toolbox.toolbars.length-1],b.items.length)for(c=b.items[d?b.items.length-1:0];c&&!c.focus;)(c=d?c.previous:c.next)||
(b=0);c&&c.focus();return!1;case o:b=c;do b=b.next,!b&&j&&(b=c.toolbar.items[0]);while(b&&!b.focus);b?b.focus():g(c,9);return!1;case 40:return c.button&&c.button.hasArrow?(a.once("panelShow",function(b){b.data._.panel._.currentBlock.onKeyDown(40)}),c.execute()):g(c,40==h?o:e),!1;case e:case 38:b=c;do b=b.previous,!b&&j&&(b=c.toolbar.items[c.toolbar.items.length-1]);while(b&&!b.focus);b?b.focus():(d=1,g(c,CKEDITOR.SHIFT+9),d=0);return!1;case 27:return a.focus(),!1;case 13:case 32:return c.execute(),
!1}return!0};a.on("uiSpace",function(c){if(c.data.space==a.config.toolbarLocation){c.removeListener();a.toolbox=new u;var d=CKEDITOR.tools.getNextId(),b=['<span id="',d,'" class="cke_voice_label">',a.lang.toolbar.toolbars,"</span>",'<span id="'+a.ui.spaceId("toolbox")+'" class="cke_toolbox" role="group" aria-labelledby="',d,'" onmousedown="return false;">'],d=!1!==a.config.toolbarStartupExpanded,e,j;a.config.toolbarCanCollapse&&a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&b.push('<span class="cke_toolbox_main"'+
(d?">":' style="display:none">'));for(var o=a.toolbox.toolbars,f=w(a),k=0;k<f.length;k++){var i,l=0,r,m=f[k],s;if(m)if(e&&(b.push("</span>"),j=e=0),"/"===m)b.push('<span class="cke_toolbar_break"></span>');else{s=m.items||m;for(var t=0;t<s.length;t++){var p=s[t],n;if(p)if(p.type==CKEDITOR.UI_SEPARATOR)j=e&&p;else{n=!1!==p.canGroup;if(!l){i=CKEDITOR.tools.getNextId();l={id:i,items:[]};r=m.name&&(a.lang.toolbar.toolbarGroups[m.name]||m.name);b.push('<span id="',i,'" class="cke_toolbar"',r?' aria-labelledby="'+
i+'_label"':"",' role="toolbar">');r&&b.push('<span id="',i,'_label" class="cke_voice_label">',r,"</span>");b.push('<span class="cke_toolbar_start"></span>');var q=o.push(l)-1;0<q&&(l.previous=o[q-1],l.previous.next=l)}n?e||(b.push('<span class="cke_toolgroup" role="presentation">'),e=1):e&&(b.push("</span>"),e=0);i=function(c){c=c.render(a,b);q=l.items.push(c)-1;if(q>0){c.previous=l.items[q-1];c.previous.next=c}c.toolbar=l;c.onkey=g;c.onfocus=function(){a.toolbox.focusCommandExecuted||a.focus()}};
j&&(i(j),j=0);i(p)}}e&&(b.push("</span>"),j=e=0);l&&b.push('<span class="cke_toolbar_end"></span></span>')}}a.config.toolbarCanCollapse&&b.push("</span>");if(a.config.toolbarCanCollapse&&a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var v=CKEDITOR.tools.addFunction(function(){a.execCommand("toolbarCollapse")});a.on("destroy",function(){CKEDITOR.tools.removeFunction(v)});a.addCommand("toolbarCollapse",{readOnly:1,exec:function(b){var a=b.ui.space("toolbar_collapser"),c=a.getPrevious(),e=b.ui.space("contents"),
d=c.getParent(),f=parseInt(e.$.style.height,10),h=d.$.offsetHeight,g=a.hasClass("cke_toolbox_collapser_min");g?(c.show(),a.removeClass("cke_toolbox_collapser_min"),a.setAttribute("title",b.lang.toolbar.toolbarCollapse)):(c.hide(),a.addClass("cke_toolbox_collapser_min"),a.setAttribute("title",b.lang.toolbar.toolbarExpand));a.getFirst().setText(g?"â–²":"â—€");e.setStyle("height",f-(d.$.offsetHeight-h)+"px");b.fire("resize")},modes:{wysiwyg:1,source:1}});a.setKeystroke(CKEDITOR.ALT+(CKEDITOR.env.ie||CKEDITOR.env.webkit?
189:109),"toolbarCollapse");b.push('<a title="'+(d?a.lang.toolbar.toolbarCollapse:a.lang.toolbar.toolbarExpand)+'" id="'+a.ui.spaceId("toolbar_collapser")+'" tabIndex="-1" class="cke_toolbox_collapser');d||b.push(" cke_toolbox_collapser_min");b.push('" onclick="CKEDITOR.tools.callFunction('+v+')">','<span class="cke_arrow">&#9650;</span>',"</a>")}b.push("</span>");c.data.html+=b.join("")}});a.on("destroy",function(){if(this.toolbox){var a,d=0,b,e,g;for(a=this.toolbox.toolbars;d<a.length;d++){e=a[d].items;
for(b=0;b<e.length;b++)g=e[b],g.clickFn&&CKEDITOR.tools.removeFunction(g.clickFn),g.keyDownFn&&CKEDITOR.tools.removeFunction(g.keyDownFn)}}});a.on("uiReady",function(){var c=a.ui.space("toolbox");c&&a.focusManager.add(c,1)});a.addCommand("toolbarFocus",x);a.setKeystroke(CKEDITOR.ALT+121,"toolbarFocus");a.ui.add("-",CKEDITOR.UI_SEPARATOR,{});a.ui.addHandler(CKEDITOR.UI_SEPARATOR,{create:function(){return{render:function(a,d){d.push('<span class="cke_toolbar_separator" role="separator"></span>');return{}}}}})}});
CKEDITOR.ui.prototype.addToolbarGroup=function(a,d,g){var c=n(this.editor),h=0===d,b={name:a};if(g){if(g=CKEDITOR.tools.search(c,function(a){return a.name==g})){!g.groups&&(g.groups=[]);if(d&&(d=CKEDITOR.tools.indexOf(g.groups,d),0<=d)){g.groups.splice(d+1,0,a);return}h?g.groups.splice(0,0,a):g.groups.push(a);return}d=null}d&&(d=CKEDITOR.tools.indexOf(c,function(a){return a.name==d}));h?c.splice(0,0,a):"number"==typeof d?c.splice(d+1,0,b):c.push(a)}})();CKEDITOR.UI_SEPARATOR="separator";
CKEDITOR.config.toolbarLocation="top";(function(){function g(a){this.editor=a;this.reset()}CKEDITOR.plugins.add("undo",{init:function(a){function c(a){b.enabled&&!1!==a.data.command.canUndo&&b.save()}function d(){b.enabled=a.readOnly?!1:"wysiwyg"==a.mode;b.onChange()}var b=a.undoManager=new g(a),e=a.addCommand("undo",{exec:function(){b.undo()&&(a.selectionChange(),this.fire("afterUndo"))},startDisabled:!0,canUndo:!1}),f=a.addCommand("redo",{exec:function(){b.redo()&&(a.selectionChange(),this.fire("afterRedo"))},startDisabled:!0,canUndo:!1}),
h=[CKEDITOR.CTRL+90,CKEDITOR.CTRL+89,CKEDITOR.CTRL+CKEDITOR.SHIFT+90];a.setKeystroke([[h[0],"undo"],[h[1],"redo"],[h[2],"redo"]]);a.on("contentDom",function(){var b=a.editable();b.attachListener(b,"keydown",function(a){-1<CKEDITOR.tools.indexOf(h,a.data.getKeystroke())&&a.data.preventDefault()})});b.onChange=function(){e.setState(b.undoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);f.setState(b.redoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)};a.on("beforeCommandExec",c);a.on("afterCommandExec",
c);a.on("saveSnapshot",function(a){b.save(a.data&&a.data.contentOnly)});a.on("contentDom",function(){a.editable().on("keydown",function(a){a=a.data.getKey();(8==a||46==a)&&b.type(a,0)});a.editable().on("keypress",function(a){b.type(a.data.getKey(),1)})});a.on("beforeModeUnload",function(){"wysiwyg"==a.mode&&b.save(!0)});a.on("mode",d);a.on("readOnly",d);a.ui.addButton&&(a.ui.addButton("Undo",{label:a.lang.undo.undo,command:"undo",toolbar:"undo,10"}),a.ui.addButton("Redo",{label:a.lang.undo.redo,command:"redo",
toolbar:"undo,20"}));a.resetUndo=function(){b.reset();a.fire("saveSnapshot")};a.on("updateSnapshot",function(){b.currentImage&&b.update()});a.on("lockSnapshot",function(a){a=a.data;b.lock(a&&a.dontUpdate,a&&a.forceUpdate)});a.on("unlockSnapshot",b.unlock,b)}});CKEDITOR.plugins.undo={};var f=CKEDITOR.plugins.undo.Image=function(a,c){this.editor=a;a.fire("beforeUndoImage");var d=a.getSnapshot();CKEDITOR.env.ie&&d&&(d=d.replace(/\s+data-cke-expando=".*?"/g,""));this.contents=d;c||(this.bookmarks=(d=
d&&a.getSelection())&&d.createBookmarks2(!0));a.fire("afterUndoImage")},i=/\b(?:href|src|name)="[^"]*?"/gi;f.prototype={equalsContent:function(a){var c=this.contents,a=a.contents;if(CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks))c=c.replace(i,""),a=a.replace(i,"");return c!=a?!1:!0},equalsSelection:function(a){var c=this.bookmarks,a=a.bookmarks;if(c||a){if(!c||!a||c.length!=a.length)return!1;for(var d=0;d<c.length;d++){var b=c[d],e=a[d];if(b.startOffset!=e.startOffset||b.endOffset!=
e.endOffset||!CKEDITOR.tools.arrayCompare(b.start,e.start)||!CKEDITOR.tools.arrayCompare(b.end,e.end))return!1}}return!0}};g.prototype={type:function(a,c){var d=!c&&a!=this.lastKeystroke,b=this.editor;if(!this.typing||c&&!this.wasCharacter||d){var e=new f(b),g=this.snapshots.length;CKEDITOR.tools.setTimeout(function(){var a=b.getSnapshot();CKEDITOR.env.ie&&(a=a.replace(/\s+data-cke-expando=".*?"/g,""));e.contents!=a&&g==this.snapshots.length&&(this.typing=!0,this.save(!1,e,!1)||this.snapshots.splice(this.index+
1,this.snapshots.length-this.index-1),this.hasUndo=!0,this.hasRedo=!1,this.modifiersCount=this.typesCount=1,this.onChange())},0,this)}this.lastKeystroke=a;(this.wasCharacter=c)?(this.modifiersCount=0,this.typesCount++,25<this.typesCount?(this.save(!1,null,!1),this.typesCount=1):setTimeout(function(){b.fire("change")},0)):(this.typesCount=0,this.modifiersCount++,25<this.modifiersCount?(this.save(!1,null,!1),this.modifiersCount=1):setTimeout(function(){b.fire("change")},0))},reset:function(){this.lastKeystroke=
0;this.snapshots=[];this.index=-1;this.limit=this.editor.config.undoStackSize||20;this.currentImage=null;this.hasRedo=this.hasUndo=!1;this.locked=null;this.resetType()},resetType:function(){this.typing=!1;delete this.lastKeystroke;this.modifiersCount=this.typesCount=0},fireChange:function(){this.hasUndo=!!this.getNextImage(!0);this.hasRedo=!!this.getNextImage(!1);this.resetType();this.onChange()},save:function(a,c,d){var b=this.editor;if(this.locked||"ready"!=b.status||"wysiwyg"!=b.mode)return!1;
var e=b.editable();if(!e||"ready"!=e.status)return!1;e=this.snapshots;c||(c=new f(b));if(!1===c.contents)return!1;if(this.currentImage)if(c.equalsContent(this.currentImage)){if(a||c.equalsSelection(this.currentImage))return!1}else b.fire("change");e.splice(this.index+1,e.length-this.index-1);e.length==this.limit&&e.shift();this.index=e.push(c)-1;this.currentImage=c;!1!==d&&this.fireChange();return!0},restoreImage:function(a){var c=this.editor,d;a.bookmarks&&(c.focus(),d=c.getSelection());this.locked=
1;this.editor.loadSnapshot(a.contents);a.bookmarks?d.selectBookmarks(a.bookmarks):CKEDITOR.env.ie&&(d=this.editor.document.getBody().$.createTextRange(),d.collapse(!0),d.select());this.locked=0;this.index=a.index;this.currentImage=this.snapshots[this.index];this.update();this.fireChange();c.fire("change")},getNextImage:function(a){var c=this.snapshots,d=this.currentImage,b;if(d)if(a)for(b=this.index-1;0<=b;b--){if(a=c[b],!d.equalsContent(a))return a.index=b,a}else for(b=this.index+1;b<c.length;b++)if(a=
c[b],!d.equalsContent(a))return a.index=b,a;return null},redoable:function(){return this.enabled&&this.hasRedo},undoable:function(){return this.enabled&&this.hasUndo},undo:function(){if(this.undoable()){this.save(!0);var a=this.getNextImage(!0);if(a)return this.restoreImage(a),!0}return!1},redo:function(){if(this.redoable()&&(this.save(!0),this.redoable())){var a=this.getNextImage(!1);if(a)return this.restoreImage(a),!0}return!1},update:function(a){if(!this.locked){a||(a=new f(this.editor));for(var c=
this.index,d=this.snapshots;0<c&&this.currentImage.equalsContent(d[c-1]);)c-=1;d.splice(c,this.index-c+1,a);this.index=c;this.currentImage=a}},lock:function(a,c){if(this.locked)this.locked.level++;else if(a)this.locked={level:1};else{var d=null;if(c)d=!0;else{var b=new f(this.editor,!0);this.currentImage&&this.currentImage.equalsContent(b)&&(d=b)}this.locked={update:d,level:1}}},unlock:function(){if(this.locked&&!--this.locked.level){var a=this.locked.update;this.locked=null;if(!0===a)this.update();
else if(a){var c=new f(this.editor,!0);a.equalsContent(c)||this.update()}}}}})();CKEDITOR.plugins.add("wordcount",{version:1.1,init:function(a){function j(a){var c=document.createElement("div");c.innerHTML=a;return""==c.textContent&&"undefined"==typeof c.innerText?"":c.textContent||c.innerText}function i(e){var c=0,f=0,d,b;if(b=e.getData())if(g.showCharCount&&(g.countHTML?f=b.length:(a.config.fullPage&&(f=b.search(/<body>/i),-1!=f&&(d=b.search(/<\/body>/i),b=b.substring(f+6,d))),d=b.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+|\s+$/g,"").replace("&nbsp;",""),g.countSpacesAsChars||
(d=b.replace(/\s/g,"")),d=j(d).replace(/^([\s\t\r\n]*)$/,""),f=d.length)),g.showWordCount){d=b.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," ");d=j(d);c=d.split(/\s+/);for(b=c.length-1;0<=b;b--)c[b].match(/^([\s\t\r\n]*)$/)&&c.splice(b,1);c=c.length}b=l.replace("%wordCount%",c).replace("%charCount%",f);a.plugins.wordcount.wordCount=c;a.plugins.wordcount.charCount=f;document.getElementById("cke_wordcount_"+e.name).innerHTML=b;if(f==k)return!0;k=f;return!0}if(a.elementMode!==
CKEDITOR.ELEMENT_MODE_INLINE){var h='<span class="cke_path_item">',k=0,g=CKEDITOR.tools.extend({showWordCount:!0,showCharCount:!1,countSpacesAsChars:!1,countHTML:!1},a.config.wordcount||{},!0);g.showCharCount&&(h+=a.lang.wordcount[g.countHTML?"CharCountWithHTML":"CharCount"]+"&nbsp;%charCount%");g.showCharCount&&g.showWordCount&&(h+=",&nbsp;");g.showWordCount&&(h+=a.lang.wordcount.WordCount+" %wordCount%");var l=h+"</span>";CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css");a.on("key",
function(e){"source"===a.mode&&i(e.editor)},a,null,100);a.on("change",function(a){i(a.editor)},a,null,100);a.on("uiSpace",function(e){"bottom"==e.data.space&&(e.data.html+='<div id="cke_wordcount_'+e.editor.name+'" class="cke_wordcount" style="" title="'+a.lang.wordcount.title+'">&nbsp;</div>')},a,null,100);a.on("dataReady",function(a){i(a.editor)},a,null,100);a.on("afterPaste",function(a){i(a.editor)},a,null,100);a.on("blur",function(){},a,null,300);String.prototype.trim||(String.prototype.trim=
function(){return this.replace(/^\s+|\s+$/g,"")})}}});(function(){function k(a){var d=this.editor,b=a.document,c=b.body,e=b.getElementById("cke_actscrpt");e&&e.parentNode.removeChild(e);(e=b.getElementById("cke_shimscrpt"))&&e.parentNode.removeChild(e);(e=b.getElementById("cke_basetagscrpt"))&&e.parentNode.removeChild(e);CKEDITOR.env.gecko&&(c.contentEditable=!1,2E4>CKEDITOR.env.version&&(c.innerHTML=c.innerHTML.replace(/^.*<\!-- cke-content-start --\>/,""),setTimeout(function(){var a=new CKEDITOR.dom.range(new CKEDITOR.dom.document(b));a.setStart(new CKEDITOR.dom.node(c),
0);d.getSelection().selectRanges([a])},0)));c.contentEditable=!0;CKEDITOR.env.ie&&(c.hideFocus=!0,c.disabled=!0,c.removeAttribute("disabled"));delete this._.isLoadingData;this.$=c;b=new CKEDITOR.dom.document(b);this.setup();CKEDITOR.env.ie&&(b.getDocumentElement().addClass(b.$.compatMode),d.config.enterMode!=CKEDITOR.ENTER_P&&this.attachListener(b,"selectionchange",function(){var a=b.getBody(),c=d.getSelection(),e=c&&c.getRanges()[0];e&&(a.getHtml().match(/^<p>(?:&nbsp;|<br>)<\/p>$/i)&&e.startContainer.equals(a))&&
setTimeout(function(){e=d.getSelection().getRanges()[0];if(!e.startContainer.equals("body")){a.getFirst().remove(1);e.moveToElementEditEnd(a);e.select()}},0)}));if(CKEDITOR.env.webkit||CKEDITOR.env.ie&&10<CKEDITOR.env.version)b.getDocumentElement().on("mousedown",function(a){a.data.getTarget().is("html")&&setTimeout(function(){d.editable().focus()})});l(d);try{d.document.$.execCommand("2D-position",!1,!0)}catch(g){}(CKEDITOR.env.gecko||CKEDITOR.env.ie&&"CSS1Compat"==d.document.$.compatMode)&&this.attachListener(this,
"keydown",function(a){var b=a.data.getKeystroke();if(b==33||b==34)if(CKEDITOR.env.ie)setTimeout(function(){d.getSelection().scrollIntoView()},0);else if(d.window.$.innerHeight>this.$.offsetHeight){var c=d.createRange();c[b==33?"moveToElementEditStart":"moveToElementEditEnd"](this);c.select();a.data.preventDefault()}});CKEDITOR.env.ie&&this.attachListener(b,"blur",function(){try{b.$.selection.empty()}catch(a){}});CKEDITOR.env.iOS&&this.attachListener(b,"touchend",function(){a.focus()});d.document.getElementsByTag("title").getItem(0).data("cke-title",
d.document.$.title);CKEDITOR.env.ie&&(d.document.$.title=this._.docTitle);CKEDITOR.tools.setTimeout(function(){if(this.status=="unloaded")this.status="ready";d.fire("contentDom");if(this._.isPendingFocus){d.focus();this._.isPendingFocus=false}setTimeout(function(){d.fire("dataReady")},0);CKEDITOR.env.ie&&setTimeout(function(){if(d.document){var a=d.document.$.body;a.runtimeStyle.marginBottom="0px";a.runtimeStyle.marginBottom=""}},1E3)},0,this)}function l(a){function d(){var c;a.editable().attachListener(a,
"selectionChange",function(){var d=a.getSelection().getSelectedElement();d&&(c&&(c.detachEvent("onresizestart",b),c=null),d.$.attachEvent("onresizestart",b),c=d.$)})}function b(a){a.returnValue=!1}if(CKEDITOR.env.gecko)try{var c=a.document.$;c.execCommand("enableObjectResizing",!1,!a.config.disableObjectResizing);c.execCommand("enableInlineTableEditing",!1,!a.config.disableNativeTableHandles)}catch(e){}else CKEDITOR.env.ie&&(11>CKEDITOR.env.version&&a.config.disableObjectResizing)&&d(a)}function m(){var a=
[];if(8<=CKEDITOR.document.$.documentMode){a.push("html.CSS1Compat [contenteditable=false]{min-height:0 !important}");var d=[],b;for(b in CKEDITOR.dtd.$removeEmpty)d.push("html.CSS1Compat "+b+"[contenteditable=false]");a.push(d.join(",")+"{display:inline-block}")}else CKEDITOR.env.gecko&&(a.push("html{height:100% !important}"),a.push("img:-moz-broken{-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"));a.push("html{cursor:text;*cursor:auto}");a.push("img,input,textarea{cursor:default}");
return a.join("\n")}CKEDITOR.plugins.add("wysiwygarea",{init:function(a){a.config.fullPage&&a.addFeature({allowedContent:"html head title; style [media,type]; body (*)[id]; meta link [*]",requiredContent:"body"});a.addMode("wysiwyg",function(d){function b(b){b&&b.removeListener();a.editable(new j(a,e.$.contentWindow.document.body));a.setData(a.getData(1),d)}var c="document.open();"+(CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"")+"document.close();",c=CKEDITOR.env.air?"javascript:void(0)":
CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent(c)+"}())":"",e=CKEDITOR.dom.element.createFromHtml('<iframe src="'+c+'" frameBorder="0"></iframe>');e.setStyles({width:"100%",height:"100%"});e.addClass("cke_wysiwyg_frame cke_reset");var g=a.ui.space("contents");g.append(e);if(c=CKEDITOR.env.ie||CKEDITOR.env.gecko)e.on("load",b);var f=a.title,h=a.fire("ariaEditorHelpLabel",{}).label;f&&(CKEDITOR.env.ie&&h&&(f+=", "+h),e.setAttribute("title",f));if(h){var f=CKEDITOR.tools.getNextId(),
i=CKEDITOR.dom.element.createFromHtml('<span id="'+f+'" class="cke_voice_label">'+h+"</span>");g.append(i,1);e.setAttribute("aria-describedby",f)}a.on("beforeModeUnload",function(a){a.removeListener();i&&i.remove()});e.setAttributes({tabIndex:a.tabIndex,allowTransparency:"true"});!c&&b();CKEDITOR.env.webkit&&(c=function(){g.setStyle("width","100%");e.hide();e.setSize("width",g.getSize("width"));g.removeStyle("width");e.show()},e.setCustomData("onResize",c),CKEDITOR.document.getWindow().on("resize",
c));a.fire("ariaWidget",e)})}});CKEDITOR.editor.prototype.addContentsCss=function(a){var d=this.config,b=d.contentsCss;CKEDITOR.tools.isArray(b)||(d.contentsCss=b?[b]:[]);d.contentsCss.push(a)};var j=CKEDITOR.tools.createClass({$:function(a){this.base.apply(this,arguments);this._.frameLoadedHandler=CKEDITOR.tools.addFunction(function(a){CKEDITOR.tools.setTimeout(k,0,this,a)},this);this._.docTitle=this.getWindow().getFrame().getAttribute("title")},base:CKEDITOR.editable,proto:{setData:function(a,d){var b=
this.editor;if(d)this.setHtml(a),b.fire("dataReady");else{this._.isLoadingData=!0;b._.dataStore={id:1};var c=b.config,e=c.fullPage,g=c.docType,f=CKEDITOR.tools.buildStyleHtml(m()).replace(/<style>/,'<style data-cke-temp="1">');e||(f+=CKEDITOR.tools.buildStyleHtml(b.config.contentsCss));var h=c.baseHref?'<base href="'+c.baseHref+'" data-cke-temp="1" />':"";e&&(a=a.replace(/<!DOCTYPE[^>]*>/i,function(a){b.docType=g=a;return""}).replace(/<\?xml\s[^\?]*\?>/i,function(a){b.xmlDeclaration=a;return""}));
a=b.dataProcessor.toHtml(a);e?(/<body[\s|>]/.test(a)||(a="<body>"+a),/<html[\s|>]/.test(a)||(a="<html>"+a+"</html>"),/<head[\s|>]/.test(a)?/<title[\s|>]/.test(a)||(a=a.replace(/<head[^>]*>/,"$&<title></title>")):a=a.replace(/<html[^>]*>/,"$&<head><title></title></head>"),h&&(a=a.replace(/<head>/,"$&"+h)),a=a.replace(/<\/head\s*>/,f+"$&"),a=g+a):a=c.docType+'<html dir="'+c.contentsLangDirection+'" lang="'+(c.contentsLanguage||b.langCode)+'"><head><title>'+this._.docTitle+"</title>"+h+f+"</head><body"+
(c.bodyId?' id="'+c.bodyId+'"':"")+(c.bodyClass?' class="'+c.bodyClass+'"':"")+">"+a+"</body></html>";CKEDITOR.env.gecko&&(a=a.replace(/<body/,'<body contenteditable="true" '),2E4>CKEDITOR.env.version&&(a=a.replace(/<body[^>]*>/,"$&<\!-- cke-content-start --\>")));c='<script id="cke_actscrpt" type="text/javascript"'+(CKEDITOR.env.ie?' defer="defer" ':"")+">var wasLoaded=0;function onload(){if(!wasLoaded)window.parent.CKEDITOR.tools.callFunction("+this._.frameLoadedHandler+",window);wasLoaded=1;}"+
(CKEDITOR.env.ie?"onload();":'document.addEventListener("DOMContentLoaded", onload, false );')+"<\/script>";CKEDITOR.env.ie&&9>CKEDITOR.env.version&&(c+='<script id="cke_shimscrpt">window.parent.CKEDITOR.tools.enableHtml5Elements(document)<\/script>');h&&(CKEDITOR.env.ie&&10>CKEDITOR.env.version)&&(c+='<script id="cke_basetagscrpt">var baseTag = document.querySelector( "base" );baseTag.href = baseTag.href;<\/script>');a=a.replace(/(?=\s*<\/(:?head)>)/,c);this.clearCustomData();this.clearListeners();
b.fire("contentDomUnload");var i=this.getDocument();try{i.write(a)}catch(j){setTimeout(function(){i.write(a)},0)}}},getData:function(a){if(a)return this.getHtml();var a=this.editor,d=a.config,b=d.fullPage,c=b&&a.docType,e=b&&a.xmlDeclaration,g=this.getDocument(),b=b?g.getDocumentElement().getOuterHtml():g.getBody().getHtml();CKEDITOR.env.gecko&&d.enterMode!=CKEDITOR.ENTER_BR&&(b=b.replace(/<br>(?=\s*(:?$|<\/body>))/,""));b=a.dataProcessor.toDataFormat(b);e&&(b=e+"\n"+b);c&&(b=c+"\n"+b);return b},
focus:function(){this._.isLoadingData?this._.isPendingFocus=!0:j.baseProto.focus.call(this)},detach:function(){var a=this.editor,d=a.document,a=a.window.getFrame();j.baseProto.detach.call(this);this.clearCustomData();d.getDocumentElement().clearCustomData();a.clearCustomData();CKEDITOR.tools.removeFunction(this._.frameLoadedHandler);(d=a.removeCustomData("onResize"))&&d.removeListener();a.remove()}}})})();CKEDITOR.config.disableObjectResizing=!1;CKEDITOR.config.disableNativeTableHandles=!0;
CKEDITOR.config.disableNativeSpellChecker=!0;CKEDITOR.config.contentsCss=CKEDITOR.getUrl("contents.css");CKEDITOR.config.plugins='dialogui,dialog,a11yhelp,basicstyles,button,panel,floatpanel,menu,contextmenu,divarea,enterkey,entities,htmlwriter,indent,indentblock,indentlist,list,listblock,removeformat,richcombo,sharedspace,specialchar,tab,table,tabletools,tableresize,toolbar,undo,wordcount,wysiwygarea';CKEDITOR.config.skin='moono';(function() {var setIcons = function(icons, strip) {var path = CKEDITOR.getUrl( 'plugins/' + strip );icons = icons.split( ',' );for ( var i = 0; i < icons.length; i++ )CKEDITOR.skin.icons[ icons[ i ] ] = { path: path, offset: -icons[ ++i ], bgsize : icons[ ++i ] };};if (CKEDITOR.env.hidpi) setIcons('bold,0,,italic,24,,strike,48,,subscript,72,,superscript,96,,underline,120,,indent-rtl,144,,indent,168,,outdent-rtl,192,,outdent,216,,bulletedlist-rtl,240,,bulletedlist,264,,numberedlist-rtl,288,,numberedlist,312,,removeformat,336,,specialchar,360,,table,384,,redo-rtl,408,,redo,432,,undo-rtl,456,,undo,480,','icons_hidpi.png');else setIcons('bold,0,auto,italic,24,auto,strike,48,auto,subscript,72,auto,superscript,96,auto,underline,120,auto,indent-rtl,144,auto,indent,168,auto,outdent-rtl,192,auto,outdent,216,auto,bulletedlist-rtl,240,auto,bulletedlist,264,auto,numberedlist-rtl,288,auto,numberedlist,312,auto,removeformat,336,auto,specialchar,360,auto,table,384,auto,redo-rtl,408,auto,redo,432,auto,undo-rtl,456,auto,undo,480,auto','icons.png');})();CKEDITOR.lang.languages={"en":1};}());

/* SOURCE FILE: en.js (e6be8b9c) 9/9/2014 2:09:00 PM */

CKEDITOR.lang['en']={"editor":"Rich Text Editor","editorPanel":"Rich Text Editor panel","common":{"editorHelp":"Press ALT 0 for help","browseServer":"Browse Server","url":"URL","protocol":"Protocol","upload":"Upload","uploadSubmit":"Send it to the Server","image":"Image","flash":"Flash","form":"Form","checkbox":"Checkbox","radio":"Radio Button","textField":"Text Field","textarea":"Textarea","hiddenField":"Hidden Field","button":"Button","select":"Selection Field","imageButton":"Image Button","notSet":"<not set>","id":"Id","name":"Name","langDir":"Language Direction","langDirLtr":"Left to Right (LTR)","langDirRtl":"Right to Left (RTL)","langCode":"Language Code","longDescr":"Long Description URL","cssClass":"Stylesheet Classes","advisoryTitle":"Advisory Title","cssStyle":"Style","ok":"OK","cancel":"Cancel","close":"Close","preview":"Preview","resize":"Resize","generalTab":"General","advancedTab":"Advanced","validateNumberFailed":"This value is not a number.","confirmNewPage":"Any unsaved changes to this content will be lost. Are you sure you want to load new page?","confirmCancel":"You have changed some options. Are you sure you want to close the dialog window?","options":"Options","target":"Target","targetNew":"New Window (_blank)","targetTop":"Topmost Window (_top)","targetSelf":"Same Window (_self)","targetParent":"Parent Window (_parent)","langDirLTR":"Left to Right (LTR)","langDirRTL":"Right to Left (RTL)","styles":"Style","cssClasses":"Stylesheet Classes","width":"Width","height":"Height","align":"Alignment","alignLeft":"Left","alignRight":"Right","alignCenter":"Center","alignJustify":"Justify","alignTop":"Top","alignMiddle":"Middle","alignBottom":"Bottom","alignNone":"None","invalidValue":"Invalid value.","invalidHeight":"Height must be a number.","invalidWidth":"Width must be a number.","invalidCssLength":"Value specified for the \"%1\" field must be a positive number with or without a valid CSS measurement unit (px, %, in, cm, mm, em, ex, pt, or pc).","invalidHtmlLength":"Value specified for the \"%1\" field must be a positive number with or without a valid HTML measurement unit (px or %).","invalidInlineStyle":"Value specified for the inline style must consist of one or more tuples with the format of \"name : value\", separated by semi-colons.","cssLengthTooltip":"Enter a number for a value in pixels or a number with a valid CSS unit (px, %, in, cm, mm, em, ex, pt, or pc).","unavailable":"%1<span class=\"cke_accessibility\">, unavailable</span>"},"basicstyles":{"bold":"Bold","italic":"Italic","strike":"Strike Through","subscript":"Subscript","superscript":"Superscript","underline":"Underline"},"button":{"selectedLabel":"%1 (Selected)"},"contextmenu":{"options":"Context Menu Options"},"indent":{"indent":"Increase Indent","outdent":"Decrease Indent"},"list":{"bulletedlist":"Insert/Remove Bulleted List","numberedlist":"Insert/Remove Numbered List"},"removeformat":{"toolbar":"Remove Format"},"specialchar":{"options":"Special Character Options","title":"Select Special Character","toolbar":"Insert Special Character"},"table":{"border":"Border size","caption":"Caption","cell":{"menu":"Cell","insertBefore":"Insert Cell Before","insertAfter":"Insert Cell After","deleteCell":"Delete Cells","merge":"Merge Cells","mergeRight":"Merge Right","mergeDown":"Merge Down","splitHorizontal":"Split Cell Horizontally","splitVertical":"Split Cell Vertically","title":"Cell Properties","cellType":"Cell Type","rowSpan":"Rows Span","colSpan":"Columns Span","wordWrap":"Word Wrap","hAlign":"Horizontal Alignment","vAlign":"Vertical Alignment","alignBaseline":"Baseline","bgColor":"Background Color","borderColor":"Border Color","data":"Data","header":"Header","yes":"Yes","no":"No","invalidWidth":"Cell width must be a number.","invalidHeight":"Cell height must be a number.","invalidRowSpan":"Rows span must be a whole number.","invalidColSpan":"Columns span must be a whole number.","chooseColor":"Choose"},"cellPad":"Cell padding","cellSpace":"Cell spacing","column":{"menu":"Column","insertBefore":"Insert Column Before","insertAfter":"Insert Column After","deleteColumn":"Delete Columns"},"columns":"Columns","deleteTable":"Delete Table","headers":"Headers","headersBoth":"Both","headersColumn":"First column","headersNone":"None","headersRow":"First Row","invalidBorder":"Border size must be a number.","invalidCellPadding":"Cell padding must be a positive number.","invalidCellSpacing":"Cell spacing must be a positive number.","invalidCols":"Number of columns must be a number greater than 0.","invalidHeight":"Table height must be a number.","invalidRows":"Number of rows must be a number greater than 0.","invalidWidth":"Table width must be a number.","menu":"Table Properties","row":{"menu":"Row","insertBefore":"Insert Row Before","insertAfter":"Insert Row After","deleteRow":"Delete Rows"},"rows":"Rows","summary":"Summary","title":"Table Properties","toolbar":"Table","widthPc":"percent","widthPx":"pixels","widthUnit":"width unit"},"toolbar":{"toolbarCollapse":"Collapse Toolbar","toolbarExpand":"Expand Toolbar","toolbarGroups":{"document":"Document","clipboard":"Clipboard/Undo","editing":"Editing","forms":"Forms","basicstyles":"Basic Styles","paragraph":"Paragraph","links":"Links","insert":"Insert","styles":"Styles","colors":"Colors","tools":"Tools"},"toolbars":"Editor toolbars"},"undo":{"redo":"Redo","undo":"Undo"},"wordcount":{"WordCount":"Words:","CharCount":"Characters:","CharCountWithHTML":"Characters (including HTML):","limit":"Limit:","title":"Statistics"}};

/* SOURCE FILE: styles.js (aa9f6537) 9/9/2014 2:09:01 PM */

CKEDITOR.stylesSet.add( 'default', [
{ name: 'Italic Title',  element: 'h2', styles: { 'font-style': 'italic' } },
{ name: 'Subtitle',   element: 'h3', styles: { 'color': '#aaa', 'font-style': 'italic' } },
{
name: 'Special Container',
element: 'div',
styles: {
padding: '5px 10px',
background: '#eee',
border: '1px solid #ccc'
}
},
{ name: 'Marker',   element: 'span', attributes: { 'class': 'marker' } },
{ name: 'Big',    element: 'big' },
{ name: 'Small',   element: 'small' },
{ name: 'Typewriter',  element: 'tt' },
{ name: 'Computer Code', element: 'code' },
{ name: 'Keyboard Phrase', element: 'kbd' },
{ name: 'Sample Text',  element: 'samp' },
{ name: 'Variable',   element: 'var' },
{ name: 'Deleted Text',  element: 'del' },
{ name: 'Inserted Text', element: 'ins' },
{ name: 'Cited Work',  element: 'cite' },
{ name: 'Inline Quotation', element: 'q' },
{ name: 'Language: RTL', element: 'span', attributes: { 'dir': 'rtl' } },
{ name: 'Language: LTR', element: 'span', attributes: { 'dir': 'ltr' } },
{
name: 'Styled image (left)',
element: 'img',
attributes: { 'class': 'left' }
},
{
name: 'Styled image (right)',
element: 'img',
attributes: { 'class': 'right' }
},
{
name: 'Compact table',
element: 'table',
attributes: {
cellpadding: '5',
cellspacing: '0',
border: '1',
bordercolor: '#ccc'
},
styles: {
'border-collapse': 'collapse'
}
},
{ name: 'Borderless Table',  element: 'table', styles: { 'border-style': 'hidden', 'background-color': '#E6E6FA' } },
{ name: 'Square Bulleted List', element: 'ul',  styles: { 'list-style-type': 'square' } }
] );

/* SOURCE FILE: table.js (6a5b73c7) 9/9/2014 2:09:00 PM */

(function(){function r(a){for(var e=0,l=0,k=0,m,g=a.$.rows.length;k<g;k++){m=a.$.rows[k];for(var d=e=0,c,b=m.cells.length;d<b;d++)c=m.cells[d],e+=c.colSpan;e>l&&(l=e)}return l}function o(a){return function(){var e=this.getValue(),e=!!(CKEDITOR.dialog.validate.integer()(e)&&0<e);e||(alert(a),this.select());return e}}function n(a,e){var l=function(g){return new CKEDITOR.dom.element(g,a.document)},n=a.editable(),m=a.plugins.dialogadvtab;return{title:a.lang.table.title,minWidth:310,minHeight:CKEDITOR.env.ie?
310:280,onLoad:function(){var g=this,a=g.getContentElement("advanced","advStyles");if(a)a.on("change",function(){var a=this.getStyle("width",""),b=g.getContentElement("info","txtWidth");b&&b.setValue(a,!0);a=this.getStyle("height","");(b=g.getContentElement("info","txtHeight"))&&b.setValue(a,!0)})},onShow:function(){var g=a.getSelection(),d=g.getRanges(),c,b=this.getContentElement("info","txtRows"),h=this.getContentElement("info","txtCols"),p=this.getContentElement("info","txtWidth"),f=this.getContentElement("info",
"txtHeight");"tableProperties"==e&&((g=g.getSelectedElement())&&g.is("table")?c=g:0<d.length&&(CKEDITOR.env.webkit&&d[0].shrink(CKEDITOR.NODE_ELEMENT),c=a.elementPath(d[0].getCommonAncestor(!0)).contains("table",1)),this._.selectedElement=c);c?(this.setupContent(c),b&&b.disable(),h&&h.disable()):(b&&b.enable(),h&&h.enable());p&&p.onChange();f&&f.onChange()},onOk:function(){var g=a.getSelection(),d=this._.selectedElement&&g.createBookmarks(),c=this._.selectedElement||l("table"),b={};this.commitContent(b,
c);if(b.info){b=b.info;if(!this._.selectedElement)for(var h=c.append(l("tbody")),e=parseInt(b.txtRows,10)||0,f=parseInt(b.txtCols,10)||0,i=0;i<e;i++)for(var j=h.append(l("tr")),k=0;k<f;k++)j.append(l("td")).appendBogus();e=b.selHeaders;if(!c.$.tHead&&("row"==e||"both"==e)){j=new CKEDITOR.dom.element(c.$.createTHead());h=c.getElementsByTag("tbody").getItem(0);h=h.getElementsByTag("tr").getItem(0);for(i=0;i<h.getChildCount();i++)f=h.getChild(i),f.type==CKEDITOR.NODE_ELEMENT&&!f.data("cke-bookmark")&&
(f.renameNode("th"),f.setAttribute("scope","col"));j.append(h.remove())}if(null!==c.$.tHead&&!("row"==e||"both"==e)){j=new CKEDITOR.dom.element(c.$.tHead);h=c.getElementsByTag("tbody").getItem(0);for(k=h.getFirst();0<j.getChildCount();){h=j.getFirst();for(i=0;i<h.getChildCount();i++)f=h.getChild(i),f.type==CKEDITOR.NODE_ELEMENT&&(f.renameNode("td"),f.removeAttribute("scope"));h.insertBefore(k)}j.remove()}if(!this.hasColumnHeaders&&("col"==e||"both"==e))for(j=0;j<c.$.rows.length;j++)f=new CKEDITOR.dom.element(c.$.rows[j].cells[0]),
f.renameNode("th"),f.setAttribute("scope","row");if(this.hasColumnHeaders&&!("col"==e||"both"==e))for(i=0;i<c.$.rows.length;i++)j=new CKEDITOR.dom.element(c.$.rows[i]),"tbody"==j.getParent().getName()&&(f=new CKEDITOR.dom.element(j.$.cells[0]),f.renameNode("td"),f.removeAttribute("scope"));b.txtHeight?c.setStyle("height",b.txtHeight):c.removeStyle("height");b.txtWidth?c.setStyle("width",b.txtWidth):c.removeStyle("width");c.getAttribute("style")||c.removeAttribute("style")}if(this._.selectedElement)try{g.selectBookmarks(d)}catch(m){}else a.insertElement(c),
setTimeout(function(){var g=new CKEDITOR.dom.element(c.$.rows[0].cells[0]),b=a.createRange();b.moveToPosition(g,CKEDITOR.POSITION_AFTER_START);b.select()},0)},contents:[{id:"info",label:a.lang.table.title,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":3,label:a.lang.table.rows,required:!0,controlStyle:"width:5em",validate:o(a.lang.table.invalidRows),setup:function(a){this.setValue(a.$.rows.length)},
commit:k},{type:"text",id:"txtCols","default":2,label:a.lang.table.columns,required:!0,controlStyle:"width:5em",validate:o(a.lang.table.invalidCols),setup:function(a){this.setValue(r(a))},commit:k},{type:"html",html:"&nbsp;"},{type:"select",id:"selHeaders",requiredContent:"th","default":"",label:a.lang.table.headers,items:[[a.lang.table.headersNone,""],[a.lang.table.headersRow,"row"],[a.lang.table.headersColumn,"col"],[a.lang.table.headersBoth,"both"]],setup:function(a){var d=this.getDialog();d.hasColumnHeaders=
!0;for(var c=0;c<a.$.rows.length;c++){var b=a.$.rows[c].cells[0];if(b&&"th"!=b.nodeName.toLowerCase()){d.hasColumnHeaders=!1;break}}null!==a.$.tHead?this.setValue(d.hasColumnHeaders?"both":"row"):this.setValue(d.hasColumnHeaders?"col":"")},commit:k},{type:"text",id:"txtBorder",requiredContent:"table[border]","default":a.filter.check("table[border]")?1:0,label:a.lang.table.border,controlStyle:"width:3em",validate:CKEDITOR.dialog.validate.number(a.lang.table.invalidBorder),setup:function(a){this.setValue(a.getAttribute("border")||
"")},commit:function(a,d){this.getValue()?d.setAttribute("border",this.getValue()):d.removeAttribute("border")}},{id:"cmbAlign",type:"select",requiredContent:"table[align]","default":"",label:a.lang.common.align,items:[[a.lang.common.notSet,""],[a.lang.common.alignLeft,"left"],[a.lang.common.alignCenter,"center"],[a.lang.common.alignRight,"right"]],setup:function(a){this.setValue(a.getAttribute("align")||"")},commit:function(a,d){this.getValue()?d.setAttribute("align",this.getValue()):d.removeAttribute("align")}}]},
{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",requiredContent:"table{width}",controlStyle:"width:5em",label:a.lang.common.width,title:a.lang.common.cssLengthTooltip,"default":a.filter.check("table{width}")?500>n.getSize("width")?"100%":500:0,getValue:q,validate:CKEDITOR.dialog.validate.cssLength(a.lang.common.invalidCssLength.replace("%1",a.lang.common.width)),onChange:function(){var a=this.getDialog().getContentElement("advanced","advStyles");a&&
a.updateStyle("width",this.getValue())},setup:function(a){this.setValue(a.getStyle("width"))},commit:k}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",requiredContent:"table{height}",controlStyle:"width:5em",label:a.lang.common.height,title:a.lang.common.cssLengthTooltip,"default":"",getValue:q,validate:CKEDITOR.dialog.validate.cssLength(a.lang.common.invalidCssLength.replace("%1",a.lang.common.height)),onChange:function(){var a=this.getDialog().getContentElement("advanced","advStyles");
a&&a.updateStyle("height",this.getValue())},setup:function(a){(a=a.getStyle("height"))&&this.setValue(a)},commit:k}]},{type:"html",html:"&nbsp;"},{type:"text",id:"txtCellSpace",requiredContent:"table[cellspacing]",controlStyle:"width:3em",label:a.lang.table.cellSpace,"default":a.filter.check("table[cellspacing]")?1:0,validate:CKEDITOR.dialog.validate.number(a.lang.table.invalidCellSpacing),setup:function(a){this.setValue(a.getAttribute("cellSpacing")||"")},commit:function(a,d){this.getValue()?d.setAttribute("cellSpacing",
this.getValue()):d.removeAttribute("cellSpacing")}},{type:"text",id:"txtCellPad",requiredContent:"table[cellpadding]",controlStyle:"width:3em",label:a.lang.table.cellPad,"default":a.filter.check("table[cellpadding]")?1:0,validate:CKEDITOR.dialog.validate.number(a.lang.table.invalidCellPadding),setup:function(a){this.setValue(a.getAttribute("cellPadding")||"")},commit:function(a,d){this.getValue()?d.setAttribute("cellPadding",this.getValue()):d.removeAttribute("cellPadding")}}]}]},{type:"html",align:"right",
html:""},{type:"vbox",padding:0,children:[{type:"text",id:"txtCaption",requiredContent:"caption",label:a.lang.table.caption,setup:function(a){this.enable();a=a.getElementsByTag("caption");if(0<a.count()){var a=a.getItem(0),d=a.getFirst(CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT));d&&!d.equals(a.getBogus())?(this.disable(),this.setValue(a.getText())):(a=CKEDITOR.tools.trim(a.getText()),this.setValue(a))}},commit:function(e,d){if(this.isEnabled()){var c=this.getValue(),b=d.getElementsByTag("caption");
if(c)0<b.count()?(b=b.getItem(0),b.setHtml("")):(b=new CKEDITOR.dom.element("caption",a.document),d.getChildCount()?b.insertBefore(d.getFirst()):b.appendTo(d)),b.append(new CKEDITOR.dom.text(c,a.document));else if(0<b.count())for(c=b.count()-1;0<=c;c--)b.getItem(c).remove()}}},{type:"text",id:"txtSummary",requiredContent:"table[summary]",label:a.lang.table.summary,setup:function(a){this.setValue(a.getAttribute("summary")||"")},commit:function(a,d){this.getValue()?d.setAttribute("summary",this.getValue()):
d.removeAttribute("summary")}}]}]},m&&m.createAdvancedTab(a,null,"table")]}}var q=CKEDITOR.tools.cssLength,k=function(a){var e=this.id;a.info||(a.info={});a.info[e]=this.getValue()};CKEDITOR.dialog.add("table",function(a){return n(a,"table")});CKEDITOR.dialog.add("tableProperties",function(a){return n(a,"tableProperties")})})();

/* SOURCE FILE: specialchar.js (a93573d9) 9/9/2014 2:09:00 PM */

CKEDITOR.dialog.add("specialchar",function(i){var e,l=i.lang.specialchar,k=function(c){var b,c=c.data?c.data.getTarget():new CKEDITOR.dom.element(c);if("a"==c.getName()&&(b=c.getChild(0).getHtml()))c.removeClass("cke_light_background"),e.hide(),c=i.document.createElement("span"),c.setHtml(b),i.insertText(c.getText())},m=CKEDITOR.tools.addFunction(k),j,g=function(c,b){var a,b=b||c.data.getTarget();"span"==b.getName()&&(b=b.getParent());if("a"==b.getName()&&(a=b.getChild(0).getHtml())){j&&d(null,j);
var f=e.getContentElement("info","htmlPreview").getElement();e.getContentElement("info","charPreview").getElement().setHtml(a);f.setHtml(CKEDITOR.tools.htmlEncode(a));b.getParent().addClass("cke_light_background");j=b}},d=function(c,b){b=b||c.data.getTarget();"span"==b.getName()&&(b=b.getParent());"a"==b.getName()&&(e.getContentElement("info","charPreview").getElement().setHtml("&nbsp;"),e.getContentElement("info","htmlPreview").getElement().setHtml("&nbsp;"),b.getParent().removeClass("cke_light_background"),
j=void 0)},n=CKEDITOR.tools.addFunction(function(c){var c=new CKEDITOR.dom.event(c),b=c.getTarget(),a;a=c.getKeystroke();var f="rtl"==i.lang.dir;switch(a){case 38:if(a=b.getParent().getParent().getPrevious())a=a.getChild([b.getParent().getIndex(),0]),a.focus(),d(null,b),g(null,a);c.preventDefault();break;case 40:if(a=b.getParent().getParent().getNext())if((a=a.getChild([b.getParent().getIndex(),0]))&&1==a.type)a.focus(),d(null,b),g(null,a);c.preventDefault();break;case 32:k({data:c});c.preventDefault();
break;case f?37:39:if(a=b.getParent().getNext())a=a.getChild(0),1==a.type?(a.focus(),d(null,b),g(null,a),c.preventDefault(!0)):d(null,b);else if(a=b.getParent().getParent().getNext())(a=a.getChild([0,0]))&&1==a.type?(a.focus(),d(null,b),g(null,a),c.preventDefault(!0)):d(null,b);break;case f?39:37:(a=b.getParent().getPrevious())?(a=a.getChild(0),a.focus(),d(null,b),g(null,a),c.preventDefault(!0)):(a=b.getParent().getParent().getPrevious())?(a=a.getLast().getChild(0),a.focus(),d(null,b),g(null,a),c.preventDefault(!0)):
d(null,b)}});return{title:l.title,minWidth:430,minHeight:280,buttons:[CKEDITOR.dialog.cancelButton],charColumns:17,onLoad:function(){for(var c=this.definition.charColumns,b=i.config.specialChars,a=CKEDITOR.tools.getNextId()+"_specialchar_table_label",f=['<table role="listbox" aria-labelledby="'+a+'" style="width: 320px; height: 100%; border-collapse: separate;" align="center" cellspacing="2" cellpadding="2" border="0">'],d=0,g=b.length,h,e;d<g;){f.push('<tr role="presentation">');for(var j=0;j<c;j++,
d++){if(h=b[d]){h instanceof Array?(e=h[1],h=h[0]):(e=h.replace("&","").replace(";","").replace("#",""),e=l[e]||h);var k="cke_specialchar_label_"+d+"_"+CKEDITOR.tools.getNextNumber();f.push('<td class="cke_dark_background" style="cursor: default" role="presentation"><a href="javascript: void(0);" role="option" aria-posinset="'+(d+1)+'"',' aria-setsize="'+g+'"',' aria-labelledby="'+k+'"',' class="cke_specialchar" title="',CKEDITOR.tools.htmlEncode(e),'" onkeydown="CKEDITOR.tools.callFunction( '+n+
', event, this )" onclick="CKEDITOR.tools.callFunction('+m+', this); return false;" tabindex="-1"><span style="margin: 0 auto;cursor: inherit">'+h+'</span><span class="cke_voice_label" id="'+k+'">'+e+"</span></a>")}else f.push('<td class="cke_dark_background">&nbsp;');f.push("</td>")}f.push("</tr>")}f.push("</tbody></table>",'<span id="'+a+'" class="cke_voice_label">'+l.options+"</span>");this.getContentElement("info","charContainer").getElement().setHtml(f.join(""))},contents:[{id:"info",label:i.lang.common.generalTab,
title:i.lang.common.generalTab,padding:0,align:"top",elements:[{type:"hbox",align:"top",widths:["320px","90px"],children:[{type:"html",id:"charContainer",html:"",onMouseover:g,onMouseout:d,focus:function(){var c=this.getElement().getElementsByTag("a").getItem(0);setTimeout(function(){c.focus();g(null,c)},0)},onShow:function(){var c=this.getElement().getChild([0,0,0,0,0]);setTimeout(function(){c.focus();g(null,c)},0)},onLoad:function(c){e=c.sender}},{type:"hbox",align:"top",widths:["100%"],children:[{type:"vbox",
align:"top",children:[{type:"html",html:"<div></div>"},{type:"html",id:"charPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:28px;height:40px;width:70px;padding-top:9px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"},{type:"html",id:"htmlPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:14px;height:20px;width:70px;padding-top:2px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",
html:"<div>&nbsp;</div>"}]}]}]}]}]}});

/* SOURCE FILE: en.js (0c56bc99) 9/9/2014 2:09:00 PM */

CKEDITOR.plugins.setLang("specialchar","en",{euro:"Euro sign",lsquo:"Left single quotation mark",rsquo:"Right single quotation mark",ldquo:"Left double quotation mark",rdquo:"Right double quotation mark",ndash:"En dash",mdash:"Em dash",iexcl:"Inverted exclamation mark",cent:"Cent sign",pound:"Pound sign",curren:"Currency sign",yen:"Yen sign",brvbar:"Broken bar",sect:"Section sign",uml:"Diaeresis",copy:"Copyright sign",ordf:"Feminine ordinal indicator",laquo:"Left-pointing double angle quotation mark",
not:"Not sign",reg:"Registered sign",macr:"Macron",deg:"Degree sign",sup2:"Superscript two",sup3:"Superscript three",acute:"Acute accent",micro:"Micro sign",para:"Pilcrow sign",middot:"Middle dot",cedil:"Cedilla",sup1:"Superscript one",ordm:"Masculine ordinal indicator",raquo:"Right-pointing double angle quotation mark",frac14:"Vulgar fraction one quarter",frac12:"Vulgar fraction one half",frac34:"Vulgar fraction three quarters",iquest:"Inverted question mark",Agrave:"Latin capital letter A with grave accent",
Aacute:"Latin capital letter A with acute accent",Acirc:"Latin capital letter A with circumflex",Atilde:"Latin capital letter A with tilde",Auml:"Latin capital letter A with diaeresis",Aring:"Latin capital letter A with ring above",AElig:"Latin Capital letter Ã†",Ccedil:"Latin capital letter C with cedilla",Egrave:"Latin capital letter E with grave accent",Eacute:"Latin capital letter E with acute accent",Ecirc:"Latin capital letter E with circumflex",Euml:"Latin capital letter E with diaeresis",Igrave:"Latin capital letter I with grave accent",
Iacute:"Latin capital letter I with acute accent",Icirc:"Latin capital letter I with circumflex",Iuml:"Latin capital letter I with diaeresis",ETH:"Latin capital letter Eth",Ntilde:"Latin capital letter N with tilde",Ograve:"Latin capital letter O with grave accent",Oacute:"Latin capital letter O with acute accent",Ocirc:"Latin capital letter O with circumflex",Otilde:"Latin capital letter O with tilde",Ouml:"Latin capital letter O with diaeresis",times:"Multiplication sign",Oslash:"Latin capital letter O with stroke",
Ugrave:"Latin capital letter U with grave accent",Uacute:"Latin capital letter U with acute accent",Ucirc:"Latin capital letter U with circumflex",Uuml:"Latin capital letter U with diaeresis",Yacute:"Latin capital letter Y with acute accent",THORN:"Latin capital letter Thorn",szlig:"Latin small letter sharp s",agrave:"Latin small letter a with grave accent",aacute:"Latin small letter a with acute accent",acirc:"Latin small letter a with circumflex",atilde:"Latin small letter a with tilde",auml:"Latin small letter a with diaeresis",
aring:"Latin small letter a with ring above",aelig:"Latin small letter Ã¦",ccedil:"Latin small letter c with cedilla",egrave:"Latin small letter e with grave accent",eacute:"Latin small letter e with acute accent",ecirc:"Latin small letter e with circumflex",euml:"Latin small letter e with diaeresis",igrave:"Latin small letter i with grave accent",iacute:"Latin small letter i with acute accent",icirc:"Latin small letter i with circumflex",iuml:"Latin small letter i with diaeresis",eth:"Latin small letter eth",
ntilde:"Latin small letter n with tilde",ograve:"Latin small letter o with grave accent",oacute:"Latin small letter o with acute accent",ocirc:"Latin small letter o with circumflex",otilde:"Latin small letter o with tilde",ouml:"Latin small letter o with diaeresis",divide:"Division sign",oslash:"Latin small letter o with stroke",ugrave:"Latin small letter u with grave accent",uacute:"Latin small letter u with acute accent",ucirc:"Latin small letter u with circumflex",uuml:"Latin small letter u with diaeresis",
yacute:"Latin small letter y with acute accent",thorn:"Latin small letter thorn",yuml:"Latin small letter y with diaeresis",OElig:"Latin capital ligature OE",oelig:"Latin small ligature oe",372:"Latin capital letter W with circumflex",374:"Latin capital letter Y with circumflex",373:"Latin small letter w with circumflex",375:"Latin small letter y with circumflex",sbquo:"Single low-9 quotation mark",8219:"Single high-reversed-9 quotation mark",bdquo:"Double low-9 quotation mark",hellip:"Horizontal ellipsis",
trade:"Trade mark sign",9658:"Black right-pointing pointer",bull:"Bullet",rarr:"Rightwards arrow",rArr:"Rightwards double arrow",hArr:"Left right double arrow",diams:"Black diamond suit",asymp:"Almost equal to"});

/* SOURCE FILE: plugin.js (c4035858) 10/26/2014 1:27:05 PM */

(function (CKEDITOR) {
var modeName = 'spellcheck';
var cmdName = 'spellchecker';
var pluginName = 'spellchecker';
function createSpellCheck(editor) {
if (editor.spellCheck) return;
editor.spellCheck = new SpellCheck(SpellCheckManager, editor.contentDom);
$(editor.contentDom).click(function (evt) {
if (editor.commands.spellchecker.enabled) {
if ($(evt.target).hasClass('spellcheck-word')) {
clickedWord(editor, evt);
}
}
});
}
function disableSpellChecks() {
Util.Object.values(CKEDITOR.instances).forEach(function (editor) {
var cmdSC = editor.commands.spellchecker;
if (cmdSC.enabled) {
cmdSC.exec();
}
});
}
function enableSpellCheck(editor) {
if (this.enabled) return;
console.log('SpellCheck Enabled "' + editor.name + '": ' + this.language);
disableSpellChecks();
this.enabled = true;
createSpellCheck(editor);
SpellCheckManager.setLanguage(this.language);
Util.Dom.blur(editor.contentDom);
editor.setReadOnly(true);
editor.spellCheck.check();
this.setState(CKEDITOR.TRISTATE_ON);
}
function disableSpellCheck(editor) {
if (!this.enabled) return;
console.log('SpellCheck Disabled "' + editor.name + '"');
this.enabled = false;
editor.spellCheck.done();
editor.setReadOnly(false);
this.setState(CKEDITOR.TRISTATE_OFF);
if (editor.focusManager.hasFocus) {
Util.Dom.blur(editor.contentDom);
}
setTimeout(function() {
Util.Dom.focus(editor.contentDom);
}, 0);
}
function replaceWord(editor, node, word, replacement) {
editor.spellCheck.replaceWord(node, word, replacement);
}
function clickedWord(editor, evt) {
var node = evt.target;
var word = Util.Dom.getTextContent(node);
if (!word) return;
var suggestions = SpellCheckManager.getSuggestions(word);
var menuItems = [];
if (suggestions.length > 0) {
for (var i = 0; i < suggestions.length; i++) {
var suggestion = suggestions[i];
menuItems.push({
text: suggestion,
onclick: { fn: replaceWord.bind(null, editor, node, word, suggestion) }
});
}
} else {
menuItems.push({
text: 'No suggestions'
});
}
var menuXY = YUD.getXY(node);
menuXY = ContentManager.getEventXY(evt, menuXY);
var region = YAHOO.util.Region.getRegion(node);
menuXY[1] += region.height;
ContentManager.Menu.show({
custom: menuItems,
evt: evt,
xy: menuXY
});
};
function initLanguages(editor) {
var lookup = {
ESN: 'EspaÃ±ol',
ENU: 'English'
};
var languages = window.ContentManager ? ContentManager.getAccommodationProperties().getLanguages() : ['ENU', 'ESN'];
var defaultLang = window.ContentManager ? ContentManager.getAccommodationProperties().getLanguage() : 'ENU';
if (languages.indexOf('ESN') != -1) {
if (languages.indexOf('ENU') == -1) {
languages.push('ENU');
}
}
if (languages.indexOf('ENU-Braille') != -1) {
if (languages.indexOf('ENU') == -1) {
languages.push('ENU');
}
if (defaultLang == 'ENU-Braille') {
defaultLang = 'ENU';
}
}
var cmdSC = editor.commands.spellchecker;
cmdSC.language = defaultLang;
if (languages.length > 1) {
editor.ui.addRichCombo('Languages', {
toolbar: 'spellchecker,20',
label: lookup[defaultLang],
value: defaultLang,
onClick: function (selectedLang) {
this.setValue(selectedLang, lookup[selectedLang]);
this.label = lookup[selectedLang];
cmdSC.language = selectedLang;
},
panel: {
css: [CKEDITOR.skin.getPath('editor')].concat(editor.config.contentsCss),
multiSelect: false,
attributes: { 'aria-label': 'Spellcheck language' }
},
init: function () {
this.startGroup('Language');
for (var i = 0; i < languages.length; ++i) {
if (lookup[languages[i]]) {
this.add(languages[i], lookup[languages[i]]);
}
}
this.commit();
}
});
}
}
function initPlugin(editor) {
var cmd = editor.addCommand(cmdName, {
canUndo: true,
async: false,
modes: { wysiwyg: 1, spellcheck: 1 },
exec: function () {
if (this.enabled) {
disableSpellCheck.call(this, editor);
} else {
enableSpellCheck.call(this, editor);
}
},
enabled: false
});
var button = editor.ui.addButton('SpellChecker', {
label: 'SpellCheck',
icon: 'spellchecker',
command: cmdName,
toolbar: 'spellchecker,10'
});
initLanguages(editor);
if (editor.contextMenu) {
editor.addMenuGroup('spellCheckGroup');
editor.addMenuItem('spellCheckItem', {
label: 'Spell Check',
icon: 'spellchecker',
command: cmdName,
group: 'spellCheckGroup'
});
editor.contextMenu.addListener(function (element) {
return { spellCheckItem: CKEDITOR.TRISTATE_ON };
});
}
}
CKEDITOR.plugins.add(pluginName, {
requires: 'richcombo',
config: {
parser: 'html'
},
init: initPlugin
});
})(CKEDITOR);

/* SOURCE FILE: plugin.js (6aa93862) 9/9/2014 2:08:53 PM */

(function () {
'use strict';
CKEDITOR.plugins.add('clipboard', {
requires: 'dialog',
icons: 'copy,cut,paste',
init: function (editor) {
initClipboard(editor);
}
});
function initClipboard(editor) {
var BUFFER = null;
var inReadOnly = 0;
addListeners();
addButtonsCommands();
function pasteHtml() {
if (!BUFFER) return;
var sel = editor.getSelection();
var rng = sel.getRanges();
if (rng && rng.length > 0) {
editor.insertHtml(BUFFER, 'html');
}
};
function cutCopyHtml(type) {
var sel = editor.getSelection();
var rng = sel.getRanges();
if (!rng || rng.length == 0) return;
var contents;
if (type == 'cut') {
contents = rng[0].extractContents();
} else {
contents = rng[0].cloneContents();
sel.selectRanges(rng);
}
var commonParent = rng[0].getCommonAncestor();
var parentNodes = [];
if (commonParent) {
commonParent = commonParent.$;
if (commonParent.nodeType === Util.Dom.NodeType.TEXT) {
commonParent = commonParent.parentNode;
}
var tableCellContent = false;
while (!tableCellContent && !YUD.hasClass(commonParent, 'cke_editable')) {
switch (commonParent.tagName.toLowerCase()) {
case 'strong':
case 'em':
case 'u':
parentNodes.push(commonParent);
break;
case 'td':
tableCellContent = true;
break;
}
commonParent = commonParent.parentNode;
}
}
if (parentNodes.length > 0) {
var bufferRoot = document.createDocumentFragment();
var bufferNode = bufferRoot;
for (var nodeIndex = parentNodes.length - 1; nodeIndex >= 0; --nodeIndex) {
bufferNode.appendChild(parentNodes[nodeIndex].cloneNode(false));
bufferNode = bufferNode.firstChild;
}
bufferNode.appendChild(contents.$.cloneNode(true));
contents.$ = bufferRoot;
}
var div = document.createElement('div');
div.appendChild(contents.$);
BUFFER = div.innerHTML;
setToolbarStates();
}
function addButtonsCommands() {
addButtonCommand('Cut', 'cut', createCutCopyCmd('cut'), 10, 1);
addButtonCommand('Copy', 'copy', createCutCopyCmd('copy'), 20, 4);
addButtonCommand('Paste', 'paste', createPasteCmd(), 30, 8);
function addButtonCommand(buttonName, commandName, command, toolbarOrder, ctxMenuOrder) {
var lang = editor.lang.clipboard[commandName];
editor.addCommand(commandName, command);
editor.ui.addButton && editor.ui.addButton(buttonName, {
label: lang,
command: commandName,
toolbar: 'clipboard,' + toolbarOrder
});
if (editor.addMenuItems) {
editor.addMenuItem(commandName, {
label: lang,
command: commandName,
group: 'clipboard',
order: ctxMenuOrder
});
}
}
}
function isSelectionReadOnly(selection) {
var rng = selection.getRanges();
return rng && rng[0] && rng[0].checkReadOnly ? rng[0].checkReadOnly() : true;
}
function addListeners() {
editor.on('key', onKey);
editor.on('contentDom', addListenersToEditable);
editor.on('selectionChange', function (evt) {
inReadOnly = isSelectionReadOnly(evt.data.selection);
setToolbarStates();
});
if (editor.contextMenu) {
editor.contextMenu.addListener(function (element, selection) {
inReadOnly = isSelectionReadOnly(selection);
return {
cut: stateFromNamedCommand('Cut'),
copy: stateFromNamedCommand('Copy'),
paste: stateFromNamedCommand('Paste')
};
});
}
}
function addListenersToEditable() {
var editable = editor.editable();
editable.on('mouseup', function () {
setTimeout(function () {
setToolbarStates();
}, 0);
});
editable.on('keyup', setToolbarStates);
if (editor.document && editor.document.$ != document) {
var mouseupTimeout;
editable.attachListener(CKEDITOR.env.ie ? editable : editor.document.getDocumentElement(), 'mouseup', function () {
mouseupTimeout = setTimeout(function () {
setToolbarStates();
}, 0);
});
editor.on('destroy', function () {
clearTimeout(mouseupTimeout);
});
}
}
function createCutCopyCmd(type) {
return {
type: type,
canUndo: type == 'cut',
startDisabled: true,
exec: function (data) {
cutCopyHtml(type);
}
};
}
function createPasteCmd() {
return {
canUndo: false,
startDisabled: true,
exec: function () {
pasteHtml();
}
};
}
function onKey(event) {
if (editor.mode != 'wysiwyg') {
return;
}
switch (event.data.keyCode) {
case CKEDITOR.CTRL + 86:
pasteHtml();
event.cancel();
return;
case CKEDITOR.CTRL + 67:
cutCopyHtml('copy');
event.cancel();
return;
case CKEDITOR.CTRL + 88:
cutCopyHtml('cut');
event.cancel();
editor.fire('saveSnapshot');
return;
}
}
function setToolbarStates() {
if (editor.mode != 'wysiwyg') {
return;
}
editor.getCommand('cut').setState(stateFromNamedCommand('Cut'));
editor.getCommand('copy').setState(stateFromNamedCommand('Copy'));
editor.getCommand('paste').setState(stateFromNamedCommand('Paste'));
}
function stateFromNamedCommand(command) {
if (editor.readOnly) {
return CKEDITOR.TRISTATE_DISABLED;
}
var retval;
if (inReadOnly && command in { Paste: 1, Cut: 1 }) {
return CKEDITOR.TRISTATE_DISABLED;
}
if (command == 'Paste') {
if (BUFFER) {
return CKEDITOR.TRISTATE_OFF;
} else {
return CKEDITOR.TRISTATE_DISABLED;
}
}
else {
var sel = editor.getSelection(),
ranges = sel.getRanges();
retval = sel.getType() != CKEDITOR.SELECTION_NONE && !(ranges.length == 1 && ranges[0].collapsed);
}
return retval ? CKEDITOR.TRISTATE_OFF : CKEDITOR.TRISTATE_DISABLED;
}
}
})();

/* SOURCE FILE: en.js (26df6efe) 9/9/2014 2:08:53 PM */

CKEDITOR.plugins.setLang( 'clipboard', 'en', {
copy: 'Copy',
copyError: 'Your browser security settings don\'t permit the editor to automatically execute copying operations. Please use the keyboard for that (Ctrl/Cmd+C).',
cut: 'Cut',
cutError: 'Your browser security settings don\'t permit the editor to automatically execute cutting operations. Please use the keyboard for that (Ctrl/Cmd+X).',
paste: 'Paste',
pasteArea: 'Paste Area',
pasteMsg: 'Please paste inside the following box using the keyboard (<strong>Ctrl/Cmd+V</strong>) and hit OK',
securityMsg: 'Because of your browser security settings, the editor is not able to access your clipboard data directly. You are required to paste it again in this window.',
title: 'Paste'
});

/* SOURCE FILE: plugin.js (f0736dce) 10/26/2014 1:27:05 PM */

(function () {
var cmdName = 'a11yHelp';
var pluginName = 'keymaphelp';
function initPlugin(editor) {
var button = editor.ui.addButton('KeyMapHelp', {
label: 'KeyMapHelp',
icon: 'keymaphelp',
command: cmdName,
toolbar: 'keymaphelp,11'
});
}
CKEDITOR.plugins.add(pluginName, {
requires: 'dialog',
init: initPlugin
});
})();

/* SOURCE FILE: base.js (7a490760) 10/26/2014 1:27:05 PM */

(function (CKEDITOR) {
if (CKEDITOR == null) return;
CKEDITOR.disableAutoInline = true;
var useInline = false;
var mode = Util.QueryString.parse().ckeditor;
if (mode) {
useInline = (mode == 'inline');
} else if (Util.Browser.isIOS() || Util.Browser.isAndroid()) {
useInline = true;
}
CKEDITOR.on('instanceCreated', function (ev) {
var clipPath = HTMLEditor.resolveBaseUrl('Scripts/HTMLEditor2/plugins/clipboard/icons/');
var spellPath = HTMLEditor.resolveBaseUrl('Scripts/HTMLEditor2/plugins/spellchecker/icons/');
var keymapPath = HTMLEditor.resolveBaseUrl('Scripts/HTMLEditor2/plugins/keymaphelp/icons/');
CKEDITOR.skin.addIcon('cut', clipPath + 'cut.png', 0, true);
CKEDITOR.skin.addIcon('copy', clipPath + 'copy.png', 0, true);
CKEDITOR.skin.addIcon('paste', clipPath + 'paste.png', 0, true);
CKEDITOR.skin.addIcon('spellchecker', spellPath + 'spellchecker.png', 0, true);
CKEDITOR.skin.addIcon('keymaphelp', keymapPath + 'keymaphelp.png', 0, true);
});
function fixPaths() {
var version = '4.4';
var rootPath = HTMLEditor.resolveBaseUrl('');
var basePath = rootPath + 'Scripts/Libraries/ckeditor/' + version + '/';
var pluginsPath = basePath + 'plugins/';
var customPath = rootPath + 'Scripts/HTMLEditor2/plugins/';
if (CKEDITOR.basePath != basePath) {
CKEDITOR.basePath = basePath;
}
if (CKEDITOR.plugins.basePath != pluginsPath) {
CKEDITOR.plugins.basePath = pluginsPath;
}
var pluginName;
for (pluginName in CKEDITOR.plugins.registered) {
var plugin = CKEDITOR.plugins.registered[pluginName];
if (plugin.path.indexOf(pluginsPath) == -1) {
plugin.path = CKEDITOR.plugins.getPath(pluginName);
}
}
var iconName;
for (iconName in CKEDITOR.skin.icons) {
var icon = CKEDITOR.skin.icons[iconName];
var fileName = icon.path.split('/').pop();
if (icon.path.indexOf(customPath) == -1) {
icon.path = pluginsPath + fileName;
}
}
}
var DEFAULT_GROUPS = {
'help': ['KeyMapHelp'],
'basicstyles': ['Bold', 'Italic', 'Underline'],
'cleanup': ['RemoveFormat'],
'list': ['NumberedList', 'BulletedList'],
'indent': ['Outdent', 'Indent'],
'clipboard': ['Cut', 'Copy', 'Paste'],
'undo': ['Undo', 'Redo'],
'spellchecker': ['SpellChecker', 'Languages'],
'table': ['Table'],
'specialchar': ['SpecialChar']
};
function createToolbar(responseType, addGroups, removeGroups) {
var toolGroups = {};
if (responseType == 'HTMLEditorCustom') {
if (addGroups) {
addGroups.forEach(function (groupName) {
toolGroups[groupName] = DEFAULT_GROUPS[groupName];
});
}
} else {
Object.keys(DEFAULT_GROUPS).forEach(function(groupName) {
toolGroups[groupName] = DEFAULT_GROUPS[groupName];
});
}
var toolbar = [
['KeyMapHelp'],
['Bold', 'Italic', 'Underline', 'RemoveFormat'],
['NumberedList', 'BulletedList', 'Outdent', 'Indent'],
['Cut', 'Copy', 'Paste', 'Undo', 'Redo'],
['SpellChecker', 'Languages'],
['Table', 'SpecialChar']
];
if (responseType != 'HTMLEditorTable' &&
responseType != 'HTMLEditorCustom') {
delete toolGroups['table'];
}
if (responseType == 'PlainTextSpell') {
Object.keys(toolGroups).forEach(function(groupName) {
if (groupName != 'spellchecker') {
delete toolGroups[groupName];
}
});
}
var accProps = Accommodations.Manager.getCurrentProps();
if (!accProps.isStreamlinedMode()) {
delete toolGroups['help'];
}
if (removeGroups) {
removeGroups.forEach(function (groupName) {
delete toolGroups[groupName];
});
}
var buttons = Util.Array.flatten(Util.Object.values(toolGroups));
toolbar = toolbar.map(function (group) {
return group.filter(function (button) {
return buttons.indexOf(button) != -1;
});
}).filter(function (group) {
return group.length;
});
return toolbar;
}
function createConfig(responseType, addGroups, removeGroups) {
var config = {
title: '',
customConfig: '',
readOnly: true,
startupFocus: false,
baseFloatZIndex: 50,
dialog_noConfirmCancel: true,
extraPlugins: 'clipboard,spellchecker,keymaphelp',
removePlugins: 'sharedSpaces,floatingspace,resize,tableresize,wordcount',
disableNativeSpellChecker: true,
disableNativeTableHandles: true,
height: ''
};
config.toolbar = createToolbar(responseType, addGroups, removeGroups);
if (useInline) {
config.removePlugins += ',wysiwygarea';
} else {
config.removePlugins += ',divarea';
}
if (!useInline) {
var styles = [];
styles.push(HTMLEditor.resolveBaseUrl('Shared/CSS/accommodations.css'));
styles.push(HTMLEditor.resolveBaseUrl('Scripts/HTMLEditor2/frame.css'));
config.contentsCss = styles;
}
return config;
}
function onInstanceReady(editor) {
var editable = editor.editable();
editor.isReady = true;
editor.container.addClass('editor');
if (useInline) {
editor.contentDom = editable.$;
} else {
editor.contentDom = editor.document.$.body;
}
var editorEl = editor.element.$;
if (editorEl.removeAttribute) {
editorEl.removeAttribute('title');
}
if (!Util.Browser.supportsModifierKeys()) {
editable.attachListener(editable, 'keydown', function (evt) {
if (evt.data.$.ctrlKey) {
evt.stop();
}
}, null, null, 1);
}
if (editor.config.disabled !== true) {
setTimeout(function () {
editor.setReadOnly(false);
}, 0);
}
}
function createEditor(containerEl, responseType, configOverride) {
containerEl.innerHTML = '';
fixPaths();
var config = createConfig(responseType, configOverride.addGroups, configOverride.removeGroups);
if (configOverride) {
for (var property in configOverride){
config[property] = configOverride[property];
}
}
CKEDITOR.env.isCompatible = true;
var editor = CKEDITOR.appendTo(containerEl, config);
if (!editor) {
throw new Error('CKEditor failed to be created.');
}
editor.isReady = false;
editor.on('instanceReady', onInstanceReady.bind(null, editor));
return editor;
}
var HTMLEditor = {};
HTMLEditor.create = createEditor;
HTMLEditor.resolveBaseUrl = function (url) {
return url;
};
HTMLEditor.getLanguage = function() {
return 'ENU';
};
window.HTMLEditor = HTMLEditor;
})(window.CKEDITOR);
(function(CKEDITOR) {
CKEDITOR.on('dialogDefinition', function (e) {
var dialogName = e.data.name;
var dialog = e.data.definition.dialog;
dialog.on('show', function () {
YUD.addClass(document.body, 'showingDialog');
});
dialog.on('hide', function () {
YUD.removeClass(document.body, 'showingDialog');
});
});
CKEDITOR.on('instanceCreated', function (ev) {
ev.editor.on('contentDom', function () {
var element = (document != ev.editor.document) ?
ev.editor.document : ev.editor.element;
element.on('dragstart', function (ev) {
ev.data.preventDefault(true);
});
element.on('drop', function (ev) {
ev.data.preventDefault(true);
});
element.on('contextmenu', function (ev) {
ev.data.preventDefault(true);
});
});
});
CKEDITOR.on('ariaWidget', function (e) {
var menuCKEditorEl = e.data;
if (menuCKEditorEl.hasClass && !menuCKEditorEl.hasClass('dragDisabled')) {
var tag = menuCKEditorEl.$.tagName.toLowerCase();
var doc;
var menuBody;
if (tag === 'iframe') {
doc = menuCKEditorEl.getFrameDocument();
menuBody = doc.getBody();
} else if (tag === 'body') {
doc = menuCKEditorEl.getDocument();
menuBody = menuCKEditorEl;
} else {
return;
}
if (doc && menuBody) {
menuBody.setAttribute('ondragstart', 'return false;');
menuCKEditorEl.addClass('dragDisabled');
}
}
});
if (Util.Browser.getFirefoxVersion() < 10) {
CKEDITOR.editor.prototype.getSelection = function (forceRealSelection) {
if ((this._.savedSelection || this._.fakeSelection) && !forceRealSelection)
return this._.savedSelection || this._.fakeSelection;
var editable = this.editable();
if (editable && (this.mode === undefined || this.mode == 'wysiwyg')) {
var sel = new CKEDITOR.dom.selection(editable);
if (this.mode === undefined) {
sel.isLocked = 1;
}
return sel;
}
return null;
};
}
})(CKEDITOR);
(function (CKEDITOR) {
var charDiff = 10;
function instanceCreated(editor) {
var lastChange = '';
editor.on('change', function (evt) {
var editable = editor.editable();
var text = editable.getText();
if (text) {
text = text.replace(/([\s\t\r\n]*)/gm, '');
}
if (text != lastChange && text.length == 0 && lastChange.length > charDiff) {
console.warn('EDITOR DELETE WARNING: ' + lastChange);
}
lastChange = text;
});
}
CKEDITOR.on('instanceCreated', function (ev) {
instanceCreated(ev.editor);
});
})(CKEDITOR);

/* SOURCE FILE: table.js (a3e20209) 9/9/2014 2:08:53 PM */

(function(CKEDITOR, HTMLEditor) {
var MAX_ROWS = 100;
var MAX_COLS = 10;
var lang = HTMLEditor.getLanguage();
var invalidRowsMsg = 'TDSCKE.Alert.InvalidRows.' + lang;
var invalidColsMsg = 'TDSCKE.Alert.InvalidCols.' + lang;
var invalidWidthMsg = 'TDSCKE.Alert.InvalidWidth.' + lang;
var invalidHeightMsg = 'TDSCKE.Alert.InvalidHeight.' + lang;
function validateNum(msg, max) {
return function () {
var value = this.getValue(),
pass = !!(CKEDITOR.dialog.validate.integer()(value) && value > 0 && value <= max);
if (!pass) {
var invalidValue = this.getInputElement().$;
TDS.Dialog.showAlert(msg, function () { invalidValue.select(); });
}
return pass;
};
}
function validateSize(msg) {
return function () {
var value = this.getValue();
var pass = /^((0*\.\d*[1-9]\d*|0*[1-9]\d*(\.\d+)?)(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i.test(value);
if (!pass) {
var invalidValue = this.getInputElement().$;
TDS.Dialog.showAlert(msg, function () { invalidValue.select(); });
}
return pass;
};
}
CKEDITOR.on('dialogDefinition', function (e) {
var dialogName = e.data.name;
var dialog = e.data.definition.dialog;
var def = e.data.definition;
if (dialogName && def) {
if (dialogName == 'table' || dialogName == 'tableProperties') {
var tableTab = def.getContents('info');
if (tableTab) {
tableTab.remove('txtBorder');
tableTab.remove('txtCellSpace');
tableTab.remove('txtCellPad');
tableTab.remove('txtSummary');
var txtRows = tableTab.get('txtRows');
txtRows.validate = validateNum(invalidRowsMsg, MAX_ROWS);
var txtCols = tableTab.get('txtCols');
txtCols.validate = validateNum(invalidColsMsg, MAX_COLS);
var txtWidth = tableTab.get('txtWidth');
txtWidth.validate = validateSize(invalidWidthMsg);
var txtHeight = tableTab.get('txtHeight');
txtHeight.validate = validateSize(invalidHeightMsg);
var cmbAlign = tableTab.get('cmbAlign');
cmbAlign.setup = function (selectedTable) {
this.setValue($(selectedTable.$).css('text-align') || '');
};
cmbAlign.commit = function (data, selectedTable) {
if (this.getValue()) {
$(selectedTable.$).css('text-align', this.getValue());
} else {
$(selectedTable.$).css('text-align', '');
}
};
}
} else if (dialogName == 'cellProperties') {
var cellTab = def.getContents('info');
if (cellTab) {
cellTab.remove('rowSpan');
cellTab.remove('colSpan');
cellTab.remove('txtSummary');
}
}
}
});
})(CKEDITOR, HTMLEditor);

/* SOURCE FILE: widget.js (843d0a90) 10/26/2014 1:27:05 PM */

(function (HTMLEditor, CM) {
HTMLEditor.resolveBaseUrl = CM.resolveBaseUrl.bind(CM);
HTMLEditor.getLanguage = CM.getLanguage.bind(CM);
function match(page, item, content) {
if (page.layout == '12') return false;
var id = 'editor_' + item.position;
var el = document.getElementById(id);
if (el) {
return new CM.WidgetConfig(id, el);
}
return false;
};
function Widget_CK(page, item, config) {
this._editor = null;
}
CM.registerWidget('htmleditor', Widget_CK, match);
Widget_CK.prototype.load = function () {
var item = this.entity;
var addGroups = [];
if (item.responseType === 'HTMLEditorCustom') {
if (item.rendererSpec) {
var xmlButtonGroupsDoc = $.parseXML(item.rendererSpec);
var $xml = $(xmlButtonGroupsDoc);
$xml.find('htmlEditor toolbarGroups group').each(function (index, groupEl) {
addGroups.push($(groupEl).attr('name'));
});
}
}
var removeGroups = [];
var page = this.page;
var accProps = page.getAccProps();
var buttonGroups = accProps.getHTMLEditorButtonGroups();
if (buttonGroups.length && buttonGroups[0] != 'TDS_HEBG_None') {
buttonGroups.forEach(function (groupName) {
removeGroups.push(groupName.substring(9).toLowerCase());
});
}
var containerEl = this.element;
var editor = HTMLEditor.create(containerEl, item.responseType, {
addGroups: addGroups,
removeGroups: removeGroups,
disabled: item.isReadOnly()
});
this._editor = editor;
editor.parentItem = item;
if (item.value) {
editor._.data = item.value;
}
}
Widget_CK.prototype.showMenu = function (contentMenu, evt) {
var targetNode = YUE.getTarget(evt);
if (targetNode.tagName == 'HTML') {
var children = targetNode.childNodes;
for (var i = 0; i < children.length; ++i) {
targetNode = children[i];
if (targetNode.tagName == 'BODY') {
break;
}
}
}
while (targetNode) {
if (YUD.hasClass(targetNode, 'cke_editable')) {
contentMenu.cancel = true;
break;
} else {
targetNode = targetNode.parentNode;
}
}
};
Widget_CK.prototype.hide = function() {
var editor = this._editor;
if (editor &&
editor.commands &&
editor.commands.spellchecker &&
editor.commands.spellchecker.enabled) {
editor.commands.spellchecker.exec();
}
};
Widget_CK.prototype.isResponseAvailable = function () {
return this._editor && this._editor.isReady;
}
Widget_CK.prototype.getResponse = function() {
var item = this.entity;
if (item.isResponseType('PlainTextSpell')) {
return this.getResponseText();
} else {
return this.getResponseHtml();
}
}
Widget_CK.prototype.getResponseHtml = function () {
var value = this._editor.getData();
var isValid = (value.length > 0);
return this.createResponse(value, isValid);
}
Widget_CK.prototype.getResponseText = function () {
var value = this._editor.element.$;
value = Util.Dom.getTextContent(value);
var isValid = (value.length > 0);
return this.createResponse(value, isValid);
}
Widget_CK.prototype.setResponse = function(value) {
this._editor.setData(value);
}
CKEDITOR.on('instanceReady', function (ev) {
var editor = ev.editor;
if (!editor) {
return;
}
var item = editor.parentItem;
if (!item) {
return;
}
editor.on('focus', function (ev) {
item.setActiveComponent(editor);
});
item.addComponent(editor);
var doc = editor.document.$;
var win = editor.document.getWindow().$;
if (doc == document) return;
CM.Menu.applyDocFix(win);
CM.addMouseEvents(item, doc);
CM.addKeyEvents(doc);
if (Util.Browser.isTouchDevice()) {
CM.listenForFocus(doc);
}
var page = item.getPage();
if (doc.body) {
var pageAccommodations = page.getAccommodations();
pageAccommodations.applyCSS(doc.body);
}
var zoom = page.getZoom();
zoom.addDocument(doc);
zoom.refresh();
});
})(HTMLEditor, ContentManager);

/* SOURCE FILE: writing.unit.js (49e055f5) 9/9/2014 2:09:05 PM */

function WritingUnit(divUnit)
{
this.onOpenEdit = new YAHOO.util.CustomEvent('onOpenEdit', this, false, YAHOO.util.CustomEvent.FLAT),
this.onCloseEdit = new YAHOO.util.CustomEvent('onCloseEdit', this, false, YAHOO.util.CustomEvent.FLAT),
this.item = null;
this.position = divUnit.id.split('_')[1] * 1;
this.divPrompt = YUD.getElementsByClassName('prompt', 'div', divUnit)[0];
this.divContent = YUD.getElementsByClassName('promptContent', 'span', this.divPrompt)[0];
this.linkSelect = YUD.getElementsByClassName('addMark', 'span', divUnit)[0];
this.linkExpandPrompt = YUD.getElementsByClassName('expandPrompt', 'a', divUnit)[0];
var unitDoc = divUnit.ownerDocument;
this.divComment = unitDoc.getElementById("Item_CommentBox_" + this.position);
this.textComment = unitDoc.getElementById("Item_Comment_" + this.position);
this.hiddenChanged = unitDoc.getElementById("Item_Changed_" + this.position);
this.hiddenSelected = unitDoc.getElementById("Item_Selected_" + this.position);
this.textResponse = unitDoc.getElementById("Item_Response_CR_" + this.position);
this.checkMark = unitDoc.getElementById("Item_Mark_" + this.position);
this.isExpanded = function()
{
return YUD.hasClass(this.divPrompt, 'openedPrompt');
};
this.expand = function()
{
return YUD.addClass(this.divPrompt, 'openedPrompt');
};
this.collapse = function()
{
return YUD.removeClass(this.divPrompt, 'openedPrompt');
};
this.toggleExpand = function()
{
if (this.isExpanded()) this.collapse();
else this.expand();
};
this.isSelected = function()
{
return this.hiddenSelected.value.toUpperCase() == "TRUE";
};
this.getValue = function()
{
return this.textResponse.value;
};
this.hasChanges = function()
{
return this.hiddenChanged.value.toUpperCase() == "TRUE";
};
this.select = function()
{
YUD.addClass(divUnit, 'selectedPrompt');
this.hiddenSelected.value = true;
};
this.deselect = function()
{
YUD.removeClass(divUnit, 'selectedPrompt');
this.hiddenSelected.value = false;
};
}

/* SOURCE FILE: writing.js (f3c0453d) 10/26/2014 1:27:06 PM */

function WritingLayout(divLayout)
{
this.units = [];
this.divBigTable = YUD.getFirstChild(divLayout);
this.linkStart = YUD.getElementsByClassName('writeNow', 'a', divLayout)[0];
this.linksChangePrompt = YUD.getElementsByClassName('changePrompt', 'a', divLayout);
this.linkExpandAll = YUD.getElementsByClassName('expandAll', 'a', divLayout)[0];
this.isEditing = function()
{
return YUD.hasClass(this.divBigTable, 'nowWrite');
};
this.enableEditing = function()
{
var selectedUnit = this.getSelectedUnit();
if (selectedUnit == null)
{
return false;
}
else
{
YUD.addClass(this.divBigTable, 'nowWrite');
if (selectedUnit.item && selectedUnit.item.editor && selectedUnit.item.editor.contentLoaded)
{
selectedUnit.item.editor.show();
selectedUnit.item.editor.hide();
selectedUnit.item.editor.show();
ContentManager.focus(window);
ContentManager.focus(divLayout);
}
selectedUnit.onOpenEdit.fire();
return true;
}
};
this.disableEditing = function() {
var selectedUnit = this.getSelectedUnit();
if (selectedUnit != null) {
if (selectedUnit.item && selectedUnit.item.editor && selectedUnit.item.editor.spell) {
selectedUnit.item.editor.spell.destroy();
}
if (YUD.getStyle(selectedUnit.divComment, 'display') == 'block') {
YUD.setStyle(selectedUnit.divComment, 'display', 'none');
}
}
YUD.removeClass(this.divBigTable, 'nowWrite');
selectedUnit.onCloseEdit.fire();
};
this.toggleEdit = function()
{
if (this.checkForErrors('toggleEdit')) return;
if (this.isEditing())
{
var selectedUnit = this.getSelectedUnit();
if (selectedUnit.item.isReadOnly()) {
return;
}
if (YUD.hasClass(document.body, 'dialogPromptShow')) {
return;
}
var self = this;
var closeEdit = function()
{
self.disableEditing();
TTS.getInstance().stop();
ContentManager.Menu.hide();
};
if (window.TestShell)
{
TestShell.UI.showWarningPrompt('TDSWritingJS.Label.ChangePassage',
{
yes: closeEdit
});
}
else
{
closeEdit();
}
}
else
{
this.enableEditing();
TTS.getInstance().stop();
ContentManager.Menu.hide();
}
};
this.isExpandAll = function()
{
return YUD.hasClass(this.linkExpandAll, 'collapse');
};
this.toggleExpandAll = function()
{
if (this.isEditing()) return;
for(var i = 0; i < this.units.length; i++)
{
if (this.isExpandAll()) this.units[i].collapse();
else this.units[i].expand();
}
if (this.isExpandAll()) YUD.removeClass(this.linkExpandAll, 'collapse');
else YUD.addClass(this.linkExpandAll, 'collapse');
};
this.selectUnit = function(unit)
{
YUD.removeClass(this.linkStart, 'inactive');
var selectedUnit = this.getSelectedUnit();
if (selectedUnit != null)
{
if (selectedUnit == unit)
{
if (this.isEditing()) selectedUnit.toggleExpand();
return;
}
selectedUnit.deselect();
}
unit.select();
this.checkForErrors('selectUnit');
};
this.getSelectedUnit = function()
{
for(var i = 0; i < this.units.length; i++)
{
if (this.units[i].isSelected()) return this.units[i];
}
return null;
};
this.checkForErrors = function(stack)
{
stack = (stack == null) ? '' : stack;
var selectedUnits = [];
for (var i = 0; i < this.units.length; i++)
{
var unit = this.units[i];
if (unit.isSelected()) selectedUnits.push(unit);
}
if (selectedUnits.length > 1)
{
for (var i = 0; i < selectedUnits.length; i++)
{
selectedUnits[i].deselect();
selectedUnits[i].hiddenChanged.value = true;
}
if (this.isEditing()) this.disableEditing();
return true;
}
return false;
};
YUE.addListener(this.linkStart, 'click', this.toggleEdit, this, true);
YUE.addListener(this.linksChangePrompt, 'click', this.toggleEdit, this, true);
YUE.addListener(this.linkExpandAll, 'click', this.toggleExpandAll, this, true);
};

/* SOURCE FILE: writing.widget.js (e86ee98b) 10/26/2014 1:27:06 PM */

(function(CM, CKEDITOR) {
var wordsAllowed = 850;
function countHTMLWords(html) {
if (!html) {
return 0;
}
var text = html.
replace(/(\r\n|\n|\r)/gm, " ").
replace(/^\s+|\s+$/g, "").
replace("&nbsp;", " ");
var tmp = document.createElement("div");
tmp.innerHTML = text;
text = Util.Dom.getTextContent(tmp);
var words = text.split(/\s+/);
for (var wordIndex = words.length - 1; wordIndex >= 0; wordIndex--) {
if (words[wordIndex].match(/^([\s\t\r\n]*)$/)) {
words.splice(wordIndex, 1);
}
}
return words.length;
}
function updateWordCount(item, warning) {
var editor = item.editor;
var isEditorReady = editor && editor.isReady;
var wordsCount = countHTMLWords(isEditorReady ? editor.getData() : item.value);
var wordCountLabel = (wordsCount == 0) ? '' : wordsCount + ' out of ' + wordsAllowed + ' words used.';
var page = item.getPage();
var pageEl = page.getElement();
if (pageEl) {
$('div.writeNav2', pageEl).text(wordCountLabel);
}
if (wordsCount > 0) {
var promptCountLabel = wordsCount + ' words';
var itemEl = item.getElement();
if (itemEl) {
$('span.inlineCount', itemEl).text(promptCountLabel);
}
}
if (isEditorReady && warning && wordsCount > wordsAllowed) {
var message = 'Your response cannot exceed ' + wordsAllowed + ' words.';
TDS.Dialog.showAlert(message, function () {
CM.focus(editor);
});
}
}
function createEditor(writing, item) {
var itemDiv = YUD.get('Item_' + item.position);
var editorDiv = itemDiv.getElementsByClassName('writingBlock')[0];
var editor = HTMLEditor.create(editorDiv, item.responseType, { disabled: item.isReadOnly() });
item.editor = editor;
editor.parentItem = item;
if (item.value) {
editor._.data = item.value;
}
item.addComponent(editor);
editor.on('change', function() {
updateWordCount(item, true);
});
editor.on('instanceReady', function () {
updateWordCount(item, false);
});
}
function processItem(writing, item) {
var unit = new WritingUnit(item.getElement());
unit.item = item;
unit.writing = writing;
writing.units.push(unit);
if (unit.isSelected()) {
unit.select();
YUD.removeClass(writing.linkStart, 'inactive');
item.setActive();
}
YUE.addListener(unit.linkSelect, 'click', function () {
if (CM.Menu.isShowing()) return;
writing.selectUnit(unit);
});
YUE.addListener(unit.linkExpandPrompt, 'click', unit.toggleExpand, unit, true);
item.isVisible = function () {
return Util.Dom.isVisible(unit.divPrompt);
};
unit.onOpenEdit.subscribe(function () {
updateWordCount(item, false);
if (!item.editor) {
createEditor(writing, item);
}
});
updateWordCount(item, false);
return unit;
}
function processPage(page) {
var divWriting = page.getElement();
var writing = new WritingLayout(divWriting);
var wordCountDiv = divWriting.getElementsByClassName('writeNav2')[0];
YUD.addClass(wordCountDiv, 'writeNav2');
var parentDiv = divWriting.getElementsByClassName('bigTable')[0];
parentDiv.appendChild(wordCountDiv);
writing.wordCountEl = wordCountDiv;
var items = page.getItems();
Util.Array.each(items, function (item) {
var unit = processItem(writing, item);
var unitEl = item.getElement();
var config = new CM.WidgetConfig(unitEl.id, unitEl);
var widget = CM.createWidget(Widget_Writing, page, item, config);
widget.unit = unit;
item.widgets.add('writing', widget);
});
if (writing.units.length == 1) {
writing.units[0].select();
writing.enableEditing();
}
else {
writing.toggleEdit();
}
return writing;
}
function Plugin_Writing() {
this.writing = null;
}
CM.registerPagePlugin('writing', Plugin_Writing, function(page) {
return (page.layout == '12');
});
Plugin_Writing.prototype.load = function () {
this.writing = processPage(this.page);
}
function Widget_Writing(page, item) {
this.unit = null;
}
CM.extendWidget(Widget_Writing);
Widget_Writing.prototype.keyEvent = function(evt) {
var unit = this.unit;
var writing = unit.writing;
if (evt.type != 'keydown' || evt.ctrlKey || evt.altKey) return;
if (evt.key == 'Enter' && !writing.isEditing()) {
if (unit.isSelected()) {
writing.enableEditing();
} else {
writing.selectUnit(unit);
}
}
}
Widget_Writing.prototype.showMenu = function(menu) {
var item = this.entity;
var unit = this.unit;
var writing = unit.writing;
if (item.getActiveComponent() != item.getStemElement()) return;
if (writing.isEditing()) {
menu._entity.push({
text: 'Change Prompt',
classname: 'changePrompt',
onclick: {
fn: writing.toggleEdit,
scope: writing
}
});
}
}
Widget_Writing.prototype.isResponseAvailable = function () {
return this.entity.editor && this.entity.editor.isReady;
}
Widget_Writing.prototype.getResponse = function() {
var item = this.entity;
var editor = item.editor;
var unit = this.unit;
var value = editor.getData();
var isValid = (value.length > 0);
var isSelected = unit.isSelected();
return this.createResponse(value, isValid, isSelected);
}
Widget_Writing.prototype.setResponse = function(value) {
var item = this.entity;
var editor = item.editor;
editor.setData(value);
}
})(window.ContentManager, window.CKEDITOR);

/* SOURCE FILE: common.js (815f4e7e) 9/9/2014 2:08:53 PM */

var Lang = YAHOO.util.Lang;
var ErrorHandler =
{
report: function(name, ex)
{
if (typeof console != 'object') return;
console.error(name + ' ' + ex.name + ': ' + ex.message + ' - ' + ex.fileName + ' (line ' + ex.lineNumber + ')');
},
wrapFunction: function(context, name)
{
var fn = context[name];
if (YAHOO.lang.isObject(context) && YAHOO.lang.isFunction(fn))
{
context[name] = function()
{
try
{
return fn.apply(context, arguments);
}
catch (ex)
{
ErrorHandler.report(name, ex);
throw ex;
}
};
}
},
wrapFunctions: function(context, names)
{
if (YAHOO.lang.isArray(names))
{
for (var i = 0; i < names.length; i++)
{
ErrorHandler.wrapFunction(context, names[i]);
}
}
}
};
var EventLazyProvider = function() {};
EventLazyProvider.prototype =
{
_scope: null,
setScope: function(obj) { this._scope = obj; },
fireLazy: function(name, obj)
{
if (!this.hasEvent(name))
{
if (this._scope) this.createEvent(name, { scope: this._scope });
else this.createEvent(name);
}
return this.fireEvent(name, obj);
}
};
YAHOO.lang.augmentProto(EventLazyProvider, YAHOO.util.EventProvider);
(function() {
var con;
try {
con = top.console;
} catch (ex) {
con = console;
}
function Logger(prefix) {
var enabled = true;
this.enable = function() {
enabled = true;
};
this.disable = function() {
enabled = false;
};
function log(level, message, params) {
if (!enabled) {
return;
}
if (level == 'error') {
level = 'warn';
}
if (!con || !con[level]) {
return;
}
if (prefix) {
message = prefix + message;
}
if (params) {
message = YAHOO.lang.substitute(message, params);
}
try {
con[level](message);
} catch (ex) {
}
}
this.debug = function (message, params) { log('debug', message, params); };
this.info = function (message, params) { log('info', message, params); };
this.warn = function (message, params) { log('warn', message, params); };
this.error = function (message, params) { log('error', message, params); };
};
window.Logger = Logger;
})();
var logger = new Logger('GRID: ');

/* SOURCE FILE: grid.js (67cb9899) 9/9/2014 2:08:53 PM */

var Grid = function(element, svgFile)
{
this._element = YAHOO.util.Dom.get(element);
this._svgFile = svgFile;
this.view = null;
this.ui = null;
this.model = null;
this.question = null;
this.importexport = null;
this.palette = null;
this.toolbar = null;
this.feedback = null;
this.canvas = null;
this._currentPanel = null;
this._currentMode = null;
this._state = Grid.State.Uninitialized;
this._canvasComponents = [];
this.showCoordinates = false;
this.allowTab = true;
this._debug = false;
this.view = this.ui = new Grid.View(this._svgFile);
this.model = this.question = new Grid.Model();
this.importexport = new Grid.ImportExport(this.model);
this.palette = new Grid.Palette(this);
this.toolbar = new Grid.Toolbar(this);
this.canvas = new Grid.Canvas(this);
if (Grid.Utils.hasSVGWeb())
{
ErrorHandler.wrapFunctions(this, ['_svgRendered', 'init', 'update', 'loadItemXml', 'loadResponseXml', 'getResponseXml']);
}
Grid.Events.fireLazy('onNew', this);
};
Grid.Events = new EventLazyProvider();
YAHOO.lang.augmentProto(Grid, EventLazyProvider);
Grid.State =
{
Error: -1,
Uninitialized: 0,
Initialized: 1,
Created: 2,
Ready: 3,
Loading: 4,
Loaded: 5
};
GridState = Grid.State;
Grid.prototype.isReadOnly = function() { return false; };
Grid.prototype._setState = function(state, data)
{
this._state = state;
var stateName = 'Unknown';
switch (this._state)
{
case Grid.State.Error: stateName = 'Error'; break;
case Grid.State.Uninitialized: stateName = 'Uninitialized'; break;
case Grid.State.Initialized: stateName = 'Initialized'; break;
case Grid.State.Created: stateName = 'Created'; break;
case Grid.State.Ready: stateName = 'Ready'; break;
case Grid.State.Loading: stateName = 'Loading'; break;
case Grid.State.Loaded: stateName = 'Loaded'; break;
}
this.fireLazy('onStateChange', { grid: this, state: state, name: stateName, data: data });
};
Grid.prototype.getState = function() { return this._state; };
Grid.prototype.reportError = function(msg, ex, silent)
{
this.fireLazy('onError', { message: msg, exception: ex });
if (ex && !silent) throw ex;
};
Grid.prototype._processKeyEvent = function(evt)
{
evt.preventDefault();
if (this.isReadOnly()) return;
var key = '';
switch (evt.keyCode)
{
case 9: key = 'tab'; break;
case 13: key = 'enter'; break;
case 27: key = 'esc'; break;
case 32: key = 'space'; break;
case 37: key = 'left'; break;
case 38: key = 'up'; break;
case 39: key = 'right'; break;
case 40: key = 'down'; break;
}
var keyEvent =
{
dom: evt,
key: key
};
var area = this.getArea();
if (this.allowTab && evt.ctrlKey && key == 'tab')
{
this.view._svgWin.focus();
if (area == 'canvas')
{
if (this.model.options.showPalette) this.setArea('palette');
else if (this.model.options.showButtons.length > 0) this.setArea('toolbar');
}
else if (area == 'palette') this.setArea('toolbar');
else if (area == 'toolbar') this.setArea('canvas');
return;
}
if (area == 'canvas' && typeof this.canvas.processKeyEvent == 'function') this.canvas.processKeyEvent(keyEvent);
else if (area == 'palette' && typeof this.palette.processKeyEvent == 'function') this.palette.processKeyEvent(keyEvent);
else if (area == 'toolbar' && typeof this.toolbar.processKeyEvent == 'function') this.toolbar.processKeyEvent(keyEvent);
};
Grid.prototype._svgRendered = function()
{
var grid = this;
var groupPalette = this.view.getElementById('groupPalette');
var groupToolbar = this.view.getElementById('groupToolbar');
var groupCanvas = this.view.getElementById('groupCanvas');
if (groupPalette) {
Grid.Utils.addMouseListener(groupPalette, 'mousedown', function (evt) {
if (!grid.isReadOnly()) {
grid.setArea('palette');
}
});
}
if (groupToolbar) {
Grid.Utils.addMouseListener(groupToolbar, 'mousedown', function (evt) {
if (!grid.isReadOnly()) {
grid.setArea('toolbar');
}
});
}
Grid.Utils.addMouseListener(groupCanvas, 'mousedown', function (evt) {
if (!grid.isReadOnly()) {
grid.setArea('canvas');
}
});
this.view._svgRoot.addEventListener("keyup", function(evt) { evt.preventDefault(); }, false);
this.view._svgRoot.addEventListener("keypress", function(evt) { evt.preventDefault(); }, false);
this.view._svgRoot.addEventListener("keydown", function(evt)
{
try { grid._processKeyEvent(evt); }
catch (ex) { grid.reportError('Error processing key event', ex); }
}, false);
grid.view._svgRoot.addEventListener('contextmenu', function(evt) {
evt.preventDefault();
}, false);
this.addMouseListener('groupCanvas', function(evt)
{
if (grid.isReadOnly()) return;
try
{
var i = grid._canvasComponents.length;
while (i--)
{
var canvasComponent = grid._canvasComponents[i];
var success;
if (typeof canvasComponent.processMouseEvent == 'function')
{
success = canvasComponent.processMouseEvent(evt);
}
if (success === false) return;
}
}
catch (ex) { grid.reportError('Error processing canvas mouse event', ex); }
});
this.registerCanvasComponent(grid.canvas);
this.addMouseListener('groupWrapper', function(evt)
{
if (grid.isReadOnly()) return;
try { grid.palette.processMouseEvent(evt); }
catch (ex) { grid.reportError('Error processing palette mouse event', ex); }
});
this.addMouseListener('groupCanvas', function(evt)
{
if (grid.showCoordinates)
{
grid.view.setCoordinatesText('(' + evt.currentPosition.x + ',' + (grid.model.options.canvasHeight - evt.currentPosition.y) + ')');
}
});
grid.palette.subscribeToModelEvents();
grid.canvas.subscribeToModelEvents();
if (groupToolbar)
{
this.toolbar.init();
}
this.setMode('move');
if (YAHOO.env.ua.gecko < 1.91)
{
this.view._suspendRedrawEnabled = true;
this.view._attributeBatchEnabled = true;
}
setTimeout(function()
{
grid._setState(Grid.State.Ready);
}, 0);
};
Grid.prototype.registerCanvasComponent = function(obj)
{
this._canvasComponents.push(obj);
};
Grid.prototype.getArea = function() { return this._currentPanel; };
Grid.prototype.setArea = function(panelName)
{
if (this._currentPanel == panelName) return false;
this.canvas.stopAction();
this.canvas.clearFocused();
if (this._currentPanel != null)
{
switch (this._currentPanel)
{
case 'canvas': this.view.setAttributes('backgroundCanvas', { 'stroke': 'black' }); break;
case 'palette': this.view.setAttributes('backgroundPalette', { 'stroke': 'black' }); break;
case 'toolbar': this.view.setAttributes('backgroundToolbar', { 'stroke': 'white' }); break;
}
}
this._currentPanel = panelName;
if (this._currentPanel != null)
{
switch (this._currentPanel)
{
case 'canvas': this.view.setAttributes('backgroundCanvas', { 'stroke': 'blue' }); break;
case 'palette': this.view.setAttributes('backgroundPalette', { 'stroke': 'blue' }); break;
case 'toolbar': this.view.setAttributes('backgroundToolbar', { 'stroke': 'blue' }); break;
}
}
this.fireLazy('onAreaChange', { grid: this, name: panelName });
return true;
};
Grid.prototype.getMode = function() { return this._currentMode; };
Grid.prototype.setMode = function(mode)
{
if (this.palette.moving) return;
if (this._currentMode != null && mode == this._currentMode && mode == 'move') return;
if (mode == this._currentMode)
{
mode = 'move';
}
var currentButton;
if (this._currentMode)
{
currentButton = this.toolbar.getButton(this._currentMode);
if (currentButton) currentButton.deselect();
}
this._currentMode = mode;
currentButton = this.toolbar.getButton(this._currentMode);
if (currentButton) currentButton.select();
this.canvas.stopAction();
this.setModeCursor();
this.setModeHint();
this.fireLazy('onModeChange', { grid: this, name: mode });
};
Grid.prototype.init = function()
{
var grid = this;
if (this.getState() != Grid.State.Uninitialized)
{
throw Error('Grid has already been initialized.');
}
this.view.subscribe('loaded', function()
{
grid._setState(Grid.State.Created);
grid._svgRendered();
});
this._setState(Grid.State.Initialized);
this.view.render(this._element);
};
Grid.prototype.getLayout = function() {
if (this.model == null || this.model.options == null) return null;
var options = this.model.options;
var layout = new Grid.Layout();
layout.setContainerPadding(
options.containerPaddingTop,
options.containerPaddingRight,
options.containerPaddingBottom,
options.containerPaddingLeft);
layout.setPaletteWidth(options.paletteWidth, options.paletteGutter);
layout.setToolbarHeight(options.toolbarHeight, options.toolbarGutter);
layout.setCanvasWidth(options.canvasWidth + options.canvasWidthExt);
layout.setCanvasHeight(options.canvasHeight + options.canvasHeightExt);
layout.setCanvasBorderOffset(options.canvasBorderOffset);
layout.setFeedbackHeight(options.feedbackHeight, options.feedbackGutter);
return layout;
};
Grid.prototype.update = function()
{
var options = this.model.options;
if (options.updateLayout) {
var layout = this.getLayout();
this.view.updateLayout(layout);
}
if (options.showGridLines) this.view.createGridLines(options.gridSpacing);
else this.view.clearGridLines();
if (options.showPalette) this.view.showPalette();
else this.view.hidePalette();
if (options.showFeedback) this.view.showFeedback();
else this.view.hideFeedback();
if (options.showToolbar && options.showButtons.length > 0)
{
this.view.showToolbar();
var buttonNames = ['move'];
for (var i = 0; i < options.showButtons.length; i++)
{
var buttonName = options.showButtons[i];
buttonNames.push(buttonName);
}
this.toolbar.enableButtons(buttonNames);
}
else
{
this.view.hideToolbar();
this.toolbar.resetButtons();
}
this.view.updateCenterScaleImage(options.paletteCenter, options.paletteScale);
this.setMode('move');
};
Grid.prototype.loadXml = function(itemXml, responseXml)
{
if (this._debug) logger.info('LOAD ITEM XML = ' + itemXml);
if (this.getState() < Grid.State.Ready)
{
throw Error('Grid is not ready to load (make sure to call init first).');
}
this._setState(Grid.State.Loading);
var grid = this;
var callbackFailure = function(message, values)
{
grid._setState(Grid.State.Error, { message: message, values: values });
};
var callbackCreated = function()
{
var svgImages = grid.view.getElementsByTagName('image');
if (YAHOO.env.ua.gecko &&
typeof ResourceLoader == 'function' &&
(svgImages && svgImages.length > 0))
{
var imageLoader = new ResourceLoader.ImageCollection();
for (var i = 0; i < svgImages.length; i++)
{
imageLoader.addImage(svgImages[i]);
}
imageLoader.load(callbackLoaded, function()
{
var imageErrors = imageLoader.getErrors();
callbackFailure('Error loading SVG images', imageErrors);
});
}
else
{
callbackLoaded();
}
};
var callbackLoaded = function()
{
grid.update();
if (responseXml)
{
if (grid._debug) logger.info('LOAD RESPONSE XML = ' + responseXml);
grid.importexport.loadAnswer(responseXml);
}
grid._setState(Grid.State.Loaded);
grid.view.zoom(1);
};
this.importexport.loadItem(itemXml, callbackCreated, callbackFailure);
};
Grid.prototype.getResponseXml = function()
{
if (!this.isLoaded()) return null;
return this.importexport.getAnswerXml();
};
Grid.prototype.isLoaded = function()
{
return (this.getState() == Grid.State.Loaded);
};
Grid.prototype.hasChanged = function(xml)
{
if (!this.isLoaded()) return false;
var cleanXml = function(xml)
{
if (xml == null) return '';
var values = xml.split('DOCTYPE');
if (values.length > 1) return values[1].split(' ').join('').split('\r').join('');
else return xml;
};
var currentAnswerXml = this.getResponseXml();
return (cleanXml(currentAnswerXml) != cleanXml(xml));
};
Grid.prototype.isValid = function()
{
if (this.isLoaded())
{
if (this.importexport && this.importexport.isStudentResponseValid()) return true;
}
return false;
};
Grid.Hints =
{
'SetPoint': 'Select locations of points',
'Connect': 'Select 2 points to connect or press & drag to create & connect points.',
'Arrow': 'Select 2 points to connect with arrow.',
'DoubleArrow': 'Select 2 points to connect with double arrow.',
'Delete': 'Select object to delete.',
'AddValue': 'Select point or edge to add value',
'AddLabel': 'Select location of label',
'AddComponent': '',
'MotionPending': 'Move object to new location and click where you want it.',
'DraggingObject': 'Release the mouse button to drop it where you want it.',
'WaitForDropDragging': 'Release the mouse button to drop it where you want it.',
'WaitForDrop': 'Click to drop the object where you want it.',
'None': ' '
};
Grid.getHint = function(key)
{
if(typeof(window.Messages) == 'object')
{
return window.Messages.get("GridJS.Label.Hint"+key);
}
return Grid.Hints[key] || '';
};
Grid.prototype.setHint = function(key) { this.view.setFeedbackText(Grid.getHint(key)); };
Grid.prototype.setModeHint = function()
{
var mode = this.getMode();
switch(mode)
{
case 'move': this.setHint('None'); break;
case 'delete': this.setHint('Delete'); break;
case 'point': this.setHint('SetPoint'); break;
case 'connect': this.setHint('Connect'); break;
case 'arrow': this.setHint('Arrow'); break;
case 'arrw2': this.setHint('DoubleArrow'); break;
default: this.setHint('');
}
};
Grid.prototype.setModeCursor = function()
{
var mode = this.getMode();
switch(mode)
{
case 'move': this.view.setCanvasCursor('default'); break;
case 'delete': this.view.setCanvasCursor('crosshair'); break;
case 'arrow': this.view.setCanvasCursor('pointer'); break;
case 'arrw2': this.view.setCanvasCursor('pointer'); break;
case 'point': this.view.setCanvasCursor('pointer'); break;
case 'connect': this.view.setCanvasCursor('pointer'); break;
default: this.view.setCanvasCursor('default');
}
};
Grid.prototype.addMouseListener = function(id, handler)
{
var group = this.view.getElementById(id);
if (!group) return false;
var grid = this;
var isClicked = false;
var isDragging = false;
var clickedPosition = null;
var mouseEventHandler = function(name               , evt             )
{
evt.preventDefault();
var clientX = evt.clientX - 0.5;
var clientY = evt.clientY - 0.5;
var currentPosition = grid.view.translateElement(group, clientX, clientY);
if (YAHOO.env.ua.ie || YAHOO.env.ua.ios)
{
currentPosition.x = Math.round(currentPosition.x);
currentPosition.y = Math.round(currentPosition.y);
}
if (name == 'mousedown') clickedPosition = currentPosition;
var callHandler = function(eventName)
{
var svgEvent =
{
name: eventName,
target: evt.target,
raw: evt,
currentPosition: currentPosition,
clickedPosition: clickedPosition
};
handler(svgEvent);
};
if (name == 'mousedown')
{
if (isDragging)
{
callHandler('dragend');
isClicked = false;
isDragging = false;
}
else
{
isClicked = true;
callHandler('mousedown');
}
}
else if (name == 'mousemove')
{
if (isClicked) {
if (!isDragging) {
var hasMoved = (clickedPosition.x != currentPosition.x ||
clickedPosition.y != currentPosition.y);
if (hasMoved) {
callHandler('dragbegin');
isDragging = true;
}
}
if (isDragging) {
callHandler('drag');
}
} else {
callHandler('mousemove');
}
}
else if (name == 'mouseup')
{
if (isDragging)
{
callHandler('dragend');
isDragging = false;
}
else if (isClicked)
{
callHandler('mouseup');
}
isClicked = false;
clickedPosition = null;
}
if (name == 'mousedown') {
grid.view._svgWin.focus();
}
};
Grid.Utils.addMouseListener(group, 'mousedown', function(evt) {
mouseEventHandler('mousedown', evt);
});
Grid.Utils.addMouseListener(group, 'mousemove', function(evt) {
mouseEventHandler('mousemove', evt);
});
Grid.Utils.addMouseListener(group, 'mouseup', function(evt) {
mouseEventHandler('mouseup', evt);
});
return true;
};
Grid.prototype.dispose = function()
{
if (this.view) this.view.dispose();
Grid.Events.fireLazy('onDispose', this);
};
Grid.prototype.validate = function()
{
if (YAHOO.env.ua.gecko == 0) return true;
var setError = Util.bind(function(msg, modelImage)
{
if (typeof console == 'object') console.error('GRID: ' + msg);
this._setState(GridState.Error, { message: msg, values: [ modelImage ] });
return false;
}, this);
var modelImages = [];
modelImages = modelImages.concat(this.model.getBackgroundImages());
modelImages = modelImages.concat(this.model.getImages());
modelImages = modelImages.concat(this.model.getRegionsImages());
for (var i = 0; i < modelImages.length; i++)
{
var modelImage = modelImages[i];
var modelRect = modelImage.getBoundingRect();
var inBounds = (modelRect.left >= -1 && modelRect.left <= this.view.width &&
modelRect.top >= -1 && modelRect.top <= this.view.height);
if (!inBounds) return setError('Error with position of image out of bounds', modelImage);
var svgImage = this.view.getElementById(modelImage.getID());
if (!svgImage) return setError('Error finding the svg image', modelImage);
if (modelImage.isVisible())
{
if (svgImage.getAttribute('display') == 'none')
{
return setError('Error with image it should be visible but it is hidden', modelImage);
}
}
else
{
if (svgImage.getAttribute('display') != 'none')
{
return setError('Error with image it should be hidden but it is visible', modelImage);
}
}
var imgAttribs = {
x: svgImage.getAttribute('x') * 1,
y: svgImage.getAttribute('y') * 1,
width: svgImage.getAttribute('width') * 1,
height: svgImage.getAttribute('height') * 1
};
if (modelRect.width != imgAttribs.width ||
modelRect.height != imgAttribs.height)
{
return setError('Error with the attributes width/height of image', modelImage);
}
if (modelRect.left != imgAttribs.x ||
modelRect.top != imgAttribs.y)
{
return setError('Error with the attributes position of image', modelImage);
}
var imgRect = null;
if (modelImage.isVisible() && typeof svgImage.getBBox == 'function')
{
try { imgRect = svgImage.getBBox(); }
catch (ex)
{
return setError('Error with image bounding box', modelImage);
}
}
if (imgRect)
{
if (modelRect.width != imgRect.width ||
modelRect.height != imgRect.height)
{
return setError('Error with the bounding box width/height of image', modelImage);
}
if (modelRect.left != imgRect.x ||
modelRect.top != imgRect.y)
{
return setError('Error with the bounding box position of image', modelImage);
}
}
}
return true;
};

/* SOURCE FILE: utils.js (afbe1732) 9/9/2014 2:08:53 PM */

Grid.Utils = {};
Grid.Utils.hasSVGNative = function() {
return document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1');
};
Grid.Utils.hasSVGWeb = function() {
return (typeof(svgweb) == 'object');
};
Grid.Utils.isSVGFlash = function() {
return (Grid.Utils.hasSVGWeb() && svgweb.getHandlerType() == 'flash');
};
(function (Utils) {
var touchScreen = 'ontouchstart' in window;
var touchEvents = {
'mousedown': 'touchstart',
'mouseup': 'touchend',
'mousemove': 'touchmove'
};
var mouseEvents = {
'mousedown': 'mousedown',
'mouseup': 'mouseup',
'mousemove': 'mousemove'
};
var getWindowsNTVersion = function() {
var matches = navigator.userAgent.match(/Windows NT (\d+\.\d+)/);
var value;
if (matches && matches[1]) {
value = parseFloat(matches[1]);
}
return value || 0;
};
var supportsTouchAndMouse = function() {
return (touchScreen && getWindowsNTVersion() >= 6.1);
};
var normalizeTouchEvent = function (evt) {
if (evt.changedTouches) {
var touches = evt.changedTouches;
for (var i = 0, ii = touches.length; i < ii; i++) {
if (touches[i].target == evt.target) {
var oldevt = evt;
evt = touches[i];
evt.preventDefault = function () {
return oldevt.preventDefault();
};
evt.stopPropagation = function () {
return oldevt.stopPropagation();
};
return evt;
}
}
}
return evt;
};
var addMouseListener = function (target, name, fn) {
var touchAndMouse = supportsTouchAndMouse();
var eventName, altEventName;
if (touchScreen) {
eventName = (touchEvents[name] || name);
if (touchAndMouse) {
altEventName = (mouseEvents[name] || name);
}
} else {
eventName = (mouseEvents[name] || name);
}
var processEvent = function(evt) {
if (touchAndMouse) {
evt.preventDefault();
}
if (touchScreen) {
evt = normalizeTouchEvent(evt);
}
fn(evt);
};
if (eventName) {
target.addEventListener(eventName, processEvent, false);
if (altEventName) {
target.addEventListener(altEventName, processEvent, false);
}
}
};
Utils.addMouseListener = addMouseListener;
})(Grid.Utils);
Grid.Utils.importNode = function(doc, importedNode, deep) {
if (!doc) doc = document;
var node = null;
switch (importedNode.nodeType) {
case 1:
var nodeNS = importedNode.namespaceURI;
if (typeof doc.createElementNS == 'function' && nodeNS != null) {
node = doc.createElementNS(nodeNS, importedNode.nodeName);
} else {
node = doc.createElement(importedNode.nodeName);
}
Grid.Utils.importAttributes(importedNode, node);
if (deep && importedNode.childNodes && importedNode.childNodes.length > 0) {
for (var i = 0, il = importedNode.childNodes.length; i < il; i++) {
var childNode = Grid.Utils.importNode(doc, importedNode.childNodes[i], deep);
if (childNode) node.appendChild(childNode);
}
}
break;
case 3:
node = doc.createTextNode(importedNode.nodeValue, true);
break;
case 4:
break;
case 7:
break;
case 8:
break;
}
return node;
};
Grid.Utils.importAttributes = function(importedNode, node) {
if (importedNode.attributes && importedNode.attributes.length > 0) {
for (var i = 0, il = importedNode.attributes.length; i < il; i++) {
var attrNS = importedNode.attributes[i].namespaceURI;
var attrName = importedNode.attributes[i].nodeName;
if (node.getAttribute(attrName) == null) {
var attrValue = importedNode.getAttribute(attrName);
if (typeof node.setAttributeNS == 'function' && attrNS != null) {
node.setAttributeNS(attrNS, attrName, attrValue);
} else {
node.setAttribute(attrName, attrValue);
}
}
}
}
};
Grid.Utils.getOffset = function(element) {
var hasClientRects = false;
try {
hasClientRects = (element && typeof element.getClientRects == 'function');
} catch (ex) {
}
if (hasClientRects) {
return {
top: element.getClientRects()[0].top,
left: element.getClientRects()[0].left
};
} else {
return {
top: 0,
left: 0
};
}
};
Grid.Utils.getOffsetAdv = function(elem)
{
if (!("getBoundingClientRect" in document.documentElement))
{
return { top: 0, left: 0 };
}
var boxModel = true;
var box = elem.getBoundingClientRect();
var doc = elem.ownerDocument;
var body = doc.body;
var docElem = doc.documentElement;
var clientTop = docElem.clientTop || body.clientTop || 0;
var clientLeft = docElem.clientLeft || body.clientLeft || 0;
var top = box.top + (self.pageYOffset || boxModel && docElem.scrollTop || body.scrollTop) - clientTop;
var left = box.left + (self.pageXOffset || boxModel && docElem.scrollLeft || body.scrollLeft) - clientLeft;
return { top: top, left: left };
};
Grid.Utils.fixOffset = function(svgObject)
{
var getElementFrame = function()
{
var doc;
try {
doc = element.ownerDocument;
} catch (ex) {
return null;
}
var win = doc.parentWindow || doc.defaultView;
return win.frameElement;
};
var element = svgObject;
var elements = [];
do
{
elements.push(element);
}
while (element = getElementFrame())
elements.reverse();
var top = 0, left = 0;
for (var i = 0; i < elements.length; i++)
{
var offset = Grid.Utils.getOffset(elements[i]);
if (offset) {
top += (Math.ceil(offset.top) - offset.top);
left += (Math.ceil(offset.left) - offset.left);
}
}
if (top > 0) {
YAHOO.util.Dom.setStyle(svgObject, 'margin-top', top + 'px');
}
if (left > 0) {
YAHOO.util.Dom.setStyle(svgObject, 'margin-left', left + 'px');
}
};
Grid.Utils.parseElementXY = function(el)
{
var getFloat = function(attrib)
{
var value = el.getAttribute(attrib);
return (value == null) ? 0 : parseFloat(value);
};
var data = {};
if (el.nodeName == 'circle')
{
data.x = getFloat('cx');
data.y = getFloat('cy');
data.radius = getFloat('r');
}
else if (el.nodeName == 'line')
{
data.x1 = getFloat('x1');
data.y1 = getFloat('y1');
data.x2 = getFloat('x2');
data.y2 = getFloat('y2');
}
else if (el.nodeName == 'image' || el.nodeName == 'rect')
{
data.x = getFloat('x');
data.y = getFloat('y');
data.width = getFloat('width');
data.height = getFloat('height');
}
else
{
data.x = getFloat('x');
data.y = getFloat('y');
}
data.thickness = getFloat('stroke-width');
return data;
};

/* SOURCE FILE: crtool.js (992a0fd2) 9/9/2014 2:08:53 PM */

var crToolMouseDownPoint = {x: -1,y: -1};
var crToolMouseDragPoint = {x: -1,y: -1};
var crToolMouseUpPoint = {x: -1,y: -1};
var CRToolMode =
{
Test: 0,
Question: 1,
Dot: 2,
Rectangle: 3,
Circle: 4,
NoAction: 5,
Hotspots: 6
};
function CRTool(grid, mode)
{
this.grid = grid;
this._selectedBackgroundImage = null;
if (mode) this.mode = mode;
else this.mode = CRToolMode.Test;
this.resetCRToolData();
this.grid.showCoordinates = true;
};
CRTool.prototype.setMode = function(mode)
{
this.mode = mode;
this.resetCRToolData();
this.clearCRToolUI();
this.paletteAndSnapPointUIControl();
}
CRTool.prototype.getMode = function()
{
return this.mode;
}
CRTool.prototype.processBackgroundImage = function(evt)
{
if (evt.name == 'mousedown' && evt.target != null)
{
var entity = this.grid.model.getEntity(evt.target.id);
if (entity && entity.getType() == 'backgroundimage')
{
this.grid.canvas.setFocused(entity);
var id = this.grid.canvas._currentFocus.getID();
this._selectedBackgroundImage = this.grid.canvas._currentFocus;
return true;
}
else
{
this.grid.canvas.clearFocused();
return false;
}
}
else if (evt.name == 'drag')
{
if (this._selectedBackgroundImage)
{
var x = evt.currentPosition.x, y = evt.currentPosition.y;
this._selectedBackgroundImage.moveTo(x, y, true);
var id = this._selectedBackgroundImage.getID();
var entity = this._selectedBackgroundImage;
this.grid.view.moveImage(id, entity.x, entity.y, entity.width, entity.height, true);
return true;
}
}
else if (evt.name == 'dragend')
{
if (this._selectedBackgroundImage)
{
var id = this._selectedBackgroundImage.getID();
this.grid.view.deselectImage(id);
this._selectedBackgroundImage.x = this._selectedBackgroundImage.x - this._selectedBackgroundImage.width / 2;
this._selectedBackgroundImage.y = this._selectedBackgroundImage.y - this._selectedBackgroundImage.height;
this._selectedBackgroundImage = null;
return true;
}
}
return false;
};
CRTool.prototype.resetCRToolData = function()
{
crToolMouseUpPoint.x = -1;
crToolMouseUpPoint.y = -1;
crToolMouseDragPoint.x = -1;
crToolMouseDragPoint.y = -1;
crToolMouseDownPoint.x = -1;
crToolMouseDownPoint.y = -1;
}
CRTool.prototype.clearCRToolUI = function()
{
var crtoolShapes = ['crtool_rectangle', 'crtool_circle'];
for (var i=0; i<crtoolShapes.length; i++) removeChildren(crtoolShapes[i]);
}
function removeChildren(id) {
var crtoolNode = this.grid.view.getElementById(id);
var len = crtoolNode.childNodes.length;
var centerIDs = [];
for (var i=0; i<len; i++)
{
centerIDs.push(crtoolNode.childNodes[i].id);
}
for (var j=0; j<len; j++)
{
this.grid.view.removeElement(centerIDs[j]);
}
}
CRTool.prototype.paletteAndSnapPointUIControl = function()
{
if (this.getMode() == CRToolMode.Question) {
if (this.grid.model.options.paletteWidth > 0 &&
!this.grid.model.options.showPalette) this.grid.view.showPalette();
} else {
this.clearSnapPointsUI();
if (this.grid.model.options.showPalette) this.grid.view.showPalette();
else this.grid.view.hidePalette();
}
if (this.getMode() != CRToolMode.Test) this.showSnapPoints();
}
CRTool.prototype.setMouseDownPoint = function(x,y)
{
crToolMouseUpPoint.x = -1;
crToolMouseUpPoint.y = -1;
crToolMouseDragPoint.x = -1;
crToolMouseDragPoint.y = -1;
crToolMouseDownPoint.x = x;
crToolMouseDownPoint.y = y;
}
CRTool.prototype.setMouseDragPoint = function(x,y)
{
crToolMouseDragPoint.x = x;
crToolMouseDragPoint.y = y;
}
CRTool.prototype.setMouseUpPoint = function(x,y)
{
crToolMouseUpPoint.x = x;
crToolMouseUpPoint.y = y;
}
CRTool.prototype.getCRToolData = function(type)
{
if (type == 'mousedown') return crToolMouseDownPoint.x + ',' + crToolMouseDownPoint.y;
if (type == 'drag')      return crToolMouseDragPoint.x + ',' + crToolMouseDragPoint.y;
if (type == 'dragend')   return crToolMouseUpPoint.x + ',' + crToolMouseUpPoint.y;
return '-1,-1';
}
CRTool.prototype.setCRToolMouseLocation = function(evt)
{
var x = Math.round(evt.currentPosition.x),
y = Math.round(evt.currentPosition.y);
if (evt.name == 'mousedown')
{
this.setMouseDownPoint(x,y);
} else
if (evt.name == 'drag')
{
this.setMouseDragPoint(x,y);
} else
if (evt.name == 'mouseup' || evt.name == 'dragend')
{
this.setMouseUpPoint(x,y);
}
};
CRTool.prototype.updateCRToolUI = function(evt)
{
if (evt.name == 'mousemove') return;
if (this.mode == CRToolMode.Rectangle) {
if (this.dataReady('mousedown') && this.dataReady('mouseup')) {
this.drawCRToolRectangle(crToolMouseDownPoint.x, crToolMouseDownPoint.y, crToolMouseUpPoint.x, crToolMouseUpPoint.y);
} else {
if (this.dataReady('mousedown') && this.dataReady('drag')) {
this.drawCRToolRectangle(crToolMouseDownPoint.x, crToolMouseDownPoint.y,crToolMouseDragPoint.x, crToolMouseDragPoint.y);
}
}
} else
if (this.mode == CRToolMode.Circle) {
if (this.dataReady('mousedown') && this.dataReady('mouseup')) {
var r = Math.sqrt( Math.pow((crToolMouseDownPoint.x-crToolMouseUpPoint.x),2) + Math.pow((crToolMouseDownPoint.y-crToolMouseUpPoint.y),2));
this.drawCRToolCircle(crToolMouseDownPoint.x, crToolMouseDownPoint.y,r);
} else {
if (this.dataReady('mousedown') && this.dataReady('drag')) {
var r = Math.sqrt( Math.pow((crToolMouseDownPoint.x-crToolMouseDragPoint.x),2) + Math.pow((crToolMouseDownPoint.y-crToolMouseDragPoint.y),2));
this.drawCRToolCircle(crToolMouseDownPoint.x, crToolMouseDownPoint.y,r);
}
}
} else
if (this.mode == CRToolMode.Question) {
if (!this.getSnapToPointFlag()) return;
if (this.dataReady('mousedown') && this.dataReady('mouseup')) {
if ( (crToolMouseDownPoint.x == crToolMouseUpPoint.x) && (crToolMouseDownPoint.y == crToolMouseUpPoint.y) ) {
var snapPoint = this.grid.model.addSnapPoint(crToolMouseDownPoint.x, crToolMouseDownPoint.y, this.getSnapToPointRadius());
this.resetCRToolData();
this.showSnapPoints();
}
}
}
}
CRTool.prototype.showSnapPoints = function()
{
var snapPnts = this.grid.model.getSnapPoints();
this.clearSnapPointsUI();
if ((snapPnts) && (snapPnts.length > 0)) {
for (var i=0; i<snapPnts.length; i++) {
var id = snapPnts[i].getID();
this.grid.view.createSnapToPointAndCircle(snapPnts[i].x, snapPnts[i].y, this.getSnapToPointRadius(), id);
}
}
}
CRTool.prototype.clearSnapPointsUI = function()
{
removeChildren('crtool_snapcenter');
removeChildren('crtool_snapcircle');
}
CRTool.prototype.drawCRToolCircle = function(x,y,r)
{
this.clearCRToolUI();
this.grid.view.createCRToolCircle(x,y,r);
}
CRTool.prototype.drawCRToolRectangle = function(x1,y1,x2,y2)
{
this.clearCRToolUI();
this.grid.view.createCRToolRectangle(x1,y1,x2,y2);
}
CRTool.prototype.crToolDrawDot = function(x,y)
{
}
CRTool.prototype.getSnapToPointFlag = function()
{
return (document.getElementById('snapToPoint').checked);
}
CRTool.prototype.getSnapToPointRadius = function()
{
return (document.getElementById('snapPointRadius').value);
}
CRTool.prototype.deleteSnapPoint = function(evt)
{
var snapPoints = this.grid.model.getSnapPoints();
for (var i=0; i<snapPoints.length; i++) {
if (('snapPointCenter_snappoint_' + snapPoints[i]._id) == evt.target.id) {
this.grid.view.removeElement(evt.target.id);
this.grid.view.removeElement('snapPointCircle_snappoint_' + snapPoints[i]._id);
this.grid.model.deleteSnapPoint(snapPoints[i]);
this.showSnapPoints();
return true;
}
}
return false;
}
CRTool.prototype.dataReady = function (type)
{
if ((type == 'mousedown') && (crToolMouseDownPoint.x >=0) && (crToolMouseDownPoint.y >=0)) return true;
if ((type == 'drag') && (crToolMouseDragPoint.x >=0) && (crToolMouseDragPoint.y >=0)) return true;
if ((type == 'mouseup') && (crToolMouseUpPoint.x >=0) && (crToolMouseUpPoint.y >=0)) return true;
return false;
}
CRTool.prototype.listStaticGridImages = function()
{
function removePath(urlFile)
{
if (urlFile.indexOf('localhost') == -1)
{
var index = urlFile.lastIndexOf("/");
var file = '../NET/WebGraphicReview/'+ urlFile.substring(index + 1);
return file;
} else {
var pathname = window.location.pathname;
var index = pathname.lastIndexOf("/");
pathname = pathname.substring(0, index);
pathname = window.location.protocol + "//" + window.location.host + pathname;
index = urlFile.indexOf(pathname);
if (index != -1) return urlFile.substring(pathname.length+1);
else return urlFile;
}
}
var bkgImages = this.grid.model.getBackgroundImages();
var imageList = '';
for (var i=0; i<bkgImages.length; i++) {
imageList += translateImageLinkToDisplayName(removePath(bkgImages[i].url) + '|' +
bkgImages[i].x  + ',' + bkgImages[i].y);
if (i != bkgImages.length-1) imageList += ';';
}
return imageList;
}
CRTool.prototype.crToolGetGridPoint = function()
{
var CanvasHeight = this.grid.model.options.canvasHeight;
if ((crToolMouseDownPoint.x == -1) || (crToolMouseUpPoint.x == -1)) return '0,0';
if ((crToolMouseDownPoint.x == crToolMouseUpPoint.x) && (crToolMouseDownPoint.y == crToolMouseUpPoint.y))
return (crToolMouseDownPoint.x + ',' + (CanvasHeight - crToolMouseDownPoint.y));
return '0,0';
}
CRTool.prototype.crToolGetCenterAndTolerance = function()
{
var CanvasHeight = this.grid.model.options.canvasHeight;
if ((crToolMouseDownPoint.x != -1) && (crToolMouseUpPoint.x != -1))
{
var tol = Math.sqrt(Math.pow((crToolMouseDownPoint.x - crToolMouseUpPoint.x),2) + Math.pow((crToolMouseDownPoint.y - crToolMouseUpPoint.y),2));
tol = Math.round(tol);
return  (Math.round(crToolMouseDownPoint.x) + ',' + (CanvasHeight - Math.round(crToolMouseDownPoint.y)) + ',' + tol);
}
return '0,0,0';
}
CRTool.prototype.crToolGetArea = function()
{
var CanvasHeight = this.grid.model.options.canvasHeight;
if ((crToolMouseDownPoint.x != -1) && (crToolMouseUpPoint.x != -1))
{
var area = crToolMouseDownPoint.x + ',' + (CanvasHeight-crToolMouseDownPoint.y) + ',' + crToolMouseUpPoint.x + ',' + (CanvasHeight - crToolMouseUpPoint.y);
return area;
}
return '0,0,0,0';
}
CRTool.prototype.SetSnapToPointRadius = function(radius)
{
var snapPoints = this.grid.model.getSnapPoints();
for (var i = 0; i < snapPoints.length; i++)
{
snapPoints[i].snapRadius = radius;
}
}
CRTool.prototype.setCenterImage = function(onoff)
{
this.grid.view.paletteCenter = onoff;
this.grid.model.options.paletteCenter = onoff;
this.grid.view._updatePaletteLayout();
}
CRTool.prototype.setScaleImage = function(onoff)
{
this.grid.view.paletteScale = onoff;
this.grid.model.options.paletteScale = onoff;
this.grid.view._updatePaletteLayout();
}
var crToolCanvsComponent =
{
processMouseEvent: function(evt)
{
var crtool = getGridCRtoolObject();
if (crtool == null) return;
if (crtool.getMode() == CRToolMode.Question)
{
var btnMode = getGridObject().getMode();
if (btnMode == 'move')
{
if (crtool.getSnapToPointFlag())
{
crtool.setCRToolMouseLocation(evt);
crtool.updateCRToolUI(evt);
}
else
{
}
}
else if (btnMode == 'delete')
{
if (evt.name == 'mousedown') crtool.deleteSnapPoint(evt);
}
}
else
{
crtool.setCRToolMouseLocation(evt);
crtool.updateCRToolUI(evt);
}
}
}

/* SOURCE FILE: math.js (226d2130) 9/9/2014 2:08:53 PM */

function Point2D(x,y){if(arguments.length>0){this.x=x;this.y=y;}}
Point2D.prototype.clone=function(){return new Point2D(this.x,this.y);};
Point2D.prototype.add=function(that){return new Point2D(this.x+that.x,this.y+that.y);};
Point2D.prototype.addEquals=function(that){this.x+=that.x;this.y+=that.y;return this;};
Point2D.prototype.offset=function(a,b){var result=0;if(!(b.x<=this.x||this.x+a.x<=0)){var t=b.x*a.y-a.x*b.y;var s;var d;if(t>0){if(this.x<0){s=this.x*a.y;d=s/a.x-this.y;}else if(this.x>0){s=this.x*b.y;d=s/b.x-this.y}else{d=-this.y;}}else{if(b.x<this.x+a.x){s=(b.x-this.x)*a.y;d=b.y-(this.y+s/a.x);}else if(b.x>this.x+a.x){s=(a.x+this.x)*b.y;d=s/b.x-(this.y+a.y);}else{d=b.y-(this.y+a.y);}}if(d>0){result=d;}}return result;};
Point2D.prototype.rmoveto=function(dx,dy){this.x+=dx;this.y+=dy;};
Point2D.prototype.scalarAdd=function(scalar){return new Point2D(this.x+scalar,this.y+scalar);};
Point2D.prototype.scalarAddEquals=function(scalar){this.x+=scalar;this.y+=scalar;return this;};
Point2D.prototype.subtract=function(that){return new Point2D(this.x-that.x,this.y-that.y);};
Point2D.prototype.subtractEquals=function(that){this.x-=that.x;this.y-=that.y;return this;};
Point2D.prototype.scalarSubtract=function(scalar){return new Point2D(this.x-scalar,this.y-scalar);};
Point2D.prototype.scalarSubtractEquals=function(scalar){this.x-=scalar;this.y-=scalar;return this;};
Point2D.prototype.multiply=function(scalar){return new Point2D(this.x*scalar,this.y*scalar);};
Point2D.prototype.multiplyEquals=function(scalar){this.x*=scalar;this.y*=scalar;return this;};
Point2D.prototype.divide=function(scalar){return new Point2D(this.x/scalar, this.y/scalar);};
Point2D.prototype.divideEquals=function(scalar){this.x/=scalar;this.y/=scalar;return this;};
Point2D.prototype.compare=function(that){return(this.x-that.x||this.y-that.y);};
Point2D.prototype.eq=function(that){return(this.x==that.x&&this.y==that.y);};
Point2D.prototype.lt=function(that){return(this.x<that.x&&this.y<that.y);};
Point2D.prototype.lte=function(that){return(this.x<=that.x&&this.y<=that.y);};
Point2D.prototype.gt=function(that){return(this.x>that.x&&this.y>that.y);};
Point2D.prototype.gte=function(that){return(this.x>=that.x&&this.y>=that.y);};
Point2D.prototype.distanceFrom=function(that){var dx=this.x-that.x;var dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy);};
Point2D.prototype.min=function(that){return new Point2D(Math.min(this.x,that.x),Math.min(this.y,that.y));};
Point2D.prototype.max=function(that){return new Point2D(Math.max(this.x,that.x),Math.max(this.y,that.y));};
Point2D.prototype.toString=function(){return this.x+","+this.y;};
Point2D.prototype.setXY=function(x,y){this.x=x;this.y=y;};
Point2D.prototype.setFromPoint=function(that){this.x=that.x;this.y=that.y;};
Point2D.prototype.swap=function(that){var x=this.x;var y=this.y;this.x=that.x;this.y=that.y;that.x=x;that.y=y;};
Point2D.prototype.lerp=function(that,t){return new Point2D(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t);};
function Intersection(status){if(arguments.length>0){this.init(status);}}
Intersection.prototype.init=function(status){this.status=status;this.points=new Array();};
Intersection.prototype.appendPoint=function(point){this.points.push(point);};
Intersection.prototype.appendPoints=function(points){this.points=this.points.concat(points);};
Intersection.intersectCircleCircle=function(c1,r1,c2,r2){var result;var r_max=r1+r2;var r_min=Math.abs(r1-r2);var c_dist=c1.distanceFrom(c2);if(c_dist>r_max){result=new Intersection("Outside");}else if(c_dist<r_min){result=new Intersection("Inside");}else{result=new Intersection("Intersection");var a=(r1*r1-r2*r2+c_dist*c_dist)/(2*c_dist);var h=Math.sqrt(r1*r1-a*a);var p=c1.lerp(c2,a/c_dist);var b=h/c_dist;result.points.push(new Point2D(p.x-b*(c2.y-c1.y),p.y+b*(c2.x-c1.x)));result.points.push(new Point2D(p.x+b*(c2.y-c1.y),p.y-b*(c2.x-c1.x)));}return result;};
Intersection.intersectCircleLine=function(c,r,a1,a2){var result;var a=(a2.x-a1.x)*(a2.x-a1.x)+(a2.y-a1.y)*(a2.y-a1.y);var b=2*((a2.x-a1.x)*(a1.x-c.x)+(a2.y-a1.y)*(a1.y-c.y));var cc=c.x*c.x+c.y*c.y+a1.x*a1.x+a1.y*a1.y-2*(c.x*a1.x+c.y*a1.y)-r*r;var deter=b*b-4*a*cc;if(deter<0){result=new Intersection("Outside");}else if(deter==0){result=new Intersection("Tangent");}else{var e=Math.sqrt(deter);var u1=(-b+e)/(2*a);var u2=(-b-e)/(2*a);if((u1<0||u1>1)&&(u2<0||u2>1)){if((u1<0&&u2<0)||(u1>1&&u2>1)){result=new Intersection("Outside");}else{result=new Intersection("Inside");}}else{result=new Intersection("Intersection");if(0<=u1&&u1<=1)result.points.push(a1.lerp(a2,u1));if(0<=u2&&u2<=1)result.points.push(a1.lerp(a2,u2));}}return result;};
Intersection.intersectLineLine=function(a1,a2,b1,b2){var result;var ua_t=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x);var ub_t=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x);var u_b=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(u_b!=0){var ua=ua_t/u_b;var ub=ub_t/u_b;if(0<=ua&&ua<=1&&0<=ub&&ub<=1){result=new Intersection("Intersection");result.points.push(new Point2D(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)));}else{result=new Intersection("No Intersection");}}else{if(ua_t==0||ub_t==0){result=new Intersection("Coincident");}else{result=new Intersection("Parallel");}}return result;};
Intersection.intersectRectangleRectangle=function(a1,a2,b1,b2){var min=a1.min(a2);var max=a1.max(a2);var topRight=new Point2D(max.x,min.y);var bottomLeft=new Point2D(min.x,max.y);var inter1=Intersection.intersectLineRectangle(min,topRight,b1,b2);var inter2=Intersection.intersectLineRectangle(topRight,max,b1,b2);var inter3=Intersection.intersectLineRectangle(max,bottomLeft,b1,b2);var inter4=Intersection.intersectLineRectangle(bottomLeft,min,b1,b2);var result=new Intersection("No Intersection");result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectCircleRectangle = function(c, r, r1, r2) { var min = r1.min(r2); var max = r1.max(r2); var topRight = new Point2D(max.x, min.y); var bottomLeft = new Point2D(min.x, max.y); var inter1 = Intersection.intersectCircleLine(c, r, min, topRight); var inter2 = Intersection.intersectCircleLine(c, r, topRight, max); var inter3 = Intersection.intersectCircleLine(c, r, max, bottomLeft); var inter4 = Intersection.intersectCircleLine(c, r, bottomLeft, min); var result = new Intersection("No Intersection"); result.appendPoints(inter1.points); result.appendPoints(inter2.points); result.appendPoints(inter3.points); result.appendPoints(inter4.points); if (result.points.length > 0) result.status = "Intersection"; else result.status = inter1.status; return result; };
Intersection.intersectLineRectangle = function(a1, a2, r1, r2) { var min = r1.min(r2); var max = r1.max(r2); var topRight = new Point2D(max.x, min.y); var bottomLeft = new Point2D(min.x, max.y); var inter1 = Intersection.intersectLineLine(min, topRight, a1, a2); var inter2 = Intersection.intersectLineLine(topRight, max, a1, a2); var inter3 = Intersection.intersectLineLine(max, bottomLeft, a1, a2); var inter4 = Intersection.intersectLineLine(bottomLeft, min, a1, a2); var result = new Intersection("No Intersection"); result.appendPoints(inter1.points); result.appendPoints(inter2.points); result.appendPoints(inter3.points); result.appendPoints(inter4.points); if (result.points.length > 0) result.status = "Intersection"; return result; };

/* SOURCE FILE: model.js (546da46e) 9/9/2014 2:08:53 PM */

Grid.Model = function(id, options)
{
this.id = id || '';
this.options = options || new Grid.Model.Options();
this._uuid = 0;
this.questionPartID = 1;
this.description = '';
this.defaultRadius = 5;
this._collection = [];
this._cache = {};
this._addCache = function(id, obj) { this._cache[id] = obj; };
this._removeCache = function(id) { this._cache[id] = null; };
this._points = [];
this._snappoints = [];
this._lines = [];
this._paletteimages = [];
this._canvasimages = [];
this._staticimages = [];
this._backgroundimages = [];
this._labels = [];
this._rectangles = [];
this._circles = [];
this._regions = [];
this._regionGroups = [];
this.importing = false;
this._listenForCacheEvents();
this._instance = ++Grid.Model._instances;
};
YAHOO.lang.augmentProto(Grid.Model, EventLazyProvider);
Grid.Model.arrayRemoveAt = function(arr, i)
{
return (Array.prototype.splice.call(arr, i, 1).length == 1);
};
Grid.Model.arrayRemove = function(arr, obj)
{
var i = arr.indexOf(obj);
var rv;
if ((rv = i >= 0))
{
Grid.Model.arrayRemoveAt(arr, i);
}
return rv;
};
Grid.Model._instances = 0;
Grid.Model.getEmptyStyles = function()
{
return {
'fill': 'white',
'fill-opacity': '0',
'stroke': 'white',
'stroke-width': '0',
'stroke-opacity': '',
'stroke-dasharray': ''
};
};
Grid.Model.getDefaultStyles = function()
{
return {
'fill': 'white',
'fill-opacity': '0',
'stroke': 'red',
'stroke-width': '1',
'stroke-opacity': '',
'stroke-dasharray': ''
};
};
Grid.Model.prototype._createUUID = function()
{
var t = new Date().getTime();
var r = Math.random().toString().split('.')[1] * 1;
++this._uuid;
return this._uuid;
};
Grid.Model.prototype._listenForCacheEvents = function()
{
var model = this;
this.subscribe('onAdd', function(entity)
{
var id = entity.getID();
model._cache[id] = entity;
model._collection.push(entity);
});
this.subscribe('onDelete', function(entity)
{
var id = entity.getID();
delete model._cache[id];
Grid.Model.arrayRemove(model._collection, entity);
});
};
Grid.Model.prototype._hasString = function(id) { return (Lang.isString(id) && id.length > 0); };
Grid.Model.prototype.deleteEntity = function(entityToDelete)
{
var type = entityToDelete.getType();
var collectionName = '_' + type + 's';
var collection = this[collectionName];
if (collection != null)
{
Grid.Model.arrayRemove(this[collectionName], entityToDelete);
}
this.fireLazy('onDelete', entityToDelete);
};
Grid.Model.prototype.clearResponse = function()
{
while (this._snappoints.length > 0) this.deleteSnapPoint(this._snappoints[0]);
while (this._points.length > 0) this.deletePoint(this._points[0]);
while (this._canvasimages.length > 0) this.deleteImage(this._canvasimages[0]);
while (this._circles.length > 0) this.deleteCircle(this._circles[0]);
for (var i = 0; i < this._regions.length; i++)
{
var region = this._regions[i];
if (region.isSelected()) region.deselect();
}
};
Grid.Model.prototype.clearQuestion = function()
{
this.clearResponse();
while (this._snappoints.length > 0) this.deleteSnapPoint(this._snappoints[0]);
while (this._paletteimages.length > 0) this.deletePaletteImage(this._paletteimages[0]);
while (this._backgroundimages.length > 0) this.deleteBackgroundImage(this._backgroundimages[0]);
while (this._staticimages.length > 0) this.deleteStaticImage(this._staticimages[0]);
while (this._regionGroups.length > 0) this.deleteRegionGroup(this._regionGroups[0], true);
this.options = new Grid.Model.Options();
};
Grid.Model.prototype.getEntity = function(id)
{
if (id == null || id == '') return null;
return this._cache[id] || null;
};
Grid.Model.prototype.getEntities = function() { return this._collection; };
Grid.Model.prototype.addEntity = function(entity)
{
this.fireLazy('onAdd', entity);
};
Grid.Model.prototype.addPoint = function(x, y)
{
var radius = (arguments[2] > 0) ? arguments[2] : this.defaultRadius;
var point = new Grid.Model.Point(this, x, y, radius);
this._points.push(point);
this.fireLazy('onAdd', point);
return point;
};
Grid.Model.prototype.getPoints = function() { return this._points; };
Grid.Model.prototype.deletePoint = function(point)
{
for (var i = 0; i < this._points.length; i++)
{
if (point != this._points[i]) continue;
var pointLines = point.getLines();
for (var j = 0; j < pointLines.length; j++)
{
var line = pointLines[j];
this.deleteLine(line);
}
Grid.Model.arrayRemoveAt(this._points, i);
this.fireLazy('onDelete', point);
return true;
}
return false;
};
Grid.Model.prototype.getLines = function() { return this._lines; };
Grid.Model.prototype.addLine = function(source, target, dirType, style)
{
if (!source || !target) throw new Error('Invalid source or target point');
if (source == target) return null;
for(var i = 0; i < this._lines.length; i++)
{
var existingLine = this._lines[i];
if (source == existingLine.source && target == existingLine.target) return existingLine;
if (target == existingLine.source && source == existingLine.target) return existingLine;
}
var line = new Grid.Model.Line(this, source, target, dirType, style, this.options.properLineGeometry);
this._lines.push(line);
this.fireLazy('onAdd', line);
return line;
};
Grid.Model.prototype.getLinesByDir = function(dirType)
{
var lineDirections = [];
for (var i = 0; i < this._lines.length; i++)
{
var line = this._lines[i];
if (line.dirType == dirType) lineDirections.push(line);
}
return lineDirections;
};
Grid.Model.prototype.deleteLine = function(line)
{
return this.deleteEntity(line);
};
Grid.Model.prototype.getSnapPoints = function() { return this._snappoints; };
Grid.Model.prototype.addSnapPoint = function(x, y, snapRadius)
{
var snapPoint = new Grid.Model.SnapPoint(this, x, y, this.defaultRadius, snapRadius);
this._snappoints.push(snapPoint);
this.fireLazy('onAdd', snapPoint);
return snapPoint;
};
Grid.Model.prototype.deleteSnapPoint = function(snapPoint)
{
return this.deleteEntity(snapPoint);
};
Grid.Model.prototype.getPaletteImages = function() { return this._paletteimages; };
Grid.Model.prototype.addPaletteImage = function(name              , url                 , width, height)
{
var paletteImage = new Grid.Model.PaletteImage(this, name, url, width, height);
this._paletteimages.push(paletteImage);
this.fireLazy('onAdd', paletteImage);
return paletteImage;
};
Grid.Model.prototype.deletePaletteImage = function(paletteImage)
{
var canvasImages = paletteImage.getImages();
this.deleteEntity(paletteImage);
for (var i = 0; i < canvasImages.length; i++)
{
this.deleteEntity(canvasImages[0]);
}
};
Grid.Model.prototype.getImages = function() { return this._canvasimages; };
Grid.Model.prototype.addImage = function(name, x, y)
{
if (!Lang.isString(name) || name.length == 0) return null;
var paletteImage = null;
for (var i = 0; i < this._paletteimages.length; i++)
{
if (name == this._paletteimages[i].name)
{
paletteImage = this._paletteimages[i];
break;
}
}
if (paletteImage == null) throw new Error('Cannot add the image ' + name + ' because the palette image does not exist.');
var image = new Grid.Model.Image(this, name, x, y, paletteImage.width, paletteImage.height);
this._canvasimages.push(image);
this.fireLazy('onAdd', image);
return image;
};
Grid.Model.prototype.deleteImage = function(image)
{
return this.deleteEntity(image);
};
Grid.Model.prototype.getStaticImages = function() { return this._staticimages; };
Grid.Model.prototype.addStaticImage = function(url                 , x, y, width, height)
{
var staticImage = new Grid.Model.StaticImage(this, url, x, y, width, height);
this._staticimages.push(staticImage);
this.fireLazy('onAdd', staticImage);
return staticImage;
};
Grid.Model.prototype.deleteStaticImage = function(staticImage)
{
return this.deleteEntity(staticImage);
};
Grid.Model.prototype.getBackgroundImages = function() { return this._backgroundimages; };
Grid.Model.prototype.addBackgroundImage = function(url                 , x, y, width, height)
{
var backgroundImage = new Grid.Model.BackgroundImage(this, url, x, y, width, height);
this._backgroundimages.push(backgroundImage);
this.fireLazy('onAdd', backgroundImage);
return backgroundImage;
};
Grid.Model.prototype.deleteBackgroundImage = function(backgroundImage)
{
return this.deleteEntity(backgroundImage);
};
Grid.Model.prototype.getRectangles = function() { return this._rectangles; };
Grid.Model.prototype.createRectangle = function(x1, y1, x2, y2)
{
var width = (x2 - x1);
var height = (y2 - y1);
return new Grid.Model.Rectangle(this, x1, y1, width, height);
};
Grid.Model.prototype.addRectangle = function(rect)
{
if (!(rect instanceof Grid.Model.Rectangle)) throw new Error('Can only add valid rectangle objects.');
this._rectangles.push(rect);
this.fireLazy('onAdd', rect);
return rect;
};
Grid.Model.prototype.getCircles = function() { return this._circles; };
Grid.Model.prototype.createCircle = function(x, y, radius)
{
return new Grid.Model.Circle(this, x, y, radius);
};
Grid.Model.prototype.addCircle = function(circle)
{
if (!(circle instanceof Grid.Model.Circle)) throw new Error('Can only add valid circle objects.');
this._circles.push(circle);
this.fireLazy('onAdd', circle);
return circle;
};
Grid.Model.prototype.deleteCircle = function (circle)
{
return this.deleteEntity(circle);
};
Grid.Model.prototype.getLabels = function() { return this._labels; };
Grid.Model.prototype.addLabel = function(x, y, text, fontSize, fontFamily)
{
var label = new Grid.Model.Label(this, x, y, text, fontSize, fontFamily);
this._labels.push(label);
this.fireLazy('onAdd', label);
return label;
};
Grid.Model.prototype.getRegionGroups = function() { return this._regionGroups; };
Grid.Model.prototype.getRegionGroup = function(name)
{
var regionGroups = grid.model.getRegionGroups();
for (var i = 0; i < regionGroups.length; i++)
{
var group = regionGroups[i];
if (group.name == name) return group;
}
return null;
};
Grid.Model.prototype.createRegionGroup = function(name, min, max)
{
var regionGroup = new Grid.Model.RegionGroup(this, name, min, max);
this._regionGroups.push(regionGroup);
return regionGroup;
};
Grid.Model.prototype.deleteRegionGroup = function(group, deleteOrphans)
{
var regions = group.getRegions();
while (regions.length > 0)
{
group.removeRegion(regions[0], deleteOrphans);
}
Grid.Model.arrayRemove(this._regionGroups, group);
};
Grid.Model.prototype.createRegion = function(name           , shape           , coords           )
{
var region = null;
switch (shape)
{
case 'rect': region = this._buildRegionRect(name); break;
case 'circle': region = this._buildRegionCircle(name); break;
case 'poly': region = this._buildRegionPolygon(name); break;
}
if (region != null)
{
region.setHoverable(true);
region.setFocusable(Grid.Model.Focusable.Auto);
region.setSelectable(true);
region.setMoveable(false);
this.addEntity(region);
this._regions.push(region);
if (YAHOO.lang.isString(coords))
{
region.setCoords(coords);
}
}
return region;
};
Grid.Model.prototype._buildRegionRect = function(name)
{
var regionClass = Grid.Model.buildRegion(Grid.Model.Rectangle, name);
return new regionClass(this, 0, 0, 0, 0);
};
Grid.Model.prototype._buildRegionCircle = function(name)
{
var regionClass = Grid.Model.buildRegion(Grid.Model.Circle, name);
return new regionClass(this, 0, 0, 0);
};
Grid.Model.prototype._buildRegionPolygon = function(name)
{
var regionClass = Grid.Model.buildRegion(Grid.Model.Polygon, name);
return new regionClass(this);
};
Grid.Model.prototype.deleteRegion = function(region)
{
var events = region.getEvents();
for (var i = 0; i < events.length; i++)
{
var event = events[i];
region.deleteEvent(event);
}
Grid.Model.arrayRemove(this._regions, region);
this.deleteEntity(region);
};
Grid.Model.prototype.getRegions = function() { return this._regions; };
Grid.Model.prototype.getRegion = function(name)
{
for (var i = 0; i < this._regions.length; i++)
{
var region = this._regions[i];
if (region.name == name) return region;
}
return null;
};
Grid.Model.prototype.getRegionsImages = function()
{
var regionImages = [];
var regions = this.getRegions();
for (var i = 0; i < regions.length; i++)
{
var regionEvents = regions[i].getEvents();
for (var j = 0; j < regionEvents.length; j++)
{
var eventImage = regionEvents[j].getImage();
if (eventImage != null) regionImages.push(eventImage);
}
}
return regionImages;
};

/* SOURCE FILE: model.options.js (103f2380) 9/9/2014 2:08:53 PM */

Grid.Model.Options = function()
{
this.updateLayout = true;
this.containerPaddingTop = 0;
this.containerPaddingRight = 1;
this.containerPaddingBottom = 1;
this.containerPaddingLeft = 0;
this.showPalette = false;
this.paletteWidth = 75;
this.paletteGutter = 5;
this.paletteCenter = false;
this.paletteScale = false;
this.showToolbar = true;
this.toolbarHeight = 21;
this.toolbarGutter = 4;
this.showButtons = [];
this.canvasWidth = 500;
this.canvasWidthExt = 2;
this.canvasHeight = 410;
this.canvasHeightExt = 1;
this.canvasBorderOffset = -1;
this.properLineGeometry = false;
this.showGridLines = false;
this.gridColor = 'None';
this.gridSpacing = 0;
this.snapToGrid = false;
this.snapRadius = 0;
this.selectionTolerance = 0;
this.showFeedback = true;
this.feedbackHeight = 30;
this.feedbackGutter = 4;
};
Grid.Model.Options.prototype.addButton = function(button)
{
if (button == 'delete' ||
button == 'point' ||
button == 'connect' ||
button == 'arrow' ||
button == 'arrw2' ||
button == 'dash' ||
button == 'circle') {
this.showButtons.push(button);
}
};
Grid.Model.Options.prototype.clearButtons = function() {
this.showButtons = [];
};

/* SOURCE FILE: model.base.js (b3d6fadd) 9/9/2014 2:08:53 PM */

Grid.Model.Base = function(model)
{
if (!(model instanceof Grid.Model))
{
throw new Error('The base class does not have a valid model.');
}
this.model = model;
this._id = model._instance + '_' + model._createUUID();
this._visible = true;
this._hoverable = false;
this._hovering = false;
this._focusable = Grid.Model.Focusable.Never;
this._focused = false;
this._moveable = false;
this._deletable = false;
this._selectable = false;
this._selected = false;
};
Grid.Model.Focusable =
{
Never: 0,
Manual: 1,
Auto: 2
};
Grid.Model.Base.prototype.getType = function()
{
if (this instanceof Grid.Model.BackgroundImage) return 'backgroundimage';
if (this instanceof Grid.Model.StaticImage) return 'staticimage';
if (this instanceof Grid.Model.PaletteImage) return 'paletteimage';
if (this instanceof Grid.Model.Image) return 'canvasimage';
if (this instanceof Grid.Model.Line) return 'line';
if (this instanceof Grid.Model.SnapPoint) return 'snappoint';
if (this instanceof Grid.Model.Point) return 'point';
if (this instanceof Grid.Model.Circle) return 'circle';
if (this instanceof Grid.Model.Rectangle) return 'rect';
if (this instanceof Grid.Model.Polygon) return 'poly';
if (this instanceof Grid.Model.Path) return 'path';
if (this instanceof Grid.Model.Base) return 'base';
return 'unknown';
};
Grid.Model.Base.prototype.getID = function()
{
return this.getType() + '_' + this._id;
};
Grid.Model.Base.prototype.setVisible = function(visible) { this._visible = visible; };
Grid.Model.Base.prototype.isVisible = function() { return this._visible; };
Grid.Model.Base.prototype.show = function()
{
this.setVisible(true);
this.update();
};
Grid.Model.Base.prototype.hide = function()
{
this.setVisible(false);
this.update();
};
Grid.Model.Base.prototype.setHoverable = function(hoverable) { this._hoverable = hoverable; };
Grid.Model.Base.prototype.isHoverable = function()
{
return this.isVisible() ? this._hoverable : false;
};
Grid.Model.Base.prototype.setHovering = function(hovering) { this._hovering = hovering; };
Grid.Model.Base.prototype.isHovering = function() { return this._hovering; };
Grid.Model.Base.prototype.setFocusable = function(focusable) { this._focusable = focusable; };
Grid.Model.Base.prototype.isFocusable = function()
{
return this.isVisible() ? this._focusable : false;
};
Grid.Model.Base.prototype.setFocused = function(focused) { this._focused = focused; };
Grid.Model.Base.prototype.isFocused = function() { return this._focused; };
Grid.Model.Base.prototype.setSelectable = function(selectable) { this._selectable = selectable; };
Grid.Model.Base.prototype.isSelectable = function() { return this._selectable; };
Grid.Model.Base.prototype.isSelected = function() { return this._selected; };
Grid.Model.Base.prototype.select = function()
{
if (this.isSelected()) return false;
if (!this.isSelectable()) return false;
this._selected = true;
this.update();
return true;
};
Grid.Model.Base.prototype.deselect = function()
{
if (!this.isSelected()) return false;
this._selected = false;
this.update();
return true;
};
Grid.Model.Base.prototype.setMoveable = function(moveable) { this._moveable = moveable; };
Grid.Model.Base.prototype.isMoveable = function() { return this._moveable; };
Grid.Model.Base.prototype.setDeletable = function(deletable) { this._deletable = deletable; };
Grid.Model.Base.prototype.isDeletable = function() { return this._deletable; };
Grid.Model.Base.prototype.update = function()
{
this.model.fireLazy('onUpdate', this);
};
Grid.Model.Base.prototype.setCoords = function() {};
Grid.Model.Base.prototype.getStyles = function()
{
return Grid.Model.getDefaultStyles();
};
Grid.Model.Base.prototype.getElement = function(view)
{
var id = this.getID();
return view.getElementById(id);
};
Grid.Model.Base.prototype.createElement = function(view) { return null; };
Grid.Model.Base.prototype.getElementGroup = function() { return 'shapes'; };
Grid.Model.Base.prototype.appendElement = function(view, element)
{
var groupId = this.getElementGroup();
view.appendChild(groupId, element);
};
Grid.Model.Base.prototype.moveElement = function(view) {};
Grid.Model.Base.prototype.removeElement = function(view)
{
var id = this.getID();
view.removeElement(id);
};
Grid.Model.Base.prototype.updateElement = function(view)
{
var element = this.getElement(view);
if (element == null) return;
var styles = this.getStyles();
view.setAttributes(element, styles);
var visible = this.isVisible();
view.setAttributes(element,
{
'display': visible ? 'inline' : 'none'
});
};

/* SOURCE FILE: model.position.js (73916789) 9/9/2014 2:08:53 PM */

Grid.Model.Position = function(model, x, y)
{
Grid.Model.Position.superclass.constructor.call(this, model);
this.x = x;
this.y = y;
this._boundsEnabled = true;
this._snapEnabled = true;
};
Lang.extend(Grid.Model.Position, Grid.Model.Base);
Grid.Model.Position.prototype.get2D = function() { return new Point2D(this.x, this.y); };
Grid.Model.Position.prototype.isBoundsEnabled = function() { return this._boundsEnabled; };
Grid.Model.Position.prototype.setBoundsEnabled = function(boundsEnabled) { this._boundsEnabled = boundsEnabled; };
Grid.Model.Position.prototype.isSnapEnabled = function() { return this._snapEnabled; };
Grid.Model.Position.prototype.setSnapEnabled = function(snapEnabled) { this._snapEnabled = snapEnabled; };
Grid.Model.Position.prototype.getFixedCoords = function(x, y)
{
return { x: x, y: y };
};
Grid.Model.Position.prototype.moveTo = function(moveX, moveY, preventSnap             )
{
if (this.isBoundsEnabled())
{
var fixedCoords = this.getFixedCoords(moveX, moveY);
moveX = fixedCoords.x;
moveY = fixedCoords.y;
}
if (moveX == this.x && moveY == this.y) return false;
this.x = moveX;
this.y = moveY;
if (this.isSnapEnabled() && !preventSnap) this.snapToGrid();
this.model.fireLazy('onMove', this);
return true;
};
Grid.Model.Position.prototype._moveBy = function(moveSize)
{
var options = this.model.options;
if (options.snapToGrid && options.gridSpacing > 0)
{
return options.gridSpacing;
}
return moveSize;
};
Grid.Model.Position.prototype.moveLeft = function(moveSize)
{
return this.moveTo(this.x - this._moveBy(moveSize), this.y);
};
Grid.Model.Position.prototype.moveUp = function(moveSize)
{
return this.moveTo(this.x, this.y - this._moveBy(moveSize));
};
Grid.Model.Position.prototype.moveRight = function(moveSize)
{
return this.moveTo(this.x + this._moveBy(moveSize), this.y);
};
Grid.Model.Position.prototype.moveDown = function(moveSize)
{
return this.moveTo(this.x, this.y + this._moveBy(moveSize));
};
Grid.Model.Position.prototype.distanceFrom = function(that)
{
var p1 = this.get2D(),
p2 = that.get2D();
return p1.distanceFrom(p2);
};
Grid.Model.Position.prototype._getNearestSnapPoint = function()
{
var snapPoints = this.model.getSnapPoints();
var closestSnapPoint = null;
var closestDistance = +Infinity;
for(var i = 0; i < snapPoints.length; i++)
{
var snapPoint = snapPoints[i];
var distance = this.distanceFrom(snapPoint);
if (distance <= snapPoint.snapRadius && distance < closestDistance)
{
closestDistance = distance;
closestSnapPoint = snapPoint;
}
}
return closestSnapPoint;
};
Grid.Model.Position.prototype.snapToPoint = function()
{
var snapPoint = this._getNearestSnapPoint();
if (snapPoint != null)
{
return this.moveTo(snapPoint.x, snapPoint.y, true);
}
return false;
};
Grid.Model.Position.prototype.snapToGrid = function()
{
var spacing = 1;
var options = this.model.options;
if (options.snapToGrid && options.gridSpacing > 0)
{
spacing = options.gridSpacing;
}
var fixedX = this.x;
var fixedY = this.y;
if (this instanceof Grid.Model.Image)
{
fixedX = (fixedX - Math.round(this.width / 2)); // NOTE: JAVA floored this value
fixedY = (fixedY - this.height);
}
var snappedX = Math.round(fixedX / spacing) * spacing;
var snappedY = Math.round(fixedY / spacing) * spacing;
if (this instanceof Grid.Model.Image)
{
snappedX = (snappedX + Math.round(this.width / 2)); // NOTE: JAVA floored this value
snappedY = (snappedY + this.height);
}
return this.moveTo(snappedX, snappedY, true);
};
Grid.Model.Position.prototype.snap = function () {
if (!this.snapToPoint()) {
this.snapToGrid();
}
};
Grid.Model.Position.prototype.moveElement = function(view)
{
var element = this.getElement(view);
view.setAttributes(element,
{
'x': this.x,
'y': this.y
});
};

/* SOURCE FILE: model.circle.js (5a88952c) 9/9/2014 2:08:53 PM */

Grid.Model.Circle = function(model, x, y, radius)
{
Grid.Model.Circle.superclass.constructor.call(this, model, x, y);
this.radius = radius;
this.setHoverable(false);
this.setFocusable(Grid.Model.Focusable.Manual);
this.setMoveable(true);
this.setSelectable(false);
};
Lang.extend(Grid.Model.Circle, Grid.Model.Position);
Grid.Model.Circle.prototype.getList = function()
{
return this.model.getPoints();
};
Grid.Model.Circle.prototype.getBoundingRect = function(x, y)
{
if (!YAHOO.lang.isNumber(x)) x = this.x;
if (!YAHOO.lang.isNumber(y)) y = this.y;
var width = (this.radius * 2);
var height = (this.radius * 2);
var topLeftX = (x - this.radius);
var topLeftY = (y - this.radius);
var bottomRightX = (topLeftX + width);
var bottomRightY = (topLeftY + height);
return {
width: width,
height: height,
left: topLeftX,
top: topLeftY,
right: bottomRightX,
bottom: bottomRightY
};
};
Grid.Model.Circle.prototype.getFixedCoords = function(moveX, moveY)
{
var rect = this.getBoundingRect(moveX, moveY);
var canvasWidth = this.model.options.canvasWidth;
var canvasHeight = this.model.options.canvasHeight;
if (rect.left < 0) moveX = this.radius;
if (rect.top < 0) moveY = this.radius;
if (rect.right > canvasWidth) moveX = (canvasWidth - this.radius);
if (rect.bottom > canvasHeight) moveY = (canvasHeight - this.radius);
return { x: moveX, y: moveY };
};
Grid.Model.Circle.prototype.intersect = function(that)
{
var c1 = this.get2D(),
r1 = this.radius,
c2 = that.get2D(),
r2 = that.radius;
return (Intersection.intersectCircleCircle(c1, r1, c2, r2).status != 'Outside');
};
Grid.Model.Circle.prototype.getIntersections = function()
{
var intersectingPoints = [];
var points = this.getList();
for(var i = 0; i < points.length; i++)
{
var point = points[i];
if (this != point && this.intersect(point))
{
intersectingPoints.push(point);
}
}
return intersectingPoints;
};
Grid.Model.Circle.prototype.setCoords = function(coords)
{
coords = coords.split(',');
for (var i = 0; i < coords.length; i++) { coords[i] = (coords[i] * 1); }
this.x = coords[0];
this.y = coords[1];
this.radius = coords[2];
this.update();
};
Grid.Model.Circle.prototype.getCoords = function()
{
return YAHOO.lang.substitute('{x}, {y}, {radius}', this);
};
Grid.Model.Circle.prototype.createElement = function(view)
{
var id = this.getID();
var circleElement = view.createElement('circle', { 'id': id });
this.appendElement(view, circleElement);
return circleElement;
};
Grid.Model.Circle.prototype.updateElement = function(view)
{
var circleElement = this.getElement(view);
view.setAttributes(circleElement, {
'cx': this.x,
'cy': this.y,
'r':  (this.radius - 0.4)
});
Grid.Model.Circle.superclass.updateElement.call(this, view);
};
Grid.Model.Circle.prototype.moveElement = function(view)
{
var circleElement = this.getElement(view);
view.setAttributes(circleElement, {
'cx': this.x,
'cy': this.y
});
};

/* SOURCE FILE: model.polygon.js (9a90a7ae) 9/9/2014 2:08:53 PM */

Grid.Model.PolygonPoint = function(model, x, y)
{
Grid.Model.PolygonPoint.superclass.constructor.call(this, model, x, y);
};
Lang.extend(Grid.Model.PolygonPoint, Grid.Model.Position);
Grid.Model.PolygonPoint.prototype.toString = function()
{
return this.x + ',' + this.y;
};
Grid.Model.Polygon = function(model)
{
Grid.Model.Polygon.superclass.constructor.call(this, model, 0, 0);
this._points = [];
this._focusable = Grid.Model.Focusable.Manual;
this._moveable = true;
};
Lang.extend(Grid.Model.Polygon, Grid.Model.Position);
Grid.Model.Polygon.prototype.getPoints = function() { return this._points; };
Grid.Model.Polygon.prototype.addPoint = function(x, y)
{
var point = new Grid.Model.PolygonPoint(this.model, x, y);
this._points.push(point);
};
Grid.Model.Polygon.prototype.getCoords = function()
{
return this._points.join(' ');
};
Grid.Model.Polygon._path_regexp = (function()
{
var number = '-?[0-9.]+';
var comma = '\s*[, \t]\s*';
var xy = number + comma + number;
return new RegExp(xy, 'ig');
})();
Grid.Model.Polygon._parsePath = function(path)
{
var points = [];
var tokens = path.match(Grid.Model.Polygon._path_regexp);
if (YAHOO.lang.isArray(tokens))
{
for (var i = 0; i < tokens.length; i++)
{
var token = tokens[i].replace(/^\s+|\s+$/g, '');
var xy = token.split(/[, \t]+/);
var x = parseFloat(xy[0]);
var y = parseFloat(xy[1]);
points.push([x, y]);
}
}
return points;
};
Grid.Model.Polygon.prototype.setCoords = function(coords)
{
this._points = [];
var parsedPoints = Grid.Model.Polygon._parsePath(coords);
for (var i = 0; i < parsedPoints.length; i++)
{
var parsedPoint = parsedPoints[i];
this.addPoint(parsedPoint[0], parsedPoint[1]);
}
if (this._points.length > 0)
{
this.x = parsedPoints[0][0];
this.y = parsedPoints[0][1];
}
this.update();
};
Grid.Model.Polygon.prototype.createElement = function(view)
{
var id = this.getID();
var polyElement = view.createElement('polygon', {
'id': id,
'points': this._points.join(' ')
});
this.appendElement(view, polyElement);
return polyElement;
};
Grid.Model.Polygon.prototype.moveElement = function(view)
{
var polyElement = this.getElement(view);
var xDiff = 0;
var yDiff = 0;
for (var i = 0; i < this._points.length; i++)
{
var point = this._points[i];
if (i == 0)
{
xDiff = this.x - point.x;
yDiff = this.y - point.y;
point.x = this.x;
point.y = this.y;
}
else
{
point.x += xDiff;
point.y += yDiff ;
}
}
view.setAttributes(polyElement, {
'points': this._points.join(' ')
});
};
Grid.Model.Polygon.prototype.updateElement = function(view)
{
this.moveElement(view);
Grid.Model.Polygon.superclass.updateElement.call(this, view);
};

/* SOURCE FILE: model.path.js (f9610d5b) 9/9/2014 2:08:53 PM */

Grid.Model.Path = function(model, pathData)
{
Grid.Model.Path.superclass.constructor.call(this, model);
this.pathData = pathData;
this._focusable = Grid.Model.Focusable.Manual;
};
Lang.extend(Grid.Model.Path, Grid.Model.Base);
Grid.Model.Path.prototype.createElement = function(view)
{
var id = this.getID();
var polyElement = view.createElement('path', { 'id': id });
this.appendElement(view, polyElement);
this.updateElement(view);
return polyElement;
};
Grid.Model.Path.prototype.updateElement = function(view)
{
var polyElement = this.getElement(view);
view.setAttributes(polyElement, { 'd': this.pathData });
Grid.Model.Path.superclass.updateElement.call(this, view);
};

/* SOURCE FILE: model.point.js (5ca8217a) 9/9/2014 2:08:53 PM */

Grid.Model.Point = function(model, x, y, radius)
{
Grid.Model.Point.superclass.constructor.call(this, model, x, y, radius);
this.radius = radius;
this._transparent = false;
};
Lang.extend(Grid.Model.Point, Grid.Model.Circle);
Grid.Model.Point.prototype.makeTransparent = function(transparent) {
this._transparent = transparent;
this.update();
};
Grid.Model.Point.prototype.isTransparent = function () {
return this._transparent;
};
Grid.Model.Point.prototype.getBoundingRect = function(x, y)
{
var rect = Grid.Model.Point.superclass.getBoundingRect.call(this, x, y);
rect.top -= this.radius;
rect.bottom -= this.radius;
return rect;
};
Grid.Model.Point.prototype.getFixedCoords = function(moveX, moveY)
{
var rect = this.getBoundingRect(moveX, moveY);
var canvasWidth = this.model.options.canvasWidth;
var canvasHeight = this.model.options.canvasHeight;
if (rect.left < 0) moveX = 0;
if (rect.top < 0) moveY = 0;
if (rect.right > canvasWidth) moveX = canvasWidth;
if (rect.bottom > canvasHeight) moveY = canvasHeight;
return { x: moveX, y: moveY };
};
Grid.Model.Point.prototype.moveTo = function(moveX, moveY, preventSnap)
{
var moved = Grid.Model.Point.superclass.moveTo.call(this, moveX, moveY, preventSnap);
if (moved)
{
var lines = this.getLines();
for (var i = 0; i < lines.length; i++) this.model.fireLazy('onMove', lines[i]);
}
return moved;
};
Grid.Model.Point.prototype.getLines = function()
{
var pointLines = [];
var lines = this.model.getLines();
for(var i = 0; i < lines.length; i++)
{
var line = lines[i];
if (this == line.source || this == line.target)
{
pointLines.push(line);
}
}
return pointLines;
};
Grid.Model.Point.prototype.moveLines = function(toPoint)
{
if (!toPoint) return false;
var fromLines = this.getLines();
for(var i = 0; i < fromLines.length; i++)
{
var fromLine = fromLines[i];
var isSource = (fromLine.source == this);
this.model.deleteLine(fromLine);
if (isSource) this.model.addLine(toPoint, fromLine.target, fromLine.dirType);
else this.model.addLine(fromLine.source, toPoint, fromLine.dirType);
}
return true;
};
Grid.Model.Point.prototype._intersectLine = function(line)
{
var c = this.get2D(),
r = this.radius,
a1 = line.source.get2D(),
a2 = line.target.get2D();
return (Intersection.intersectCircleLine(c, r, a1, a2).source != 'Outside');
};
Grid.Model.Point.prototype._nearestPointAlongLine = function(line)
{
var px = this.x,
py = this.y,
x1 = line.source.x,
y1 = line.source.y,
x2 = line.target.x,
y2 = line.target.y;
var dx = x2 - x1;
var dy = y2 - y1;
if (dx == 0 && dy == 0) return { x: x1, y: y1 };
var t = ((px - x1) * dx + (py - y1) * dy) / (dx * dx + dy * dy);
if (t < 0)
{
dx = x1;
dy = y1;
}
else if (t > 1)
{
dx = x2;
dy = y2;
}
else
{
dx = x1 + t * dx;
dy = y1 + t * dy;
}
return new Point2D(dx, dy);
};
Grid.Model.Point.prototype.distanceFromLine = function(line)
{
var nearestPoint = this._nearestPointAlongLine(line);
return this.get2D().distanceFrom(nearestPoint);
};
Grid.Model.Point.prototype.getStyles = function()
{
var styles =
{
'fill': 'red',
'stroke': 'blue',
'stroke-width': '0',
'stroke-dasharray': ''
};
if (this.isFocused())
{
styles['stroke-width'] = '1';
}
else
{
styles['stroke-width'] = '0';
}
if (this._transparent) {
styles['opacity'] = '0';
}
return styles;
};
Grid.Model.Point.prototype.getElementGroup = function() { return 'points'; };
Grid.Model.Point.prototype.updateElement = function(view)
{
var pointElement = this.getElement(view);
if (this.isFocused())
{
view.bringToFront(pointElement);
}
Grid.Model.Point.superclass.updateElement.call(this, view);
};

/* SOURCE FILE: model.snappoint.js (f948b9f4) 9/9/2014 2:08:53 PM */

Grid.Model.SnapPoint = function(model, x, y, radius, snapRadius)
{
Grid.Model.SnapPoint.superclass.constructor.call(this, model, x, y, radius);
this.snapRadius = snapRadius;
this.setHoverable(false);
this.setFocusable(Grid.Model.Focusable.Never);
this.setMoveable(false);
this.setSelectable(false);
this.setVisible(false);
};
Lang.extend(Grid.Model.SnapPoint, Grid.Model.Circle);
Grid.Model.SnapPoint.prototype.getList = function()
{
return this.model.getSnapPoints();
};
Grid.Model.SnapPoint.prototype.getStyles = function()
{
return Grid.Model.getEmptyStyles();
}

/* SOURCE FILE: model.line.js (18c255fe) 9/9/2014 2:08:53 PM */

Grid.Model.Line = function(model, source, target, dirType, style, transparent)
{
Grid.Model.Line.superclass.constructor.call(this, model);
this.source = source;
this.target = target;
this.style = style || 'solid';
if (Lang.isBoolean(dirType)) {
dirType = dirType ? 'forward' : 'none';
}
else if (Lang.isString(dirType)) {
dirType = dirType.toLowerCase();
if (dirType != 'none' && dirType != 'forward' && dirType != 'back' && dirType != 'both') {
throw new Error('Invalid line direction');
}
} else {
dirType = 'none';
}
if (transparent) {
source.makeTransparent(dirType == 'both' || dirType == 'back');
target.makeTransparent(dirType == 'both' || dirType == 'forward');
}
this.dirType = dirType;
};
Lang.extend(Grid.Model.Line, Grid.Model.Base);
Grid.Model.Line.prototype.getLength = function()
{
var p1 = this.source.get2D();
var p2 = this.target.get2D();
return p1.distanceFrom(p2);
};
Grid.Model.Line.prototype.intersect = function(line)
{
var a1 = this.source.get2D(),
a2 = this.target.get2D(),
b1 = line.source.get2D(),
b2 = line.target.get2D();
return (Intersection.intersectLineLine(a1, a2, b1, b2).status == 'Intersection');
};
Grid.Model.Line.prototype.distanceFrom = function(line)
{
if (this.intersect(line)) return 0;
var distances = [];
distances.push(this.source.distanceFromLine(line));
distances.push(this.target.distanceFromLine(line));
distances.push(line.source.distanceFromLine(this));
distances.push(line.target.distanceFromLine(this));
return Math.min.apply(Math, distances);
};
Grid.Model.Line.prototype.getSlope = function()
{
var denom = this.target.x - this.source.x;
var num = this.target.y - this.source.y;
if (denom == 0) return Infinity;
else if (num == 0) return 0.0;
else return num / denom;
};
Grid.Model.Line.prototype.getAngle = function()
{
var x1 = this.source.x,
y1 = this.source.y,
x2 = this.target.x,
y2 = this.target.y;
return Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
};
Grid.Model.Line.prototype.getAngle2 = function()
{
var x1 = this.source.x,
y1 = this.source.y,
x2 = this.target.x,
y2 = this.target.y;
var radians = (x1 <= x2) ? Math.atan2(y2 - y1, x2 - x1) : Math.atan2(y1 - y2, x1 - x2);
var degrees = (radians * 180 / Math.PI);
return degrees;
};
Grid.Model.Line.prototype.isParallelTo = function(line, tolerance) {
var angleTolerance = 0.05;
var line1Vertical = false;
var line1Horizontal = false;
var line2Vertical = false;
var line2Horizontal = false;
var line1 = this;
var line2 = line;
if (line1.source.x >= line1.target.x) {
if (Math.abs(line1.source.x - line1.target.x) < .25) {
line1Vertical = true;
}
} else if (Math.abs(line1.target.x - line1.source.x) < .25) {
line1Vertical = true;
}
if (line2.source.x >= line2.target.x) {
if (Math.abs(line2.source.x - line2.target.x) < .25) {
line2Vertical = true;
}
} else if (Math.abs(line2.target.x - line2.source.x) < .25) {
line2Vertical = true;
}
if (line1.source.y >= line1.target.y) {
if (Math.abs(line1.source.y - line1.target.y) < .25) {
line1Horizontal = true;
}
} else if (Math.abs(line1.target.y - line1.source.y) < .25) {
line1Horizontal = true;
}
if (line2.source.y >= line2.target.y) {
if (Math.abs(line2.source.y - line2.target.y) < .25) {
line2Horizontal = true;
}
} else if (Math.abs(line2.target.y - line2.source.y) < .25) {
line2Horizontal = true;
}
if ((line1Vertical && line2Vertical) || (line1Horizontal && line2Horizontal)) {
return true;
}
if (!line1Vertical && !line2Vertical) {
var slope1 = (line1.target.y - line1.source.y) / (line1.target.x - line1.source.x);
var slope2 = (line2.target.y - line2.source.y) / (line2.target.x - line2.source.x);
if (slope1 == slope2) return true;
}
var distance = function(x, y) {
return (Math.sqrt(Math.pow((x), 2) + Math.pow((y), 2)));
};
var newX1 = line1.target.x - line1.source.x;
var newY1 = line1.target.y - line1.source.y;
var newX2 = line2.target.x - line2.source.x;
var newY2 = line2.target.y - line2.source.y;
var dotProd = newX1 * newX2 + newY1 * newY2;
var distance1 = distance(newX1, newY1);
var distance2 = distance(newX2, newY2);
var lengthProd = distance1 * distance2;
if (Math.abs(dotProd) == Math.abs(lengthProd)) return true;
var theta = angleTolerance + 1;
if (lengthProd != 0) theta = Math.acos(Math.abs(dotProd / lengthProd));
if (theta <= angleTolerance) return true;
return false;
};
Grid.Model.Line.prototype.getLongestLine = function(line)
{
var lines = [];
var d1 = this.source.distanceFrom(line.source);
var d2 = this.source.distanceFrom(line.target);
var start, end;
if (d1 < d2)
{
start = line.source;
end = line.target;
}
else
{
start = line.target;
end = line.source;
}
lines[0] = new Grid.Model.Line(this.model, start, end);
lines[1] = new Grid.Model.Line(this.model, this.source, end);
lines[2] = new Grid.Model.Line(this.model, start, this.target);
lines[3] = new Grid.Model.Line(this.model, end, this.target);
var length = this.getLength();
var longest = this;
for (var i = 0; i < 4; i++)
{
var l = lines[i].getLength();
if (lines[i].getLength() > length)
{
longest = lines[i];
length = l;
}
}
return longest;
};
Grid.Model.Line.prototype.getInfo = function()
{
var x1 = this.source.x,
y1 = this.source.y,
r1 = this.source.radius,
t1 = 1;
var x2 = this.target.x,
y2 = this.target.y,
r2 = this.target.radius,
t2 = 1;
var radians = Math.atan2(y2 - y1, x2 - x1);
var sourceOffset = -2;
var targetOffset = (this.dirType == 'none') ? -2 : -1;
if (!this.source.isTransparent()) {
x1 = x1 + (Math.cos(radians) * ((r1 + t1) + sourceOffset));
y1 = y1 + (Math.sin(radians) * ((r1 + t1) + sourceOffset));
}
if (!this.target.isTransparent()) {
x2 = x2 - (Math.cos(radians) * ((r2 + t2) + targetOffset));
y2 = y2 - (Math.sin(radians) * ((r2 + t2) + targetOffset));
}
var angle = (radians / (2 * Math.PI)) * 360; // radians to degrees
return {x1: x1, y1: y1, x2: x2, y2: y2, angle: angle };
};
Grid.Model.Line.prototype.getStyles = function()
{
return {
'fill': 'none',
'stroke': 'red',
'stroke-width': '1',
'stroke-dasharray': (this.style == 'dashed') ? '5, 5' : ''
};
};
Grid.Model.Line.prototype.getArrowStyles = function()
{
return {
'stroke-width': '1.3'
};
};
Grid.Model.Line.prototype.getElementGroup = function() { return 'lines'; };
Grid.Model.Line.prototype.createElement = function(view)
{
var id = this.getID();
var lineInfo = this.getInfo();
var lineElement = view.createElement('line', {
'id': id,
'x1': lineInfo.x1,
'y1': lineInfo.y1,
'x2': lineInfo.x2,
'y2': lineInfo.y2
});
this.appendElement(view, lineElement);
if (this.dirType == 'forward' || this.dirType == 'both')
{
this._createArrowElement(view, id + '_arrow1', lineInfo.x2, lineInfo.y2, lineInfo.angle);
}
if (this.dirType == 'both')
{
this._createArrowElement(view, id + '_arrow2', lineInfo.x1, lineInfo.y1, (lineInfo.angle - 180));
}
return lineElement;
};
Grid.Model.Line.prototype._getArrowPath = function(x, y)
{
var size = 6;
return 'M' + x + ' ' + y + ' L' + (x - size) + ' ' + (y - size) + ' M' + (x - size) + ' ' + (y + size) + ' L' + x + ' ' + y;
};
Grid.Model.Line.prototype._createArrowElement = function(view, id, x, y, angle)
{
var path = this._getArrowPath(x, y);
var arrowElement = view.createElement('path', {
'id': id,
'd': path,
'transform': 'rotate(' + angle + ', ' + x + ', ' + y + ')'
});
var lineStyles = this.getStyles();
var arrowStyles = this.getArrowStyles();
YAHOO.lang.augmentObject(arrowStyles, lineStyles, false);
view.setAttributes(arrowElement, arrowStyles);
view.appendChild('arrows', arrowElement);
return arrowElement;
};
Grid.Model.Line.prototype.moveElement = function(view)
{
var id = this.getID();
var lineInfo = this.getInfo();
var lineElement = view.getElementById(id);
if (!lineElement) throw new Error('Cannot move the line ' + id + ' because it does not exist');
view.setAttributes(lineElement, {
'x1': lineInfo.x1,
'y1': lineInfo.y1,
'x2': lineInfo.x2,
'y2': lineInfo.y2
});
if (this.dirType == 'forward' || this.dirType == 'both')
{
this._updateArrowElement(view, id + '_arrow1', lineInfo.x2, lineInfo.y2, lineInfo.angle);
}
if (this.dirType == 'both')
{
this._updateArrowElement(view, id + '_arrow2', lineInfo.x1, lineInfo.y1, (lineInfo.angle - 180));
}
};
Grid.Model.Line.prototype._updateArrowElement = function(view, id, x, y, angle)
{
var arrowElement = view.getElementById(id);
if (!arrowElement) throw new Error('Cannot move the arrow ' + id + ' because it does not exist');
var path = this._getArrowPath(x, y);
view.setAttributes(arrowElement, {
'd': path,
'transform': 'rotate(' + angle + ', ' + x + ', ' + y + ')'
});
};
Grid.Model.Line.prototype.removeElement = function(view)
{
var id = this.getID();
Grid.Model.Line.superclass.removeElement.call(this, view);
if (this.dirType == 'forward' || this.dirType == 'both') view.removeElement(id + '_arrow1');
if (this.dirType == 'both') view.removeElement(id + '_arrow2');
};
Grid.Model.Line.prototype.getElementGroup = function() { return 'lines'; };
Grid.Model.Line.prototype.createElement = function(view)
{
var id = this.getID();
var lineInfo = this.getInfo();
var lineElement = view.createElement('line', {
'id': id,
'x1': lineInfo.x1,
'y1': lineInfo.y1,
'x2': lineInfo.x2,
'y2': lineInfo.y2
});
this.appendElement(view, lineElement);
if (this.dirType == 'forward' || this.dirType == 'both')
{
this._createArrowElement(view, id + '_arrow1', lineInfo.x2, lineInfo.y2, lineInfo.angle);
}
if (this.dirType == 'both')
{
this._createArrowElement(view, id + '_arrow2', lineInfo.x1, lineInfo.y1, (lineInfo.angle - 180));
}
return lineElement;
};
Grid.Model.Line.prototype._getArrowPath = function(x, y)
{
var size = 6;
return 'M' + x + ' ' + y + ' L' + (x - size) + ' ' + (y - size) + ' M' + (x - size) + ' ' + (y + size) + ' L' + x + ' ' + y;
};
Grid.Model.Line.prototype._createArrowElement = function(view, id, x, y, angle)
{
var path = this._getArrowPath(x, y);
var arrowElement = view.createElement('path', {
'id': id,
'd': path,
'transform': 'rotate(' + angle + ', ' + x + ', ' + y + ')'
});
var lineStyles = this.getStyles();
var arrowStyles = this.getArrowStyles();
YAHOO.lang.augmentObject(arrowStyles, lineStyles, false);
view.setAttributes(arrowElement, arrowStyles);
view.appendChild('arrows', arrowElement);
return arrowElement;
};
Grid.Model.Line.prototype.moveElement = function(view)
{
var id = this.getID();
var lineInfo = this.getInfo();
var lineElement = view.getElementById(id);
if (!lineElement) throw new Error('Cannot move the line ' + id + ' because it does not exist');
view.setAttributes(lineElement, {
'x1': lineInfo.x1,
'y1': lineInfo.y1,
'x2': lineInfo.x2,
'y2': lineInfo.y2
});
if (this.dirType == 'forward' || this.dirType == 'both')
{
this._updateArrowElement(view, id + '_arrow1', lineInfo.x2, lineInfo.y2, lineInfo.angle);
}
if (this.dirType == 'both')
{
this._updateArrowElement(view, id + '_arrow2', lineInfo.x1, lineInfo.y1, (lineInfo.angle - 180));
}
};
Grid.Model.Line.prototype._updateArrowElement = function(view, id, x, y, angle)
{
var arrowElement = view.getElementById(id);
if (!arrowElement) throw new Error('Cannot move the arrow ' + id + ' because it does not exist');
var path = this._getArrowPath(x, y);
view.setAttributes(arrowElement, {
'd': path,
'transform': 'rotate(' + angle + ', ' + x + ', ' + y + ')'
});
};
Grid.Model.Line.prototype.removeElement = function(view)
{
var id = this.getID();
Grid.Model.Line.superclass.removeElement.call(this, view);
if (this.dirType == 'forward' || this.dirType == 'both') view.removeElement(id + '_arrow1');
if (this.dirType == 'both') view.removeElement(id + '_arrow2');
};

/* SOURCE FILE: model.rectangle.js (fee59fba) 9/9/2014 2:08:53 PM */

Grid.Model.Rectangle = function(model, x, y, width, height)
{
Grid.Model.Rectangle.superclass.constructor.call(this, model, x, y);
this.width = width || 0;
this.height = height || 0;
this.setHoverable(false);
this.setFocusable(Grid.Model.Focusable.Manual);
this.setMoveable(true);
this.setSelectable(false);
};
Lang.extend(Grid.Model.Rectangle, Grid.Model.Position);
Grid.Model.Rectangle.prototype.getSize = function() { return this.width * this.height; };
Grid.Model.Rectangle.prototype.getBoundingRect = function(x, y)
{
if (!YAHOO.lang.isNumber(x)) x = this.x;
if (!YAHOO.lang.isNumber(y)) y = this.y;
var topLeftX = x;
var topLeftY = y;
var bottomRightX = (topLeftX + this.width);
var bottomRightY = (topLeftY + this.height);
return {
width: this.width,
height: this.height,
left: topLeftX,
top: topLeftY,
right: bottomRightX,
bottom: bottomRightY
};
};
Grid.Model.Rectangle.prototype.getFixedCoords = function(moveX, moveY)
{
var rect = this.getBoundingRect(moveX, moveY);
var canvasWidth = this.model.options.canvasWidth;
var canvasHeight = this.model.options.canvasHeight;
if (rect.left < 0) moveX = 0;
if (rect.top < 0) moveY = 0;
if (rect.right > canvasWidth) moveX = (canvasWidth - this.width);
if (rect.bottom > canvasHeight) moveY = (canvasHeight - this.height);
return { x: moveX, y: moveY };
};
Grid.Model.Rectangle.prototype.setCoords = function(coords)
{
coords = coords.split(',');
for (var i = 0; i < coords.length; i++) { coords[i] = (coords[i] * 1); }
var x1 = coords[0];
var y1 = coords[1];
var x2 = coords[2];
var y2 = coords[3];
this.x = x1;
this.y = y1;
this.width = (x2 - x1);
this.height = (y2 - y1);
this.update();
};
Grid.Model.Rectangle.prototype.getCoords = function()
{
var boundingRect = this.getBoundingRect();
return YAHOO.lang.substitute('{left}, {top}, {right}, {bottom}', boundingRect);
};
Grid.Model.Rectangle.prototype.createElement = function(view)
{
var id = this.getID();
var element = view.createElement('rect', { 'id': id });
this.appendElement(view, element);
return element;
};
Grid.Model.Rectangle.prototype.updateElement = function(view)
{
var element = this.getElement(view);
var boundingRect = this.getBoundingRect();
view.setAttributes(element, {
'x': boundingRect.left,
'y': boundingRect.top,
'width': boundingRect.width,
'height': boundingRect.height
});
Grid.Model.Rectangle.superclass.updateElement.call(this, view);
};
Grid.Model.Rectangle.prototype.moveElement = function(view)
{
var element = this.getElement(view);
var boundingRect = this.getBoundingRect();
view.setAttributes(element,
{
'x': boundingRect.left,
'y': boundingRect.top
});
};

/* SOURCE FILE: model.image.js (1c1be2af) 9/9/2014 2:08:53 PM */

Grid.Model.Image = function(model, name, x, y, width, height)
{
Grid.Model.Image.superclass.constructor.call(this, model, x, y, width, height);
this.name = name;
this.setHoverable(false);
this.setFocusable(Grid.Model.Focusable.Manual);
this.setMoveable(true);
this.setSelectable(false);
};
Lang.extend(Grid.Model.Image, Grid.Model.Rectangle);
Grid.Model.Image.prototype.getBoundingRect = function(x, y)
{
if (!YAHOO.lang.isNumber(x)) x = this.x;
if (!YAHOO.lang.isNumber(y)) y = this.y;
var topLeftX = (x - Math.round(this.width / 2));
var topLeftY = (y - this.height);
var bottomRightX = (topLeftX + this.width);
var bottomRightY = (topLeftY + this.height);
return {
width: this.width,
height: this.height,
left: topLeftX,
top: topLeftY,
right: bottomRightX,
bottom: bottomRightY
};
};
Grid.Model.Image.prototype.getFixedCoords = function(moveX, moveY)
{
var rect = this.getBoundingRect(moveX, moveY);
var canvasWidth = this.model.options.canvasWidth;
var canvasHeight = this.model.options.canvasHeight;
if (rect.left < 0) moveX = Math.round(this.width / 2);
if (rect.top < 0) moveY = this.height;
if (rect.right > canvasWidth) moveX = (canvasWidth - Math.round(this.width / 2));
if (rect.bottom > canvasHeight) moveY = canvasHeight;
var tolerance = 4;
var rec = this.otherImageInSamePlace(moveX, moveY, tolerance);
while (rec != null)
{
moveX = rec.x + tolerance;
moveY = rec.y + tolerance;
rec = this.otherImageInSamePlace(moveX, moveY, tolerance);
}
return { x: moveX, y: moveY };
};
Grid.Model.Image.prototype.getPaletteImage = function()
{
var paletteImages = this.model.getPaletteImages();
for (var i = 0; i < paletteImages.length; i++)
{
var paletteImage = paletteImages[i];
if (paletteImage.name == this.name) return paletteImage;
}
return null;
};
Grid.Model.Image.prototype.otherImageInSamePlace = function(realX, realY, tolerance)
{
var p = new Point2D(realX, realY);
var size = this.getSize();
var images = this.model.getImages();
for(var i = 0; i < images.length; i++)
{
var rec = images[i];
if (rec == this) continue;
var distance = rec.get2D().distanceFrom(p);
if (distance < tolerance)
{
var sizeDif = Math.abs(rec.getSize() - size);
if (sizeDif < (.15 * size)) return rec;
}
}
return null;
};
Grid.Model.Image.prototype.getStyles = function()
{
return null;
};
Grid.Model.Image.prototype.getBorderStyles = function()
{
return {
'stroke': 'blue',
'stroke-width': '2',
'fill': 'none'
};
};
Grid.Model.Image.prototype.toString = function() { return this.name; };
Grid.Model.Image.prototype.getElementGroup = function() { return 'images'; };
Grid.Model.Image.prototype.createElement = function(view)
{
var id = this.getID();
var imageElement = view.createElement('image', {
'id': id,
'transform': 'translate(-0.5, -0.5)'
});
var paletteImage = this.getPaletteImage();
imageElement.setAttributeNS(XLINK_NS, 'xlink:href', paletteImage.url);
this.appendElement(view, imageElement);
return imageElement;
};
Grid.Model.Image.prototype.moveElement = function(view)
{
Grid.Model.Image.superclass.moveElement.call(this, view);
if (this.isFocused()) this._updateBorderElement(view);
};
Grid.Model.Image.prototype.updateElement = function(view)
{
Grid.Model.Image.superclass.updateElement.call(this, view);
if (this.isFocused()) this._updateBorderElement(view);
else this._removeBorderElement(view);
};
Grid.Model.Image.prototype.removeElement = function(view)
{
if (this.isFocused()) this._removeBorderElement(view);
Grid.Model.Image.superclass.removeElement.call(this, view);
};
Grid.Model.Image.prototype._updateBorderElement = function(view)
{
var id = this.getID();
var imageElement = view.getElementById(id);
var rect = this.getBoundingRect();
var borderID = imageElement.id + '_border';
var borderElement = view.getElementById(borderID);
if (borderElement == null)
{
borderElement = view.createElement('rect', { 'id': borderID });
var borderStyles = this.getBorderStyles();
view.setAttributes(borderElement, borderStyles);
view.appendChild('imageborders', borderElement);
}
view.setAttributes(borderElement,
{
'x': rect.left - 2,
'y': rect.top - 2,
'width': rect.width + 4,
'height': rect.height + 4
});
};
Grid.Model.Image.prototype._removeBorderElement = function(view)
{
var id = this.getID();
view.removeElement(id + '_border');
};

/* SOURCE FILE: model.staticimage.js (1dc2d357) 9/9/2014 2:08:53 PM */

Grid.Model.StaticImage = function(model, url, x, y, width, height)
{
Grid.Model.StaticImage.superclass.constructor.call(this, model, x, y, width, height);
this.url = url;
this.setHoverable(false);
this.setFocusable(Grid.Model.Focusable.None);
this.setMoveable(false);
this.setSelectable(false);
};
Lang.extend(Grid.Model.StaticImage, Grid.Model.Rectangle);
Grid.Model.StaticImage.prototype.getStyles = function()
{
return null;
};
Grid.Model.BackgroundImage = function(model, url, x, y, width, height)
{
Grid.Model.BackgroundImage.superclass.constructor.call(this, model, url, x, y, width, height);
};
Lang.extend(Grid.Model.BackgroundImage, Grid.Model.StaticImage);
Grid.Model.StaticImage.prototype.getElementGroup = function() { return 'staticimages'; };
Grid.Model.StaticImage.prototype.createElement = function(view)
{
var id = this.getID();
var element = view.createElement('image', {
'id': id,
'transform': 'translate(-0.5, -0.5)'
});
element.setAttributeNS(XLINK_NS, 'xlink:href', this.url);
this.appendElement(view, element);
return element;
};

/* SOURCE FILE: model.label.js (859ad8a1) 9/9/2014 2:08:53 PM */

Grid.Model.Label = function(model, x, y, text, fontSize, fontFamily)
{
Grid.Model.Label.superclass.constructor.call(this, model, x, y);
this.text = text;
this.fontSize = fontSize || '12';
this.fontFamily = fontFamily || 'Arial';
};
Lang.extend(Grid.Model.Label, Grid.Model.Position);
Grid.Model.Label.prototype.getStyles = function()
{
return {
"font-size": this.fontSize,
"font-family": this.fontFamily,
"fill": "black"
};
};
Grid.Model.Label.prototype.getElementGroup = function() { return 'labels'; };
Grid.Model.Label.prototype.createElement = function(view)
{
var id = this.getID();
var label = view.createElement('text', {
'id': id,
'x': this.x,
'y': this.y
});
this.appendElement(view, label);
};
Grid.Model.Label.prototype.updateElement = function(view)
{
var labelElement = this.getElement(view);
view.setText(labelElement.id, this.text);
Grid.Model.Label.superclass.updateElement.call(this, view);
};

/* SOURCE FILE: model.region.js (63277355) 9/9/2014 2:08:53 PM */

Grid.Model.buildRegion = function(entityClass, regionName)
{
var regionClass = function()
{
var args = Array.prototype.slice.call(arguments, 0);
regionClass.superclass.constructor.apply(this, args);
this.name = regionName;
this._currentEvent = null;
this._events = {};
};
Lang.extend(regionClass, entityClass, Grid.Model.Region);
regionClass.prototype.isSelectable = function()
{
if (this.isSelected()) return true;
var regionGroups = this.getGroups();
for (var i = 0; i < regionGroups.length; i++)
{
var regionGroup = regionGroups[i];
if (regionGroup.isMaxMet()) return false;
}
return regionClass.superclass.isSelectable.call(this);
};
regionClass.prototype.select = function()
{
if (!this.isSelected()) this.deselectConflicts();
return regionClass.superclass.select.call(this);
};
return regionClass;
};
Grid.Model.Region = {};
Grid.Model.Region.getGroups = function()
{
var refGroups = [];
var regionGroups = this.model.getRegionGroups();
for (var i = 0; i < regionGroups.length; i++)
{
var regionGroup = regionGroups[i];
if (regionGroup.containsRegion(this))
{
refGroups.push(regionGroup);
}
}
return refGroups;
};
Grid.Model.Region.isOrphan = function()
{
return (this.getGroups().length == 0);
};
Grid.Model.Region.deselectConflicts = function()
{
var refGroups = this.getGroups();
var deselectRegions = [];
for (var i = 0; i < refGroups.length; i++)
{
var refGroup = refGroups[i];
var selectedRegions = refGroup.getSelectedRegions();
if (selectedRegions.length > 0)
{
if (refGroup.max == 1) deselectRegions.push(selectedRegions[0]);
else if (refGroup.isMaxMet()) return false;
}
}
for (var i = 0; i < deselectRegions.length; i++)
{
deselectRegions[i].deselect();
}
return true;
};
Grid.Model.Region.getEvent = function(name) { return this._events[name]; };
Grid.Model.Region.hasEvent = function(name) { return (this.getEvent(name) != null); };
Grid.Model.Region.createEvent = function(name)
{
this._events[name] = new Grid.Model.RegionEvent(this, name);
return this.getEvent(name);
};
Grid.Model.Region.deleteEvent = function(event)
{
event.deleteImage();
event.deleteLabel();
if (this._currentEvent == event) this._currentEvent = null;
delete(this._events[event.name]);
};
Grid.Model.Region.getCurrentEvent = function() { return this._currentEvent; };
Grid.Model.Region.setCurrentEvent = function(name)
{
if (this._currentEvent != null)
{
var entities = this._currentEvent.getEntities();
for (var i = 0; i < entities.length; i++)
{
entities[i].hide();
}
this._currentEvent = null;
}
this._currentEvent = this.getEvent(name);
if (this._currentEvent != null)
{
var entities = this._currentEvent.getEntities();
for (var i = 0; i < entities.length; i++)
{
entities[i].show();
}
return true;
}
return false;
};
Grid.Model.Region.getEvents = function()
{
var eventList = [];
for (var evt in this._events)
{
eventList.push(this._events[evt]);
}
return eventList;
};
Grid.Model.Region.getStyles = function()
{
var regionEvent = this.getCurrentEvent();
if (regionEvent != null)
{
return regionEvent.getStyles();
}
else
{
return Grid.Model.getEmptyStyles();
}
};
Grid.Model.Region.updateElement = function(view)
{
if (this.isSelected() && this.isFocused() && this.hasEvent('hoverselect'))
{
this.setCurrentEvent('hoverselect');
}
else if (this.isSelected() && this.hasEvent('select'))
{
this.setCurrentEvent('select');
}
else if (this.isFocused() && this.hasEvent('hover'))
{
this.setCurrentEvent('hover');
}
else if (this.hasEvent('unselect'))
{
this.setCurrentEvent('unselect');
}
else
{
this.setCurrentEvent(null);
}
this.constructor.superclass.updateElement.call(this, view);
};

/* SOURCE FILE: model.region.group.js (16ed26c2) 9/9/2014 2:08:53 PM */

Grid.Model.RegionGroup = function(model, name, min, max)
{
this.model = model;
this.name = name || '';
this.min = min || 0;
this.max = max || 0;
this._regions = [];
};
Grid.Model.RegionGroup.prototype.getRegions = function() { return this._regions; };
Grid.Model.RegionGroup.prototype.getRegion = function(name)
{
var regions = this.getRegions();
for (var i = 0; i < regions.length; i++)
{
var region = regions[i];
if (region.name == name) return region;
}
return null;
};
Grid.Model.RegionGroup.prototype.getSelectedRegions = function()
{
var regions = this.getRegions();
var selectedRegions = [];
for (var i = 0; i < regions.length; i++)
{
var region = regions[i];
if (region.isSelected()) selectedRegions.push(region);
}
return selectedRegions;
};
Grid.Model.RegionGroup.prototype.addRegion = function(region)
{
this._regions.push(region);
};
Grid.Model.RegionGroup.prototype.containsRegion = function(region)
{
return (this._regions.indexOf(region) > -1);
};
Grid.Model.RegionGroup.prototype.removeRegion = function(region, deleteOrphan)
{
Grid.Model.arrayRemove(this._regions, region);
if (deleteOrphan && region.getGroups().length == 0)
{
this.model.deleteRegion(region);
}
};
Grid.Model.RegionGroup.prototype.isMaxMet = function()
{
var selectedRegions = this.getSelectedRegions();
return (this.max > 0 && selectedRegions.length >= this.max);
};

/* SOURCE FILE: model.region.event.js (ebfd2be4) 9/9/2014 2:08:53 PM */

Grid.Model.RegionEvent = function(region, name)
{
this.region = region;
this.name = name;
this._image = null;
this._label = null;
this._styles = Grid.Model.getEmptyStyles();
};
Grid.Model.RegionEvent.prototype.getStyles = function() { return this._styles; };
Grid.Model.RegionEvent.prototype.setStyles = function(newStyles)
{
YAHOO.lang.augmentObject(this._styles, newStyles, true);
};
Grid.Model.RegionEvent.prototype.getEntities = function()
{
var entities = [];
if (this._image != null) entities.push(this._image);
if (this._label != null) entities.push(this._label);
return entities;
};
Grid.Model.RegionEvent.prototype.getImage = function() { return this._image; };
Grid.Model.RegionEvent.prototype.setImage = function(url, x, y, width, height)
{
if (this._image != null) this.deleteImage();
this._image = this.region.model.addStaticImage(url, x, y, width, height);
this._image.hide();
};
Grid.Model.RegionEvent.prototype.deleteImage = function()
{
if (this._image == null) return false;
this.region.model.deleteStaticImage(this._image);
this._image = null;
return true;
};
Grid.Model.RegionEvent.prototype.getLabel = function() { return this._label; };
Grid.Model.RegionEvent.prototype.setLabel = function(x, y, text)
{
if (this._label != null) this.deleteLabel();
this._label = this.region.model.addLabel(x, y, text);
this._label.hide();
};
Grid.Model.RegionEvent.prototype.deleteLabel = function()
{
if (this._label == null) return false;
this.region.model.deleteEntity(this._label);
this._label = null;
return true;
};
(function()
{
if (YAHOO.env.ua.gecko > 0) return;
Grid.Model.getEmptyStyles = function()
{
return {
'fill': 'white',
'fill-opacity': '0',
'stroke': 'white',
'stroke-width': '0',
'stroke-opacity': '0',
'stroke-dasharray': ''
};
};
Grid.Model.getDefaultStyles = function()
{
return {
'fill': 'white',
'fill-opacity': '0',
'stroke': 'red',
'stroke-width': '1',
'stroke-opacity': '1',
'stroke-dasharray': ''
};
};
var fixStyles = function(styles)
{
if (styles['stroke-opacity'] == null ||
styles['stroke-opacity'] == '')
{
var strokeWidth = parseInt(styles['stroke-width']);
if (strokeWidth > 0) styles['stroke-opacity'] = '1';
else if (strokeWidth === 0) styles['stroke-opacity'] = '0';
}
};
Grid.Model.RegionEvent.prototype.setStyles = function(newStyles)
{
YAHOO.lang.augmentObject(this._styles, newStyles, true);
fixStyles(this._styles);
};
})();

/* SOURCE FILE: model.palette.js (f7be00de) 9/9/2014 2:08:53 PM */

Grid.Model.PaletteImage = function(model, name, url, width, height)
{
Grid.Model.PaletteImage.superclass.constructor.call(this, model);
this.name = name;
this.url = url;
this.width = width || 0;
this.height = height || 0;
this.loaded = false;
};
Lang.extend(Grid.Model.PaletteImage, Grid.Model.Base);
Grid.Model.PaletteImage.prototype.getImages = function()
{
var paletteCanvasImages = [];
var images = this.model.getImages();
for(var i = 0; i < images.length; i++)
{
var image = images[i];
if (image.name == this.name)
{
paletteCanvasImages.push(image);
}
}
return paletteCanvasImages;
};
Grid.Model.PaletteImage.prototype.toString = function() { return this.name; };

/* SOURCE FILE: view.js (6e9f4da2) 9/9/2014 2:08:53 PM */

var SVG_NS = "http://www.w3.org/2000/svg";
var XLINK_NS = "http://www.w3.org/1999/xlink";
var GRID_NS = 'http://www.air.org/2010/grid/';
Grid.View = function(svgFile)
{
this.svgFile = svgFile;
this.paletteImgIndex = 0;
this.paletteCenter = false;
this.paletteScale = false;
this.width = 600;
this.height = 500;
this._svgObject = null;
this._svgDoc = null;
this._svgWin = null;
this._svgRoot = null;
this._svgElement = null;
this._zoomLevel = 1;
this._domCache = {};
this.svgReady = false;
this.svgLoaded = false;
this._suspendRedrawEnabled = false;
this._debug = false;
this._fixedOffset = false;
this._layout = null;
if (Grid.Utils.hasSVGWeb()) {
ErrorHandler.wrapFunctions(this, [
'setAttributes', 'createElement',
'createPoint', 'createSnapPoint', 'movePoint', 'createLine', 'moveLine'
]);
}
};
Grid.View.prototype.render = function(id)
{
var parent = YAHOO.util.Dom.get(id);
var view = this;
var ready = function() {
view.svgReady = true;
view._create(parent);
};
if (Grid.Utils.hasSVGWeb()) {
if (svgweb.pageLoaded) {
ready();
} else {
window.onsvgload = function() { ready(); };
}
}
else if (Grid.Utils.hasSVGNative()) {
ready();
} else {
throw new Error('This browser does not have support for SVG');
}
};
Grid.View.prototype._fixOffset = function()
{
if (this._fixedOffset) return;
Grid.Utils.fixOffset(this._svgObject);
this._fixedOffset = true;
};
Grid.View.prototype._addCache = function(element) {
if (typeof element.id == 'string') this._domCache[element.id] = element;
};
Grid.View.prototype._removeCache = function(element) {
if (typeof element.id == 'string') delete(this._domCache[element.id]);
};
Grid.View.prototype.getElementById = function(id) {
if (this._svgDoc == null) return null;
if (!id) return null;
if (id.nodeType) return id;
if (typeof id == 'string') {
var element = this._domCache[id];
if (element) return element;
else return this._svgDoc.getElementById(id);
}
return null;
};
Grid.View.prototype.getElementsByTagName = function(tagName)
{
if (this._svgDoc == null) return null;
return this._svgDoc.getElementsByTagNameNS(SVG_NS, tagName);
};
Grid.View.prototype.createElement = function(name, attrs) {
if (typeof name != 'string') return false;
var element = null;
if (attrs != null && typeof attrs.id == 'string') {
element = this.getElementById(attrs.id);
}
if (element == null) {
element = this._svgDoc.createElementNS(SVG_NS, name);
}
this.setAttributes(element, attrs);
if (this._debug && element.id) {
logger.debug('Created \'{nodeName}\' with id \'{id}\'', element);
}
this._addCache(element);
return element;
};
Grid.View.prototype.setAttributes = function(node, attrs)
{
if (typeof node == 'string') {
node = this.getElementById(node);
}
if (node == null) return false;
if (attrs == null) return false;
var handle = null;
if (this._suspendRedrawEnabled === true) {
try {
handle = this._svgRoot.suspendRedraw(10000);
} catch (ex) {}
}
for (var name in attrs) {
if (attrs.hasOwnProperty(name)) {
var value = attrs[name];
node.setAttribute(name, value);
}
}
if (handle != null) {
this._svgRoot.unsuspendRedraw(handle);
}
return true;
};
Grid.View.prototype.setAttribute = function(node, name, value)
{
if (typeof node == 'string') {
node = this.getElementById(node);
}
if (node == null) return false;
node.setAttribute(name, value);
return true;
};
Grid.View.prototype.appendChild = function(parent, element)
{
if (typeof parent == 'string') {
parent = this.getElementById(parent);
}
if (parent == null) {
logger.warn('Failed to append the element \'' + element.id + '\' because the parent was not found.');
return false;
}
parent.appendChild(element);
if (Grid.Utils.isSVGFlash()) {
if (parent.getAttribute('style') != '') {
this.setAttributes(element, {
'style': parent.getAttribute('style')
});
}
}
return true;
};
Grid.View.prototype.removeChild = function(parent, element)
{
parent.removeChild(element);
if (YAHOO.lang.isObject(element._fakeNode) &&
YAHOO.lang.isArray(element._fakeNode._listeners)) {
element._fakeNode._listeners = {};
}
};
Grid.View.prototype.removeChildren = function(parent)
{
if (typeof parent == 'string') {
parent = this.getElementById(parent);
}
while (parent && parent.firstChild) {
this.removeChild(parent, parent.firstChild);
}
};
Grid.View.prototype.removeElement = function(id)
{
var element = this.getElementById(id);
if (element == null) {
logger.warn('Cannot remove the element \'' + id + '\' because it does not exist');
return false;
}
this._removeCache(element);
if (element.parentNode != null) {
this.removeChild(element.parentNode, element);
}
if (this._debug) logger.debug('Removed \'{nodeName}\' with id \'{id}\'', element);
return true;
};
Grid.View.prototype.setText = function(id, text)
{
var element = this.getElementById(id);
if (element == null) return false;
this.removeChildren(element);
var textNode = this._svgDoc.createTextNode(text);
element.appendChild(textNode);
return true;
};
Grid.View.prototype.bringToFront = function(id)
{
var element = this.getElementById(id);
if (element == null) return false;
var parent = element.parentNode;
if (parent == null) return false;
this.removeChild(parent, element);
parent.appendChild(element);
return true;
};
Grid.View.prototype.zoom = function(scale) {
this._zoomLevel = scale = (scale || this._zoomLevel || 1);
var zoomedWidth = Math.round(this.width * scale);
var zoomedHeight = Math.round(this.height * scale);
if (this._svgElement) {
if (this._svgElement.width.baseVal) {
this._svgElement.width.baseVal.value = zoomedWidth;
this._svgElement.height.baseVal.value = zoomedHeight;
}
if (YAHOO.env.ua.android > 0 || YAHOO.env.ua.webkit >= 534) {
this._svgElement.setAttribute('width', zoomedWidth);
this._svgElement.setAttribute('height', zoomedHeight);
}
}
if (this._svgObject) {
this._svgObject.width = zoomedWidth;
this._svgObject.height = zoomedHeight;
}
var groupWrapper = this.getElementById('groupWrapper');
if (groupWrapper) {
var groupTransform = groupWrapper.getAttribute('transform');
var groupTranslate = groupTransform.split(' scale')[0];
this.setAttributes(groupWrapper, {
'transform': groupTranslate + ' scale(' + scale + ')'
});
}
};
Grid.View.prototype.translateElement = function(element, x, y)
{
if (typeof element == 'string') {
element = this.getElementById(element);
}
if (element == null) return null;
var matrix = element.getCTM().inverse();
x = matrix.a * x + matrix.c * y + matrix.e;
y = matrix.b * x + matrix.d * y + matrix.f;
return { x: x, y: y };
};
Grid.View.prototype.dispose = function()
{
if (this._svgObject && this._svgObject.parentNode) {
this._svgObject.parentNode.removeChild(this._svgObject);
}
this._svgObject = null;
this._svgDoc = null;
this._svgWin = null;
this._svgRoot = null;
this._svgElement = null;
this._domCache = null;
if (Grid.Utils.hasSVGWeb()) {
if (svgweb._removedNodes != null) {
for (var i = 0; i < svgweb._removedNodes.length; i++) {
var node = svgweb._removedNodes[i];
if (node._fakeNode) {
node._fakeNode._htcNode = null;
}
node._fakeNode = null;
node._handler = null;
svgweb._removedNodes[i] = null;
}
svgweb._removedNodes = [];
}
}
};
YAHOO.lang.augmentProto(Grid.View, EventLazyProvider);
if (window.svgweb && top != window) top.svgweb = window.svgweb;

/* SOURCE FILE: view.layout.js (e0dca6f2) 9/9/2014 2:08:53 PM */

Grid.Layout = function() {
var containerPaddingTop = 0;
var containerPaddingRight = 0;
var containerPaddingBottom = 0;
var containerPaddingLeft = 0;
var canvasWidth = 0;
var canvasHeight = 0;
var canvasBorderOffset = 0;
var paletteWidth = 0;
var toolbarHeight = 0;
var feedbackHeight = 0;
var paletteGutter = 0;
var toolbarGutter = 0;
var feedbackGutter = 0;
this.setContainerPadding = function(top, right, bottom, left) {
containerPaddingTop = top;
containerPaddingRight = right;
containerPaddingBottom = bottom;
containerPaddingLeft = left;
};
this.setCanvasWidth = function(width) {
canvasWidth = width;
};
this.setCanvasHeight = function(height) {
canvasHeight = height;
};
this.setCanvasBorderOffset = function(offset) {
canvasBorderOffset = offset;
};
this.setPaletteWidth = function(width, gutter) {
paletteWidth = width;
paletteGutter = gutter;
};
this.setToolbarHeight = function(height, gutter) {
toolbarHeight = height;
toolbarGutter = gutter;
};
this.setFeedbackHeight = function(height, gutter) {
feedbackHeight = height;
feedbackGutter = gutter;
};
this.getCanvasWidth = function() {
return canvasWidth;
};
this.getCanvasHeight = function() {
return canvasHeight;
};
this.getCanvasBorderOffset = function() {
return canvasBorderOffset;
};
this.getToolbarWidth = function() {
return this.getToolbarHeight() > 0 ? this.getCanvasWidth() : 0;
};
this.getToolbarHeight = function() {
return toolbarHeight;
};
this.getToolbarGutter = function() {
return (toolbarHeight > 0) ? toolbarGutter : 0;
};
this.getFeedbackWidth = function() {
return this.getFeedbackHeight() > 0 ? this.getCanvasWidth() : 0;
};
this.getFeedbackHeight = function() {
return feedbackHeight;
};
this.getFeedbackGutter = function() {
return (feedbackHeight > 0) ? feedbackGutter : 0;
};
this._getWidth = function() {
return this.getPaletteWidth() + this.getPaletteGutter() + this.getCanvasWidth();
};
this._getHeight = function() {
return this.getToolbarHeight() + this.getToolbarGutter() + this.getCanvasHeight() +
this.getFeedbackGutter() + this.getFeedbackHeight();
};
this.getPaletteWidth = function() {
return paletteWidth;
};
this.getPaletteHeight = function() {
return this._getHeight();
};
this.getPaletteGutter = function() {
return (paletteWidth > 0) ? paletteGutter : 0;
};
this.getGridWidth = function() {
return this._getWidth() + containerPaddingLeft + containerPaddingRight;
};
this.getGridHeight = function() {
return this._getHeight() + containerPaddingTop  + containerPaddingBottom;
};
this.getContainerPaddingTop = function() {
return containerPaddingTop;
};
this.getContainerPaddingLeft = function() {
return containerPaddingLeft;
};
this.getContainerPaddingBottom = function() {
return containerPaddingBottom;
};
this.getContainerPaddingRight = function() {
return containerPaddingRight;
};
this.getPaletteX = function() {
return 0;
};
this.getPaletteY = function() {
return 0;
};
this.getToolbarX = function() {
return this.getPaletteWidth() + this.getPaletteGutter();
};
this.getToolbarY = function() {
return 0;
};
this.getCanvasX = function() {
return this.getPaletteWidth() + this.getPaletteGutter();
};
this.getCanvasY = function() {
return this.getToolbarHeight() + this.getToolbarGutter();
};
this.getFeedbackX = function() {
return this.getPaletteWidth() + this.getPaletteGutter();
};
this.getFeedbackY = function() {
return this.getToolbarHeight() + this.getToolbarGutter() + this.getCanvasHeight() + this.getFeedbackGutter();
};
};
Grid.Layout.debug = function(layout) {
console.log('Palette: width=%d height=%d x=%d y=%d visible=%s',
layout.getPaletteWidth(), layout.getPaletteHeight(), layout.getPaletteX(), layout.getPaletteY());
console.log('Toolbar: width=%d height=%d x=%d y=%d visible=%s',
layout.getToolbarWidth(), layout.getToolbarHeight(), layout.getToolbarX(), layout.getToolbarY());
console.log('Canvas: width=%d height=%d x=%d y=%d',
layout.getCanvasWidth(), layout.getCanvasHeight(), layout.getCanvasX(), layout.getCanvasY());
console.log('Feedback: width=%d height=%d x=%d y=%d visible=%s',
layout.getFeedbackWidth(), layout.getFeedbackHeight(), layout.getFeedbackX(), layout.getFeedbackY());
};
Grid.View.prototype.updateLayout = function(layout) {
this.setAttribute('groupPalette', 'transform', 'translate(' +
layout.getPaletteX() + ',' +
layout.getPaletteY() + ')');
this.setAttributes('backgroundPalette', {
'width': layout.getPaletteWidth(),
'height': layout.getPaletteHeight()
});
this.setAttribute('groupToolbar', 'transform', 'translate(' +
layout.getToolbarX() + ',' +
layout.getToolbarY() + ')');
this.setAttributes('backgroundToolbar', {
'width': layout.getToolbarWidth(),
'height': layout.getToolbarHeight()
});
this.setAttribute('groupCanvas', 'transform', 'translate(' +
layout.getCanvasX() + ',' +
layout.getCanvasY() + ')');
this.setAttributes('backgroundCanvas', {
'width': layout.getCanvasWidth(),
'height': layout.getCanvasHeight(),
'x': layout.getCanvasBorderOffset(),
'y': layout.getCanvasBorderOffset()
});
this.setAttribute('groupFeedback', 'transform', 'translate(' +
layout.getFeedbackX() + ',' +
layout.getFeedbackY() + ')');
this.setAttributes('backgroundFeedback', {
'width': layout.getFeedbackWidth(),
'height': layout.getFeedbackHeight()
});
this.setAttribute('groupWrapper', 'transform', 'translate(' +
(layout.getContainerPaddingLeft() + 0.5) + ',' +
(layout.getContainerPaddingTop() + 0.5) + ')');
this.width = layout.getGridWidth();
this.height = layout.getGridHeight();
this.zoom();
};

/* SOURCE FILE: view.loader.js (f8646ae0) 9/9/2014 2:08:53 PM */

Grid.View.prototype._create = function(parentEl)
{
var view = this;
var elementDoc = parentEl.ownerDocument;
var elementWin = elementDoc.parentWindow || elementDoc.defaultView;
var isFrame = (window != elementWin);
if (Grid.Utils.hasSVGWeb() && elementWin && !elementWin.svgweb)
{
elementWin.svgweb = window.svgweb;
}
var pageUnloaded = function() {
view.dispose();
};
elementWin.addEventListener('unload', pageUnloaded, false);
if (this._inlineHtml) this._createInline(parentEl);
else this._createObject(parentEl);
};
Grid.View.prototype._createObject = function(parentEl)
{
var svgID = parentEl.id + 'Container';
var svgObject = document.createElement('object', true);
svgObject.setAttribute('id', svgID);
svgObject.setAttribute('name', svgID);
svgObject.setAttribute('type', 'image/svg+xml');
svgObject.setAttribute('data', this.svgFile);
var view = this;
var loaded = function() { view._loadedObject(this); };
if (Grid.Utils.hasSVGWeb())
{
svgObject.addEventListener('SVGLoad', loaded, false);
svgweb.appendChild(svgObject, parentEl);
}
else
{
svgObject.addEventListener('load', loaded, false);
parentEl.appendChild(svgObject);
}
};
Grid.View.prototype._loadedObject = function(svgObject)
{
this._svgObject = svgObject;
this._svgDoc = this._svgObject.contentDocument;
this._svgWin = this._svgDoc.defaultView;
this._svgElement = this._svgDoc.documentElement;
this._svgRoot = this._svgDoc.rootElement;
this.svgLoaded = true;
this.fireLazy('loaded');
};
Grid.View.prototype._createInline = function(parentEl)
{
var callback =
{
success: this._loadedInline,
failure: this._failedInline,
scope: this,
argument: parentEl
};
YAHOO.util.Connect.asyncRequest('GET', this.svgFile, callback);
};
Grid.View.prototype._loadedInline = function(xhrObj)
{
var parentEl = xhrObj.argument;
var svgText = xhrObj.responseText;
parentEl.innerHTML = svgText;
this._svgElement = YAHOO.util.Dom.getChildren(parentEl)[0];
this._svgRoot = this._svgElement;
this._svgObject = this._svgElement;
this._svgDoc = this._svgElement.ownerDocument;
this._svgWin = this._svgDoc.parentWindow || this._svgDoc.defaultView;
this.svgLoaded = true;
this.fireLazy('loaded');
};

/* SOURCE FILE: view.canvas.js (285f52e5) 9/9/2014 2:08:53 PM */

Grid.View.prototype.getCanvasResolution = function()
{
var backgroundCanvas = this.getElementById('backgroundCanvas');
return {
width: backgroundCanvas.getAttribute("width") * 1,
height: backgroundCanvas.getAttribute("height") * 1
};
};
Grid.View.prototype.createGridLines = function(spacing)
{
this.clearGridLines();
if (!YAHOO.lang.isNumber(spacing) || spacing == 0) return false;
var gridLines = this.getElementById('gridlines');
var createLine = function(x1, y1, x2, y2)
{
var lineElement = this.createElement('line', {
'x1': x1,
'y1': y1,
'x2': x2,
'y2': y2
});
gridLines.appendChild(lineElement);
};
var res = this.getCanvasResolution();
for (var x = 0; x <= res.width; x += spacing)
{
createLine.call(this, x, 0, x, res.height);
}
for (var y = 0; y <= res.height; y += spacing)
{
createLine.call(this, 0, y, res.width, y);
}
return true;
};
Grid.View.prototype.clearGridLines = function()
{
this.removeChildren('gridlines');
};
Grid.View.prototype.setCanvasCursor = function(type)
{
var groupCanvas = this.getElementById('groupCanvas');
this.setAttributes(groupCanvas, {
'cursor': type
});
};
Grid.View.prototype.setCanvasCustomCursor = function(url, x, y)
{
var groupCanvas = this.getElementById('groupCanvas');
x = x || 0;
y = y || 0;
this.setAttributes(groupCanvas, {
'cursor': 'url(\'' + url + '\') ' + x + ' ' + y + ' , crosshair'
});
};

/* SOURCE FILE: view.palette.js (0877ee20) 9/9/2014 2:08:53 PM */

Grid.View.prototype._updatePaletteImgIndex = function(panup)
{
if (panup)
{
this.paletteImgIndex--;
}
else this.paletteImgIndex++;
this._updatePalettePaning();
};
Grid.View.prototype._getPaletteContainerWidth = function()
{
var paletteContainer = this.getElementById('backgroundPalette');
var paletteContainerXY = Grid.Utils.parseElementXY(paletteContainer);
return paletteContainerXY.width;
};
Grid.View.prototype.updateCenterScaleImage = function(paletteCenter, paletteScale)
{
this.paletteCenter = paletteCenter;
this.paletteScale = paletteScale;
this._updatePaletteLayout();
};
Grid.View.prototype._updatePaletteLayout = function()
{
var paletteContainer = this.getElementById('backgroundPalette');
var paletteContainerXY = Grid.Utils.parseElementXY(paletteContainer);
var paletteImages = this.getElementById('paletteImages').childNodes;
var paletteWidth = paletteContainerXY.width;
var x = 2;
var spacing = this.getPaletteSpacing();
var y = spacing;
for(var i = 0; i < paletteImages.length; i++)
{
var paletteImage = paletteImages[i];
var imageXY = Grid.Utils.parseElementXY(paletteImage);
if (this.paletteCenter)
{
if ((paletteWidth - imageXY.width) >= 0)
x = (paletteWidth - imageXY.width)/2;
else {
if (this.paletteScale) x = 0;
else x = (paletteWidth - imageXY.width)/2;
}
}
this.setAttributes(paletteImage, {
'x': x,
'y': y
}, 0);
paletteImage.scale = paletteWidth / imageXY.width;
if (this.paletteScale && paletteImage.scale < 1.0) {
paletteImage.scaled = true;
var transform = 'matrix(' + paletteImage.scale + ',0,0,' + paletteImage.scale + ',0,' + y * (1 - paletteImage.scale) + ')';
paletteImage.setAttribute('transform', transform);
} else if (paletteImage.scaled) {
paletteImage.scaled = false;
var transform = 'matrix(1,0,0,1,0,0)';
paletteImage.setAttribute('transform', transform);
}
if (this.paletteScale) {
y = y + imageXY.height * paletteImage.scale + spacing;
} else {
y = y + imageXY.height + spacing;
}
}
this._updatePalettePaning();
};
Grid.View.prototype._updatePalettePaning = function()
{
var panYoffset = this.getPalettePanOffset();
this.setAttributes(this.getElementById('paletteImages'),
{
'transform': 'translate(0, ' + (0 - panYoffset) + ')'
}, 0);
this.setAttributes(this.getElementById('palettecliprect'),
{
'x': 0,
'y': this.getPaletteClipOffset(panYoffset),
'height': this.getPaletteClipHeight()
}, 0);
};
Grid.View.prototype.getPaletteClipOffset = function(panYoffset)
{
var topClipAdjust = this.getPalettePanHeight();
if (panYoffset == 0) topClipAdjust = 0;
return (panYoffset + topClipAdjust);
};
Grid.View.prototype.getPalettePanOffset = function()
{
var paletteContainer = this.getElementById('backgroundPalette');
var paletteContainerXY = Grid.Utils.parseElementXY(paletteContainer);
var paletteImages = this.getElementById('paletteImages').childNodes;
var panYoffset = 0;
if (this.paletteImgIndex > 0) {
this.getElementById('panup').style.display = 'block';
for (var i=0; i<this.paletteImgIndex; i++) {
var paletteImage = paletteImages[i];
var imageXY = Grid.Utils.parseElementXY(paletteImage);
if (this.paletteScale)
panYoffset += imageXY.height * paletteImage.scale + this.getPaletteSpacing();
else
panYoffset += imageXY.height + this.getPaletteSpacing();
}
panYoffset -=  this.getPalettePanHeight();
} else {
this.getElementById('panup').style.display = 'none';
}
return panYoffset;
};
Grid.View.prototype.getPaletteClipHeight = function()
{
var paletteContainer = this.getElementById('backgroundPalette');
var paletteContainerXY = Grid.Utils.parseElementXY(paletteContainer);
var paletteImages = this.getElementById('paletteImages').childNodes;
var availableHeight = paletteContainerXY.height;
if (this.paletteImgIndex > 0) availableHeight -= this.getPalettePanHeight();
var totalHeight = 0;
for (var i = this.paletteImgIndex; i < paletteImages.length; i++)
{
var paletteImage = paletteImages[i];
var scale = 1;
if (this.paletteScale) scale = paletteImage.scale;
var imageXY = Grid.Utils.parseElementXY(paletteImage);
if (i == paletteImages.length - 1) totalHeight += imageXY.height * scale;
else totalHeight += imageXY.height * scale + this.getPaletteSpacing();
if (availableHeight < totalHeight)
{
availableHeight -= this.getPalettePanHeight();
this.getElementById('pandown').style.display = 'block';
var j = i;
while (totalHeight > availableHeight)
{
var preimage = paletteImages[j--];
var preXY = Grid.Utils.parseElementXY(preimage);
var increase;
if (this.paletteScale)
increase = preXY.height * preimage.scale + this.getPaletteSpacing();
else
increase = preXY.height + this.getPaletteSpacing();
totalHeight -= increase;
}
return totalHeight;
}
}
this.getElementById('pandown').style.display = 'none';
return availableHeight;
};
Grid.View.prototype.getPalettePanHeight = function()
{
return 15;
};
Grid.View.prototype.getPaletteSpacing = function()
{
return 3;
};
Grid.View.prototype.showPalette = function() {
this.setAttributes('groupPalette', { 'display': 'inline' });
};
Grid.View.prototype.hidePalette = function() {
this.setAttributes('groupPalette', { 'display': 'none' });
};
Grid.View.prototype.createPaletteImage = function(id, width, height, url)
{
var paletteElement = this.createElement('image', {
'id': id,
'width': width,
'height': height,
'transform': 'translate(-0.5, -0.5)'
});
paletteElement.setAttributeNS(XLINK_NS, 'xlink:href', url);
this.appendChild('paletteImages', paletteElement);
this._updatePaletteLayout();
return paletteElement;
};
Grid.View.prototype.clonePaletteImage = function(id, cloneID)
{
var paletteElement = this.getElementById(id);
var clonedElement = paletteElement.cloneNode(true);
clonedElement.id = cloneID;
this.appendChild('paletteDragging', clonedElement);
if (paletteElement.scaled) {
var x = paletteElement.getAttribute("x");
var y = paletteElement.getAttribute("y");
var s = "matrix(1,0,0,1,0,0)";
clonedElement.setAttribute("transform", s);
}
return clonedElement;
};
Grid.View.prototype.movePaletteImage = function(id, x, y)
{
var clonedElement = this.getElementById(id);
this.setAttributes(clonedElement,
{
'x': x,
'y': y
});
};
Grid.View.prototype.removePaletteImage = function(id)
{
this.removeElement(id);
this._updatePaletteLayout();
};
Grid.View.prototype.selectPaletteImage = function(paletteID)
{
var paletteElement = this.getElementById(paletteID);
var imageXY = Grid.Utils.parseElementXY(paletteElement);
var selectedPalette = this.getElementById('selectedPalette');
var height = imageXY.height + 4;
if (this.paletteScale) height = imageXY.height * paletteElement.scale + 4;
this.setAttributes(selectedPalette,
{
'x': 0,
'y': imageXY.y - this.getPalettePanOffset(),
'width': 75,
'height': height
}, 0);
selectedPalette.style.display = '';
};
Grid.View.prototype.deselectPaletteImage = function()
{
var selectedPalette = this.getElementById('selectedPalette');
selectedPalette.style.display = 'none';
};

/* SOURCE FILE: view.toolbar.js (37b2719f) 9/9/2014 2:08:53 PM */

Grid.View.prototype.showToolbar = function() {
this.setAttributes('groupToolbar', { 'display': 'inline' });
};
Grid.View.prototype.hideToolbar = function() {
this.setAttributes('groupToolbar', { 'display': 'none' });
};

/* SOURCE FILE: view.feedback.js (a9e7cf78) 9/9/2014 2:08:53 PM */

Grid.View.prototype.setFeedbackText = function(text)
{
this.setText('feedback', text);
};
Grid.View.prototype.setCoordinatesText = function(text)
{
this.setText('coordinates', text);
};
Grid.View.prototype.showFeedback = function() {
this.setAttributes('groupFeedback', { 'display': 'inline' });
};
Grid.View.prototype.hideFeedback = function() {
this.setAttributes('groupFeedback', { 'display': 'none' });
};

/* SOURCE FILE: view.editor.js (507bd1fa) 9/9/2014 2:08:53 PM */

Grid.View.prototype.createSnapToPointAndCircle = function(x, y, r, id)
{
var center = this.createElement("circle", {
"id": 'snapPointCenter_' + id,
"cx": x,
"cy": y,
"r": 4
});
this.appendChild('crtool_snapcenter', center);
var circle = this.createElement("circle", {
"id": 'snapPointCircle_' + id,
"cx": x,
"cy": y,
"r": r
});
this.appendChild('crtool_snapcircle', circle);
};
Grid.View.prototype.createCRToolCircle = function(x, y, r)
{
var container = 'crtool_circle';
var centerId = 'crToolCircleCenter';
var circleId = 'crToolCircle';
var center = this.createElement("circle", {
"id": centerId,
"cx": x,
"cy": y,
"r": 4
});
this.appendChild(container, center);
var circle = this.createElement("circle", {
"id": circleId,
"cx": x,
"cy": y,
"r": r
});
this.appendChild(container, circle);
};
Grid.View.prototype.createCRToolRectangle = function(x1,y1,x2,y2)
{
var container = 'crtool_rectangle';
var rect = this.createElement("rect", {
"id": 'crToolRectangle',
"x": x1,
"y": y1,
"width": x2-x1,
"height": y2-y1
});
this.appendChild(container, rect);
};
Grid.View.prototype.updateHelperLine = function(id, x1, y1, x2, y2)
{
var mergeLine = this.getElementById(id);
if (!mergeLine)
{
mergeLine = this.createElement('line', {
'id': id,
'fill': 'none',
'stroke': 'green',
'stroke-width': '1',
'opacity': '0.7',
'stroke-dasharray': '3, 3'
});
this.appendChild('mergeLines', mergeLine);
}
this.setAttributes(mergeLine,
{
'x1': x1,
'y1': y1,
'x2': x2,
'y2': y2
});
};

/* SOURCE FILE: action.js (79bf0adc) 9/9/2014 2:08:53 PM */

Grid.Action = {};
Grid.Action.actions = {};
Grid.Action.registerAction = function(modeName, action) { Grid.Action.actions[modeName] = action; };
Grid.Action.Base = function(grid)
{
this.grid = grid;
this.canvas = grid.canvas;
this.model = grid.model;
this._completed = false;
};
Grid.Action.Base.prototype.isCompleted = function() { return this._completed; };
Grid.Action.Base.prototype.onMouseEvent = function(evt) {};
Grid.Action.Base.prototype.onKeyEvent = function(evt) {};
Grid.Action.Base.prototype.dispose = function() {};
Grid.Action.Base.prototype.finalize = function()
{
this.dispose();
this._completed = true;
};

/* SOURCE FILE: action.move.js (940864e9) 9/9/2014 2:08:53 PM */

Grid.Action.Move = function(grid)
{
Grid.Action.Move.superclass.constructor.call(this, grid);
this.moveObject = null;
};
YAHOO.lang.extend(Grid.Action.Move, Grid.Action.Base);
Grid.Action.Move.prototype.dispose = function()
{
if (this.moveObject instanceof Grid.Model.Point) this.canvas.finalizePoint(this.moveObject);
else if (this.moveObject instanceof Grid.Model.Image) this.canvas.finalizeImage(this.moveObject);
};
Grid.Action.Move.prototype.onMouseEvent = function(evt)
{
var focusedObject = this.canvas.getFocused();
if (evt.name == 'mousedown')
{
if (this.moveObject || focusedObject == null || !focusedObject.isMoveable())
{
this.finalize();
}
else
{
this.moveObject = focusedObject;
this.grid.setHint('DraggingObject');
}
}
if (this.moveObject == null) return;
if (evt.name == 'mousemove' || evt.name == 'drag')
{
var x = evt.currentPosition.x,
y = evt.currentPosition.y;
if (typeof this.moveObject.moveTo == 'function')
{
this.moveObject.moveTo(x, y);
}
}
if (evt.name == 'dragend')
{
this.finalize();
}
if (evt.name == 'mouseup' && focusedObject instanceof Grid.Model.Point)
{
this.finalize();
}
};
Grid.Action.Move.prototype.onKeyEvent = function(evt)
{
if (this.moveObject != null)
{
this.canvas.clearFocused();
this.finalize();
}
else
{
var focusedObject = this.canvas.getFocused();
if (focusedObject != null && focusedObject.isMoveable())
{
this.moveObject = focusedObject;
}
else
{
this.finalize();
}
}
};

/* SOURCE FILE: action.point.js (d490d4bb) 9/9/2014 2:08:53 PM */

Grid.Action.Point = function(grid)
{
Grid.Action.Point.superclass.constructor.call(this, grid);
this.createdPoint = null;
};
YAHOO.lang.extend(Grid.Action.Point, Grid.Action.Base);
Grid.Action.Point.prototype.dispose = function()
{
if (this.createdPoint)
{
this.createdPoint = this.canvas.finalizePoint(this.createdPoint);
}
};
Grid.Action.Point.prototype.onMouseEvent = function(evt)
{
var x = evt.currentPosition.x,
y = evt.currentPosition.y;
if (evt.name == 'mousedown')
{
var entity = this.model.getEntity(evt.target.id);
if (entity && entity.getType() == 'point')
{
this.createdPoint = entity;
}
else
{
this.createdPoint = this.model.addPoint(x, y);
}
if (this.createdPoint == null) this.finalize();
}
if (evt.name == 'drag' && this.createdPoint.isMoveable())
{
this.createdPoint.moveTo(x, y);
}
if (evt.name == 'mouseup' || evt.name == 'dragend')
{
this.finalize();
}
};
Grid.Action.Point.prototype.onKeyEvent = function(evt)
{
if (!this.createdPoint)
{
this.createdPoint = this.model.addPoint(30, 30);
this.createdPoint.snapToGrid();
}
else
{
this.finalize();
}
};

/* SOURCE FILE: action.line.js (a25d6038) 9/9/2014 2:08:53 PM */

Grid.Action.Line = function(grid)
{
Grid.Action.Line.superclass.constructor.call(this, grid);
this.pointType = 'none';
this.sourcePoint = null;
this.targetPoint = null;
this.line = null;
this.moved = false;
};
YAHOO.lang.extend(Grid.Action.Line, Grid.Action.Base);
Grid.Action.Line.prototype.dispose = function()
{
if (this.pointType == 'source')
{
this.canvas.finalizePoint(this.sourcePoint);
}
else if (this.pointType == 'target')
{
this.targetPoint = this.canvas.finalizePoint(this.targetPoint);
if (this.sourcePoint == this.targetPoint)
{
this.model.deleteLine(this.line);
}
}
};
Grid.Action.Line.prototype.getPoint = function() { return this[this.pointType + 'Point']; };
Grid.Action.Line.prototype.setPoint = function(point) { this[this.pointType + 'Point'] = point; };
Grid.Action.Line.prototype.movePoint = function(x, y)
{
var currentPoint = this.getPoint();
currentPoint.moveTo(x, y);
};
Grid.Action.Line.prototype.createLine = function()
{
this.line = this.model.addLine(this.sourcePoint, this.targetPoint);
};
Grid.Action.Line.prototype.canLineBeFinalized = function()
{
if (this.sourcePoint == null || this.targetPoint == null) return false;
if (!this.targetPoint.isMoveable()) return true;
if (!this.moved) return false;
var intersectedPoints = this.targetPoint.getIntersections();
for (var i = 0; i < intersectedPoints.length; i++)
{
if (this.sourcePoint == intersectedPoints[i]) return false;
}
return true;
};
Grid.Action.Line.prototype.onMouseEvent = function(evt)
{
var x = evt.currentPosition.x,
y = evt.currentPosition.y;
if (evt.name == 'mousedown')
{
var clickedEntity = this.model.getEntity(evt.target.id);
if (this.sourcePoint && this.sourcePoint == clickedEntity) return;
if (this.sourcePoint == null)
{
this.pointType = 'source';
if (clickedEntity && clickedEntity.getType == 'point')
{
this.setPoint(clickedEntity);
}
else
{
this.setPoint(this.model.addPoint(x, y));
this.sourcePoint = this.canvas.finalizePoint(this.sourcePoint);
}
}
if (this.targetPoint == null)
{
this.pointType = 'target';
this.setPoint(this.model.addPoint(x, y));
this.createLine();
}
if (this.canLineBeFinalized()) this.finalize();
}
if ((evt.name == 'mousemove' || evt.name == 'drag') && this.targetPoint.isMoveable())
{
this.moved = true;
this.movePoint(x, y);
}
if (evt.name == 'dragend')
{
if (this.canLineBeFinalized()) this.finalize();
}
};
Grid.Action.Line.prototype.onKeyEvent = function(evt)
{
var selected = this.canvas.getFocused();
if (selected && this.pointType == 'none')
{
this.pointType = 'source';
this.setPoint(selected);
}
if (!selected && this.pointType == 'none')
{
this.pointType = 'source';
this.setPoint(this.model.addPoint(30, 30));
}
else if (this.pointType == 'source')
{
this.sourcePoint = this.canvas.finalizePoint(this.sourcePoint);
this.pointType = 'target';
this.setPoint(this.model.addPoint(this.sourcePoint.x, this.sourcePoint.y));
this.createLine();
}
else
{
this.targetPoint = this.canvas.finalizePoint(this.targetPoint);
if (this.sourcePoint == this.targetPoint)
{
this.model.deleteLine(this.line);
}
this.finalize();
}
};
Grid.Action.LineDash = function(grid)
{
Grid.Action.LineDash.superclass.constructor.call(this, grid);
};
YAHOO.lang.extend(Grid.Action.LineDash, Grid.Action.Line);
Grid.Action.LineDash.prototype.createLine = function()
{
this.line = this.model.addLine(this.sourcePoint, this.targetPoint, 'none', 'dashed');
};

/* SOURCE FILE: action.arrow.js (c794903f) 9/9/2014 2:08:53 PM */

Grid.Action.ArrowSingle = function(grid)
{
Grid.Action.ArrowSingle.superclass.constructor.call(this, grid);
};
YAHOO.lang.extend(Grid.Action.ArrowSingle, Grid.Action.Line);
Grid.Action.ArrowSingle.prototype.createLine = function()
{
this.line = this.model.addLine(this.sourcePoint, this.targetPoint, 'forward');
};
Grid.Action.ArrowDouble = function(grid)
{
Grid.Action.ArrowDouble.superclass.constructor.call(this, grid);
};
YAHOO.lang.extend(Grid.Action.ArrowDouble, Grid.Action.Line);
Grid.Action.ArrowDouble.prototype.createLine = function()
{
this.line = this.model.addLine(this.sourcePoint, this.targetPoint, 'both');
};

/* SOURCE FILE: action.delete.js (5ec81a89) 9/9/2014 2:08:53 PM */

Grid.Action.Delete = function(grid)
{
Grid.Action.Delete.superclass.constructor.call(this, grid);
this.deletedPoint = null;
};
YAHOO.lang.extend(Grid.Action.Delete, Grid.Action.Base);
Grid.Action.Delete.prototype.onMouseEvent = function(evt)
{
if (evt.name == 'mouseup')
{
var selected = this.canvas.getFocused();
if (selected)
{
var type = selected.getType();
switch(type)
{
case 'point': this.model.deletePoint(selected); break;
case 'canvasimage': this.model.deleteImage(selected); break;
case 'circle': this.model.deleteEntity(selected); break;
}
this.finalize();
}
else
{
var targetEntity = this.model.getEntity(evt.target.id);
if (targetEntity && targetEntity.getType() == 'line')
{
this.model.deleteLine(targetEntity);
}
}
}
if (evt.name == 'mouseup' || evt.name == 'dragend') this.finalize();
};
Grid.Action.Delete.prototype.onKeyEvent = function(evt)
{
var selected = this.canvas.getFocused();
if (selected)
{
var type = selected.getType();
switch (type)
{
case 'point': this.model.deletePoint(selected); break;
case 'canvasimage': this.model.deleteImage(selected); break;
}
this.finalize();
}
};

/* SOURCE FILE: action.circle.js (3b572cf1) 9/9/2014 2:08:53 PM */

Grid.Action.Circle = function(grid)
{
Grid.Action.Circle.superclass.constructor.call(this, grid);
this.createdCircle = null;
};
YAHOO.lang.extend(Grid.Action.Circle, Grid.Action.Base);
Grid.Action.Circle.prototype.create = function(x, y)
{
var circle = this.model.createCircle(x, y, 10);
this.model.addCircle(circle);
return circle;
};
Grid.Action.Circle.prototype.dispose = function () {
this.createdCircle.snap();
this.createdCircle = null;
};
Grid.Action.Circle.prototype.onMouseEvent = function(evt)
{
var x = evt.currentPosition.x,
y = evt.currentPosition.y;
if (evt.name == 'mousedown')
{
var entity = this.model.getEntity(evt.target.id);
if (entity && entity.getType() == 'circle')
{
this.createdCircle = entity;
}
else
{
this.createdCircle = this.create(x, y);
}
if (this.createdCircle == null) this.finalize();
}
if (evt.name == 'drag') {
var radius = evt.currentPosition.x - evt.clickedPosition.x;
this.createdCircle.radius = (radius < 10) ? this.createdCircle.radius : radius;
this.createdCircle.update();
}
if (evt.name == 'mouseup' || evt.name == 'dragend')
{
this.finalize();
}
};
Grid.Action.Circle.prototype.onKeyEvent = function(evt)
{
if (!this.createdPoint)
{
this.createdPoint = this.create(30, 30);
this.createdPoint.snapToGrid();
}
else
{
this.finalize();
}
};

/* SOURCE FILE: toolbar.js (8f38bc0f) 9/9/2014 2:08:53 PM */

Grid.Toolbar = function(grid)
{
this.grid = grid;
this.view = grid.view;
this._buttonHash = {};
this._buttons = [];
};
Grid.Toolbar.prototype.init = function()
{
var buttonNames = ['move', 'delete', 'point', 'connect', 'arrow', 'arrw2', 'dash', 'circle'];
var grid = this.grid;
for (var i = 0; i < buttonNames.length; i++)
{
var buttonName = buttonNames[i];
var button = null;
switch (buttonName)
{
case 'move': button = new Grid.Toolbar.Button.Circle(this, buttonName); break;
default: button = new Grid.Toolbar.Button(this, buttonName); break;
}
button.hide();
this._buttons.push(button);
this._buttonHash[buttonName] = button;
(function (button) {
var buttonGroup = button.getGroup();
Grid.Utils.addMouseListener(buttonGroup, 'mousedown', function () {
if (!grid.isReadOnly()) {
grid.setMode(button.name);
}
}, false);
})(button);
}
};
Grid.Toolbar.prototype.getButton = function(buttonName) { return this._buttonHash[buttonName]; };
Grid.Toolbar.prototype.getButtons = function() { return this._buttons; };
Grid.Toolbar.prototype.getVisibleButtons = function()
{
var visibleButtons = [];
for (var i = 0; i < this._buttons.length; i++)
{
var button = this._buttons[i];
if (button.isVisible()) visibleButtons.push(button);
}
return visibleButtons;
};
Grid.Toolbar.prototype.resetButtons = function()
{
for (var i = 0; i < this._buttons.length; i++)
{
var button = this._buttons[i];
button.hide();
}
};
Grid.Toolbar.prototype.enableButtons = function(buttonNames)
{
this.resetButtons();
for (var i = 0; i < buttonNames.length; i++) {
var button = this._buttonHash[buttonNames[i]];
button.show();
}
var spacing = 5;
var x = spacing;
var y = 2;
for (var i = 0; i < this._buttons.length; i++) {
var button = this._buttons[i];
if (!button.isVisible()) continue;
var buttonGroup = button.getGroup();
this.view.setAttributes(buttonGroup,
{
'transform': 'translate(' + x + ', ' + y + ')'
});
x = x + button.width + spacing;
}
};
Grid.Toolbar.prototype.processKeyEvent = function(evt)
{
if (evt.key == 'enter')
{
this.grid.setArea('canvas');
return;
}
if (evt.key != 'left' && evt.key != 'right') return;
var selectedButton = this.getButton(this.grid.getMode());
var visibleButtons = this.getVisibleButtons();
if (visibleButtons.length == 0) return;
for (var i = 0; i < visibleButtons.length; i++)
{
var button = visibleButtons[i];
if (button == selectedButton)
{
if (evt.key == 'left')
{
if (i == 0) selectedButton = visibleButtons[visibleButtons.length - 1];
else selectedButton = visibleButtons[i - 1];
}
else if (evt.key == 'right')
{
if (i == (visibleButtons.length - 1)) selectedButton = visibleButtons[0];
else selectedButton = visibleButtons[i + 1];
}
break;
}
}
this.grid.setMode(selectedButton.name);
};
Grid.Action.registerAction('move', Grid.Action.Move);
Grid.Action.registerAction('delete', Grid.Action.Delete);
Grid.Action.registerAction('point', Grid.Action.Point);
Grid.Action.registerAction('connect', Grid.Action.Line);
Grid.Action.registerAction('arrow', Grid.Action.ArrowSingle);
Grid.Action.registerAction('arrw2', Grid.Action.ArrowDouble);
Grid.Action.registerAction('dash', Grid.Action.LineDash);
Grid.Action.registerAction('circle', Grid.Action.Circle);

/* SOURCE FILE: toolbar.button.js (90ecf603) 9/9/2014 2:08:53 PM */

Grid.Toolbar.Button = function(toolbar, name)
{
this.name = name;
this.width = 100;
this.toolbar = toolbar;
this.grid = toolbar.grid;
this.view = toolbar.view;
this._visible = true;
this._state = Grid.Toolbar.Button.State.Up;
this._iconFillElements = [];
this._iconStrokeElements = [];
this._init();
};
Grid.Toolbar.Button.State =
{
Up: 0,
Selected: 1,
Over: 2,
SelectedOver: 3
};
Grid.Toolbar.Button.prototype._init = function()
{
var buttonGroup = this.getGroup();
for (var i = 0; i < buttonGroup.childNodes.length; i++)
{
var element = buttonGroup.childNodes[i];
if (element.nodeType == 1)
{
if (element.getAttribute('fill') == '#ffffff') this._iconFillElements.push(element);
if (element.getAttribute('stroke') == '#ffffff') this._iconStrokeElements.push(element);
}
if (typeof window.Messages == 'object' && element.nodeName == 'text')
{
var key = "GridSVG.Label.button_"+element.textContent.replace(" ","_");
var alternateLabel = window.Messages.get(key);
if(alternateLabel != key) {
element.textContent = alternateLabel;
}
}
}
};
Grid.Toolbar.Button.prototype.getGroup = function()
{
return this.view.getElementById('button_' + this.name);
};
Grid.Toolbar.Button.prototype.getContainer = function()
{
var buttonGroup = this.getGroup();
var path = null;
for (var i = 0; i < buttonGroup.childNodes.length; i++)
{
var node = buttonGroup.childNodes[i];
if (node.nodeName == 'path')
{
path = node;
break;
}
}
return path;
};
Grid.Toolbar.Button.prototype.show = function()
{
var buttonGroup = this.getGroup();
buttonGroup.style.display = '';
this._visible = true;
};
Grid.Toolbar.Button.prototype.hide = function()
{
var buttonGroup = this.getGroup();
buttonGroup.style.display = 'none';
this._visible = false;
};
Grid.Toolbar.Button.prototype.isVisible = function() { return this._visible; };
Grid.Toolbar.Button.prototype._setIconColor = function(color)
{
for (var i = 0; i < this._iconFillElements.length; i++)
{
var element = this._iconFillElements[i];
element.setAttribute('fill', color);
}
for (var i = 0; i < this._iconStrokeElements.length; i++)
{
var element = this._iconStrokeElements[i];
element.setAttribute('stroke', color);
}
};
Grid.Toolbar.Button.prototype.deselect = function()
{
this._state = Grid.Toolbar.Button.State.Up;
this._setIconColor('#ffffff');
var container = this.getContainer();
container.setAttribute('fill', 'url(#buttons_background_up)');
};
Grid.Toolbar.Button.prototype.select = function()
{
this._state = Grid.Toolbar.Button.State.Selected;
this._setIconColor('#1f5181');
var container = this.getContainer();
container.setAttribute('fill', 'url(#buttons_background_selected)');
};
Grid.Toolbar.Button.Circle = function(toolbar, name)
{
Grid.Toolbar.Button.Circle.superclass.constructor.call(this, toolbar, name);
this.width = 18;
};
Lang.extend(Grid.Toolbar.Button.Circle, Grid.Toolbar.Button);
Grid.Toolbar.Button.Circle.prototype.getContainer = function()
{
var buttonGroup = this.getGroup();
var circle = null;
for (var i = 0; i < buttonGroup.childNodes.length; i++)
{
var node = buttonGroup.childNodes[i];
if (node.nodeName == 'circle')
{
circle = node;
break;
}
}
return circle;
};

/* SOURCE FILE: palette.js (63a68ea5) 9/9/2014 2:08:53 PM */

Grid.Palette = function(grid)
{
this.grid = grid;
this.view = grid.view;
this.model = grid.model;
this.canvas = grid.canvas;
this._selectedImage = null;
this.moving = false;
if (Grid.Utils.hasSVGWeb())
{
ErrorHandler.wrapFunctions(this, ['processMouseEvent', 'subscribeToModelEvents']);
}
};
Grid.Palette.prototype.clearMoving = function()
{
this.moving = false;
var imageID = this._selectedImage.getID();
var cloneID = imageID + '_clone';
this.view.removeElement(cloneID);
this.grid.setModeHint();
};
Grid.Palette.prototype.getSelected = function() { return this._selectedImage; };
Grid.Palette.prototype.hasSelected = function () { return this._selectedImage != null; };
Grid.Palette.prototype.setSelected = function(paletteImage)
{
if (this.moving) this.clearMoving();
if (this._selectedImage && this._selectedImage == paletteImage) return false;
if (this._selectedImage)
{
var id = this._selectedImage.getID() + '_border';
this.view.deselectPaletteImage();
logger.debug('palette unselected: ' + id);
}
this._selectedImage = paletteImage || null;
if (paletteImage)
{
var id = paletteImage.getID();
this.view.selectPaletteImage(id);
logger.debug('palette selected: ' + id);
this.grid.setMode('move');
this.grid.canvas.clearFocused();
}
return true;
};
Grid.Palette.prototype.clearSelected = function()
{
return this.setSelected(null);
};
Grid.Palette.prototype.processMouseEvent = function(evt)
{
if (!this.moving && evt.name == 'mousedown')
{
if ((evt.target.id == 'panup') || (evt.target.id == 'pandown'))
{
if (evt.target.id == 'panup') {
this.grid.view._updatePaletteImgIndex(true);
} else {
this.grid.view._updatePaletteImgIndex(false);
}
return;
}
if (evt.target.nodeName == 'image' && evt.target.id.indexOf('paletteimage_') != -1)
{
this.setSelected(this.model.getEntity(evt.target.id));
}
else
{
this.clearSelected();
}
}
var paletteImage = this.getSelected();
if (paletteImage == null) return;
var imageID = paletteImage.getID();
var cloneID = imageID + '_clone';
var gridX = evt.currentPosition.x - Math.round(paletteImage.width / 2);
var gridY = evt.currentPosition.y - paletteImage.height;
if (!this.moving && (evt.name == 'mousedown' || evt.name == 'dragbegin'))
{
this.moving = true;
this.view.clonePaletteImage(imageID, cloneID);
this.view.movePaletteImage(cloneID, gridX, gridY);
this.grid.setHint('DraggingObject');
}
else if (this.moving && (evt.name == 'mousemove' || evt.name == 'drag'))
{
this.view.movePaletteImage(cloneID, gridX, gridY);
}
else if (this.moving && (evt.name == 'mousedown' || evt.name == 'dragend'))
{
this.clearMoving();
this.clearSelected();
var canvasPosition = this.view.translateElement('groupCanvas', evt.raw.clientX, evt.raw.clientY);
if (canvasPosition && canvasPosition.x > 0 && canvasPosition.y > 0)
{
var image = this.model.addImage(paletteImage.name, canvasPosition.x, canvasPosition.y);
this.grid.canvas.finalizeImage(image);
this.grid.setArea('canvas');
}
}
};
Grid.Palette.prototype.processKeyEvent = function(evt)
{
var selected = this.getSelected();
var paletteImages = this.model.getPaletteImages();
if (evt.key == 'space')
{
var image = this.model.addImage(selected.name, 0, 0);
this.grid.canvas.finalizeImage(image);
this.grid.canvas.setFocused(image);
this.grid.setArea('canvas');
this.grid.setMode('move');
this.clearSelected();
this.grid.canvas.processKeyEvent(evt);
}
if (selected == null && (evt.key == 'up' || evt.key == 'down'))
{
this.setSelected(paletteImages[0]);
return;
}
if (evt.key == 'up' || evt.key == 'down')
{
if (paletteImages.length == 0) return;
var paletteIndex = -1;
for (var i = 0; i < paletteImages.length; i++)
{
if (paletteImages[i] == selected)
{
paletteIndex = i;
break;
}
}
if (evt.key == 'down')
{
if (paletteIndex < paletteImages.length - 1)
{
this.setSelected(paletteImages[paletteIndex + 1]);
}
else
{
this.setSelected(paletteImages[0]);
}
}
if (evt.key == 'up')
{
if (paletteIndex == 0)
{
this.setSelected(paletteImages[paletteImages.length - 1]);
}
else
{
this.setSelected(paletteImages[paletteIndex - 1]);
}
}
}
};
Grid.Palette.prototype.subscribeToModelEvents = function()
{
var palette = this;
var view = this.view;
var question = this.model;
this.model.subscribe('onAdd', function(entity)
{
var id = entity.getID();
if (entity instanceof Grid.Model.PaletteImage)
{
view.createPaletteImage(id, entity.width, entity.height, entity.url);
}
});
this.model.subscribe('onDelete', function(entity)
{
var id = entity.getID();
if (entity instanceof Grid.Model.PaletteImage)
{
view.removePaletteImage(id);
}
});
};

/* SOURCE FILE: canvas.js (b03ca385) 9/9/2014 2:08:53 PM */

Grid.Canvas = function(grid)
{
this.grid = grid;
this.view = grid.view;
this.model = grid.model;
this._currentHover = null;
this._currentFocus = null;
this._currentAction = null;
if (Grid.Utils.hasSVGWeb())
{
ErrorHandler.wrapFunctions(this,
[
'finalizePoint', 'finalizeLines', 'processMouseEvent', 'processKeyEvent', 'subscribeToModelEvents'
]);
}
this.init();
};
YAHOO.lang.augmentProto(Grid.Canvas, EventLazyProvider);
Grid.Canvas.prototype.init = function()
{
var canvas = this;
var view = this.view;
var onEntityEvent = function(name, entity)
{
logger.debug('EVENT - {name} ({id})', { name: name, id: entity.getID() });
entity.updateElement(view);
};
this.subscribe('onHover', function(entity) { onEntityEvent('onHover', entity); });
this.subscribe('onHoverOut', function(entity) { onEntityEvent('onHoverOut', entity); });
this.subscribe('onFocus', function(entity) { onEntityEvent('onFocus', entity); });
this.subscribe('onFocusOut', function(entity) { onEntityEvent('onFocusOut', entity); });
this.subscribe('onActionStart', function(action)
{
var mode = this.grid.getMode();
var focusedEntity = canvas.getFocused();
if (mode == 'move' && focusedEntity != null)
{
if (focusedEntity.isSelected()) focusedEntity.deselect();
else focusedEntity.select();
}
});
};
Grid.Canvas.prototype.getHovering = function() { return this._currentHover; };
Grid.Canvas.prototype.clearHovering = function()
{
if (this._currentHover == null) return false;
var entity = this._currentHover;
this._currentHover = null;
entity.setHovering(false);
this.fireLazy('onHoverOut', entity);
if (entity.isFocusable() === Grid.Model.Focusable.Auto) this.clearFocused(entity);
return true;
};
Grid.Canvas.prototype.setHovering = function(entity)
{
if (this._currentHover == entity) return false;
this.clearHovering();
if (entity == null) return false;
if (!entity.isHoverable()) return false;
if (this.performingAction()) return false;
var allowHover = this.fireLazy('onBeforeHover', entity);
if (allowHover)
{
this._currentHover = entity;
entity.setHovering(true);
this.fireLazy('onHover', entity);
if (entity.isFocusable() === Grid.Model.Focusable.Auto) this.setFocused(entity);
}
return allowHover;
};
Grid.Canvas.prototype.getFocused = function() { return this._currentFocus; };
Grid.Canvas.prototype.clearFocused = function(entity)
{
if (this._currentFocus == null) return false;
if (entity != null && entity != this._currentFocus) return false;
entity = this._currentFocus;
this._currentFocus = null;
entity.setFocused(false);
this.fireLazy('onFocusOut', entity);
return true;
};
Grid.Canvas.prototype.setFocused = function(entity)
{
if (entity == this._currentFocus) return false;
this.clearFocused();
if (entity == null) return false;
if (this.grid.palette.moving == true) return false;
if (!entity.isFocusable()) return false;
var allowFocus = this.fireLazy('onBeforeFocus', entity);
if (allowFocus)
{
this._currentFocus = entity;
entity.setFocused(true);
this.fireLazy('onFocus', entity);
}
return allowFocus;
};
Grid.Canvas.prototype.performingAction = function() { return (this._currentAction != null); };
Grid.Canvas.prototype.startAction = function()
{
if (this._currentAction != null) return false;
var focusedEntity = this.getFocused();
if (focusedEntity != null && focusedEntity.isMoveable())
{
this.clearHovering();
}
var mode = this.grid.getMode();
var actionClass = Grid.Action.actions[mode];
if (actionClass == null) return false;
this._currentAction = new actionClass(this.grid);
this.fireLazy('onActionStart', this._currentAction);
return true;
};
Grid.Canvas.prototype.stopAction = function()
{
if (this._currentAction == null) return false;
if (!this._currentAction.isCompleted()) this._currentAction.finalize();
this.grid.setModeHint();
var action = this._currentAction;
this._currentAction = null;
this.fireLazy('onActionEnd', action);
return true;
};
Grid.Canvas.prototype.finalizePoint = function(point)
{
var lines = point.getLines();
point.snap();
var intersectedPoints = point.getIntersections();
if (intersectedPoints.length == 0)
{
this.finalizeLines(lines);
return point;
}
var mergePoint = intersectedPoints[0];
point.moveLines(mergePoint);
if (point == this.getFocused()) this.setFocused(mergePoint);
this.model.deletePoint(point);
this.finalizeLines(mergePoint.getLines());
return mergePoint;
};
Grid.Canvas.prototype.finalizeLines = function(pointLines)
{
if (this._currentAction instanceof Grid.Action.Line && this._currentAction.targetPoint == null) return;
var toleranceParallel = 10;
var toleranceDistance = 4;
for (var i = 0; i < pointLines.length; i++)
{
var pointLine = pointLines[i];
var lines = this.model.getLinesByDir(pointLine.dirType);
for (var j = 0; j < lines.length; j++)
{
var line = lines[j];
if (pointLine == line) continue;
var isParallel = pointLine.isParallelTo(line, toleranceParallel);
if (!isParallel) continue;
var distance = pointLine.distanceFrom(line);
if (distance > toleranceDistance) continue;
var newLine = pointLine.getLongestLine(line);
this.model.deleteLine(line);
this.model.deleteLine(pointLine);
var mergedLine = this.model.addLine(newLine.source, newLine.target, pointLine.dirType, pointLine.style);
if (line.source.getLines().length == 0) this.model.deletePoint(line.source);
if (line.target.getLines().length == 0) this.model.deletePoint(line.target);
if (pointLine.source.getLines().length == 0) this.model.deletePoint(pointLine.source);
if (pointLine.target.getLines().length == 0) this.model.deletePoint(pointLine.target);
var mergedLines = [];
mergedLines.push(mergedLine);
this.finalizeLines(mergedLines);
return;
}
}
};
Grid.Canvas.prototype.finalizeImage = function(image)
{
image.snap();
};
Grid.Canvas.prototype.processMouseEvent = function(evt)
{
this._checkForMouseHover(evt);
this._checkForMouseFocus(evt);
this._processMouseAction(evt);
};
Grid.Canvas.prototype._checkForMouseHover = function(evt)
{
if (evt.name != 'mousemove' || this.performingAction()) return;
if (evt.target == null || evt.target.id == null) return;
var entity = this.model.getEntity(evt.target.id);
if (entity && entity.isHoverable()) this.setHovering(entity);
else this.clearHovering();
};
Grid.Canvas.prototype._checkForMouseFocus = function(evt)
{
if (evt.name != 'mousedown') return;
if (evt.target == null) return;
var entity = this.model.getEntity(evt.target.id);
if (entity && entity.isFocusable()) this.setFocused(entity);
else this.clearFocused();
};
Grid.Canvas.prototype._processMouseAction = function(evt                  )
{
var mode = this.grid.getMode();
if (this._currentAction == null)
{
if (evt.name != 'mousedown') return;
this.startAction();
}
try
{
this._currentAction.onMouseEvent(evt);
}
catch (ex)
{
this._currentAction = null;
throw ex;
}
if (this._currentAction != null && this._currentAction.isCompleted()) this.stopAction();
};
Grid.Canvas.prototype.getFocusableObjects = function(typeFilter)
{
var focusableEntities = [];
var entities = this.model.getEntities();
for (var i = 0; i < entities.length; i++)
{
var entity = entities[i];
if ((typeof typeFilter != 'function' || entity instanceof typeFilter) && entity.isFocusable())
{
focusableEntities.push(entities[i]);
}
}
return focusableEntities;
};
Grid.Canvas.prototype.processKeyEvent = function(evt)
{
var focusedObject = this.getFocused();
if (evt.key == 'esc')
{
this.clearFocused();
this.stopAction();
}
if (evt.key == 'enter' && this._currentAction == null)
{
var objects;
if (this.grid.getMode() == 'move' || this.grid.getMode() == 'delete')
{
objects = this.getFocusableObjects(Grid.Model.Base);
}
else
{
objects = this.getFocusableObjects(Grid.Model.Point);
}
var nextObject = this._nextObjectInFocusableOrder(focusedObject, objects);
if (focusedObject != nextObject)
{
this.stopAction();
}
this.setFocused(nextObject);
return;
};
if (evt.key == 'space')
{
this._processKeyAction('keydown', evt);
};
if (this._currentAction == null) return;
var moveKey = (!evt.dom.ctrlKey && (evt.key == 'left' || evt.key == 'right' || evt.key == 'up' || evt.key == 'down'));
if (focusedObject && moveKey)
{
var x = focusedObject.x,
y = focusedObject.y;
var moveSize = evt.dom.shiftKey ? 1 : 10;
if (evt.key == 'left') focusedObject.moveLeft(moveSize);
if (evt.key == 'right') focusedObject.moveRight(moveSize);
if (evt.key == 'up') focusedObject.moveUp(moveSize);
if (evt.key == 'down') focusedObject.moveDown(moveSize);
}
};
Grid.Canvas.prototype._processKeyAction = function(name, evt)
{
var mode = this.grid.getMode();
if (this._currentAction == null) this.startAction();
try
{
this._currentAction.onKeyEvent(evt);
}
catch(ex)
{
this._currentAction.finalize();
this._currentAction = null;
throw ex;
}
if (this._currentAction.isCompleted())
{
this._currentAction = null;
logger.debug('Action - {mode} completed', { mode: mode });
}
};
Grid.Canvas.prototype._firstObjectInFocusableOrder = function(positions)
{
var firstPosition = null;
for (var i = 0; i < positions.length; i++)
{
var existingPosition = positions[i];
if (firstPosition == null)
{
firstPosition = existingPosition;
}
else if (existingPosition.y < firstPosition.y || (existingPosition.y == firstPosition.y && existingPosition.x < firstPosition.x))
{
firstPosition = existingPosition;
}
}
return firstPosition;
};
Grid.Canvas.prototype._nextObjectInFocusableOrder = function(currentPosition, positions)
{
if (currentPosition == null) return this._firstObjectInFocusableOrder(positions);
var nextPosition = null;
for (var i = 0; i < positions.length; i++)
{
var existingPosition = positions[i];
if (existingPosition.y < currentPosition.y || (existingPosition.y == currentPosition.y && existingPosition.x <= currentPosition.x))
{
continue;
}
if (nextPosition == null)
{
nextPosition = existingPosition;
}
else if (existingPosition.y < nextPosition.y || (existingPosition.y == nextPosition.y && existingPosition.x < nextPosition.x))
{
nextPosition = existingPosition;
}
}
if (nextPosition == null) nextPosition = this._firstObjectInFocusableOrder(positions);
return nextPosition;
};
Grid.Canvas.prototype.reorderImages = function()
{
var imageSorter = function(imageA, imageB)
{
var sizeA = imageA.getSize();
var sizeB = imageB.getSize();
return sizeA > sizeB ? -1 : sizeA < sizeB ? 1 : 0;
};
var images = this.model.getImages();
images.sort(imageSorter);
for (var i = 0; i < images.length; i++)
{
var image = images[i];
this.view.bringToFront(image.getID());
}
};
Grid.Canvas.prototype.subscribeToModelEvents = function()
{
var canvas = this;
var view = this.view;
this.model.subscribe('onAdd', function(entity)
{
entity.createElement(view);
entity.updateElement(view);
if (entity instanceof Grid.Model.Point) canvas.setFocused(entity);
if (entity instanceof Grid.Model.Image) canvas.reorderImages();
});
this.model.subscribe('onDelete', function(entity)
{
canvas.clearHovering();
canvas.clearFocused(entity);
entity.removeElement(view);
});
this.model.subscribe('onMove', function(entity) { entity.moveElement(view); });
this.model.subscribe('onUpdate', function(entity) { entity.updateElement(view); });
};

/* SOURCE FILE: importexport.js (03b45b27) 9/9/2014 2:08:53 PM */

Grid.ImportExport = function(gquestion)
{
var gridquestion = gquestion;
var answerSpaceXml;
this.isStudentResponseValid = function()
{
if (answerSpaceXml == null) return false;
var xmlobject = Grid.ImportExport.parseFromString(answerSpaceXml);
var originalquestion = new Grid.Model();
originalquestion._paletteimages = gridquestion._paletteimages;
var imageLoader = new Grid.ImportExport.ImageLoader();
Grid.ImportExport.loadHotspots(xmlobject, originalquestion, imageLoader);
var presetAnswerList = xmlobject.getElementsByTagName("PreSetAnswerPart");
if ((presetAnswerList) && (presetAnswerList[0]) && (presetAnswerList[0].childNodes[0]))
{
var presetAnswerXml = Grid.ImportExport.serializeToString(presetAnswerList[0]);
this.loadAnswer(presetAnswerXml, originalquestion);
}
if (!pointsEqual(originalquestion.getPoints(), gridquestion.getPoints())) return true;
if (!edgesEqual(originalquestion.getLines(), gridquestion.getLines())) return true;
if (!imagesEqual(originalquestion.getImages(), gridquestion.getImages())) return true;
if (!arrowEqual(originalquestion.getLinesByDir("forward"), gridquestion.getLinesByDir("forward"))) return true;
if (!doubleArrowEqual(originalquestion.getLinesByDir("both"), gridquestion.getLinesByDir("both"))) return true;
var regions = gridquestion.getRegions();
for (var i = 0; i < regions.length; i++)
{
var originalRegion = originalquestion.getRegion(regions[i].name);
if (originalRegion) {
if (regions[i].isSelected() != originalRegion.isSelected()) return true;
}
}
return false;
function pointsEqual(points1, points2)
{
if (points1.length != points2.length) return false;
if (points1.length == 0) return true;
for (var i = 0; i < points1.length; i++)
{
var found = false;
for (var j = 0; j < points2.length; j++)
{
if ((points1[i].x == points2[j].x) && (points1[i].y == points2[j].y)) found = true;
}
if (!found) return false;
}
return true;
}
function edgesEqual(edges1, edges2)
{
if (edges1.length != edges2.length) return false;
if (edges1.length == 0) return true;
for (var i = 0; i < edges1.length; i++)
{
var found = false;
for (var j = 0; j < edges2.length; j++)
{
if (((edges1[i].source.x == edges2[j].source.x) && (edges1[i].source.y == edges2[j].source.y)
&& (edges1[i].target.x == edges2[j].target.x) && (edges1[i].target.y == edges2[j].target.y)) ||
((edges1[i].source.x == edges2[j].target.x) && (edges1[i].source.y == edges2[j].target.y)
&& (edges1[i].target.x == edges2[j].source.x) && (edges1[i].target.y == edges2[j].source.y))
) found = true;
}
if (!found) return false;
}
return true;
}
function imagesEqual(images1, images2)
{
if (images1.length != images2.length) return false;
if (images1.length == 0) return true;
for (var i = 0; i < images1.length; i++)
{
var found = false;
for (var j = 0; j < images2.length; j++)
{
if ((images1[i].name == images2[j].name) && (images1[i].x == images2[j].x)
&& (images1[i].y == images2[j].y)) found = true;
}
if (!found) return false;
}
return true;
}
function arrowEqual(arrows1, arrows2)
{
if (arrows1.length != arrows2.length) return false;
if (arrows1.length == 0) return true;
for (var i = 0; i < arrows1.length; i++)
{
var found = false;
for (var j = 0; j < arrows2.length; j++)
{
if (((arrows1[i].source.x == arrows2[j].source.x) && (arrows1[i].source.y == arrows2[j].source.y)
&& (arrows1[i].target.x == arrows2[j].target.x) && (arrows1[i].target.y == arrows2[j].target.y)))
found = true;
}
if (!found) return false;
}
return true;
}
function doubleArrowEqual(da1, da2)
{
return edgesEqual(da1, da2);
}
};
this.getAnswerXml = function()
{
function getSnapPoints(xmlDoc, QuestionPartNode)
{
var SnapPointNode = xmlDoc.createElement('SnapPoint');
var snapPoints = gridquestion.getSnapPoints();
var str = "";
for (var i = 0; i < snapPoints.length; i++)
{
if (i == 0) str = snapPoints[0].snapRadius + "@";
str += snapPoints[i].x + "," + snapPoints[i].y;
if (i != snapPoints.length - 1) str += ";";
}
var textNode = xmlDoc.createTextNode(str);
SnapPointNode.appendChild(textNode);
QuestionPartNode.appendChild(SnapPointNode);
}
function getTerminatedEdgeObjects(xmlDoc, ObjectSetNode)
{
var arrows = gridquestion.getLinesByDir("forward");
for (var i = 0; i < arrows.length; i++)
{
var tNode = xmlDoc.createElement('TerminatedEdgeObject');
var sourceXY = arrows[i].source.x + ',' + translateCoordinate(arrows[i].source.y);
var targetXY = arrows[i].target.x + ',' + translateCoordinate(arrows[i].target.y);
var str = "(" + sourceXY + "),(" + targetXY + "),Type-1";
var textNode = xmlDoc.createTextNode(str);
tNode.appendChild(textNode);
ObjectSetNode.appendChild(tNode);
}
var doubleArrows = gridquestion.getLinesByDir("both");
for (var i = 0; i < doubleArrows.length; i++)
{
var tNode = xmlDoc.createElement('TerminatedEdgeObject');
var sourceXY = doubleArrows[i].source.x + ',' + translateCoordinate(doubleArrows[i].source.y);
var targetXY = doubleArrows[i].target.x + ',' + translateCoordinate(doubleArrows[i].target.y);
var str = "(" + sourceXY + "),(" + targetXY + "),Type-2";
var textNode = xmlDoc.createTextNode(str);
tNode.appendChild(textNode);
ObjectSetNode.appendChild(tNode);
}
}
function createAtomicObject(xmlDoc, ObjectSetNode)
{
var images = gridquestion.getImages();
for (var i = 0; i < images.length; i++)
{
var AtomicObjectNode = xmlDoc.createElement('AtomicObject');
var pointXY = images[i].x + "," + translateCoordinate(images[i].y);
var str = "{" + images[i].name + "(" + pointXY + ")}";
var TextNode = xmlDoc.createTextNode(str);
AtomicObjectNode.appendChild(TextNode);
ObjectSetNode.appendChild(AtomicObjectNode);
}
}
function createRegionGroupObjects(xmlDoc, ObjectSetNode)
{
var regionGroupsList = gridquestion.getRegionGroups();
for (var i = 0; i < regionGroupsList.length; i++)
{
var regionGroupObj = regionGroupsList[i];
var regionGroupNode = xmlDoc.createElement('RegionGroupObject');
regionGroupNode.setAttribute('name', regionGroupObj.name);
regionGroupNode.setAttribute('numselected', regionGroupObj.getSelectedRegions().length);
var regionsList = regionGroupObj.getRegions();
for (var j = 0; j < regionsList.length; j++)
{
var regionObj = regionsList[j];
var regionNode = xmlDoc.createElement('RegionObject');
regionNode.setAttribute('name', regionObj.name);
regionNode.setAttribute('isselected', regionObj.isSelected().toString());
regionGroupNode.appendChild(regionNode);
}
ObjectSetNode.appendChild(regionGroupNode);
}
}
function createPointObject(xmlDoc, ObjectSetNode, points)
{
if (!(points)) return;
for (var i = 0; i < points.length; i++)
{
var ObjectNode = xmlDoc.createElement('Object');
var PointVectorNode = xmlDoc.createElement('PointVector');
var EdgeVectorNode = xmlDoc.createElement('EdgeVector');
var LabelListNode = xmlDoc.createElement('LabelList');
var ValueListNode = xmlDoc.createElement('ValueList');
var pointStr = "{(" + points[i].x + ',' + translateCoordinate(points[i].y) + ")}";
var PointTextNode = xmlDoc.createTextNode(pointStr);
PointVectorNode.appendChild(PointTextNode);
var edgeStr = " {} ";
var EdgeTextNode = xmlDoc.createTextNode(edgeStr);
EdgeVectorNode.appendChild(EdgeTextNode);
var labelStr = " {} ";
var LabelTextNode = xmlDoc.createTextNode(labelStr);
LabelListNode.appendChild(LabelTextNode);
var valueStr = " {} ";
var ValueTextNode = xmlDoc.createTextNode(valueStr);
ValueListNode.appendChild(ValueTextNode);
ObjectNode.appendChild(PointVectorNode);
ObjectNode.appendChild(EdgeVectorNode);
ObjectNode.appendChild(LabelListNode);
ObjectNode.appendChild(ValueListNode);
ObjectSetNode.appendChild(ObjectNode);
}
}
function createConnectedLinesObj(xmlDoc, ObjectSetNode, thisWorkingLines)
{
var ObjectNode = xmlDoc.createElement('Object');
var PointVectorNode = xmlDoc.createElement('PointVector');
var EdgeVectorNode = xmlDoc.createElement('EdgeVector');
var LabelListNode = xmlDoc.createElement('LabelList');
var ValueListNode = xmlDoc.createElement('ValueList');
var pointsStr = "{";
var linesStr = "{";
var previousLeftPoint = "";
var linePoints = [];
for (var i = 0; i < thisWorkingLines.length; i++)
{
var sourceXY = thisWorkingLines[i].source.x + ',' + translateCoordinate(thisWorkingLines[i].source.y);
var targetXY = thisWorkingLines[i].target.x + ',' + translateCoordinate(thisWorkingLines[i].target.y);
linesStr += " {(" + sourceXY + '),(' + targetXY + ")}";
if (i == 0)
{
linePoints.push(sourceXY);
linePoints.push(targetXY);
} else
{
if (!findExistingItem(linePoints, sourceXY)) linePoints.push(sourceXY);
if (!findExistingItem(linePoints, targetXY)) linePoints.push(targetXY);
}
}
for (var i = 0; i < linePoints.length; i++)
{
pointsStr += "(" + linePoints[i] + ")";
}
pointsStr += "}";
var PointVectorTextNode = xmlDoc.createTextNode(pointsStr);
PointVectorNode.appendChild(PointVectorTextNode);
linesStr += "}";
var EdgeVectorTextNode = xmlDoc.createTextNode(linesStr);
EdgeVectorNode.appendChild(EdgeVectorTextNode);
var labelStr = " {} ";
var LabelTextNode = xmlDoc.createTextNode(labelStr);
LabelListNode.appendChild(LabelTextNode);
var valueStr = " {} ";
var ValueTextNode = xmlDoc.createTextNode(valueStr);
ValueListNode.appendChild(ValueTextNode);
ObjectNode.appendChild(PointVectorNode);
ObjectNode.appendChild(EdgeVectorNode);
ObjectNode.appendChild(LabelListNode);
ObjectNode.appendChild(ValueListNode);
ObjectSetNode.appendChild(ObjectNode);
}
function findExistingItem(array, item)
{
for (var i = 0; i < array.length; i++)
{
if (item == array[i]) return true;
}
return false;
}
function addLinePointsToQueue(pointQueue, line)
{
var rtnPointQueue = pointQueue;
if (!pointExistsInQueue(pointQueue, line.source)) rtnPointQueue.push(line.source);
if (!pointExistsInQueue(pointQueue, line.target)) rtnPointQueue.push(line.target);
return rtnPointQueue;
}
function pointExistsInQueue(pointQueue, point)
{
for (var i = 0; i < pointQueue.length; i++)
{
if (point == pointQueue[i]) return true;
}
return false;
}
function getNewLinesConnectedToPoint(remainingLines, workingLines, pointQueue, point)
{
var newLines = [];
for (var i = 0; i < remainingLines.length; i++)
{
if ((remainingLines[i].source == point) || (remainingLines[i].target == point))
{
var found = false;
for (var j = 0; j < workingLines.length; j++)
{
if (workingLines[j] == remainingLines[i])
{
found = true;
break;
}
}
if (!found) newLines.push(remainingLines[i]);
}
}
return newLines;
}
function getRemainingLines(remainingLines, thisWorkingLines)
{
var rLines = [];
for (var i = 0; i < remainingLines.length; i++)
{
var found = false;
for (var j = 0; j < thisWorkingLines.length; j++)
{
if (remainingLines[i] == thisWorkingLines[j])
{
found = true;
break;
}
}
if (!found) rLines.push(remainingLines[i]);
}
return rLines;
}
function identifyObjects(xmlDoc, ObjectSetNode)
{
var lines = gridquestion.getLinesByDir("none");
var points = gridquestion.getPoints();
var remainingLines = gridquestion.getLinesByDir("none");
while (remainingLines.length > 0)
{
var thisWorkingLines = [];
var thisPointQueue = [];
thisWorkingLines.push(remainingLines[0]);
var newQueue = addLinePointsToQueue(thisPointQueue, remainingLines[0]);
thisPointQueue = newQueue;
while ((thisPointQueue) && (thisPointQueue.length > 0))
{
var newPoint = thisPointQueue.shift();
var newLines = getNewLinesConnectedToPoint(remainingLines, thisWorkingLines, thisPointQueue, newPoint);
if (newLines)
{
for (var i = 0; i < newLines.length; i++)
{
thisWorkingLines.push(newLines[i]);
addLinePointsToQueue(thisPointQueue, newLines[i]);
}
}
}
var rLines = getRemainingLines(remainingLines, thisWorkingLines);
remainingLines = rLines;
if (thisWorkingLines.length > 0)
{
createConnectedLinesObj(xmlDoc, ObjectSetNode, thisWorkingLines);
}
}
var iPoints = getIsolatedPoints();
if (iPoints.length > 0) createPointObject(xmlDoc, ObjectSetNode, iPoints);
createAtomicObject(xmlDoc, ObjectSetNode);
createRegionGroupObjects(xmlDoc, ObjectSetNode);
}
function getIsolatedPoints()
{
var lines = gridquestion.getLines();
var points = gridquestion.getPoints();
var iPoints = [];
for (var i = 0; i < points.length; i++)
{
var found = false;
for (var j = 0; j < lines.length; j++)
{
if ((points[i] == lines[j].source) || (points[i] == lines[j].target))
{
found = true;
break;
}
}
if (!found) iPoints.push(points[i]);
}
return iPoints;
}
function getIndent(depth)
{
var str = "";
for (var i = 0; i < depth * 3; i++)
{
str += " ";
}
return str;
}
function getIndentedText(xNode, depth)
{
var alignedText = '';
if (xNode.nodeType == 3)
{
if (xNode.nodeValue)
return (alignedText + xNode.nodeValue);
else
return (alignedText);
}
alignedText = getIndent(depth) + '<' + xNode.nodeName + '>';
var length = alignedText.length;
for (var i = 0; i < xNode.childNodes.length; i++)
{
if (xNode.childNodes[i].nodeType == 3)
alignedText += getIndentedText(xNode.childNodes[i], depth + 1);
else
alignedText += '\n' + getIndentedText(xNode.childNodes[i], depth + 1);
}
var trimedText = alignedText.replace(/^\s+|\s+$/g, "");
if ((trimedText.charAt(trimedText.length - 1) == '}') || (xNode.nodeName == 'TerminatedEdgeObject') || (alignedText.length == length))
{
return (alignedText + '</' + xNode.nodeName + '>');
} else
{
return (alignedText + '\n' + getIndent(depth) + '</' + xNode.nodeName + '>');
}
}
var xmlDoc = Grid.ImportExport.parseFromString("<root></root>");
var AnswerSetNode = xmlDoc.createElement('AnswerSet');
var QuestionNode = xmlDoc.createElement('Question');
QuestionNode.setAttribute('id', gridquestion.id);
AnswerSetNode.appendChild(QuestionNode);
var QuestionPartNode = xmlDoc.createElement('QuestionPart');
QuestionPartNode.setAttribute('id', 1);
QuestionNode.appendChild(QuestionPartNode);
var ObjectSetNode = xmlDoc.createElement('ObjectSet');
QuestionPartNode.appendChild(ObjectSetNode);
identifyObjects(xmlDoc, ObjectSetNode);
var TerminatedEdgeObjectNode = xmlDoc.createElement('TerminatedEdgeObject');
getTerminatedEdgeObjects(xmlDoc, ObjectSetNode);
getSnapPoints(xmlDoc, QuestionPartNode);
Grid.ImportExport.writeShapes(QuestionPartNode, gridquestion);
var header = '<?xml version="1.0" encoding="UTF-8"?>';
if (typeof XMLSerializer != 'undefined')
{
var serializer = new XMLSerializer();
var answerXml = serializer.serializeToString(AnswerSetNode);
return (header + answerXml);
}
else if (AnswerSetNode.xml)
{
return (header + AnswerSetNode.xml);
}
else
{
throw Error('This browser does not support serializing XML nodes');
}
};
var parseImageFiles = function(questionXml)
{
var getTextContent = function(node)
{
if (node && node.childNodes && node.childNodes.length)
return node.childNodes[0].nodeValue;
return null;
};
var imageFiles = [];
var xmlDoc = Grid.ImportExport.parseFromString(questionXml);
var imageNodes = xmlDoc.getElementsByTagName('FileSpec');
Grid.ImportExport.eachNode(imageNodes, function(imageNode)
{
var imageFile = getTextContent(imageNode);
if (imageFiles.indexOf(imageFile) == -1) imageFiles.push(imageFile);
});
imageNodes = xmlDoc.getElementsByTagName('Image');
Grid.ImportExport.eachNode(imageNodes, function(imageNode)
{
var imageFile = imageNode.getAttribute('src');
if (imageFiles.indexOf(imageFile) == -1) imageFiles.push(imageFile);
});
return imageFiles;
};
this.loadItem = function(questionXml, callbackCreated, callbackFailure)
{
var imageFiles = parseImageFiles(questionXml);
var imageLoader = new Grid.ImportExport.ImageLoader();
if (imageFiles.length == 0)
{
this.loadItem2(questionXml, callbackCreated, imageLoader);
return;
}
for (var i = 0; i < imageFiles.length; i++)
{
var url = Grid.ImportExport.resolveUrl(imageFiles[i]);
imageLoader.addImage(url);
}
var self = this;
imageLoader.load(function()
{
var imageErrors = imageLoader.getErrors();
if (imageErrors.length == 0)
{
self.loadItem2.call(self, questionXml, callbackCreated, imageLoader);
}
else
{
callbackFailure('Error loading DOM images', imageErrors);
}
});
};
this.loadItem2 = function(questionXml, callback, imageLoader)
{
answerSpaceXml = questionXml;
function removeQuotes(str)
{
var first = str.indexOf('"');
if (first == -1) return str;
str = str.substring(first + 1);
var second = str.lastIndexOf('"');
if (second == -1) return str;
return str.substring(0, second);
}
function addBackgroundImage(bkgNode)
{
var node = bkgNode.firstChild;
var fileSpec = "";
var position = "";
while (node)
{
if (node.nodeName == "FileSpec")
{
fileSpec = removeQuotes(node.childNodes[0].nodeValue);
}
else if (node.nodeName == "Position")
{
position = removeQuotes(node.childNodes[0].nodeValue);
}
if ((fileSpec != "") && (position != ""))
{
var xy = position.split(',');
var url = Grid.ImportExport.resolveUrl(fileSpec);
var htmlImage = imageLoader.getImage(url);
if (htmlImage != null)
{
gridquestion.addBackgroundImage(htmlImage.src, xy[0] * 1, xy[1] * 1, htmlImage.width, htmlImage.height);
}
return;
}
node = node.nextSibling;
}
}
function addPalleteImage(palleteNode)
{
var node = palleteNode.firstChild;
var labelName = "";
var fileName = "";
while (node)
{
if (node.nodeName == "FileSpec")
{
fileName = removeQuotes(node.childNodes[0].nodeValue);
}
else if (node.nodeName == "Label")
{
labelName = removeQuotes(node.childNodes[0].nodeValue);
labelName = YAHOO.lang.trim(labelName);
}
if ((fileName != "") && (labelName != ""))
{
var url = Grid.ImportExport.resolveUrl(fileName);
var htmlImage = imageLoader.getImage(url);
if (htmlImage != null)
{
gridquestion.addPaletteImage(labelName, htmlImage.src, htmlImage.width, htmlImage.height);
}
return;
}
node = node.nextSibling;
}
}
gridquestion.clearQuestion();
var xmlobject = Grid.ImportExport.parseFromString(questionXml);
Grid.ImportExport.loadOptions(xmlobject, gridquestion);
var backgroundImageList = xmlobject.getElementsByTagName("ImageSpec");
if ((backgroundImageList) && (backgroundImageList[0]) && (backgroundImageList[0].childNodes[0]))
{
for (var i = 0; i < backgroundImageList.length; i++)
{
addBackgroundImage(backgroundImageList[i]);
}
}
var palleteImageList = xmlobject.getElementsByTagName("IconSpec");
if ((palleteImageList) && (palleteImageList[0]) && (palleteImageList[0].childNodes[0]))
{
for (var i = 0; i < palleteImageList.length; i++)
{
addPalleteImage(palleteImageList[i]);
}
}
Grid.ImportExport.loadHotspots(xmlobject, gridquestion, imageLoader);
var presetAnswerList = xmlobject.getElementsByTagName("PreSetAnswerPart");
if ((presetAnswerList) && (presetAnswerList[0]) && (presetAnswerList[0].childNodes[0]))
{
this.loadAnswer(Grid.ImportExport.serializeToString(presetAnswerList[0]));
}
if (gridquestion.getPaletteImages().length > 0 &&
gridquestion.getPoints().length == 0 &&
gridquestion.getImages().length == 0) {
gridquestion.options.showPalette = true;
} else {
gridquestion.options.showPalette = false;
}
if (typeof callback == 'function') callback();
};
this.loadAnswer = function(response, gridq)
{
function addSnapPoint(snapPoint, gridq)
{
if (snapPoint.childNodes.length == 0) return;
var snapStr = snapPoint.childNodes[0].nodeValue;
var first = snapStr.indexOf("@");
var snapRadius = parseInt(snapStr.substring(0, first));
snapStr = snapStr.substring(first + 1) + ";";
var index = snapStr.indexOf(";");
while (index != -1)
{
var pntStr = snapStr.substring(0, index);
var indexComma = pntStr.indexOf(",");
var x = parseInt(pntStr.substring(0, indexComma));
var y = parseInt(pntStr.substring(indexComma + 1));
if (gridq == null) gridquestion.addSnapPoint(x, y, snapRadius);
else gridq.addSnapPoint(x, y, snapRadius);
snapStr = snapStr.substring(index + 1);
index = snapStr.indexOf(";");
}
}
function addAtomicObj(obj, gridq)
{
var atomicStr = obj.childNodes[0].nodeValue;
var first = atomicStr.indexOf("{");
var second = atomicStr.indexOf("(");
var third = atomicStr.indexOf(")");
var labelName = atomicStr.substring(first + 1, second);
var pntStr = atomicStr.substring(second + 1, third);
var indexComma = pntStr.indexOf(",");
var x = parseInt(pntStr.substring(0, indexComma));
var y = parseInt(pntStr.substring(indexComma + 1));
if (gridq == null)
gridquestion.addImage(YAHOO.lang.trim(labelName), x, translateCoordinate(y));
else
gridq.addImage(YAHOO.lang.trim(labelName), x, translateCoordinate(y));
}
function addTerminatedEdgeObj(obj, gridq)
{
var arrowStr = obj.childNodes[0].nodeValue;
var index = arrowStr.indexOf(",Type-");
var type = arrowStr.substring(index + 6);
var dirType = "both";
if (type == "1") dirType = "forward";
parseSingleLine(arrowStr.substring(0, index), dirType, gridq);
}
function addObj(obj, gridq)
{
var node = obj.firstChild;
while (node)
{
if (node.nodeName == "PointVector")
{
parsePointVectorString(node.childNodes[0].nodeValue, gridq);
}
else if (node.nodeName == "EdgeVector")
{
parseEdgeVectorString(node.childNodes[0].nodeValue, gridq);
}
node = node.nextSibling;
}
}
function parsePointVectorString(pointsStr, gridq)
{
var indexLeft = pointsStr.indexOf("(");
var indexRight = pointsStr.indexOf(")");
while ((indexLeft != -1) && (indexRight != -1))
{
var pntStr = pointsStr.substring(indexLeft + 1, indexRight);
pointsStr = pointsStr.substring(indexRight + 1);
var indexComma = pntStr.indexOf(",");
var x = parseInt(pntStr.substring(0, indexComma));
var y = parseInt(pntStr.substring(indexComma + 1));
if (gridq == null)
gridquestion.addPoint(x, translateCoordinate(y));
else
{
gridq.addPoint(x, translateCoordinate(y));
}
indexLeft = pointsStr.indexOf("(");
indexRight = pointsStr.indexOf(")");
}
}
function parseEdgeVectorString(edgesStr, gridq)
{
var firstLeft = edgesStr.indexOf("{");
var lastRight = edgesStr.lastIndexOf("}");
edgesStr = edgesStr.substring(firstLeft + 1, lastRight);
var indexLeft = edgesStr.indexOf("{");
var indexRight = edgesStr.indexOf("}");
while ((indexLeft != -1) && (indexRight != -1))
{
var eStr = edgesStr.substring(indexLeft + 1, indexRight);
parseSingleLine(eStr, "none", gridq);
edgesStr = edgesStr.substring(indexRight + 1);
indexLeft = edgesStr.indexOf("{");
indexRight = edgesStr.indexOf("}");
}
}
function parseSingleLine(eStr, dirType, gridq)
{
var indexLeft = eStr.indexOf("(");
var indexRight = eStr.indexOf(")");
var pntStr = eStr.substring(indexLeft + 1, indexRight);
var indexComma = pntStr.indexOf(",");
var x = parseInt(pntStr.substring(0, indexComma));
var y = parseInt(pntStr.substring(indexComma + 1));
var point1;
if (gridq == null)
{
if (dirType != "none")
point1 = gridquestion.addPoint(x, translateCoordinate(y));
else
point1 = getExistingPoint(x, translateCoordinate(y), gridq);
} else
{
if (dirType != "none")
point1 = gridq.addPoint(x, translateCoordinate(y));
else
point1 = getExistingPoint(x, translateCoordinate(y), gridq);
}
pntStr = eStr.substring(indexRight + 1);
indexLeft = pntStr.indexOf("(");
indexRight = pntStr.indexOf(")");
pntStr = pntStr.substring(indexLeft + 1, indexRight);
indexComma = pntStr.indexOf(",");
x = parseInt(pntStr.substring(0, indexComma));
y = parseInt(pntStr.substring(indexComma + 1));
var point2;
if (gridq == null)
{
if (dirType != "none")
point2 = gridquestion.addPoint(x, translateCoordinate(y));
else
point2 = getExistingPoint(x, translateCoordinate(y), gridq);
if ((point1) && (point2))
{
gridquestion.addLine(point1, point2, dirType);
}
}
else
{
if (dirType != "none")
point2 = gridq.addPoint(x, translateCoordinate(y));
else
point2 = getExistingPoint(x, translateCoordinate(y), gridq);
if ((point1) && (point2))
{
gridq.addLine(point1, point2, dirType);
}
}
}
function getExistingPoint(x, y, gridq)
{
var points;
if (gridq == null)
points = gridquestion.getPoints();
else
points = gridq.getPoints();
for (var i = 0; i < points.length; i++)
{
if ((points[i].x == x) && (points[i].y == y))
return points[i];
}
return null;
}
if (gridq == null) gridquestion.clearResponse();
else gridq.clearResponse();
var xmlobject = Grid.ImportExport.parseFromString(response);
var objectList = xmlobject.getElementsByTagName("Object");
if ((objectList) && (objectList[0]) && (objectList[0].childNodes[0]))
{
for (var i = 0; i < objectList.length; i++)
{
addObj(objectList[i], gridq);
}
}
var atomicObjList = xmlobject.getElementsByTagName("AtomicObject");
if ((atomicObjList) && (atomicObjList[0]) && (atomicObjList[0].childNodes[0]))
{
for (var i = 0; i < atomicObjList.length; i++)
{
addAtomicObj(atomicObjList[i], gridq);
}
}
var terminatedEdgeList = xmlobject.getElementsByTagName("TerminatedEdgeObject");
if ((terminatedEdgeList) && (terminatedEdgeList[0]) && (terminatedEdgeList[0].childNodes[0]))
{
for (var i = 0; i < terminatedEdgeList.length; i++)
{
addTerminatedEdgeObj(terminatedEdgeList[i], gridq);
}
}
var snapPointList = xmlobject.getElementsByTagName("SnapPoint");
if ((snapPointList) && (snapPointList[0]) && (snapPointList[0].childNodes[0]))
{
for (var i = 0; i < snapPointList.length; i++)
{
addSnapPoint(snapPointList[i], gridq);
}
}
var model = ((gridq != null) ? gridq : gridquestion);
Grid.ImportExport.loadRegionGroupObjects(xmlobject, model);
Grid.ImportExport.loadShapes(xmlobject, model);
if (gridq == null) gridquestion.importing = true;
};
function translateCoordinate(y)
{
return (gridquestion.options.canvasHeight - y);
}
};
Grid.ImportExport.parseFromString = function(text)
{
if (typeof text != 'string') {
return text;
}
var xmlDoc;
if (window.DOMParser) {
xmlDoc = (new window.DOMParser()).parseFromString(text, "text/xml");
} else {
xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
xmlDoc.async = "false";
xmlDoc.validateOnParse = "false";
xmlDoc.loadXML(text);
}
var errorMsg = null;
if (xmlDoc.parseError && xmlDoc.parseError.errorCode != 0) {
errorMsg = "XML Parsing Error: " + xmlDoc.parseError.reason
+ " at line " + xmlDoc.parseError.line
+ " at position " + xmlDoc.parseError.linepos;
} else {
if (xmlDoc.documentElement) {
if (xmlDoc.documentElement.nodeName == "parsererror") {
errorMsg = xmlDoc.documentElement.childNodes[0].nodeValue;
}
} else {
errorMsg = "XML Parsing Error";
}
}
if (errorMsg) {
throw new Error(errorMsg);
}
return xmlDoc;
};
Grid.ImportExport.serializeToString = function(node)
{
return node.xml || (new XMLSerializer()).serializeToString(node);
};
Grid.ImportExport.eachNode = function(nodeList, func)
{
var nodes = [];
for (var i = 0; i < nodeList.length; i++)
{
var node = nodeList[i] || nodeList.item(i);
nodes.push(node);
}
YAHOO.util.Dom.batch(nodes, func);
};
Grid.ImportExport.resolveUrl = function(url)
{
url = url.replace(/&amp;/g, '&');
url = url.split('&').join('&amp;').split('<').join('&lt;').split('"').join('&quot;');
var el = document.createElement('div');
el.innerHTML = '<a href="' + url + '">x</a>';
return el.firstChild.href;
};
Grid.ImportExport.getFilename = function(path)
{
return path.substr(path.lastIndexOf('/') + 1);
};
Grid.ImportExport.ImageLoader = function()
{
this._requests = [];
this._completedCount = 0;
this._completedCallback = null;
this.getRequests = function() { return this._requests; };
this.addImage = function(url, callback, label)
{
var request = { url: url, callback: callback, image: null, label: label };
this._requests.push(request);
};
this.getImage = function(url)
{
for (var i = 0; i < this._requests.length; i++)
{
var request = this._requests[i];
if (request.url == url) return request.image;
}
return null;
};
this.isCompleted = function()
{
return (this._completedCount == this._requests.length);
};
this.getErrors = function()
{
var imageErrors = [];
for (var i = 0; i < this._requests.length; i++)
{
var request = this._requests[i];
if (request.image.state != 1)
{
imageErrors.push(request.image);
}
}
return imageErrors;
};
this.load = function(callback)
{
this._completedCallback = callback;
for (var i = 0; i < this._requests.length; i++)
{
var request = this._requests[i];
this._requestImage(request);
}
};
this._requestImage = function(request)
{
var self = this;
request.image = new Image();
request.image.state = 0;
request.image.name = request.label;
var completed = function()
{
if (typeof (request.callback) == 'function')
{
request.callback(request.image);
}
self._requestCompleted();
};
request.image.onload = function()
{
request.image.state = 1;
completed();
};
request.image.onerror = function()
{
request.image.state = -1;
completed();
};
request.image.onabort = function()
{
request.image.state = -1;
completed();
};
request.image.src = request.url;
};
this._requestCompleted = function()
{
this._completedCount++;
if (this._completedCount == this._requests.length && typeof (this._completedCallback) == 'function')
{
var images = [];
for (var i = 0; i < this._requests.length; i++)
{
images.push(this._requests[i].image);
}
this._completedCallback(images);
}
};
};
String.prototype.startsWith = function(str)
{return (this.match("^"+str)==str);
};

/* SOURCE FILE: importexport.options.js (0a545402) 9/9/2014 2:08:53 PM */

Grid.ImportExport.removeQuotes = function(str) {
var first = str.indexOf('"');
if (first == -1) return str;
str = str.substring(first + 1);
var second = str.lastIndexOf('"');
if (second == -1) return str;
return str.substring(0, second);
};
Grid.ImportExport.hasElementValue = function(xml, id) {
var el = xml.getElementsByTagName(id);
return (el && el[0] && el[0].childNodes[0]);
};
Grid.ImportExport.getElementString = function(xml, id) {
var el = xml.getElementsByTagName(id);
if (el && el[0] && el[0].childNodes[0]) {
return this.removeQuotes(el[0].childNodes[0].nodeValue);
}
return null;
};
Grid.ImportExport.getElementBool = function(xml, id) {
var value = Grid.ImportExport.getElementString(xml, id);
return (value && value === 'true');
};
Grid.ImportExport.getElementInt = function(xml, id) {
var value = Grid.ImportExport.getElementString(xml, id);
return (value) ? parseInt(value) : 0;
};
Grid.ImportExport.loadOptions = function(gridXml, model) {
var options = model.options;
if (this.hasElementValue(gridXml, 'UpdateLayout')) {
options.updateLayout = this.getElementBool(gridXml, 'UpdateLayout');
}
if (this.hasElementValue(gridXml, 'ContainerPaddingTop')) {
options.containerPaddingTop = this.getElementInt(gridXml, 'ContainerPaddingTop');
}
if (this.hasElementValue(gridXml, 'ContainerPaddingRight')) {
options.containerPaddingRight = this.getElementInt(gridXml, 'ContainerPaddingRight');
}
if (this.hasElementValue(gridXml, 'ContainerPaddingBottom')) {
options.containerPaddingBottom = this.getElementInt(gridXml, 'ContainerPaddingBottom');
}
if (this.hasElementValue(gridXml, 'ContainerPaddingLeft')) {
options.containerPaddingLeft = this.getElementInt(gridXml, 'ContainerPaddingLeft');
}
if (this.hasElementValue(gridXml, 'PaletteWidth')) {
options.paletteWidth = this.getElementInt(gridXml, 'PaletteWidth');
}
if (this.hasElementValue(gridXml, 'PaletteGutter')) {
options.paletteGutter = this.getElementInt(gridXml, 'PaletteGutter');
}
var centerImageNode = gridXml.getElementsByTagName("CenterImage");
if ((centerImageNode) && (centerImageNode[0]) && (centerImageNode[0].childNodes[0])) {
options.paletteCenter = (centerImageNode[0].childNodes[0].nodeValue == 'true') ? true : false;
}
var scaleImageNode = gridXml.getElementsByTagName("ScaleImage");
if ((scaleImageNode) && (scaleImageNode[0]) && (scaleImageNode[0].childNodes[0])) {
options.paletteScale = (scaleImageNode[0].childNodes[0].nodeValue == 'true') ? true : false;
}
if (this.hasElementValue(gridXml, 'ShowToolbar')) {
options.showToolbar = this.getElementBool(gridXml, 'ShowToolbar');
}
if (this.hasElementValue(gridXml, 'ToolbarHeight')) {
options.toolbarHeight = this.getElementInt(gridXml, 'ToolbarHeight');
}
if (this.hasElementValue(gridXml, 'ToolbarGutter')) {
options.toolbarGutter = this.getElementInt(gridXml, 'ToolbarGutter');
}
var buttonNode = gridXml.getElementsByTagName("ShowButtons");
if ((buttonNode) && (buttonNode[0]) && (buttonNode[0].childNodes[0]) && (buttonNode[0].childNodes[0].nodeValue)) {
var buttons = this.removeQuotes(buttonNode[0].childNodes[0].nodeValue).split(",");
for (var i = 0; i < buttons.length; i++) {
options.addButton(buttons[i]);
}
}
if (this.hasElementValue(gridXml, 'CanvasWidth')) {
options.canvasWidth = this.getElementInt(gridXml, 'CanvasWidth');
}
if (this.hasElementValue(gridXml, 'CanvasWidthExt')) {
options.canvasWidthExt = this.getElementInt(gridXml, 'CanvasWidthExt');
}
if (this.hasElementValue(gridXml, 'CanvasHeight')) {
options.canvasHeight = this.getElementInt(gridXml, 'CanvasHeight');
}
if (this.hasElementValue(gridXml, 'CanvasHeightExt')) {
options.canvasHeightExt = this.getElementInt(gridXml, 'CanvasHeightExt');
}
if (this.hasElementValue(gridXml, 'CanvasBorderOffset')) {
options.canvasBorderOffset = this.getElementInt(gridXml, 'CanvasBorderOffset');
}
if (this.hasElementValue(gridXml, 'ProperLineGeometry')) {
options.properLineGeometry = this.getElementBool(gridXml, 'ProperLineGeometry');
}
var selectionToleranceNode = gridXml.getElementsByTagName("SelectionTolerance");
if ((selectionToleranceNode) && (selectionToleranceNode[0]) && (selectionToleranceNode[0].childNodes[0])) {
options.selectionTolerance = parseInt(this.removeQuotes(selectionToleranceNode[0].childNodes[0].nodeValue));
}
var gridSpacingNode = gridXml.getElementsByTagName("GridSpacing");
if ((gridSpacingNode) && (gridSpacingNode[0]) && (gridSpacingNode[0].childNodes[0])) {
var spacingStr = gridSpacingNode[0].childNodes[0].nodeValue;
spacingStr = this.removeQuotes(spacingStr.replace(/^\s+|\s+$/g, ""));
var strSplit = spacingStr.split(",");
options.gridSpacing = parseInt(strSplit[0].replace(/^\s+|\s+$/g, ""));
if (strSplit[1].replace(/^\s+|\s+$/g, "") == "Y") options.snapToGrid = true;
else options.snapToGrid = false;
}
var gridColorNode = gridXml.getElementsByTagName("GridColor");
if ((gridColorNode) && (gridColorNode[0]) && (gridColorNode[0].childNodes[0])) {
options.gridColor = this.removeQuotes(gridColorNode[0].childNodes[0].nodeValue);
options.showGridLines = (options.gridColor != 'None');
}
if (this.hasElementValue(gridXml, 'ShowFeedback')) {
options.showFeedback = this.getElementBool(gridXml, 'ShowFeedback');
}
if (this.hasElementValue(gridXml, 'FeedbackHeight')) {
options.feedbackHeight = this.getElementInt(gridXml, 'FeedbackHeight');
}
if (this.hasElementValue(gridXml, 'FeedbackGutter')) {
options.feedbackGutter = this.getElementInt(gridXml, 'FeedbackGutter');
}
};

/* SOURCE FILE: importexport.hotspot.js (80746697) 9/9/2014 2:08:53 PM */

Grid.ImportExport.parseRegion = function(regionNode)
{
var region =
{
name: regionNode.getAttribute('name'),
shape: regionNode.getAttribute('shape'),
coords: regionNode.getAttribute('coords'),
events: []
};
var eventNodes = regionNode.getElementsByTagName('Event');
Grid.ImportExport.eachNode(eventNodes, function(eventNode)
{
var regionEvent =
{
name: eventNode.getAttribute('name'),
styles: {},
image: null,
label: null
};
var stylesNode = eventNode.getElementsByTagName('Styles');
if (stylesNode.length == 1)
{
Grid.ImportExport.eachNode(stylesNode[0].attributes, function(styleAttrib)
{
regionEvent.styles[styleAttrib.name] = styleAttrib.value;
});
}
var imageNode = eventNode.getElementsByTagName('Image');
if (imageNode.length == 1)
{
imageNode = imageNode[0];
regionEvent.image =
{
src: imageNode.getAttribute('src'),
x: imageNode.getAttribute('x') * 1,
y: imageNode.getAttribute('y') * 1
};
}
var labelNode = eventNode.getElementsByTagName('Label');
if (labelNode.length == 1)
{
labelNode = labelNode[0];
regionEvent.label =
{
text: labelNode.getAttribute('text'),
x: labelNode.getAttribute('x') * 1,
y: labelNode.getAttribute('y') * 1
};
}
region.events.push(regionEvent);
});
return region;
};
Grid.ImportExport.parseRegionGroup = function(regionGroupNode)
{
var regionGroup =
{
name: regionGroupNode.getAttribute('name'),
min: regionGroupNode.getAttribute('min') * 1,
max: regionGroupNode.getAttribute('max') * 1,
includes: []
};
var regionNodes = regionGroupNode.getElementsByTagName('Region');
Grid.ImportExport.eachNode(regionNodes, function(regionNode)
{
var regionName = regionNode.getAttribute('name');
regionGroup.includes.push(regionName);
});
var includeNodes = regionGroupNode.getElementsByTagName('Include');
Grid.ImportExport.eachNode(includeNodes, function(includeNode)
{
var regionName = includeNode.getAttribute('region');
regionGroup.includes.push(regionName);
});
return regionGroup;
};
Grid.ImportExport.loadHotspots = function(xmlobject, model, imageLoader)
{
var hotspots = { regions: [], groups: [] };
var regionNodes = xmlobject.getElementsByTagName("Region");
Grid.ImportExport.eachNode(regionNodes, function(regionNode)
{
var regionJson = Grid.ImportExport.parseRegion(regionNode);
hotspots.regions.push(regionJson);
});
var regionGroupNodes = xmlobject.getElementsByTagName("RegionGroup");
Grid.ImportExport.eachNode(regionGroupNodes, function(regionGroupNode)
{
var groupJson = Grid.ImportExport.parseRegionGroup(regionGroupNode);
hotspots.groups.push(groupJson);
});
Grid.ImportExport.eachNode(hotspots.regions, function(regionJson)
{
var region = model.createRegion(regionJson.name, regionJson.shape, regionJson.coords);
if (region == null) return;
Grid.ImportExport.eachNode(regionJson.events, function(eventJson)
{
var event = region.createEvent(eventJson.name);
event.setStyles(eventJson.styles);
if (eventJson.label != null)
{
event.setLabel(eventJson.label.x, eventJson.label.y, eventJson.label.text);
}
if (eventJson.image != null)
{
var url = Grid.ImportExport.resolveUrl(eventJson.image.src);
var htmlImage = imageLoader.getImage(url);
if (htmlImage != null)
{
event.setImage(url, eventJson.image.x, eventJson.image.y, htmlImage.width, htmlImage.height);
}
}
});
region.update();
});
Grid.ImportExport.eachNode(hotspots.groups, function(groupJson)
{
var regionGroup = model.createRegionGroup(groupJson.name, groupJson.min, groupJson.max);
for (var i = 0; i < groupJson.includes.length; i++)
{
var region = model.getRegion(groupJson.includes[i]);
if (region != null) regionGroup.addRegion(region);
}
});
};
Grid.ImportExport.parseRegionGroupObjects = function(xmlobject)
{
var regionObjects = [];
var regionObjNodes = xmlobject.getElementsByTagName("RegionObject");
Grid.ImportExport.eachNode(regionObjNodes, function(regionObjNode)
{
var regionObject =
{
name: regionObjNode.getAttribute('name'),
selected: (regionObjNode.getAttribute('isselected') == 'true')
};
regionObjects.push(regionObject);
});
return regionObjects;
};
Grid.ImportExport.loadRegionGroupObjects = function(xmlobject, model)
{
var regionObjects = Grid.ImportExport.parseRegionGroupObjects(xmlobject);
for (var i = 0; i < regionObjects.length; i++)
{
var regionObject = regionObjects[i];
var region = model.getRegion(regionObject.name);
if (region != null)
{
if (regionObject.selected) region.select();
else region.deselect();
}
}
};
Grid.ImportExport.getRegionGroupsXmlString = function(model)
{
var xmlDoc = Grid.ImportExport.getRegionGroupsXmlDoc(model);
return Grid.ImportExport.serializeToString(xmlDoc);
};
Grid.ImportExport.getRegionGroupsXmlDoc = function(model)
{
var xmlDoc = Grid.ImportExport.parseFromString('<HotSpots></HotSpots>');
var appendEvent = function(event, parentNode)
{
var eventNode = xmlDoc.createElement('Event');
eventNode.setAttribute('name', event.name);
var styles = event.getStyles();
var stylesNode = xmlDoc.createElement('Styles');
for (var styleName in styles)
{
var styleValue = styles[styleName];
stylesNode.setAttribute(styleName, styleValue);
}
eventNode.appendChild(stylesNode);
var image = event.getImage();
if (image != null)
{
var imageNode = xmlDoc.createElement('Image');
imageNode.setAttribute('src', image.url);
imageNode.setAttribute('x', image.x);
imageNode.setAttribute('y', image.y);
eventNode.appendChild(imageNode);
}
var label = event.getLabel();
if (label != null)
{
var labelNode = xmlDoc.createElement('Label');
labelNode.setAttribute('text', label.text);
labelNode.setAttribute('x', label.x);
labelNode.setAttribute('y', label.y);
eventNode.appendChild(labelNode);
}
parentNode.appendChild(eventNode);
};
var appendRegion = function(region, parentNode)
{
var regionNode = xmlDoc.createElement('Region');
var shapeName = region.getType();
var shapeCoords = region.getCoords();
regionNode.setAttribute('name', region.name);
regionNode.setAttribute('shape', shapeName);
regionNode.setAttribute('coords', shapeCoords);
var events = region.getEvents();
for (var i = 0; i < events.length; i++)
{
appendEvent(events[i], regionNode);
}
parentNode.appendChild(regionNode);
};
var appendRegionGroup = function(regionGroup, parentNode)
{
var regionGroupNode = xmlDoc.createElement('RegionGroup');
regionGroupNode.setAttribute('name', regionGroup.name);
regionGroupNode.setAttribute('min', regionGroup.min);
regionGroupNode.setAttribute('max', regionGroup.max);
var regions = regionGroup.getRegions();
for (var i = 0; i < regions.length; i++)
{
var region = regions[i];
var includeNode = xmlDoc.createElement('Include');
includeNode.setAttribute('region', region.name);
regionGroupNode.appendChild(includeNode);
}
parentNode.appendChild(regionGroupNode);
};
var regions = model.getRegions();
var regionsNode = xmlDoc.createElement('Regions');
xmlDoc.documentElement.appendChild(regionsNode);
for (var i = 0; i < regions.length; i++)
{
appendRegion(regions[i], regionsNode);
}
var regionGroups = model.getRegionGroups();
var regionGroupsNode = xmlDoc.createElement('RegionGroups');
xmlDoc.documentElement.appendChild(regionGroupsNode);
for (var i = 0; i < regionGroups.length; i++)
{
appendRegionGroup(regionGroups[i], regionGroupsNode);
}
return xmlDoc;
};

/* SOURCE FILE: importexport.shapes.js (c4542add) 9/9/2014 2:08:53 PM */

Grid.ImportExport.translateCoordinate = function(model, y)
{
return (model.options.canvasHeight - y);
};
Grid.ImportExport.writeShapes = function(rootNode, model) {
var xmlDoc = rootNode.ownerDocument;
var circles = model.getCircles();
if (circles && circles.length > 0) {
var circlesNode = this.createCirclesElement(xmlDoc, circles);
rootNode.appendChild(circlesNode);
}
var lines = model.getLines();
if (lines && lines.length > 0) {
var linesNode = this.createLinesElement(xmlDoc, lines);
rootNode.appendChild(linesNode);
}
};
Grid.ImportExport.createCirclesElement = function(xmlDoc, circles) {
var circlesNode = xmlDoc.createElement('Circles');
for (var i = 0; i < circles.length; i++) {
var circle = circles[i];
var circleNode = xmlDoc.createElement('Circle');
circleNode.setAttribute('x', circle.x);
circleNode.setAttribute('y', circle.y);
circleNode.setAttribute('r', circle.radius);
circlesNode.appendChild(circleNode);
}
return circlesNode;
};
Grid.ImportExport.createLinesElement = function(xmlDoc, lines) {
var linesNode = xmlDoc.createElement('Lines');
for (var i = 0; i < lines.length; i++) {
var line = lines[i];
var lineNode = xmlDoc.createElement('Line');
lineNode.setAttribute('sourceX', line.source.x);
lineNode.setAttribute('sourceY', line.source.y);
lineNode.setAttribute('targetX', line.target.x);
lineNode.setAttribute('targetY', line.target.y);
lineNode.setAttribute('dir', line.dirType);
lineNode.setAttribute('style', line.style);
linesNode.appendChild(lineNode);
}
return linesNode;
};
Grid.ImportExport.loadShapes = function(xmlDoc, model) {
var circlesNode = xmlDoc.getElementsByTagName('Circles')[0];
if (circlesNode) this.loadCircles(circlesNode, model);
var linesNode = xmlDoc.getElementsByTagName('Lines')[0];
if (linesNode) this.loadLines(linesNode, model);
};
Grid.ImportExport.loadCircles = function(circlesNode, model) {
var circleList = circlesNode.getElementsByTagName('Circle');
for (var i = 0; i < circleList.length; i++) {
var circleNode = circleList[i];
var x = parseInt(circleNode.getAttribute('x'));
var y = parseInt(circleNode.getAttribute('y'));
var r = parseInt(circleNode.getAttribute('r'));
var circle = model.createCircle(x, y, r);
model.addCircle(circle);
}
};
Grid.ImportExport.loadLines = function(linesNode, model) {
var lineList = linesNode.getElementsByTagName('Line');
var lines = model.getLines();
for (var i = 0; i < lineList.length; i++) {
var lineNode = lineList[i];
var sourceX = parseInt(lineNode.getAttribute('sourceX'));
var sourceY = parseInt(lineNode.getAttribute('sourceY'));
var targetX = parseInt(lineNode.getAttribute('targetX'));
var targetY = parseInt(lineNode.getAttribute('targetY'));
var dir = lineNode.getAttribute('dir');
var style = lineNode.getAttribute('style');
if (style != 'dashed') continue;
for (var j = 0; j < lines.length; j++) {
var line = lines[j];
if (sourceX == line.source.x &&
sourceY == line.source.y &&
targetX == line.target.x &&
targetY == line.target.y &&
dir == line.dirType) {
line.style = style;
line.update();
}
}
}
};

/* SOURCE FILE: ImportExport.qti.js (17d76a6f) 9/9/2014 2:08:53 PM */

Grid.QtiImportExport = function(model) {
var gridquestion = model;
var answerSpaceXml;
var defaultEvents = [
{
name: "select",
styles: {
'fill': "white",
'fill-opacity': "0",
'stroke': "red",
'stroke-dasharray': "",
'stroke-opacity': "",
'stroke-width': "6"
},
image: null,
label: null
},
{
name: "hover",
styles: {
'fill': "white",
'fill-opacity': "0",
'stroke': "blue",
'stroke-dasharray': "",
'stroke-opacity': "",
'stroke-width': "4"
},
image: null,
label: null
}
];
this._importexport = new Grid.ImportExport(model);
this.loadItem = function(qtiXmlStr, callbackCreated, callbackFailure) {
var imageFiles = parseImageFiles(qtiXmlStr);
var imageLoader = new Grid.ImportExport.ImageLoader();
if (imageFiles.length == 0) {
loadItem2(qtiXmlStr, callbackCreated, imageLoader, imageFiles);
return;
}
for (var i = 0; i < imageFiles.length; i++) {
var url = Grid.ImportExport.resolveUrl(imageFiles[i].url);
imageLoader.addImage(url);
}
var self = this;
imageLoader.load(function() {
var imageErrors = imageLoader.getErrors();
if (imageErrors.length == 0) {
loadItem2.call(self, qtiXmlStr, callbackCreated, imageLoader, imageFiles);
} else {
callbackFailure('Error loading DOM images', imageErrors);
}
});
};
this.loadAnswer = function(response, gridq) {
this._importexport.loadAnswer.call(this, response, gridq);
};
this.getAnswerXml = function() {
this._importexport.getAnswerXml.call(this);
};
this.isStudentResponseValid = function() {
this._importexport.isStudentResponseValid.call(this);
};
var parseImageFiles = function(qtiXmlStr) {
var imageFiles = [];
var xmlDoc = Grid.ImportExport.parseFromString(qtiXmlStr);
var nodes = xmlDoc.getElementsByTagName('object');
Grid.ImportExport.eachNode(nodes, function(node) {
var nodeType = node.getAttribute('type');
if (nodeType.indexOf('image') != -1) {
var imageFile = {
url: node.getAttribute('data'),
height: node.getAttribute('height'),
width: node.getAttribute('width')
};
if (imageFiles.indexOf(imageFile) == -1) {
imageFiles.push(imageFile);
}
}
});
return imageFiles;
};
var addBackgroundImage = function(imageFiles, imageLoader) {
for (var i = 0; i < imageFiles.length; i++) {
var img = imageFiles[i];
var url = Grid.ImportExport.resolveUrl(img.url);
var htmlImage = imageLoader.getImage(url);
if ((htmlImage != null) && (img.height != null) && (img.width != null)) {
gridquestion.addBackgroundImage(htmlImage.src, 0, 0, htmlImage.width, htmlImage.height);
}
}
};
var parseHotspotChoice = function(regionNode) {
var region = {
name: regionNode.getAttribute('identifier'),
shape: regionNode.getAttribute('shape'),
coords: regionNode.getAttribute('coords'),
events: defaultEvents
};
return region;
};
var loadHotspots = function(xmlDoc, localModel, imageLoader) {
var hotspots = [];
var qtiObject = xmlDoc.getElementsByTagName('hotspotInteraction')[0];
var minChoices = qtiObject.getAttribute('minChoices');
var maxChoices = qtiObject.getAttribute('maxChoices');
var regionGroup = localModel.createRegionGroup('All', minChoices, maxChoices);
var regionNodes = xmlDoc.getElementsByTagName('hotspotChoice');
Grid.ImportExport.eachNode(regionNodes, function(regionNode) {
var regionJson = parseHotspotChoice(regionNode);
hotspots.push(regionJson);
});
Grid.ImportExport.eachNode(hotspots, function(regionJson) {
var region = localModel.createRegion(regionJson.name, regionJson.shape, regionJson.coords);
if (region == null) return;
regionGroup.addRegion(region);
if (regionJson.events == null) regionJson.events = defaultEvents;
Grid.ImportExport.eachNode(regionJson.events, function(eventJson) {
var event = region.createEvent(eventJson.name);
event.setStyles(eventJson.styles);
if (eventJson.label != null) {
event.setLabel(eventJson.label.x, eventJson.label.y, eventJson.label.text);
}
if (eventJson.image != null) {
var url = Grid.ImportExport.resolveUrl(eventJson.image.src);
var htmlImage = imageLoader.getImage(url);
if (htmlImage != null) {
event.setImage(url, eventJson.image.x, eventJson.image.y, htmlImage.width, htmlImage.height);
}
}
});
region.update();
});
};
var loadItem2 = function(qtiXmlStr, callback, imageLoader, imageFiles) {
answerSpaceXml = qtiXmlStr;
var xmlDoc = Grid.ImportExport.parseFromString(qtiXmlStr);
addBackgroundImage(imageFiles, imageLoader);
loadHotspots(xmlDoc, gridquestion, imageLoader);
if (typeof callback == 'function') callback();
};
};

/* SOURCE FILE: widget.js (3b0e19d5) 10/26/2014 1:27:05 PM */

(function(CM) {
function isGrid(item) {
return item.isResponseType('grid');
}
function isQTI(item) {
return item.isResponseType('hotspot');
}
function create(page, item, containerEl, gridAnswerSpace) {
var doc = page.getDoc();
if (containerEl == null) {
return null;
}
var gridSvg = CM.resolveBaseUrl('Scripts/Grid2/grid.svg');
var grid = new Grid(containerEl, gridSvg);
if (isQTI(item)) {
CM.QTI.loadStem(item);
grid.importexport = new Grid.QtiImportExport(grid.model);
};
item.grid = grid;
YUD.addClass(containerEl, 'loading');
grid.allowTab = false;
grid.isReadOnly = item.isReadOnly;
var GridComponent = function(panelName) {
this.id = panelName;
this.getXY = function() { return [0, 0]; };
this.focus = function() {
grid.setArea(panelName);
Util.Dom.focus(grid.ui._svgWin);
};
this.blur = function() {
grid.setArea(null);
if (!Util.Browser.isIE()) {
Util.Dom.blur(grid.ui._svgWin);
}
};
this.toString = function() { return panelName; };
};
var gridComponents = {};
gridComponents['canvas'] = new GridComponent('canvas');
gridComponents['palette'] = new GridComponent('palette');
gridComponents['toolbar'] = new GridComponent('toolbar');
grid.subscribe('onStateChange', function(gridEvt) {
if (gridEvt.state == GridState.Ready) {
CM.addKeyEvents(grid.ui._svgRoot);
if (typeof (KeyManager) == 'object') {
KeyManager.attachListener(grid.ui._svgRoot);
}
setTimeout(function() {
var gridResponse = null;
if (typeof (window.TestShell) == 'object' &&
typeof (window.TestShell.PageManager) == 'object') {
var response = window.TestShell.PageManager.getResponse(item.position);
gridResponse = response.getLastValue();
} else {
gridResponse = item.value;
}
if (Grid.QtiImportExport && grid.importexport instanceof Grid.QtiImportExport) {
grid.loadXml(item.qti.xml, gridResponse);
} else {
grid.loadXml(gridAnswerSpace, gridResponse);
}
}, 0);
}
if (gridEvt.state == GridState.Loaded) {
YUD.removeClass(containerEl, 'loading');
if (grid.question.options.showPalette) {
item.addComponent(gridComponents['palette']);
}
if (grid.question.options.showButtons.length > 0) {
item.addComponent(gridComponents['toolbar']);
}
item.addComponent(gridComponents['canvas']);
var zoomFactor = page.getZoomFactor();
setTimeout(function() {
grid.ui.zoom(zoomFactor);
}, 0);
if (page.isShowing()) {
grid.ui._fixOffset();
}
}
if (gridEvt.state == GridState.Error) {
YUD.removeClass(containerEl, 'loading');
YUD.addClass(containerEl, 'failed');
if (grid.ui && grid.ui._svgObject) {
YUD.setStyle(grid.ui._svgObject, 'display', 'none');
}
}
CM.log('GRID ' + item.position + ': STATE - ' + gridEvt.name);
});
grid.subscribe('onModeChange', function(gridEvt) {
CM.log('GRID ' + item.position + ': MODE - ' + gridEvt.name);
});
grid.subscribe('onAreaChange', function(gridEvt) {
if (gridEvt.name != null) {
item.setActive(gridEvt);
item.setActiveComponent(gridComponents[gridEvt.name]);
}
CM.log('GRID ' + item.position + ': AREA - ' + gridEvt.name);
});
if (typeof TDS.Diagnostics == 'object') {
grid.subscribe('onStateChange', function(gridEvt) {
if (gridEvt.state == GridState.Created) {
TDS.Diagnostics.addErrorHandler(grid.view._svgWin);
}
});
grid.subscribe('onError', function(evt) {
if (evt.exception) {
TDS.Diagnostics.report(evt.exception);
}
});
}
grid.init();
return grid;
}
function match_ITS(page, item, content) {
var id = 'GridContainer_' + item.position;
var el = document.getElementById(id);
if (el) {
return new CM.WidgetConfig(id, el, item.gridAnswerSpace);
}
return false;
}
function Widget_Grid(page, item, config) {
this.grid = null;
}
CM.registerWidget('grid', Widget_Grid, match_ITS);
var match_QTI = CM.QTI.createWidgetMatch('customInteraction', 'grid');
CM.registerWidget('qti.grid', Widget_Grid, match_QTI);
Widget_Grid.prototype.init = function() {
Grid.Utils.loadImageFiles(this.page, this.config);
}
Widget_Grid.prototype.load = function () {
this.grid = create(this.page, this.entity, this.element, this.config);
}
Widget_Grid.prototype.show = function() {
if (this.grid.ui._svgObject) {
this.grid.ui._fixOffset();
}
}
Widget_Grid.prototype.zoom = function (level) {
this.grid.ui.zoom(level);
}
Widget_Grid.prototype.isResponseAvailable = function() {
return this.grid && this.grid.isLoaded();
}
Widget_Grid.prototype.getResponse = function () {
var value = this.grid.getResponseXml();
var isValid = this.grid.isValid();
return this.createResponse(value, isValid);
}
Widget_Grid.prototype.setResponse = function (value) {
this.grid.importexport.loadAnswer(value);
}
})(window.ContentManager);
if (typeof (Grid.Utils) == 'undefined') {
Grid.Utils = {};
}
Grid.Utils.parseImageFiles = function(xmlStr) {
var eachNode = function(nodeList, func) {
var nodes = [];
for (var i = 0; i < nodeList.length; i++) {
nodes.push(nodeList[i] || nodeList.item(i));
}
YAHOO.util.Dom.batch(nodes, func);
};
var getTextContent = function(node) {
if (node && node.childNodes && node.childNodes.length) {
return node.childNodes[0].nodeValue;
}
return null;
};
var imageFiles = [];
var xmlDoc;
if (typeof xmlStr == 'string') {
xmlDoc = Util.Xml.parseFromString(xmlStr);
} else {
xmlDoc = xmlStr;
}
var imageNodes = xmlDoc.getElementsByTagName('FileSpec');
eachNode(imageNodes, function(imageNode) {
var imageFile = getTextContent(imageNode);
if (imageFiles.indexOf(imageFile) == -1) {
imageFiles.push(imageFile);
}
});
imageNodes = xmlDoc.getElementsByTagName('Image');
eachNode(imageNodes, function(imageNode) {
var imageFile = imageNode.getAttribute('src');
if (imageFiles.indexOf(imageFile) == -1) {
imageFiles.push(imageFile);
}
});
return imageFiles;
};
Grid.Utils.loadImageFiles = function(page, questionXml) {
var imageFiles = Grid.Utils.parseImageFiles(questionXml);
for (var i = 0; i < imageFiles.length; i++) {
var imageFile = imageFiles[i];
var imageUrl = Grid.ImportExport.resolveUrl(imageFile);
var img = new Image();
page.getRenderer().addImage(img);
img.src = imageUrl;
}
};

/* SOURCE FILE: Interaction.js (cf7d2863) 9/9/2014 2:08:53 PM */

if (typeof TDS == 'undefined') var TDS = {};
TDS.Interaction = function(responseIdentifier, config)
{
this._responseIdentifier = responseIdentifier;
this._config = config || {};
};
YAHOO.lang.augmentProto(TDS.Interaction, YAHOO.util.EventProvider);
TDS.Interaction.prototype.getResponseIdentifier = function()
{
return this._responseIdentifier;
};
TDS.Interaction.prototype.init = function() { };
TDS.Interaction.prototype.validateResponse = function() { return false; };
TDS.Interaction.prototype.getResponse = function() { return null; };
TDS.Interaction.prototype.resetResponse = function() { };
TDS.Interaction.prototype.loadResponse = function(        ) { };
TDS.Interaction.parseIdentifier = function(el)
{
return YUD.getAttribute(el, 'data-its-identifier');
};
TDS.Interaction.compareOrder = function(obj1, obj2)
{
return Util.Dom.compareNodeOrder(obj1.getElement(), obj2.getElement());
};
TDS.Interaction.parseXmlRoot = function (xml) {
var xmlDoc;
if (typeof xml == 'string') {
xmlDoc = Util.Xml.parseFromString(xml);
} else {
xmlDoc = xml;
}
var xmlRoot;
if (xmlDoc.documentElement) {
xmlRoot = xmlDoc.documentElement;
} else {
xmlRoot = xml;
}
return xmlRoot;
}

/* SOURCE FILE: ChoiceInteraction.js (51710cb8) 9/9/2014 2:08:53 PM */

TDS.ChoiceInteraction = function(responseIdentifier)
{
TDS.ChoiceInteraction.superclass.constructor.call(this, responseIdentifier);
this._choices = [];
};
YAHOO.lang.extend(TDS.ChoiceInteraction, TDS.Interaction);
TDS.ChoiceInteraction.prototype.getChoices = function() { return this._choices; };
TDS.ChoiceInteraction.prototype.getChoice = function(identifier)
{
for (var i = 0; i < this._choices.length; i++)
{
var choice = this._choices[i];
if (identifier == choice.getIdentifier()) return choice;
}
return null;
};
TDS.ChoiceInteraction.prototype.removeChoice = function(choice)
{
Util.Array.remove(this._choices, choice);
};
TDS.ChoiceInteraction.prototype.addChoice = function(choice)
{
this._choices.push(choice);
};

/* SOURCE FILE: Choice.js (05f6a22e) 9/9/2014 2:08:53 PM */

TDS.Choice = function(identifier, element, config)
{
this._identifier = identifier || '';
this._element = element || null;
this._config = config || {};
this.init();
};
YAHOO.lang.augmentProto(TDS.Choice, YAHOO.util.EventProvider);
TDS.Choice.prototype.getIdentifier = function() { return this._identifier; };
TDS.Choice.prototype.getElement = function() { return this._element; };
TDS.Choice.prototype.getDoc = function()
{
var element = this.getElement();
return Util.Dom.getOwnerDocument(element);
};
TDS.Choice.prototype.getWin = function()
{
var elementDoc = this.getDoc();
return Util.Dom.getWindow(elementDoc);
};
TDS.Choice.prototype.getRegions = function() {
var choiceEl = this.getElement();
return Util.Dom.getElementRegions(choiceEl);
};
TDS.Choice.prototype.init = function() { };
TDS.Choice.prototype.toString = function()
{
return this.getIdentifier();
};

/* SOURCE FILE: SelectInteraction.js (29bbddcc) 9/9/2014 2:08:53 PM */

TDS.SelectInteraction = function(responseIdentifier) {
TDS.SelectInteraction.superclass.constructor.call(this, responseIdentifier);
this._selectElements = [];
this._cardinalityLookup = new Util.Structs.Map();
};
YAHOO.lang.extend(TDS.SelectInteraction, TDS.ChoiceInteraction);
TDS.SelectInteraction.prototype.setCardinality = function (id, min, max) {
this._cardinalityLookup.set(id, {
id: id,
min: min,
max: max
});
};
TDS.SelectInteraction.prototype.getCardinality = function (id) {
return this._cardinalityLookup.get(id) || {
id: id,
min: 0,
max: 0
};
};
TDS.SelectInteraction.prototype.addChoice = function(choice) {
TDS.SelectInteraction.superclass.addChoice.call(this, choice);
choice.subscribe('beforeSelectEvent', this._validateSelection, choice, this);
};
TDS.SelectInteraction.prototype.removeChoice = function(choice) {
TDS.SelectInteraction.superclass.removeChoice.call(this, choice);
choice.unsubscribe('beforeSelectEvent', this._validateSelection, choice, this);
};
TDS.SelectInteraction.prototype.getSelectedChoices = function () {
return this.getChoices().filter(function(choice) {
return choice.isSelected();
});
};
TDS.SelectInteraction.prototype.getChoicesInGroup = function (id) {
return this.getChoices().filter(function (choice) {
return (id == choice.getGroupIdentifier());
});
};
TDS.SelectInteraction.prototype.getSelectedInGroup = function (id) {
return this.getSelectedChoices().filter(function (choice) {
return (id == choice.getGroupIdentifier());
});
};
TDS.SelectInteraction.prototype.getGroups = function () {
return Util.Array.unique(this.getChoices().map(function(choice) {
return choice.getGroupIdentifier();
}));
};
TDS.SelectInteraction.prototype._validateSelection = function(id, choice) {
var groupId = choice.getGroupIdentifier();
var cardinality = this.getCardinality(groupId);
var choices = this.getSelectedInGroup(groupId);
if (cardinality.max == 1 && choices.length > 0) {
choices[0].deselect();
return true;
}
else if (cardinality.max > 0 &&
cardinality.max <= choices.length) {
return false;
}
return true;
};
TDS.SelectInteraction.prototype.validateResponse = function () {
var totalMin = 0,
totalSelected = 0;
var groupIds = this.getGroups();
for (var i = 0; i < groupIds.length; i ++) {
var groupId = groupIds[i];
var cardinality = this.getCardinality(groupId);
var choices = this.getSelectedInGroup(groupId);
if (choices.length < cardinality.min) {
return false;
}
totalMin += cardinality.min;
totalSelected += choices.length;
}
if (totalMin == 0 && totalSelected == 0) {
return false;
}
return true;
};
TDS.SelectInteraction.prototype.getResponseArray = function() {
var selectedIdentifiers = [];
var selectedChoices = this.getSelectedChoices();
for (var i = 0; i < selectedChoices.length; i++) {
var choice = selectedChoices[i];
selectedIdentifiers.push(choice.getIdentifier());
}
return selectedIdentifiers;
};
TDS.SelectInteraction.prototype.getResponseJson = function () {
var groupList = [];
var groupLookup = {};
var selectedChoices = this.getSelectedChoices();
Util.Array.each(selectedChoices, function(choice) {
var selectIdent = choice.getIdentifier();
var selectEl = choice.getElement();
var selectGroupIdent = YUD.getAttribute(selectEl, 'data-its-group') || '';
var selectGroup = groupLookup[selectGroupIdent];
if (selectGroup == null) {
selectGroup =
{
responses: [],
identifier: selectGroupIdent
};
groupLookup[selectGroupIdent] = selectGroup;
groupList.push(selectGroup);
}
selectGroup.responses.push(selectIdent);
});
return groupList;
};
TDS.SelectInteraction.prototype.getResponseXml = function() {
var responseXml = Util.Xml.createDocument('interaction');
var interactionEl = responseXml.documentElement;
interactionEl.setAttribute('identifier', this.getResponseIdentifier());
interactionEl.setAttribute('type', 'selectable');
var groupsList = this.getResponseJson();
Util.Array.each(groupsList, function(groupJson) {
var groupNode = responseXml.createElement('group');
groupNode.setAttribute('identifier', groupJson.identifier);
interactionEl.appendChild(groupNode);
Util.Array.each(groupJson.responses, function(response) {
var responseNode = responseXml.createElement('response');
responseNode.setAttribute('identifier', response);
groupNode.appendChild(responseNode);
});
});
return responseXml;
};
TDS.SelectInteraction.prototype.getResponse = function() {
var responseXml = this.getResponseXml();
return Util.Xml.serializeToString(responseXml);
};
TDS.SelectInteraction.prototype.resetResponse = function() {
var choices = this.getChoices();
for (var i = 0; i < choices.length; i++) {
choices[i].deselect();
}
};
TDS.SelectInteraction.prototype.setResponse = function(identifier) {
var choice = this.getChoice(identifier);
return (choice) ? choice.select() : false;
};
TDS.SelectInteraction.prototype.loadResponseIDs = function(responseIdentifiers) {
this.resetResponse();
responseIdentifiers.forEach(function(id) {
this.setResponse(id);
}.bind(this));
};
TDS.SelectInteraction.prototype.loadResponseXml = function (xml) {
var interactionNode = TDS.Interaction.parseXmlRoot(xml);
var responseIdentifiers = [];
Util.Dom.queryTagsBatch('response', interactionNode, function(responseNode) {
var responseIdentifier = responseNode.getAttribute('identifier');
responseIdentifiers.push(responseIdentifier);
});
this.loadResponseIDs(responseIdentifiers);
};
TDS.SelectInteraction.prototype.getSelectElements = function() {
return this._selectElements;
};
TDS.SelectInteraction.prototype.load = function(parent) {
parent = YUD.get(parent);
var interactionElements = YUD.getElementsByClassName('interaction', null, parent);
var selectElements = [];
YUD.batch(interactionElements, function(interactionEl) {
if (YUD.hasClass(interactionEl, 'selectable')) {
selectElements.push(interactionEl);
}
});
this._selectElements = selectElements;
for (var i = 0; i < selectElements.length; i++) {
var selectElement = selectElements[i];
var responseIdentifier = TDS.Interaction.parseIdentifier(selectElement);
var choice = new TDS.SelectChoice(responseIdentifier, selectElement);
this.addChoice(choice);
}
};

/* SOURCE FILE: SelectChoice.js (1acd7e75) 9/9/2014 2:08:53 PM */

TDS.SelectChoice = function(identifier, element, config) {
this._selected = false;
TDS.SelectChoice.superclass.constructor.call(this, identifier, element, config);
this.createEvent('beforeSelectEvent');
this.createEvent('selectEvent');
this.createEvent('deselectEvent');
};
YAHOO.extend(TDS.SelectChoice, TDS.Choice);
TDS.SelectChoice.prototype.isSelected = function() {
return this._selected;
};
TDS.SelectChoice.prototype.getGroupIdentifier = function() {
return this._element.getAttribute('data-its-group');
};
TDS.SelectChoice.prototype.select = function() {
if (this._selected) {
return false;
}
var b4result = this.fireEvent('beforeSelectEvent', this._identifier);
if (b4result !== false) {
this._selected = true;
this.onSelect();
this.fireEvent('selectEvent', this._identifier);
return true;
}
return false;
};
TDS.SelectChoice.prototype.deselect = function() {
if (!this._selected) {
return false;
}
this._selected = false;
this.onDeselect();
this.fireEvent('deselectEvent', this._identifier);
return true;
};
TDS.SelectChoice.prototype.onSelect = function() {
YUD.addClass(this._element, 'selected');
this._element.setAttribute('aria-checked', 'true');
};
TDS.SelectChoice.prototype.onDeselect = function() {
YUD.removeClass(this._element, 'selected');
this._element.setAttribute('aria-checked', 'false');
};
TDS.SelectChoice.prototype.onClick = function(ev) {
if (this.isSelected()) {
this.deselect();
} else {
this.select();
}
};
TDS.SelectChoice.prototype.init = function() {
var el = this._element;
el.setAttribute('tabindex', '0');
el.setAttribute('role', 'checkbox');
el.setAttribute('aria-checked', 'false');
YAHOO.util.Event.on(el, 'click', this.onClick, this, true);
new YAHOO.util.KeyListener(el, {
keys: [13]
}, {
fn: this.onClick,
scope: this,
correctScope: true
}).enable();
};

/* SOURCE FILE: DDInteraction.js (28f9ebcb) 9/9/2014 2:08:53 PM */

TDS.DDInteraction = function(responseIdentifier)
{
this._groupLookup = new Util.Structs.Map();
this._dragLookup = new Util.Structs.Map();
this._dragSource = null;
this._dropTarget = null;
this._defaultResponse = null;
TDS.DDInteraction.superclass.constructor.call(this, responseIdentifier);
};
YAHOO.lang.extend(TDS.DDInteraction, TDS.Interaction);
TDS.DDInteraction.CSS = {
INTERACTION: 'interaction',
DRAGGABLE: 'draggable',
DRAG_GROUP: 'drag-group',
DROP_TARGET: 'drop-target',
DROP_TARGET_COLLAPSED: 'drop-target-collapsed',
DRAG_SOURCE: 'drag-source',
DRAG_OVER: 'drag-over',
DRAG_PROXY: 'drag-proxy',
DRAG_PROXY_OVER: 'drag-proxy-over',
DROP_MARKER: 'drop-marker',
DRAG_LOCKED: 'drag-locked'
};
TDS.DDInteraction.prototype.getGroups = function()
{
return this._groupLookup.getValues();
};
TDS.DDInteraction.prototype.getGroup = function(responseIdentifier)
{
return this._groupLookup.get(responseIdentifier);
};
TDS.DDInteraction.prototype.addGroup = function(group)
{
var responseIdentifier = group.getIdentifier();
this._groupLookup.set(responseIdentifier, group);
};
TDS.DDInteraction.prototype.getDraggables = function()
{
return this._dragLookup.getValues();
};
TDS.DDInteraction.prototype.getDraggable = function(responseIdentifier)
{
return this._dragLookup.get(responseIdentifier);
};
TDS.DDInteraction.prototype.addDraggable = function(draggable)
{
var responseIdentifier = draggable.getIdentifier();
this._dragLookup.set(responseIdentifier, draggable);
};
TDS.DDInteraction.prototype.getSource = function() { return this._dragSource; };
TDS.DDInteraction.prototype.hasSource = function() { return (this._dragSource != null); };
TDS.DDInteraction.prototype.setSource = function(draggable)
{
if (this._dragSource == draggable) return;
this.clearSource();
if (!(draggable instanceof TDS.Choice)) return;
var dragEl = draggable.getElement();
YUD.addClass(dragEl, TDS.DDInteraction.CSS.DRAG_SOURCE);
this._dragSource = draggable;
};
TDS.DDInteraction.prototype.clearSource = function()
{
if (this._dragSource == null) return;
var dropEl = this._dragSource.getElement();
YUD.removeClass(dropEl, TDS.DDInteraction.CSS.DRAG_SOURCE);
this._dragSource = null;
};
TDS.DDInteraction.prototype.getTarget = function() { return this._dropTarget; };
TDS.DDInteraction.prototype.hasTarget = function() { return (this._dropTarget != null); };
TDS.DDInteraction.prototype.setTarget = function(droppable)
{
this.clearTarget();
if (!(droppable instanceof TDS.Choice)) return;
var dropEl = droppable.getElement();
YUD.addClass(dropEl, TDS.DDInteraction.CSS.DRAG_OVER);
var dragSource = this.getSource();
if (dragSource) {
var proxy = dragSource.getProxy();
var proxyEl = proxy.getDragEl();
YUD.addClass(proxyEl, TDS.DDInteraction.CSS.DRAG_PROXY_OVER);
}
this.addMarker(droppable);
this._dropTarget = droppable;
};
TDS.DDInteraction.prototype.clearTarget = function()
{
if (this._dropTarget == null) return;
var dropEl = this._dropTarget.getElement();
YUD.removeClass(dropEl, TDS.DDInteraction.CSS.DRAG_OVER);
var dragSource = this.getSource();
if (dragSource) {
var proxy = dragSource.getProxy();
var proxyEl = proxy.getDragEl();
YUD.removeClass(proxyEl, TDS.DDInteraction.CSS.DRAG_PROXY_OVER);
}
this.removeMarker(this._dropTarget);
this._dropTarget = null;
};
TDS.DDInteraction.prototype.addMarker = function(draggable)
{
if (draggable == null) return;
if (draggable instanceof TDS.DragDrop)
{
var dropEl = draggable.getElement();
var dropDoc = Util.Dom.getOwnerDocument(dropEl);
var markerId = YUD.getAttribute(dropEl, 'id');
var markerEl = dropDoc.createElement('span');
YUD.setAttribute(markerEl, 'id', markerId + '-marker');
YUD.addClass(markerEl, TDS.DDInteraction.CSS.DROP_MARKER);
YUD.insertBefore(markerEl, dropEl);
}
};
TDS.DDInteraction.prototype.removeMarker = function(draggable)
{
if (draggable == null) return;
if (draggable instanceof TDS.DragDrop)
{
var dropEl = draggable.getElement();
var dropDoc = Util.Dom.getOwnerDocument(dropEl);
var markerId = YUD.getAttribute(dropEl, 'id');
var markerEl = dropDoc.getElementById(markerId + '-marker');
if (markerEl != null) Util.Dom.removeNode(markerEl);
}
};
TDS.DDInteraction.prototype.onStartDrag = function(dragSource)
{
this.setSource(dragSource);
var draggables = this.getDraggables();
for (var i = 0; i < draggables.length; i++)
{
var droppable = draggables[i];
if (droppable == dragSource) continue;
var dropElement = droppable.getElement();
YUD.addClass(dropElement, TDS.DDInteraction.CSS.DROP_TARGET);
}
var groups = this.getGroups();
for (var i = 0; i < groups.length; i++)
{
var group = groups[i];
if (group.isDroppable())
{
var groupEl = group.getElement();
YUD.addClass(groupEl, TDS.DDInteraction.CSS.DROP_TARGET);
if (groupEl.offsetHeight == 0 || groupEl.offsetWidth == 0) {
YUD.addClass(groupEl, TDS.DDInteraction.CSS.DROP_TARGET_COLLAPSED);
}
}
}
};
TDS.DDInteraction.prototype.onDrag = function(ev, dragSource)
{
var srcEl = dragSource.getElement();
var targetEl = TDS.DDInteraction.getElementInEvent(ev, this.getDraggables());
if (targetEl == null) {
targetEl = TDS.DDInteraction.getElementInEvent(ev, this.getGroups());
}
var proxy = dragSource.getProxy();
var proxyEl = proxy.getDragEl();
if (targetEl == proxyEl) return;
if (this._dropTarget && this._dropTarget.getElement() == targetEl) return;
this.clearTarget();
if (targetEl == null || targetEl == srcEl) return;
var targetIdent = TDS.Interaction.parseIdentifier(targetEl);
if (targetIdent)
{
if (YUD.hasClass(targetEl, TDS.DDInteraction.CSS.DRAGGABLE))
{
var droppable = this.getDraggable(targetIdent);
if (droppable) this.setTarget(droppable);
}
else if (YUD.hasClass(targetEl, TDS.DDInteraction.CSS.DRAG_GROUP))
{
var group = this.getGroup(targetIdent);
if (group && group.isDroppable()) this.setTarget(group);
}
}
};
TDS.DDInteraction.prototype.onEndDrag = function(dragSource)
{
var dropTarget = this.getTarget();
if (dropTarget != null)
{
this.onDrop(dragSource, dropTarget);
}
this.clearTarget();
this.clearSource();
var draggables = this.getDraggables();
for (var i = 0; i < draggables.length; i++)
{
var droppable = draggables[i];
if (droppable == dragSource) continue;
var dropElement = droppable.getElement();
YUD.removeClass(dropElement, TDS.DDInteraction.CSS.DROP_TARGET);
}
var groups = this.getGroups();
for (var i = 0; i < groups.length; i++)
{
var group = groups[i];
var groupEl = group.getElement();
YUD.removeClass(groupEl, TDS.DDInteraction.CSS.DROP_TARGET);
YUD.removeClass(groupEl, TDS.DDInteraction.CSS.DROP_TARGET_COLLAPSED);
}
};
TDS.DDInteraction.prototype.onDrop = function(dragSource, dropTarget)
{
if (dropTarget instanceof TDS.DragGroup)
{
dragSource.setGroup(dropTarget);
}
else if (dropTarget instanceof TDS.DragDrop)
{
dragSource.setGroup(dropTarget.getGroup());
}
var srcEl = dragSource.getElement();
var dropEl = dropTarget.getElement();
Util.Dom.removeNode(srcEl);
if (dropTarget instanceof TDS.DragGroup)
{
dropEl.appendChild(srcEl);
}
else if (dropTarget instanceof TDS.DragDrop)
{
YUD.insertBefore(srcEl, dropEl);
}
};
TDS.DDInteraction.prototype.validateResponse = function()
{
return (this._defaultResponse != this.getResponse());
};
TDS.DDInteraction.prototype.getResponseJson = function()
{
var groupsList = [];
var groups = this.getGroups();
Util.Array.sort(groups, TDS.Interaction.compareOrder);
Util.Array.each(groups, function(group)
{
var draggables = group.getChildren();
Util.Array.sort(draggables, TDS.Interaction.compareOrder);
var jsonGroup =
{
responses: [],
identifier: group.getIdentifier()
};
Util.Array.each(draggables, function(draggable)
{
jsonGroup.responses.push(draggable.getIdentifier());
});
groupsList.push(jsonGroup);
});
return groupsList;
};
TDS.DDInteraction.prototype.getResponseXml = function()
{
var responseXml = Util.Xml.createDocument('interaction');
var interactionEl = responseXml.documentElement;
interactionEl.setAttribute('identifier', this.getResponseIdentifier());
interactionEl.setAttribute('type', 'draggable');
var groupsList = this.getResponseJson();
Util.Array.each(groupsList, function(groupJson)
{
var groupNode = responseXml.createElement('group');
groupNode.setAttribute('identifier', groupJson.identifier);
interactionEl.appendChild(groupNode);
Util.Array.each(groupJson.responses, function(response)
{
var responseNode = responseXml.createElement('response');
responseNode.setAttribute('identifier', response);
groupNode.appendChild(responseNode);
});
});
return responseXml;
};
TDS.DDInteraction.prototype.getResponse = function () {
var responseXml = this.getResponseXml();
return Util.Xml.serializeToString(responseXml);
};
TDS.DDInteraction.prototype.loadResponseXml = function (xml)
{
var interactionNode = TDS.Interaction.parseXmlRoot(xml);
var dd = this;
Util.Dom.queryTagsBatch('group', interactionNode, function (groupNode)
{
var groupIdentifier = groupNode.getAttribute('identifier');
var group = dd.getGroup(groupIdentifier);
Util.Dom.queryTagsBatch('response', groupNode, function (responseNode)
{
var responseIdentifier = responseNode.getAttribute('identifier');
var draggable = dd.getDraggable(responseIdentifier);
dd.onDrop(draggable, group);
});
});
};
TDS.DDInteraction.prototype.load = function (parentEl, opts) {
opts = opts || {};
opts.createGroups = opts.createGroups || true;
opts.moveDraggables = opts.moveDraggables || false;
parentEl = YUD.get(parentEl);
var interactionElements = YUD.getElementsByClassName(TDS.DDInteraction.CSS.INTERACTION, null, parentEl);
var dragElements = [];
var groupElements = [];
YUD.batch(interactionElements, function(interactionEl)
{
if (YUD.hasClass(interactionEl, TDS.DDInteraction.CSS.DRAGGABLE))
{
dragElements.push(interactionEl);
}
else if (YUD.hasClass(interactionEl, TDS.DDInteraction.CSS.DRAG_GROUP))
{
groupElements.push(interactionEl);
}
});
for (var i = 0; i < groupElements.length; i++)
{
var groupElement = groupElements[i];
var groupIdent = TDS.Interaction.parseIdentifier(groupElement);
var group = new TDS.DragGroup(this, groupIdent, groupElement);
this.addGroup(group);
}
for (var i = 0; i < dragElements.length; i++)
{
var dragEl = dragElements[i];
var responseIdent = TDS.Interaction.parseIdentifier(dragEl);
var draggable = new TDS.DragDrop(this, responseIdent, dragEl);
this.addDraggable(draggable);
var groups = this.getGroups();
for (var j = 0; j < groups.length; j++)
{
var group = groups[j];
var groupEl = group.getElement();
if (dragEl.parentNode == groupEl)
{
draggable.setGroup(group);
break;
}
}
}
if (opts.createGroups) {
this._createGroupContainers(opts);
}
this._defaultResponse = this.getResponse();
};
TDS.DDInteraction.prototype._createGroupContainers = function (opts)
{
var getGroupIdent = function(el) { return YUD.getAttribute(el, 'data-its-group'); };
var draggables = this.getDraggables();
var groupMapping = {};
for (var i = 0; i < draggables.length; i++)
{
var draggable = draggables[i];
if (draggable.getGroup()) continue;
var dragEl = draggable.getElement();
var groupIdent = getGroupIdent(dragEl);
if (groupIdent == null) continue;
var groupDraggables = groupMapping[groupIdent];
if (!groupDraggables)
{
groupDraggables = [];
groupMapping[groupIdent] = groupDraggables;
}
groupDraggables.push(draggable);
}
for (var groupIdent in groupMapping)
{
var groupDraggables = groupMapping[groupIdent];
var dragStartEl = groupDraggables[0].getElement();
var groupEl = dragStartEl.parentNode;
var groupChildren = YUD.getChildren(groupEl);
var groupUsingParent = Util.Array.every(groupChildren, function(child)
{
return (groupIdent == getGroupIdent(child));
});
if (!groupUsingParent)
{
var dragDoc = Util.Dom.getOwnerDocument(dragStartEl);
groupEl = dragDoc.createElement('span');
YUD.insertBefore(groupEl, dragStartEl);
}
groupEl.setAttribute('data-its-identifier', groupIdent);
groupEl.className = TDS.DDInteraction.CSS.INTERACTION + ' ' + TDS.DDInteraction.CSS.DRAG_GROUP;
var group = new TDS.DragGroup(this, groupIdent, groupEl);
this.addGroup(group);
for (var i = 0; i < groupDraggables.length; i++)
{
var groupDraggable = groupDraggables[i];
var dragEl = groupDraggable.getElement();
if (opts.moveDraggables || !groupUsingParent) {
console.log('DDI: Moving draggable into group: ', dragEl, group.getElement());
Util.Dom.removeNode(dragEl);
group.getElement().appendChild(dragEl);
}
groupDraggable.setGroup(group);
}
}
for (var i = 0; i < draggables.length; i++) {
var draggable = draggables[i];
var dragEl = draggable.getElement();
var dragText = Util.Dom.getTextContent(dragEl);
dragText = YAHOO.lang.trim(dragText);
if (Util.String.startsWith(dragText, '#') &&
Util.String.endsWith(dragText, '#')) {
dragText = dragText.substr(1);
dragText = dragText.substring(0, dragText.length - 1);
Util.Dom.setTextContent(dragEl, dragText);
var dragGroup = draggable.getGroup();
dragGroup.setDroppable(true);
draggable.lock();
}
}
};
TDS.DDInteraction.getElementInRegion = function(region, choices)
{
for(var i = 0, ii = choices.length; i < ii; i++)
{
var choice = choices[i];
var regions = choice.getRegions();
for (var j = 0, jj = regions.length; j < jj; j++)
{
if (regions[j].contains(region)) return choice.getElement();
}
}
return null;
};
TDS.DDInteraction.getElementInEvent = function(evt, choices)
{
var point = new YAHOO.util.Point(evt.clientX, evt.clientY);
return TDS.DDInteraction.getElementInRegion(point, choices);
};
TDS.DDInteraction.drawLine = function(x1, y1, x2, y2) {
if (y1 < y2) {
var pom = y1;
y1 = y2;
y2 = pom;
pom = x1;
x1 = x2;
x2 = pom;
}
var a = Math.abs(x1 - x2);
var b = Math.abs(y1 - y2);
var c;
var sx = (x1 + x2) / 2;
var sy = (y1 + y2) / 2;
var width = Math.sqrt(a * a + b * b);
var x = sx - width / 2;
var y = sy;
a = width / 2;
b = Math.sqrt(Math.abs(x1 - x) * Math.abs(x1 - x) + Math.abs(y1 - y) * Math.abs(y1 - y));
c = Math.abs(sx-x);
var cosb = (b * b - a * a - c * c) / (2 * a * c);
var rad = Math.acos(cosb);
var deg = (rad * 180) / Math.PI;
var htmlns = 'http://www.w3.org/1999/xhtml';
var div = document.createElementNS(htmlns, 'div');
div.setAttribute('style', 'border:1px solid red;width:' + width + 'px;height:0px;-moz-transform:rotate(' + deg + 'deg);-webkit-transform:rotate(' + deg + 'deg);position:absolute;top:' + y + 'px;left:' + x + 'px;');
document.body.appendChild(div);
}

/* SOURCE FILE: DragDrop.js (58121815) 9/9/2014 2:08:53 PM */

TDS.DragDrop = function(parentInteraction, responseIdentifier, element)
{
this._parentInteraction = parentInteraction;
this._group = null;
this._proxy = null;
TDS.DragDrop.superclass.constructor.call(this, responseIdentifier, element);
};
YAHOO.extend(TDS.DragDrop, TDS.Choice);
TDS.DragDrop.prototype.getProxy = function() { return this._proxy; };
TDS.DragDrop.prototype.getGroup = function() { return this._group; };
TDS.DragDrop.prototype.setGroup = function(group) {
var dragEl = this.getElement();
dragEl.setAttribute('data-its-group', group.getIdentifier());
this._group = group;
};
TDS.DragDrop.prototype.init = function()
{
var element = this.getElement();
var elementWin = this.getWin();
var proxy = new elementWin.YAHOO.util.DDProxy(element);
this._proxy = proxy;
proxy.startDrag = Util.bind(this.onStartDrag, this);
proxy.onDrag = Util.bind(this.onDrag, this);
proxy.endDrag = Util.bind(this.onEndDrag, this);
};
TDS.DragDrop.prototype.onStartDrag = function(x, y)
{
var srcEl = this._proxy.getEl();
var proxyEl = this._proxy.getDragEl();
YUD.addClass(proxyEl, TDS.DDInteraction.CSS.DRAG_PROXY);
YUD.setStyle(proxyEl, 'width', '');
YUD.setStyle(proxyEl, 'height', '');
YUD.setStyle(proxyEl, 'border', '');
proxyEl.innerHTML = srcEl.innerHTML;
this._proxy.setDelta(0, 0);
this._parentInteraction.onStartDrag(this);
};
TDS.DragDrop.prototype.onDrag = function(ev)
{
this._parentInteraction.onDrag(ev, this);
};
TDS.DragDrop.prototype.onDragDrop = function(ev, id)
{
};
TDS.DragDrop.prototype.onEndDrag = function(ev)
{
var srcEl = this._proxy.getEl();
var proxyEl = this._proxy.getDragEl();
YUD.removeClass(proxyEl, TDS.DDInteraction.CSS.DRAG_PROXY);
this._parentInteraction.onEndDrag(this);
};
TDS.DragDrop.prototype.lock = function() {
var dragEl = this.getElement();
YUD.addClass(dragEl, TDS.DDInteraction.CSS.DRAG_LOCKED);
var proxy = this.getProxy();
proxy.lock();
};
TDS.DragDrop.prototype.unlock = function() {
var dragEl = this.getElement();
YUD.removeClass(dragEl, TDS.DDInteraction.CSS.DRAG_LOCKED);
var proxy = this.getProxy();
proxy.unlock();
};

/* SOURCE FILE: DragGroup.js (d5be9376) 9/9/2014 2:08:53 PM */

TDS.DragGroup = function(parentInteraction, responseIdentifier, element)
{
this._parentInteraction = parentInteraction;
this._droppable = false;
TDS.DragGroup.superclass.constructor.call(this, responseIdentifier, element);
};
YAHOO.extend(TDS.DragGroup, TDS.Choice);
TDS.DragGroup.prototype.getChildren = function()
{
var groupDraggables = [];
var draggables = this._parentInteraction.getDraggables();
for (var i = 0; i < draggables.length; i++)
{
var draggable = draggables[i];
if (draggable.getGroup() == this)
{
groupDraggables.push(draggable);
}
}
return groupDraggables;
};
TDS.DragGroup.prototype.setDroppable = function(droppable) {
this._droppable = droppable;
};
TDS.DragGroup.prototype.isDroppable = function() {
if (this._droppable) return true;
var draggables = this.getChildren();
return (draggables.length == 0);
};
TDS.DragGroup.prototype.init = function()
{
var element = this.getElement();
YUE.on(element, 'mouseenter', this.onEnter, this, true);
YUE.on(element, 'mouseleave', this.onLeave, this, true);
};
TDS.DragGroup.prototype.onEnter = function(ev)
{
var dragSource = this._parentInteraction.getSource();
if (dragSource && dragSource != this && this.isDroppable())
{
this._parentInteraction.setTarget(this);
}
};
TDS.DragGroup.prototype.onLeave = function(ev)
{
var dragSource = this._parentInteraction.getSource();
if (dragSource)
{
var dragProxy = dragSource.getProxy();
if (dragProxy && ev.relatedTarget === dragProxy.getDragEl()) return;
this._parentInteraction.clearTarget();
}
};

/* SOURCE FILE: OrderInteraction.js (a25faa4b) 9/9/2014 2:08:53 PM */

(function(TDS) {
var Orientation = {
Vertical: 'vertical',
Horizontal: 'horizontal'
}
var CSS = {
INTERACTION: 'interaction',
ORDER_CHOICE: 'order-choice',
ORDER_GROUP: 'order-group',
ORDER_SOURCE: 'order-source',
ORDER_HOVER: 'order-hover',
ORDER_PROXY: 'order-proxy'
};
function OI(responseIdentifier, orientation) {
this._orientation = orientation || Orientation.Vertical;
this._groups = new Util.Structs.Map();
this._defaultResponse = null;
OI.superclass.constructor.call(this, responseIdentifier);
};
YAHOO.lang.extend(OI, TDS.Interaction);
OI.Orientation = Orientation;
OI.CSS = CSS;
OI.prototype.getOrientation = function () {
return this._orientation;
};
OI.prototype.createGroup = function(id, el) {
var group = new TDS.OrderGroup(this, id, el);
this._groups.set(id, group);
return group;
};
OI.prototype.removeGroup = function (id) {
return this._groups.remove(id);
};
OI.prototype.getGroup = function(id) {
return this._groups.get(id);
};
OI.prototype.getGroups = function (sort) {
var groups = this._groups.getValues();
if (sort) {
Util.Array.sort(groups, TDS.Interaction.compareOrder);
}
return groups;
};
OI.prototype.getGroupIdentifiers = function(sort) {
var groups = this._groups.getValues(sort);
return groups.map(function(group) {
return group.getIdentifier();
});
};
OI.prototype.load = function (parentEl) {
parentEl = YUD.get(parentEl);
$('.interaction.order-group', parentEl).each(function (groupIdx, groupEl) {
var groupId = TDS.Interaction.parseIdentifier(groupEl);
var group = this.createGroup(groupId, groupEl);
$('.interaction.order-choice', groupEl).each(function (choiceIdx, choiceEl) {
var choiceId = TDS.Interaction.parseIdentifier(choiceEl);
group.createChoice(choiceId, choiceEl);
}.bind(this));
}.bind(this));
this._defaultResponse = this.getResponse();
};
OI.prototype.validateResponse = function () {
return (this._defaultResponse != this.getResponse());
};
OI.prototype.getResponseJson = function () {
var groupsList = [];
var groups = this.getGroups(true);
groups.forEach(function (group) {
var jsonGroup = {
identifier: group.getIdentifier(),
responses: []
};
var choices = group.getChoices(true);
choices.forEach(function (choice) {
jsonGroup.responses.push(choice.getIdentifier());
});
groupsList.push(jsonGroup);
}, this);
return groupsList;
};
OI.prototype.getResponseXml = function () {
var responseXml = Util.Xml.createDocument('interaction');
var interactionEl = responseXml.documentElement;
interactionEl.setAttribute('identifier', this.getResponseIdentifier());
interactionEl.setAttribute('type', 'order');
var groupsList = this.getResponseJson();
Util.Array.each(groupsList, function (groupJson) {
var groupNode = responseXml.createElement('group');
groupNode.setAttribute('identifier', groupJson.identifier);
interactionEl.appendChild(groupNode);
Util.Array.each(groupJson.responses, function (response) {
var responseNode = responseXml.createElement('response');
responseNode.setAttribute('identifier', response);
groupNode.appendChild(responseNode);
});
});
return responseXml;
};
OI.prototype.getResponse = function () {
var responseXml = this.getResponseXml();
return Util.Xml.serializeToString(responseXml);
};
OI.prototype.loadResponseXml = function (xml) {
var interactionNode = TDS.Interaction.parseXmlRoot(xml);
var interaction = this;
Util.Dom.queryTagsBatch('group', interactionNode, function (groupNode) {
var groupIdentifier = groupNode.getAttribute('identifier');
var group = interaction.getGroup(groupIdentifier);
if (group) {
var identifiers = [];
Util.Dom.queryTagsBatch('response', groupNode, function (responseNode) {
var responseIdentifier = responseNode.getAttribute('identifier');
identifiers.push(responseIdentifier);
});
group.sort(identifiers);
}
});
};
OI.prototype.loadResponse = function(xmlStr) {
var xmlDoc = Util.Xml.parseFromString(xmlStr);
this.loadResponseXml(xmlDoc);
}
TDS.OrderInteraction = OI;
})(TDS);

/* SOURCE FILE: OrderGroup.js (62721c9d) 9/9/2014 2:08:53 PM */

(function(TDS) {
function OG(parentInteraction, responseIdentifier, element) {
this._parentInteraction = parentInteraction;
this._lookup = {};
this._list = [];
OG.superclass.constructor.call(this, responseIdentifier, element);
}
YAHOO.extend(OG, TDS.Choice);
OG.prototype.getParentInteraction = function() {
return this._parentInteraction;
};
OG.prototype.toggleLockDrag = function (identifier, lock) {
for (var i = 0; i < this._list.length; ++i) {
var choice = this._list[i];
if (choice._identifier != identifier) {
choice._preventDrag = lock;
}
}
};
OG.prototype.createChoice = function(id, el) {
var choice = new TDS.OrderChoice(this, id, el);
this._lookup[id] = choice;
this._list.push(choice);
return choice;
};
OG.prototype.getChoices = function(sort) {
var choices = this._list.concat();
if (sort) {
Util.Array.sort(choices, TDS.Interaction.compareOrder);
}
return choices;
};
OG.prototype.getIdentifiers = function(sort) {
var choices = this.getChoices(sort);
return choices.map(function(choice) {
return choice.getIdentifier();
});
};
OG.prototype.getChoice = function(id) {
return this._lookup[id];
};
OG.prototype.removeChoice = function(id) {
var choice = this.getChoice(id);
if (choice) {
delete this._lookup[id];
Util.Array.remove(this._list, choice);
}
};
OG.prototype._syncDom = function() {
var choices = this.getChoices();
var elements = choices.map(function(choice) {
return choice.getElement();
});
var groupEl = this.getElement();
$(groupEl).append(elements);
};
OG.prototype.sort = function(identifiers) {
Util.Array.sort(this._list, function(recA, recB) {
var idxA = identifiers.indexOf(recA.getIdentifier());
var idxB = identifiers.indexOf(recB.getIdentifier());
return idxA > idxB ? 1 : idxA < idxB ? -1 : 0;
});
this._syncDom();
};
OG.prototype.dispose = function() {
this._parentInteraction = null;
this.getChoices().forEach(function(choice) {
choice.dispose();
});
};
TDS.OrderGroup = OG;
})(TDS);

/* SOURCE FILE: OrderChoice.js (867b99b2) 9/9/2014 2:08:53 PM */

(function(TDS) {
var OI = TDS.OrderInteraction;
var Orientation = OI.Orientation;
var CSS = OI.CSS;
function OC(parentGroup, responseIdentifier, element) {
this._parentGroup = parentGroup;
this._parentInteraction = parentGroup.getParentInteraction();
this._proxy = null;
this._dragging = false;
this._dragBack = false;
this._lastX = 0;
this._lastY = 0;
this._preventDrag = false;
OC.superclass.constructor.call(this, responseIdentifier, element);
};
YAHOO.extend(OC, TDS.Choice);
OC.prototype.getGroup = function() {
return this._parentGroup;
};
OC.prototype.getParentInteraction = function () {
return this._parentInteraction;
};
OC.prototype.getProxy = function() {
return this._proxy;
};
OC.prototype.isDragging = function () {
return this._dragging;
};
OC.prototype.init = function() {
var element = this.getElement();
var elementWin = element.ownerDocument.defaultView;
var proxy = new elementWin.YAHOO.util.DDProxy(element);
this._proxy = proxy;
if (this._parentInteraction.getOrientation() == Orientation.Vertical) {
proxy.setXConstraint(0, 0);
} else {
proxy.setYConstraint(0, 0);
}
proxy.startDrag = this.onStartDrag.bind(this);
proxy.onDrag = this.onDrag.bind(this);
proxy.onDragOver = this.onDragOver.bind(this);
proxy.onDragDrop = this.onDragDrop.bind(this);
proxy.endDrag = this.onEndDrag.bind(this);
proxy.b4MouseDown = this.onBeforeMouseDown.bind(this);
};
OC.prototype.refreshCache = function () {
var element = this.getElement();
var elementWin = element.ownerDocument.defaultView;
elementWin.YAHOO.util.DragDropMgr.refreshCache();
};
OC.prototype.onBeforeMouseDown = function(ev) {
if (this._preventDrag) {
return false;
}
};
OC.prototype.onStartDrag = function (x, y) {
this._dragging = true;
this._parentGroup.toggleLockDrag(this._identifier, true);
var $srcEl = $(this._proxy.getEl());
var $proxyEl = $(this._proxy.getDragEl());
$srcEl.addClass(CSS.ORDER_SOURCE);
$proxyEl.addClass(CSS.ORDER_PROXY);
$proxyEl.css('width', '');
$proxyEl.css('height', '');
$proxyEl.css('border', '');
$proxyEl.html($srcEl.html());
this._proxy.setDelta(0, ($proxyEl.height() / 2));
};
OC.prototype.onDrag = function(ev) {
if (this._parentInteraction.getOrientation() == Orientation.Horizontal) {
var x = YUE.getPageX(ev);
if (x < this._lastX) {
this._dragBack = true;
} else if (x > this._lastX) {
this._dragBack = false;
}
this._lastX = x;
} else {
var y = YUE.getPageY(ev);
if (y < this._lastY) {
this._dragBack = true;
} else if (y > this._lastY) {
this._dragBack = false;
}
this._lastY = y;
}
};
OC.prototype.onDragOver = function (ev, id) {
var $src = $(this.getElement());
var $dest = $(YUD.get(id));
if (!$src.parent().is($dest.parent())) return;
if (this._dragBack) {
$src.insertBefore($dest);
} else {
$src.insertAfter($dest);
}
this.refreshCache();
};
OC.prototype.onDragDrop = function(ev, id) {
};
OC.prototype.onEndDrag = function() {
this._dragging = false;
this._parentGroup.toggleLockDrag(this._identifier, false);
var $srcEl = $(this._proxy.getEl());
var $proxyEl = $(this._proxy.getDragEl());
$srcEl.removeClass(CSS.ORDER_SOURCE);
$proxyEl.removeClass(CSS.ORDER_PROXY);
};
OC.prototype.dispose = function() {
this._parentGroup = null;
this._parentInteraction = null;
this._proxy = null;
};
TDS.OrderChoice = OC;
})(TDS);

/* SOURCE FILE: qti.hottext.js (cdc640ae) 10/26/2014 1:27:05 PM */

(function (CM) {
var QTI = CM.QTI;
var match = QTI.createWidgetMatch('hottextInteraction');
function Widget_HT(page, item, config) {
this.dataType = CM.DataType.Array;
this.options = {
autoLoad: true
}
this.interaction = null;
}
CM.registerWidget('qti.hottext', Widget_HT, match);
Widget_HT.prototype.load = function() {
var containerEl = this.element;
var interactionNode = this.config;
var interactionDoc = interactionNode.ownerDocument;
var interactionId = this.id;
QTI.replaceNodes(interactionNode, 'hottext', function(htNode) {
var span = interactionDoc.createElement('span');
span.setAttribute('class', 'interaction selectable');
span.setAttribute('data-its-group', interactionId);
span.setAttribute('data-its-identifier', htNode.getAttribute('identifier'));
return span;
});
var interactionEl = QTI.createInteractionElement(interactionNode);
this.interaction = new TDS.SelectInteraction('select-' + this.id);
this.interaction.load(interactionEl);
containerEl.appendChild(interactionEl);
}
Widget_HT.prototype.getResponse = function () {
var values = this.interaction.getResponseArray();
var isValid = this.interaction.validateResponse();
return this.createResponse(values, isValid);
}
Widget_HT.prototype.setResponse = function (values) {
this.interaction.loadResponseIDs(values);
}
})(window.ContentManager);

/* SOURCE FILE: qti.order.js (ba0539c2) 10/26/2014 1:27:05 PM */

(function (CM) {
var QTI = CM.QTI;
var match = QTI.createWidgetMatch('orderInteraction');
function Widget_Order(page, item, config) {
this.dataType = CM.DataType.Array;
this.options = {
autoLoad: true
}
this.interaction = null;
}
CM.registerWidget('qti.order', Widget_Order, match);
Widget_Order.prototype.load = function () {
var containerEl = this.element;
var interactionNode = this.config;
var interactionDoc = interactionNode.ownerDocument;
var interactionId = this.id;
QTI.replacePrompt(interactionNode);
var listEl = interactionDoc.createElement('ul');
listEl.setAttribute('class', 'interaction order-group');
listEl.setAttribute('data-its-identifier', this.id);
var choiceSpans = QTI.replaceNodes(interactionNode, 'simpleChoice', function (simpleNode) {
var span = interactionDoc.createElement('li');
span.setAttribute('class', 'interaction order-choice');
span.setAttribute('data-its-group', interactionId);
span.setAttribute('data-its-identifier', simpleNode.getAttribute('identifier'));
return span;
});
$(choiceSpans).appendTo(listEl);
$(listEl).appendTo(interactionNode);
var interactionEl = QTI.createInteractionElement(interactionNode);
this.interaction = new TDS.OrderInteraction('order-' + this.id);
this.interaction.load(interactionEl);
containerEl.appendChild(interactionEl);
}
Widget_Order.prototype.getResponse = function () {
var values = this.interaction.getResponseJson()[0].responses;
var isValid = this.interaction.validateResponse();
return this.createResponse(values, isValid);
}
Widget_Order.prototype.setResponse = function (values) {
var group = this.interaction.getGroup(this.id);
group.sort(values);
}
})(window.ContentManager);

/* SOURCE FILE: its.container.js (7e26c53b) 9/9/2014 2:08:53 PM */

(function (CM) {
function Container() {
}
CM.registerResponseContainer('Interactions', Container);
Container.prototype.create = function (responses) {
var xmlDoc = Util.Xml.parseFromString('<interactions></interactions>');
var rootNode = xmlDoc.documentElement;
responses.forEach(function (response) {
var interactionDoc = response.value;
var interactionNode = interactionDoc.documentElement;
rootNode.appendChild(interactionNode);
});
return Util.Xml.serializeToString(xmlDoc);
}
Container.prototype.load = function (value, widgets) {
var xmlDoc = Util.Xml.parseFromString(value);
var rootNode = xmlDoc.documentElement;
$('interaction', rootNode).each(function (idx, node) {
var id = node.getAttribute('identifier');
var widget = Util.Array.find(widgets, function (widget) {
return widget.id == id;
});
if (widget) {
widget.setResponse(node);
}
});
}
CM.mapResponseContainer('HT', 'Interactions');
CM.mapResponseContainer('HTQ', 'QTI');
})(window.ContentManager);

/* SOURCE FILE: its.select.js (61517754) 9/9/2014 2:08:53 PM */

(function (CM) {
function isQTIResponse(item) {
return item.format.toUpperCase() == 'HTQ';
}
function match(page, item) {
if (!item.isResponseType('Hottext')) return false;
var stemEl = item.getStemElement();
var $selectables = $('span.interaction.selectable', stemEl);
if ($selectables.length > 0) {
var groupId = $selectables.attr('data-its-group');
return new CM.WidgetConfig(groupId, stemEl);
}
return false;
}
function Widget_Select(page, item, config) {
this.dataType = isQTIResponse(item) ? CM.DataType.Array : CM.DataType.Xml;
this.options = {
autoLoad: true
}
this.interaction = null;
}
CM.registerWidget('select', Widget_Select, match);
Widget_Select.prototype.load = function () {
var item = this.entity;
var stemEl = this.element;
var interaction = new TDS.SelectInteraction(this.id);
interaction.load(stemEl);
this.interaction = interaction;
var constraints = Util.Array.find(item.specs, function (spec) {
return spec.nodeName == 'constraints';
});
if (constraints) {
Util.Dom.queryTagsBatch('cardinality', constraints, function (el) {
var id = Util.Xml.getAttribute(el, 'target');
var min = Util.Xml.getAttributeInt(el, 'min');
var max = Util.Xml.getAttributeInt(el, 'max');
interaction.setCardinality(id, min, max);
});
}
}
Widget_Select.prototype.getComponents = function () {
return this.interaction.getChoices().map(function(choice) {
return choice.getElement();
});
}
Widget_Select.prototype.getResponse = function () {
var data;
if (isQTIResponse(this.entity)) {
data = this.interaction.getResponseArray();
} else {
data = this.interaction.getResponseXml();
}
var isValid = this.interaction.validateResponse();
return this.createResponse(data, isValid);
}
Widget_Select.prototype.setResponse = function (data) {
if (isQTIResponse(this.entity)) {
this.interaction.loadResponseIDs(data);
} else {
this.interaction.loadResponseXml(data);
}
}
})(window.ContentManager);

/* SOURCE FILE: its.order.js (e9ce933e) 9/9/2014 2:08:53 PM */

(function (CM) {
function isQTIResponse(item) {
return item.format.toUpperCase() == 'HTQ';
}
function match(page, item) {
if (!item.isResponseType('Hottext')) return false;
var stemEl = item.getStemElement();
var $groups = $('ul.interaction.order-group', stemEl);
if ($groups.length > 0) {
var groupId = $groups.attr('data-its-identifier');
if (!groupId) {
throw new Error('Order interaction missing group id: ' + $groups.html().split('>')[0] + '>');
}
return new CM.WidgetConfig(groupId, stemEl);
}
return false;
}
function Widget_Order_ITS(page, item, config) {
this.dataType = isQTIResponse(item) ? CM.DataType.Array : CM.DataType.Xml;
this.options = {
autoLoad: true
}
this.interaction = null;
}
CM.registerWidget('order', Widget_Order_ITS, match);
Widget_Order_ITS.prototype.load = function () {
var stemEl = this.element;
this.interaction = new TDS.OrderInteraction(this.id);
this.interaction.load(stemEl);
}
Widget_Order_ITS.prototype.getResponseDataType = function () {
if (isQTIResponse(this.entity)) {
return CM.DataType.Array;
} else {
return CM.DataType.Xml;
}
}
Widget_Order_ITS.prototype.getResponse = function () {
var data;
if (isQTIResponse(this.entity)) {
data = this.interaction.getResponseJson()[0].responses;
} else {
data = this.interaction.getResponseXml();
}
var isValid = this.interaction.validateResponse();
return this.createResponse(data, isValid);
}
Widget_Order_ITS.prototype.setResponse = function (data) {
if (isQTIResponse(this.entity)) {
var group = this.interaction.getGroup(this.id);
group.sort(data);
} else {
this.interaction.loadResponseXml(data);
}
}
})(window.ContentManager);

/* SOURCE FILE: its.dragdrop.js (bd1acff0) 9/9/2014 2:08:53 PM */

(function (CM) {
function match(page, item) {
if (!item.isResponseType('Hottext')) return false;
var stemEl = item.getStemElement();
var $draggables = $('span.interaction.draggable', stemEl);
if ($draggables.length > 0) {
var id = 'dd-' + item.getID();
return new CM.WidgetConfig(id, stemEl);
}
return false;
}
function Widget_DD(page, item, config) {
this.dataType = CM.DataType.Xml;
this.options = {
autoLoad: true
}
this.interaction = null;
}
CM.registerWidget('dragdrop', Widget_DD, match);
Widget_DD.prototype.load = function () {
var page = this.page;
var stemEl = this.element;
var dd = new TDS.DDInteraction(this.id);
this.interaction = dd;
dd.load(stemEl);
var draggables = dd.getDraggables();
if (draggables.length > 0) {
var pageElement = page.getElement();
var scrollContainer = Util.Dom.getElementByClassName('theQuestions', 'div', pageElement);
if (scrollContainer) {
for (var i = 0; i < draggables.length; i++) {
var ddProxy = draggables[i].getProxy();
ddProxy.setScrollDirection(true, true);
ddProxy.setParentScroll(scrollContainer);
}
}
}
}
Widget_DD.prototype.getResponse = function () {
var data = this.interaction.getResponseXml();
var isValid = this.interaction.validateResponse();
return this.createResponse(data, isValid);
}
Widget_DD.prototype.setResponse = function (data) {
this.interaction.loadResponseXml(data);
}
})(window.ContentManager);

/* SOURCE FILE: drawing.js (dc06287d) 9/9/2014 2:09:01 PM */

function createLine(x1, y1, x2, y2)
{
var line = document.createElement('a');
if (YAHOO.env.ua.ie > 0 && YAHOO.env.ua.ie < 9) {
line.className = 'line ieline';
} else {
line.className = 'line';
}
updateLine(line, x1, y1, x2, y2);
return line;
}
function updateLine(line, x1, y1, x2, y2)
{
if (x2 < x1)
{
var temp = x1;
x1 = x2;
x2 = temp;
temp = y1;
y1 = y2;
y2 = temp;
}
var length = Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));
line.style.width = length + 'px';
if (YAHOO.env.ua.ie > 0 && YAHOO.env.ua.ie < 9)
{
line.style.top = (y2 > y1) ? y1 + 'px' : y2 + 'px';
line.style.left = x1 + 'px';
var nCos = (x2 - x1) / length;
var nSin = (y2 - y1) / length;
line.style.filter = 'progid:DXImageTransform.Microsoft.Matrix(sizingMethod=\'auto expand\', M11=' + nCos + ', M12=' + (-1 * nSin) + ', M21=' + nSin + ', M22=' + nCos + ')';
}
else
{
var angle = Math.atan((y2 - y1) / (x2 - x1));
line.style.top = y1 + 0.5 * length * Math.sin(angle) + 'px';
line.style.left = x1 - 0.5 * length * (1 - Math.cos(angle)) + 'px';
var property = getTransformProperty(line);
line.style[property] = 'rotate(' + angle + 'rad)';
}
return line;
}
function getTransformProperty(element) {
var properties = [
'transform',
'WebkitTransform',
'msTransform',
'MozTransform',
'OTransform'
];
var p;
while (p = properties.shift()) {
if (typeof element.style[p] != 'undefined') {
return p;
}
}
return false;
}

/* SOURCE FILE: mi.html.js (868451dd) 10/26/2014 1:27:05 PM */

MatchItem = (typeof (MatchItem) == "undefined") ? {} : MatchItem;
MatchItem.ListHtmlGenerator = function (discriminator) {
var getDivId = function (str) { return (discriminator ? discriminator + str : str); };
var self = this;
this.cellFactory = MatchItem.ListCellHtml.Create;
var lineUl = document.createElement('ul');
this.tabbableSpans = [];
var choiceItems = [];
this.getClickableHeader = function(choiceItem) {
return choiceItem.elementContainer;
};
this.createHeaderElement = function (choiceItem, scope) {
choiceItem.elementContainer = document.createElement('li');
var divId = getDivId('li-' + choiceItem.identifier + '-' + scope);
choiceItem.elementContainer.setAttribute('id', divId);
choiceItem.element = document.createElement('div');
YUD.setAttribute(choiceItem.element, 'tabindex', '0');
YUD.addClass(choiceItem.element, 'innerContainer');
choiceItem.element.innerHTML = choiceItem.value;
choiceItem.elementContainer.appendChild(choiceItem.element);
choiceItem.lineUl = lineUl;
this.tabbableSpans.push(choiceItem.elementContainer);
choiceItems[divId] = choiceItem;
};
this.createTableHeaderRows = function (prompt) {
self.headerDiv = document.createElement('div');
YUD.addClass(self.headerDiv, 'matchItemLines');
YUD.setAttribute(self.headerDiv, 'id', getDivId('matchItemLinesId'));
self.headerRow = document.createElement('ul');
YUD.addClass(self.headerRow, 'matchColumn matchFirstColumn');
self.headerColumn = document.createElement('ul');
YUD.addClass(self.headerColumn, 'matchColumn matchSecondColumn');
YUD.addClass(lineUl, 'matchConnections');
self.headerDiv.appendChild(self.headerRow);
self.headerDiv.appendChild(self.headerColumn);
self.headerDiv.appendChild(lineUl);
};
this.addColumnToHeaderRow = function (column) {
self.headerColumn.appendChild(column.elementContainer);
};
this.createTable = function (table, captionText) {
var caption = document.createElement('div');
Util.Dom.setTextContent(caption, captionText);
table.appendChild(self.headerDiv);
};
this.attachRowToTable = function (row) {
self.headerRow.appendChild(row.elementContainer);
};
this.setSelected = function (val, choiceItem) {
if (val) {
YUD.addClass(choiceItem.elementContainer, 'matchSelected');
} else {
YUD.removeClass(choiceItem.elementContainer, 'matchSelected');
}
};
this.setHeaderCallback = function (choiceItem, func) {
YUE.addListener(choiceItem.element, 'click', function (evt) {
func(choiceItem);
});
};
this.setItemChecked = function (header, val) {
if (val) {
YUD.addClass(header.elementContainer, 'matchMade');
} else {
YUD.removeClass(header.elementContainer, 'matchMade');
}
};
};
MatchItem.TableHtmlGenerator = function (discriminator) {
var self = this;
this.cellFactory = MatchItem.TableCellHtml.Create;
this.getClickableHeader = function (choiceItem) {
return null;
};
this.createHeaderElement = function (choiceItem, scope) {
choiceItem.element = document.createElement('th');
choiceItem.element.setAttribute('scope', scope);
choiceItem.element.innerHTML= choiceItem.value;
if (scope == 'row') {
choiceItem.elementContainer = document.createElement('tr');
choiceItem.elementContainer.appendChild(choiceItem.element);
}
};
this.createTableHeaderRows = function (prompt) {
self.headerRow = document.createElement('tr');
self.promptCell = document.createElement('td');
self.promptCell.innerHTML = prompt;
YUD.addClass(self.promptCell, 'matchItem_cellSpacer');
self.headerRow.appendChild(self.promptCell);
};
this.addColumnToHeaderRow = function (column) {
self.headerRow.appendChild(column.element);
};
this.setSelected = function (val, choiceItem) {
};
this.setHeaderCallback = function (choiceItem) {
};
this.createTable = function (parentDiv, captionText) {
var table = document.createElement('table');
var thead = document.createElement('THEAD');
self.tbody = document.createElement('TBODY');
if (captionText && captionText.length > 0) {
var caption = document.createElement('caption');
Util.Dom.setTextContent(caption, captionText);
table.appendChild(caption);
}
thead.appendChild(self.headerRow);
table.appendChild(thead);
table.appendChild(self.tbody);
parentDiv.appendChild(table);
};
this.setItemChecked = function(header,val) {
};
this.attachRowToTable = function (row) {
self.tbody.appendChild(row.elementContainer);
};
};
MatchItem.TableCellHtml = function (id, label, discriminator) {
var cellElement;
var checkboxElement;
var getDivId = function (str) { return (discriminator ? discriminator + str : str); };
this.getCheckbox = function () { return checkboxElement; };
cellElement = document.createElement('td');
checkboxElement = document.createElement('input');
checkboxElement.type = 'checkbox';
var lelem = document.createElement('label');
lelem.setAttribute('for', id);
lelem.innerHTML = label;
var spanNodes = lelem.getElementsByTagName('span');
var spanNodesToRemove = [];
var spanNode;
for (var spanIndex = 0; spanIndex < spanNodes.length; ++spanIndex) {
spanNode = spanNodes[spanIndex];
if (spanNode.hasAttribute('data-tag-boundary')) {
var spanAttrValue = spanNode.getAttribute('data-tag-boundary');
if (spanAttrValue === 'start' || spanAttrValue === 'end') {
spanNodesToRemove.push(spanNode);
}
}
}
for (var removeIndex = 0; removeIndex < spanNodesToRemove.length; ++removeIndex) {
spanNode = spanNodesToRemove[removeIndex];
spanNode.parentNode.removeChild(spanNode);
}
var par = lelem.getElementsByTagName('p');
while (par != null && par.length > 0) {
var p = par[0];
var span = document.createElement('span');
span.innerHTML = p.innerHTML;
p.parentNode.replaceChild(span,p);
par = lelem.getElementsByTagName('p');
}
cellElement.appendChild(checkboxElement);
cellElement.appendChild(lelem);
YUD.setAttribute(checkboxElement, 'id', id);
this.attachToRow = function (rowElement) {
rowElement.appendChild(cellElement);
};
this.isChecked = function () {
return checkboxElement.checked;
};
this.setChecked = function (val) {
checkboxElement.checked = val;
var td = checkboxElement.parentNode;
if (val)
YUD.addClass(td, 'matchItem_cellChecked');
else
YUD.removeClass(td, 'matchItem_cellChecked');
};
var listenerFuncs = [];
this.addClickListener = function (func) {
listenerFuncs.push(func);
};
YUE.addListener(checkboxElement, 'click', function (ev) {
var cancelEvent = false;
for (var i = 0; i < listenerFuncs.length; ++i) {
if (!listenerFuncs[i](ev)) {
cancelEvent = true;
}
}
if (cancelEvent) {
ev.preventDefault();
} else {
var td = checkboxElement.parentNode;
if (checkboxElement.checked) {
YUD.addClass(td, 'matchItem_cellChecked');
} else {
YUD.removeClass(td, 'matchItem_cellChecked');
}
}
});
};
MatchItem.ListCellHtml = function (id, label, parentCell, discriminator) {
var cellElement;
var line;
cellElement = document.createElement('li');
this.attachToRow = function (rowElement) {
};
this.isChecked = function () {
return line != null;
};
this.getCheckbox = function () { return null; };
this.setChecked = function (val, parentSelected) {
if (val == false) {
if (line) {
cellElement.parentNode.removeChild(cellElement);
line.parentNode.removeChild(line);
line = null;
}
} else {
if (line == null) {
var row = parentCell.getRowItem().elementContainer;
var column = parentCell.getColumnItem().elementContainer;
if (row.offsetLeft > column.offsetLeft) {
var rrr = row;
row = column;
column = rrr;
}
var container = parentCell.getRowItem().lineUl;
var r1 = YUD.getRegion(row);
var r2 = YUD.getRegion(column);
var x1 = row.offsetLeft;
var y1 = row.offsetTop;
var x2 = column.offsetLeft;
var y2 = column.offsetTop;
x1 += r1.width;
y1 += r1.height / 2;
y2 += r2.height / 2;
line = createLine(x1, y1,
x2, y2);
Util.Dom.setTextContent(line, label);
container.appendChild(cellElement);
cellElement.appendChild(line);
}
if (parentSelected)
YUD.addClass(line, 'matchParentSelected');
else
YUD.removeClass(line, 'matchParentSelected');
}
};
var listenerFuncs = [];
this.addClickListener = function (func) {
listenerFuncs.push(func);
};
};
MatchItem.TableCellHtml.Create = function(id, label,parentCell,discriminator) {
return new MatchItem.TableCellHtml(id, label, parentCell, discriminator);
};
MatchItem.ListCellHtml.Create = function (id, label, parentCell, discriminator) {
return new MatchItem.ListCellHtml(id, label, parentCell, discriminator);
};

/* SOURCE FILE: mi.cell.js (754debf5) 10/26/2014 1:27:05 PM */

MatchItem = (typeof (MatchItem) == "undefined") ? {} : MatchItem;
MatchItem.Cell = function (id, rowIndex, colIndex, matrix, cellFactory) {
var row = rowIndex;
var column = colIndex;
this.getRow = function () { return row; };
this.getColumn = function () { return column; };
this.getRowItem = function () { return matrix.getRow(row); };
this.getColumnItem = function () { return matrix.getColumn(column); };
this.getCheckbox = function() { return presentation.getCheckbox(); };
var labelText = matrix.getRow(row).value + ' and ' + matrix.getColumn(column).value;
var presentation = cellFactory(id, labelText, this);
var onCheckFuncs = [];
this.onCheck = function (func) {
onCheckFuncs.push(func);
};
this.attachToRow = function (rowElement) {
presentation.attachToRow(rowElement);
};
this.isChecked = function () {
return presentation.isChecked();
};
this.setChecked = function (val, parentSelected) {
if (matrix.isReadOnly()) {
return;
}
presentation.setChecked(val, parentSelected);
checked = val;
};
this.redraw = function () {
if (checked) {
self.setChecked(false);
self.setChecked(true);
}
};
this.erase = function () {
if (checked) {
presentation.setChecked(false);
}
};
var checked = false;
var self = this;
presentation.addClickListener(function (ev) {
if (matrix.isReadOnly()) {
return false;
} else {
if (checked == true) {
self.setChecked(false);
}
for (var i = 0; i < onCheckFuncs.length; ++i) {
onCheckFuncs[i](self);
}
}
return true;
});
return this;
};

/* SOURCE FILE: mi.parse.js (a95f4894) 9/9/2014 2:09:01 PM */

MatchItem = (typeof (MatchItem) == "undefined") ? {} : MatchItem;
MatchItem.Parse = function (id) {
this.mid = id;
this.createFromFile = function (xmlUrl) {
var xmlhttp;
if ((typeof (window.XMLHttpRequest) == "function") ||
(typeof (window.XMLHttpRequest) == "object")) {
xmlhttp = new XMLHttpRequest();
}
else {
xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
}
xmlhttp.open("GET", xmlUrl, false);
xmlhttp.send();
var xmlDoc = xmlhttp.responseText;
return this.createFromXml(xmlDoc);
};
this.createFromXml = function (xmlDoc) {
var nodes = Util.Xml.parseFromString(xmlDoc);
var spanNodes = nodes.getElementsByTagName('span');
for (var spanIndex = 0; spanIndex < spanNodes.length; ++spanIndex) {
var spanNode = spanNodes[spanIndex];
if ((spanNode.childNodes.length === 0) && spanNode.hasAttribute('data-tag-boundary')) {
var spanAttrValue = spanNode.getAttribute('data-tag-boundary');
if (spanAttrValue === 'start' || spanAttrValue === 'end') {
spanNode.appendChild(document.createTextNode(''));
}
}
}
var docElement = nodes.documentElement;
var choiceXml;
if (docElement.tagName == 'matchInteraction') {
choiceXml = docElement;
} else {
var matchInteraction = docElement.getElementsByTagName('matchInteraction');
if ((matchInteraction == null) || matchInteraction.length != 1) {
return;
}
choiceXml = matchInteraction[0];
}
var readContent = function (choice) {
var rv = '';
for (var k = 0; k < choice.childNodes.length; ++k) {
if (choice.childNodes[k].nodeType == 1) {
rv = rv + Util.Xml.serializeToString(choice.childNodes[k]);
} else if (choice.childNodes[k].nodeType == 3) {
rv = rv + Util.Dom.getTextContent(choice.childNodes[k]);
}
}
return rv;
};
var processItemSet = function (choices) {
var itemAr = [];
var choiceItems = choices.getElementsByTagName('simpleAssociableChoice');
for (var j = 0; j < choiceItems.length; ++j) {
var choice = choiceItems[j];
var choiceItem = {
identifier: choice.getAttribute('identifier'),
matchMax: choice.getAttribute('matchMax'),
content: readContent(choice)
};
itemAr.push(choiceItem);
}
return itemAr;
};
this.maxAssociations = parseInt(choiceXml.getAttribute('maxAssociations'));
this.title = choiceXml.getAttribute('title');
this.forceTable = choiceXml.getAttribute('forceTable');
this.responseId = choiceXml.getAttribute('responseIdentifier');
this.shuffle = (choiceXml.getAttribute('shuffle') === 'true');
var choiceSets = choiceXml.getElementsByTagName('simpleMatchSet');
var promptNodes = choiceXml.getElementsByTagName('prompt');
this.prompt = (promptNodes && promptNodes.length > 0) ? Util.Dom.getTextContent(promptNodes[0]) : '';
this.rows = processItemSet(choiceSets[0]);
this.columns = processItemSet(choiceSets[1]);
};
};

/* SOURCE FILE: mi.matrix.js (b545f5a5) 9/9/2014 2:09:01 PM */

MatchItem.PermutationArray = function (size, shuffle) {
var ar = [];
for (var i = 0; i < size; ++i) {
ar.push(i);
if (shuffle && (i > 0)) {
var ix = (Math.floor(Math.random() * (i + 1)));
var p = ar[i];
ar[i] = ar[ix];
ar[ix] = p;
}
}
return ar;
};
MatchItem.Matrix = function (parseResult, htmlGenerator, discriminator) {
var rowHeaders = [];
var columnHeaders = [];
var cells = [];
var onChangedFuncs = [];
var addComponentArray = [];
var keyEventHandlerArray = [];
var prompt = "";
if (parseResult.prompt != null) {
prompt = parseResult.prompt;
}
var maxAssociations = parseResult.maxAssociations;
var shuffle = parseResult.shuffle;
var title = parseResult.title;
var cs = parseResult.columns;
var rs = parseResult.rows;
this.responseId = parseResult.responseId;
var self = this;
this.onChanged = function (func) {
onChangedFuncs.push(func);
};
this.getRow = function (index) {
return rowHeaders[index];
};
this.getColumn = function (index) {
return columnHeaders[index];
};
this.getRowCount = function () {
return rowHeaders.length;
};
this.getColumnCount = function () {
return columnHeaders.length;
};
this.getCell = function (r, c) {
return cells[this.index(rowHeaders[r].identifier, columnHeaders[c].identifier)];
};
this.violatesMatchMax = function (cell) {
var column = columnHeaders[cell.getColumn()];
var row = rowHeaders[cell.getRow()];
var rmax = row.matchMax;
var cmax = column.matchMax;
var orow, ocol;
var changed = false;
if ((cmax) && self.checksInColumn(cell.getColumn()) > cmax) {
cell.setChecked(false);
if (cmax == 1) {
ocol = getOnlyCheckInColumn(cell.getColumn());
if (rmax == 1)
orow = getOnlyCheckInRow(cell.getRow());
cell.setChecked(true);
}
} else if ((rmax) && self.checksInRow(cell.getRow()) > rmax) {
cell.setChecked(false);
if (rmax == 1) {
orow = getOnlyCheckInRow(cell.getRow());
if (cmax == 1)
ocol = getOnlyCheckInColumn(cell.getColumn());
cell.setChecked(true);
}
} else if ((maxAssociations) && self.countAssociations() > maxAssociations) {
cell.setChecked(false);
} else {
for (var i = 0; i < onChangedFuncs.length; ++i) {
onChangedFuncs[i](self);
}
}
if (orow) {
orow.setChecked(false);
}
if (ocol) {
ocol.setChecked(false);
}
};
this.isResponseValid = function() {
var value = this.getResult();
return (value && value.length > 0);
};
this.getResponseXML = function() {
var value = this.getResult();
var xmlDoc = Util.Xml.createDocument('itemResponse');
var xmlEl = xmlDoc.documentElement;
var responseXML = xmlDoc.createElement('response');
responseXML.setAttribute('id', this.responseId);
xmlEl.appendChild(responseXML);
if (value && value.length > 0) {
for (var i = 0; i < value.length; i++) {
var valueXML = xmlDoc.createElement('value');
valueXML.textContent = value[i];
responseXML.appendChild(valueXML);
}
}
var xmlStr = Util.Xml.serializeToString(xmlDoc);
return xmlStr;
};
this.getResult = function () {
var result = [];
this.forEachCell(function (cell) {
if (cell.isChecked()) {
var str = rowHeaders[cell.getRow()].identifier +
' ' +
columnHeaders[cell.getColumn()].identifier;
result.push(str);
}
});
return result;
};
this.setResultXML = function (resultXML) {
var xmlDoc = Util.Xml.parseFromString(resultXML);
var docEl = xmlDoc.documentElement;
var values = docEl.getElementsByTagName('value');
var result = [];
if (values && values.length >0 ) {
for (var i = 0; i < values.length; i++) {
result.push(values[i].textContent);
}
}
this.setResult(result);
};
this.setResult = function (ar) {
var i;
this.forEachCell(function (cell) {
var row = rowHeaders[cell.getRow()];
var col = columnHeaders[cell.getColumn()];
cell.setChecked(false);
htmlGenerator.setItemChecked(row, false);
htmlGenerator.setItemChecked(col, false);
});
if (ar == null)
return;
this.forEachCell(function (cell) {
for (i = 0; i < ar.length; ++i) {
var ar2 = ar[i].split(' ');
var row = rowHeaders[cell.getRow()];
var col = columnHeaders[cell.getColumn()];
var rowid = row.identifier;
var colid = col.identifier;
if ((ar2[0] == rowid) && (ar2[1] == colid)) {
cell.setChecked(true);
htmlGenerator.setItemChecked(row, true);
htmlGenerator.setItemChecked(col, true);
}
}
});
};
this.forEachCell = function (func) {
for (var i = 0; i < this.getRowCount(); ++i) {
for (var j = 0; j < this.getColumnCount(); ++j) {
var cell = this.getCell(i, j);
func(cell);
}
}
};
this.forEachRow = function (func) {
for (var i = 0; i < self.getRowCount(); ++i) {
func(self.getRow(i));
}
};
this.forEachColumn = function (func) {
for (var j = 0; j < self.getColumnCount(); ++j) {
func(self.getColumn(j));
}
};
var handleHeaderClick = function (header) {
var iterator, otherIterator;
var selectedRow = null;
var selectedCol = null;
if (header.isSelected) {
htmlGenerator.setSelected(false, header);
header.isSelected = false;
updateParentSelected(header);
return;
}
if (header.scope == 'row') {
otherIterator = self.forEachColumn;
iterator = self.forEachRow;
selectedRow = header;
} else {
otherIterator = self.forEachRow;
iterator = self.forEachColumn;
selectedCol = header;
}
iterator(function (entity) {
if ((entity.identifier != header.identifier) &&
(entity.isSelected == true)) {
entity.isSelected = false;
htmlGenerator.setSelected(false, entity);
}
});
otherIterator(function (entity) {
if (entity.isSelected) {
if (selectedRow == null) {
selectedRow = entity;
} else {
selectedCol = entity;
}
}
});
if (selectedRow && selectedCol) {
self.forEachCell(function (cell) {
if ((cell.getRowItem().identifier == selectedRow.identifier) &&
(cell.getColumnItem().identifier == selectedCol.identifier)) {
selectedRow.isSelected = false;
htmlGenerator.setSelected(false, selectedRow);
selectedCol.isSelected = false;
htmlGenerator.setSelected(false, selectedCol);
if (cell.isChecked() == false) {
cell.setChecked(true);
self.violatesMatchMax(cell);
} else {
cell.setChecked(false);
}
}
});
} else {
header.isSelected = true;
htmlGenerator.setSelected(true, header);
}
updateParentSelected(header);
};
var updateParentSelected = function (header) {
self.forEachCell(function (cell) {
if (cell.isChecked() == true) {
if ((rowHeaders[cell.getRow()].isSelected == true) ||
(columnHeaders[cell.getColumn()].isSelected == true)) {
cell.setChecked(true, true);
} else {
cell.setChecked(true, false);
}
}
});
self.forEachRow(function (row) {
if (self.checksInRow(row.index) > 0) {
htmlGenerator.setItemChecked(row, true);
} else {
htmlGenerator.setItemChecked(row, false);
}
});
self.forEachColumn(function (column) {
if (self.checksInColumn(column.index) > 0) {
htmlGenerator.setItemChecked(column, true);
} else {
htmlGenerator.setItemChecked(column, false);
}
});
};
var addHeader = function (xHeader, scopeString) {
var choiceItem = {
identifier: xHeader.identifier,
matchMax: parseInt(xHeader.matchMax),
value: xHeader.content,
element: null,
elementContainer: null,
isSelected: false,
scope: scopeString
};
htmlGenerator.createHeaderElement(choiceItem, scopeString);
htmlGenerator.setHeaderCallback(choiceItem, handleHeaderClick);
return choiceItem;
};
var addColumn = function (xHeader) {
var acol = addHeader(xHeader, 'col');
acol.index = columnHeaders.length;
columnHeaders.push(acol);
};
var addRow = function (xHeader) {
var arow = addHeader(xHeader, 'row');
arow.index = rowHeaders.length;
rowHeaders.push(arow);
return arow;
};
this.index = function (rowid, colid) {
return parseResult.mid + '-' + rowid + '-' + colid;
};
var addCell = function (row, col) {
var identifier = self.index(rowHeaders[row].identifier, columnHeaders[col].identifier);
var tmpCell = new MatchItem.Cell('micell-' + identifier, row, col, self, htmlGenerator.cellFactory, discriminator);
cells[identifier] = tmpCell;
tmpCell.attachToRow(rowHeaders[row].elementContainer);
tmpCell.onCheck(self.violatesMatchMax);
};
this.checksInColumn = function (ix) {
var rv = 0;
this.forEachCell(function (cell) {
if ((cell.getColumn() == ix) && cell.isChecked())
++rv;
});
return rv;
};
var getOnlyCheckInColumn = function (ix) {
var rv = null;
self.forEachCell(function (cell) {
if ((cell.getColumn() == ix) && cell.isChecked() &&
(columnHeaders[cell.getColumn()].matchMax == 1))
rv = cell;
});
return rv;
};
var getOnlyCheckInRow = function (ix) {
var rv = null;
self.forEachCell(function (cell) {
if ((cell.getRow() == ix) && cell.isChecked() &&
(rowHeaders[cell.getRow()].matchMax == 1))
rv = cell;
});
return rv;
};
this.checksInRow = function (ix) {
var rv = 0;
this.forEachCell(function (cell) {
if ((cell.getRow() == ix) && cell.isChecked())
++rv;
});
return rv;
};
this.countAssociations = function () {
var rv = 0;
this.forEachCell(function (cell) {
if (cell.isChecked())
++rv;
});
return rv;
};
this.attachTable = function (table) {
htmlGenerator.createTable(table, title);
for (var i = 0; i < rowHeaders.length; ++i) {
htmlGenerator.attachRowToTable(rowHeaders[i]);
}
};
this.eraseChecks = function () {
this.forEachCell(function (cell) {
cell.erase();
});
};
this.reDrawChecks = function () {
window.setTimeout(function () {
self.forEachCell(function (cell) {
cell.redraw();
});
}, 1);
};
var getParentElement = function (choiceItem) {
return choiceItem.elementContainer ? choiceItem.elementContainer : choiceItem.element;
};
htmlGenerator.createTableHeaderRows(prompt);
var colperms = MatchItem.PermutationArray(cs.length, parseResult.shuffle);
for (var colix = 0; colix < cs.length; ++colix) {
addColumn(cs[colperms[colix]]);
htmlGenerator.addColumnToHeaderRow(columnHeaders[colix]);
}
var rowperms = MatchItem.PermutationArray(rs.length, shuffle);
for (var rowix = 0; rowix < rs.length; ++rowix) {
addRow(rs[rowperms[rowix]]);
for (colix = 0; colix < columnHeaders.length; ++colix) {
addCell(rowix, colix);
}
}
this.getComponentArray = function () {
return addComponentArray;
};
this.handleKeyEvent = function(spanId, evt) {
if (spanId) {
var handleEnterKey = keyEventHandlerArray[spanId];
if ((handleEnterKey) && (typeof handleEnterKey == "function")) {
handleEnterKey();
}
}
};
var headerNavIterator = function (iterator) {
iterator(function (entity) {
var span = htmlGenerator.getClickableHeader(entity);
if ((span != null) && (span.id)) {
addComponentArray.push(span);
keyEventHandlerArray[span.id] = function () {
handleHeaderClick(entity);
};
}
});
};
headerNavIterator(this.forEachRow);
headerNavIterator(this.forEachColumn);
this.forEachCell(function (cell) {
var checkbox = cell.getCheckbox();
if ((checkbox) && (checkbox.id)) {
addComponentArray.push(checkbox);
keyEventHandlerArray[checkbox.id] = function() {
cell.setChecked(!(cell.isChecked()));
self.violatesMatchMax(cell);
};
}
});
};
MatchItem.Matrix.prototype.isReadOnly = function () { return false; };

/* SOURCE FILE: mi.widget.js (6926852b) 10/26/2014 1:27:05 PM */

(function(CM, MatchItem) {
if (!MatchItem) {
return;
}
function create(item, containerEl) {
var parseResult = new MatchItem.Parse(item.itemKey);
var qtiXml = (item.qti) ? item.qti.xml : item.rendererSpec;
if (qtiXml == null) {
return null;
}
parseResult.createFromXml(qtiXml);
var presentation;
if (item.isResponseType('TableMatch') || CM.isAccessibilityEnabled()) {
presentation = new MatchItem.TableHtmlGenerator(item.position);
} else {
presentation = new MatchItem.ListHtmlGenerator(item.position);
}
var discriminator = item.position;
var m1 = new MatchItem.Matrix(parseResult, presentation, discriminator);
m1.isReadOnly = item.isReadOnly.bind(item);
var componentArray = m1.getComponentArray();
for (var i = 0; i < componentArray.length; ++i) {
item.addComponent(componentArray[i]);
}
containerEl.innerHTML = '';
YUD.removeClass(containerEl, 'loading');
m1.attachTable(containerEl);
var onresize = window.onresize;
YUE.on(window, 'scroll', function() {
if (onresize != null) {
onresize();
}
if (item.isVisible()) {
m1.reDrawChecks();
}
});
if (item.value) {
m1.setResultXML(item.value);
}
return m1;
}
function match(page, item) {
var id = 'MatchContainer_' + item.position;
var el = document.getElementById(id);
if (el) {
return new CM.WidgetConfig(id, el);
}
return false;
}
function Widget_MI(page, item) {
this.matchItem = null;
}
CM.registerWidget('matchitem', Widget_MI, match);
Widget_MI.prototype.load = function() {
this.matchItem = create(this.entity, this.element);
};
Widget_MI.prototype.keyEvent = function(evt) {
if (evt.type != 'keydown') {
return;
}
if (evt.ctrlKey || evt.altKey) {
return;
}
var item = this.entity;
var matches = this.matchItem;
if (evt.key == 'Enter') {
if (item.isReadOnly()) {
return;
}
evt.stopPropagation();
var matchId = item.getActiveComponent().id;
if (matchId) {
matches.handleKeyEvent(matchId, evt);
}
}
};
Widget_MI.prototype.zoom = function(level) {
this.matchItem.reDrawChecks();
};
Widget_MI.prototype.show = function() {
this.matchItem.reDrawChecks();
};
Widget_MI.prototype.getResponse = function() {
var value = this.matchItem.getResponseXML();
var isValid = this.matchItem.isResponseValid();
return this.createResponse(value, isValid);
};
Widget_MI.prototype.setResponse = function(value) {
this.matchItem.setResultXML(value);
};
})(window.ContentManager, window.MatchItem);

/* SOURCE FILE: raphael-min.js (cced7c91) 9/9/2014 2:09:01 PM */

// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” \\
// â”‚ RaphaÃ«l 2.1.2 - JavaScript Vector Library                          â”‚ \\
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ \\
// â”‚ Copyright Â© 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)    â”‚ \\
// â”‚ Copyright Â© 2008-2012 Sencha Labs (http://sencha.com)              â”‚ \\
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ \\
// â”‚ Licensed under the MIT (http://raphaeljs.com/license.html) license.â”‚ \\
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ \\
!function(a){var b,c,d="0.4.2",e="hasOwnProperty",f=/[\.\/]/,g="*",h=function(){},i=function(a,b){return a-b},j={n:{}},k=function(a,d){a=String(a);var e,f=c,g=Array.prototype.slice.call(arguments,2),h=k.listeners(a),j=0,l=[],m={},n=[],o=b;b=a,c=0;for(var p=0,q=h.length;q>p;p++)"zIndex"in h[p]&&(l.push(h[p].zIndex),h[p].zIndex<0&&(m[h[p].zIndex]=h[p]));for(l.sort(i);l[j]<0;)if(e=m[l[j++]],n.push(e.apply(d,g)),c)return c=f,n;for(p=0;q>p;p++)if(e=h[p],"zIndex"in e)if(e.zIndex==l[j]){if(n.push(e.apply(d,g)),c)break;do if(j++,e=m[l[j]],e&&n.push(e.apply(d,g)),c)break;while(e)}else m[e.zIndex]=e;else if(n.push(e.apply(d,g)),c)break;return c=f,b=o,n.length?n:null};k._events=j,k.listeners=function(a){var b,c,d,e,h,i,k,l,m=a.split(f),n=j,o=[n],p=[];for(e=0,h=m.length;h>e;e++){for(l=[],i=0,k=o.length;k>i;i++)for(n=o[i].n,c=[n[m[e]],n[g]],d=2;d--;)b=c[d],b&&(l.push(b),p=p.concat(b.f||[]));o=l}return p},k.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(f),d=j,e=0,g=c.length;g>e;e++)d=d.n,d=d.hasOwnProperty(c[e])&&d[c[e]]||(d[c[e]]={n:{}});for(d.f=d.f||[],e=0,g=d.f.length;g>e;e++)if(d.f[e]==b)return h;return d.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}},k.f=function(a){var b=[].slice.call(arguments,1);return function(){k.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}},k.stop=function(){c=1},k.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b},k.nts=function(){return b.split(f)},k.off=k.unbind=function(a,b){if(!a)return void(k._events=j={n:{}});var c,d,h,i,l,m,n,o=a.split(f),p=[j];for(i=0,l=o.length;l>i;i++)for(m=0;m<p.length;m+=h.length-2){if(h=[m,1],c=p[m].n,o[i]!=g)c[o[i]]&&h.push(c[o[i]]);else for(d in c)c[e](d)&&h.push(c[d]);p.splice.apply(p,h)}for(i=0,l=p.length;l>i;i++)for(c=p[i];c.n;){if(b){if(c.f){for(m=0,n=c.f.length;n>m;m++)if(c.f[m]==b){c.f.splice(m,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[e](d)&&c.n[d].f){var q=c.n[d].f;for(m=0,n=q.length;n>m;m++)if(q[m]==b){q.splice(m,1);break}!q.length&&delete c.n[d].f}}else{delete c.f;for(d in c.n)c.n[e](d)&&c.n[d].f&&delete c.n[d].f}c=c.n}},k.once=function(a,b){var c=function(){return k.unbind(a,c),b.apply(this,arguments)};return k.on(a,c)},k.version=d,k.toString=function(){return"You are running Eve "+d},"undefined"!=typeof module&&module.exports?module.exports=k:"undefined"!=typeof define?define("eve",[],function(){return k}):a.eve=k}(window||this),function(a,b){"function"==typeof define&&define.amd?define(["eve"],function(c){return b(a,c)}):b(a,a.eve)}(this,function(a,b){function c(a){if(c.is(a,"function"))return u?a():b.on("raphael.DOMload",a);if(c.is(a,V))return c._engine.create[D](c,a.splice(0,3+c.is(a[0],T))).add(a);var d=Array.prototype.slice.call(arguments,0);if(c.is(d[d.length-1],"function")){var e=d.pop();return u?e.call(c._engine.create[D](c,d)):b.on("raphael.DOMload",function(){e.call(c._engine.create[D](c,d))})}return c._engine.create[D](c,arguments)}function d(a){if("function"==typeof a||Object(a)!==a)return a;var b=new a.constructor;for(var c in a)a[z](c)&&(b[c]=d(a[c]));return b}function e(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function f(a,b,c){function d(){var f=Array.prototype.slice.call(arguments,0),g=f.join("â€"),h=d.cache=d.cache||{},i=d.count=d.count||[];return h[z](g)?(e(i,g),c?c(h[g]):h[g]):(i.length>=1e3&&delete h[i.shift()],i.push(g),h[g]=a[D](b,f),c?c(h[g]):h[g])}return d}function g(){return this.hex}function h(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}function i(a,b,c,d,e){var f=-3*b+9*c-9*d+3*e,g=a*f+6*b-12*c+6*d;return a*g-3*b+3*c}function j(a,b,c,d,e,f,g,h,j){null==j&&(j=1),j=j>1?1:0>j?0:j;for(var k=j/2,l=12,m=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],o=0,p=0;l>p;p++){var q=k*m[p]+k,r=i(q,a,c,e,g),s=i(q,b,d,f,h),t=r*r+s*s;o+=n[p]*N.sqrt(t)}return k*o}function k(a,b,c,d,e,f,g,h,i){if(!(0>i||j(a,b,c,d,e,f,g,h)<i)){var k,l=1,m=l/2,n=l-m,o=.01;for(k=j(a,b,c,d,e,f,g,h,n);Q(k-i)>o;)m/=2,n+=(i>k?1:-1)*m,k=j(a,b,c,d,e,f,g,h,n);return n}}function l(a,b,c,d,e,f,g,h){if(!(O(a,c)<P(e,g)||P(a,c)>O(e,g)||O(b,d)<P(f,h)||P(b,d)>O(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(k){var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(!(n<+P(a,c).toFixed(2)||n>+O(a,c).toFixed(2)||n<+P(e,g).toFixed(2)||n>+O(e,g).toFixed(2)||o<+P(b,d).toFixed(2)||o>+O(b,d).toFixed(2)||o<+P(f,h).toFixed(2)||o>+O(f,h).toFixed(2)))return{x:l,y:m}}}}function m(a,b,d){var e=c.bezierBBox(a),f=c.bezierBBox(b);if(!c.isBBoxIntersect(e,f))return d?0:[];for(var g=j.apply(0,a),h=j.apply(0,b),i=O(~~(g/5),1),k=O(~~(h/5),1),m=[],n=[],o={},p=d?0:[],q=0;i+1>q;q++){var r=c.findDotsAtSegment.apply(c,a.concat(q/i));m.push({x:r.x,y:r.y,t:q/i})}for(q=0;k+1>q;q++)r=c.findDotsAtSegment.apply(c,b.concat(q/k)),n.push({x:r.x,y:r.y,t:q/k});for(q=0;i>q;q++)for(var s=0;k>s;s++){var t=m[q],u=m[q+1],v=n[s],w=n[s+1],x=Q(u.x-t.x)<.001?"y":"x",y=Q(w.x-v.x)<.001?"y":"x",z=l(t.x,t.y,u.x,u.y,v.x,v.y,w.x,w.y);if(z){if(o[z.x.toFixed(4)]==z.y.toFixed(4))continue;o[z.x.toFixed(4)]=z.y.toFixed(4);var A=t.t+Q((z[x]-t[x])/(u[x]-t[x]))*(u.t-t.t),B=v.t+Q((z[y]-v[y])/(w[y]-v[y]))*(w.t-v.t);A>=0&&1.001>=A&&B>=0&&1.001>=B&&(d?p++:p.push({x:z.x,y:z.y,t1:P(A,1),t2:P(B,1)}))}}return p}function n(a,b,d){a=c._path2curve(a),b=c._path2curve(b);for(var e,f,g,h,i,j,k,l,n,o,p=d?0:[],q=0,r=a.length;r>q;q++){var s=a[q];if("M"==s[0])e=i=s[1],f=j=s[2];else{"C"==s[0]?(n=[e,f].concat(s.slice(1)),e=n[6],f=n[7]):(n=[e,f,e,f,i,j,i,j],e=i,f=j);for(var t=0,u=b.length;u>t;t++){var v=b[t];if("M"==v[0])g=k=v[1],h=l=v[2];else{"C"==v[0]?(o=[g,h].concat(v.slice(1)),g=o[6],h=o[7]):(o=[g,h,g,h,k,l,k,l],g=k,h=l);var w=m(n,o,d);if(d)p+=w;else{for(var x=0,y=w.length;y>x;x++)w[x].segment1=q,w[x].segment2=t,w[x].bez1=n,w[x].bez2=o;p=p.concat(w)}}}}}return p}function o(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function p(){return this.x+H+this.y+H+this.width+" Ã— "+this.height}function q(a,b,c,d,e,f){function g(a){return((l*a+k)*a+j)*a}function h(a,b){var c=i(a,b);return((o*c+n)*c+m)*c}function i(a,b){var c,d,e,f,h,i;for(e=a,i=0;8>i;i++){if(f=g(e)-a,Q(f)<b)return e;if(h=(3*l*e+2*k)*e+j,Q(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=g(e),Q(f-a)<b)return e;a>f?c=e:d=e,e=(d-c)/2+c}return e}var j=3*b,k=3*(d-b)-j,l=1-j-k,m=3*c,n=3*(e-c)-m,o=1-m-n;return h(a,1/(200*f))}function r(a,b){var c=[],d={};if(this.ms=b,this.times=1,a){for(var e in a)a[z](e)&&(d[_(e)]=a[e],c.push(_(e)));c.sort(lb)}this.anim=d,this.top=c[c.length-1],this.percents=c}function s(a,d,e,f,g,h){e=_(e);var i,j,k,l,m,n,p=a.ms,r={},s={},t={};if(f)for(v=0,x=ic.length;x>v;v++){var u=ic[v];if(u.el.id==d.id&&u.anim==a){u.percent!=e?(ic.splice(v,1),k=1):j=u,d.attr(u.totalOrigin);break}}else f=+s;for(var v=0,x=a.percents.length;x>v;v++){if(a.percents[v]==e||a.percents[v]>f*a.top){e=a.percents[v],m=a.percents[v-1]||0,p=p/a.top*(e-m),l=a.percents[v+1],i=a.anim[e];break}f&&d.attr(a.anim[a.percents[v]])}if(i){if(j)j.initstatus=f,j.start=new Date-j.ms*f;else{for(var y in i)if(i[z](y)&&(db[z](y)||d.paper.customAttributes[z](y)))switch(r[y]=d.attr(y),null==r[y]&&(r[y]=cb[y]),s[y]=i[y],db[y]){case T:t[y]=(s[y]-r[y])/p;break;case"colour":r[y]=c.getRGB(r[y]);var A=c.getRGB(s[y]);t[y]={r:(A.r-r[y].r)/p,g:(A.g-r[y].g)/p,b:(A.b-r[y].b)/p};break;case"path":var B=Kb(r[y],s[y]),C=B[1];for(r[y]=B[0],t[y]=[],v=0,x=r[y].length;x>v;v++){t[y][v]=[0];for(var D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(C[v][D]-r[y][v][D])/p}break;case"transform":var G=d._,H=Pb(G[y],s[y]);if(H)for(r[y]=H.from,s[y]=H.to,t[y]=[],t[y].real=!0,v=0,x=r[y].length;x>v;v++)for(t[y][v]=[r[y][v][0]],D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(s[y][v][D]-r[y][v][D])/p;else{var K=d.matrix||new o,L={_:{transform:G.transform},getBBox:function(){return d.getBBox(1)}};r[y]=[K.a,K.b,K.c,K.d,K.e,K.f],Nb(L,s[y]),s[y]=L._.transform,t[y]=[(L.matrix.a-K.a)/p,(L.matrix.b-K.b)/p,(L.matrix.c-K.c)/p,(L.matrix.d-K.d)/p,(L.matrix.e-K.e)/p,(L.matrix.f-K.f)/p]}break;case"csv":var M=I(i[y])[J](w),N=I(r[y])[J](w);if("clip-rect"==y)for(r[y]=N,t[y]=[],v=N.length;v--;)t[y][v]=(M[v]-r[y][v])/p;s[y]=M;break;default:for(M=[][E](i[y]),N=[][E](r[y]),t[y]=[],v=d.paper.customAttributes[y].length;v--;)t[y][v]=((M[v]||0)-(N[v]||0))/p}var O=i.easing,P=c.easing_formulas[O];if(!P)if(P=I(O).match(Z),P&&5==P.length){var Q=P;P=function(a){return q(a,+Q[1],+Q[2],+Q[3],+Q[4],p)}}else P=nb;if(n=i.start||a.start||+new Date,u={anim:a,percent:e,timestamp:n,start:n+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:p,easing:P,from:r,diff:t,to:s,el:d,callback:i.callback,prev:m,next:l,repeat:h||a.times,origin:d.attr(),totalOrigin:g},ic.push(u),f&&!j&&!k&&(u.stop=!0,u.start=new Date-p*f,1==ic.length))return kc();k&&(u.start=new Date-u.ms*f),1==ic.length&&jc(kc)}b("raphael.anim.start."+d.id,d,a)}}function t(a){for(var b=0;b<ic.length;b++)ic[b].el.paper==a&&ic.splice(b--,1)}c.version="2.1.2",c.eve=b;var u,v,w=/[, ]+/,x={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},y=/\{(\d+)\}/g,z="hasOwnProperty",A={doc:document,win:a},B={was:Object.prototype[z].call(A.win,"Raphael"),is:A.win.Raphael},C=function(){this.ca=this.customAttributes={}},D="apply",E="concat",F="ontouchstart"in A.win||A.win.DocumentTouch&&A.doc instanceof DocumentTouch,G="",H=" ",I=String,J="split",K="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[J](H),L={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},M=I.prototype.toLowerCase,N=Math,O=N.max,P=N.min,Q=N.abs,R=N.pow,S=N.PI,T="number",U="string",V="array",W=Object.prototype.toString,X=(c._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),Y={NaN:1,Infinity:1,"-Infinity":1},Z=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,$=N.round,_=parseFloat,ab=parseInt,bb=I.prototype.toUpperCase,cb=c._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},db=c._availableAnimAttrs={blur:T,"clip-rect":"csv",cx:T,cy:T,fill:"colour","fill-opacity":T,"font-size":T,height:T,opacity:T,path:"path",r:T,rx:T,ry:T,stroke:"colour","stroke-opacity":T,"stroke-width":T,transform:"transform",width:T,x:T,y:T},eb=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,fb={hs:1,rg:1},gb=/,?([achlmqrstvxz]),?/gi,hb=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ib=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,jb=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,kb=(c._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),lb=function(a,b){return _(a)-_(b)},mb=function(){},nb=function(a){return a},ob=c._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},pb=function(a,b,c,d){return null==d&&(d=c),[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},qb=c._getPath={path:function(a){return a.attr("path")},circle:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.r)},ellipse:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.rx,b.ry)},rect:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height,b.r)},image:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height)},text:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)},set:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)}},rb=c.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=Kb(a),e=0,g=a.length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a};if(c._g=A,c.type=A.win.SVGAngle||A.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==c.type){var sb,tb=A.doc.createElement("div");if(tb.innerHTML='<v:shape adj="1"/>',sb=tb.firstChild,sb.style.behavior="url(#default#VML)",!sb||"object"!=typeof sb.adj)return c.type=G;tb=null}c.svg=!(c.vml="VML"==c.type),c._Paper=C,c.fn=v=C.prototype=c.prototype,c._id=0,c._oid=0,c.is=function(a,b){return b=M.call(b),"finite"==b?!Y[z](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||W.call(a).slice(8,-1).toLowerCase()==b},c.angle=function(a,b,d,e,f,g){if(null==f){var h=a-d,i=b-e;return h||i?(180+180*N.atan2(-i,-h)/S+360)%360:0}return c.angle(a,b,f,g)-c.angle(d,e,f,g)},c.rad=function(a){return a%360*S/180},c.deg=function(a){return 180*a/S%360},c.snapTo=function(a,b,d){if(d=c.is(d,"finite")?d:10,c.is(a,V)){for(var e=a.length;e--;)if(Q(a[e]-b)<=d)return a[e]}else{a=+a;var f=b%a;if(d>f)return b-f;if(f>a-d)return b-f+a}return b};c.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*N.random()|0,c="x"==a?b:3&b|8;return c.toString(16)});c.setWindow=function(a){b("raphael.setWindow",c,A.win,a),A.win=a,A.doc=A.win.document,c._engine.initWin&&c._engine.initWin(A.win)};var ub=function(a){if(c.vml){var b,d=/^\s+|\s+$/g;try{var e=new ActiveXObject("htmlfile");e.write("<body>"),e.close(),b=e.body}catch(g){b=createPopup().document.body}var h=b.createTextRange();ub=f(function(a){try{b.style.color=I(a).replace(d,G);var c=h.queryCommandValue("ForeColor");return c=(255&c)<<16|65280&c|(16711680&c)>>>16,"#"+("000000"+c.toString(16)).slice(-6)}catch(e){return"none"}})}else{var i=A.doc.createElement("i");i.title="RaphaÃ«l Colour Picker",i.style.display="none",A.doc.body.appendChild(i),ub=f(function(a){return i.style.color=a,A.doc.defaultView.getComputedStyle(i,G).getPropertyValue("color")})}return ub(a)},vb=function(){return"hsb("+[this.h,this.s,this.b]+")"},wb=function(){return"hsl("+[this.h,this.s,this.l]+")"},xb=function(){return this.hex},yb=function(a,b,d){if(null==b&&c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(d=a.b,b=a.g,a=a.r),null==b&&c.is(a,U)){var e=c.getRGB(a);a=e.r,b=e.g,d=e.b}return(a>1||b>1||d>1)&&(a/=255,b/=255,d/=255),[a,b,d]},zb=function(a,b,d,e){a*=255,b*=255,d*=255;var f={r:a,g:b,b:d,hex:c.rgb(a,b,d),toString:xb};return c.is(e,"finite")&&(f.opacity=e),f};c.color=function(a){var b;return c.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):c.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(c.is(a,"string")&&(a=c.getRGB(a)),c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=xb,a},c.hsb2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Q(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)},c.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100),a*=360;var e,f,g,h,i;return a=a%360/60,i=2*b*(.5>c?c:1-c),h=i*(1-Q(a%2-1)),e=f=g=c-i/2,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)},c.rgb2hsb=function(a,b,c){c=yb(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g;return f=O(a,b,c),g=f-P(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=(d+360)%6*60/360,e=0==g?0:g/f,{h:d,s:e,b:f,toString:vb}},c.rgb2hsl=function(a,b,c){c=yb(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g,h,i;return g=O(a,b,c),h=P(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=(d+360)%6*60/360,f=(g+h)/2,e=0==i?0:.5>f?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:wb}},c._path2string=function(){return this.join(",").replace(gb,"$1")};c._preload=function(a,b){var c=A.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top:-9999em",c.onload=function(){b.call(this),this.onload=null,A.doc.body.removeChild(this)},c.onerror=function(){A.doc.body.removeChild(this)},A.doc.body.appendChild(c),c.src=a};c.getRGB=f(function(a){if(!a||(a=I(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:g};!(fb[z](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=ub(a));var b,d,e,f,h,i,j=a.match(X);return j?(j[2]&&(e=ab(j[2].substring(5),16),d=ab(j[2].substring(3,5),16),b=ab(j[2].substring(1,3),16)),j[3]&&(e=ab((h=j[3].charAt(3))+h,16),d=ab((h=j[3].charAt(2))+h,16),b=ab((h=j[3].charAt(1))+h,16)),j[4]&&(i=j[4][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),"rgba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100)),j[5]?(i=j[5][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||"Â°"==i[0].slice(-1))&&(b/=360),"hsba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsb2rgb(b,d,e,f)):j[6]?(i=j[6][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||"Â°"==i[0].slice(-1))&&(b/=360),"hsla"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsl2rgb(b,d,e,f)):(j={r:b,g:d,b:e,toString:g},j.hex="#"+(16777216|e|d<<8|b<<16).toString(16).slice(1),c.is(f,"finite")&&(j.opacity=f),j)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g}},c),c.hsb=f(function(a,b,d){return c.hsb2rgb(a,b,d).hex}),c.hsl=f(function(a,b,d){return c.hsl2rgb(a,b,d).hex}),c.rgb=f(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)}),c.getColor=function(a){var b=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||.75},c=this.hsb2rgb(b.h,b.s,b.b);return b.h+=.075,b.h>1&&(b.h=0,b.s-=.2,b.s<=0&&(this.getColor.start={h:0,s:1,b:b.b})),c.hex},c.getColor.reset=function(){delete this.start},c.parsePathString=function(a){if(!a)return null;var b=Ab(a);if(b.arr)return Cb(b.arr);var d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},e=[];return c.is(a,V)&&c.is(a[0],V)&&(e=Cb(a)),e.length||I(a).replace(hb,function(a,b,c){var f=[],g=b.toLowerCase();if(c.replace(jb,function(a,b){b&&f.push(+b)}),"m"==g&&f.length>2&&(e.push([b][E](f.splice(0,2))),g="l",b="m"==b?"l":"L"),"r"==g)e.push([b][E](f));else for(;f.length>=d[g]&&(e.push([b][E](f.splice(0,d[g]))),d[g]););}),e.toString=c._path2string,b.arr=Cb(e),e},c.parseTransformString=f(function(a){if(!a)return null;var b=[];return c.is(a,V)&&c.is(a[0],V)&&(b=Cb(a)),b.length||I(a).replace(ib,function(a,c,d){{var e=[];M.call(c)}d.replace(jb,function(a,b){b&&e.push(+b)}),b.push([c][E](e))}),b.toString=c._path2string,b});var Ab=function(a){var b=Ab.ps=Ab.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[z](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]};c.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=R(j,3),l=R(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,y=90-180*N.atan2(q-s,r-t)/S;return(q>s||t>r)&&(y+=180),{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:y}},c.bezierBBox=function(a,b,d,e,f,g,h,i){c.is(a,"array")||(a=[a,b,d,e,f,g,h,i]);var j=Jb.apply(null,a);return{x:j.min.x,y:j.min.y,x2:j.max.x,y2:j.max.y,width:j.max.x-j.min.x,height:j.max.y-j.min.y}},c.isPointInsideBBox=function(a,b,c){return b>=a.x&&b<=a.x2&&c>=a.y&&c<=a.y2},c.isBBoxIntersect=function(a,b){var d=c.isPointInsideBBox;return d(b,a.x,a.y)||d(b,a.x2,a.y)||d(b,a.x,a.y2)||d(b,a.x2,a.y2)||d(a,b.x,b.y)||d(a,b.x2,b.y)||d(a,b.x,b.y2)||d(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)},c.pathIntersection=function(a,b){return n(a,b)},c.pathIntersectionNumber=function(a,b){return n(a,b,1)},c.isPointInsidePath=function(a,b,d){var e=c.pathBBox(a);return c.isPointInsideBBox(e,b,d)&&n(a,[["M",b,d],["H",e.x2+10]],1)%2==1},c._removedFactory=function(a){return function(){b("raphael.log",null,"RaphaÃ«l: you are calling to method â€œ"+a+"â€ of removed object",a)}};var Bb=c.pathBBox=function(a){var b=Ab(a);if(b.bbox)return d(b.bbox);if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=Kb(a);for(var c,e=0,f=0,g=[],h=[],i=0,j=a.length;j>i;i++)if(c=a[i],"M"==c[0])e=c[1],f=c[2],g.push(e),h.push(f);else{var k=Jb(e,f,c[1],c[2],c[3],c[4],c[5],c[6]);g=g[E](k.min.x,k.max.x),h=h[E](k.min.y,k.max.y),e=c[5],f=c[6]}var l=P[D](0,g),m=P[D](0,h),n=O[D](0,g),o=O[D](0,h),p=n-l,q=o-m,r={x:l,y:m,x2:n,y2:o,width:p,height:q,cx:l+p/2,cy:m+q/2};return b.bbox=d(r),r},Cb=function(a){var b=d(a);return b.toString=c._path2string,b},Db=c._pathToRelative=function(a){var b=Ab(a);if(b.rel)return Cb(b.rel);c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a));var d=[],e=0,f=0,g=0,h=0,i=0;"M"==a[0][0]&&(e=a[0][1],f=a[0][2],g=e,h=f,i++,d.push(["M",e,f]));for(var j=i,k=a.length;k>j;j++){var l=d[j]=[],m=a[j];if(m[0]!=M.call(m[0]))switch(l[0]=M.call(m[0]),l[0]){case"a":l[1]=m[1],l[2]=m[2],l[3]=m[3],l[4]=m[4],l[5]=m[5],l[6]=+(m[6]-e).toFixed(3),l[7]=+(m[7]-f).toFixed(3);break;case"v":l[1]=+(m[1]-f).toFixed(3);break;case"m":g=m[1],h=m[2];default:for(var n=1,o=m.length;o>n;n++)l[n]=+(m[n]-(n%2?e:f)).toFixed(3)}else{l=d[j]=[],"m"==m[0]&&(g=m[1]+e,h=m[2]+f);for(var p=0,q=m.length;q>p;p++)d[j][p]=m[p]}var r=d[j].length;switch(d[j][0]){case"z":e=g,f=h;break;case"h":e+=+d[j][r-1];break;case"v":f+=+d[j][r-1];break;default:e+=+d[j][r-2],f+=+d[j][r-1]}}return d.toString=c._path2string,b.rel=Cb(d),d},Eb=c._pathToAbsolute=function(a){var b=Ab(a);if(b.abs)return Cb(b.abs);if(c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a)),!a||!a.length)return[["M",0,0]];var d=[],e=0,f=0,g=0,i=0,j=0;"M"==a[0][0]&&(e=+a[0][1],f=+a[0][2],g=e,i=f,j++,d[0]=["M",e,f]);for(var k,l,m=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),n=j,o=a.length;o>n;n++){if(d.push(k=[]),l=a[n],l[0]!=bb.call(l[0]))switch(k[0]=bb.call(l[0]),k[0]){case"A":k[1]=l[1],k[2]=l[2],k[3]=l[3],k[4]=l[4],k[5]=l[5],k[6]=+(l[6]+e),k[7]=+(l[7]+f);break;case"V":k[1]=+l[1]+f;break;case"H":k[1]=+l[1]+e;break;case"R":for(var p=[e,f][E](l.slice(1)),q=2,r=p.length;r>q;q++)p[q]=+p[q]+e,p[++q]=+p[q]+f;d.pop(),d=d[E](h(p,m));break;case"M":g=+l[1]+e,i=+l[2]+f;default:for(q=1,r=l.length;r>q;q++)k[q]=+l[q]+(q%2?e:f)}else if("R"==l[0])p=[e,f][E](l.slice(1)),d.pop(),d=d[E](h(p,m)),k=["R"][E](l.slice(-2));else for(var s=0,t=l.length;t>s;s++)k[s]=l[s];switch(k[0]){case"Z":e=g,f=i;break;case"H":e=k[1];break;case"V":f=k[1];break;case"M":g=k[k.length-2],i=k[k.length-1];default:e=k[k.length-2],f=k[k.length-1]}}return d.toString=c._path2string,b.abs=Cb(d),d},Fb=function(a,b,c,d){return[a,b,c,d,c,d]},Gb=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},Hb=function(a,b,c,d,e,g,h,i,j,k){var l,m=120*S/180,n=S/180*(+e||0),o=[],p=f(function(a,b,c){var d=a*N.cos(c)-b*N.sin(c),e=a*N.sin(c)+b*N.cos(c);return{x:d,y:e}});if(k)y=k[0],z=k[1],w=k[2],x=k[3];else{l=p(a,b,-n),a=l.x,b=l.y,l=p(i,j,-n),i=l.x,j=l.y;var q=(N.cos(S/180*e),N.sin(S/180*e),(a-i)/2),r=(b-j)/2,s=q*q/(c*c)+r*r/(d*d);s>1&&(s=N.sqrt(s),c=s*c,d=s*d);var t=c*c,u=d*d,v=(g==h?-1:1)*N.sqrt(Q((t*u-t*r*r-u*q*q)/(t*r*r+u*q*q))),w=v*c*r/d+(a+i)/2,x=v*-d*q/c+(b+j)/2,y=N.asin(((b-x)/d).toFixed(9)),z=N.asin(((j-x)/d).toFixed(9));y=w>a?S-y:y,z=w>i?S-z:z,0>y&&(y=2*S+y),0>z&&(z=2*S+z),h&&y>z&&(y-=2*S),!h&&z>y&&(z-=2*S)}var A=z-y;if(Q(A)>m){var B=z,C=i,D=j;z=y+m*(h&&z>y?1:-1),i=w+c*N.cos(z),j=x+d*N.sin(z),o=Hb(i,j,c,d,e,0,h,C,D,[z,B,w,x])}A=z-y;var F=N.cos(y),G=N.sin(y),H=N.cos(z),I=N.sin(z),K=N.tan(A/4),L=4/3*c*K,M=4/3*d*K,O=[a,b],P=[a+L*G,b-M*F],R=[i+L*I,j-M*H],T=[i,j];if(P[0]=2*O[0]-P[0],P[1]=2*O[1]-P[1],k)return[P,R,T][E](o);o=[P,R,T][E](o).join()[J](",");for(var U=[],V=0,W=o.length;W>V;V++)U[V]=V%2?p(o[V-1],o[V],n).y:p(o[V],o[V+1],n).x;return U},Ib=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:R(j,3)*a+3*R(j,2)*i*c+3*j*i*i*e+R(i,3)*g,y:R(j,3)*b+3*R(j,2)*i*d+3*j*i*i*f+R(i,3)*h}},Jb=f(function(a,b,c,d,e,f,g,h){var i,j=e-2*c+a-(g-2*e+c),k=2*(c-a)-2*(e-c),l=a-c,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,o=[b,h],p=[a,g];return Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),j=f-2*d+b-(h-2*f+d),k=2*(d-b)-2*(f-d),l=b-d,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),{min:{x:P[D](0,p),y:P[D](0,o)},max:{x:O[D](0,p),y:O[D](0,o)}}}),Kb=c._path2curve=f(function(a,b){var c=!b&&Ab(a);if(!b&&c.curve)return Cb(c.curve);for(var d=Eb(a),e=b&&Eb(b),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=(function(a,b,c){var d,e,f={T:1,Q:1};if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in f)&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"][E](Hb[D](0,[b.x,b.y][E](a.slice(1))));break;case"S":"C"==c||"S"==c?(d=2*b.x-b.bx,e=2*b.y-b.by):(d=b.x,e=b.y),a=["C",d,e][E](a.slice(1));break;case"T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y),a=["C"][E](Gb(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"][E](Gb(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][E](Fb(b.x,b.y,a[1],a[2]));break;case"H":a=["C"][E](Fb(b.x,b.y,a[1],b.y));break;case"V":a=["C"][E](Fb(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"][E](Fb(b.x,b.y,b.X,b.Y))}return a}),i=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)a.splice(b++,0,["C"][E](c.splice(0,6)));a.splice(b,1),l=O(d.length,e&&e.length||0)}},j=function(a,b,c,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),c.bx=0,c.by=0,c.x=a[g][1],c.y=a[g][2],l=O(d.length,e&&e.length||0))},k=0,l=O(d.length,e&&e.length||0);l>k;k++){d[k]=h(d[k],f),i(d,k),e&&(e[k]=h(e[k],g)),e&&i(e,k),j(d,e,f,g,k),j(e,d,g,f,k);var m=d[k],n=e&&e[k],o=m.length,p=e&&n.length;f.x=m[o-2],f.y=m[o-1],f.bx=_(m[o-4])||f.x,f.by=_(m[o-3])||f.y,g.bx=e&&(_(n[p-4])||g.x),g.by=e&&(_(n[p-3])||g.y),g.x=e&&n[p-2],g.y=e&&n[p-1]}return e||(c.curve=Cb(d)),e?[d,e]:d},null,Cb),Lb=(c._parseDots=f(function(a){for(var b=[],d=0,e=a.length;e>d;d++){var f={},g=a[d].match(/^([^:]*):?([\d\.]*)/);if(f.color=c.getRGB(g[1]),f.color.error)return null;f.color=f.color.hex,g[2]&&(f.offset=g[2]+"%"),b.push(f)}for(d=1,e=b.length-1;e>d;d++)if(!b[d].offset){for(var h=_(b[d-1].offset||0),i=0,j=d+1;e>j;j++)if(b[j].offset){i=b[j].offset;break}i||(i=100,j=e),i=_(i);for(var k=(i-h)/(j-d+1);j>d;d++)h+=k,b[d].offset=h+"%"}return b}),c._tear=function(a,b){a==b.top&&(b.top=a.prev),a==b.bottom&&(b.bottom=a.next),a.next&&(a.next.prev=a.prev),a.prev&&(a.prev.next=a.next)}),Mb=(c._tofront=function(a,b){b.top!==a&&(Lb(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)},c._toback=function(a,b){b.bottom!==a&&(Lb(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)},c._insertafter=function(a,b,c){Lb(a,c),b==c.top&&(c.top=a),b.next&&(b.next.prev=a),a.next=b.next,a.prev=b,b.next=a},c._insertbefore=function(a,b,c){Lb(a,c),b==c.bottom&&(c.bottom=a),b.prev&&(b.prev.next=a),a.prev=b.prev,b.prev=a,a.next=b},c.toMatrix=function(a,b){var c=Bb(a),d={_:{transform:G},getBBox:function(){return c}};return Nb(d,b),d.matrix}),Nb=(c.transformPath=function(a,b){return rb(a,Mb(a,b))},c._extractTransform=function(a,b){if(null==b)return a._.transform;b=I(b).replace(/\.{3}|\u2026/g,a._.transform||G);var d=c.parseTransformString(b),e=0,f=0,g=0,h=1,i=1,j=a._,k=new o;if(j.transform=d||[],d)for(var l=0,m=d.length;m>l;l++){var n,p,q,r,s,t=d[l],u=t.length,v=I(t[0]).toLowerCase(),w=t[0]!=v,x=w?k.invert():0;"t"==v&&3==u?w?(n=x.x(0,0),p=x.y(0,0),q=x.x(t[1],t[2]),r=x.y(t[1],t[2]),k.translate(q-n,r-p)):k.translate(t[1],t[2]):"r"==v?2==u?(s=s||a.getBBox(1),k.rotate(t[1],s.x+s.width/2,s.y+s.height/2),e+=t[1]):4==u&&(w?(q=x.x(t[2],t[3]),r=x.y(t[2],t[3]),k.rotate(t[1],q,r)):k.rotate(t[1],t[2],t[3]),e+=t[1]):"s"==v?2==u||3==u?(s=s||a.getBBox(1),k.scale(t[1],t[u-1],s.x+s.width/2,s.y+s.height/2),h*=t[1],i*=t[u-1]):5==u&&(w?(q=x.x(t[3],t[4]),r=x.y(t[3],t[4]),k.scale(t[1],t[2],q,r)):k.scale(t[1],t[2],t[3],t[4]),h*=t[1],i*=t[2]):"m"==v&&7==u&&k.add(t[1],t[2],t[3],t[4],t[5],t[6]),j.dirtyT=1,a.matrix=k}a.matrix=k,j.sx=h,j.sy=i,j.deg=e,j.dx=f=k.e,j.dy=g=k.f,1==h&&1==i&&!e&&j.bbox?(j.bbox.x+=+f,j.bbox.y+=+g):j.dirtyT=1}),Ob=function(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},Pb=c._equaliseTransform=function(a,b){b=I(b).replace(/\.{3}|\u2026/g,a),a=c.parseTransformString(a)||[],b=c.parseTransformString(b)||[];for(var d,e,f,g,h=O(a.length,b.length),i=[],j=[],k=0;h>k;k++){if(f=a[k]||Ob(b[k]),g=b[k]||Ob(f),f[0]!=g[0]||"r"==f[0].toLowerCase()&&(f[2]!=g[2]||f[3]!=g[3])||"s"==f[0].toLowerCase()&&(f[3]!=g[3]||f[4]!=g[4]))return;for(i[k]=[],j[k]=[],d=0,e=O(f.length,g.length);e>d;d++)d in f&&(i[k][d]=f[d]),d in g&&(j[k][d]=g[d])
}return{from:i,to:j}};c._getContainer=function(a,b,d,e){var f;return f=null!=e||c.is(a,"object")?a:A.doc.getElementById(a),null!=f?f.tagName?null==b?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:b,height:d}:{container:1,x:a,y:b,width:d,height:e}:void 0},c.pathToRelative=Db,c._engine={},c.path2curve=Kb,c.matrix=function(a,b,c,d,e,f){return new o(a,b,c,d,e,f)},function(a){function b(a){return a[0]*a[0]+a[1]*a[1]}function d(a){var c=N.sqrt(b(a));a[0]&&(a[0]/=c),a[1]&&(a[1]/=c)}a.add=function(a,b,c,d,e,f){var g,h,i,j,k=[[],[],[]],l=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],m=[[a,c,e],[b,d,f],[0,0,1]];for(a&&a instanceof o&&(m=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),g=0;3>g;g++)for(h=0;3>h;h++){for(j=0,i=0;3>i;i++)j+=l[g][i]*m[i][h];k[g][h]=j}this.a=k[0][0],this.b=k[1][0],this.c=k[0][1],this.d=k[1][1],this.e=k[0][2],this.f=k[1][2]},a.invert=function(){var a=this,b=a.a*a.d-a.b*a.c;return new o(a.d/b,-a.b/b,-a.c/b,a.a/b,(a.c*a.f-a.d*a.e)/b,(a.b*a.e-a.a*a.f)/b)},a.clone=function(){return new o(this.a,this.b,this.c,this.d,this.e,this.f)},a.translate=function(a,b){this.add(1,0,0,1,a,b)},a.scale=function(a,b,c,d){null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d)},a.rotate=function(a,b,d){a=c.rad(a),b=b||0,d=d||0;var e=+N.cos(a).toFixed(9),f=+N.sin(a).toFixed(9);this.add(e,f,-f,e,b,d),this.add(1,0,0,1,-b,-d)},a.x=function(a,b){return a*this.a+b*this.c+this.e},a.y=function(a,b){return a*this.b+b*this.d+this.f},a.get=function(a){return+this[I.fromCharCode(97+a)].toFixed(4)},a.toString=function(){return c.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},a.split=function(){var a={};a.dx=this.e,a.dy=this.f;var e=[[this.a,this.c],[this.b,this.d]];a.scalex=N.sqrt(b(e[0])),d(e[0]),a.shear=e[0][0]*e[1][0]+e[0][1]*e[1][1],e[1]=[e[1][0]-e[0][0]*a.shear,e[1][1]-e[0][1]*a.shear],a.scaley=N.sqrt(b(e[1])),d(e[1]),a.shear/=a.scaley;var f=-e[0][1],g=e[1][1];return 0>g?(a.rotate=c.deg(N.acos(g)),0>f&&(a.rotate=360-a.rotate)):a.rotate=c.deg(N.asin(f)),a.isSimple=!(+a.shear.toFixed(9)||a.scalex.toFixed(9)!=a.scaley.toFixed(9)&&a.rotate),a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate,a.noRotation=!+a.shear.toFixed(9)&&!a.rotate,a},a.toTransformString=function(a){var b=a||this[J]();return b.isSimple?(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[b.dx,b.dy]:G)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:G)+(b.rotate?"r"+[b.rotate,0,0]:G)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(o.prototype);var Qb=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);v.safari="Apple Computer, Inc."==navigator.vendor&&(Qb&&Qb[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Qb&&Qb[1]<8?function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:mb;for(var Rb=function(){this.returnValue=!1},Sb=function(){return this.originalEvent.preventDefault()},Tb=function(){this.cancelBubble=!0},Ub=function(){return this.originalEvent.stopPropagation()},Vb=function(a){var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,c=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;return{x:a.clientX+c,y:a.clientY+b}},Wb=function(){return A.doc.addEventListener?function(a,b,c,d){var e=function(a){var b=Vb(a);return c.call(d,a,b.x,b.y)};if(a.addEventListener(b,e,!1),F&&L[b]){var f=function(b){for(var e=Vb(b),f=b,g=0,h=b.targetTouches&&b.targetTouches.length;h>g;g++)if(b.targetTouches[g].target==a){b=b.targetTouches[g],b.originalEvent=f,b.preventDefault=Sb,b.stopPropagation=Ub;break}return c.call(d,b,e.x,e.y)};a.addEventListener(L[b],f,!1)}return function(){return a.removeEventListener(b,e,!1),F&&L[b]&&a.removeEventListener(L[b],e,!1),!0}}:A.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||A.win.event;var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,e=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,f=a.clientX+e,g=a.clientY+b;return a.preventDefault=a.preventDefault||Rb,a.stopPropagation=a.stopPropagation||Tb,c.call(d,a,f,g)};a.attachEvent("on"+b,e);var f=function(){return a.detachEvent("on"+b,e),!0};return f}:void 0}(),Xb=[],Yb=function(a){for(var c,d=a.clientX,e=a.clientY,f=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,g=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,h=Xb.length;h--;){if(c=Xb[h],F&&a.touches){for(var i,j=a.touches.length;j--;)if(i=a.touches[j],i.identifier==c.el._drag.id){d=i.clientX,e=i.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var k,l=c.el.node,m=l.nextSibling,n=l.parentNode,o=l.style.display;A.win.opera&&n.removeChild(l),l.style.display="none",k=c.el.paper.getElementByPoint(d,e),l.style.display=o,A.win.opera&&(m?n.insertBefore(l,m):n.appendChild(l)),k&&b("raphael.drag.over."+c.el.id,c.el,k),d+=g,e+=f,b("raphael.drag.move."+c.el.id,c.move_scope||c.el,d-c.el._drag.x,e-c.el._drag.y,d,e,a)}},Zb=function(a){c.unmousemove(Yb).unmouseup(Zb);for(var d,e=Xb.length;e--;)d=Xb[e],d.el._drag={},b("raphael.drag.end."+d.el.id,d.end_scope||d.start_scope||d.move_scope||d.el,a);Xb=[]},$b=c.el={},_b=K.length;_b--;)!function(a){c[a]=$b[a]=function(b,d){return c.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:Wb(this.shape||this.node||A.doc,a,b,d||this)})),this},c["un"+a]=$b["un"+a]=function(b){for(var d=this.events||[],e=d.length;e--;)d[e].name!=a||!c.is(b,"undefined")&&d[e].f!=b||(d[e].unbind(),d.splice(e,1),!d.length&&delete this.events);return this}}(K[_b]);$b.data=function(a,d){var e=kb[this.id]=kb[this.id]||{};if(0==arguments.length)return e;if(1==arguments.length){if(c.is(a,"object")){for(var f in a)a[z](f)&&this.data(f,a[f]);return this}return b("raphael.data.get."+this.id,this,e[a],a),e[a]}return e[a]=d,b("raphael.data.set."+this.id,this,d,a),this},$b.removeData=function(a){return null==a?kb[this.id]={}:kb[this.id]&&delete kb[this.id][a],this},$b.getData=function(){return d(kb[this.id]||{})},$b.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},$b.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var ac=[];$b.drag=function(a,d,e,f,g,h){function i(i){(i.originalEvent||i).preventDefault();var j=i.clientX,k=i.clientY,l=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,m=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;if(this._drag.id=i.identifier,F&&i.touches)for(var n,o=i.touches.length;o--;)if(n=i.touches[o],this._drag.id=n.identifier,n.identifier==this._drag.id){j=n.clientX,k=n.clientY;break}this._drag.x=j+m,this._drag.y=k+l,!Xb.length&&c.mousemove(Yb).mouseup(Zb),Xb.push({el:this,move_scope:f,start_scope:g,end_scope:h}),d&&b.on("raphael.drag.start."+this.id,d),a&&b.on("raphael.drag.move."+this.id,a),e&&b.on("raphael.drag.end."+this.id,e),b("raphael.drag.start."+this.id,g||f||this,i.clientX+m,i.clientY+l,i)}return this._drag={},ac.push({el:this,start:i}),this.mousedown(i),this},$b.onDragOver=function(a){a?b.on("raphael.drag.over."+this.id,a):b.unbind("raphael.drag.over."+this.id)},$b.undrag=function(){for(var a=ac.length;a--;)ac[a].el==this&&(this.unmousedown(ac[a].start),ac.splice(a,1),b.unbind("raphael.drag.*."+this.id));!ac.length&&c.unmousemove(Yb).unmouseup(Zb),Xb=[]},v.circle=function(a,b,d){var e=c._engine.circle(this,a||0,b||0,d||0);return this.__set__&&this.__set__.push(e),e},v.rect=function(a,b,d,e,f){var g=c._engine.rect(this,a||0,b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},v.ellipse=function(a,b,d,e){var f=c._engine.ellipse(this,a||0,b||0,d||0,e||0);return this.__set__&&this.__set__.push(f),f},v.path=function(a){a&&!c.is(a,U)&&!c.is(a[0],V)&&(a+=G);var b=c._engine.path(c.format[D](c,arguments),this);return this.__set__&&this.__set__.push(b),b},v.image=function(a,b,d,e,f){var g=c._engine.image(this,a||"about:blank",b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},v.text=function(a,b,d){var e=c._engine.text(this,a||0,b||0,I(d));return this.__set__&&this.__set__.push(e),e},v.set=function(a){!c.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new mc(a);return this.__set__&&this.__set__.push(b),b.paper=this,b.type="set",b},v.setStart=function(a){this.__set__=a||this.set()},v.setFinish=function(){var a=this.__set__;return delete this.__set__,a},v.setSize=function(a,b){return c._engine.setSize.call(this,a,b)},v.setViewBox=function(a,b,d,e,f){return c._engine.setViewBox.call(this,a,b,d,e,f)},v.top=v.bottom=null,v.raphael=c;var bc=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=b.top+(A.win.pageYOffset||e.scrollTop||d.scrollTop)-f,i=b.left+(A.win.pageXOffset||e.scrollLeft||d.scrollLeft)-g;return{y:h,x:i}};v.getElementByPoint=function(a,b){var c=this,d=c.canvas,e=A.doc.elementFromPoint(a,b);if(A.win.opera&&"svg"==e.tagName){var f=bc(d),g=d.createSVGRect();g.x=a-f.x,g.y=b-f.y,g.width=g.height=1;var h=d.getIntersectionList(g,null);h.length&&(e=h[h.length-1])}if(!e)return null;for(;e.parentNode&&e!=d.parentNode&&!e.raphael;)e=e.parentNode;return e==c.canvas.parentNode&&(e=d),e=e&&e.raphael?c.getById(e.raphaelid):null},v.getElementsByBBox=function(a){var b=this.set();return this.forEach(function(d){c.isBBoxIntersect(d.getBBox(),a)&&b.push(d)}),b},v.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null},v.forEach=function(a,b){for(var c=this.bottom;c;){if(a.call(b,c)===!1)return this;c=c.next}return this},v.getElementsByPoint=function(a,b){var c=this.set();return this.forEach(function(d){d.isPointInside(a,b)&&c.push(d)}),c},$b.isPointInside=function(a,b){var d=this.realPath=qb[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(d=c.transformPath(d,this.attr("transform"))),c.isPointInsidePath(d,a,b)},$b.getBBox=function(a){if(this.removed)return{};var b=this._;return a?((b.dirty||!b.bboxwt)&&(this.realPath=qb[this.type](this),b.bboxwt=Bb(this.realPath),b.bboxwt.toString=p,b.dirty=0),b.bboxwt):((b.dirty||b.dirtyT||!b.bbox)&&((b.dirty||!this.realPath)&&(b.bboxwt=0,this.realPath=qb[this.type](this)),b.bbox=Bb(rb(this.realPath,this.matrix)),b.bbox.toString=p,b.dirty=b.dirtyT=0),b.bbox)},$b.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(a),a},$b.glow=function(a){if("text"==this.type)return null;a=a||{};var b={width:(a.width||10)+(+this.attr("stroke-width")||1),fill:a.fill||!1,opacity:a.opacity||.5,offsetx:a.offsetx||0,offsety:a.offsety||0,color:a.color||"#000"},c=b.width/2,d=this.paper,e=d.set(),f=this.realPath||qb[this.type](this);f=this.matrix?rb(f,this.matrix):f;for(var g=1;c+1>g;g++)e.push(d.path(f).attr({stroke:b.color,fill:b.fill?b.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b.width/c*g).toFixed(3),opacity:+(b.opacity/c).toFixed(3)}));return e.insertBefore(this).translate(b.offsetx,b.offsety)};var cc=function(a,b,d,e,f,g,h,i,l){return null==l?j(a,b,d,e,f,g,h,i):c.findDotsAtSegment(a,b,d,e,f,g,h,i,k(a,b,d,e,f,g,h,i,l))},dc=function(a,b){return function(d,e,f){d=Kb(d);for(var g,h,i,j,k,l="",m={},n=0,o=0,p=d.length;p>o;o++){if(i=d[o],"M"==i[0])g=+i[1],h=+i[2];else{if(j=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6]),n+j>e){if(b&&!m.start){if(k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),l+=["C"+k.start.x,k.start.y,k.m.x,k.m.y,k.x,k.y],f)return l;m.start=l,l=["M"+k.x,k.y+"C"+k.n.x,k.n.y,k.end.x,k.end.y,i[5],i[6]].join(),n+=j,g=+i[5],h=+i[6];continue}if(!a&&!b)return k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),{x:k.x,y:k.y,alpha:k.alpha}}n+=j,g=+i[5],h=+i[6]}l+=i.shift()+i}return m.end=l,k=a?n:b?m:c.findDotsAtSegment(g,h,i[0],i[1],i[2],i[3],i[4],i[5],1),k.alpha&&(k={x:k.x,y:k.y,alpha:k.alpha}),k}},ec=dc(1),fc=dc(),gc=dc(0,1);c.getTotalLength=ec,c.getPointAtLength=fc,c.getSubpath=function(a,b,c){if(this.getTotalLength(a)-c<1e-6)return gc(a,b).end;var d=gc(a,c,1);return b?gc(d,b).end:d},$b.getTotalLength=function(){var a=this.getPath();if(a)return this.node.getTotalLength?this.node.getTotalLength():ec(a)},$b.getPointAtLength=function(a){var b=this.getPath();if(b)return fc(b,a)},$b.getPath=function(){var a,b=c._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return b&&(a=b(this)),a},$b.getSubpath=function(a,b){var d=this.getPath();if(d)return c.getSubpath(d,a,b)};var hc=c.easing_formulas={linear:function(a){return a},"<":function(a){return R(a,1.7)},">":function(a){return R(a,.48)},"<>":function(a){var b=.48-a/1.04,c=N.sqrt(.1734+b*b),d=c-b,e=R(Q(d),1/3)*(0>d?-1:1),f=-c-b,g=R(Q(f),1/3)*(0>f?-1:1),h=e+g+.5;return 3*(1-h)*h*h+h*h*h},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){a-=1;var b=1.70158;return a*a*((b+1)*a+b)+1},elastic:function(a){return a==!!a?a:R(2,-10*a)*N.sin(2*(a-.075)*S/.3)+1},bounce:function(a){var b,c=7.5625,d=2.75;return 1/d>a?b=c*a*a:2/d>a?(a-=1.5/d,b=c*a*a+.75):2.5/d>a?(a-=2.25/d,b=c*a*a+.9375):(a-=2.625/d,b=c*a*a+.984375),b}};hc.easeIn=hc["ease-in"]=hc["<"],hc.easeOut=hc["ease-out"]=hc[">"],hc.easeInOut=hc["ease-in-out"]=hc["<>"],hc["back-in"]=hc.backIn,hc["back-out"]=hc.backOut;var ic=[],jc=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},kc=function(){for(var a=+new Date,d=0;d<ic.length;d++){var e=ic[d];if(!e.el.removed&&!e.paused){var f,g,h=a-e.start,i=e.ms,j=e.easing,k=e.from,l=e.diff,m=e.to,n=(e.t,e.el),o={},p={};if(e.initstatus?(h=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*i,e.status=e.initstatus,delete e.initstatus,e.stop&&ic.splice(d--,1)):e.status=(e.prev+(e.percent-e.prev)*(h/i))/e.anim.top,!(0>h))if(i>h){var q=j(h/i);for(var r in k)if(k[z](r)){switch(db[r]){case T:f=+k[r]+q*i*l[r];break;case"colour":f="rgb("+[lc($(k[r].r+q*i*l[r].r)),lc($(k[r].g+q*i*l[r].g)),lc($(k[r].b+q*i*l[r].b))].join(",")+")";break;case"path":f=[];for(var t=0,u=k[r].length;u>t;t++){f[t]=[k[r][t][0]];for(var v=1,w=k[r][t].length;w>v;v++)f[t][v]=+k[r][t][v]+q*i*l[r][t][v];f[t]=f[t].join(H)}f=f.join(H);break;case"transform":if(l[r].real)for(f=[],t=0,u=k[r].length;u>t;t++)for(f[t]=[k[r][t][0]],v=1,w=k[r][t].length;w>v;v++)f[t][v]=k[r][t][v]+q*i*l[r][t][v];else{var x=function(a){return+k[r][a]+q*i*l[r][a]};f=[["m",x(0),x(1),x(2),x(3),x(4),x(5)]]}break;case"csv":if("clip-rect"==r)for(f=[],t=4;t--;)f[t]=+k[r][t]+q*i*l[r][t];break;default:var y=[][E](k[r]);for(f=[],t=n.paper.customAttributes[r].length;t--;)f[t]=+y[t]+q*i*l[r][t]}o[r]=f}n.attr(o),function(a,c,d){setTimeout(function(){b("raphael.anim.frame."+a,c,d)})}(n.id,n,e.anim)}else{if(function(a,d,e){setTimeout(function(){b("raphael.anim.frame."+d.id,d,e),b("raphael.anim.finish."+d.id,d,e),c.is(a,"function")&&a.call(d)})}(e.callback,n,e.anim),n.attr(m),ic.splice(d--,1),e.repeat>1&&!e.next){for(g in m)m[z](g)&&(p[g]=e.totalOrigin[g]);e.el.attr(p),s(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1)}e.next&&!e.stop&&s(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat)}}}c.svg&&n&&n.paper&&n.paper.safari(),ic.length&&jc(kc)},lc=function(a){return a>255?255:0>a?0:a};$b.animateWith=function(a,b,d,e,f,g){var h=this;if(h.removed)return g&&g.call(h),h;var i=d instanceof r?d:c.animation(d,e,f,g);s(i,h,i.percents[0],null,h.attr());for(var j=0,k=ic.length;k>j;j++)if(ic[j].anim==b&&ic[j].el==a){ic[k-1].start=ic[j].start;break}return h},$b.onAnimation=function(a){return a?b.on("raphael.anim.frame."+this.id,a):b.unbind("raphael.anim.frame."+this.id),this},r.prototype.delay=function(a){var b=new r(this.anim,this.ms);return b.times=this.times,b.del=+a||0,b},r.prototype.repeat=function(a){var b=new r(this.anim,this.ms);return b.del=this.del,b.times=N.floor(O(a,0))||1,b},c.animation=function(a,b,d,e){if(a instanceof r)return a;(c.is(d,"function")||!d)&&(e=e||d||null,d=null),a=Object(a),b=+b||0;var f,g,h={};for(g in a)a[z](g)&&_(g)!=g&&_(g)+"%"!=g&&(f=!0,h[g]=a[g]);return f?(d&&(h.easing=d),e&&(h.callback=e),new r({100:h},b)):new r(a,b)},$b.animate=function(a,b,d,e){var f=this;if(f.removed)return e&&e.call(f),f;var g=a instanceof r?a:c.animation(a,b,d,e);return s(g,f,g.percents[0],null,f.attr()),f},$b.setTime=function(a,b){return a&&null!=b&&this.status(a,P(b,a.ms)/a.ms),this},$b.status=function(a,b){var c,d,e=[],f=0;if(null!=b)return s(a,this,-1,P(b,1)),this;for(c=ic.length;c>f;f++)if(d=ic[f],d.el.id==this.id&&(!a||d.anim==a)){if(a)return d.status;e.push({anim:d.anim,status:d.status})}return a?0:e},$b.pause=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||b("raphael.anim.pause."+this.id,this,ic[c].anim)!==!1&&(ic[c].paused=!0);return this},$b.resume=function(a){for(var c=0;c<ic.length;c++)if(ic[c].el.id==this.id&&(!a||ic[c].anim==a)){var d=ic[c];b("raphael.anim.resume."+this.id,this,d.anim)!==!1&&(delete d.paused,this.status(d.anim,d.status))}return this},$b.stop=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||b("raphael.anim.stop."+this.id,this,ic[c].anim)!==!1&&ic.splice(c--,1);return this},b.on("raphael.remove",t),b.on("raphael.clear",t),$b.toString=function(){return"RaphaÃ«lâ€™s object"};var mc=function(a){if(this.items=[],this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)!a[b]||a[b].constructor!=$b.constructor&&a[b].constructor!=mc||(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},nc=mc.prototype;nc.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)a=arguments[c],!a||a.constructor!=$b.constructor&&a.constructor!=mc||(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},nc.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},nc.forEach=function(a,b){for(var c=0,d=this.items.length;d>c;c++)if(a.call(b,this.items[c],c)===!1)return this;return this};for(var oc in $b)$b[z](oc)&&(nc[oc]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][D](c,b)})}}(oc));return nc.attr=function(a,b){if(a&&c.is(a,V)&&c.is(a[0],"object"))for(var d=0,e=a.length;e>d;d++)this.items[d].attr(a[d]);else for(var f=0,g=this.items.length;g>f;f++)this.items[f].attr(a,b);return this},nc.clear=function(){for(;this.length;)this.pop()},nc.splice=function(a,b){a=0>a?O(this.length+a,0):a,b=O(0,P(this.length-a,b));var c,d=[],e=[],f=[];for(c=2;c<arguments.length;c++)f.push(arguments[c]);for(c=0;b>c;c++)e.push(this[a+c]);for(;c<this.length-a;c++)d.push(this[a+c]);var g=f.length;for(c=0;c<g+d.length;c++)this.items[a+c]=this[a+c]=g>c?f[c]:d[c-g];for(c=this.items.length=this.length-=b-g;this[c];)delete this[c++];return new mc(e)},nc.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0},nc.animate=function(a,b,d,e){(c.is(d,"function")||!d)&&(e=d||null);var f,g,h=this.items.length,i=h,j=this;if(!h)return this;e&&(g=function(){!--h&&e.call(j)}),d=c.is(d,U)?d:g;var k=c.animation(a,b,d,g);for(f=this.items[--i].animate(k);i--;)this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(f,k,k),this.items[i]&&!this.items[i].removed||h--;return this},nc.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},nc.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x),b.push(f.y),c.push(f.x+f.width),d.push(f.y+f.height)}return a=P[D](0,a),b=P[D](0,b),c=O[D](0,c),d=O[D](0,d),{x:a,y:b,x2:c,y2:d,width:c-a,height:d-b}},nc.clone=function(a){a=this.paper.set();for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},nc.toString=function(){return"RaphaÃ«lâ€˜s set"},nc.glow=function(a){var b=this.paper.set();return this.forEach(function(c){var d=c.glow(a);null!=d&&d.forEach(function(a){b.push(a)})}),b},nc.isPointInside=function(a,b){var c=!1;return this.forEach(function(d){return d.isPointInside(a,b)?(c=!0,!1):void 0}),c},c.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"];for(var d in a.face)a.face[z](d)&&(b.face[d]=a.face[d]);if(this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b],!a.svg){b.face["units-per-em"]=ab(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[z](e)){var f=a.glyphs[e];if(b.glyphs[e]={w:f.w,k:{},d:f.d&&"M"+f.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},f.k)for(var g in f.k)f[z](g)&&(b.glyphs[e].k[g]=f.k[g])}}return a},v.getFont=function(a,b,d,e){if(e=e||"normal",d=d||"normal",b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400,c.fonts){var f=c.fonts[a];if(!f){var g=new RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,G)+"(\\s|$)","i");for(var h in c.fonts)if(c.fonts[z](h)&&g.test(h)){f=c.fonts[h];break}}var i;if(f)for(var j=0,k=f.length;k>j&&(i=f[j],i.face["font-weight"]!=b||i.face["font-style"]!=d&&i.face["font-style"]||i.face["font-stretch"]!=e);j++);return i}},v.print=function(a,b,d,e,f,g,h,i){g=g||"middle",h=O(P(h||0,1),-1),i=O(P(i||1,3),1);var j,k=I(d)[J](G),l=0,m=0,n=G;if(c.is(e,"string")&&(e=this.getFont(e)),e){j=(f||16)/e.face["units-per-em"];for(var o=e.face.bbox[J](w),p=+o[0],q=o[3]-o[1],r=0,s=+o[1]+("baseline"==g?q+ +e.face.descent:q/2),t=0,u=k.length;u>t;t++){if("\n"==k[t])l=0,x=0,m=0,r+=q*i;else{var v=m&&e.glyphs[k[t-1]]||{},x=e.glyphs[k[t]];l+=m?(v.w||e.w)+(v.k&&v.k[k[t]]||0)+e.w*h:0,m=1}x&&x.d&&(n+=c.transformPath(x.d,["t",l*j,r*j,"s",j,j,p,s,"t",(a-p)/j,(b-s)/j]))}}return this.path(n).attr({fill:"#000",stroke:"none"})},v.add=function(a){if(c.is(a,"array"))for(var b,d=this.set(),e=0,f=a.length;f>e;e++)b=a[e]||{},x[z](b.type)&&d.push(this[b.type]().attr(b));return d},c.format=function(a,b){var d=c.is(b,V)?[0][E](b):arguments;return a&&c.is(a,U)&&d.length-1&&(a=a.replace(y,function(a,b){return null==d[++b]?G:d[b]})),a||G},c.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}(),c.ninja=function(){return B.was?A.win.Raphael=B.is:delete Raphael,c},c.st=nc,function(a,b,d){function e(){/in/.test(a.readyState)?setTimeout(e,9):c.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,d=function(){a.removeEventListener(b,d,!1),a.readyState="complete"},!1),a.readyState="loading"),e()}(document,"DOMContentLoaded"),b.on("raphael.DOMload",function(){u=!0}),function(){if(c.svg){var a="hasOwnProperty",b=String,d=parseFloat,e=parseInt,f=Math,g=f.max,h=f.abs,i=f.pow,j=/[, ]+/,k=c.eve,l="",m=" ",n="http://www.w3.org/1999/xlink",o={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},p={};c.toString=function(){return"Your browser supports SVG.\nYou are running RaphaÃ«l "+this.version};var q=function(d,e){if(e){"string"==typeof d&&(d=q(d));for(var f in e)e[a](f)&&("xlink:"==f.substring(0,6)?d.setAttributeNS(n,f.substring(6),b(e[f])):d.setAttribute(f,b(e[f])))}else d=c._g.doc.createElementNS("http://www.w3.org/2000/svg",d),d.style&&(d.style.webkitTapHighlightColor="rgba(0,0,0,0)");return d},r=function(a,e){var j="linear",k=a.id+e,m=.5,n=.5,o=a.node,p=a.paper,r=o.style,s=c._g.doc.getElementById(k);if(!s){if(e=b(e).replace(c._radial_gradient,function(a,b,c){if(j="radial",b&&c){m=d(b),n=d(c);var e=2*(n>.5)-1;i(m-.5,2)+i(n-.5,2)>.25&&(n=f.sqrt(.25-i(m-.5,2))*e+.5)&&.5!=n&&(n=n.toFixed(5)-1e-5*e)}return l}),e=e.split(/\s*\-\s*/),"linear"==j){var t=e.shift();if(t=-d(t),isNaN(t))return null;var u=[0,0,f.cos(c.rad(t)),f.sin(c.rad(t))],v=1/(g(h(u[2]),h(u[3]))||1);u[2]*=v,u[3]*=v,u[2]<0&&(u[0]=-u[2],u[2]=0),u[3]<0&&(u[1]=-u[3],u[3]=0)}var w=c._parseDots(e);if(!w)return null;if(k=k.replace(/[\(\)\s,\xb0#]/g,"_"),a.gradient&&k!=a.gradient.id&&(p.defs.removeChild(a.gradient),delete a.gradient),!a.gradient){s=q(j+"Gradient",{id:k}),a.gradient=s,q(s,"radial"==j?{fx:m,fy:n}:{x1:u[0],y1:u[1],x2:u[2],y2:u[3],gradientTransform:a.matrix.invert()}),p.defs.appendChild(s);for(var x=0,y=w.length;y>x;x++)s.appendChild(q("stop",{offset:w[x].offset?w[x].offset:x?"100%":"0%","stop-color":w[x].color||"#fff"}))}}return q(o,{fill:"url(#"+k+")",opacity:1,"fill-opacity":1}),r.fill=l,r.opacity=1,r.fillOpacity=1,1},s=function(a){var b=a.getBBox(1);q(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},t=function(d,e,f){if("path"==d.type){for(var g,h,i,j,k,m=b(e).toLowerCase().split("-"),n=d.paper,r=f?"end":"start",s=d.node,t=d.attrs,u=t["stroke-width"],v=m.length,w="classic",x=3,y=3,z=5;v--;)switch(m[v]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=m[v];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":x=5;break;case"short":x=2}if("open"==w?(x+=2,y+=2,z+=2,i=1,j=f?4:1,k={fill:"none",stroke:t.stroke}):(j=i=x/2,k={fill:t.stroke,stroke:"none"}),d._.arrows?f?(d._.arrows.endPath&&p[d._.arrows.endPath]--,d._.arrows.endMarker&&p[d._.arrows.endMarker]--):(d._.arrows.startPath&&p[d._.arrows.startPath]--,d._.arrows.startMarker&&p[d._.arrows.startMarker]--):d._.arrows={},"none"!=w){var A="raphael-marker-"+w,B="raphael-marker-"+r+w+x+y;c._g.doc.getElementById(A)?p[A]++:(n.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:o[w],id:A})),p[A]=1);var C,D=c._g.doc.getElementById(B);D?(p[B]++,C=D.getElementsByTagName("use")[0]):(D=q(q("marker"),{id:B,markerHeight:y,markerWidth:x,orient:"auto",refX:j,refY:y/2}),C=q(q("use"),{"xlink:href":"#"+A,transform:(f?"rotate(180 "+x/2+" "+y/2+") ":l)+"scale("+x/z+","+y/z+")","stroke-width":(1/((x/z+y/z)/2)).toFixed(4)}),D.appendChild(C),n.defs.appendChild(D),p[B]=1),q(C,k);var E=i*("diamond"!=w&&"oval"!=w);f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-E*u):(g=E*u,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),k={},k["marker-"+r]="url(#"+B+")",(h||g)&&(k.d=c.getSubpath(t.path,g,h)),q(s,k),d._.arrows[r+"Path"]=A,d._.arrows[r+"Marker"]=B,d._.arrows[r+"dx"]=E,d._.arrows[r+"Type"]=w,d._.arrows[r+"String"]=e}else f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-g):(g=0,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),d._.arrows[r+"Path"]&&q(s,{d:c.getSubpath(t.path,g,h)}),delete d._.arrows[r+"Path"],delete d._.arrows[r+"Marker"],delete d._.arrows[r+"dx"],delete d._.arrows[r+"Type"],delete d._.arrows[r+"String"];for(k in p)if(p[a](k)&&!p[k]){var F=c._g.doc.getElementById(k);F&&F.parentNode.removeChild(F)}}},u={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,c,d){if(c=u[b(c).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",f={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,g=[],h=c.length;h--;)g[h]=c[h]*e+(h%2?1:-1)*f;q(a.node,{"stroke-dasharray":g.join(",")})}},w=function(d,f){var i=d.node,k=d.attrs,m=i.style.visibility;i.style.visibility="hidden";for(var o in f)if(f[a](o)){if(!c._availableAttrs[a](o))continue;var p=f[o];switch(k[o]=p,o){case"blur":d.blur(p);break;case"title":var u=i.getElementsByTagName("title");if(u.length&&(u=u[0]))u.firstChild.nodeValue=p;else{u=q("title");var w=c._g.doc.createTextNode(p);u.appendChild(w),i.appendChild(u)}break;case"href":case"target":var x=i.parentNode;if("a"!=x.tagName.toLowerCase()){var z=q("a");x.insertBefore(z,i),z.appendChild(i),x=z}"target"==o?x.setAttributeNS(n,"show","blank"==p?"new":p):x.setAttributeNS(n,o,p);break;case"cursor":i.style.cursor=p;break;case"transform":d.transform(p);break;case"arrow-start":t(d,p);break;case"arrow-end":t(d,p,1);break;case"clip-rect":var A=b(p).split(j);if(4==A.length){d.clip&&d.clip.parentNode.parentNode.removeChild(d.clip.parentNode);var B=q("clipPath"),C=q("rect");B.id=c.createUUID(),q(C,{x:A[0],y:A[1],width:A[2],height:A[3]}),B.appendChild(C),d.paper.defs.appendChild(B),q(i,{"clip-path":"url(#"+B.id+")"}),d.clip=C}if(!p){var D=i.getAttribute("clip-path");if(D){var E=c._g.doc.getElementById(D.replace(/(^url\(#|\)$)/g,l));E&&E.parentNode.removeChild(E),q(i,{"clip-path":l}),delete d.clip}}break;case"path":"path"==d.type&&(q(i,{d:p?k.path=c._pathToAbsolute(p):"M0,0"}),d._.dirty=1,d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1)));break;case"width":if(i.setAttribute(o,p),d._.dirty=1,!k.fx)break;o="x",p=k.x;case"x":k.fx&&(p=-k.x-(k.width||0));case"rx":if("rx"==o&&"rect"==d.type)break;case"cx":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"height":if(i.setAttribute(o,p),d._.dirty=1,!k.fy)break;o="y",p=k.y;case"y":k.fy&&(p=-k.y-(k.height||0));case"ry":if("ry"==o&&"rect"==d.type)break;case"cy":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"r":"rect"==d.type?q(i,{rx:p,ry:p}):i.setAttribute(o,p),d._.dirty=1;break;case"src":"image"==d.type&&i.setAttributeNS(n,"href",p);break;case"stroke-width":(1!=d._.sx||1!=d._.sy)&&(p/=g(h(d._.sx),h(d._.sy))||1),d.paper._vbSize&&(p*=d.paper._vbSize),i.setAttribute(o,p),k["stroke-dasharray"]&&v(d,k["stroke-dasharray"],f),d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"stroke-dasharray":v(d,p,f);break;case"fill":var F=b(p).match(c._ISURL);if(F){B=q("pattern");var G=q("image");B.id=c.createUUID(),q(B,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),q(G,{x:0,y:0,"xlink:href":F[1]}),B.appendChild(G),function(a){c._preload(F[1],function(){var b=this.offsetWidth,c=this.offsetHeight;q(a,{width:b,height:c}),q(G,{width:b,height:c}),d.paper.safari()})}(B),d.paper.defs.appendChild(B),q(i,{fill:"url(#"+B.id+")"}),d.pattern=B,d.pattern&&s(d);break}var H=c.getRGB(p);if(H.error){if(("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p)){if("opacity"in k||"fill-opacity"in k){var I=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l));if(I){var J=I.getElementsByTagName("stop");q(J[J.length-1],{"stop-opacity":("opacity"in k?k.opacity:1)*("fill-opacity"in k?k["fill-opacity"]:1)})}}k.gradient=p,k.fill="none";break}}else delete f.gradient,delete k.gradient,!c.is(k.opacity,"undefined")&&c.is(f.opacity,"undefined")&&q(i,{opacity:k.opacity}),!c.is(k["fill-opacity"],"undefined")&&c.is(f["fill-opacity"],"undefined")&&q(i,{"fill-opacity":k["fill-opacity"]});H[a]("opacity")&&q(i,{"fill-opacity":H.opacity>1?H.opacity/100:H.opacity});case"stroke":H=c.getRGB(p),i.setAttribute(o,H.hex),"stroke"==o&&H[a]("opacity")&&q(i,{"stroke-opacity":H.opacity>1?H.opacity/100:H.opacity}),"stroke"==o&&d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"gradient":("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p);break;case"opacity":k.gradient&&!k[a]("stroke-opacity")&&q(i,{"stroke-opacity":p>1?p/100:p});case"fill-opacity":if(k.gradient){I=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l)),I&&(J=I.getElementsByTagName("stop"),q(J[J.length-1],{"stop-opacity":p}));break}default:"font-size"==o&&(p=e(p,10)+"px");var K=o.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()});i.style[K]=p,d._.dirty=1,i.setAttribute(o,p)}}y(d,f),i.style.visibility=m},x=1.2,y=function(d,f){if("text"==d.type&&(f[a]("text")||f[a]("font")||f[a]("font-size")||f[a]("x")||f[a]("y"))){var g=d.attrs,h=d.node,i=h.firstChild?e(c._g.doc.defaultView.getComputedStyle(h.firstChild,l).getPropertyValue("font-size"),10):10;
if(f[a]("text")){for(g.text=f.text;h.firstChild;)h.removeChild(h.firstChild);for(var j,k=b(f.text).split("\n"),m=[],n=0,o=k.length;o>n;n++)j=q("tspan"),n&&q(j,{dy:i*x,x:g.x}),j.appendChild(c._g.doc.createTextNode(k[n])),h.appendChild(j),m[n]=j}else for(m=h.getElementsByTagName("tspan"),n=0,o=m.length;o>n;n++)n?q(m[n],{dy:i*x,x:g.x}):q(m[0],{dy:0});q(h,{x:g.x,y:g.y}),d._.dirty=1;var p=d._getBBox(),r=g.y-(p.y+p.height/2);r&&c.is(r,"finite")&&q(m[0],{dy:r})}},z=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.matrix=c.matrix(),this.realPath=null,this.paper=b,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},A=c.el;z.prototype=A,A.constructor=z,c._engine.path=function(a,b){var c=q("path");b.canvas&&b.canvas.appendChild(c);var d=new z(c,b);return d.type="path",w(d,{fill:"none",stroke:"#000",path:a}),d},A.rotate=function(a,c,e){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this.transform(this._.transform.concat([["r",a,c,e]])),this},A.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3])),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this},A.translate=function(a,c){return this.removed?this:(a=b(a).split(j),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this.transform(this._.transform.concat([["t",a,c]])),this)},A.transform=function(b){var d=this._;if(null==b)return d.transform;if(c._extractTransform(this,b),this.clip&&q(this.clip,{transform:this.matrix.invert()}),this.pattern&&s(this),this.node&&q(this.node,{transform:this.matrix}),1!=d.sx||1!=d.sy){var e=this.attrs[a]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":e})}return this},A.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},A.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},A.remove=function(){if(!this.removed&&this.node.parentNode){var a=this.paper;a.__set__&&a.__set__.exclude(this),k.unbind("raphael.*.*."+this.id),this.gradient&&a.defs.removeChild(this.gradient),c._tear(this,a),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var b in this)this[b]="function"==typeof this[b]?c._removedFactory(b):null;this.removed=!0}},A._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=b||{}}return a&&this.hide(),b},A.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;for(var g=b.split(j),h={},i=0,l=g.length;l>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return l-1?h:h[g[0]]}if(null==d&&c.is(b,"array")){for(h={},i=0,l=b.length;l>i;i++)h[b[i]]=this.attr(b[i]);return h}if(null!=d){var m={};m[b]=d}else null!=b&&c.is(b,"object")&&(m=b);for(var n in m)k("raphael.attr."+n+"."+this.id,this,m[n]);for(n in this.paper.customAttributes)if(this.paper.customAttributes[a](n)&&m[a](n)&&c.is(this.paper.customAttributes[n],"function")){var o=this.paper.customAttributes[n].apply(this,[].concat(m[n]));this.attrs[n]=m[n];for(var p in o)o[a](p)&&(m[p]=o[p])}return w(this,m),this},A.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var a=this.paper;return a.top!=this&&c._tofront(this,a),this},A.toBack=function(){if(this.removed)return this;var a=this.node.parentNode;"a"==a.tagName.toLowerCase()?a.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):a.firstChild!=this.node&&a.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper);this.paper;return this},A.insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;return b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this},A.insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;return b.parentNode.insertBefore(this.node,b),c._insertbefore(this,a,this.paper),this},A.blur=function(a){var b=this;if(0!==+a){var d=q("filter"),e=q("feGaussianBlur");b.attrs.blur=a,d.id=c.createUUID(),q(e,{stdDeviation:+a||1.5}),d.appendChild(e),b.paper.defs.appendChild(d),b._blur=d,q(b.node,{filter:"url(#"+d.id+")"})}else b._blur&&(b._blur.parentNode.removeChild(b._blur),delete b._blur,delete b.attrs.blur),b.node.removeAttribute("filter");return b},c._engine.circle=function(a,b,c,d){var e=q("circle");a.canvas&&a.canvas.appendChild(e);var f=new z(e,a);return f.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"},f.type="circle",q(e,f.attrs),f},c._engine.rect=function(a,b,c,d,e,f){var g=q("rect");a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},h.type="rect",q(g,h.attrs),h},c._engine.ellipse=function(a,b,c,d,e){var f=q("ellipse");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"},g.type="ellipse",q(f,g.attrs),g},c._engine.image=function(a,b,c,d,e,f){var g=q("image");q(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS(n,"href",b),a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:c,y:d,width:e,height:f,src:b},h.type="image",h},c._engine.text=function(a,b,d,e){var f=q("text");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={x:b,y:d,"text-anchor":"middle",text:e,font:c._availableAttrs.font,stroke:"none",fill:"#000"},g.type="text",w(g,g.attrs),g},c._engine.setSize=function(a,b){return this.width=a||this.width,this.height=b||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a&&a.container,d=a.x,e=a.y,f=a.width,g=a.height;if(!b)throw new Error("SVG container not found.");var h,i=q("svg"),j="overflow:hidden;";return d=d||0,e=e||0,f=f||512,g=g||342,q(i,{height:g,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),1==b?(i.style.cssText=j+"position:absolute;left:"+d+"px;top:"+e+"px",c._g.doc.body.appendChild(i),h=1):(i.style.cssText=j+"position:relative",b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i)),b=new c._Paper,b.width=f,b.height=g,b.canvas=i,b.clear(),b._left=b._top=0,h&&(b.renderfix=function(){}),b.renderfix(),b},c._engine.setViewBox=function(a,b,c,d,e){k("raphael.setViewBox",this,this._viewBox,[a,b,c,d,e]);var f,h,i=g(c/this.width,d/this.height),j=this.top,l=e?"xMidYMid meet":"xMinYMin";for(null==a?(this._vbSize&&(i=1),delete this._vbSize,f="0 0 "+this.width+m+this.height):(this._vbSize=i,f=a+m+b+m+c+m+d),q(this.canvas,{viewBox:f,preserveAspectRatio:l});i&&j;)h="stroke-width"in j.attrs?j.attrs["stroke-width"]:1,j.attr({"stroke-width":h}),j._.dirty=1,j._.dirtyT=1,j=j.prev;return this._viewBox=[a,b,c,d,!!e],this},c.prototype.renderfix=function(){var a,b=this.canvas,c=b.style;try{a=b.getScreenCTM()||b.createSVGMatrix()}catch(d){a=b.createSVGMatrix()}var e=-a.e%1,f=-a.f%1;(e||f)&&(e&&(this._left=(this._left+e)%1,c.left=this._left+"px"),f&&(this._top=(this._top+f)%1,c.top=this._top+"px"))},c.prototype.clear=function(){c.eve("raphael.clear",this);for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null,(this.desc=q("desc")).appendChild(c._g.doc.createTextNode("Created with RaphaÃ«l "+c.version)),a.appendChild(this.desc),a.appendChild(this.defs=q("defs"))},c.prototype.remove=function(){k("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null};var B=c.st;for(var C in A)A[a](C)&&!B[a](C)&&(B[C]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}}(),function(){if(c.vml){var a="hasOwnProperty",b=String,d=parseFloat,e=Math,f=e.round,g=e.max,h=e.min,i=e.abs,j="fill",k=/[, ]+/,l=c.eve,m=" progid:DXImageTransform.Microsoft",n=" ",o="",p={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},q=/([clmz]),?([^clmz]*)/gi,r=/ progid:\S+Blur\([^\)]+\)/g,s=/-?[^,\s-]+/g,t="position:absolute;left:0;top:0;width:1px;height:1px",u=21600,v={path:1,rect:1,image:1},w={circle:1,ellipse:1},x=function(a){var d=/[ahqstv]/gi,e=c._pathToAbsolute;if(b(a).match(d)&&(e=c._path2curve),d=/[clmz]/g,e==c._pathToAbsolute&&!b(a).match(d)){var g=b(a).replace(q,function(a,b,c){var d=[],e="m"==b.toLowerCase(),g=p[b];return c.replace(s,function(a){e&&2==d.length&&(g+=d+p["m"==b?"l":"L"],d=[]),d.push(f(a*u))}),g+d});return g}var h,i,j=e(a);g=[];for(var k=0,l=j.length;l>k;k++){h=j[k],i=j[k][0].toLowerCase(),"z"==i&&(i="x");for(var m=1,r=h.length;r>m;m++)i+=f(h[m]*u)+(m!=r-1?",":o);g.push(i)}return g.join(n)},y=function(a,b,d){var e=c.matrix();return e.rotate(-a,.5,.5),{dx:e.x(b,d),dy:e.y(b,d)}},z=function(a,b,c,d,e,f){var g=a._,h=a.matrix,k=g.fillpos,l=a.node,m=l.style,o=1,p="",q=u/b,r=u/c;if(m.visibility="hidden",b&&c){if(l.coordsize=i(q)+n+i(r),m.rotation=f*(0>b*c?-1:1),f){var s=y(f,d,e);d=s.dx,e=s.dy}if(0>b&&(p+="x"),0>c&&(p+=" y")&&(o=-1),m.flip=p,l.coordorigin=d*-q+n+e*-r,k||g.fillsize){var t=l.getElementsByTagName(j);t=t&&t[0],l.removeChild(t),k&&(s=y(f,h.x(k[0],k[1]),h.y(k[0],k[1])),t.position=s.dx*o+n+s.dy*o),g.fillsize&&(t.size=g.fillsize[0]*i(b)+n+g.fillsize[1]*i(c)),l.appendChild(t)}m.visibility="visible"}};c.toString=function(){return"Your browser doesnâ€™t support SVG. Falling down to VML.\nYou are running RaphaÃ«l "+this.version};var A=function(a,c,d){for(var e=b(c).toLowerCase().split("-"),f=d?"end":"start",g=e.length,h="classic",i="medium",j="medium";g--;)switch(e[g]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":h=e[g];break;case"wide":case"narrow":j=e[g];break;case"long":case"short":i=e[g]}var k=a.node.getElementsByTagName("stroke")[0];k[f+"arrow"]=h,k[f+"arrowlength"]=i,k[f+"arrowwidth"]=j},B=function(e,i){e.attrs=e.attrs||{};var l=e.node,m=e.attrs,p=l.style,q=v[e.type]&&(i.x!=m.x||i.y!=m.y||i.width!=m.width||i.height!=m.height||i.cx!=m.cx||i.cy!=m.cy||i.rx!=m.rx||i.ry!=m.ry||i.r!=m.r),r=w[e.type]&&(m.cx!=i.cx||m.cy!=i.cy||m.r!=i.r||m.rx!=i.rx||m.ry!=i.ry),s=e;for(var t in i)i[a](t)&&(m[t]=i[t]);if(q&&(m.path=c._getPath[e.type](e),e._.dirty=1),i.href&&(l.href=i.href),i.title&&(l.title=i.title),i.target&&(l.target=i.target),i.cursor&&(p.cursor=i.cursor),"blur"in i&&e.blur(i.blur),(i.path&&"path"==e.type||q)&&(l.path=x(~b(m.path).toLowerCase().indexOf("r")?c._pathToAbsolute(m.path):m.path),"image"==e.type&&(e._.fillpos=[m.x,m.y],e._.fillsize=[m.width,m.height],z(e,1,1,0,0,0))),"transform"in i&&e.transform(i.transform),r){var y=+m.cx,B=+m.cy,D=+m.rx||+m.r||0,E=+m.ry||+m.r||0;l.path=c.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",f((y-D)*u),f((B-E)*u),f((y+D)*u),f((B+E)*u),f(y*u)),e._.dirty=1}if("clip-rect"in i){var G=b(i["clip-rect"]).split(k);if(4==G.length){G[2]=+G[2]+ +G[0],G[3]=+G[3]+ +G[1];var H=l.clipRect||c._g.doc.createElement("div"),I=H.style;I.clip=c.format("rect({1}px {2}px {3}px {0}px)",G),l.clipRect||(I.position="absolute",I.top=0,I.left=0,I.width=e.paper.width+"px",I.height=e.paper.height+"px",l.parentNode.insertBefore(H,l),H.appendChild(l),l.clipRect=H)}i["clip-rect"]||l.clipRect&&(l.clipRect.style.clip="auto")}if(e.textpath){var J=e.textpath.style;i.font&&(J.font=i.font),i["font-family"]&&(J.fontFamily='"'+i["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,o)+'"'),i["font-size"]&&(J.fontSize=i["font-size"]),i["font-weight"]&&(J.fontWeight=i["font-weight"]),i["font-style"]&&(J.fontStyle=i["font-style"])}if("arrow-start"in i&&A(s,i["arrow-start"]),"arrow-end"in i&&A(s,i["arrow-end"],1),null!=i.opacity||null!=i["stroke-width"]||null!=i.fill||null!=i.src||null!=i.stroke||null!=i["stroke-width"]||null!=i["stroke-opacity"]||null!=i["fill-opacity"]||null!=i["stroke-dasharray"]||null!=i["stroke-miterlimit"]||null!=i["stroke-linejoin"]||null!=i["stroke-linecap"]){var K=l.getElementsByTagName(j),L=!1;if(K=K&&K[0],!K&&(L=K=F(j)),"image"==e.type&&i.src&&(K.src=i.src),i.fill&&(K.on=!0),(null==K.on||"none"==i.fill||null===i.fill)&&(K.on=!1),K.on&&i.fill){var M=b(i.fill).match(c._ISURL);if(M){K.parentNode==l&&l.removeChild(K),K.rotate=!0,K.src=M[1],K.type="tile";var N=e.getBBox(1);K.position=N.x+n+N.y,e._.fillpos=[N.x,N.y],c._preload(M[1],function(){e._.fillsize=[this.offsetWidth,this.offsetHeight]})}else K.color=c.getRGB(i.fill).hex,K.src=o,K.type="solid",c.getRGB(i.fill).error&&(s.type in{circle:1,ellipse:1}||"r"!=b(i.fill).charAt())&&C(s,i.fill,K)&&(m.fill="none",m.gradient=i.fill,K.rotate=!1)}if("fill-opacity"in i||"opacity"in i){var O=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+c.getRGB(i.fill).o+1||2)-1);O=h(g(O,0),1),K.opacity=O,K.src&&(K.color="none")}l.appendChild(K);var P=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0],Q=!1;!P&&(Q=P=F("stroke")),(i.stroke&&"none"!=i.stroke||i["stroke-width"]||null!=i["stroke-opacity"]||i["stroke-dasharray"]||i["stroke-miterlimit"]||i["stroke-linejoin"]||i["stroke-linecap"])&&(P.on=!0),("none"==i.stroke||null===i.stroke||null==P.on||0==i.stroke||0==i["stroke-width"])&&(P.on=!1);var R=c.getRGB(i.stroke);P.on&&i.stroke&&(P.color=R.hex),O=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+R.o+1||2)-1);var S=.75*(d(i["stroke-width"])||1);if(O=h(g(O,0),1),null==i["stroke-width"]&&(S=m["stroke-width"]),i["stroke-width"]&&(P.weight=S),S&&1>S&&(O*=S)&&(P.weight=1),P.opacity=O,i["stroke-linejoin"]&&(P.joinstyle=i["stroke-linejoin"]||"miter"),P.miterlimit=i["stroke-miterlimit"]||8,i["stroke-linecap"]&&(P.endcap="butt"==i["stroke-linecap"]?"flat":"square"==i["stroke-linecap"]?"square":"round"),"stroke-dasharray"in i){var T={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};P.dashstyle=T[a](i["stroke-dasharray"])?T[i["stroke-dasharray"]]:o}Q&&l.appendChild(P)}if("text"==s.type){s.paper.canvas.style.display=o;var U=s.paper.span,V=100,W=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);p=U.style,m.font&&(p.font=m.font),m["font-family"]&&(p.fontFamily=m["font-family"]),m["font-weight"]&&(p.fontWeight=m["font-weight"]),m["font-style"]&&(p.fontStyle=m["font-style"]),W=d(m["font-size"]||W&&W[0])||10,p.fontSize=W*V+"px",s.textpath.string&&(U.innerHTML=b(s.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var X=U.getBoundingClientRect();s.W=m.w=(X.right-X.left)/V,s.H=m.h=(X.bottom-X.top)/V,s.X=m.x,s.Y=m.y+s.H/2,("x"in i||"y"in i)&&(s.path.v=c.format("m{0},{1}l{2},{1}",f(m.x*u),f(m.y*u),f(m.x*u)+1));for(var Y=["x","y","text","font","font-family","font-weight","font-style","font-size"],Z=0,$=Y.length;$>Z;Z++)if(Y[Z]in i){s._.dirty=1;break}switch(m["text-anchor"]){case"start":s.textpath.style["v-text-align"]="left",s.bbx=s.W/2;break;case"end":s.textpath.style["v-text-align"]="right",s.bbx=-s.W/2;break;default:s.textpath.style["v-text-align"]="center",s.bbx=0}s.textpath.style["v-text-kern"]=!0}},C=function(a,f,g){a.attrs=a.attrs||{};var h=(a.attrs,Math.pow),i="linear",j=".5 .5";if(a.attrs.gradient=f,f=b(f).replace(c._radial_gradient,function(a,b,c){return i="radial",b&&c&&(b=d(b),c=d(c),h(b-.5,2)+h(c-.5,2)>.25&&(c=e.sqrt(.25-h(b-.5,2))*(2*(c>.5)-1)+.5),j=b+n+c),o}),f=f.split(/\s*\-\s*/),"linear"==i){var k=f.shift();if(k=-d(k),isNaN(k))return null}var l=c._parseDots(f);if(!l)return null;if(a=a.shape||a.node,l.length){a.removeChild(g),g.on=!0,g.method="none",g.color=l[0].color,g.color2=l[l.length-1].color;for(var m=[],p=0,q=l.length;q>p;p++)l[p].offset&&m.push(l[p].offset+n+l[p].color);g.colors=m.length?m.join():"0% "+g.color,"radial"==i?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=j,g.angle=0):(g.type="gradient",g.angle=(270-k)%360),a.appendChild(g)}return 1},D=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=b,this.matrix=c.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},E=c.el;D.prototype=E,E.constructor=D,E.transform=function(a){if(null==a)return this._.transform;var d,e=this.paper._viewBoxShift,f=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:o;e&&(d=a=b(a).replace(/\.{3}|\u2026/g,this._.transform||o)),c._extractTransform(this,f+a);var g,h=this.matrix.clone(),i=this.skew,j=this.node,k=~b(this.attrs.fill).indexOf("-"),l=!b(this.attrs.fill).indexOf("url(");if(h.translate(1,1),l||k||"image"==this.type)if(i.matrix="1 0 0 1",i.offset="0 0",g=h.split(),k&&g.noRotation||!g.isSimple){j.style.filter=h.toFilter();var m=this.getBBox(),p=this.getBBox(1),q=m.x-p.x,r=m.y-p.y;j.coordorigin=q*-u+n+r*-u,z(this,1,1,q,r,0)}else j.style.filter=o,z(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate);else j.style.filter=o,i.matrix=b(h),i.offset=h.offset();return d&&(this._.transform=d),this},E.rotate=function(a,c,e){if(this.removed)return this;if(null!=a){if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",a,c,e]])),this}},E.translate=function(a,c){return this.removed?this:(a=b(a).split(k),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",a,c]])),this)},E.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null)),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this._.dirtyT=1,this},E.hide=function(){return!this.removed&&(this.node.style.display="none"),this},E.show=function(){return!this.removed&&(this.node.style.display=o),this},E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),c.eve.unbind("raphael.*.*."+this.id),c._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;this.removed=!0}},E.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if(b==j&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var g=b.split(k),h={},i=0,m=g.length;m>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return m-1?h:h[g[0]]}if(this.attrs&&null==d&&c.is(b,"array")){for(h={},i=0,m=b.length;m>i;i++)h[b[i]]=this.attr(b[i]);return h}var n;null!=d&&(n={},n[b]=d),null==d&&c.is(b,"object")&&(n=b);for(var o in n)l("raphael.attr."+o+"."+this.id,this,n[o]);if(n){for(o in this.paper.customAttributes)if(this.paper.customAttributes[a](o)&&n[a](o)&&c.is(this.paper.customAttributes[o],"function")){var p=this.paper.customAttributes[o].apply(this,[].concat(n[o]));this.attrs[o]=n[o];for(var q in p)p[a](q)&&(n[q]=p[q])}n.text&&"text"==this.type&&(this.textpath.string=n.text),B(this,n)}return this},E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&c._tofront(this,this.paper),this},E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper)),this)},E.insertAfter=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[a.length-1]),a.node.nextSibling?a.node.parentNode.insertBefore(this.node,a.node.nextSibling):a.node.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this)},E.insertBefore=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[0]),a.node.parentNode.insertBefore(this.node,a.node),c._insertbefore(this,a,this.paper),this)},E.blur=function(a){var b=this.node.runtimeStyle,d=b.filter;return d=d.replace(r,o),0!==+a?(this.attrs.blur=a,b.filter=d+n+m+".Blur(pixelradius="+(+a||1.5)+")",b.margin=c.format("-{0}px 0 0 -{0}px",f(+a||1.5))):(b.filter=d,b.margin=0,delete this.attrs.blur),this},c._engine.path=function(a,b){var c=F("shape");c.style.cssText=t,c.coordsize=u+n+u,c.coordorigin=b.coordorigin;var d=new D(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a),d.type="path",d.path=[],d.Path=o,B(d,e),b.canvas.appendChild(c);var f=F("skew");return f.on=!0,c.appendChild(f),d.skew=f,d.transform(o),d},c._engine.rect=function(a,b,d,e,f,g){var h=c._rectPath(b,d,e,f,g),i=a.path(h),j=i.attrs;return i.X=j.x=b,i.Y=j.y=d,i.W=j.width=e,i.H=j.height=f,j.r=g,j.path=h,i.type="rect",i},c._engine.ellipse=function(a,b,c,d,e){{var f=a.path();f.attrs}return f.X=b-d,f.Y=c-e,f.W=2*d,f.H=2*e,f.type="ellipse",B(f,{cx:b,cy:c,rx:d,ry:e}),f},c._engine.circle=function(a,b,c,d){{var e=a.path();e.attrs}return e.X=b-d,e.Y=c-d,e.W=e.H=2*d,e.type="circle",B(e,{cx:b,cy:c,r:d}),e},c._engine.image=function(a,b,d,e,f,g){var h=c._rectPath(d,e,f,g),i=a.path(h).attr({stroke:"none"}),k=i.attrs,l=i.node,m=l.getElementsByTagName(j)[0];return k.src=b,i.X=k.x=d,i.Y=k.y=e,i.W=k.width=f,i.H=k.height=g,k.path=h,i.type="image",m.parentNode==l&&l.removeChild(m),m.rotate=!0,m.src=b,m.type="tile",i._.fillpos=[d,e],i._.fillsize=[f,g],l.appendChild(m),z(i,1,1,0,0,0),i},c._engine.text=function(a,d,e,g){var h=F("shape"),i=F("path"),j=F("textpath");d=d||0,e=e||0,g=g||"",i.v=c.format("m{0},{1}l{2},{1}",f(d*u),f(e*u),f(d*u)+1),i.textpathok=!0,j.string=b(g),j.on=!0,h.style.cssText=t,h.coordsize=u+n+u,h.coordorigin="0 0";var k=new D(h,a),l={fill:"#000",stroke:"none",font:c._availableAttrs.font,text:g};k.shape=h,k.path=i,k.textpath=j,k.type="text",k.attrs.text=b(g),k.attrs.x=d,k.attrs.y=e,k.attrs.w=1,k.attrs.h=1,B(k,l),h.appendChild(j),h.appendChild(i),a.canvas.appendChild(h);var m=F("skew");return m.on=!0,h.appendChild(m),k.skew=m,k.transform(o),k},c._engine.setSize=function(a,b){var d=this.canvas.style;return this.width=a,this.height=b,a==+a&&(a+="px"),b==+b&&(b+="px"),d.width=a,d.height=b,d.clip="rect(0 "+a+" "+b+" 0)",this._viewBox&&c._engine.setViewBox.apply(this,this._viewBox),this},c._engine.setViewBox=function(a,b,d,e,f){c.eve("raphael.setViewBox",this,this._viewBox,[a,b,d,e,f]);var h,i,j=this.width,k=this.height,l=1/g(d/j,e/k);return f&&(h=k/e,i=j/d,j>d*h&&(a-=(j-d*h)/2/h),k>e*i&&(b-=(k-e*i)/2/i)),this._viewBox=[a,b,d,e,!!f],this._viewBoxShift={dx:-a,dy:-b,scale:l},this.forEach(function(a){a.transform("...")}),this};var F;c._engine.initWin=function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),F=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){F=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},c._engine.initWin(c._g.win),c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a.container,d=a.height,e=a.width,f=a.x,g=a.y;if(!b)throw new Error("VML container not found.");var h=new c._Paper,i=h.canvas=c._g.doc.createElement("div"),j=i.style;return f=f||0,g=g||0,e=e||512,d=d||342,h.width=e,h.height=d,e==+e&&(e+="px"),d==+d&&(d+="px"),h.coordsize=1e3*u+n+1e3*u,h.coordorigin="0 0",h.span=c._g.doc.createElement("span"),h.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",i.appendChild(h.span),j.cssText=c.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",e,d),1==b?(c._g.doc.body.appendChild(i),j.left=f+"px",j.top=g+"px",j.position="absolute"):b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i),h.renderfix=function(){},h},c.prototype.clear=function(){c.eve("raphael.clear",this),this.canvas.innerHTML=o,this.span=c._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},c.prototype.remove=function(){c.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;return!0};var G=c.st;for(var H in E)E[a](H)&&!G[a](H)&&(G[H]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(H))}}(),B.was?A.win.Raphael=c:Raphael=c,c});

/* SOURCE FILE: PiObject.js (ea38953b) 9/9/2014 2:08:59 PM */

PiObject = function(o){
this.properties = [];
var values = {};
this.length = this.properties.length;
this.listeners = {};
this.filters = {};
this.globalListeners = [];
this.globalFilters = [];
var uuid = null;
var uid = -1;
this.getUUID = function() {
if (uuid == null) {
var my = {};
my.date = new Date();
my.uuid = [];
my.uuid.push(my.date.getFullYear().toString());
my.uuid.push(my.date.getMonth().toString());
my.uuid.push(my.date.getDate().toString());
my.uuid.push(my.date.getTime().toString());
uuid = my.uuid.join("");
}
return uuid;
}
this.getLength = function() {
return this.properties.length;
}
this.getProperty = function(index) {
if (index.constructor != Number)
return index.replace(/^\s*(\S*)\s*$/,'$1');
else if (index >= 0 && index < this.getLength())
return this.properties[index];
else
return '';
}
this.getIndex = function(propertyName) {
if (propertyName.constructor != Number) {
for (var i=0; i < this.getLength(); i++)
if (this.properties[i] == propertyName)
return i;
}
var num = parseInt(propertyName);
if (propertyName == num && num >= 0 && num < this.getLength())
return num;
else
return -1;
}
this.getPropertyList = function(propertyName) {
if (propertyName) {
var value;
var propertyList = [];
for (var i=0; i<this.properties.length; i++) {
value = values[this.properties[i]];
if (value instanceof PiObject)
propertyList.push( value.get(propertyName).toString() );
else if (value instanceof Object)
propertyList.push( value[propertyName] || '' );
else
propertyList.push('');
}
return propertyList.join();
}
else {
return this.properties.join();
}
}
this.get = function(property) {
var my = {};
property = this.getProperty(property);
if (typeof values[property] != "undefined")
my.result = values[property]
else
my.result = "";
my.filters = this.filters[property] || [];
my.filters = my.filters.concat(this.globalFilters);
for (var i=0; i < my.filters.length; i++) {
my.returnVariable = my.filters[i].method.call(my.filters[i].scope,this,property,my.result);
if (my.returnVariable != undefined)
my.result = my.returnVariable;
}
return my.result;
}
this.exists = function(property) {
property = this.getProperty(property);
if (property.length && this.getIndex(property) >= 0)
return true;
else
return false;
}
this.set = function(propertyName,value) {
var o = {};
if (propertyName != undefined) {
if (propertyName.constructor == Object)
o = propertyName;
else
o[this.getProperty(propertyName)] = value;
}
var my = {};
for (my.name in o) {
my.index = my.name;
if (my.name.constructor == Number)
my.name = this.getProperty(my.name);
my.oldValue = values[my.name] || "";
if (this.getIndex(my.index) < 0) {
uid++;
this.properties.push(my.name);
this.length = this.properties.length;
}
my.newValue = o[my.name];
values[my.name] = my.newValue;
my.listeners = this.listeners[my.name] || [];
my.listeners = my.listeners.concat(this.globalListeners);
for (var i=0; i < my.listeners.length; i++) {
my.result = my.listeners[i].method.call(my.listeners[i].scope,this,my.index,my.oldValue,my.newValue);
if (my.result != undefined && my.result != my.newValue) {
my.newValue = my.result;
values[my.name] = my.newValue;
}
}
}
if (propertyName != undefined && propertyName.constructor != Object)
return this.get(my.name);
else
return this;
}
this.insertAt = function(i) {
var my = {};
var o = {};
my.index = this.getIndex(i);
for (var i=1; i < arguments.length; i++) {
my.prop = (++uid).toString();
if (my.index >= 0)
this.properties.splice(my.index++,0,my.prop);
else
this.properties.push(my.prop);
this.length = this.properties.length;
o[my.prop] = arguments[i];
}
return this.set(o);
}
this.add = function() {
var my = {};
var o = {};
for (var i=0; i < arguments.length; i++) {
my.prop = (++uid).toString();
this.properties.push(my.prop);
this.length = this.properties.length;
o[my.prop] = arguments[i];
}
return this.set(o);
}
this.append = this.add;
this.move = function(oldName,newName) {
var my = {};
my.oldIndex = this.getIndex(oldName);
if (my.oldIndex < 0)
throw "index does not exist";
if (my.oldIndex < -this.properties.length || my.oldIndex > this.properties.length)
throw "index does not exist";
my.newIndex = this.getIndex(newName);
if (my.newIndex < 0) {
if (typeof(oldName) == "string")
my.newIndex = my.oldIndex;
else
my.newIndex = this.properties.length;
}
if (my.oldIndex != my.newIndex) {
my.prop = this.properties.splice(my.oldIndex,1)[0];
if (my.newIndex < 0)
my.newIndex++;
if (my.newIndex >= this.properties.length)
this.properties.push(my.prop);
else
this.properties.splice(my.newIndex,0,my.prop);
}
if (typeof(oldName) == "string" && typeof(newName) == "string") {
this.remove(newName);
this.properties[this.getIndex(oldName)] = newName;
values[newName] = values[oldName];
delete values[oldName];
}
return this;
}
this.remove = function() {
var my = {};
var o = {};
for (var i=0; i < arguments.length; i++) {
my.prop = this.getProperty(arguments[i]);
if (values[my.prop] != undefined)
o[my.prop] = "";
}
this.set(o);
for (my.prop in o) {
my.index = this.getIndex(my.prop);
if (values[my.prop].length == 0) {
delete values[my.prop];
this.properties.splice(my.index,1);
this.length = this.properties.length;
}
}
return this;
}
this.deleteIt = this.remove;
this.removeAll = function() {
for (var i=0; i < this.length; i++) {
this.set(i,"");
}
for (var i in values)
delete values[i];
delete this.properties;
this.properties = [];
this.length=this.properties.length;
return this;
}
this.deleteAll = this.removeAll
var addFunction = function(type,action,property,scope,method,applyToExisting) {
var my = {};
if (typeof(property) == "string")
property = property.split(",");
if (property == undefined || property.constructor != Array) {
applyToExisting = method;
method = scope;
scope = property;
property = [""];
}
if (typeof(scope) == "function") {
applyToExisting = method;
method = scope;
scope = this;
}
else if (typeof(method) == "string") {
method = scope[method];
}
if (applyToExisting == undefined || typeof(applyToExisting) != "boolean")
applyToExisting = true;
if (typeof(scope) != "object")
throw("The scope parameter supplied to the " + action + type + "() function was not of type 'object'.");
if (typeof(method) != "function")
throw("The method parameter supplied to the " + action + type + "() function was not of type 'function'.");
if (property.constructor != Array)
throw("The property parameter supplied to the " + action + type + "() function must be either of type 'string' or 'array'.");
if (typeof(applyToExisting) != "boolean")
throw("The applyToExisting parameter supplied to the " + action + type + "() function was not of type 'boolean'.");
for (my.index=0; my.index<property.length; my.index++) {
my.property = this.getProperty(property[my.index]);
if (my.property.length) {
if (type == "Listener") {
if (action == "add")
this.listeners[my.property] = this.listeners[my.property] || [];
my.functions = this.listeners[my.property];
} else {
if (action == "add")
this.filters[my.property] = this.filters[my.property] || [];
my.functions = this.filters[my.property];
}
} else {
if (type == "Listener")
my.functions = this.globalListeners;
else
my.functions = this.globalFilters
}
if (my.functions != undefined) {
my.alreadyExists = false;
for (var i=my.functions.length-1; i >= 0; i--) {
if (my.functions[i].method == method && my.functions[i].scope === scope) {
if (action == "add")
my.alreadyExists = true;
else if (action == "remove")
my.functions.splice(i,1);
break;
}
}
if (action == "add" && !my.alreadyExists) {
my.functions.push({
'property':my.property,
'scope':scope,
'method':method,
'applyToExisting':applyToExisting
});
if (type == "Listener" && applyToExisting) {
if (my.property.length)
my.properties = [my.property];
else
my.properties = this.properties;
for (var i=0; i < my.properties.length; i++) {
if (values[my.properties[i]] != undefined) {
my.result = method.call(scope,this,my.properties[i],"",values[my.properties[i]]);
if (my.result != undefined)
values[my.properties[i]] = my.result;
}
}
}
}
}
}
return this;
}
this.addListener = function(property,scope,method,applyToExisting) {
return addFunction.call(this,"Listener","add",property,scope,method,applyToExisting);
}
this.removeListener = function(property,scope,method) {
return addFunction.call(this,"Listener","remove",property,scope,method);
}
this.addFilter = function(property,scope,method) {
return addFunction.call(this,"Filter","add",property,scope,method);
}
this.removeFilter = function(property,scope,method) {
return addFunction.call(this,"Filter","remove",property,scope,method);
}
this.each = function(scope,method) {
if (typeof(scope) == "function") {
method = scope;
scope = this;
}
else if (typeof(method) == "string") {
method = scope[method];
}
if (typeof(scope) != "object")
throw("The scope parameter supplied to the each() function was not of type 'object'.");
if (typeof(method) != "function")
throw("The method parameter supplied to the each() function was not of type 'function'.");
var propertyList = this.getPropertyList().split(',');
for (var i=0; i<propertyList.length; i++) {
if (typeof(values[propertyList[i]]) != "undefined") {
var result = method.call(scope,this,propertyList[i],values[propertyList[i]]);
if (result != undefined) {
return result;
}
}
}
}
this.init(o);
this.destroy = function() {
delete this.properties;
for (var prop in values)
delete values[prop];
delete this.length;
for (var prop in this.listeners)
for (var i in this.listeners[prop])
delete this.listeners[prop][i];
delete this.listeners;
for (var prop in this.filters)
for (var i in this.filters[prop])
delete this.filters[prop][i];
delete this.filters;
for (var i in this.globalListeners)
delete this.globalListeners[i];
delete this.globalListeners;
for (var i in this.globalFilters)
delete this.globalFilters[i];
delete this.globalFilters;
}
this.getValues = function(){
var copy = {};
for (var prop in values)
copy[prop] = values[prop];
return copy;
}
};
PiObject.prototype.init = function(o) {
if (o instanceof Array)
this.add.apply(this,o);
else
this.set.apply(this,arguments);
}
Pi = PiObject;
Pi.extend=function(constructor) {
var parent = this;
constructor = constructor || function(){
parent.prototype.constructor.apply(this,arguments);
};
constructor.parent = parent.prototype;
constructor.extend = PiObject.extend;
constructor.prototype = new parent();
constructor.prototype.constructor = constructor;
return constructor;
}

/* SOURCE FILE: Set.js (55dec090) 9/9/2014 2:09:01 PM */

if (typeof(MeasurementTool) == "undefined") {
MeasurementTool = {};
}
MeasurementTool.Set = PiObject.extend();
MeasurementTool.Set.prototype.init = function (config) {
config = this.set('config', config || {});
this.addListener('config', this.defaultConfig);
MeasurementTool.Set.parent.init.apply(this, arguments);
if (!this.exists('children')) {
var children = this.set('children', new PiObject());
} else {
var children = this.get('children');
}
this.addListener('children', this.initCollection);
children.addListener(this, this.transformChildren, false);
if (!this.exists('transforms')) {
var transforms = this.set('transforms', new PiObject());
} else {
var transforms = this.get('transforms');
}
transforms.addListener(this, this.defineTransform);
transforms.addListener(this, this.transform);
this.addFilter('transform', this.getTransform);
this.addFilter('transforms', this.getPosition);
this.addFilter('transforms', this.getRotation);
this.addFilter('dragHandleAttributes', this.getDragHandleAttributes);
this.addListener('canvas', this.addSet);
this.addFilter('offset', this.getOffset);
this.addListener('scale', this.setScale);
this.addListener('visibility', this.setVisibility);
this.addListener('visibility', this.resetTransforms);
};
MeasurementTool.Set.prototype.defaultConfig = function (object, property, oldConfig, newConfig) {
this.removeListener(property, this.defaultConfig);
newConfig = typeof(newConfig) == "object" ? newConfig : {};
};
MeasurementTool.Set.prototype.initCollection = function (object, property, oldValue, newValue) {
if (newValue != '') {
if (newValue.constructor == Array || newValue.constructor == Object) {
return new PiObject(newValue);
}
}
};
MeasurementTool.Set.prototype.setVisibility = function (object, property, oldValue, newValue) {
if (this.exists('set')) {
if (this.get('visibility') == 'hidden') {
this.get('set').hide();
} else {
this.get('set').show();
}
}
};
MeasurementTool.Set.prototype.resetTransforms = function (object, property, oldValue, newValue) {
if (newValue == 'hidden') {
this.get('transforms').removeAll();
this.transform();
this.setVisibility(this, 'visibility', '', this.get('visibility'));
}
};
MeasurementTool.Set.prototype.setScale = function (object, property, oldValue, newValue) {
if (oldValue != "" && newValue == "") {
this.get('transforms').remove('scale');
}
if (newValue != "") {
this.get('transforms').set('scale', { scale: newValue });
}
};
MeasurementTool.Set.prototype.defineTransform = function (transforms, index, oldTransform, newTransform) {
if (newTransform != "") {
switch (index) {
case 'rotation':
newTransform.type = newTransform.type || 'r';
break;
case 'translation':
newTransform.type = newTransform.type || 't';
break;
case 'scale':
newTransform.type = newTransform.type || 's';
break;
}
switch (newTransform.type) {
case 'r':
case 'R':
case 'rotate':
case 'rotation':
if (typeof(newTransform) != "object") {
newTransform = {
type: 'r',
angle: +newTransform
};
}
newTransform.svg = newTransform.type.charAt(0);
newTransform.type = 'rotation';
newTransform.css = "rotate";
newTransform.angle = newTransform.angle || 0;
newTransform.x = typeof(newTransform.x) != "undefined" ? newTransform.x : (this.exists('center') ? +this.get('center').x : this.exists('width') ? this.get('width') / 2 : 0);
newTransform.y = typeof(newTransform.y) != "undefined" ? newTransform.y : (this.exists('center') ? +this.get('center').y : this.exists('height') ? this.get('height') / 2 : 0);
newTransform.h = Math.sqrt(Math.pow(newTransform.x, 2) + Math.pow(newTransform.y, 2));
break;
case 't':
case 'T':
case 'translate':
case 'translation':
newTransform.svg = newTransform.type.charAt(0);
newTransform.type = 'translation';
newTransform.css = "translate";
newTransform.x = typeof(newTransform.x) != "undefined" ? newTransform.x : 0;
newTransform.y = typeof(newTransform.y) != "undefined" ? newTransform.y : 0;
break;
case 's':
case 'S':
case 'scale':
newTransform.svg = newTransform.type.charAt(0);
newTransform.type = 'scale';
newTransform.css = 'scale';
newTransform.scale = typeof(newTransform.scale) != "undefined" ? newTransform.scale : 1;
break;
}
}
};
MeasurementTool.Set.prototype.getPosition = function(object, property, transforms) {
if (!transforms.exists('translation')) {
transforms.set('translation', {
x: this.exists('x') ? this.get('x') : this.exists('width') && this.exists('canvas') ? this.get('canvas').get('width') / 2 - this.get('width') / 2 : 0,
y: this.exists('y') ? this.get('y') : this.exists('height') && this.exists('canvas') ? this.get('canvas').get('height') / 2 - this.get('height') / 2 : 0
});
}
};
MeasurementTool.Set.prototype.getRotation = function (object, property, transforms) {
if (!transforms.exists('rotation')) {
transforms.set('rotation', {
angle: this.get('rotation')
});
}
};
MeasurementTool.Set.prototype.getDragHandleAttributes = function (object, property, value) {
this.removeFilter(property, this.getDragHandleAttributes);
if (value == "") {
return this.set(property, {
stroke: 'none',
fill: '#00F',
'fill-opacity': 0
});
}
};
MeasurementTool.Set.prototype.addSet = function (object, property, oldCanvas, newCanvas) {
if (!this.exists('set')) {
this.set('set', (newCanvas instanceof PiObject) ? newCanvas.get('canvas').set() : newCanvas.set());
this.transform();
this.setVisibility(this, 'visibility', '', this.get('visibility'));
}
};
MeasurementTool.Set.prototype.getOffset = function (object, property, offset) {
if (this.exists('canvas')) {
return this.get('canvas').get('offset');
}
};
MeasurementTool.Set.prototype.getTransform = function (object, property, transform) {
var result = [];
var translation = [];
var transforms = this.get('transforms');
transforms.each(function(transforms, index, transform) {
if (transform != "") {
switch (transform.type) {
case 'rotation':
result.push([transform.svg, transform.angle, transform.x, transform.y].join(" "));
break;
case 'translation':
result.push([transform.svg, transform.x, transform.y].join(" "));
break;
case 'scale':
result.push([transform.svg, transform.scale].join(" "));
}
}
});
return result.join(" ");
};
MeasurementTool.Set.prototype.transformChildren = function(children, index, oldChild, newChild) {
if (oldChild != "") {
if (oldChild instanceof PiObject) {
oldChild.removeFilter('transform', this, this.addParentTransform);
}
}
if (newChild != "") {
if (newChild instanceof PiObject) {
newChild.addFilter('transform', this, this.addParentTransform);
}
}
};
MeasurementTool.Set.prototype.addParentTransform = function(child, property, transform) {
return [this.get('transform'), transform].join(" ");
};
MeasurementTool.Set.prototype.transform = function(transforms, index, oldTransform, newTransform) {
if (this.exists('set')) {
var set = this.get('set');
if (set.transform) {
set.transform(this.get('transform'));
}
this.get('children').each(function(children, index, child) {
if (child.transform) {
child.transform();
}
});
}
};
MeasurementTool.Set.prototype.translation = (function() {
var start;
return {
'drag': function(dx, dy, x, y) {
this.get('transforms').set('translation', {
x: start.x + dx,
y: start.y + dy
});
},
'start': function(x, y, event) {
start = this.get('transforms').get('translation');
},
'stop': function(x, y, event) {}
};
})();
MeasurementTool.Set.prototype.rotation = (function() {
var last;
return {
'drag': function(dx, dy, canvasX, canvasY) {
var offset = this.get('offset');
var transforms = this.get('transforms');
var translation = transforms.get('translation');
var rotation = transforms.get('rotation');
var current = Raphael.angle(canvasX, canvasY, offset.x + rotation.x + translation.x, offset.y + rotation.y + translation.y);
var delta = current - last;
if (delta < -180) {
delta += 360;
} else if (delta > 180) {
delta -= 360;
}
last = current;
rotation.angle += delta;
transforms.set('rotation', rotation);
return;
},
'start': function(canvasX, canvasY, event) {
var offset = this.get('offset');
var transforms = this.get('transforms');
var translation = transforms.get('translation');
var rotation = transforms.get('rotation');
last = Raphael.angle(canvasX, canvasY, offset.x + rotation.x + translation.x, offset.y + rotation.y + translation.y);
},
'stop': function(x, y, event) {}
};
})();

/* SOURCE FILE: Canvas.js (890ff3d4) 9/9/2014 2:09:01 PM */

if (typeof(MeasurementTool) == "undefined") {
MeasurementTool = {};
}
MeasurementTool.Canvas = MeasurementTool.Set.extend();
MeasurementTool.Canvas.prototype.init = function(config) {
if (typeof config == 'undefined') {
return;
}
config = config || {};
config.window = config.window || window;
MeasurementTool.Canvas.parent.init.apply(this, arguments);
this.addListener('window', this.initRaphael);
this.addFilter('node', this.createNode);
this.addListener('node', this.initNode);
};
MeasurementTool.Canvas.prototype.defaultConfig = function(object, property, oldConfig, newConfig) {
MeasurementTool.Canvas.parent.defaultConfig.apply(this, arguments);
newConfig.width = newConfig.width || 620;
newConfig.height = newConfig.height || 420;
newConfig.r = newConfig.r || 0;
newConfig.stroke = newConfig.stroke || 'none';
newConfig.fill = newConfig.fill || 'none';
newConfig.scale = newConfig.scale || 1;
};
MeasurementTool.Canvas.prototype.initRaphael = function(object, property, oldWindow, newWindow) {
Raphael.setWindow(newWindow);
};
MeasurementTool.Canvas.prototype.createNode = function(object, property, node) {
var doc = this.get('window').document;
if (doc.body) {
this.removeFilter(property, this.createNode);
if (node == "") {
node = doc.createElement('div');
node.id = this.get('id');
node.className = this.get('classname');
var parent = this.exists('parent') ? this.get('parent') : doc.body;
var box = parent.getBoundingClientRect();
var width = this.get('width');
var height = this.get('height');
parent.appendChild(node);
node.style.cssText = [
'width:' + width,
'height:' + height
].join(';');
if (!this.exists('x')) {
this.set('x', box.left + box.width / 2 - width / 2);
}
if (!this.exists('y')) {
this.set('y', box.top + box.height / 2 - height / 2);
}
node.style.visibility = this.exists('visibility') ? this.get('visibility') : 'visible';
this.set('node', node);
}
}
};
MeasurementTool.Canvas.prototype.initNode = function(object, property, oldNode, newNode) {
if (typeof (newNode) == "string") {
newNode = Raphael._g.doc.getElementById(this.set('id', newNode));
} else {
this.set('id', newNode.id);
}
if (newNode.ownerDocument && newNode.ownerDocument != Raphael._g.doc && newNode.ownerDocument.defaultView) {
Raphael.setWindow(newNode.ownerDocument.defaultView);
}
if (newNode.childNodes) {
while (newNode.hasChildNodes()) {
if (newNode.firstChild.tagName == "IMG") {
var src = newNode.firstChild.src;
if (src.charAt(0) != '/' && src.indexOf('://') == -1) {
var href = window.document.location.href;
var last = href.split('/').pop();
if (last.indexOf('.')) {
var dir = href.substr(0, href.length - last.length);
} else {
var dir = href;
}
if (dir.charAt(dir.length - 1) != '/') {
dir += '/';
}
src = dir + src;
}
var img = {
type: 'image',
src: src,
width: this.get('width'),
height: this.get('height'),
x: 0,
y: 0
};
for (var i = 0; i < newNode.firstChild.attributes.length; i++) {
switch (newNode.firstChild.attributes[i].name) {
case 'width':
var value = +newNode.firstChild.attributes[i].value;
if (value) {
img.width = value;
img.x = (this.get('width') - value) / 2;
}
break;
case 'height':
var value = +newNode.firstChild.attributes[i].value;
if (value) {
img.height = value;
img.y = (this.get('height') - value) / 2;
}
break;
}
}
}
newNode.removeChild(newNode.firstChild);
}
}
this.set('raphael', Raphael);
this.set('canvas', Raphael(
newNode,
this.get('width'),
this.get('height')
));
this.addListener('r', this.outline, false);
this.addListener('stroke', this.outline, false);
this.addListener('fill', this.outline, false);
this.outline();
if (img) {
this.get('children').insertAt(0, img);
}
this.addFilter('transformProperty', this.getTransformProperty);
this.addFilter('transformMatrix', this.getTransformMatrix);
this.get('children').addListener(this, this.initChildren);
this.addListener('x', this.moveNode);
this.addListener('y', this.moveNode);
return newNode;
};
MeasurementTool.Canvas.prototype.moveNode = function(object, property, oldValue, newValue) {
if (this.exists('node')) {
switch (property) {
case 'x':
this.get('node').style.left = newValue + 'px';
break;
case 'y':
this.get('node').style.top = newValue + 'px';
break;
}
}
};
MeasurementTool.Canvas.prototype.resetTransforms = function(object, property, oldValue, newValue) {
MeasurementTool.Canvas.parent.resetTransforms.apply(this, arguments);
};
MeasurementTool.Canvas.prototype.getPosition = function(object, property, transforms) {
if (!transforms.exists('translation')) {
transforms.set('translation', { x: 0, y: 0 });
}
};
MeasurementTool.Canvas.prototype.getOffset = function(object, property, offset) {
if (this.exists('node')) {
var node = this.get('node'),
height = this.get('height'),
width = this.get('width'),
box = node.getBoundingClientRect();
offset = getOffset(node, this.get('raphael'));
if (box.height != height || box.width != width) {
var translation = this.get('transformMatrix');
offset.x = offset.x + (box.right - box.left) / 2 - width / 2 - translation.e;
offset.y = offset.y + (box.bottom - box.top) / 2 - height / 2 - translation.f;
}
return offset;
}
function getOffset(elem, raphael) {
var thisbox = elem.getBoundingClientRect(),
doc = elem.ownerDocument,
body = doc.body,
docElem = doc.documentElement,
clientTop = docElem.clientTop || body.clientTop || 0,
clientLeft = docElem.clientLeft || body.clientLeft || 0,
top = thisbox.top + (raphael._g.win.pageYOffset || docElem.scrollTop || body.scrollTop) - clientTop,
left = thisbox.left + (raphael._g.win.pageXOffset || docElem.scrollLeft || body.scrollLeft) - clientLeft;
return {
y: top,
x: left
};
};
};
MeasurementTool.Canvas.prototype.setVisibility = function(object, property, oldValue, newValue) {
if (this.exists('node')) {
this.get('node').style['visibility'] = this.get('visibility');
}
};
MeasurementTool.Canvas.prototype.getTransformProperty = function(object, property, value) {
var node = this.get('node');
var properties = [
'transform',
'WebkitTransform',
'msTransform',
'MozTransform',
'OTransform',
'filters'
];
for (var i = 0; i < properties.length; i++) {
value = properties[i];
if (typeof(node.style[value]) != 'undefined') {
break;
}
}
if (value != 'filters' || typeof(document.body.filters) != "undefined") {
this.removeFilter(property, this.getTransformProperty);
return this.set(property, value);
}
};
MeasurementTool.Canvas.prototype.getTransformMatrix = function(object, property, value) {
value = Raphael.matrix(1, 0, 0, 1, 0, 0);
this.get('transforms').each(this, function(transforms, index, transform) {
if (transform != "") {
var current = value.split();
}
switch (transform.type) {
case 'rotation':
if (transform.angle % 360) {
var raphael = this.get('raphael');
var scale = this.get('scale');
var delta = {
x: (transform.x - this.get('width') / 2) * scale,
y: (transform.y - this.get('height') / 2) * scale
};
delta.h = Math.sqrt(Math.pow(delta.x, 2) + Math.pow(delta.y, 2));
delta.angle = raphael.rad(raphael.angle(transform.x, transform.y, this.get('width') / 2, this.get('height') / 2) + transform.angle);
value.translate(delta.x - delta.h * Math.cos(delta.angle), delta.y - delta.h * Math.sin(delta.angle));
}
value.rotate(transform.angle);
break;
case 'translation':
value.translate(transform.x, transform.y);
break;
case 'scale':
value.scale(transform.scale);
break;
}
});
return value;
};
MeasurementTool.Canvas.prototype.transform = function(transforms, index, oldTransform, newTransform) {
if (this.exists('node') && this.exists('canvas')) {
var node = this.get('node');
var transforms = this.get('transforms');
var property = this.get('transformProperty');
var matrix = this.get('transformMatrix');
if (this.exists('scale')) {
var scale = this.get('scale');
var canvas = this.get('canvas').canvas;
canvas.setAttribute('width', scale * this.get('width'));
canvas.setAttribute('height', scale * this.get('height'));
this.get('children').each(function(children, index, child) {
if (child.transform) {
child.transform();
}
});
}
if (property == "filters") {
var filter = node.filters.item('DXImageTransform.Microsoft.Matrix');
filter.M11 = matrix[0][0];
filter.M12 = matrix[0][1];
filter.M21 = matrix[1][0];
filter.M22 = matrix[1][1];
} else if (node.style[property] != null) {
node.style[property] = matrix.toString();
}
}
};
MeasurementTool.Canvas.prototype.initChildren = function(object, property, oldChild, newChild) {
if (oldChild != newChild) {
if (oldChild != '') {
if (oldChild instanceof MeasurementTool.Set) {
oldChild.remove('canvas');
} else {
oldChild.remove();
}
}
if (newChild != '') {
var newRaphaelObject;
if (newChild instanceof MeasurementTool.Set) {
newRaphaelObject = newChild.set({
'canvas': this
}).get('set');
}
else if (!newChild.paper) {
newRaphaelObject = this.get('canvas').add(
(newChild.constructor == Array) ? newChild : [newChild]
);
}
this.get('set').push(newRaphaelObject);
}
}
};
MeasurementTool.Canvas.prototype.outline = function(object, property, oldValue, newValue) {
if (this.exists('outline')) {
var outline = this.get('outline');
outline[property] = newValue;
this.get('children').set(0, outline);
} else {
var config = this.get('config');
config.type = 'rect';
this.get('children').insertAt(0, this.set('outline', config));
}
};
MeasurementTool.Canvas.prototype.translation = (function() {
var start;
return {
'drag': function (dx, dy, x, y) {
var newX = start.x + dx,
newY = start.y + dy,
toolHeight = this.get('height') / 2,
toolWidth = this.get('width') / 2;
if(newX + toolWidth <= this.get('rightBoundary') &&
newY + toolHeight <= this.get('bottomBoundary') &&
newX + toolWidth >= 0 &&
newY + toolHeight >= 0) {
this.set('x', newX);
this.set('y', newY);
}
},
'start': function(x, y, event) {
start = {
x: this.get('x'),
y: this.get('y')
};
},
'stop': function(x, y, event) {}
};
})();

/* SOURCE FILE: StraightLine.js (551fe062) 9/9/2014 2:09:01 PM */

if (typeof(MeasurementTool) == "undefined") {
MeasurementTool = {};
}
MeasurementTool.StraightLine = MeasurementTool.Set.extend();
MeasurementTool.StraightLine.prototype.init = function(config) {
MeasurementTool.StraightLine.parent.init.apply(this, arguments);
this.set('lines', new PiObject()).addListener(MeasurementTool.StraightLine.prototype.removeLine);
this.addListener('set', this.addPencil);
this.transform();
};
MeasurementTool.StraightLine.prototype.defaultConfig = function(object, property, oldConfig, newConfig) {
newConfig.width = newConfig.width || 18;
newConfig.height = newConfig.height || 62;
newConfig.origin = {
x: newConfig.width / 2,
y: newConfig.height
};
MeasurementTool.StraightLine.parent.defaultConfig.apply(this, arguments);
};
MeasurementTool.StraightLine.prototype.setVisibility = function(object, property, oldValue, newValue) {
if (this.exists('canvas')) {
var canvasHolder = this.get('canvas').get('canvas'),
canvas = canvasHolder.canvas;
var moveStraightLine = function (event) {
var offset = canvas.getBoundingClientRect(),
zoomFactor = straightline.get('zoomFactor');
if (canvasHolder.bottom.node) {
offset = canvasHolder.bottom.node.getBoundingClientRect();
}
straightline.get('transforms').set('translation', {
x: (event.clientX - offset.left) / zoomFactor - (15 * zoomFactor),  // The 15 is so that even after rotation, the object is still positioned under the mouse.  CAUTION: This is especially important in Firefox 3.5, which handles rotated objects slightly differently than later versions of Firefox!
y: (event.clientY - offset.top - straightline.get('height')) / zoomFactor + (5 * zoomFactor)    // The 5 is to give the mouse some padding so we don't see the cursor flutter so much.
});
};
if (newValue == 'hidden') {
canvas.style.cursor = 'inherit';
canvas.removeEventListener('mousemove', moveStraightLine, false);
if ('ontouchstart' in window) {
canvas.removeEventListener('mousedown', moveStraightLine, false);
}
this.get('set').hide();
} else {
var straightline = this;
straightline.addMouseListener(canvas, 'mousemove', moveStraightLine);
if ('ontouchstart' in window) {
straightline.addMouseListener(canvas, 'mousedown', moveStraightLine);
}
straightline.get('set').show();
canvas.style.cursor = 'none';
}
}
};
MeasurementTool.StraightLine.prototype.addMouseListener = function (target, name, fn) {
var touchScreen = 'ontouchstart' in window;
var touchEvents = {
'mousedown': 'touchstart',
'mouseup': 'touchend',
'mousemove': 'touchmove'
};
var mouseEvents = {
'mousedown': 'mousedown',
'mouseup': 'mouseup',
'mousemove': 'mousemove'
};
var getWindowsNTVersion = function () {
var matches = navigator.userAgent.match(/Windows NT (\d+\.\d+)/);
var value;
if (matches && matches[1]) {
value = parseFloat(matches[1]);
}
return value || 0;
};
var supportsTouchAndMouse = function () {
return (touchScreen && getWindowsNTVersion() >= 6.1);
};
var normalizeTouchEvent = function (evt) {
if (evt.changedTouches) {
var touches = evt.changedTouches;
for (var i = 0, ii = touches.length; i < ii; i++) {
if (touches[i].target == evt.target) {
var oldevt = evt;
evt = touches[i];
evt.preventDefault = function () {
return oldevt.preventDefault();
};
evt.stopPropagation = function () {
return oldevt.stopPropagation();
};
return evt;
}
}
}
return evt;
};
var touchAndMouse = supportsTouchAndMouse();
var eventName, altEventName;
if (touchScreen) {
eventName = (touchEvents[name] || name);
if (touchAndMouse) {
altEventName = (mouseEvents[name] || name);
}
} else {
eventName = (mouseEvents[name] || name);
}
var processEvent = function (evt) {
if (touchAndMouse) {
evt.preventDefault();
}
if (touchScreen) {
evt = normalizeTouchEvent(evt);
}
fn(evt);
};
if (eventName) {
target.addEventListener(eventName, processEvent, false);
if (altEventName) {
target.addEventListener(altEventName, processEvent, false);
}
}
};
MeasurementTool.StraightLine.prototype.getRotation = function(object, property, transforms) {
var origin = this.get('origin');
if (!transforms.exists('rotation')) {
transforms.set('rotation', {
type: 'rotation',
angle: 30,
x: origin.x,
y: origin.y
});
}
MeasurementTool.StraightLine.parent.getRotation.apply(this, arguments);
};
MeasurementTool.StraightLine.prototype.addPencil = function (object, property, oldSet, newSet) {
var canvas = this.get('canvas').get('canvas');
var width = this.get('width');
var height = this.get('height');
var start, click, line;
newSet.push(
this.get('children').set('pencil',
canvas.set([
canvas.rect(0, 0, 18, 20, 7).attr({
'fill': '#DB4652',
'stroke-miterlimit': '10',
'stroke': '#C1272D'
}),
canvas.rect(0, 17, 18, 32).attr({
'fill': '#FBB03B'
}),
canvas.rect(5.5, 17.5, 9, 32).attr({
'fill': '#F2B96D',
'stroke': '#D68A25',
'stroke-miterlimit': '10'
}),
canvas.rect(0.5, 8.5, 17, 5).attr({
'fill': '#E6E6E6',
'stroke': '#B3B3B3',
'stroke-miterlimit': '10'
}),
canvas.rect(0.5, 12.5, 17, 5).attr({
'fill': '#E6E6E6',
'stroke': '#B3B3B3',
'stroke-miterlimit': '10'
}),
canvas.path('M0,49 l9,13 l9,-13 Z').attr({
'fill': '#C7B299'
}),
canvas.path('M6,58 l6,0 l-3,4 z').attr({
'fill': '#000'
}),
canvas.rect(0, 0, width, height).attr(this.get('dragHandleAttributes'))
]).drag(
function(dx, dy, canvasX, canvasY) {
var origin = this.get('origin');
var translation = this.get('transforms').get('translation');
var path = [
'M',
start.x,
start.y,
'L',
origin.x + translation.x,
origin.y + translation.y
].join(" ");
if (!line) {
this.get('lines').add(line = canvas.path(path));
} else {
line.attr('path', path);
}
},
function(canvasX, canvasY, event) {
var origin = this.get('origin');
var translation = this.get('transforms').get('translation');
start = {
x: origin.x + translation.x,
y: origin.y + translation.y
};
},
function(event) {
if (line) {
line = null;
}
},
this,
this,
this
)
)
);
};
MeasurementTool.StraightLine.prototype.removeLine = function(arcs, index, oldLine, newLine) {
if (oldLine != "") {
oldLine.remove();
}
};

/* SOURCE FILE: Ruler.js (07e3e369) 9/9/2014 2:09:01 PM */

if (typeof(MeasurementTool) == "undefined") {
MeasurementTool = {};
}
MeasurementTool.Ruler = MeasurementTool.Canvas.extend();
MeasurementTool.Ruler.prototype.init = function (config) {
MeasurementTool.Ruler.parent.init.apply(this, arguments);
this.addListener('set', this.addOutline);
this.addListener('set', this.addTickMarks);
this.addListener('set', this.addLabel);
this.addListener('set', this.addDragHandles);
this.addListener('set', this.adjustPosition);
this.get('node');
this.transform();
};
MeasurementTool.Ruler.prototype.defaultConfig = function (object, property, oldConfig, newConfig) {
newConfig.origin = newConfig.origin || { x: 0, y: 0 };
newConfig.stroke = newConfig.stroke || '#000';
newConfig['font-size'] = newConfig['font-size'] || '10pt';
newConfig['line-height'] = parseInt(newConfig['font-size']);
newConfig.type = newConfig.type || 'rect';
newConfig.cursor = newConfig.cursor || 'move';
newConfig.thickness = newConfig.thickness || newConfig.height || 5 * newConfig['line-height'];
newConfig.height = newConfig.height || newConfig.thickness;
if (newConfig.length) {
newConfig.width = newConfig.length;
} else if (newConfig.parent) {
newConfig.width = newConfig.parent.offsetWidth * 0.60;
} else {
newConfig.width = 400;
}
MeasurementTool.Ruler.parent.defaultConfig.apply(this, arguments);
};
MeasurementTool.Ruler.prototype.getRotation = function(object, property, transforms) {
MeasurementTool.Ruler.parent.getRotation.apply(this, arguments);
if (!transforms.exists('left_rotation')) {
transforms.set('left_rotation', {
type: 'rotation',
angle: 0,
x: this.get('width'),
y: 0
});
}
if (!transforms.exists('right_rotation')) {
transforms.set('right_rotation', {
type: 'rotation',
angle: 0,
x: 0,
y: 0
});
}
};
MeasurementTool.Ruler.prototype.addOutline = function(object, property, oldSet, newSet) {
var canvas = this.get('canvas');
this.get('children').set('outline',
canvas.rect(0, 0, this.get('width'), this.get('height')).attr({
stroke: this.get('stroke')
})
);
};
MeasurementTool.Ruler.prototype.adjustPosition = function () {
var rulerLeft = (window.innerWidth - this.get('canvas').width) / 2,
rulerTop = (window.innerHeight - this.get('canvas').height) / 2;
this.moveNode(this.get('node'), 'x', 0, rulerLeft);
this.moveNode(this.get('node'), 'y', 0, rulerTop);
this.set('x', rulerLeft);
this.set('y', rulerTop);
};
MeasurementTool.Ruler.prototype.addTickMarks = function (object, property, oldSet, newSet) {
var canvas = this.get('canvas');
var config = this.get('config');
var system = this.get('system');
var tickmarks = canvas.set();
config.max = Math.ceil(config.max) || 10;
config.min = Math.floor(config.min) || 0;
var widest = (Math.abs(config.max) > Math.abs(config.min)) ? Math.abs(config.max) : Math.abs(config.min);
var span = config.max - config.min;
var temp = canvas.text(10, 10, widest + 'W').attr({ opacity: 0 });
var scale = Math.ceil((temp[0].getComputedTextLength() * (span + 1)) / config.width);
var width = config.width / (span / scale);
var lineHeight = config['line-height'];
var subscale;
temp.remove();
var origin = this.get('origin');
if (origin.y >= config.height) {
lineHeight = -lineHeight;
}
var labelY = origin.y + lineHeight * 5 / 2;
if (system!=null && system.toLowerCase() == 'metric') {
if (scale <= 2) {
subscale = 2;
} else if (scale > 2 && scale <= 5) {
scale = 5;
subscale = 5;
} else {
scale = Math.ceil(scale / 10) * 10;
while (scale < (span - 10) && span % scale) {
scale += 10;
}
subscale = 10;
}
width = config.width / (span / scale);
} else {
subscale = Math.min(4, scale);
}
for (var i = 0, label, x, half; config.min + i * scale <= config.max; i++) {
line = canvas.path("M" + (width * i) + "," + origin.y + "v" + (lineHeight * 2));
tickmarks.push(line);
if (scale == 1) {
if (system!=null && system.toLowerCase() == 'metric') {
for (var j = 1; j < 10; j++) {
x = width * i + j * width / 10;
h = 1.5;
if (j % 5) {
h -= 0.5;
}
if (x < config.width) {
tickmarks.push(canvas.path("M" + x + "," + origin.y + "v" + (lineHeight * h)));
}
}
} else {
for (var j = 1; j < 8; j++) {
x = width * i + j * width / 8;
h = 2;
if (j % 8) {
h -= 0.5;
}
if (j % 4) {
h -= 0.5;
}
if (j % 2) {
h -= 0.5;
}
if (x < config.width) {
tickmarks.push(canvas.path("M" + x + "," + origin.y + "v" + (lineHeight * h)));
}
}
}
} else {
for (var j = 1; j < subscale; j++) {
x = width * i + j * width / subscale;
if (x < config.width) {
tickmarks.push(canvas.path("M" + x + "," + origin.y + "v" + (lineHeight * 3 / 2)));
}
}
}
label = canvas.text(width * i, labelY, config.min + scale * i);
x = parseInt(label.attr('x'));
half = label[0].getComputedTextLength() / 2;
if ((x - half) < 0)
{
label.attr('x', half + config['line-height'] / 4);
} else if ((x + half) > config.width)
{
label.attr('x', config.width - half - config['line-height'] / 4);
}
tickmarks.push(label);
}
this.get('children').set('tickmarksR', tickmarks);
};
MeasurementTool.Ruler.prototype.addDragHandles = function(object, property, oldSet, newSet) {
var canvas = this.get('canvas');
var config = this.get('config');
var children = this.get('children');
var y = this.get('origin').y;
if (y >= config.height - config.thickness) {
y = config.height - config.thickness;
}
children.add(
canvas.rect(
0,
y,
config.width,
config.thickness
).attr(this.get('dragHandleAttributes')).attr({
"cursor": "move"
}).drag(
this.translation.drag,
this.translation.start,
this.translation.stop,
this,
this,
this
)
),
children.add(
canvas.set([
canvas.rect(
0,
y,
config.thickness,
config.thickness
).attr(this.get('dragHandleAttributes'))
]).attr({
"cursor": "rotate"
}).drag(
function(dx, dy, canvasX, canvasY) {
this.rotation.drag.apply(this, arguments);
},
function(canvasX, canvasY, event) {
this.rotation.start.apply(this, arguments);
},
function(canvasX, canvasY, event) {
this.rotation.start.apply(this, arguments);
},
this,
this,
this
)
),
children.add(
canvas.set([
canvas.rect(
(config.width - config.thickness),
y,
config.thickness,
config.thickness
).attr(this.get('dragHandleAttributes'))
]).attr({
"cursor": "rotate"
}).drag(
function(dx, dy, canvasX, canvasY) {
this.rotation.drag.apply(this, arguments);
},
function(canvasX, canvasY, event) {
this.rotation.start.apply(this, arguments);
},
function(canvasX, canvasY, event) {
this.rotation.start.apply(this, arguments);
},
this,
this,
this
)
);
};
MeasurementTool.Ruler.prototype.addLabel = function(object, property, oldSet, newSet) {
var canvas = this.get('canvas');
if (this.exists('label')) {
this.get('children').set('label', canvas.text(
this.get('width') / 2, // x
this.get('height') - this.get('line-height'),
this.get('label')
));
}
};

/* SOURCE FILE: Protractor.js (55c08245) 9/9/2014 2:09:01 PM */

if (typeof(MeasurementTool) == "undefined")
MeasurementTool = {};
MeasurementTool.Protractor = MeasurementTool.Ruler.extend();
MeasurementTool.Protractor.prototype.init = function(config) {
MeasurementTool.Protractor.parent.init.apply(this, arguments);
this.addListener('set', this.adjustPosition);
};
MeasurementTool.Protractor.prototype.defaultConfig = function(object, property, oldConfig, newConfig) {
newConfig.min = newConfig.min || -5;
newConfig.max = newConfig.max || 5;
MeasurementTool.Protractor.parent.defaultConfig.apply(this, arguments);
newConfig.thickness = newConfig.height;
newConfig.height = newConfig.width / 2 + newConfig.thickness;
newConfig.origin = {
x: newConfig.width / 2,
y: newConfig.width / 2
}
newConfig.outline = newConfig.stroke;
delete newConfig.stroke;
};
MeasurementTool.Protractor.prototype.getRotation = function(object, property, transforms) {
var width = this.get('width');
var origin = this.get('origin');
if (!transforms.exists('rotation'))
transforms.set('rotation', {
type: 'rotation',
angle: 0,
x: origin.x,
y: origin.y
});
MeasurementTool.Ruler.parent.getRotation.apply(this, arguments);
};
MeasurementTool.Protractor.prototype.adjustPosition = function () {
var protractorLeft = (window.innerWidth - this.get('canvas').width) / 2,
protractorTop = (window.innerHeight - this.get('canvas').height) / 2;
this.moveNode(this.get('node'), 'x', 0, protractorLeft);
this.moveNode(this.get('node'), 'y', 0, protractorTop);
this.set('x', protractorLeft);
this.set('y', protractorTop);
};
MeasurementTool.Protractor.prototype.addOutline = function(object, property, oldSet, newSet) {
var canvas = this.get('canvas');
var width = +this.get('width');
var height = +this.get('height');
var thickness = +this.get('thickness');
var stroke = this.get('outline');
var outer = {
radius: width / 2,
top: 0,
bottom: height - thickness,
left: 0,
right: width
};
var inner = {
radius: outer.radius - thickness,
bottom: height - thickness,
left: outer.left + thickness,
right: outer.right - thickness
};
var outline = canvas.set([
canvas.rect(0, width / 2, width, thickness).attr({
stroke: stroke
}),
canvas.path([
"M",
0, width / 2, //start coordinates
"A",
outer.radius, outer.radius,
0,
1,
1,
outer.right, outer.bottom,
"Z"
].join(" ")).attr({
stroke: stroke
})
]);
this.set('outline', outline);
newSet.push(this.get('children').set('outline', outline));
};
MeasurementTool.Protractor.prototype.addTickMarks = function(object, property, oldSet, newSet) {
MeasurementTool.Protractor.parent.addTickMarks.apply(this, arguments);
var canvas = this.get('canvas');
var raphael = this.get('raphael');
var config = this.get('config');
var tickmarks = canvas.set();
var center = {
x: config.width / 2,
y: config.width / 2
}
var offset = {};
var path;
for (var a = 1; a < 180; a++) {
offset.angle = raphael.rad(-a);
offset.x = config.width / 2 * Math.cos(offset.angle);
offset.y = config.width / 2 * Math.sin(offset.angle);
path = [];
if (a % 10 == 0) {
path.push(
"M",
center.x + 0.10 * offset.x,
center.y + 0.10 * offset.y,
"L",
center.x + 0.70 * offset.x,
center.y + 0.70 * offset.y,
"M",
center.x + 0.90 * offset.x,
center.y + 0.90 * offset.y,
"L",
center.x + offset.x,
center.y + offset.y
);
tickmarks.push(canvas.text(center.x + 0.75 * offset.x, center.y + 0.75 * offset.y, a).transform('R' + (-a + 90)));
tickmarks.push(canvas.text(center.x + 0.85 * offset.x, center.y + 0.85 * offset.y, 180 - a).transform('R' + (-a + 90)));
} else if (a % 5 == 0) {
path.push(
"M",
center.x + 0.95 * offset.x,
center.y + 0.95 * offset.y,
"L",
center.x + offset.x,
center.y + offset.y
);
} else {
path.push(
"M",
center.x + 0.975 * offset.x,
center.y + 0.975 * offset.y,
"L",
center.x + offset.x,
center.y + offset.y
);
}
tickmarks.push(
canvas.path(path.join(" ")).attr({
stroke: config.outline
})
);
}
newSet.push(this.get('children').set('tickmarks', tickmarks));
};
MeasurementTool.Protractor.prototype.addDragHandles = function(object, property, oldSet, newSet) {
var canvas = this.get('canvas');
var width = +this.get('width');
var height = +this.get('height');
var thickness = +this.get('thickness');
var config = this.get('config');
var children = this.get('children');
var outer = {
left: 0,
right: width,
top: 0,
bottom: height - thickness,
radius: width / 2
};
newSet.push(
children.set('rotate',
canvas.set([
canvas.rect(outer.left, outer.bottom, 2 * outer.radius, thickness),
canvas.path([
"M",
outer.left, outer.bottom,
"A",
outer.radius, outer.radius,
0,
0,
1,
outer.right, outer.bottom,
"Z"
].join(" "))
]).attr(this.get('dragHandleAttributes')).attr({
cursor: 'rotate'
}).drag(
this.rotation.drag,
this.rotation.start,
this.rotation.stop,
this,
this,
this
)
)
);
var inner = {
left: thickness,
right: width - thickness,
top: 0,
bottom: height - thickness,
radius: width / 2 - thickness
};
newSet.push(
children.set('drag',
canvas.set([
canvas.rect(inner.left, inner.bottom, 2 * inner.radius, thickness),
canvas.path([
"M",
inner.left, inner.bottom,
"A",
inner.radius, inner.radius,
0,
0,
1,
inner.right, inner.bottom,
"Z"
].join(" "))
]).attr(this.get('dragHandleAttributes')).attr({
"cursor": "move"
}).drag(
this.translation.drag,
this.translation.start,
this.translation.stop,
this,
this,
this
)
)
);
};

/* SOURCE FILE: Compass.js (2096fe5d) 9/9/2014 2:09:01 PM */

if (typeof(MeasurementTool) == "undefined") {
MeasurementTool = {};
}
MeasurementTool.Compass = MeasurementTool.Set.extend();
MeasurementTool.Compass.prototype.init = function(config) {
MeasurementTool.Compass.parent.init.apply(this, arguments);
this.set('arcs', new PiObject()).addListener(MeasurementTool.Compass.prototype.removeArc);
this.addListener('set', this.addPivotArm);
this.addListener('set', this.addPencilArm);
this.addListener('set', this.addPencil);
this.addListener('set', this.addHandle);
};
MeasurementTool.Compass.prototype.defaultConfig = function(object, property, oldConfig, newConfig) {
newConfig.angle = newConfig.angle || 0;
newConfig.radius = newConfig.radius || 16;
newConfig.width = newConfig.width || 32;
newConfig.height = newConfig.height || 220;
newConfig.center = { x: 8, y: 220 };
newConfig.joint = { x: 24, y: 67 };
MeasurementTool.Compass.parent.defaultConfig.apply(this, arguments);
};
MeasurementTool.Compass.prototype.setVisibility = function(object, property, oldValue, newValue) {
if (newValue == 'hidden') {
this.set({
'angle': 0,
'radius': 16
}).get('children').each(function(children, index, child) {
child.get('transforms').remove('translation', 'rotation');
});
}
MeasurementTool.Compass.parent.setVisibility.apply(this, arguments);
};
MeasurementTool.Compass.prototype.addHandle = function(object, property, oldSet, newSet) {
var canvas = this.get('canvas').get('canvas');
newSet.push(
this.get('children').set('handle',
new MeasurementTool.Set({
set: canvas.set([
canvas.rect(13.5, 20, 5, 10).attr({
"fill": "#808285",
"stroke": "#6D6E71",
"stroke-miterlimit": "10"
}),
canvas.rect(11, 0, 10, 20).attr({
"fill": "#D1D3D4",
"stroke": "#808285",
"stroke-miterlimit": "10"
}),
canvas.rect(0, 25, 32, 50, 6).attr({
"fill": "#808285",
"stroke": "#6D6E71",
"stroke-miterlimit": "10"
}),
canvas.path("M12.5,44 l7,0 l3,6 l-3,6 l-7,0 l-3,-6 z").attr({
"fill": "#F1F2F2",
"stroke": "#BCBEC0",
"stroke-miterlimit": "10"
}),
canvas.circle(16, 50, 2.33).attr({
"fill": "#F1F2F2",
"stroke": "#BCBEC0",
"stroke-miterlimit": "10"
})
]).attr({
"cursor": "move"
}).drag(this.rotation.drag, this.rotation.start, this.rotation.stop, this, this, this)
})
).get('set')
);
};
MeasurementTool.Compass.prototype.addPivotArm = function(object, property, oldSet, newSet) {
var canvas = this.get('canvas').get('canvas');
newSet.push(
this.get('children').set('pivot_arm',
new MeasurementTool.Set({
rotation: 0,
center: { x: 8, y: 220 },
set: canvas.set([
canvas.path("M7,205 l2,0 l-1,15 z").attr({
"fill": "none",
"stroke": "#BCBEC0",
"stroke-miterlimit": "10"
}),
canvas.rect(3, 65, 10, 140).attr({
"fill": "#D1D3D4",
"stroke": "#808285",
"stroke-miterlimit": "10"
}),
canvas.circle(8, 195, 7).attr({
"fill": "#F1F2F2",
"stroke": "#BCBEC0",
"stroke-miterlimit": "10"
}),
canvas.circle(8, 195, 2.5).attr({
"fill": "#F1F2F2",
"stroke": "#BCBEC0",
"stroke-miterlimit": "10"
}),
canvas.rect(-3, 65, 22, 155).attr(this.get('dragHandleAttributes'))
]).attr({
"cursor": "move"
}).drag(
function(dx, dy, canvasX, canvasY) {
this.translation.drag.apply(this, arguments);
},
function(canvasX, canvasY, event) {
this.translation.start.apply(this, arguments);
},
function(canvasX, canvasY, event) {
this.translation.stop.apply(this, arguments);
},
this,
this,
this
)
})
).get('set')
);
};
MeasurementTool.Compass.prototype.addPencilArm = function(object, property, oldSet, newSet) {
var start;
var canvas = this.get('canvas').get('canvas');
newSet.push(
this.get('children').set('pencil_arm',
new MeasurementTool.Set({
rotation: 0,
center: { x: 24, y: 67 },
set: canvas.set([
canvas.rect(19, 65, 10, 100).attr({
"fill": "#D1D3D4",
"stroke": "#808285",
"stroke-miterlimit": "10"
}),
canvas.rect(13, 65, 22, 100).attr(this.get('dragHandleAttributes'))
]).attr({
"cursor": "e-resize"
}).drag(
function(dx, dy, canvasX, canvasY) {
my = {};
my.offset = this.get('offset');
my.children = this.get('children');
my.transforms = this.get('transforms');
my.translation = my.transforms.get('translation');
my.rotation = my.transforms.get('rotation');
my.P1 = my.children.get('pivot_arm').get('transforms').get('rotation');
my.P2 = my.children.get('pencil_arm').get('transforms').get('rotation');
my.triangle = this.set('mouse', { x: canvasX, y: canvasY });
my.triangle.gap = 16 + 5;
if (my.triangle.dx < 0) {
my.triangle.gap = -my.triangle.gap;
}
my.triangle.h1 = start.h1;
my.triangle.h2 = start.h2;
my.LIMIT = my.triangle.h3 + my.triangle.h1 + Math.abs(my.triangle.gap);
if (my.triangle.dx < -my.LIMIT) {
my.triangle.dx = -my.LIMIT;
} else if (my.triangle.dx > my.LIMIT) {
my.triangle.dx = my.LIMIT;
}
var a = 0.25 - Math.pow(my.triangle.h3 / my.triangle.h2, 2);
var b = Math.abs(my.triangle.dx - my.triangle.gap) / 2;
var c = Math.pow(Math.abs(my.triangle.dx - my.triangle.gap), 2) / 4;
my.triangle.x2 = (-b - Math.sqrt(Math.pow(b, 2) - 4 * a * c)) / (2 * a);
if (my.triangle.x2 < 0) {
my.triangle.x2 = (-b + Math.sqrt(Math.pow(b, 2) - 4 * a * c)) / (2 * a);
}
if (my.triangle.dx < 0) {
my.triangle.x2 = -my.triangle.x2;
}
my.triangle.x3 = (my.triangle.dx - my.triangle.gap + my.triangle.x2) / 2;
my.triangle.A = Math.acos(my.triangle.x3 / my.triangle.h3);
my.triangle.y3 = my.triangle.h3 * Math.sin(my.triangle.A);
my.triangle.dy = my.triangle.h3 - my.triangle.y3;
my.pivot_angle = this.set('angle', 90 - Raphael.deg(my.triangle.A));
this.set('radius', 2 * my.triangle.x3 + (my.triangle.dx >= 0 ? 16 : -16));
my.children.get('pivot_arm').get('transforms').set({
'rotation': {
angle: my.pivot_angle,
x: my.P1.x,
y: my.P1.y
}
});
my.children.get('handle').get('transforms').set({
'translation': {
x: (my.triangle.dx < 0) ? my.triangle.x3 - 16 : my.triangle.x3,
y: my.triangle.dy
}
});
my.children.get('pencil_arm').get('transforms').set({
'rotation': {
angle: -my.pivot_angle,
x: my.P2.x,
y: my.P2.y
},
'translation': {
x: (my.triangle.dx < 0) ? my.triangle.x3 - 32 : my.triangle.x3,
y: my.triangle.dy
}
});
my.children.get('pencil').get('transforms').set({
'rotation': {
angle: -my.pivot_angle,
x: my.P2.x,
y: my.P2.y
},
'translation': {
x: (my.triangle.dx < 0) ? my.triangle.x3 - 32 : my.triangle.x3,
y: my.triangle.dy
}
});
if (Math.abs(my.triangle.dx) > Math.abs(my.triangle.gap)) {
if (my.triangle.x2 == 0) {
my.triangle.y2 = my.triangle.h2;
} else {
my.triangle.y2 = my.triangle.x2 * Math.tan(my.triangle.A);
}
my.delta = {
angle: Raphael.rad((start.rotation.angle - (my.triangle.dx < 0 ? 180 : 0)) % 360) - Math.atan(Math.abs(my.triangle.y2) / my.triangle.dx),
h: Math.sqrt(Math.pow(my.triangle.y2, 2) + Math.pow(my.triangle.dx, 2))
};
my.delta.x = my.offset.x + my.translation.x + start.rotation.x + my.delta.h * Math.cos(my.delta.angle);
my.delta.y = my.offset.y + my.translation.y + start.rotation.y + my.delta.h * Math.sin(my.delta.angle);
my.delta.rotation = Raphael.angle(canvasX, canvasY, my.delta.x, my.delta.y, my.offset.x + start.rotation.x + my.translation.x, my.offset.y + start.rotation.y + my.translation.y);
my.rotation.angle = start.rotation.angle + my.delta.rotation;
}
my.transforms.set('rotation', my.rotation);
var angle = my.rotation.angle + my.pivot_angle;
angle = (my.triangle.dx >= 0) ? angle % 360 : (angle - 90) % 360;
angle = (angle >= 0) ? angle : (angle + 360);
if (angle >= 0 && angle <= 90) {
var cursor = "e-resize";
} else if (angle > 90 && angle < 180) {
var cursor = "s-resize";
} else if (angle >= 180 && angle <= 270) {
var cursor = "w-resize";
} else if (angle > 270 && angle < 360) {
var cursor = "n-resize";
}
my.children.get('pencil_arm').get('set').attr({
"cursor": cursor
});
},
function(canvasX, canvasY, event) {
this.addListener('mouse', this.setMouse);
start = this.set('mouse', { x: canvasX, y: canvasY });
},
function(canvasX, canvasY, event) {
this.removeListener('mouse', this.setMouse);
},
this,
this,
null
)
})
).get('set')
);
};
MeasurementTool.Compass.prototype.setMouse = function (object, property, oldMouse, newMouse) {
var offset = this.get('offset');
var transforms = this.get('transforms');
var translation = transforms.get('translation');
var rotation = transforms.get('rotation');
var pivot = Raphael.rad(90 - this.get('children').get('pivot_arm').get('transforms').get('rotation').angle);
newMouse.rotation = rotation;
newMouse.dAngle = Raphael.rad(Raphael.angle(newMouse.x, newMouse.y, offset.x + rotation.x + translation.x, offset.y + rotation.y + translation.y) - (rotation.angle || 360));
if (newMouse.x < offset.x + rotation.x + translation.x) {
newMouse.dAngle = -newMouse.dAngle;
}
newMouse.dh = Math.sqrt(Math.pow(newMouse.x - (offset.x + rotation.x + translation.x), 2) + Math.pow((offset.y + rotation.y + translation.y) - newMouse.y, 2));
newMouse.dx = newMouse.dh * Math.cos(newMouse.dAngle);
newMouse.dy = newMouse.dh * Math.sin(newMouse.dAngle);
newMouse.y2 = newMouse.dy;
newMouse.h2 = Math.abs(newMouse.y2 / Math.sin(pivot)); // length of arm below start position
newMouse.x2 = Math.abs(newMouse.y2 / Math.tan(pivot));
newMouse.h3 = 153;
newMouse.h1 = newMouse.h3 - newMouse.h2;
};
MeasurementTool.Compass.prototype.addPencil = function(object, property, oldSet, newSet) {
var canvas = this.get('canvas').get('canvas');
var arc;
newSet.push(
this.get('children').set('pencil',
new MeasurementTool.Set({
rotation: 0,
center: { x: 24, y: 67 },
set: canvas.set([
canvas.rect(23.5, 205, 1, 15).attr({
"fill": "none",
"stroke": "#231F20",
"stroke-miterlimit": "10"
}),
canvas.rect(23, 165, 2, 12).attr({
"fill": "#D1D3D4",
"stroke": "#808285",
"stroke-miterlimit": "10"
}),
canvas.rect(20.5, 177, 7, 10).attr({
"fill": "#D1D3D4",
"stroke": "#808285",
"stroke-miterlimit": "10"
}),
canvas.rect(22.5, 187, 3.5, 3).attr({
"fill": "#D1D3D4",
"stroke": "#808285",
"stroke-miterlimit": "10"
}),
canvas.path("M22,190 l4,0 l-1,15 l-2,0 l-1,-15").attr({
"fill": "#D1D3D4",
"stroke": "#808285",
"stroke-miterlimit": "10"
}),
canvas.rect(13, 165, 22, 55).attr(this.get('dragHandleAttributes'))
]).drag(
function(dx, dy, canvasX, canvasY) {
this.rotation.drag.apply(this, arguments);
var radius = this.get('radius');
var angle = this.get('transforms').get('rotation').angle - (radius < 0 ? 180 : 0);
var start = arc.get('start');
var end = arc.get('end');
if (angle < start) {
arc.set('start', angle);
} else if (angle > end) {
arc.set('end', angle);
}
},
function(canvasX, canvasY, event) {
this.rotation.start.apply(this, arguments);
var radius = this.get('radius');
var transforms = this.get('transforms');
var translation = transforms.get('translation');
var rotation = transforms.get('rotation');
var angle = rotation.angle - (radius < 0 ? 180 : 0);
this.get('arcs').add(arc = new MeasurementTool.Arc({
canvas: this.get('canvas'),
center: { x: rotation.x + translation.x, y: rotation.y + translation.y },
radius: Math.abs(radius),
start: angle,
end: angle
}));
},
null,
this,
this,
null
)
})
).get('set')
);
};
MeasurementTool.Compass.prototype.removeArc = function(arcs, index, oldArc, newArc) {
if (oldArc != "") {
oldArc.get('node').remove();
oldArc.destroy();
}
};

/* SOURCE FILE: Arc.js (06d3e87f) 9/9/2014 2:09:01 PM */

if (typeof(MeasurementTool) == "undefined") {
MeasurementTool = {};
}
MeasurementTool.Arc = PiObject.extend();
MeasurementTool.Arc.prototype.init = function(config) {
config = config || {};
config.radius = Math.abs(config.radius);
config['stroke-width'] = config['stroke-width'] || 13;
MeasurementTool.Arc.parent.init.apply(this, arguments);
this.addListener('radius', this.positiveRadius, false);
this.addListener('canvas', this.addCanvas);
};
MeasurementTool.Arc.prototype.positiveRadius = function (object, property, oldValue, newValue) {
if (newValue < 0) {
return Math.abs(newValue);
}
};
MeasurementTool.Arc.prototype.addCanvas = function (object, property, oldCanvas, newCanvas) {
this.addListener('center', this.render, false);
this.addListener('start', this.render, false);
this.addListener('end', this.render, false);
this.render();
};
MeasurementTool.Arc.prototype.render = function (object, property, oldValue, newValue) {
if (property == "node") {
return;
}
var large_arc_flag,
sweep_flag = this.get('direction'),
center = this.get('center'),
radius = this.get('radius'),
start = this.get('start'),
end = this.get('end');
if (sweep_flag == "") {
if (start < end) {
sweep_flag = "1";
}
else if (start > end) {
sweep_flag = "0";
}
if (sweep_flag != "") {
this.set('direction', sweep_flag);
} else {
sweep_flag = "0";
}
}
if (Math.abs(end - start) >= 180) {
large_arc_flag = 1;
} else {
large_arc_flag = 0;
}
if (this.exists('node')) {
this.get('node').remove();
}
if (Math.abs(end - start) >= 360) {
var node = this.get('canvas').get('canvas').circle(center.x, center.y, radius);
} else {
start = parseInt(start) * Math.PI / 180.0;
start = [center.x + radius * Math.cos(start), center.y + radius * Math.sin(start)].join(',');
end = parseInt(end) * Math.PI / 180.0;
end = [center.x + radius * Math.cos(end), center.y + radius * Math.sin(end)].join(',');
var path = [
"M",
start,
"A",
[radius, radius].join(','),
"0",
[large_arc_flag, sweep_flag].join(','),
end
].join(' ');
var node = this.get('canvas').get('canvas').path(path);
}
node.attr(this.get('config'));
this.set('node', node);
};

/* SOURCE FILE: module_mt.js (03b58ea9) 9/9/2014 2:08:51 PM */

(function(CM) {
if (typeof Raphael != 'function') {
return;
}
if (typeof MeasurementTool != 'object') {
return;
}
function MT_setVisibility(value) {
var toolContainer = this.get('canvas').canvas && Util.Browser.isIOS() && Util.Browser.getIOSVersion() < 7 ? this.get('canvas').canvas.parentNode : null;
if (value == 'hidden' || this.get('visibility') == 'visible') {
if (toolContainer) {
YUD.addClass(toolContainer, 'hideMeasuring');
}
return this.set('visibility', 'hidden');
} else {
if (toolContainer) {
YUD.removeClass(toolContainer, 'hideMeasuring');
}
return this.set('visibility', 'visible');
}
};
TDS.MT_toggleRuler = function (event, page) {
if (!page.ruler) {
return false;
}
var zoomFactor = page.getZoomFactor();
if (MT_setVisibility.call(page.ruler) == 'visible') {
page.ruler.setScale(0, 0, 0, zoomFactor);
this.className = 'on';
} else {
this.className = 'off';
}
return true;
};
TDS.MT_toggleProtractor = function (event, page) {
if (!page.protractor) {
return false;
}
var zoomFactor = page.getZoomFactor();
if (MT_setVisibility.call(page.protractor) == 'visible') {
page.protractor.setScale(0, 0, 0, zoomFactor);
this.className = 'on';
} else {
this.className = 'off';
}
return true;
};
function MTApplication(arg) {
var page = arg.page,
imgItem = arg.imgItem,
mtIndex = arg.mtIndex,
lineEnabled = arg.lineEnabled,
compassEnabled = arg.compassEnabled,
zoomFactor = arg.zoomFactor;
var mtContainer = imgItem.parentNode.parentNode,
mtElem = imgItem.parentNode;
var dataMTConfigWidth = YUD.getAttribute(imgItem, 'data-mt-config-width') || 500,
dataMTConfigHeight = YUD.getAttribute(imgItem, 'data-mt-config-height') || 300;
this.dataMTConfigWidth = dataMTConfigWidth;
this.dataMTConfigHeight = dataMTConfigHeight;
var imgSrc = YUD.getAttribute(imgItem, 'src');
var toolID = page.id + "_" + mtIndex;
var toolBox = [];
var doc = page.getDoc();
var imgElem = doc.createElement('img'),
imgParents = doc.createElement('div'),
buttonContainer = doc.createElement('div'),
measuringElem = doc.createElement('div');
if (lineEnabled) {
var lineButton = doc.createElement('button');
lineButton.setAttribute('id', 'ToggleStraightLine_' + toolID);
YUD.addClass(lineButton, 'measure_straight off');
YUE.addListener(lineButton, 'click', function (e) {
YUE.stopEvent(e);
if (compassEnabled) {
MT_setVisibility.call(page.mt[mtIndex].compass, 'hidden');
compassButton.className = 'measure_compass off';
}
var lineToolStatus = MT_setVisibility.call(page.mt[mtIndex].line);
if (lineToolStatus == 'visible') {
this.className = 'measure_straight on';
} else {
this.className = 'measure_straight off';
}
});
buttonContainer.appendChild(lineButton);
var line_mt = new MeasurementTool.StraightLine({
visibility: 'hidden'
});
line_mt.set('zoomFactor', zoomFactor);
toolBox.push(line_mt);
this.line = line_mt;
}
if (compassEnabled) {
var compassButton = doc.createElement('button');
compassButton.setAttribute('id', 'ToggleCompass_' + toolID);
YUD.addClass(compassButton, 'measure_compass off');
YUE.addListener(compassButton, 'click', function (e) {
YUE.stopEvent(e);
if (lineEnabled) {
MT_setVisibility.call(page.mt[mtIndex].line, 'hidden');
lineButton.className = 'measure_straight off';
}
var compassToolStatus = MT_setVisibility.call(page.mt[mtIndex].compass);
if (compassToolStatus == 'visible') {
this.className = 'measure_compass on';
} else {
this.className = 'measure_compass off';
}
});
buttonContainer.appendChild(compassButton);
var compass_mt = new MeasurementTool.Compass({
visibility: 'hidden'
});
toolBox.push(compass_mt);
this.compass = compass_mt;
}
if (lineEnabled || compassEnabled) {
var resetButton = doc.createElement('button');
resetButton.setAttribute('id', 'RestCanvas_' + toolID);
YUD.addClass(resetButton, 'measure_reset off');
YUE.addListener(resetButton, 'click', function (e) {
YUE.stopEvent(e);
if (lineEnabled) {
MT_setVisibility.call(page.mt[mtIndex].line, 'hidden');
lineButton.className = 'measure_straight off';
page.mt[mtIndex].line.get('lines').removeAll();
}
if (compassEnabled) {
MT_setVisibility.call(page.mt[mtIndex].compass, 'hidden');
compassButton.className = 'measure_compass off';
page.mt[mtIndex].compass.get('arcs').removeAll();
}
});
buttonContainer.appendChild(resetButton);
}
imgElem.setAttribute('src', imgSrc);
imgElem.setAttribute('alt', 'line segments');
imgParents.setAttribute('id', 'measurement_' + toolID);
YUD.setStyle(imgParents, 'width', dataMTConfigWidth + 'px');
YUD.setStyle(imgParents, 'height', dataMTConfigHeight + 'px');
YUD.addClass(imgParents, 'contextArea illustrationContainer');
YUD.addClass(buttonContainer, 'tools_measure');
YUD.addClass(measuringElem, 'measuring');
imgParents.appendChild(imgElem);
measuringElem.appendChild(imgParents);
measuringElem.appendChild(buttonContainer);
mtContainer.replaceChild(measuringElem, mtElem);
var s_canvas = new MeasurementTool.Canvas({
node: imgParents,
width: dataMTConfigWidth,
height: dataMTConfigHeight,
r: 20,
children: new PiObject(toolBox)
});
var canvasStyle = s_canvas.get('canvas').canvas.style;
canvasStyle.removeProperty('left');
canvasStyle.removeProperty('top');
this.canvas = s_canvas;
var zoomMt = function (zoomfacor) {
var curCanvas = this.canvas,
curSvgElem = curCanvas.get('canvas').canvas;
var zoomCtnWidth = dataMTConfigWidth * zoomfacor,
zoomCtnHeight = dataMTConfigHeight * zoomfacor;
if (this.line) {
this.line.set('zoomFactor', zoomfacor);
}
if (curCanvas) {
curCanvas.get('canvas').setViewBox(0, 0, dataMTConfigWidth, dataMTConfigHeight);
YUD.setStyle(imgParents, 'width', zoomCtnWidth + 'px');
YUD.setStyle(imgParents, 'height', zoomCtnHeight + 'px');
YUD.setAttribute(curSvgElem, 'width', zoomCtnWidth);
YUD.setAttribute(curSvgElem, 'height', zoomCtnHeight);
}
};
this.zoomMt = zoomMt;
}
CM.onPageEvent('available', function(page) {
var pageEl = page.getElement(),
doc = page.getDoc(),
ruler = null,
protractor = null,
zoomFactor = page.getZoomFactor(),
imgElements = Util.Array.slice(pageEl.getElementsByTagName('img')),
mtIndex = 0,
rightBoundary = doc.body.clientWidth,
bottomBoundary = doc.body.clientHeight - doc.getElementById('topBar').clientHeight;
page.mt = [];
YUD.batch(imgElements, function (imgItem) {
var rulerEnabled = YUD.getAttribute(imgItem, 'data-mt-ruler-enabled'),
protractorEnabled = YUD.getAttribute(imgItem, 'data-mt-protractor-enabled'),
lineEnabled = YUD.getAttribute(imgItem, 'data-mt-line-enabled'),
compassEnabled = YUD.getAttribute(imgItem, 'data-mt-compass-enabled'),
pageScaleToolClassName = Util.Browser.isIOS() && Util.Browser.getIOSVersion() < 7 ? 'mtPageScaleTools hideMeasuring' : 'mtPageScaleTools';
if (rulerEnabled && ruler == null) {
var rulerMin = YUD.getAttribute(imgItem, 'data-mt-ruler-min');
var rulerMax = YUD.getAttribute(imgItem, 'data-mt-ruler-max');
var rulerSystem = YUD.getAttribute(imgItem, 'data-mt-ruler-system');
var rulerLabel = YUD.getAttribute(imgItem, 'data-mt-ruler-label');
ruler = new MeasurementTool.Ruler({
id: 'Ruler_' + page.id,
parent: pageEl,
visibility: 'hidden',
classname: pageScaleToolClassName,
min: rulerMin,
max: rulerMax,
system: rulerSystem,
label: rulerLabel
});
ruler.set('rightBoundary', rightBoundary);
ruler.set('bottomBoundary', bottomBoundary);
page.ruler = ruler;
page.MT_toggleRuler = TDS.MT_toggleRuler;
}
if (protractorEnabled && protractor == null) {
var protractorSystem = YUD.getAttribute(imgItem, 'data-mt-protractor-system');
var protractorLabel = YUD.getAttribute(imgItem, 'data-mt-protractor-label');
protractor = new MeasurementTool.Protractor({
id: 'Protractor_' + page.id,
parent: pageEl,
visibility: 'hidden',
classname: pageScaleToolClassName,
system: protractorSystem,
label: protractorLabel
});
protractor.set('rightBoundary', rightBoundary);
protractor.set('bottomBoundary', bottomBoundary);
page.protractor = protractor;
page.MT_toggleProtractor = TDS.MT_toggleProtractor;
}
if (lineEnabled || compassEnabled) {
var mtArg = {
'page': page,
'imgItem': imgItem,
'mtIndex': mtIndex,
'lineEnabled': lineEnabled,
'compassEnabled': compassEnabled,
'zoomFactor': zoomFactor
};
page.mt[mtIndex] = new MTApplication(mtArg);
mtIndex++;
}
}, this, true);
});
CM.onPageEvent('show', function (page) {
if (!page.ruler && !page.protractor) {
return;
}
var accProps = TDS.getAccommodationProperties();
if (accProps && accProps.hasReverseContrast()) {
var color = '#808080';
if (page.ruler) {
var rulerEls = page.ruler.get('children');
rulerEls.get('tickmarksR').forEach(function (element) {
element.attr('stroke', color);
});
rulerEls.get('outline').attr('stroke', color);
rulerEls.get('label').attr('stroke', color);
}
if (page.protractor) {
var protractorEls = page.protractor.get('children');
protractorEls.get('tickmarksR').forEach(function (element) {
element.attr('stroke', color);
});
protractorEls.get('tickmarks').forEach(function (element) {
element.attr('stroke', color);
});
protractorEls.get('outline').forEach(function (element) {
element.attr('stroke', color);
});
protractorEls.get('label').attr('stroke', color);
}
}
});
CM.onPageEvent('zoom', function(page, item) {
if (!page.mt && !page.ruler && !page.protractor) {
return;
}
var zoomFactor = page.getZoomFactor();
if (page.mt) {
for (var i = 0; i < page.mt.length; i++) {
var curMt = page.mt[i];
curMt.zoomMt(zoomFactor);
}
}
if (page.ruler) {
page.ruler.setScale(0, 0, 0, zoomFactor);
}
if (page.protractor) {
page.protractor.setScale(0, 0, 0, zoomFactor);
}
});
CM.onPageEvent('hide', function (page) {
if (page.ruler && page.ruler.get('visibility') == 'visible') {
page.ruler.set('visibility', 'hidden');
}
if (page.protractor && page.protractor.get('visibility') == 'visible') {
page.protractor.set('visibility', 'hidden');
}
});
})(ContentManager);

/* SOURCE FILE: SetSimNameSpace.js (d502f2e2) 9/9/2014 2:09:04 PM */

if (typeof Simulator == 'undefined' || !Simulator) {
var Simulator = {};
}
Simulator.nameSpace = function() {
var nsObj = null, parts;
for (var i = 0; i < arguments.length; i++) {
parts = ('' + arguments[i]).split('.');
nsObj = Simulator;
for (var j = (parts[0] === 'Simulator') ? 1 : 0; j < parts.length; j++) {
nsObj[parts[j]] = nsObj[parts[j]] || {};
nsObj = nsObj[parts[j]];
}
}
console.log('Set up ' + arguments[0] + '.' + arguments[1] + ' namespace');
return nsObj;
};
Simulator.Animation = Simulator.nameSpace('Simulator', 'Animation');
Simulator.Control = Simulator.nameSpace('Simulator', 'Control');
Simulator.Display = Simulator.nameSpace('Simulator', 'Display');
Simulator.Input = Simulator.nameSpace('Simulator', 'Input');
Simulator.Utils = Simulator.nameSpace('Simulator', 'Utils');

/* SOURCE FILE: swfobject.js (25b1dbca) 9/9/2014 2:09:04 PM */

var swfobject = function () {
var UNDEF = "undefined",
OBJECT = "object",
SHOCKWAVE_FLASH = "Shockwave Flash",
SHOCKWAVE_FLASH_AX = "ShockwaveFlash.ShockwaveFlash",
FLASH_MIME_TYPE = "application/x-shockwave-flash",
EXPRESS_INSTALL_ID = "SWFObjectExprInst",
ON_READY_STATE_CHANGE = "onreadystatechange",
win = window,
doc = document,
nav = navigator,
plugin = false,
domLoadFnArr = [main],
regObjArr = [],
objIdArr = [],
listenersArr = [],
storedAltContent,
storedAltContentId,
storedCallbackFn,
storedCallbackObj,
isDomLoaded = false,
isExpressInstallActive = false,
dynamicStylesheet,
dynamicStylesheetMedia,
autoHideShow = true,
ua = function () {
var w3cdom = typeof doc.getElementById != UNDEF && typeof doc.getElementsByTagName != UNDEF && typeof doc.createElement != UNDEF,
u = nav.userAgent.toLowerCase(),
p = nav.platform.toLowerCase(),
windows = p ? /win/.test(p) : /win/.test(u),
mac = p ? /mac/.test(p) : /mac/.test(u),
webkit = /webkit/.test(u) ? parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/, "$1")) : false,
ie = ! +"\v1",
playerVersion = [0, 0, 0],
d = null;
if (typeof nav.plugins != UNDEF && typeof nav.plugins[SHOCKWAVE_FLASH] == OBJECT) {
d = nav.plugins[SHOCKWAVE_FLASH].description;
if (d && !(typeof nav.mimeTypes != UNDEF && nav.mimeTypes[FLASH_MIME_TYPE] && !nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) {
plugin = true;
ie = false;
d = d.replace(/^.*\s+(\S+\s+\S+$)/, "$1");
playerVersion[0] = parseInt(d.replace(/^(.*)\..*$/, "$1"), 10);
playerVersion[1] = parseInt(d.replace(/^.*\.(.*)\s.*$/, "$1"), 10);
playerVersion[2] = /[a-zA-Z]/.test(d) ? parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/, "$1"), 10) : 0;
}
}
else if (typeof win.ActiveXObject != UNDEF) {
try {
var a = new ActiveXObject(SHOCKWAVE_FLASH_AX);
if (a) {
d = a.GetVariable("$version");
if (d) {
ie = true;
d = d.split(" ")[1].split(",");
playerVersion = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];
}
}
}
catch (e) { }
}
return { w3: w3cdom, pv: playerVersion, wk: webkit, ie: ie, win: windows, mac: mac };
} (),
onDomLoad = function () {
if (!ua.w3) { return; }
if ((typeof doc.readyState != UNDEF && doc.readyState == "complete") || (typeof doc.readyState == UNDEF && (doc.getElementsByTagName("body")[0] || doc.body))) {
callDomLoadFunctions();
}
if (!isDomLoaded) {
if (typeof doc.addEventListener != UNDEF) {
doc.addEventListener("DOMContentLoaded", callDomLoadFunctions, false);
}
if (ua.ie && ua.win) {
doc.attachEvent(ON_READY_STATE_CHANGE, function () {
if (doc.readyState == "complete") {
doc.detachEvent(ON_READY_STATE_CHANGE, arguments.callee);
callDomLoadFunctions();
}
});
if (win == top) {
(function () {
if (isDomLoaded) { return; }
try {
doc.documentElement.doScroll("left");
}
catch (e) {
setTimeout(arguments.callee, 0);
return;
}
callDomLoadFunctions();
})();
}
}
if (ua.wk) {
(function () {
if (isDomLoaded) { return; }
if (!/loaded|complete/.test(doc.readyState)) {
setTimeout(arguments.callee, 0);
return;
}
callDomLoadFunctions();
})();
}
addLoadEvent(callDomLoadFunctions);
}
} ();
function callDomLoadFunctions() {
if (isDomLoaded) { return; }
try {
var t = doc.getElementsByTagName("body")[0].appendChild(createElement("span"));
t.parentNode.removeChild(t);
}
catch (e) { return; }
isDomLoaded = true;
var dl = domLoadFnArr.length;
for (var i = 0; i < dl; i++) {
domLoadFnArr[i]();
}
}
function addDomLoadEvent(fn) {
if (isDomLoaded) {
fn();
}
else {
domLoadFnArr[domLoadFnArr.length] = fn;
}
}
function addLoadEvent(fn) {
if (typeof win.addEventListener != UNDEF) {
win.addEventListener("load", fn, false);
}
else if (typeof doc.addEventListener != UNDEF) {
doc.addEventListener("load", fn, false);
}
else if (typeof win.attachEvent != UNDEF) {
addListener(win, "onload", fn);
}
else if (typeof win.onload == "function") {
var fnOld = win.onload;
win.onload = function () {
fnOld();
fn();
};
}
else {
win.onload = fn;
}
}
function main() {
if (plugin) {
testPlayerVersion();
}
else {
matchVersions();
}
}
function testPlayerVersion() {
var b = doc.getElementsByTagName("body")[0];
var o = createElement(OBJECT);
o.setAttribute("type", FLASH_MIME_TYPE);
var t = b.appendChild(o);
if (t) {
var counter = 0;
(function () {
if (typeof t.GetVariable != UNDEF) {
var d = t.GetVariable("$version");
if (d) {
d = d.split(" ")[1].split(",");
ua.pv = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];
}
}
else if (counter < 10) {
counter++;
setTimeout(arguments.callee, 10);
return;
}
b.removeChild(o);
t = null;
matchVersions();
})();
}
else {
matchVersions();
}
}
function matchVersions() {
var rl = regObjArr.length;
if (rl > 0) {
for (var i = 0; i < rl; i++) {
var id = regObjArr[i].id;
var cb = regObjArr[i].callbackFn;
var cbObj = { success: false, id: id };
if (ua.pv[0] > 0) {
var obj = getElementById(id);
if (obj) {
if (hasPlayerVersion(regObjArr[i].swfVersion) && !(ua.wk && ua.wk < 312)) {
setVisibility(id, true);
if (cb) {
cbObj.success = true;
cbObj.ref = getObjectById(id);
cb(cbObj);
}
}
else if (regObjArr[i].expressInstall && canExpressInstall()) {
var att = {};
att.data = regObjArr[i].expressInstall;
att.width = obj.getAttribute("width") || "0";
att.height = obj.getAttribute("height") || "0";
if (obj.getAttribute("class")) { att.styleclass = obj.getAttribute("class"); }
if (obj.getAttribute("align")) { att.align = obj.getAttribute("align"); }
var par = {};
var p = obj.getElementsByTagName("param");
var pl = p.length;
for (var j = 0; j < pl; j++) {
if (p[j].getAttribute("name").toLowerCase() != "movie") {
par[p[j].getAttribute("name")] = p[j].getAttribute("value");
}
}
showExpressInstall(att, par, id, cb);
}
else {
displayAltContent(obj);
if (cb) { cb(cbObj); }
}
}
}
else {
setVisibility(id, true);
if (cb) {
var o = getObjectById(id);
if (o && typeof o.SetVariable != UNDEF) {
cbObj.success = true;
cbObj.ref = o;
}
cb(cbObj);
}
}
}
}
}
function getObjectById(objectIdStr) {
var r = null;
var o = getElementById(objectIdStr);
if (o && o.nodeName == "OBJECT") {
if (typeof o.SetVariable != UNDEF) {
r = o;
}
else {
var n = o.getElementsByTagName(OBJECT)[0];
if (n) {
r = n;
}
}
}
return r;
}
function canExpressInstall() {
return !isExpressInstallActive && hasPlayerVersion("6.0.65") && (ua.win || ua.mac) && !(ua.wk && ua.wk < 312);
}
function showExpressInstall(att, par, replaceElemIdStr, callbackFn) {
isExpressInstallActive = true;
storedCallbackFn = callbackFn || null;
storedCallbackObj = { success: false, id: replaceElemIdStr };
var obj = getElementById(replaceElemIdStr);
if (obj) {
if (obj.nodeName == "OBJECT") {
storedAltContent = abstractAltContent(obj);
storedAltContentId = null;
}
else {
storedAltContent = obj;
storedAltContentId = replaceElemIdStr;
}
att.id = EXPRESS_INSTALL_ID;
if (typeof att.width == UNDEF || (!/%$/.test(att.width) && parseInt(att.width, 10) < 310)) { att.width = "310"; }
if (typeof att.height == UNDEF || (!/%$/.test(att.height) && parseInt(att.height, 10) < 137)) { att.height = "137"; }
doc.title = doc.title.slice(0, 47) + " - Flash Player Installation";
var pt = ua.ie && ua.win ? "ActiveX" : "PlugIn",
fv = "MMredirectURL=" + win.location.toString().replace(/&/g, "%26") + "&MMplayerType=" + pt + "&MMdoctitle=" + doc.title;
if (typeof par.flashvars != UNDEF) {
par.flashvars += "&" + fv;
}
else {
par.flashvars = fv;
}
if (ua.ie && ua.win && obj.readyState != 4) {
var newObj = createElement("div");
replaceElemIdStr += "SWFObjectNew";
newObj.setAttribute("id", replaceElemIdStr);
obj.parentNode.insertBefore(newObj, obj);
obj.style.display = "none";
(function () {
if (obj.readyState == 4) {
obj.parentNode.removeChild(obj);
}
else {
setTimeout(arguments.callee, 10);
}
})();
}
createSWF(att, par, replaceElemIdStr);
}
}
function displayAltContent(obj) {
if (ua.ie && ua.win && obj.readyState != 4) {
var el = createElement("div");
obj.parentNode.insertBefore(el, obj);
el.parentNode.replaceChild(abstractAltContent(obj), el);
obj.style.display = "none";
(function () {
if (obj.readyState == 4) {
obj.parentNode.removeChild(obj);
}
else {
setTimeout(arguments.callee, 10);
}
})();
}
else {
obj.parentNode.replaceChild(abstractAltContent(obj), obj);
}
}
function abstractAltContent(obj) {
var ac = createElement("div");
if (ua.win && ua.ie) {
ac.innerHTML = obj.innerHTML;
}
else {
var nestedObj = obj.getElementsByTagName(OBJECT)[0];
if (nestedObj) {
var c = nestedObj.childNodes;
if (c) {
var cl = c.length;
for (var i = 0; i < cl; i++) {
if (!(c[i].nodeType == 1 && c[i].nodeName == "PARAM") && !(c[i].nodeType == 8)) {
ac.appendChild(c[i].cloneNode(true));
}
}
}
}
}
return ac;
}
function createSWF(attObj, parObj, id) {
var r, el = getElementById(id);
if (ua.wk && ua.wk < 312) { return r; }
if (el) {
if (typeof attObj.id == UNDEF) {
attObj.id = id;
}
if (ua.ie && ua.win) {
var att = "";
for (var i in attObj) {
if (attObj[i] != Object.prototype[i]) {
if (i.toLowerCase() == "data") {
parObj.movie = attObj[i];
}
else if (i.toLowerCase() == "styleclass") {
att += ' class="' + attObj[i] + '"';
}
else if (i.toLowerCase() != "classid") {
att += ' ' + i + '="' + attObj[i] + '"';
}
}
}
var par = "";
for (var j in parObj) {
if (parObj[j] != Object.prototype[j]) {
par += '<param name="' + j + '" value="' + parObj[j] + '" />';
}
}
el.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + att + '>' + par + '</object>';
objIdArr[objIdArr.length] = attObj.id;
r = getElementById(attObj.id);
}
else {
var o = createElement(OBJECT);
o.setAttribute("type", FLASH_MIME_TYPE);
for (var m in attObj) {
if (attObj[m] != Object.prototype[m]) {
if (m.toLowerCase() == "styleclass") {
o.setAttribute("class", attObj[m]);
}
else if (m.toLowerCase() != "classid") {
o.setAttribute(m, attObj[m]);
}
}
}
for (var n in parObj) {
if (parObj[n] != Object.prototype[n] && n.toLowerCase() != "movie") {
createObjParam(o, n, parObj[n]);
}
}
el.parentNode.replaceChild(o, el);
r = o;
}
}
return r;
}
function createObjParam(el, pName, pValue) {
var p = createElement("param");
p.setAttribute("name", pName);
p.setAttribute("value", pValue);
el.appendChild(p);
}
function removeSWF(id) {
var obj = getElementById(id);
if (obj && obj.nodeName == "OBJECT") {
if (ua.ie && ua.win) {
obj.style.display = "none";
(function () {
if (obj.readyState == 4) {
removeObjectInIE(id);
}
else {
setTimeout(arguments.callee, 10);
}
})();
}
else {
obj.parentNode.removeChild(obj);
}
}
}
function removeObjectInIE(id) {
var obj = getElementById(id);
if (obj) {
for (var i in obj) {
if (typeof obj[i] == "function") {
obj[i] = null;
}
}
obj.parentNode.removeChild(obj);
}
}
function getElementById(id) {
var el = null;
try {
el = doc.getElementById(id);
}
catch (e) { }
return el;
}
function createElement(el) {
return doc.createElement(el);
}
function addListener(target, eventType, fn) {
target.attachEvent(eventType, fn);
listenersArr[listenersArr.length] = [target, eventType, fn];
}
function hasPlayerVersion(rv) {
var pv = ua.pv, v = rv.split(".");
v[0] = parseInt(v[0], 10);
v[1] = parseInt(v[1], 10) || 0;
v[2] = parseInt(v[2], 10) || 0;
return (pv[0] > v[0] || (pv[0] == v[0] && pv[1] > v[1]) || (pv[0] == v[0] && pv[1] == v[1] && pv[2] >= v[2])) ? true : false;
}
function createCSS(sel, decl, media, newStyle) {
if (ua.ie && ua.mac) { return; }
var h = doc.getElementsByTagName("head")[0];
if (!h) { return; }
var m = (media && typeof media == "string") ? media : "screen";
if (newStyle) {
dynamicStylesheet = null;
dynamicStylesheetMedia = null;
}
if (!dynamicStylesheet || dynamicStylesheetMedia != m) {
var s = createElement("style");
s.setAttribute("type", "text/css");
s.setAttribute("media", m);
dynamicStylesheet = h.appendChild(s);
if (ua.ie && ua.win && typeof doc.styleSheets != UNDEF && doc.styleSheets.length > 0) {
dynamicStylesheet = doc.styleSheets[doc.styleSheets.length - 1];
}
dynamicStylesheetMedia = m;
}
if (ua.ie && ua.win) {
if (dynamicStylesheet && typeof dynamicStylesheet.addRule == OBJECT) {
dynamicStylesheet.addRule(sel, decl);
}
}
else {
if (dynamicStylesheet && typeof doc.createTextNode != UNDEF) {
dynamicStylesheet.appendChild(doc.createTextNode(sel + " {" + decl + "}"));
}
}
}
function setVisibility(id, isVisible) {
if (!autoHideShow) { return; }
var v = isVisible ? "visible" : "hidden";
if (isDomLoaded && getElementById(id)) {
getElementById(id).style.visibility = v;
}
else {
createCSS("#" + id, "visibility:" + v);
}
}
function urlEncodeIfNecessary(s) {
var regex = /[\\\"<>\.;]/;
var hasBadChars = regex.exec(s) != null;
return hasBadChars && typeof encodeURIComponent != UNDEF ? encodeURIComponent(s) : s;
}
var cleanup = function () {
if (ua.ie && ua.win) {
window.attachEvent("onunload", function () {
var ll = listenersArr.length;
for (var i = 0; i < ll; i++) {
listenersArr[i][0].detachEvent(listenersArr[i][1], listenersArr[i][2]);
}
var il = objIdArr.length;
for (var j = 0; j < il; j++) {
removeSWF(objIdArr[j]);
}
for (var k in ua) {
ua[k] = null;
}
ua = null;
for (var l in swfobject) {
swfobject[l] = null;
}
swfobject = null;
});
}
} ();
return {
registerObject: function (objectIdStr, swfVersionStr, xiSwfUrlStr, callbackFn) {
if (ua.w3 && objectIdStr && swfVersionStr) {
var regObj = {};
regObj.id = objectIdStr;
regObj.swfVersion = swfVersionStr;
regObj.expressInstall = xiSwfUrlStr;
regObj.callbackFn = callbackFn;
regObjArr[regObjArr.length] = regObj;
setVisibility(objectIdStr, false);
}
else if (callbackFn) {
callbackFn({ success: false, id: objectIdStr });
}
},
getObjectById: function (objectIdStr) {
if (ua.w3) {
return getObjectById(objectIdStr);
}
},
embedSWF: function (swfUrlStr, replaceElemIdStr, widthStr, heightStr, swfVersionStr, xiSwfUrlStr,
flashvarsObj, parObj, attObj, simDocument, callbackFn) {
if (simDocument != null) doc = simDocument;
var callbackObj = { success: false, id: replaceElemIdStr };
if (ua.w3 && !(ua.wk && ua.wk < 312) && swfUrlStr && replaceElemIdStr && widthStr && heightStr && swfVersionStr) {
setVisibility(replaceElemIdStr, false);
addDomLoadEvent(function () {
widthStr += "";
heightStr += "";
var att = {};
if (attObj && typeof attObj === OBJECT) {
for (var i in attObj) {
att[i] = attObj[i];
}
}
att.data = swfUrlStr;
att.width = widthStr;
att.height = heightStr;
var par = {};
if (parObj && typeof parObj === OBJECT) {
for (var j in parObj) {
par[j] = parObj[j];
}
}
if (flashvarsObj && typeof flashvarsObj === OBJECT) {
for (var k in flashvarsObj) {
if (typeof par.flashvars != UNDEF) {
par.flashvars += "&" + k + "=" + flashvarsObj[k];
}
else {
par.flashvars = k + "=" + flashvarsObj[k];
}
}
}
if (hasPlayerVersion(swfVersionStr)) {
var obj = createSWF(att, par, replaceElemIdStr);
if (att.id == replaceElemIdStr) {
setVisibility(replaceElemIdStr, true);
}
callbackObj.success = true;
callbackObj.ref = obj;
}
else if (xiSwfUrlStr && canExpressInstall()) {
att.data = xiSwfUrlStr;
showExpressInstall(att, par, replaceElemIdStr, callbackFn);
return;
}
else {
setVisibility(replaceElemIdStr, true);
}
if (callbackFn) { callbackFn(callbackObj); }
});
}
else if (callbackFn) { callbackFn(callbackObj); }
},
switchOffAutoHideShow: function () {
autoHideShow = false;
},
ua: ua,
getFlashPlayerVersion: function () {
return { major: ua.pv[0], minor: ua.pv[1], release: ua.pv[2] };
},
hasFlashPlayerVersion: hasPlayerVersion,
createSWF: function (attObj, parObj, replaceElemIdStr) {
if (ua.w3) {
return createSWF(attObj, parObj, replaceElemIdStr);
}
else {
return undefined;
}
},
showExpressInstall: function (att, par, replaceElemIdStr, callbackFn) {
if (ua.w3 && canExpressInstall()) {
showExpressInstall(att, par, replaceElemIdStr, callbackFn);
}
},
removeSWF: function (objElemIdStr) {
if (ua.w3) {
removeSWF(objElemIdStr);
}
},
createCSS: function (selStr, declStr, mediaStr, newStyleBoolean) {
if (ua.w3) {
createCSS(selStr, declStr, mediaStr, newStyleBoolean);
}
},
addDomLoadEvent: addDomLoadEvent,
addLoadEvent: addLoadEvent,
getQueryParamValue: function (param) {
var q = doc.location.search || doc.location.hash;
if (q) {
if (/\?/.test(q)) { q = q.split("?")[1]; }
if (param == null) {
return urlEncodeIfNecessary(q);
}
var pairs = q.split("&");
for (var i = 0; i < pairs.length; i++) {
if (pairs[i].substring(0, pairs[i].indexOf("=")) == param) {
return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=") + 1)));
}
}
}
return "";
},
expressInstallCallback: function () {
if (isExpressInstallActive) {
var obj = getElementById(EXPRESS_INSTALL_ID);
if (obj && storedAltContent) {
obj.parentNode.replaceChild(storedAltContent, obj);
if (storedAltContentId) {
setVisibility(storedAltContentId, true);
if (ua.ie && ua.win) { storedAltContent.style.display = "block"; }
}
if (storedCallbackFn) { storedCallbackFn(storedCallbackObj); }
}
isExpressInstallActive = false;
}
}
};
} ();

/* SOURCE FILE: Object2.js (6e541d7d) 9/9/2014 2:09:04 PM */

Object.size = function(obj) {
var size = 0;
if(obj.length) size = obj.length;
if(size == 0) {
try {
for (var propName in obj) {
if (obj.hasOwnProperty(propName)) size++;
}
} catch(err) {
logError('Javascript error: ' + err.message + ' occurred. Object size could not be determined.');
return Simulator.Constants.FAILURE;
}
}
return size;
};

/* SOURCE FILE: HTML2JSMap2.js (3c3fa47f) 9/9/2014 2:09:04 PM */

Simulator.HTML2JSMap = function(sim) {
var source = 'HTML2JSMap';
var map = [];
var dbg = function() {return sim.getDebug();};
this.inspect = function(embedded, force) {
var buff = [];
var sep = '\n';
buff.push('Inspecting ' + source + sep);
for ( var i in map) {
buff.push(i + ' = ' + map[i].getName() + ' ' + map[i].getEname() + sep);
}
buff.push('End Inspecting ' + source + sep + sep);
if(!embedded) force == true ? debugf(buff.join('')) : debug(buff.join(''));
else return buff.join('');
};
this.mapJSFromHTML = function(jsObject, htmlElement) {
if(!jsObject || !htmlElement) dbg().logError(source, 'jsOject or htmlElement is null. Cannot map JSFromHTML');
else {
map[htmlElement.id] = jsObject;
}
};
this.getJSFromHTML = function(htmlElement) {
return map[htmlElement.id];
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: Constants2.js (5b242848) 9/9/2014 2:09:04 PM */

Simulator.Constants = function() {};
Simulator.Constants.HIDDEN = false;
Simulator.Constants.VISIBLE = true;
Simulator.Constants.SUCCESS = 1;
Simulator.Constants.NONE = 0;
Simulator.Constants.FAILURE = -1;
Simulator.Constants.YES = 1;
Simulator.Constants.NO = 0;
Simulator.Constants.SIM_CONTAINER_NAME = 'container';
Simulator.Constants.TIME_BASED_ANIMATION = 'timeline';
Simulator.Constants.INTERACTIVE_ANIMATION = 'interactive';
Simulator.Constants.STATIC_ANIMATION = 'static';
Simulator.Constants.INPUT_PANEL_NAME = 'inputPanel';
Simulator.Constants.ANIMATION_PANEL_NAME = 'animationPanel';
Simulator.Constants.DATA_DISPLAY_PANEL_NAME = 'dataOutputPanel';
Simulator.Constants.CONTROL_PANEL_NAME = 'controlElementsPanel';
Simulator.Constants.ITERATION_DELIMITTER = '\\0x1D\\';  // Use to be ';'
Simulator.Constants.KEY_VALUE_DELIMITTER = '\\0x1F\\';   // Use to be ':'
Simulator.Constants.PAIR_DELIMITTER = '\\0x1E\\';  // Use to be ','
Simulator.Constants.MULTIPLE_VALUE_DELIMITTER = '|';
Simulator.Constants.SPEECH_LABEL_PREFIX = 'Move To ';
Simulator.Constants.SPEECH_ITEM_VALUE_PREFIX = 'Select ';
Simulator.Constants.SPEECH_CMD_ITEM_PREFIX = 'Click ';
Simulator.Constants.ANIMATION_FINISHED = 'animationFinished';
Simulator.Constants.ANIMATION_STARTED = 'animationStarted';
Simulator.Constants.ANIMATION_THREAD_FINISHED = 'animationThreadFinished';
Simulator.Constants.ANIMATION_LOADED = 'animationLoaded';
Simulator.Constants.ANIMATION_REPORT_STATUS = 'reportStatus';
Simulator.Constants.ANIMATION_REPORTING = 'animationReporting';
Simulator.Constants.ANIMATION_UNRESPONSIVE = 'animationUnresponsive';
Simulator.Constants.ANIMATION_ABORTED = 'animationAborted';
Simulator.Constants.ANIMATION_UNABLE_TO_START = 'animationUnableToStart';
Simulator.Constants.ANIMATION_NOT_READY = 0;
Simulator.Constants.PARAM_COMMAND = 'command';
Simulator.Constants.PARAM_INFO = 'info';
Simulator.Constants.PARAM_DATA = 'data';
Simulator.Constants.PARAM_INPUT = 'input';
Simulator.Constants.PARAM_UPDATE = 'update';
Simulator.Constants.PARAM_OUTPUT = 'output';
Simulator.Constants.PARAM_DEBUG_OUTPUT = 'debug';
Simulator.Constants.PARAM_ERROR = 'error';
Simulator.Constants.SET_ID_CMD = 'setID';
Simulator.Constants.PLAY_CMD = 'play';
Simulator.Constants.STOP_CMD = 'stop';
Simulator.Constants.REWIND_CMD = 'rewind';
Simulator.Constants.RESTART_CMD = 'restart';
Simulator.Constants.OUTPUT_REQ_CMD = 'outputRequest';
Simulator.Constants.INPUT_NAME_PART = 0;
Simulator.Constants.INPUT_VALUE_PART = 1;
Simulator.Constants.START_FRAME = 'startFrame';
Simulator.Constants.ANIMATION_COMPLETED = 'animationCompleted';
Simulator.Constants.ANIMATION_PLAYING = 'animationPlaying';
Simulator.Constants.ANIMATION_PAUSED = 'animationPaused';
Simulator.Constants.ANIMATION_STOPPED = 'animationStopped';
Simulator.Constants.ANIMATION_REWOUND = 'animationRewound';
Simulator.Constants.ANIMATION_READY = 'animationReady';
Simulator.Constants.ANIMATION_ERROR = 'animationError';
Simulator.Constants.ANIMATION_PROPERTIES = 'properties';
Simulator.Constants.GET_ANIMATION_PROPERTIES = 'properties';
Simulator.Constants.ANIMATION_ALIVE = 'alive';
Simulator.Constants.SIM_CALLBACK = 'Simulator.Animation.FlashAnimationInterface.AnimationMediaOutput';
Simulator.Constants.DEFAULT_INITIAL_TRIAL_NUM = 0;
Simulator.Constants.NO_DATA_INDICATOR = '';
Simulator.Constants.HTML5_ANIMATION = 'html5';
Simulator.Constants.FLASH_ANIMATION = 'flash';
Simulator.Constants.IMAGE_ANIMATION = 'image';
Simulator.Constants.HOTTEXT_ANIMATION = 'hotText';

/* SOURCE FILE: Whiteboard2.js (47c6306a) 9/9/2014 2:09:04 PM */

Simulator.Whiteboard = function (sim) {
var categories = [];
var source = 'Whiteboard';
var dbg = function () {return sim.getDebug();};
var key = Math.random()*1000;
this.addCategory = function(catName) {
if(catName in categories) return false;
else {
categories[catName] = [];
return true;
}
};
this.getCategory = function(name) {
if(name in categories) return categories[name];
else return null;
};
this.getCategoryAsString = function(name, separator) {
var buff = [];
var num = 0;
if(name in categories) {
var cat = categories[name];
for(var item in cat) {
if(cat.hasOwnProperty(item)) {
if(num > 0) buff.push(Simulator.Constants.PAIR_DELIMITTER + ' ');
buff.push(item);
if(separator) buff.push(Simulator.Constants.KEY_VALUE_DELIMITTER + ' ');
else buff.push(Simulator.Constants.KEY_VALUE_DELIMITTER);
buff.push(this.getItem(name, item));
num++;
}
}
return buff.join('');
}
else return null;
};
this.categoryExists = function(categoryName) {
return category in categories;
};
this.itemExists = function(categoryName, itemName) {
if(categoryName in categories) {
var category = categories[categoryName];
return (itemName in category);
}
else return false;
};
this.addItem = function(category, item) {
if(category in categories) {
var cat= categories[category];
if(item in cat) return null;
else {
cat[item] = null;
return key;
}
} else return null;
};
this.setItem = function(category, item, value, itemKey) {
if(category in categories) {
if(key == itemKey) {
var cat = categories[category];
cat[item] = value;
return true;
}
else return false;
}
else return false;
};
this.getItem = function(category, theItem) {
if(category in categories) {
cat = categories[category];
if(cat[theItem]) return cat[theItem];
else return null;
}
else return null;
};
this.clearCategory = function(category) {
if(categories[category]) categories[category] = [];
};
this.clearWhiteboard = function() {
for(var p in categories) {
categories[p] = [];
}
};
this.inspect = function(embedded, force) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting Whiteboard:'); buff.push(sep);
for ( var i in categories) {
var aCat = categories[i];
buff.push('Inspecting '); buff.push(i); buff.push(' category:'); buff.push(sep);
for(var k in aCat) {
buff.push(i); buff.push('['); buff.push(k); buff.push('] = '); buff.push(aCat[k]); buff.push(sep);
}
}
if(!embedded) (force) ? dbg().debugf(buff.join(''), null, true) : dbg().debug(buff.join(''), null, true);
return buff.join('');
};
};

/* SOURCE FILE: Utils2.js (3547fea0) 9/9/2014 2:09:04 PM */

Simulator.Utils.Utils = function (sim) {
var source = 'Utils';
var timeMark = 0;
var IE = 'Microsoft Internet Explorer';
var MSIE = 'MSIE';
var FIREFOX = 'Firefox';
var CHROME = 'Chrome';
var OPERA = 'Opera';
var SAFARI = 'Safari';
var sequenceNumber = 0;
var dbg = function () { return sim.getDebug(); };
this.getChildElement = function (id, numChild) {
var HTMLElement = document.getElementById(id);
var num = 0;
var child = null;
if (HTMLElement) {
var children = HTMLElement.childNodes;
if (chldren.length > 0) {
for (var i = 0; i < children.length; i++) {
child = children[i];
if (child.nodeName[0] != '#') {
if (num == numChild) return child;
else num++;
}
}
return null;
} else return HTMLElement;
} else dbg().logError(source, 'Could not get HTMLElement');
};
this.applyFilter = function (functionName, data) {
var result = null;
var elements = [];
switch (functionName) {
case 'max':
result = Math.max.apply(Math, data);
break;
case 'min':
result = Math.min.apply(Math, data);
break;
case 'first':
result = data[0];
break;
case 'last':
result = data[data.length - 1];
break;
case 'average':
var sum = 0;
for (var i = 0; i < data.length; i++) {
sum += parseFloat(data[i]);
}
result = sum / data.length;
break;
case 'sum':
var sum = 0;
for (var i = 0; i < data.length; i++) {
sum += parseFloat(data[i]);
}
result = sum;
break;
case 'numNonZero':
var num = 0;
for (var i = 0; i < data.length; i++) {
if (data[i] !== 0) num++;
}
result = num;
break;
case 'zeroNotNull':
if (data[0] == 'null') result = '0';
else result = data[0];
break;
case 'blankNotNull':
if (data[0] === 'null') result = Simulator.Constants.NO_DATA_INDICATOR;
else result = data[0];
break;
case 'blankNotZero':
if (parseFloat(data[0]) == 0) result = Simulator.Constants.NO_DATA_INDICATOR;
else result = data[0];
break;
default:
if (functionName.substr(0, 4) == 'set[') {
var resultArray = [];
elements = functionName.replace(/set\s*\[/, '');
elements = elements.replace(/\s*\]$/, '');
var parts = functionName.substr(4).split(',');
for (var i = 0; i < parts.length; i++) {
resultArray.push(data[parseInt(parts[i])]);
}
result = resultArray.join(',');
}
}
return result;
};
this.getFileName = function (path, includeExtension) {
var filename = path.substring(path.lastIndexOf('/') + 1);
var index = filename.lastIndexOf('.');
if (!includeExtension) filename = filename.substring(0, index);
return filename;
};
this.getElementsByClassName = function (classname, node) {
if (!node) node = document.getElementsByTagName('body')[0];
var a = [];
var re = new RegExp('\\b' + classname + '\\b');
var els = node.getElementsByTagName('*');
for (var i = 0, j = els.length; i < j; i++)
if (re.test(els[i].className)) a.push(els[i]);
return a;
};
this.getElementsByTagValue = function (node, tagName, tagValue) {
if (!node) node = document.getElementsByTagName('body')[0];
var a = [];
var els = node.getElementsByTagName(tagName);
for (var i = 0; j < els.length; i++)
if (els[i].nodeValue == tagValue) a.push(els[i]);
return a;
};
this.associationStoreToString = function (associationStore, sep) {
buff = [];
num = 0;
for (var i in associationStore) {
if (associationStore.hasOwnProperty(i)) {
if (num > 0) buff.push(', ');
if (sep) buff.push('\n');
buff.push(i); buff.push(': '); buff.push(associationStore[i]);
num++;
}
}
return buff.join('');
};
this.assocArrayIsEmpty = function (theArray) {
for (var i in theArray) {
if (i) {
if (theArray.hasOwnProperty(i))
return false;
}
}
return true;
};
this.appendText = function (node, txt, noBreak) {
if (!noBreak) {
node.innerHTML = node.innerHTML + '<br>';
}
node.appendChild(document.createTextNode(txt));
if (!noBreak) {
node.innerHTML = node.innerHTML + '<br>';
}
};
this.appendBlankVertcalSpace = function (parentElement, theNum) {
var num = 1;
var newBreak = null;
if (theNum) num = theNum;
for (var i = 0; i < num; i++) {
newBreak = document.createElement('br');
newBreak.style.border = 'none';
parentElement.appendChild(newBreak);
}
};
this.appendElement = function (node, tag, id, htm) {
var ne = document.createElement(tag);
if (id) ne.id = id;
if (htm) ne.innerHTML = htm;
node.appendChild(ne);
};
this.getNextSequenceNumber = function () {
return ++sequenceNumber;
};
this.replaceAll = function (inThisString, replaceThis, withThis) {
var re = new RegExp('[' + replaceThis + ']', 'g');
return inThisString.replace(re, withThis);
};
this.setObjectDimensions = function (governingObject, subjectObject) {
var dimensions = setDimensions(governingObject.height, governingObject.width, subjectObject.height, subjectObject.width);
subjectObject.height = dimensions.height;
subjectObject.width = dimensions.width;
};
this.removeHeadingAndTrailingQuotes = function (theString, theTypeOfQuotes) {
var fIndex, lIndex, strLength;
var typeOfQuotes = 'both';
if (theTypeOfQuotes) typeOfQuotes = theTypeOfQuotes;
if (theString) theString = theString.trim();
if (typeOfQuotes === 'double' || typeOfQuotes === 'both') {
fIndex = theString.indexOf('"');
lIndex = theString.lastIndexOf('"');
strLength = theString.length;
if (fIndex == 0 && lIndex == strLength - 1)
theString = theString.substr(1, lIndex - 1);
}
if (typeOfQuotes === 'single' || typeOfQuotes === 'both') {
fIndex = theString.indexOf("'");
lIndex = theString.lastIndexOf("'");
strLength = theString.length;
if (fIndex == 0 && lIndex == strLength - 1)
theString = theString.substr(1, lIndex - 1);
}
return theString;
};
this.setDimensions = function (governingObjectHeight, governingObjectWidth, subjectObjectHeight, subjectObjectWidth, padding) {
var x = subjectObjectHeight / governingObjectHeight;
var y = subjectObjectWidth / governingObjectWidth;
var z = subjectObjectHeight / subjectObjectWidth;    // Get proportion
if (!padding)
padding = 0;
if (x >= y) {
subjectObjectHeight = governingObjectHeight;
subjectObjectWidth = subjectObjectHeight / z;
} else {
subjectObjectWidth = governingObjectWidth;
subjectObjectHeight = subjectObjectWidth * z;
}
var dimensions = {};
if (z > 1) {
dimensions.width = subjectObjectWidth - padding;
dimensions.height = dimensions.width * z;
} else {
dimensions.height = subjectObjectHeight - padding;
dimensions.width = dimensions.height / z;
}
return dimensions;
};
this.elementInArray = function (array, element, isSubstring) {
for (var i = 0; i < array.length; i++) {
if (!isSubstring) if (array[i] == element) return true;
else if (array[i].indexOf(element) != -1) return true;
}
return false;
};
this.getAttributes = function (node) {
var attr = [];
var attributes = node.attributes;
if (attributes != null && attributes != undefined) {
for (var j = 0; j < attributes.length; j++) {
var id = attributes[j].nodeName;
attr[id] = attributes[j].nodeValue;
}
}
return attr;
};
this.getNumberLength = function (num) {
var str = num + '';
return str.length;
};
this.isInternetExplorer = function () {
return navigator.userAgent.indexOf(MSIE) != -1;
};
this.isIE8orBelow = function () {
var info = this.getBrowserInfo(['name', 'major version'], null);
return (info['name'] === IE && parseInt(info['major version']) < 9);
};
this.isFireFox = function () {
return navigator.userAgent.indexOf(FIREFOX) != -1;
};
this.isChrome = function () {
return navigator.userAgent.indexOf(CHROME) != -1;
};
this.isOpera = function () {
return navigator.userAgent.indexOf(OPERA) !== -1;
};
this.isSafari = function () {
return navigator.userAgent.indexOf(SAFARI) !== -1;
};
this.getBrowserInfo = function (infoArray, sep) {
var nVer = navigator.appVersion;
var nAgt = navigator.userAgent;
var browserName = navigator.appName;
var fullVersion = '' + parseFloat(navigator.appVersion);
var majorVersion = parseInt(navigator.appVersion, 10);
var nameOffset, verOffset, ix;
if ((verOffset = nAgt.indexOf(OPERA)) !== -1) {
browserName = opera;
fullVersion = nAgt.substring(verOffset + 6);
if ((verOffset = nAgt.indexOf('Version')) !== -1)
fullVersion = nAgt.substring(verOffset + 8);
}
else if ((verOffset = nAgt.indexOf(MSIE)) !== -1) {
browserName = IE;
fullVersion = nAgt.substring(verOffset + 5);
}
else if ((verOffset = nAgt.indexOf(CHROME)) !== -1) {
browserName = CHROME;
fullVersion = nAgt.substring(verOffset + 7);
}
else if ((verOffset = nAgt.indexOf(SAFARI)) !== -1) {
browserName = SAFARI;
fullVersion = nAgt.substring(verOffset + 7);
if ((verOffset = nAgt.indexOf('Version')) !== -1)
fullVersion = nAgt.substring(verOffset + 8);
}
else if ((verOffset = nAgt.indexOf(FIREFOX)) !== -1) {
browserName = FIREFOX;
fullVersion = nAgt.substring(verOffset + 8);
}
else if ((nameOffset = nAgt.lastIndexOf(' ') + 1) <
(verOffset = nAgt.lastIndexOf('/'))) {
browserName = nAgt.substring(nameOffset, verOffset);
fullVersion = nAgt.substring(verOffset + 1);
if (browserName.toLowerCase() === browserName.toUpperCase()) {
browserName = navigator.appName;
}
}
if ((ix = fullVersion.indexOf(';')) !== -1)
fullVersion = fullVersion.substring(0, ix);
if ((ix = fullVersion.indexOf(' ')) !== -1)
fullVersion = fullVersion.substring(0, ix);
majorVersion = parseInt('' + fullVersion, 10);
if (isNaN(majorVersion)) {
fullVersion = '' + parseFloat(navigator.appVersion);
majorVersion = parseInt(navigator.appVersion, 10);
}
buff = [];
if (!sep) sep = ' ';
for (var i = 0; i < infoArray.length; i++) {
switch (infoArray[i]) {
case 'name': buff.push('Name  = ' + browserName);
break;
case 'major version': buff.push('Major version = ' + majorVersion);
break;
case 'full version': buff.push('Full version = ' + fullVersion);
break;
case 'appName': buff.push('App Name = ' + navigator.appName);
break;
case 'agent': buff.push('User Agent = ' + navigator.userAgent);
break;
case 'platform': buff.push('Platform = ' + navigator.platform);
break;
}
}
return buff.join(sep);
};
this.markTime = function () {
var d = new Date;
timeMark = d.getTime();
};
this.getElapsedTime = function () {
var d = new Date;
var nowTime = d.getTime();
return nowTime - timeMark;
};
this.getClass = function (obj) {
if (typeof obj === "undefined")
return "undefined";
if (obj === null)
return "null";
else return Object.prototype.toString.call(obj).match(/^\[object\s(.*)\]$/)[1];
};
this.getJSObjName = function (obj) {
if (!obj) return null;
else if (obj.getName) return obj.getName();
else if (obj.name) return obj.name;
else return this.getJSObjNameViaConstructor(obj);
};
this.getJSObjNameViaConstructor = function (obj) {
var str = obj.constructor.name;
if (!str) str = obj.constructor.toString();
var index = str.indexOf('(');
if (index > -1) {
str = str.substring(0, index);
index = str.indexOf('function');
if (index == 0) str = str.substring('function'.length);
}
return str.trim();
};
this.createTimeOutCallbackStr = function (obj, fctn, args) {
var buff = [];
buff.push(obj);
buff.push('.');
buff.push(fctn);
buff.push('(\'');
buff.push(args);
buff.push('\')');
return buff.join('');
};
this.bindEvent = function (el, event, handler) {
if (el.addEventListener)
el.addEventListener(event, handler, false);
else if (el.attachEvent)
el.attachEvent("on" + event, handler);
}
this.canPlayHtml5 = function () {
if (YAHOO.env.ua.ie > 0 &&
YAHOO.env.ua.ie < 9) return false;
if (Util.Browser.getFirefoxVersion() > 0 &&
Util.Browser.getFirefoxVersion() < 4) return false;
return true;
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
};
};

/* SOURCE FILE: Debug2.js (d3da706c) 9/9/2014 2:09:04 PM */

Simulator.Utils.Debug = function (sim) {
var Count = 0;
var debugOn = false;
var prevSetting = false;
var dLevel = 'SimWarning';
var stackLevel = 2;
var eventMgr = function () { return sim.getEventManager(); }
var util = function() { return sim.getUtils(); };
this.tdebug = function (source, str1, appendCount, appendTime, str2) {
if (typeof console != 'object') return;
else if (debugOn) {
var buff = [];
if (source) {
if(util().isFireFox()) {
var line = callerLine((new Error).stack.split("\n")[stackLevel]);
buff.push(source + ' line ' + line + ': ');
}
else buff.push(source + ': ');
}
buff.push(str1);
if (appendCount) buff.push(Count++);
if (appendTime) buff.push(getTime());
if (str2) buff.push(str2);
console.log(buff.join(' '));
}
};
this.debug = function (source, str, obj, trace) {
if (typeof console != 'object') return;
var buff = [];
if (debugOn) {
if (source) {
if(util().isFireFox()) {
var line = callerLine((new Error).stack.split("\n")[stackLevel]);
buff.push(source + ' line ' + line + ': ');
}
else buff.push(source + ': ');
}
buff.push(str);
if (obj) buff.push(' = '); buff.push(obj); buff.push('\n\n');
console.log(buff.join(''));
if (trace == 'trace') {
console.log('--- Program stack trace: ---\n');
printStackTrace();
console.log('\n--- End of program stack trace ---\n\n');
}
}
};
this.debugf = function (source, str, obj, trace) {
if (typeof console != 'object') return;
var buff = [];
if (source) {
if(util().isFireFox()) {
var line = callerLine((new Error).stack.split("\n")[stackLevel]);
buff.push(source + ' line ' + line + ': ');
}
else buff.push(source + ': ');
}
buff.push(str);
if (obj) buff.push(' = '); buff.push(obj); buff.push('\n\n');
console.log(buff.join(''));
if (trace == 'trace') {
console.log('--- Program stack trace: ---\n');
printStackTrace();
console.log('\n--- End of program stack trace ---\n\n');
}
};
var iDest = 'console';
this.setIDest = function (dest) {
iDest = dest;
};
this.iDebug = function (source, str, obj, force) {
if (typeof console != 'object') return;
if (debugOn || force) {
var buff = [];
if (source) {
if(util().isFireFox()) {
var line = callerLine((new Error).stack.split("\n")[stackLevel]);
buff.push(source + ' line ' + line + ': ');
}
}
buff.push(str);
if (obj) buff.push(' = '); buff.push(obj); buff.push('\n\n');
if (iDest == 'screen') Simulator.showAlert('',buff.join(''));
else console.log(buff.join(''));
}
};
this.writeToConsole = function(str) {
console.log(str);
};
this.inspectArray = function (source, name, theArray, doNotIinspectObjects, embedded, force) {
if (typeof console != 'object') return;
var buff = [];
var sep = '\n\n';
if (debugOn || force) {
if (source) {
if(util().isFireFox()) {
var line = callerLine((new Error).stack.split("\n")[stackLevel]);
buff.push(source + ' line ' + line + ': ');
}
else buff.push(source + ': ');
}
buff.push('Inspecting '); buff.push(name); buff.push(sep);
if (theArray.length == 0) {
for (var p in theArray) {
buff.push(name); buff.push('['); buff.push(p); buff.push('] = ');
if(theArray[p].getSourceName) { buff.push(theArray[p].getSourceName()); buff.push(sep);}
else if(theArray[p].getName) { buff.push(theArray[p].getName()); buff.push(sep);}
else {buff.push(String(theArray[p])); buff.push(sep);}
if(!doNotIinspectObjects) if (theArray[p].inspect != undefined) buff.push(theArray[p].inspect(true));
}
} else {
for (var i = 0; i < theArray.length; i++) {
buff.push(name); buff.push('['); buff.push(i); buff.push('] = ');
if(theArray[i].getSourceName) {
buff.push(theArray[i].getSourceName()); buff.push(' ');
}
if(theArray[i].getName) {
buff.push(theArray[i].getName()); buff.push(sep);
}
else {
buff.push(theArray[i]); buff.push(sep);
}
buff.push('Inspecting '); buff.push(typeof theArray[i]); buff.push(sep);
if(!doNotIinspectObjects) if (theArray[i].inspect != undefined) buff.push(theArray[i].inspect(true));
}
}
buff.push('End of inspection of '); buff.push(name); buff.push(sep);
console.log(buff.join(''));
}
};
this.setDebug = function (flag) {
prevSetting = debugOn;
if(flag === 'on' || flag === true) debugOn = true;
else debugOn = false;
};
this.setErrorReportLevel = function (level) {
dLevel = (level == 'SimWarning' || level == 'SimError' || level == 'SimFatalError') ? level : 'SimError';
};
this.debugIsOn = function () {
return debugOn;
};
this.resetDebug = function () {
debugOn = prevSetting;
};
this.logWarning = function (source, str, notify, trace) {
var trace = 'noTrace';
if (trace) trace = 'trace';
logMsg = true;
if (dLevel == 'SimWarning') this.debugf(source, 'Warning: ' + str                                                            );
logMsg = false;
if (notify) Simulator.showAlertWarning(str);
};
this.logError = function (source, str, notify, noTrace) {
var noTrace = 'trace';
if (noTrace) trace = 'noTrace';
logMsg = true;
if (dLevel != 'SimFatalError') this.debugf(source, '**** ERROR: ' + str                                                            );
logMsg = false;
if (notify) Simulator.showAlert('**** ERROR: ' + str);
};
this.logFatalError = function (source, str) {
logMsg = true;
this.debugf(source, '!!!!!! FATAL ERROR: ' + str                                                                                                             );
logMsg = false;
eventMgr().postEvent(new Simulator.Event(this, 'info', 'fatalErrorOccurred', str));
Simulator.showAlert('Fatal Error',str);
};
function AssertException(message) {
this.message = message;
AssertException.prototype.toString = function () {
return 'AssertException: ' + this.message;
};
}
this.assert = function (exp, message) {
if (!exp) {
throw new AssertException(message);
}
};
function printStackTrace() {
if (isFireFox()) console.trace();
else if (isChrome()) {
var obj = {};
Error.captureStackTrace(obj, getStackTrace);
console.log(obj);
}
else if (isInternetExplorer());
else if (isSafari());
else if (isOpera());
else console.log('Unknown browser: ' + getBrowserInfo(['name']));
}
function callerLine(str) {
var index = str.lastIndexOf(':');
return str.substr(index + 1);
};
};

/* SOURCE FILE: Queue2.js (9300fb40) 9/9/2014 2:09:04 PM */

Simulator.Utils.Queue = function (sim) {
var source = 'Queue';
var dbg = function () { return sim.getDebug(); };
var queue = [];
var offset = 0;
this.length = function () {
return (queue.length - offset);
};
this.isEmpty = function () {
return (queue.length == 0);
};
this.insertAt = function (item, index) {
var offsetIndex = index + offset;
if (offsetIndex >= 0 && offsetIndex < queue.length) queue.splice(offsetIndex, 0, item);
else if (offsetIndex == queue.length) queue.push(item);
};
this.add = function (item) {
queue.push(item);
};
this.elementAt = function (index) {
var offsetIndex = index + offset;
if (offsetIndex >= 0 && offsetIndex < queue.length) return queue[offsetIndex];
else return undefined;
};
this.remove = function () {
if (queue.length == 0)
return null;
var item = queue[offset];
if (++offset * 2 >= queue.length) {
queue = queue.slice(offset);
offset = 0;
}
return item;
};
this.peek = function () {
return (queue.length > 0 ? queue[offset] : null);
};
this.clear = function () {
var item = this.remove();
while (item != null) {
item = this.remove();
}
};
this.inspect = function (embedded, force) {
var buff = [];
buff.push('\nInspecting Queue:');
buff.push('Contains ' + queue.length + (queue.length == 1 ? ' item' : ' items'));
buff.push('Queue offset = ' + offset);
for (var i = offset; i < queue.length; i++) {
buff.push('queue[' + i + '] = ' + queue[i]);
}
buff.push('End inspecting Queue\n');
if (embedded) return buff.join('\n');
else {
if (force) debugf(buff.join('\n'));
else debug(buff.join('\n'));
}
};
this.entriesAsString = function () {
var buff = [];
for (var i = 0; i < queue.length; i++) {
buff.push(queue[i]);
}
return buff.join(',');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Utils.OrderedQueue = function (sim) {
Simulator.Utils.Queue.call(this, sim);
var source = 'OrderedQueue';
dbg = function () {return sim.getDebug();};
this.add = function (item) {
var len = this.length();
if (typeof (item) != 'object') {
if (this.isEmpty()) {
this.insertAt(item, 0);
return;
}
else for (var i = 0; i < len; i++) {
if (item < this.elementAt(i)) {
this.insertAt(item, i);
return;
}
}
this.insertAt(item, len);
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Utils.OrderedQueue.prototype = new Simulator.Utils.Queue();
Simulator.Utils.OrderedQueue.parent = Simulator.Utils.Queue;
Simulator.Utils.OrderedQueue.prototype.constructor = Simulator.Utils.OrderedQueue;

/* SOURCE FILE: Stack2.js (525edc9c) 9/9/2014 2:09:04 PM */

Simulator.Utils.Stack = function (sim) {
var source = 'Stack';
this.store = [];
var dbg = function () {return sim.getDebug();};
this.push = function (data) {
this.store.push(data);
};
this.pop = function () {
if (this.store.length > 0) return this.store.pop();
else return null;
};
this.peek = function () {
return this.store[this.store.length - 1];
};
this.inspect = function (embedded, forced) {
var buff = [];
buff.push('\nInspecting Stack:');
buff.push('Stack contains ' + this.store.length + (this.store.length == 1 ? ' element' : ' elements'));
var last = this.store.length - 1;
for (var i = last; i >= 0; i--) {
if (typeof (this.store[i]) == 'object') {
if (this.store[i].inspect != undefined) buff.push(this.store[i].inspect(true, true));
}
else buff.push('stack nonobject element: ' + this.store[i]);
}
buff.push('End inspecting Stack\n');
if (embedded) return buff.join('\n');
else forced == null ? debug(buff.join('\n')) : debugf(buff.join('\n'));
};
this.elementAt = function (num) {
if (num < this.store.length && num >= 0) return this.store[num];
};
this.insertAt = function (obj, index) {
if (index >= 0 && index < this.store.length) this.store.splice(index, 0, obj);
else if (index == this.store.length) this.store.push(obj);
};
this.numElements = function () {
return this.store.length;
};
this.clear = function () {
var item = this.pop();
while (item != null) {
item = this.pop();
}
};
this.entriesAsString = function () {
var buff = [];
for (var i = this.store.length - 1; i > -1; i--) {
buff.push(this.store[i]);
}
return buff.join(',');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: String2.js (5355229f) 9/9/2014 2:09:04 PM */

String.prototype.trim = function () {
return this.replace(/^\s+|\s+$/g,'');
};
String.prototype.ltrim = function() {
return this.replace(/^\s+/,'');
};
String.prototype.rtrim = function() {
return this.replace(/\s+$/,'');
};

/* SOURCE FILE: Dictionary2.js (03c55750) 9/9/2014 2:09:04 PM */

Simulator.Utils.Dictionary = function (sim) {
var source = 'Dictionary';
var elements = [];
var dbg = function () {return sim.getDebug();};
this.getElements = function () {
return elements;
}
this.exists = function (key) {
return (elements[key] == undefined);
};
this.keyExists = function (key) {
return (key in elements);
};
this.setValue = function (key, value) {
this.addKey(key);
elements[key] = value;
};
this.addKey = function (key, value) {
if (!this.keyExists(key)) {
elements[key] = '';
}
};
this.remove = function (key) {
delete elements[key];
};
this.lookup = function (key) {
return elements[key];
};
this.keys = function () {
var keys = [];
for (var key in elements) {
if (key != undefined && key != null) keys.push(key);
}
return keys;
};
this.size = function () {
var i = 0;
for (key in elements) {
i++;
}
return i;
};
this.toString = function () {
var buff = new Simulator.Utils.StringBuffer();
var str;
for (key in elements) {
if (key != undefined && key != null) {
if (elements[key] instanceof Array) {
str = (elements[key]).join('  ');
} else str = elements[key];
buff.append('key = ').append(key).append(', value = ').append(str).append('\n');
}
}
return buff.toString();
};
this.toAssociativeArray = function() {
dbg().inspectArray(source, 'elements', elements);
return elements;
};
this.inspect = function (embedded, forced) {
buff = [];
var sep = '\n\n';
buff.push('Inspecting Dictionary'); buff.push(sep);
buff.push(this.toString()); buff.push(sep);
if (!embedded) (forced) ? debugf(buff.join('')) : debug(buff.join(''));
return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Utils.StringBuffer = function () {
this.buffer = [];
this.append = function (string) {
this.buffer.push(string);
return this;
};
this.toString = function () {
return this.buffer.join('');
};
};

/* SOURCE FILE: Table2.js (48412901) 9/9/2014 2:09:04 PM */

Simulator.Utils.Table = function (incompleteRows, tableName, sim) {
var source = 'Table';
var columns = [];
var typedElements = [];
var columnNames = [];
var contentsForInCompleteRows = false;
var name = tableName;
var maxRowNum = -1;
var dbg = function () { return sim.getDebug(); };
var simMgr = function () { return sim.getSimulationManager(); };
var scoringTable = function () { return sim.getScoringTable(); };
this.getName = function () {
return name;
};
if (incompleteRows) contentsForInCompleteRows = true;
this.setMaxRowNum = function (num) {
if (num) maxRowNum = num;
};
this.addElement = function (name, type) {
if (!(name in columns)) {
columns[name] = [];
columnNames.push(name);
if (type) {
if (!(type in typedElements)) {
var values = new Array();
typedElements[type] = values;
}
typedElements[type].push(name);
}
}
};
this.cloneInputsForOutputs = function () {
var outputs = typedElements['output'];
if (!outputs) {
var values = new Array();
typedElements['output'] = values;
outputs = typedElements['output'];
}
for (var p in columns) {
if (columns.hasOwnProperty(p)) {
if (!outputs.hasOwnProperty(p)) {
typedElements['output'].push(p);
}
}
}
};
this.clearTable = function (clearOutputs) {
for (var p in columns) {
if (columns.hasOwnProperty(p)) {
var col = columns[p];
for (var j = 0; j < col.length; j++) col[j] = '';
}
}
if (clearOutputs) {
var outputs = typedElements['output'];
if (outputs) {
for (var t in outputs) {
if (outputs.hasOwnProperty(t)) {
outputs[t] = '';
}
}
}
}
};
this.clearEntry = function (colName, rowNum) {
if (columns.hasOwnProperty(colName)) {
var col = columns[colName];
col[rowNum] = '';
}
};
this.clearRow = function (rowNum, clearOutputs, deleteRow) {
for (var p in columns) {
if (columns.hasOwnProperty(p)) {
var col = columns[p];
col[rowNum] = '';
}
}
if (clearOutputs) {
var outputs = typedElements['output'];
if (outputs) {
for (var t in outputs) {
if (outputs.hasOwnProperty(t)) {
outputs[rowNum] = '';
}
}
}
}
};
this.deleteEmptyRows = function () {
var numRows = getNumRows();
for (var row = 0; row < numRows; row++) {
if (rowIsEmpty(row)) deleteRow(row);
}
};
this.outputEntered = function () {
var outputs = typedElements['output'];
if (outputs) {
for (var i = 0; i < outputs.length; i++) {
if (!this.isColumnEmpty(outputs[i])) return true;
}
return false;
}
return false;
};
function deleteRow(num) {
size = Object.size(columns);
for (var col = 0; col < size; col++) {
aColName = columnNames[col];
columns[aColName].splice(num, 1);
}
}
this.isColumnEmpty = function (elementName) {
if (columns[elementName]) {
for (var i = 0; i < columns[elementName].length; i++) {
if (columns[elementName][i] != '') return false;
}
return true;
}
else return true;
};
this.deleteElement = function (elementName) {
if (elementName in columns) delete columns[elementName];
for (t in typedElements) {
for (var j = 0; j < typedElements[t].length; j++) {
if (typedElements[t][j] == elementName) typedElements[t].splice(j, 1);
}
}
};
this.setValue = function (colName, rowNum, value) {
var theValue = null;
if (value instanceof Array) {
theValue = value.join(', ');
}
else theValue = value;
if (rowNum == null || rowNum < 0) {
rowNum = simMgr().getTrialNum() - 1;
}
if (rowNum > -1) {
if (!columns[colName]) columns[colName] = [];
columns[colName][rowNum] = theValue;
} else {
dbg().logError(source, 'rowNum = ' + rowNum + ' in ' + name + '.setValue');
}
};
this.getElementsOfType = function (type) {
if (typedElements[type]) return typedElements[type];
else return null;
};
function getNumRows() {
var maxLen = 0;
var len = 0;
for (var p in columns) {
len = columns[p].length;
maxLen = Math.max(len, maxLen);
}
return maxLen;
}
this.getContents = function () {
var buff = [];
var colNames = [];
var maxLen = 0;
var len = 0;
var i = 0;
var aColName = null;
buff.push('<responseTable>');
buff.push('   <tr>');
for (var p in columns) {
buff.push('      <th id = "' + p + '">' + p + '</th>');
len = columns[p].length;
maxLen = Math.max(len, maxLen);
colNames[i++] = p;
}
if ((maxRowNum > 0) && (maxLen > maxRowNum)) {
maxLen = maxRowNum;
}
buff.push('   </tr>');
var size = colNames.length;
var value = null;
for (var row = 0; row < maxLen; row++) {
if (!contentsForInCompleteRows && !rowIsCompletlyFilledIn(row)) break;
else {
buff.push('   <tr>');
for (var col = 0; col < size; col++) {
aColName = colNames[col];
value = columns[aColName][row];
if (value == undefined || value == null) value = '';
if (value && value.indexOf && value.indexOf('<') != -1)
value = '<![CDATA[' + value + ']]>';
buff.push('      <td>' + value + '</td>');
}
buff.push('   </tr>');
}
}
buff.push('</responseTable>');
return buff.join('\n');
};
function rowIsCompletlyFilledIn(rowNum) {
var size = Object.size(columns);
for (var col = 0; col < size; col++) {
aColName = columnNames[col];
if (columns[aColName][rowNum] == '') return false;
}
return true;
}
function rowIsEmpty(rowNum) {
var size = Object.size(columns);
for (var col = 0; col < size; col++) {
aColName = columnNames[col];
if (columns[aColName][rowNum] == undefined) continue;
else if (columns[aColName][rowNum] != '') return false;
}
return true;
}
this.getNumNonEmptyRows = function () {
var maxLen = 0;
var numRows = 0;
for (var p in columns) {
numRows = 0;
len = columns[p].length;
for (var row = 0; row < len; row++) {
if (columns[p][row] != '') numRows++;
}
maxLen = Math.max(numRows, maxLen);
}
return maxLen;
};
this.restoreResponseTable = function (node) {
var child = null;
var attr = null;
var text = null;
var colNum = -1;
var rowNum = -2;
this.clearTable();
var children = node.childNodes;
for (var q = 0; q < children.length; q++) {
if (children[q].nodeName == 'tr') {
rowNum++;
colNum = -1;
child = children[q];
for (var m = 0; m < child.childNodes.length; m++) {
if (child.childNodes[m].nodeName == 'td') {
colNum++;
text = child.childNodes[m].textContent;
scoringTable().setValue(columnNames[colNum], rowNum, text);
} else if (child.childNodes[m].nodeName == 'th') {
attr = child.childNodes[m].attributes;
for (var j = 0; j < attr.length; j++) {
if (attr[j].nodeValue[0] != '#') {
columnNames.push(attr[j].nodeValue);
if (!attr[j].nodeValue in columns) dbg().logFatalError(source, 'response column name: ' + columnNames[j] + ' is not in ' + name + ' column names');
}
}
}
}
}
}
};
this.inspectElementTypes = function (embedded, force) {
var buff = [];
var aType = null;
buff.push('Inspecting typedElements:');
for (var e in typedElements) {
buff.push('  ' + e + ' type elements:');
aType = typedElements[e];
for (var j = 0; j < aType.length; j++) {
buff.push('    ' + aType[j]);
}
}
buff.push('End inspecting typeElements');
if (embedded) return buff.join('\n');
else (force === null) ? debug(buff.join('\n')) : debugf(buff.join('\n'));
};
this.inspect = function (embedded, force) {
var str = this.getContents();
var preface = name + 'Table output:\n';
if (embedded) return str;
else {
if (!force) debug(preface + str);
else debugf(preface + str);
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: PersistentVariableDataBase2.js (d79e17f2) 9/9/2014 2:09:04 PM */

Simulator.Utils.PersistentVariableDataBase = function (sim) {
var source = 'PersistentVariableDB';
var store = [];
var dbg = function () {return sim.getDebug();};
this.updateElement = function (element, value, operation) {
if (element in store) {
if (!isNaN(value)) {
currentValue = store[element];
if (!operation) currentValue += parseFloat(value);
else switch (operation) {
case '+':
currentValue += parseFloat(value);
break;
case '*':
currentValue *= parseFloat(value);
break;
case '/':
currentValue /= parseFloat(value);
break;
case '-':
currentValue -= parseFloat(value);
break;
case 'overwrite':
currentValue = value;
break;
default:
dbg().logWarning(source, 'Invalid operator ' + operator + ' passed to PersistentVariableDataBase.updateElement. No update occurred');
break;
}
store[element] = currentValue;
} else store[element] = value;
}
else {
if (!isNaN(value)) store[element] = parseFloat(value);
else store[element] = value;
}
return this.getElementValue(element);
};
this.setElementTo = function (element, num) {
store[element] = num;
};
this.getElementValue = function (element) {
if (element in store) return store[element];
else return null;
};
this.getContents = function () {
return store;
};
this.inspect = function (embedded, force) {
var buff = [];
buff.push('Inspecting ' + source);
for (var p in store) {
buff.push('   ' + source + '[' + p + '] = ' + store[p]);
}
if (embedded) return buff.join('\n');
else force == true ? debugf(buff.join('\n')) : debug(buff.join('\n'));
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: TranslationDictionary2.js (071938f8) 9/9/2014 2:09:04 PM */

Simulator.Utils.TranslationDictionary = function (sim) {
Simulator.Utils.Dictionary.call(this, sim);
var source = 'TranslationDictionary';
var dbg = function () { return sim.getDebug(); };
var supportedLanguages = ['en'];
var currentLanguage = 'en';
var dictionaryLoaded = false;
this.loadTranslations = function (translationNodes) {
var transUnits = translationNodes[0].getElementsByTagName('language');
for (var i = 0; i < transUnits.length; i++) {
var thisLanguage = transUnits[i].getAttribute('lang');
supportedLanguages[i] = thisLanguage;
debug('Found translation support for language: ' + thisLanguage);
var langElements = transUnits[i].getElementsByTagName('languageElement');
for (var j = 0; j < langElements.length; j++) {
var tag = langElements[j].getAttribute('id');
var valueText = langElements[j].getAttribute('value');
var valueArray;
if (this.keyExists(tag)) {
valueArray = this.lookup(tag);
} else {
valueArray = [];
}
valueArray[i] = valueText;
this.setValue(tag, valueArray);
}
}
dictionaryLoaded = true;
this.validateTranslations();
}
this.getLanguageCount = function () {
return supportedLanguages.length;
}
this.setCurrentLanguage = function (languageString) {
if (getLanguageIndex(languageString) > -1) {
currentLanguage = languageString;
} else
languageNotFoundAction(languageString);
}
this.getCurrentLanguage = function () {
return currentLanguage;
}
this.translate = function (tag) {
if (!dictionaryLoaded || !this.keyExists(tag))
return tag;
var langIndex = getLanguageIndex(this.getCurrentLanguage())
return this.translateToLanguage(tag, langIndex);
}
this.translateToLanguage = function (tag, lang) {
if (!isNaN(lang)) {
return this.lookup(tag)[lang];
} else {
return this.lookup(tag)[getLanguageIndex(lang)];
}
}
this.toString = function () {
var buff = new StringBuffer();
var transBuff = [];
for (key in this.getElements()) {
if (key != undefined && key != null) {
for (var i = 0; i < this.translationsAvailableCount(key) ; i++) {
transBuff[i] = supportedLanguages[i] + ':' + this.translateToLanguage(key, i);
}
buff.append('key = ').append(key).append(', value = ').append(transBuff.join(' ; ')).append('\n');
}
}
return buff.toString();
};
this.inspect = function (embedded, forced) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting Translation Dictionary'); buff.push(sep);
buff.push(this.toString()); buff.push(sep);
if (!embedded) (forced) ? debugf(buff.join('')) : debug(buff.join(''));
return buff.join('');
};
this.translationsAvailableCount = function (key) {
var count = 0;
if (this.keyExists(key)) {
var transSet = this.lookup(key);
for (var transStrings in transSet) {
if (transStrings != undefined) ++count;
}
}
return count;
}
this.validateTranslations = function () {
var valid = true;
for (var key in this.getElements()) {
if (this.translationsAvailableCount(key) != this.getLanguageCount()) {
valid = false;
debugf('Error: Tag is missing translation(s): ' + key);
}
}
if (valid)
debug('Translation Dictionary validated: translations are available for all tags.');
return valid;
}
function getLanguageIndex(languageString) {
for (var i = 0; i < supportedLanguages.length; i++) {
if (languageString.toLowerCase() == supportedLanguages[i].toLowerCase())
return i;
}
return -1;
}
function languageNotFoundAction(lang) {
debugf('Error: requested language not found: ' + lang);
this.setCurrentLanguage('en');
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
}
Simulator.Utils.TranslationDictionary.prototype = new Simulator.Utils.Dictionary();
Simulator.Utils.TranslationDictionary.parent = Simulator.Utils.Dictionary;
Simulator.Utils.TranslationDictionary.prototype.constructor = Simulator.Utils.TranslationDictionary;

/* SOURCE FILE: SimItem2.js (06b0ebae) 9/9/2014 2:09:04 PM */

Simulator.SimItem = function(sim) {
var source = 'SimItem';
var eName = 'SimItem';
var simId = null;
var IDNum = -1;
var dbg = function() {return sim.getDebug();};
var simDocument = function() { return sim.getSimDocument(); };
if(sim) {
simId = sim.getSimID();
}
this.getEname = function() {
return eName;
};
this.setEname = function(newEname) {
eName = newEname;
return this;
};
this.createItemID = function (reset, itemNum, aName) {
var name = (!aName) ? this.getName() : aName;
if (itemNum != null) {
if (itemNum > -1) return name + 'Item' + simId + itemNum;
else {
IDNum++;
return name + 'Element' + simId + IDNum;
}
}
else {
if (reset) IDNum = -1;
++IDNum;
return name + 'Item' + simId + IDNum;
}
};
this.getNodeID = function () {
return nodeID;
};
this.inspect = function(embedded, force) {
var buff = [];
var sep = '\n';
buff.push('Inspecting ' + source + sep);
for ( var i in this) {
if (i == 'items') {
buff.push(this.parent.inspect());
} else {
if (i.substr(0, 3) == 'get') {
buff.push(i.charAt(3).toLowerCase() + i.slice(4));
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
}
buff.push('End Inspecting ' + source + sep + sep);
if(!embedded) force == true ? dbg().debugf(source, buff.join('')) : dbg().debug(source, buff.join(''));
else return buff.join('');
};
this.setAttributes = function (attr) {
for (var i in attr) {
switch (i) {
case 'eName':
this.setEname(attr[i]);
break;
}
}
};
};

/* SOURCE FILE: KeyboardInput2.js (12e323ae) 10/26/2014 1:27:05 PM */

Simulator.Input.KeyboardInput = function (sim) {
var KEY = 0;
var ELEMENT = 1;
var ITEM = 2;
var source = 'KeyboardInput';
var dbg = function () { return sim.getDebug(); };
var eventMgr = function () { return sim.getEventManager(); };
var simMgr = function () { return sim.getSimulationManager(); };
var elementSelected = false;
var focusableElements = [];
var inputIndex = 0;
var itemIndex = -1;
this.addFocusableElement = function (element, elementID, itemID) {
focusableElements.push([]);
focusableElements[focusableElements.length - 1][KEY] = elementID;
focusableElements[focusableElements.length - 1][ELEMENT] = element;
focusableElements[focusableElements.length - 1][ITEM] = [];
};
this.addFocusableElementItem = function (element, elementID, itemID, position) {
var index = elementInDB(elementID);
if (index == -1) {
this.addFocusableElement(element, elementID, itemID);
var items = [];
items.push(itemID);
focusableElements[focusableElements.length - 1][ITEM] = items;
}
else {
var items = focusableElements[index][ITEM];
if (items == null) {
items = [];
items.push(itemID);
}
else if ((items.length == 0) || (!position) || (items.length <= position))
items.push(itemID);
else
items.splice(position, 0, itemID);
}
};
this.inspect = function (force) {
var buff = [];
buff.push("Inspecting focusableElements:");
for (var i = 0; i < focusableElements.length; i++) {
buff.push("[" + i + "] = " + focusableElements[i][KEY] + ", " + focusableElements[i][ELEMENT].getName() + ", " + focusableElements[i][ITEM]);
}
buff.push("End inspecting focusableElements");
force == null ? debug(source, buff.join('\n')) : debugf(source, buff.join('\n'));
};
var advanceToNextElement = function () {
inputIndex++;
if (inputIndex >= focusableElements.length)
inputIndex = -1;
};
var advanceToNextItem = function () {
elementSelected = false;
itemIndex++;
if ((inputIndex == -1) || (focusableElements[inputIndex][ITEM].length <= itemIndex)) {
advanceToNextElement();
itemIndex = 0;
}
};
var advanceToPreviousElement = function () {
inputIndex--;
if (inputIndex < 0)
inputIndex = focusableElements.length - 1;
if (inputIndex >= 0) {
itemIndex = focusableElements[inputIndex][ITEM].length - 1;
if (itemIndex < 0)
itemIndex = 0;
}
};
var advanceToPreviousItem = function () {
if (itemIndex <= 0)
advanceToPreviousElement();
else
itemIndex--;
};
var elementInDB = function (elementID) {
for (var i = 0; i < focusableElements.length; i++) {
if (focusableElements[i][KEY] == elementID) return i;
}
return -1;
};
var getInputObjectFromList = function (inputIndex, itemIndex) {
if ((inputIndex != -1) && (inputIndex < focusableElements.length)) {
var parts = [];
parts[KEY] = focusableElements[inputIndex][KEY];
parts[ELEMENT] = focusableElements[inputIndex][ELEMENT];
var items = [];
items = focusableElements[inputIndex][ITEM];
parts[ITEM] = items[itemIndex];
return parts;
}
};
shortcut = {
'all_shortcuts': {},
'add': function (shortcut_combination, callback, simDoc, opt) {
var default_options = {
'type': 'keydown',
'propagate': true,
'disable_in_input': false,
'target': simDoc,
'keycode': false
};
if (!opt) opt = default_options;
else {
for (var dfo in default_options) {
if (typeof opt[dfo] == 'undefined') opt[dfo] = default_options[dfo];
}
}
var ele = opt.target;
if (typeof opt.target == 'string') ele = document.getElementById(opt.target);
shortcut_combination = shortcut_combination.toLowerCase();
var func = function (e) {
e = e || window.event;
if (opt['disable_in_input']) {
var element = null;
if (e.target) element = e.target;
else if (e.srcElement) element = e.srcElement;
if (element.nodeType == 3) element = element.parentNode;
if (element.tagName == 'INPUT' || element.tagName == 'TEXTAREA') return;
}
if (e.keyCode) code = e.keyCode;
else if (e.which) code = e.which;
var character = String.fromCharCode(code).toLowerCase();
if (code == 188) character = ",";
if (code == 190) character = ".";
var keys = shortcut_combination.split("+");
var kp = 0;
var shift_nums = {
"`": "~",
"1": "!",
"2": "@",
"3": "#",
"4": "$",
"5": "%",
"6": "^",
"7": "&",
"8": "*",
"9": "(",
"0": ")",
"-": "_",
"=": "+",
";": ":",
"'": "\"",
",": "<",
".": ">",
"/": "?",
"\\": "|"
};
var special_keys = {
'esc': 27,
'escape': 27,
'tab': 9,
'space': 32,
'return': 13,
'enter': 13,
'backspace': 8,
'scrolllock': 145,
'scroll_lock': 145,
'scroll': 145,
'capslock': 20,
'caps_lock': 20,
'caps': 20,
'numlock': 144,
'num_lock': 144,
'num': 144,
'pause': 19,
'break': 19,
'insert': 45,
'home': 36,
'delete': 46,
'end': 35,
'pageup': 33,
'page_up': 33,
'pu': 33,
'pagedown': 34,
'page_down': 34,
'pd': 34,
'left': 37,
'up': 38,
'right': 39,
'down': 40,
'f1': 112,
'f2': 113,
'f3': 114,
'f4': 115,
'f5': 116,
'f6': 117,
'f7': 118,
'f8': 119,
'f9': 120,
'f10': 121,
'f11': 122,
'f12': 123
};
var modifiers = {
shift: { wanted: false, pressed: false },
ctrl: { wanted: false, pressed: false },
alt: { wanted: false, pressed: false },
meta: { wanted: false, pressed: false}
};
if (e.ctrlKey) modifiers.ctrl.pressed = true;
if (e.shiftKey) modifiers.shift.pressed = true;
if (e.altKey) modifiers.alt.pressed = true;
if (e.metaKey) modifiers.meta.pressed = true;
for (var i = 0; k = keys[i], i < keys.length; i++) {
if (k == 'ctrl' || k == 'control') {
kp++;
modifiers.ctrl.wanted = true;
} else if (k == 'shift') {
kp++;
modifiers.shift.wanted = true;
} else if (k == 'alt') {
kp++;
modifiers.alt.wanted = true;
} else if (k == 'meta') {
kp++;
modifiers.meta.wanted = true;
} else if (k.length > 1) {
if (special_keys[k] == code) kp++;
} else if (opt['keycode']) {
if (opt['keycode'] == code) kp++;
} else {
if (character == k) kp++;
else {
if (shift_nums[character] && e.shiftKey) {
character = shift_nums[character];
if (character == k) kp++;
}
}
}
}
if (kp == keys.length &&
modifiers.ctrl.pressed == modifiers.ctrl.wanted &&
modifiers.shift.pressed == modifiers.shift.wanted &&
modifiers.alt.pressed == modifiers.alt.wanted &&
modifiers.meta.pressed == modifiers.meta.wanted) {
callback(e);
if (!opt['propagate']) {
e.cancelBubble = true;
e.returnValue = false;
if (e.stopPropagation) {
e.stopPropagation();
e.preventDefault();
}
return false;
}
}
};
this.all_shortcuts[shortcut_combination] = {
'callback': func,
'target': ele,
'event': opt['type']
};
if (ele.addEventListener) ele.addEventListener(opt['type'], func, false);
else if (ele.attachEvent) ele.attachEvent('on' + opt['type'], func);
else ele['on' + opt['type']] = func;
},
'remove': function (shortcut_combination) {
shortcut_combination = shortcut_combination.toLowerCase();
var binding = this.all_shortcuts[shortcut_combination];
delete (this.all_shortcuts[shortcut_combination]);
if (!binding) return;
var type = binding['event'];
var ele = binding['target'];
var callback = binding['callback'];
if (ele.detachEvent) ele.detachEvent('on' + type, callback);
else if (ele.removeEventListener) ele.removeEventListener(type, callback, false);
else ele['on' + type] = false;
}
};
this.initializeKeyboardShortcuts = function () {
shortcut.add('tab', function () { handleKeyBoardInput('tab', '', ''); }, sim.getSimDocument());
shortcut.add('ctrl+tab', function () { handleKeyBoardInput('ctrl', 'tab', ''); }, sim.getSimDocument());
shortcut.add('shift+tab', function () { handleKeyBoardInput('shift', 'tab', ''); }, sim.getSimDocument());
shortcut.add('ctrl+shift+tab', function () { handleKeyBoardInput('ctrl', 'shift', 'tab'); }, sim.getSimDocument());
shortcut.add('enter', function () { handleKeyBoardInput('enter', '', ''); }, sim.getSimDocument());
};
this.removeKeyboardShortcuts = function () {
shortcut.remove('tab');
shortcut.remove('ctrl+tab');
shortcut.remove('shift+tab');
shortcut.remove('ctrl+shift+tab');
shortcut.remove('enter');
};
this.resetKeyboardFocusState = function () {
if (prevInputObjectInfo[ELEMENT]) {
prevInputObjectInfo[ELEMENT].keyboardNavigateAwayFrom(prevInputObjectInfo[KEY], prevInputObjectInfo[ITEM], itemIndex);
}
inputIndex = 0;
itemIndex = -1;
prevInputObjectInfo = [];
}
var prevInputObjectInfo = [];
var handleKeyBoardInput = function (firstKey, secondKey, thirdKey) {
if (simMgr().isPlaying()) return;
var parts = null;
if (prevInputObjectInfo[ELEMENT]) {
prevInputObjectInfo[ELEMENT].keyboardNavigateAwayFrom(prevInputObjectInfo[KEY], prevInputObjectInfo[ITEM], itemIndex);
}
switch (firstKey) {
case 'ctrl':
switch (secondKey) {
case 'tab':
if (elementSelected) advanceToNextElement();
else advanceToNextItem();
parts = getInputObjectFromList(inputIndex, itemIndex);
if (parts) {
parts[ELEMENT].keyboardNavigateTo(parts[KEY], parts[ITEM], itemIndex);
} else {
eventMgr().postEvent(new Simulator.Event(this, 'info', 'lastfocusableSimulatorElementReached', null, false));
inputIndex = -1;
}
break;
case 'shift':
switch (thirdKey) {
case 'tab':
if (elementSelected) advanceToPreviousElement();
else advanceToPreviousItem();
parts = getInputObjectFromList(inputIndex, itemIndex);
if (parts) {
parts[ELEMENT].keyboardNavigateTo(parts[KEY], parts[ITEM], itemIndex);
} else {
eventMgr().postEvent(new Simulator.Event(this, 'info', 'firstfocusableSimulatorElementReached', null, false));
inputIndex = -1;
}
break;
}
break;
}
break;
case 'shift':
switch (secondKey) {
case 'tab':
if (elementSelected) advanceToPreviousElement();
else advanceToPreviousItem();
parts = getInputObjectFromList(inputIndex, itemIndex);
if (parts) {
parts[ELEMENT].keyboardNavigateTo(parts[KEY], parts[ITEM], itemIndex);
} else {
eventMgr().postEvent(new Simulator.Event(this, 'info', 'firstfocusableSimulatorElementReached', null, false));
inputIndex = -1;
}
break;
}
break;
case 'tab':
break;
case 'enter':
parts = getInputObjectFromList(inputIndex, itemIndex);
if (parts) {
parts[ELEMENT].recordKeyboardSelection(parts[KEY], parts[ITEM], itemIndex);
if (parts[ELEMENT].getType() == 'optionList' || parts[ELEMENT].getType() == 'choiceList')
parts[ELEMENT].keyboardNavigateTo(parts[KEY], parts[ITEM], itemIndex);
if (parts[ELEMENT].getType() === 'dropList') {
itemIndex = focusableElements[inputIndex][ITEM].length - 1;
}
}
break;
}
if (parts) {
prevInputObjectInfo[KEY] = parts[KEY];
prevInputObjectInfo[ELEMENT] = parts[ELEMENT];
prevInputObjectInfo[ITEM] = parts[ITEM];
}
else {
prevInputObjectInfo[KEY] = null;
prevInputObjectInfo[ELEMENT] = null;
prevInputObjectInfo[ITEM] = null;
}
};
this.closeDropList = function () {
handleKeyBoardInput('enter');
}
var debug = function (str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
};
var debugf = function (str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
};
};

/* SOURCE FILE: SimElement2.js (55dc685d) 9/9/2014 2:09:04 PM */

Simulator.SimElement = function (sim) {
Simulator.SimItem.call(this, sim);
var source = 'SimElement';
var name = '';
var focusable = false;
var nodeID = null;
var type = null;
var label = '';
var scoreable = true;
var spaceAbove = 0;
var spaceBelow = 0;
var image = null;
var speechLabel = '';
var toEvents = new Simulator.EventDB(sim, 'toEvents');
var fromEvents = new Simulator.EventDB(sim, 'fromEvents');
var theSimulator = null;
var keyboardInput = function () { sim.getKeyboardInput(); };
var html2jsMap = function() { return sim.getHTML2JSMap(); };
if(sim) {
theSimulator = sim;
}
var eventMgr = function () { return theSimulator.getEventManager(); };
var dbg = function() {return theSimulator.getDebug();};
var simDocument = function () { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); }
this.getEname = function() {
return source;
};
this.addEvent = function (theEvent, dir) {
switch (dir) {
case 'to':
toEvents.addEvent(theEvent);
eventMgr().registerEvent(theEvent);
break;
case 'from':
fromEvents.addEvent(theEvent);
break;
default:
dbg().logError(source, 'Unknown event direction ' + dir + ' passed to ' + this.getName());
break;
}
return this;
};
this.setFocusable = function (flag, noRegister) {
if (flag == true) {
focusable = true;
}
else focusable = false;
};
this.isFocusable = function () {
return focusable;
};
this.nextEvent = function (reset) {
return fromEvents.nextEvent(reset);
};
this.getName = function () {
return name;
};
this.setName = function (newName) {
name = newName.trim();
nodeID = this.createItemID(true, -1);
return this;
};
this.getType = function () {
return type;
};
this.setType = function (newType) {
type = newType;
return this;
};
this.getLabel = function () {
return transDictionary().translate(label);
};
this.setLabel = function (newLabel) {
label = newLabel;
return this;
};
this.getScoreable = function () {
return scoreable;
};
this.setSpaceAbove = function (newSpaceAbove) {
spaceAbove = parseInt(newSpaceAbove);
};
this.getSpaceAbove = function () {
return spaceAbove;
};
this.setSpaceBelow = function (newSpaceBelow) {
spaceBelow = parseInt(newSpaceBelow);
};
this.getSpaceBelow = function () {
return spaceBelow;
};
this.getImage = function () {
var translatedImage = transDictionary().translate(image);
debug("Getting an image using SimElement2.js method: " + translatedImage);
return translatedImage;
};
this.setImage = function (newImage) {
debug("SETTING an image using SimElement2.js method: " + newImage);
image = newImage;
return this;
};
this.getData = function () {
return '';
};
this.setSpeechLabel = function (newSpeechLabel) {
speechLabel = newSpeechLabel;
};
this.getSpeechLabel = function () {
return speechLabel;
};
this.formatEventData = function () {
return this.getData();
};
this.postOnChangeEnabled = function () {
var theEvent = this.nextEvent('true');
while (theEvent != null) {
if (theEvent.postOnChange == 'yes') {
return true;
}
theEvent = this.nextEvent();
}
return false;
};
this.postOnChangeEvents = function () {
var theEvent = this.nextEvent('true');
while (theEvent != null) {
if (theEvent.postOnChange == 'yes') {
theEvent.data = this.formatEventData();
eventMgr().postEvent(theEvent);
}
theEvent = this.nextEvent();
}
};
this.postStaticEvents = function () {
var theEvent = this.nextEvent('true');
while (theEvent != null) {
if (theEvent.postOnChange != 'yes') {
theEvent.data = this.formatEventData();
theEvent.postEvent();
}
theEvent = this.nextEvent();
}
};
this.getNodeID = function () {
return nodeID;
};
this.mapHTML2JS = function(htmlElement) {
html2jsMap().mapJSFromHTML(this, htmlElement);
};
this.inspect = function(embedded, force) {
var buff = [];
var sep = '\n';
buff.push('Inspecting ' + source + sep);
var str = Simulator.SimElement.prototype.inspect.call(this, true, force);
if (str) {
buff.push(str);
buff.push(fromEvents.inspect(true, force));
buff.push(toEvents.inspect(true, force));
return buff.join('');
}
else {
for ( var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i.charAt(3).toLowerCase() + i.slice(4));
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
buff.push(fromEvents.inspect(true, force));
buff.push(toEvents.inspect(true, force));
buff.push('End Inspecting ' + source + sep + sep);
if(!embedded) force == true ? debugf(buff.join('')) : debug(buff.join(''));
else return buff.join('');
}
};
this.selectViaKeyboard = function (itemIndex) { Simulator.showAlert('Error','"selectViaKeyboard" must be inplemented by subclass'); };
if(sim) this.setEname('SimElement');
this.setAttributes = function (attr) {
Simulator.SimElement.prototype.setAttributes.call(this, attr);
for (var i in attr) {
switch (i) {
case 'name':
this.setName(attr[i]);
break;
case 'image':
this.setImage(attr[i]);
break;
case 'label':
this.setLabel(attr[i]);
break;
case 'type':
this.setType(attr[i]);
break;
case 'spaceAbove':
this.setSpaceAbove(attr[i]);
break;
case 'spaceBelow':
this.setSpaceBelow(attr[i]);
break;
case 'speechLabel':
this.setSpeechLabel(attr[i]);
break;
}
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.SimElement.prototype = new Simulator.SimItem();
Simulator.SimElement.prototype.constructor = Simulator.SimElement;

/* SOURCE FILE: DataDictionary2.js (12b8a1fc) 9/9/2014 2:09:04 PM */

Simulator.DataDictionary = function (sim) {
Simulator.SimItem.call(this, sim);
var source = 'DataDictionary';
var dataDB = [];
var dbg = function () { return sim.getDebug(); };
this.createEntry = function(key) {
if(!dataDB.keyExists(key)) dataDB.addKey(key, '');
};
this.setEntryValue = function(key, value) {
dataDB.setValue(key, value);
};
this.getEntryValue = function(key) {
return dataDB.lookup(key);
};
this.contents = function() {
var buff = [];
buff.push('<Table>\n');
buff.push('<tr>');
var keys = dataDB.keys();
for(var i = 0; i < keys.length; i++) {
buff.push('<th id = "' + keys[i] + '">' + keys[i] + '</th>');
}
return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
};
};
Simulator.DataDictionary.prototype = new Simulator.SimItem();
Simulator.DataDictionary.parent = Simulator.SimItem;
Simulator.DataDictionary.prototype.constructor = Simulator.DataDictionary;

/* SOURCE FILE: EventManager2.js (88ecb2ad) 9/9/2014 2:09:04 PM */

Simulator.EventManager = function(sim) {
var source = 'EventManager';
var inputQueue = new Simulator.Utils.Queue(sim);
var subscriberDB = null;
var timer = null;
var dbg = function() {return sim.getDebug();};
var utils = function() {return sim.getUtils();};
var getSubscriberDB = function() {
if(!subscriberDB) subscriberDB = new Simulator.EventDB(sim, 'subscriberDB');
return subscriberDB;
};
this.registerEvent = function(event) {
getSubscriberDB().addEvent(event);
};
this.deRegisterEvent = function(event) {
getSubscriberDB().remove(event);
};
this.postEvent = function(event) {
inputQueue.add(event);
};
this.startEventProcessing = function() {
var closure = bind(processEvents);
timer = setInterval (closure, 500 );
};
this.getSourceName = function(obj) {
return utils().getJSObjName(obj);
};
this.stopEventProcessing = function() {
clearTimeout(timer);
};
function processEvents() {
while(!inputQueue.isEmpty()) {
var matches = [];
var event = inputQueue.remove();
matches = getSubscriberDB().getAllMatchingEvents(event);
for ( var i = 0; i < matches.length; i++) {
if((matches[i]).src.handleEvent != undefined) {
(matches[i]).src.handleEvent(event);
}
else if(typeof (matches[i]).src != 'object') {
(matches[i]).src.prototype.handleEvent(event);
}
}
}
}
function bind(method) {
var _this = this;
return(function() {
return(method.apply(_this.arguments));
});
}
function getEventSrcName(event) {
if (event.src.getSourceName === undefined) return 'object';
else return event.src.getSourceName();
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: EventDB2.js (5c4bdc27) 9/9/2014 2:09:04 PM */

Simulator.EventDB = function(sim, theName) {
var source = 'EventDB';
var DB = [];
var currentIndex = 0;
var name = theName;
var dbg = function() {return sim.getDebug();};
this.getName = function() {
return name;
};
this.addEvent = function(event) {
DB.push(event);
};
this.removeEvent = function(event) {
var index = this.isInDB(event, true);
if(index > -1) DB.splice(index, 1);
};
this.isInDB = function(event, fullMatch) {
for(var i = 0; i < DB.length; i++) {
var theEvent = DB[i];
if(theEvent.type == event.type && theEvent.context == event.context) {
if (fullMatch) {
if(theEvent.src == event.src) return i;
} else return i;
}
}
return -1;
};
this.getAllMatchingEvents = function(event) {
var matches = [];
var k = 0;
for ( var i = 0; i < DB.length; i++) {
var theEvent = DB[i];
if(theEvent.type == event.type && (theEvent.context == event.context || theEvent.context == '*'|| event.context == '*')) {
if(event.data) theEvent.data = event.data;
theEvent.completeWithoutOutput = event.completeWithoutOutput;
theEvent.originatorName = event.originatorName;
matches[k++] = theEvent;
}
}
return matches;
};
this.nextEvent = function(reset) {
if(reset) currentIndex = 0;
if(currentIndex < DB.length) return DB[currentIndex++];
else return null;
};
this.inspect = function(embedded, forced) {
var buff = [];
var sep = '\n';
buff.push('Inspecting EventDB ' + name + sep);
buff.push('There are ' + DB.length + ' events in ' + name + sep);
for(var i = 0; i < DB.length; i++) {
(forced) ? buff.push(debugf(DB[i].inspect(embedded, true))) : buff.push(debug(DB[i].inspect(embedded, true)));
buff.push(sep);
};
buff.push('End of EventDB ' + name + ' Inspection' + sep + sep);
if(!embedded) (forced) ? debugf(buff.join('')) : debug(buff.join(''));
else return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: Event2.js (3f33490d) 9/9/2014 2:09:04 PM */

Simulator.Event = function(src, type, context, data, postOnChange, completeWithoutOutput) {
this.type = type;
this.src = src;
this.context = context;
this.data = data;
this.postOnChange = postOnChange;
this.completeWithoutOutput = (completeWithoutOutput === true) ? true : false;
this.inspect = function() {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting event'); buff.push(sep);
if(this.src.getName) {
buff.push('event src = '); buff.push(this.src.getName()); buff.push(';'); buff.push(sep);
}
buff.push('event type = '); buff.push(this.type); buff.push(';'); buff.push(sep);
buff.push('event context = '); buff.push(this.context);  buff.push(';'); buff.push(sep);
buff.push('event data = '); buff.push(this.data);  buff.push(';'); buff.push(sep);;
buff.push('event postOnChange = '); buff.push(this.postOnChange);  buff.push(';'); buff.push(sep);;
buff.push('event completeWithoutOutput = '); buff.push(this.completeWithoutOutput);  buff.push(';'); buff.push(sep);;
return buff.join('');
};
function addHTMLEvent( obj, type, fn ) {
if( obj.attachEvent ) {
obj['e'+type+fn] = fn;
obj[type+fn] = function(){obj['e'+type+fn]( window.event );};
obj.attachEvent( 'on'+type, obj[type+fn] );
} else
obj.addEventListener( type, fn, false );
}
function removeHTMLEvent( obj, type, fn ) {
if( obj.detachEvent ) {
obj.detachEvent( 'on'+type, obj[type+fn] );
obj[type+fn] = null;
} else
obj.removeEventListener( type, fn, false );
}
};

/* SOURCE FILE: Layout2.js (81a352d8) 9/9/2014 2:09:04 PM */

Simulator.Display.Layout = function (sim, container) {
var source = 'Layout';
var panelList = [];
var dbg = function () { return sim.getDebug(); };
var eventMgr = function () { return sim.getEventManager(); };
var simDocument = function () { return sim.getSimDocument(); };
var utils = function () { return sim.getUtils(); };
var simDocument = function () { return sim.getSimDocument(); };
this.specifyLayout = function (layout) {
var format = null;
var attr = layout[0].attributes;
var div = simDocument().createElement('div');
div.setAttribute('id', Simulator.Constants.SIM_CONTAINER_NAME + sim.getSimID());
if (utils().isInternetExplorer()) {
format = attr.getNamedItem('format').value;
}
else format = attr['format'].nodeValue;
if (format) {
div.setAttribute('class', format);
container.appendChild(div);
}
else dbg().logError(source, 'Could not get layout format attribute.');
};
this.createPanels = function (node) {
var aPanel;
var panelSpec;
var panelNum = 0;
for (var i = 0; i < node.length; i++) {
if (node[i].nodeName[0] != '#') {
aPanel = new Simulator.Display.Panel(sim, panelNum++);
for (var j = 0; j < node[i].childNodes.length; j++) {
if (node[i].childNodes[j].nodeName[0] != '#') {
panelSpec = node[i].childNodes[j];
aPanel.setAttributes(aPanel, utils().getAttributes(panelSpec));
}
}
var attr = node[i].attributes;
if (utils().isInternetExplorer()) aPanel.setAttributes(utils().getAttributes(node[i]));
else if (Object.size(attr) > 0) aPanel.setAttributes(utils().getAttributes(node[i]));
aPanel.setName(node[i].nodeName);
var id = aPanel.getNodeID();
if (!panelList[id]) panelList[id] = aPanel;
aPanel.render();
}
}
};
this.getPanelInstance = function (panelType) {
for (var panel in panelList)
if (panel.indexOf(panelType) > -1) return panelList[panel];
return null;
};
this.resizeAllPanels = function (zoom) {
debug(source, 'In Layout Panel Resize All Panels for simID=' + sim.getSimID());
var aPanel = null;
for (var name in panelList) {
aPanel = panelList[name];
if (aPanel.resize) {
aPanel.resize(zoom);
} else dbg().logError(source, 'unknown panel name: ' + name);
}
};
this.recordPanelSizes = function (zoom) {
debug(source, 'In Record Panel Sizes for simID=' + sim.getSimID());
var aPanel = null;
for (var name in panelList) {
aPanel = panelList[name];
if (aPanel.recordOriginalWidthAndHeight) {
aPanel.recordOriginalWidthAndHeight();
} else dbg().logError(source, 'unknown panel name: ' + name);
}
};
this.makeAllPanelsVisible = function () {
var aPanel = null;
for (var name in panelList) {
aPanel = panelList[name];
aPanel.setDisplay('visible');
var HTMLPanel = simDocument().getElementById(name);
if (HTMLPanel) {
HTMLPanel.style.visibility = 'visible';
debug(name + '.style.visibility = ' + HTMLPanel.style.visibility);
}
else dbg().logError(source, 'Could not get HTML ' + name + ' panel element. Could not make panel visible');
}
};
this.getContainerWidth = function () {
var width = 0;
var container = simDocument().getElementById(Simulator.Constants.SIM_CONTAINER_NAME + sim.getSimID());
if (container) {
width = container.offsetWidth;
if (width === 0) {
dbg().logError(source, 'Simulator container offsetWidth is 0');
}
return container.offsetWidth;
} else {
dbg().logError(source, 'Simulator\'s container with id = "' + id + '" is null');
return FAILURE;
}
};
this.getContainerHeight = function () {
var height = 0;
var container = simDocument().getElementById(Simulator.Constants.SIM_CONTAINER_NAME + sim.getSimID());
if (container) {
height = container.offsetHeight;
if (height === 0) {
dbg().logError(source, 'Simuator container offsetHeight is 0');
}
return container.offsetHeight;
} else {
dbg().logError(source, 'Simulator\'s container with id = "' + id + '" is null.');
return FAILURE;
}
};
this.handleEvent = function (event) {
switch (event.type) {
case 'info':
switch (event.context) {
case 'simulatorStateChange':
switch (event.data) {
case 'ReadOnly': this.disableAllInput();
break;
case 'Playing': this.disableAllInput();
break;
case 'Ready': this.enableAllInput();
break;
}
break;
}
}
};
this.enableAllInput = function () {
for (var panel in panelList) {
if (panel) {
var panelObj = panelList[panel];
if (panelObj.enableAllInput)
panelObj.enableAllInput();
}
}
};
this.disableAllInput = function () {
for (var panel in panelList) {
if (panel) {
var panelObj = panelList[panel];
if (panelObj.disableAllInput)
panelObj.disableAllInput();
}
}
};
this.saveInputs = function (forcedSave) {
for (var panel in panelList) {
if (panel) {
var panelObj = panelList[panel];
if (panelObj.saveInputs)
panelObj.saveInputs(forcedSave);
}
}
};
this.hasEmptyChoiceListSelection = function () {
for (var panel in panelList) {
if (panel) {
var panelObj = panelList[panel];
if (panelObj.hasEmptyChoiceListSelection) {
if (panelObj.hasEmptyChoiceListSelection()) {
return true;
}
}
}
}
return false;
};
this.getSourceName = function () {
return source;
};
if (sim) eventMgr().registerEvent(new Simulator.Event(this, 'info', 'simulatorStateChange'));
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: Simulator2.js (57a31119) 10/26/2014 1:27:05 PM */

Simulator.showAlertWarning = function (msg) {
if (window.TDS && TDS.Dialog) {
TDS.Dialog.showWarning(msg, function () {});
} else {
alert(msg);
}
};
Simulator.showAlert = function (headline,msg) {
if (window.TDS && TDS.Dialog) {
TDS.Dialog.showAlert(msg, function () {});
} else {
alert(msg);
}
};
Simulator.Simulator = function (container, assistiveMode, speechMode) {
var source = 'Simulator';
var simID = null;
var speechEnabled = speechMode;
var language = 'english';
var mode = 'operation';
var xmlns = '';
var simMgr = null;
var layout = null;
var animationSetObj = null;
var animationShellPath = null;
var animationExternalScriptsPath = null;
var animationPresent = true;
var accessibilityIFActive = assistiveMode;
var dataTable = null;
var instance = this;
var simDocument = null;
var visible = true;
var eventMgr = new Simulator.EventManager(this);
var whiteboard = new Simulator.Whiteboard(this);
var scoringTable = new Simulator.Utils.Table(true, 'ScoringTable', this);
var persistentVariableDB = new Simulator.Utils.PersistentVariableDataBase(this);
var utils = new Simulator.Utils.Utils(this);
var dbg = new Simulator.Utils.Debug(this);
var keyboardInput = new Simulator.Input.KeyboardInput(this);
var html2jsMap = new Simulator.HTML2JSMap(this);
var translationDictionary = (typeof Simulator.Utils.TranslationDictionary == 'function')
? new Simulator.Utils.TranslationDictionary(this)
: { translate: function (tag) { return tag; } };
var sliderPreRenderQueue = new Simulator.Utils.Queue();
var sliderIndex = 1;
var speechGrammarBldr = null;
var speechMgr = null;
this.getSpeechGrammarBldr = function () {
return speechGrammarBldr;
};
this.getVisibility = function () {
return visible;
};
this.setVisibilityAndAttachEvents = function (newValue) {
visible = newValue;
if (newValue) {
this.resize(this, false);
this.bindResize(simDocument.body, this);
}
};
this.getSourceName = function () {
return source;
};
this.getDataTable = function () {
return dataTable;
};
this.setAnimationShellPath = function (path) {
if (!animationShellPath)
animationShellPath = path;
};
this.getAnimationShellPath = function () {
return animationShellPath;
};
this.setAnimationExternalScriptsPath = function (path) {
if (!animationExternalScriptsPath)
animationExternalScriptsPath = path;
};
this.getAnimationExternalScriptsPath = function () {
return animationExternalScriptsPath;
};
this.getAnimationSet = function () {
return animationSetObj;
};
this.getSimulationManager = function () {
return simMgr;
};
this.getSimDocument = function () {
return simDocument;
};
this.getLayout = function () {
return layout;
};
this.getSimID = function () {
return simID;
};
this.getHTML2JSMap = function () {
return html2jsMap;
};
this.getParser = function () {
return parser;
};
this.getWhiteboard = function () {
return whiteboard;
};
this.getScoringTable = function () {
return scoringTable;
};
this.getPersistentVariableDB = function () {
return persistentVariableDB;
};
this.getEventManager = function () {
return eventMgr;
};
this.getDebug = function () {
return dbg;
};
this.getUtils = function () {
return utils;
};
this.getKeyboardInput = function () {
return keyboardInput;
};
this.getTranslationDictionary = function () {
return translationDictionary;
};
debug('Instantiating SimulationManager');
simMgr = new Simulator.SimulationManager(this);
debug('Required services instantiated');
this.getSliderPreRenderQueue = function () {
return sliderPreRenderQueue;
};
this.getSliderIndex = function () {
return sliderIndex++;
};
this.getSpeechEnabled = function () {
return speechEnabled;
};
this.getLanguage = function () {
return language;
};
this.getMode = function () {
return mode;
};
this.getXmlns = function () {
return xmlns;
};
this.animationIsPresent = function () {
return animationPresent;
};
this.startSimulation = function (xmlFile) {
var xmlDoc = loadXMLDoc(xmlFile);
this.startSimulationXmlDom(xmlDoc);
sendStartEvent();
};
this.loadTranslationXmlText = function (xmlText) {
var transElem = loadXMLDocFromString(xmlText);
this.loadTranslationXmlDom(transElem);
};
this.startSimulationXmlText = function (xmlText) {
var xmlDoc = loadXMLDocFromString(xmlText);
this.startSimulationXmlDom(xmlDoc);
sendStartEvent();
};
var onSliderContainerDone = function () {
var sliderElement = instance.getSliderPreRenderQueue().remove();
while (sliderElement) {
sliderElement.postContainerRender();
sliderElement = instance.getSliderPreRenderQueue().remove();
}
};
this.loadTranslationXmlDom = function (transDom) {
debug('Translation dictionary is loading');
x = transDom.getElementsByTagName('translation');
if (x.length > 0) {
debug('Found translation section');
translationDictionary.loadTranslations(x);
}
}
this.startSimulationXmlDom = function (xmlDoc) {
eventMgr.startEventProcessing();
debug('Simulator is loading');
if (container) {
var className = container.getAttribute('class');
if (className)
className += ' simV2';
else
className = 'simV2';
container.setAttribute('class', className);
}
var x = xmlDoc.childNodes[1];
if (!x) x = xmlDoc.childNodes[0];
if (!x) x = xmlDoc.getElementsByTagName('simulationItem');
if (x) {
recordItemAttributes(this, x);
simDocument = container.ownerDocument;
} else {
dbg.logFatalError(source, 'Missing "simulationItem" element in xml input file.');
return;
}
if (speechEnabled) {
if (speechGrammarBldr === null) speechGrammarBldr = new Simulator.Speech.SpeechGrammarBuilder(this);
speechGrammarBldr.setItemName(this.getItemName());
speechGrammarBldr.createHeader();
}
x = xmlDoc.getElementsByTagName('definition');
if (x.length > 0) {
debug('found definition spec');
var layOut = xmlDoc.getElementsByTagName('layout');
if (layOut.length > 0) {
debug('Found layout spec');
layout = new Simulator.Display.Layout(this, container);
layout.specifyLayout(layOut);
layout.createPanels(layOut[0].childNodes);
} else {
dbg.logFatalError(source, 'Missing "layout" element in xml input file.');
return;
}
} else {
dbg.logFatalError(source, 'Missing "definition" element in xml input file.');
}
var x = xmlDoc.getElementsByTagName('initialization');
if (x.length > 0) {
debug('Found initialization section');
recordInitializationSpecs(x);
}
simMgr.initManagerVariables();
var x = xmlDoc.getElementsByTagName('state');
if (x.length > 0) {
debug('Found state element');
}
x = xmlDoc.getElementsByTagName('input');
if (x.length > 0) {
debug('Found input section');
whiteboard.addCategory('dataInput');
whiteboard.addCategory('evaluationInput');
whiteboard.addCategory('animationInput');
whiteboard.addCategory('evaluationOutput');
whiteboard.addCategory('animationOutput');
var sections = xmlDoc.getElementsByTagName('section');
if (sections) {
for (var i = 0; i < sections.length; i++) {
createInputSection(this, sections[i], i);
}
} else {
dbg.logFatalError(source, 'Missing "section" elements in xml input file.');
return;
}
} else {
dbg.logFatalError(source, 'Missing "input" element in xml input file.');
}
x = xmlDoc.getElementsByTagName('animation');
if (x.length > 0) {
animationPresent = true;
for (var k = 0; k < x.length; k++) {
debug('Found animation section');
createAnimationMembers(this, x[k]);
}
} else animationPresent = false;
x = xmlDoc.getElementsByTagName('display');
if (x.length > 0) {
for (var k = 0; k < x.length; k++) {
debug('Found display section');
createDisplayMembers(this, x[k]);
}
}
x = xmlDoc.getElementsByTagName('evaluation');
var parser = new SimParser.EvaluationUnit(this);
if (x.length > 0) {
debug('Found evaluation section');
try {
parser.load(xmlDoc);
} catch (err) {
dbg.logFatalError(source, 'Error loading evaluation element: ' + err);
return;
}
}
x = xmlDoc.getElementsByTagName('control');
if (x.length > 0) {
debug('Found control section');
}
onSliderContainerDone();
if (speechEnabled) {
speechGrammarBldr.finishItemSpeechGrammar();
if (speechMgr === null) speechMgr = new Simulator.Speech.SpeechManager(this);
}
simMgr.setStateFromName('Loaded');
if (!animationPresent) eventMgr.postEvent(new Simulator.Event(this, 'info', 'allMediaLoaded'));
};
this.bindResize = function (dom, scope) {
if (dom) {
var f = function () { scope.resize(scope, false); };
dom.onresize = f;
} else {
dbg.logError(source, 'Failed to bind a resize event.');
}
};
this.resize = function (scope, zoom) {
scope = scope || this;
if (scope.getVisibility())
layout.resizeAllPanels(zoom);
};
this.getDoc = function () { return simDocument; };
this.getWin = function () { return window; };
this.loadXml = function (itemXml, responseXml, translationXml) {
if (translationXml != null && translationXml.length > 0) {
this.loadTranslationXmlText(translationXml);
}
this.startSimulationXmlText(itemXml);
if (responseXml != null && responseXml.length > 0) {
this.loadResponseXml(responseXml);
}
};
this.getResponseXml = function () {
var stateMgr = new Simulator.ResponseStateManager(this);
simMgr.setResponseStateVariables(stateMgr);
return stateMgr.saveState();
};
this.loadResponseXml = function (xmlText) {
var responseMgr = new Simulator.ResponseStateManager(this);
simMgr.clearSimulationState();
var xmlDoc = loadXMLDocFromString(xmlText);
responseMgr.restoreSimulation(xmlDoc);
simMgr.displaySimulatorState();
};
this.isValid = function () {
return scoringTable.outputEntered();
};
this.isPlaying = function () {
return simMgr.isPlaying();
};
this.setReadOnlyState = function (readOnlyState) {
simMgr.setReadOnlyState(readOnlyState);
};
this.getAccessibilityIFActive = function () {
return accessibilityIFActive;
};
this.zoom = function (factor) {
this.zoomFactor = factor;
this.resize(this, true);
};
this.show = function () {
};
this.hide = function () {
keyboardInput.resetKeyboardFocusState();
};
this.focus = function () {
if (!this.getAccessibilityIFActive())
keyboardInput.initializeKeyboardShortcuts();
};
this.blur = function () {
keyboardInput.removeKeyboardShortcuts();
};
this.subscribe = function (type, context, callback) {
var stateCallback =
{
handleEvent: callback
};
var event = new Simulator.Event(stateCallback, type, context);
eventMgr.registerEvent(event);
return event;
};
this.unsubscribe = function (event) {
eventMgr.deRegisterEvent(event);
};
this.inspect = function (embedded, forced) {
var buff = [];
buff.push('Inspecting ' + source);
buff.push('simID = ' + simID);
buff.push('End inspecting ' + source);
if (embedded) return buff.join('\n');
else forced ? debugf(buff.join('\n')) : debug(buff.join('\n'));
};
this.isLoaded = function () {
return simMgr.isLoaded();
};
dbg.setDebug(true);
dbg.setErrorReportLevel('SimWarning');
simID = simIDgenerate();
debug('accessibilityIFActive = ' + accessibilityIFActive);
function startSimulator() {
simMgr.setStateFromName('Loaded');
}
function recordItemAttributes(sim, node) {
var attrArray = utils.getAttributes(node);
for (var attr in attrArray) {
switch (attr) {
case 'speechEnabled': speechEnabled = attrArray[attr] === 'yes' ? true : false;
break;
case 'language': language = attrArray[attr];
break;
case 'mode': mode = attrArray[attr];
break;
case 'itemName': itemName = attrArray[attr];
break;
case 'xmlns': xmlns = attrArray[attr];
break;
default: dbg.logWarning(source, 'Unrecognized Simulator attribute ' + attr + ' with value ' + attrArray[attr]);
break;
}
}
debug('Completed recording item attributes');
}
function loadXMLDoc(fileName) {
var xhttp = null;
if (window.XMLHttpRequest) {
xhttp = new XMLHttpRequest();
} else {
xhttp = new ActiveXObject('Microsoft.XMLHTTP');
}
xhttp.open('GET', fileName, false);
xhttp.send();
return xhttp.responseXML;
}
function loadXMLDocFromString(xmlStr) {
var xmlDoc = null;
if (window.DOMParser) {
var domParser = new DOMParser();
xmlDoc = domParser.parseFromString(xmlStr, 'application/xml');
} else
{
xmlDoc = new ActiveXObject('Microsoft.XMLDOM');
xmlDoc.async = 'false';
xmlDoc.loadXML(xmlStr);
}
return xmlDoc;
}
function recordInitializationSpecs(initNode) {
var varName = null;
var value = null;
var isIE = utils.isInternetExplorer();
if (initNode.length > 0) {
var children = initNode[0].childNodes;
whiteboard.addCategory('initialization');
for (var i = 0; i < children.length; i++) {
if (children[i].nodeName[0] !== '#') {
varName = children[i].attributes[0].nodeValue;
value = children[i].attributes[1].nodeValue;
debug('Found initialization variable ' + varName + ' with value = ' + value);
if ((isIE && (children[i].attributes).getNamedItem('persistent') != undefined)
|| 'persistent' in children[i].attributes)
persistentVariableDB.updateElement(varName, value);
else {
key = whiteboard.addItem('initialization', varName);
whiteboard.setItem('initialization', varName, value, key);
}
}
}
debug('Completed recording initialization specs');
}
}
function createInputSection(sim, section, count) {
var panel = layout.getPanelInstance(Simulator.Constants.INPUT_PANEL_NAME);
var attr = utils.getAttributes(section);
var aSection = new Simulator.Input.Section(sim, panel, count);
aSection.setAttributes(attr);
aSection.render();
var sectionElements = section.childNodes;
var theElement;
var elementorientation = aSection.getSectionSettings().elementorientation;
var numberofcolumns = aSection.getSectionSettings().numberofcolumns;
var container;
if (elementorientation === "vertical") {
var tableRow = aSection.getSimDocument().createElement("div");
tableRow.className = "inputpanelrow";
panel.getHTMLElement().appendChild(tableRow);
container = tableRow;
}
for (var i = 0; i < sectionElements.length; i++) {
if (elementorientation === "horizontal") {
if (i % numberofcolumns == 0) {
var tableRow = aSection.getSimDocument().createElement("div");
tableRow.className = "inputpanelrow";
panel.getHTMLElement().appendChild(tableRow);
}
container = tableRow;
}
switch (sectionElements[i].nodeName) {
case 'inputElement':
var iElements = sectionElements[i].childNodes;
for (var j = 0; j < iElements.length; j++) {
var my = {};
switch (iElements[j].nodeName) {
case 'dropList':
theElement = new Simulator.Input.DropList(sim, iElements[j], panel, aSection, container);
break;
case 'optionList':
theElement = new Simulator.Input.OptionList(sim, iElements[j], panel, aSection, container);
break;
case 'choiceList':
theElement = new Simulator.Input.ChoiceList(sim, iElements[j], panel, aSection, container);
break;
case 'upDownCounter':
if (sim.getAccessibilityIFActive()) {
my.accessibleNode = convertUpDownCounterToDropDown(iElements[j]);
theElement = new Simulator.Input.DropList(sim, my.accessibleNode, panel, aSection, container);
} else
theElement = new Simulator.Input.UpDownCounter(sim, iElements[j], panel, aSection, container);
break;
case 'slider':
theElement = new Simulator.Input.SimSlider(sim, iElements[j], panel, aSection, container);
break;
case 'textField':
theElement = new Simulator.Input.TextField(sim, iElements[j], panel, aSection, container);
break;
default:
continue;
}
if (my.accessibleNode != undefined) {
var attr = utils.getAttributes(my.accessibleNode);
theElement.setAttributes(attr, my.accessibleNode);
setEvents(theElement, my.accessibleNode);
delete my.accessibleNode;
} else {
var attr = utils.getAttributes(iElements[j]);
theElement.setAttributes(attr, iElements[j]);
setEvents(theElement, iElements[j]);
}
theElement.render();
break;
}
break;
case 'commandElement':
var cElements = sectionElements[i].childNodes;
for (var c = 0; c < cElements.length; c++) {
switch (cElements[c].nodeName) {
case 'button':
theElement = new Simulator.Control.Button(sim, panel, aSection, container);
break;
default:
continue;
}
theElement.setAttributes(cElements[c].attributes, cElements[c]);
setEvents(theElement, cElements[c]);
theElement.render(panel.getNodeID());
break;
}
break;
case 'staticElement':
var sElements = sectionElements[i].childNodes;
for (var s = 0; s < sElements.length; s++) {
switch (sElements[s].nodeName) {
case 'imageElement':
theElement = new Simulator.Input.ImageElement(sim, panel, aSection, container);
break;
case 'horizontalLine':
theElement = new Simulator.Input.HorizontalLine(sim, panel, aSection, container);
break;
case 'sectionDivider':
theElement = new Simulator.Input.SectionDivider(sim, panel, aSection, container);
break;
case 'verticalSpace':
theElement = new Simulator.Input.VerticalSpace(sim, panel, aSection, container);
break;
case 'textConstant':
theElement = new Simulator.Input.TextConstant(sim, panel, aSection, container);
break;
default:
continue;
}
theElement.setAttributes(sElements[s].attributes, sElements[s]);
theElement.render(Simulator.Constants.INPUT_PANEL_NAME);
break;
}
break;
}
}
}
function convertUpDownCounterToDropDown(upDownNode) {
function gatherPropertyString(obj) {
var stringVector = [];
for (var prop in obj) {
if (obj[prop] != null)
stringVector.push(prop + '="' + obj[prop] + '"');
}
return stringVector.join(' ');
}
var my = {};
my.xml = [];
my.dropElement = {};
my.dropElement.eName = 'dropList';
my.dropElement.name = upDownNode.getAttribute('name');
my.dropElement.type = 'dropList';
my.dropElement.inputScope = upDownNode.getAttribute('inputScope');
my.dropElement.label = upDownNode.getAttribute('label');
my.dropElement.note = upDownNode.getAttribute('note');
my.dropElement.image = upDownNode.getAttribute('image');
my.xml.push('<dropList ' + gatherPropertyString(my.dropElement) + '>');
my.calc = {};
my.calc.defaultValue = parseFloat(upDownNode.getAttribute('defaultValue'));
my.calc.minValue = parseFloat(upDownNode.getAttribute('minValue'));
my.calc.maxValue = parseFloat(upDownNode.getAttribute('maxValue'));
my.calc.increment = parseFloat(upDownNode.getAttribute('increment'));
my.calc.units = upDownNode.getAttribute('units');
my.calc.values = [];
var currentValue = my.calc.defaultValue;
while (currentValue >= my.calc.minValue) {
my.calc.values.push(currentValue);
currentValue -= my.calc.increment;
}
currentValue = my.calc.defaultValue + my.calc.increment;
while (currentValue <= my.calc.maxValue) {
my.calc.values.push(currentValue);
currentValue += my.calc.increment;
}
my.calc.values.sort(function (a, b) { return a - b });
my.items = [];
for (var i = 0; i < my.calc.values.length; i++)
my.items.push(
{
'val': ((my.calc.units == null) ? my.calc.values[i] : (my.calc.values[i] + ' ' + my.calc.units)),
'dataProxy': my.calc.values[i],
'evaluationProxy': my.calc.values[i],
'animationProxy': my.calc.values[i],
'default': ((my.calc.values[i] == my.calc.defaultValue) ? 'yes' : null)
});
for (var j = 0; j < my.items.length; j++)
my.xml.push('<item ' + gatherPropertyString(my.items[j]) + ' />');
my.eventNodes = upDownNode.getElementsByTagName('event');
for (var j = 0; j < my.eventNodes.length; j++) {
my.xml.push(my.eventNodes[j].outerHTML);
}
my.xml.push('</dropList>');
var xmlString = my.xml.join('\n').replace("&", "&amp;");
var xmlDoc = loadXMLDocFromString(xmlString);
return xmlDoc.getElementsByTagName('dropList')[0];
}
function createAnimationMembers(sim, animationNode) {
var attr;
var theElement;
var animationSet = null;
var panel = layout.getPanelInstance(Simulator.Constants.ANIMATION_PANEL_NAME);
panel.setLiveAttribute('polite');
panel.recordOriginalWidthAndHeight();
for (var i = 0; i < animationNode.childNodes.length; i++) {
if (animationNode.childNodes[i].nodeName[0] != '#') {
animationSet = animationNode.childNodes[i];
break;
}
}
if (!animationSet) {
dbg().logError(source, 'Could not initialize animationSet.');
return;
}
var theSet = new Simulator.Animation.AnimationSet(sim, panel);
animationSetObj = theSet;
theSet.setAttributes(animationSet.attributes, animationSet);
setEvents(theSet, animationSet);
var animationSetElements = animationSet.childNodes;
for (var j = 0; j < animationSetElements.length; j++) {
switch (animationSetElements[j].nodeName) {
case 'animationThread':
var animationThread = animationSetElements[j];
theElement = new Simulator.Animation.AnimationThread(sim, panel, null, theSet);
attr = animationThread.attributes;
theElement.setAttributes(attr, animationThread);
var threadElements = animationThread.childNodes;
for (var k = 0; k < threadElements.length; k++) {
if (threadElements[k].nodeName === 'animationThreadElement') {
var aThreadElement = new Simulator.Animation.AnimationThreadElement(sim, theElement);
aThreadElement.setAttributes(threadElements[k].attributes, threadElements[k]);
theElement.addAnimationThreadElement(aThreadElement);
}
}
setEvents(theElement, animationThread);
break;
case 'animationElement':
theElement = new Simulator.Animation.AnimationElement(sim, theSet, panel);
attr = animationSetElements[j].attributes;
theElement.setAttributes(attr, animationSetElements[j]);
theSet.addAnimationElement(theElement);
if (theElement.getSrc() === '') {
var inlineElement = getElementInlineData(animationSetElements[j], sim);
if (inlineElement) {
theElement.setSrc(inlineElement.getData());
theElement.setInlineDataID(inlineElement.getID());
}
}
if ((theElement.getType() == 'html5') && (utils.canPlayHtml5())) {
panel.addPanelClass('withHTML5');
} else {
panel.addPanelClass('withFlash');
}
break;
case 'poster':
attr = animationSetElements[j].attributes;
theSet.setPoster(attr);
break;
case 'commandElement':
var cElements = animationSetElements[j].childNodes;
for (var c = 0; c < cElements.length; c++) {
switch (cElements[c].nodeName) {
case 'button':
theElement = new Simulator.Control.Button(sim, panel);
break;
default:
continue;
}
theElement.setAttributes(cElements[c].attributes, cElements[c]);
setEvents(theElement, cElements[c]);
theElement.render('animationPanel');
break;
}
break;
}
}
}
function getElementInlineData(node, sim) {
var aNode = null;
var theElement = new Simulator.Animation.InlineData(sim);
var attr = node.attributes;
var nodes = node.childNodes;
var numChildren = nodes.length;
for (var i = 0; i < numChildren; i++) {
aNode = nodes[i];
if (aNode.nodeName === 'inlineData') {
theElement.setAttributes(attr, aNode);
var data = aNode.textContent;
theElement.setData(data);
return theElement;
}
}
dbg.logError(source, 'Missing CDATA section for inlineData element');
return '';
}
function createDisplayMembers(sim, displayNode) {
var theElement = null;
var panel = layout.getPanelInstance(Simulator.Constants.DATA_DISPLAY_PANEL_NAME);
panel.setLiveAttribute('polite');
var displayElementsOriginal = displayNode.childNodes;
var displayElements = [];
if (sim.getAccessibilityIFActive()) {
var clearAllRowsButtons = [];
var otherElements = [];
for (var j = 0; j < displayElementsOriginal.length; j++) {
if (displayElementsOriginal[j].nodeName == 'commandElement' && displayElementsOriginal[j].getElementsByTagName('button')[0].getAttribute('handler') == 'ResetTrials')
clearAllRowsButtons.push(displayElementsOriginal[j]);
else
otherElements.push(displayElementsOriginal[j]);
}
for (var j = 0; j < otherElements.length; j++) {
displayElements.push(otherElements[j]);
if (otherElements[j].nodeName == 'displayElement') {
displayElements = displayElements.concat(clearAllRowsButtons);
clearAllRowsButtons = [];
}
}
} else {
for (var j = 0; j < displayElementsOriginal.length; j++) {
displayElements.push(displayElementsOriginal[j]);
}
}
var clearAllRowsButton;
for (var i = 0; i < displayElements.length; i++) {
switch (displayElements[i].nodeName) {
case 'displayElement':
var dElements = displayElements[i].childNodes;
for (var j = 0; j < dElements.length; j++) {
switch (dElements[j].nodeName) {
case 'table':
theElement = new Simulator.Display.DataTable(sim, panel);
dataTable = theElement;
simMgr.setTableExists(true);
break;
case 'graph':
break;
default:
continue;
}
theElement.setAttributes(dElements[j].attributes, dElements[j]);
setEvents(theElement, dElements[j]);
theElement.render('dataOutputPanel');
}
break;
case 'commandElement':
var cElements = displayElements[i].childNodes;
for (var c = 0; c < cElements.length; c++) {
switch (cElements[c].nodeName) {
case 'button':
theElement = new Simulator.Control.Button(sim, panel);
break;
default:
continue;
}
theElement.setAttributes(cElements[c].attributes, cElements[c]);
setEvents(theElement, cElements[c]);
theElement.render('dataOutputPanel');
if (sim.getAccessibilityIFActive()
&& theElement.getHandler() == 'ResetTrials'
&& clearAllRowsButton == undefined) {
clearAllRowsButton = simDocument.getElementById(theElement.getNodeID());
}
break;
}
break;
}
}
if (clearAllRowsButton != undefined)
clearAllRowsButton.setAttribute('aria-labelledby', dataTable.getCaptionID());
}
function createControlMembers(sim, controlNode) {
var theElement = null;
var controlElements = controlNode.childNodes;
var panel = layout.getPanelInstance(Simulator.Constants.CONTROL_PANEL_NAME);
for (var i = 0; i < controlElements.length; i++) {
switch (controlElements[i].nodeName) {
case 'commandElement':
var cElements = controlElements[i].childNodes;
for (var c = 0; c < cElements.length; c++) {
switch (cElements[c].nodeName) {
case 'button':
theElement = new Simulator.Control.Button(sim, panel);
break;
default:
continue;
}
theElement.setAttributes(cElements[c].attributes, cElements[c]);
setEvents(theElement, cElements[c]);
theElement.render('controlPanel');
break;
}
break;
}
}
}
function setEvents(element, node) {
var events = [];
var attributes;
var children = node.childNodes;
if (children != null && children != undefined) {
for (var j = 0; j < children.length; j++) {
var id = children[j].nodeName;
if (id === 'event') {
attributes = children[j].attributes;
var eventInfo = createEvent(element, attributes);
element.addEvent(eventInfo['theEvent'], eventInfo['direction']);
}
}
}
return events;
}
function createEvent(obj, attributes) {
var response = [];
var data = '';
var ctx = '';
var dir = '';
var type = '';
var postOnChange = 'no';
var completeWithoutOutput = false;
for (var k = 0; k < attributes.length; k++) {
switch (attributes[k].nodeName) {
case 'direction':
dir = attributes[k].nodeValue;
break;
case 'data':
data = attributes[k].nodeValue;
break;
case 'context':
ctx = attributes[k].nodeValue;
break;
case 'type':
type = attributes[k].nodeValue;
break;
case 'postOnChange':
postOnChange = attributes[k].nodeValue;
break;
case 'completeWithoutOutput':
completeWithoutOutput = attributes[k].nodeValue === 'yes' ? true : false;
break;
}
}
response['theEvent'] = new Simulator.Event(obj, type, ctx, data, postOnChange, completeWithoutOutput); response['direction'] = dir;
return response;
}
function sendStartEvent() {
eventMgr.postEvent(new Simulator.Event(simMgr, 'command', 'load'));
}
function simIDgenerate() {
var id = new Date().getTime();
debug('simID generated: ' + id);
return id;
}
function debug(str1, str2, trace) {
dbg.debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg.debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: SimulationManager2.js (5317ec25) 10/26/2014 1:27:05 PM */

Simulator.SimulationManager = function (sim) {
var source = 'SimulationManager';
var name = 'SimulationManager';
var instance = this;
this.zoomFactor = 1;
var maxTrials = 0;
var initialTrialNum = 0;
var currentTrial = initialTrialNum;
var isTrialLimitReached = false;
var noMoreTrialsString = 'Limit on the Number of Trials Reached.';
var simulatorHeight = 0;
var simulatorWidth = 0;
var originalSimulatorHeight = 0;
var originalSimulatorWidth = 0;
var animationFinished = false;
var tableUpdated = false;
var itemName = '';
var redoingTrial = false;
var tableExists = false;
var animationCompleteWithoutOutput = false;
var stateDB = {};
var stateName = null;
var restoreAnimationOnReload = null;
var clearScoreOnNewTrial = false;
var useTrialNumFromDeleteQueue = false;
var state =
{
SimError: -1,
Uninitialized: 0,
Initialized: 1,
Instantiated: 2,
Loading: 3,
Loaded: 4,
Ready: 5,
TrialLimitReached: 6,
Playing: 7,
ReadOnly: 8
};
var currentState = state.Uninitialized;
var eventMgr = function () { return sim.getEventManager(); };
var whiteboard = function () { return sim.getWhiteboard(); };
var scoringTable = function () { return sim.getScoringTable(); };
var persistentVariableDB = sim.getPersistentVariableDB();
var trialNumStack = new Simulator.Utils.Stack(sim);
var deleteQueue = new Simulator.Utils.OrderedQueue(sim);
var layout = function () { return sim.getLayout(); };
var simID = function () { return sim.getSimID(); };
var dbg = function () { return sim.getDebug(); };
var dataTable = function () { return sim.getDataTable(); };
var simDocument = function () { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
registerAllEvents = function (simMgr) {
eventMgr().registerEvent(new Simulator.Event(simMgr, 'command', 'startTrial'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'command', 'newTrial'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'command', 'startAnimation'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'command', 'resetTrials'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'errorOccurred'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'animationStarted'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'animationFinished'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'animationThreadFinished'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'simulatorStateChange'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'animationUnreachable'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'tableUpdated'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'allMediaLoaded'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'allTableRowsCleared'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'command', 'redoTrial'));
eventMgr().registerEvent(new Simulator.Event(simMgr, 'info', 'simulatorDimensionsAvaiable'));
debug('Registered all pre - required events');
};
this.getName = function () {
return name;
};
this.getSourceName = function () {
return source;
};
this.getRestoreAnimationOnReload = function () {
return restoreAnimationOnReload;
};
this.setSimulatorHeight = function (height) {
if (height) {
simulatorHeight = height;
} else {
simulatorHeight = layout().getContainerHeight();
}
};
this.setSimulatorWidth = function (width) {
if (width) {
simulatorWidth = width;
} else {
simulatorWidth = layout().getContainerWidth();
}
};
this.setOriginalSimulatorHeight = function (height) {
if (height) {
originalSimulatorHeight = height;
} else {
originalSimulatorHeight = layout().getContainerHeight();
}
};
this.setOriginalSimulatorWidth = function (width) {
if (width) {
originalSimulatorWidth = width;
} else {
originalSimulatorWidth = layout().getContainerWidth();
}
};
this.getItemName = function () {
return itemName;
};
this.getSimulatorHeight = function () {
simulatorHeight = layout().getContainerHeight();
return simulatorHeight;
};
this.getSimulatorWidth = function () {
simulatorWidth = layout().getContainerWidth();
return simulatorWidth;
};
this.getOriginalSimulatorHeight = function () {
return originalSimulatorHeight;
};
this.getOriginalSimulatorWidth = function () {
return originalSimulatorWidth;
};
this.setAnimationCompleteWithoutOutput = function (flag) {
animationCompleteWithoutOutput = (flag === 'yes' || flag == true) ? true : false;
};
this.getAnimationCompleteWithoutOutput = function () {
return animationCompleteWithoutOutput;
};
this.setState = function (theState) {
currentState = theState;
switch (theState) {
case state.SimError: stateName = 'SimError'; break;
case state.Uninitialized: stateName = 'Uninitialized'; break;
case state.Initialized: stateName = 'Initialized'; break;
case state.Instantiated: stateName = 'Instantiated'; break;
case state.Loading: stateName = 'Loading'; break;
case state.Loaded: stateName = 'Loaded'; break;
case state.Ready: stateName = 'Ready'; break;
case state.TrialLimitReached: stateName = 'TrialLimitReached'; break;
case state.Playing: stateName = 'Playing'; break;
case state.ReadOnly: stateName = 'ReadOnly'; break;
default:
dbg().logError(source, 'Unknown state passed to setState: ' + theState);
return;
}
debugf('Simulator state: ' + stateName);
eventMgr().postEvent(new Simulator.Event(this, 'info', 'simulatorStateChange', stateName));
};
this.getState = function () {
return currentState;
};
this.getStateName = function () {
return stateName;
};
this.verifyCheckListSelection = function () {
return layout().hasEmptyChoiceListSelection();
};
this.setStateFromName = function (theStateName) {
switch (theStateName) {
case 'SimError': this.setState(state.SimError); break;
case 'Uninitialized': this.setState(state.Uninitialized); break;
case 'Initialized': this.setState(state.Initialized); break;
case 'Instantiated': this.setState(state.Instantiated); break;
case 'Loading': this.setState(state.Loading); break;
case 'Loaded': this.setState(state.Loaded); break;
case 'Ready': this.setState(state.Ready); break;
case 'TrialLimitReached': this.setState(state.TrialLimitReached); break;
case 'Playing': this.setState(state.Playing); break;
case 'ReadOnly': this.setState(state.ReadOnly); break;
default:
dbg().logError(source, 'Unknown state name passed to setState: ' + stateName);
return;
}
};
this.handleEvent = function (event) {
switch (event.type) {
case 'command':
switch (event.context) {
case 'startTrial':
var redoingATrial = this.adjustForRedoTrials();
if (!this.checkTrialLimitReached(redoingATrial)) {
layout().saveInputs(true);
tableUpdated = false;
animationFinished = false;
this.setAnimationCompleteWithoutOutput(false);
if (!redoingATrial) this.nextTrialNum();
} else this.trialLimitReachedAction();
break;
case 'startAnimation':
this.adjustForRedoTrials();
layout().saveInputs();
tableUpdated = false;
animationFinished = false;
break;
case 'newTrial':
if (!this.checkTrialLimitReached()) {
this.adjustForRedoTrials();
} else this.trialLimitReachedAction();
break;
case 'resetTrials':
if (!this.isReadOnly()) {
this.resetTrialNum();
layout().enableAllInput();
}
break;
case 'redoTrial':
if (!this.isReadOnly()) {
this.redoTrialNum(event.data);
}
break;
}
break;
case 'info':
switch (event.context) {
case 'animationStarted':
this.setPlayingState();
break;
case 'animationThreadFinished':
animationFinished = true;
debug(source, "Received animationThreadFinished event from, animationCompleteWithoutOutput = " + this.getAnimationCompleteWithoutOutput());
if (!this.getAnimationCompleteWithoutOutput()) {
debug('this.getTableExists() = ' + this.getTableExists() + ', tableUpdated = ' + tableUpdated);
if (this.getTableExists() && tableUpdated) {
dataTable().saveScoreableInputs();
whiteboard().clearCategory('evaluationOutput');
this.setReadyState();
} else {
if (!this.getTableExists()) {
debug(source, 'Table does not exist. Setting simulator state to Ready');
this.setReadyState();
}
else {
debug(source, 'Table does exist but has not been updated');
this.setReadyState();
}
}
} else {
dataTable().saveScoreableInputs();
debug(source, "Received animationThreadFinished event with animationCompleteWithoutOutput = true. Table was not updated. Current trial number remains at " + this.getTrialNum());
this.setReadyState();
}
break;
case 'animationUnreachable':
dbg.logWarning('AnimationUnreachable.Setting Ready state in SimulationManager.handleEvent');
this.setReadyState();
break;
case 'tableUpdated':
tableUpdated = true;
debug('Received tableUpdated event');
if (animationFinished) {
this.setReadyState();
}
break;
case 'allTableRowsCleared':
layout().enableAllInput();
break;
case 'allMediaLoaded':
debug("SimulationManager received 'allMediaLoaded' event");
this.setReadyState();
break;
case 'fatalErrorOccurred':
this.setState(state.Error);
eventMgr().postEvent(new Simulator.Event({ source: this, type: 'error', context: 'FatalSimulationError', data: event.data }));
eventMgr().stopEventProcessing();
break;
}
break;
default: dbg().logWarning(source, 'Unrecognized event of type "' + event.type + '" and context: "' + event.context + '"');
break;
}
};
this.lastTrialReached = function () {
if (deleteQueue.length() > 0) return false;
else if (maxTrials === 0) return false;
else if (trialNumStack.peek() < parseInt(maxTrials)) return false;
else {
trialNumStack.push(parseInt(maxTrials));
return true;
}
};
this.checkTrialLimitReached = function (redoingATrial) {
if (deleteQueue.length() > 0) {
isTrialLimitReached = false;
return false;
} else if (maxTrials === 0) {
isTrialLimitReached = false;
return false;
} else {
if (redoingATrial) isTrialLimitReached = (currentTrial > parseInt(maxTrials));
else isTrialLimitReached = (currentTrial >= parseInt(maxTrials));
return isTrialLimitReached;
}
};
this.trialLimitReached = function () {
return isTrialLimitReached;
};
this.nextTrialNum = function () {
var val = trialNumStack.peek();
if (isNaN(val)) trialNumStack.push(initialTrialNum);
else trialNumStack.push(parseInt(trialNumStack.peek()) + 1);
currentTrial = trialNumStack.peek();
if (!this.trialLimitReached() && clearScoreOnNewTrial) {
scoringTable().clearTable();
}
trialNumStack.inspect();
deleteQueue.inspect();
debug('SimulationManager.NextTrialNum: Setting next trial number to ' + currentTrial);
};
this.adjustForRedoTrials = function () {
if (deleteQueue.length() > 0) {
currentTrial = deleteQueue.remove();
useTrialNumFromDeleteQueue = true;
redoingTrial = false;
return true;
} else if (useTrialNumFromDeleteQueue) {
useTrialNumFromDeleteQueue = false;
currentTrial = trialNumStack.peek();
if (isNaN(currentTrial)) currentTrial = initialTrialNum;
return false;
} else return false;
};
this.redoTrialNum = function (num) {
deleteQueue.add(num);
trialNumStack.inspect();
deleteQueue.inspect();
redoingTrial = true;
this.setReadyState();
};
this.getTrialRowNum = function (recordOnChange) {
if (recordOnChange) {
if (deleteQueue.length() == 0) {
var val = trialNumStack.peek();
if (isNaN(val)) return initialTrialNum;
else return parseInt(trialNumStack.peek());
} else {
return deleteQueue.peek() - 1;
}
} else {
if (useTrialNumFromDeleteQueue) {
return currentTrial - 1;
} else {
var val = trialNumStack.peek();
if (isNaN(val)) return initialTrialNum;
else return parseInt(trialNumStack.peek());
}
}
}
this.isRedoingTrial = function () {
return redoingTrial;
};
this.getTrialNum = function () {
return currentTrial;
};
this.getInitialTrialNum = function () {
return initialTrialNum;
};
this.setTrialNum = function (num) {
trialNumStack.push(num);
currentTrial = num;
debug('SimulationManager.SetTrialNum: Setting current trial number to ' + currentTrial);
};
this.resumeTrials = function () {
};
this.resetTrialNum = function () {
deleteQueue.clear();
trialNumStack.push(Simulator.Constants.DEFAULT_INITIAL_TRIAL_NUM);
currentTrial = trialNumStack.peek();
};
this.getDisabledAction = function () {
switch (this.getState()) {
case state.TrialLimitReached:
return trialLimitReachedAction;
default: return this.noAction;
}
};
this.trialLimitReachedAction = function () {
this.setTrialLimitReachedState();
Simulator.showAlertWarning(this.getNoMoreTrialString());
};
this.noAction = function () {
return;
};
this.getNoMoreTrialString = function () {
return transDictionary().translate(noMoreTrialsString);
};
this.getBaseURL = function () {
return baseURL;
};
this.getName = function () {
return source;
};
this.isPlaying = function () {
return this.getStateName() === 'Playing';
};
this.isReadOnly = function () {
return this.getStateName() == 'ReadOnly';
};
this.isLoaded = function () {
return (this.getState() >= state.Loaded);
}
this.isReady = function () {
return (this.getState() === state.Ready);
};
this.setReadOnlyState = function (newState) {
newState === true ? this.setState(state.ReadOnly) : this.setState(state.Ready);
};
this.setReadyState = function () {
this.setState(state.Ready);
debugf('Enabling all input and setting simulator state to "Ready"', null, 'notrace');
layout().enableAllInput();
};
this.setPlayingState = function () {
debugf('Disabling all input and setting simulator state to "Playing"', null, 'notrace');
this.setState(state.Playing);
layout().disableAllInput();
};
this.setTrialLimitReachedState = function () {
this.setState(state.TrialLimitReached);
layout().disableAllInput();
};
this.getNextItem = function () {
window.location.reload();
};
this.getResponse = function () {
var contents = dataDB.getContents();
return contents;
};
this.setTableExists = function (flag) {
flag == true ? tableExists = true : tableExists = false;
};
this.getTableExists = function () {
return tableExists;
};
this.displaySimulatorState = function (embedded) {
var buff = [];
var aState = null;
buff.push('Simulator State:');
buff.push('-----------------------');
buff.push(deleteQueue.inspect(false));
buff.push(trialNumStack.inspect(false));
buff.push('currentTrial = ' + currentTrial);
buff.push('redoingTrial = ' + redoingTrial);
buff.push('currentState = ' + this.getStateName());
buff.push('zoomFactor = ' + this.zoomFactor);
buff.push('speechEnabled = ' + sim.getSpeechEnabled());
buff.push('simulator height = ' + this.getSimulatorHeight());
buff.push('simulator width = ' + this.getSimulatorWidth());
if (sim.getAnimationSet() !== null) {
aState = sim.getAnimationSet().getCurrentAnimationState();
} else {
aState = [];
aState['animation state'] = 'none';
}
for (var p in aState) buff.push(p + ' = ' + aState[p]);
buff.push('End of Simulator State');
buff.push('-----------------------');
if (!embedded) debug(buff.join('\n'));
else return buff.join('\n');
};
this.initManagerVariables = function () {
var whtBrd = whiteboard();
this.setTrialNum(Simulator.Constants.DEFAULT_INITIAL_TRIAL_NUM);
currentTrial = this.getTrialNum();
if (whtBrd.itemExists('initialization', 'MaxTrials')) {
maxTrials = whtBrd.getItem('initialization', 'MaxTrials');
if ((maxTrials) && (maxTrials > 0)) {
scoringTable().setMaxRowNum(maxTrials);
}
}
if (whtBrd.itemExists('initialization', 'NoMoreTrialsString')) {
noMoreTrialsString = whtBrd.getItem('initialization', 'NoMoreTrialsString');
}
if (whtBrd.itemExists('initialization', 'ClearScoreOnNewTrial')) {
clearScoreOnNewTrial = whtBrd.getItem('initialization', 'ClearScoreOnNewTrial');
clearScoreOnNewTrial = clearScoreOnNewTrial === 'yes' ? true : false;
}
if (whtBrd.itemExists('initialization', 'RestoreAnimationOnReload')) {
restoreAnimationOnReload = whtBrd.getItem('initialization', 'RestoreAnimationOnReload');
restoreAnimationOnReload = restoreAnimationOnReload === 'yes' ? true : false;
}
};
this.setSimulatorHeight = function (height) {
simulatorHeight = height;
};
this.setSimulatorWidth = function (width) {
simulatorWidth = width;
};
this.setResponseStateVariables = function (stateMgr) {
stateMgr.setResponseStateVariableValue('deleteQueue', deleteQueue.entriesAsString());
stateMgr.setResponseStateVariableValue('trialNumStack', trialNumStack.entriesAsString());
stateMgr.setResponseStateVariableValue('currentTrial', currentTrial);
stateMgr.setResponseStateVariableValue('redoingTrial', redoingTrial);
if (this.getStateName() == 'ReadOnly') stateMgr.setResponseStateVariableValue('currentState', 'Ready');
else stateMgr.setResponseStateVariableValue('currentState', this.getStateName());
stateMgr.setResponseStateVariableValue('zoomFactor', this.zoomFactor);
stateMgr.setResponseStateVariableValue('speechEnabled', sim.getSpeechEnabled());
if (this.getStateName() == 'ReadOnly') stateMgr.setResponseStateVariableValue('simulatorHeight', this.getOriginalSimulatorHeight());
else stateMgr.setResponseStateVariableValue('simulatorHeight', this.getSimulatorHeight());
if (this.getStateName() == 'ReadOnly') stateMgr.setResponseStateVariableValue('simulatorWidth', this.getOriginalSimulatorWidth());
else stateMgr.setResponseStateVariableValue('simulatorWidth', this.getSimulatorWidth());
};
this.clearSimulationState = function () {
trialNumStack.clear();
deleteQueue.clear();
};
function recordStateSpecs(initNode) {
if (initNode.length > 0) {
var children = initNode[0].childNodes;
for (var i = 0; i < children.length; i++) {
spec = children[i];
if (children[i].nodeName[0] != '#') {
varName = children[i].attributes[0].nodeValue;
stateDB.varName = '';
}
}
}
}
this.restoreStateVariables = function (stateDB) {
var parts = null;
for (p in stateDB) {
switch (p) {
case 'deleteQueue':
deleteQueue.clear();
parts = stateDB['deleteQueue'].split(',');
for (var i = 0; i < parts.length; i++) {
if (parts[i]) {
if (parts[i] !== undefined && parts[i] !== '') deleteQueue.add(parseInt(parts[i]));
}
}
break;
case 'trialNumStack':
trialNumStack.clear();
parts = stateDB['trialNumStack'].split(',');
for (var i = parts.length - 1; i > -1; i--) {
if (parts[i]) {
if (parts[i] !== undefined && parts[i] !== '') trialNumStack.push(parseInt(parts[i]));
}
}
break;
case 'currentTrial':
if (stateDB[p] !== '') currentTrial = parseInt(stateDB[p]);
break;
case 'redoingTrial':
redoingTrial = stateDB[p] === 'true' ? true : false;
break;
case 'currentState':
this.setStateFromName(stateDB[p]);
break;
case 'zoomFactor':
this.zoomFactor = parseFloat(stateDB[p]);
break;
case 'simulatorHeight':
this.setSimulatorHeight(stateDB[p]);
this.setOriginalSimulatorHeight(stateDB[p]);
break;
case 'simulatorWidth':
this.setSimulatorWidth(stateDB[p]);
this.setOriginalSimulatorWidth(stateDB[p]);
break;
}
}
this.displaySimulatorState();
};
if (sim) registerAllEvents(instance);
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: ResponseStateManager2.js (a910fe9e) 9/9/2014 2:09:04 PM */

Simulator.ResponseStateManager = function (sim) {
var stateDB = {};
var persistentVarDB = function () { return sim.getPersistentVariableDB(); };
var util = function () { return sim.getUtils(); };
var simMgr = function () { return sim.getSimulationManager(); };
var dbg = function () { return sim.getDebug(); };
var scoringTable = function () { return sim.getScoringTable(); };
var dataTable = function () { return sim.getDataTable(); };
var simDocument = function() { return sim.getSimDocument(); };
var setStateVarSpec = function (initNode) {
var attr = initNode.attributes;
if (attr.length > 0) {
var element = attr['element'].nodeValue;
var value = attr['value'].nodeValue;
if (attr['persistent']) {
if (attr['persistent'].nodeValue == 'yes') persistentVarDB().updateElement(element, value);
}
else stateDB[element] = value;
}
};
var setInputStateSpec = function (initNode, panel) {
var attr = initNode.attributes;
if (attr.length > 0) {
var element = attr['element' +
''].nodeValue;
var value = attr['value'].nodeValue;
panel.setElementSelectState(element, value);
}
};
var setAnimationStateSpec = function (initNode) {
var spec = null;
var attr = null;
var animationStateDB = [];
var children = initNode.childNodes;
for (var i = 0; i < children.length; i++) {
if (children[i].nodeName[0] != '#') {
spec = children[i];
attr = spec.attributes;
if (attr.length > 0) {
var element = attr['element'].nodeValue;
var value = attr['value'].nodeValue;
animationStateDB[element] = value;
}
}
}
if (Object.size(animationStateDB) > 0) sim.getAnimationSet().setCurrentAnimationState(animationStateDB);
};
function writeSimulationState(indent) {
var simStateStr = indent + '<state>\n';
var doubleIndent = indent + indent;
var tripleIndent = doubleIndent + indent;
for (var p in stateDB) {
simStateStr = simStateStr + doubleIndent + '<stateSpec element="' + p + '" value="' + stateDB[p] + '" /> \n';
}
var store = persistentVarDB().getContents();
for (var i in store) {
simStateStr = simStateStr + doubleIndent + '<stateSpec element="' + i + '" value="' + store[i] + '" persistent="yes" /> \n';
}
var inputState = sim.getLayout().getPanelInstance(Simulator.Constants.INPUT_PANEL_NAME).saveInputElementStates(indent, '<inputSpec ', 'element="', '" value="', '" />\n');
simStateStr = simStateStr + inputState;
var displayTable = dataTable();
if (displayTable) {
var tableStr = displayTable.getContents(tripleIndent);
if (tableStr) {
simStateStr = simStateStr + doubleIndent + '<stateTableSpec id="dataTable"> \n' +
tableStr + doubleIndent + '</stateTableSpec>';
}
}
if (simMgr().getRestoreAnimationOnReload()) {
var animationState = sim.getAnimationSet().getCurrentAnimationState();
if (animationState != undefined && animationState != null) {
simStateStr = simStateStr + doubleIndent + '<animationStateSpec> \n';
for (var k in animationState) {
simStateStr = simStateStr + tripleIndent + '<stateSpec element="' + k + '" value="' + animationState[k] + '" /> \n';
}
simStateStr = simStateStr + doubleIndent + '</animationStateSpec>';
}
}
simStateStr = simStateStr + indent + '\n</state>\n';
return simStateStr;
}
this.setResponseStateVariableValue = function (theVariable, theValue) {
stateDB[theVariable] = theValue;
};
this.getResponseStateVariableValue = function (theVariable) {
return stateDB[theVariable];
};
this.restoreSimulation = function (xmlDoc) {
var responseSpec = xmlDoc.getElementsByTagName('responseSpec')[0];
if (responseSpec) {
var simState = responseSpec.getElementsByTagName('state')[0];
var children = simState.childNodes;
for (var i = 0; i < children.length; i++) {
if (children[i].nodeName[0] != '#') {
switch (children[i].nodeName) {
case 'stateSpec':
setStateVarSpec(children[i]);
break;
case 'inputSpec':
setInputStateSpec(children[i], sim.getLayout().getPanelInstance(Simulator.Constants.INPUT_PANEL_NAME));
break;
case 'stateTableSpec':
var nextGen = children[i].childNodes;
for (var q = 0; q < nextGen.length; q++) {
if (nextGen[q].nodeName == 'stateTable') {
dataTable().loadFromResponse(nextGen[q]);
}
}
break;
case 'animationStateSpec':
setAnimationStateSpec(children[i]);
break;
}
}
}
simMgr().restoreStateVariables(stateDB);
scoringTable().restoreResponseTable(responseSpec.getElementsByTagName('responseTable')[0]);
}
};
this.saveState = function () {
var stateStr = '<responseSpec>\n';
var responseStr = scoringTable().getContents('  ');
stateStr += responseStr + '\n\n';
stateStr += writeSimulationState('  ');
stateStr += '\n</responseSpec>';
return stateStr;
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: Canvas2.js (958ad2a2) 9/9/2014 2:09:04 PM */

Simulator.Display.Canvas = function(sim) {
Simulator.SimElement.call(this, sim);
var source = 'Canvas';
var instance = this;
var hTMLElement = '';
var top = 0;
var left = 0;
var height = 0;
var width = 0;
var backgroundColor = '';
var dbg = function() {return sim.getDebug();};
var simulationMgr = function() {return sim.getSimulationManager();};
var simDocument = function() { return sim.getSimDocument(); };
this.getHTMLElement = function() {
return hTMLElement;
};
this.setHTMLElement = function(newHTMLElement) {
hTMLElement = newHTMLElement;
return this;
};
this.getTop = function() {
return top;
};
this.setTop = function(newTop) {
top = newTop;
return this;
};
this.getLeft = function() {
return left;
};
this.setLeft = function(newLeft) {
left = newLeft;
return this;
};
this.getHeight = function() {
if(simulationMgr()) {
return (parseFloat(height)/100)*(simulationMgr().getSimulatorHeight());
}
else return 0;
};
this.getHeightPercentage = function() {
return height;
};
this.setHeight = function(newHeight) {
height = newHeight;
return this;
};
this.getWidth = function() {
if(simulationMgr()) {
return (parseFloat(width)/100)*(simulationMgr().getSimulatorWidth());
}
else return 0;
};
this.getWidthPercentage = function() {
return width;
};
this.setWidth = function(newWidth) {
width = newWidth;
return this;
};
this.getBackgroundColor = function() {
return backgroundColor;
};
this.setBackgroundColor = function(newBackgroundColor) {
backgroundColor = newBackgroundColor;
return this;
};
this.containsElement = function(elementID) {
var children = hTMLElement.childNodes;
for(var i = 0; i < children.length; i++) {
if(children[i].nodeName[0] != '#') {
if(children[i].nodeValue == elementID) return true;
}
}
return false;
};
this.containsElementWithAttribute = function(elementID, attributeName, attributeValue) {
var attributes = null;
var children = hTMLElement.childNodes;
for(var i = 0; i < children.length; i++) {
if(children[i].nodeName[0] != '#') {
if(children[i].nodeValue == elementID) {
attributes = children[i].attributes;
if(attributes) {
if(attributeName in attributes) {
if(attributeValue) return attributes[attributeName] == attributeValue;
else return true;
}
} else return false;
} else return false;
}
}
return false;
};
this.setEname('Canvas');
this.setAttributes = function(attr, node) {
Simulator.Display.Canvas.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'top':
this.setTop(attr[i]);
break;
case 'left':
this.setLeft(attr[i]);
break;
case 'height':
this.setHeight(attr[i]);
break;
case 'width':
this.setWidth(attr[i]);
break;
case 'backgroundColor':
this.setBackgroundColor(attr[i]);
break;
}
}
};
this.getSourceName = function() {
return source;
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Display.Canvas.prototype = new Simulator.SimElement();
Simulator.Display.Canvas.prototype.constructor = Simulator.Display.Canvas;

/* SOURCE FILE: Panel2.js (f3cd410d) 10/26/2014 1:27:05 PM */

Simulator.Display.Panel = function (sim, panelNum) {
Simulator.Display.Canvas.call(this, sim);
var source = 'Panel';
var instance = this;
var headerText = '';
var headerTextSize = '';
var float = '';
var initialFocus = false;
var display = 'hidden';
var borderColor = '';
var dialogAttr = [];
var panelNumber = panelNum;
var panelID = '';
var dialogPanel = null;
var ioElements = [];
var dialogButtonLabel = "";
var originalWidth = null;
var originalHeight = null;
var dbg = function () { return sim.getDebug(); };
var utils = function () { return sim.getUtils(); };
var simDocument = function () { return sim.getSimDocument(); };
this.registerIOElement = function (inputElement) {
ioElements.push(inputElement);
};
this.getOriginalHeight = function () {
return originalHeight;
}
this.getOriginalWidth = function () {
return originalWidth;
}
this.recordOriginalWidthAndHeight = function () {
if (this.getName() == 'animationPanel' && !(originalWidth > 0 && originalHeight > 0)) {
originalWidth = this.getWidth();
originalHeight = this.getHeight();
debugf(source, 'Recording Original Width =' + originalWidth + ' Original Heigth =' + originalHeight);
}
}
this.getHeaderText = function () {
return headerText;
};
this.setHeaderText = function (newHeaderText) {
headerText = newHeaderText;
return this;
};
this.getHeaderTextSize = function () {
return headerTextSize;
};
this.setHeaderTextSize = function (textSize) {
headerTextSize = textSize == 'small' || textSize == 'medium' | textSize == 'large' | textSize == 'x-Large' ? textSize : null;
if (!headerTextSize) {
dbg().logError(source, 'Invalid value for headerTextSize attribute: ' + textSize);
headerTextSize = '';
}
return this;
};
this.getFloat = function () {
return float;
};
this.setFloat = function (newFloat) {
float = newFloat == 'left' | newFloat == 'right' || newFloat == 'none' ? newFloat : null;
if (!float) {
dbg().logError(source, 'Invalid value for float attribute: ' + newFloat);
newFloat = '';
}
return this;
};
this.getInitialFocus = function () {
return initialFocus;
};
this.setInitialFocus = function (newInitialFocus) {
initialFocus = newInitialFocus == 'yes' ? true : false;
return this;
};
this.setDialogButtonLabel = function (newLabel) {
dialogButtonLabel = newLabel;
};
this.getDialogButtonLabel = function () {
return dialogButtonLabel;
};
this.getDisplay = function () {
return display;
};
this.setDisplay = function (newDisplay) {
display = (newDisplay == 'inline' || newDisplay == 'block' || newDisplay == 'none' || newDisplay == 'hidden' || newDisplay == 'visible') ? newDisplay : null;
if (!display) {
dbg().logError(source, 'Invalid value for display attribute: ' + newDisplay);
display = 'hidden';
}
return this;
};
this.resize = function (zoom) {
if (this.getName() == 'animationPanel') {
sim.getAnimationSet().getRenderer().resizeAnimationElements(this, zoom);
}
};
this.getBorderColor = function () {
return borderColor;
};
this.setBorderColor = function (newBorderColor) {
borderColor = newBorderColor;
return this;
};
this.appendStr = function (str) {
var hElement = this.getHTMLElement();
hElement.innerHTML = hElement.innerHTML + str;
};
this.setStr = function (str) {
var hElement = this.getHTMLElement();
hElement.innerHTML = str;
};
this.resetStr = function (str) {
var hElement = this.getHTMLElement();
hElement.innerHTML = this.getHeaderText() + str;
};
this.disableAllInput = function () {
for (var i = 0; i < ioElements.length; i++) {
ioElements[i].disableInput();
}
};
this.enableAllInput = function () {
for (var i = 0; i < ioElements.length; i++) {
ioElements[i].enableInput();
}
};
this.saveInputs = function (forcedSave) {
for (var i = 0; i < ioElements.length; i++) {
if (ioElements[i].recordInput)
ioElements[i].recordInput(null, null, null, forcedSave);
}
};
this.saveInputElementStates = function (indent, preface, nameStr, valStr, suffix) {
var stateStr = '';
for (var i = 0; i < ioElements.length; i++) {
if (ioElements[i].saveState) {
stateStr = stateStr + indent + ioElements[i].saveState(indent, preface, nameStr, valStr, suffix);
}
}
return stateStr;
};
this.setElementSelectState = function (elementID, contents) {
var iElement = null;
for (var i = 0; i < ioElements.length; i++) {
iElement = ioElements[i];
if (iElement.getName() == elementID) iElement.setElementSelectState('true', contents);
}
};
this.setLiveAttribute = function (liveValue) {
if (!liveValue)
this.getHTMLElement().setAttribute('aria-live', 'off');
else
this.getHTMLElement().setAttribute('aria-live', liveValue);
}
this.hasEmptyChoiceListSelection = function () {
var iElement = null;
for (var i = 0; i < ioElements.length; i++) {
iElement = ioElements[i];
if (iElement.getType() === 'choiceList') {
var choiceSelection = iElement.getData();
if (choiceSelection.length == 0) {
var sectionLabel = iElement.getSectionLabel();
if ((sectionLabel != null) && (sectionLabel != '')) {
dbg().logFatalError(iElement.getName(), 'you must make a selection for "' + sectionLabel + '"!');
} else {
dbg().logFatalError(iElement.getName(), 'you must make a selection for a choice element!');
}
return true;
}
}
}
return false;
};
this.getHTMLPanel = function () {
return simDocument().getElementById(this.getName());
};
this.setAttributes = function (panel, attr) {
Simulator.Display.Panel.prototype.setAttributes.call(this, attr);
for (var i in attr) {
switch (i) {
case 'headerText':
this.setHeaderText(attr[i]);
break;
case 'headerTextSize':
this.setHeaderTextSize(attr[i]);
break;
case 'float':
this.setFloat(attr[i]);
break;
case 'display':
this.setDisplay(attr[i]);
break;
case 'border':
this.setBorder(attr[i]);
break;
case 'initialFocus':
this.setInitialFocus(attr[i]);
break;
case 'instructions':
dialogAttr[i] = attr[i];
break;
case 'button':
this.setDialogButtonLabel(attr[i]);
break;
case 'borderColor':
this.setBorderColor(attr[i]);
break;
case 'title':
this.setTitle(attr[i]);
break;
}
}
if (!utils().assocArrayIsEmpty(dialogAttr)) dialogPanel = new Simulator.Display.DialogPanel(sim, instance, panelID, this.getDialogButtonLabel(), dialogAttr);
};
this.render = function () {
var div = simDocument().createElement('div');
if (this.getFloat()) {
div.style.display = this.getFloat();
}
if (this.getHeightPercentage()) {
div.style.height = this.getHeightPercentage();
}
if (this.getWidthPercentage()) {
div.style.width = this.getWidthPercentage();
}
if (this.getTop()) {
div.style.top = this.getTop();
}
if (this.getLeft()) {
div.style.left = this.getLeft();
}
div.id = this.getNodeID();
div.setAttribute('class', 'panel' + panelNumber + ' panelSingle ' + this.getName());
div.setAttribute('role', 'region');
div.setAttribute('aria-live', 'off');
if (this.getHeaderText()) {
var div2 = simDocument().createElement('div');
div2.setAttribute('class', 'holderInfo');
div2.innerHTML = this.getHeaderText();
div.appendChild(div2);
}
var container = simDocument().getElementById(Simulator.Constants.SIM_CONTAINER_NAME + sim.getSimID());
container.appendChild(div);
this.setHTMLElement(div);
if ('instructions' in dialogAttr) {
if ('button' in dialogAttr) dialogPanel.render();
else div.innerHTML = this.getDialogAttr()['instructions'];
}
this.mapHTML2JS(div);
};
this.getSourceName = function () {
return source;
};
this.inspect = function (embedded, forced) {
var buff = [];
var sep = '\n';
if (!embedded)
buff.push('Inspecting ' + this.getName() + ' panel');
buff.push(sep);
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) forced === null ? debug(buff.join('')) : debugf(buff.join(''));
else return buff.join('');
};
this.addPanelClass = function (className) {
var htmlPanel = simDocument().getElementById(this.getNodeID());
if (htmlPanel) {
var classNames = htmlPanel.getAttribute('class');
if (classNames.indexOf(className) != -1) {
return;
}
if (classNames != '') {
className = ' ' + className;
}
classNames = classNames + className;
htmlPanel.setAttribute('class', classNames);
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Display.Panel.prototype = new Simulator.Display.Canvas();
Simulator.Display.Panel.prototype.constructor = Simulator.Display.Panel;

/* SOURCE FILE: InlineData2.js (3bc75045) 9/9/2014 2:09:04 PM */

Simulator.Animation.InlineData = function (sim) {
var source = 'InlineData';
var id = '';
var name = '';
var data = '';
var animationElementName = '';
var util = function () { return sim.getUtils(); };
var simDocument = function() { return sim.getSimDocument(); };
var dbg = function () { return sim.getDebug(); }
this.setID = function(newID) {
id = newID;
};
this.getID = function() {
return id;
};
this.setName = function(newName) {
name = newName;
return this;
};
this.getName = function() {
return name;
};
this.setData = function(newData) {
data = newData;
return this;
};
this.getData = function() {
return data;
};
this.setAnimationElement = function(newAnimationElementName) {
animationElementName = newAnimationElementName;
};
this.getAnimationElementName = function() {
return animationElementName;
};
this.getSourceName = function() {
return source;
};
this.inspect = function(embedded, force) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting InlineData element ' + this.getName());
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
buff.push('End of inlineData element inspection');
buff.push(sep);
if(embedded) return buff.join('');
else force == null ? debug(buff.join('')) : debugf(buff.join(''));
};
Simulator.Animation.InlineData.prototype.setAttributes = function (attr, node) {
var attr = util().getAttributes(node);
for (var i in attr) {
switch (i) {
case 'id':
this.setID(attr[i]);
break;
case 'name':
this.setName(attr[i]);
break;
case 'animationElement':
this.setAnimationElement(attr[i]);
break;
}
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
}

/* SOURCE FILE: AnimationElement2.js (d6e33f06) 9/9/2014 2:09:04 PM */

Simulator.Animation.AnimationElement = function (sim) {
Simulator.SimElement.call(this, sim);
var source = 'AnimationElement';
var controls = '';
var src = '';
var altSrc = '';
var altSrcType = '';
var altText = '';
var behavior = 'timeline';
var inlineDataID = '';
var interactive = false;
this.setEname(source);
var util = function () { return sim.getUtils(); };
var simDocument = function () { return sim.getSimDocument(); };
var dbg = function () { return sim.getDebug(); };
var simMgr = function () { return sim.getSimulationManager(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
this.getControls = function () {
return controls;
};
this.setControls = function (newControls) {
controls = newControls == 'yes' ? 'controls' : '';
return this;
};
this.getSrc = function () {
var transSrc = transDictionary().translate(src);
return transSrc;
};
this.setSrc = function (newSrc) {
var filename = util().getFileName(transDictionary().translate(newSrc), true);
if (filename == 'inlineData') src = '';
else src = newSrc;
return this;
};
this.getAltSrc = function () {
var transAltSrc = transDictionary().translate(altSrc);
return transAltSrc;
};
this.setAltSrc = function (newAltSrc) {
var filename = util().getFileName(transDictionary().translate(newAltSrc), true);
if (filename == 'inlineData') altSrc = '';
else altSrc = newAltSrc;
return this;
};
this.getAltSrcType = function () {
return altSrcType;
};
this.setAltSrcType = function (newAltSrcType) {
altSrcType = newAltSrcType;
return this;
};
this.setAltText = function (newAltText) {
altText = newAltText;
return this;
};
this.getAltText = function () {
return altText;
};
this.setInteractive = function (newInteractive) {
interactive = (newInteractive == "yes") ? true : false;
if (interactive) behavior = Simulator.Constants.INTERACTIVE_ANIMATION;
return this;
};
this.getInteractive = function () {
return interactive;
};
this.getBehavior = function () {
return behavior;
};
this.setBehavior = function (newBehavior) {
behavior = newBehavior;
if (behavior === Simulator.Constants.INTERACTIVE_ANIMATION) interaction = true;
return this;
};
this.setInlineDataID = function (newInlineDataID) {
inlineDataID = newInlineDataID;
return this;
};
this.getInlineDataID = function () {
return inlineDataID;
};
this.setAttributes = function (attr, node) {
if (node) attr = util().getAttributes(node);
Simulator.Animation.AnimationElement.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'controls':
this.setControls(attr[i]);
break;
case 'src':
this.setSrc(attr[i]);
break;
case 'altSrc':
this.setAltSrc(attr[i]);
break;
case 'altSrcType':
this.setAltSrcType(attr[i]);
break;
case 'altText':
this.setAltText(attr[i]);
break;
case 'behavior':
this.setBehavior(attr[i]);
break;
case "interactive":
this.setInteractive(attr[i]);
break;
default:
continue;
}
}
};
this.getSourceName = function () {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting ');
buff.push(this.getEname());
buff.push(': ');
buff.push(this.getName());
buff.push(sep);
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (embedded) return buff.join('');
else force == null ? debug(buff.join('')) : debugf(buff.join(''));
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Animation.AnimationElement.prototype = new Simulator.SimElement();
Simulator.Animation.AnimationElement.parent = Simulator.SimElement;
Simulator.Animation.AnimationElement.prototype.constructor = Simulator.Animation.AnimationElement;

/* SOURCE FILE: AnimationRenderer2.js (b613b00c) 9/9/2014 2:09:04 PM */

Simulator.Animation.AnimationRenderer = function (sim, thePanel, animationSet) {
Simulator.SimItem.call(this, sim);
var source = 'AnimationRenderer';
var prevImageID = null;
var elementInfomediaType = null;
var elementInfoid = null;
var elementInfosrc = null;
var ID_SEPARATOR = '!';
var currenAnimationName = null;
var currentAnimationElement = null;
var tries = 0;
var maxTries = 10;
var animationInterval = 500;
var panel = thePanel;
var simID = null;
var iFrameID = null;
if (sim) {
simID = sim.getSimID();
}
var util = function () { return sim.getUtils(); };
var dbg = function () { return sim.getDebug(); };
var whiteboard = function () { return sim.getWhiteboard(); };
var eventMgr = function () { return sim.getEventManager(); };
var simMgr = function () { return sim.getSimulationManager(); };
var layout = function () { return sim.getLayout(); };
var simDocument = function () { return sim.getSimDocument(); };
function doImageRendering(element, img, panelName, div, span, renderMaxTime) {
debug('In doImageRendering - Image = ' + img.src + ', height = ' + img.height + ', width = ' + img.width);
var dimensions = util().setDimensions(panel.getHeight(), panel.getWidth(), img.height, img.width, 10              );
if (dimensions.height > 0 && dimensions.width > 0) {
img.height = dimensions.height;
img.width = dimensions.width;
debug('In doImageRendering - Image resize with padding to height = ' + img.height + ', width = ' + img.width);
}
span.appendChild(img);
elementInfomediaType = 'image';
elementInfoid = div.id;
elementInfosrc = img.src;
if (!renderMaxTime) remderMaxTime = 0;
if (renderMaxTime >= 0) setTimeout(function () { handleTimeout(element); }, renderMaxTime);
}
function handleTimeout(renderedElement) {
var anEvent = null;
if (renderedElement != undefined && renderedElement != null) {
var thread = animationSet.getCurrentThread();
if (thread != null && thread != undefined) {
var element = thread.renderNextThreadElement();
if (element == null) {
anEvent = new Simulator.Event(renderedElement, "info", "animationThreadFinished");
eventMgr().postEvent(anEvent);
}
}
else {
anEvent = new Simulator.Event(renderedElement, "info", "animationThreadFinished");
eventMgr().postEvent(anEvent);
}
}
else
dbg().logFatalError(source, "renderedElement is null in AnimationRenderer.handleTimeout");
};
function flashEmbedSuccessCallback(event) {
if (!event.success) {
animationSet.setCurrentAnimation(null);
dbg().logFatalError(source, 'Could not embed flash element ' + event.id);
} else {
animationSet.setCurrentAnimation(simDocument().getElementById(event.ref.id));
eventMgr().postEvent(new Simulator.Event(animationSet, 'info', 'animationEmbedded', event.ref));
sendDataToAnimationElement(false);
}
}
function sendDataToAnimationElement(element, update) {
var t = null;
var foundSource = false;
var interactive = false;
var data = '';
element = (!element) ? currentAnimationElement : element;
debug('In sendDataToAnimationElement - element = ' + element.getName());
if (util().elementInArray(animationSet.getInputSource(), 'evaluator')) {
data = whiteboard().getItem('evaluationOutput', 'output');
if (data == null || data == '') data = '';
else foundSource = true;
}
if (util().elementInArray(animationSet.getInputSource(), 'animation')) {
var animationData = whiteboard().getCategoryAsString('animationInput');
foundSource = true;
if (animationData != '' && animationData != null) {
if (data != '' && data != null) data += Simulator.Constants.PAIR_DELIMITTER + animationData;
else data = animationData;
}
}
if (foundSource == false) {
dbg().logFatalError(source, 'Unknown input source ' + animationSet.getInputSource() + ' in sendDataToAnimationElement. No data sent to animation element');
return;
}
if (tries == 0) util().markTime();
var movie = animationSet.getCurrentAnimation();
if (movie) {
if (!movie.animationInput) {
t = setTimeout(function () { sendDataToAnimationElement(element, false); }, animationInterval);
tries++;
if (tries > maxTries) {
clearTimeout(t);
tries = 0;
dbg().logFatalError(source, 'Could not establish interface with animation element ' + currenAnimationName + ' after ' + tries
+ ' attempts spanning ' + util().getElapsedTime() + ' ms');
}
return;
}
else {
clearTimeout(t);
tries = 0;
var simID = sim.getSimID();
if (element.getInteractive) interactive = element.getInteractive();
if (movie.animationInitialize) movie.animationInitialize(simID, interactive);
if (!update) {
if ((data != null) && (data != '')) {
movie.animationInput(simID, 'input', data);
debugf('Sending "' + data + '" to animation "' + currenAnimationName + '"');
}
else {
movie.animationInput(simID, 'input', 'input');
debugf('Sending "input" to animation "' + currenAnimationName + '"');
}
debugf('Sending "play" to current animation after ' + util().getElapsedTime() + ' ms');
eventMgr().postEvent(new Simulator.Event(animationSet, 'info', 'animationStarted'));
movie.animationInput(simID, 'command', 'play');
}
else {
if (movie.animationInput) {
debugf('Sending "update" to animation "' + currenAnimationName + '" with data: "' + data + '" after ' + util().getElapsedTime() + ' ms');
eventMgr().postEvent(new Simulator.Event(animationSet, 'info', 'animationStarted'));
if ((data != null) && (data != '')) movie.animationInput(simID, 'update', data);
else movie.animationInput(simID, 'update', 'input');
}
else dbg().logFatalError(source, 'Could not re-establish previously established interface with animation element ' + currenAnimationName);
}
}
}
}
function removeFlash(flashObj) {
swfobject.removeSWF(flashObj);
animationSet.setCurrentAnimation(null);
}
function formatAnimationInput(data) {
}
this.sendDataToAnimation = function (element) {
sendDataToAnimationElement(element, false);
};
this.renderImage = function (element, panelName, imageSrc, currentElementName, renderMaxTime, thread) {
var img = null;
var span = null;
var HTMLAnimation = null;
var HTMLPanel = panel.getHTMLElement();
span = simDocument().getElementById('holdingSpan' + simID);
if (span)
HTMLAnimation = span.getElementsByTagName('img')[0];
if (!HTMLAnimation)
HTMLAnimation = simDocument().getElementById(prevImageID);
if (HTMLAnimation) {
HTMLAnimation.src = imageSrc;
HTMLAnimation.id = element.getName();
if (!renderMaxTime) remderMaxTime = 0;
if (renderMaxTime >= 0) setTimeout(function () { handleTimeout(element); }, renderMaxTime);
}
else {
var div = simDocument().getElementById('holderAnimation' + simID);
if (div && div.media != 'imageAnimation') {
var parent = div.parentNode;
if (parent.id == 'outerDiv')
HTMLPanel.removeChild(parent);
else
HTMLPanel.removeChild(div);
}
div = simDocument().createElement('div');
div.id = 'holderAnimation' + simID;
div.elementName = currentElementName;
div.setAttribute('class', 'holderAnimation');
div.media = 'imageAnimation';
HTMLPanel.appendChild(div);
span = simDocument().createElement('span');
span.setAttribute('class', 'holderCell');
span.id = 'holdingSpan' + simID;
div.appendChild(span);
img = simDocument().createElement('img');
img.id = currentElementName;
prevImageID = img.id;
var imageLoaded = false, wait;
util().bindEvent(img, 'load', function () { imageLoaded = true; });
img.src = imageSrc;
wait = setInterval(function () {
if (imageLoaded) {
clearInterval(wait);
eventMgr().postEvent(new Simulator.Event(element, 'info', 'imageEmbedded', img));
eventMgr().postEvent(new Simulator.Event(element, "info", "allMediaLoaded"));
doImageRendering(element, img, panelName, div, span, renderMaxTime);
}
}, 1);
}
};
this.renderAnimation = function (element, panelName, animationSrc, animationName, animationControls, currentElementName, renderMaxTime, thread) {
var holderDiv = null;
var hsize = panel.getHeight();
var wsize = panel.getWidth();
var HTMLPanel = panel.getHTMLElement();
var result = null;
var initialRender = false;
if (elementInfomediaType != 'animation' || elementInfosrc != animationSrc) {
holderDiv = simDocument().getElementById('holderAnimation' + simID);
if (holderDiv && holderDiv.media != 'animation') {
var parent = holderDiv.parentNode;
if (parent.id == 'outerDiv') HTMLPanel.removeChild(parent);
else HTMLPanel.removeChild(holderDiv);
initialRender = true;
}
holderDiv = simDocument().createElement('div');
holderDiv.id = 'holderAnimation' + simID;
holderDiv.name = 'holderAnimation' + simID;
holderDiv.elementName = animationName;
holderDiv.setAttribute('class', 'holderAnimation');
HTMLPanel.appendChild(holderDiv);
elementInfomediaType = 'animation';
elementInfoid = holderDiv.id;
initialRender = true;
} else holderDiv = simDocument().getElementById('holderAnimation' + simID);
elementInfosrc = animationSrc;
currentAnimationElement = element;
if(sim.getAccessibilityIFActive()) {
var altText = element.getAltText();
var altTextSpan = simDocument().createElement('span');
altTextSpan.style.position='absolute';
altTextSpan.style.top = '50%';
holderDiv.style.verticalAlign='middle';
holderDiv.style.horizontalAlign='center';
altTextSpan.style.fontSize = 'xx-large';
altTextSpan.innerHTML = altText;
holderDiv.innerHTML = '';
holderDiv.appendChild(altTextSpan);
debug('renderAnimation simulating time of animation execution since accessibilityIF is true');
setTimeout(simulateAnimationExecutionTime, 5000);
return;
}
if (!iFrameID) iFrameID = this.createItemID(true, -1, 'html5iFrame');
var iFrame = simDocument().getElementById(iFrameID);
if (!iFrame) {
iFrame = simDocument().createElement('iframe');
iFrame.id = iFrameID;
iFrame.width = wsize - 5;
iFrame.height = hsize - 5;
debug('iFrame.height = ' + iFrame.height + ', iFrame.width = ' + iFrame.width);
iFrame.border = 0;
iFrame.scrolling = 'no';
iFrame.src = appendExternalScriptURLParameter(animationSrc, sim.getAnimationExternalScriptsPath());
iFrame.setAttribute('style', 'height:' + iFrame.height + 'px !important');
iFrame.setAttribute('class', 'centeredAnimation');
if (initialRender) holderDiv.appendChild(iFrame);
iFrame.onload = function () {
debug("iFrame is loaded");
createHTML5AnimationInterface(element, iFrame, animationName);
};
}
else {
if (renderMaxTime != undefined && renderMaxTime != null && renderMaxTime >= 0) {
setTimeout(function () { handleTimeout(element); }, renderMaxTime);
}
sendDataToAnimationElement();
}
};
function appendExternalScriptURLParameter(animationUrl, scriptUrl) {
if (scriptUrl)
scriptUrl = encodeURIComponent(scriptUrl);
if (animationUrl) {
if (animationUrl.indexOf('?') != -1)
animationUrl = animationUrl.replace('?', '?scriptUrl=' + scriptUrl + '&');
else
animationUrl = animationUrl + '?scriptUrl=' + scriptUrl;
}
return animationUrl;
}
function createHTML5AnimationInterface(element, iFrame, animationName, renderMaxTime) {
var html5Shell = new Simulator.Animation.HTML5Shell(sim, simID);
if (!html5Shell) {
dbg().logFatalError(source, 'Could not instantiate HTML5Shell');
} else {
var parameters = {
callback: animationSet.animationMediaOutput,
behavior: element.getBehavior(),
inlineData: null,
containerID: iFrame.id,
outputOnReq: animationSet.getOutputOnRequest()
};
animationSet.setCurrentAnimation(html5Shell);
result = html5Shell.initialize(simID, parameters);
if (result !== Simulator.Constants.ANIMATION_LOADED) dbg().logFatalError(source, 'Could not initialize HTML5Shell');
currenAnimationName = animationName;
}
if (renderMaxTime != undefined && renderMaxTime != null && renderMaxTime >= 0) {
setTimeout(function () { handleTimeout(element); }, renderMaxTime);
}
sendDataToAnimationElement(element, false);
};
this.renderHotText = function (element, panelName, animationSrc, animationName, animationControls, currentElementName, renderMaxTime, thread) {
var HTMLPanel = panel.getHTMLElement();
var holderDiv = null;
var hsize = panel.getHeight();
var wsize = panel.getWidth();
if (elementInfomediaType != 'hotText' || elementInfosrc != animationSrc) {
holderDiv = simDocument().getElementById('holderAnimation' + simID);
if (holderDiv && holderDiv.media != 'hotText') {
var parent = holderDiv.parentNode;
if (parent.id == 'outerDiv') HTMLPanel.removeChild(parent);
else HTMLPanel.removeChild(holderDiv);
}
holderDiv = simDocument().createElement('div');
holderDiv.id = 'holderAnimation' + simID;
holderDiv.style.textAlign = 'left';
holderDiv.name = 'holderAnimation' + simID;
holderDiv.elementName = animationName;
holderDiv.setAttribute('class', 'holderAnimation');
var contentDiv = simDocument().createElement('div');
contentDiv.id = 'hotTextContentDiv';
contentDiv.style.textAlign = 'left';
contentDiv.style.padding = '0px';
holderDiv.appendChild(contentDiv);
HTMLPanel.appendChild(holderDiv);
elementInfomediaType = 'animation';
elementInfoid = holderDiv.id;
}
elementInfosrc = animationSrc;
contentDiv.innerHTML = animationSrc;
if (renderMaxTime != undefined && renderMaxTime != null && renderMaxTime >= 0) {
setTimeout(function () { handleTimeout(element); }, renderMaxTime);
}
currenAnimationName = animationName;
var hotText = new Simulator.Animation.HotTextShell(sim);
animationSet.setCurrentAnimation(hotText);
debug('AnimationSet.CurrentAnimation = ' + animationSet.getCurrentAnimation());
debug('Initializing the HotTextShell: inlinDataID = ' + element.getInlineDataID() + ', holderDiv.id = ' + holderDiv.id + ', outputOnRequest = ' + animationSet.getOutputOnRequest());
var parameters = {
callback: animationSet.animationMediaOutput,
inlineDataID: element.getInlineDataID(),
containerID: holderDiv.id,
behavior: element.getBehavior(),
outputOnReq: animationSet.getOutputOnRequest()
};
hotText.initialize(simID, parameters);
sendDataToAnimationElement(element, false);
};
this.resizeAnimationElements = function (panel, zoom) {
var HTMLPanel = panel.getHTMLElement();
if (zoom) {
var flashObjectArray = HTMLPanel.getElementsByTagName('object');
if (flashObjectArray && flashObjectArray.length == 1) {
var flashObj = flashObjectArray[0];
flashObj.animationResize(parseInt(flashObj.style.width), parseInt(flashObj.style.height));
}
}
else {
var hsize = panel.getHeight();
var wsize = panel.getWidth();
var flashObjectArray = HTMLPanel.getElementsByTagName('object');
if (flashObjectArray && flashObjectArray.length == 1) {
var flashObj = flashObjectArray[0];
var dimensions = util().setDimensions(hsize, wsize, parseInt(panel.getOriginalHeight()), parseInt(panel.getOriginalWidth()), 10              );
if (dimensions.height > 0 && dimensions.width > 0) {
hsize = dimensions.height;
wsize = dimensions.width;
}
flashObj.width = wsize;
flashObj.height = hsize;
flashObj.setAttribute('originalwidth', wsize);
flashObj.setAttribute('originalheight', hsize);
flashObj.style.width = wsize + 'px';
flashObj.style.height = hsize + 'px';
flashObj.animationResize(wsize, hsize);
}
var imgArray = HTMLPanel.getElementsByTagName('img');
if (imgArray && imgArray.length == 1) {
var image = imgArray[0];
debug('Image height = ' + image.height + ', width = ' + image.width);
var dimensions = util().setDimensions(hsize, wsize, image.height, image.width, 10              );
if (dimensions.height > 0 && dimensions.width > 0) {
image.height = dimensions.height;
image.width = dimensions.width;
debug('Image resize with padding to height = ' + image.height + ', width = ' + image.width);
}
}
}
};
this.renderFlash = function (element, panelName, flashSrc, flashName, flashControls, currentElementName, renderMaxTime, thread) {
var HTMLPanel = panel.getHTMLElement();
if (elementInfomediaType != 'flash' || elementInfosrc != flashSrc) {
var expressFlashInstall = false;
var animationSet = thread.getAnimationSet();
var flashvars = {
simID: simID,
simURL: escape(flashSrc),
simCallback: (window.document == simDocument()) ? Simulator.Constants.SIM_CALLBACK : 'window.parent.' + Simulator.Constants.SIM_CALLBACK,
simBehavior: element.getBehavior()
};
debug("flashvars.simBehavior = " + flashvars.simBehavior);
var params = {
wmode: 'opaque',
allowscriptaccess: 'always',
swliveconnect: 'true'
};
var attributes = {};
attributes.name = flashName;
attributes.media = 'flashAnimation';
attributes.styleclass = 'centeredAnimation';
var flashVersion = '9';
var hsize, wsize;
if ((panel.getOriginalHeight() == null) || (panel.getOriginalHeight() <= 0)) {
hsize = panel.getHeight() - 10;
} else {
hsize = panel.getOriginalHeight() - 10;
}
if ((panel.getOriginalWidth() == null) || (panel.getOriginalWidth() <= 0)) {
wsize = panel.getWidth() - 10;
} else {
wsize = panel.getOriginalWidth() - 10;
}
var holderDiv = simDocument().getElementById('holderAnimation' + simID);
if (holderDiv && holderDiv.media != 'flashAnimation') {
var parent = holderDiv.parentNode;
if (parent.id == 'outerDiv') HTMLPanel.removeChild(parent);
else HTMLPanel.removeChild(holderDiv);
}
holderDiv = simDocument().createElement('div');
holderDiv.id = 'holderAnimation' + simID;
holderDiv.name = 'holderAnimation' + simID;
holderDiv.elementName = flashName;
holderDiv.setAttribute('class', 'holderAnimation');
holderDiv.innerHTML = '<h1>Alternative content</h1>';
HTMLPanel.appendChild(holderDiv);
if(sim.getAccessibilityIFActive()) {
var altText = element.getAltText();
var altTextSpan = simDocument().createElement('span');
altTextSpan.style.position='absolute';
altTextSpan.style.top = '50%';
holderDiv.style.verticalAlign='middle';
holderDiv.style.horizontalAlign='center';
altTextSpan.style.fontSize = 'xx-large';
altTextSpan.innerHTML = altText;
holderDiv.innerHTML = '';
holderDiv.appendChild(altTextSpan);
debug('renderFlash simulating time of animation execution since accessibilityIF is true');
setTimeout(simulateAnimationExecutionTime, 5000);
return;
}
elementInfomediaType = 'flash';
elementInfoid = holderDiv.id;
elementInfosrc = flashSrc;
currentAnimationElement = element;
currenAnimationName = flashName;
swfobject.switchOffAutoHideShow();
swfobject.embedSWF(sim.getAnimationShellPath(), holderDiv.id, wsize, hsize, flashVersion, expressFlashInstall, flashvars, params, attributes, simDocument(), flashEmbedSuccessCallback);
if (renderMaxTime != undefined && renderMaxTime != null && renderMaxTime >= 0) {
setTimeout(function () { handleTimeout(element); }, renderMaxTime);
}
}
else
sendDataToAnimationElement(element, false);
};
this.renderVideo = function (element, panelName, videoSrc, currentElementName, renderMaxTime, thread) {
var HTMLAnimation = simDocument().getElementById(currentElementName);
var vid = simDocument().createElement('video');
vid.setAttribute('type', 'application/x-shockwave-flash');
vid.setAttribute('width', panel.getWidth(true) - 2);
vid.controls = 'true';
vid.setAttribute('src', videoSrc);
vid.object = simDocument().createElement('object');
vid.object.data = 'flvplayer.swf';
vid.object.media = 'videoAnimation';
vid.object.type = 'application/x-shockwave-flash';
vid.object.param = simDocument().createElement('param');
vid.object.param.value = 'flvplayer.swf';
vid.object.param.name = 'movie';
var div = simDocument().createElement('div');
div.setAttribute('class', 'holderAnimation');
var span = simDocument().createElement('span');
span.appendChild(vid);
div.appendChild(span);
panel.replaceChild(div, HTMLAnimation);
};
function simulateAnimationExecutionTime(renderer) {
debug('Posting animationThreadFinished event since accessibilityIF is true');
eventMgr().postEvent(new Simulator.Event(this, 'info', 'animationThreadFinished'));
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Animation.AnimationRenderer.prototype = new Simulator.SimItem();
Simulator.Animation.AnimationRenderer.prototype.constructor = Simulator.Animation.AnimationRenderer;

/* SOURCE FILE: HTML5Shell.js (dee9b115) 9/9/2014 2:09:04 PM */

Simulator.Animation.HTML5Shell = function(sim, theSimID) {
var source = 'HTML5Shell';
var simURL = null;
var iFrameID = null;
var iFrame = null;
var behavior = null;
var simCallback = null;
var simHeight = null;
var simWidth = null;
var simID = theSimID;
var outputOnReq = null;
var maxSRTimeouts = 2;
var statusReqTimer = null;
var statusReturnTimer = null;
var statusReportInterval = 10 * 1000;
var statusReturnInterval = 1 * 1000;
var animationFinishedDelay = 1000;
var dbg = function() {
return sim.getDebug();
};
var utils = function() {
return sim.getUtils();
};
var simDocument = function() {
return sim.getSimDocument();
};
this.initialize = function(theSimID, parameters) {
if (!simIDIsValid(theSimID)) {
dbg().logError(source,
'initialize message with simID = ' + simulationID
+ ' sent to HTML5Shell with simID = ' + simID);
return Simulator.Constants.FAILURE;
} else {
iFrameID = parameters.containerID;
iFrame = simDocument().getElementById(iFrameID);
if (!iFrame) {
dbg().logError(source, 'Could not get iFrame from id ' + iframeID);
return Simulator.Constants.FAILURE;
} else {
simURL = iFrame.src;
behavior = parameters.behavior;
simWidth = iFrame.width;
simHeight = iFrame.height;
simCallback = parameters.callback;
outputOnReq = parameters.outputOnReq;
debug('In initialize');
simWidth1 = simWidth;
if (simID === "" && simURL === "") {
dbg().logError(source, "Simulation does not exist");
return Simulator.Constants.FAILURE;
} else {
var animationParams = {
behavior : behavior,
callback : this.fromAnimationInterface,
simHeight: simHeight,
simWidth: simWidth
};
debug('animationParams.behavior = '+ animationParams.behavior);
debug('animationParams.simHeight = '+ animationParams.simHeight);
debug('animationParams.simWidth = '+ animationParams.simWidth);
debug('Calling init in the animation interface');
var status = iFrame.contentWindow.init(this, animationParams);
if (status === Simulator.Constants.SUCCESS) {
debug('Received SUCCESS from init function in animation. Link with HTML Animation established');
status = Simulator.Constants.ANIMATION_LOADED;
if (behavior !== Simulator.Constants.INTERACTIVE_ANIMATION) startStatusTimer();
} else {
dbg().logFatalError(source,
'animation interface returned failure. Link with HTML Animation NOT established');
return Simulator.Constants.FAILURE;
}
}
return Simulator.Constants.ANIMATION_LOADED;
}
}
};
this.fromAnimationInterface = function(type, data) {
debug("HTML5Shell.fromAnimationInterface(), type = " + type);
var formattedOutput = null;
resetStatusTimer();
switch (type) {
case Simulator.Constants.ANIMATION_PROPERTIES:
formattedOutput = formatOutput(data);
sendOutputToSimulator(type, formattedOutput);
break;
case Simulator.Constants.ANIMATION_REPORTING:
if(data === Simulator.Constants.ANIMATION_ALIVE) debug('Received "I am alive" message from animation at ' + utils().getElapsedTime());
else debug('Received "' + data + '" message from animation at ' + utils().getElapsedTime());
break;
case Simulator.Constants.PARAM_OUTPUT:
formattedOutput = formatOutput(data);
sendOutputToSimulator(type, formattedOutput);
break;
case Simulator.Constants.PARAM_ERROR:
case Simulator.Constants.PARAM_INFO:
if ((data === Simulator.Constants.ANIMATION_FINISHED) && (behavior != Simulator.Constants.INTERACTIVE_ANIMATION)) {
processCommand(simID, Simulator.Constants.OUTPUT_REQ_CMD);
}
sendOutputToSimulator(type, data);
break;
default:
debug("ERROR - Unrecognized type, '" + type + "' of messsage received from animationInterface.");
}
};
this.animationInput = function(simulationID, type, input) {
debug("HTML5Shell.animationInput(): type = " + type + ", input = "
+ input);
var inputs = null;
if (!simIDIsValid(theSimID)) {
return Simulator.Constants.FAILURE;
} else {
debug("Received message from simulator: simID = " + simID
+ ", type = " + type + ", input = " + input);
switch (type) {
case Simulator.Constants.PARAM_COMMAND:
processCommand(simulationID, input);
break;
case Simulator.Constants.PARAM_INFO:
break;
case Simulator.Constants.PARAM_INPUT:
if (input === null || input === "") {
debug("Inputs not provided");
sendInfo(Simulator.Constants.ANIMATION_UNABLE_TO_START);
} else {
inputs = parseInputs(input);
if (iFrame.contentWindow) {
iFrame.contentWindow.updateInputs(inputs);
}
}
break;
case Simulator.Constants.PARAM_UPDATE:
if (!checkID(simulationID)) {
dbg().logError(source, 'simID does not match!');
return;
} else if (input === null || input === "") {
debug("Inputs not provided");
sendInfo(Simulator.Constants.ANIMATION_UNABLE_TO_START);
} else {
inputs = parseInputs(input);
iFrame.contentWindow.updateInputs(inputs);
iFrame.contentWindow.playAnimation();
if (behavior === Simulator.Constants.INTERACTIVE_ANIMATION) {
setTimeout(function() {
sendInfo(Simulator.Constants.ANIMATION_FINISHED);
}, animationFinishedDelay);
}
startStatusTimer();
}
break;
default:
debug("Inputs not provided");
}
}
};
var processCommand = function(simulationID, cmd) {
debug("Received command from simulator: " + cmd);
switch (cmd) {
case Simulator.Constants.GET_ANIMATION_PROPERTIES:
var properties = iFrame.contentWindow.getProperties();
var output = formatOutput(properties);
sendOutputToSimulator(Simulator.Constants.ANIMATION_PROPERTIES, output);
break;
case Simulator.Constants.PLAY_CMD:
if (iFrame.contentWindow) {
iFrame.contentWindow.playAnimation();
if (behavior === Simulator.Constants.INTERACTIVE_ANIMATION) {
setTimeout(function () {
sendInfo(Simulator.Constants.ANIMATION_FINISHED);
}, animationFinishedDelay);
}
startStatusTimer();
}
break;
case Simulator.Constants.STOP_CMD:
break;
case Simulator.Constants.REWIND_CMD:
rewind();
break;
case Simulator.Constants.SET_ID_CMD:
this.simID = simulationID;
break;
case Simulator.Constants.RESTART_CMD:
reStart();
break;
case Simulator.Constants.OUTPUT_REQ_CMD:
var outputs = iFrame.contentWindow.getOutputs();
debug("HTML5Shell.processCommand() with Simulator.Constants.OUTPUT_REQ_CMD, outputs = "
+ outputs);
var data = formatOutput(outputs);
debug("Received data from formatOutput: " + data);
sendOutputToSimulator(Simulator.Constants.PARAM_OUTPUT, data);
break;
case Simulator.Constants.ANIMATION_REPORT_STATUS:
sendStatusRequest();
break;
default:
dbg().logError(source, "Unknown command passed to animation");
}
};
var parseInputs = function(input) {
console.log("parseInputs(): " + input);
inputArray = [];
input = removeBrackets(input);
input = removeSemi(input);
var elements = input.split(Simulator.Constants.ITERATION_DELIMITTER);
for ( var j = 0; j < elements.length; j++) {
var pairs = String(elements[j]).split(
Simulator.Constants.PAIR_DELIMITTER);
for ( var i = 0; i < pairs.length; i++) {
parts = String(pairs[i]).split(
Simulator.Constants.KEY_VALUE_DELIMITTER);
parts[Simulator.Constants.INPUT_NAME_PART] = removeQuotes(String(
parts[Simulator.Constants.INPUT_NAME_PART]).trim());
parts[Simulator.Constants.INPUT_VALUE_PART] = removeQuotes(String(
parts[Simulator.Constants.INPUT_VALUE_PART]).trim());
var values = String(parts[Simulator.Constants.INPUT_VALUE_PART])
.split(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER);
parts[Simulator.Constants.INPUT_VALUE_PART] = values;
debug("Input #" + (j + 1) + ", '"
+ parts[Simulator.Constants.INPUT_NAME_PART] + "' = "
+ parts[Simulator.Constants.INPUT_VALUE_PART] + ";");
inputArray[parts[Simulator.Constants.INPUT_NAME_PART]] = parts[Simulator.Constants.INPUT_VALUE_PART];
}
}
return inputArray;
};
var rewind = function() {
iFrame.contentWindow.gotoAndStop(Simulator.Constants.START_FRAME);
};
var reStart = function() {
iFrame.contentWindow.gotoAndStop(Simulator.Constants.START_FRAME);
iFrame.contentWindow.playAnimation();
};
var formatOutput = function(dataArray) {
var str = "";
for (key in dataArray) {
if (str)
str += Simulator.Constants.PAIR_DELIMITTER;
str += key + Simulator.Constants.KEY_VALUE_DELIMITTER + dataArray[key];
}
return str;
};
var sendOutput = function() {
var data = formatOutput();
sendOutputToSimulator(Simulator.Constants.PARAM_OUTPUT, data);
};
var sendInfo = function(info) {
sendOutputToSimulator(Simulator.Constants.PARAM_INFO, info);
};
var sendError = function(info) {
sendOutputToSimulator(Simulator.Constants.PARAM_ERROR, info);
};
var sendOutputToSimulator = function(type, output) {
debug("Sending simulator " + type + " message with data =  " + output.toString());
simCallback(this.simID, type, output);
};
var simIDIsValid = function(simulationID) {
if (simID === simulationID)
return true;
else
return false;
};
var removeBrackets = function(str) {
var rex = /[\[\]]*/gim;
return str.replace(rex, '');
};
var removeSemi = function(str) {
var rex = /[;]$/im;
return str.replace(rex, '');
};
var removeQuotes = function(str) {
var rex = /["]*/gim;
return str.replace(rex, '');
};
var startStatusTimer = function() {
if (statusReqTimer)
clearTimeout(statusReqTimer);
statusReqTimer = setTimeout(sendStatusRequest, statusReportInterval);
utils().markTime();
if (!statusReqTimer) dbg().logError(source,
'Could not start statusReqTimer. No "alive" messages will be sent to the animation.');
};
var resetStatusTimer = function() {
debug('Status timers reset at ' + utils().getElapsedTime());
if (statusReturnTimer)
clearTimeout(statusReturnTimer);
if (statusReqTimer)
clearTimeout(statusReqTimer);
startStatusTimer();
};
var sendStatusRequest = function() {
utils().markTime();
srTimeouts++;
statusReturnTimer = setTimeout(statusReportTimeout,
statusReturnInterval);
debug('Sending number ' + srTimeouts + ' status request to animation.');
if (iFrame.contentWindow) {
var result = iFrame.contentWindow.statusRequest();
if (result === Simulator.Constants.ANIMATION_ALIVE) {
resetStatusTimer();
}
}
};
var srTimeouts = 0;
statusReportTimeout = function() {
debug('Status report waiting period ' + srTimeouts + ' timed out at ' + utils().getElapsedTime());
if (srTimeouts === maxSRTimeouts) {
debug('Sending "animationUnresponsive" message to simulator');
sendOutputToSimulator(Simulator.Constants.PARAM_ERROR,
Simulator.Constants.ANIMATION_UNRESPONSIVE);
srTimeouts = 0;
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: HotTextShell2.js (eb5e34f2) 9/9/2014 2:09:04 PM */

Simulator.Animation.HotTextShell = function (sim) {
var interactions = [];
var dictionary = new Object();
var source = 'HotTextShell';
var inlineDataID = null;
var dbg = function () {
return sim.getDebug();
};
var utils = function () {
return sim.getUtils();
};
var simDocument = function () {
return sim.getSimDocument();
};
function generateOutputStr(simID) {
var output = '';
var semicolon = '\\0x1D\\'; //to separate iterations
var comma = '\\0x1E\\'; //to separate data groups
var colon = '\\0x1F\\'; //to separate a key and value in a key-value group
var formattedResponse = '';
var rawResponse = '';
var responseText = '';
var interactionType = '';
var itemId = inlineDataID;
var responseXMLString, interaction, returnString;
if (interactions.length > 0) {
for (var j = 0; j < interactions.length; j++) {
interaction = interactions[j];
rawResponse = interaction.getResponse();
if (interaction instanceof TDS.DDInteraction) {
if (interactionType)
interactionType += '|' + 'draggable';
else
interactionType += 'draggable';
}
else if (interaction instanceof TDS.SelectInteraction) {
if (interactionType)
interactionType += '|' + 'selectable';
else
interactionType += 'selectable';
var selectionChoices = interaction.getSelectedChoices();
var selectedChoicesLength = 0;
if (selectionChoices)
selectedChoicesLength = selectionChoices.length;
for (var i = 0; i < selectedChoicesLength; i++) {
if (i == 0) {
formattedResponse = selectionChoices[i].getIdentifier();
responseText = selectionChoices[i].getElement().innerHTML.replace(/<[^>]*>/gi, '').replace(/&.{4};/gi, '');
}
else {
formattedResponse += '|' + selectionChoices[i].getIdentifier();
responseText += '|' + selectionChoices[i].getElement().innerHTML.replace(/<[^>]*>/gi, '').replace(/&.{4};/gi, '');
}
}
}
}
var xml = [];
xml.push('<interactions>');
xml.push(rawResponse);
xml.push('</interactions>');
rawResponse = xml.join('');
output += 'itemId' + colon + inlineDataID + comma;
output += 'interactionType' + colon + interactionType + comma;
output += 'formattedResponse' + colon + formattedResponse + comma;
output += 'rawHTResponseRC' + colon + rawResponse + comma;
output += 'responseText' + colon + responseText;
}
return output;
}
this.initialize = function (simID, parameters) {
inlineDataID = parameters.inlineDataID;
var itemContainer = simDocument().getElementById(parameters.containerID);
var id_postfix = '-interaction-' + simID;
var ddInteraction = new TDS.DDInteraction('dd' + id_postfix);
ddInteraction.load(itemContainer);
if (ddInteraction.getDraggables().length > 0) {
interactions.push(ddInteraction);
}
var selectInteraction = new TDS.SelectInteraction('select' + id_postfix);
selectInteraction.load(itemContainer);
var numChoices = selectInteraction.getChoices().length;
if (numChoices > 0) {
interactions.push(selectInteraction);
if (!parameters.outputOnReq)
for (var i = 0; i < numChoices; i++) {
selectInteraction.getChoices()[i].subscribe('selectEvent', function () { sim.getAnimationSet().animationMediaOutput(simID, 'output', generateOutputStr(simID)) });
selectInteraction.getChoices()[i].subscribe('deselectEvent', function () { sim.getAnimationSet().animationMediaOutput(simID, 'output', generateOutputStr(simID)) });
}
}
if (interactions.length) {
sim.getAnimationSet().animationMediaOutput(simID, 'info', 'animationLoaded');
}
else {
sim.getAnimationSet().animationMediaOutput(simID, 'info', 'animationError');
}
}
this.animationInput = function (simID, type, content) {
if (type == 'command') {
switch (content) {
case 'outputRequest':
{
var output = generateOutputStr(simID);
sim.getAnimationSet().animationMediaOutput(simID, 'output', output);
break;
}
case 'play':
{
sim.getAnimationSet().animationMediaOutput(simID, 'info', 'animationStarted');
sim.getAnimationSet().animationMediaOutput(simID, 'info', 'animationFinished');
break;
}
default:
break;
}
}
}
this.animationIONames = function () {
return 'output' + Simulator.Constants.KEY_VALUE_DELIMITTER + 'itemId' + Simulator.Constants.MULTIPLE_VALUE_DELIMITTER + 'interactionType' + Simulator.Constants.MULTIPLE_VALUE_DELIMITTER + 'formattedResponse' + Simulator.Constants.MULTIPLE_VALUE_DELIMITTER + 'rawHTResponseRC' + Simulator.Constants.MULTIPLE_VALUE_DELIMITTER + 'responseText' + Simulator.Constants.PAIR_DELIMITTER;
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
}

/* SOURCE FILE: AnimationSet2.js (624b6f4f) 9/9/2014 2:09:04 PM */

Simulator.Animation.AnimationSet = function (sim, panel) {
Simulator.SimElement.call(this, sim);
this.setEname('AnimationSet');
var source = 'AnimationSet';
var instance = this;
var setElements = [];
var setThreads = [];
var poster = [];
var inputSource = [];
var outputs = [];
var outputOnRequest = false;
var prevInputs = [];
var currentInputs = [];
var lastThreadExecuted = null;
var currentThread = null;
var currentAnimation = null;
var currentAnimationState = [];
var scoreable = true;
var key = null;
var renderer = null;
var animationBehavior = 'timeBased';
var instance = this;
var animationLoaded = false;
var util = function () { return sim.getUtils(); };
var dbg = function () { return sim.getDebug(); };
var whiteboard = function () { return sim.getWhiteboard(); };
var eventMgr = function () { return sim.getEventManager(); };
var scoringTable = function () { return sim.getScoringTable(); };
var simMgr = function () { return sim.getSimulationManager(); };
var simDocument = function() { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
function registerEvents(instance) {
eventMgr().registerEvent(new Simulator.Event(instance, 'info', 'animationThreadFinished'));
eventMgr().registerEvent(new Simulator.Event(instance, 'info', 'animationFinished'));
eventMgr().registerEvent(new Simulator.Event(instance, 'info', 'animationStarted'));
eventMgr().registerEvent(new Simulator.Event(instance, 'info', 'animationError'));
}
this.getRenderer = function () {
return renderer;
};
this.getKey = function () {
return key;
};
this.getPrevInputs = function () {
return prevInputs;
};
var inputSource = [];
inputSource[0] = 'evaluator';
this.getInputSource = function () {
return inputSource;
};
this.setInputSource = function (newInputSource) {
var parts = [];
inputSource.splice(0, 1);
parts = newInputSource.split(',');
for (var i = 0; i < parts.length; i++) {
parts[i] = parts[i].trim();
if (parts[i] == "evaluator" || parts[i] == "animation") {
if (!util().elementInArray(inputSource, parts[i])) inputSource.push(parts[i]);
}
else dgb().logFatalError(source, 'Unknow input source "' + parts[i] + '" passed to AnimationSet.setInputSource');
}
};
this.getCurrentAnimation = function () {
return currentAnimation;
};
this.setCurrentAnimation = function (animation) {
currentAnimation = animation;
};
this.getCurrentInputs = function() {
return currentInputs;
};
this.getAnimationBehavior = function () {
return animationBehavior;
};
this.setAnimationBehavior = function (newBehavior) {
animationBehavior = newBehavior;
return this;
};
this.addAnimationElement = function (element) {
setElements.push(element);
return this;
};
this.getAnimationElement = function (id) {
for (var i = 0; i < setElements.length; i++) {
if (setElements[i].getName() == id)
return setElements[i];
}
return null;
};
this.addThread = function (aThread) {
setThreads.push(aThread);
};
this.getThreadFromName = function (name) {
for (var i = 0; i < setThreads.length; i++) {
if (setThreads[i].getName() == name) return setThreads[i];
}
return null;
};
this.getFirstAnimationThread = function() {
return setThreads[0];
};
this.getPosterName = function () {
return poster['name'] + sim.getSimID();
};
this.getPosterSrc = function () {
var translatedPosterSource = transDictionary().translate(poster['image']);
debug("Getting a poster image using AnimationSet2.js method: " + translatedPosterSource);
return translatedPosterSource;
};
this.getPosterShow = function () {
return poster['show'];
};
this.getInputSource = function () {
return inputSource;
};
this.setOutputs = function (newOutputs) {
outputs = newOutputs.split(",");
if(outputs == "inputs") scoringTable().cloneInputsForOutputs();
else if(scoreable) {
for(var i = 0; i < outputs.length; i++) {
if(outputs[i] != "none") scoringTable().addElement(outputs[i], "output");
}
}
};
this.getOutputs = function () {
return outputs;
};
this.setScoreable = function (newScoreable) {
scoreable = newScoreable == 'yes' ? true : false;
return this;
};
this.getScoreable = function () {
return scoreable;
};
this.setPoster = function (posterAttributes) {
for (var i = 0; i < posterAttributes.length; i++) {
if (posterAttributes[i].nodeName == 'image') {
poster[posterAttributes[i].nodeName] = posterAttributes[i].nodeValue;
}
else poster[posterAttributes[i].nodeName] = posterAttributes[i].nodeValue;
}
};
this.setOutputOnRequest = function (newOutputOnRequest) {
outputOnRequest = newOutputOnRequest == 'yes' ? true : false;
return this;
};
this.getOutputOnRequest = function () {
return outputOnRequest;
};
this.recordOutputs = function () {
var parts = [];
var data = whiteboard().getCategory('animationOutput')['output'];
if (data != null) {
data = data.split(Simulator.Constants.PAIR_DELIMITTER);
if (data != undefined && data != null && data != '') for (var i = 0; i < outputs.length; i++) {
if (outputs[i] == 'none') break;
else if (scoreable) {
for (var j = 0; j < data.length; j++) {
parts = data[j].split(Simulator.Constants.KEY_VALUE_DELIMITTER);
parts[0] = parts[0].trim();
if (parts[1]) parts[1] = parts[1].trim();
if (parts[0] == outputs[i]) scoringTable().setValue(parts[0], simMgr().getTrialNum() - 1, parts[1]);
}
}
}
}
};
this.selectThread = function (noStart) {
this.setCurrentThread(null);
for (var i = 0; i < setThreads.length; i++) {
if (setThreads[i].isSelected()) {
this.setCurrentThread(setThreads[i]);
if (!noStart) setThreads[i].startSimulation();
return true;
}
}
return false;
};
this.handleEvent = function (event) {
var newEvent = undefined;
switch (event.type) {
case 'info':
switch (event.context) {
case 'animationThreadFinished':
case 'animationFinished':
lastThreadExecuted = this.getCurrentThread();
if (poster['show'] == 'after' || poster['show'] == 'both') renderer.renderImage(this, 'animationPanel', this.getPosterSrc(), this.getPosterName(), -1, null);
break;
case 'animationStarted':
break;
case 'inputAvailable':
var result = this.storeInputs(true);
if (result != false) {
simMgr().setAnimationCompleteWithoutOutput(event.completeWithoutOutput);
this.sendDataToAnimation();
}
break;
case 'animationError':
dbg().logError(source, event.data);
break;
case 'outputAvailable':
if (!simMgr().trialLimitReached()) {
var result = this.storeInputs(true);
if (result != false) {
if (this.getCurrentThread() == null) {
this.selectThread();
} else {
var nextElement = this.getCurrentThread().renderNextThreadElement(false);
if (!nextElement) this.selectThread();
}
}
}
break;
default:
dbg().logFatalError(source, 'AnimationSet - Unknown command name: ' + event.context + ' received by ' + this.getName());
break;
}
break;
case 'command':
switch (event.context) {
case 'load':
if(!animationLoaded) {
if (poster['show'] == 'before' || poster['show'] == 'both')
renderer.renderImage(this, 'animationPanel', this.getPosterSrc(), this.getPosterName(), -1, null);
else if (util().assocArrayIsEmpty(poster)) eventMgr().postEvent(new Simulator.Event(instance, "info", "allMediaLoaded"));
animationLoaded = true;
}
break;
case 'startAnimation':
this.storeInputs(true);
if (this.getCurrentThread() == null) {
this.selectThread();
} else {
var nextElement = this.getCurrentThread().renderNextThreadElement(true);
if (nextElement) this.selectThread();
}
break;
case 'outputReq':
if (currentAnimation) {
currentAnimation.animationInput(sim.getSimID(), 'command', 'outputRequest');
}
break;
case 'startTrial':
if (!simMgr().trialLimitReached()) {
this.storeInputs(true);
simMgr().setAnimationCompleteWithoutOutput(event.completeWithoutOutput);
if (this.getCurrentThread() == null) {
this.selectThread();
} else {
var nextElement = this.getCurrentThread().renderNextThreadElement(false);
if (!nextElement) this.selectThread();
}
}
break;
default:
dbg().logFatalError(source, 'AnimationSet - Unknown command name: ' + event.context + ' received by ' + this.getName());
break;
}
break;
default:
dbg().logFatalError(source, 'AnimationSet ' + this.getName() + ': Unhandled event type received: ' + event.inspect());
return;
}
if (newEvent != undefined && newEvent != null) {
newEvent.postEvent();
}
};
this.sendDataToAnimation = function () {
debug('in sendDataToAnimation of AnimationSet');
var thread = this.getCurrentThread();
if (!thread) {
thread = lastThreadExecuted;
if (!thread) {
if (!this.selectThread()) dbg().logFatalError(source, 'Could not select a thread in sendDataToAnimation of AnimationSet.');
return;
} else return;
}
var element = thread.getCurrentElement();
if (!element) element = thread.getLastExecutedAnimationElement();
debug('In sendDataToAnimation - element = ' + (element === null) ? 'null' : element.getName());
if (element) {
renderer.sendDataToAnimation(element);
} else dbg().logFatalError(source, 'Could not find CurrentElement or LastExecutedAnimationElement in sendDataToAnimation of AnimationThread');
};
this.getSourceName = function() {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
if (!embedded)
buff.push('Inspecting AnimationSet');
buff.push(sep);
for (var i = 0; i < setElements.length; i++) {
buff.push('[');
buff.push(i);
buff.push('] = ');
buff.push(setElements[i].inspect(true));
buff.push(sep);
}
if (!embedded)
buff.push('End of AnimationSet inspection');
buff.push(sep);
if (!embedded) (force == null) ? debug(buff.join('')) : debugf(buff.join(''));
else return buff.join('');
};
this.getCurrentAnimationState = function () {
if (lastThreadExecuted) {
currentAnimationState['lastThreadExecutedName'] = lastThreadExecuted.getName();
currentAnimationState['currentThreadElementIndex'] = lastThreadExecuted.getCurrentThreadElementIndex();
currentAnimationState['animationInputs'] = currentInputs.join(',');
currentAnimationState['animationOutputs'] = this.getOutputs().join(',');
return currentAnimationState;
} else return [];
};
this.setCurrentAnimationState = function (stateArray) {
lastThreadExecuted = this.getThreadFromName(stateArray['lastThreadExecutedName']);
lastThreadExecuted.setCurrentThreadElementIndex(stateArray['currentThreadElementIndex']);
var parts = stateArray['animationInputs'].split(',');
for (var p in parts) currentInputs[p] = parts[p];
this.setOutputs(stateArray['animationOutputs']);
if (simMgr().getRestoreAnimationOnReload()) lastThreadExecuted.startSimulation();
};
this.storeInputs = function (backupInputs) {
var inputs = whiteboard().getCategory('animationInput');
if (inputs != null) {
if (Object.size(inputs) > 0) {
if (backupInputs) this.setPrevInputs();
for (var s in inputs) {
currentInputs[s] = inputs[s];
}
}
}
};
this.setPrevInputs = function () {
for (var p in currentInputs) {
prevInputs[p] = currentInputs[p];
}
};
this.setCurrentThread = function (thread) {
lastThreadExecuted = currentThread;
currentThread = thread;
if (currentThread !== null) {
debug('In setCurrentThread - currentThread = "' + currentThread.getName() + '", so setting currentElement to null');
currentThread.setCurrentElement(null);
} else dbg().logWarning(source, 'In setCurrentThread - currentThread = null');
};
this.getCurrentThread = function (thread) {
return currentThread;
};
function renderNextElement(instance) {
var anEvent = null;
if (currentThread != null && currentThread != undefined) {
var element = currentThread.renderNextThreadElement();
if (element == null) {
anEvent = new Simulator.Event(instance, "info", "animationThreadFinished");
eventMgr().postEvent(anEvent);
}
} else {
anEvent = new Simulator.Event(instance, "info", "animationThreadFinished");
eventMgr().postEvent(anEvent);
}
}
this.animationMediaOutput = function (theSimID, type, data) {
if (sim.getSimID() != theSimID) {
dbg().logWarning(source, 'SimID from animation: ' + theSimID + ' does not match this simulator\'s ID: ' + sim.getSimID());
}
var set = null;
if (type != 'debug' && type != Simulator.Constants.PARAM_DEBUG_OUTPUT)
debug('Received ' + type + ' output from the animation with data "' + data + '"');
switch (type) {
case 'info':
switch (data) {
case Simulator.Constants.ANIMATION_THREAD_FINISHED:
case Simulator.Constants.ANIMATION_FINISHED:
var currentElement = currentThread.getCurrentElement();
debug('In animationMediaOutput - currentElement = ' + ((currentElement === null) ? 'null' : currentElement.getName()));
if(currentElement.getBehavior() != Simulator.Constants.INTERACTIVE_ANIMATION) {
if (instance.getOutputs() != '') instance.recordOutputs();
}
renderNextElement(instance);
break;
case Simulator.Constants.ANIMATION_STARTED:
break;
case Simulator.Constants.ANIMATION_ABORTED:
case Simulator.Constants.ANIMATION_UNABLE_TO_START:
case 'newTrial':
eventMgr().postEvent(new Simulator.Event(set, 'command', 'newTrial'));
break;
default:
}
break;
case Simulator.Constants.PARAM_OUTPUT:
case Simulator.Constants.PARAM_DATA:
whiteboard().setItem('animationOutput', 'output', data, key);
instance.recordOutputs();
eventMgr().postEvent(new Simulator.Event(instance, 'info', 'animationOutputAvailable'));
break;
case Simulator.Constants.PARAM_DEBUG_OUTPUT:
break;
case Simulator.Constants.ANIMATION_ERROR:
eventMgr().postEvent(new Simulator.Event(set, 'animationError', data));
break;
default:
}
};
this.setAttributes = function (attr, node) {
var attr = util().getAttributes(node);
Simulator.Animation.AnimationSet.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'poster':
this.setPoster(attr[i]);
break;
case 'scoreable':
this.setScoreable(attr[i]);
break;
case 'outputs':
this.setOutputs(attr[i]);
break;
case 'inputSource':
this.setInputSource(attr[i]);
break;
case 'outputOnRequest':
this.setOutputOnRequest(attr[i]);
break;
}
}
};
if (sim) {
key = whiteboard().addItem('animationOutput', 'output');
inputSource[0] = 'evaluator';
registerEvents(instance);
renderer = new Simulator.Animation.AnimationRenderer(sim, panel, this);
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Animation.AnimationSet.prototype = new Simulator.SimElement();
Simulator.Animation.AnimationSet.parent = Simulator.Simulator;
Simulator.Animation.AnimationSet.prototype.constructor = Simulator.Animation.AnimationSet;

/* SOURCE FILE: AnimationThread2.js (7e76a405) 9/9/2014 2:09:04 PM */

Simulator.Animation.AnimationThread = function (sim, panel, section, animationSet) {
Simulator.SimElement.call(this);
var source = 'AnimationThread';
var theSet = animationSet;
var threadElements = [];
var currentThreadElementIndex = 0;
var selectionCriteria = [];
var requiresInput = 'no';
var currentElement = null;
var currentThread = null;
var lastExecutedAnimationElement = null;
this.setEname(source);
if (animationSet)
animationSet.addThread(this);
var util = function () { return sim.getUtils(); };
var dbg = function () { return sim.getDebug(); };
var eventMgr = function () { return sim.getEventManager(); };
var renderer = function () { return animationSet.getRenderer(); };
var simDocument = function () { return sim.getSimDocument(); };
function onChangeToSpecified(criteria) {
if (criteria['onChangeTo']) {
if (criteria['onChangeTo'] == 'yes') return true;
else return false;
} else return false;
}
function changeOccurred(criteria) {
var val = criteria['variable'];
var prevVal = animationSet.getPrevInputs()[val];
var curVarName = criteria['variable'];
var currentVal = animationSet.getCurrentInputs()[curVarName];
if (currentVal != prevVal) {
if (criteria['value'] == '*') return true;
else return (currentVal == criteria['value']);
} else return false;
}
function inspectSelectionCriteria(sc, embedded, force) {
var buff = [];
var sep = '\n';
for (var l in sc) {
buff.push('selectionCriteria[');
buff.push(l);
buff.push('] = ');
buff.push(sc[l]);
buff.push(sep);
}
if (embedded) return buff.join('');
else force == null ? debug(buff.join('')) : debugf(buff.join(''));
}
this.getAnimationSet = function () {
return animationSet;
};
this.addAnimationThreadElement = function (element) {
threadElements.push(element);
return this;
};
this.getAnimationElement = function (id) {
return animationSet.getAnimationElement(id);
};
this.getFirstAnimationThreadElement = function () {
return threadElements[0];
};
this.nextAnimationThreadElement = function (reset) {
if (reset)
this.resetCurrentThreadElementIndex();
else this.incrementCurrentThreadElementIndex();
if (this.getCurrentThreadElementIndex() >= threadElements.length) return null;
else {
var nextElement = threadElements[this.getCurrentThreadElementIndex()];
return nextElement;
}
};
this.getCurrentThreadElementIndex = function () {
return currentThreadElementIndex;
};
this.setCurrentThreadElementIndex = function (num) {
currentThreadElementIndex = Math.min(Math.max(0, num), threadElements.length);
};
this.incrementCurrentThreadElementIndex = function () {
currentThreadElementIndex++;
};
this.resetCurrentThreadElementIndex = function () {
currentThreadElementIndex = 0;
};
this.getRequiresInput = function () {
return requiresInput;
};
this.setRequiresInput = function (newRequiresInput) {
requiresInput = newRequiresInput;
};
this.addSelectionCriteria = function (attributes) {
var criteriaAttr = [];
for (var i = 0; i < attributes.length; i++) {
criteriaAttr[attributes[i].nodeName] = attributes[i].nodeValue;
}
selectionCriteria.push(criteriaAttr);
};
this.getSelectionCriteria = function () {
return selectionCriteria;
};
this.isSelected = function () {
var result = true;
var sc = this.getSelectionCriteria();
if (Object.size(sc) == 0) result = true;
else {
for (var i = 0; i < sc.length; i++) {
var criterium = sc[i];
if (onChangeToSpecified(criterium)) {
if (changeOccurred(criterium)) {
if (!(criterium['variable'] in animationSet.getCurrentInputs()) || criterium['value'] != animationSet.getCurrentInputs()[criterium['variable']]) {
result = false;
break;
}
} else {
result = false;
break;
}
}
else {
if (!(criterium['variable'] in animationSet.getCurrentInputs()) || criterium['value'] != animationSet.getCurrentInputs()[criterium['variable']]) {
result = false;
break;
} else result = true;
}
}
}
return result;
};
this.startSimulation = function () {
theSet.setCurrentThread(this);
this.resetCurrentThreadElementIndex();
this.renderNextThreadElement(true);
};
this.getSourceName = function () {
return source;
};
this.renderNextThreadElement = function (startAtBeginning) {
debug('In renderNextThreadElement -startAtBeginning = ' + startAtBeginning);
if (startAtBeginning) currentThreadElement = this.getFirstAnimationThreadElement();
else {
currentThreadElement = this.nextAnimationThreadElement(false);
if (!currentThreadElement) {
dbg().logError(source, 'Could not get next AnimationThreadElement for currentThread = ' + this.getName());
return null;
}
}
debug('In renderNextThreadElement - currentThreadElement = ' + currentThreadElement.getName());
currentElement = animationSet.getAnimationElement(currentThreadElement.getName());
if (!currentElement) {
dbg().logError(source, 'Could not get new current AnimationElement for currentThreadElement = ' + currentThreadElement.getName());
return null;
}
else {
debug('In renderNextThreadElement - currentElement = ' + currentElement.getName());
currentElementName = currentElement.getName();
if (!currentElementName) dbg().logWarning(source, 'Name is null for current AnimationElement in AnimationThread = ' + this.getName());
switch (currentElement.getType()) {
case Simulator.Constants.IMAGE_ANIMATION:
debug('In renderNextThreadElement - rendering image ' + currentElement.getSrc());
renderer().renderImage(currentElement, 'animationPanel', currentElement.getSrc(),
currentElementName, currentThreadElement.getMaxTime(), this);
break;
case 'animation':
case Simulator.Constants.HTML5_ANIMATION:
if (util().canPlayHtml5()) {
renderer().renderAnimation(currentElement, 'animationPanel', currentElement.getSrc(),
util().getFileName(currentElement.getSrc()), currentThreadElement.getMaxTime(), this);
}
else if (currentElement.getAltSrcType() == Simulator.Constants.FLASH_ANIMATION) {
renderer().renderFlash(currentElement, 'animationPanel', currentElement.getAltSrc(),
util().getFileName(currentElement.getAltSrc()), currentElement.getControls(),
currentElementName, currentThreadElement.getMaxTime(), this);
}
break;
case Simulator.Constants.FLASH_ANIMATION:
renderer().renderFlash(currentElement, 'animationPanel', currentElement.getSrc(),
util().getFileName(currentElement.getSrc()), currentElement.getControls(),
currentElementName, currentThreadElement.getMaxTime(), this);
break;
case Simulator.Constants.HOTTEXT_ANIMATION:
renderer().renderHotText(currentElement, 'animationPanel', currentElement.getSrc(),
'', currentElement.getControls(),
currentElementName, currentThreadElement.getMaxTime(), this);
break;
}
}
debug('In renderNextThreadElement - returning currentElement = ' + currentElement.getName());
return currentElement;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting AnimationThread "'); buff.push(this.getName()); buff.push('"');
buff.push(sep);
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
buff.push(inspectSelectionCriteria(this.getSelectionCriteria(), true, force));
buff.push('End of selectionCriteria');
buff.push(sep);
for (var i = 0; i < threadElements.length; i++) {
switch (getConstructorName(threadElements[i].constructor.toString())) {
case 'AnimationThreadElement':
buff.push(threadElements[i].inspect(true)); buff.push(sep);
break;
}
}
buff.push('End of AnimationThread inspection');
buff.push(sep);
if (embedded) return buff.join('');
else force == null ? debug(buff.join('')) : debugf(buff.join(''));
};
this.getCurrentElement = function () {
debug('In getCurrentElement - returning ' + ((currentElement === null) ? null : currentElement.getName()));
return currentElement;
};
this.setCurrentElement = function (element) {
debug('In setCurrentElement - setting lastExecutedAnimationElement to currentElement: ' + ((currentElement === null) ? 'null' : currentElement.getName()));
lastExecutedAnimationElement = currentElement;
debug('In setCurrentElement - setting currentElement to ' + ((element === null) ? 'null' : element.getName()));
currentElement = element;
};
this.getLastExecutedAnimationElement = function () {
return lastExecutedAnimationElement;
};
this.setAttributes = function (attr, node) {
if (node) attr = util().getAttributes(node);
Simulator.Animation.AnimationThread.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'maxTime':
this.setmaxTime(attr[i]);
break;
case 'requiresInput':
this.setRequiresInput(attr[i]);
break;
case 'completionPendingOnOutput':
this.setCompletionPendingOnOutput(attr[i]);
break;
}
}
var threadElements = node.childNodes;
for (var i = 0; i < threadElements.length; i++) {
switch (threadElements[i].nodeName) {
case 'selectionClause':
var clauseElements = threadElements[i].childNodes;
for (var j = 0; j < clauseElements.length; j++) {
if (clauseElements[j].nodeName[0] != '#') this.addSelectionCriteria(clauseElements[j].attributes);
}
break;
}
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Animation.AnimationThread.prototype = new Simulator.SimElement();
Simulator.Animation.AnimationThread.parent = Simulator.SimElement;
Simulator.Animation.AnimationThread.prototype.constructor = Simulator.Animation.AnimationThread;

/* SOURCE FILE: AnimationThreadElement2.js (81aeeb51) 9/9/2014 2:09:04 PM */

Simulator.Animation.AnimationThreadElement = function (sim, panel, section, animationSet, animationThread) {
Simulator.SimElement.call(this, sim);
var source = 'AnimationThreadElement';
var selectionCriteria = [];
var prevInputs = [];
var currentInputs = [];
var maxTime = -1;
this.setEname(source);
var util = function () { return sim.getUtils(); };
var whiteboard = function() { sim.getWhiteboard(); };
var dbg = function () { return sim.getDebug(); };
var simDocument = function() { return sim.getSimDocument(); };
function storeInputs(backupInputs) {
var inputs = whiteboard.getCategory('dataInputs');
setPrevInputs();
if (Object.size(inputs) > 0) {
setPrevInputs();
for (var r in inputs) {
currentInputs[r] = inputs[r];
}
}
}
function setPrevInputs() {
for (var p in currentInputs) {
prevInputs[p] = currentInputs[p];
}
}
function onChangeToSpecified(criteria) {
if (criteria['onChangeTo']) {
if (criteria['onChangeTo'] == 'yes') return true;
else return false;
} else return false;
}
function changeOccurred(criteria) {
var prevVal = animationSet.getPrevInputs()[criteria['variable']];
var curVarName = criteria['variable'];
var currentVal = animationSet.getCurrentInputs()[curVarName];
if (currentVal != prevVal) {
if (criteria['value'] == '*') return true;
else return (currentVal == criteria['value']);
} else return false;
}
function inspectSelectionCriteria (criteria, embedded, force) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting Selection Criteria:');
buff.push(sep);
for (var l in criteria) {
buff.push('selectionCriteria[');
buff.push(l);
buff.push(']: '); buff.push(sep);
for (var p in criteria[l]) {
buff.push('['); buff.push(p); buff.push('] = '); buff.push(criteria[l][p]); buff.push(sep);
}
}
buff.push('End of selectionCriteria');
buff.push(sep);
if (!embedded)
(force == null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
};
this.getMaxTime = function () {
return maxTime;
};
this.setMaxTime = function (newMaxTime) {
maxTime = newMaxTime;
};
this.getAnimationThread = function () {
return animationThread;
};
this.getAnimationSet = function () {
return animationSet;
};
this.addSelectionCriteria = function (attributes) {
var criteriaAttr = [];
for (var i = 0; i < attributes.length; i++) {
criteriaAttr[attributes[i].nodeName] = attributes[i].nodeValue;
}
selectionCriteria.push(criteriaAttr);
};
this.getSelectionCriteria = function () {
return selectionCriteria;
};
this.isSelected = function () {
var result = true;
var sc = this.getSelectionCriteria();
var scSize = Object.size(sc);
var inputSize = Object.size(animationSet.getCurrentInputs());
if (scSize == 0) result = true;
else if (scSize != inputSize) result = false;
else {
for (var i = 0; i < inputSize; i++) {
var criterium = sc[i];
if (onChangeToSpecified(criterium)) {
if (changeOccurred(criterium)) {
if (!(criterium['variable'] in animationSet.getCurrentInputs()) || criterium['value'] != animationSet.getCurrentInputs()[criterium['variable']]) {
result = false;
break;
}
} else {
result = false;
break;
}
}
else {
if (!(criterium['variable'] in animationSet.getCurrentInputs()) || criterium['value'] != animationSet.getCurrentInputs()[criterium['variable']]) {
result = false;
break;
}
}
}
}
return result;
};
this.getSourceName = function() {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting ');
buff.push(this.getEname());
buff.push(': ');
buff.push(this.getName());
buff.push(sep);
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
buff.push(inspectSelectionCriteria(selectionCriteria, true));
buff.push(sep);
buff.push('end of AnimationThreadElement Inspection'); buff.push(sep);
if (!embedded)
(force == null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
};
this.setAttributes = function (attr, node) {
if (node) attr = util().getAttributes(node);
Simulator.Animation.AnimationThreadElement.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'maxTime':
this.setMaxTime(attr[i]);
break;
default:
continue;
}
}
var threadElements = node.childNodes;
for (var i = 0; i < threadElements.length; i++) {
if (threadElements[i].nodeName[0] != '#') {
switch (threadElements[i].nodeName) {
case 'selectionClause':
var clauseElements = threadElements[i].childNodes;
for (var j = 0; j < clauseElements.length; j++) {
if (clauseElements[j].nodeName[0] != '#') this.addSelectionCriteria(clauseElements[j].attributes);
}
break;
}
}
}
};
this.render = function (panelName, currentElementName, maxTime, thread) {
var aThread = this.getAnimationThread();
var element = aThread.getAnimationElement(this.getName());
debug('In render - Attempting to render element "' + (element === null) ? null : element.getName() + '"');
element.render(panelName, currentElementName, maxTime, thread);
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Animation.AnimationThreadElement.prototype = new Simulator.SimElement();
Simulator.Animation.AnimationThreadElement.parent = Simulator.SimElement;
Simulator.Animation.AnimationThreadElement.prototype.constructor = Simulator.Animation.AnimationThreadElement;

/* SOURCE FILE: FlashAnimationInterface2.js (25f48b66) 9/9/2014 2:09:04 PM */

Simulator.Animation.FlashAnimationInterface = {};
Simulator.Animation.FlashAnimationInterface.ObjectMapper = [];
Simulator.Animation.FlashAnimationInterface.GetInstance = function (simID) {
return Simulator.Animation.FlashAnimationInterface.ObjectMapper[simID];
}
Simulator.Animation.FlashAnimationInterface.MapInstance = function (simObject) {
Simulator.Animation.FlashAnimationInterface.ObjectMapper[simObject.getSimID()] = simObject;
}
Simulator.Animation.FlashAnimationInterface.AnimationMediaOutput = function (simID, type, data) {
var simulator = Simulator.Animation.FlashAnimationInterface.GetInstance(simID);
if(simulator)
simulator.getAnimationSet().animationMediaOutput(simID, type, data);
}

/* SOURCE FILE: Section2.js (86f7cd54) 10/26/2014 1:27:05 PM */

Simulator.Input.Section = function (sim, thePanel, count) {
Simulator.SimElement.call(this, sim);
var source = 'Section';
var instance = this;
var sectionNumber = 1;
var divider = 'no';
var sectionLabel = '';
var panel = thePanel;
var simID = null;
var sectionCount = (!count) ? 0 : count;
var orientation = "vertical";
var numberOfColumns = "1";
this.getSectionSettings = function () {
var sectionSettings = {
'elementorientation': orientation,
'numberofcolumns' : numberOfColumns
}
return sectionSettings;
}
var dbg = function () { return sim.getDebug(); };
var utils = function () { return sim.getUtils(); };
var simMgr = function () { return sim.getSimulationManager(); };
var simDocument = function () { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
this.getSimDocument = function () {
return simDocument();
}
if (sim) {
simID = sim.getSimID();
}
this.setDivider = function (newDivider) {
divider = newDivider;
};
this.getDivider = function () {
return divider;
};
this.setLabel = function (newLabel) {
sectionLabel = newLabel;
return this;
};
this.getLabel = function () {
return transDictionary().translate(sectionLabel);
};
this.getSectionID = function () {
return 'inputSection' + simID + sectionCount;
}
this.render = function () {
var inputPanel = panel;
var label = this.getLabel();
var HTMLPanel = simDocument().getElementById(panel.getNodeID());
var space = this.getSpaceAbove();
if (space > 0) utils().appendBlankVertcalSpace(HTMLPanel, space);
if (label) {
var h4Element = simDocument().createElement('h4');
h4Element.id = this.getSectionID();
h4Element.innerHTML = label;
HTMLPanel.appendChild(h4Element);
}
var image = this.getImage();
if (image) {
div = simDocument().createElement('div');
div.id = 'imageHolder' + simID;
HTMLPanel.appendChild(div);
var span = simDocument().createElement('span');
span.id = 'holdingSpan' + simID;
div.appendChild(span);
var img = simDocument().createElement('img');
img.id = this.getEname() + SimItem.NextForNumber();
img.src = image;
span.appendChild(img);
}
if (this.getDivider() == 'yes') HTMLPanel.appendChild(simDocument().createElement('hr'));
space = this.getSpaceBelow();
if (space > 0) utils().appendBlankVertcalSpace(HTMLPanel, space);
};
this.setAttributes = function (attr, node) {
Simulator.Input.Section.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'divider':
instance.setDivider(attr[i]);
break;
case 'orientation':
orientation = attr[i];
break;
case 'columns':
numberOfColumns = attr[i];
break;
}
}
};
function debug(str1, str2, trace) {
dbg().debug(source + ': ' + str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source + ': ' + str1, str2, trace);
}
};
Simulator.Input.Section.prototype = new Simulator.SimElement();
Simulator.Input.Section.prototype.constructor = Simulator.Input.Section;

/* SOURCE FILE: InputElement2.js (99b155fb) 10/26/2014 1:27:05 PM */

Simulator.Input.InputElement = function (sim) {
Simulator.SimElement.call(this, sim);
var source = 'InputElement';
var prevValue = null;
var data = 0;
var availableinputScopes = ['dataInput', 'animationInput', 'evaluationInput'];
var inputScope = [];
var saveOnChange = true;
var key = undefined;
var scoreable = true;
var state = 'enabled';
var eventsRegistered = false;
var panel = null;
var section = null;
var dbg = function () { return sim.getDebug(); };
var eventMgr = function () { return sim.getEventManager(); };
var simulationMgr = function () { return sim.getSimulationManager(); };
var whiteboard = function () { return sim.getWhiteboard(); };
var scoringTable = function () { return sim.getScoringTable(); };
var simDocument = function () { return sim.getSimDocument(); };
this.getPanel = function () {
return panel;
};
this.setPanel = function (newPanel) {
panel = newPanel;
panel.registerIOElement(this);
return this;
};
this.setSection = function (theSection) {
section = theSection;
};
this.getSectionLabel = function () {
return section.getLabel();
};
this.getSectionID = function () {
return section.getSectionID();
}
this.createLabelID = function () {
return this.createItemID(false, -1, this.getName() + 'Label');
}
this.createUnitsID = function () {
return this.createItemID(false, -1, this.getName() + 'Units');
}
this.getPrevValue = function () {
return prevValue;
};
this.setPrevValue = function (newPrevValue) {
prevValue = newPrevValue;
return this;
};
this.getData = function () {
var dataArray = [];
if (dataArray[0]) prevValue = dataArray[0];
dataArray[0] = data;
return dataArray;
};
this.setData = function (newData) {
if (data) prevValue = data;
data = newData;
return this;
};
this.getInputScope = function () {
return inputScope;
};
this.setInputScope = function (newinputScope) {
if (newinputScope == 'globalInput') {
for (var i = 0; i < availableinputScopes.length; i++) inputScope[i] = availableinputScopes[i];
} else inputScope = newinputScope.split(',');
for (var j = 0; j < inputScope.length; j++) inputScope[j] = inputScope[j].trim();
};
this.getSaveOnChange = function () {
return saveOnChange;
};
this.setSaveOnChange = function (newSaveOnChange) {
saveOnChange = newSaveOnChange == 'no' ? false : true;
};
this.onChange = function (id) {
if (!id) id = this.getNodeID();
var jsObj = this.getHTMLElement(id);
this.recordInput(jsObj, false, true, false);
this.postOnChangeEvents();
};
this.recordInput = function (obj, setDefault, recordOnChange, forcedSave) {
var value = null;
for (var i = 0; i < inputScope.length; i++) {
if (key == undefined) key = whiteboard().addItem(inputScope[i], this.getName());
value = this.getData(inputScope[i]);
if (value) {
if (inputScope[i] == 'animationInput' && this instanceof Simulator.Input.InputElement) value = this.formatForAnimationInput(value);
else if (inputScope[i] == 'dataInput' && this instanceof Simulator.Input.InputElement) value = this.formatForTableInput(value);
whiteboard().setItem(inputScope[i], this.getName(), value, key);
}
}
if (value && this.getScoreable() && !setDefault && (this.postOnChangeEnabled() || forcedSave)) {
scoringTable().setValue(this.getName(), simulationMgr().getTrialRowNum(recordOnChange), value);
}
};
this.getScoreable = function () {
return scoreable;
};
this.formatForAnimationInput = function (value) {
return value;
};
this.formatForTableInput = function (value) {
return value;
};
this.setScoreable = function (newScoreable) {
if (newScoreable == 'yes') scoreable = true;
else scoreable = false;
};
this.getState = function () {
return state;
};
this.setState = function (newState) {
if (newState == 'disabled') state = 'disabled';
else state = 'enabled';
};
this.disableInput = function () {
var element = simDocument().getElementById(this.getNodeID());
element.disabled = true;
this.setState('disabled');
};
this.enableInput = function () {
var element = simDocument().getElementById(this.getNodeID());
element.disabled = false;
this.setState('enabled');
};
this.getHTMLElement = function (id) {
if (id) return simDocument().getElementById(id);
else return simDocument().getElementById(this.getNodeID());
};
this.registerEvents = function () {
if (!eventsRegistered) {
eventMgr().registerEvent(new Simulator.Event(this, 'info', 'simulatorStateChange'), 'to');
eventsRegistered = true;
}
};
this.setAttributes = function (attr) {
Simulator.Input.InputElement.prototype.setAttributes.call(this, attr);
for (var i in attr) {
switch (i) {
case 'inputScope':
this.setInputScope(attr[i]);
break;
case 'state':
this.setState(attr[i]);
break;
case 'scoreable':
this.setScoreable(attr[i]);
break;
case 'saveOnChange':
this.setSaveOnChange(attr[i]);
break;
}
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Input.InputElement.prototype = new Simulator.SimElement();
Simulator.Input.InputElement.parent = Simulator.SimElement;
Simulator.Input.InputElement.prototype.constructor = Simulator.Input.InputElement;

/* SOURCE FILE: GroupList2.js (809c44a7) 10/26/2014 1:27:05 PM */

Simulator.Input.GroupList = function(sim) {
Simulator.Input.InputElement.call(this, sim);
var items = [];
var dbg = function() { return sim.getDebug(); };
var eventMgr = function() { return sim.getEventManager(); };
var utils = function() { return sim.getUtils(); };
var simulationMgr = function() { return sim.getSimulationManager(); };
var simDocument = function() { return sim.getSimDocument(); };
this.getItems = function() {
return items;
};
this.setItems = function(node) {
var id;
var ruleName = null;
var elementName = '';
try {
if(utils().isInternetExplorer()) elementName = node.attributes.getNamedItem('name').value;
else elementName = node.attributes['name'].nodeValue;
} catch(err) {
dbg().logError(source, 'Error occurred getting element name: ' + err.message);
elementName = '';
}
var attr = [];
var theItem;
var itemID = null;
var itemNum = 0;
if (node.childNodes != null) {
for ( var j = 0; j < node.childNodes.length; j++) {
id = node.childNodes[j].nodeName;
if (id[0] != '#') {
if (id == 'item' || id == 'ITEM') {
theItem = node.childNodes[j];
attr = theItem.attributes;
var attributes = new Simulator.Utils.Dictionary(sim);
items[itemNum] = attributes;
for ( var i = 0; i < attr.length; i++) {
var attribute = attr[i];
var nodeName = attribute.nodeName;
if(attribute.nodeName == 'image') {
attributes.setValue(nodeName, attribute.nodeValue);
}
else attributes.setValue(nodeName, attribute.nodeValue);
}
itemID = j == 0 ? this.createItemID(true, itemNum) : this.createItemID(false, itemNum);
attributes.setValue('itemID', itemID);
itemNum++;
}
}
}
}
};
this.disableItems = function() {
for(var i = 0; i < items.length; i++) {
var element = simDocument().getElementById(items[i].itemID);
element.disabled = true;
}
};
this.enableItems = function() {
for(var i = 0; i < items.length; i++) {
var element = simDocument().getElementById(items[i].itemID);
element.disabled = false;
}
};
this.getDefaultSelection = function() {
var defaults = [];
for(var i = 0; i < items.length; i++) {
if(items[i].keyExists('default')) {
if(items[i].lookup('default') == 'yes') {
defaults.push(items[i].lookup('val'));
}
}
}
return defaults;
};
this.setDefaultSelections = function() {
var defaults = this.getDefaultSelection();
if(defaults.length > 0) {
selectedItem = defaults;
this.setData(defaults);
}
};
this.getDataProxy = function(itemNum) {
if(itemNum != undefined && itemNum != null) return  items[itemNum].lookup('dataProxy');
else return null;
};
this.getAnimationProxy = function(itemNum) {
if(itemNum != undefined && itemNum != null) return  items[itemNum].lookup('animationProxy');
else return null;
};
this.getEvaluationProxy = function(itemNum) {
if(itemNum != undefined && itemNum != null) return  items[itemNum].lookup('evaluationProxy');
else return null;
};
this.extractItemValue = function(itemIndex) {
var value = null;
var inputScope = this.getInputScope();
if(isNaN(itemIndex)) {
for(var i = 0; i < items.length; i++) {
if(items[i].itemID == itemIndex) {
itemIndex = i;
break;
}
}
}
if(itemIndex >= 0) {
if(inputScope == 'dataInput') value = this.getDataProxy(itemIndex);
else if(inputScope == 'evaluationInput') value = this.getEvaluationProxy(itemIndex);
else if(inputScope == 'animationInput') value = this.getAnimationProxy(itemIndex);
if(value == undefined || value == null) value = items[itemIndex].lookup('val');
return value;
} else {
dbg().logError(source, 'itemIndex = "' + itemIndex + '". Could not extract item value');
return null;
}
};
this.saveState = function(indent, preface, nameStr, valStr, suffix) {
var checkedItems = '';
for(var i = 0; i < items.length; i++) {
var id = items[i].itemID;
var value = items[i].lookup('val');
if(value == undefined || value == null || value == '') value = items[i].lookup('dataProxy');
var htmlElement = simDocument().getElementById(id);
if(htmlElement.checked != undefined) {
if(htmlElement.checked) {
if(checkedItems == '') checkedItems = checkedItems + value;
else checkedItems = checkedItems + ', ' + value;
}
} else if(htmlElement.selected != undefined) {
if(htmlElement.selected) {
this.selectedIndex = value;
checkedItems = value;
}
}
}
if(checkedItems != '') return indent + preface + nameStr + this.getName() + valStr + checkedItems + suffix;
else return '';
};
this.setSelectStateViaKeyboard = function(elementID, itemID) {
var HTMLItem = null;
if(itemID) HTMLItem = simDocument().getElementById(itemID);
else HTMLItem = simDocument().getElementById(elementID);
if(HTMLItem) {
if(this.getType() == 'dropList') {
if(HTMLItem.selected) HTMLItem.removeAttribute('selected');
else {
HTMLItem.selected = 'selected';
}
} else {
if (HTMLItem.checked) HTMLItem.checked = false;
else {
HTMLItem.checked = 'checked';
this.recordInput(this);
}
}
}
};
this.setSelectStateViaSpeech = function(elementID, itemID) {
this.recordKeyboardSelection(elementID, itemID);
};
this.recordKeyboardSelection = function(elementID, itemID, itemIndex) {
var element = null;
var item = null;
if(itemID) {
item = simDocument().getElementById(itemID);
if(!item) {
element = simDocument().getElementById(elementID);
if(element) item = element.getElementsByClassName(itemID)[0];
}
if(item) {
item.isSelected = true;
this.setSelectStateViaKeyboard(elementID, itemID);
this.onChange(elementID);
}
}
};
this.inspect = function(embedded, forced) {
buff = [];
if (!embedded)
buff.push('Inspecting GroupList');
var items = this.getItems();
for ( var i in items) {
buff.push(i);
buff.push(' = ');
buff.push(items[i]);
buff.push('\n\n');
}
if(!embedded) forced == true ? dbg().debugf(buff.join('')) : dbg().debug(buff.join());
else return buff.join('');
};
this.setAttributes = function(attr) {
Simulator.Input.GroupList.prototype.setAttributes.call(this, attr);
for ( var i in attr) {
switch (i) {
case 'items':
this.setItems(attr[i]);
break;
}
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Input.GroupList.prototype = new Simulator.Input.InputElement();
Simulator.Input.GroupList.prototype.constructor = Simulator.Input.GroupList;

/* SOURCE FILE: ChoiceList2.js (e8922025) 10/26/2014 1:27:05 PM */

Simulator.Input.ChoiceList = function(sim, node, panel, theSection, container) {
Simulator.Input.GroupList.call(this, sim);
var that = this;
var source = 'ChoiceList';
var dbg = function() { return sim.getDebug(); };
var utils = function() { return sim.getUtils(); };
var simMgr = function() { return sim.getSimulationManager(); };
var keyboardInput = function () { return sim.getKeyboardInput(); };
var scoringTable = function () { return sim.getScoringTable(); };
var simDocument = function() { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
if(sim) {
this.setPanel(panel);
this.setSection(theSection);
}
this.formatEventData = function() {
var buff = [];
var data = this.getData();
for(var i = 0; i < data.length; i++) {
if(data[i]) {
buff.push(data[i]);
if(i < data.length - 1) buff.push(',');
}
}
return buff.join('');
};
this.formatForAnimationInput = function(value) {
var output = [];
output[0] = value.join(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER);
return output;
};
this.formatForTableInput = function(value) {
var output = [];
output[0] = value.join(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER + ' ');
return output;
};
this.getData = function(inputScope) {
var checkedItems = [];
var k = 0;
var item = null;
var proxy = null;
var items = this.getItems();
for(var i = 0; i < items.length; i++) {
var labelFor = simDocument().getElementById(items[i].lookup('labelForID'));
item = simDocument().getElementById(items[i]['itemID']);
if(item.checked) {
if(inputScope == 'dataInput') proxy = this.getDataProxy(i);
else if(inputScope == 'evaluationInput') proxy = this.getEvaluationProxy(i);
else if(inputScope == 'animationInput') proxy = this.getAnimationProxy(i);
if(proxy != undefined && proxy != null) checkedItems[k] = proxy;
else checkedItems[k] = items[i].lookup('val');
labelFor.setAttribute('class', 'inputChecked');
k++;
}
else labelFor.removeAttribute('class');
}
this.setData(checkedItems);
return checkedItems;
};
this.handleEvent = function(event) {
switch (event.type) {
case 'inputReq':
this.recordInput(this);
break;
case 'info':
switch(event.context) {
case 'simulatorStateChange':
break;
}
break;
default:
dbg().logWarning(sourde, 'Unhandled event type received: ' + event.toString());
return;
}
};
this.setElementSelectState = function (state, contents) {
var htmlElement = null;
selectedItem = -1;
var items = this.getItems();
var parts = contents.split(',');
for (var i = 0; i < parts.length; i++) {
if (parts[i] != null) parts[i] = parts[i].trim();
}
var proxy = null;
var value = null;
for (var i = 0; i < items.length; i++) {
var labelFor = simDocument().getElementById(items[i].lookup('labelForID'));
proxy = items[i].lookup('dataProxy');
if (proxy) value = proxy;
else value = items[i].lookup('val');
if (state == 'true') {
if (utils().elementInArray(parts, value)) {
items[i].setValue('selected', 'checked');
if (selectedItem == '') selectedItem = value;
else selectedItem = ', ' + value;
htmlElement = simDocument().getElementById(items[i].itemID);
htmlElement.checked = 'checked';
labelFor.setAttribute('class', 'inputChecked');
this.recordInput(this, true);
}
else if ((items[i].lookup('selected')) || (items[i].lookup('default') == 'yes')) {
htmlElement = simDocument().getElementById(items[i].itemID);
if(htmlElement) htmlElement.checked = false;
labelFor.removeAttribute('class');
items[i].remove('selected');
}
} else {
if (value == contents && items[i].lookup('selected')) {
htmlElement = simDocument().getElementById(items[i].itemID);
if(htmlElement) htmlElement.checked = false;
labelFor.removeAttribute('class');
items[i].remove('selected');
}
}
}
};
this.keyboardNavigateTo = function(elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
var nodes = element.getElementsByTagName('li');
var item = nodes[index];
if(element) element.selectedIndex = index;
if(item) item.setAttribute('class', 'simAreaFocus');
};
this.keyboardNavigateAwayFrom = function(elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
var nodes = element.getElementsByTagName('li');
var item = nodes[index];
item.removeAttribute('class');
};
this.disableInput = function() {
this.disableItems();
};
this.enableInput = function() {
this.enableItems();
};
this.setAttributes = function(attr, node) {
Simulator.Input.ChoiceList.prototype.setAttributes.call(this, attr);
if(this.getScoreable()) scoringTable().addElement(this.getName(), 'input');
this.setItems(node);
};
this.doOnClick = function(id) {
this.onChange(id);
};
this.render = function() {
var nodeID = this.getNodeID();
var itemID = null;
var items = this.getItems();
var nextNum = utils().getNextSequenceNumber();
var image = null;
var labelledByID = this.getSectionID();
var panelHtml = container;
var outerDiv = simDocument().createElement("div");
outerDiv.className = "inputChoiceList";
this.setFocusable(true, true);
if (this.getLabel()) {
var h5LabelElement = simDocument().createElement('h5');
var h5ID = this.createLabelID();
h5LabelElement.id = h5ID;
labelledByID = labelledByID + ' ' + h5ID;
h5LabelElement.innerHTML = this.getLabel();
panelHtml.appendChild(h5LabelElement);
}
for ( var x = 0; x < items.length; x++) {
var itemIDReset = x == 0 ? true : false;
itemID = this.createItemID(itemIDReset);
items[x]['itemID'] = itemID;
image = (items[x]).lookup('image');
if(x == 0) {
if (image != null && image != undefined) {
var ulElement = simDocument().createElement('ul');
ulElement.id = nodeID;
ulElement.setAttribute('class', 'multiSelect withImages');
} else {
ulElement = simDocument().createElement('ul');
ulElement.id = nodeID;
ulElement.setAttribute('class', 'multiSelect');
ulElement.setAttribute('role', 'group');
ulElement.setAttribute('aria-labelledby', labelledByID);
}
if (theSection.getSectionSettings().elementorientation === "horizontal") {
outerDiv.classList.add("inputpanelcell");
}
outerDiv.appendChild(ulElement);
}
var labelForID = 'labelFor' + itemID;
items[x].setValue('labelForID', labelForID);
if ((items[x]).lookup('val') != undefined) {
var listElement = simDocument().createElement('li');
var inputEl = simDocument().createElement('input');
inputEl.id = itemID;
inputEl.setAttribute('type', 'checkbox');
inputEl.setAttribute('name', 'ChoiceButtonGroup' + nodeID + nextNum);
inputEl.setAttribute('value', (items[x]).lookup('val'));
if(this.getSaveOnChange()) {
utils().bindEvent(inputEl, 'click', function () {
that.doOnClick(nodeID);
});
}
if(items[x].lookup('default') == 'yes') {
inputEl.setAttribute('checked', '');
}
listElement.appendChild(inputEl);
var labelForID = 'labelFor' + itemID;
items[x].setValue('labelForID', labelForID);
var labelEl = simDocument().createElement('label');
labelEl.id = labelForID;
labelEl.setAttribute('for', itemID);
if(items[x].lookup('default') == 'yes') {
labelEl.setAttribute('class', 'inputChecked');
}
if (image != null && image != undefined) {
var imageSpanEl = simDocument().createElement('span');
imageSpanEl.setAttribute('class', 'holderImage');
var imageEl = simDocument().createElement('img');
imageEl.setAttribute('src', image);
imageEl.setAttribute('alt', (items[x]).lookup('val'));
imageSpanEl.appendChild(imageEl);
labelEl.appendChild(imageSpanEl);
}
var listLabelSpanEl = simDocument().createElement('span');
listLabelSpanEl.setAttribute('class', 'listLabel');
var innerHTMLtag = (items[x]).lookup('val');
listLabelSpanEl.innerHTML = transDictionary().translate(innerHTMLtag);
labelEl.appendChild(listLabelSpanEl);
listElement.appendChild(labelEl);
ulElement.appendChild(listElement);
}
if (this.isFocusable()) {
keyboardInput().addFocusableElementItem(this, this.getNodeID(), itemID);
}
}
panelHtml.appendChild(outerDiv);
this.setDefaultSelections();
this.mapHTML2JS(ulElement);
};
this.getSourceName = function() {
return source;
};
this.inspect = function(embedded, forced) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
for ( var i in this) {
if (i == 'items') {
buff.push(this.parent.inspect());
} else {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
}
if(!embedded) forced == true ? dbg().debugf(buff.join('')) : dbg().debug(buff.join(''));
else return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Input.ChoiceList.prototype = new Simulator.Input.GroupList();
Simulator.Input.ChoiceList.prototype.constructor = Simulator.Input.ChoiceList;

/* SOURCE FILE: DropList2.js (99049f02) 10/26/2014 1:27:05 PM */

Simulator.Input.DropList = function (sim, node, panel, theSection, container) {
Simulator.Input.GroupList.call(this, sim);
var dbg = function() { return sim.getDebug(); };
var utils = function() { return sim.getUtils(); };
var keyboardInput = function () { return sim.getKeyboardInput(); };
var scoringTable = function () { return sim.getScoringTable(); };
var simMgr = function () { return sim.getSimulationManager(); };
var simDocument = function () { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
var instance = this;
var selectType = 'single';
var listExpanded = false;
if(sim) {
this.setPanel(panel);
this.setSection(theSection);
}
this.getSelectType = function() {
return selectType;
};
this.getElementData = function(id) {
};
this.getKeyboardInput = function() {
return keyboardInput();
};
this.setSelectType = function(newSelectType) {
selectType = newSelectType;
return this;
};
this.getListExpanded = function() {
return listExpanded;
};
this.getData = function(inputScope) {
var data = [];
var proxy = null;
var select = simDocument().getElementById(this.getNodeID());
var value = select.value;
this.setData(value);
if(inputScope == 'dataInput') proxy = this.getDataProxy(select.selectedIndex);
else if(inputScope == 'animationInput') proxy = this.getAnimationProxy(select.selectedIndex);
else if(inputScope == 'evaluationInput') proxy = this.getEvaluationProxy(select.selectedIndex);
if(proxy != undefined && proxy != null) data[0] = proxy;
else data[0] = value;
return data;
};
this.handleEvent = function(event) {
switch (event.type) {
case 'inputReq':
this.recordInput(this);
break;
case 'info':
switch(event.context) {
case 'simulatorStateChange':
break;
}
break;
default:
dbg().logWarning(source, 'Unhandled event type received: ' + event.toString());
return;
}
};
this.setElementSelectState = function(state, contents) {
var items = this.getItems();
var proxy = null;
var value = null;
for(var i = 0; i < items.length; i++) {
proxy = items[i].lookup('dataProxy');
if(proxy) value = proxy;
else value = items[i].lookup('val');
var htmlElement = simDocument().getElementById(items[i].itemID);
if(state == 'true') {
if(value == contents) {
items[i].setValue('selected', 'selected');
selectedItem = value;
htmlElement.selected = true;
this.recordInput(this, true);
}
else if(items[i].lookup('selected') == 'selected') htmlElement.removeAttribute('selected');
} else {
if(value == contents && items[i].lookup('selected') == 'selected') htmlElement.removeAttribute('selected');
}
}
};
this.receivedSpeechFocus = function() {
debug(this.getName() + ' received speech focus');
var element = simDocument().getElementById(this.getNodeID());
var node = simDocument().getElementById(Simulator.Constants.INPUT_PANEL_NAME);
var outline = simDocument().getElementById('dropHolder' + this.getName());
if(outline) outline.setAttribute('class', 'dropHolder simAreaFocus');
outline.size = this.getItems().length;
element.size = this.getItems().length;
node = simDocument().getElementById(this.getName());
node.style.border='thin solid #ff0000';
};
this.speechActivated = function(value) {
this.setSelectStateViaSpeech(this.getNodeID(), value);
InputElement.onChange(this.getNodeID());
};
this.removeSpeechFocus = function() {
debug(this.getName() + ' lost speech focus');
var element = simDocument().getElementById(this.getNodeID());
element.size = 1;
var node = simDocument().getElementById(Simulator.Constants.INPUT_PANEL_NAME);
var element = getElementsByClassName('dropHolder', node)[0];
node = simDocument().getElementById(this.getName());
node.style.border='none';
if(element) element.setAttribute('class', 'dropHolder');
};
this.keyboardNavigateTo = function(elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
var outline = element.parentNode;
if(outline) outline.setAttribute("class", "dropHolder simAreaFocus");
var item = null;
item = simDocument().getElementById(itemID);
if (item) {
item.setAttribute("focused", "focused");
}
if (!listExpanded) {
this.expandList();
listExpanded = true;
}
};
this.keyboardNavigateAwayFrom = function(elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
var outline = element.parentNode;
if(outline) outline.setAttribute("class", "dropHolder");
var item = null;
item = simDocument().getElementById(itemID);
if (item) {
item.setAttribute("focused", "");
}
if (listExpanded) {
this.closeList();
listExpanded = false;
}
};
this.disableInput = function() {
this.disableItems();
};
this.enableInput = function() {
this.enableItems();
};
this.expandList = function() {
var dlist = simDocument().getElementById(this.getNodeID());
var newspan = simDocument().createElement('span');
newspan.setAttribute('id', "selectholderspan");
newspan.setAttribute('class', "selectHolder selectOpened");
dlist.parentNode.parentNode.appendChild(newspan);
newspan.appendChild(dlist.parentNode);
dlist.setAttribute('size', this.getItems().length);
var visibleHeight = 1.2 * this.getItems().length;
dlist.style.height = visibleHeight.toString() + 'em';
var container = simDocument().getElementById(Simulator.Constants.SIM_CONTAINER_NAME + sim.getSimID());
if (container) {
utils().bindEvent(container, 'click', function () {
if ((instance) && (instance.getListExpanded())) {
instance.getKeyboardInput().closeDropList();
}
});
}
};
this.closeList = function() {
var dlist = simDocument().getElementById(this.getNodeID());
dlist.style.height = "";
dlist.setAttribute('size', 0);
var spanRemoved = dlist.parentNode.parentNode;
spanRemoved.parentNode.appendChild(dlist.parentNode);
spanRemoved.parentNode.removeChild(spanRemoved);
};
this.recordKeyboardSelection = function(elementID, itemID, itemIndex) {
var element = null;
var item = null;
if((itemID) && (elementID)) {
item = simDocument().getElementById(itemID);
element = simDocument().getElementById(elementID);
if(!item) {
if(element) item = element.getElementsByClassName(itemID)[0];
}
if(item) {
if ((element.selectedIndex != null) && (element.selectedIndex >= 0))
element.options[element.selectedIndex].setAttribute("selected", "");
item.selected = true;
item.setAttribute("selected", "selected");
if (element)
element.selectedIndex = itemIndex;
this.setSelectStateViaKeyboard(elementID, itemID);
this.onChange(elementID);
}
}
if (listExpanded) {
this.closeList();
listExpanded = false;
}
};
this.setAttributes = function(attr, node) {
Simulator.Input.DropList.prototype.setAttributes.call(this, attr);
for ( var i in attr) {
switch (i) {
case 'selectType':
this.setSelectType(attr[i]);
break;
}
}
if(instance.getScoreable()) scoringTable().addElement(instance.getName(), 'input');
this.setItems(node);
};
this.doOnChange = function() {
instance.onChange(instance.getNodeID());
};
this.render = function() {
var items = this.getItems();
var itemID = null;
var labelledByID = this.getSectionID();
this.setFocusable(true, true);
var image = this.getImage();
if (image != undefined && image != null) {
var dropDiv = simDocument().createElement('div');
dropDiv.setAttribute('class', 'dropDown withImages');
dropDiv.id = this.getName();
var holderSpan = simDocument().createElement('span');
holderSpan.setAttribute('class', 'holderImage');
dropDiv.appendChild(holderSpan);
var img = simDocument().createElement('img');
img.src = image;
img.alt = this.getName() + ' image';
holderSpan.appendChild(img);
dropDiv.appendChild(holderSpan);
}
else {
var dropDiv = simDocument().createElement('div');
dropDiv.setAttribute('class', 'dropDown');
dropDiv.id = this.getName();
}
var form = simDocument().createElement('form');
dropDiv.appendChild(form);
form.name = this.getName();
var formSpan = simDocument().createElement('span');
formSpan.setAttribute('class', 'dropHolder');
formSpan.id = 'dropHolder' + this.getName();
form.appendChild(formSpan);
if(this.getLabel()) {
var labelSpan = simDocument().createElement('span');
labelSpan.style.padding.top = '15px';
labelSpan.style.padding.top = '15px';
labelSpan.innerHTML = this.getLabel();
var labelSpanID = this.createLabelID();
labelSpan.id = labelSpanID;
labelledByID = labelledByID + ' ' + labelSpanID;
formSpan.appendChild(labelSpan);
}
var select = simDocument().createElement('select');
select.id = this.getNodeID();
select.setAttribute('aria-labelledby', labelledByID);
var item = null;
for ( var x = 0; x < items.length; x++) {
var itemIDReset = x == 0 ? true : false;
itemID = this.createItemID(itemIDReset);
items[x]['itemID'] = itemID;
if ((items[x]).lookup('val') != undefined) {
item = simDocument().createElement('option');
item.id = itemID;
item.value = (items[x]).lookup('val');
}
if(items[x].lookup('default') == 'yes') item.selected = 'selected';
var innerHTMLtag = (items[x]).lookup('val');
item.innerHTML = transDictionary().translate(innerHTMLtag);
select.appendChild(item);
if(this.isFocusable()) {
keyboardInput().addFocusableElementItem(this, this.getNodeID(), itemID);
}
}
formSpan.appendChild(select);
var arrowSpan = simDocument().createElement('span');
arrowSpan.setAttribute('class', 'dropArrow');
formSpan.appendChild(arrowSpan);
htmlPanel = container;
if (theSection.getSectionSettings().elementorientation === "horizontal") {
dropDiv.classList.add("inputpanelcell");
}
htmlPanel.appendChild(dropDiv);
var dropList = simDocument().getElementById(this.getNodeID());
if(instance.getSaveOnChange())
utils().bindEvent(dropList, 'change', function() {
instance.doOnChange();
});
utils().appendBlankVertcalSpace(simDocument().getElementById(panel.getNodeID()), 2);
this.setDefaultSelections();
this.mapHTML2JS(dropList);
};
this.getSourceName = function() {
return source;
};
this.inspect = function(embedded, forced) {
var buff = [];
var sep = '\n\n';
if(!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for ( var i in this) {
if (i == 'items') {
buff.push(this.parent.inspect());
} else {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
}
if(!embedded) forced === true ? dbg().debugf(buff.join('')) : dbg().debug(buff.join(''));
else return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Input.DropList.prototype = new Simulator.Input.GroupList();
Simulator.Input.DropList.prototype.constructor = Simulator.Input.DropList;

/* SOURCE FILE: OptionList2.js (9a1155e7) 10/26/2014 1:27:05 PM */

Simulator.Input.OptionList = function(sim, node, panel, theSection, container) {
Simulator.Input.GroupList.call(this, sim);
var that = this;
var source = 'OptionList';
var dbg = function() { return sim.getDebug(); };
var utils = function() { return sim.getUtils(); };
var scoringTable = function () { return sim.getScoringTable(); };
var keyboardInput = function () { return sim.getKeyboardInput(); };
var simMgr = function() { sim.getSimulationManager(); };
var simDocument = function () { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
if(sim) {
this.setPanel(panel);
this.setSection(theSection);
}
this.getData = function(inputScope) {
var data = [];
var proxy = null;
var items = this.getItems();
for(var i = 0;  i < items.length; i++) {
var HTMLItem = simDocument().getElementById(items[i].lookup('itemID'));
var labelFor = simDocument().getElementById(items[i].lookup('labelForID'));
if(inputScope == 'dataInput') proxy = this.getDataProxy(i);
else if(inputScope == 'evaluationInput') proxy = this.getEvaluationProxy(i);
else if(inputScope == 'animationInput') proxy = this.getAnimationProxy(i);
if(HTMLItem.checked) {
if(proxy != undefined && proxy != null) data[0] = proxy;
else data[0] = items[i].lookup('val');
this.setData(data[0]);
labelFor.setAttribute('class', 'inputChecked');
items[i].setValue('checked','true');
selectedItem = data[0];
}
else {
labelFor.removeAttribute('class');
items[i].setValue('checked', 'false');
}
}
if(data.length == 0) this.setData('');
return data;
};
this.handleEvent = function(event) {
switch (event.type) {
case 'inputReq':
this.recordInput(this);
break;
case 'info':
switch(event.context) {
case 'simulatorStateChange':
break;
}
break;
default:
dbg().logWarning(source, 'Unhandled event type received: ' + event.toString());
return;
}
};
this.setElementSelectState = function(state, contents) {
var items = this.getItems();
var proxy = null;
var value = null;
for(var i = 0; i < items.length; i++) {
proxy = items[i].lookup('dataProxy');
if(proxy) value = proxy;
else value = items[i].lookup('val');
var itemID = items[i].lookup('itemID');
var labelFor = simDocument().getElementById('labelFor' + itemID);
var htmlElement = simDocument().getElementById(itemID);
if(value == contents) {
items[i].setValue('checked','true');
selectedItem = value;
htmlElement.checked = 'checked';
labelFor.setAttribute('class', 'inputChecked');
this.recordInput(this, true);
}
else if(items[i].lookup('checked')) {
items[i].setValue('checked', 'false');
htmlElement.removeAttribute('checked');
labelFor.removeAttribute('class');
}
}
};
this.keyboardNavigateTo = function(elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
if (element) {
element.selectedIndex = index;
var nodes = element.getElementsByTagName('li');
var item = nodes[index];
if (item) {
item.setAttribute('class', 'simAreaFocus');
}
}
};
this.receivedSpeechFocus = function() {
debug(this.getName() + ' received speech focus');
var element = simDocument().getElementById(this.getNodeID());
if (element) {
element.selectedIndex = 0;
element.style.border = 'thin solid #ff0000';
var nodes = element.getElementsByTagName('li');
var item = nodes[0];
if (item) {
item.setAttribute('class', 'simAreaFocus');
}
}
};
this.keyboardNavigateAwayFrom = function(elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
if (element) {
var nodes = element.getElementsByTagName('li');
var item = nodes[index];
if (item) {
item.removeAttribute('class');
}
}
};
this.removeSpeechFocus = function() {
debug(this.getName() + ' lost speech focus');
var element = simDocument().getElementById(this.getNodeID());
if (element) {
element.style.border = 'none';
var nodes = element.getElementsByTagName('li');
var item = nodes[0];
if (item) {
item.removeAttribute('class');
}
}
};
this.disableInput = function() {
this.disableItems();
};
this.enableInput = function() {
this.enableItems();
};
this.speechActivated = function(value) {
this.setSelectStateViaSpeech(this.getNodeID(), value);
this.onChange(this.getNodeID());
};
this.setAttributes = function(attr, node) {
Simulator.Input.OptionList.prototype.setAttributes.call(this, attr, node);
if(this.getScoreable()) scoringTable().addElement(this.getName(), 'input');
this.setItems(node);
};
this.doOnClick = function(id) {
this.onChange(id);
};
this.render = function() {
var nodeID = this.getNodeID();
var itemID = null;
var items = this.getItems();
var nextNum = utils().getNextSequenceNumber();
var image = null;
var labelledByID = this.getSectionID();
var panelHtml = container;
var outerDiv = simDocument().createElement("div");
outerDiv.className = "inputOptionList";
this.setFocusable(true, true);
if (this.getLabel()) {
var h5LabelElement = simDocument().createElement('h5');
var h5ID = this.createLabelID();
h5LabelElement.id = h5ID;
labelledByID = labelledByID + ' ' + h5ID;
h5LabelElement.innerHTML = this.getLabel();
outerDiv.appendChild(h5LabelElement);
}
var ulElement = null;
for ( var x = 0; x < items.length; x++) {
var itemIDReset = x == 0 ? true : false;
itemID = this.createItemID(itemIDReset);
items[x]['itemID'] = itemID;
image = (items[x]).lookup('image');
if(x == 0) {
if (image != undefined && image != null) {
ulElement = simDocument().createElement('ul');
ulElement.id = nodeID;
ulElement.setAttribute('class', 'singleSelect withImages');
ulElement.setAttribute('role', 'radiogroup');
ulElement.setAttribute('aria-labelledby', labelledByID);
} else {
ulElement = simDocument().createElement('ul');
ulElement.id = nodeID;
ulElement.setAttribute('class', 'singleSelect');
ulElement.setAttribute('role', 'radiogroup');
ulElement.setAttribute('aria-labelledby', labelledByID);
}
if (theSection.getSectionSettings().elementorientation === "horizontal") {
outerDiv.classList.add("inputpanelcell");
}
outerDiv.appendChild(ulElement);
}
if ((items[x]).lookup('val') != undefined) {
var listElement = simDocument().createElement('li');
var inputEl = simDocument().createElement('input');
inputEl.id = itemID;
inputEl.setAttribute('type', 'radio');
inputEl.setAttribute('name', 'RadioButtonGroup' + nodeID + nextNum);
inputEl.setAttribute('value', (items[x]).lookup('val'));
if (this.getSaveOnChange()) {
utils().bindEvent(inputEl, 'click', function () {
that.doOnClick(nodeID);
});
}
if(items[x].lookup('default') == 'yes') {
inputEl.setAttribute('checked', '');
}
listElement.appendChild(inputEl);
var labelForID = 'labelFor' + itemID;
items[x].setValue('labelForID', labelForID);
var elementLabel = simDocument().createElement('label');
elementLabel.id = labelForID;
elementLabel.setAttribute('for', itemID);
if(items[x].lookup('default') == 'yes') {
elementLabel.setAttribute('class', 'inputChecked');
}
if (image != undefined && image != null) {
var imageSpanEl = simDocument().createElement('span');
imageSpanEl.setAttribute('class', 'holderImage');
var imageEl = simDocument().createElement('img');
imageEl.setAttribute('src', image);
imageEl.setAttribute('alt', (items[x]).lookup('val'));
imageSpanEl.appendChild(imageEl);
elementLabel.appendChild(imageSpanEl);
}
var listLabelSpanEl = simDocument().createElement('span');
listLabelSpanEl.setAttribute('class', 'listLabel');
var innerHTMLtag = (items[x]).lookup('val');
listLabelSpanEl.innerHTML = transDictionary().translate(innerHTMLtag);
elementLabel.appendChild(listLabelSpanEl);
listElement.appendChild(elementLabel);
ulElement.appendChild(listElement);
}
if(this.isFocusable()) {
keyboardInput().addFocusableElementItem(this, nodeID, itemID);
}
}
panelHtml.appendChild(outerDiv);
this.setDefaultSelections();
this.mapHTML2JS(ulElement);
};
this.getSourceName = function() {
return source;
};
this.inspect = function(embedded, forced) {
var buff = [];
var sep = '\n\n';
if(!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for ( var i in this) {
if (i == 'items') {
buff.push(this.parent.inspect());
} else {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
}
if(!embedded) forced === true ? dbg().debug(buff.join('')) : dbg().debug(buff.join(''));
else return buff.join('');
};
var debug = function(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
};
var debugf = function(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
};
};
Simulator.Input.OptionList.prototype = new Simulator.Input.GroupList();
Simulator.Input.OptionList.parent = Simulator.Input.GroupList;
Simulator.Input.OptionList.prototype.constructor = Simulator.Input.OptionList;

/* SOURCE FILE: FieldSet2.js (c741a8fb) 9/9/2014 2:09:04 PM */

Simulator.Input.FieldSet = function(sim) {
Simulator.Input.InputElement.call(this, sim);
var dbg = function() { return sim.getDebug(); };
var persistentVarDB = function() { return sim.getPersistentVariableDataBase(); };
var simDocument = function() { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
var defaultValue = 0;
var minValue = 0;
var increment = 0;
var unitsTag = '';
var data = '';
var valueModifier = null;
var valueChanged = false;
var selectedValue = -1;
var valueModifierOp = 'add';
var maxValue = 0;
this.getMinValue = function() {
return minValue;
};
this.setMinValue = function(newMinValue) {
minValue = newMinValue;
return this;
};
this.getMaxValue = function() {
return maxValue;
};
this.setMaxValue = function(newMaxValue) {
maxValue = newMaxValue;
return this;
};
this.getDefaultValue = function() {
this.setData(defaultValue);
return defaultValue;
};
this.setDefaultValue = function(newDefaultValue) {
defaultValue = newDefaultValue;
selectedValue = newDefaultValue;
this.setPrevValue(newDefaultValue);
return this;
};
this.recordKeyboardSelection = function(elementID, itemID, itemIndex) {
var element = null;
var item = null;
if(itemID) {
item = simDocument().getElementById(itemID);
if(!item) {
element = simDocument().getElementById(elementID);
if(element) item = element.getElementsByClassName(itemID)[0];
}
if(item) {
item.isSelected = true;
this.setSelectStateViaKeyboard(elementID, itemID);
this.onChange(elementID);
}
}
};
this.setSelectStateViaKeyboard = function(elementID, itemID) {
if(itemID == 'goingUp') incrementValue(elementID, this.getMaxValue(), this.getIncrement());
else if(itemID == 'goingDown') decrementValue(elementID, this.getMaxValue(), this.getIncrement());
};
this.getIncrement = function() {
return increment;
};
this.setIncrement = function(newIncrement) {
increment = newIncrement;
return this;
};
this.getUnits = function () {
return transDictionary().translate(unitsTag);
};
this.setUnits = function(newUnits) {
unitsTag = newUnits;
return this;
};
this.setData = function(newData) {
data = newData;
};
this.getData = function() {
var dataArray = [];
dataArray[0] = data;
return dataArray;
};
this.saveState = function(indent, preface, nameStr, valStr, suffix) {
if(selectedValue != '') return indent + preface + nameStr + this.getName() + valStr + this.getData() + suffix;
else return '';
};
this.setElementSelectState = function(state, contents) {
var value = parseFloat(contents);
if(value >= this.getMinValue() && value <= this.getMaxValue() && value % this.getIncrement() == 0) {
this.setData(contents);
selectedValue = contents;
setHTMLValue(this.getNodeID(), this.getData());
this.recordInput(this, true);
}
};
this.setValueModifier = function(element) {
valueModifier = element;
};
this.getValueModifier = function() {
return valueModifier;
};
this.setValueModifierOp = function(op) {
valueModifierOp = op;
};
this.getValueModifierOp = function() {
return valueModifierOp;
};
var doModifierOp = function(element, value) {
var modifier = element.getValueModifier();
if(isNaN(modifier)) modifier = persistentVarDB().getElementValue(element.getValueModifier());
if(value == undefined || value == null) logError('ValueModifier ' + modifier + ' for ' + element.getName() + ' is not a number nor in persistentVarDB');
else {
var op = element.getValueModifierOp();
switch(op) {
case 'add': value += modifier;
break;
case 'multiply': value *= modifier;
break;
case 'subtract': value -= modifier;
break;
case 'divide': value /= modifier;
break;
default: dbg().logError(source, 'Value modifer operation "' + op + '" is not defined');
break;
}
}
return value;
};
this.getModifiedValue = function(value) {
if(this.getValueModifier() != null) {
value = doModifierOp(this, value);
}
return value;
};
this.setAttributes = function(attr, node) {
Simulator.Input.FieldSet.prototype.setAttributes.call(this, attr);
for (var i in attr) {
switch (i) {
case 'minValue':
this.setMinValue(attr[i]);
break;
case 'maxValue':
this.setMaxValue(attr[i]);
break;
case 'defaultValue':
this.setDefaultValue(attr[i]);
break;
case 'increment':
this.setIncrement(attr[i]);
break;
case 'units':
this.setUnits(attr[i]);
break;
}
}
};
var setHTMLValue = function(id, value) {
var htmlElement = simDocument().getElementById(id);
if (!htmlElement) htmlElement = simDocument().getElementById(id + 'slider-value');
if (htmlElement) htmlElement.value = value;
};
this.setValueChanged = function(newValueChanged) {
valueChanged = newValueChanged == 'true' || newValueChanged == 'yes' ? true : false;
};
this.getValueChanged = function() {
return valueChanged;
};
this.incrementValue = function(id, maxValue, increment) {
var htmlElement = simDocument().getElementById(id);
currentValue = parseFloat(htmlElement.value);
currentValue = Math.min(currentValue + parseFloat(increment), maxValue);
htmlElement.value = currentValue;
currentValue = this.getModifiedValue(currentValue);
currentValue = currentValue.toString();
this.setData(currentValue);
valueChanged = true;
if(this.getSaveOnChange()) this.onChange(this.getNodeID());
};
this.decrementValue = function(id, minValue, decrement) {
var htmlElement = simDocument().getElementById(id);
currentValue = parseFloat(htmlElement.value);
currentValue = Math.max(currentValue - parseFloat(decrement), minValue);
htmlElement.value = currentValue;
currentValue = this.getModifiedValue(currentValue);
currentValue = currentValue.toString();
this.setData(currentValue);
valueChanged = true;
if(this.getSaveOnChange()) this.onChange(this.getNodeID());
};
this.inspect = function(embedded, forced) {
var buff = [];
var sep = '\n\n';
if (!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for ( var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) forced === true ? dbg().debugf(buff.join('')) : dbg().debug(buff.join(''));
else return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Input.FieldSet.prototype = new Simulator.Input.InputElement();
Simulator.Input.FieldSet.prototype.constructor = Simulator.Input.FieldSet;

/* SOURCE FILE: SimSlider2.js (b5ba4e48) 10/26/2014 1:27:05 PM */

Simulator.Input.SimSlider = function (sim, node, panel, theSection, container) {
Simulator.Input.FieldSet.call(this, sim);
var that = this;
var source = 'SimSlider';
var instance = this;
var HTMLId = null;
var textAreaId = null;
var sliderBackgroundImage = 'http://yui.yahooapis.com/2.9.0/build/slider/assets/bg-h.gif';
var sliderImage = 'Scripts/Simulator/renderer/images/slider_thumb.png';
var theSlider = null;
var setValues = [];
var orientation = 'horizontal';
var reportMovement = false;
var startConstraint = 0;
var endConstraint = 210;
var dbg = function () { return sim.getDebug(); };
var utils = function () { return sim.getUtils(); };
var simMgr = function () { return sim.getSimulationManager(); };
var scoringTable = function () { return sim.getScoringTable(); };
var keyboardInput = function () { return sim.getKeyboardInput(); };
var simDocument = function () { return sim.getSimDocument(); };
if (sim) {
this.setPanel(panel);
this.setSection(theSection);
}
this.setHTMLId = function (newHTMLId) {
HTMLId = newHTMLId;
};
this.getHTMLId = function () {
return HTMLId;
};
this.setTextAreaId = function (newTextAreaId) {
textAreaId = newTextAreaId;
};
this.getTextAreaId = function () {
return textAreaId;
};
this.getSetValues = function () {
return setValues;
};
this.setSetValues = function (newSetValues) {
setValues = newSetValues;
return this;
};
this.getSliderBackgroundImage = function () {
return sliderBackgroundImage;
};
this.setSliderBackgroundImage = function (newSliderBackgroundImage) {
sliderBackgroundImage = newSliderBackgroundImage;
return this;
};
this.getSliderImage = function () {
return 'Scripts/Simulator/renderer/images/slider_thumb.png';
};
this.setSliderImage = function (newSliderImage) {
sliderImage = newSliderImage;
return this;
};
this.getOrientation = function () {
return orientation;
};
this.setOrientation = function (newOrientation) {
orientation = newOrientation;
return this;
};
this.getReportMovement = function () {
return reportMovement;
};
this.setReportMovement = function (newReportMovement) {
reportMovement = newReportMovement == 'yes' ? true : false;
return this;
};
this.handleEvent = function (event) {
switch (event.type) {
case 'inputReq':
this.recordInput(this);
break;
case 'info':
switch (event.context) {
case 'sliderValue':
this.setData(this.getModifiedValue(event.data.toString()));
this.onChange(this.getNodeID());
break;
case 'simulatorStateChange':
break;
}
default:
dbg().logWarning(source, 'Unhandled event type received: ' + event.toString());
return;
}
};
this.keyboardNavigateTo = function (elementID, itemID, index) {
if (this.getTextAreaId()) {
var element = simDocument().getElementById(this.getTextAreaId());
if (element) {
var className = element.getAttribute('class');
className = className + ' ' + 'simAreaFocus';
element.setAttribute('class', className);
element.focus();
}
}
};
this.keyboardNavigateAwayFrom = function (elementID, itemID, index) {
if (this.getTextAreaId()) {
var element = simDocument().getElementById(this.getTextAreaId());
if (element) {
var className = element.getAttribute('class');
var index = className.indexOf('simAreaFocus');
if (index > 0)
className = className.substring(0, index - 1);
element.setAttribute('class', className);
element.blur();
}
}
};
this.recordKeyboardSelection = function (elementID, itemID, itemIndex) {
if ((this.getTextAreaId()) && (theSlider != null)) {
var element = simDocument().getElementById(this.getTextAreaId());
if (element) {
var currentValue = element.value;
if (!isNaN(currentValue)) {
var actualValue = theSlider.jsSlider.getMinValue() - 0;
theSlider.setValue(actualValue + (currentValue / theSlider.scaleFactor));
RecordChange(theSlider);
}
element.blur();
}
}
};
this.disableInput = function () {
var element = simDocument().getElementById(this.getNodeID() + 'sliderHolder');
element.disabled = true;
var txtField = simDocument().getElementById(this.getNodeID() + 'slider-value');
txtField.disabled = true;
this.setState('disabled');
if (this.mySlider) {
this.mySlider.lock();
}
};
this.enableInput = function () {
var element = simDocument().getElementById(this.getNodeID() + 'sliderHolder');
element.disabled = false;
var txtField = simDocument().getElementById(this.getNodeID() + 'slider-value');
txtField.disabled = false;
this.setState('enabled');
if (this.mySlider) {
this.mySlider.unlock();
}
};
this.render = function () {
var panelHtml = container;
var labelledByID = this.getSectionID();
var holderDiv = simDocument().createElement('div');
holderDiv.id = this.getNodeID() + 'sliderHolder';
if (this.getOrientation() == 'horizontal') holderDiv.setAttribute('class', 'slider sliderHorizontal');
else holderDiv.setAttribute('class', 'slider sliderVertical');
holderDiv.setAttribute('role', 'group');
if (theSection.getSectionSettings().elementorientation === "horizontal") {
holderDiv.classList.add("inputpanelcell");
}
var label = '';
if (sim.getSpeechEnabled()) {
label = this.getSpeechLabel();
if (!label) {
label = this.getLabel();
if (!label) label = Simulator.Constants.SPEECH_LABEL_PREFIX + label;
else {
label = Section.GetCurrentSectionLabel();
if (!label) label = Simulator.Constants.SPEECH_LABEL_PREFIX + label;
else {
dbg().logFatalError(source, 'Item is speech enabled but no speechLabel, element label, or enclosing section label is specified for ' + this.getName());
return;
}
}
}
}
else {
label = this.getLabel();
if (!label) {
label = ' ';
} else {
label = label + ':';
}
}
var labelElem = simDocument().createElement('span');
labelElem.innerHTML = label;
if (this.getLabel()) {
var labelID = this.createLabelID();
labelElem.id = labelID;
labelledByID = labelledByID + ' ' + labelID;
labelElem.setAttribute('aria-label', this.getLabel());
}
var txtAreaDiv = simDocument().createElement('div');
txtAreaDiv.setAttribute('class', 'slider-label-area');
var txtAreaInput = simDocument().createElement('input');
txtAreaInput.id = this.getNodeID() + 'slider-value';
this.txtAreaId = txtAreaInput.id;
this.setTextAreaId(txtAreaInput.id);
txtAreaInput.type = 'text';
txtAreaInput.size = utils().getNumberLength(this.getMaxValue());
txtAreaInput.maxlength = txtAreaInput.size;
txtAreaInput.autocomplete = 'off';
txtAreaInput.value = this.getDefaultValue();
txtAreaInput.setAttribute('class', 'slider-text-area');
txtAreaInput.setAttribute('aria-labelledby', labelledByID);
utils().bindEvent(txtAreaInput, 'change', function () {
var currentValue = txtAreaInput.value;
if (!isNaN(currentValue)) {
var actualValue = theSlider.jsSlider.getMinValue() - 0;
theSlider.setValue(actualValue + Math.round(currentValue / theSlider.scaleFactor));
RecordChange(theSlider);
}
});
utils().bindEvent(txtAreaInput, 'keypress', function (event) {
var key = event.keyCode;
if (key == 13) {
var currentValue = txtAreaInput.value;
if (!isNaN(currentValue)) {
var actualValue = theSlider.jsSlider.getMinValue() - 0;
theSlider.setValue(actualValue + Math.round(currentValue / theSlider.scaleFactor));
RecordChange(theSlider);
}
} else {
var validKey = that.onKeyPressHandler(event);
if (!validKey) {
if (event.preventDefault) {
event.preventDefault();
} else {
event.returnValue = false;
}
}
}
});
var txtAreaUM = null;
if (this.getUnits()) {
txtAreaUM = simDocument().createElement('label');
txtAreaUM.setAttribute('for', txtAreaInput.id);
txtAreaUM.innerHTML = this.getUnits();
var unitsID = this.createUnitsID();
txtAreaUM.id = unitsID;
txtAreaInput.setAttribute('aria-describedby', unitsID);
}
if (this.isFocusable()) keyboardInput().addFocusableElementItem(this, this.getNodeID(), txtAreaInput.id);
var minMaxDiv = simDocument().createElement('div');
minMaxDiv.setAttribute('class', 'slider-min-max');
var minValSpan = simDocument().createElement('span');
minMaxDiv.appendChild(minValSpan);
minValSpan.innerHTML = this.getMinValue() + '  ';
minValSpan.setAttribute('class', 'yui-slider-min');
minValSpan.setAttribute('role', 'presentation');
var maxValSpan = simDocument().createElement('span');
minMaxDiv.appendChild(maxValSpan);
maxValSpan.setAttribute('class', 'yui-slider-max');
maxValSpan.setAttribute('role', 'presentation');
maxValSpan.innerHTML = '  ' + this.getMaxValue();
var image = this.getImage();
var imageDiv = null;
if (image != null && image != undefined) {
imageDiv = simDocument().createElement('div');
imageDiv.setAttribute('class', 'slider withImages');
imageDiv.setAttribute('id', this.getName());
var imageHolder = simDocument().createElement('span');
imageHolder.setAttribute('class', 'holderImage');
var imageElement = simDocument().createElement('img');
imageElement.setAttribute('src', image);
imageHolder.appendChild(imageElement);
imageDiv.appendChild(imageHolder);
}
var bgDivId = this.getNodeID() + 'DivBG';
var sliderDiv = simDocument().createElement('div');
sliderDiv.id = bgDivId;
sliderDiv.setAttribute('class', 'yui-h-slider');
sliderDiv.tabindex = '-1';
sliderDiv.title = 'Slider';
this.setHTMLId(sliderDiv.id);
var sliderThumbDiv = simDocument().createElement('div');
var thumbDivId = this.getNodeID() + 'ThumbDiv';
sliderThumbDiv.id = thumbDivId;
sliderThumbDiv.setAttribute("class", "yui-slider-thumb");
sliderThumbDiv.setAttribute('class', 'yui-slider-thumb');
sliderThumbDiv.setAttribute('aria-labelledby', labelledByID);
sliderThumbDiv.setAttribute('aria-valuenow', this.getDefaultValue());
sliderThumbDiv.setAttribute('aria-valuemax', this.getMaxValue());
sliderThumbDiv.setAttribute('aria-valuemin', this.getMinValue());
sliderThumbDiv.setAttribute('role', 'slider');
sliderThumbDiv.setAttribute('tabindex', 0);
panelHtml.appendChild(holderDiv);
txtAreaDiv.appendChild(labelElem);
txtAreaDiv.appendChild(txtAreaInput);
if (txtAreaUM) {
txtAreaDiv.appendChild(txtAreaUM);
}
sliderDiv.appendChild(sliderThumbDiv);
holderDiv.appendChild(txtAreaDiv);
holderDiv.appendChild(minMaxDiv);
holderDiv.appendChild(sliderDiv);
if (imageDiv != null) {
holderDiv.appendChild(imageDiv);
}
this.sliderDiv = sliderDiv.id;
this.sliderThumbDiv = sliderThumbDiv.id;
this.startConstraint = startConstraint;
this.endConstraint = endConstraint;
this.sliderDivId = sliderDiv.id;
this.sliderThumbDivId = sliderThumbDiv.id;
sim.getSliderPreRenderQueue().add(this);
this.recordInput(this, true);
this.setPrevValue(this.getDefaultValue());
this.mapHTML2JS(holderDiv);
};
this.onKeyPressHandler = function (event) {
var char = null, match = null;
if (event.which == null) {
char = String.fromCharCode(event.keyCode);
}
else if (event.which != 0 && event.charCode != 0) {
char = String.fromCharCode(event.which);
}
else {
return true;
}
match = char.match(/[0-9]/);
return !!match;
};
this.getHTMLElement = function (id) {
return simDocument().getElementById(this.getNodeID() + 'DivBG');
};
this.getHTMLSlider = function () {
return theSlider;
};
this.setFocusable(true, true);
this.postContainerRender = function () {
var inc = this.getIncrement();
var scaleFactor = (this.getMaxValue() - this.getMinValue()) / endConstraint;
inc = inc / scaleFactor;
this.scaleFactor = scaleFactor;
if (this.getOrientation() == 'horizontal') {
theSlider = YAHOO.widget.Slider.getHorizSlider(this.sliderDivId,
this.sliderThumbDivId, startConstraint, endConstraint, inc);
} else {
theSlider = YAHOO.widget.Slider.getVertSlider(this.sliderDivId,
this.sliderThumbDivId, startConstraint, endConstraint, inc);
}
this.mySlider = theSlider;
this.prevValue = this.getDefaultValue();
theSlider.setValue(Math.abs(this.getDefaultValue() - this.getMinValue()) / scaleFactor, false, true, true);
theSlider.valTxtField = this.txtAreaInput;
theSlider.jsSlider = this;
theSlider.scaleFactor = this.scaleFactor;
theSlider.subscribe('change', function () { RecordChange(theSlider); });
theSlider.subscribe('slideEnd', function () { SliderEnd(theSlider); });
theSlider.animate = false;
var id = this.txtAreaId;
var node = simDocument().getElementById(id);
node.value = this.getDefaultValue();
};
this.setAttributes = function (attr, node) {
if (node) attr = utils().getAttributes(node);
Simulator.Input.SimSlider.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'orientation':
this.setOrientation(attr[i]);
break;
case 'sliderBackgroundImage':
this.setSliderBackgroundImage(attr[i]);
break;
case 'sliderImage':
this.setSliderImage(attr[i]);
break;
case 'imagePath':
this.setSliderImagePath(attr[i]);
break;
case 'multModifier':
this.setMultModifier(attr[i]);
break;
case 'addModifier':
this.setAddModifier(attr[i]);
break;
case 'valueModifier':
this.setValueModifier(attr[i]);
break;
case 'reportMovement':
this.setReportMovement(attr[i]);
break;
}
}
if (this.getScoreable()) scoringTable().addElement(this.getName(), 'input');
};
this.getSourceName = function () {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
if (!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) (force === null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
};
var SSFixRoundError = function (val, inc) {
if (inc) {
var rem = val % inc;
if (rem) {
val = val + (inc - rem);
}
}
return val;
};
var RecordChange = function (slider) {
var jsSlider = slider.jsSlider;
var actualValue = Math.round(slider.getValue());
actualValue = actualValue * slider.scaleFactor;
if (actualValue < 0)
actualValue = 0;
var offset = jsSlider.getMinValue() - 0;
actualValue = actualValue + offset;
actualValue = SSFixRoundError(actualValue, jsSlider.getIncrement());
var id = jsSlider.txtAreaId;
var node = simDocument().getElementById(id);
node.value = actualValue;
var sliderNode = simDocument().getElementById(jsSlider.sliderThumbDivId);
sliderNode.setAttribute('aria-valuenow', actualValue);
if (jsSlider.getReportMovement()) {
jsSlider.setData(actualValue);
jsSlider.recordInput(jsSlider);
instance.onChange(jsSlider.getNodeID());
}
};
var SliderEnd = function (slider) {
var jsSlider = slider.jsSlider;
var actualValue = Math.round(slider.getValue() * slider.scaleFactor);
if (actualValue < 0)
actualValue = 0;
var offset = slider.jsSlider.getMinValue() - 0;
actualValue = actualValue + offset;
actualValue = SSFixRoundError(actualValue, jsSlider.getIncrement());
var id = jsSlider.txtAreaId;
var node = simDocument().getElementById(id);
node.value = actualValue;
if (jsSlider.prevValue != actualValue) {
jsSlider.setData(jsSlider.getModifiedValue(actualValue) + '');
jsSlider.recordInput(jsSlider);
instance.onChange(jsSlider.getNodeID());
jsSlider.prevValue = actualValue;
}
};
this.setElementSelectState = function(state, contents) {
var value = parseFloat(contents);
if(value >= this.getMinValue() && value <= this.getMaxValue() && value % this.getIncrement() == 0) {
this.setData(contents);
this.setDefaultValue(contents);
setHTMLValue(this.getNodeID(), this.getData());
this.recordInput(this, true);
}
};
var setHTMLValue = function(id, value) {
var htmlElement = simDocument().getElementById(id);
if (!htmlElement) htmlElement = simDocument().getElementById(id + 'slider-value');
if (htmlElement) htmlElement.value = value;
if (!isNaN(value)) {
var actualValue = theSlider.jsSlider.getMinValue() - 0;
theSlider.setValue(actualValue + Math.round(value / theSlider.scaleFactor));
RecordChange(theSlider);
}
};
var debug = function (str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
};
var debugf = function (str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
};
}
Simulator.Input.SimSlider.prototype = new Simulator.Input.FieldSet();
Simulator.Input.SimSlider.parent = Simulator.Input.FieldSet;
Simulator.Input.SimSlider.prototype.constructor = Simulator.Input.SimSlider;

/* SOURCE FILE: TextField2.js (6a4143a0) 9/9/2014 2:09:04 PM */

Simulator.Input.TextField = function(sim, node, panel, theSection, container) {
Simulator.Input.InputElement.call(this, sim);
var that = this;
var source = 'TextField';
var userEditable = true;
var prevStyle = {};
var displayLabel = true;
var text = '';
var typeInputAllowed = 'textOnly';
var fieldLength = 7;
var textCache = '';
var dbg = function() { return sim.getDebug(); };
var utils = function() { return sim.getUtils(); };
var eventMgr = function () { return sim.getEventManager(); };
var simDocument = function () { return sim.getSimDocument(); };
var keyboardInput = function () { return sim.getKeyboardInput(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
var scoringTable = function () { return sim.getScoringTable(); };
if(sim) {
this.setPanel(panel);
this.setSection(theSection);
}
eventMgr().registerEvent(new Simulator.Event(this, 'info', 'animationThreadFinished'), 'to');
this.getUserEditable = function () {
return userEditable;
};
this.setUserEditable = function (newUserEditable) {
userEditable = newUserEditable == 'yes' ? true : false;
return this;
};
this.getDisplayLabel = function () {
return displayLabel;
};
this.setDisplayLabel = function (newDisplayLabel) {
displayLabel = newDisplayLabel == 'yes' ? true : false;
return this;
};
this.getText = function () {
return transDictionary().translate(text);
};
this.setText = function (newText) {
text = newText;
this.setData(newText);
return this;
};
this.setTypeInputAllowed = function (typeInput) {
typeInputAllowed = typeInput;
};
this.getTypeInputAllowed = function () {
return typeInputAllowed;
};
this.getFieldLength = function () {
return fieldLength;
};
this.setFieldLength = function (newLength) {
fieldLength = parseInt(newLength);
return this;
};
this.saveState = function (indent, preface, nameStr, valStr, suffix) {
var data = this.getData();
if (data != '') return indent + preface + nameStr + this.getName() + valStr + data + suffix;
else return '';
};
this.setElementSelectState = function (state, contents) {
this.setData(contents);
this.recordInput(this, true);
};
this.disableInput = function () {
var element = simDocument().getElementById(this.getNodeID());
element.disabled = true;
this.setState('disabled');
};
this.enableInput = function () {
var element = simDocument().getElementById(this.getNodeID());
element.disabled = false;
this.setState('enabled');
};
this.setTextCache = function (cacheText) {
textCache = cacheText;
};
this.handleEvent = function (event) {
switch (event.type) {
case 'inputReq':
this.recordInput(this);
break;
case 'info':
switch (event.context) {
case 'simulatorStateChange':
break;
case 'animationThreadFinished':
this.setData(textCache);
this.recordInput();
textCache = '';
break;
}
break;
default:
dbg().logWarning(source, 'Unhandled event type received: ' + event.toString());
return;
}
};
this.keyboardNavigateTo = function (elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
if (element) {
prevStyle.color = element.style.borderColor;
prevStyle.width = element.style.borderWidth;
prevStyle.style = element.style.borderStyle;
element.style.borderStyle = 'solid';
element.style.borderWidth = '2px';
element.style.borderColor = '#FF9100';
}
element.focus();
};
this.keyboardNavigateAwayFrom = function (elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
if (element) {
element.style.borderStyle = prevStyle.style;
element.style.borderWidth = prevStyle.width;
element.style.borderColor = prevStyle.color;
element.blur();
}
};
this.recordKeyboardSelection = function (elementID, itemID, itemIndex) {
var element = null;
element = simDocument().getElementById(elementID);
if (element) {
element.style.borderStyle = prevStyle.style;
element.style.borderWidth = prevStyle.width;
element.style.borderColor = prevStyle.color;
element.isSelected = true;
this.setSelectStateViaKeyboard(elementID, itemID);
this.onChange(elementID);
element.blur();
}
};
this.setAttributes = function (attr, node) {
if (node) attr = utils().getAttributes(node);
Simulator.Input.TextField.prototype.setAttributes.call(this, attr, node);
for ( var i in attr) {
try {
switch (i) {
case 'initialText':
this.setText(attr[i]);
break;
case 'userEditable':
this.setUserEditable(attr[i]);
break;
case 'displayLabel':
this.setDisplayLabel(attr[i]);
break;
case 'fieldLength':
this.setFieldLength(attr[i]);
break;
case 'typeInputAllowed':
this.setTypeInputAllowed(attr[i]);
break;
}
} catch(err) {
dbg().logError(source, 'Error occurred getting TextField attribute ' + i + ': ' + err.message);
}
}
if(this.getScoreable()) {
sim.getScoringTable().addElement(this.getName(), 'input');
}
};
this.render = function() {
var nodeID = this.getNodeID();
var panelHtml = container;
var brElement1 = simDocument().createElement('br');
panelHtml.appendChild(brElement1);
var brElement2 = simDocument().createElement('br');
panelHtml.appendChild(brElement2);
var divElement = simDocument().createElement('div');
divElement.setAttribute('class', 'textFieldWrapper withImages');
var image = this.getImage();
if (image != null && image != undefined) {
var spanElement1 = simDocument().createElement('span');
spanElement1.setAttribute('class', 'holderImage');
var imgElement = simDocument().createElement('img');
imgElement.setAttribute('src', image);
imgElement.setAttribute('alt', this.getName());
spanElement1.appendChild(imgElement);
divElement.appendChild(spanElement1);
}
var spanElement2 = simDocument().createElement('span');
spanElement2.setAttribute('class', 'textFieldContainer');
spanElement2.innerHTML = this.getLabel();
var inputEl = simDocument().createElement('input');
inputEl.setAttribute('type', 'text');
inputEl.id = nodeID;
inputEl.setAttribute('value', this.getText());
inputEl.onkeydown = 'return false;';
utils().bindEvent(inputEl, 'keypress', function (event) {
var validKey = that.onKeyPressHandler(nodeID, event);
if (!validKey) {
if (event.preventDefault) {
event.preventDefault();
} else {
event.returnValue = false;
}
}
});
utils().bindEvent(inputEl, 'change', function () {
that.changeInValue(nodeID);
});
inputEl.setAttribute('size', this.getFieldLength());
inputEl.setAttribute('maxlength', this.getFieldLength());
spanElement2.appendChild(inputEl);
divElement.appendChild(spanElement2);
if (theSection.getSectionSettings().elementorientation === "horizontal") {
divElement.classList.add("inputpanelcell");
}
panelHtml.appendChild(divElement);
this.recordInput(this, true);
this.setFocusable(true, true);
if(this.isFocusable()) {
keyboardInput().addFocusableElementItem(this, nodeID);
}
this.mapHTML2JS(divElement);
};
this.changeInValue = function(id) {
if(id) {
var htmlElement = simDocument().getElementById(id);
this.setData(htmlElement.value);
this.recordInput();
eventMgr().postEvent(new Simulator.Event(this, 'info', 'inputAvailable', null, false));
}
};
var numLockKeyCode = 144;
var numLockPressed = false;
this.onKeyPressHandler = function (id, event) {
var char = null, match = null;
if (event.which == null) {
char = String.fromCharCode(event.keyCode);
}
else if (event.which != 0 && event.charCode != 0) {
char = String.fromCharCode(event.which);
}
else {
return true;
}
switch(this.getTypeInputAllowed()) {
case 'alphaOnly':
match = char.match(/[a-z\.]/i);
return !!match;
break;
case 'numericOnly':
match = char.match(/[0-9\.\+\-]/);
return !!match;
break;
case 'alphaNumericOnly':
match = char.match(/[a-z0-9\.\+\-]/i);
return !!match;
break;
case 'textOnly':
return true;
break;
default:
return true;
break;
}
};
this.getSourceName = function() {
return source;
};
this.inspect = function(embedded, force) {
var buff = [];
var sep = '\n\n';
if (!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for ( var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) (force === null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
};
var debug = function(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
};
var debugf = function(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
};
};
Simulator.Input.TextField.prototype = new Simulator.Input.InputElement();
Simulator.Input.TextField.parent = Simulator.Input.InputElement;
Simulator.Input.TextField.prototype.constructor = Simulator.Input.TextField;

/* SOURCE FILE: StaticElement2.js (5438e893) 9/9/2014 2:09:04 PM */

Simulator.Input.StaticElement = function (sim) {
Simulator.SimElement.call(this, sim);
var panel = null;
var section = null;
this.getPanel = function() {
return panel;
};
this.setPanel = function(newPanel) {
panel = newPanel;
return this;
};
this.setSection = function(theSection) {
section = theSection;
};
this.saveState = function(indent, preface, nameStr, valStr, suffix) {
return indent + preface + nameStr + this.getName() + valStr + checkedItems + suffix;
};
};
Simulator.Input.StaticElement.prototype = new Simulator.SimElement();
Simulator.Input.StaticElement.parent = Simulator.SimElement;
Simulator.Input.StaticElement.prototype.constructor = Simulator.Input.StaticElement;

/* SOURCE FILE: VerticalSpace2.js (4fa202e7) 9/9/2014 2:09:04 PM */

Simulator.Input.VerticalSpace = function (sim, panel, theSection, container) {
Simulator.Input.StaticElement.call(this, sim);
var source = 'VerticalSpace';
var lines = 0;
var dbg = function () { return sim.getDebug(); };
var utils = function() { return sim.getUtils(); };
var simDocument = function() { return sim.getSimDocument(); };
if(sim) {
this.setPanel(panel);
this.setSection(theSection);
}
this.setLines = function(newLines) {
lines = parseInt(newLines);
};
this.getLines = function() {
return lines;
};
this.setAttributes = function (attr, node) {
if (node) attr = utils().getAttributes(node);
Simulator.Input.VerticalSpace.prototype.setAttributes(attr);
for (var i in attr) {
switch (i) {
case 'lines':
this.setLines(attr[i]);
break;
}
}
};
this.render = function () {
var panelHtml = container;
var divElement = simDocument().createElement('div');
divElement.style.paddingBottom = 20 * this.getLines() + 'px';
panelHtml.appendChild(divElement);
this.setFocusable(false);
this.mapHTML2JS(divElement);
};
this.getSourceName = function() {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
if (!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) (force === null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Input.VerticalSpace.prototype = new Simulator.Input.StaticElement();
Simulator.Input.VerticalSpace.parent = Simulator.Input.StaticElement;
Simulator.Input.VerticalSpace.prototype.constructor = Simulator.Input.VerticalSpace;

/* SOURCE FILE: HorizontalLine2.js (95c55aae) 9/9/2014 2:09:04 PM */

Simulator.Input.HorizontalLine = function (sim, panel, theSection, container) {
Simulator.Input.StaticElement.call(this, sim);
var source = 'HorizontalLine';
var dbg = function () { return sim.getDebug(); };
var utils = function () { return sim.getUtils(); };
var simDocument = function () { return sim.getSimDocument(); };
if (sim) {
this.setPanel(panel);
this.setSection(theSection);
}
var height = 0;
this.setHeight = function (newHeight) {
height = parseInt(newHeight);
};
this.getHeight = function () {
return height;
};
var width = 1;
this.setWidth = function (newWidth) {
width = parseInt(newWidth);
};
this.getWidth = function () {
return width;
};
var alignment = 'absolute';
this.setAlignment = function (newAlignment) {
alignment = newAlignment;
};
this.getAlignment = function () {
return alignment;
};
var distance = 0;
this.setDistance = function (newDistance) {
distance = newDistance;
};
this.getDistance = function () {
return distance;
};
var ownSpace = true;
this.setOwnSpace = function (newOwnSpace) {
ownSpace = newOwnSpace == 'yes' ? true : false;
};
this.getOwnSpace = function () {
return ownSpace;
};
this.setAttributes = function (attr, node) {
if (node) attr = utils().getAttributes(node);
Simulator.Input.HorizontalLine.prototype.setAttributes(attr);
for (var i in attr) {
switch (i) {
case 'name':
this.setName(attr[i]);
break;
case 'width':
this.setWidth(attr[i]);
break;
case 'height':
this.setHeight(attr[i]);
break;
case 'alignment':
this.setAlignment(attr[i]);
break;
case 'distance':
this.setDistance(attr[i]);
break;
case 'ownSpace':
this.setOwnSpace(attr[i]);
break;
}
}
};
this.render = function () {
var panelHtml = container;
spanElement = simDocument().createElement('span');
spanElement.id = 'horizontalLine';
if (this.getAlignment() == 'left') {
spanElement.setAttribute('class', 'sim_divider sim_divider_left');
if (this.getDistance() != null) spanElement.style.marginLeft = this.getDistance() + 'px';
} else if (this.getAlignment() == 'right') {
spanElement.setAttribute('class', 'sim_divider sim_divider_right');
if (this.getDistance() != null) spanElement.style.marginRight = this.getDistance() + 'px';
} else {
spanElement.setAttribute('class', 'sim_divider sim_divider_center');
}
if (this.getWidth() != null) spanElement.style.width = this.getWidth() + "px";
if (this.getHeight() != null) spanElement.style.height = this.getHeight() + "px";
if (this.getOwnSpace()) spanElement.style.clear = 'both';
panelHtml.appendChild(spanElement);
this.setFocusable(false);
this.mapHTML2JS(spanElement);
};
this.getSourceName = function () {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
if (!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) (force == null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
}
Simulator.Input.HorizontalLine.prototype = new Simulator.Input.StaticElement();
Simulator.Input.HorizontalLine.parent = Simulator.Input.StaticElement;
Simulator.Input.HorizontalLine.prototype.constructor = Simulator.Input.HorizontalLine;

/* SOURCE FILE: SectionDivider2.js (9b052ea0) 9/9/2014 2:09:04 PM */

Simulator.Input.SectionDivider = function (sim, panel, theSection, container) {
Simulator.Input.StaticElement.call(this, sim);
var source = 'SectionDivider';
var dbg = function () { return sim.getDebug(); };
var utils = function () { return sim.getUtils(); };
var simDocument = function () { return sim.getSimDocument(); };
if (sim) {
this.setPanel(panel);
this.setSection(theSection);
}
this.setAttributes = function (attr, node) {
if (node) attr = utils().getAttributes(node);
Simulator.Input.SectionDivider.prototype.setAttributes(attr);
for (var i in attr) {
switch (i) {
case 'name':
this.setName(attr[i]);
break;
}
}
};
this.render = function () {
var panelHtml = container;
divElement = simDocument().createElement('div');
divElement.id = 'hrHolder';
divElement.setAttribute('class', 'hrHolder');
var hrElement = simDocument().createElement('hr');
divElement.appendChild(hrElement);
panelHtml.appendChild(divElement);
this.setFocusable(false);
this.mapHTML2JS(divElement);
};
this.getSourceName = function () {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
if (!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) (force == null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
}
Simulator.Input.SectionDivider.prototype = new Simulator.Input.StaticElement();
Simulator.Input.SectionDivider.parent = Simulator.Input.StaticElement;
Simulator.Input.SectionDivider.prototype.constructor = Simulator.Input.SectionDivider;

/* SOURCE FILE: UpDownCounter2.js (0d6dad31) 10/26/2014 1:27:05 PM */

Simulator.Input.UpDownCounter = function (sim, node, panel, theSection, container) {
Simulator.Input.FieldSet.call(this, sim);
var that = this;
var source = 'UpDownCounter';
var setValues = [];
var interButtonDelay = true;
var interButtonDelay = true;
var setValues = [];
var actOnChangeWithMouseout = false;
var dbg = function () { return sim.getDebug(); };
var utils = function () { return sim.getUtils(); };
var simDocument = function () { return sim.getSimDocument(); };
var scoringTable = function () { return sim.getScoringTable(); };
var keyboardInput = function () { return sim.getKeyboardInput(); };
if (sim) {
this.setPanel(panel);
this.setSection(theSection);
}
this.getSetValues = function () {
return setValues;
};
this.setsetValues = function (newsetValues) {
setValues = newsetValues;
return this;
};
this.setInterButtonDelay = function (newInterButtonDelay) {
interButtonDelay = newInterButtonDelay == true || newInterButtonDelay == 'yes' ? true : false;
return this;
};
this.getInterButtonDelay = function () {
return interButtonDelay;
};
this.handleEvent = function (event) {
switch (event.type) {
case 'inputReq':
this.recordInput(this);
break;
case 'info':
switch (event.context) {
case 'simulatorStateChange':
break;
}
break;
default:
dbg().logWarning(source, 'Unhandled event type received: ' + event.toString());
return;
}
};
this.setActOnChangeWithMouseout = function (newActOnChangeWithMouseout) {
actOnChangeWithMouseout = newActOnChangeWithMouseout == 'yes' ? true : false;
};
this.getActOnChangeWithMouseout = function () {
return actOnChangeWithMouseout;
};
this.keyboardNavigateTo = function (elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
var spanElement = element.getElementsByTagName('span')[0];
var upDownSpanElement = spanElement.getElementsByClassName('upDown')[0];
var item = element.getElementsByClassName(itemID)[0];
if (item) item.setAttribute('class', itemID + ' simAreaFocus');
}
this.keyboardNavigateAwayFrom = function (elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
var spanElement = element.getElementsByTagName('span')[0];
var upDownSpanElement = spanElement.getElementsByClassName('upDown')[0];
var item = element.getElementsByClassName(itemID)[0];
if (item) item.setAttribute('class', itemID);
}
this.recordKeyboardSelection = function (elementID, itemID, itemIndex) {
if ((itemID) && (elementID)) {
if (itemIndex == 0) {
this.incrementValue(this.getNodeID(), this.getMaxValue(), this.getIncrement());
}
else if (itemIndex == 1) {
this.decrementValue(this.getNodeID(), this.getMinValue(), this.getIncrement());
}
}
};
this.receivedSpeechFocus = function () {
debug(this.getName() + ' received speech focus');
var node = simDocument().getElementById('incrementalWrapper' + this.getNodeID());
node.style.border = 'thin solid #ff0000';
};
this.removeSpeechFocus = function (value) {
debug(this.getName() + ' lost speech focus');
var node = simDocument().getElementById('incrementalWrapper' + this.getNodeID());
prevBorders = node.borders;
node.style.border = 'none';
};
this.disableInput = function () {
var component = simDocument().getElementById('goingUp' + this.getNodeID());
component.disabled = true;
component = simDocument().getElementById('goingDown' + this.getNodeID());
component.disabled = true;
};
this.enableInput = function () {
var component = simDocument().getElementById('goingUp' + this.getNodeID());
component.disabled = false;
component = simDocument().getElementById('goingDown' + this.getNodeID());
component.disabled = false;
};
this.speechActivated = function (value) {
if (value == 1) this.incrementValue(this.getNodeID(), parseFloat(this.getMaxValue()), parseFloat(this.getIncrement()));
else if (value == -1) this.decrementValue(this.getNodeID(), this.getMinValue(), this.getIncrement());
this.onChange(this.getNodeID());
};
this.setAttributes = function (attr, node) {
if (node) attr = utils().getAttributes(node);
Simulator.Input.UpDownCounter.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'actOnChange':
this.setActOnChange(attr[i]);
break;
case 'actOnChangeWithMouseout':
this.setActOnChangeWithMouseout(attr[i]);
break;
case 'interButtonDelay':
this.setInterButtonDelay(attr[i]);
break;
case 'multModifier':
this.setMultModifier(attr[i]);
break;
case 'addModifier':
this.setAddModifier(attr[i]);
break;
}
}
if (this.getScoreable()) scoringTable().addElement(this.getName(), 'input');
};
this.render = function () {
var nodeID = this.getNodeID();
var panelHtml = container;
var labelledByID = this.getSectionID();
this.setFocusable(true, true);
var nextNum = utils().getNextSequenceNumber();
var image = this.getImage();
if (this.getSpaceAbove()) {
utils().appendBlankVertcalSpace(panelHtml, this.getSpaceAbove);
}
var needtoShowLabelBelow = false;
needtoShowLabelBelow = true;
var divElement = null;
if (image != null && image != undefined) {
divElement = simDocument().createElement('div');
divElement.id = 'incrementalWrapper' + nodeID;
divElement.setAttribute('class', 'incrementalWrapper withImages');
divElement.setAttribute('role', 'group');
var spanElement = simDocument().createElement('span');
spanElement.setAttribute('class', 'holderImage');
var imageElement = simDocument().createElement('img');
imageElement.setAttribute('src', image);
imageElement.setAttribute('alt', this.getName());
spanElement.appendChild(imageElement);
divElement.appendChild(spanElement);
}
else {
divElement = simDocument().createElement('div');
divElement.id = 'incrementalWrapper' + nodeID;
divElement.setAttribute('class', 'incrementalWrapper');
divElement.setAttribute('role', 'group');
if (sim.getSpeechEnabled()) {
divElement.setAttribute('style', 'padding-bottom: 40px');
}
}
var containerSpanElement = simDocument().createElement('span');
containerSpanElement.setAttribute('class', 'incrementalContainer');
var inputElement = simDocument().createElement('input');
inputElement.id = nodeID;
inputElement.setAttribute('readonly', 'readonly');
inputElement.setAttribute('name', 'number' + nodeID);
inputElement.setAttribute('value', this.getDefaultValue());
inputElement.setAttribute('type', 'text');
containerSpanElement.appendChild(inputElement);
var labelElement = simDocument().createElement('label');
labelElement.setAttribute('for', nextNum);
labelElement.innerHTML = this.getUnits();
containerSpanElement.appendChild(labelElement);
var upDownSpanElement = simDocument().createElement('span');
upDownSpanElement.setAttribute('class', 'upDown');
var inputGoingUpElement = simDocument().createElement('input');
inputGoingUpElement.id = 'goingUp' + nodeID;
inputGoingUpElement.setAttribute('class', 'goingUp');
utils().bindEvent(inputGoingUpElement, 'click', function () {
that.incrementValue(nodeID, that.getMaxValue(), that.getIncrement());
});
if (this.getActOnChangeWithMouseout()) {
utils().bindEvent(inputGoingUpElement, 'mouseout', function () {
that.PotentialChangeInValue(nodeID);
});
if (this.getInterButtonDelay()) {
utils().bindEvent(inputGoingUpElement, 'mouseover', function () {
that.CancelNoChange(nodeID);
});
}
}
inputGoingUpElement.setAttribute('type', 'button');
inputGoingUpElement.setAttribute('title', 'increase count');
upDownSpanElement.appendChild(inputGoingUpElement);
if (sim.getSpeechEnabled()) {
var textLabelElement1 = simDocument().createTextNode(' Increment');
upDownSpanElement.appendChild(textLabelElement1);
}
var inputGoingDownElement = simDocument().createElement('input');
inputGoingDownElement.id = 'goingDown' + nodeID;
inputGoingDownElement.setAttribute('class', 'goingDown');
utils().bindEvent(inputGoingDownElement, 'click', function () {
that.decrementValue(nodeID, that.getMinValue(), that.getIncrement());
});
if (this.getActOnChangeWithMouseout()) {
utils().bindEvent(inputGoingDownElement, 'mouseout', function () {
that.PotentialChangeInValue(nodeID);
});
if (this.getInterButtonDelay()) {
utils().bindEvent(inputGoingDownElement, 'mouseover', function () {
that.CancelNoChange(nodeID);
});
}
}
inputGoingDownElement.setAttribute('type', 'button');
inputGoingDownElement.setAttribute('title', 'decrease count');
upDownSpanElement.appendChild(inputGoingDownElement);
if (sim.getSpeechEnabled()) {
var textLabelElement2 = simDocument().createTextNode(' Decrement');
upDownSpanElement.appendChild(textLabelElement2);
}
containerSpanElement.appendChild(upDownSpanElement);
divElement.appendChild(containerSpanElement);
if (theSection.getSectionSettings().elementorientation === "horizontal") {
divElement.classList.add("inputpanelcell");
}
panelHtml.appendChild(divElement);
if (needtoShowLabelBelow) {
if (this.getLabel()) {
var h5LabelElement = simDocument().createElement('h5');
var h5ID = this.createLabelID();
h5LabelElement.id = h5ID;
labelledByID = labelledByID + ' ' + h5ID;
h5LabelElement.innerHTML = this.getLabel();
divElement.appendChild(h5LabelElement);
}
}
inputElement.setAttribute('aria-labelledby', labelledByID);
inputGoingUpElement.setAttribute('aria-labelledby', labelledByID);
inputGoingDownElement.setAttribute('aria-labelledby', labelledByID);
inputGoingUpElement.setAttribute('aria-valuenow', this.getDefaultValue());
inputGoingUpElement.setAttribute('aria-valuemax', this.getMaxValue());
inputGoingUpElement.setAttribute('aria-valuemin', this.getMinValue());
inputGoingDownElement.setAttribute('aria-valuenow', this.getDefaultValue());
inputGoingDownElement.setAttribute('aria-valuemax', this.getMaxValue());
inputGoingDownElement.setAttribute('aria-valuemin', this.getMinValue());
if (this.isFocusable()) {
keyboardInput().addFocusableElementItem(this, divElement.id, 'goingUp');
keyboardInput().addFocusableElementItem(this, divElement.id, 'goingDown');
}
if (this.getSpaceBelow()) {
utils().appendBlankVertcalSpace(panelHtml, this.getSpaceBelow());
}
this.recordInput(this, true);
this.setPrevValue(this.getDefaultValue());
this.mapHTML2JS(divElement);
};
var theCounterID = null;
var prevCounterID = null;
var movementInterval = 50;
var t = null;
this.PotentialChangeInValue = function (id) {
var element = simDocument().getElementById(id);
prevCounterID = theCounterID == null ? id : theCounterID;
theCounterID = id;
if (this.getInterButtonDelay()) {
t = setTimeout(function () { that.ChangeInValue(); }, movementInterval);
} else this.ChangeInValue();
};
this.CancelNoChange = function () {
if (theCounterID == prevCounterID) clearTimeout(t);
};
this.ChangeInValue = function () {
if (theCounterID) {
var htmlElement = simDocument().getElementById(theCounterID);
if (this.getPrevValue() != htmlElement.value) {
this.setPrevValue(this.getData());
this.onChange(theCounterID);
}
theCounterID = null;
}
};
this.incrementValue = function (id, maxValue, increment) {
var htmlElement = simDocument().getElementById(id);
var upElement = htmlElement.parentNode.getElementsByTagName('span')[0].getElementsByClassName('goingUp')[0];
var downElement = htmlElement.parentNode.getElementsByTagName('span')[0].getElementsByClassName('goingDown')[0];
currentValue = parseFloat(htmlElement.value);
if ((currentValue + parseFloat(increment)) <= maxValue) {
currentValue = parseFloat((currentValue + parseFloat(increment)).toFixed(10));
}
htmlElement.value = currentValue;
currentValue = this.getModifiedValue(currentValue);
currentValue = currentValue.toString();
upElement.setAttribute('aria-valuenow', currentValue);
downElement.setAttribute('aria-valuenow', currentValue);
this.setData(currentValue);
valueChanged = true;
if (this.getSaveOnChange()) this.onChange(this.getNodeID());
};
this.decrementValue = function (id, minValue, decrement) {
var htmlElement = simDocument().getElementById(id);
var upElement = htmlElement.parentNode.getElementsByTagName('span')[0].getElementsByClassName('goingUp')[0];
var downElement = htmlElement.parentNode.getElementsByTagName('span')[0].getElementsByClassName('goingDown')[0];
currentValue = parseFloat(htmlElement.value);
if ((currentValue - parseFloat(decrement)) >= minValue) {
currentValue = parseFloat((currentValue - parseFloat(decrement)).toFixed(10));
}
htmlElement.value = currentValue;
currentValue = this.getModifiedValue(currentValue);
currentValue = currentValue.toString();
upElement.setAttribute('aria-valuenow', currentValue);
downElement.setAttribute('aria-valuenow', currentValue);
this.setData(currentValue);
valueChanged = true;
if (this.getSaveOnChange()) this.onChange(this.getNodeID());
};
this.getSourceName = function () {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
if (!embedded) {
buff.push('Inspecting ');
buff.push(this.getName());
buff.push(sep);
}
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) (force === null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Input.UpDownCounter.prototype = new Simulator.Input.FieldSet();
Simulator.Input.UpDownCounter.parent = Simulator.Input.FieldSet;
Simulator.Input.UpDownCounter.prototype.constructor = Simulator.Input.UpDownCounter;

/* SOURCE FILE: TextConstant2.js (2f547fc3) 9/9/2014 2:09:04 PM */

Simulator.Input.TextConstant = function (sim, panel, theSection, container) {
Simulator.Input.StaticElement.call(this, sim);
var source = 'TextConstant';
var dbg = function () { return sim.getDebug(); };
var utils = function() { return sim.getUtils(); };
var simDocument = function() { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); };
if(sim) {
this.setPanel(panel);
this.setSection(theSection);
}
var text = '';
var heavy = false;
this.setText = function(newText) {
text = newText;
};
this.getText = function () {
return transDictionary().translate(text);
};
this.setHeavy = function(newHeavy) {
if(newHeavy == 'yes') heavy = true;
else heavy = false;
};
this.getHeavy = function() {
return heavy;
};
this.setAttributes = function (attr, node) {
if (node) attr = utils().getAttributes(node);
Simulator.Input.TextConstant.prototype.setAttributes(attr);
for (var i in attr) {
switch (i) {
case 'text':
this.setText(attr[i]);
break;
case 'heavy':
this.setHeavy(attr[i]);
break;
}
}
};
this.render = function () {
var panelHtml =container;
var divElement = simDocument().createElement('div');
if (this.getSpaceAbove() > 0) utils().appendBlankVertcalSpace(divElement, this.getSpaceAbove());
if (theSection.getSectionSettings().elementorientation === "horizontal") {
divElement.classList.add("inputpanelcell");
}
panelHtml.appendChild(divElement);
if (this.getHeavy()) divElement.innerHTML = '<b>' + this.getText() + '</b>';
else divElement.innerHTML = this.getText();
if (this.getSpaceBelow() > 0) utils().appendBlankVertcalSpace(divElement, this.getSpaceBelow());
this.setFocusable(false);
this.mapHTML2JS(divElement);
};
this.getSourceName = function() {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
buff.push('Inspecting TextElement');
buff.push(sep);
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i);
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
if (!embedded) (force === null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Input.TextConstant.prototype = new Simulator.Input.StaticElement();
Simulator.Input.TextConstant.parent = Simulator.Input.StaticElement;
Simulator.Input.TextConstant.prototype.constructor = Simulator.Input.TextConstant;

/* SOURCE FILE: CommandElement2.js (857c2608) 9/9/2014 2:09:04 PM */

Simulator.Control.CommandElement = function (sim) {
Simulator.SimElement.call(this, sim);
var source = 'CommandElement';
var parent = Simulator.SimElement.prototype;
var cmdElementImages = ['image_Trashcan'];
var handler = null;
var state = 'enabled';
var handlerParameters = '';
var alwaysEnabled = false;
var eventsRegistered = false;
var panel = null;
var util = function () { return sim.getUtils(); };
var simMgr = function () { return sim.getSimulationManager(); };
var eventMgr = function () { return sim.getEventManager(); };
var dbg = function () { return sim.getDebug(); };
var simDocument = function() { return sim.getSimDocument(); };
var registerClassEvents = function (instance) {
if (!eventsRegistered) {
eventMgr().registerEvent(new Simulator.Event(instance, 'info', 'simulatorStateChange'));
eventsRegistered = true;
}
};
this.setEname(source);
this.isAPredefinedCmdElementImage = function (imageName) {
return util().elementInArray(cmdElementImages, imageName);
};
this.getState = function () {
return state;
};
this.setState = function (newState) {
if (simMgr().isPlaying() || simMgr().isReadOnly()) state = 'disabled';
else if (newState == 'disabled') {
if (this.getAlwaysEnabled()) state = 'enabled';
else state = newState;
}
else if (newState == 'enabled') {
state = newState;
} else dbg().logFatalError(source, 'Invalid state passed to CommandElement.setState()');
return this;
};
this.keyboardNavigateTo = function (elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
if (element) element.setAttribute('class', element.getAttribute('class') + ' simAreaFocus');
};
this.keyboardNavigateAwayFrom = function (elementID, itemID, index) {
var element = simDocument().getElementById(elementID);
if (element) {
var className = element.getAttribute('class');
var index = className.indexOf('simAreaFocus');
if (index > 0)
className = className.substring(0, index - 1);
element.setAttribute('class', className);
}
};
this.getHandler = function () {
return handler;
};
this.setHandler = function (newHandler) {
handler = newHandler;
return this;
};
this.getHandlerParameters = function () {
return handlerParameters;
};
this.setHandlerParameters = function (newHandlerParameters) {
handlerParameters = newHandlerParameters;
return this;
};
this.setPredefinedImage = function (newImage) {
this.setImage(newImage);
};
this.getAlwaysEnabled = function () {
return alwaysEnabled;
};
this.setAlwaysEnabled = function (newAlwaysEnabled) {
alwaysEnabled = newAlwaysEnabled == 'yes' ? true : false;
return this;
};
this.isDisabled = function () {
return state == 'disabled';
};
this.setPanel = function (thePanel) {
panel = thePanel;
panel.registerIOElement(this);
return this;
};
this.saveState = function(indent, preface, nameStr, valStr, suffix) {
return '';
};
this.getSourceName = function() {
return source;
};
this.inspect = function(embedded, force) {
var buff = [];
var sep = '\n';
buff.push('Inspecting ' + source + sep);
var str = Simulator.Control.CommandElement.prototype.inspect.call(this, true, force);
if (str) return str;
else {
for ( var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i.charAt(3).toLowerCase() + i.slice(4));
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
buff.push('End Inspecting ' + source + sep + sep);
if(!embedded) force == true ? dbg().debugf(source, buff.join('')) : dbg().debug(source, buff.join(''));
else return buff.join('');
}
};
this.setAttributes = function (attr, node) {
Simulator.Control.CommandElement.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'predefinedImage':
this.setPredefinedImage(attr[i]);
break;
case 'handler':
this.setHandler(attr[i]);
break;
case 'handlerParameters':
this.setHandlerParameters(attr[i]);
break;
case 'alwaysEnabled':
this.setAlwaysEnabled(attr[i]);
break;
case 'speechLabel':
this.setSpeechLabel(attr[i]);
break;
}
}
};
if (sim) {
registerClassEvents(this);
}
};
Simulator.Control.CommandElement.prototype = new Simulator.SimElement();
Simulator.Control.CommandElement.parent = Simulator.SimElement;
Simulator.Control.CommandElement.prototype.constructor = Simulator.Control.CommandElement;

/* SOURCE FILE: Button2.js (ea40e08c) 9/9/2014 2:09:04 PM */

Simulator.Control.Button = function (sim, panel, section, container) {
Simulator.Control.CommandElement.call(this, sim);
var source = 'Button';
var instance = this;
var HTMLButton = null;
var src = '';
var implication = 'neutral';
var borderColor = '';
var eventsRegistered = false;
var debouceInterval = 1000;
var lastStartTrialTime = 0;
var genericButtonReady = true;
var startTrialButtonReady = true;
var startAnimationButtonReady = true;
var resetTrialsButtonReady = true;
var newTrialButtonReady = true;
var submitInputButtonReady = true;
var submitItemButtonReady = true;
var requestAnimationOutputButtonReady = true;
var showDialogButtonReady = true;
var showAlertButtonReady = true;
var util = function () { return sim.getUtils(); };
var simMgr = function () { return sim.getSimulationManager(); };
var eventMgr = function () { return sim.getEventManager(); };
var dbg = function () { return sim.getDebug(); };
var speechGrammarBldr = function () { return sim.getSpeechGrammarBldr(); };
var scoringTable = function () { return sim.getScoringTable(); };
var html2jsMap = function () { return sim.getHTML2JSMap(); };
var simDocument = function () { return sim.getSimDocument(); };
var transDictionary = function () { return sim.getTranslationDictionary(); }
var keyboardInput = function () { return sim.getKeyboardInput(); };
var whiteboard = function () { return sim.getWhiteboard(); };
var registerClassEvents = function (instance) {
if (!eventsRegistered) {
eventMgr().registerEvent(new Simulator.Event(instance, 'info', 'animationFinished'));
eventMgr().registerEvent(new Simulator.Event(instance, 'info', 'animationThreadFinished'));
eventsRegistered = true;
}
};
function resetButton(buttonName) {
switch (buttonName) {
case 'generic':
genericButtonReady = true;
break;
case 'startTrial':
startTrialButtonReady = true;
break;
case 'startAnimation':
startAnimationButtonReady = true;
break;
case 'resetTrials':
resetTrialsButtonReady = true;
break;
case 'newTrial':
newTrialButtonReady = true;
break;
case 'submitInput':
submitInputButtonReady = true;
break;
case 'submitItem':
submitItemButtonReady = true;
break;
case 'requestAnimationOutput':
requestAnimationOutputButtonReady = true;
break;
case 'showDialog':
showDialogButtonReady = true;
break;
case 'showAlert':
showAlertButtonReady = true;
break;
case 'speechLabel':
this.setSpeechLabel(attr[i]);
break;
default:
break;
}
};
function publishEvents(jsButton, context) {
var anEvent = jsButton.nextEvent(true);
if (!context) context = '*';
while (anEvent != null) {
if (anEvent.context == context || anEvent.context == '*' || context == '*') {
eventMgr().postEvent(anEvent);
}
anEvent = jsButton.nextEvent();
}
};
this.setEname(source);
if (panel) {
this.setPanel(panel);
}
this.setHTMLButton = function () {
return HTMLButton;
};
this.setHTMLButton = function (newHTMLButton) {
HTMLButton = newHTMLButton;
return this;
};
this.getSrc = function () {
return src;
};
this.setSrc = function (newSrc) {
src = newSrc;
return this;
};
this.getImplication = function () {
return implication;
};
this.setImplication = function (newImplication) {
implication = newImplication;
return this;
};
this.recordKeyboardSelection = function (elementID, itemID) {
if (itemID) {
var handler = this.getHandler();
handler(elementID);
}
};
this.receivedSpeechFocus = function () {
debug(this.getName() + ' received speech focus');
var node = simDocument().getElementById('buttonDiv' + this.getNodeID());
borderColor = node.style.border.color;
node.style.border = '#ff0000';
};
this.removeSpeechFocus = function (value) {
debug(this.getName() + ' lost speech focus');
var node = simDocument().getElementById('buttonDiv' + this.getNodeID());
node.style.border.color = borderColor;
};
this.speechActivated = function (value) {
var handler = 'Button.' + this.getHandler();
eval(handler)(this.getNodeID());
};
this.handleEvent = function (event) {
var newEvent = undefined;
switch (event.type) {
case 'command':
break;
case 'info':
switch (event.context) {
case 'animationThreadFinished':
resetButton('startTrial');
break;
case 'animationFinished':
resetButton('startTrial');
break;
}
break;
default:
dbg().logWarning(this.getName() + ': Unhandled event type received: ' + event.toString());
return;
}
if (newEvent != undefined && newEvent != null) newEvent.postEvent();
};
this.disableInput = function () {
var element = simDocument().getElementById(this.getNodeID());
element.disable = true;
this.setState('disabled');
};
this.enableInput = function () {
var element = simDocument().getElementById(this.getNodeID());
element.disable = false;
this.setState('enabled');
};
this.getSourceName = function () {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n';
buff.push('Inspecting ' + source + ' ' + this.getName() + sep);
var str = Simulator.Control.Button.prototype.inspect.call(this, true, force);
if (str) buff.push(str);
else {
for (var i in this) {
if (i.substr(0, 3) == 'get') {
buff.push(i.charAt(3).toLowerCase() + i.slice(4));
buff.push(' = ');
buff.push(eval('this.' + i + '()'));
buff.push(sep);
}
}
}
buff.push('End inspecting ' + source + ' ' + this.getName() + sep + sep);
if (!embedded) force == true ? debugf(buff.join('')) : debug(buff.join(''));
else return buff.join('');
};
function onClick(id) {
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((genericButtonReady == true) && (!simMgr().isPlaying())) {
if ((newTime - lastStartTrialTime) > debouceInterval) {
lastStartTrialTime = newTime;
genericButtonReady = false;
setTimeout(function () { resetButton("generic"); }, debouceInterval);
if (jsButton.isDisabled()) {
(simMgr().GetDisabledAction())();
}
else {
publishEvents(jsButton);
}
}
}
}
else {
dbg().logWarning(source, '-- Button with id = ' + id + ' could not be activated --');
}
}
else {
dbg().logFatalError(source, 'Could not get Button instance with id = ' + id);
}
};
function StartTrial(id) {
if (!simMgr().verifyCheckListSelection()) {
var newTime = new Date();
var debounceMultiplier = (sim.animationIsPresent()) ? 4 : .5;
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((startTrialButtonReady == true) && (!simMgr().isPlaying()) && !simMgr().isReadOnly()) {
lastStartTrialTime = newTime;
startTrialButtonReady = false;
whiteboard().clearCategory('evaluationOutput');
whiteboard().clearCategory('animationOutput');
setTimeout(function () { resetButton("startTrial"); }, debouceInterval * debounceMultiplier);
publishEvents(jsButton, 'startTrial');
}
}
} else {
dbg().logFatalError(source, 'Could not get Button instance with id = ' + id);
}
}
};
function StartAnimation(id) {
if (!simMgr().verifyCheckListSelection()) {
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((startAnimationButtonReady == true) && (!simMgr().isPlaying()) && !simMgr().isReadOnly()) {
lastStartTrialTime = newTime;
startAnimationButtonReady = false;
whiteboard().clearCategory('evaluationOutput');
whiteboard().clearCategory('animationOutput');
setTimeout(function () { resetButton("startAnimation"); }, debouceInterval * 4);
publishEvents(jsButton, 'startAnimation');
}
}
} else {
dbg().logFatalError(source, 'Could not get Button instance with id = ' + id);
}
}
};
function NewTrial(id) {
if (!simMgr().verifyCheckListSelection()) {
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((newTrialButtonReady == true) && (!simMgr().isPlaying())) {
if ((newTime - lastStartTrialTime) > debouceInterval) {
lastStartTrialTime = newTime;
newTrialButtonReady = false;
setTimeout(function () { resetButton("newTrial"); }, debouceInterval);
if (jsButton.isDisabled()) {
(simMgr().GetDisabledAction())();
}
else {
simMgr().NexTrial();
}
}
}
}
}
}
};
function SubmitInput(id) {
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((submitInputButtonReady == true) && (!simMgr().isPlaying())) {
if ((newTime - lastStartTrialTime) > debouceInterval) {
lastStartTrialTime = newTime;
submitInputButtonReady = false;
setTimeout(function () { resetButton("submitInput"); }, debouceInterval);
if (jsButton.isDisabled()) {
(simMgr().GetDisabledAction())();
}
else {
publishEvents(jsButton, 'submitInput');
}
}
}
}
}
};
function SubmitItem(id) {
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((submitItemButtonReady == true) && (!simMgr().isPlaying())) {
if ((newTime - lastStartTrialTime) > debouceInterval) {
lastStartTrialTime = newTime;
submitItemButtonReady = false;
setTimeout(function () { resetButton("submitItem"); }, debouceInterval);
if (jsButton.isDisabled()) {
(simMgr().GetDisabledAction())();
}
else {
var answer = confirm('Are You Sure You Want to Submit the Item for Scoring');
if (answer) {
simMgr().ScoreItem();
Simulator.showAlert('Question', 'Press "Next" for Next Test Item');
simMgr().GetNextItem();
}
}
}
}
}
}
};
function RequestAnimationOutput(id) {
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((requestAnimationOutputButtonReady == true) && (!simMgr().isPlaying())) {
if ((newTime - lastStartTrialTime) > debouceInterval) {
lastStartTrialTime = newTime;
requestAnimationOutputButtonReady = false;
setTimeout(function () { resetButton("requestAnimationOutput"); }, debouceInterval);
if (jsButton.isDisabled()) {
(simMgr().GetDisabledAction())();
}
else {
eventMgr().postEvent(new Simulator.Event(jsButton, 'command', 'outputReq'));
}
}
}
}
}
};
function ShowDialog(id, dialogID) {
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((showDialogButtonReady == true) && (!simMgr().isPlaying())) {
if ((newTime - lastStartTrialTime) > debouceInterval) {
lastStartTrialTime = newTime;
showDialogButtonReady = false;
setTimeout(function () { resetButton("showDialog"); }, debouceInterval);
if (jsButton.isDisabled()) {
(simMgr().GetDisabledAction())();
}
else {
dialogID.style.display = '';
}
}
}
}
}
};
function ShowAlert(id, parameters) {
var transParameters = transDictionary().translate(parameters);
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled') {
if ((showAlertButtonReady == true) && (!simMgr().isPlaying())) {
if ((newTime - lastStartTrialTime) > debouceInterval) {
lastStartTrialTime = newTime;
showAlertButtonReady = false;
setTimeout(function () { resetButton("showAlert"); }, debouceInterval);
if (jsButton.isDisabled())
(simMgr().GetDisabledAction())();
else {
if (transParameters) {
var parts = transParameters.split('|');
var elements = [];
var aParameter = null;
for (var i = 0; i < parts.length; i++) {
aParameter = parts[i].split('*');
elements[aParameter[0]] = aParameter[1];
}
if ('contents' in elements) {
var msg = unescape(elements['contents']);
Simulator.showAlertWarning(unescape(elements['contents']));
}
}
}
}
}
}
}
};
function ResetTrials(id) {
var newTime = new Date();
var theButton = simDocument().getElementById(id);
if (theButton) {
var jsButton = html2jsMap().getJSFromHTML(theButton);
if (jsButton.getState() == 'enabled' && !simMgr().isReadOnly()) {
if ((resetTrialsButtonReady == true) && (!simMgr().isPlaying())) {
if ((newTime - lastStartTrialTime) > debouceInterval) {
lastStartTrialTime = newTime;
resetTrialsButtonReady = false;
setTimeout(function () { resetButton("resetTrials"); }, debouceInterval);
if (jsButton.isDisabled()) {
(simMgr().GetDisabledAction())();
}
else {
publishEvents(jsButton, 'resetTrials');
simMgr().setReadyState();
scoringTable().clearTable();
}
}
}
}
}
};
this.setAttributes = function (attr, node) {
if (node) attr = util().getAttributes(node);
Simulator.Control.Button.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'implication':
this.setImplication(attr[i]);
break;
}
}
};
this.recordKeyboardSelection = function (elementID, itemID, itemIndex) {
var bHandler = this.getHandler();
var bNodeID = this.getNodeID();
var parameters = this.getHandlerParameters();
if (parameters) parameters = ', "' + parameters + '"';
if (!parameters)
parameters = '';
eval(bHandler + '("' + bNodeID + '"' + parameters + ')');
};
this.render = function (panelName) {
var needTableDiv = false;
var tableDiv = null;
var buttonDiv = null;
if (section) {
var HTMLPanel = container;
}
else {
var HTMLPanel = panel.getHTMLElement();
}
var button = null;
var imageSpan = null;
var imageElement = null;
var labelSpan = null;
var type = this.getType();
var tableElement = null;
if (HTMLPanel.id.indexOf('dataOutputPanel') != -1) {
tableElement = util().getElementsByClassName('table_controls', HTMLPanel);
needTableDiv = true;
}
if (needTableDiv) {
tableDiv = simDocument().createElement('div');
tableDiv.id = 'tableDiv' + this.getNodeID();
tableDiv.setAttribute('class', 'table_controls');
HTMLPanel.appendChild(tableDiv);
} else {
buttonDiv = simDocument().createElement('div');
buttonDiv.id = 'buttonDiv' + this.getNodeID();
if (section) {
if (section.getSectionSettings().elementorientation === "horizontal") {
buttonDiv.classList.add("inputpanelcell");
}
}
HTMLPanel.appendChild(buttonDiv);
}
button = simDocument().createElement('button');
button.id = this.getNodeID();
button.setAttribute('type', 'button');
var bHandler = this.getHandler();
var bNodeID = this.getNodeID();
var parameters = this.getHandlerParameters();
if (parameters) parameters = ', "' + parameters + '"';
if (!parameters)
parameters = '';
util().bindEvent(button, 'click', function (event) {
eval(bHandler + '("' + bNodeID + '"' + parameters + ')');
if (event.preventDefault) {
event.preventDefault();
} else {
event.returnValue = false;
}
return false;
});
if (type == 'mixed' || type == 'image') {
imageSpan = simDocument().createElement('span');
imageSpan.setAttribute('class', 'holderImage');
var image = this.getImage();
if (this.isAPredefinedCmdElementImage(image)) button.setAttribute('class', 'actionButton ' + image + ' ' + this.getImplication());
else {
button.setAttribute('class', 'actionButton withImages ' + this.getImplication());
imageElement = simDocument().createElement('img');
imageElement.src = image;
imageElement.alt = this.getLabel();
imageSpan.appendChild(imageElement);
}
button.appendChild(imageSpan);
}
if (type == 'mixed' || type == 'text') {
if (type == 'text')
button.setAttribute('class', 'actionButton ' + this.getImplication());
labelSpan = simDocument().createElement('span');
labelSpan.setAttribute('class', 'holderText');
if (sim.getSpeechEnabled()) {
labelSpan.innerHTML = Simulator.Constants.SPEECH_CMD_ITEM_PREFIX + this.getLabel();
} else labelSpan.innerHTML = this.getLabel();
button.appendChild(labelSpan);
}
if (needTableDiv)
tableDiv.appendChild(button);
else if (HTMLPanel.id.indexOf('dataOutputPanel') == -1)
buttonDiv.appendChild(button);
else
tableElement[0].appendChild(button);
this.setHTMLButton(button);
hButton = button;
this.mapHTML2JS(button);
this.setFocusable(true, true);
if (sim.getSpeechEnabled()) {
var speechLabel = this.getSpeechLabel();
if (!speechLabel) {
speechLabel = this.getLabel();
if (!speechLabel && section) {
label = section.getSectionLabel();
}
if (!speechLabel) {
dbg().logFatalError(source, 'Item is speech enabled but speechLabel attribute is missing for ' + this.getName(), true);
return;
}
}
speechGrammarBldr().createButtonGrammarRule(this.getName(), speechLabel, this, speechLabel);
}
if (this.isFocusable()) {
keyboardInput().addFocusableElementItem(this, this.getNodeID());
}
};
if (sim) {
registerClassEvents(instance);
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Control.Button.prototype = new Simulator.Control.CommandElement();
Simulator.Control.Button.parent = Simulator.Control.CommandElement;
Simulator.Control.Button.prototype.constructor = Simulator.Control.Button;

/* SOURCE FILE: DataDisplayElement2.js (20d98ee3) 9/9/2014 2:09:04 PM */

Simulator.Display.DataDisplayElement = function  (sim) {
Simulator.SimElement.call(this, sim);
var visible = 'true';
var displayVector = [];
var waitOn = null;
var fixedDigits = 2;
this.getVisible = function() {
return visible;
};
this.setVisible = function(newVisible) {
visible = newVisible;
return this;
};
this.getDisplayVector = function() {
return displayVector;
};
this.setDisplayVector = function(newDisplayVector) {
displayVector = newDisplayVector;
return this;
};
this.getWaitOn = function() {
return waitOn;
};
this.setWaitOn = function(newWaitOn) {
waitOn = newWaitOn;
return this;
};
this.getFixedDigits = function() {
return fixedDigits;
};
this.setFixedDigits = function(newFixedDigits) {
fixedDigits = newFixedDigits;
return this;
};
this.onChange = function (id) {
this.postOnChangeEvents();
};
this.setAttributes = function (attr, node) {
Simulator.Display.DataDisplayElement.prototype.setAttributes.call(this, attr, node);
for (var i in attr) {
switch (i) {
case 'visible':
this.setVisible(attr[i]);
break;
case 'fixedDigits':
this.setFixedDigits(attr[i]);
break;
case 'waitOn':
this.setWaitOn(attr[i]);
break;
}
}
};
};
Simulator.Display.DataDisplayElement.prototype = new Simulator.SimElement();
Simulator.Display.DataDisplayElement.parent = Simulator.SimElement;
Simulator.Display.DataDisplayElement.prototype.constructor = Simulator.Display.DataDisplayElement;

/* SOURCE FILE: DataTable2.js (bd30e65f) 10/26/2014 1:27:05 PM */

Simulator.Display.DataTable = function (sim, panel) {
Simulator.Display.DataDisplayElement.call(this, sim);
var source = 'DataTable';
var iteratorSelectorMap = [];
var rowFunctionMap = [];
var headingMap = [];
var headingNames = [];
var autoCountMap = [];
var scoreableMap = [];
var numFiguresMap = [];
var includeKeyInOutput = [];
var columnTextLengthMap = [];
var hasOutputKeys = false;
var colWidth = -1;
var whiteboardKey = null;
var userAlerted = false;
var deleteColumn = false;
var numRows = undefined;
var htmlTableRendered = false;
var userAddRows = true;
var numColumns = undefined;
var header = true;
var incrementTrialOnOutput = false;
var clearRows = false;
var footer = false;
var scoreable = false;
var headerVisible = true;
var outputSource = 'evaluator';
var deleteRowImage = '';
var prevBorder = 'none';
var simID = null;
var instance = this;
if (sim) {
simID = sim.getSimID();
}
var HTMLPanel = panel.getHTMLElement();
var keyboardInput = function () { return sim.getKeyboardInput(); };
var util = function () { return sim.getUtils(); };
var simMgr = function () { return sim.getSimulationManager(); };
var eventMgr = function () { return sim.getEventManager(); };
var dbg = function () { return sim.getDebug(); };
var speechGrammarBldr = function () { return sim.getSpeechGrammarBldr(); };
var whiteboard = function () { return sim.getWhiteboard(); };
var scoringTable = function () { return sim.getScoringTable(); };
var simDocument = function () { return sim.getSimDocument(); };
var clearRowText = function () { return 'Clear Row'; };
var tableCaptionText = function () { return 'Output Table'; };
var rowHeaderText = function () { return 'Trial'; };
var transDictionary = function () { return sim.getTranslationDictionary(); };
var HTMLDataTable = simDocument().createElement('table');
HTMLDataTable.setAttribute('class', 'dataTable');
HTMLDataTable.rules = 'all';
function updateHTMLTable(newHTMLTable) {
HTMLDataTable = newHTMLTable;
}
this.setFocusable(true, true);
function addRow(table, loadFromResponse) {
var newCell = null;
var hTable = simDocument().getElementById(table.getID());
var nRows = hTable.rows.length;
var lastCellID = table.createCellId(hTable.tBodies[0].rows.length - 2, table.getNumColumnsPlusHeader() - 1);
var newRow = hTable.insertRow(nRows);
if (sim.getAccessibilityIFActive()) {
var rowHeader = document.createElement('th');
rowHeader.innerHTML = rowHeaderText() + ' ' + nRows;
newRow.appendChild(rowHeader);
}
for (var i = table.getZerothColumn() ; i < table.getNumColumnsPlusHeader() ; i++) {
newCell = newRow.insertCell(i);
newCell.id = table.createCellId(hTable.tBodies[0].rows.length - 1, i);
newCell.innerHTML = ' ';
if (table.isFocusable()) keyboardInput().addFocusableElementItem(table, table.getID(), newCell.id);
}
if (table.getClearRows()) {
var dCell = newCell = newRow.insertCell(table.getNumColumnsPlusHeader());
dCell.style.borderRight = '0px';
dCell.style.borderTop = '0px';
dCell.style.borderBottom = '0px';
dCell.id = table.createCellId(hTable.tBodies[0].rows.length - 1, table.getNumColumnsPlusHeader());
var anchor = simDocument().createElement('a');
anchor.href = '#';
anchor.setAttribute('class', 'clearRow');
anchor.innerHTML = clearRowText();
var anchorwrap = simDocument().createElement('div');
anchor.onclick = (function (e) {
var theRow = simMgr().getTrialNum() - 1;
if (loadFromResponse) {
theRow = nRows - 1;
}
var id = table.getNodeID();
return function (e) {
instance.clearRow(e, id, theRow);
};
})();
anchorwrap.appendChild(anchor);
dCell.appendChild(anchorwrap);
if (table.isFocusable()) keyboardInput().addFocusableElementItem(table, table.getID(), dCell.id);
}
updateHTMLTable(hTable);
table.setNumRows(hTable.tBodies[0].rows.length);
}
function resolveColumn(inputKey, outputKey) {
for (var i = 0; i < numColumns; i++) {
if (headingMap[i]['inputKey']) {
if (inputKey) {
if (headingMap[i]['inputKey'].toLowerCase() == inputKey.toLowerCase()) {
if (outputKeyMatch(outputKey, i)) return i;
else return -1;
}
}
} else if (outputKey) {
if (outputKeyMatch(outputKey, i)) return i;
}
}
return -1;
}
function outputKeyMatch(outputKey, colNum) {
if (headingMap[colNum]['outputKey']) {
if (outputKey) {
if (headingMap[colNum]['outputKey'][0] == '+') {
if (headingMap[colNum]['outputKey'].substring(1) == outputKey) return true;
}
else {
theOutputKeys = headingMap[colNum]['outputKey'].split(',');
for (var j = 0; j < theOutputKeys.length; j++) {
anOutputKey = theOutputKeys[j].replace(/^\s+/, '');
anOutputKey = anOutputKey.replace(/\s+$/, '');
if (anOutputKey.toLowerCase() == outputKey.toLowerCase()) return true;
} return false;
}
}
} else {
if (outputKey) return false;
else return true;
}
}
function parseTableInput(obj, inputs) {
var inputArray = [];
var elements = null;
var parts = null;
var cellWritten = false;
for (var p in inputs) {
inputArray = inputs[p];
if (inputArray) {
for (var i = 0; i < inputArray.length; i++) {
if (inputArray[i]) {
elements = inputArray[i].split(Simulator.Constants.PAIR_DELIMITTER);
for (var k = 0; k < elements.length; k++) {
parts = elements[k].split(Simulator.Constants.KEY_VALUE_DELIMITTER);
var myInputKey, myData;
if (parts[1]) {
myInputKey = parts[0];
myData = parts[1];
} else {
myInputKey = p;
myData = parts[0];
}
if (isNaN(myData)) {
myData = transDictionary().translate(myData);
}
cellWritten = obj.setCell(myInputKey, myData);
}
}
}
}
}
if (cellWritten && !hasOutputKeys) {
debug(source, 'cellWritten = ' + cellWritten + ', hasOutputKeys = ' + hasOutputKeys + '. Sending "tableUpdated" event');
eventMgr().postEvent(new Simulator.Event(obj, 'info', 'tableUpdated'));
}
}
function parseOutput(obj, outputs) {
var parts = [];
var functionList = [];
var functionDB = [];
var iterations = [];
if (outputs == '' || outputs == ';') {
dbg().logError(source, 'Improper output parameter received in DataTable.parseOutput: ' + outputs + '');
return;
}
iterations = outputs.split(Simulator.Constants.ITERATION_DELIMITTER);
for (var t = 0; t < iterations.length; t++) {
functionList = iterations[t].split(Simulator.Constants.PAIR_DELIMITTER);
for (var fl = 0; fl < functionList.length; fl++) {
parts = functionList[fl].split(Simulator.Constants.KEY_VALUE_DELIMITTER);
parts[0] = util().removeHeadingAndTrailingQuotes(parts[0], 'both');
parts[1] = util().removeHeadingAndTrailingQuotes(parts[1], 'both');
if (t == 0)
functionDB[parts[0]] = [];
if (parts[0])
functionDB[parts[0]].push(parts[parts.length - 1]);
}
}
var cellWritten = false;
for (var k = 0 ; k < obj.getNumColumns() ; k++) {
var allData = null;
var inputKey = headingMap[k]['inputKey'];
var outputKeys = headingMap[k]['outputKey'];
if (outputKeys) {
var outputKeyList = outputKeys.split(',');
for (var i = 0; i < outputKeyList.length; i++) {
var data = null;
if (typeof outputKeyList[i] == 'Array') outputKeyList[i] = outputKeyList[i][0];
outputKeyList[i] = outputKeyList[i].replace(/^\s*/, "");
outputKeyList[i] = outputKeyList[i].replace(/\s*$/, "");
outputKeyList[i] = outputKeyList[i].replace(/^"\s*/, "\*");
outputKeyList[i] = outputKeyList[i].replace(/\s*\"$/, "\"");
outputKeyList[i] = outputKeyList[i].replace(/\"/g, "");
if (outputKeyList[i] in functionDB) {
var keyString = "";
if (iteratorSelectorMap[k]) {
data = util().applyFilter(iteratorSelectorMap[k], functionDB[outputKeyList[i]]);
functionDB[outputKeyList[i]] = data;
} else {
if (includeKeyInOutput[k]) {
var keyTag = outputKeyList[i];
keyString = transDictionary().translate(keyTag) + ' : ';
}
}
if (isNaN(functionDB[outputKeyList[i]])) {
functionDB[outputKeyList[i]] = transDictionary().translate(functionDB[outputKeyList[i]]);
}
data = keyString + functionDB[outputKeyList[i]];
if (data instanceof Array) data = data.join(',');
if (allData) allData = allData + ', ' + data;
else allData = data;
cellWritten = obj.setCell(inputKey, allData, outputKeyList[i]);
}
}
}
}
if (cellWritten) {
obj.saveScoreableInputs();
eventMgr().postEvent(new Simulator.Event(obj, 'info', 'tableUpdated'));
}
}
function compoundOutputKey(outputs) {
return outputs[0] == '+' ? true : false;
}
function postTableDataToWhiteboard(obj) {
var dataSeriesID = null;
whiteboard().addCategory('itemTableData');
var cellID = null;
var cell = null;
var buff = [];
for (var j = 0; j < numRows; j++) {
for (var i = obj.getZerothColumn(); i < obj.getNumColumnsPlusHeader(); i++) {
cellID = obj.createCellId(j, i);
cell = simDocument().getElementById(cellID);
if (i == 0) buff.push(cell.innerHTML);
else {
buff.push(', ');
buff.push(cell.innerHTML);
}
}
dataSeriesID = 'series' + (j + 1);
if (!whiteboardKey) whiteboardKey = whiteboard().addItem('itemTableData', dataSeriesID);
whiteboard().setItem('itemTableData', dataSeriesID, buff.join(''), whiteboardKey);
}
}
function rowIsEmpty(tbl, theRow) {
var nCols = tbl.getNumColumnsPlusHeader();
if (theRow < tbl.getNumRows() && theRow >= 0) {
for (var i = tbl.getZerothColumn(); i < nCols; i++) {
var id = tbl.createCellId(theRow, i);
var cell = simDocument().getElementById(id);
if (cell.innerHTML != '') return false;
}
}
return true;
}
var createTableBody = function (tbl) {
var tBody = simDocument().createElement('tbody');
HTMLDataTable.appendChild(tBody);
var row;
tbl.setFocusable(true, false);
for (var j = 0; j < numRows; j++) {
row = simDocument().createElement('tr');
tBody.appendChild(row);
if (sim.getAccessibilityIFActive()) {
var rowHeader = document.createElement('th');
var printedRowNumber = j + 1;
rowHeader.innerHTML = rowHeaderText() + ' ' + printedRowNumber;
row.appendChild(rowHeader);
}
for (var i = tbl.getZerothColumn(); i < tbl.getNumColumnsPlusHeader(); i++) {
var cell = simDocument().createElement('td');
cell.id = tbl.createCellId(j, i);
row.appendChild(cell);
cell.innerHTML = '';
if (tbl.isFocusable()) keyboardInput().addFocusableElementItem(tbl, tbl.getNodeID(), cell.id);
}
if (tbl.getClearRows()) {
var dCell = newCell = row.insertCell(row.cells.length);
dCell.id = tbl.createCellId(j, tbl.getNumColumnsPlusHeader());
dCell.style.borderRight = '0px';
dCell.style.borderTop = '0px';
dCell.style.borderBottom = '0px';
var anchor = simDocument().createElement('a');
anchor.href = '#';
anchor.setAttribute('class', 'clearRow');
anchor.innerHTML = clearRowText();
anchor.onclick = (function (e) {
var theRow = j;
var id = tbl.getNodeID();
return function (e) {
instance.clearRow(e, id, theRow);
};
})();
dCell.appendChild(anchor);
if (tbl.isFocusable()) keyboardInput().addFocusableElementItem(tbl, tbl.getNodeID(), dCell.id);
}
}
return;
};
var createRowDeletionSpeechCommand = function (tbl) {
speechGrammarBldr().createTableRowClearRule(tbl.getName(), '', tbl, 'Data Table');
};
this.setEname(source);
this.getHTMLTable = function () {
return HTMLDataTable;
};
this.getID = function () {
return HTMLDataTable.id;
};
this.setID = function (id) {
HTMLDataTable.setAttribute('id', this.getNodeID());
};
this.getCaptionID = function () {
return 'caption' + this.getID();
};
this.getColumnHeaderID = function (colNumber) {
return 'column' + colNumber + 'Header' + this.getID();
};
this.getUserAddRows = function () {
return userAddRows;
};
this.setUserAddRows = function (newUserAddRows) {
if (newUserAddRows == 'true') userAddRows = true;
else userAddRows = false;
};
this.getNumRows = function () {
return numRows;
};
this.setNumRows = function (newNumRows) {
numRows = parseInt(newNumRows);
if (numRows == undefined) {
dbg().logWarning(source, 'Could not convert string representation of number of data table rows to an integer');
}
if (numRows == 0) deleteColumn = true;
return this;
};
this.getZerothColumn = function () {
return (sim.getAccessibilityIFActive() ? 1 : 0);
}
this.getNumColumnsPlusHeader = function () {
return this.getNumColumns() + this.getZerothColumn();
}
this.getNumColumns = function () {
return numColumns;
};
this.setNumColumns = function (newNumColumns) {
numColumns = parseInt(newNumColumns);
if (!numColumns) {
dbg().logWarning(source, 'Could not convert string representation of number of data table columns to an integer');
}
colWidth = 85 / numColumns;
dColWidth = (100 - (colWidth * numColumns)) + '%';
return this;
};
this.getHeader = function () {
return header;
};
this.setHeader = function (header) {
var indexStr = '';
var maxLength = 0;
var k = -1;
var cell = null;
var headingText = null;
var isIE = util().isInternetExplorer();
if (header != null) {
var tHead = HTMLDataTable.createTHead();
var row = simDocument().createElement('tr');
tHead.appendChild(row);
if (sim.getAccessibilityIFActive()) {
var blankHeaderCell = simDocument().createElement('th');
blankHeaderCell.setAttribute('id', this.getColumnHeaderID(0));
row.appendChild(blankHeaderCell);
}
for (var i = 0; i < header.childNodes.length; i++) {
try {
var child = header.childNodes[i];
if (child.nodeName[0] != '#') {
k += 1;
if (k <= numColumns) {
cell = simDocument().createElement('th');
cell.setAttribute('id', this.getColumnHeaderID(k + this.getZerothColumn()));
row.appendChild(cell);
indexStr = 'text';
if (isIE) headingText = child.attributes.getNamedItem(indexStr).value;
else headingText = child.attributes[indexStr].nodeValue;
cell.innerHTML = transDictionary().translate(headingText);
headingNames[k] = headingText;
headingMap[k] = [];
indexStr = "contentType";
headingMap[k].push([indexStr]);
if (isIE) {
if (child.attributes.getNamedItem(indexStr) != undefined)
headingMap[k][indexStr] = child.attributes.getNamedItem(indexStr).value;
else
headingMap[k][indexStr] = "text";
}
else {
if (child.attributes[indexStr] != undefined)
headingMap[k][indexStr] = child.attributes[indexStr].nodeValue;
else
headingMap[k][indexStr] = "text";
}
indexStr = "inputKey";
headingMap[k].push([indexStr]);
if (isIE) {
if (child.attributes.getNamedItem(indexStr) != undefined)
headingMap[k][indexStr] = child.attributes.getNamedItem(indexStr).value;
else
headingMap[k][indexStr] = null;
}
else {
if (child.attributes[indexStr] != undefined)
headingMap[k][indexStr] = child.attributes[indexStr].nodeValue;
else
headingMap[k][indexStr] = null;
}
indexStr = "outputKey";
headingMap[k].push([indexStr]);
if (isIE) {
if (child.attributes.getNamedItem(indexStr) != undefined) {
headingMap[k][indexStr] = child.attributes.getNamedItem(indexStr).value;
headingMap[k][indexStr] = headingMap[k][indexStr].replace(/\s*\"\s*/g, "\"");
hasOutputKeys = true;
}
else
headingMap[k][indexStr] = null;
}
else {
if (child.attributes[indexStr] != undefined) {
headingMap[k][indexStr] = child.attributes[indexStr].nodeValue;
headingMap[k][indexStr] = headingMap[k][indexStr].replace(/\s*\"\s*/g, "\"");
hasOutputKeys = true;
}
else headingMap[k][indexStr] = null;
}
indexStr = "includeKeyInOutput";
if (isIE) {
if (child.attributes.getNamedItem(indexStr))
if (child.attributes.getNamedItem(indexStr).value == "yes") includeKeyInOutput[k] = true;
else includeKeyInOutput[k] = false;
}
else {
if (child.attributes[indexStr])
if (child.attributes[indexStr].nodeValue == "yes") includeKeyInOutput[k] = true;
else includeKeyInOutput[k] = false;
}
indexStr = "autoCount";
if (isIE) {
if (child.attributes.getNamedItem(indexStr)) autoCountMap[k] = child.attributes.getNamedItem(indexStr).value;
else autoCountMap[k] = null;
}
else {
if (child.attributes[indexStr]) autoCountMap[k] = child.attributes[indexStr].nodeValue;
else autoCountMap[k] = null;
}
indexStr = "filter";
if (isIE) {
if (child.attributes.getNamedItem(indexStr)) iteratorSelectorMap[k] = child.attributes.getNamedItem(indexStr).value;
var len = headingText.length;
if (len > maxLength) maxLength = len;
}
else {
if (child.attributes[indexStr]) iteratorSelectorMap[k] = child.attributes[indexStr].nodeValue;
var len = headingText.length;
if (len > maxLength) maxLength = len;
}
indexStr = "scoreable";
if (isIE) {
if (child.attributes.getNamedItem(indexStr) != undefined) {
scoreableMap[k] = true;
scoringTable().addElement(headingNames[k], "output");
}
else scoreableMap[k] = false;
}
else {
if (child.attributes[indexStr] != undefined) {
scoreableMap[k] = true;
scoringTable().addElement(headingNames[k], "output");
}
else scoreableMap[k] = false;
}
indexStr = "numDecFigures";
if (isIE) {
if (child.attributes.getNamedItem(indexStr) != undefined) numFiguresMap[k] = child.attributes.getNamedItem(indexStr).value;
}
else {
if (child.attributes[indexStr] != undefined) numFiguresMap[k] = child.attributes[indexStr].nodeValue;
}
indexStr = "rowFunction";
if (isIE) {
if (child.attributes.getNamedItem(indexStr) != undefined) rowFunctionMap[k] = child.attributes.getNamedItem(indexStr).value;
}
else {
if (child.attributes[indexStr] != undefined) rowFunctionMap[k] = child.attributes[indexStr].nodeValue;
}
indexStr = "maxTextLength";
if (isIE) {
if (child.attributes.getNamedItem(indexStr)) columnTextLengthMap[k] = child.attributes.getNamedItem(indexStr).value;
else columnTextLengthMap[k] = -1;
}
else {
if (child.attributes[indexStr]) columnTextLengthMap[k] = child.attributes[indexStr].nodeValue;
else columnTextLengthMap[k] = -1;
}
}
}
} catch (err) {
dbg().logError(source, 'Error occurred during construction of data table header column ' + k + ' for attribute ' + indexStr + ': ' + err.message);
}
}
if (sim.getAccessibilityIFActive()) {
var caption = simDocument().createElement('caption');
caption.innerHTML = tableCaptionText();
caption.setAttribute('id', this.getCaptionID());
HTMLDataTable.insertBefore(caption, tHead);
var cell = simDocument().createElement('th');
row.appendChild(cell);
cell.innerHTML = clearRowText();
}
}
return this;
};
this.getInputKey = function (columnNumber) {
return headingMap[columnNumber]['inputKey'];
};
this.getOutputKey = function (columnNumber) {
return headingMap[columnNumber]['outputKey'];
};
this.headingMapInverse = function (num) {
for (var key in headingMap) {
if (headingMap[key] == num) return key;
}
return null;
};
this.setIncrementTrialOnOutput = function (newIncrementTrialOnOutput) {
if (newIncrementTrialOnOutput == 'true') incrementTrialOnOutput = true;
else incrementTrialOnOutput = false;
};
this.getIncrementTrialOnOutput = function () {
return incrementTrialOnOutput;
};
this.createCellId = function (row, col) {
return this.getName() + simID + row + col;
};
this.getFooter = function () {
return footer;
};
this.setFooter = function (footer) {
var tFoot = HTMLDataTable.createTFoot();
var row = simDocument().createElement('TR');
tFoot.appendChild(row);
for (var i = this.getZerothColumn(); i < this.getNumColumnsPlusHeader(); i++) {
var cell = simDocument().createElement('TD');
cell.style.width = colWidth;
row.appendChild(cell);
cell.innerHTML = ' ';
}
this.HTMLDataTable.style.display = 'block';
return this;
};
this.getClearRows = function () {
return clearRows;
};
this.setClearRows = function (newClearRows) {
clearRows = newClearRows == 'true' || newClearRows == 'yes' ? true : false;
return this;
};
this.getScoreable = function () {
return scoreable;
};
this.setScoreable = function (newScoreable) {
if (newScoreable == 'yes') scoreable = true;
else scoreable = false;
return this;
};
this.getHeaderVisible = function () {
return headerVisible;
};
this.setHeaderVisible = function (newHeaderVisible) {
headerVisible = newHeaderVisible;
return this;
};
this.getOutputSource = function () {
return outputSource;
};
this.setOutputSource = function (newOutputSource) {
outputSource = newOutputSource;
return this;
};
this.getDeleteRowImage = function () {
return deleteRowImage;
};
this.setDeleteRowImage = function (newDeleteRowImage) {
deleteRowImage = newDeleteRowImage;
if (deleteRowImage) {
this.setClearRows(true);
deleteColumn = true;
}
return this;
};
this.evaluateRowFunction = function (row, column) {
if (rowFunctionMap[column]) {
var sum = 0;
var cellID = this.createCellId(row, column);
var cell = simDocument().getElementById(cellID);
switch (rowFunctionMap[column]) {
case 'mean':
for (var i = 0; i < this.getNumColumns() ; i++) if (i != column) sum += parseFloat(cell.innerHTML);
return (sum / numRows).toFixed(this.getFixedDigits());
break;
case 'sum':
for (var i = 0; i < this.getNumColumns() ; i++) if (i != column) sum += parseFloat(cell.innerHTML);
return sum.toFixed(this.getFixedDigits());
break;
case 'max':
var max = null;
for (var i = 0; i < this.getNumColumns() ; i++) max = Math.max(parseFloat(cell.innerHTML), max);
return max.toFixed(this.getFixedDigits());
break;
case 'min':
var min = null;
for (var i = 0; i < this.getNumColumns() ; i++) min = Math(min, parseFloat(cell.innerHTML));
return min.toFixed(this.getFixedDigits());
break;
}
}
};
this.replace = function () {
HTMLPanel.replaceChild(HTMLDataTable, HTMLDataTable);
this.refreshTable();
};
this.append = function () {
HTMLPanel.appendChild(HTMLDataTable);
};
this.setCell = function (inputKey, data, outputKey) {
var cellWritten = false;
var rowNum = simMgr().getTrialNum() - 1;
var colNum = resolveColumn(inputKey, outputKey);
if (rowNum == numRows) {
if (userAddRows) addRow(this);
else {
if (!userAlerted) {
Simulator.showAlertWarning('You cannot add additional data table rows.');
userAlerted = true;
}
return;
}
}
cellWritten = this.setCellWithRowColNum(rowNum, colNum, data);
this.setAutoCountCells(rowNum);
return cellWritten;
};
this.setCellWithRowColNum = function (rowNum, colNum, data) {
var cellWritten = false;
var testVal = null;
if (rowNum < numRows && rowNum >= 0 && colNum != -1) {
var displayColNum = colNum + this.getZerothColumn();
var id = this.createCellId(rowNum, displayColNum);
cell = simDocument().getElementById(id);
var contentType = headingMap[colNum]['contentType'];
if (data === Simulator.Constants.NO_DATA_INDICATOR) cell.innerHTML = Simulator.Constants.NO_DATA_INDICATOR;
else if (contentType == 'text') {
if (!isNaN(data)) {
testVal = parseFloat(data);
var figures = parseInt(numFiguresMap[colNum]);
if (!figures) figures = 0;
if (rowFunctionMap[colNum]) testVal = this.evaluateRowFunction(rowNum, colNum);
data = testVal.toFixed(figures);
}
else if (columnTextLengthMap[colNum] != -1) {
var parts = data.split(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER);
var txtLen = parseInt(columnTextLengthMap[colNum]);
for (var i = 0; i < parts.length; i++) {
if (parts[i].length > txtLen) parts[i] = parts[i].substr(0, txtLen - 4) + " ...";
if (i > 0) parts[i] = ', ' + parts[i];
}
if (parts.length > 1) data = parts.join('\n');
else data = parts[0];
}
cell.innerHTML = util().replaceAll(data, Simulator.Constants.MULTIPLE_VALUE_DELIMITTER, ',');
} else if (contentType == 'image') {
cell.innerHTML = '<img src="data:image/png;base64,"' + data + '" alt="x">';
}
cellWritten = true;
} else cellWritten = false;
return cellWritten;
};
this.setAutoCountCells = function (rowNum) {
if (rowNum < numRows && rowNum >= 0) {
for (var i = this.getZerothColumn(); i < this.getNumColumnsPlusHeader(); i++) {
if (autoCountMap[i] != null) {
var id = this.createCellId(rowNum, i);
cell = simDocument().getElementById(id);
cell.innerHTML = simMgr().getTrialNum();
}
}
}
};
this.handleEvent = function (event) {
var newEvent = undefined;
var data = '';
switch (event.type) {
case 'inputReq':
break;
case 'input':
data = event.data;
parseTableInput(this, data);
break;
case 'command':
switch (event.context) {
case 'resetTrials':
this.clearAllRows(this);
userAlerted = false;
break;
case 'startTrial':
if (!simMgr().trialLimitReached()) {
userAlerted = false;
data = whiteboard().getCategory('dataInput');
if (data != null) {
parseTableInput(this, data);
postTableDataToWhiteboard(this);
}
}
break;
case 'startAnimation':
userAlerted = false;
data = whiteboard().getCategory('dataInput');
if (data != null) {
parseTableInput(this, data);
postTableDataToWhiteboard(this);
}
break;
default:
dbg().logWarning(source, 'Unhandled command ' + event.context + ' received by DataTable');
break;
}
break;
case 'info':
switch (event.context) {
case 'inputAvailable':
if (!simMgr().trialLimitReached()) {
data = whiteboard().getCategory('dataInput');
if (data != null) {
parseTableInput(this, data);
postTableDataToWhiteboard(this);
}
}
break;
case Simulator.Constants.ANIMATION_FINISHED:
case Simulator.Constants.ANIMATION_THREAD_FINISHED:
if (this.getOutputSource()) {
if (this.getOutputSource() == 'evaluator') data = whiteboard().getItem('evaluationOutput', 'output');
else if (this.getOutputSource() == 'animation') data = whiteboard().getItem('animationOutput', 'output');
} else {
data = whiteboard().getItem('evaluationOutput', 'output');
if (!data) data = whiteboard().getItem('animationOutput', 'output');
}
if (data != null) parseOutput(this, data);
break;
case 'outputAvailable':
if ((!simMgr().trialLimitReached()) && ((this.getWaitOn() == null) || (this.getWaitOn() == ''))) {
data = whiteboard().getItem('evaluationOutput', 'output');
if (!data) data = whiteboard().getItem('evaluation', 'output');
if (!data) data = whiteboard().getItem('animationOutput', 'output');
if (data != null) parseOutput(this, data);
else eventMgr().postEvent(new Simulator.Event(this, 'info', 'tableUpdated'));
} else if ((this.getWaitOn() != null) && (this.getWaitOn() != '')) {
eventMgr().registerEvent(new Simulator.Event(this, 'info', this.getWaitOn()));
}
break;
case 'animationOutputAvailable':
data = whiteboard().getItem('animationOutput', 'output');
if (data != null) parseOutput(this, data);
else eventMgr().postEvent(new Simulator.Event(this, 'info', 'tableUpdated'));
break;
}
break;
default:
dbg().logWarning(source, 'DataTable ' + this.getName() + ': Unhandled event type received: ' + event.inspect());
return;
}
if (newEvent != undefined && newEvent != null) newEvent.postEvent();
};
this.allAttributesLoaded = function () {
createTableBody(this);
};
this.saveScoreableInputs = function () {
var row = simMgr().getTrialNum() - 1;
for (var i = this.getZerothColumn(); i < this.getNumColumnsPlusHeader(); i++) {
var cellID = this.createCellId(row, i);
var cell = simDocument().getElementById(cellID);
if (scoreableMap[i]) scoringTable().setValue(headingNames[i], row, cell.innerHTML);
}
};
this.getContents = function (indent, name) {
var buff = [];
var numCols = 0;
var table = simDocument().getElementById(this.getNodeID());
if (table) {
var body = table.tBodies[0];
var children = body.childNodes;
if (!name) buff.push(indent + '<stateTable>\n');
else buff.push('<' + name + '>\n');
for (var i = 0; i < children.length; i++) {
if (children[i].nodeName[0] != '#') {
var child = children[i];
if (child.nodeName.toLowerCase() == 'tr') {
buff.push(indent + '  <tr>\n');
var cols = child.childNodes;
if (this.getClearRows() == true) numCols = cols.length - 1;
else numCols = cols.length;
for (var j = 0; j < numCols; j++) {
if (cols[j].nodeName.toLowerCase() == 'th') {
buff.push(indent + '    <th>');
buff.push(cols[j].childNodes[0].textContent);
buff.push('</th>');
} else if (cols[j].nodeName.toLowerCase() == 'td') {
buff.push(indent + '    <td>');
buff.push(cols[j].textContent);
buff.push('</td>\n');
}
}
buff.push(indent + '  </tr>\n');
}
}
}
if (!name) buff.push(indent + '</stateTable>\n');
else buff.push('</' + name + '>\n');
return buff.join('');
} else return '';
};
this.loadFromResponse = function (node) {
var responseRowNum = -1;
var lastTableRowNum = this.getNumRows() - 1;
var colNum = -1;
var children = node.childNodes;
for (var i = 0; i < children.length; i++) {
var child = children[i];
if (child.nodeName[0] != '#') {
if (child.nodeName.toLowerCase() == 'tr') {
responseRowNum++;
colNum = -1;
if (lastTableRowNum < responseRowNum) {
addRow(this, true);
lastTableRowNum++;
}
var childChildren = child.childNodes;
for (var j = 0; j < childChildren.length; j++) {
var childChild = childChildren[j];
if (childChild.nodeName[0] != '#') {
if (childChild.nodeName.toLowerCase() == 'td') {
colNum++;
var cellID = this.createCellId(responseRowNum, colNum);
var cell = simDocument().getElementById(cellID);
if (cell) cell.innerHTML = childChild.textContent;
else dbg().logError(source, 'DataTable.loadFromResponse: Could not find cell with ID = ' + cellID);
}
}
}
}
}
}
};
this.keyboardNavigateTo = function (elementID, itemID, index) {
var item = simDocument().getElementById(itemID);
if (item) item.setAttribute('class', 'simAreaFocus');
};
this.keyboardNavigateAwayFrom = function (elementID, itemID, index) {
var item = simDocument().getElementById(itemID);
if (item) item.removeAttribute('class');
};
this.recordKeyboardSelection = function (elementID, itemID, itemIndex) {
var element = null;
var item = null;
if (itemID) {
item = simDocument().getElementById(itemID);
if (!item) {
element = simDocument().getElementById(elementID);
if (element) item = element.getElementsByClassName(itemID)[0];
}
if (item) {
item.isSelected = true;
if (this.getClearRows()) {
if ((itemIndex % (numColumns + 1)) == numColumns) {
var currentRow = Math.floor(itemIndex / (numColumns + 1)); // WCAG
this.clearRow(null, itemID, currentRow, false);
}
}
}
}
};
this.receivedSpeechFocus = function () {
debug(this.getName() + ' received speech focus');
var node = simDocument().getElementById(this.getID());
prevBorder = node.style.border;
node.style.border = 'thin solid #ff0000';
};
this.removeSpeechFocus = function (value) {
debug(this.getName() + ' lost speech focus');
var node = simDocument().getElementById(this.getID());
node.style.border = prevBorder;
};
this.speechActivated = function (value) {
var parts = value.split('#');
this.clearRow(null, this.getNodeID(), parts[1].trim(), false);
};
this.getSourceName = function () {
return source;
};
this.inspect = function (embedded, force) {
var buff = [];
var sep = '\n\n';
var rowSep = '\n\n';
var colSep = '   ';
var tHeader = HTMLDataTable.tHead;
var tBody = HTMLDataTable.tBodies[0];
buff.push('Inspecting '); buff.push(this.getName()); buff.push(sep);
for (var i = this.getZerothColumn(); i < this.getNumColumnsPlusHeader(); i++) {
buff.push(tHeader.rows[0].cells[i].innerHTML); buff.push(colSep);
}
buff.push(rowSep);
for (var l = 0; l < numRows; l++) {
var row = tBody.rows[l];
for (var j = this.getZerothColumn() ; j < this.getNumColumnsPlusHeader() ; j++) {
buff.push(row.cells[j].innerHTML); buff.push(colSep);
}
buff.push(rowSep);
}
buff.push(sep);
for (var prop in this) {
if (prop.substr(0, 3) == 'get') {
buff.push(prop);
buff.push(' = ');
buff.push(eval('this.' + prop + '()'));
buff.push(sep);
}
}
if (!embedded) (force === null) ? debug(buff.join('')) : debugf(buff.join(''));
return buff.join('');
};
this.refreshTable = function () {
HTMLDataTable.style.display = 'none';
HTMLDataTable.style.display = 'table';
};
this.clearRow = function (e, htmlTbl, theRow, batchDelete) {
var evt = window.event || e;
if (!simMgr().isPlaying() && !simMgr().isReadOnly()) {
var tbl = this;
var nRows = tbl.getNumRows();
var nCols = tbl.getNumColumnsPlusHeader();
if (theRow < nRows && theRow >= 0) {
if (!rowIsEmpty(tbl, theRow)) {
for (var i = this.getZerothColumn(); i < nCols; i++) {
var id = tbl.createCellId(theRow, i);
var cell = simDocument().getElementById(id);
cell.innerHTML = '';
}
scoringTable().clearRow(theRow);
if (!batchDelete) eventMgr().postEvent(new Simulator.Event(tbl, 'command', 'redoTrial', theRow + 1));
}
}
}
if (evt) {
if (evt.preventDefault) {
evt.preventDefault();
} else {
evt.returnValue = false;
}
}
};
this.clearAllRows = function (tbl) {
if (!simMgr().isReadOnly()) {
var htmlTbl = simDocument().getElementById(tbl.getNodeID());
var nRows = tbl.getNumRows();
for (var j = 0; j < nRows; j++) {
this.clearRow(null, htmlTbl.id, j, true);
}
eventMgr().postEvent(new Simulator.Event(tbl, 'info', 'allTableRowsCleared'));
}
};
this.setAttributes = function (attr, node) {
if (node) attr = util().getAttributes(node);
Simulator.Display.DataTable.prototype.setAttributes.call(this, attr, node);
for (var key in attr) {
switch (key) {
case 'rows':
this.setNumRows(attr[key]);
break;
case 'columns':
this.setNumColumns(attr[key]);
break;
case 'footer':
this.setFooter(attr[key]);
break;
case 'clearRow':
this.setClearRows(attr[key]);
break;
case 'headerVisible':
this.setHeaderVisible(attr[key]);
break;
case 'name':
this.setID(this.getName());
break;
case 'deleteRowImage':
this.setDeleteRowImage(attr[key]);
break;
case 'contentType':
this.setContentType(attr[key]);
break;
case 'incrementTrialOnOutput':
this.setIncrementTrialOnOutput(attr[key]);
break;
case 'userAddRows':
this.setUserAddRows(attr[key]);
break;
case 'rowFunction':
this.setRowFunction(attr[key]);
break;
case 'outputSource':
this.setOutputSource(attr[key]);
break;
}
}
var children = node.childNodes;
for (var k = 0; k < children.length; k++) {
if (children[k].nodeName == 'header') {
this.setHeader(children[k]);
break;
}
}
this.allAttributesLoaded();
};
this.render = function (panelName) {
if (this.getVisible()) {
if (!htmlTableRendered) {
this.append();
htmlTableRendered = true;
}
else this.append();
this.refreshTable();
} else {
var HTMLTable = simDocument().getElementById(this.getName());
HTMLTable.style.display = 'none';
this.mapHTML2JS(HTMLTable);
}
};
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};
Simulator.Display.DataTable.prototype = new Simulator.Display.DataDisplayElement();
Simulator.Display.DataTable.parent = Simulator.Display.DataDisplayElement;
Simulator.Display.DataTable.prototype.constructor = Simulator.Display.DataTable;

/* SOURCE FILE: DialogPanel2.js (684f7af1) 9/9/2014 2:09:04 PM */

Simulator.Display.DialogPanel = function(sim, enclosingPanel, panelID, buttonLabel, attr) {
var source = 'DialogPanel';
var HTMLDialogPanel = null;
var title = '';
var instructions = '';
var id = '';
var dialogAttr = [];
var dbg = function() { return sim.getDebug(); };
var simDocument = function() { return sim.getSimDocument(); };
this.getTitle = function() {
return title;
};
this.getInstructions = function() {
return instructions;
};
this.getID = function() {
return id;
};
this.setClass = function(newClass) {
HTMLDialogPanel.setAttribute('class', newClass);
};
this.setInstructions = function(newInstructions) {
dialogAttr['instructions'] = newInstructions;
};
this.setTitle = function(newTitle) {
dialogAttr['title'] = newITitle;
};
this.getDialogAttr = function() {
return dialogAttr;
};
this.render = function(enclosingPanel, attr, panelID, buttonLabel) {
dialogButton = dialogPanel.createButton(panelID + 'button', panelID, buttonLabel);
var htmlButton = simDocument().getElementById(dialogButton.getNodeID());
HTMLPanel = simDocument().getElementById(panelID);
dialogPanel.innerHTML = dialogAttr['instructions'];
dialogPanel.display = 'none';
HTMLPanel.appendChild(htmlButton);
};
this.getDialogButton = function() {
return dialogButton;
};
function setAttributes(attr) {
for(var i in attr) {
switch (i) {
case 'title':
title = attr[i];
break;
case 'instructions':
instructions = attr[i];
break;
default:
dbg().logError(source, 'Unknown DialogPanel attribute seen: ' + i + 'with value "' + attr[i] + '"');
}
}
setStructure();
}
function setStructure() {
HTMLDialogPanel = simDocument().createElement('div');
HTMLDialogPanel.setAttribute('class', 'infoWrapper');
HTMLDialogPanel.style.display = 'none';
var titleDiv = simDocument().createElement('div');
titleDiv.setAttribute('class', 'instructionsTitle');
var header = simDocument().createElement('h2');
header.innerHTML = title;
titleDiv.appendChild(header);
var anchor = simDocument().createElement('a');
anchor.href = '#';
anchor.setAttribute('class', 'close instructions');
anchor.innerHTML = 'Close';
titleDiv.appendChild(anchor);
HTMLDialogPanel.appendChild(titleDiv);
var instrDiv = simDocument().createElement('div');
instrDiv.setAttribute('class', 'holderInfo');
instrDiv.innerHTML = instructions;
HTMLDialogPanel.appendChild(instrDiv);
}
this.createButton = function(htmlID, panelName, buttonLabel) {
var theButton = new Button();
var attr = [];
attr['implication'] = 'neutral';
attr['label'] = buttonLabel;
attr['name'] = htmlID;
attr['type'] = 'text';
attr['alwaysEnabled'] = 'yes';
attr['handler'] = 'ShowDialog';
attr['handlerParameters'] = panelName;
theButton.setAttributes(attr, null);
theButton.render(panelName);
return theButton;
};
function debug(str1, str2, tace) {
dbg().debug(source + ': ' + str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source + ': ' + str1, str2, trace);
}
setAttributes(attr);
};

/* SOURCE FILE: SimParser.js (3ac3b06c) 9/9/2014 2:09:04 PM */

var SimParser = SimParser || {};
SimParser.nameSpace = function() {
var nsObj = null, parts;
for (var i = 0; i < arguments.length; i++) {
parts = ('' + arguments[i]).split('.');
nsObj = SimParser;
for (var j = (parts[0] == 'SimParser') ? 1 : 0; j < parts.length; j++) {
nsObj[parts[j]] = nsObj[parts[j]] || {};
nsObj = nsObj[parts[j]];
}
}
return nsObj;
};
SimParser.ParserItem = SimParser.nameSpace('SimParser', 'ParserItem');
SimParser.Utils = SimParser.nameSpace('SimParser', 'Utils');
SimParser.Variable = SimParser.nameSpace('SimParser', 'Variable');
SimParser.VariableManager = SimParser.nameSpace('SimParser', 'VariableManager');
SimParser.Range = SimParser.nameSpace('SimParser', 'Range');
SimParser.RangeManager = SimParser.nameSpace('SimParser', 'RangeManager');
SimParser.Constraint = SimParser.nameSpace('SimParser', 'Constraint');
SimParser.ConstraintManager = SimParser.nameSpace('SimParser', 'ConstraintManager');
SimParser.Permutation = SimParser.nameSpace('SimParser', 'Permutation');
SimParser.Function = SimParser.nameSpace('SimParser', 'Function');
SimParser.FunctionManager = SimParser.nameSpace('SimParser', 'FunctionManager');
SimParser.FilterEvaluation = SimParser.nameSpace('SimParser', 'FilterEvaluation');
SimParser.FunctionEvaluation = SimParser.nameSpace('SimParser', 'FunctionEvaluation');
SimParser.EvaluationUnit = SimParser.nameSpace('SimParser', 'EvaluationUnit');

/* SOURCE FILE: ParserItem.js (33eb0c18) 9/9/2014 2:09:04 PM */

SimParser.ParserItem = function(parser) {
var eName = 'ParserItem';
this.getEname = function() {
return eName;
};
this.setEname = function(newEname) {
eName = newEname;
return this;
};
SimParser.ParserItem.prototype.setAttributes = function (attr, node) {
for (var i in attr) {
switch (i) {
case 'eName':
this.setEname(attr[i]);
break;
}
}
}
};

/* SOURCE FILE: SimUtils.js (c38dc0fb) 9/9/2014 2:09:04 PM */

if (typeof(EU) === 'undefined') EU = {};
EU.debug = function(str)
{
if (typeof debug == 'function') debug(str);
if (typeof console == 'object') console.log(str);
};
SimParser.Utils = function (vUnit) {
var evUnit = vUnit;
var whiteboard = evUnit.getSimInstance().getWhiteboard();
this.greedyEvaluation = function (varsWB, varsFunc) {
var varCount = new Array(varsFunc.length);
for (var i = 0; i < varsFunc.length; i++) {
varCount[i] = countVarBindable(varsWB, varsFunc[i]);
}
var iMax = 0;
for (var i = 0; i < varCount.length; i++) {
if (varCount[i].bindable && varCount[i].count > iMax) {
iMax = varCount[i].count;
}
}
r = [];
for (var i = 0; i < varsFunc.length; i++) {
if ((varCount[i].bindable && varCount[i].count === iMax) || varCount[i].count === 0) {
r.push(varsFunc[i].name);
}
}
return r;
};
this.fullEvaluation = function (varsWB, varsFunc) {
var func = [];
var vMng = evUnit.getVariableManager();
for (var i = 0; i < varsFunc.length; i++) {
var v = varsFunc[i].vars;
var fBind = true;
for (var j = 0; j < v.length; j++) {
if ((vMng.isVarBindable(v[j])) && (varsWB.indexOf(v[j]) === -1)) {
fBind = false;
break;
}
}
if (fBind) {
func.push(varsFunc[i]);
}
}
return func;
};
this.countVarBindable = function (varsWB, varFunc) {
var r = { count: 0, bindable: true };
var v = varFunc.vars;
var vMng = evUnit.getVariableManager();
for (var i = 0; i < v.length; i++) {
if (vMng.isVarBindable(v[i])) {
if (varsWB.indexOf(v[i]) !== -1) {
r.count++;
} else {
r.bindable = false;
}
}
}
return r;
};
this.mergeWBVariables = function (varsWB) {
var r = {};
var varsWB1 = [];
for (var i = 0; i < varsWB.length; i++) {
for (var key in varsWB[i]) {
varsWB1.push({ name: key, value: varsWB[i][key] });
}
}
for (var i = 0; i < varsWB1.length; i++) {
if (r[varsWB1[i].name] === undefined) {
r[varsWB1[i].name] = [varsWB1[i].value]
}
else {
r[varsWB1[i].name].push(varsWB1[i].value);
}
}
var rr = [];
for (var key in r) {
rr.push({ name: key, value: r[key] });
}
return rr;
};
this.getWBVarNames = function (varsWB) {
var names = [];
for (var i = 0; i < varsWB.length; i++) {
names.push(varsWB[i].name);
}
return names;
};
this.getWBVarValues = function (varsWB) {
var v = [];
for (var i = 0; i < varsWB.length; i++) {
v.push(varsWB[i].value);
}
return v;
};
this.convertElementNamesToVarNames = function (vNames) {
r = [];
var vMng = evUnit.getVariableManager();
for (var j = 0; j < vNames.length; j++) {
var v = vMng.getVariableByObjectName(vNames[j]);
if (v) {
r.push(v.getName());
} else {
EU.debug('Cannot find a varible name for element:' + vNames[j]);
r.push(vNames[j]);
}
}
return r;
};
this.getConstantValues = function () {
r = { vNames: [], vValues: [] };
var vMng = evUnit.getVariableManager();
var c = vMng.getConstants();
for (var i = 0; i < c.length; i++) {
if (r.vNames.indexOf(c[i].name) === -1) {
r.vNames.push(c[i].name);
r.vValues.push(c[i].value);
}
}
return r;
};
this.getImplicitValues = function (varFuncs) {
var imvarsRequiredNames = [];
var imvarsRequiredValues = [];
var vMng = evUnit.getVariableManager();
var impvarsDeclaredNames = vMng.getVariableNames(['implicit']);
for (var i = 0; i < varFuncs.length; i++) {
var v = varFuncs[i].vars;
for (var j = 0; j < v.length; j++) {
if (impvarsDeclaredNames.indexOf(v[j]) >= 0) {
if (imvarsRequiredNames.indexOf(v[j]) === -1) {
imvarsRequiredNames.push(v[j]);
var sirVar = vMng.getVariableByName(v[j]);
imvarsRequiredValues.push(sirVar.getValues());
}
}
}
}
return { 'names': imvarsRequiredNames, 'values': imvarsRequiredValues };
};
this.getVarObject = function(varNames, varValues) {
var r = {};
for (var i = 0; i < varNames.length; i++) {
r[varNames[i]] = varValues[i];
}
return r;
};
this.getFuncVars = function () {
vFuncs = [];
var fMng = evUnit.getFunctionManager();
var fn = fMng.getFunctions();
for (var i = 0; i < fn.length; i++) {
vFuncs.push({ name: fn[i].getName(), vars: fn[i].getVarNames() });
}
return vFuncs;
};
this.writeDataOnWhiteBoard = function (data, key1, cat, item) {
if (typeof (whiteboard) === 'undefined') {
EU.debug('whiteboard object not defined.');
return;
}
whiteboard.addCategory(cat);
if (!key1) {
key1 = whiteboard.addItem(cat, item);
}
whiteboard.setItem(cat, item, data, key1)
return key1;
};
this.readDataFromWhiteBoard = function (section, item) {
var  vars = [{ 'chalk': 15 }, { 'surfaceArea': 600 }, { 'chalk': 16}];
return vars;
};
this.readDataFromWhiteBoard = function (category) {
var data = [];
var cat = whiteboard.getCategory(category);
if (cat !== null || cat !== undefined || cat.length !== 0) {
for (var p in cat) {
if (cat.hasOwnProperty(p)) {
var d = {};
d[p] = cat[p];
data.push(d);
}
}
}
return data;
};
this.packVariablesforWhiteboard = function (v) {
var vv = {};
var vMng = evUnit.getVariableManager();
for (var i = 0; i < v.length; i++) {
var objName = v[i].name;
var sirVar = vMng.getVariableByName(v[i].name);
if (sirVar && sirVar.getType() === 'binding') {
objName = sirVar.getObjectName();
}
vv[objName] = v[i].value;
}
return vv;
};
this.packFunctionforWhiteboard = function (f, v) {
var ff = {};
for (var i = 0; i < f.length; i++) {
ff[f[i]] = v[i];
}
return ff;
};
this.getFuncNames = function (algorithm, varNames, varFuncs) {
if (algorithm === 'greedy') {
return greedyEvaluation(varNames, varFuncs)
} else {
if (algorithm === 'all') {
return this.fullEvaluation(varNames, varFuncs)
} else {
EU.debug('Unsupported algorithm in function evaluation');
}
}
};
this.createSingleOutput = function (varList, funcList) {
var r = {};
var v = {};
var f = {};
for (var i = 0; i < varList.length; i++) {
v[varList[i].name] = varList[i].value;
}
for (var i = 0; i < funcList.length; i++) {
f[funcList[i].name] = funcList[i].value;
}
r = { variables: v, functions: f };
return r;
};
this.oddValue = function (v) {
return ((v === undefined) || ((v === null) ||
((typeof (v) === 'string') ||
((typeof (v) === 'number') &&
((v === Infinity) || (v === -Infinity) || (v.toString() === 'NaN'))))))
};
}
if (!Array.prototype.indexOf)
{
Array.prototype.indexOf = function(elt           )
{
var len = this.length;
var from = Number(arguments[1]) || 0;
from = (from < 0)
? Math.ceil(from)
: Math.floor(from);
if (from < 0)
from += len;
for (; from < len; from++)
{
if ((from in this) && (this[from] === elt)) {
return from;
}
}
return -1;
};
}

/* SOURCE FILE: Parser.js (ff7ed807) 9/9/2014 2:09:04 PM */

var Parser = function () {
if(!Array.indexOf){
Array.prototype.indexOf = function(arg){
for(var i=0; i<this.length; i++){
if(this[i]==arg){
return i;
}
}
return -1;
}
}
String.trim = function(strArg) {
return strArg.replace(/^\s+|\s+$/g,"");
}
function object(o) {
function F() {}
F.prototype = o;
return new F();
}
var TNUMBER = 0;
var TOP1 = 1;
var TOP2 = 2;
var TVAR = 3;
var TFUNCALL = 4;
function Token(type_, index_, prio_, number_) {
this.type_ = type_;
this.index_ = index_ || 0;
this.prio_ = prio_ || 0;
this.number_ = (number_ !== undefined && number_ !== null) ? number_ : 0;
this.toString = function () {
switch (this.type_) {
case TNUMBER:
return this.number_;
case TOP1:
case TOP2:
case TVAR:
return this.index_;
case TFUNCALL:
return "CALL";
default:
return "Invalid Token";
}
};
}
function Expression(tokens, ops1, ops2, functions) {
this.tokens = tokens;
this.ops1 = ops1;
this.ops2 = ops2;
this.functions = functions;
}
var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
escapable = /[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
meta = {
'\b': '\\b',
'\t': '\\t',
'\n': '\\n',
'\f': '\\f',
'\r': '\\r',
"'" : "\\'",
'\\': '\\\\'
};
function escapeValue(v) {
if (typeof v === "string") {
escapable.lastIndex = 0;
return escapable.test(v) ?
"'" + v.replace(escapable, function (a) {
var c = meta[a];
return typeof c === 'string' ? c :
'\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
}) + "'" :
"'" + v + "'";
}
return v;
}
function append(a, b) {
if (Object.prototype.toString.call(a) != "[object Array]") {
return [a, b];
}
a = a.slice();
a.push(b);
return a;
}
function fac(a) {
a = Math.floor(a);
var b = a;
while (a > 1) {
b = b * (--a);
}
return b;
}
function pyt(a, b) {
return Math.sqrt(a * a + b * b);
}
function random(a) {
return Math.random() * (a || 1);
}
function Parser() {
this.success = false;
this.errormsg = "";
this.expression = "";
this.pos = 0;
this.tokennumber = 0;
this.tokenprio = 0;
this.tokenindex = 0;
this.tmpprio = 0;
this.ops1 = {
"sin": Math.sin,
"cos": Math.cos,
"tan": Math.tan,
"asin": Math.asin,
"acos": Math.acos,
"atan": Math.atan,
"sqrt": Math.sqrt,
"log": Math.log,
"exp": Math.exp,
"abs": Math.abs,
"ceil": Math.ceil,
"floor": Math.floor,
"round": Math.round,
"if": function(x){return x;},
"-": function(x){return -x;},
"!": function(x){return !x;},
"{": function(a){eval('var z = {'+a+'}'); return z;}
};
this.ops2 = {
"+": function(a,b){return Number(a) + Number(b);},
"-": function(a,b){return a - b;},
"*": function(a,b){return a * b;},
"/": function(a,b){return a / b;},
"%": function(a,b){return a % b;},
",":  append,
"&&": function(a,b){return a&&b;},
"||": function(a,b){return a||b;},
"^":   Math.pow,
"pow": Math.pow,
"?":  function(a,b){if(a){return b;}else{return null;};},
":":  function(ab,c){if(ab === null){return c;}else{return ab;};},
"[]": function(a,b){return a[b];},
"==": function(a,b){return a == b;},
"!=": function(a,b){return a != b;},
"<":  function(a,b){return a <  b;},
"<=": function(a,b){return a <= b;},
">":  function(a,b){return a >  b;},
">=": function(a,b){return a >= b;}
};
this.functions = {
"Math.atan2": Math.atan2,
"Math.sin": Math.sin,
"Math.cos": Math.cos,
"Math.floor": Math.floor,
"Math.min": Math.min,
"Math.max": Math.max,
"Math.pow": Math.pow,
"Math.rand": Math.random,
"Math.random": Math.random,
"Math.round": Math.round,
"Math.sqrt": Math.sqrt,
"atan2": Math.atan2,
"fac": fac,
"min": Math.min,
"max": Math.max,
"pow": Math.pow,
"random": random,
"rand": random,
"pyt": pyt
};
this.consts = {
"E": Math.E,
"e": Math.E,
"PI": Math.PI,
"pi": Math.PI
};
}
Parser.parbracketsAndCo = function (expr){
expr = enclosers(expr, '(', ')', '');
expr = enclosers(expr, '[', ']', '[]');
expr = enclosers(expr, '{', '}', '{');
return expr;
function enclosers(expr, delimOpen , delimClose, name){
var newExp = "",
char = 0,
pos = 0,
charOpen = delimOpen.charAt(0),
charClose = delimClose.charAt(0),
countingOpenedGroup = 0;
while(pos < expr.length) {
char = expr.charAt(pos);
if (char == charOpen) {
countingOpenedGroup ++;
if (delimOpen == '{')
newExp += name + '(' +'`';
else
newExp += name + '(';
}
else if (char == charClose) {
countingOpenedGroup --;
if(countingOpenedGroup < 0){
noIllegalGroup(countingOpenedGroup, delimOpen , delimClose);
}
if (delimOpen == '{')
newExp += '`' + ')';
else
newExp += ')';
}
else {
newExp += char;
}
pos++;
}
noIllegalGroup(countingOpenedGroup, delimOpen , delimClose);
return newExp;
}
function noIllegalGroup(countingOpenedGroup, delimOpen , delimClose){
if(countingOpenedGroup < 0) {
throw new Error('parse error : ' + delimOpen + '...'
+ delimClose + ', missing opening character');
}
else if(countingOpenedGroup > 0) {
throw new Error('parse error : ' + delimOpen + '...'
+ delimClose + ', missing closing character');
}
}
}
Parser.evaluate = function (expr, variables) {
return Parser.parse(expr).evaluate(variables);
};
Parser.Expression = Expression;
Parser.values = {
sin: Math.sin,
cos: Math.cos,
tan: Math.tan,
asin: Math.asin,
acos: Math.acos,
atan: Math.atan,
sqrt: Math.sqrt,
log: Math.log,
abs: Math.abs,
ceil: Math.ceil,
floor: Math.floor,
"Math.floor": Math.floor,
round: Math.round,
random: random,
rand: random,
fac: fac,
exp: Math.exp,
min: Math.min,
max: Math.max,
"Math.max": Math.max,
pyt: pyt,
pow: Math.pow,
atan2: Math.atan2,
E: Math.E,
PI: Math.PI
};
var PRIMARY  = 1 << 0;
var OPERATOR = 1 << 1;
var FUNCTION = 1 << 2;
var LPAREN   = 1 << 3;
var RPAREN   = 1 << 4;
var COMMA    = 1 << 5;
var SIGN     = 1 << 6;
var CALL     = 1 << 7;
Parser.prototype = {
parse: function (expr) {
expr = Parser.parbracketsAndCo(expr);
this.errormsg = "";
this.success = true;
var operstack = [];
var tokenstack = [];
this.tmpprio = 0;
var expected = (PRIMARY | LPAREN | FUNCTION | SIGN);
var noperators = 0;
var lptsl = -1;
this.expression = expr;
this.pos = 0;
while (this.pos < this.expression.length) {
var cc = this.expression.charAt(this.pos);
if (this.isOperator()) {
if (this.isSign() && (expected & SIGN)) {
if (this.isNegativeSign()) {
this.tokenprio = 2;
this.tokenindex = "-";
this.addfunc(tokenstack, operstack, TOP1);
noperators += 1;
}
expected = (PRIMARY | LPAREN | FUNCTION | SIGN);
}
else if (this.isComment()) {
}
else {
if ((expected & OPERATOR) === 0) {
this.error_parsing(this.pos, "unexpected operator");
}
this.addfunc(tokenstack, operstack, TOP2);
noperators += 2;
expected = (PRIMARY | LPAREN | FUNCTION | SIGN);
}
}
else if (this.isNumber()) {
if ((expected & PRIMARY) === 0) {
this.error_parsing(this.pos, "unexpected number");
}
var token = new Token(TNUMBER, 0, 0, this.tokennumber);
tokenstack.push(token);
expected = (OPERATOR | RPAREN | COMMA);
}
else if (this.isString()) {
if ((expected & PRIMARY) === 0) {
this.error_parsing(this.pos, "unexpected string");
}
var token = new Token(TNUMBER, 0, 0, this.tokennumber);
tokenstack.push(token);
expected = (OPERATOR | RPAREN | COMMA);
}
else if (this.isLeftParen()) {
if ((expected & LPAREN) === 0) {
this.error_parsing(this.pos, "unexpected \"(\"");
}
if (expected & CALL) {
this.tokenprio = -2;
this.tokenindex = -1;
this.addfunc(tokenstack, operstack, TFUNCALL);
noperators += 2;
lptsl = tokenstack.length;
}
expected = (PRIMARY | LPAREN | FUNCTION | SIGN | RPAREN);
}
else if (this.isRightParen()) {
if ((expected & RPAREN) === 0) {
this.error_parsing(this.pos, "unexpected \")\"");
}
if (lptsl == tokenstack.length) {
var token = new Token(TNUMBER, 0, 0, '');
tokenstack.push(token);
lptsl = -1;
}
expected = (OPERATOR | RPAREN | COMMA | LPAREN | CALL);
}
else if (this.isComma()) {
if ((expected & COMMA) === 0) {
this.error_parsing(this.pos, "unexpected \",\"");
}
this.addfunc(tokenstack, operstack, TOP2);
noperators += 2;
expected = (PRIMARY | LPAREN | FUNCTION | SIGN);
}
else if (this.isConst()) {
if ((expected & PRIMARY) === 0) {
this.error_parsing(this.pos, "unexpected constant");
}
var consttoken = new Token(TNUMBER, 0, 0, this.tokennumber);
tokenstack.push(consttoken);
expected = (OPERATOR | RPAREN | COMMA);
}
else if (this.isOp2()) {
if ((expected & FUNCTION) === 0) {
this.error_parsing(this.pos, "unexpected function");
}
this.addfunc(tokenstack, operstack, TOP2);
noperators += 2;
expected = (LPAREN);
}
else if (this.isOp1()) {
if ((expected & FUNCTION) === 0) {
this.error_parsing(this.pos, "unexpected function");
}
this.addfunc(tokenstack, operstack, TOP1);
noperators += 1;
expected = (LPAREN);
}
else if (this.isVar()) {
if ((expected & PRIMARY) === 0) {
this.error_parsing(this.pos, "unexpected variable");
}
var vartoken = new Token(TVAR, this.tokenindex, 0, 0);
tokenstack.push(vartoken);
expected = (OPERATOR | RPAREN | COMMA | LPAREN | CALL);
}
else if (this.isWhite()) {
}
else {
if (this.errormsg === "") {
this.error_parsing(this.pos, "unknown character");
}
else {
this.error_parsing(this.pos, this.errormsg);
}
}
}
if (this.tmpprio < 0 || this.tmpprio >= 10) {
this.error_parsing(this.pos, "unmatched \"()\"");
}
while (operstack.length > 0) {
var tmp = operstack.pop();
tokenstack.push(tmp);
}
if (noperators + 1 !== tokenstack.length) {
this.error_parsing(this.pos, "parity");
}
return new Expression(tokenstack, object(this.ops1), object(this.ops2), object(this.functions));
},
evaluate: function (expr, variables) {
return this.parse(expr).evaluate(variables);
},
error_parsing: function (column, msg) {
this.success = false;
this.errormsg = "parse error: " + msg + "; col. " + column + " in: '" + this.expression + "'";
throw new Error(this.errormsg);
},
addfunc: function (tokenstack, operstack, type_) {
var operator = new Token(type_, this.tokenindex, this.tokenprio + this.tmpprio, 0);
while (operstack.length > 0) {
if (operator.prio_ <= operstack[operstack.length - 1].prio_) {
tokenstack.push(operstack.pop());
}
else {
break;
}
}
operstack.push(operator);
},
isNumber: function () {
var r = false;
var str = "";
while (this.pos < this.expression.length) {
var code = this.expression.charCodeAt(this.pos);
if ((code >= 48 && code <= 57) || code === 46) {
str += this.expression.charAt(this.pos);
this.pos++;
this.tokennumber = parseFloat(str);
r = true;
}
else {
break;
}
}
return r;
},
unescape: function (v, pos) {
var buffer = [];
var escaping = false;
var i;
for (i = 0; i < v.length; i++) {
var c = v.charAt(i);
if (escaping) {
switch (c) {
case "'":
buffer.push("'");
break;
case '\\':
buffer.push('\\');
break;
case '/':
buffer.push('/');
break;
case 'b':
buffer.push('\b');
break;
case 'f':
buffer.push('\f');
break;
case 'n':
buffer.push('\n');
break;
case 'r':
buffer.push('\r');
break;
case 't':
buffer.push('\t');
break;
case 'u':
var codePoint = parseInt(v.substring(i + 1, i + 5), 16);
buffer.push(String.fromCharCode(codePoint));
i += 4;
break;
default:
throw this.error_parsing(pos + i, "Illegal escape sequence: '\\" + c + "'");
}
escaping = false;
} else {
if (c == '\\') {
escaping = true;
} else {
buffer.push(c);
}
}
}
return buffer.join('');
},
isString: function () {
var r = false;
var str = "";
var startpos = this.pos;
var char0 = this.expression.charAt(this.pos);
if (this.pos < this.expression.length && (char0 == "'" || char0=='"' || char0=='`') ) {
this.pos++;
while (this.pos < this.expression.length) {
var char = this.expression.charAt(this.pos);
if (char != char0 || str.slice(-1) == "\\") {  //String must begin and end with the same type of quote
str += this.expression.charAt(this.pos);
this.pos++;
}
else {
this.pos++;
this.tokennumber = this.unescape(str, startpos);
r = true;
break;
}
}
}
return r;
},
isConst: function () {
var str;
for (var i in this.consts) {
if (true) {
var L = i.length;
str = this.expression.substr(this.pos, L);
if (i === str) {
this.tokennumber = this.consts[i];
this.pos += L;
return true;
}
}
}
return false;
},
isOperator: function () {
var opsyns = {
"+": ["+",0],
"-": ["-",0],
"&&": ["&&",-3],
"and": ["&&",-3],
"&amp;&amp;": ["&&",-3],
"||": ["||",-4],
"or": ["||",-4],
"*": ["*",1],
"/": ["/",2],
"%": ["%",2],
"^": ["^",3],
"?": ["?",-5],
":": [":",-6],
"if": ["+",-4],
"then": ["?",-5],
"else": [":",-6],
"[]": ["[]",4],
"===": ["==",-2],
"==": ["==",-2],
"=": ["==",-2],
"!==": ["!=",-2],
"!=": ["!=",-2],
"<>": ["!=",-2],
"<=": ["<=",-1],
"<": ["<",-1],
">=": [">=",-1],
">": [">",-1],
"&lt;=": ["<=",-1],
"&lt;": ["<",-1],
"&gt;=": [">=",-1],
"&gt;": [">",-1]
};
for (var key in opsyns) {
var found = true;
var equiv = opsyns[key][0];
var thischar = this.expression.charAt(this.pos);
for (var i=0; i<key.length; i+=1) {
found = found && this.expression.charAt(this.pos + i).toLowerCase() === key.charAt(i);
}
if (found) {
this.tokenindex = equiv;
this.tokenprio = opsyns[key][1];
this.pos += key.length;
return true;
};
}
return false;
},
isSign: function () {
var char = this.expression.charAt(this.pos - 1);
var prevchar = this.expression.charAt(this.pos - 2);
if (char === "-" || char === "+" || (prevchar+char) === "if") {
return true;
}
return false;
},
isPositiveSign: function () {
var char = this.expression.charAt(this.pos - 1);
if (char === "+") {
return true;
}
return false;
},
isNegativeSign: function () {
var char = this.expression.charAt(this.pos - 1);
if (char === "-") {
return true;
}
return false;
},
isLeftParen: function () {
var char = this.expression.charAt(this.pos);
if (char === "(") {
this.pos++;
this.tmpprio += 10;
return true;
}
return false;
},
isRightParen: function () {
var char = this.expression.charAt(this.pos);
if (char === ")") {
this.pos++;
this.tmpprio -= 10;
return true;
}
return false;
},
isComma: function () {
var char = this.expression.charAt(this.pos);
if (char === ",") {
this.pos++;
this.tokenprio = -1;
this.tokenindex = ",";
return true;
}
return false;
},
isWhite: function () {
var code = this.expression.charCodeAt(this.pos);
if (code === 32 || code === 9 || code === 10 || code === 13) {
this.pos++;
return true;
}
return false;
},
isOp1: function () {
var i, str = "";
for (i = this.pos; i < this.expression.length; i++) {
var c = this.expression.charAt(i);
if ( (c.toUpperCase() === c.toLowerCase()) && (c != '{') ) {
if (i === this.pos || c < '0' || c > '9') {
break;
}
}
str += c;
}
if (str.length > 0 && (str in this.ops1)) {
this.tokenindex = str;
this.tokenprio = 5;
this.pos += str.length;
return true;
}
return false;
},
isOp2: function () {
var i, str = "";
for (i = this.pos; i < this.expression.length; i++) {
var c = this.expression.charAt(i);
if (c.toUpperCase() === c.toLowerCase()) {
if (i === this.pos || c < '0' || c > '9') {
break;
}
}
str += c;
}
if (str.length > 0 && (str in this.ops2)) {
this.tokenindex = str;
this.tokenprio = 5;
this.pos += str.length;
return true;
}
return false;
},
isVar: function () {
var i, str = "";
for (i = this.pos; i < this.expression.length; i++) {
var c = this.expression.charAt(i);
if ((c.toUpperCase() === c.toLowerCase()) && (c !== '_') && (c !== '.')) {
if (i === this.pos || c < '0' || c > '9') {
break;
}
}
str += c;
}
if (str.length > 0) {
this.tokenindex = str;
this.tokenprio = 4;
this.pos += str.length;
return true;
}
return false;
},
isComment: function () {
var char = this.expression.charAt(this.pos - 1);
if (char === "/" && this.expression.charAt(this.pos) === "*") {
this.pos = this.expression.indexOf("*/", this.pos) + 2;
if (this.pos === 1) {
this.pos = this.expression.length;
}
return true;
}
return false;
}
};
Expression.prototype = {
simplify: function (values) {
values = values || {};
var nstack = [];
var newexpression = [];
var f, i, item, n1, n2;
var L = this.tokens.length;
for (i = 0; i < L; i++) {
item = this.tokens[i];
var type_ = item.type_;
if (type_ === TNUMBER) {
nstack.push(item);
}
else if (type_ === TVAR && (item.index_ in values)) {
item = new Token(TNUMBER, 0, 0, values[item.index_]);
nstack.push(item);
}
else if (type_ === TOP2 && nstack.length > 1) {
n2 = nstack.pop();
n1 = nstack.pop();
f = this.ops2[item.index_];
item = new Token(TNUMBER, 0, 0, f(n1.number_, n2.number_));
nstack.push(item);
}
else if (type_ === TOP1 && nstack.length > 0) {
n1 = nstack.pop();
f = this.ops1[item.index_];
item = new Token(TNUMBER, 0, 0, f(n1.number_));
nstack.push(item);
}
else {
while (nstack.length > 0) {
newexpression.push(nstack.shift());
}
newexpression.push(item);
}
}
while (nstack.length > 0) {
newexpression.push(nstack.shift());
}
return new Expression(newexpression, object(this.ops1), object(this.ops2), object(this.functions));
},
substitute: function (variable, expr) {
if (!(expr instanceof Expression)) {
expr = new Parser().parse(String(expr));
}
var newexpression = [];
var L = this.tokens.length;
var i, item;
for (i = 0; i < L; i++) {
item = this.tokens[i];
var type_ = item.type_;
if (type_ === TVAR && item.index_ === variable) {
for (var j = 0; j < expr.tokens.length; j++) {
var expritem = expr.tokens[j];
var replitem = new Token(expritem.type_, expritem.index_, expritem.prio_, expritem.number_);
newexpression.push(replitem);
}
}
else {
newexpression.push(item);
}
}
var ret = new Expression(newexpression, object(this.ops1), object(this.ops2), object(this.functions));
return ret;
},
evaluate: function (values) {
values = values || {};
var nstack = [];
var f, i, item, n1, n2;
var L = this.tokens.length;
for (i = 0; i < L; i++) {
item = this.tokens[i];
var type_ = item.type_;
if (type_ === TNUMBER) {
nstack.push(item.number_);
}
else if (type_ === TOP2) {
n2 = nstack.pop();
n1 = nstack.pop();
f = this.ops2[item.index_];
nstack.push(f(n1, n2));
}
else if (type_ === TVAR) {
if (item.index_ in values) {
nstack.push(values[item.index_]);
}
else if (item.index_ in this.functions) {
nstack.push(this.functions[item.index_]);
}
else {
throw new Error("undefined variable: " + item.index_);
}
}
else if (type_ === TOP1) {
n1 = nstack.pop();
f = this.ops1[item.index_];
nstack.push(f(n1));
}
else if (type_ === TFUNCALL) {
n1 = nstack.pop();
f = nstack.pop();
if (f.apply && f.call) {
if (Object.prototype.toString.call(n1) == "[object Array]") {
nstack.push(f.apply(undefined, n1));
}
else {
nstack.push(f.call(undefined, n1));
}
}
else {
throw new Error(f + " is not a function");
}
}
else {
throw new Error("invalid Expression");
}
}
if (nstack.length > 1) {
throw new Error("invalid Expression (parity)");
}
return nstack[0];
},
toString: function (toJS) {
var nstack = [];
var L = this.tokens.length;
var f, i, item, n1, n2;
for (i = 0; i < L; i++) {
item = this.tokens[i];
var type_ = item.type_;
if (type_ === TNUMBER) {
nstack.push(escapeValue(item.number_));
}
else if (type_ === TOP2) {
n2 = nstack.pop();
n1 = nstack.pop();
f = item.index_;
if (toJS && f == "^") {
nstack.push("Math.pow(" + n1 + "," + n2 + ")");
}
else {
nstack.push("(" + n1 + f + n2 + ")");
}
}
else if (type_ === TVAR) {
nstack.push(item.index_);
}
else if (type_ === TOP1) {
n1 = nstack.pop();
f = item.index_;
if (f === "-") {
nstack.push("(" + f + n1 + ")");
}
else {
nstack.push(f + "(" + n1 + ")");
}
}
else if (type_ === TFUNCALL) {
n1 = nstack.pop();
f = nstack.pop();
nstack.push(f + "(" + n1 + ")");
}
else {
throw new Error("invalid Expression");
}
}
if (nstack.length > 1) {
throw new Error("invalid Expression (parity)");
}
return nstack[0];
},
toLaTeX: function () {
var nstack = [];
var f, i, item, n1, n2;
var L = this.tokens.length;
for (i = 0; i < L; i++) {
item = this.tokens[i];
var type_ = item.type_;
if (type_ === TNUMBER) {
nstack.push(escapeValue(item.number_));
}
else if (type_ === TOP2) {
n2 = nstack.pop();
n1 = nstack.pop();
f = item.index_;
if (f == "^") {
nstack.push("{" + n1 + "}^{" + n2 + "}");
}
else if (f == "*") {
nstack.push(n1 + " \\times " + n2);
}
else if (f == "/") {
nstack.push("\\frac{" + n1 + "}{" + n2 + "}");
}
else {
nstack.push(n1 + " " + f + " " + n2);
}
}
else if (type_ === TVAR) {
nstack.push(item.index_);
}
else if (type_ === TOP1) {
n1 = nstack.pop();
f = item.index_;
if (f === "-") {
nstack.push(f + n1);
}
else {
nstack.push(f + ' ' + n1);
}
}
else if (type_ === TFUNCALL) {
n1 = nstack.pop();
f = nstack.pop();
nstack.push(f + ' ' + n1);
}
else {
throw new Error("invalid Expression");
}
}
if (nstack.length > 1) {
throw new Error("invalid Expression (parity)");
}
return nstack[0];
},
variables: function () {
var L = this.tokens.length;
var vars = [];
var i;
for (i = 0; i < L; i++) {
var item = this.tokens[i];
if (item.type_ === TVAR && (vars.indexOf(item.index_) == -1)) {
vars.push(item.index_);
}
}
return vars;
},
toJSFunction: function (param, variables) {
var f = new Function(param, "with(Parser.values) { return " + this.simplify(variables).toString(true) + "; }");
return f;
}
};
return Parser;
} ();

/* SOURCE FILE: Constraints.js (4a38f906) 9/9/2014 2:09:04 PM */

SimParser.Constraint = function() {
SimParser.ParserItem.call(this);
var constraint;
var boundedConstraint;
var formulaName;
var name;
var varList;
var type;
this.getName = function () {
return name;
}
this.setName = function (newName) {
name = newName;
}
this.getFormulaName = function () {
return formulaName;
}
this.setFormulaName = function (newFormulaName) {
formulaName = newFormulaName;
}
this.getConstraint = function () {
return constraint;
}
this.setConstraint = function (newConstraint) {
constraint = newConstraint;
}
this.getType = function () {
return type;
}
this.setType = function (newType) {
type = newType;
}
this.isConstraintBindable = function (varsWB) {
var varNames = getVarNames();
r = true;
for (var i = 0; i < varNames.length; i++) {
if (varsWB.indexOf(varNames[i]) === -1) {
r = false;
break;
}
}
return r;
}
this.setAttributes = function (attr, node) {
if (attr.name !== undefined) {
this.setName(attr.name);
}
if (attr.formula !== undefined) {
this.setFormulaName(attr.formula);
}
if (attr.clause !== undefined) {
this.setConstraint(attr.clause);
}
if (attr.type !== undefined) {
this.setType(attr.type);
}
}
this.bindConstraint = function (vars) {
varList = [];
var c = constraint;
tokens = c.match(/\w+/g);
for (var i = 0; i < tokens.length; i++) {
for (var j = 0; j < vars.length; j++) {
if (tokens[i] === vars[j].getName()) {
varList.push(vars[j]);
break;
}
}
}
var strVar = new String();
for (var i = 0; i < varList.length; i++) {
strVar = strVar + varList[i].getName() + '=' + varList[i].getValue() + ';';
}
c = c.replace(/\bor\b/g, '||').replace(/\band\b/g, '&&');
boundedConstraint = strVar + '(' + c +')';
return boundedConstraint;
}
this.evaluate = function () {
if (boundedConstraint)
return eval(boundedConstraint);
}
this.getVarNames = function () {
var c = constraint;
var cNames = [];
var tokens = c.match(/\w+/g);
for (var i = 0; i < tokens.length; i++) {
if (tokens[i].toString().toLowerCase() === 'and' ||
tokens[i].toString().toLowerCase() === 'or' ||
parseFloat(tokens[i] !== NaN)) {
;
}
else {
cNames.push(tokens[i]);
}
}
return cNames;
}
this.setEname('Constraint');
}
SimParser.Constraint.prototype = new SimParser.ParserItem();
SimParser.Constraint.prototype.constructor = SimParser.Constraint;

/* SOURCE FILE: ConstraintManager.js (0b955c71) 9/9/2014 2:09:04 PM */

SimParser.ConstraintManager = function() {
var constraints = [];
var that = this;
var subs = { '&lt;': '<', '&gt;': '>'};
this.getConstraints = function () {
return constraints;
};
this.setConstraints = function (root) {
constraints = [];
var r = root.getElementsByTagName('constraints').item(0);
if (r !== null && r.hasChildNodes()) {
for (var i = 0; i < r.childNodes.length; i++) {
var attr = {};
if (r.childNodes[i].nodeName[0] === '#') {
continue;
}
for (var j = 0; j < r.childNodes[i].attributes.length; j++) {
attr[r.childNodes[i].attributes[j].name] = r.childNodes[i].attributes[j].nodeValue;
}
c = new SimParser.Constraint();
c.setAttributes(attr, r);
constraints.push(c);
}
}
};
this.getConstraintNames = function (funcName, filter) {
var cNames = [];
if (typeof (filter) === 'undefined') {
filter = 'pre-condition';
}
for (var i = 0; i < constraints.length; i++) {
if (constraints[i].getFormulaName() === funcName && constraints[i].getType() === filter) {
cNames.push(constraints[i].getName());
}
}
return cNames;
};
this.getConstraintByName = function (cName, filter) {
if (typeof (filter) === 'undefined') {
filter = 'pre-condition';
}
for (var i = 0; i < constraints.length; i++) {
if (constraints[i].getName() === cName && constraints[i].getType() === filter) {
return constraints[i];
}
}
};
this.evalPreConstraints = function (fName, varValueList) {
var cEval = true;
if (typeof (fName) === 'undefined') {
fName = '';
}
var cn = that.getConstraintNames(fName, 'pre-condition');
for (var j = 0; j < cn.length; j++) {
var cnt = that.getConstraintByName(cn[j]);
var r = evalConstraint(cnt.getConstraint(), varValueList);
if (typeof (r) !== 'boolean') {
cEval = false;
}
else {
cEval = cEval && r;
}
if (!cEval) {
break;
}
}
return cEval;
};
this.evalPostConstraints = function (fName, varValueList, funcValueList) {
var cEval = true;
if (typeof (fName) === 'undefined') {
fName = '';
}
var varList = [];
for (var i = 0; i < varValueList.length; i++) {
varList.push(varValueList[i]);
}
for (var i = 0; i < funcValueList.length; i++) {
if (typeof (funcValueList[i]) !== 'undefined') {
varList.push(funcValueList[i]);
}
}
var cn = that.getConstraintNames(fName, 'post-condition');
for (var j = 0; j < cn.length; j++) {
var cnt = that.getConstraintByName(cn[j], 'post-condition');
var r = evalConstraint(cnt.getConstraint(), varList);
if (typeof (r) !== 'boolean') {
cEval = false;
}
else {
cEval = cEval && r;
}
if (!cEval) {
break;
}
}
return cEval;
};
var evalConstraint = function (constraint, vars) {
var result = null;
var varList = [];
var c = constraint;
var variables = vars;
var nonVariableTokens = [];
var tokens = c.match(/\w+/g);
for (var i = 0; i < tokens.length; i++) {
var tokenIsVariable = false;
for (var j = 0; j < variables.length; j++) {
if (tokens[i] === variables[j].name) {
varList.push(variables[j]);
tokenIsVariable = true;
break;
}
}
if ((isNaN(tokens[i])) && (tokens[i] !== 'and') && (tokens[i] !== 'or') && (tokenIsVariable == false) && (!arrayContains(nonVariableTokens, tokens[i]))) {
var pattern = new RegExp(tokens[i], 'g');
var newPatten = "'" + tokens[i] + "'";
c = c.replace(pattern, newPatten);
nonVariableTokens.push(tokens[i]);
}
}
var strVar = new String();
for (var i = 0; i < varList.length; i++) {
if (varList[i].value[0] != null) {
if (isNaN(varList[i].value[0])) {
strVar = strVar + varList[i].name + "='" + varList[i].value + "';";
}
else {
strVar = strVar + varList[i].name + '=' + varList[i].value + ';';
}
}
else if (varList[i].value != null) {
if (isNaN(varList[i].value)) {
strVar = strVar + varList[i].name + "='" + varList[i].value + "';";
}
else {
strVar = strVar + varList[i].name + '=' + varList[i].value + ';';
}
}
}
c = c.replace(/\bor\b/g, '||').replace(/\band\b/g, '&&');
try {
result = eval(strVar + '(' + c + ')');
}
catch (err) {
result = err.message;
}
return result;
};
var arrayContains = function(arr, obj) {
var i = arr.length;
while (i--) {
if (arr[i] === obj) {
return true;
}
}
return false;
};
};

/* SOURCE FILE: Permutations.js (f3e6b91c) 9/9/2014 2:09:04 PM */

SimParser.Permutation = function(vars) {
var n = vars.length;
var pia = [];
var piv = [];
var rs = [];
var init = function () {
rs = [];
for (var i = 0; i < n; i++) {
pia[i] = 0;
piv[i] = vars[i].length - 1;
}
}
var next = function () {
for (var i = n - 1; i >= 0; i--) {
if (pia[i] < piv[i]) {
pia[i]++;
return true;
}
else {
var j = i - 1;
while ((j >= 0) && (pia[j] === piv[j])) j--;
if (j < 0) {
return false
} else {
pia[j]++;
for (var k = j + 1; k <= i; k++) pia[k] = 0;
return true;
}
}
}
}
var currentPermutation = function () {
var cp = [];
for (i = 0; i < n; i++) {
cp.push(vars[i][pia[i]]);
}
return cp;
}
var run = function () {
init();
do {
rs.push(currentPermutation());
}
while (next());
return rs;
}
return run();
};

/* SOURCE FILE: Functions.js (f72ba796) 9/9/2014 2:09:04 PM */

SimParser.Function = function() {
SimParser.ParserItem.call(this);
var name;
var nameProxy;
var equation='';
var varList = [];
var value;
var context;
var type = 'regualar';
var variable;
var parser = new Parser();
var lookup;
var code = '';
var func;
var keyName = undefined;
var filter = '';
var scoreable = 'yes';
var orderedEvaluation = false;
var depLevel = -1;
var compOrder = -1;
this.bindVariables = function (vars) {
var vList = [];
var p = parser.parse(equation);
for (var i = 0; i < p.tokens.length; i++) {
if (p.tokens[i].type_ === 3) {
for (var j = 0; j < vars.length; j++) {
var v = undefined;
if (vars[j].getName() === p.tokens[i].index_) {
v = vars[j];
break;
}
}
if (v) {
vList.push(v);
}
}
}
this.setVarList(vList);
}
this.evaluateEquation = function () {
var bindList= {};
for (var i = 0; i < varList.length; i++) {
bindList[varList[i].getName()] = varList[i].getValue();
}
return parser.parse(this.getEquation()).evaluate(bindList);
}
this.testAnswer = function(testValue) {
return (value === testValue);
}
this.getValue = function () {
return value;
}
this.setValue = function (newValue) {
value = newValue;
return this;
}
this.getEquation = function () {
return equation;
}
this.setEquation = function (newEquation) {
equation = newEquation;
return this;
}
this.getVarList = function () {
return varList;
}
this.setVarList = function (vars) {
varList = vars;
return this;
}
this.setVarList = function (newVarList) {
varList = newVarList;
return this;
}
this.getName = function () {
return name;
}
this.setName = function (newName) {
name = newName;
return this;
}
this.getContext = function () {
return context;
}
this.setContext = function (newContext) {
context = newContext;
return this;
}
this.getDepLevel = function () {
return depLevel;
}
this.setDepLevel = function (level) {
depLevel = level;
}
this.getCompOrder = function () {
return compOrder;
}
this.setCompOrder = function (newCompOrder) {
compOrder = newCompOrder;
}
this.getVariable = function () {
return variable;
}
this.setVariable = function (newVariable) {
variable = newVariable;
}
this.getCode = function () {
return code;
}
this.setCode = function (newCode) {
code = newCode;
}
this.getScoreable = function () {
return scoreable;
}
this.setScoreable = function (newScorable) {
if (newScorable !== 'no') {
newScorable='yes'
}
scoreable = newScorable;
}
this.getOrderedEvaluation = function () {
return orderedEvaluation;
}
this.setOrderedEvaluation = function (ordered) {
if (ordered === 'yes') {
orderedEvaluation = true;
}
else {
orderedEvaluation = false;
}
}
this.getFunction = function () {
if (!func) {
var vNames = this.getVarNames();
var params = vNames.join(',');
func = new Function(params, 'return ' + this.getCode());
}
return func;
}
this.getVarNames = function () {
var fNames = [];
var p = parser.parse(equation);
for (var i = 0; i < p.tokens.length; i++) {
if (p.tokens[i].type_ === 3 && fNames.indexOf(p.tokens[i].index_) === -1 && p.tokens[i].index_ !== name) {
if ((p.tokens[i].index_.length < 5) || (p.tokens[i].index_.substring(0,5).toLowerCase() != 'math.')) {
fNames.push(p.tokens[i].index_);
}
}
}
return fNames;
}
this.getType = function () {
return type;
}
this.setType = function (t) {
type = t;
}
this.getKeyName = function () {
return keyName;
}
this.setKeyName = function (k) {
keyName = k;
}
this.getLookupValue = function (v) {
if (!lookup) {
lookup = {};
lookup = eval('(' + equation + ')');
}
return lookup[v];
}
this.getFilter = function () {
return filter;
}
this.setFilter = function (f) {
filter = f;
}
this.getProxyName = function () {
return nameProxy;
}
this.setProxyName = function (p) {
nameProxy = p;
}
this.setAttributes = function (attr, node) {
if (attr.type !== undefined) this.setType(attr.type);
if (attr.nameProxy !== undefined) this.setProxyName(attr.nameProxy);
if (attr.name !== undefined) this.setName(attr.name);
if (attr.formula !== undefined) this.setEquation(attr.formula);
if (attr.context !== undefined) this.setContext(attr.context);
if (attr.value !== undefined) this.setValue(attr.value);
if (attr.variable !== undefined) this.setVariable(attr.variable);
if (attr.code !== undefined) {
if (this.getType() === 'javascript') {
this.setEquation(attr.code);
}
this.setCode(attr.code);
}
if (attr.keyName !== undefined) this.setKeyName(attr.keyName);
if (attr.filter !== undefined) this.setFilter(attr.filter);
this.setScoreable(attr.scoreable);
if (attr.orderedEvaluation !== undefined) this.setOrderedEvaluation(attr.orderedEvaluation);
}
this.setEname('Equation');
};
SimParser.Function.prototype = new SimParser.ParserItem();
SimParser.Function.prototype.constructor = SimParser.Function;

/* SOURCE FILE: FunctionManager.js (3aec57b1) 9/9/2014 2:09:04 PM */

SimParser.FunctionManager = function (eUnit) {
var functions = [];
var lfunctions = [];
var jfunctions = [];
var that = this;
var maxDepLevel = 0;
var depTreeExists = false;
var currentOrder = 0;
var varCurrent = [];
var evUnit = eUnit;
var scoringTable = evUnit.getSimInstance().getScoringTable();
var cMng = evUnit.getConstraintManager();
function mergeArrays(arrayOne, arrayTwo) {
var result = [];
for (var i = 0; i < arrayOne.length; i++) {
result.push(arrayOne[i]);
}
for (var i = 0; i < arrayTwo.length; i++) {
result.push(arrayTwo[i]);
}
return result;
}
function compareArrays(arrayOne, arrayTwo) {
for (var i = 0; i < arrayOne.length; i++) {
if (arrayTwo.indexOf(arrayOne[i]) === -1) {
return false;
}
}
return true;
}
this.getMaxDepLevel = function () {
return maxDepLevel;
}
this.setMaxDepLevel = function (level) {
maxDepLevel = level;
}
this.getFunctions = function () {
return functions;
}
this.getLFunctions = function () {
return lfunctions;
}
this.getJFunctions = function () {
return jfunctions;
}
this.setFunctions = function (root) {
functions = [];
var r = root.getElementsByTagName('functions').item(0);
if (r !== null && r.hasChildNodes()) {
for (var i = 0; i < r.childNodes.length; i++) {
var attr = {};
if (r.childNodes[i].nodeName[0] === '#') {
continue;
}
for (var j = 0; j < r.childNodes[i].attributes.length; j++) {
attr[r.childNodes[i].attributes[j].name] = r.childNodes[i].attributes[j].nodeValue;
}
var newFunction = new SimParser.Function();
newFunction.setAttributes(attr, r);
if (newFunction.getScoreable() !== 'no') {
scoringTable.addElement(newFunction.getName(), 'output');
}
functions.push(newFunction);
}
}
}
this.getFunctionNames = function () {
var fNames = [];
for (var i = 0; i < functions.length; i++) {
fNames.push(functions[i].getName());
}
return fNames;
}
this.getFunctionByName = function (funcName) {
for (var i = 0; i < functions.length; i++) {
if (functions[i].getName() === funcName) {
return functions[i];
}
}
for (var i = 0; i < lfunctions.length; i++) {
if (lfunctions[i].getName() === funcName) {
return lfunctions[i];
}
}
for (var i = 0; i < jfunctions.length; i++) {
if (jfunctions[i].getName() === funcName) {
return jfunctions[i];
}
}
}
this.getLFunctionByName = function (funcName) {
for (var i = 0; i < functions.length; i++) {
if (lfunctions[i].getName() === funcName) {
return lfunctions[i];
}
}
}
this.evaluateOrderedFunctions = function () {
var evaluationSucceed = true;
var iCompOrder = 0;
var vMng = evUnit.getVariableManager();
varCurrent = vMng.getVariableNames(['binding', 'constant', 'implicit', 'persistent', 'cumulative']);
for (var i=0; i<functions.length; i++) {
if (functions[i].getOrderedEvaluation() == true) {
if (this.canComputeFunction(functions[i], varCurrent)) {
functions[i].setCompOrder(iCompOrder);
iCompOrder++;
var varNext = [];
varNext.push(functions[i].getValue());
varCurrent = mergeArrays(varCurrent, varNext);
}
else {
EU.debug('Function evaluation cannot work because ordered function ' + functions[i].getValue() + ' cannot be evaluated');
evaluationSucceed = false;
depTreeExists = true;
break;
}
}
}
if (evaluationSucceed == true) {
currentOrder = iCompOrder;
}
}
this.buildFunctionDependancyTree = function () {
this.evaluateOrderedFunctions();
if (depTreeExists) {
return;
}
var orderedFuncList = [];
var varNext = [];
var iCompOrder = currentOrder;
var iDepLevel = 0;
var bEnd = false;
var iTotalAmount = functions.length;
while (iCompOrder < iTotalAmount && !bEnd) {
var oldCompOrder = iCompOrder;
for (var k = 0; k < functions.length; k++) {
if ((functions[k].getOrderedEvaluation() == false) && (functions[k].getDepLevel() === -1) && (this.canComputeFunction(functions[k], varCurrent))) {
functions[k].setDepLevel(iDepLevel);
functions[k].setCompOrder(iCompOrder);
orderedFuncList.push(functions[k]);
iCompOrder++;
varNext.push(functions[k].getValue());
}
}
iDepLevel++;
varCurrent = mergeArrays(varCurrent, varNext);
bEnd = !!oldCompOrder == iCompOrder;
}
if (iCompOrder === iTotalAmount) {
depTreeExists = true;
}
else {
EU.debug('Function evaluation cannot work because of broken dependancy tree.');
}
maxDepLevel = iDepLevel - 1;
}
this.buildFuncVarMap = function () {
var map = {};
for (var i = 0; i < functions.length; i++) {
map[functions[i].name] = functions[i].value;
}
return map;
}
this.canComputeFunction = function (func, values) {
var fvars;
if (func.getType() == "lookup") {
fvars = [func.getKeyName()];
}
else {
fvars = func.getVarNames();
}
return compareArrays(fvars, values);
}
this.getFunctionByCompOrder = function (order) {
for (var i = 0; i < functions.length; i++) {
if (functions[i].getCompOrder() === order) {
return functions[i];
}
}
}
this.bindVars = function () {
for (var i = 0; i < functions.length; i++) {
functions[i].bindVariables(variables);
}
}
this.evalFuncs = function () {
var res = [];
for (var i = 0; i < functions.length; i++) {
res.push(functions[i].evaluateEquation());
}
}
this.evaluateLFunctions = function (varValueList, varNames, varValues) {
var r = {};
for (var i = 0; i < lfunctions.length; i++) {
if (lfunctions[i].getScoreable() === 'yes') {
var varName = lfunctions[i].getName();
var fName = lfunctions[i].getKeyName();
if ((varName) && (cMng.evalPreConstraints(varName, varValueList))) {
var ind = varNames.indexOf(fName);
if (ind >= 0) {
var val = varValues[ind];
r[varName] = lfunctions[i].getLookupValue(val);
scoringTable.setValue(varName, null, r[varName]);
}
}
}
}
return r;
}
var evalFormula = function (formula, variables) {
var parser = new Parser();
try {
var result = parser.parse(formula).evaluate(variables);
}
catch (e) {
result = e.message;
}
return result;
}
this.evaluateJFunctions = function (varNames, varValues) {
var r = {};
var evUtils = new SimParser.Utils(evUnit);
var v = evUtils.getVarObject(varNames, varValues);
for (var i = 0; i < jfunctions.length; i++) {
if (jfunctions[i].getScoreable() === 'yes') {
var varName = jfunctions[i].getName();
if (varName) {
var sirF = jfunctions[i];
var jF = sirF.getFunction();
v[varName] = jF;
r[varName] = evalFormula(sirF.getEquation(), v);
scoringTable.setValue(varName, null, r[varName]);
}
}
}
return r;
}
this.getFunctionIndexByName = function (name, type) {
var fn = this.getFunctions();
if (type === 'lookup') var fn = this.getLFunctions();
for (var i = 0; i < fn.length; i++) {
if (fn[i].getName() === name) {
return i;
}
}
}
this.createFunction = function (name, type, formula, vName) {
var f = new SimParser.Function();
var attr = { 'name': name, 'type': type, 'formula': formula, 'variable': vName };
f.setAttributes(attr);
if (attr.type === 'lookup') {
lfunctions.push(f);
}
else {
functions.push(f);
}
}
this.renameEquation = function (oldName, newName) {
var f = this.getFunctionByName(oldName);
if (f) {
f.setName(newName);
}
}
this.updateFunction = function (name, type, formula, vName) {
var f = this.getFunctionNames(name);
if (!f) f = this.getLFunctionNames(name);
if (f) {
var attr = { 'name': name, 'type': type, 'formula': formula, 'variable': vName };
f.setAttributes(attr);
}
}
this.deleteFunction = function (name) {
var i = this.getFunctionIndexByName(name);
if (i) {
var fn = this.getFunctions();
fn.splice(i, 1);
}
else {
i = this.getFunctionIndexByName(name, 'lookup');
if (i) {
var fn = getLFunctions();
fn.splice(i, 1);
}
}
}
};

/* SOURCE FILE: FilterEvaluation.js (63af4f4c) 9/9/2014 2:09:04 PM */

SimParser.FilterEvaluation = function (eUnit) {
var filters = 'max, min, average';
var rs;
var impVar = [];
var evUnit = eUnit;
var vMng = evUnit.getVariableManager();
var fMng = evUnit.getFunctionManager();
function getValues(fName) {
var r = [];
for (var i = 0; i < rs.length; i++) {
r.push(rs[i].functions[fName]);
}
return r;
}
function getVarValues(vName) {
var r = [];
for (var i = 0; i < rs.length; i++) {
r.push(rs[i].variables[vName]);
}
return r;
}
function max(fName) {
var v = getValues(fName);
var f = false;
var vr = impVar;
var maxValue = - Infinity;
var maxIndex = undefined;
for (var i=0; i<v.length; i++) {
if (v[i] && (v[i] > maxValue)) {
maxValue = v[i];
maxIndex = vr[i];
f = true;
}
}
return f ? maxValue : undefined;
}
function min(fName) {
var v = getValues(fName);
var vr = impVar;
var minValue = Infinity;
var minIndex = undefined;
var f = false;
for (var i=0; i<v.length; i++) {
if (v[i] && (v[i] < minValue)) {
minValue = v[i];
minIndex = vr[i];
f = true;
}
}
return f ? minValue : undefined;
}
function average(fName) {
var v = getValues(fName);
var totValue = 0;
var avValue = 0.0;
var f = false;
for (var i=0; i<v.length; i++) {
totValue = totValue + v[i];
}
if (v.length > 0) {
avValue = totValue / v.length;
f = true;
}
return f ? avValue : undefined;
}
this.run = function (result) {
rs = result;
var fList = fMng.getFunctionNames();
var impNames = vMng.getVariableNames(['implicit']);
if (impNames.length !== 1) {
return rs;
}
impVar = getVarValues(impNames[0]);
for (var i = 0; i < fList.length; i++) {
var r = {};
var sirF = fMng.getFunctionByName(fList[i]);
var filter = sirF.getFilter();
if (filter !== '') {
var fValues = getValues(fList[i]);
var aFilter = filter.split(',');
for (var j=0; j<aFilter.length; j++){
switch (aFilter[j]) {
case 'max':
r = max(fList[i]);
break;
case 'min':
r = min(fList[i]);
break;
case 'average':
r = average(fList[i]);
break;
}
}
for (var k=0; k<rs.length;k++) {
delete rs[k].functions[fList[i]];
var allgone = true;
if (fList.length - 1 === i || k > 0) {
for (var p in rs[k].functions) {
if (rs[k].functions.hasOwnProperty(p)) {
allgone = false;
break;
}
}
if (allgone) {
delete rs[k].functions;
delete rs[k].variables;
rs[k] = undefined;
}
}
}
rs[0].functions[fList[i]] = r;
}
}
var rs1 = [];
for (var i = 0; i < rs.length; i++) {
if (rs[i] !== undefined) {
rs1.push(rs[i]);
}
}
return rs1;
}
}

/* SOURCE FILE: Ranges.js (20308803) 9/9/2014 2:09:04 PM */

SimParser.Range = function() {
SimParser.ParserItem.call(this);
var name;
var type;
this.getName = function () {
return name;
}
this.setName = function (newName) {
name = newName;
}
this.getType = function () {
return type;
}
this.setType = function (newType) {
type = newType;
}
SimParser.Range.prototype.setAttributes = function (attr) {
if (attr.name !== undefined) {
this.setName(attr.name);
}
if (attr.type !== undefined) {
this.setType(attr.type);
}
}
}
SimParser.Range.prototype = new SimParser.ParserItem();
SimParser.Range.prototype.constructor = SimParser.Range;

/* SOURCE FILE: RangeManager.js (ed4ffc7c) 9/9/2014 2:09:04 PM */

SimParser.RangeManager = function() {
var ranges = [];
var that = this;
this.getRanges = function () {
return ranges;
}
this.setRanges = function (root) {
ranges = [];
var r = root.getElementsByTagName('ranges').item(0);
if (r !== null && r.hasChildNodes()) {
for (var i = 0; i < r.childNodes.length; i++) {
var attr = {};
if (r.childNodes[i].nodeName[0] === '#') {
continue;
}
for (var j = 0; j < r.childNodes[i].attributes.length; j++) {
attr[r.childNodes[i].attributes[j].name] = r.childNodes[i].attributes[j].nodeValue;
}
switch (attr.type) {
case 'range':
var rn = new SimParser.MinMaxRange();
break;
case 'iterator':
var rn = new SimParser.IterationRange();
break;
}
rn.setAttributes(attr, r);
ranges.push(rn);
}
}
}
this.getRangeByName = function (name) {
for (var i = 0; i < ranges.length; i++) {
if (ranges[i].getName() === name) {
return ranges[i];
}
}
}
}

/* SOURCE FILE: MinMaxRange.js (1b373b55) 9/9/2014 2:09:04 PM */

SimParser.MinMaxRange = function() {
SimParser.Range.call(this);
var minValue = new Number();
var maxValue = new Number();
var increment = new Number();
var values;
var currentValue = new Number();
this.runNext = function (callback, params) {
if (currentValue <= maxValue) {
callback(params);
currentValue++;
}
}
this.runAll = function (callback, params) {
for (var i = minValue; i <= maxValue; i += increment) {
callback(params);
currentValue = i;
}
}
this.IsValueinRange = function (val) {
return (value >= minValue && value <= maxValue);
}
this.reset = function () {
currentValue = minValue;
}
this.getValues = function () {
return values;
}
this.setValues = function () {
values = [];
if (typeof (minValue) === 'undefined' || typeof (maxValue) === 'undefined' || typeof (incrementValue) === 'undefined') {
EU.debug('minValue/maxValue/increment is not defined in ' + name);
}
var curValue = minValue;
while (curValue <= maxValue) {
values.push(curValue);
curValue = curValue + increment;
}
}
SimParser.MinMaxRange.prototype.setAttributes = function (attr) {
SimParser.Range.prototype.setAttributes.call(this, attr);
if (attr.minValue !== undefined) {
minValue = parseInt(attr.minValue);
}
else {
minValue = 1;
}
if (attr.maxValue !== undefined) {
maxValue = parseInt(attr.maxValue);
}
else {
maxValue = 10;
}
if (attr.increment !== undefined)  {
increment = parseFloat(attr.increment);
}
else {
increment = 1;
}
this.setValues();
}
}
SimParser.MinMaxRange.prototype = new SimParser.Range();
SimParser.MinMaxRange.prototype.constructor = SimParser.MinMaxRange;

/* SOURCE FILE: IterationRange.js (a59630b6) 9/9/2014 2:09:04 PM */

SimParser.IterationRange = function() {
SimParser.Range.call(this);
var startValue = new Number();
var numIterations = new Number();
var currentValue = new Number();
var values;
this.runNext = function (callback, params) {
if (currentValue <= numIterations) {
callback(params);
currentValue++;
}
}
this.runAll = function (callback, params) {
for (var i = 1; i <= numIterations; i++) {
callback(params);
currentValue = i;
}
}
this.reset = function () {
currentValue = 1;
}
this.getValues = function () {
return values;
}
this.getStartValue = function () {
return startValue;
}
this.setStartValue = function (newStartValue) {
startValue = newStartValue;
}
this.setValues = function () {
values = [];
if (typeof (startValue) === 'undefined' || typeof (numIterations) === 'undefined') {
EU.debug('startValue or numIterations is not defined in ' + name);
}
for (var i = startValue; i < numIterations; i++) {
values.push(i);
}
}
this.getNumIterations = function () {
return numIterations;
}
this.setNumIterations = function (iterations) {
numIterations = iterations;
}
SimParser.IterationRange.prototype.setAttributes = function (attr) {
SimParser.Range.prototype.setAttributes.call(this, attr);
if (attr.numIteration !== undefined) {
numIterations = parseInt(attr.numIteration);
}
else {
numIterations = 10;
}
if (attr.startValue !== undefined) {
startValue = parseInt(attr.startValue);
}
else {
startValue = 1;
}
if (attr.type !== undefined) {
this.type = attr.type;
}
this.setValues();
}
}
SimParser.IterationRange.prototype = new SimParser.Range();
SimParser.IterationRange.prototype.constructor = SimParser.IterationRange;

/* SOURCE FILE: Variables.js (968c17ce) 9/9/2014 2:09:04 PM */

SimParser.Variable = function() {
SimParser.ParserItem.call(this);
var name;
var type;
var objectName;
var value = new Number();
this.getName = function () {
return name;
}
this.setName = function (n) {
name = n;
return this;
}
this.getType = function () {
return type;
}
this.setType = function (t) {
type = t;
return this;
}
this.getValue = function () {
return value;
}
this.setValue = function (v) {
value = v;
return this;
}
this.getObjectName = function () {
return objectName;
}
this.setObjectName = function (o) {
objectName = o;
return this;
}
SimParser.Variable.prototype.setAttributes = function (attr, node) {
if (attr.name !== undefined) {
this.setName(attr.name);
}
if (attr.type !== undefined) {
this.setType(attr.type);
}
if (attr.value !== undefined) {
this.setValue(attr.value);
}
if (attr.object !== undefined) {
this.setObjectName(attr.object);
}
}
this.setEname('BaseVariable');
}
SimParser.Variable.prototype = new SimParser.ParserItem();
SimParser.Variable.prototype.constructor = SimParser.Variable;

/* SOURCE FILE: VariableManager.js (a90121a7) 9/9/2014 2:09:04 PM */

SimParser.VariableManager = function (eUnit) {
var variables = [];
var evUnit = eUnit;
var that = this;
this.getVariables = function () {
return variables;
}
this.setVariables = function (root) {
variables = [];
r = root.getElementsByTagName('variables').item(0);
if (r !== null && r.hasChildNodes()) {
for (var i = 0; i < r.childNodes.length; i++) {
if (r.childNodes[i].nodeName[0] === '#') {
continue;
}
var attr = {};
var rc = r.childNodes[i];
for (var j = 0; j < r.childNodes[i].attributes.length; j++) {
attr[r.childNodes[i].attributes[j].name] = r.childNodes[i].attributes[j].nodeValue;
}
if (rc.hasChildNodes()) {
var vals = [];
for (var k = 0; k < rc.childNodes.length; k++) {
if (rc.childNodes[k].nodeName[0] === '#') {
continue;
}
vals.push(rc.childNodes[k].textContent);
}
attr.allValues = vals;
}
var vr;
switch (attr.type) {
case 'binding':
vr = new SimParser.BindableVariable();
break;
case 'constant':
vr = new SimParser.ConstantVariable();
break;
case 'implicit':
vr = new SimParser.ImplicitVariable();
var rMng = evUnit.getRangeManager();
attr.sirRange = rMng.getRangeByName(attr.range);
break;
case 'result':
vr = new SimParser.ResultVariable();
break;
case 'lookup':
vr = new SimParser.LookupVariable();
break;
case 'cumulative':
vr = new SimParser.CumulativeVariable();
break;
case 'persistent':
vr = new SimParser.PersistentVariable();
break;
default:
vr = new SimParser.Variable();
break;
}
vr.setAttributes(attr, r);
variables.push(vr);
}
}
}
this.getConstants = function () {
var cNames = [];
var vars = that.getVariables();
for (var i = 0; i < vars.length; i++) {
if (vars[i].type === 'constant') {
cNames.push({ name: vars[i].name, value: [vars[i].value] });
}
}
return cNames;
}
this.getVariableByName = function (vName) {
var v = undefined;
for (var i = 0; i < variables.length; i++) {
if (variables[i].getName() === vName) {
return variables[i];
}
}
}
this.getVarIndexByName = function (vName) {
for (var i = 0; i < variables.length; i++) {
if (variables[i].getName() === vName) {
return i;
}
}
}
this.getVariableNames = function (filter) {
var vNames = [];
for (var i = 0; i < variables.length; i++) {
if ((filter === undefined) || (filter.indexOf(variables[i].getType()) >= 0)) {
vNames.push(variables[i].getName());
}
}
return vNames;
}
this.getVariableByObjectName = function (name) {
for (var i = 0; i < variables.length; i++) {
if (variables[i].getObjectName() === name) {
return variables[i];
}
}
}
this.isVarBindable = function (vName) {
var v = that.getVariableByName(vName);
return (v === undefined) ? false : v.type === 'binding';
}
this.isVarConstant = function (vName) {
var v = that.getVariableByName(vName);
return (v === undefined) ? false : v.type === 'constant';
}
this.isVarImplicit = function (vName) {
var v = that.getVariableByName(vName);
return (v === undefined) ? false : v.type === 'implicit';
}
this.isVarResult = function (vName) {
var v = that.getVariableByName(vName);
return (v === undefined) ? false : v.type === 'result';
}
this.getConstantNames = function () {
var cNames = [];
var vars = that.getVariables();
for (var i = 0; i < vars.length; i++) {
if (vars[i].getType() === 'constant') {
cNames.push(vars[i].getName());
}
}
return cNames;
}
this.getConstants = function () {
var cNames = [];
var vars = that.getVariables();
for (var i = 0; i < vars.length; i++) {
if (vars[i].getType() === 'constant') {
cNames.push({ name: vars[i].getName(), value: [vars[i].getValue()] });
}
}
return cNames;
}
function createVariable (name, value, type) {
var vr = undefined;
var attr = { 'type': type, 'name': name, 'value': value };
switch (attr.type) {
case 'binding':
vr = new SimParser.BindableVariable();
break;
case 'constant':
vr = new SimParser.ConstantVariable();
break;
case 'implicit':
vr = new SimParser.ImplicitVariable();
attr.sirRange = SirRangeManager.getRangeByName(attr.range);
break;
case 'result':
vr = new SimParser.ResultVariable();
break;
case 'lookup':
vr = new SimParser.LookupVariable();
break;
}
if (vr) {
vr.setAttributes(attr);
variables.push(vr);
return true;
}
else {
return false;
}
}
this.saveVariable = function (name, value, type) {
var v = this.getVariableByName(name);
if (v) {
v.setValue(value);
v.setName(name)
}
else {
createVariable(name, value, type);
}
}
this.renameVariable = function (oldName, newName) {
var v = this.getVariableByName(oldName);
if (v) {
v.setName(newName);
}
}
this.updateVariable = function (name, value) {
var v = this.getVariableByName(name);
if (v) {
var attr = { 'name': name, 'value': value };
v.setAttributes(attr);
}
}
this.deleteVariable = function (name) {
var i = this.getVarIndexByName(name);
if (i) {
functions.splice(i, 1);
}
}
};

/* SOURCE FILE: PersistentVariable.js (a729e6fa) 9/9/2014 2:09:04 PM */

SimParser.PersistentVariable = function () {
SimParser.Variable.call(this);
var store;
this.getStore = function () {
return store;
}
this.setStore = function (s) {
store = s;
return this;
}
SimParser.PersistentVariable.prototype.setAttributes = function (attr, node) {
SimParser.Variable.prototype.setAttributes.call(this, attr, node);
if (attr.store !== undefined) {
this.setStore(attr.store);
}
if (attr.comOp !== undefined) {
this.setStore(attr.cumOP);
}
}
this.setEname('PersistentVariable');
};
SimParser.PersistentVariable.prototype = new SimParser.PersistentVariable();
SimParser.PersistentVariable.prototype.constructor = SimParser.Variable;

/* SOURCE FILE: ImplicitVariable.js (ff8ae7b2) 9/9/2014 2:09:04 PM */

SimParser.ImplicitVariable = function () {
SimParser.Variable.call(this);
var allValues;
var range;
this.getValues = function () {
if (allValues) {
return allValues;
}
else {
if (range) {
allValues = range.getValues();
}
else {
allValues = [];
}
return allValues;
}
}
this.bindRange = function (newRange) {
range = newRange;
}
SimParser.ImplicitVariable.prototype.setAttributes = function (attr, node) {
SimParser.Variable.prototype.setAttributes.call(this, attr, node);
if (attr.range !== undefined) {
this.bindRange(attr.sirRange);
}
if (attr.defaultValue !== undefined) {
this.setValue(attr.defaultValue);
}
}
this.setEname('ImplicitVariable');
};
SimParser.ImplicitVariable.prototype = new SimParser.ImplicitVariable();
SimParser.ImplicitVariable.prototype.constructor = SimParser.Variable;

/* SOURCE FILE: LookupVariable.js (577cbf2a) 9/9/2014 2:09:04 PM */

SimParser.LookupVariable = function () {
SimParser.Variable.call(this);
this.getAllValues = function () {
return [value];
}
SimParser.LookupVariable.prototype.setAttributes = function (attr, node) {
SimParser.Variable.prototype.setAttributes.call(this, attr, node);
if (attr.value !== undefined) {
this.setValue(attr.value);
}
if (attr.defaultValue !== undefined) {
this.setValue(attr.defaultValue);
}
}
this.setEname('LookupVariable');
};
SimParser.LookupVariable.prototype = new SimParser.LookupVariable();
SimParser.LookupVariable.prototype.constructor = SimParser.Variable;

/* SOURCE FILE: BindableVariable.js (3889f902) 9/9/2014 2:09:04 PM */

SimParser.BindableVariable = function () {
SimParser.Variable.call(this);
var allValues;
this.getValues = function () {
return allValues;
}
this.setValues = function (v) {
allValues = v;
return this;
}
SimParser.BindableVariable.prototype.setAttributes = function (attr, node) {
SimParser.Variable.prototype.setAttributes.call(this, attr, node);
if (attr.allValues !== undefined) {
this.setValues(attr.allValues);
}
if (attr.defaultValue !== undefined) {
this.setValue(attr.defaultValue);
}
}
this.setEname('BindableVariable');
};
SimParser.BindableVariable.prototype = new SimParser.BindableVariable();
SimParser.BindableVariable.prototype.constructor = SimParser.Variable;

/* SOURCE FILE: ConstantVariable.js (77bb829f) 9/9/2014 2:09:04 PM */

SimParser.ConstantVariable = function () {
SimParser.Variable.call(this);
var allValues;
this.getAllValues = function () {
return [value];
}
SimParser.ConstantVariable.prototype.setAttributes = function (attr, node) {
SimParser.Variable.prototype.setAttributes.call(this, attr, node);
if (attr.object !== undefined) {
this.setObjectName(attr.object);
}
}
this.setEname('ConstantVariable');
};
SimParser.ConstantVariable.prototype = new SimParser.ConstantVariable();
SimParser.ConstantVariable.prototype.constructor = SimParser.Variable;

/* SOURCE FILE: CumulativeVariable.js (0b412004) 9/9/2014 2:09:04 PM */

SimParser.CumulativeVariable = function () {
SimParser.Variable.call(this);
var store;
var cumOp;
this.getStore = function () {
return store;
}
this.setStore = function (s) {
store = s;
return this;
}
this.getCumOp = function () {
return cumOp;
}
this.setCumOp = function (c) {
cumOp = c;
return this;
}
SimParser.CumulativeVariable.prototype.setAttributes = function (attr, node) {
SimParser.Variable.prototype.setAttributes.call(this, attr, node);
if (attr.store !== undefined) {
this.setStore(attr.store);
}
if (attr.cumOp !== undefined) {
this.setCumOp(attr.cumOp);
}
}
this.setEname('CumulativeVariable');
};
SimParser.CumulativeVariable.prototype = new SimParser.CumulativeVariable();
SimParser.CumulativeVariable.prototype.constructor = SimParser.Variable;

/* SOURCE FILE: ResultVariable.js (39bf143e) 9/9/2014 2:09:04 PM */

SimParser.ResultVariable = function () {
SimParser.Variable.call(this);
SimParser.ResultVariable.prototype.setAttributes = function (attr, node) {
SimParser.Variable.prototype.setAttributes.call(this, attr, node);
}
this.setEname('ResultVariable');
};
SimParser.ResultVariable.prototype = new SimParser.ResultVariable();
SimParser.ResultVariable.prototype.constructor = SimParser.Variable;

/* SOURCE FILE: FunctionEvaluation.js (f2fb049c) 9/9/2014 2:09:04 PM */

SimParser.FunctionEvaluation = function (eUnit) {
var key = undefined;
var varList = [];
var varNames = [];
var varValues = [];
var varFuncs = [];
var evalResult = [];
var isContinue = true;
var evUnit = eUnit;
var evUtils = new SimParser.Utils(eUnit);
var scoringTable = function() { return evUnit.getSimInstance().getScoringTable(); };
this.process = function (p, f) {
var d1 = new Date();
doInit(p,f);
if (isContinue) {
evalResult = doProcess(p,f);
if (evalResult.length > 0) {
doEnd();
}
}
var d2 = new Date();
return evalResult;
}
function doInit(p, f) {
varNames = [];
varValues = [];
varFuncs = [];
varList = [];
varList = evUtils.readDataFromWhiteBoard('evaluationInput', 'input');
if (varList === undefined || varList.length === 0) {
isContinue = false;
return;
}
var vWB = evUtils.mergeWBVariables(varList);
varNames = evUtils.getWBVarNames(vWB);
varValues = evUtils.getWBVarValues(vWB);
varNames = evUtils.convertElementNamesToVarNames(varNames);
p = new Parser();
var c = evUtils.getConstantValues();
for (var i = 0; i < c.vNames.length; i++) {
varNames.push(c.vNames[i]);
varValues.push(c.vValues[i]);
}
if (typeof (f) === 'undefined') {
varFuncs = evUtils.getFuncVars();
} else {
varFuncs = evUtils.getFuncVars(f);
}
var impVars = evUtils.getImplicitValues(varFuncs);
for (var i = 0; i < impVars.names.length; i++) {
varNames.push(impVars.names[i]);
varValues.push(impVars.values[i]);
}
}
function doProcess (p, f) {
var param = {};
if (typeof (p) === 'undefined') {
param.algorithm = 'greedy';
}
else {
param.algorithm = p;
}
var fList = [];
if (typeof (f) === 'undefined' || f === null || f === '') {
}
else {
var fMng = evUnit.getFunctionManager();
var sirF = fMng.getFunctionByName(f);
if (sirF === undefined) {
EU.debug('unknown function to evaluate: ' + f);
}
else {
fList.push(f);
}
}
var r = doProcess3();
return r;
}
var evalFormula2 = function (formula, variables) {
var parser = new Parser();
vars = {};
for (var i = 0; i < variables.length; i++) {
vars[variables[i].name] = variables[i].value;
}
try {
var result = parser.parse(formula).evaluate(vars);
}
catch (e) {
result = e.message;
}
return result;
}
function doProcess3 () {
var fMng = evUnit.getFunctionManager();
fMng.buildFunctionDependancyTree();
var result = [];
var persistentVarDB = evUnit.getSimInstance().getPersistentVariableDB();
var funcCount = fMng.getFunctions().length;
var permList = SimParser.Permutation(varValues);
var varValueList = [];
var vMng = evUnit.getVariableManager();
var cMng = evUnit.getConstraintManager();
for (var i = 0; i < permList.length; i++) {
varValueList = [];
var fLastIteration = false;
for (var k = 0; k < varNames.length; k++) {
varValueList.push({ 'name': varNames[k], 'value': permList[i][k] });
}
for (var k = 0; k < funcCount; k++) {
var sirF = fMng.getFunctionByCompOrder(k);
if (sirF.getValue() != null) {
var currentVariable = vMng.getVariableByName(sirF.getValue());
if ((currentVariable != null) && ((currentVariable.getType() == 'cumulative') || (currentVariable.getType() == 'persistent'))) {
var variableStore = currentVariable.getStore();
if (variableStore != null) {
if (persistentVarDB.getElementValue(variableStore) != null) {
varValueList.push ({ 'name': sirF.getValue(), 'value': persistentVarDB.getElementValue(variableStore)});
}
}
}
}
}
var funcVector = [];
var varFuncVars = [];
var fEval = true;
var fn = [];
if (cMng.evalPreConstraints('', varValueList)) {
for (var k = 0; k < funcCount; k++) {
var sirF = fMng.getFunctionByCompOrder(k);
fn[k] = sirF.getName();
if (cMng.evalPreConstraints(fn[k], varValueList)) {
if (sirF.getType() != "lookup") {
funcVector[k] = evalFormula2(sirF.getEquation(), varValueList);
}
else {
funcVector[k] = evalLFunction(sirF, varValueList);
}
if (sirF.getValue() != null) {
var currentVariable = vMng.getVariableByName(sirF.getValue());
if ((currentVariable != null) && (currentVariable.getType() == 'cumulative')) {
var variableStore = currentVariable.getStore();
if (variableStore != null) {
var cumOp = currentVariable.getCumOp();
var variableCumOp = '+';
if (cumOp != null) {
if (cumOp === 'add') {
variableCumOp = '+';
}
else if (cumOp === 'multiply') {
variableCumOp = '*';
}
else if (cumOp === 'subtract') {
variableCumOp = '-';
}
else if (cumOp === 'divide') {
variableCumOp = '/';
}
}
persistentVarDB.updateElement(variableStore, funcVector[k], variableCumOp);
funcVector[k] = persistentVarDB.getElementValue(variableStore);
}
}
else if ((currentVariable != null) && (currentVariable.getType() == 'persistent')) {
var variableStore = currentVariable.getStore();
if (variableStore != null) {
persistentVarDB.updateElement(variableStore, funcVector[k], 'overwrite');
}
}
if (sirF.getScoreable() !== 'no') {
scoringTable().setValue(fn[k], null, funcVector[k]);
}
varFuncVars[k] = { 'name': sirF.getValue(), 'value': funcVector[k] };
fEval = fEval && cMng.evalPostConstraints(fn[k], varValueList, varFuncVars);
if (!fEval) {
fLastIteration = true;
}
if (currentVariable != null) {
if ((currentVariable.getType() == 'cumulative') || (currentVariable.getType() == 'persistent')) {
for (var l=0; l<varValueList.length; l++) {
if (varValueList[l].name === sirF.getValue()) {
varValueList[l].value = funcVector[k];
break;
}
}
}
else {
varValueList.push({ 'name': sirF.getValue(), 'value': funcVector[k] });
}
}
}
}
else {
var currentVariable = vMng.getVariableByName(sirF.getValue());
if ((currentVariable != null) && (currentVariable.getType() == 'cumulative')) {
var variableStore = currentVariable.getStore();
if (variableStore != null) {
funcVector[k] = persistentVarDB.getElementValue(variableStore);
}
if (sirF.getScoreable() !== 'no') {
scoringTable().setValue(fn[k], null, funcVector[k]);
}
varFuncVars[k] = { 'name': sirF.getValue(), 'value': funcVector[k] };
fEval = fEval && cMng.evalPostConstraints(fn[k], varValueList, varFuncVars);
if (!fEval) {
fLastIteration = true;
}
for (var l=0; l<varValueList.length; l++) {
if (varValueList[l].name === sirF.getValue()) {
varValueList[l].value = funcVector[k];
break;
}
}
}
}
}
result.push({ 'functions': evUtils.packFunctionforWhiteboard(fn, funcVector), 'variables': evUtils.packVariablesforWhiteboard(varValueList) });
if (fLastIteration || !cMng.evalPostConstraints('', varValueList, varFuncVars)) {
break;
}
}
}
if (result.length === 0) {
result.push({ 'functions': undefined, 'variables': undefined});
}
var fe = new SimParser.FilterEvaluation(evUnit);
result = fe.run(result);
if (result.length >= 0) {
var r = result[0].functions;
if (r) {
for (var p in r) {
if (p != 'undefined') {
scoringTable().setValue(p, null, r[p]);
}
}
}
}
return result;
}
function evalLFunction(lFunction, varValueList) {
var keyName = lFunction.getKeyName();
var keyValue;
for (var i = 0; i < varValueList.length; i++) {
var obj = varValueList[i];
if (obj["name"] == keyName) {
keyValue = obj["value"];
}
}
return lFunction.getLookupValue(keyValue);
}
function doEnd () {
var r = [], r1 = '', rs = evalResult, str, strCopy;
var fMng = evUnit.getFunctionManager();
for (var k = 0; k < rs.length; k++) {
str = rs[k].functions;
strCopy = {};
if (str !== undefined) {
for (var p in str) {
if (str.hasOwnProperty(p)) {
strCopy[p] = str[p];
if (str[p]) {
var sirF = fMng.getFunctionByName(p);
var prName = sirF.getProxyName();
if (prName) {
if (typeof str[p] === 'string') {
strCopy[prName] = str[p].replace(/:/g, '\\0x1G\\').replace(/,/g, '\\0x1H\\');
}
else {
strCopy[prName] = str[p];
}
if (p !== prName) delete strCopy[p];
}
}
}
}
r.push(JSON.stringify(strCopy).replace(/:/g, '\\0x1F\\').replace(/,/g, '\\0x1E\\') + '\\0x1D\\');
}
}
r1 = r.join('');
r1 = r1.replace(/\\0x1H\\/g, ',').replace(/\\0x1G\\/g, ':');
r1 = r1.replace(/{/g, '').replace(/}/g, '').replace(/;;/g, '');
r1 = unescape(r1);
if ((r1.length > 6)  && (r1.substring(r1.length-6, r1.length) === '\\0x1D\\')) {
r1 = r1.substring(0, r1.length-6);
}
key = evUtils.writeDataOnWhiteBoard(r1, key, 'evaluationOutput', 'output');
}
}

/* SOURCE FILE: EvaluationUnit.js (ac40c4c4) 9/9/2014 2:09:04 PM */

SimParser.EvaluationUnit = function (sim) {
var source = 'EvaluationUnit';
var root;
var vMng = new SimParser.VariableManager(this);
var cMng = new SimParser.ConstraintManager(this);
var rMng = new SimParser.RangeManager(this);
var simInstance = sim;
var dbg = function() { return sim.getDebug(); };
var isRunning = false;
var eventElement = new Simulator.SimElement(sim);
this.getVariableManager = function () {
return vMng;
}
this.getConstraintManager = function () {
return cMng;
}
this.getRangeManager = function () {
return rMng;
}
this.getSimInstance = function () {
return simInstance;
}
var fMng = new SimParser.FunctionManager(this);
this.getFunctionManager = function () {
return fMng;
}
var fEvaluation = new SimParser.FunctionEvaluation(this);
this.evaluateFunction = function (funcName) {
var func = fMng.getFunctionByName(funcName);
var vars = func.getVarList();
var valueList = [];
var results = [];
for (var i = 0; i < vars.length; i++) {
valueList.push(vars[i].getValues());
}
var permList = SimParser.Permutation(valueList);
for (var i = 0; i < permList.length; i++) {
for (var j = 0; j < vars.length; j++) {
vars[j].setValue(permList[i][j]);
}
results.push({
params: permList[i],
result: func.evaluateEquation()
});
}
return results;
};
this.functionVerifierEvaluation = function () {
return runEvaluation(1);
}
var runEvaluation = function (funcVerifier) {
var result = false;
var d1 = new Date();
if (isRunning) {
return;
}
isRunning = true;
try {
try {
if (!root) {
Simulator.showAlertWarning('Evaluation Unit is not loaded');
}
else {
var fCount = fMng.getFunctions().length + fMng.getLFunctions().length + fMng.getJFunctions().length;
if (fCount > 0) {
if (!funcVerifier) {
fEvaluation.process('greedy');
result = true;
}
else {
result = fEvaluation.process('greedy');
}
}
}
}
catch (e) {
EU.debug(e.message);
}
}
finally {
isRunning = false;
}
return result;
};
this.load = function (source) {
var d1 = new Date();
root = source;
rMng.setRanges(root);
vMng.setVariables(root);
fMng.setFunctions(root);
cMng.setConstraints(root);
this.setupEvents();
};
eventElement.handleEvent = function (event) {
var simulationMgr = sim.getSimulationManager();
var eventMgr = sim.getEventManager();
switch (event.type) {
case 'info':
if(simulationMgr.trialLimitReached()) {
return;
}
if (event.context === 'inputAvailable' || event.context === 'animationThreadFinished') {
if (runEvaluation()) {
eventMgr.postEvent(new Simulator.Event(this, 'info', 'outputAvailable', null, false));
}
break;
}
case 'command':
if(simulationMgr.trialLimitReached()) {
return;
}
if ((event.context === 'startTrial') || (event.context === 'startAnimation')) {
if (runEvaluation()) {
eventMgr.postEvent(new Simulator.Event(this, 'info', 'outputAvailable', null, false));
}
break;
}
default:
debug(this.getName() + ': Unhandled event type received: ' + event.toString());
return;
}
};
this.setupEvents = function () {
var r = root.getElementsByTagName('unit').item(0);
if (r !== undefined && r !== null) {
setEvents(eventElement, r);
}
};
this.getEvents = function () {
return eventElement;
};
function setEvents(element, node) {
var events = [];
var attributes;
var children = node.childNodes;
if (children != null && children != undefined) {
for ( var j = 0; j < children.length; j++) {
var id = children[j].nodeName;
if (id === 'event') {
attributes = children[j].attributes;
var eventInfo = createEvent(element, attributes);
element.addEvent(eventInfo['theEvent'], eventInfo['direction']);
}
}
}
return events;
}
function createEvent(obj, attributes) {
var response = [];
var data = '';
var ctx = '';
var dir = '';
var type = '';
var postOnChange = 'no';
var  completeWithoutOutput = false;
for ( var k = 0; k < attributes.length; k++) {
switch (attributes[k].nodeName) {
case 'direction':
dir = attributes[k].nodeValue;
break;
case 'data':
data = attributes[k].nodeValue;
break;
case 'context':
ctx = attributes[k].nodeValue;
break;
case 'type':
type = attributes[k].nodeValue;
break;
case 'postOnChange':
postOnChange = attributes[k].nodeValue;
break;
case 'completeWithoutOutput':
completeWithoutOutput = attributes[k].nodeValue === 'yes' ? true : false;
break;
}
}
response['theEvent'] = new Simulator.Event(obj, type, ctx, data, postOnChange, completeWithoutOutput); response['direction'] = dir;
return response;
}
function debug(str1, str2, trace) {
dbg().debug(source, str1, str2, trace);
}
function debugf(str1, str2, trace) {
dbg().debugf(source, str1, str2, trace);
}
};

/* SOURCE FILE: SimulationLoader2.js (017b4c08) 9/9/2014 2:09:04 PM */

SimulationLoader = function(xmlText, callback)
{
this._xmlText = xmlText;
this._callback = callback;
};
SimulationLoader.prototype.start = function()
{
var imageFiles = SimulationLoader.parseImages(this._xmlText);
var flashFiles = SimulationLoader.parseFlash(this._xmlText);
this._callback(this._xmlText);
};
SimulationLoader._regex_images1 = /image[\s]*=[\s]*".*"/g;
SimulationLoader._regex_images2 = /src[\s]*=[\s]*".*(.jpg | .png | .gif)\s*"/g;
SimulationLoader._regex_flash1 = /flash[\s]*=[\s]*\".*\"/g;
SimulationLoader._regex_flash2 = /src[\s]*=[\s]*\".*(swf)\s*\"/g;
SimulationLoader._regex_flash3 = /altSrc[\s]*=[\s]*\".*(swf)\s*\"/g;
SimulationLoader._parse = function(xmlText, regex)
{
var values = [];
var matches = xmlText.match(regex);
if (matches != null)
{
var extractFile = function(str)
{
var index = str.indexOf('"');
var cleanStr = str.substring(index + 1);
index = cleanStr.indexOf('"');
cleanStr = cleanStr.substring(0, index);
return cleanStr;
}
for(var i = 0; i < matches.length; i++)
{
values.push(extractFile(matches[i]));
}
}
return values;
};
SimulationLoader.parseImages = function(xmlText)
{
var imageFiles = [];
imageFiles = imageFiles.concat(this._parse(xmlText, this._regex_images1));
imageFiles = imageFiles.concat(this._parse(xmlText, this._regex_images2));
for (var i = 0; i < imageFiles.length; i++)
{
imageFiles[i] = SimulationLoader.resolveUrl(imageFiles[i]);
}
return imageFiles;
};
SimulationLoader.parseFlash = function(xmlText)
{
var flashFiles = [];
flashFiles = flashFiles.concat(this._parse(xmlText, this._regex_flash1));
flashFiles = flashFiles.concat(this._parse(xmlText, this._regex_flash2));
flashFiles = flashFiles.concat(this._parse(xmlText, this._regex_flash3));
for (var i = 0; i < flashFiles.length; i++)
{
flashFiles[i] = SimulationLoader.resolveUrl(flashFiles[i]);
}
return flashFiles;
};
SimulationLoader.fixPaths = function(xmlText, baseUrl)
{
xmlText = xmlText.replace(/src=\"/g, 'src="' + baseUrl);
xmlText = xmlText.replace(/altSrc=\"/g, 'altSrc="' + baseUrl);
xmlText = xmlText.replace(/image=\"/g, 'image="' + baseUrl);
xmlText = xmlText.replace(/deleteRowImage=\"/g, 'deleteRowImage="' + baseUrl);
xmlText = xmlText.replace(/flash=\'"/g, 'flash="' + baseUrl);
return xmlText;
};
SimulationLoader.resolveUrl = function(url)
{
url = url.replace(/&amp;/g, '&');
url = url.split('&').join('&amp;').split('<').join('&lt;').split('"').join('&quot;');
var el = document.createElement('div');
el.innerHTML = '<a href="' + url + '">x</a>';
return el.firstChild.href;
};

/* SOURCE FILE: widget.js (1d07359f) 10/26/2014 1:27:05 PM */

(function (CM, TS) {
function create(page, item, containerEl, simXml) {
var simulator = null;
var simImageFiles = SimulationLoader.parseImages(simXml);
for (var i = 0; i < simImageFiles.length; i++) {
var loaderImage = new ResourceLoader.Image(simImageFiles[i]);
page.addResourceLoader(loaderImage);
}
var simSWFFiles = SimulationLoader.parseFlash(simXml);
for (var i = 0; i < simSWFFiles.length; i++) {
var loaderBinary = new ResourceLoader.Binary(simSWFFiles[i]);
page.addResourceLoader(loaderBinary);
}
var responseXml;
if (TS && TS.PageManager) {
var response = TS.PageManager.getResponse(item.position);
responseXml = response.getLastValue();
}
else {
responseXml = item.value;
}
simulator = new Simulator.Simulator(containerEl, CM.isAccessibilityEnabled());
Simulator.Animation.FlashAnimationInterface.MapInstance(simulator);
simulator.setAnimationShellPath(CM.resolveBaseUrl('Scripts/Simulator2/Renderer/SWF/SimulationShell.swf'));
simulator.setAnimationExternalScriptsPath(CM.resolveBaseUrl('Scripts/Libraries'));
simulator.loadXml(simXml, responseXml);
item.simulator = simulator;
var simWin = simulator.getWin();
var simDoc = simulator.getDoc();
var zoomImage = function (img) {
var zoom = page.getZoom();
if (zoom) {
zoom.updateElement(img);
}
};
YUD.batch(simDoc.getElementsByTagName('img'), function (img) {
if (Util.Dom.isImgLoaded(img)) {
zoomImage(img);
}
else {
YUE.on(img, 'load', function () {
zoomImage(img);
});
}
});
simulator.subscribe('info', 'animationEmbedded', function (evt) {
VideoManager.SWF.stopRightClick(evt.data);
});
simulator.subscribe('info', 'simulatorStateChange', function (evt) {
if (YAHOO.lang.isString(evt.data)) {
var eventType = evt.data.toUpperCase();
if (eventType == "READY") {
if (item.isReadOnly()) {
simulator.setReadOnlyState(true);
}
YUD.removeClass(containerEl, 'loading');
}
else if (eventType == "ERROR") {
YUD.addClass(containerEl, 'failed');
}
}
});
if (typeof TDS.Diagnostics == 'object') {
TDS.Diagnostics.addErrorHandler(simWin);
}
return simulator;
}
function Widget_Sim(page, item, config) {
this.simulator = null;
}
function match(page, item, content) {
var id = 'SimContainer_' + item.position;
var el = document.getElementById(id);
if (el && item.rendererSpec) {
return new CM.WidgetConfig(id, el, item.rendererSpec);
}
return false;
}
CM.registerWidget('simulator', Widget_Sim, match);
Widget_Sim.prototype.load = function() {
this.simulator = create(this.page, this.entity, this.element, this.config);
}
Widget_Sim.prototype.zoom = function(level) {
this.simulator.zoom(level);
}
Widget_Sim.prototype.show = function() {
this.simulator.setVisibilityAndAttachEvents(true);
}
Widget_Sim.prototype.hide = function () {
this.simulator.setVisibilityAndAttachEvents(false);
this.simulator.hide();
}
Widget_Sim.prototype.focus = function () {
this.simulator.focus();
}
Widget_Sim.prototype.blur = function () {
this.simulator.blur();
}
Widget_Sim.prototype.isResponseAvailable = function () {
return this.simulator && this.simulator.isLoaded();
}
Widget_Sim.prototype.getResponse = function () {
var value = this.simulator.getResponseXml();
var isValid = this.simulator.isValid();
return this.createResponse(value, isValid);
}
Widget_Sim.prototype.setResponse = function (value) {
this.simulator.loadResponseXml(value);
}
})(window.ContentManager, window.TestShell);

/* SOURCE FILE: eq_content.js (3de48f97) 10/26/2014 1:27:05 PM */

(function(){
if (!window.MathEditorContent) { window.MathEditorContent = {}; }
var greek = {
title: 'Greek',
type: 'row',
items: [
'alpha',
'beta',
'gamma',
'delta',
'epsilon',
'zeta',
'eta',
'theta',
'iota',
'kappa',
'lambda',
'mu',
'nu',
'xi',
'omicron',
'pi',
'rho',
'sigma',
'tau',
'upsilon',
'phi',
'chi',
'psi'
]
};
var trig = {
title: 'Trigonometry',
type: 'row',
items: [
'sin',
'cos',
'tan',
'arcsin',
'arccos',
'arctan'
]
};
var numbers = {
title: 'Numbers',
type: 'grid',
cols: 3,
items: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0',
'.',
{key: 'fraction', text: 'fraction', value: '\\frac{\\PH}{\\PH}', css: 'mathjax_editor_button_fraction'}
]
};
var numbersminus = {
title: 'Numbers',
type: 'grid',
cols: 3,
items: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '.', '-']
};
var numpad = {
title: 'Number Pad',
type: 'numpad',
items: [
'7', '8', '9', '4', '5', '6', '1', '2', '3', '0', '.'
]
};
var decimalnumbers = {
title: 'Numbers',
type: 'grid',
cols: 3,
items: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '.']
};
var operations = {
title: 'Operations_After_Grade_6',
type: 'row',
items: [
'+', '-', {key: '*', text: '*'}, 'div'
]
};
var operations_muldot = {
title: 'OperationsWithCDot',
type: 'row',
items: [
'+', '-', { key: '*', value: '\\bullet', css: 'mje_button_dot'                            }, 'div']
};
var operations_calc = {
title: 'Operations',
type: 'row',
items: [
'+',
'-',
{key: '*', text: '*'},
'div',
{key: 'nrt',    value: '\\sqrt[\\PH]{\\PH}',      css: 'mathjax_editor_button_nrt'},
{key: 'fraction',   value: '\\frac{\\PH}{\\PH}',  css: 'mathjax_editor_button_fraction'},
{key: 'intV',   value: '\\int_\\PH^\\PH \\PH',    css: 'mathjax_editor_button_intergal_vals',  text:eval('"\\u222B"')},
{key: 'sub',    value: '\\PH_\\PH',               css: 'mathjax_editor_button_sub'},
{key: 'sup',     value: '\\PH^\\PH',              css: 'mathjax_editor_button_sup'}
]
};
var operation_simple = {
title: 'Operations',
type: 'row',
items: ['+', '-', 'times', 'div']
};
var signs_basic = {
title: 'Signs',
type: 'row',
items: ['lt', '=', 'gt']
};
var signs = {
title: 'Signs',
type: 'row',
items: ['lt', 'le', '=', 'ge', 'gt']
};
var basic_variables = {
title: 'Variables',
type: 'row',
items: [
'x',
'y'
]
};
var variables = {
title: 'Variables',
type: 'row',
items: [
'f',
'n',
'x',
'y',
{ key: 'sub', value: '\\PH_{\\PH}' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
{ key: '( )', value: '(\\PH)' }]
};
var fractions = {
title: 'Fractions',
type: 'row',
items: [
{key: 'fraction', value: '\\frac{\\PH}{\\PH}'}
]
};
var calc = {
title: 'Calculus',
type: 'row',
items: [
{ key: 'subsup', value: '\\PH_{\\PH}^{\\PH}', css: '' },
]
};
var other = {
title: 'Other',
type: 'row',
items: [
{ key: '| |', value: '\\lvert\\PH\\rvert', css: '' },
{ key: '( )', value: '(\\PH)' }
]
};
var functions = {
title: 'Functions',
type: 'grid',
cols: 2,
items: [
'(', ')',
'sin', 'cos',
'tan', {key: 'e^x', value: 'e^{\\PH}', text: 'e^exp'},
'ln',  'log',
{key: 'n!', value: '\\PH!', text: 'n!'},
{key: 'FBoxes', value: '\\frac{\\PH}{\\PH}', text: 'fraction'},
{key: 'x^y', text: 'x^y', value: 'x^y'}, {key: 'x^2', value: 'x^2', text: 'x^2'},
{key: 'x^3', text: 'x^3', value: 'x^3'}, 'pi',
'abs'
]
};
var row3_sbac4 = {
title: 'Other',
type: 'row',
items: [
{ key: '( )', value: '(\\PH)' }
]
};
var row3_sbac5 = {
title: 'Other',
type: 'row',
items: [
{ key: 'sup', value: '\\PH^\\PH' },
{ key: '( )', value: '(\\PH)' }
]
};
var row3_sbac6 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' }
]
};
var row3_sbac7 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
"pi"
]
};
var row3_sbac8 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
{ key: 'sqrt', value: '\\sqrt{\\PH}' },
{ key: 'nrt', value: '\\sqrt[\\PH]{\\PH}' },
"pi"
]
};
var row3_sbac10 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: 'sub', value: '\\PH_\\PH'},
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
{ key: 'sqrt', value: '\\sqrt{\\PH}' },
{ key: 'nrt', value: '\\sqrt[\\PH]{\\PH}' },
"pi",
"i"
]
};
var row3_utah3 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: '( )', value: '(\\PH)' }
]
};
var row3_utah4 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: '( )', value: '(\\PH)' }
]
};
var row3_utah5 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: '( )', value: '(\\PH)' }
]
};
var row3_utah6 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
]
};
var row3_utah7 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
{ key: 'sqrt', value: '\\sqrt{\\PH}' },
{ key: 'nrt', value: '\\sqrt[\\PH]{\\PH}' },
"pi"
]
};
var row3_utah8 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
{ key: 'sqrt', value: '\\sqrt{\\PH}' },
{ key: 'nrt', value: '\\sqrt[\\PH]{\\PH}' },
"pi"
]
};
var row3_utahsm1 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: 'sub', value: '\\PH_\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
{ key: 'sqrt', value: '\\sqrt{\\PH}' },
{ key: 'nrt', value: '\\sqrt[\\PH]{\\PH}' },
"pi"
]
};
var row3_utahsm2 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: 'sub', value: '\\PH_\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
{ key: 'sqrt', value: '\\sqrt{\\PH}' },
{ key: 'nrt', value: '\\sqrt[\\PH]{\\PH}' },
"pi",
"i"
]
};
var row3_utahsm3 = {
title: 'Other',
type: 'row',
items: [
{ key: 'fraction', value: '\\frac{\\PH}{\\PH}' },
{ key: 'sup', value: '\\PH^\\PH' },
{ key: 'sub', value: '\\PH_\\PH' },
{ key: '( )', value: '(\\PH)' },
{ key: '| |', value: '\\lvert\\PH\\rvert' },
{ key: 'sqrt', value: '\\sqrt{\\PH}' },
{ key: 'nrt', value: '\\sqrt[\\PH]{\\PH}' },
"pi",
"i"
]
};
MathEditorContent.Config = MathEditorContent.Config || {};
MathEditorContent.Config.Common = [
{key: 'Box',    value: '\\Box',                text: eval('"\\u2610"')},
{key: 'int',    value: '\\int\\PH',            text: eval('"\\u222B"')},
{key: 'abs',    value: '\\lvert\\PH\\rvert',   text: '| |'},
{key: 'sqrt',   value: '\\sqrt\\PH',           text: eval('"\\u221A"')},
{key: 'nrt',    value: '\\sqrt[\\PH]{\\PH}',      css: 'mathjax_editor_button_nrt'},
{key: 'fraction',   value: '\\frac{\\PH}{\\PH}',  css: 'mathjax_editor_button_fraction'},
{key: 'intV',   value: '\\int_\\PH^\\PH \\PH',    css: 'mathjax_editor_button_intergal_vals',  text:eval('"\\u222B"')},
{key: 'sub',    value: '\\PH_\\PH',               css: 'mathjax_editor_button_sub'},
{key: 'sup',     value: '\\PH^\\PH',              css: 'mathjax_editor_button_sup'},
{key: 'subsup', value: '\\PH_\\PH^\\PH',          css: 'mathjax_editor_button_subsup'}
];
MathEditorContent.Config.Rows = {
Numbers: numbers,
NumPad: numpad,
Signs: signs,
Functions: functions,
Other: other,
Operations: operations,
SimpleOperation: operation_simple,
OperationsWithCDot: operations_muldot,
Greek: greek,
Trigonometry: trig,
Algebra: basic_variables,
Fraction: fractions
};
MathEditorContent.Config.Tabs = {
Order: ['Numbers', 'Basic', 'Algebra', 'Calculus', 'SBAC3', 'SBAC4', 'SBAC5', 'SBAC6', 'SBAC7', 'SBAC8', 'SBAC9', 'SBAC10', 'SBAC11', 'Utah3', 'Utah4', 'Utah5', 'Utah6', 'Utah7', 'Utah8', 'UtahSM1', 'UtahSM2', 'UtahSM3' ],
Numbers: {
title: 'Numbers',
rows: [
numbers
]
},
Basic: {
title: 'Basic',
rows: [numbers, operation_simple, signs_basic, fractions]
},
Algebra: {
title: 'Algebra',
rows: [
numbers,
basic_variables,
operations,
signs,
other
]
},
Calculus: {
title: 'Calculus',
rows: [
numbers,
variables,
operations_calc,
signs,
trig
]
},
SBAC3: {
title: 'SBAC3',
rows: [numbers, operation_simple, signs_basic, row3_sbac4]
},
SBAC4: {
title: 'SBAC4',
rows: [numbers, operation_simple, signs_basic, row3_sbac4]
},
SBAC5: {
title: 'SBAC5',
rows: [numbers, operation_simple, signs_basic, row3_sbac5]
},
SBAC6: {
title: 'SBAC6',
rows: [numbersminus, operations, signs_basic, row3_sbac6]
},
SBAC7: {
title: 'SBAC7',
rows: [numbersminus, operations, signs, row3_sbac7]
},
SBAC8: {
title: 'SBAC8',
rows: [numbersminus, operations, signs, row3_sbac8]
},
SBAC9: {
title: 'SBAC9',
rows: [numbersminus, operations, signs, row3_sbac8]
},
SBAC10: {
title: 'SBAC10',
rows: [numbersminus, operations, signs, row3_sbac10]
},
SBAC11: {
title: 'SBAC11',
rows: [numbersminus, operations, signs, row3_sbac10, trig]
},
Utah3: {
title: 'Utah3',
rows: [decimalnumbers, operation_simple, signs_basic, row3_utah3]
},
Utah4: {
title: 'Utah4',
rows: [decimalnumbers, operation_simple, signs_basic, row3_utah4]
},
Utah5: {
title: 'Utah5',
rows: [decimalnumbers, operation_simple, signs_basic, row3_utah5]
},
Utah6: {
title: 'Utah6',
rows: [numbersminus, operations_muldot, signs_basic, row3_utah6]
},
Utah7: {
title: 'Utah7',
rows: [numbersminus, operations_muldot, signs, row3_utah7]
},
Utah8: {
title: 'Utah8',
rows: [numbersminus, operations_muldot, signs, row3_utah8]
},
UtahSM1: {
title: 'UtahSM1',
rows: [numbersminus, operations_muldot, signs, row3_utahsm1]
},
UtahSM2: {
title: 'UtahSM2',
rows: [numbersminus, operations_muldot, signs, row3_utahsm2, trig]
},
UtahSM3: {
title: 'UtahSM3',
rows: [numbersminus, operations_muldot, signs, row3_utahsm3, trig]
}
};
MathEditorContent.Config.Translator = {
_itemCollectioBuildComplete: false,
itemCollection: {
keys: [],
values: []
},
_ignoreItems: [],
buildItemCollection: function () {
this._ignoreItems.push('(');
this._ignoreItems.push(')');
var keys = [], values = [];
keys.push('Box'); values.push({ key: 'Box', text: '&#x25a1;', cmd: '\\Box', title: 'box', arialabel: 'box' });
keys.push('1'); values.push({ key: '1', text: '1', title: 'one', arialabel: 'one' });
keys.push('2'); values.push({ key: '2', text: '2', title: 'two', arialabel: 'two' });
keys.push('3'); values.push({ key: '3', text: '3', title: 'three', arialabel: 'three' });
keys.push('4'); values.push({ key: '4', text: '4', title: 'four', arialabel: 'four' });
keys.push('5'); values.push({ key: '5', text: '5', title: 'five', arialabel: 'five' });
keys.push('6'); values.push({ key: '6', text: '6', title: 'six', arialabel: 'six' });
keys.push('7'); values.push({ key: '7', text: '7', title: 'seven', arialabel: 'seven' });
keys.push('8'); values.push({ key: '8', text: '8', title: 'eight', arialabel: 'eight' });
keys.push('9'); values.push({ key: '9', text: '9', title: 'nine', arialabel: 'nine' });
keys.push('0'); values.push({ key: '0', text: '0', title: 'zero', arialabel: 'zero' });
keys.push('+'); values.push({ key: '+', text: '+', title: 'plus', arialabel: 'plus' });
keys.push('-'); values.push({ key: '-', text: '-', title: 'minus', arialabel: 'minus' });
keys.push('.'); values.push({ key: '.', text: '.', title: 'period', arialabel: 'period' });
keys.push('div'); values.push({ key: 'div', text: '&#xF7;', title: 'divison', arialabel: 'divison' });
keys.push('*'); values.push({ key: '*', text: '&#x2217;', cmd: '\\ast', title: 'asterisk', arialabel: 'multiply' });
keys.push('mje_button_dot'); values.push({ key: 'cdot', text: '&#x2219;', css: 'mje_button_dot', title: 'cdot', arialabel: 'multiply' });
keys.push('times'); values.push({ key: 'times', text: '&#215;', title: 'times', arialabel: 'multiply' });
keys.push('fraction'); values.push({ key: 'fraction', cmd: '/', css: 'mje_button_fraction', title: 'fraction', arialabel: 'fraction' });
keys.push('FBoxes'); values.push({ key: 'FBoxes', cmd: '/', css: 'mje_button_fraction', title: 'fboxes', arialabel: 'fraction' });
keys.push('lt'); values.push({ key: 'lt', text: '&#x3C;', title: 'lt', arialabel: 'Less Than' });
keys.push('le'); values.push({ key: 'le', text: '&#x2264;', title: 'le', arialabel: 'Less Than Equal To' });
keys.push('='); values.push({ key: '=', text: '&#x3D;', title: 'eq', arialabel: 'Equals' });
keys.push('ge'); values.push({ key: 'ge', text: '&#x2265;', title: 'ge', arialabel: 'Greater Than' });
keys.push('gt'); values.push({ key: 'gt', text: '&#x3E;', title: 'gt', arialabel: 'Greater Than Equal To' });
keys.push('sqrt'); values.push({ key: 'sqrt', cmd: '\\sqrt', css: 'mje_button_sqrt', title: 'sqroot', arialabel: 'Square Root' });
keys.push('nrt'); values.push({ key: 'nrt', cmd: '\\nthroot', css: 'mje_button_nrt', title: 'nthroot', arialabel: 'Nth Root' });
keys.push('intV'); values.push({ key: 'intV', text: '&#x0222B;', title: 'integral', arialabel: 'Integral' });
keys.push('sup'); values.push({ key: 'sup', cmd: '^', css: 'mje_button_sup', title: 'exponent', arialabel: 'exponent' });
keys.push('sub'); values.push({ key: 'sub', cmd: '_', css: 'mje_button_sub', title: 'subscript', arialabel: 'subscript' });
keys.push('( )'); values.push({ key: '( )', text: '( )', cmd: '(', title: 'parentheses', arialabel: 'parentheses' });
keys.push('| |'); values.push({ key: '| |', text: '| |', cmd: '|', title: 'absvalue', arialabel: 'absolute value' });
keys.push('prod'); values.push({ key: 'prod', text: '&#x3C0;', cmd: '\\pi', title: 'pi', arialabel: 'PI' });
keys.push('log'); values.push({ key: 'log', text: 'log', cmd: '\\log', title: 'log', arialabel: 'logarithm' });
keys.push('ln'); values.push({ key: 'ln', text: 'ln', cmd: '\\ln', title: 'ln', arialabel: 'natural logarithm' });
keys.push('n!'); values.push({ key: 'n!', text: '!', title: 'factorial', arialabel: 'factorial' });
keys.push('pi'); values.push({ key: 'pi', text: '&#x3C0;', cmd: '\\pi', title: 'pi', arialabel: 'pi' });
keys.push('abs'); values.push({ key: 'abs', text: '| |', cmd: '|', title: 'abs', arialabel: 'absolute value' });
keys.push('sin'); values.push({ key: 'sin', text: 'sin', cmd: '\\sin', title: 'sin', arialabel: 'sine', wrapargs: 'true' });
keys.push('cos'); values.push({ key: 'cos', text: 'cos', cmd: '\\cos', title: 'cos', arialabel: 'cosine', wrapargs: 'true' });
keys.push('tan'); values.push({ key: 'tan', text: 'tan', cmd: '\\tan', title: 'tan', arialabel: 'tangent', wrapargs: 'true' });
keys.push('arcsin'); values.push({ key: 'arcsin', text: 'arcsin', cmd: '\\arcsin', title: 'arcsin', arialabel: 'secant', wrapargs: 'true' });
keys.push('arccos'); values.push({ key: 'arccos', text: 'arccos', cmd: '\\arccos', title: 'arccos', arialabel: 'cosecant', wrapargs: 'true' });
keys.push('arctan'); values.push({ key: 'arctan', text: 'arctan', cmd: '\\arctan', title: 'arctan', arialabel: 'cotangent', wrapargs: 'true' });
keys.push('alpha'); values.push({ key: 'alpha', text: '&#x03B1;', cmd: '\\alpha', title: 'alpha', arialabel: 'alpha' });
keys.push('beta'); values.push({ key: 'beta', text: '&#x03B2;', cmd: '\\beta', title: 'beta', arialabel: 'beta' });
keys.push('gamma'); values.push({ key: 'gamma', text: '&#x03B3;', cmd: '\\gamma', title: 'gamma', arialabel: 'gamma' });
keys.push('delta'); values.push({ key: 'delta', text: '&#x03B4;', cmd: '\\delta', title: 'delta', arialabel: 'delta' });
keys.push('epsilon'); values.push({ key: 'epsilon', text: '&#x03B5;', cmd: '\\epsilon', title: 'epsilon', arialabel: 'epsilon' });
keys.push('zeta'); values.push({ key: 'zeta', text: '&#x03B6;', cmd: '\\zeta', title: 'zeta', arialabel: 'zeta' });
keys.push('eta'); values.push({ key: 'eta', text: '&#x03B7;', cmd: '\\eta', title: 'eta', arialabel: 'eta' });
keys.push('theta'); values.push({ key: 'theta', text: '&#x03B8;', cmd: '\\theta', title: 'theta', arialabel: 'theta' });
keys.push('iota'); values.push({ key: 'iota', text: '&#x03B9;', cmd: '\\iota', title: 'iota', arialabel: 'iota' });
keys.push('kappa'); values.push({ key: 'kappa', text: '&#x03BA;', cmd: '\\kappa', title: 'kappa', arialabel: 'kappa' });
keys.push('lambda'); values.push({ key: 'lambda', text: '&#x03BB;', cmd: '\\lambda', title: 'lambda', arialabel: 'lambda' });
keys.push('mu'); values.push({ key: 'mu', text: '&#x03BC;', cmd: '\\mu', title: 'mu', arialabel: 'mu' });
keys.push('nu'); values.push({ key: 'nu', text: '&#x03BD;', cmd: '\\nu', title: 'nu', arialabel: 'nu' });
keys.push('xi'); values.push({ key: 'xi', text: '&#x03BE;', cmd: '\\xi', title: 'xi', arialabel: 'xi' });
keys.push('omicron'); values.push({ key: 'omicron', text: '&#x03BF;', title: 'omicron', arialabel: 'omicron' });
keys.push('rho'); values.push({ key: 'rho', text: '&#x03C1;', cmd: '\\rho', title: 'rho', arialabel: 'rho' });
keys.push('sigma'); values.push({ key: 'sigma', text: '&#x03C3;', cmd: '\\sigma', title: 'sigma', arialabel: 'sigma' });
keys.push('tau'); values.push({ key: 'tau', text: '&#x03C4;', cmd: '\\tau', title: 'tau', arialabel: 'tau' });
keys.push('upsilon'); values.push({ key: 'upsilon', text: '&#x03C5;', cmd: '\\upsilon', title: 'upsilon', arialabel: 'upsilon' });
keys.push('phi'); values.push({ key: 'phi', text: '&#x03C6;', cmd: '\\phi', title: 'phi', arialabel: 'phi' });
keys.push('chi'); values.push({ key: 'chi', text: '&#x03C7;', cmd: '\\chi', title: 'chi', arialabel: 'chi' });
keys.push('psi'); values.push({ key: 'psi', text: '&#x03C8;', cmd: '\\psi', title: 'psi', arialabel: 'psi' });
keys.push('x^y'); values.push({ key: 'x^y', text: 'x^y', cmd: 'x^y', insertraw: 'true', title: 'xpowery', arialabel: 'x to the power y' });
keys.push('x^2'); values.push({ key: 'x^2', text: 'x^2', cmd: 'x^2', insertraw: 'true', title: 'xpower2', arialabel: 'x to the power 2' });
keys.push('x^3'); values.push({ key: 'x^3', text: 'x^3', cmd: 'x^3', insertraw: 'true', title: 'xpower3', arialabel: 'x to the power 3' });
this.itemCollection.keys = keys;
this.itemCollection.values = values;
this._itemCollectioBuildComplete = true;
},
getItem: function (key) {
if (!this._itemCollectioBuildComplete)
this.buildItemCollection();
var ind = this.itemCollection.keys.indexOf(key);
if (ind === -1)
return key;
return this.itemCollection.values[ind];
},
ignoreKey: function (key) {
if (!this._itemCollectioBuildComplete)
this.buildItemCollection();
if (this._ignoreItems.indexOf(key) === -1)
return false;
return true;
},
hasKey: function (key) {
var ind = this.itemCollection.keys.indexOf(key);
if (ind === -1)
return false;
return true;
}
};
MathEditorContent.Config.EquationAdapter = {
_translator: MathEditorContent.Config.Translator,
_PLACEHOLDER: '&##&',
_FORMATTER: '\r\n',
_Empty: '',
convertToDesmosXml: function (xml) {
return this._parser(xml);
},
getTabXml: function (key) {
var tab = MathEditorContent.Config.Tabs[key];
return '<tab title="' + tab.title + '">' + this._FORMATTER + this._rowsToXml(tab.rows) + this._FORMATTER + '</tab>';
},
getRowXml: function (key) {
var row = MathEditorContent.Config.Rows[key];
return this._rowsToXml([row]);
},
getItemXml: function (key) {
if (this._translator.ignoreKey(key)) {
return this._Empty;
}
var item = this._getItem(key);
return this._toItemXml(item);
},
hasKey: function (key) {
return this._translator.hasKey(key);
},
_getItem: function (key) {
var item = this._translator.getItem(key);
if (item === key)
item = { key: key, title: key, arialabel: key, text: key, css: 'mje_button_variable' };
return item;
},
_parser: function (xml) {
var xmlDoc = null, xmlSerializer= new XMLSerializer();
if (window.DOMParser) {
var parser = new DOMParser();
xmlDoc = parser.parseFromString(xml, "text/xml");
}
else
{
xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
xmlDoc.async = false;
xmlDoc.loadXML(xml);
}
var node = xmlDoc.childNodes[0];
var desmosXml = '';
var mathml = $(node).find('editorconfig mathML'),
labels = $(node).find('editorconfig editorLabels')                                             , lblen = labels.length;
for (var i = 0; i < mathml.length; i++) {
desmosXml += '<editorRow>' + '<editorLabels>' + (i < lblen ? labels[i].textContent : '') + '</editorLabels>' + xmlSerializer.serializeToString(mathml[i].firstChild) + '</editorRow>';
}
var tabContent = MathEditorContent.Config.Tabs;
var keypad = '';
var tabConfigEl = $(node).find('editorconfig tabConfig');
if (tabConfigEl.length > 0) {
var tabStr = '';
var orders = $(tabConfigEl[0]).find('Order');
for (i = 0, len = orders.length; i < len; i++) {
var tName = orders[i].firstChild.nodeValue;
tabStr = '<tab title="' + tName + '" >' + this._FORMATTER + this._PLACEHOLDER + '</tab>';
var rows = [];
var tab = $(tabConfigEl[0]).find(tName);
if (tab.length > 0) {
var rowEls = $(tab[0]).find('rows');
for (var j = 0, elLen = rowEls.length; j < elLen; j++) {
var r = { title: '', type: '', items: [] };
for (var k = 0, plen = rowEls[j].childNodes.length; k < plen; k++) {
if (rowEls[j].childNodes[k].nodeName === 'title') {
r.title = rowEls[j].childNodes[k].firstChild.nodeValue;
} else if (rowEls[j].childNodes[k].nodeName === 'type') {
r.type = rowEls[j].childNodes[k].firstChild.nodeValue;
} else if (rowEls[j].childNodes[k].nodeName === 'items') {
if (rowEls[j].childNodes[k].childNodes.length > 1) {
var itObj = {};
$.each(rowEls[j].childNodes[k].childNodes, function(idx) {
if (rowEls[j].childNodes[k].childNodes[idx].nodeName === 'isparsed') {
itObj.isParsed = rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue;
} else if (rowEls[j].childNodes[k].childNodes[idx].nodeName === 'key') {
itObj.key = rowEls[j].childNodes[k].childNodes[idx].textContent;
itObj.arialabel = rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue;
} else if (rowEls[j].childNodes[k].childNodes[idx].nodeName === 'text') {
itObj.text = rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue;
} else if (rowEls[j].childNodes[k].childNodes[idx].nodeName === 'value') {
itObj.value = rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue;
} else if (rowEls[j].childNodes[k].childNodes[idx].nodeName === 'css') {
itObj.css = rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue;
}
});
r.items.push(itObj);
} else {
r.items.push(rowEls[j].childNodes[k].firstChild.nodeValue);
}
}
}
rows.push(r);
}
} else {
try {
rows = tabContent[tName].rows;
} catch (e) {
console.log('$$$$$$ row configuration not found.');
continue;
}
}
tabStr = tabStr.replace(this._PLACEHOLDER, this._rowsToXml(rows));
keypad += tabStr + this._FORMATTER;
}
}
desmosXml = '<editorconfig>' + desmosXml + '<tabConfig>' + this._FORMATTER + keypad + '</tabConfig>' + '</editorconfig>';
return desmosXml;
},
_rowsToXml: function (rows) {
var keypad = '';
for (var j = 0, rlen = rows.length; j < rlen; j++) {
var r = rows[j];
if (r.type === "grid" || r.type === "numpad") {
keypad += '<grid cols="3" title="' + r.title + '">' + this._PLACEHOLDER + '</grid>' + this._FORMATTER;
} else {
keypad += '<row title="' + r.title + '">' + this._PLACEHOLDER + '</row>' + this._FORMATTER;
}
var items = r.items;
var itemStr = '';
for (var k = 0, ilen = items.length; k < ilen; k++) {
if (typeof items[k] === "object") {
if (typeof items[k].isParsed != "undefined" && items[k].isParsed)
{
itemStr += this._toItemXml({ key: items[k].key, title: items[k].key, arialabel: items[k].key, text: items[k].text, css: 'mje_button_variable' });
} else if (items[k].key == '*' && items[k].css) {
itemStr += this.getItemXml(items[k].css);
}
else {
itemStr += this.getItemXml(items[k].key);
}
}
else
itemStr += this.getItemXml(items[k]);
}
keypad = keypad.replace(this._PLACEHOLDER, this._FORMATTER + itemStr);
}
return keypad;
},
_toItemXml: function (item) {
var xmlVal = '<item title="' + item.title + '" aria-label="' + item.arialabel + '" ';
if (typeof item.cmd != "undefined")
xmlVal += 'cmd="' + item.cmd + '" ';
if (typeof item.css != "undefined")
xmlVal += 'class="' + item.css + '" ';
if (typeof item.insertraw != "undefined")
xmlVal += 'insert-raw="' + item.insertraw + '" ';
if (typeof item.wrapargs != "undefined")
xmlVal += 'wrap-args="' + item.wrapargs + '" ';
if (typeof item.text != "undefined")
xmlVal += '>' + item.text + '';
else
xmlVal += '>';
xmlVal += '</item>' + this._FORMATTER;
return xmlVal;
}
};
MathEditorContent.Config.PreviewFormatter = {
getPreviewXmlDoc: function (configXml) {
var MATHQUILL_PLACEHOLDER_TAG = '##';
var newXmlDoc = $.parseXML(configXml);
var cdotRows = $(newXmlDoc).find("item[title='cdot']").each(function () {
if (!$(this).attr('class')) {
$(this).text('âˆ™');
$(this).attr('class', 'mje_button_dot');
}
});
var rows = $(newXmlDoc).find('editorconfig editorRow');
for (var i = 0, len = rows.length; i < len; i++) {
var mathml = $(rows[i]).find('math')
, latexCmd = '';
if (mathml.length > 0) {
latexCmd = window.MathEditorWidget.convertMathMlToLatex(mathml);
if (latexCmd.indexOf(MATHQUILL_PLACEHOLDER_TAG) != -1) {
latexCmd = latexCmd.replace(/##/g, "\\MathQuillMathField{}");
} else {
latexCmd = "\\MathQuillMathField{" + latexCmd + "}";
}
} else {
latexCmd = "\\MathQuillMathField{}";
}
var labels = $(rows[i]).find('editorLabels')
, labelVal = (labels.length > 0 ? labels[0].textContent : '');
labelVal = labelVal.replace(/ /g, '\\space ');
rows[i].textContent = labelVal + latexCmd;
}
return newXmlDoc;
}
};
})();

/* SOURCE FILE: eq_editor.js (a725ac10) 10/26/2014 1:27:05 PM */

(function () {
var P = (function (prototype, ownProperty, undefined) {
function isObject(o) { return typeof o === 'object'; }
function isFunction(f) { return typeof f === 'function'; }
function P(_superclass               , definition) {
if (definition === undefined) {
definition = _superclass;
_superclass = Object;
}
function C(args) {
var self = this;
if (!(self instanceof C)) return new C(arguments);
if (args && isFunction(self.init)) self.init.apply(self, args);
}
var proto = C[prototype] = C.fn = new _superclass();
var _super = _superclass[prototype];
var extensions;
proto.constructor = C;
C.mixin = function (def) {
C[prototype] = P(C, def)[prototype];
return C;
}
return (C.open = function (def) {
extensions = {};
if (isFunction(def)) {
extensions = def.call(C, proto, _super, C, _superclass);
}
else if (isObject(def)) {
extensions = def;
}
if (isObject(extensions)) {
for (var ext in extensions) {
if (ownProperty.call(extensions, ext)) {
proto[ext] = extensions[ext];
}
}
}
if (!isFunction(proto.init)) {
proto.init = function () { _superclass.apply(this, arguments); };
}
return C;
})(definition);
}
return P;
})('prototype', ({}).hasOwnProperty);
(function () {
var $ = jQuery,
undefined,
_,
mqCmdId = 'mathquill-command-id',
mqBlockId = 'mathquill-block-id',
min = Math.min,
max = Math.max;
var __slice = [].slice;
function noop() { }
function bind(cons               ) {
var args = __slice.call(arguments, 1);
return function () {
return cons.apply(this, args);
};
}
function pray(message, cond) {
if (!cond) throw new Error('prayer failed: ' + message);
}
var P = (function (prototype, ownProperty, undefined) {
function isObject(o) { return typeof o === 'object'; }
function isFunction(f) { return typeof f === 'function'; }
function P(_superclass               , definition) {
if (definition === undefined) {
definition = _superclass;
_superclass = Object;
}
function C(args) {
var self = this;
if (!(self instanceof C)) return new C(arguments);
if (args && isFunction(self.init)) self.init.apply(self, args);
}
var proto = C[prototype] = new _superclass();
var _super = _superclass[prototype];
var extensions;
proto.constructor = C;
C.mixin = function (def) {
C[prototype] = P(C, def)[prototype];
return C;
}
return (C.open = function (def) {
extensions = {};
if (isFunction(def)) {
extensions = def.call(C, proto, _super, C, _superclass);
}
else if (isObject(def)) {
extensions = def;
}
if (isObject(extensions)) {
for (var ext in extensions) {
if (ownProperty.call(extensions, ext)) {
proto[ext] = extensions[ext];
}
}
}
if (!isFunction(proto.init)) {
proto.init = function () { _superclass.apply(this, arguments); };
}
return C;
})(definition);
}
return P;
})('prototype', ({}).hasOwnProperty);
var manageTextarea = (function () {
var KEY_VALUES = {
8: 'Backspace',
9: 'Tab',
10: 'Enter',
13: 'Enter',
16: 'Shift',
17: 'Control',
18: 'Alt',
20: 'CapsLock',
27: 'Esc',
32: 'Spacebar',
33: 'PageUp',
34: 'PageDown',
35: 'End',
36: 'Home',
37: 'Left',
38: 'Up',
39: 'Right',
40: 'Down',
45: 'Insert',
46: 'Del',
144: 'NumLock'
};
function stringify(evt) {
var which = evt.which || evt.keyCode;
var keyVal = KEY_VALUES[which];
var key;
var modifiers = [];
if (evt.ctrlKey) modifiers.push('Ctrl');
if (evt.originalEvent && evt.originalEvent.metaKey) modifiers.push('Meta');
if (evt.altKey) modifiers.push('Alt');
if (evt.shiftKey) modifiers.push('Shift');
key = keyVal || String.fromCharCode(which);
if (!modifiers.length && !keyVal) return key;
modifiers.push(key);
return modifiers.join('-');
}
return function manageTextarea(el, opts) {
if (!el.is('textarea')) return { select: noop };
var keydown = null;
var keypress = null;
if (!opts) opts = {};
var textCallback = opts.text || noop;
var keyCallback = opts.key || noop;
var pasteCallback = opts.paste || noop;
var onCut = opts.cut || noop;
var textarea = $(el);
var target = $(opts.container || textarea);
var timeout, deferredFn;
function defer(fn) {
timeout = setTimeout(fn);
deferredFn = fn;
}
function flush() {
if (timeout) {
clearTimeout(timeout);
timeout = undefined;
deferredFn();
}
}
target.bind('keydown keypress input keyup focusout paste', flush);
function select(text) {
flush();
textarea.val(text);
if (text) textarea[0].select();
}
function hasSelection() {
var dom = textarea[0];
if (!('selectionStart' in dom)) return false;
return dom.selectionStart !== dom.selectionEnd;
}
function popText(callback) {
var text = textarea.val();
textarea.val('');
if (text) callback(text);
}
function handleKey() {
keyCallback(stringify(keydown), keydown);
}
function onKeydown(e) {
keydown = e;
keypress = null;
handleKey();
}
function onKeypress(e) {
if (keydown && keypress) handleKey();
keypress = e;
defer(function () {
if (hasSelection()) {
setTimeout(function () {
if (!hasSelection())
popText(textCallback);
});
} else {
popText(textCallback);
}
if (hasSelection()) return;
popText(textCallback);
});
}
function onBlur() { keydown = keypress = null; }
function onPaste(e) {
textarea.focus();
defer(function () {
popText(pasteCallback);
});
}
target.bind({
keydown: onKeydown,
keypress: onKeypress,
focusout: onBlur,
cut: onCut,
paste: onPaste
});
return {
select: select
};
};
}());
var Parser = P(function (_, _super, Parser) {
function parseError(stream, message) {
if (stream) {
stream = "'" + stream + "'";
}
else {
stream = 'EOF';
}
throw 'Parse Error: ' + message + ' at ' + stream;
}
_.init = function (body) { this._ = body; };
_.parse = function (stream) {
return this.skip(eof)._(stream, success, parseError);
function success(stream, result) { return result; }
};
_.or = function (alternative) {
pray('or is passed a parser', alternative instanceof Parser);
var self = this;
return Parser(function (stream, onSuccess, onFailure) {
return self._(stream, onSuccess, failure);
function failure(newStream) {
return alternative._(stream, onSuccess, onFailure);
}
});
};
_.then = function (next) {
var self = this;
return Parser(function (stream, onSuccess, onFailure) {
return self._(stream, success, onFailure);
function success(newStream, result) {
var nextParser = (next instanceof Parser ? next : next(result));
pray('a parser is returned', nextParser instanceof Parser);
return nextParser._(newStream, onSuccess, onFailure);
}
});
};
_.many = function () {
var self = this;
return Parser(function (stream, onSuccess, onFailure) {
var xs = [];
while (self._(stream, success, failure));
return onSuccess(stream, xs);
function success(newStream, x) {
stream = newStream;
xs.push(x);
return true;
}
function failure() {
return false;
}
});
};
_.times = function (min, max) {
if (arguments.length < 2) max = min;
var self = this;
return Parser(function (stream, onSuccess, onFailure) {
var xs = [];
var result = true;
var failure;
for (var i = 0; i < min; i += 1) {
result = self._(stream, success, firstFailure);
if (!result) return onFailure(stream, failure);
}
for (; i < max && result; i += 1) {
result = self._(stream, success, secondFailure);
}
return onSuccess(stream, xs);
function success(newStream, x) {
xs.push(x);
stream = newStream;
return true;
}
function firstFailure(newStream, msg) {
failure = msg;
stream = newStream;
return false;
}
function secondFailure(newStream, msg) {
return false;
}
});
};
_.result = function (res) { return this.then(succeed(res)); };
_.atMost = function (n) { return this.times(0, n); };
_.atLeast = function (n) {
var self = this;
return self.times(n).then(function (start) {
return self.many().map(function (end) {
return start.concat(end);
});
});
};
_.map = function (fn) {
return this.then(function (result) { return succeed(fn(result)); });
};
_.skip = function (two) {
return this.then(function (result) { return two.result(result); });
};
var string = this.string = function (str) {
var len = str.length;
var expected = "expected '" + str + "'";
return Parser(function (stream, onSuccess, onFailure) {
var head = stream.slice(0, len);
if (head === str) {
return onSuccess(stream.slice(len), head);
}
else {
return onFailure(stream, expected);
}
});
};
var regex = this.regex = function (re) {
pray('regexp parser is anchored', re.toString().charAt(1) === '^');
var expected = 'expected ' + re;
return Parser(function (stream, onSuccess, onFailure) {
var match = re.exec(stream);
if (match) {
var result = match[0];
return onSuccess(stream.slice(result.length), result);
}
else {
return onFailure(stream, expected);
}
});
};
var succeed = Parser.succeed = function (result) {
return Parser(function (stream, onSuccess) {
return onSuccess(stream, result);
});
};
var fail = Parser.fail = function (msg) {
return Parser(function (stream, _, onFailure) {
return onFailure(stream, msg);
});
};
var letter = Parser.letter = regex(/^[a-z]/i);
var letters = Parser.letters = regex(/^[a-z]*/i);
var digit = Parser.digit = regex(/^[0-9]/);
var digits = Parser.digits = regex(/^[0-9]*/);
var whitespace = Parser.whitespace = regex(/^\s+/);
var optWhitespace = Parser.optWhitespace = regex(/^\s*/);
var any = Parser.any = Parser(function (stream, onSuccess, onFailure) {
if (!stream) return onFailure(stream, 'expected any character');
return onSuccess(stream.slice(1), stream.charAt(0));
});
var all = Parser.all = Parser(function (stream, onSuccess, onFailure) {
return onSuccess('', stream);
});
var eof = Parser.eof = Parser(function (stream, onSuccess, onFailure) {
if (stream) return onFailure(stream, 'expected EOF');
return onSuccess(stream, stream);
});
});
var Node = P(function (_) {
_.prev = 0;
_.next = 0;
_.parent = 0;
_.firstChild = 0;
_.lastChild = 0;
_.children = function () {
return Fragment(this.firstChild, this.lastChild);
};
_.eachChild = function (fn) {
return this.children().each(fn);
};
_.foldChildren = function (fold, fn) {
return this.children().fold(fold, fn);
};
_.adopt = function (parent, prev, next) {
Fragment(this, this).adopt(parent, prev, next);
return this;
};
_.disown = function () {
Fragment(this, this).disown();
return this;
};
});
var Fragment = P(function (_) {
_.first = 0;
_.last = 0;
_.init = function (first, last) {
pray('no half-empty fragments', !first === !last);
if (!first) return;
pray('first node is passed to Fragment', first instanceof Node);
pray('last node is passed to Fragment', last instanceof Node);
pray('first and last have the same parent',
first.parent === last.parent);
this.first = first;
this.last = last;
};
function prayWellFormed(parent, prev, next) {
pray('a parent is always present', parent);
pray('prev is properly set up', (function () {
if (!prev) return parent.firstChild === next;
return prev.next === next && prev.parent === parent;
})());
pray('next is properly set up', (function () {
if (!next) return parent.lastChild === prev;
return next.prev === prev && next.parent === parent;
})());
}
_.adopt = function (parent, prev, next) {
prayWellFormed(parent, prev, next);
var self = this;
self.disowned = false;
var first = self.first;
if (!first) return this;
var last = self.last;
if (prev) {
} else {
parent.firstChild = first;
}
if (next) {
next.prev = last;
} else {
parent.lastChild = last;
}
self.last.next = next;
self.each(function (el) {
el.prev = prev;
el.parent = parent;
if (prev) prev.next = el;
prev = el;
});
return self;
};
_.disown = function () {
var self = this;
var first = self.first;
if (!first || self.disowned) return self;
self.disowned = true;
var last = self.last;
var parent = first.parent;
prayWellFormed(parent, first.prev, first);
prayWellFormed(parent, last, last.next);
if (first.prev) {
first.prev.next = last.next;
} else {
parent.firstChild = last.next;
}
if (last.next) {
last.next.prev = first.prev;
} else {
parent.lastChild = first.prev;
}
return self;
};
_.each = function (fn) {
var self = this;
var el = self.first;
if (!el) return self;
for (; el !== self.last.next; el = el.next) {
if (fn.call(self, el) === false) break;
}
return self;
};
_.fold = function (fold, fn) {
this.each(function (el) {
fold = fn.call(this, fold, el);
});
return fold;
};
});
var uuid = (function () {
var id = 0;
return function () { return id += 1; };
})();
var MathElement = P(Node, function (_) {
_.init = function (obj) {
this.id = uuid();
MathElement[this.id] = this;
};
_.toString = function () {
return '[MathElement ' + this.id + ']';
};
_.bubble = function (event               ) {
var args = __slice.call(arguments, 1);
for (var ancestor = this; ancestor; ancestor = ancestor.parent) {
var res = ancestor[event] && ancestor[event].apply(ancestor, args);
if (res === false) break;
}
return this;
};
_.postOrder = function (fn               ) {
if (typeof fn === 'string') {
var methodName = fn;
fn = function (el) {
if (methodName in el) el[methodName].apply(el, arguments);
};
}
(function recurse(desc) {
desc.eachChild(recurse);
fn(desc);
})(this);
};
_.jQ = $();
_.jQadd = function (jQ) { this.jQ = this.jQ.add(jQ); };
this.jQize = function (html) {
var jQ = $(html);
function jQadd(el) {
if (el.getAttribute) {
var cmdId = el.getAttribute('mathquill-command-id');
var blockId = el.getAttribute('mathquill-block-id');
if (cmdId) MathElement[cmdId].jQadd(el);
if (blockId) MathElement[blockId].jQadd(el);
}
}
function traverse(el) {
for (el = el.firstChild; el; el = el.nextSibling) {
jQadd(el);
if (el.firstChild) traverse(el);
}
}
for (var i = 0; i < jQ.length; i += 1) {
jQadd(jQ[i]);
traverse(jQ[i]);
}
return jQ;
};
_.finalizeInsert = function () {
var self = this;
self.postOrder('finalizeTree');
self.postOrder('blur');
self.postOrder('respace');
if (self.next.respace) self.next.respace();
if (self.prev.respace) self.prev.respace();
self.postOrder('redraw');
self.bubble('redraw');
self.bubble('redraw');
};
_.seek = function (cursor, clientX, clientY, root, clientRect) {
var frontier = [];
function popClosest() {
var iClosest, minSqDist = Infinity;
for (var i = 0; i < frontier.length; i += 1) {
if (!frontier[i]) continue;
var sqDist = frontier[i].sqDist;
if (sqDist < minSqDist) iClosest = i, minSqDist = sqDist;
}
var closest = frontier[iClosest];
frontier[iClosest] = null;
return closest;
}
function seekPoint(node) {
var pt = node.seekPoint(clientX, clientY, clientRect);
if (!pt) return;
var dx = clientX - pt.x, dy = clientY - pt.y;
frontier.push({ point: pt, sqDist: dx * dx + dy * dy });
}
function addNode(node) {
if (!node) return;
var rect = clientRect(node);
var closestX = max(rect.left, min(rect.right, clientX));
var closestY = max(rect.top, min(rect.bottom, clientY));
var dx = clientX - closestX, dy = clientY - closestY;
frontier.push({ node: node, sqDist: dx * dx + dy * dy });
}
function addContainer(node) {
if (node === root) return;
var rect = clientRect(node);
var dist = max(0, min(clientX - rect.left, clientY - rect.top,
rect.right - clientX, rect.bottom - clientY));
frontier.push({ container: node, sqDist: dist * dist });
}
seekPoint(this);
this.eachChild(addNode);
addContainer(this);
for (var closest = popClosest() ; !closest.point; closest = popClosest()) {
if (closest.container) {
var container = closest.container, outer = container.parent;
seekPoint(outer);
outer.eachChild(function (n) { if (n !== container) addNode(n); });
addContainer(outer);
}
else {
seekPoint(closest.node);
closest.node.eachChild(addNode);
}
}
if (closest.point.next) cursor.insertBefore(closest.point.next)
else cursor.appendTo(closest.point.parent);
};
});
var MathCommand = P(MathElement, function (_, _super) {
_.init = function (ctrlSeq, htmlTemplate, textTemplate) {
var cmd = this;
_super.init.call(cmd);
if (!cmd.ctrlSeq) cmd.ctrlSeq = ctrlSeq;
if (htmlTemplate) cmd.htmlTemplate = htmlTemplate;
if (textTemplate) cmd.textTemplate = textTemplate;
};
_.replaces = function (replacedFragment) {
replacedFragment.disown();
this.replacedFragment = replacedFragment;
};
_.isEmpty = function () {
return this.foldChildren(true, function (isEmpty, child) {
return isEmpty && child.isEmpty();
});
};
_.parser = function () {
var block = latexMathParser.block;
var self = this;
return block.times(self.numBlocks()).map(function (blocks) {
self.blocks = blocks;
for (var i = 0; i < blocks.length; i += 1) {
blocks[i].adopt(self, self.lastChild, 0);
}
return self;
});
};
_.createBefore = function (cursor) {
var cmd = this;
var replacedFragment = cmd.replacedFragment;
cmd.createBlocks();
MathElement.jQize(cmd.html());
if (replacedFragment) {
replacedFragment.adopt(cmd.firstChild, 0, 0);
replacedFragment.jQ.appendTo(cmd.firstChild.jQ);
}
cursor.jQ.before(cmd.jQ);
cursor.prev = cmd.adopt(cursor.parent, cursor.prev, cursor.next);
cmd.finalizeInsert(cursor);
cmd.placeCursor(cursor);
};
_.createBlocks = function () {
var cmd = this,
numBlocks = cmd.numBlocks(),
blocks = cmd.blocks = Array(numBlocks);
for (var i = 0; i < numBlocks; i += 1) {
var newBlock = blocks[i] = MathBlock();
newBlock.adopt(cmd, cmd.lastChild, 0);
}
};
_.respace = noop;
_.placeCursor = function (cursor) {
cursor.appendTo(this.foldChildren(this.firstChild, function (prev, child) {
return prev.isEmpty() ? prev : child;
}));
};
_.seekPoint = noop;
_.expectedCursorYNextTo = function (clientRect) {
return this.firstChild.expectedCursorYInside(clientRect);
};
_.remove = function () {
this.disown()
this.jQ.remove();
this.postOrder(function (el) { delete MathElement[el.id]; });
return this;
};
_.numBlocks = function () {
var matches = this.htmlTemplate.match(/&\d+/g);
return matches ? matches.length : 0;
};
_.html = function () {
var cmd = this;
var blocks = cmd.blocks;
var cmdId = ' mathquill-command-id=' + cmd.id;
var tokens = cmd.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);
pray('no unmatched angle brackets', tokens.join('') === this.htmlTemplate);
for (var i = 0, token = tokens[0]; token; i += 1, token = tokens[i]) {
if (token.slice(-2) === '/>') {
tokens[i] = token.slice(0, -2) + cmdId + '/>';
}
else if (token.charAt(0) === '<') {
pray('not an unmatched top-level close tag', token.charAt(1) !== '/');
tokens[i] = token.slice(0, -1) + cmdId + '>';
var nesting = 1;
do {
i += 1, token = tokens[i];
pray('no missing close tags', token);
if (token.slice(0, 2) === '</') {
nesting -= 1;
}
else if (token.charAt(0) === '<' && token.slice(-2) !== '/>') {
nesting += 1;
}
} while (nesting > 0);
}
}
return tokens.join('').replace(/>&(\d+)/g, function ($0, $1) {
return ' mathquill-block-id=' + blocks[$1].id + '>' + blocks[$1].join('html');
});
};
_.latex = function () {
return this.foldChildren(this.ctrlSeq, function (latex, child) {
return latex + '{' + (child.latex() || ' ') + '}';
});
};
_.mqLatex = function () {
return this.foldChildren(this.ctrlSeq, function (latex, child) {
return latex + '{' + (child.mqLatex() || ' ') + '}';
});
};
_.textTemplate = [''];
_.text = function () {
var i = 0;
return this.foldChildren(this.textTemplate[i], function (text, child) {
i += 1;
var child_text = child.text();
if (text && this.textTemplate[i] === '('
&& child_text[0] === '(' && child_text.slice(-1) === ')')
return text + child_text.slice(1, -1) + this.textTemplate[i];
return text + child.text() + (this.textTemplate[i] || '');
});
};
});
var Symbol = P(MathCommand, function (_, _super) {
_.init = function (ctrlSeq, html, text) {
if (!text) text = ctrlSeq && ctrlSeq.length > 1 ? ctrlSeq.slice(1) : ctrlSeq;
_super.init.call(this, ctrlSeq, html, [text]);
};
_.parser = function () { return Parser.succeed(this); };
_.numBlocks = function () { return 0; };
_.replaces = function (replacedFragment) {
replacedFragment.remove();
};
_.createBlocks = noop;
_.seek = function (cursor, clientX, clientY, root, clientRect) {
var rect = clientRect(this), left = rect.left, right = rect.right;
if (clientX - left < right - clientX) cursor.insertBefore(this);
else cursor.insertAfter(this);
};
_.expectedCursorYNextTo = function (clientRect) {
return (clientRect(this).top + clientRect(this).bottom) / 2;
};
_.latex = function () { return this.ctrlSeq; };
_.text = function () { return this.textTemplate; };
_.placeCursor = noop;
_.isEmpty = function () { return true; };
});
var MathBlock = P(MathElement, function (_) {
_.join = function (methodName) {
return this.foldChildren('', function (fold, child) {
return fold + child[methodName]();
});
};
_.mqLatex = function () { return this.join('mqLatex'); };
_.latex = function () { return this.join('latex'); };
_.text = function () {
return this.firstChild === this.lastChild ?
this.firstChild.text() :
'(' + this.join('text') + ')'
;
};
_.isEmpty = function () {
return this.firstChild === 0 && this.lastChild === 0;
};
_.seekPoint = function (clientX, clientY, clientRect) {
if (!this.firstChild) {
var pt = { next: 0, x: (clientRect(this).left + clientRect(this).right) / 2 };
}
else {
function pointLeftOf(n) { return { next: n, x: clientRect(n).left }; }
var pt = pointLeftOf(this.firstChild);
if (clientX > pt.x) {
pt = pointLeftOf(this.lastChild);
var rightwardPt = { next: 0, x: clientRect(pt.next).right };
while (clientX < pt.x) rightwardPt = pt, pt = pointLeftOf(pt.next.prev);
if (rightwardPt.x - clientX < clientX - pt.x) pt = rightwardPt;
}
}
return {
parent: this, next: pt.next,
x: pt.x, y: this.expectedCursorYInside(clientRect)
};
};
_.expectedCursorYInside = function (clientRect) {
if (this.firstChild) return this.firstChild.expectedCursorYNextTo(clientRect);
else return (clientRect(this).top + clientRect(this).bottom) / 2;
};
_.focus = function () {
this.jQ.addClass('mq-hasCursor');
this.jQ.removeClass('mq-empty');
return this;
};
_.blur = function () {
this.jQ.removeClass('mq-hasCursor');
if (this.isEmpty())
this.jQ.addClass('mq-empty');
return this;
};
});
var MathFragment = P(Fragment, function (_, _super) {
_.init = function (first, last) {
_super.init.call(this, first, last || first);
this.jQ = this.fold($(), function (jQ, child) { return child.jQ.add(jQ); });
};
_.latex = function () {
return this.fold('', function (latex, el) { return latex + el.latex(); });
};
_.remove = function () {
this.jQ.remove();
this.each(function (el) {
el.postOrder(function (desc) {
delete MathElement[desc.id];
});
});
return this.disown();
};
});
function createRoot(container, root, textbox, editable) {
var contents = container.contents().detach();
if (!textbox) {
container.addClass('mathquill-rendered-math');
}
root.jQ = $('<span class="mathquill-root-block"/>').appendTo(container.attr(mqBlockId, root.id));
root.revert = function () {
container.empty().unbind('.mathquill')
.removeClass('mathquill-rendered-math mathquill-editable mathquill-textbox')
.append(contents);
};
root.cursor = Cursor(root);
root.renderLatex(contents.text());
}
function setupTextarea(editable, container, root, cursor) {
var is_ios = navigator.userAgent.match(/(iPad|iPhone|iPod)/i) !== null;
var is_android = navigator.userAgent.match(/(Android|Silk|Kindle)/i) !== null;
window.MathEditorWidgetUseKeyboard = true;
var useTextarea = true;
if (is_ios || is_android) useTextarea = false;
if (window.MathEditorWidgetUseKeyboard == true) useTextarea = true;
var textareaSpan = root.textarea = useTextarea ?
$('<span class="mq-textarea"><textarea></textarea></span>')
: $('<span class="mq-textarea"><span tabindex=0></span></span>'),
textarea = textareaSpan.children();
var textareaSelectionTimeout;
root.selectionChanged = function () {
if (textareaSelectionTimeout === undefined) {
textareaSelectionTimeout = setTimeout(setTextareaSelection);
}
forceIERedraw(container[0]);
};
function setTextareaSelection() {
textareaSelectionTimeout = undefined;
var latex = cursor.selection ? '$' + cursor.selection.latex() + '$' : '';
textareaManager.select(latex);
root.triggerSpecialEvent('selectionChanged');
}
container.bind('selectstart.mathquill', function (e) {
if (e.target !== textarea[0]) e.preventDefault();
e.stopPropagation();
});
var textareaManager = hookUpTextarea(editable, container, root, cursor, textarea, textareaSpan, setTextareaSelection);
return textarea;
}
function mouseEvents(ultimateRootjQ) {
ultimateRootjQ.bind('mousedown.mathquill', function (e) {
e.preventDefault();
var container = $(e.target);
if (!container.hasClass('mathquill-editable')) {
container = container.closest('.mathquill-root-block').parent();
}
var root = MathElement[container.attr(mqBlockId) || ultimateRootjQ.attr(mqBlockId)];
var cursor = root.cursor, blink = cursor.blink;
var textareaSpan = root.textarea, textarea = textareaSpan.children();
if (root.ignoreMousedownTimeout !== undefined) {
clearTimeout(root.ignoreMousedownTimeout);
root.ignoreMousedownTimeout = undefined;
return;
}
var cachedClientRect = cachedClientRectFnForNewCache();
function mousemove(e) {
cursor.seek($(e.target), e.clientX, e.clientY, cachedClientRect);
if (cursor.prev !== anticursor.prev
|| cursor.parent !== anticursor.parent) {
cursor.selectFrom(anticursor);
}
e.preventDefault();
}
function docmousemove(e) {
delete e.target;
return mousemove(e);
}
function mouseup(e) {
anticursor = undefined;
cursor.blink = blink;
if (!cursor.selection) {
if (root.editable) {
cursor.show();
}
else {
textareaSpan.detach();
}
}
container.unbind('mousemove', mousemove);
$(e.target.ownerDocument).unbind('mousemove', docmousemove).unbind('mouseup', mouseup);
}
cursor.blink = noop;
cursor.hideHandle().seek($(e.target), e.clientX, e.clientY, cachedClientRect);
var anticursor = { parent: cursor.parent, prev: cursor.prev, next: cursor.next };
if (!root.editable && root.blurred) container.prepend(textareaSpan);
textarea.focus();
root.blurred = false;
container.mousemove(mousemove);
$(e.target.ownerDocument).mousemove(docmousemove).mouseup(mouseup);
});
}
function setupTouchHandle(editable, root, cursor) {
function firstFingerOnly(ontouchstart) {
return function (e) {
e.preventDefault();
var e = e.originalEvent, target = $(e.target);
if (e.changedTouches.length < e.touches.length) return;
var touchstart = e.changedTouches[0];
var handlers = ontouchstart(touchstart) || 0;
if (handlers.touchmove) {
target.bind('touchmove', function (e) {
var touchmove = e.originalEvent.changedTouches[0];
if (touchmove.id !== touchstart.id) return;
handlers.touchmove.call(this, touchmove);
});
}
target.bind('touchend', function (e) {
var touchend = e.originalEvent.changedTouches[0];
if (touchend.id !== touchstart.id) return;
if (handlers.touchend) handlers.touchend.call(this, touchend);
target.unbind('touchmove touchend');
});
};
}
cursor.handle.on('touchstart', firstFingerOnly(function (e) {
cursor.blink = noop;
var cursorRect = cursor.jQ[0].getBoundingClientRect();
var offsetX = e.clientX - cursorRect.left;
var offsetY = e.clientY - (cursorRect.top + cursorRect.bottom) / 2;
var cachedClientRect = cachedClientRectFnForNewCache();
var onAnimationEnd;
root.onAnimationEnd = function () { onAnimationEnd(); };
return {
touchmove: function (e) {
var adjustedX = e.clientX - offsetX, adjustedY = e.clientY - offsetY;
cursor.seek(elAtPt(adjustedX, adjustedY, root), adjustedX, adjustedY, cachedClientRect, true);
visualHapticFeedback();
onAnimationEnd = visualHapticFeedback;
function visualHapticFeedback() {
var cursorRect = cursor.jQ[0].getBoundingClientRect();
cursor.repositionHandle(cursorRect);
var dx = adjustedX - cursorRect.left;
var dy = adjustedY - (cursorRect.top + cursorRect.bottom) / 2;
var dist = Math.sqrt(dx * dx + dy * dy);
var weight = (Math.log(dist) + 1) / dist;
var skewX = Math.atan2(weight * dx, offsetY);
var scaleY = (weight * dy + offsetY) / offsetY;
var steeperScale = 2 * (scaleY - 1) + 1;
cursor.handle.css({
WebkitTransform: 'translateX(.5px) skewX(' + skewX + 'rad) scaleY(' + scaleY + ')',
opacity: 1 - steeperScale * .5
});
}
},
touchend: function (e) {
cursor.handle.css({ WebkitTransform: '', opacity: '' });
cursor.blink = blink;
cursor.show(true);
onAnimationEnd = function () {
cursor.repositionHandle(cursor.jQ[0].getBoundingClientRect());
cursor.handle.css({ WebkitTransform: '', opacity: '' });
delete root.onAnimationEnd;
};
}
};
}));
}
function hookUpTextarea(editable, container, root, cursor, textarea, textareaSpan, setTextareaSelection) {
if (!editable) {
root.blurred = true;
var textareaManager = manageTextarea(textarea, { container: container });
container.bind('copy', setTextareaSelection)
.prepend('<span class="mq-selectable">$' + root.latex() + '$</span>');
textarea.bind('cut paste', false).blur(function () {
cursor.clearSelection();
setTimeout(detach);
});
function detach() {
textareaSpan.detach();
root.blurred = true;
}
return textareaManager;
}
var textareaManager = manageTextarea(textarea, {
container: container,
key: function (key, evt) {
cursor.parent.bubble('onKey', key, evt);
},
text: function (text) {
cursor.parent.bubble('onText', text);
},
cut: function (e) {
if (cursor.selection) {
setTimeout(function () {
cursor.prepareEdit();
cursor.parent.bubble('redraw');
root.triggerSpecialEvent('render');
});
}
e.stopPropagation();
root.triggerSpecialEvent('render');
},
paste: function (text) {
if (text.slice(0, 1) === '$' && text.slice(-1) === '$') {
text = text.slice(1, -1);
}
cursor.writeLatex(text).show();
root.triggerSpecialEvent('render');
}
});
container.prepend(textareaSpan);
return textareaManager;
}
function rootCSSClasses(container, textbox) {
container.addClass('mathquill-editable');
if (textbox)
container.addClass('mathquill-textbox');
}
function focusBlurEvents(root, cursor, textarea) {
textarea.focus(function (e) {
root.blurred = false;
if (!cursor.parent)
cursor.appendTo(root);
cursor.parent.jQ.addClass('mq-hasCursor');
if (cursor.selection) {
cursor.selection.jQ.removeClass('mq-blur');
setTimeout(root.selectionChanged);
}
else
cursor.show();
}).blur(function (e) {
root.blurred = true;
cursor.hide().parent.blur();
if (cursor.selection)
cursor.selection.jQ.addClass('mq-blur');
}).blur();
}
function desmosCustomEvents(container, root, cursor) {
container.bind('select_all', function (e) {
cursor.prepareMove().appendTo(root);
while (cursor.prev) cursor.selectLeft();
})
.bind('custom_paste', function (e, text) {
if (text.slice(0, 1) === '$' && text.slice(-1) === '$') {
text = text.slice(1, -1);
}
cursor.writeLatex(text).show();
root.triggerSpecialEvent('render');
});
}
function elAtPt(clientX, clientY, root) {
var el = document.elementFromPoint(clientX, clientY);
return $.contains(root.jQ[0], el) ? $(el) : root.jQ;
}
function cachedClientRectFnForNewCache() {
var cache = {};
function elById(el, id) {
if (!cache[id]) {
pray('only called within Cursor::seek', 'scrollLeft' in cachedClientRect);
var rect = el.getBoundingClientRect(), dx = cachedClientRect.scrollLeft;
cache[id] = {
top: rect.top, right: rect.right + dx,
bottom: rect.bottom, left: rect.left + dx
};
}
return cache[id];
};
function cachedClientRect(node) { return elById(node.jQ[0], node.id); };
cachedClientRect.elById = elById;
return cachedClientRect;
}
var RootMathBlock = P(MathBlock, function (_, _super) {
_.latex = function () {
return _super.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/ig, '$1');
};
_.text = function () {
return this.foldChildren('', function (text, child) {
return text + child.text();
});
};
_.renderLatex = function (latex) {
var all = Parser.all;
var eof = Parser.eof;
var block = latexMathParser.skip(eof).or(all.result(false)).parse(latex);
this.firstChild = this.lastChild = 0;
if (block) {
block.children().adopt(this, 0, 0);
}
var jQ = this.jQ;
if (block) {
var html = block.join('html');
jQ.html(html);
MathElement.jQize(jQ);
this.focus().finalizeInsert();
}
else {
jQ.empty();
}
this.cursor.appendTo(this);
};
_.renderSliderLatex = function (latex) {
function makeCmd(ch) {
var cmd;
var code = ch.charCodeAt(0);
if ((65 <= code && code <= 90) || (97 <= code && code <= 122))
cmd = Variable(ch);
else {
if (CharCmds[ch] || LatexCmds[ch])
cmd = (CharCmds[ch] || LatexCmds[ch])(ch);
else {
cmd = VanillaSymbol(ch);
}
}
return cmd;
}
var matches = /^([a-z])(?:_([a-z0-9]|\{[a-z0-9]+\}))?=([-0-9.]+)$/i.exec(latex);
pray('valid restricted slider LaTeX', matches);
var letter = matches[1];
var subscript = matches[2];
var value = matches[3];
this.firstChild = this.lastChild = 0;
letter = Variable(letter);
if (subscript) {
var sub = LatexCmds._('_');
var subBlock = MathBlock().adopt(sub, 0, 0);
sub.blocks = [subBlock];
if (subscript.length === 1) {
makeCmd(subscript).adopt(subBlock, subBlock.lastChild, 0);
}
else {
for (var i = 1; i < subscript.length - 1; i += 1) {
makeCmd(subscript.charAt(i)).adopt(subBlock, subBlock.lastChild, 0);
}
}
}
letter.adopt(this, this.lastChild, 0);
if (sub) sub.adopt(this, this.lastChild, 0);
LatexCmds['=']('=').adopt(this, this.lastChild, 0);
for (var i = 0, l = value.length; i < l; i += 1) {
var ch = value.charAt(i);
var cmd = makeCmd(ch);
cmd.adopt(this, this.lastChild, 0);
}
var jQ = this.jQ;
var html = this.join('html');
jQ.html(html);
MathElement.jQize(jQ);
this.cursor.parent = this;
this.cursor.prev = this.lastChild;
this.cursor.next = 0;
};
_.up = function () { this.triggerSpecialEvent('upPressed'); };
_.down = function () { this.triggerSpecialEvent('downPressed'); };
_.moveOutOf = function (dir) { this.triggerSpecialEvent(dir + 'Pressed'); };
_.onKey = function (key, e) {
switch (key) {
case 'Ctrl-Shift-Backspace':
case 'Ctrl-Backspace':
while (this.cursor.prev || this.cursor.selection) {
this.cursor.backspace();
}
break;
case 'Shift-Backspace':
case 'Backspace':
this.cursor.backspace();
this.triggerSpecialEvent('render');
break;
case 'Esc':
case 'Tab':
var parent = this.cursor.parent;
if (parent === this.cursor.root) return;
this.cursor.prepareMove();
if (parent.next) {
this.cursor.prependTo(parent.next);
} else {
this.cursor.insertAfter(parent.parent);
}
break;
case 'Shift-Tab':
case 'Shift-Esc':
var parent = this.cursor.parent;
if (parent === this.cursor.root) return;
this.cursor.prepareMove();
if (parent.prev) {
this.cursor.appendTo(parent.prev);
} else {
this.cursor.insertBefore(parent.parent);
}
break;
case 'Enter': this.triggerSpecialEvent('enterPressed'); break;
case 'End':
this.cursor.prepareMove().appendTo(this.cursor.parent);
break;
case 'Ctrl-End':
this.cursor.prepareMove().appendTo(this);
break;
case 'Shift-End':
while (this.cursor.next) {
this.cursor.selectRight();
}
break;
case 'Ctrl-Shift-End':
while (this.cursor.next || this.cursor.parent !== this) {
this.cursor.selectRight();
}
break;
case 'Home':
this.cursor.prepareMove().prependTo(this.cursor.parent);
break;
case 'Ctrl-Home':
this.cursor.prepareMove().prependTo(this);
break;
case 'Shift-Home':
while (this.cursor.prev) {
this.cursor.selectLeft();
}
break;
case 'Ctrl-Shift-Home':
while (this.cursor.prev || this.cursor.parent !== this) {
this.cursor.selectLeft();
}
break;
case 'Left': this.cursor.moveLeft(); break;
case 'Shift-Left': this.cursor.selectLeft(); break;
case 'Ctrl-Left': break;
case 'Meta-Left': break;
case 'Right': this.cursor.moveRight(); break;
case 'Shift-Right': this.cursor.selectRight(); break;
case 'Ctrl-Right': break;
case 'Meta-Right': break;
case 'Up': this.cursor.moveUp(); break;
case 'Down': this.cursor.moveDown(); break;
case 'Shift-Up':
if (this.cursor.prev) {
while (this.cursor.prev) this.cursor.selectLeft();
} else {
this.cursor.selectLeft();
}
case 'Shift-Down':
if (this.cursor.next) {
while (this.cursor.next) this.cursor.selectRight();
}
else {
this.cursor.selectRight();
}
case 'Ctrl-Up': break;
case 'Meta-Up': break;
case 'Ctrl-Down': break;
case 'Meta-Down': break;
case 'Ctrl-Shift-Del':
case 'Ctrl-Del':
while (this.cursor.next || this.cursor.selection) {
this.cursor.deleteForward();
}
this.triggerSpecialEvent('render');
break;
case 'Shift-Del':
case 'Del':
this.cursor.deleteForward();
this.triggerSpecialEvent('render');
break;
case 'Meta-A':
case 'Ctrl-A':
if (this !== this.cursor.root) return;
this.cursor.prepareMove().appendTo(this);
while (this.cursor.prev) this.cursor.selectLeft();
break;
default:
this.scrollHoriz();
return false;
}
e.preventDefault();
this.scrollHoriz();
return false;
};
_.onText = function (ch) {
this.cursor.setFractionMode(1);
this.cursor.write(ch);
this.cursor.setFractionMode(0);
this.triggerSpecialEvent('render');
this.scrollHoriz();
return false;
};
_.scrollHoriz = function () {
var cursor = this.cursor, seln = cursor.selection;
var rootRect = this.jQ[0].getBoundingClientRect();
if (!seln) {
var x = cursor.jQ[0].getBoundingClientRect().left;
if (x > rootRect.right - 20) var scrollBy = x - (rootRect.right - 20);
else if (x < rootRect.left + 20) var scrollBy = x - (rootRect.left + 20);
else return;
}
else {
var rect = seln.jQ[0].getBoundingClientRect();
var overLeft = rect.left - (rootRect.left + 20);
var overRight = rect.right - (rootRect.right - 20);
if (seln.first === cursor.next) {
if (overLeft < 0) var scrollBy = overLeft;
else if (overRight > 0) {
if (rect.left - overRight < rootRect.left + 20) var scrollBy = overLeft;
else var scrollBy = overRight;
}
else return;
}
else {
if (overRight > 0) var scrollBy = overRight;
else if (overLeft < 0) {
if (rect.right - overLeft > rootRect.right - 20) var scrollBy = overRight;
else var scrollBy = overLeft;
}
else return;
}
}
this.jQ.stop().animate({ scrollLeft: '+=' + scrollBy }, 100, this.onAnimationEnd);
};
_.triggerSpecialEvent = function (eventName) {
this.jQ.trigger(eventName);
};
});
var RootMathCommand = P(MathCommand, function (_, _super) {
_.init = function (cursor) {
_super.init.call(this, '$');
this.cursor = cursor;
};
_.htmlTemplate = '<span class="mathquill-rendered-math">&0</span>';
_.createBlocks = function () {
this.firstChild =
this.lastChild =
RootMathBlock();
this.blocks = [this.firstChild];
this.firstChild.parent = this;
var cursor = this.firstChild.cursor = this.cursor;
this.firstChild.onText = function (ch) {
if (ch !== '$' || cursor.parent !== this)
cursor.write(ch);
else if (this.isEmpty()) {
cursor.insertAfter(this.parent).backspace()
.insertNew(VanillaSymbol('\\$', '$')).show();
}
else if (!cursor.next)
cursor.insertAfter(this.parent);
else if (!cursor.prev)
cursor.insertBefore(this.parent);
else
cursor.write(ch);
return false;
};
};
_.latex = function () {
return '$' + this.firstChild.latex() + '$';
};
});
var RootTextBlock = P(MathBlock, function (_) {
_.renderLatex = function (latex) {
var self = this
var cursor = self.cursor;
self.jQ.children().slice(1).remove();
self.firstChild = self.lastChild = 0;
cursor.show().appendTo(self);
var regex = Parser.regex;
var string = Parser.string;
var eof = Parser.eof;
var all = Parser.all;
var mathMode = string('$').then(latexMathParser)
.skip(string('$').or(eof))
.map(function (block) {
var rootMathCommand = RootMathCommand(cursor);
rootMathCommand.createBlocks();
var rootMathBlock = rootMathCommand.firstChild;
block.children().adopt(rootMathBlock, 0, 0);
return rootMathCommand;
})
;
var escapedDollar = string('\\$').result('$');
var textChar = escapedDollar.or(regex(/^[^$]/)).map(VanillaSymbol);
var latexText = mathMode.or(textChar).many();
var commands = latexText.skip(eof).or(all.result(false)).parse(latex);
if (commands) {
for (var i = 0; i < commands.length; i += 1) {
commands[i].adopt(self, self.lastChild, 0);
}
var html = self.join('html');
MathElement.jQize(html).appendTo(self.jQ);
this.finalizeInsert();
}
};
_.onKey = RootMathBlock.prototype.onKey;
_.onText = function (ch) {
this.cursor.prepareEdit();
if (ch === '$')
this.cursor.insertNew(RootMathCommand(this.cursor));
else
this.cursor.insertNew(VanillaSymbol(ch));
return false;
};
_.scrollHoriz = RootMathBlock.prototype.scrollHoriz;
});
var CharCmds = {}, LatexCmds = {};
var scale,
forceIERedraw = noop,
div = document.createElement('div'),
div_style = div.style,
transformPropNames = {
transform: 1,
WebkitTransform: 1,
MozTransform: 1,
OTransform: 1,
msTransform: 1
},
transformPropName;
for (var prop in transformPropNames) {
if (prop in div_style) {
transformPropName = prop;
break;
}
}
if (transformPropName) {
scale = function (jQ, x, y) {
jQ.css(transformPropName, 'scale(' + x + ',' + y + ')');
};
}
else if ('filter' in div_style) {
forceIERedraw = function (el) { el.className = el.className; };
scale = function (jQ, x, y) {
x /= (1 + (y - 1) / 2);
jQ.css('fontSize', y + 'em');
if (!jQ.hasClass('mq-matrixed-container')) {
jQ.addClass('mq-matrixed-container')
.wrapInner('<span class="mq-matrixed"></span>');
}
var innerjQ = jQ.children()
.css('filter', 'progid:DXImageTransform.Microsoft'
+ '.Matrix(M11=' + x + ",SizingMethod='auto expand')"
);
function calculateMarginRight() {
jQ.css('marginRight', (innerjQ.width() - 1) * (x - 1) / x + 'px');
}
calculateMarginRight();
var intervalId = setInterval(calculateMarginRight);
$(window).load(function () {
clearTimeout(intervalId);
calculateMarginRight();
});
};
}
else {
scale = function (jQ, x, y) {
jQ.css('fontSize', y + 'em');
};
}
var Style = P(MathCommand, function (_, _super) {
_.init = function (ctrlSeq, tagName, attrs) {
_super.init.call(this, ctrlSeq, '<' + tagName + ' ' + attrs + '>&0</' + tagName + '>');
};
});
LatexCmds.mathrm = bind(Style, '\\mathrm', 'span', 'class="mq-roman mq-font"');
LatexCmds.mathit = bind(Style, '\\mathit', 'i', 'class="mq-font"');
LatexCmds.mathbf = bind(Style, '\\mathbf', 'b', 'class="mq-font"');
LatexCmds.mathsf = bind(Style, '\\mathsf', 'span', 'class="mq-sans-serif mq-font"');
LatexCmds.mathtt = bind(Style, '\\mathtt', 'span', 'class="mq-monospace mq-font"');
LatexCmds.underline = bind(Style, '\\underline', 'span', 'class="mq-non-leaf mq-underline"');
LatexCmds.overline = LatexCmds.bar = bind(Style, '\\overline', 'span', 'class="mq-non-leaf mq-overline"');
var SupSub = P(MathCommand, function (_, _super) {
_.init = function (ctrlSeq, tag, text) {
_super.init.call(this, ctrlSeq, '<' + tag + ' class="mq-non-leaf"><span class="mq-non-leaf mq-' + tag + '">&0</span></' + tag + '>', [text]);
};
_.finalizeTree = function () {
pray('SupSub is only _ and ^',
this.ctrlSeq === '^' || this.ctrlSeq === '_'
);
if (this.ctrlSeq === '_') {
this.down = this.firstChild;
this.firstChild.up = insertBeforeUnlessAtEnd;
}
else {
this.up = this.firstChild;
this.firstChild.down = insertBeforeUnlessAtEnd;
}
};
function insertBeforeUnlessAtEnd(cursor) {
var cmd = this.parent, ancestorCmd = cursor;
do {
if (ancestorCmd.next) {
cursor.insertBefore(cmd);
return false;
}
ancestorCmd = ancestorCmd.parent.parent;
} while (ancestorCmd !== cmd);
cursor.insertAfter(cmd);
return false;
}
_.latex = function () {
if (this.ctrlSeq === '_' && this.respaced) return '';
var latex = '';
if (this.ctrlSeq === '^' && this.next.respaced) {
var block = this.next.firstChild.latex();
if (block.length === 1) latex += '_' + block;
else latex += '_{' + block + '}';
}
var block = this.firstChild.latex();
if (block.length === 1) latex += this.ctrlSeq + block;
else latex += this.ctrlSeq + '{' + (block || ' ') + '}';
return latex;
};
_.redraw = function () {
if (this.prev)
this.prev.respace();
if (!(this.prev instanceof SupSub)) {
this.respace();
if (this.next && !(this.next instanceof SupSub))
this.next.respace();
}
};
_.respace = function () {
if (
this.prev.ctrlSeq === '\\int ' || (
this.prev instanceof SupSub && this.prev.ctrlSeq != this.ctrlSeq
&& this.prev.prev && this.prev.prev.ctrlSeq === '\\int '
)
) {
if (!this['int']) {
this['int'] = true;
this.jQ.addClass('mq-int');
}
}
else {
if (this['int']) {
this['int'] = false;
this.jQ.removeClass('mq-int');
}
}
this.respaced = this.prev instanceof SupSub && this.prev.ctrlSeq != this.ctrlSeq && !this.prev.respaced;
if (this.respaced) {
var fontSize = +this.jQ.css('fontSize').slice(0, -2),
prevWidth = this.prev.jQ.outerWidth(),
thisWidth = this.jQ.outerWidth();
this.jQ.css({
left: (this['int'] && this.ctrlSeq === '_' ? -.25 : 0) - prevWidth / fontSize + 'em',
marginRight: .1 - min(thisWidth, prevWidth) / fontSize + 'em'
});
}
else if (this['int'] && this.ctrlSeq === '_') {
this.jQ.css({
left: '-.25em',
marginRight: ''
});
}
else {
this.jQ.css({
left: '',
marginRight: ''
});
}
if (this.respaced) {
if (this.ctrlSeq === '^') this.down = this.firstChild.down = this.prev.firstChild;
else this.up = this.firstChild.up = this.prev.firstChild;
}
else if (this.next.respaced) {
if (this.ctrlSeq === '_') this.up = this.firstChild.up = this.next.firstChild;
else this.down = this.firstChild.down = this.next.firstChild;
}
else {
if (this.ctrlSeq === '_') {
delete this.up;
this.firstChild.up = insertBeforeUnlessAtEnd;
}
else {
delete this.down;
this.firstChild.down = insertBeforeUnlessAtEnd;
}
}
if (this.next instanceof SupSub)
this.next.respace();
return this;
};
_.onKey = function (key, e) {
if (this.getCursor().parent.parent !== this) return;
switch (key) {
case 'Tab':
if (this.next.respaced) {
this.getCursor().prepareMove().prependTo(this.next.firstChild);
e.preventDefault();
return false;
}
break;
case 'Shift-Tab':
if (this.respaced) {
this.getCursor().prepareMove().appendTo(this.prev.firstChild);
e.preventDefault();
return false;
}
break;
case 'Left':
if (!this.getCursor().prev && this.respaced) {
this.getCursor().prepareMove().insertBefore(this.prev);
return false;
}
break;
case 'Right':
if (!this.getCursor().next && this.next.respaced) {
this.getCursor().prepareMove().insertAfter(this.next);
return false;
}
}
};
_.getCursor = function () {
var cursor;
for (var ancestor = this.parent; !cursor; ancestor = ancestor.parent) {
cursor = ancestor.cursor;
}
this.getCursor = function () { return cursor; };
return this.getCursor();
};
_.expectedCursorYNextTo = function (clientRect) {
if (this.ctrlSeq === '_') return clientRect(this).top;
else return clientRect(this).bottom;
};
});
LatexCmds.subscript =
LatexCmds._ = bind(SupSub, '_', 'sub', '_');
LatexCmds.superscript =
LatexCmds.supscript =
LatexCmds['^'] = bind(SupSub, '^', 'sup', '**');
var BigSymbol = P(MathCommand, function (_, _super) {
_.init = function (ch, html) {
var htmlTemplate =
'<span class="mq-large-operator mq-non-leaf">'
+ '<span class="mq-to"><span>&1</span></span>'
+ '<big>' + html + '</big>'
+ '<span class="mq-from"><span>&0</span></span>'
+ '</span>'
;
Symbol.prototype.init.call(this, ch, htmlTemplate);
};
_.placeCursor = function (cursor) {
if(cursor.prev && cursor.prev.ctrlSeq.trim() != '\\int') cursor.appendTo(this.firstChild).writeLatex('n=').show();
};
_.latex = function () {
function simplify(latex) {
return latex.length === 1 ? latex : '{' + (latex || ' ') + '}';
}
return this.ctrlSeq + '_' + simplify(this.firstChild.latex()) +
'^' + simplify(this.lastChild.latex());
};
_.parser = function () {
var string = Parser.string;
var optWhitespace = Parser.optWhitespace;
var succeed = Parser.succeed;
var block = latexMathParser.block;
var self = this;
var blocks = self.blocks = [MathBlock(), MathBlock()];
for (var i = 0; i < blocks.length; i += 1) {
blocks[i].adopt(self, self.lastChild, 0);
}
return optWhitespace.then(string('_').or(string('^'))).then(function (supOrSub) {
var child = blocks[supOrSub === '_' ? 0 : 1];
return block.then(function (block) {
block.children().adopt(child, child.lastChild, 0);
return succeed(self);
});
}).many().result(self);
};
_.finalizeTree = function () {
this.down = this.firstChild;
this.firstChild.up = insertAfterUnlessAtBeginning;
this.up = this.lastChild;
this.lastChild.down = insertAfterUnlessAtBeginning;
};
function insertAfterUnlessAtBeginning(cursor) {
var cmd = this.parent, ancestorCmd = cursor;
do {
if (ancestorCmd.prev) {
cursor.insertAfter(cmd);
return false;
}
ancestorCmd = ancestorCmd.parent.parent;
} while (ancestorCmd !== cmd);
cursor.insertBefore(cmd);
return false;
}
});
LatexCmds['\u2211'] = LatexCmds.sum = LatexCmds.summation = bind(BigSymbol, '\\sum ', '&sum;');
LatexCmds['\u220F'] = LatexCmds.prod = LatexCmds.product = bind(BigSymbol, '\\prod ', '&prod;');
LatexCmds['\u222B'] = LatexCmds.int = bind(BigSymbol, '\\int ', '&int;');
var Fraction =
LatexCmds.frac =
LatexCmds.dfrac =
LatexCmds.cfrac =
LatexCmds.fraction = P(MathCommand, function (_, _super) {
_.ctrlSeq = '\\frac';
_.htmlTemplate =
'<span class="mq-fraction mq-non-leaf">'
+ '<span class="mq-numerator">&0</span>'
+ '<span class="mq-denominator">&1</span>'
+ '<span style="display:inline-block;width:0;overflow:hidden">&nbsp;</span>'
+ '</span>'
;
_.textTemplate = ['(', '/', ')'];
_.finalizeTree = function () {
this.up = this.lastChild.up = this.firstChild;
this.down = this.firstChild.down = this.lastChild;
};
_.expectedCursorYNextTo = function (clientRect) {
return clientRect.elById(this.jQ[0].lastChild, this.id + .5).top;
};
});
var LiveFraction =
LatexCmds.over =
CharCmds['/'] = P(Fraction, function (_, _super) {
_.createBefore = function (cursor) {
if (!this.replacedFragment) {
var prev = cursor.prev;
if (prev instanceof TextBlock || prev instanceof Fraction) {
prev = prev.prev;
}
else {
while (prev &&
!(
prev instanceof BinaryOperator ||
prev instanceof TextBlock ||
prev instanceof BigSymbol ||
prev instanceof Fraction ||
prev.ctrlSeq === ',' ||
prev.ctrlSeq === ':' ||
prev.ctrlSeq === '\\space '
)
)
prev = prev.prev;
if (prev instanceof BigSymbol && prev.next instanceof SupSub) {
prev = prev.next;
if (prev.next instanceof SupSub && prev.next.ctrlSeq != prev.ctrlSeq)
prev = prev.next;
}
}
if (prev !== cursor.prev && ((this.ctrlSeq != '\\frac' && cursor.getFractionMode() == 0) || (this.ctrlSeq == '\\frac' && cursor.getFractionMode() == 1))) {
this.replaces(MathFragment(prev.next || cursor.parent.firstChild, cursor.prev));
cursor.prev = prev;
}
}
_super.createBefore.call(this, cursor);
};
});
var SquareRoot =
LatexCmds.sqrt =
LatexCmds['âˆš'] = P(MathCommand, function (_, _super) {
_.ctrlSeq = '\\sqrt';
_.htmlTemplate =
'<span class="mq-non-leaf">'
+ '<span class="mq-scaled mq-sqrt-prefix">&radic;</span>'
+ '<span class="mq-non-leaf mq-sqrt-stem">&0</span>'
+ '</span>'
;
_.textTemplate = ['sqrt(', ')'];
_.parser = function () {
return latexMathParser.optBlock.then(function (optBlock) {
return latexMathParser.block.map(function (block) {
var nthroot = NthRoot();
nthroot.blocks = [optBlock, block];
optBlock.adopt(nthroot, 0, 0);
block.adopt(nthroot, optBlock, 0);
return nthroot;
});
}).or(_super.parser.call(this));
};
_.redraw = function () {
var block = this.lastChild.jQ;
scale(block.prev(), 1, block.innerHeight() / +block.css('fontSize').slice(0, -2) - .1);
};
});
var NthRoot =
LatexCmds.nthroot = P(SquareRoot, function (_, _super) {
_.ctrlSeq = '\\root';
_.htmlTemplate =
'<sup class="mq-nthroot mq-non-leaf">&0</sup>'
+ '<span class="mq-scaled">'
+ '<span class="mq-sqrt-prefix mq-scaled">&radic;</span>'
+ '<span class="mq-sqrt-stem mq-non-leaf">&1</span>'
+ '</span>'
;
_.textTemplate = ['sqrt[', '](', ')'];
_.onKey = function (key, e) {
if (this.getCursor().parent.parent !== this) return;
switch (key) {
case 'Right':
if (this.getCursor().next) return;
case 'Tab':
if (this.getCursor().parent === this.firstChild) {
this.getCursor().prepareMove().prependTo(this.lastChild);
e.preventDefault();
return false;
}
break;
case 'Left':
if (this.getCursor().prev) return;
case 'Shift-Tab':
if (this.getCursor().parent === this.lastChild) {
this.getCursor().prepareMove().appendTo(this.firstChild);
e.preventDefault();
return false;
}
}
};
_.getCursor = SupSub.prototype.getCursor;
_.expectedCursorYNextTo = function (clientRect) {
return clientRect.elById(this.jQ[0], this.id + .5).bottom;
};
});
var Bracket = P(MathCommand, function (_, _super) {
_.init = function (open, close, ctrlSeq, end) {
_super.init.call(this, '\\left' + ctrlSeq,
'<span class="mq-non-leaf">'
+ '<span class="mq-scaled mq-paren">' + open + '</span>'
+ '<span class="mq-non-leaf">&0</span>'
+ '<span class="mq-scaled mq-paren">' + close + '</span>'
+ '</span>',
[open, close]);
this.end = '\\right' + end;
};
_.jQadd = function () {
_super.jQadd.apply(this, arguments);
var jQ = this.jQ;
this.bracketjQs = jQ.children(':first').add(jQ.children(':last'));
};
_.finalizeTree = function () {
if (this.firstChild.isEmpty() && this.next) {
var nextAll = MathFragment(this.next, this.parent.lastChild).disown();
nextAll.adopt(this.firstChild, 0, 0);
nextAll.jQ.appendTo(this.firstChild.jQ);
}
};
_.placeCursor = function (cursor) {
cursor.prependTo(this.firstChild);
};
_.latex = function () {
return this.ctrlSeq + this.firstChild.latex() + this.end;
};
_.redraw = function () {
var blockjQ = this.firstChild.jQ;
var height = blockjQ.outerHeight() / +blockjQ.css('fontSize').slice(0, -2);
scale(this.bracketjQs, min(1 + .2 * (height - 1), 1.2), 1.05 * height);
};
});
LatexCmds.left = P(MathCommand, function (_) {
_.parser = function () {
var regex = Parser.regex;
var string = Parser.string;
var regex = Parser.regex;
var succeed = Parser.succeed;
var block = latexMathParser.block;
var optWhitespace = Parser.optWhitespace;
return optWhitespace.then(regex(/^(?:[([|]|\\\{)/))
.then(function (open) {
if (open.charAt(0) === '\\') open = open.slice(1);
var cmd = CharCmds[open]();
return latexMathParser
.map(function (block) {
cmd.blocks = [block];
block.adopt(cmd, 0, 0);
})
.then(string('\\right'))
.skip(optWhitespace)
.then(regex(/^(?:[\])|]|\\\})/))
.then(function (close) {
if (close.slice(-1) !== cmd.end.slice(-1)) {
return Parser.fail('open doesn\'t match close');
}
return succeed(cmd);
})
;
})
;
};
});
LatexCmds.right = P(MathCommand, function (_) {
_.parser = function () {
return Parser.fail('unmatched \\right');
};
});
LatexCmds.lbrace =
CharCmds['{'] = bind(Bracket, '{', '}', '\\{', '\\}');
LatexCmds.langle =
LatexCmds.lang = bind(Bracket, '&lang;', '&rang;', '\\langle ', '\\rangle ');
var CloseBracket = P(Bracket, function (_, _super) {
_.createBefore = function (cursor) {
if (this.replacedFragment) return _super.createBefore.call(this, cursor);
var openParen = cursor.parent.parent;
if (openParen.ctrlSeq === this.ctrlSeq) {
if (cursor.next) {
var nextAll = MathFragment(cursor.next, openParen.firstChild.lastChild).disown();
nextAll.adopt(openParen.parent, openParen, openParen.next);
nextAll.jQ.insertAfter(openParen.jQ);
if (cursor.next.respace) cursor.next.respace();
}
cursor.insertAfter(openParen);
openParen.bubble('redraw');
}
else {
_super.createBefore.call(this, cursor);
cursor.appendTo(this.firstChild);
}
};
_.finalizeTree = noop;
_.placeCursor = function (cursor) {
this.firstChild.blur();
cursor.insertAfter(this);
};
});
LatexCmds.rbrace =
CharCmds['}'] = bind(CloseBracket, '{', '}', '\\{', '\\}');
LatexCmds.rangle =
LatexCmds.rang = bind(CloseBracket, '&lang;', '&rang;', '\\langle ', '\\rangle ');
var parenMixin = function (_, _super) {
_.init = function (open, close) {
_super.init.call(this, open, close, open, close);
};
};
var Paren = P(Bracket, parenMixin);
LatexCmds.lparen =
CharCmds['('] = bind(Paren, '(', ')');
LatexCmds.lbrack =
LatexCmds.lbracket =
CharCmds['['] = bind(Paren, '[', ']');
var CloseParen = P(CloseBracket, parenMixin);
LatexCmds.rparen =
CharCmds[')'] = bind(CloseParen, '(', ')');
LatexCmds.rbrack =
LatexCmds.rbracket =
CharCmds[']'] = bind(CloseParen, '[', ']');
var Pipes =
LatexCmds.lpipe =
LatexCmds.rpipe =
CharCmds['|'] = P(Paren, function (_, _super) {
_.init = function () {
_super.init.call(this, '|', '|');
}
_.createBefore = function (cursor) {
if (!cursor.next && cursor.parent.parent && cursor.parent.parent.end === this.end && !this.replacedFragment)
cursor.insertAfter(cursor.parent.parent);
else
MathCommand.prototype.createBefore.call(this, cursor);
};
_.finalizeTree = noop;
});
var TextBlock =
LatexCmds.text =
LatexCmds.textnormal =
LatexCmds.textrm =
LatexCmds.textup =
LatexCmds.textmd = P(MathCommand, function (_, _super) {
_.ctrlSeq = '\\text';
_.htmlTemplate = '<span class="mq-text">&0</span>';
_.replaces = function (replacedText) {
if (replacedText instanceof MathFragment)
this.replacedText = replacedText.remove().jQ.text();
else if (typeof replacedText === 'string')
this.replacedText = replacedText;
};
_.textTemplate = ['"', '"'];
_.parser = function () {
var string = Parser.string;
var regex = Parser.regex;
var optWhitespace = Parser.optWhitespace;
return optWhitespace
.then(string('{')).then(regex(/^[^}]*/)).skip(string('}'))
.map(function (text) {
var cmd = TextBlock();
cmd.createBlocks();
var block = cmd.firstChild;
for (var i = 0; i < text.length; i += 1) {
var ch = VanillaSymbol(text.charAt(i));
ch.adopt(block, block.lastChild, 0);
}
return cmd;
})
;
};
_.createBlocks = function () {
this.firstChild =
this.lastChild =
InnerTextBlock();
this.blocks = [this.firstChild];
this.firstChild.parent = this;
};
_.finalizeInsert = function () {
this.firstChild.blur = function () { delete this.blur; return this; };
_super.finalizeInsert.call(this);
};
_.createBefore = function (cursor) {
_super.createBefore.call(this, this.cursor = cursor);
if (this.replacedText)
for (var i = 0; i < this.replacedText.length; i += 1)
this.write(this.replacedText.charAt(i));
};
_.write = function (ch) {
this.cursor.insertNew(VanillaSymbol(ch));
};
_.onKey = function (key, e) {
if (!this.cursor.selection &&
(
(key === 'Backspace' && !this.cursor.prev) ||
(key === 'Del' && !this.cursor.next)
)
) {
if (this.isEmpty())
this.cursor.insertAfter(this);
return false;
}
};
_.onText = function (ch) {
this.cursor.prepareEdit();
if (ch !== '$')
this.write(ch);
else if (this.isEmpty())
this.cursor.insertAfter(this).backspace().insertNew(VanillaSymbol('\\$', '$'));
else if (!this.cursor.next)
this.cursor.insertAfter(this);
else if (!this.cursor.prev)
this.cursor.insertBefore(this);
else {
var next = TextBlock(MathFragment(this.cursor.next, this.firstChild.lastChild));
next.placeCursor = function (cursor) {
this.prev = 0;
delete this.placeCursor;
this.placeCursor(cursor);
};
next.firstChild.focus = function () { return this; };
this.cursor.insertAfter(this).insertNew(next);
next.prev = this;
this.cursor.insertBefore(next);
delete next.firstChild.focus;
}
this.cursor.root.triggerSpecialEvent('render');
return false;
};
});
var InnerTextBlock = P(MathBlock, function (_, _super) {
_.blur = function () {
this.jQ.removeClass('mq-hasCursor');
if (this.isEmpty()) {
var textblock = this.parent, cursor = textblock.cursor;
if (cursor.parent === this)
this.jQ.addClass('mq-empty');
else {
cursor.hide();
textblock.remove();
if (cursor.next === textblock)
cursor.next = textblock.next;
else if (cursor.prev === textblock)
cursor.prev = textblock.prev;
cursor.show().parent.bubble('redraw');
}
}
return this;
};
_.focus = function () {
_super.focus.call(this);
var textblock = this.parent;
if (textblock.next.ctrlSeq === textblock.ctrlSeq) {
var innerblock = this,
cursor = textblock.cursor,
next = textblock.next.firstChild;
next.eachChild(function (child) {
child.parent = innerblock;
child.jQ.appendTo(innerblock.jQ);
});
if (this.lastChild)
this.lastChild.next = next.firstChild;
else
this.firstChild = next.firstChild;
next.firstChild.prev = this.lastChild;
this.lastChild = next.lastChild;
next.parent.remove();
if (cursor.prev)
cursor.insertAfter(cursor.prev);
else
cursor.prependTo(this);
cursor.parent.bubble('redraw');
}
else if (textblock.prev.ctrlSeq === textblock.ctrlSeq) {
var cursor = textblock.cursor;
if (cursor.prev)
textblock.prev.firstChild.focus();
else
cursor.appendTo(textblock.prev.firstChild);
}
return this;
};
});
function makeTextBlock(latex, tagName, attrs) {
return P(TextBlock, {
ctrlSeq: latex,
htmlTemplate: '<' + tagName + ' ' + attrs + '>&0</' + tagName + '>'
});
}
LatexCmds.em = LatexCmds.italic = LatexCmds.italics =
LatexCmds.emph = LatexCmds.textit = LatexCmds.textsl =
makeTextBlock('\\textit', 'i', 'class="mq-text"');
LatexCmds.strong = LatexCmds.bold = LatexCmds.textbf =
makeTextBlock('\\textbf', 'b', 'class="mq-text"');
LatexCmds.sf = LatexCmds.textsf =
makeTextBlock('\\textsf', 'span', 'class="mq-sans-serif mq-text"');
LatexCmds.tt = LatexCmds.texttt =
makeTextBlock('\\texttt', 'span', 'class="mq-monospace mq-text"');
LatexCmds.textsc =
makeTextBlock('\\textsc', 'span', 'style="font-variant:small-caps" class="mq-text"');
LatexCmds.uppercase =
makeTextBlock('\\uppercase', 'span', 'style="text-transform:uppercase" class="mq-text"');
LatexCmds.lowercase =
makeTextBlock('\\lowercase', 'span', 'style="text-transform:lowercase" class="mq-text"');
var LatexCommandInput =
P(MathCommand, function (_, _super) {
_.ctrlSeq = '\\';
_.replaces = function (replacedFragment) {
this._replacedFragment = replacedFragment.disown();
this.isEmpty = function () { return false; };
};
_.htmlTemplate = '<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>';
_.textTemplate = ['\\'];
_.createBlocks = function () {
_super.createBlocks.call(this);
this.firstChild.focus = function () {
this.parent.jQ.addClass('mq-hasCursor');
if (this.isEmpty())
this.parent.jQ.removeClass('mq-empty');
return this;
};
this.firstChild.blur = function () {
this.parent.jQ.removeClass('mq-hasCursor');
if (this.isEmpty())
this.parent.jQ.addClass('mq-empty');
return this;
};
};
_.createBefore = function (cursor) {
_super.createBefore.call(this, cursor);
this.cursor = cursor.appendTo(this.firstChild);
if (this._replacedFragment) {
var el = this.jQ[0];
this.jQ =
this._replacedFragment.jQ.addClass('mq-blur').bind(
'mousedown mousemove',
function (e) {
$(e.target = el).trigger(e);
return false;
}
).insertBefore(this.jQ).add(this.jQ);
}
};
_.latex = function () {
return '\\' + this.firstChild.latex() + ' ';
};
_.onKey = function (key, e) {
if (key === 'Tab' || key === 'Enter') {
this.renderCommand();
this.cursor.root.triggerSpecialEvent('render');
e.preventDefault();
return false;
}
};
_.onText = function (ch) {
if (ch.match(/[a-z]/i)) {
this.cursor.prepareEdit();
this.cursor.insertNew(VanillaSymbol(ch));
return false;
}
this.renderCommand();
if (ch === ' ' || (ch === '\\' && this.firstChild.isEmpty())) {
this.cursor.root.triggerSpecialEvent('render');
return false;
}
};
_.renderCommand = function () {
this.jQ = this.jQ.last();
this.remove();
if (this.next) {
this.cursor.insertBefore(this.next);
} else {
this.cursor.appendTo(this.parent);
}
var latex = this.firstChild.latex(), cmd;
if (!latex) latex = 'backslash';
this.cursor.insertCmd(latex, this._replacedFragment);
};
});
var Binomial =
LatexCmds.binom =
LatexCmds.binomial = P(MathCommand, function (_, _super) {
_.ctrlSeq = '\\binom';
_.htmlTemplate =
'<span class="mq-paren mq-scaled">(</span>'
+ '<span class="mq-non-leaf">'
+ '<span class="mq-array mq-non-leaf">'
+ '<span>&0</span>'
+ '<span>&1</span>'
+ '</span>'
+ '</span>'
+ '<span class="mq-paren mq-scaled">)</span>'
;
_.textTemplate = ['choose(', ',', ')'];
_.redraw = function () {
var blockjQ = this.jQ.eq(1);
var height = blockjQ.outerHeight() / +blockjQ.css('fontSize').slice(0, -2);
var parens = this.jQ.filter('.mq-paren');
scale(parens, min(1 + .2 * (height - 1), 1.2), 1.05 * height);
};
_.expectedCursorYNextTo = Symbol.prototype.expectedCursorYNextTo;
});
var Choose =
LatexCmds.choose = P(Binomial, function (_) {
_.createBefore = LiveFraction.prototype.createBefore;
});
var Vector =
LatexCmds.vector = P(MathCommand, function (_, _super) {
_.ctrlSeq = '\\vector';
_.htmlTemplate = '<span class="mq-array"><span>&0</span></span>';
_.latex = function () {
return '\\begin{matrix}' + this.foldChildren([], function (latex, child) {
latex.push(child.latex());
return latex;
}).join('\\\\') + '\\end{matrix}';
};
_.text = function () {
return '[' + this.foldChildren([], function (text, child) {
text.push(child.text());
return text;
}).join() + ']';
}
_.createBefore = function (cursor) {
_super.createBefore.call(this, this.cursor = cursor);
};
_.onKey = function (key, e) {
var currentBlock = this.cursor.parent;
if (currentBlock.parent === this) {
if (key === 'Enter') {
var newBlock = MathBlock();
newBlock.parent = this;
newBlock.jQ = $('<span></span>')
.attr(mqBlockId, newBlock.id)
.insertAfter(currentBlock.jQ);
if (currentBlock.next)
currentBlock.next.prev = newBlock;
else
this.lastChild = newBlock;
newBlock.next = currentBlock.next;
currentBlock.next = newBlock;
newBlock.prev = currentBlock;
this.bubble('redraw').cursor.appendTo(newBlock);
e.preventDefault();
return false;
}
else if (key === 'Tab' && !currentBlock.next) {
if (currentBlock.isEmpty()) {
if (currentBlock.prev) {
this.cursor.insertAfter(this);
delete currentBlock.prev.next;
this.lastChild = currentBlock.prev;
currentBlock.jQ.remove();
this.bubble('redraw');
e.preventDefault();
return false;
}
else
return;
}
var newBlock = MathBlock();
newBlock.parent = this;
newBlock.jQ = $('<span></span>').attr(mqBlockId, newBlock.id).appendTo(this.jQ);
this.lastChild = newBlock;
currentBlock.next = newBlock;
newBlock.prev = currentBlock;
this.bubble('redraw').cursor.appendTo(newBlock);
e.preventDefault();
return false;
}
else if (e.which === 8) {
if (currentBlock.isEmpty()) {
if (currentBlock.prev) {
this.cursor.appendTo(currentBlock.prev)
currentBlock.prev.next = currentBlock.next;
}
else {
this.cursor.insertBefore(this);
this.firstChild = currentBlock.next;
}
if (currentBlock.next)
currentBlock.next.prev = currentBlock.prev;
else
this.lastChild = currentBlock.prev;
currentBlock.jQ.remove();
if (this.isEmpty())
this.cursor.deleteForward();
else
this.bubble('redraw');
e.preventDefault();
return false;
}
else if (!this.cursor.prev) {
e.preventDefault();
return false;
}
}
}
};
_.expectedCursorYNextTo = Binomial.prototype.expectedCursorYNextTo;
});
LatexCmds.MathQuillMathField = P(MathCommand, function (_, _super) {
_.ctrlSeq = '\\MathQuillMathField';
_.htmlTemplate = '<span class="mathquill-editable">&0</span>';
_.finalizeTree = function () {
var self = this, rootBlock = RootMathBlock();
delete MathElement[rootBlock.id];
rootBlock.id = self.firstChild.id;
MathElement[rootBlock.id] = rootBlock;
self.firstChild.children().disown().adopt(rootBlock, 0, 0);
rootBlock.parent = self;
self.firstChild = self.lastChild = rootBlock;
self.blocks = [rootBlock];
rootBlock.jQ = self.jQ.wrapInner('<span class="mathquill-root-block"/>').children();
rootBlock.editable = true;
var cursor = rootBlock.cursor = Cursor(rootBlock).appendTo(rootBlock);
var textarea = setupTextarea(true, self.jQ, rootBlock, cursor);
setupTouchHandle(true, rootBlock, cursor);
focusBlurEvents(rootBlock, cursor, textarea);
desmosCustomEvents(self.jQ, rootBlock, cursor);
};
_.mqLatex = _super.latex;
_.latex = function () { return this.firstChild.latex(); };
_.text = function () { return this.firstChild.text(); };
});
var Variable = P(Symbol, function (_, _super) {
_.init = function (ch, html) {
_super.init.call(this, ch, '<var>' + (html || ch) + '</var>');
}
_.createBefore = function (cursor) {
var ctrlSeq = this.ctrlSeq;
for (var i = 0, prev = cursor.prev; i < MAX_AUTOCMD_LEN - 1 && prev && prev instanceof Variable; i += 1, prev = prev.prev)
ctrlSeq = prev.ctrlSeq + ctrlSeq;
while (ctrlSeq.length) {
if (AutoCmds.hasOwnProperty(ctrlSeq)) {
for (var i = 1; i < ctrlSeq.length; i += 1) cursor.backspace();
if (/^(sin|cos|tan|arcsin|arccos|arctan)$/i.test(ctrlSeq)) {
cursor.insertNew(CharCmds['(']('('));
cursor.moveLeft();
cursor.insertNew(LatexCmds[ctrlSeq](ctrlSeq));
cursor.moveRight();
}
else
cursor.insertNew(LatexCmds[ctrlSeq](ctrlSeq));
return;
}
ctrlSeq = ctrlSeq.slice(1);
}
_super.createBefore.apply(this, arguments);
};
_.respace =
_.finalizeTree = function () {
var ctrlSeq = this.ctrlSeq;
if (ctrlSeq.length > 1) return;
for (var prev = this.prev; prev instanceof Variable && prev.ctrlSeq.length === 1; prev = prev.prev)
ctrlSeq = prev.ctrlSeq + ctrlSeq;
for (var next = this.next; next instanceof Variable && next.ctrlSeq.length === 1; next = next.next)
ctrlSeq += next.ctrlSeq;
MathFragment(prev.next || this.parent.firstChild, next.prev || this.parent.lastChild)
.each(function (el) {
el.jQ.removeClass('mq-un-italicized mq-last');
delete el.isFirstLetter;
delete el.isLastLetter;
});
outer: for (var i = 0, first = prev.next || this.parent.firstChild; i < ctrlSeq.length; i += 1, first = first.next) {
for (var len = min(MAX_UNITALICIZED_LEN, ctrlSeq.length - i) ; len > 0; len -= 1) {
if (UnItalicizedCmds.hasOwnProperty(ctrlSeq.slice(i, i + len))) {
first.isFirstLetter = true;
for (var j = 0, letter = first; j < len; j += 1, letter = letter.next) {
letter.jQ.addClass('mq-un-italicized');
var last = letter;
}
last.isLastLetter = true;
if (!(last.next instanceof SupSub || last.next instanceof Bracket))
last.jQ.addClass('mq-last');
i += len - 1;
first = last;
continue outer;
}
}
}
};
_.latex = function () {
return (
this.isFirstLetter ? '\\' + this.ctrlSeq :
this.isLastLetter ? this.ctrlSeq + ' ' :
this.ctrlSeq
);
};
_.text = function () {
var text = this.ctrlSeq;
if (this.prev && !(this.prev instanceof Variable)
&& !(this.prev instanceof BinaryOperator))
text = '*' + text;
if (this.next && !(this.next instanceof BinaryOperator)
&& !(this.next.ctrlSeq === '^'))
text += '*';
return text;
};
});
var UnItalicized = P(Symbol, function (_, _super) {
_.init = function (fn) {
this.ctrlSeq = fn;
};
_.createBefore = function (cursor) {
cursor.writeLatex(this.ctrlSeq).show();
};
_.parser = function () {
var fn = this.ctrlSeq;
var block = MathBlock();
for (var i = 0; i < fn.length; i += 1) {
Variable(fn.charAt(i)).adopt(block, block.lastChild, 0);
}
return Parser.succeed(block.children());
};
});
var UnItalicizedCmds = {
ln: 1,
log: 1,
min: 1,
nCr: 1,
nPr: 1,
gcd: 1,
lcm: 1,
mcm: 1,
mcd: 1,
ceil: 1,
exp: 1,
abs: 1,
max: 1,
mod: 1,
gcf: 1,
exp: 1,
floor: 1,
sign: 1,
signum: 1,
round: 1
}, MAX_UNITALICIZED_LEN = 9, AutoCmds = {
sin: 1,
cos: 1,
tan: 1,
arcsin: 1,
arccos: 1,
arctan: 1,
sqrt: 1,
nthroot: 1,
sum: 1,
prod: 1,
pi: 1,
phi: 1,
tau: 1,
gamma: 1,
theta: 1
}, MAX_AUTOCMD_LEN = 7;
(function () {
var trigs = { sin: 1, cos: 1, tan: 1, sec: 1, cosec: 1, csc: 1, cotan: 1, cot: 1, ctg: 1 };
for (var trig in trigs) {
UnItalicizedCmds[trig] =
UnItalicizedCmds['arc' + trig] =
UnItalicizedCmds[trig + 'h'] =
UnItalicizedCmds['arc' + trig + 'h'] = 1;
}
for (var fn in UnItalicizedCmds)
LatexCmds[fn] = UnItalicized;
}());
var VanillaSymbol = P(Symbol, function (_, _super) {
_.init = function (ch, html) {
_super.init.call(this, ch, '<span>' + (html || ch) + '</span>');
};
});
CharCmds[' '] = bind(VanillaSymbol, '\\space ', ' ');
LatexCmds.prime = CharCmds["'"] = bind(VanillaSymbol, "'", '&prime;');
var NonSymbolaSymbol = P(Symbol, function (_, _super) {
_.init = function (ch, html) {
_super.init.call(this, ch, '<span class="mq-nonSymbola">' + (html || ch) + '</span>');
};
});
LatexCmds['$'] = NonSymbolaSymbol;
LatexCmds['@'] = NonSymbolaSymbol;
LatexCmds['&'] = bind(NonSymbolaSymbol, '\\&', '&amp;');
LatexCmds['%'] = bind(NonSymbolaSymbol, '\\%', '%');
LatexCmds.alpha =
LatexCmds.beta =
LatexCmds.gamma =
LatexCmds.delta =
LatexCmds.zeta =
LatexCmds.eta =
LatexCmds.theta =
LatexCmds.iota =
LatexCmds.kappa =
LatexCmds.mu =
LatexCmds.nu =
LatexCmds.xi =
LatexCmds.rho =
LatexCmds.sigma =
LatexCmds.tau =
LatexCmds.chi =
LatexCmds.psi =
LatexCmds.omega = P(Variable, function (_, _super) {
_.init = function (latex) {
_super.init.call(this, '\\' + latex + ' ', '&' + latex + ';');
};
});
LatexCmds.sin = bind(VanillaSymbol, '\\sin ', 'sin');
LatexCmds.cos = bind(VanillaSymbol, '\\cos ', 'cos');
LatexCmds.tan = bind(VanillaSymbol, '\\tan ', 'tan');
LatexCmds.arcsin = bind(VanillaSymbol, '\\arcsin ', 'arcsin');
LatexCmds.arccos = bind(VanillaSymbol, '\\arccos ', 'arccos');
LatexCmds.arctan = bind(VanillaSymbol, '\\arctan ', 'arctan');
LatexCmds.phi =
bind(Variable, '\\phi ', '&#981;');
LatexCmds.phiv =
LatexCmds.varphi =
bind(Variable, '\\varphi ', '&phi;');
LatexCmds.epsilon =
bind(Variable, '\\epsilon ', '&#1013;');
LatexCmds.epsiv =
LatexCmds.varepsilon =
bind(Variable, '\\varepsilon ', '&epsilon;');
LatexCmds.piv =
LatexCmds.varpi =
bind(Variable, '\\varpi ', '&piv;');
LatexCmds.sigmaf =
LatexCmds.sigmav =
LatexCmds.varsigma =
bind(Variable, '\\varsigma ', '&sigmaf;');
LatexCmds.thetav =
LatexCmds.vartheta =
LatexCmds.thetasym =
bind(Variable, '\\vartheta ', '&thetasym;');
LatexCmds.upsilon =
LatexCmds.upsi =
bind(Variable, '\\upsilon ', '&upsilon;');
LatexCmds.gammad =
LatexCmds.Gammad =
LatexCmds.digamma =
bind(Variable, '\\digamma ', '&#989;');
LatexCmds.kappav =
LatexCmds.varkappa =
bind(Variable, '\\varkappa ', '&#1008;');
LatexCmds.rhov =
LatexCmds.varrho =
bind(Variable, '\\varrho ', '&#1009;');
LatexCmds.pi = LatexCmds['\u03C0'] = bind(NonSymbolaSymbol, '\\pi ', '&pi;');
LatexCmds.theta = LatexCmds['\u03B8'] = bind(NonSymbolaSymbol, '\\theta ', '&theta;');
LatexCmds.lambda = bind(NonSymbolaSymbol, '\\lambda ', '&lambda;');
LatexCmds.Upsilon =
LatexCmds.Upsi =
LatexCmds.upsih =
LatexCmds.Upsih =
bind(Symbol, '\\Upsilon ', '<var style="font-family: serif">&upsih;</var>');
LatexCmds.Gamma =
LatexCmds.Delta =
LatexCmds.Theta =
LatexCmds.Lambda =
LatexCmds.Xi =
LatexCmds.Pi =
LatexCmds.Sigma =
LatexCmds.Phi =
LatexCmds.Psi =
LatexCmds.Omega =
LatexCmds.forall = P(VanillaSymbol, function (_, _super) {
_.init = function (latex) {
_super.init.call(this, '\\' + latex + ' ', '&' + latex + ';');
};
});
var LatexFragment = P(MathCommand, function (_) {
_.init = function (latex) { this.latex = latex; };
_.createBefore = function (cursor) { cursor.writeLatex(this.latex); };
_.parser = function () {
var frag = latexMathParser.parse(this.latex).children();
return Parser.succeed(frag);
};
});
LatexCmds['\u00b9'] = bind(LatexFragment, '^1');
LatexCmds['\u00b2'] = bind(LatexFragment, '^2');
LatexCmds['\u00b3'] = bind(LatexFragment, '^3');
LatexCmds['\u00bc'] = bind(LatexFragment, '\\frac14');
LatexCmds['\u00bd'] = bind(LatexFragment, '\\frac12');
LatexCmds['\u00be'] = bind(LatexFragment, '\\frac34');
LatexCmds['\u2152'] = bind(LatexFragment, '\\frac{1}{10}');
LatexCmds['\u2153'] = bind(LatexFragment, '\\frac13');
LatexCmds['\u2154'] = bind(LatexFragment, '\\frac23');
var BinaryOperator = P(Symbol, function (_, _super) {
_.init = function (ctrlSeq, html, text) {
_super.init.call(this,
ctrlSeq, '<span class="mq-binary-operator">' + html + '</span>', text
);
};
_.createBefore = function (cursor) {
var ctrlSeq = cursor.prev.ctrlSeq + this.ctrlSeq;
if (ctrlSeq === '<=' && cursor.overridenOperators && cursor.overridenOperators['le'])
cursor.backspace().insertNew(BinaryOperator('\\le ', '&le;'));
else if (ctrlSeq === '>=' && cursor.overridenOperators && cursor.overridenOperators['ge'])
cursor.backspace().insertNew(BinaryOperator('\\ge ', '&ge;'));
else
_super.createBefore.apply(this, arguments);
};
});
var PlusMinus = P(BinaryOperator, function (_) {
_.init = VanillaSymbol.prototype.init;
_.respace = function () {
if (!this.prev) {
this.jQ[0].className = '';
}
else if (
this.prev instanceof BinaryOperator &&
this.next && !(this.next instanceof BinaryOperator)
) {
this.jQ[0].className = 'mq-unary-operator';
}
else {
this.jQ[0].className = 'mq-binary-operator';
}
return this;
};
});
LatexCmds['+'] = bind(PlusMinus, '+', '+');
LatexCmds['\u2013'] = LatexCmds['\u2212'] = LatexCmds['-'] = bind(PlusMinus, '-', '&minus;');
LatexCmds['\u00B1'] = LatexCmds.pm = LatexCmds.plusmn = LatexCmds.plusminus =
bind(PlusMinus, '\\pm ', '&plusmn;');
LatexCmds.mp = LatexCmds.mnplus = LatexCmds.minusplus =
bind(PlusMinus, '\\mp ', '&#8723;');
LatexCmds.sdot = LatexCmds.cdot =
bind(BinaryOperator, '\\cdot ', '&middot;');
LatexCmds.bull = LatexCmds.bullet = bind(BinaryOperator, '\\bullet ', '&bull;');
LatexCmds['='] = bind(BinaryOperator, '=', '=');
LatexCmds['<'] = bind(BinaryOperator, '<', '&lt;');
LatexCmds['>'] = bind(BinaryOperator, '>', '&gt;');
LatexCmds.notin =
LatexCmds.sim =
LatexCmds.cong =
LatexCmds.equiv =
LatexCmds.oplus =
LatexCmds.otimes = P(BinaryOperator, function (_, _super) {
_.init = function (latex) {
_super.init.call(this, '\\' + latex + ' ', '&' + latex + ';');
};
});
LatexCmds.times = bind(BinaryOperator, '\\times ', '&times;', '[x]');
LatexCmds['\u00F7'] = LatexCmds.div = LatexCmds.divide = LatexCmds.divides =
bind(BinaryOperator, '\\div ', '&divide;', '[/]');
LatexCmds['\u2260'] = LatexCmds.ne = LatexCmds.neq = bind(BinaryOperator, '\\ne ', '&ne;');
LatexCmds.ast = LatexCmds.star = LatexCmds.loast = LatexCmds.lowast =
bind(BinaryOperator, '\\ast ', '&lowast;');
LatexCmds.therefor = LatexCmds.therefore =
bind(BinaryOperator, '\\therefore ', '&there4;');
LatexCmds.cuz =
LatexCmds.because = bind(BinaryOperator, '\\because ', '&#8757;');
LatexCmds.prop = LatexCmds.propto = bind(BinaryOperator, '\\propto ', '&prop;');
LatexCmds['\u2248'] = LatexCmds.asymp = LatexCmds.approx = bind(BinaryOperator, '\\approx ', '&asymp;');
LatexCmds.lt = bind(BinaryOperator, '<', '&lt;');
LatexCmds.gt = bind(BinaryOperator, '>', '&gt;');
LatexCmds['\u2264'] = LatexCmds.le = LatexCmds.leq = bind(BinaryOperator, '\\le ', '&le;');
LatexCmds['\u2265'] = LatexCmds.ge = LatexCmds.geq = bind(BinaryOperator, '\\ge ', '&ge;');
LatexCmds.isin = LatexCmds['in'] = bind(BinaryOperator, '\\in ', '&isin;');
LatexCmds.ni = LatexCmds.contains = bind(BinaryOperator, '\\ni ', '&ni;');
LatexCmds.notni = LatexCmds.niton = LatexCmds.notcontains = LatexCmds.doesnotcontain =
bind(BinaryOperator, '\\not\\ni ', '&#8716;');
LatexCmds.sub = LatexCmds.subset = bind(BinaryOperator, '\\subset ', '&sub;');
LatexCmds.sup = LatexCmds.supset = LatexCmds.superset =
bind(BinaryOperator, '\\supset ', '&sup;');
LatexCmds.nsub = LatexCmds.notsub =
LatexCmds.nsubset = LatexCmds.notsubset =
bind(BinaryOperator, '\\not\\subset ', '&#8836;');
LatexCmds.nsup = LatexCmds.notsup =
LatexCmds.nsupset = LatexCmds.notsupset =
LatexCmds.nsuperset = LatexCmds.notsuperset =
bind(BinaryOperator, '\\not\\supset ', '&#8837;');
LatexCmds.sube = LatexCmds.subeq = LatexCmds.subsete = LatexCmds.subseteq =
bind(BinaryOperator, '\\subseteq ', '&sube;');
LatexCmds.supe = LatexCmds.supeq =
LatexCmds.supsete = LatexCmds.supseteq =
LatexCmds.supersete = LatexCmds.superseteq =
bind(BinaryOperator, '\\supseteq ', '&supe;');
LatexCmds.nsube = LatexCmds.nsubeq =
LatexCmds.notsube = LatexCmds.notsubeq =
LatexCmds.nsubsete = LatexCmds.nsubseteq =
LatexCmds.notsubsete = LatexCmds.notsubseteq =
bind(BinaryOperator, '\\not\\subseteq ', '&#8840;');
LatexCmds.nsupe = LatexCmds.nsupeq =
LatexCmds.notsupe = LatexCmds.notsupeq =
LatexCmds.nsupsete = LatexCmds.nsupseteq =
LatexCmds.notsupsete = LatexCmds.notsupseteq =
LatexCmds.nsupersete = LatexCmds.nsuperseteq =
LatexCmds.notsupersete = LatexCmds.notsuperseteq =
bind(BinaryOperator, '\\not\\supseteq ', '&#8841;');
LatexCmds.Box = bind(VanillaSymbol, '\\Box ', '\u25A1');
LatexCmds.mid = bind(VanillaSymbol, '\\mid ', '\u2223');
LatexCmds.space = bind(VanillaSymbol, '\\space ', '&nbsp;');
LatexCmds.and = LatexCmds.land = LatexCmds.wedge =
bind(VanillaSymbol, '\\wedge ', '&and;');
LatexCmds.or = LatexCmds.lor = LatexCmds.vee = bind(VanillaSymbol, '\\vee ', '&or;');
var latexMathParser = (function () {
function commandToBlock(cmd) {
var block = MathBlock();
cmd.adopt(block, 0, 0);
return block;
}
function joinBlocks(blocks) {
var firstBlock = blocks[0] || MathBlock();
for (var i = 1; i < blocks.length; i += 1) {
blocks[i].children().adopt(firstBlock, firstBlock.lastChild, 0);
}
return firstBlock;
}
var string = Parser.string;
var regex = Parser.regex;
var letter = Parser.letter;
var any = Parser.any;
var optWhitespace = Parser.optWhitespace;
var succeed = Parser.succeed;
var fail = Parser.fail;
var variable = letter.map(Variable);
var symbol = regex(/^[^${}\\_^]/).map(VanillaSymbol);
var controlSequence =
regex(/^[^\\]/)
.or(string('\\').then(
regex(/^[a-z]+/i)
.or(regex(/^\s+/).result(' '))
.or(any)
)).then(function (ctrlSeq) {
var cmdKlass = LatexCmds[ctrlSeq];
if (cmdKlass) {
return cmdKlass(ctrlSeq).parser();
}
else {
return fail('unknown command: \\' + ctrlSeq);
}
})
;
var command =
controlSequence
.or(variable)
.or(symbol)
;
var mathGroup = string('{').then(function () { return mathSequence; }).skip(string('}'));
var mathBlock = optWhitespace.then(mathGroup.or(command.map(commandToBlock)));
var mathSequence = mathBlock.many().map(joinBlocks).skip(optWhitespace);
var optMathBlock =
string('[').then(
mathBlock.then(function (block) {
return block.join('latex') !== ']' ? succeed(block) : fail();
})
.many().map(joinBlocks).skip(optWhitespace)
).skip(string(']'))
;
var latexMath = mathSequence;
latexMath.block = mathBlock;
latexMath.optBlock = optMathBlock;
return latexMath;
})();
var Cursor = P(function (_) {
_.init = function (root) {
this.parent = this.root = root;
var jQ = this.jQ = this._jQ = $('<span class="mq-cursor"><span class="mq-line">&zwj;</span></span>');
this.blink = function () { jQ.toggleClass('mq-blink'); }
this.upDownCache = {};
this.handle = $('<span class="mq-handle"></span>');
this.handleAnchor = $('<span class="mq-handle-anchor" ' +
'style="display:none"></span>')
.append(this.handle).insertAfter(root.jQ);
this.handleAnchor.top = this.handleAnchor.left = 0;
};
_.prev = 0;
_.next = 0;
_.parent = 0;
_.showHandle = function () {
if (!this.handleAnchor.visible) {
this.handleAnchor.show();
this.repositionHandle(this.jQ[0].getBoundingClientRect());
this.handleAnchor.visible = true;
}
return this;
};
_.hideHandle = function () {
if (this.handleAnchor.visible) {
this.handleAnchor.hide();
delete this.handleAnchor.visible;
}
return this;
};
_.repositionHandle = function (cursorRect) {
var anchor = this.handleAnchor;
var anchorRect = anchor[0].getBoundingClientRect();
anchor.css({
top: anchor.top += cursorRect.bottom - anchorRect.bottom,
left: anchor.left += cursorRect.left - anchorRect.left
});
};
_.show = function (keepHandle) {
if (!keepHandle) this.hideHandle();
this.jQ = this._jQ.removeClass('mq-blink');
if ('intervalId' in this)
clearInterval(this.intervalId);
else {
if (this.next) {
if (this.selection && this.selection.first.prev === this.prev)
this.jQ.insertBefore(this.selection.jQ);
else
this.jQ.insertBefore(this.next.jQ.first());
}
else
this.jQ.appendTo(this.parent.jQ);
this.parent.focus();
}
this.intervalId = setInterval(this.blink, 500);
return this;
};
_.hide = function () {
this.hideHandle();
if ('intervalId' in this)
clearInterval(this.intervalId);
delete this.intervalId;
this.jQ.detach();
this.jQ = $();
return this;
};
_.insertAt = function (parent, prev, next) {
var old_parent = this.parent;
this.parent = parent;
this.prev = prev;
this.next = next;
old_parent.blur();
};
_.insertBefore = function (el) {
this.insertAt(el.parent, el.prev, el)
this.parent.jQ.addClass('mq-hasCursor');
this.jQ.insertBefore(el.jQ.first());
return this;
};
_.insertAfter = function (el) {
this.insertAt(el.parent, el, el.next);
this.parent.jQ.addClass('mq-hasCursor');
this.jQ.insertAfter(el.jQ.last());
return this;
};
_.prependTo = function (el) {
this.insertAt(el, 0, el.firstChild);
this.jQ.prependTo(el.jQ);
el.focus();
return this;
};
_.appendTo = function (el) {
this.insertAt(el, el.lastChild, 0);
this.jQ.appendTo(el.jQ);
el.focus();
return this;
};
_.hopLeft = function () {
this.jQ.insertBefore(this.prev.jQ.first());
this.next = this.prev;
this.prev = this.prev.prev;
return this;
};
_.hopRight = function () {
this.jQ.insertAfter(this.next.jQ.last());
this.prev = this.next;
this.next = this.next.next;
return this;
};
_.moveLeftWithin = function (block) {
if (this.prev) {
if (this.prev instanceof NthRoot) this.appendTo(this.prev.lastChild);
else if (this.prev instanceof Fraction) this.appendTo(this.prev.lastChild);
else if (this.prev.prev == 0 && this.parent != 0 && this.parent.parent != 0 && this.parent.parent instanceof Fraction && typeof this.parent.up != 'undefined') {
this.appendTo(this.parent.parent.firstChild);
}
else if (this.prev.up instanceof MathBlock) this.appendTo(this.prev.up);
else if (this.prev.firstChild) this.appendTo(this.prev.firstChild);
else this.hopLeft();
}
else {
if (this.parent !== block) this.insertBefore(this.parent.parent);
else if (block.moveOutOf) block.moveOutOf('left', this);
}
};
_.moveRightWithin = function (block) {
if (this.next) {
if (this.next.up instanceof MathBlock) this.prependTo(this.next.up);
else if (this.next.next == 0 && this.parent != 0 && this.parent.parent != 0 && this.parent.parent instanceof Fraction && typeof this.parent.down != 'undefined') {
this.prependTo(this.parent.parent.lastChild);
}
else if (this.next.firstChild) this.prependTo(this.next.firstChild);
else this.hopRight();
}
else {
if (this.parent !== block) this.insertAfter(this.parent.parent);
else if (block.moveOutOf) block.moveOutOf('right', this);
}
};
_.moveLeft = function () {
clearUpDownCache(this);
if (this.selection)
this.insertBefore(this.selection.first).clearSelection();
else {
this.moveLeftWithin(this.root);
}
this.root.triggerSpecialEvent('cursorMoved');
return this.show();
};
_.moveRight = function () {
clearUpDownCache(this);
if (this.selection)
this.insertAfter(this.selection.last).clearSelection();
else {
this.moveRightWithin(this.root);
}
this.root.triggerSpecialEvent('cursorMoved');
return this.show();
};
_.moveUp = function () { return moveUpDown(this, 'up'); };
_.moveDown = function () { return moveUpDown(this, 'down'); };
function moveUpDown(self, dir) {
if (self.next[dir]) self.prependTo(self.next[dir]);
else if (self.prev[dir]) self.appendTo(self.prev[dir]);
else {
var ancestorBlock = self.parent;
do {
var prop = ancestorBlock[dir];
if (prop) {
if (typeof prop === 'function') prop = ancestorBlock[dir](self);
if (prop === false || prop instanceof MathBlock) {
self.upDownCache[ancestorBlock.id] = { parent: self.parent, prev: self.prev, next: self.next };
if (prop instanceof MathBlock) {
var cached = self.upDownCache[prop.id];
if (cached) {
if (cached.next) {
self.insertBefore(cached.next);
} else {
self.appendTo(cached.parent);
}
} else {
var coords = self.jQ[0].getBoundingClientRect();
var cachedClientRect = cachedClientRectFnForNewCache();
cachedClientRect.scrollLeft = 0;
prop.seek(self, coords.left, coords.bottom, prop, cachedClientRect);
}
}
break;
}
}
ancestorBlock = ancestorBlock.parent.parent;
} while (ancestorBlock);
}
return self.clearSelection().show();
}
_.seek = function (target, clientX, clientY, clientRect, keepHandle) {
clearUpDownCache(this);
var cursor = this.clearSelection().show(keepHandle);
var nodeId = target.attr(mqBlockId) || target.attr(mqCmdId);
if (!nodeId) {
var targetParent = target.parent();
nodeId = targetParent.attr(mqBlockId) || targetParent.attr(mqCmdId);
}
var node = nodeId ? MathElement[nodeId] : cursor.root;
pray('nodeId is the id of some Node that exists', node);
var dx = clientRect.scrollLeft = this.root.jQ.scrollLeft();
node.seek(cursor, clientX + dx, clientY, cursor.root, clientRect);
delete clientRect.scrollLeft;
this.root.scrollHoriz();
return cursor;
};
function offset(self) {
var offset = self.jQ.removeClass('mq-cursor').offset();
self.jQ.addClass('mq-cursor');
return offset;
}
_.writeLatex = function (latex) {
var self = this;
clearUpDownCache(self);
self.show().deleteSelection();
var all = Parser.all;
var eof = Parser.eof;
var block = latexMathParser.skip(eof).or(all.result(false)).parse(latex);
if (block && !block.isEmpty()) {
block.children().adopt(self.parent, self.prev, self.next);
var html = block.join('html');
var jQ = MathElement.jQize(html);
jQ.insertBefore(self.jQ);
self.prev = block.lastChild;
block.finalizeInsert();
self.parent.bubble('redraw');
}
return this;
};
_.autoCorrect = function (latex) {
var cursor = this;
if (latex == ' ' && !cursor._superMode) {
cursor._superMode = true;
} else {
if (latex == '/' && cursor._superMode) {
cursor.setFractionMode(0);
}
cursor._superMode = false;
}
if (/(\\sin|\\cos|\\tan)/gi.test(latex) || (cursor.next && /(\\sin|\\cos|\\tan)/gi.test(cursor.next.ctrlSeq))) {
var ctrlSeq = "", i = 0;
for (var prev = cursor.prev; prev && prev instanceof Variable; prev = prev.prev)
ctrlSeq = prev.ctrlSeq + ctrlSeq;
if (/arc$/.test(ctrlSeq)) {
for (i = 0; i < 3; i++)
cursor.backspace();
latex = 'arc' + latex.slice(1);
} else if (/ar$/.test(ctrlSeq) && latex == 'c') {
latex = cursor.next.ctrlSeq.replace('\\', 'arc').replace(/\ /g, '');
cursor.moveRight();
for (i = 0; i < 3; i++)
cursor.backspace();
} else if (/(\\sin|\\cos|\\tan)/gi.test(latex))
latex = latex.slice(1);
}
return latex;
};
_._superMode = false;
_._fractionModeId = 0;
_.setFractionMode = function (value) {
this._fractionModeId = value;
};
_.getFractionMode = function () {
return this._fractionModeId;
};
_.write =
_.insertCh = function (ch, overrideRestrictForCh) {
var updatedCh = this.autoCorrect(ch);
if (updatedCh != ch && updatedCh.length > 1) {
return this.insertCmd(updatedCh);
}
overrideRestrictForCh = (typeof overrideRestrictForCh == 'undefined') ? false : overrideRestrictForCh;
var permitKey = function(cursor, keyPressed) {
var ctrlSeq = "";
for (var prev = cursor.prev; prev && prev instanceof Variable; prev = prev.prev)
ctrlSeq = prev.ctrlSeq + ctrlSeq;
ctrlSeq += keyPressed;
for (var next = cursor.next; next && next instanceof Variable; next = next.next)
ctrlSeq = ctrlSeq + next.ctrlSeq;
return cursor.restrictContentKeys.match(ctrlSeq);
};
if (!overrideRestrictForCh) {
if (this.restrictContentKeys && !permitKey(this, ch))
return;
}
if (this.overridenOperators && this.overridenOperators[ch])
ch = this.overridenOperators[ch];
if ((ch == '^' || ch == '_') && !this.prev) return;
if ((ch == '=' || ch == '<' || ch == '>' || ch == 'â‰¥' || ch == 'â‰¤') && (this.parent.parent.ctrlSeq === '^' || this.parent.parent.ctrlSeq === '_')
&& !this.next && this.prev
) {
this.moveRight();
}
if (ch === '^' && this.prev instanceof SupSub &&
(this.prev.ctrlSeq === '^' || this.prev.prev.ctrlSeq === '^')) {
this.moveUp();
return;
}
if (ch === '^' && this.next instanceof SupSub &&
(this.next.ctrlSeq === '^' || (this.next.next && this.next.next.ctrlSeq === '^'))) {
this.moveUp();
return;
}
if (ch === '_' && this.prev instanceof SupSub &&
(this.prev.ctrlSeq === '_' || this.prev.prev.ctrlSeq === '_')) {
this.moveDown();
return;
}
clearUpDownCache(this);
this.show();
if (ch == '*' && typeof CharCmds[ch] == 'undefined') {
CharCmds['*'] = LatexCmds.ast;
}
else if (ch == 'âˆ™' && typeof CharCmds[ch] == 'undefined') {
CharCmds['âˆ™'] = LatexCmds.bullet;
}
var cmd;
if (ch.match(/^[a-z]$/i))
cmd = Variable(ch);
else if (cmd = CharCmds[ch] || LatexCmds[ch])
cmd = cmd(ch);
else
cmd = VanillaSymbol(ch);
if (this.selection) {
this.prev = this.selection.first.prev;
this.next = this.selection.last.next;
cmd.replaces(this.selection);
delete this.selection;
}
return this.insertNew(cmd);
};
_.insertNew = function (cmd) {
cmd.createBefore(this);
return this;
};
_.insertCmd = function (latexCmd, replacedFragment) {
clearUpDownCache(this);
this.show();
if (/(\\sin|\\cos|\\tan)/gi.test('\\' + latexCmd))
latexCmd = this.autoCorrect('\\' + latexCmd);
var cmd = LatexCmds[latexCmd];
if (cmd) {
cmd = cmd(latexCmd);
if (replacedFragment) cmd.replaces(replacedFragment);
this.insertNew(cmd);
}
else {
cmd = TextBlock();
cmd.replaces(latexCmd);
cmd.firstChild.focus = function () { delete this.focus; return this; };
this.insertNew(cmd).insertAfter(cmd);
if (replacedFragment)
replacedFragment.remove();
}
return this;
};
_.unwrapGramp = function () {
var gramp = this.parent.parent;
var greatgramp = gramp.parent;
var next = gramp.next;
var cursor = this;
var prev = gramp.prev;
gramp.disown().eachChild(function (uncle) {
if (uncle.isEmpty()) return;
uncle.children()
.adopt(greatgramp, prev, next)
.each(function (cousin) {
cousin.jQ.insertBefore(gramp.jQ.first());
})
;
prev = uncle.lastChild;
});
if (!this.next) {
if (this.prev)
this.next = this.prev.next;
else {
while (!this.next) {
this.parent = this.parent.next;
if (this.parent)
this.next = this.parent.firstChild;
else {
this.next = gramp.next;
this.parent = greatgramp;
break;
}
}
}
}
if (this.next)
this.insertBefore(this.next);
else
this.appendTo(greatgramp);
gramp.jQ.remove();
if (gramp.prev)
gramp.prev.respace();
if (gramp.next)
gramp.next.respace();
};
_.backspace = function () {
clearUpDownCache(this);
this.show();
if (this.deleteSelection());
else if (this.prev) {
if (this.prev.isEmpty()) {
if (this.prev.ctrlSeq === '\\le ') var ins = LatexCmds['<']('<');
else if (this.prev.ctrlSeq === '\\ge ') var ins = LatexCmds['>']('>');
this.prev = this.prev.remove().prev;
if (ins) this.insertNew(ins);
}
else if (this.prev instanceof Bracket)
return this.appendTo(this.prev.firstChild).deleteForward();
else
this.selectLeft();
}
else if (this.parent !== this.root) {
if (this.parent.parent.isEmpty())
return this.insertAfter(this.parent.parent).backspace();
else if (this.next instanceof Bracket)
return this.prependTo(this.next.firstChild).backspace();
else
this.unwrapGramp();
}
else this.root.triggerSpecialEvent('backspacePressed');
if (this.prev)
this.prev.respace();
if (this.next)
this.next.respace();
this.parent.bubble('redraw');
return this;
};
_.deleteForward = function () {
clearUpDownCache(this);
this.show();
if (this.deleteSelection());
else if (this.next) {
if (this.next.isEmpty())
this.next = this.next.remove().next;
else
this.selectRight();
}
else if (this.parent !== this.root) {
if (this.parent.parent.isEmpty())
return this.insertBefore(this.parent.parent).deleteForward();
else
this.unwrapGramp();
}
else this.root.triggerSpecialEvent('delPressed');
if (this.prev)
this.prev.respace();
if (this.next)
this.next.respace();
this.parent.bubble('redraw');
return this;
};
_.selectFrom = function (anticursor) {
var oneA = this, otherA = anticursor;
loopThroughAncestors: do {
for (var oneI = this; oneI !== oneA.parent.parent; oneI = oneI.parent.parent)
if (oneI.parent === otherA.parent) {
left = oneI;
right = otherA;
break loopThroughAncestors;
}
for (var otherI = anticursor; otherI !== otherA.parent.parent; otherI = otherI.parent.parent)
if (oneA.parent === otherI.parent) {
left = oneA;
right = otherI;
break loopThroughAncestors;
}
if (oneA.parent.parent)
oneA = oneA.parent.parent;
if (otherA.parent.parent)
otherA = otherA.parent.parent;
} while (oneA.parent.parent || otherA.parent.parent || oneA.parent === otherA.parent);
pray('cursor and anticursor are in the same tree',
oneA.parent.parent || otherA.parent.parent || oneA.parent === otherA.parent);
var left, right, leftRight;
if (left.next !== right) {
for (var next = left; next; next = next.next) {
if (next === right.prev) {
leftRight = true;
break;
}
}
if (!leftRight) {
leftRight = right;
right = left;
left = leftRight;
}
}
this.hide().selection = Selection(left.prev.next || left.parent.firstChild, right.next.prev || right.parent.lastChild);
this.insertAfter(right.next.prev || right.parent.lastChild);
this.root.selectionChanged();
};
_.selectLeft = function () {
clearUpDownCache(this);
if (this.selection) {
if (this.selection.first === this.next) {
if (this.prev)
this.hopLeft().selection.extendLeft();
else if (this.parent !== this.root)
this.insertBefore(this.parent.parent).selection.levelUp();
}
else {
this.hopLeft();
if (this.selection.first === this.selection.last) {
this.clearSelection().show();
return;
}
this.selection.retractLeft();
}
}
else {
if (this.prev)
this.hopLeft();
else
if (this.parent !== this.root)
this.insertBefore(this.parent.parent);
else
return;
this.hide().selection = Selection(this.next);
}
this.root.selectionChanged();
};
_.selectRight = function () {
clearUpDownCache(this);
if (this.selection) {
if (this.selection.last === this.prev) {
if (this.next)
this.hopRight().selection.extendRight();
else if (this.parent !== this.root)
this.insertAfter(this.parent.parent).selection.levelUp();
}
else {
this.hopRight();
if (this.selection.first === this.selection.last) {
this.clearSelection().show();
return;
}
this.selection.retractRight();
}
}
else {
if (this.next)
this.hopRight();
else
if (this.parent !== this.root)
this.insertAfter(this.parent.parent);
else
return;
this.hide().selection = Selection(this.prev);
}
this.root.selectionChanged();
};
function clearUpDownCache(self) {
self.upDownCache = {};
}
_.prepareMove = function () {
clearUpDownCache(this);
return this.show().clearSelection();
};
_.prepareEdit = function () {
clearUpDownCache(this);
return this.show().deleteSelection();
}
_.clearSelection = function () {
if (this.selection) {
this.selection.clear();
delete this.selection;
this.root.selectionChanged();
}
return this;
};
_.deleteSelection = function () {
if (!this.selection) return false;
this.prev = this.selection.first.prev;
this.next = this.selection.last.next;
this.selection.remove();
this.root.selectionChanged();
return delete this.selection;
};
});
var Selection = P(MathFragment, function (_, _super) {
_.init = function () {
var frag = this;
_super.init.apply(frag, arguments);
frag.jQwrap(frag.jQ);
};
_.jQwrap = function (children) {
this.jQ = children.wrapAll('<span class="mq-selection"></span>').parent();
};
_.adopt = function () {
this.jQ.replaceWith(this.jQ = this.jQ.children());
return _super.adopt.apply(this, arguments);
};
_.clear = function () {
this.jQ.replaceWith(this.jQ.children());
return this;
};
_.levelUp = function () {
var seln = this,
gramp = seln.first = seln.last = seln.last.parent.parent;
seln.clear().jQwrap(gramp.jQ);
return seln;
};
_.extendLeft = function () {
this.first = this.first.prev;
this.first.jQ.prependTo(this.jQ);
};
_.extendRight = function () {
this.last = this.last.next;
this.last.jQ.appendTo(this.jQ);
};
_.retractRight = function () {
this.first.jQ.insertBefore(this.jQ);
this.first = this.first.next;
};
_.retractLeft = function () {
this.last.jQ.insertAfter(this.jQ);
this.last = this.last.prev;
};
});
$.fn.mathquill = function (cmd, latex) {
switch (cmd) {
case 'focus':
case 'blur':
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
if (block && block.textarea)
block.textarea.children().trigger(cmd);
});
case 'onKey':
case 'onText':
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor) {
cursor.parent.bubble(cmd, latex, { preventDefault: noop });
if (block.blurred) cursor.hide().parent.blur();
}
});
case 'redraw':
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
rootBlock = blockId && MathElement[blockId];
if (rootBlock) {
(function postOrderRedraw(el) {
el.eachChild(postOrderRedraw);
if (el.redraw) el.redraw();
}(rootBlock));
}
});
case 'revert':
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
if (block && block.revert)
block.revert();
});
case 'sliderLatex':
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
if (block) {
cursor = block && block.cursor;
if (cursor) cursor.clearSelection();
block.renderSliderLatex(latex);
block.triggerSpecialEvent('render');
}
});
case 'latex':
if (arguments.length > 1) {
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
if (block) {
cursor = block && block.cursor;
if (cursor) cursor.clearSelection();
block.renderLatex(latex);
block.triggerSpecialEvent('render');
}
});
}
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
return block && block.latex();
case 'mqLatex':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
return block && block.mqLatex();
case 'text':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
return block && block.text();
case 'html':
return this.children('.mathquill-root-block').html().replace(/ ?mq-hasCursor|mq-hasCursor /, '')
.replace(/ class=(""|(?= |>))/g, '')
.replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i, '');
case 'write':
if (arguments.length > 1)
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor) {
cursor.writeLatex(latex);
if (block.blurred) cursor.hide().parent.blur();
}
});
case 'cmd':
if (arguments.length > 1)
var overrideRestrictForCh = arguments[2] || false;
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor) {
if (/^\\[a-z]+$/i.test(latex)) {
var selection = cursor.selection;
if (selection) {
cursor.prev = selection.first.prev;
cursor.next = selection.last.next;
delete cursor.selection;
}
cursor.insertCmd(latex.slice(1), selection);
} else
cursor.insertCh(latex, overrideRestrictForCh);
if (block.blurred) cursor.hide().parent.blur();
}
});
case 'restrictContentKeys':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor && typeof cursor.restrictContentKeys == 'undefined')
cursor.restrictContentKeys = latex;
break;
case 'mathOperatorOverride':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor && typeof cursor.overridenOperators == 'undefined') {
cursor.overridenOperators = {};
if (latex && latex.length > 0) {
$(latex).each(function (index, element) {
var operators = element.split('|');
if (operators.length = 2) {
cursor.overridenOperators[operators[0]] = operators[1];
}
});
}
}
break;
case 'touchtap':
var touchstartTarget = arguments[1], x = arguments[2], y = arguments[3];
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor && touchstartTarget !== cursor.handle[0]) {
var wasBlurred = block.blurred;
block.textarea.children().focus();
cursor.seek(elAtPt(x, y, block), x, y, cachedClientRectFnForNewCache(), true);
if (!wasBlurred) cursor.showHandle();
}
});
case 'ignoreNextMousedown':
var time = arguments[1];
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
if (block) {
block.ignoreMousedownTimeout = setTimeout(function () {
block.ignoreMousedownTimeout = undefined;
}, time);
}
});
case 'moveStart':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
if (block && block.cursor)
block.cursor.prependTo(block);
break;
case 'moveEnd':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId];
if (block && block.cursor)
block.cursor.appendTo(block);
break;
case 'isAtStart':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor) return cursor.parent === cursor.root && !cursor.prev;
break;
case 'isAtEnd':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor) return cursor.parent === cursor.root && !cursor.next;
break;
case 'selection':
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (!cursor) return;
return cursor.selection ? '$' + cursor.selection.latex() + '$' : '';
case 'clearSelection':
return this.each(function () {
var blockId = $(this).attr(mqBlockId),
block = blockId && MathElement[blockId],
cursor = block && block.cursor;
if (cursor) {
cursor.clearSelection();
if (block.blurred) cursor.hide().parent.blur();
}
});
default:
var textbox = cmd === 'textbox',
editable = textbox || cmd === 'editable',
RootBlock = textbox ? RootTextBlock : RootMathBlock;
return this.each(function () {
var container = $(this), root = RootBlock();
createRoot(container, root, textbox, editable);
var cursor = root.cursor;
var textarea = setupTextarea(editable, container, root, cursor);
var textareaSpan = root.textarea;
root.editable = editable;
mouseEvents(container);
setupTouchHandle(editable, root, cursor);
if (!editable) return;
rootCSSClasses(container, textbox);
focusBlurEvents(root, cursor, textarea);
desmosCustomEvents(container, root, cursor);
});
}
};
}());
var checkForMathML = true;
var notifyIfNoMathML = true;
var alertIfNoMathML = false;
var mathcolor = "";
var mathfontfamily = "";
var showasciiformulaonhover = true;
var isIE = document.createElementNS == null;
if (document.getElementById == null)
alert("This webpage requires a recent browser such as\
\nMozilla/Netscape 7+ or Internet Explorer 6+MathPlayer")
function AMcreateElementXHTML(t) {
if (isIE) return document.createElement(t);
else return document.createElementNS("http://www.w3.org/1999/xhtml", t);
}
function AMnoMathMLNote() {
var nd = AMcreateElementXHTML("h3");
nd.setAttribute("align", "center")
nd.appendChild(AMcreateElementXHTML("p"));
nd.appendChild(document.createTextNode("To view the "));
var an = AMcreateElementXHTML("a");
an.appendChild(document.createTextNode("LaTeXMathML"));
an.setAttribute("href", "http://www.maths.nott.ac.uk/personal/drw/lm.html");
nd.appendChild(an);
nd.appendChild(document.createTextNode(" notation use Internet Explorer 6+"));
an = AMcreateElementXHTML("a");
an.appendChild(document.createTextNode("MathPlayer"));
an.setAttribute("href", "http://www.dessci.com/en/products/mathplayer/download.htm");
nd.appendChild(an);
nd.appendChild(document.createTextNode(" or Netscape/Mozilla/Firefox"));
nd.appendChild(AMcreateElementXHTML("p"));
return nd;
}
function AMisMathMLavailable() {
if (navigator.appName.slice(0, 8) == "Netscape")
if (navigator.appVersion.slice(0, 1) >= "5") return null;
else return AMnoMathMLNote();
else if (navigator.appName.slice(0, 9) == "Microsoft")
try {
var ActiveX = new ActiveXObject("MathPlayer.Factory.1");
return null;
} catch (e) {
return AMnoMathMLNote();
}
else return AMnoMathMLNote();
}
var AMcal = [0xEF35, 0x212C, 0xEF36, 0xEF37, 0x2130, 0x2131, 0xEF38, 0x210B, 0x2110, 0xEF39, 0xEF3A, 0x2112, 0x2133, 0xEF3B, 0xEF3C, 0xEF3D, 0xEF3E, 0x211B, 0xEF3F, 0xEF40, 0xEF41, 0xEF42, 0xEF43, 0xEF44, 0xEF45, 0xEF46];
var AMfrk = [0xEF5D, 0xEF5E, 0x212D, 0xEF5F, 0xEF60, 0xEF61, 0xEF62, 0x210C, 0x2111, 0xEF63, 0xEF64, 0xEF65, 0xEF66, 0xEF67, 0xEF68, 0xEF69, 0xEF6A, 0x211C, 0xEF6B, 0xEF6C, 0xEF6D, 0xEF6E, 0xEF6F, 0xEF70, 0xEF71, 0x2128];
var AMbbb = [0xEF8C, 0xEF8D, 0x2102, 0xEF8E, 0xEF8F, 0xEF90, 0xEF91, 0x210D, 0xEF92, 0xEF93, 0xEF94, 0xEF95, 0xEF96, 0x2115, 0xEF97, 0x2119, 0x211A, 0x211D, 0xEF98, 0xEF99, 0xEF9A, 0xEF9B, 0xEF9C, 0xEF9D, 0xEF9E, 0x2124];
var CONST = 0, UNARY = 1, BINARY = 2, INFIX = 3, LEFTBRACKET = 4,
RIGHTBRACKET = 5, SPACE = 6, UNDEROVER = 7, DEFINITION = 8,
TEXT = 9, BIG = 10, LONG = 11, STRETCHY = 12, MATRIX = 13;
var AMsqrt = { input: "\\sqrt", tag: "msqrt", output: "sqrt", ttype: UNARY },
AMroot = { input: "\\root", tag: "mroot", output: "root", ttype: BINARY },
AMfrac = { input: "\\frac", tag: "mfrac", output: "/", ttype: BINARY },
AMover = { input: "\\stackrel", tag: "mover", output: "stackrel", ttype: BINARY },
AMatop = { input: "\\atop", tag: "mfrac", output: "", ttype: INFIX },
AMchoose = { input: "\\choose", tag: "mfrac", output: "", ttype: INFIX },
AMsub = { input: "_", tag: "msub", output: "_", ttype: INFIX },
AMsup = { input: "^", tag: "msup", output: "^", ttype: INFIX },
AMtext = { input: "\\mathrm", tag: "mtext", output: "text", ttype: TEXT },
AMmbox = { input: "\\mbox", tag: "mtext", output: "mbox", ttype: TEXT };
var AMsymbols = [
{ input: "\\alpha", tag: "mi", output: "\u03B1", ttype: CONST },
{ input: "\\beta", tag: "mi", output: "\u03B2", ttype: CONST },
{ input: "\\gamma", tag: "mi", output: "\u03B3", ttype: CONST },
{ input: "\\delta", tag: "mi", output: "\u03B4", ttype: CONST },
{ input: "\\epsilon", tag: "mi", output: "\u03B5", ttype: CONST },
{ input: "\\varepsilon", tag: "mi", output: "\u025B", ttype: CONST },
{ input: "\\zeta", tag: "mi", output: "\u03B6", ttype: CONST },
{ input: "\\eta", tag: "mi", output: "\u03B7", ttype: CONST },
{ input: "\\theta", tag: "mi", output: "\u03B8", ttype: CONST },
{ input: "\\vartheta", tag: "mi", output: "\u03D1", ttype: CONST },
{ input: "\\iota", tag: "mi", output: "\u03B9", ttype: CONST },
{ input: "\\kappa", tag: "mi", output: "\u03BA", ttype: CONST },
{ input: "\\lambda", tag: "mi", output: "\u03BB", ttype: CONST },
{ input: "\\mu", tag: "mi", output: "\u03BC", ttype: CONST },
{ input: "\\nu", tag: "mi", output: "\u03BD", ttype: CONST },
{ input: "\\xi", tag: "mi", output: "\u03BE", ttype: CONST },
{ input: "\\pi", tag: "mi", output: "\u03C0", ttype: CONST },
{ input: "\\varpi", tag: "mi", output: "\u03D6", ttype: CONST },
{ input: "\\rho", tag: "mi", output: "\u03C1", ttype: CONST },
{ input: "\\varrho", tag: "mi", output: "\u03F1", ttype: CONST },
{ input: "\\varsigma", tag: "mi", output: "\u03C2", ttype: CONST },
{ input: "\\sigma", tag: "mi", output: "\u03C3", ttype: CONST },
{ input: "\\tau", tag: "mi", output: "\u03C4", ttype: CONST },
{ input: "\\upsilon", tag: "mi", output: "\u03C5", ttype: CONST },
{ input: "\\phi", tag: "mi", output: "\u03C6", ttype: CONST },
{ input: "\\varphi", tag: "mi", output: "\u03D5", ttype: CONST },
{ input: "\\chi", tag: "mi", output: "\u03C7", ttype: CONST },
{ input: "\\psi", tag: "mi", output: "\u03C8", ttype: CONST },
{ input: "\\omega", tag: "mi", output: "\u03C9", ttype: CONST },
{ input: "\\Gamma", tag: "mo", output: "\u0393", ttype: CONST },
{ input: "\\Delta", tag: "mo", output: "\u0394", ttype: CONST },
{ input: "\\Theta", tag: "mo", output: "\u0398", ttype: CONST },
{ input: "\\Lambda", tag: "mo", output: "\u039B", ttype: CONST },
{ input: "\\Xi", tag: "mo", output: "\u039E", ttype: CONST },
{ input: "\\Pi", tag: "mo", output: "\u03A0", ttype: CONST },
{ input: "\\Sigma", tag: "mo", output: "\u03A3", ttype: CONST },
{ input: "\\Upsilon", tag: "mo", output: "\u03A5", ttype: CONST },
{ input: "\\Phi", tag: "mo", output: "\u03A6", ttype: CONST },
{ input: "\\Psi", tag: "mo", output: "\u03A8", ttype: CONST },
{ input: "\\Omega", tag: "mo", output: "\u03A9", ttype: CONST },
{ input: "\\frac12", tag: "mo", output: "\u00BD", ttype: CONST },
{ input: "\\frac14", tag: "mo", output: "\u00BC", ttype: CONST },
{ input: "\\frac34", tag: "mo", output: "\u00BE", ttype: CONST },
{ input: "\\frac13", tag: "mo", output: "\u2153", ttype: CONST },
{ input: "\\frac23", tag: "mo", output: "\u2154", ttype: CONST },
{ input: "\\frac15", tag: "mo", output: "\u2155", ttype: CONST },
{ input: "\\frac25", tag: "mo", output: "\u2156", ttype: CONST },
{ input: "\\frac35", tag: "mo", output: "\u2157", ttype: CONST },
{ input: "\\frac45", tag: "mo", output: "\u2158", ttype: CONST },
{ input: "\\frac16", tag: "mo", output: "\u2159", ttype: CONST },
{ input: "\\frac56", tag: "mo", output: "\u215A", ttype: CONST },
{ input: "\\frac18", tag: "mo", output: "\u215B", ttype: CONST },
{ input: "\\frac38", tag: "mo", output: "\u215C", ttype: CONST },
{ input: "\\frac58", tag: "mo", output: "\u215D", ttype: CONST },
{ input: "\\frac78", tag: "mo", output: "\u215E", ttype: CONST },
{ input: "\\pm", tag: "mo", output: "\u00B1", ttype: CONST },
{ input: "\\mp", tag: "mo", output: "\u2213", ttype: CONST },
{ input: "\\triangleleft", tag: "mo", output: "\u22B2", ttype: CONST },
{ input: "\\triangleright", tag: "mo", output: "\u22B3", ttype: CONST },
{ input: "\\cdot", tag: "mo", output: "\u22C5", ttype: CONST },
{ input: "\\star", tag: "mo", output: "\u22C6", ttype: CONST },
{ input: "\\ast", tag: "mo", output: "\u002A", ttype: CONST },
{ input: "\\times", tag: "mo", output: "\u00D7", ttype: CONST },
{ input: "\\div", tag: "mo", output: "\u00F7", ttype: CONST },
{ input: "\\circ", tag: "mo", output: "\u2218", ttype: CONST },
{input:"\\bullet",   tag:"mo", output:"\u2219", ttype:CONST},
{ input: "\\oplus", tag: "mo", output: "\u2295", ttype: CONST },
{ input: "\\ominus", tag: "mo", output: "\u2296", ttype: CONST },
{ input: "\\otimes", tag: "mo", output: "\u2297", ttype: CONST },
{ input: "\\bigcirc", tag: "mo", output: "\u25CB", ttype: CONST },
{ input: "\\oslash", tag: "mo", output: "\u2298", ttype: CONST },
{ input: "\\odot", tag: "mo", output: "\u2299", ttype: CONST },
{ input: "\\land", tag: "mo", output: "\u2227", ttype: CONST },
{ input: "\\wedge", tag: "mo", output: "\u2227", ttype: CONST },
{ input: "\\lor", tag: "mo", output: "\u2228", ttype: CONST },
{ input: "\\vee", tag: "mo", output: "\u2228", ttype: CONST },
{ input: "\\cap", tag: "mo", output: "\u2229", ttype: CONST },
{ input: "\\cup", tag: "mo", output: "\u222A", ttype: CONST },
{ input: "\\sqcap", tag: "mo", output: "\u2293", ttype: CONST },
{ input: "\\sqcup", tag: "mo", output: "\u2294", ttype: CONST },
{ input: "\\uplus", tag: "mo", output: "\u228E", ttype: CONST },
{ input: "\\amalg", tag: "mo", output: "\u2210", ttype: CONST },
{ input: "\\bigtriangleup", tag: "mo", output: "\u25B3", ttype: CONST },
{ input: "\\bigtriangledown", tag: "mo", output: "\u25BD", ttype: CONST },
{ input: "\\dag", tag: "mo", output: "\u2020", ttype: CONST },
{ input: "\\dagger", tag: "mo", output: "\u2020", ttype: CONST },
{ input: "\\ddag", tag: "mo", output: "\u2021", ttype: CONST },
{ input: "\\ddagger", tag: "mo", output: "\u2021", ttype: CONST },
{ input: "\\lhd", tag: "mo", output: "\u22B2", ttype: CONST },
{ input: "\\rhd", tag: "mo", output: "\u22B3", ttype: CONST },
{ input: "\\unlhd", tag: "mo", output: "\u22B4", ttype: CONST },
{ input: "\\unrhd", tag: "mo", output: "\u22B5", ttype: CONST },
{ input: "\\sum", tag: "mo", output: "\u2211", ttype: UNDEROVER },
{ input: "\\prod", tag: "mo", output: "\u220F", ttype: UNDEROVER },
{ input: "\\bigcap", tag: "mo", output: "\u22C2", ttype: UNDEROVER },
{ input: "\\bigcup", tag: "mo", output: "\u22C3", ttype: UNDEROVER },
{ input: "\\bigwedge", tag: "mo", output: "\u22C0", ttype: UNDEROVER },
{ input: "\\bigvee", tag: "mo", output: "\u22C1", ttype: UNDEROVER },
{ input: "\\bigsqcap", tag: "mo", output: "\u2A05", ttype: UNDEROVER },
{ input: "\\bigsqcup", tag: "mo", output: "\u2A06", ttype: UNDEROVER },
{ input: "\\coprod", tag: "mo", output: "\u2210", ttype: UNDEROVER },
{ input: "\\bigoplus", tag: "mo", output: "\u2A01", ttype: UNDEROVER },
{ input: "\\bigotimes", tag: "mo", output: "\u2A02", ttype: UNDEROVER },
{ input: "\\bigodot", tag: "mo", output: "\u2A00", ttype: UNDEROVER },
{ input: "\\biguplus", tag: "mo", output: "\u2A04", ttype: UNDEROVER },
{ input: "\\int", tag: "mo", output: "\u222B", ttype: UNDEROVER },
{ input: "\\oint", tag: "mo", output: "\u222E", ttype: CONST },
{ input: ":=", tag: "mo", output: ":=", ttype: CONST },
{ input: "\\lt", tag: "mo", output: "<", ttype: CONST },
{ input: "\\gt", tag: "mo", output: ">", ttype: CONST },
{ input: "\\ne", tag: "mo", output: "\u2260", ttype: CONST },
{ input: "\\neq", tag: "mo", output: "\u2260", ttype: CONST },
{ input: "\\le", tag: "mo", output: "\u2264", ttype: CONST },
{ input: "\\leq", tag: "mo", output: "\u2264", ttype: CONST },
{ input: "\\leqslant", tag: "mo", output: "\u2264", ttype: CONST },
{ input: "\\ge", tag: "mo", output: "\u2265", ttype: CONST },
{ input: "\\geq", tag: "mo", output: "\u2265", ttype: CONST },
{ input: "\\geqslant", tag: "mo", output: "\u2265", ttype: CONST },
{ input: "\\equiv", tag: "mo", output: "\u2261", ttype: CONST },
{ input: "\\ll", tag: "mo", output: "\u226A", ttype: CONST },
{ input: "\\gg", tag: "mo", output: "\u226B", ttype: CONST },
{ input: "\\doteq", tag: "mo", output: "\u2250", ttype: CONST },
{ input: "\\prec", tag: "mo", output: "\u227A", ttype: CONST },
{ input: "\\succ", tag: "mo", output: "\u227B", ttype: CONST },
{ input: "\\preceq", tag: "mo", output: "\u227C", ttype: CONST },
{ input: "\\succeq", tag: "mo", output: "\u227D", ttype: CONST },
{ input: "\\subset", tag: "mo", output: "\u2282", ttype: CONST },
{ input: "\\supset", tag: "mo", output: "\u2283", ttype: CONST },
{ input: "\\subseteq", tag: "mo", output: "\u2286", ttype: CONST },
{ input: "\\supseteq", tag: "mo", output: "\u2287", ttype: CONST },
{ input: "\\sqsubset", tag: "mo", output: "\u228F", ttype: CONST },
{ input: "\\sqsupset", tag: "mo", output: "\u2290", ttype: CONST },
{ input: "\\sqsubseteq", tag: "mo", output: "\u2291", ttype: CONST },
{ input: "\\sqsupseteq", tag: "mo", output: "\u2292", ttype: CONST },
{ input: "\\sim", tag: "mo", output: "\u223C", ttype: CONST },
{ input: "\\simeq", tag: "mo", output: "\u2243", ttype: CONST },
{ input: "\\approx", tag: "mo", output: "\u2248", ttype: CONST },
{ input: "\\cong", tag: "mo", output: "\u2245", ttype: CONST },
{ input: "\\Join", tag: "mo", output: "\u22C8", ttype: CONST },
{ input: "\\bowtie", tag: "mo", output: "\u22C8", ttype: CONST },
{ input: "\\in", tag: "mo", output: "\u2208", ttype: CONST },
{ input: "\\ni", tag: "mo", output: "\u220B", ttype: CONST },
{ input: "\\owns", tag: "mo", output: "\u220B", ttype: CONST },
{ input: "\\propto", tag: "mo", output: "\u221D", ttype: CONST },
{ input: "\\vdash", tag: "mo", output: "\u22A2", ttype: CONST },
{ input: "\\dashv", tag: "mo", output: "\u22A3", ttype: CONST },
{ input: "\\models", tag: "mo", output: "\u22A8", ttype: CONST },
{ input: "\\perp", tag: "mo", output: "\u22A5", ttype: CONST },
{ input: "\\smile", tag: "mo", output: "\u2323", ttype: CONST },
{ input: "\\frown", tag: "mo", output: "\u2322", ttype: CONST },
{ input: "\\asymp", tag: "mo", output: "\u224D", ttype: CONST },
{ input: "\\notin", tag: "mo", output: "\u2209", ttype: CONST },
{ input: "\\begin{eqnarray}", output: "X", ttype: MATRIX, invisible: true },
{ input: "\\begin{array}", output: "X", ttype: MATRIX, invisible: true },
{ input: "\\\\", output: "}&{", ttype: DEFINITION },
{ input: "\\end{eqnarray}", output: "}}", ttype: DEFINITION },
{ input: "\\end{array}", output: "}}", ttype: DEFINITION },
{ input: "\\big", tag: "mo", output: "X", atval: "1.2", ieval: "2.2", ttype: BIG },
{ input: "\\Big", tag: "mo", output: "X", atval: "1.6", ieval: "2.6", ttype: BIG },
{ input: "\\bigg", tag: "mo", output: "X", atval: "2.2", ieval: "3.2", ttype: BIG },
{ input: "\\Bigg", tag: "mo", output: "X", atval: "2.9", ieval: "3.9", ttype: BIG },
{ input: "\\left", tag: "mo", output: "X", ttype: LEFTBRACKET },
{ input: "\\right", tag: "mo", output: "X", ttype: RIGHTBRACKET },
{ input: "{", output: "{", ttype: LEFTBRACKET, invisible: true },
{ input: "}", output: "}", ttype: RIGHTBRACKET, invisible: true },
{ input: "(", tag: "mo", output: "(", atval: "1", ttype: STRETCHY },
{ input: "[", tag: "mo", output: "[", atval: "1", ttype: STRETCHY },
{ input: "\\lbrack", tag: "mo", output: "[", atval: "1", ttype: STRETCHY },
{ input: "\\{", tag: "mo", output: "{", atval: "1", ttype: STRETCHY },
{ input: "\\lbrace", tag: "mo", output: "{", atval: "1", ttype: STRETCHY },
{ input: "\\langle", tag: "mo", output: "\u2329", atval: "1", ttype: STRETCHY },
{ input: "\\lfloor", tag: "mo", output: "\u230A", atval: "1", ttype: STRETCHY },
{ input: "\\lceil", tag: "mo", output: "\u2308", atval: "1", ttype: STRETCHY },
{ input: ")", tag: "mo", output: ")", rtag: "mi", atval: "1", ttype: STRETCHY },
{ input: "]", tag: "mo", output: "]", rtag: "mi", atval: "1", ttype: STRETCHY },
{ input: "\\rbrack", tag: "mo", output: "]", rtag: "mi", atval: "1", ttype: STRETCHY },
{ input: "\\}", tag: "mo", output: "}", rtag: "mi", atval: "1", ttype: STRETCHY },
{ input: "\\rbrace", tag: "mo", output: "}", rtag: "mi", atval: "1", ttype: STRETCHY },
{ input: "\\rangle", tag: "mo", output: "\u232A", rtag: "mi", atval: "1", ttype: STRETCHY },
{ input: "\\rfloor", tag: "mo", output: "\u230B", rtag: "mi", atval: "1", ttype: STRETCHY },
{ input: "\\rceil", tag: "mo", output: "\u2309", rtag: "mi", atval: "1", ttype: STRETCHY },
{ input: "|", tag: "mo", output: "\u2223", atval: "1", ttype: STRETCHY },
{ input: "\\|", tag: "mo", output: "\u2225", atval: "1", ttype: STRETCHY },
{ input: "\\vert", tag: "mo", output: "\u2223", atval: "1", ttype: STRETCHY },
{ input: "\\Vert", tag: "mo", output: "\u2225", atval: "1", ttype: STRETCHY },
{ input: "\\mid", tag: "mo", output: "\u2223", atval: "1", ttype: STRETCHY },
{ input: "\\parallel", tag: "mo", output: "\u2225", atval: "1", ttype: STRETCHY },
{ input: "/", tag: "mo", output: "/", atval: "1.01", ttype: STRETCHY },
{ input: "\\backslash", tag: "mo", output: "\u2216", atval: "1", ttype: STRETCHY },
{ input: "\\setminus", tag: "mo", output: "\\", ttype: CONST },
{ input: "\\!", tag: "mspace", atname: "width", atval: "-0.167em", ttype: SPACE },
{ input: "\\,", tag: "mspace", atname: "width", atval: "0.167em", ttype: SPACE },
{ input: "\\>", tag: "mspace", atname: "width", atval: "0.222em", ttype: SPACE },
{ input: "\\:", tag: "mspace", atname: "width", atval: "0.222em", ttype: SPACE },
{ input: "\\;", tag: "mspace", atname: "width", atval: "0.278em", ttype: SPACE },
{ input: "~", tag: "mspace", atname: "width", atval: "0.333em", ttype: SPACE },
{ input: "\\quad", tag: "mspace", atname: "width", atval: "1em", ttype: SPACE },
{ input: "\\qquad", tag: "mspace", atname: "width", atval: "2em", ttype: SPACE },
{ input: "\\prime", tag: "mo", output: "\u2032", ttype: CONST },
{ input: "'", tag: "mo", output: "\u02B9", ttype: CONST },
{ input: "''", tag: "mo", output: "\u02BA", ttype: CONST },
{ input: "'''", tag: "mo", output: "\u2034", ttype: CONST },
{ input: "''''", tag: "mo", output: "\u2057", ttype: CONST },
{ input: "\\ldots", tag: "mo", output: "\u2026", ttype: CONST },
{ input: "\\cdots", tag: "mo", output: "\u22EF", ttype: CONST },
{ input: "\\vdots", tag: "mo", output: "\u22EE", ttype: CONST },
{ input: "\\ddots", tag: "mo", output: "\u22F1", ttype: CONST },
{ input: "\\forall", tag: "mo", output: "\u2200", ttype: CONST },
{ input: "\\exists", tag: "mo", output: "\u2203", ttype: CONST },
{ input: "\\Re", tag: "mo", output: "\u211C", ttype: CONST },
{ input: "\\Im", tag: "mo", output: "\u2111", ttype: CONST },
{ input: "\\aleph", tag: "mo", output: "\u2135", ttype: CONST },
{ input: "\\hbar", tag: "mo", output: "\u210F", ttype: CONST },
{ input: "\\ell", tag: "mo", output: "\u2113", ttype: CONST },
{ input: "\\wp", tag: "mo", output: "\u2118", ttype: CONST },
{ input: "\\emptyset", tag: "mo", output: "\u2205", ttype: CONST },
{ input: "\\infty", tag: "mo", output: "\u221E", ttype: CONST },
{ input: "\\surd", tag: "mo", output: "\\sqrt{}", ttype: DEFINITION },
{ input: "\\partial", tag: "mo", output: "\u2202", ttype: CONST },
{ input: "\\nabla", tag: "mo", output: "\u2207", ttype: CONST },
{ input: "\\triangle", tag: "mo", output: "\u25B3", ttype: CONST },
{ input: "\\therefore", tag: "mo", output: "\u2234", ttype: CONST },
{ input: "\\angle", tag: "mo", output: "\u2220", ttype: CONST },
{ input: "\\diamond", tag: "mo", output: "\u22C4", ttype: CONST },
{ input: "\\Diamond", tag: "mo", output: "\u25C7", ttype: CONST },
{ input: "\\neg", tag: "mo", output: "\u00AC", ttype: CONST },
{ input: "\\lnot", tag: "mo", output: "\u00AC", ttype: CONST },
{ input: "\\bot", tag: "mo", output: "\u22A5", ttype: CONST },
{ input: "\\top", tag: "mo", output: "\u22A4", ttype: CONST },
{ input: "\\square", tag: "mo", output: "\u25AB", ttype: CONST },
{ input: "\\Box", tag: "mo", output: "\u25A1", ttype: CONST },
{ input: "\\wr", tag: "mo", output: "\u2240", ttype: CONST },
{ input: "\\arccos", tag: "mi", output: "arccos", ttype: UNARY, func: true },
{ input: "\\arcsin", tag: "mi", output: "arcsin", ttype: UNARY, func: true },
{ input: "\\arctan", tag: "mi", output: "arctan", ttype: UNARY, func: true },
{ input: "\\arg", tag: "mi", output: "arg", ttype: UNARY, func: true },
{ input: "\\cos", tag: "mi", output: "cos", ttype: UNARY, func: true },
{ input: "\\cosh", tag: "mi", output: "cosh", ttype: UNARY, func: true },
{ input: "\\cot", tag: "mi", output: "cot", ttype: UNARY, func: true },
{ input: "\\coth", tag: "mi", output: "coth", ttype: UNARY, func: true },
{ input: "\\csc", tag: "mi", output: "csc", ttype: UNARY, func: true },
{ input: "\\deg", tag: "mi", output: "deg", ttype: UNARY, func: true },
{ input: "\\det", tag: "mi", output: "det", ttype: UNARY, func: true },
{ input: "\\dim", tag: "mi", output: "dim", ttype: UNARY, func: true },
{ input: "\\exp", tag: "mi", output: "exp", ttype: UNARY, func: true },
{ input: "\\gcd", tag: "mi", output: "gcd", ttype: UNARY, func: true },
{ input: "\\hom", tag: "mi", output: "hom", ttype: UNARY, func: true },
{ input: "\\inf", tag: "mo", output: "inf", ttype: UNDEROVER },
{ input: "\\ker", tag: "mi", output: "ker", ttype: UNARY, func: true },
{ input: "\\lg", tag: "mi", output: "lg", ttype: UNARY, func: true },
{ input: "\\lim", tag: "mo", output: "lim", ttype: UNDEROVER },
{ input: "\\liminf", tag: "mo", output: "liminf", ttype: UNDEROVER },
{ input: "\\limsup", tag: "mo", output: "limsup", ttype: UNDEROVER },
{ input: "\\ln", tag: "mi", output: "ln", ttype: UNARY, func: true },
{ input: "\\log", tag: "mi", output: "log", ttype: UNARY, func: true },
{ input: "\\max", tag: "mo", output: "max", ttype: UNDEROVER },
{ input: "\\min", tag: "mo", output: "min", ttype: UNDEROVER },
{ input: "\\Pr", tag: "mi", output: "Pr", ttype: UNARY, func: true },
{ input: "\\sec", tag: "mi", output: "sec", ttype: UNARY, func: true },
{ input: "\\sin", tag: "mi", output: "sin", ttype: UNARY, func: true },
{ input: "\\sinh", tag: "mi", output: "sinh", ttype: UNARY, func: true },
{ input: "\\sup", tag: "mo", output: "sup", ttype: UNDEROVER },
{ input: "\\tan", tag: "mi", output: "tan", ttype: UNARY, func: true },
{ input: "\\tanh", tag: "mi", output: "tanh", ttype: UNARY, func: true },
{ input: "\\gets", tag: "mo", output: "\u2190", ttype: CONST },
{ input: "\\leftarrow", tag: "mo", output: "\u2190", ttype: CONST },
{ input: "\\to", tag: "mo", output: "\u2192", ttype: CONST },
{ input: "\\rightarrow", tag: "mo", output: "\u2192", ttype: CONST },
{ input: "\\leftrightarrow", tag: "mo", output: "\u2194", ttype: CONST },
{ input: "\\uparrow", tag: "mo", output: "\u2191", ttype: CONST },
{ input: "\\downarrow", tag: "mo", output: "\u2193", ttype: CONST },
{ input: "\\updownarrow", tag: "mo", output: "\u2195", ttype: CONST },
{ input: "\\Leftarrow", tag: "mo", output: "\u21D0", ttype: CONST },
{ input: "\\Rightarrow", tag: "mo", output: "\u21D2", ttype: CONST },
{ input: "\\Leftrightarrow", tag: "mo", output: "\u21D4", ttype: CONST },
{ input: "\\iff", tag: "mo", output: "~\\Longleftrightarrow~", ttype: DEFINITION },
{ input: "\\Uparrow", tag: "mo", output: "\u21D1", ttype: CONST },
{ input: "\\Downarrow", tag: "mo", output: "\u21D3", ttype: CONST },
{ input: "\\Updownarrow", tag: "mo", output: "\u21D5", ttype: CONST },
{ input: "\\mapsto", tag: "mo", output: "\u21A6", ttype: CONST },
{ input: "\\longleftarrow", tag: "mo", output: "\u2190", ttype: LONG },
{ input: "\\longrightarrow", tag: "mo", output: "\u2192", ttype: LONG },
{ input: "\\longleftrightarrow", tag: "mo", output: "\u2194", ttype: LONG },
{ input: "\\Longleftarrow", tag: "mo", output: "\u21D0", ttype: LONG },
{ input: "\\Longrightarrow", tag: "mo", output: "\u21D2", ttype: LONG },
{ input: "\\Longleftrightarrow", tag: "mo", output: "\u21D4", ttype: LONG },
{ input: "\\longmapsto", tag: "mo", output: "\u21A6", ttype: CONST },
AMsqrt, AMroot, AMfrac, AMover, AMsub, AMsup, AMtext, AMmbox, AMatop, AMchoose,
{ input: "\\acute", tag: "mover", output: "\u00B4", ttype: UNARY, acc: true },
{ input: "\\grave", tag: "mover", output: "\u0060", ttype: UNARY, acc: true },
{ input: "\\breve", tag: "mover", output: "\u02D8", ttype: UNARY, acc: true },
{ input: "\\check", tag: "mover", output: "\u02C7", ttype: UNARY, acc: true },
{ input: "\\dot", tag: "mover", output: ".", ttype: UNARY, acc: true },
{ input: "\\ddot", tag: "mover", output: "..", ttype: UNARY, acc: true },
{ input: "\\mathring", tag: "mover", output: "\u00B0", ttype: UNARY, acc: true },
{ input: "\\vec", tag: "mover", output: "\u20D7", ttype: UNARY, acc: true },
{ input: "\\overrightarrow", tag: "mover", output: "\u20D7", ttype: UNARY, acc: true },
{ input: "\\overleftarrow", tag: "mover", output: "\u20D6", ttype: UNARY, acc: true },
{ input: "\\hat", tag: "mover", output: "\u005E", ttype: UNARY, acc: true },
{ input: "\\widehat", tag: "mover", output: "\u0302", ttype: UNARY, acc: true },
{ input: "\\tilde", tag: "mover", output: "~", ttype: UNARY, acc: true },
{ input: "\\widetilde", tag: "mover", output: "\u02DC", ttype: UNARY, acc: true },
{ input: "\\bar", tag: "mover", output: "\u203E", ttype: UNARY, acc: true },
{ input: "\\overbrace", tag: "mover", output: "\u23B4", ttype: UNARY, acc: true },
{ input: "\\overline", tag: "mover", output: "\u00AF", ttype: UNARY, acc: true },
{ input: "\\underbrace", tag: "munder", output: "\u23B5", ttype: UNARY, acc: true },
{ input: "\\underline", tag: "munder", output: "\u00AF", ttype: UNARY, acc: true },
{ input: "\\displaystyle", tag: "mstyle", atname: "displaystyle", atval: "true", ttype: UNARY },
{ input: "\\textstyle", tag: "mstyle", atname: "displaystyle", atval: "false", ttype: UNARY },
{ input: "\\scriptstyle", tag: "mstyle", atname: "scriptlevel", atval: "1", ttype: UNARY },
{ input: "\\scriptscriptstyle", tag: "mstyle", atname: "scriptlevel", atval: "2", ttype: UNARY },
{ input: "\\textrm", tag: "mstyle", output: "\\mathrm", ttype: DEFINITION },
{ input: "\\mathbf", tag: "mstyle", atname: "mathvariant", atval: "bold", ttype: UNARY },
{ input: "\\textbf", tag: "mstyle", atname: "mathvariant", atval: "bold", ttype: UNARY },
{ input: "\\mathit", tag: "mstyle", atname: "mathvariant", atval: "italic", ttype: UNARY },
{ input: "\\textit", tag: "mstyle", atname: "mathvariant", atval: "italic", ttype: UNARY },
{ input: "\\mathtt", tag: "mstyle", atname: "mathvariant", atval: "monospace", ttype: UNARY },
{ input: "\\texttt", tag: "mstyle", atname: "mathvariant", atval: "monospace", ttype: UNARY },
{ input: "\\mathsf", tag: "mstyle", atname: "mathvariant", atval: "sans-serif", ttype: UNARY },
{ input: "\\mathbb", tag: "mstyle", atname: "mathvariant", atval: "double-struck", ttype: UNARY, codes: AMbbb },
{ input: "\\mathcal", tag: "mstyle", atname: "mathvariant", atval: "script", ttype: UNARY, codes: AMcal },
{ input: "\\mathfrak", tag: "mstyle", atname: "mathvariant", atval: "fraktur", ttype: UNARY, codes: AMfrk }
];
function compareNames(s1, s2) {
if (s1.input > s2.input) return 1
else return -1;
}
var AMnames = [];
function AMinitSymbols() {
AMsymbols.sort(compareNames);
for (i = 0; i < AMsymbols.length; i++) AMnames[i] = AMsymbols[i].input;
}
var AMmathml = "http://www.w3.org/1998/Math/MathML";
function AMcreateElementMathML(t) {
if (isIE) return document.createElement("m:" + t);
else return document.createElementNS(AMmathml, t);
}
function AMcreateMmlNode(t, frag) {
if (isIE) var node = document.createElement("m:" + t);
else var node = document.createElementNS(AMmathml, t);
node.appendChild(frag);
return node;
}
function newcommand(oldstr, newstr) {
AMsymbols = AMsymbols.concat([{
input: oldstr, tag: "mo", output: newstr,
ttype: DEFINITION
}]);
}
function AMremoveCharsAndBlanks(str, n) {
var st;
st = str.slice(n);
for (var i = 0; i < st.length && st.charCodeAt(i) <= 32; i = i + 1);
return st.slice(i);
}
function AMposition(arr, str, n) {
if (n == 0) {
var h, m;
n = -1;
h = arr.length;
while (n + 1 < h) {
m = (n + h) >> 1;
if (arr[m] < str) n = m; else h = m;
}
return h;
} else
for (var i = n; i < arr.length && arr[i] < str; i++);
return i;
}
function AMgetSymbol(str) {
var k = 0;
var j = 0;
var mk;
var st;
var tagst;
var match = "";
var more = true;
for (var i = 1; i <= str.length && more; i++) {
st = str.slice(0, i);
j = k;
k = AMposition(AMnames, st, j);
if (k < AMnames.length && str.slice(0, AMnames[k].length) == AMnames[k]) {
match = AMnames[k];
mk = k;
i = match.length;
}
more = k < AMnames.length && str.slice(0, AMnames[k].length) >= AMnames[k];
}
AMpreviousSymbol = AMcurrentSymbol;
if (match != "") {
AMcurrentSymbol = AMsymbols[mk].ttype;
return AMsymbols[mk];
}
AMcurrentSymbol = CONST;
k = 1;
st = /^[\d.]+/.exec(str);
if (st) {
st = st[0];
tagst = "mn";
} else {
st = str.slice(0, 1);
tagst = (("A" > st || st > "Z") && ("a" > st || st > "z") ? "mo" : "mi");
}
return { input: st, tag: tagst, output: st, ttype: CONST };
}
var AMpreviousSymbol, AMcurrentSymbol;
function AMparseSexpr(str) {
var symbol, node, result, result2, i, st,
newFrag = document.createDocumentFragment();
str = AMremoveCharsAndBlanks(str, 0);
symbol = AMgetSymbol(str);
if (symbol == null || symbol.ttype == RIGHTBRACKET)
return [null, str, null];
if (symbol.ttype == DEFINITION) {
str = symbol.output + AMremoveCharsAndBlanks(str, symbol.input.length);
symbol = AMgetSymbol(str);
if (symbol == null || symbol.ttype == RIGHTBRACKET)
return [null, str, null];
}
str = AMremoveCharsAndBlanks(str, symbol.input.length);
switch (symbol.ttype) {
case SPACE:
node = AMcreateElementMathML(symbol.tag);
node.setAttribute(symbol.atname, symbol.atval);
return [node, str, symbol.tag];
case UNDEROVER:
if (isIE) {
if (symbol.input.substr(0, 4) == "\\big") {
str = "\\" + symbol.input.substr(4) + str;    // make \bigcup = \cup etc.
symbol = AMgetSymbol(str);
symbol.ttype = UNDEROVER;
str = AMremoveCharsAndBlanks(str, symbol.input.length);
}
}
return [AMcreateMmlNode(symbol.tag,
document.createTextNode(symbol.output)), str, symbol.tag];
case CONST:
var output = symbol.output;
if (isIE) {
if (symbol.input == "'")
output = "\u2032";
else if (symbol.input == "''")
output = "\u2033";
else if (symbol.input == "'''")
output = "\u2033\u2032";
else if (symbol.input == "''''")
output = "\u2033\u2033";
else if (symbol.input == "\\square")
output = "\u25A1";
else if (symbol.input.substr(0, 5) == "\\frac") {
var denom = symbol.input.substr(6, 1);
if (denom == "5" || denom == "6") {
str = symbol.input.replace(/\\frac/, "\\frac ") + str;
return [node, str, symbol.tag];
}
}
}
node = AMcreateMmlNode(symbol.tag, document.createTextNode(output));
return [node, str, symbol.tag];
case LONG:
node = AMcreateMmlNode(symbol.tag, document.createTextNode(symbol.output));
node.setAttribute("minsize", "1.5");
node.setAttribute("maxsize", "1.5");
node = AMcreateMmlNode("mover", node);
node.appendChild(AMcreateElementMathML("mspace"));
return [node, str, symbol.tag];
case STRETCHY:
if (isIE && symbol.input == "\\backslash")
symbol.output = "\\"; // doesn't expand, but then nor does "\u2216"
node = AMcreateMmlNode(symbol.tag, document.createTextNode(symbol.output));
if (symbol.input == "|" || symbol.input == "\\vert" ||
symbol.input == "\\|" || symbol.input == "\\Vert") {
node.setAttribute("lspace", "0em");
node.setAttribute("rspace", "0em");
}
node.setAttribute("maxsize", symbol.atval);
if (symbol.rtag != null)
return [node, str, symbol.rtag];
else
return [node, str, symbol.tag];
case BIG:
var atval = symbol.atval;
if (isIE)
atval = symbol.ieval;
symbol = AMgetSymbol(str);
if (symbol == null)
return [null, str, null];
str = AMremoveCharsAndBlanks(str, symbol.input.length);
node = AMcreateMmlNode(symbol.tag, document.createTextNode(symbol.output));
if (isIE) {
var space = AMcreateElementMathML("mspace");
space.setAttribute("height", atval + "ex");
node = AMcreateMmlNode("mrow", node);
node.appendChild(space);
} else {
node.setAttribute("minsize", atval);
node.setAttribute("maxsize", atval);
}
return [node, str, symbol.tag];
case LEFTBRACKET:
if (symbol.input == "\\left") {
symbol = AMgetSymbol(str);
if (symbol != null) {
if (symbol.input == ".")
symbol.invisible = true;
str = AMremoveCharsAndBlanks(str, symbol.input.length);
}
}
result = AMparseExpr(str, true, false);
if (symbol == null ||
(typeof symbol.invisible == "boolean" && symbol.invisible))
node = AMcreateMmlNode("mrow", result[0]);
else {
node = AMcreateMmlNode("mo", document.createTextNode(symbol.output));
node = AMcreateMmlNode("mrow", node);
node.appendChild(result[0]);
}
return [node, result[1], result[2]];
case MATRIX:
if (symbol.input == "\\begin{array}") {
var mask = "";
symbol = AMgetSymbol(str);
str = AMremoveCharsAndBlanks(str, 0);
if (symbol == null)
mask = "l";
else {
str = AMremoveCharsAndBlanks(str, symbol.input.length);
if (symbol.input != "{")
mask = "l";
else do {
symbol = AMgetSymbol(str);
if (symbol != null) {
str = AMremoveCharsAndBlanks(str, symbol.input.length);
if (symbol.input != "}")
mask = mask + symbol.input;
}
} while (symbol != null && symbol.input != "" && symbol.input != "}");
}
result = AMparseExpr("{" + str, true, true);
node = AMcreateMmlNode("mtable", result[0]);
mask = mask.replace(/l/g, "left ");
mask = mask.replace(/r/g, "right ");
mask = mask.replace(/c/g, "center ");
node.setAttribute("columnalign", mask);
node.setAttribute("displaystyle", "false");
if (isIE)
return [node, result[1], null];
var lspace = AMcreateElementMathML("mspace");
lspace.setAttribute("width", "0.167em");
var rspace = AMcreateElementMathML("mspace");
rspace.setAttribute("width", "0.167em");
var node1 = AMcreateMmlNode("mrow", lspace);
node1.appendChild(node);
node1.appendChild(rspace);
return [node1, result[1], null];
} else {
result = AMparseExpr("{" + str, true, true);
node = AMcreateMmlNode("mtable", result[0]);
if (isIE)
node.setAttribute("columnspacing", "0.25em");
else
node.setAttribute("columnspacing", "0.167em");
node.setAttribute("columnalign", "right center left");
node.setAttribute("displaystyle", "true");
node = AMcreateMmlNode("mrow", node);
return [node, result[1], null];
}
case TEXT:
if (str.charAt(0) == "{") i = str.indexOf("}");
else i = 0;
if (i == -1)
i = str.length;
st = str.slice(1, i);
if (st.charAt(0) == " ") {
node = AMcreateElementMathML("mspace");
node.setAttribute("width", "0.33em");
newFrag.appendChild(node);
}
newFrag.appendChild(
AMcreateMmlNode(symbol.tag, document.createTextNode(st)));
if (st.charAt(st.length - 1) == " ") {
node = AMcreateElementMathML("mspace");
node.setAttribute("width", "0.33em");
newFrag.appendChild(node);
}
str = AMremoveCharsAndBlanks(str, i + 1);
return [AMcreateMmlNode("mrow", newFrag), str, null];
case UNARY:
result = AMparseSexpr(str);
if (result[0] == null) return [AMcreateMmlNode(symbol.tag,
document.createTextNode(symbol.output)), str];
if (typeof symbol.func == "boolean" && symbol.func) {
st = str.charAt(0);
if (st == "^" || st == "_" || st == ",") {
return [AMcreateMmlNode(symbol.tag,
document.createTextNode(symbol.output)), str, symbol.tag];
} else {
node = AMcreateMmlNode("mrow",
AMcreateMmlNode(symbol.tag, document.createTextNode(symbol.output)));
if (isIE) {
var space = AMcreateElementMathML("mspace");
space.setAttribute("width", "0.167em");
node.appendChild(space);
}
node.appendChild(result[0]);
return [node, result[1], symbol.tag];
}
}
if (symbol.input == "\\sqrt") {
if (isIE) {
var space = AMcreateElementMathML("mspace");
space.setAttribute("height", "1.2ex");
space.setAttribute("width", "0em");
node = AMcreateMmlNode(symbol.tag, result[0])
node.appendChild(space);
return [node, result[1], symbol.tag];
} else
return [AMcreateMmlNode(symbol.tag, result[0]), result[1], symbol.tag];
} else if (typeof symbol.acc == "boolean" && symbol.acc) {
node = AMcreateMmlNode(symbol.tag, result[0]);
var output = symbol.output;
if (isIE) {
if (symbol.input == "\\hat")
output = "\u0302";
else if (symbol.input == "\\widehat")
output = "\u005E";
else if (symbol.input == "\\bar")
output = "\u00AF";
else if (symbol.input == "\\grave")
output = "\u0300";
else if (symbol.input == "\\tilde")
output = "\u0303";
}
var node1 = AMcreateMmlNode("mo", document.createTextNode(output));
if (symbol.input == "\\vec" || symbol.input == "\\check")
node1.setAttribute("maxsize", "1.2");
if (isIE && symbol.input == "\\bar")
node1.setAttribute("maxsize", "0.5");
if (symbol.input == "\\underbrace" || symbol.input == "\\underline")
node1.setAttribute("accentunder", "true");
else
node1.setAttribute("accent", "true");
node.appendChild(node1);
if (symbol.input == "\\overbrace" || symbol.input == "\\underbrace")
node.ttype = UNDEROVER;
return [node, result[1], symbol.tag];
} else {
if (!isIE && typeof symbol.codes != "undefined") {
for (i = 0; i < result[0].childNodes.length; i++)
if (result[0].childNodes[i].nodeName == "mi" || result[0].nodeName == "mi") {
st = (result[0].nodeName == "mi" ? result[0].firstChild.nodeValue :
result[0].childNodes[i].firstChild.nodeValue);
var newst = [];
for (var j = 0; j < st.length; j++)
if (st.charCodeAt(j) > 64 && st.charCodeAt(j) < 91) newst = newst +
String.fromCharCode(symbol.codes[st.charCodeAt(j) - 65]);
else newst = newst + st.charAt(j);
if (result[0].nodeName == "mi")
result[0] = AMcreateElementMathML("mo").
appendChild(document.createTextNode(newst));
else result[0].replaceChild(AMcreateElementMathML("mo").
appendChild(document.createTextNode(newst)), result[0].childNodes[i]);
}
}
node = AMcreateMmlNode(symbol.tag, result[0]);
node.setAttribute(symbol.atname, symbol.atval);
if (symbol.input == "\\scriptstyle" ||
symbol.input == "\\scriptscriptstyle")
node.setAttribute("displaystyle", "false");
return [node, result[1], symbol.tag];
}
case BINARY:
result = AMparseSexpr(str);
if (result[0] == null) return [AMcreateMmlNode("mo",
document.createTextNode(symbol.input)), str, null];
result2 = AMparseSexpr(result[1]);
if (result2[0] == null) return [AMcreateMmlNode("mo",
document.createTextNode(symbol.input)), str, null];
if (symbol.input == "\\root" || symbol.input == "\\stackrel")
newFrag.appendChild(result2[0]);
newFrag.appendChild(result[0]);
if (symbol.input == "\\frac") newFrag.appendChild(result2[0]);
return [AMcreateMmlNode(symbol.tag, newFrag), result2[1], symbol.tag];
case INFIX:
str = AMremoveCharsAndBlanks(str, symbol.input.length);
return [AMcreateMmlNode("mo", document.createTextNode(symbol.output)),
str, symbol.tag];
default:
return [AMcreateMmlNode(symbol.tag,
document.createTextNode(symbol.output)), str, symbol.tag];
}
}
function AMparseIexpr(str) {
var symbol, sym1, sym2, node, result, tag, underover;
str = AMremoveCharsAndBlanks(str, 0);
sym1 = AMgetSymbol(str);
result = AMparseSexpr(str);
node = result[0];
str = result[1];
tag = result[2];
symbol = AMgetSymbol(str);
if (symbol.ttype == INFIX) {
str = AMremoveCharsAndBlanks(str, symbol.input.length);
result = AMparseSexpr(str);
if (result[0] == null)
result[0] = AMcreateMmlNode("mo", document.createTextNode("\u25A1"));
str = result[1];
tag = result[2];
if (symbol.input == "_" || symbol.input == "^") {
sym2 = AMgetSymbol(str);
tag = null;
underover = ((sym1.ttype == UNDEROVER) || (node.ttype == UNDEROVER));
if (symbol.input == "_" && sym2.input == "^") {
str = AMremoveCharsAndBlanks(str, sym2.input.length);
var res2 = AMparseSexpr(str);
str = res2[1];
tag = res2[2];
node = AMcreateMmlNode((underover ? "munderover" : "msubsup"), node);
node.appendChild(result[0]);
node.appendChild(res2[0]);
} else if (symbol.input == "_") {
node = AMcreateMmlNode((underover ? "munder" : "msub"), node);
node.appendChild(result[0]);
} else {
node = AMcreateMmlNode((underover ? "mover" : "msup"), node);
node.appendChild(result[0]);
}
node = AMcreateMmlNode("mrow", node);
} else {
node = AMcreateMmlNode(symbol.tag, node);
if (symbol.input == "\\atop" || symbol.input == "\\choose")
node.setAttribute("linethickness", "0ex");
node.appendChild(result[0]);
if (symbol.input == "\\choose")
node = AMcreateMmlNode("mfenced", node);
}
}
return [node, str, tag];
}
function AMparseExpr(str, rightbracket, matrix) {
var symbol, node, result, i, tag,
newFrag = document.createDocumentFragment();
do {
str = AMremoveCharsAndBlanks(str, 0);
result = AMparseIexpr(str);
node = result[0];
str = result[1];
tag = result[2];
symbol = AMgetSymbol(str);
if (node != undefined) {
if ((tag == "mn" || tag == "mi") && symbol != null &&
typeof symbol.func == "boolean" && symbol.func) {
var space = AMcreateElementMathML("mspace");
space.setAttribute("width", "0.167em");
node = AMcreateMmlNode("mrow", node);
node.appendChild(space);
}
newFrag.appendChild(node);
}
} while ((symbol.ttype != RIGHTBRACKET)
&& symbol != null && symbol.output != "");
tag = null;
if (symbol.ttype == RIGHTBRACKET) {
if (symbol.input == "\\right") {
str = AMremoveCharsAndBlanks(str, symbol.input.length);
symbol = AMgetSymbol(str);
if (symbol != null && symbol.input == ".")
symbol.invisible = true;
if (symbol != null)
tag = symbol.rtag;
}
if (symbol != null)
str = AMremoveCharsAndBlanks(str, symbol.input.length);
var len = newFrag.childNodes.length;
if (matrix &&
len > 0 && newFrag.childNodes[len - 1].nodeName == "mrow" && len > 1 &&
newFrag.childNodes[len - 2].nodeName == "mo" &&
newFrag.childNodes[len - 2].firstChild.nodeValue == "&") {
var pos = [];
var m = newFrag.childNodes.length;
for (i = 0; matrix && i < m; i = i + 2) {
pos[i] = [];
node = newFrag.childNodes[i];
for (var j = 0; j < node.childNodes.length; j++)
if (node.childNodes[j].firstChild.nodeValue == "&")
pos[i][pos[i].length] = j;
}
var row, frag, n, k, table = document.createDocumentFragment();
for (i = 0; i < m; i = i + 2) {
row = document.createDocumentFragment();
frag = document.createDocumentFragment();
node = newFrag.firstChild;
n = node.childNodes.length;
k = 0;
for (j = 0; j < n; j++) {
if (typeof pos[i][k] != "undefined" && j == pos[i][k]) {
node.removeChild(node.firstChild);
row.appendChild(AMcreateMmlNode("mtd", frag));
k++;
} else frag.appendChild(node.firstChild);
}
row.appendChild(AMcreateMmlNode("mtd", frag));
if (newFrag.childNodes.length > 2) {
newFrag.removeChild(newFrag.firstChild);
newFrag.removeChild(newFrag.firstChild);
}
table.appendChild(AMcreateMmlNode("mtr", row));
}
return [table, str];
}
if (typeof symbol.invisible != "boolean" || !symbol.invisible) {
node = AMcreateMmlNode("mo", document.createTextNode(symbol.output));
newFrag.appendChild(node);
}
}
return [newFrag, str, tag];
}
function AMparseMath(str) {
var result, node = AMcreateElementMathML("mstyle");
if (mathcolor != "") node.setAttribute("mathcolor", mathcolor);
if (mathfontfamily != "") node.setAttribute("fontfamily", mathfontfamily);
node.appendChild(AMparseExpr(str.replace(/^\s+/g, ""), false, false)[0]);
node = AMcreateMmlNode("math", node);
if (showasciiformulaonhover)
node.setAttribute("title", str.replace(/\s+/g, " "));
if (mathfontfamily != "" && (isIE || mathfontfamily != "serif")) {
var fnode = AMcreateElementXHTML("font");
fnode.setAttribute("face", mathfontfamily);
fnode.appendChild(node);
return fnode;
}
return node;
}
var xsltMathml = "<?xml version='1.0' encoding=\"UTF-8\"?>\r\n<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n\t\txmlns:m=\"http://www.w3.org/1998/Math/MathML\"\r\n                version='1.0'>\r\n                \r\n<xsl:output method=\"text\" indent=\"no\" encoding=\"UTF-8\"/>\r\n\r\n<!-- ====================================================================== -->\r\n<!-- $id: mmltex.xsl, 2002/22/11 Exp $\r\n     This file is part of the XSLT MathML Library distribution.\r\n     See ./README or http://www.raleigh.ru/MathML/mmltex for\r\n     copyright and other information                                        -->\r\n<!-- ====================================================================== -->\r\n\r\n<!--xsl:include href=\"tokens.xsl\"/-->\r\n\r\n<xsl:template match=\"m:mi|m:mn|m:mo|m:mtext|m:ms\">\r\n\t<xsl:call-template name=\"CommonTokenAtr\"/>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"mi\">\r\n  <xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"mn\">\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"mo\">\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"mtext\">\r\n\t<xsl:variable name=\"content\">\r\n\t\t<xsl:call-template name=\"replaceMtextEntities\">\r\n\t\t\t<xsl:with-param name=\"content\" select=\".\"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:variable>\r\n\t<xsl:text>\\text{</xsl:text>\r\n\t<xsl:value-of select=\"$content\"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mspace\">\r\n</xsl:template>\r\n\r\n<xsl:template name=\"ms\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"@lquote\"><xsl:value-of select=\"@lquote\"/></xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\"</xsl:text></xsl:otherwise>\r\n\t</xsl:choose><xsl:apply-templates/><xsl:choose>\r\n\t\t<xsl:when test=\"@rquote\"><xsl:value-of select=\"@rquote\"/></xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\"</xsl:text></xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"CommonTokenAtr\">\r\n\t<xsl:if test=\"@mathbackground\">\r\n\t\t<xsl:text>\\colorbox[rgb]{</xsl:text>\r\n\t\t<xsl:call-template name=\"color\">\r\n\t\t\t<xsl:with-param name=\"color\" select=\"@mathbackground\"/>\r\n\t\t</xsl:call-template>\r\n\t\t<xsl:text>}{$</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"@color or @mathcolor\"> <!-- Note: @color is deprecated in MathML 2.0 -->\r\n\t\t<xsl:text>\\textcolor[rgb]{</xsl:text>\r\n\t\t<xsl:call-template name=\"color\">\r\n\t\t\t<xsl:with-param name=\"color\" select=\"@color|@mathcolor\"/>\r\n\t\t</xsl:call-template>\r\n\t\t<xsl:text>}{</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"@mathvariant\">\r\n\t\t<xsl:choose>\r\n\t\t\t<xsl:when test=\"@mathvariant='normal'\">\r\n\t\t\t\t<xsl:text>\\mathrm{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='bold'\">\r\n\t\t\t\t<xsl:text>\\mathbf{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='italic'\">\r\n\t\t\t\t<xsl:text>\\mathit{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='bold-italic'\">\t<!-- Required definition -->\r\n\t\t\t\t<xsl:text>\\mathbit{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='double-struck'\">\t<!-- Required amsfonts -->\r\n\t\t\t\t<xsl:text>\\mathbb{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='bold-fraktur'\">\t<!-- Error -->\r\n\t\t\t\t<xsl:text>{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='script'\">\r\n\t\t\t\t<xsl:text>\\mathcal{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='bold-script'\">\t<!-- Error -->\r\n\t\t\t\t<xsl:text>\\mathsc{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='fraktur'\">\t<!-- Required amsfonts -->\r\n\t\t\t\t<xsl:text>\\mathfrak{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='sans-serif'\">\r\n\t\t\t\t<xsl:text>\\mathsf{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='bold-sans-serif'\"> <!-- Required definition -->\r\n\t\t\t\t<xsl:text>\\mathbsf{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='sans-serif-italic'\"> <!-- Required definition -->\r\n\t\t\t\t<xsl:text>\\mathsfit{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='sans-serif-bold-italic'\">\t<!-- Error -->\r\n\t\t\t\t<xsl:text>\\mathbsfit{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test=\"@mathvariant='monospace'\">\r\n\t\t\t\t<xsl:text>\\mathtt{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:otherwise>\r\n\t\t\t\t<xsl:text>{</xsl:text>\r\n\t\t\t</xsl:otherwise>\r\n\t\t</xsl:choose>\r\n\t</xsl:if>\r\n\t<xsl:call-template name=\"selectTemplate\"/>\r\n\t<xsl:if test=\"@mathvariant\">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"@color or @mathcolor\">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"@mathbackground\">\r\n\t\t<xsl:text>$}</xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"selectTemplate\">\r\n<!--\t<xsl:variable name=\"name\" select=\"local-name()\"/>\r\n\t<xsl:call-template name=\"{$name}\"/>-->\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"local-name(.)='mi'\">\r\n\t\t\t<xsl:call-template name=\"mi\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"local-name(.)='mn'\">\r\n\t\t\t<xsl:call-template name=\"mn\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"local-name(.)='mo'\">\r\n\t\t\t<xsl:call-template name=\"mo\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"local-name(.)='mtext'\">\r\n\t\t\t<xsl:call-template name=\"mtext\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"local-name(.)='ms'\">\r\n\t\t\t<xsl:call-template name=\"ms\"/>\r\n\t\t</xsl:when>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"color\">\r\n<!-- NB: Variables colora and valueColor{n} only for Sablotron -->\r\n\t<xsl:param name=\"color\"/>\r\n\t<xsl:variable name=\"colora\" select=\"translate($color,'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz')\"/>\r\n\t<xsl:choose>\r\n\t<xsl:when test=\"starts-with($colora,'#') and string-length($colora)=4\">\r\n\t\t<xsl:variable name=\"valueColor\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,2,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select=\"$valueColor div 15\"/><xsl:text>,</xsl:text>\r\n\t\t<xsl:variable name=\"valueColor1\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,3,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select=\"$valueColor1 div 15\"/><xsl:text>,</xsl:text>\r\n\t\t<xsl:variable name=\"valueColor2\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,4,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select=\"$valueColor2 div 15\"/>\r\n\t</xsl:when>\r\n\t<xsl:when test=\"starts-with($colora,'#') and string-length($colora)=7\">\r\n\t\t<xsl:variable name=\"valueColor1\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,2,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:variable name=\"valueColor2\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,3,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select=\"($valueColor1*16 + $valueColor2) div 255\"/><xsl:text>,</xsl:text>\r\n\t\t<xsl:variable name=\"valueColor1a\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,4,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:variable name=\"valueColor2a\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,5,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select=\"($valueColor1a*16 + $valueColor2a) div 255\"/><xsl:text>,</xsl:text>\r\n\t\t<xsl:variable name=\"valueColor1b\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,6,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:variable name=\"valueColor2b\">\r\n\t\t\t<xsl:call-template name=\"Hex2Decimal\">\r\n\t\t\t\t<xsl:with-param name=\"arg\" select=\"substring($colora,7,1)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select=\"($valueColor1b*16 + $valueColor2b) div 255\"/>\r\n\t</xsl:when>\r\n<!-- ======================= if color specifed as an html-color-name ========================================== -->\r\n\t<xsl:when test=\"$colora='aqua'\"><xsl:text>0,1,1</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='black'\"><xsl:text>0,0,0</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='blue'\"><xsl:text>0,0,1</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='fuchsia'\"><xsl:text>1,0,1</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='gray'\"><xsl:text>.5,.5,.5</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='green'\"><xsl:text>0,.5,0</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='lime'\"><xsl:text>0,1,0</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='maroon'\"><xsl:text>.5,0,0</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='navy'\"><xsl:text>0,0,.5</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='olive'\"><xsl:text>.5,.5,0</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='purple'\"><xsl:text>.5,0,.5</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='red'\"><xsl:text>1,0,0</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='silver'\"><xsl:text>.75,.75,.75</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='teal'\"><xsl:text>0,.5,.5</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='white'\"><xsl:text>1,1,1</xsl:text></xsl:when>\r\n\t<xsl:when test=\"$colora='yellow'\"><xsl:text>1,1,0</xsl:text></xsl:when>\r\n\t<xsl:otherwise>\r\n\t\t<xsl:message>Exception at color template</xsl:message>\r\n\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"Hex2Decimal\">\r\n\t<xsl:param name=\"arg\"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"$arg='f'\">\r\n\t\t\t<xsl:value-of select=\"15\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$arg='e'\">\r\n\t\t\t<xsl:value-of select=\"14\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$arg='d'\">\r\n\t\t\t<xsl:value-of select=\"13\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$arg='c'\">\r\n\t\t\t<xsl:value-of select=\"12\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$arg='b'\">\r\n\t\t\t<xsl:value-of select=\"11\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$arg='a'\">\r\n\t\t\t<xsl:value-of select=\"10\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"translate($arg, '0123456789', '9999999999')='9'\"> <!-- if $arg is number -->\r\n\t\t\t<xsl:value-of select=\"$arg\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:message>Exception at Hex2Decimal template</xsl:message>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:*/text()\">\r\n\t<xsl:call-template name=\"replaceEntities\">\r\n\t\t<xsl:with-param name=\"content\" select=\"normalize-space()\"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n<!--xsl:include href=\"glayout.xsl\"/-->\r\n<xsl:template match=\"m:mfrac\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"@bevelled='true'\">\r\n<!--\t\t\t<xsl:text>\\raisebox{1ex}{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}\\!\\left/ \\!\\raisebox{-1ex}{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t\t\t<xsl:text>}\\right.</xsl:text>-->\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"@linethickness\">\r\n\t\t\t<xsl:text>\\genfrac{}{}{</xsl:text>\r\n\t\t\t<xsl:choose>\r\n\t\t\t\t<xsl:when test=\"number(@linethickness)\">\r\n\t\t\t\t\t<xsl:value-of select=\"@linethickness div 10\"/>\r\n\t\t\t\t\t<xsl:text>ex</xsl:text>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:when test=\"@linethickness='thin'\">\r\n\t\t\t\t\t<xsl:text>.05ex</xsl:text>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:when test=\"@linethickness='medium'\"/>\r\n\t\t\t\t<xsl:when test=\"@linethickness='thick'\">\r\n\t\t\t\t\t<xsl:text>.2ex</xsl:text>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:otherwise>\r\n\t\t\t\t\t<xsl:value-of select=\"@linethickness\"/>\r\n\t\t\t\t</xsl:otherwise>\r\n\t\t\t</xsl:choose>\r\n\t\t\t<xsl:text>}{}{</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\frac{</xsl:text>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:if test=\"@numalign='right'\">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t<xsl:if test=\"@numalign='left'\">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>}{</xsl:text>\t\r\n\t<xsl:if test=\"@denomalign='right'\">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t\t<xsl:if test=\"@denomalign='left'\">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mroot\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"count(./*)=2\">\r\n\t\t\t<xsl:text>\\sqrt[</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t\t\t<xsl:text>]{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t<!-- number of argumnets is not 2 - code 25 -->\r\n\t\t\t<xsl:message>exception 25:</xsl:message>\r\n\t\t\t<xsl:text>\\text{exception 25:}</xsl:text> \r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:msqrt\">\r\n\t<xsl:text>\\sqrt{</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mfenced\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"@open\">\r\n\t\t\t<xsl:if test=\"translate(@open,'{}[]()|','{{{{{{{')='{'\">\r\n\t\t\t\t<xsl:text>\\left</xsl:text>\r\n\t\t\t</xsl:if>\r\n\t\t\t<xsl:if test=\"@open='{' or @open='}'\">\r\n\t\t\t\t<xsl:text>\\</xsl:text>\r\n\t\t\t</xsl:if>\r\n\t\t\t<xsl:value-of select=\"@open\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\\left(</xsl:text></xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"count(./*)>1\">\r\n\t\t\t<xsl:variable name=\"symbol\">\r\n\t\t\t\t<xsl:choose>\r\n\t\t\t\t\t<xsl:when test=\"@separators\">\r\n\t\t\t\t\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t\t\t\t\t<xsl:with-param name=\"symbol\" select=\"@separators\"/>\r\n\t\t\t\t\t\t</xsl:call-template>\r\n\t\t\t\t\t</xsl:when>\r\n\t\t\t\t\t<xsl:otherwise>,</xsl:otherwise>\r\n\t\t\t\t</xsl:choose>\r\n\t\t\t</xsl:variable>\r\n\t\t\t<xsl:for-each select=\"./*\">\r\n\t\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t\t<xsl:if test=\"not(position()=last())\">\r\n\t\t\t\t\t<xsl:choose>\r\n\t\t\t\t\t\t<xsl:when test=\"position()>string-length($symbol)\">\r\n\t\t\t\t\t\t\t<xsl:value-of select=\"substring($symbol,string-length($symbol))\"/>\r\n\t\t\t\t\t\t</xsl:when>\r\n\t\t\t\t\t\t<xsl:otherwise>\r\n\t\t\t\t\t\t\t<xsl:value-of select=\"substring($symbol,position(),1)\"/>\r\n\t\t\t\t\t\t</xsl:otherwise>\r\n\t\t\t\t\t</xsl:choose>\r\n\t\t\t\t</xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:apply-templates/>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"@close\">\r\n\t\t\t<xsl:if test=\"translate(@open,'{}[]()|','{{{{{{{')='{'\">\r\n\t\t\t\t<xsl:text>\\right</xsl:text>\r\n\t\t\t</xsl:if>\r\n\t\t\t<xsl:if test=\"@open='{' or @open='}'\">\r\n\t\t\t\t<xsl:text>\\</xsl:text>\r\n\t\t\t</xsl:if>\t\t\r\n\t\t\t<xsl:value-of select=\"@close\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\\right)</xsl:text></xsl:otherwise>\r\n\t</xsl:choose>\t\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mphantom\">\r\n\t<xsl:text>\\phantom{</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:menclose\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"@notation = 'actuarial'\">\r\n\t\t\t<xsl:text>\\overline{</xsl:text>\r\n\t\t\t<xsl:apply-templates/>\r\n\t\t\t<xsl:text>\\hspace{.2em}|}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"@notation = 'radical'\">\r\n\t\t\t<xsl:text>\\sqrt{</xsl:text>\r\n\t\t\t<xsl:apply-templates/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\overline{)</xsl:text>\r\n\t\t\t<xsl:apply-templates/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mrow\">\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mstyle\">\r\n\t<xsl:if test=\"@background\">\r\n\t\t<xsl:text>\\colorbox[rgb]{</xsl:text>\r\n\t\t<xsl:call-template name=\"color\">\r\n\t\t\t<xsl:with-param name=\"color\" select=\"@background\"/>\r\n\t\t</xsl:call-template>\r\n\t\t<xsl:text>}{$</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"@color\">\r\n\t\t<xsl:text>\\textcolor[rgb]{</xsl:text>\r\n\t\t<xsl:call-template name=\"color\">\r\n\t\t\t<xsl:with-param name=\"color\" select=\"@color\"/>\r\n\t\t</xsl:call-template>\r\n\t\t<xsl:text>}{</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test=\"@color\">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"@background\">\r\n\t\t<xsl:text>$}</xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n<!--\r\n\r\n<xsl:template match=\"m:mstyle\">\r\n\t<xsl:if test=\"@displaystyle='true'\">\r\n\t\t<xsl:text>{\\displaystyle</xsl:text>\r\n\t</xsl:if>\t\t\t\r\n\t<xsl:if test=\"@scriptlevel=2\">\r\n\t\t<xsl:text>{\\scriptscriptstyle</xsl:text>\t\r\n\t</xsl:if>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test=\"@scriptlevel=2\">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"@displaystyle='true'\">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n-->\r\n\r\n<xsl:template match=\"m:merror\">\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n<!--xsl:include href=\"scripts.xsl\"/-->\r\n<xsl:template match=\"m:munderover\">\r\n\t<xsl:variable name=\"base\">\r\n\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t<xsl:with-param name=\"symbol\" select=\"./*[1]\"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:variable>\r\n\t<xsl:variable name=\"under\">\r\n\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t<xsl:with-param name=\"symbol\" select=\"./*[2]\"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:variable>\r\n\t<xsl:variable name=\"over\">\r\n\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t<xsl:with-param name=\"symbol\" select=\"./*[3]\"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:variable>\r\n\t\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"$over='&#x000AF;'\">\t<!-- OverBar - over bar -->\r\n\t\t\t<xsl:text>\\overline{</xsl:text>\r\n\t\t\t<xsl:call-template name=\"munder\">\r\n\t\t\t\t<xsl:with-param name=\"base\" select=\"$base\"/>\r\n\t\t\t\t<xsl:with-param name=\"under\" select=\"$under\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$over='&#x0FE37;'\">\t<!-- OverBrace - over brace -->\r\n\t\t\t<xsl:text>\\overbrace{</xsl:text>\r\n\t\t\t<xsl:call-template name=\"munder\">\r\n\t\t\t\t<xsl:with-param name=\"base\" select=\"$base\"/>\r\n\t\t\t\t<xsl:with-param name=\"under\" select=\"$under\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$under='&#x00332;'\">\t<!-- UnderBar - combining low line -->\r\n\t\t\t<xsl:text>\\underline{</xsl:text>\r\n\t\t\t<xsl:call-template name=\"mover\">\r\n\t\t\t\t<xsl:with-param name=\"base\" select=\"$base\"/>\r\n\t\t\t\t<xsl:with-param name=\"over\" select=\"$over\"/>\r\n\t\t\t\t<xsl:with-param name=\"pos_over\" select=\"3\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$under='&#x0FE38;'\">\t<!-- UnderBrace - under brace -->\r\n\t\t\t<xsl:text>\\underbrace{</xsl:text>\r\n\t\t\t<xsl:call-template name=\"mover\">\r\n\t\t\t\t<xsl:with-param name=\"base\" select=\"$base\"/>\r\n\t\t\t\t<xsl:with-param name=\"over\" select=\"$over\"/>\r\n\t\t\t\t<xsl:with-param name=\"pos_over\" select=\"3\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"translate($base,'&#x0220F;&#x02210;&#x022c2;&#x022c3;&#x02294;&#x0222B;',\r\n\t\t\t\t\t\t'&#x02211;&#x02211;&#x02211;&#x02211;&#x02211;&#x02211;')='&#x02211;'\">\r\n<!-- if $base is operator, such as\r\n\t\t\t&#x02211;\t/sum L: summation operator\r\n\t\t\t&#x0220F;\t/prod L: product operator\r\n\t\t\t&#x02210;\t/coprod L: coproduct operator\r\n\t\t\t&#x022c2;\t/bigcap\r\n\t\t\t&#x022c3;\t/bigcup\r\n\t\t\t&#x02294;\t/bigsqcup\r\n-->\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>_{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t\t\t<xsl:text>}^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[3]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\underset{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t\t\t<xsl:text>}{\\overset{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[3]\"/>\r\n\t\t\t<xsl:text>}{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}}</xsl:text>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mover\">\r\n\t<xsl:call-template name=\"mover\">\r\n\t\t<xsl:with-param name=\"base\">\r\n\t\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t\t<xsl:with-param name=\"symbol\" select=\"./*[1]\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:with-param>\r\n\t\t<xsl:with-param name=\"over\">\r\n\t\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t\t<xsl:with-param name=\"symbol\" select=\"./*[2]\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:munder\">\r\n\t<xsl:call-template name=\"munder\">\r\n\t\t<xsl:with-param name=\"base\">\r\n\t\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t\t<xsl:with-param name=\"symbol\" select=\"./*[1]\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:with-param>\r\n\t\t<xsl:with-param name=\"under\">\r\n\t\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t\t<xsl:with-param name=\"symbol\" select=\"./*[2]\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"mover\">\r\n\t<xsl:param name=\"base\"/>\r\n\t<xsl:param name=\"over\"/>\r\n\t<xsl:param name=\"pos_over\" select=\"2\"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"$over='&#x000AF;'\">\t<!-- OverBar - over bar -->\r\n\t\t\t<xsl:text>\\overline{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$over='&#x0FE37;'\">\t<!-- OverBrace - over brace -->\r\n\t\t\t<xsl:text>\\overbrace{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"translate($base,'&#x0220F;&#x02210;&#x022c2;&#x022c3;&#x02294;',\r\n\t\t\t\t\t\t'&#x02211;&#x02211;&#x02211;&#x02211;&#x02211;')='&#x02211;'\">\r\n<!-- if $base is operator, such as\r\n\t\t\t&#x02211;\t/sum L: summation operator\r\n\t\t\t&#x0220F;\t/prod L: product operator\r\n\t\t\t&#x02210;\t/coprod L: coproduct operator\r\n\t\t\t&#x022c2;\t/bigcap\r\n\t\t\t&#x022c3;\t/bigcup\r\n\t\t\t&#x02294;\t/bigsqcup\r\n-->\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[$pos_over]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\stackrel{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[$pos_over]\"/>\r\n\t\t\t<xsl:text>}{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t\t<!--\r\n\t\t\t<xsl:text>\\overset{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[$pos_over]\"/>\r\n\t\t\t<xsl:text>}{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>-->\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"munder\">\r\n\t<xsl:param name=\"base\"/>\r\n\t<xsl:param name=\"under\"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"$under='&#x00332;'\">\t<!-- UnderBar - combining low line -->\r\n\t\t\t<xsl:text>\\underline{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"$under='&#x0FE38;'\">\t<!-- UnderBrace - under brace -->\r\n\t\t\t<xsl:text>\\underbrace{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"translate($base,'&#x0220F;&#x02210;&#x022c2;&#x022c3;&#x02294;',\r\n\t\t\t\t\t\t'&#x02211;&#x02211;&#x02211;&#x02211;&#x02211;')='&#x02211;'\">\r\n<!-- if $base is operator, such as\r\n\t\t\t&#x02211;\t/sum L: summation operator\r\n\t\t\t&#x0220F;\t/prod L: product operator\r\n\t\t\t&#x02210;\t/coprod L: coproduct operator\r\n\t\t\t&#x022c2;\t/bigcap\r\n\t\t\t&#x022c3;\t/bigcup\r\n\t\t\t&#x02294;\t/bigsqcup\r\n-->\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>_{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\underset{</xsl:text>\t\t<!-- Required AmsMath package -->\r\n\t\t\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t\t\t<xsl:text>}{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:msubsup\">\r\n\t<xsl:text>{</xsl:text>\t\r\n\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t<xsl:text>}_{</xsl:text>\r\n\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t<xsl:text>}^{</xsl:text>\t\r\n\t<xsl:apply-templates select=\"./*[3]\"/>\r\n\t<xsl:text>}</xsl:text>\t\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:msup\">\r\n\t<xsl:text>{</xsl:text>\t\r\n\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t<xsl:text>}^{</xsl:text>\t\r\n\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t<xsl:text>}</xsl:text>\t\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:msub\">\r\n\t<xsl:text>{</xsl:text>\t\r\n\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t<xsl:text>}_{</xsl:text>\t\r\n\t<xsl:apply-templates select=\"./*[2]\"/>\r\n\t<xsl:text>}</xsl:text>\t\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mmultiscripts\" mode=\"mprescripts\">\r\n\t<xsl:for-each select=\"m:mprescripts/following-sibling::*\">\r\n\t\t<xsl:if test=\"position() mod 2 and local-name(.)!='none'\">\r\n\t\t\t<xsl:text>{}_{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t\t<xsl:if test=\"not(position() mod 2) and local-name(.)!='none'\">\r\n\t\t\t<xsl:text>{}^{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t<xsl:for-each select=\"m:mprescripts/preceding-sibling::*[position()!=last()]\">\r\n\t\t<xsl:if test=\"position()>2 and local-name(.)!='none'\">\r\n\t\t\t<xsl:text>{}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t\t<xsl:if test=\"position() mod 2 and local-name(.)!='none'\">\r\n\t\t\t<xsl:text>_{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t\t<xsl:if test=\"not(position() mod 2) and local-name(.)!='none'\">\r\n\t\t\t<xsl:text>^{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t</xsl:for-each>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mmultiscripts\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"m:mprescripts\">\r\n\t\t\t<xsl:apply-templates select=\".\" mode=\"mprescripts\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:apply-templates select=\"./*[1]\"/>\r\n\t\t\t<xsl:for-each select=\"*[position()>1]\">\r\n\t\t\t\t<xsl:if test=\"position()>2 and local-name(.)!='none'\">\r\n\t\t\t\t\t<xsl:text>{}</xsl:text>\t\r\n\t\t\t\t</xsl:if>\r\n\t\t\t\t<xsl:if test=\"position() mod 2 and local-name(.)!='none'\">\r\n\t\t\t\t\t<xsl:text>_{</xsl:text>\t\r\n\t\t\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t\t\t</xsl:if>\r\n\t\t\t\t<xsl:if test=\"not(position() mod 2) and local-name(.)!='none'\">\r\n\t\t\t\t\t<xsl:text>^{</xsl:text>\t\r\n\t\t\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t\t\t</xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n<!--xsl:include href=\"tables.xsl\"/-->\r\n<xsl:template match=\"m:mtd[@columnspan]\">\r\n\t<xsl:text>\\multicolumn{</xsl:text>\r\n\t<xsl:value-of select=\"@columnspan\"/>\r\n\t<xsl:text>}{c}{</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:if test=\"count(following-sibling::*)>0\">\r\n\t\t<xsl:text>&amp; </xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n\r\n<xsl:template match=\"m:mtd\">\r\n\t<xsl:if test=\"@columnalign='right' or @columnalign='center'\">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test=\"@columnalign='left' or @columnalign='center'\">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"count(following-sibling::*)>0\">\r\n<!--    this test valid for Sablotron, another form - test=\"not(position()=last())\".\r\n\tAlso for m:mtd[@columnspan] and m:mtr  -->\r\n\t\t<xsl:text>&amp; </xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mtr\">\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test=\"count(following-sibling::*)>0\">\r\n\t\t<xsl:text>\\\\ </xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:mtable\">\r\n\t<xsl:text>\\begin{array}{</xsl:text>\r\n\t<xsl:if test=\"@frame='solid'\">\r\n\t\t<xsl:text>|</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:variable name=\"numbercols\" select=\"count(./m:mtr[1]/m:mtd[not(@columnspan)])+sum(./m:mtr[1]/m:mtd/@columnspan)\"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"@columnalign\">\r\n\t\t\t<xsl:variable name=\"colalign\">\r\n\t\t\t\t<xsl:call-template name=\"colalign\">\r\n\t\t\t\t\t<xsl:with-param name=\"colalign\" select=\"@columnalign\"/>\r\n\t\t\t\t</xsl:call-template>\r\n\t\t\t</xsl:variable>\r\n\t\t\t<xsl:choose>\r\n\t\t\t\t<xsl:when test=\"string-length($colalign) > $numbercols\">\r\n\t\t\t\t\t<xsl:value-of select=\"substring($colalign,1,$numbercols)\"/>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:when test=\"string-length($colalign) &lt; $numbercols\">\r\n\t\t\t\t\t<xsl:value-of select=\"$colalign\"/>\r\n\t\t\t\t\t<xsl:call-template name=\"generate-string\">\r\n\t\t\t\t\t\t<xsl:with-param name=\"text\" select=\"substring($colalign,string-length($colalign))\"/>\r\n\t\t\t\t\t\t<xsl:with-param name=\"count\" select=\"$numbercols - string-length($colalign)\"/>\r\n\t\t\t\t\t</xsl:call-template>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:otherwise>\r\n\t\t\t\t\t<xsl:value-of select=\"$colalign\"/>\r\n\t\t\t\t</xsl:otherwise>\r\n\t\t\t</xsl:choose>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:call-template name=\"generate-string\">\r\n\t\t\t\t<xsl:with-param name=\"text\" select=\"'c'\"/>\r\n\t\t\t\t<xsl:with-param name=\"count\" select=\"$numbercols\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:if test=\"@frame='solid'\">\r\n\t\t<xsl:text>|</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:if test=\"@frame='solid'\">\r\n\t\t<xsl:text>\\hline </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test=\"@frame='solid'\">\r\n\t\t<xsl:text>\\\\ \\hline</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>\\end{array}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"colalign\">\r\n\t<xsl:param name=\"colalign\"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"contains($colalign,' ')\">\r\n\t\t\t<xsl:value-of select=\"substring($colalign,1,1)\"/>\r\n\t\t\t<xsl:call-template name=\"colalign\">\r\n\t\t\t\t<xsl:with-param name=\"colalign\" select=\"substring-after($colalign,' ')\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:value-of select=\"substring($colalign,1,1)\"/>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"generate-string\">\r\n<!-- template from XSLT Standard Library v1.1 -->\r\n    <xsl:param name=\"text\"/>\r\n    <xsl:param name=\"count\"/>\r\n\r\n    <xsl:choose>\r\n      <xsl:when test=\"string-length($text) = 0 or $count &lt;= 0\"/>\r\n\r\n      <xsl:otherwise>\r\n\t<xsl:value-of select=\"$text\"/>\r\n\t<xsl:call-template name=\"generate-string\">\r\n\t  <xsl:with-param name=\"text\" select=\"$text\"/>\r\n\t  <xsl:with-param name=\"count\" select=\"$count - 1\"/>\r\n\t</xsl:call-template>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n</xsl:template>\r\n<!--xsl:include href=\"entities.xsl\"/-->\r\n\r\n<xsl:template name=\"replaceEntities\">\r\n\t<xsl:param name=\"content\"/>\r\n\t<xsl:if test=\"string-length($content)>0\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"$content ='sin' or $content ='cos' or $content='tan' or $content ='sec' or $content ='csc' or $content ='cot' or $content ='sinh' or $content ='cosh' or $content ='tanh' or $content ='coth' or $content ='arcsin' or $content ='arccos' or $content ='arctan' or $content ='ln'\"><xsl:text>\\</xsl:text><xsl:value-of select=\"$content\" /></xsl:when><xsl:when test=\"starts-with($content,'&#x0025B;')\"><xsl:value-of select=\"'\\varepsilon '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0025B;')\"/></xsl:call-template></xsl:when>\t<!--/varepsilon -->\r\n\r\n<!-- ====================================================================== -->\r\n<!-- \tUnicode 3.2\r\n\tGreek\r\n\tRange: 0370-03FF\r\n\thttp://www.unicode.org/charts/PDF/U0370.pdf\t                    -->\r\n<!-- ====================================================================== -->\t\r\n\t\t<xsl:when test=\"starts-with($content,'&#x00393;')\"><xsl:value-of select=\"'\\Gamma '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x00393;')\"/></xsl:call-template></xsl:when>\t<!--/Gamma capital Gamma, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x00394;')\"><xsl:value-of select=\"'\\Delta '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x00394;')\"/></xsl:call-template></xsl:when>\t<!--/Delta capital Delta, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x00398;')\"><xsl:value-of select=\"'\\Theta '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x00398;')\"/></xsl:call-template></xsl:when>\t<!--/Theta capital Theta, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0039B;')\"><xsl:value-of select=\"'\\Lambda '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0039B;')\"/></xsl:call-template></xsl:when>\t<!--/Lambda capital Lambda, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0039E;')\"><xsl:value-of select=\"'\\Xi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0039E;')\"/></xsl:call-template></xsl:when>\t<!--/Xi capital Xi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003A0;')\"><xsl:value-of select=\"'\\Pi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003A0;')\"/></xsl:call-template></xsl:when>\t<!--/Pi capital Pi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003A3;')\"><xsl:value-of select=\"'\\Sigma '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003A3;')\"/></xsl:call-template></xsl:when>\t<!--/Sigma capital Sigma, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003A6;')\"><xsl:value-of select=\"'\\Phi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003A6;')\"/></xsl:call-template></xsl:when>\t<!--/Phi capital Phi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003A8;')\"><xsl:value-of select=\"'\\Psi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003A8;')\"/></xsl:call-template></xsl:when>\t<!--/Psi capital Psi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003A9;')\"><xsl:value-of select=\"'\\Omega '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003A9;')\"/></xsl:call-template></xsl:when>\t<!--/Omega capital Omega, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B1;')\"><xsl:value-of select=\"'\\alpha '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B1;')\"/></xsl:call-template></xsl:when>\t<!--/alpha small alpha, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B2;')\"><xsl:value-of select=\"'\\beta '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B2;')\"/></xsl:call-template></xsl:when>\t<!--/beta small beta, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B3;')\"><xsl:value-of select=\"'\\gamma '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B3;')\"/></xsl:call-template></xsl:when>\t<!--/gamma small gamma, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B4;')\"><xsl:value-of select=\"'\\delta '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B4;')\"/></xsl:call-template></xsl:when>\t<!--/delta small delta, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B5;')\"><xsl:value-of select=\"'\\epsilon '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B5;')\"/></xsl:call-template></xsl:when>\t<!--/straightepsilon, small epsilon, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B6;')\"><xsl:value-of select=\"'\\zeta '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B6;')\"/></xsl:call-template></xsl:when>\t<!--/zeta small zeta, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B7;')\"><xsl:value-of select=\"'\\eta '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B7;')\"/></xsl:call-template></xsl:when>\t<!--/eta small eta, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B8;')\"><xsl:value-of select=\"'\\theta '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B8;')\"/></xsl:call-template></xsl:when>\t<!--/theta straight theta, small theta, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003B9;')\"><xsl:value-of select=\"'\\iota '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003B9;')\"/></xsl:call-template></xsl:when>\t<!--/iota small iota, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003BA;')\"><xsl:value-of select=\"'\\kappa '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003BA;')\"/></xsl:call-template></xsl:when>\t<!--/kappa small kappa, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003BB;')\"><xsl:value-of select=\"'\\lambda '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003BB;')\"/></xsl:call-template></xsl:when>\t<!--/lambda small lambda, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003BC;')\"><xsl:value-of select=\"'\\mu '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003BC;')\"/></xsl:call-template></xsl:when>\t<!--/mu small mu, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003BD;')\"><xsl:value-of select=\"'\\nu '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003BD;')\"/></xsl:call-template></xsl:when>\t<!--/nu small nu, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003BE;')\"><xsl:value-of select=\"'\\xi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003BE;')\"/></xsl:call-template></xsl:when>\t<!--/xi small xi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C0;')\"><xsl:value-of select=\"'\\pi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C0;')\"/></xsl:call-template></xsl:when>\t<!--/pi small pi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C1;')\"><xsl:value-of select=\"'\\rho '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C1;')\"/></xsl:call-template></xsl:when>\t<!--/rho small rho, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C2;')\"><xsl:value-of select=\"'\\varsigma '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C2;')\"/></xsl:call-template></xsl:when>\t<!--/varsigma -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C3;')\"><xsl:value-of select=\"'\\sigma '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C3;')\"/></xsl:call-template></xsl:when>\t<!--/sigma small sigma, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C4;')\"><xsl:value-of select=\"'\\tau '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C4;')\"/></xsl:call-template></xsl:when>\t<!--/tau small tau, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C5;')\"><xsl:value-of select=\"'\\upsilon '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C5;')\"/></xsl:call-template></xsl:when>\t<!--/upsilon small upsilon, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C6;')\"><xsl:value-of select=\"'\\phi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C6;')\"/></xsl:call-template></xsl:when>\t<!--/straightphi - small phi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C7;')\"><xsl:value-of select=\"'\\chi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C7;')\"/></xsl:call-template></xsl:when>\t<!--/chi small chi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C8;')\"><xsl:value-of select=\"'\\psi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C8;')\"/></xsl:call-template></xsl:when>\t<!--/psi small psi, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003C9;')\"><xsl:value-of select=\"'\\omega '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003C9;')\"/></xsl:call-template></xsl:when>\t<!--/omega small omega, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003D1;')\"><xsl:value-of select=\"'\\vartheta '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003D1;')\"/></xsl:call-template></xsl:when>\t<!--/vartheta - curly or open theta -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003D2;')\"><xsl:value-of select=\"'\\Upsilon '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003D2;')\"/></xsl:call-template></xsl:when>\t<!--/Upsilon capital Upsilon, Greek -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003D5;')\"><xsl:value-of select=\"'\\varphi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003D5;')\"/></xsl:call-template></xsl:when>\t<!--/varphi - curly or open phi -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003D6;')\"><xsl:value-of select=\"'\\varpi '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003D6;')\"/></xsl:call-template></xsl:when>\t\t<!--/varpi -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003F0;')\"><xsl:value-of select=\"'\\varkappa '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003F0;')\"/></xsl:call-template></xsl:when>\t<!--/varkappa -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x003F1;')\"><xsl:value-of select=\"'\\varrho '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x003F1;')\"/></xsl:call-template></xsl:when>\t<!--/varrho -->\r\n\t\t\r\n<!-- ====================================================================== -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0200B;')\"><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0200B;')\"/></xsl:call-template></xsl:when>\t\t\t\t\t\t<!--short form of  &InvisibleComma; -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02026;')\"><xsl:value-of select=\"'\\dots '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02026;')\"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02032;')\"><xsl:value-of select=\"'\\prime '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02032;')\"/></xsl:call-template></xsl:when>\t\t<!--/prime prime or minute -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02061;')\"><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02061;')\"/></xsl:call-template></xsl:when>\t\t\t\t\t\t<!-- ApplyFunction -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02062;')\"><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02062;')\"/></xsl:call-template></xsl:when>\t\t\t\t\t\t<!-- InvisibleTimes -->\r\n<!-- ====================================================================== -->\r\n<!-- \tUnicode 3.2\r\n\tLetterlike Symbols\r\n\tRange: 2100-214F\r\n\thttp://www.unicode.org/charts/PDF/U2100.pdf\t                    -->\r\n<!-- ====================================================================== -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0210F;&#x0FE00;')\"><xsl:value-of select=\"'\\hbar '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0210F;&#x0FE00;')\"/></xsl:call-template></xsl:when>\t<!--/hbar - Planck's over 2pi -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0210F;')\"><xsl:value-of select=\"'\\hslash '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0210F;')\"/></xsl:call-template></xsl:when>\t<!--/hslash - variant Planck's over 2pi --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02111;')\"><xsl:value-of select=\"'\\Im '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02111;')\"/></xsl:call-template></xsl:when>\t\t<!--/Im - imaginary   -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02113;')\"><xsl:value-of select=\"'\\ell '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02113;')\"/></xsl:call-template></xsl:when>\t\t<!--/ell - cursive small l -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02118;')\"><xsl:value-of select=\"'\\wp '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02118;')\"/></xsl:call-template></xsl:when>\t\t<!--/wp - Weierstrass p -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0211C;')\"><xsl:value-of select=\"'\\Re '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0211C;')\"/></xsl:call-template></xsl:when>\t\t<!--/Re - real -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02127;')\"><xsl:value-of select=\"'\\mho '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02127;')\"/></xsl:call-template></xsl:when>\t\t<!--/mho - conductance -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02135;')\"><xsl:value-of select=\"'\\aleph '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02135;')\"/></xsl:call-template></xsl:when>\t\t<!--/aleph aleph, Hebrew -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02136;')\"><xsl:value-of select=\"'\\beth '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02136;')\"/></xsl:call-template></xsl:when>\t\t<!--/beth - beth, Hebrew --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02137;')\"><xsl:value-of select=\"'\\gimel '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02137;')\"/></xsl:call-template></xsl:when>\t\t<!--/gimel - gimel, Hebrew --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02138;')\"><xsl:value-of select=\"'\\daleth '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02138;')\"/></xsl:call-template></xsl:when>\t<!--/daleth - daleth, Hebrew --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02145;')\"><xsl:value-of select=\"'D'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02145;')\"/></xsl:call-template></xsl:when>\t\t<!--D for use in differentials, e.g., within integrals -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02146;')\"><xsl:value-of select=\"'d'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02146;')\"/></xsl:call-template></xsl:when>\t\t<!--d for use in differentials, e.g., within integrals -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02147;')\"><xsl:value-of select=\"'e'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02147;')\"/></xsl:call-template></xsl:when>\t\t<!--e use for the exponential base of the natural logarithms -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02148;')\"><xsl:value-of select=\"'i'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02148;')\"/></xsl:call-template></xsl:when>\t\t<!--i for use as a square root of -1 -->\r\n\r\n<!-- ====================================================================== -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02192;')\"><xsl:value-of select=\"'\\to '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02192;')\"/></xsl:call-template></xsl:when>\t\t<!--/rightarrow /to A: =rightward arrow -->\r\n\t\t\r\n<!-- ====================================================================== -->\r\n<!-- \tUnicode 3.2\r\n\tMathematical Operators\r\n\tRange: 2200-22FF\r\n\thttp://www.unicode.org/charts/PDF/U2200.pdf                         -->\r\n<!-- ====================================================================== -->\t\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02200;')\"><xsl:value-of select=\"'\\forall '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02200;')\"/></xsl:call-template></xsl:when>\t<!--/forall for all -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02201;')\"><xsl:value-of select=\"'\\complement '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02201;')\"/></xsl:call-template></xsl:when>\t<!--/complement - complement sign --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02202;')\"><xsl:value-of select=\"'\\partial '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02202;')\"/></xsl:call-template></xsl:when>\t<!--/partial partial differential -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02203;')\"><xsl:value-of select=\"'\\exists '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02203;')\"/></xsl:call-template></xsl:when>\t<!--/exists at least one exists -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02204;')\"><xsl:value-of select=\"'\\nexists '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02204;')\"/></xsl:call-template></xsl:when>\t<!--/nexists - negated exists --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02205;&#x0FE00;')\"><xsl:value-of select=\"'\\emptyset '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02205;&#x0FE00;')\"/></xsl:call-template></xsl:when>\t<!--/emptyset - zero, slash -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02205;')\"><xsl:value-of select=\"'\\varnothing '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02205;')\"/></xsl:call-template></xsl:when>\t<!--/varnothing - circle, slash --> <!-- Required amssymb -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02206;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02206;')\"/></xsl:call-template></xsl:when>-->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02207;')\"><xsl:value-of select=\"'\\nabla '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02207;')\"/></xsl:call-template></xsl:when>\t\t<!--/nabla del, Hamilton operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02208;')\"><xsl:value-of select=\"'\\in '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02208;')\"/></xsl:call-template></xsl:when>\t\t<!--/in R: set membership  -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02209;')\"><xsl:value-of select=\"'\\notin '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02209;')\"/></xsl:call-template></xsl:when>\t\t<!--/notin N: negated set membership -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0220B;')\"><xsl:value-of select=\"'\\ni '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0220B;')\"/></xsl:call-template></xsl:when>\t\t<!--/ni /owns R: contains -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0220C;')\"><xsl:value-of select=\"'\\not\\ni '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0220C;')\"/></xsl:call-template></xsl:when>\t<!--negated contains -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0220F;')\"><xsl:value-of select=\"'\\prod '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0220F;')\"/></xsl:call-template></xsl:when>\t\t<!--/prod L: product operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02210;')\"><xsl:value-of select=\"'\\coprod '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02210;')\"/></xsl:call-template></xsl:when>\t<!--/coprod L: coproduct operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02211;')\"><xsl:value-of select=\"'\\sum '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02211;')\"/></xsl:call-template></xsl:when>\t\t<!--/sum L: summation operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02212;')\"><xsl:value-of select=\"'-'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02212;')\"/></xsl:call-template></xsl:when>\t\t<!--B: minus sign -->\t\t\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02213;')\"><xsl:value-of select=\"'\\mp '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02213;')\"/></xsl:call-template></xsl:when>\t\t<!--/mp B: minus-or-plus sign -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02214;')\"><xsl:value-of select=\"'\\dotplus '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02214;')\"/></xsl:call-template></xsl:when>\t<!--/dotplus B: plus sign, dot above --> <!-- Required amssymb -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02215;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02215;')\"/></xsl:call-template></xsl:when>-->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02216;')\"><xsl:value-of select=\"'\\setminus '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02216;')\"/></xsl:call-template></xsl:when>\t<!--/setminus B: reverse solidus -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02217;')\"><xsl:value-of select=\"'\\ast '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02217;')\"/></xsl:call-template></xsl:when>\t\t<!--low asterisk -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02218;')\"><xsl:value-of select=\"'\\circ '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02218;')\"/></xsl:call-template></xsl:when>\t\t<!--/circ B: composite function (small circle) -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02219;')\"><xsl:value-of select=\"'\\bullet '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02219;')\"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0221A;')\"><xsl:value-of select=\"'\\surd '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0221A;')\"/></xsl:call-template></xsl:when>\t\t<!--/surd radical -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0221D;')\"><xsl:value-of select=\"'\\propto '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0221D;')\"/></xsl:call-template></xsl:when>\t<!--/propto R: is proportional to -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0221E;')\"><xsl:value-of select=\"'\\infty '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0221E;')\"/></xsl:call-template></xsl:when>\t\t<!--/infty infinity -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0221F;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0221F;')\"/></xsl:call-template></xsl:when>\t\tright (90 degree) angle -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02220;')\"><xsl:value-of select=\"'\\angle '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02220;')\"/></xsl:call-template></xsl:when>\t\t<!--/angle - angle -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02221;')\"><xsl:value-of select=\"'\\measuredangle '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02221;')\"/></xsl:call-template></xsl:when>\t<!--/measuredangle - angle-measured -->\t<!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02222;')\"><xsl:value-of select=\"'\\sphericalangle '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02222;')\"/></xsl:call-template></xsl:when><!--/sphericalangle angle-spherical -->\t<!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02223;')\"><xsl:value-of select=\"'\\mid '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02223;')\"/></xsl:call-template></xsl:when>\t\t<!--/mid R: -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02224;&#x0FE00;')\"><xsl:value-of select=\"'\\nshortmid '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02224;&#x0FE00;')\"/></xsl:call-template></xsl:when>\t<!--/nshortmid --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02224;')\"><xsl:value-of select=\"'\\nmid '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02224;')\"/></xsl:call-template></xsl:when>\t\t<!--/nmid --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02225;')\"><xsl:value-of select=\"'\\parallel '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02225;')\"/></xsl:call-template></xsl:when>\t<!--/parallel R: parallel -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02226;&#x0FE00;')\"><xsl:value-of select=\"'\\nshortparallel '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02226;&#x0FE00;')\"/></xsl:call-template></xsl:when>\t<!--/nshortparallel N: not short par --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02226;')\"><xsl:value-of select=\"'\\nparallel '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02226;')\"/></xsl:call-template></xsl:when>\t<!--/nparallel N: not parallel --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02227;')\"><xsl:value-of select=\"'\\wedge '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02227;')\"/></xsl:call-template></xsl:when>\t\t<!--/wedge /land B: logical and -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02228;')\"><xsl:value-of select=\"'\\vee '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02228;')\"/></xsl:call-template></xsl:when>\t\t<!--/vee /lor B: logical or -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02229;')\"><xsl:value-of select=\"'\\cap '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02229;')\"/></xsl:call-template></xsl:when>\t\t<!--/cap B: intersection -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0222A;')\"><xsl:value-of select=\"'\\cup '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0222A;')\"/></xsl:call-template></xsl:when>\t\t<!--/cup B: union or logical sum -->\t\t\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0222B;')\"><xsl:value-of select=\"'\\int '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0222B;')\"/></xsl:call-template></xsl:when>\t\t<!--/int L: integral operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0222C;')\"><xsl:value-of select=\"'\\iint '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0222C;')\"/></xsl:call-template></xsl:when>\t\t<!--double integral operator --> <!-- Required amsmath -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0222D;')\"><xsl:value-of select=\"'\\iiint '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0222D;')\"/></xsl:call-template></xsl:when>\t\t<!--/iiint triple integral operator -->\t<!-- Required amsmath -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0222E;')\"><xsl:value-of select=\"'\\oint '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0222E;')\"/></xsl:call-template></xsl:when>\t\t<!--/oint L: contour integral operator -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0222F;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0222F;')\"/></xsl:call-template></xsl:when>-->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02230;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02230;')\"/></xsl:call-template></xsl:when>-->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02231;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02231;')\"/></xsl:call-template></xsl:when>-->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02232;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02232;')\"/></xsl:call-template></xsl:when>-->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02233;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02233;')\"/></xsl:call-template></xsl:when>-->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02234;')\"><xsl:value-of select=\"'\\therefore '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02234;')\"/></xsl:call-template></xsl:when>\t<!--/therefore R: therefore --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02235;')\"><xsl:value-of select=\"'\\because '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02235;')\"/></xsl:call-template></xsl:when>\t<!--/because R: because --> <!-- Required amssymb -->\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x02236;')\"><xsl:value-of select=\"':'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02236;')\"/></xsl:call-template></xsl:when>\t\t<!--/ratio -->\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x02237;')\"><xsl:value-of select=\"'\\colon\\colon '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02237;')\"/></xsl:call-template></xsl:when>\t<!--/Colon, two colons -->\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x02238;')\"><xsl:value-of select=\"'\\dot{-}'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02238;')\"/></xsl:call-template></xsl:when>\t\t<!--/dotminus B: minus sign, dot above -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02239;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02239;')\"/></xsl:call-template></xsl:when>\t\t-->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0223A;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0223A;')\"/></xsl:call-template></xsl:when>\t\tminus with four dots, geometric properties -->\t\t\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0223B;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0223B;')\"/></xsl:call-template></xsl:when>\t\thomothetic -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0223C;')\"><xsl:value-of select=\"'\\sim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0223C;')\"/></xsl:call-template></xsl:when>\t\t<!--/sim R: similar -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0223D;')\"><xsl:value-of select=\"'\\backsim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0223D;')\"/></xsl:call-template></xsl:when>\t<!--/backsim R: reverse similar --> <!-- Required amssymb -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0223E;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0223E;')\"/></xsl:call-template></xsl:when>\t\tmost positive -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0223F;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0223F;')\"/></xsl:call-template></xsl:when>\t\tac current -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02240;')\"><xsl:value-of select=\"'\\wr '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02240;')\"/></xsl:call-template></xsl:when>\t\t<!--/wr B: wreath product -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02241;')\"><xsl:value-of select=\"'\\nsim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02241;')\"/></xsl:call-template></xsl:when>\t\t<!--/nsim N: not similar --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02242;')\"><xsl:value-of select=\"'\\eqsim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02242;')\"/></xsl:call-template></xsl:when>\t\t<!--/esim R: equals, similar --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02243;')\"><xsl:value-of select=\"'\\simeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02243;')\"/></xsl:call-template></xsl:when>\t\t<!--/simeq R: similar, equals -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02244;')\"><xsl:value-of select=\"'\\not\\simeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02244;')\"/></xsl:call-template></xsl:when>\t<!--/nsimeq N: not similar, equals -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02245;')\"><xsl:value-of select=\"'\\cong '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02245;')\"/></xsl:call-template></xsl:when>\t\t<!--/cong R: congruent with -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02246;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02246;')\"/></xsl:call-template></xsl:when>\t\tsimilar, not equals -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02247;')\"><xsl:value-of select=\"'\\ncong '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02247;')\"/></xsl:call-template></xsl:when>\t\t<!--/ncong N: not congruent with --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02248;')\"><xsl:value-of select=\"'\\approx '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02248;')\"/></xsl:call-template></xsl:when>\t<!--/approx R: approximate -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02249;&#x00338;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02249;&#x00338;')\"/></xsl:call-template></xsl:when>\tnot, vert, approximate -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02249;')\"><xsl:value-of select=\"'\\not\\approx '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02249;')\"/></xsl:call-template></xsl:when>\t<!--/napprox N: not approximate -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0224A;')\"><xsl:value-of select=\"'\\approxeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0224A;')\"/></xsl:call-template></xsl:when>\t<!--/approxeq R: approximate, equals --> <!-- Required amssymb -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0224B;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0224B;')\"/></xsl:call-template></xsl:when>\t\tapproximately identical to -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0224C;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0224C;')\"/></xsl:call-template></xsl:when>\t\t/backcong R: reverse congruent -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0224D;')\"><xsl:value-of select=\"'\\asymp '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0224D;')\"/></xsl:call-template></xsl:when>\t\t<!--/asymp R: asymptotically equal to -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0224E;')\"><xsl:value-of select=\"'\\Bumpeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0224E;')\"/></xsl:call-template></xsl:when>\t<!--/Bumpeq R: bumpy equals --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0224F;')\"><xsl:value-of select=\"'\\bumpeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0224F;')\"/></xsl:call-template></xsl:when>\t<!--/bumpeq R: bumpy equals, equals --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02250;')\"><xsl:value-of select=\"'\\doteq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02250;')\"/></xsl:call-template></xsl:when>\t\t<!--/doteq R: equals, single dot above -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02251;')\"><xsl:value-of select=\"'\\doteqdot '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02251;')\"/></xsl:call-template></xsl:when>\t<!--/doteqdot /Doteq R: eq, even dots --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02252;')\"><xsl:value-of select=\"'\\fallingdotseq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02252;')\"/></xsl:call-template></xsl:when>\t<!--/fallingdotseq R: eq, falling dots --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02253;')\"><xsl:value-of select=\"'\\risingdotseq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02253;')\"/></xsl:call-template></xsl:when>\t<!--/risingdotseq R: eq, rising dots --> <!-- Required amssymb -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02254;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02254;')\"/></xsl:call-template></xsl:when>\t\t/coloneq R: colon, equals -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02255;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02255;')\"/></xsl:call-template></xsl:when>\t\t/eqcolon R: equals, colon -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02256;')\"><xsl:value-of select=\"'\\eqcirc '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02256;')\"/></xsl:call-template></xsl:when>\t<!--/eqcirc R: circle on equals sign --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02257;')\"><xsl:value-of select=\"'\\circeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02257;')\"/></xsl:call-template></xsl:when>\t<!--/circeq R: circle, equals --> <!-- Required amssymb -->\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x02258;')\"><xsl:value-of select=\"'\\stackrel{\\frown}{=}'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02258;')\"/></xsl:call-template></xsl:when>\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x02259;')\"><xsl:value-of select=\"'\\stackrel{\\wedge}{=}'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02259;')\"/></xsl:call-template></xsl:when>\t<!--/wedgeq R: corresponds to (wedge, equals) -->\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x0225A;')\"><xsl:value-of select=\"'\\stackrel{\\vee}{=}'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0225A;')\"/></xsl:call-template></xsl:when>\t<!--logical or, equals -->\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x0225B;')\"><xsl:value-of select=\"'\\stackrel{\\star}{=}'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0225B;')\"/></xsl:call-template></xsl:when>\t<!--equal, asterisk above -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0225C;')\"><xsl:value-of select=\"'\\triangleq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0225C;')\"/></xsl:call-template></xsl:when>\t<!--/triangleq R: triangle, equals --> <!-- Required amssymb -->\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x0225D;')\"><xsl:value-of select=\"'\\stackrel{\\scriptscriptstyle\\mathrm{def}}{=}'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0225D;')\"/></xsl:call-template></xsl:when>\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x0225E;')\"><xsl:value-of select=\"'\\stackrel{\\scriptscriptstyle\\mathrm{m}}{=}'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0225E;')\"/></xsl:call-template></xsl:when>\t\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x0225F;')\"><xsl:value-of select=\"'\\stackrel{?}{=}'\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0225F;')\"/></xsl:call-template></xsl:when>\t<!--/questeq R: equal with questionmark -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02260;&#x0FE00;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02260;&#x0FE00;')\"/></xsl:call-template></xsl:when>\tnot equal, dot -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02260;')\"><xsl:value-of select=\"'\\ne '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02260;')\"/></xsl:call-template></xsl:when>\t\t<!--/ne /neq R: not equal -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02261;&#x020E5;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02261;&#x020E5;')\"/></xsl:call-template></xsl:when>\treverse not equivalent -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02261;')\"><xsl:value-of select=\"'\\equiv '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02261;')\"/></xsl:call-template></xsl:when>\t\t<!--/equiv R: identical with -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02262;')\"><xsl:value-of select=\"'\\not\\equiv '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02262;')\"/></xsl:call-template></xsl:when>\t<!--/nequiv N: not identical with -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x02263;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02263;')\"/></xsl:call-template></xsl:when>\t\t-->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02264;')\"><xsl:value-of select=\"'\\le '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02264;')\"/></xsl:call-template></xsl:when>\t\t<!--/leq /le R: less-than-or-equal -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02265;')\"><xsl:value-of select=\"'\\ge '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02265;')\"/></xsl:call-template></xsl:when>\t\t<!--/geq /ge R: greater-than-or-equal -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02266;')\"><xsl:value-of select=\"'\\leqq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02266;')\"/></xsl:call-template></xsl:when>\t\t<!--/leqq R: less, double equals --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02267;')\"><xsl:value-of select=\"'\\geqq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02267;')\"/></xsl:call-template></xsl:when>\t\t<!--/geqq R: greater, double equals --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02268;')\"><xsl:value-of select=\"'\\lneqq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02268;')\"/></xsl:call-template></xsl:when>\t\t<!--/lneqq N: less, not double equals --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02269;')\"><xsl:value-of select=\"'\\gneqq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02269;')\"/></xsl:call-template></xsl:when>\t\t<!--/gneqq N: greater, not dbl equals --> <!-- Required amssymb -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0226A;&#x00338;&#x0FE00;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226A;&#x00338;&#x0FE00;')\"/></xsl:call-template></xsl:when>\tnot much less than, variant -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0226A;&#x00338;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226A;&#x00338;')\"/></xsl:call-template></xsl:when>\tnot, vert, much less than -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0226A;')\"><xsl:value-of select=\"'\\ll '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226A;')\"/></xsl:call-template></xsl:when>\t\t<!--/ll R: double less-than sign -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0226B;&#x00338;&#x0FE00;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226B;&#x00338;&#x0FE00;')\"/></xsl:call-template></xsl:when>\tnot much greater than, variant -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x0226B;&#x00338;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226B;&#x00338;')\"/></xsl:call-template></xsl:when>\tnot, vert, much greater than -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0226B;')\"><xsl:value-of select=\"'\\gg '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226B;')\"/></xsl:call-template></xsl:when>\t\t<!--/gg R: dbl greater-than sign -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0226C;')\"><xsl:value-of select=\"'\\between '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226C;')\"/></xsl:call-template></xsl:when>\t<!--/between R: between --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0226D;')\"><xsl:value-of select=\"'\\not\\asymp '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226D;')\"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0226E;')\"><xsl:value-of select=\"'\\nless '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226E;')\"/></xsl:call-template></xsl:when>\t\t<!--/nless N: not less-than --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0226F;')\"><xsl:value-of select=\"'\\ngtr '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0226F;')\"/></xsl:call-template></xsl:when>\t\t<!--/ngtr N: not greater-than --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02270;&#x020E5;')\"><xsl:value-of select=\"'\\nleq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02270;&#x020E5;')\"/></xsl:call-template></xsl:when>\t<!--/nleq N: not less-than-or-equal --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02270;')\"><xsl:value-of select=\"'\\nleqq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02270;')\"/></xsl:call-template></xsl:when>\t\t<!--/nleqq N: not less, dbl equals --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02271;&#x020E5;')\"><xsl:value-of select=\"'\\ngeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02271;&#x020E5;')\"/></xsl:call-template></xsl:when>\t<!--/ngeq N: not greater-than-or-equal --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02271;')\"><xsl:value-of select=\"'\\ngeqq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02271;')\"/></xsl:call-template></xsl:when>\t\t<!--/ngeqq N: not greater, dbl equals --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02272;')\"><xsl:value-of select=\"'\\lesssim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02272;')\"/></xsl:call-template></xsl:when>\t<!--/lesssim R: less, similar --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02273;')\"><xsl:value-of select=\"'\\gtrsim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02273;')\"/></xsl:call-template></xsl:when>\t<!--/gtrsim R: greater, similar --> <!-- Required amssymb -->\t\t\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02274;')\"><xsl:value-of select=\"'\\not\\lesssim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02274;')\"/></xsl:call-template></xsl:when>\t<!--not less, similar --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02275;')\"><xsl:value-of select=\"'\\not\\gtrsim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02275;')\"/></xsl:call-template></xsl:when>\t<!--not greater, similar --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02276;')\"><xsl:value-of select=\"'\\lessgtr '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02276;')\"/></xsl:call-template></xsl:when>\t<!--/lessgtr R: less, greater --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02277;')\"><xsl:value-of select=\"'\\gtrless '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02277;')\"/></xsl:call-template></xsl:when>\t<!--/gtrless R: greater, less --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02278;')\"><xsl:value-of select=\"'\\not\\lessgtr '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02278;')\"/></xsl:call-template></xsl:when>\t<!--not less, greater --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02279;')\"><xsl:value-of select=\"'\\not\\gtrless '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02279;')\"/></xsl:call-template></xsl:when>\t<!--not greater, less --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0227A;')\"><xsl:value-of select=\"'\\prec '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0227A;')\"/></xsl:call-template></xsl:when>\t\t<!--/prec R: precedes -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0227B;')\"><xsl:value-of select=\"'\\succ '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0227B;')\"/></xsl:call-template></xsl:when>\t\t<!--/succ R: succeeds -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0227C;')\"><xsl:value-of select=\"'\\preccurlyeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0227C;')\"/></xsl:call-template></xsl:when>\t<!--/preccurlyeq R: precedes, curly eq --> <!-- Required amssymb -->\t\t\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0227D;')\"><xsl:value-of select=\"'\\succcurlyeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0227D;')\"/></xsl:call-template></xsl:when>\t<!--/succcurlyeq R: succeeds, curly eq --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0227E;')\"><xsl:value-of select=\"'\\precsim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0227E;')\"/></xsl:call-template></xsl:when>\t<!--/precsim R: precedes, similar --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0227F;')\"><xsl:value-of select=\"'\\succsim '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0227F;')\"/></xsl:call-template></xsl:when>\t<!--/succsim R: succeeds, similar --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02280;')\"><xsl:value-of select=\"'\\nprec '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02280;')\"/></xsl:call-template></xsl:when>\t\t<!--/nprec N: not precedes --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02281;')\"><xsl:value-of select=\"'\\nsucc '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02281;')\"/></xsl:call-template></xsl:when>\t\t<!--/nsucc N: not succeeds --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02282;')\"><xsl:value-of select=\"'\\subset '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02282;')\"/></xsl:call-template></xsl:when>\t<!--/subset R: subset or is implied by -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02283;')\"><xsl:value-of select=\"'\\supset '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02283;')\"/></xsl:call-template></xsl:when>\t<!--/supset R: superset or implies -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02284;')\"><xsl:value-of select=\"'\\not\\subset '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02284;')\"/></xsl:call-template></xsl:when>\t<!--not subset -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02285;')\"><xsl:value-of select=\"'\\not\\supset '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02285;')\"/></xsl:call-template></xsl:when>\t<!--not superset -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02286;')\"><xsl:value-of select=\"'\\subseteq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02286;')\"/></xsl:call-template></xsl:when>\t<!--/subseteq R: subset, equals -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02287;')\"><xsl:value-of select=\"'\\supseteq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02287;')\"/></xsl:call-template></xsl:when>\t<!--/supseteq R: superset, equals -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0228E;')\"><xsl:value-of select=\"'\\uplus '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0228E;')\"/></xsl:call-template></xsl:when>\t\t<!--/uplus B: plus sign in union -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02293;')\"><xsl:value-of select=\"'\\sqcap '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02293;')\"/></xsl:call-template></xsl:when>\t\t<!--/sqcap B: square intersection -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02294;')\"><xsl:value-of select=\"'\\bigsqcup '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02294;')\"/></xsl:call-template></xsl:when>\t\t<!--/sqcup B: square union -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02295;')\"><xsl:value-of select=\"'\\oplus '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02295;')\"/></xsl:call-template></xsl:when>\t\t<!--/oplus B: plus sign in circle -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02296;')\"><xsl:value-of select=\"'\\ominus '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02296;')\"/></xsl:call-template></xsl:when>\t<!--/ominus B: minus sign in circle -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02297;')\"><xsl:value-of select=\"'\\otimes '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02297;')\"/></xsl:call-template></xsl:when>\t<!--/otimes B: multiply sign in circle -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x02298;')\"><xsl:value-of select=\"'\\oslash '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02298;')\"/></xsl:call-template></xsl:when>\t<!--/oslash B: solidus in circle -->\r\n<!-- ? -->\t<xsl:when test=\"starts-with($content,'&#x02299;')\"><xsl:value-of select=\"'\\odot '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x02299;')\"/></xsl:call-template></xsl:when>\t\t<!--/odot B: middle dot in circle --> <!--/bigodot L: circle dot operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x0229F;')\"><xsl:value-of select=\"'\\boxminus '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x0229F;')\"/></xsl:call-template></xsl:when>\t<!--/boxminus B: minus sign in box --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022A4;')\"><xsl:value-of select=\"'\\top '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022A4;')\"/></xsl:call-template></xsl:when>\t\t<!--/top top -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022A5;')\"><xsl:value-of select=\"'\\perp '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022A5;')\"/></xsl:call-template></xsl:when>\t\t<!--/perp R: perpendicular --><!--/bot bottom -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022A6;')\"><xsl:value-of select=\"'\\vdash '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022A6;')\"/></xsl:call-template></xsl:when>\t\t<!--/vdash R: vertical, dash -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022A7;')\"><xsl:value-of select=\"'\\vDash '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022A7;')\"/></xsl:call-template></xsl:when>\t\t<!--/vDash R: vertical, dbl dash --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022A8;')\"><xsl:value-of select=\"'\\models '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022A8;')\"/></xsl:call-template></xsl:when>\t<!--/models R: -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022AA;')\"><xsl:value-of select=\"'\\Vvdash '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022AA;')\"/></xsl:call-template></xsl:when>\t<!--/Vvdash R: triple vertical, dash --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C0;')\"><xsl:value-of select=\"'\\bigwedge '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C0;')\"/></xsl:call-template></xsl:when>\t<!--/bigwedge L: logical or operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C1;')\"><xsl:value-of select=\"'\\bigvee '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C1;')\"/></xsl:call-template></xsl:when>\t<!--/bigcap L: intersection operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C2;')\"><xsl:value-of select=\"'\\bigcap '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C2;')\"/></xsl:call-template></xsl:when>\t<!--/bigvee L: logical and operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C3;')\"><xsl:value-of select=\"'\\bigcup '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C3;')\"/></xsl:call-template></xsl:when>\t<!--/bigcup L: union operator -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C4;')\"><xsl:value-of select=\"'\\diamond '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C4;')\"/></xsl:call-template></xsl:when>\t<!--/diamond B: open diamond -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C5;')\"><xsl:value-of select=\"'\\cdot '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C5;')\"/></xsl:call-template></xsl:when>\t\t<!--/cdot B: small middle dot -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C6;')\"><xsl:value-of select=\"'\\star '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C6;')\"/></xsl:call-template></xsl:when>\t\t<!--/star B: small star, filled -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C7;')\"><xsl:value-of select=\"'\\divideontimes '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C7;')\"/></xsl:call-template></xsl:when>\t<!--/divideontimes B: division on times --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022C8;')\"><xsl:value-of select=\"'\\bowtie '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022C8;')\"/></xsl:call-template></xsl:when>\t<!--/bowtie R: -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022CD;')\"><xsl:value-of select=\"'\\backsimeq '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022CD;')\"/></xsl:call-template></xsl:when>\t<!--/backsimeq R: reverse similar, eq --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022EF;')\"><xsl:value-of select=\"'\\cdots '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022EF;')\"/></xsl:call-template></xsl:when>\t\t<!--/cdots, three dots, centered -->\r\n<!--\t\t<xsl:when test=\"starts-with($content,'&#x022F0;')\"><xsl:value-of select=\"' '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022F0;')\"/></xsl:call-template></xsl:when>\t\tthree dots, ascending -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x022F1;')\"><xsl:value-of select=\"'\\ddots '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x022F1;')\"/></xsl:call-template></xsl:when>\t\t<!--/ddots, three dots, descending -->\r\n\r\n<!-- ====================================================================== -->\t\t\r\n\t\t<xsl:when test=\"starts-with($content,'&#x025A1;')\"><xsl:value-of select=\"'\\Box '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x025A1;')\"/></xsl:call-template></xsl:when>\t<!--/square, square --> <!-- Required amssymb -->\r\n\t\t<xsl:when test=\"starts-with($content,'&#x025AA;')\"><xsl:value-of select=\"'\\blacksquare '\" /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '&#x025AA;')\"/></xsl:call-template></xsl:when>\t<!--/blacksquare, square, filled  --> <!-- Required amssymb -->\r\n\t\t\r\n\t\t<xsl:when test='starts-with($content,\"&apos;\")'><xsl:value-of select='\"\\text{&apos;}\"' /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select='substring-after($content, \"&apos;\")'/></xsl:call-template></xsl:when><!-- \\text required amslatex -->\r\n\t\t<xsl:when test='starts-with($content,\"(\")'><xsl:value-of select='\"\\left(\"' /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '(')\"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test='starts-with($content,\")\")'><xsl:value-of select='\"\\right)\"' /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, ')')\"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test='starts-with($content,\"[\")'><xsl:value-of select='\"\\left[\"' /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '[')\"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test='starts-with($content,\"]\")'><xsl:value-of select='\"\\right]\"' /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, ']')\"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test='starts-with($content,\"{\")'><xsl:value-of select='\"\\left\\{\"' /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '{')\"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test='starts-with($content,\"}\")'><xsl:value-of select='\"\\right\\}\"' /><xsl:call-template name=\"replaceEntities\"><xsl:with-param name=\"content\" select=\"substring-after($content, '}')\"/></xsl:call-template></xsl:when>\r\n\t\t\r\n\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:value-of select=\"substring($content,1,1)\"/>\r\n\t\t\t<xsl:call-template name=\"replaceEntities\">\r\n\t\t\t\t<xsl:with-param name=\"content\" select=\"substring($content, 2)\"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose></xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"replaceMtextEntities\">\r\n\t<xsl:param name=\"content\"/>\r\n\t<xsl:choose>\r\n\t<xsl:when test=\"contains($content,'&#x02009;&#x0200A;&#x0200A;')\">\t<!-- ThickSpace - space of width 5/18 em -->\r\n\t\t<xsl:call-template name=\"replaceMtextEntities\">\r\n\t\t\t<xsl:with-param name=\"content\" select=\"concat(substring-before($content,'&#x02009;&#x0200A;&#x0200A;'),'\\hspace{0.28em}',substring-after($content,'&#x02009;&#x0200A;&#x0200A;'))\"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:when>\r\n\t<xsl:when test=\"contains($content,'&#x02009;')\">\t<!-- ThinSpace - space of width 3/18 em -->\r\n\t\t<xsl:call-template name=\"replaceMtextEntities\">\r\n\t\t\t<xsl:with-param name=\"content\" select=\"concat(substring-before($content,'&#x02009;'),'\\hspace{0.17em}',substring-after($content,'&#x02009;'))\"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:when>\r\n\t<xsl:otherwise>\r\n\t\t<xsl:value-of select=\"normalize-space($content)\"/>\r\n\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<!--xsl:include href=\"cmarkup.xsl\"/-->\r\n<!-- 4.4.1.1 cn -->\r\n<xsl:template match=\"m:cn\"><xsl:apply-templates/></xsl:template>\r\n\r\n<xsl:template match=\"m:cn[@type='complex-cartesian']\">\r\n\t<xsl:apply-templates select=\"text()[1]\"/>\r\n  \t<xsl:text>+</xsl:text>\r\n\t<xsl:apply-templates select=\"text()[2]\"/>\r\n\t<xsl:text>i</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:cn[@type='rational']\">\r\n\t<xsl:apply-templates select=\"text()[1]\"/>\r\n\t<xsl:text>/</xsl:text>\r\n\t<xsl:apply-templates select=\"text()[2]\"/>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:cn[@type='integer' and @base!=10]\">\r\n\t\t<xsl:apply-templates/>\r\n\t\t<xsl:text>_{</xsl:text><xsl:value-of select=\"@base\"/><xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:cn[@type='complex-polar']\">\r\n\t<xsl:apply-templates select=\"text()[1]\"/>\r\n\t<xsl:text>e^{i </xsl:text>\r\n\t<xsl:apply-templates select=\"text()[2]\"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:cn[@type='e-notation']\">\r\n    <xsl:apply-templates select=\"text()[1]\"/>\r\n    <xsl:text>E</xsl:text>\r\n    <xsl:apply-templates select=\"text()[2]\"/>\r\n</xsl:template>\r\n\r\n<!-- 4.4.1.1 ci 4.4.1.2 csymbol -->\r\n<xsl:template match=\"m:ci | m:csymbol\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"string-length(normalize-space(text()))>1\">\r\n\t\t\t<xsl:text>\\mathrm{</xsl:text><xsl:apply-templates/><xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:apply-templates/></xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.1 apply 4.4.2.2 reln -->\r\n<xsl:template match=\"m:apply | m:reln\">\r\n\t<xsl:apply-templates select=\"*[1]\">\r\n\t<!-- <? -->\r\n\t\t<xsl:with-param name=\"p\" select=\"10\"/>\r\n\t</xsl:apply-templates>\r\n\t<!-- ?> -->\r\n \t<xsl:text>(</xsl:text>\r\n\t<xsl:for-each select=\"*[position()>1]\">\r\n\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t<xsl:if test=\"not(position()=last())\"><xsl:text>, </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n \t<xsl:text>)</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.3 fn -->\r\n<xsl:template match=\"m:fn[m:apply[1]]\"> <!-- for m:fn using default rule -->\r\n\t<xsl:text>(</xsl:text><xsl:apply-templates/><xsl:text>)</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.4 interval -->\r\n<xsl:template match=\"m:interval[*[2]]\">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"@closure='open' or @closure='open-closed'\">\r\n\t\t\t<xsl:text>\\left(</xsl:text>\t\t\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\\left[</xsl:text></xsl:otherwise> \r\n\t</xsl:choose>\r\n\t<xsl:apply-templates select=\"*[1]\"/>\r\n\t<xsl:text> , </xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"@closure='open' or @closure='closed-open'\">\r\n\t\t\t<xsl:text>\\right)</xsl:text>\t\t\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\\right]</xsl:text></xsl:otherwise> \r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:interval\">\r\n\t<xsl:text>\\left\\{</xsl:text><xsl:apply-templates/><xsl:text>\\right\\}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.5 inverse -->\r\n<xsl:template match=\"m:apply[*[1][self::m:inverse]]\">\r\n\t<xsl:apply-templates select=\"*[2]\"/><xsl:text>^{(-1)}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.6 sep 4.4.2.7 condition -->\r\n<xsl:template match=\"m:sep | m:condition\"><xsl:apply-templates/></xsl:template>\r\n\r\n<!-- 4.4.2.9 lambda -->\r\n<xsl:template match=\"m:lambda\">\r\n\t<xsl:text>\\mathrm{lambda}\\: </xsl:text>\r\n  \t<xsl:apply-templates select=\"m:bvar/*\"/>\r\n  \t<xsl:text>.\\: </xsl:text>\r\n  <xsl:apply-templates select=\"*[last()]\"/>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.10 compose -->\r\n<xsl:template match=\"m:apply[*[1][self::m:compose]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\circ </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.11 ident -->\r\n<xsl:template match=\"m:ident\"><xsl:text>\\mathrm{id}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.2.12 domain 4.4.2.13 codomain 4.4.2.14 image 4.4.3.21 arg 4.4.3.24 lcm\r\n\t\t4.4.5.9 grad 4.4.5.10 curl 4.4.9.4 median 4.4.9.5 mode-->\r\n<xsl:template match=\"m:domain | m:codomain | m:image | m:arg | m:lcm | m:grad |\r\n\t\t\t\t\t\t\t\t m:curl | m:median | m:mode\">\r\n\t<xsl:text>\\mathop{\\mathrm{</xsl:text>\r\n\t<xsl:value-of select=\"local-name()\"/>\r\n\t<xsl:text>}}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.15 domainofapplication -->\r\n<xsl:template match=\"m:domainofapplication\"/>\r\n\r\n<!-- 4.4.2.16 piecewise -->\r\n<xsl:template match=\"m:piecewise\">\r\n\t<xsl:text>\\begin{cases}</xsl:text>\r\n\t<xsl:apply-templates select=\"m:piece\"/>\r\n\t<xsl:apply-templates select=\"m:otherwise\"/>\r\n\t<xsl:text>\\end{cases}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:piece\">\r\n\t\t<xsl:apply-templates select=\"*[1]\"/>\r\n\t\t<xsl:text> &amp; \\text{if $</xsl:text>\r\n\t\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t\t<xsl:text>$}</xsl:text>\r\n\t\t<xsl:if test=\"not(position()=last()) or ../m:otherwise\"><xsl:text>\\\\ </xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:otherwise\">\r\n\t<xsl:apply-templates select=\"*[1]\"/>\r\n\t<xsl:text> &amp; \\text{otherwise}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.1 quotient -->\r\n<xsl:template match=\"m:apply[*[1][self::m:quotient]]\">\r\n\t<xsl:text>\\left\\lfloor\\frac{</xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t<xsl:text>}{</xsl:text>\r\n\t<xsl:apply-templates select=\"*[3]\"/>\r\n\t<xsl:text>}\\right\\rfloor </xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.2 factorial -->\r\n<xsl:template match=\"m:apply[*[1][self::m:factorial]]\">\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>!</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.3 divide -->\r\n<xsl:template match=\"m:apply[*[1][self::m:divide]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n  <xsl:param name=\"this-p\" select=\"3\"/>\r\n  <xsl:if test=\"$this-p &lt; $p\"><xsl:text>\\left(</xsl:text></xsl:if>\r\n  <xsl:text>\\frac{</xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n<!--\t\t<xsl:with-param name=\"p\" select=\"$this-p\"/>\r\n\t</xsl:apply-templates>-->\r\n\t<xsl:text>}{</xsl:text>\r\n\t<xsl:apply-templates select=\"*[3]\"/>\r\n<!--    \t<xsl:with-param name=\"p\" select=\"$this-p\"/>\r\n\t</xsl:apply-templates>-->\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:if test=\"$this-p &lt; $p\"><xsl:text>\\right)</xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.4 max min -->\r\n<xsl:template match=\"m:apply[*[1][self::m:max or self::m:min]]\">\r\n\t<xsl:text>\\</xsl:text>\r\n\t<xsl:value-of select=\"local-name(*[1])\"/>\r\n\t<xsl:text>\\{</xsl:text>\r\n   <xsl:choose>\r\n\t\t<xsl:when test=\"m:condition\">\r\n   \t\t<xsl:apply-templates select=\"*[last()]\"/>\r\n   \t\t<xsl:text>, </xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"m:condition/node()\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:for-each select=\"*[position() &gt; 1]\">\r\n\t\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t\t<xsl:if test=\"position() !=last()\"><xsl:text> , </xsl:text></xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t</xsl:otherwise>\r\n   </xsl:choose>\r\n\t<xsl:text>\\}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.5  minus-->\r\n<xsl:template match=\"m:apply[*[1][self::m:minus] and count(*)=2]\">\r\n\t<xsl:text>-</xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"5\"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:apply[*[1][self::m:minus] and count(*)&gt;2]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"mo\">-</xsl:with-param>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.6  plus-->\r\n<xsl:template match=\"m:apply[*[1][self::m:plus]]\">\r\n  <xsl:param name=\"p\" select=\"0\"/>\r\n  <xsl:if test=\"$p &gt; 2\">\r\n\t\t<xsl:text>(</xsl:text>\r\n\t</xsl:if>\r\n  <xsl:for-each select=\"*[position()&gt;1]\">\r\n   <xsl:if test=\"position() &gt; 1\">\r\n    <xsl:choose>\r\n      <xsl:when test=\"self::m:apply[*[1][self::m:times] and\r\n      *[2][self::m:apply/*[1][self::m:minus] or self::m:cn[not(m:sep) and\r\n      (number(.) &lt; 0)]]]\">-</xsl:when>\r\n      <xsl:otherwise>+</xsl:otherwise>\r\n    </xsl:choose>\r\n   </xsl:if>   \r\n    <xsl:choose>\r\n      <xsl:when test=\"self::m:apply[*[1][self::m:times] and\r\n      *[2][self::m:cn[not(m:sep) and (number(.) &lt;0)]]]\">\r\n\t\t\t<xsl:value-of select=\"-(*[2])\"/>\r\n\t\t\t<xsl:apply-templates select=\".\">\r\n\t\t     <xsl:with-param name=\"first\" select=\"2\"/>\r\n\t\t     <xsl:with-param name=\"p\" select=\"2\"/>\r\n\t\t   </xsl:apply-templates>\r\n       </xsl:when>\r\n      <xsl:when test=\"self::m:apply[*[1][self::m:times] and\r\n      *[2][self::m:apply/*[1][self::m:minus]]]\">\r\n\t\t\t\t<xsl:apply-templates select=\"./*[2]/*[2]\"/>\r\n\t\t\t\t<xsl:apply-templates select=\".\">\r\n\t\t\t\t\t<xsl:with-param name=\"first\" select=\"2\"/>\r\n\t\t\t\t\t<xsl:with-param name=\"p\" select=\"2\"/>\r\n\t\t\t\t</xsl:apply-templates>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:otherwise>\r\n\t\t\t\t<xsl:apply-templates select=\".\">\r\n\t\t\t\t\t<xsl:with-param name=\"p\" select=\"2\"/>\r\n\t\t\t\t</xsl:apply-templates>\r\n\t\t\t</xsl:otherwise>\r\n\t\t</xsl:choose>\r\n\t</xsl:for-each>\r\n\t<xsl:if test=\"$p &gt; 2\">\r\n\t\t<xsl:text>)</xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.7 power -->\r\n<xsl:template match=\"m:apply[*[1][self::m:power]]\">\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"5\"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>^{</xsl:text>\r\n\t<xsl:apply-templates select=\"*[3]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"5\"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.8 remainder -->\r\n<xsl:template match=\"m:apply[*[1][self::m:rem]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"mo\">\\mod </xsl:with-param>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"this-p\" select=\"3\"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.9  times-->\r\n<xsl:template match=\"m:apply[*[1][self::m:times]]\" name=\"times\">\r\n  <xsl:param name=\"p\" select=\"0\"/>\r\n  <xsl:param name=\"first\" select=\"1\"/>\r\n  <xsl:if test=\"$p &gt; 3\"><xsl:text>(</xsl:text></xsl:if>\r\n  <xsl:for-each select=\"*[position()&gt;1]\">\r\n\t\t<xsl:if test=\"position() &gt; 1\">\r\n\t\t\t<xsl:choose>\r\n\t\t\t\t<xsl:when test=\"self::m:cn\">\\times <!-- times --></xsl:when>\r\n\t\t\t\t<xsl:otherwise><!--invisible times--></xsl:otherwise>\r\n\t\t\t</xsl:choose>\r\n\t\t</xsl:if> \r\n\t\t<xsl:if test=\"position()&gt;= $first\">\r\n\t\t\t<xsl:apply-templates select=\".\">\r\n\t\t\t\t<xsl:with-param name=\"p\" select=\"3\"/>\r\n\t\t\t</xsl:apply-templates>\r\n\t\t</xsl:if>\r\n\t</xsl:for-each>\r\n  <xsl:if test=\"$p &gt; 3\"><xsl:text>)</xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.10 root -->\r\n<xsl:template match=\"m:apply[*[1][self::m:root]]\">\r\n\t<xsl:text>\\sqrt</xsl:text>\r\n\t<xsl:if test=\"m:degree!=2\">\r\n\t\t<xsl:text>[</xsl:text>\r\n\t\t<xsl:apply-templates select=\"m:degree/*\"/>\r\n\t\t<xsl:text>]</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>{</xsl:text>\r\n\t<xsl:apply-templates select=\"*[position()&gt;1 and not(self::m:degree)]\"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.11 gcd -->\r\n<xsl:template match=\"m:gcd\"><xsl:text>\\gcd </xsl:text></xsl:template>\r\n\r\n<!-- 4.4.3.12 and -->\r\n<xsl:template match=\"m:apply[*[1][self::m:and]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\land <!-- and --></xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.13 or -->\r\n<xsl:template match=\"m:apply[*[1][self::m:or]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"3\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\lor </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.14 xor -->\r\n<xsl:template match=\"m:apply[*[1][self::m:xor]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"3\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\mathop{\\mathrm{xor}}</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.15 not -->\r\n<xsl:template match=\"m:apply[*[1][self::m:not]]\">\r\n\t<xsl:text>\\neg </xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.16 implies -->\r\n<xsl:template match=\"m:apply[*[1][self::m:implies]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"mo\">\\implies </xsl:with-param>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"this-p\" select=\"3\"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.17 forall 4.4.3.18 exists -->\r\n<xsl:template match=\"m:apply[*[1][self::m:forall or self::m:exists]]\">\r\n\t<xsl:text>\\</xsl:text>\r\n\t<xsl:value-of select=\"local-name(*[1])\"/>\r\n\t<xsl:text> </xsl:text>\r\n\t<xsl:apply-templates select=\"m:bvar\"/>\r\n\t<xsl:if test=\"m:condition\">\r\n\t\t<xsl:text>, </xsl:text><xsl:apply-templates select=\"m:condition\"/>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"*[last()][local-name()!='condition'][local-name()!='bvar']\">\r\n\t\t<xsl:text>\\colon </xsl:text>\r\n\t  <xsl:apply-templates select=\"*[last()]\"/>\r\n  </xsl:if>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.19 abs -->\r\n<xsl:template match=\"m:apply[*[1][self::m:abs]]\">\r\n\t<xsl:text>\\left|</xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t<xsl:text>\\right|</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.20 conjugate -->\r\n<xsl:template match=\"m:apply[*[1][self::m:conjugate]]\">\r\n\t<xsl:text>\\overline{</xsl:text><xsl:apply-templates select=\"*[2]\"/><xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.22 real -->\r\n<xsl:template match=\"m:real\"><xsl:text>\\Re </xsl:text></xsl:template>\r\n\r\n<!-- 4.4.3.23 imaginary -->\r\n<xsl:template match=\"m:imaginary\"><xsl:text>\\Im </xsl:text></xsl:template>\r\n\r\n<!-- 4.4.3.25 floor -->\r\n<xsl:template match=\"m:apply[*[1][self::m:floor]]\">\r\n\t<xsl:text>\\lfloor </xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t<xsl:text>\\rfloor </xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.3.25 ceiling -->\r\n<xsl:template match=\"m:apply[*[1][self::m:ceiling]]\">\r\n\t<xsl:text>\\lceil </xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t<xsl:text>\\rceil </xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.1 eq -->\r\n<xsl:template match=\"m:apply[*[1][self::m:eq]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">=</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.2 neq -->\r\n<xsl:template match=\"m:apply[*[1][self::m:neq]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\neq </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.3 gt -->\r\n<xsl:template match=\"m:apply[*[1][self::m:gt]]\">\r\n<xsl:param name=\"p\" select=\"0\"/>\r\n<xsl:call-template name=\"infix\">\r\n\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t<xsl:with-param name=\"mo\">&gt; </xsl:with-param>\r\n</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.4 lt -->\r\n<xsl:template match=\"m:apply[*[1][self::m:lt]]\">\r\n<xsl:param name=\"p\" select=\"0\"/>\r\n<xsl:call-template name=\"infix\">\r\n\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t<xsl:with-param name=\"mo\">&lt; </xsl:with-param>\r\n</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.5 geq -->\r\n<xsl:template match=\"m:apply[*[1][self::m:geq]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\ge </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.6 leq -->\r\n<xsl:template match=\"m:apply[*[1][self::m:leq]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\le </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.7 equivalent -->\r\n<xsl:template match=\"m:apply[*[1][self::m:equivalent]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\equiv </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.8 approx -->\r\n<xsl:template match=\"m:apply[*[1][self::m:approx]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"1\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\approx </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.4.9 factorof -->\r\n<xsl:template match=\"m:apply[*[1][self::m:factorof]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"mo\"> | </xsl:with-param>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"this-p\" select=\"3\"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.5.1 int -->\r\n<xsl:template match=\"m:apply[*[1][self::m:int]]\">\r\n\t<xsl:text>\\int</xsl:text>\r\n\t<xsl:if test=\"m:lowlimit/*|m:interval/*[1]|m:condition/*\">\r\n\t\t<xsl:text>_{</xsl:text>\r\n\t\t<xsl:apply-templates select=\"m:lowlimit/*|m:interval/*[1]|m:condition/*\"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"m:uplimit/*|m:interval/*[2]\">\r\n\t\t<xsl:text>^{</xsl:text>\r\n\t\t<xsl:apply-templates select=\"m:uplimit/*|m:interval/*[2]\"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text> </xsl:text>\r\n\t<xsl:apply-templates select=\"*[last()]\"/>\r\n\t<xsl:text>\\,d </xsl:text>\r\n\t<xsl:apply-templates select=\"m:bvar\"/>\r\n</xsl:template>\r\n\r\n<!-- 4.4.5.2 diff -->\r\n<xsl:template match=\"m:apply[*[1][self::m:diff] and m:ci and count(*)=2]\" priority=\"2\">\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t<xsl:text>^\\prime </xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:apply[*[1][self::m:diff]]\" priority=\"1\">\r\n\t<xsl:text>\\frac{</xsl:text>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"m:bvar/m:degree\">\r\n\t\t\t<xsl:text>d^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"m:bvar/m:degree/node()\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"*[last()]\"/>\r\n\t\t\t<xsl:text>}{d</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"m:bvar/node()\"/>\r\n\t\t\t<xsl:text>^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"m:bvar/m:degree/node()\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>d </xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"*[last()]\"/>\r\n\t\t\t<xsl:text>}{d </xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"m:bvar\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.5.3 partialdiff -->\r\n<xsl:template match=\"m:apply[*[1][self::m:partialdiff] and m:list and m:ci and count(*)=3]\" priority=\"2\">\r\n\t<xsl:text>D_{</xsl:text>\r\n\t<xsl:for-each select=\"m:list[1]/*\">\r\n\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t<xsl:if test=\"position()&lt;last()\"><xsl:text>, </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:apply-templates select=\"*[3]\"/>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:apply[*[1][self::m:partialdiff]]\" priority=\"1\">\r\n\t<xsl:text>\\frac{\\partial^{</xsl:text>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test=\"m:degree\">\r\n\t\t\t<xsl:apply-templates select=\"m:degree/node()\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test=\"m:bvar/m:degree[string(number(.))='NaN']\">\r\n\t\t\t<xsl:for-each select=\"m:bvar/m:degree\">\r\n\t\t\t\t<xsl:apply-templates select=\"node()\"/>\r\n\t\t\t\t<xsl:if test=\"position()&lt;last()\"><xsl:text>+</xsl:text></xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t\t<xsl:if test=\"count(m:bvar[not(m:degree)])&gt;0\">\r\n\t\t\t\t<xsl:text>+</xsl:text>\r\n\t\t\t\t<xsl:value-of select=\"count(m:bvar[not(m:degree)])\"/>\r\n\t\t\t</xsl:if>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:value-of select=\"sum(m:bvar/m:degree)+count(m:bvar[not(m:degree)])\"/>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:apply-templates select=\"*[last()]\"/>\r\n\t<xsl:text>}{</xsl:text>\r\n\t<xsl:for-each select=\"m:bvar\">\r\n\t\t<xsl:text>\\partial </xsl:text>\r\n\t\t<xsl:apply-templates select=\"node()\"/>\r\n\t\t<xsl:if test=\"m:degree\">\r\n\t\t\t<xsl:text>^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"m:degree/node()\"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.2.8 declare 4.4.5.4 lowlimit 4.4.5.5 uplimit 4.4.5.7 degree 4.4.9.5 momentabout -->\r\n<xsl:template match=\"m:declare | m:lowlimit | m:uplimit | m:degree | m:momentabout\"/>\r\n\r\n<!-- 4.4.5.6  bvar-->\r\n<xsl:template match=\"m:bvar\">\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test=\"following-sibling::m:bvar\"><xsl:text>, </xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<!-- 4.4.5.8 divergence-->\r\n<xsl:template match=\"m:divergence\"><xsl:text>\\mathop{\\mathrm{div}}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.5.11 laplacian-->\r\n<xsl:template match=\"m:laplacian\"><xsl:text>\\nabla^2 </xsl:text></xsl:template>\r\n\r\n<!-- 4.4.6.1 set -->\r\n<xsl:template match=\"m:set\">\r\n\t<xsl:text>\\{</xsl:text><xsl:call-template name=\"set\"/><xsl:text>\\}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.2 list -->\r\n<xsl:template match=\"m:list\">\r\n\t<xsl:text>\\left[</xsl:text><xsl:call-template name=\"set\"/><xsl:text>\\right]</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"set\">\r\n   <xsl:choose>\r\n\t\t<xsl:when test=\"m:condition\">\r\n   \t\t<xsl:apply-templates select=\"m:bvar/*[not(self::bvar or self::condition)]\"/>\r\n   \t\t<xsl:text>\\colon </xsl:text>\r\n\t\t\t<xsl:apply-templates select=\"m:condition/node()\"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:for-each select=\"*\">\r\n\t\t\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t\t\t<xsl:if test=\"position()!=last()\"><xsl:text>, </xsl:text></xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t</xsl:otherwise>\r\n   </xsl:choose>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.3 union -->\r\n<xsl:template match=\"m:apply[*[1][self::m:union]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\cup </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.4 intersect -->\r\n<xsl:template match=\"m:apply[*[1][self::m:intersect]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"3\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\cap </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.5 in -->\r\n<xsl:template match=\"m:apply[*[1][self::m:in]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"mo\">\\in </xsl:with-param>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"this-p\" select=\"3\"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.5 notin -->\r\n<xsl:template match=\"m:apply[*[1][self::m:notin]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"mo\">\\notin </xsl:with-param>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"this-p\" select=\"3\"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.7 subset -->\r\n<xsl:template match=\"m:apply[*[1][self::m:subset]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\subseteq </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.8 prsubset -->\r\n<xsl:template match=\"m:apply[*[1][self::m:prsubset]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\subset </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.9 notsubset -->\r\n<xsl:template match=\"m:apply[*[1][self::m:notsubset]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\nsubseteq </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.10 notprsubset -->\r\n<xsl:template match=\"m:apply[*[1][self::m:notprsubset]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\not\\subset </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.11 setdiff -->\r\n<xsl:template match=\"m:apply[*[1][self::m:setdiff]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\setminus </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.12 card -->\r\n<xsl:template match=\"m:apply[*[1][self::m:card]]\">\r\n\t<xsl:text>|</xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t<xsl:text>|</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.6.13 cartesianproduct 4.4.10.6 vectorproduct -->\r\n<xsl:template match=\"m:apply[*[1][self::m:cartesianproduct or self::m:vectorproduct]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\times </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<xsl:template\r\nmatch=\"m:apply[*[1][self::m:cartesianproduct][count(following-sibling::m:reals)=count(following-sibling::*)]]\"\r\npriority=\"2\">\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"5\"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>^{</xsl:text>\r\n\t<xsl:value-of select=\"count(*)-1\"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.7.1 sum -->\r\n<xsl:template match=\"m:apply[*[1][self::m:sum]]\">\r\n\t<xsl:text>\\sum</xsl:text><xsl:call-template name=\"series\"/>\r\n</xsl:template>\r\n\r\n<!-- 4.4.7.2 product -->\r\n<xsl:template match=\"m:apply[*[1][self::m:product]]\">\r\n\t<xsl:text>\\prod</xsl:text><xsl:call-template name=\"series\"/>\r\n</xsl:template>\r\n\t\r\n<xsl:template name=\"series\">\r\n\t<xsl:if test=\"m:lowlimit/*|m:interval/*[1]|m:condition/*\">\r\n\t\t<xsl:text>_{</xsl:text>\r\n\t\t<xsl:if test=\"not(m:condition)\">\r\n\t\t\t<xsl:apply-templates select=\"m:bvar\"/>\r\n\t\t\t<xsl:text>=</xsl:text>\r\n\t\t</xsl:if>\r\n\t\t<xsl:apply-templates select=\"m:lowlimit/*|m:interval/*[1]|m:condition/*\"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"m:uplimit/*|m:interval/*[2]\">\r\n\t\t<xsl:text>^{</xsl:text>\r\n\t\t<xsl:apply-templates select=\"m:uplimit/*|m:interval/*[2]\"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text> </xsl:text>\r\n\t<xsl:apply-templates select=\"*[last()]\"/>\r\n</xsl:template>\r\n\r\n<!-- 4.4.7.3 limit -->\r\n<xsl:template match=\"m:apply[*[1][self::m:limit]]\">\r\n\t<xsl:text>\\lim_{</xsl:text>\r\n\t<xsl:apply-templates select=\"m:lowlimit|m:condition/*\"/>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:apply-templates select=\"*[last()]\"/>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:apply[m:limit]/m:lowlimit\" priority=\"3\">\r\n\t<xsl:apply-templates select=\"../m:bvar/node()\"/>\r\n\t<xsl:text>\\to </xsl:text>\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<!-- 4.4.7.4 tendsto -->\r\n<xsl:template match=\"m:apply[*[1][self::m:tendsto]]\">\r\n\t<xsl:param name=\"p\"/>\r\n\t<xsl:call-template name=\"binary\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\r\n\t\t\t<xsl:choose>\r\n\t\t\t\t<xsl:when test=\"@type='above'\">\\searrow </xsl:when>\r\n\t\t\t\t<xsl:when test=\"@type='below'\">\\nearrow </xsl:when>\r\n\t\t\t\t<xsl:when test=\"@type='two-sided'\">\\rightarrow </xsl:when>\r\n\t\t\t\t<xsl:otherwise>\\to </xsl:otherwise>\r\n\t\t\t</xsl:choose>\r\n\t\t</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.8.1 common tringonometric functions 4.4.8.3 natural logarithm -->\r\n<xsl:template match=\"m:apply[*[1][\r\n self::m:sin or \t\tself::m:cos or \tself::m:tan or\t\tself::m:sec or\r\n self::m:csc or \t\tself::m:cot or \tself::m:sinh or\t \tself::m:cosh or\r\n self::m:tanh or \t\tself::m:coth or\tself::m:arcsin or \tself::m:arccos or\r\n self::m:arctan or \tself::m:ln]]\">\r\n\t<xsl:text>\\</xsl:text>\r\n\t<xsl:value-of select=\"local-name(*[1])\"/>\r\n\t<xsl:text> </xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:sin | m:cos | m:tan | m:sec | m:csc |\r\n\t\t\t\t\t\t\t\t m:cot | m:sinh | m:cosh | m:tanh | m:coth |\r\n\t\t\t\t\t\t\t\t m:arcsin | m:arccos | m:arctan | m:ln\">\r\n\t<xsl:text>\\</xsl:text>\r\n\t<xsl:value-of select=\"local-name(.)\"/>\r\n\t<xsl:text> </xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:apply[*[1][\r\n self::m:sech or \t\tself::m:csch or\t\tself::m:arccosh or\r\n self::m:arccot or \tself::m:arccoth or \tself::m:arccsc or\r\n self::m:arccsch or self::m:arcsec or \tself::m:arcsech or\r\n self::m:arcsinh or self::m:arctanh]]\">\r\n\t<xsl:text>\\mathrm{</xsl:text>\r\n\t<xsl:value-of select=\"local-name(*[1])\"/>\r\n\t<xsl:text>\\,}</xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:sech | m:csch | m:arccosh | m:arccot |\r\n\t\t\t\t\t\t\t\t m:arccoth | m:arccsc |m:arccsch |m:arcsec |\r\n\t\t\t\t\t\t\t\t m:arcsech | m:arcsinh | m:arctanh\">\r\n\t<xsl:text>\\mathrm{</xsl:text>\r\n\t<xsl:value-of select=\"local-name(.)\"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.8.2 exp -->\r\n<xsl:template match=\"m:apply[*[1][self::m:exp]]\">\r\n\t<xsl:text>e^{</xsl:text><xsl:apply-templates select=\"*[2]\"/><xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.8.4 log -->\r\n<xsl:template match=\"m:apply[*[1][self::m:log]]\">\r\n\t<xsl:text>\\lg </xsl:text>\r\n\t<xsl:apply-templates select=\"*[last()]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:apply[*[1][self::m:log] and m:logbase != 10]\">\r\n\t<xsl:text>\\log_{</xsl:text>\r\n\t<xsl:apply-templates select=\"m:logbase/node()\"/>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:apply-templates select=\"*[last()]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<!-- 4.4.9.1 mean -->\r\n<xsl:template match=\"m:apply[*[1][self::m:mean]]\">\r\n\t<xsl:text>\\langle </xsl:text>\r\n\t<xsl:for-each select=\"*[position()&gt;1]\">\r\n\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t<xsl:if test=\"position() !=last()\"><xsl:text>, </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>\\rangle </xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.9.2 sdef -->\r\n<xsl:template match=\"m:sdev\"><xsl:text>\\sigma </xsl:text></xsl:template>\r\n\r\n<!-- 4.4.9.3 variance -->\r\n<xsl:template match=\"m:apply[*[1][self::m:variance]]\">\r\n\t<xsl:text>\\sigma(</xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\"/>\r\n\t<xsl:text>)^2</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.9.5 moment -->\r\n<xsl:template match=\"m:apply[*[1][self::m:moment]]\">\r\n\t<xsl:text>\\langle </xsl:text>\r\n\t<xsl:apply-templates select=\"*[last()]\"/>\r\n\t<xsl:text>^{</xsl:text>\r\n\t<xsl:apply-templates select=\"m:degree/node()\"/>\r\n\t<xsl:text>}\\rangle</xsl:text>\r\n\t<xsl:if test=\"m:momentabout\">\r\n\t\t<xsl:text>_{</xsl:text>\r\n\t\t<xsl:apply-templates select=\"m:momentabout/node()\"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text> </xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.10.1 vector  -->\r\n<xsl:template match=\"m:vector\">\r\n\t<xsl:text>\\left(\\begin{array}{c}</xsl:text>\r\n\t<xsl:for-each select=\"*\">\r\n\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t<xsl:if test=\"position()!=last()\"><xsl:text>\\\\ </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>\\end{array}\\right)</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.10.2 matrix  -->\r\n<xsl:template match=\"m:matrix\">\r\n\t<xsl:text>\\begin{pmatrix}</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>\\end{pmatrix}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.10.3 matrixrow  -->\r\n<xsl:template match=\"m:matrixrow\">\r\n\t<xsl:for-each select=\"*\">\r\n\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t<xsl:if test=\"position()!=last()\"><xsl:text> &amp; </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:if test=\"position()!=last()\"><xsl:text>\\\\ </xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<!-- 4.4.10.4 determinant  -->\r\n<xsl:template match=\"m:apply[*[1][self::m:determinant]]\">\r\n\t<xsl:text>\\det </xsl:text>\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"m:apply[*[1][self::m:determinant]][*[2][self::m:matrix]]\" priority=\"2\">\r\n\t<xsl:text>\\begin{vmatrix}</xsl:text>\r\n\t<xsl:apply-templates select=\"m:matrix/*\"/>\r\n\t<xsl:text>\\end{vmatrix}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.10.5 transpose -->\r\n<xsl:template match=\"m:apply[*[1][self::m:transpose]]\">\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>^T</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.10.5 selector -->\r\n<xsl:template match=\"m:apply[*[1][self::m:selector]]\">\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"7\"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>_{</xsl:text>\r\n\t<xsl:for-each select=\"*[position()&gt;2]\">\r\n\t\t<xsl:apply-templates select=\".\"/>\r\n\t\t<xsl:if test=\"position() !=last()\"><xsl:text>, </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- 4.4.10.7 scalarproduct 4.4.10.8 outerproduct -->\r\n<xsl:template match=\"m:apply[*[1][self::m:scalarproduct or self::m:outerproduct]]\">\r\n\t<xsl:param name=\"p\" select=\"0\"/>\r\n\t<xsl:call-template name=\"infix\">\r\n\t\t<xsl:with-param name=\"this-p\" select=\"2\"/>\r\n\t\t<xsl:with-param name=\"p\" select=\"$p\"/>\r\n\t\t<xsl:with-param name=\"mo\">\\dot </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<!-- 4.4.11.2 semantics -->\r\n<xsl:template match=\"m:semantics\"><xsl:apply-templates select=\"*[1]\"/></xsl:template>\r\n\r\n<xsl:template match=\"m:semantics[m:annotation/@encoding='TeX']\">\r\n\t<xsl:apply-templates select=\"m:annotation[@encoding='TeX']/node()\"/>\r\n</xsl:template>\r\n\r\n<!-- 4.4.12.1 integers -->\r\n<xsl:template match=\"m:integers\"><xsl:text>\\mathbb{Z}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.2 reals -->\r\n<xsl:template match=\"m:reals\"><xsl:text>\\mathbb{R}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.3 rationals -->\r\n<xsl:template match=\"m:rationals\"><xsl:text>\\mathbb{Q}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.4 naturalnumbers -->\r\n<xsl:template match=\"m:naturalnumbers\"><xsl:text>\\mathbb{N}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.5 complexes -->\r\n<xsl:template match=\"m:complexes\"><xsl:text>\\mathbb{C}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.6 primes -->\r\n<xsl:template match=\"m:primes\"><xsl:text>\\mathbb{P}</xsl:text></xsl:template>\r\n\t\r\n<!-- 4.4.12.7 exponentiale -->\r\n<xsl:template match=\"m:exponentiale\"><xsl:text>e</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.8 imaginaryi -->\r\n<xsl:template match=\"m:imaginaryi\"><xsl:text>i</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.9 notanumber -->\r\n<xsl:template match=\"m:notanumber\"><xsl:text>NaN</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.10 true -->\r\n<xsl:template match=\"m:true\"><xsl:text>\\mbox{true}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.11 false -->\r\n<xsl:template match=\"m:false\"><xsl:text>\\mbox{false}</xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.12 emptyset -->\r\n<xsl:template match=\"m:emptyset\"><xsl:text>\\emptyset </xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.13 pi -->\r\n<xsl:template match=\"m:pi\"><xsl:text>\\pi </xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.14 eulergamma -->\r\n<xsl:template match=\"m:eulergamma\"><xsl:text>\\gamma </xsl:text></xsl:template>\r\n\r\n<!-- 4.4.12.15 infinity -->\r\n<xsl:template match=\"m:infinity\"><xsl:text>\\infty </xsl:text></xsl:template>\r\n\r\n<!-- ****************************** -->\r\n<xsl:template name=\"infix\" >\r\n  <xsl:param name=\"mo\"/>\r\n  <xsl:param name=\"p\" select=\"0\"/>\r\n  <xsl:param name=\"this-p\" select=\"0\"/>\r\n  <xsl:if test=\"$this-p &lt; $p\"><xsl:text>(</xsl:text></xsl:if>\r\n  <xsl:for-each select=\"*[position()&gt;1]\">\r\n\t\t<xsl:if test=\"position() &gt; 1\">\r\n\t\t\t<xsl:copy-of select=\"$mo\"/>\r\n\t\t</xsl:if>   \r\n\t\t<xsl:apply-templates select=\".\">\r\n\t\t\t<xsl:with-param name=\"p\" select=\"$this-p\"/>\r\n\t\t</xsl:apply-templates>\r\n\t</xsl:for-each>\r\n  <xsl:if test=\"$this-p &lt; $p\"><xsl:text>)</xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template name=\"binary\" >\r\n  <xsl:param name=\"mo\"/>\r\n  <xsl:param name=\"p\" select=\"0\"/>\r\n  <xsl:param name=\"this-p\" select=\"0\"/>\r\n  <xsl:if test=\"$this-p &lt; $p\"><xsl:text>(</xsl:text></xsl:if>\r\n\t<xsl:apply-templates select=\"*[2]\">\r\n\t\t<xsl:with-param name=\"p\" select=\"$this-p\"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:value-of select=\"$mo\"/>\r\n\t<xsl:apply-templates select=\"*[3]\">\r\n    \t<xsl:with-param name=\"p\" select=\"$this-p\"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:if test=\"$this-p &lt; $p\"><xsl:text>)</xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Note: variables colora (template color) and symbola (template startspace) only for Sablotron -->\r\n\r\n<xsl:template name=\"startspace\">\r\n\t<xsl:param name=\"symbol\"/>\r\n\t<xsl:if test=\"contains($symbol,' ')\">\r\n\t\t<xsl:variable name=\"symbola\" select=\"concat(substring-before($symbol,' '),substring-after($symbol,' '))\"/>\r\n\t\t<xsl:call-template name=\"startspace\">\r\n\t\t\t<xsl:with-param name=\"symbol\" select=\"$symbola\"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:if>\r\n\t<xsl:if test=\"not(contains($symbol,' '))\">\r\n\t\t<xsl:value-of select=\"$symbol\"/>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:strip-space elements=\"m:*\"/>\r\n\r\n<xsl:template match=\"m:math\">\r\n\t<xsl:text>&#x00024;</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>&#x00024;</xsl:text>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>\r\n";
var Widget = P(function (widget) {
this.version = '0.3.12';
widget.init = function (el, configXML, eventCallback, restrictContentFlag) {
var self = this;
this.el = el;
this.configXML = configXML;
this.eventCallback = eventCallback;
var xml = this.xml = $(configXML);
$(el).addClass('widget');
this.$placeholder = $('<div class="widget-placeholder">').appendTo(el);
this.$body = $('<div class="widget-body">').appendTo(el);
var $inputs = this.$inputs = $('<div class="inputs"></div>').appendTo(this.$body);
xml.find('editorRow').each(function (i) {
var latexText = $(this).text().trim();
if (latexText.replace(/\\MathQuillMathField\{[^\}]*\}/i, '').length == 0) {
$('<div class="input"><span class="input-box"></span></div>')
.children().text($(this).text()).end()
.appendTo($inputs)
.find('.input-box').mathquill();
} else {
$('<div class="input mje_dynamic_inputbox"><span class="input-box"></span></div>')
.children().text($(this).text()).end()
.appendTo($inputs)
.find('.input-box').mathquill();
}
});
this.isValid = function() {
return JSON.stringify(this.getLatexResponses()) != JSON.stringify(this.initialResponses);
};
this.restrictContentFlag = (typeof restrictContentFlag == 'undefined') ? true : restrictContentFlag;
if (this.restrictContentFlag) {
this.AutoCmds = {
sin: 1,
cos: 1,
tan: 1,
arcsin: 1,
arccos: 1,
arctan: 1,
sqrt: 1,
nthroot: 1,
sum: 1,
prod: 1,
pi: 1,
phi: 1,
tau: 1,
gamma: 1,
theta: 1
};
this.restrictContentKeys = new RegexMap();
}
this.mathOperatorOverride = [];
this.createKeypad(xml).appendTo(this.$body);
this.sendKey = function (key) {
this.lastFocusedMathquill.mathquill('onKey', key);
};
this.lastFocusedMathquill = $inputs.find('.mathquill-editable:first');
$inputs.on('focusin', function (e) {
var focusedMathquill = $(e.target).closest('.mathquill-editable');
if (focusedMathquill.length) {
self.lastFocusedMathquill = focusedMathquill;
}
});
if (this.restrictContentFlag) this.restrictContentKeys.compile();
this.$inputs.find('.mathquill-editable').each(function (i) {
if (self.mathOperatorOverride) {
$(this).mathquill('mathOperatorOverride', self.mathOperatorOverride);
}
if (self.restrictContentFlag) {
$(this).mathquill('restrictContentKeys', self.restrictContentKeys);
}
});
this.$body.on('render', function () { self.resize(); });
this.scale(1);
this.undoStack = [];
this.redoStack = [];
this.undoState = this.getLatexResponses();
this.initialResponses = this.getLatexResponses();
this.$body.on('render', function () { pushUndoState(self); })
.on('keydown', function (evt) {
if (evt.ctrlKey || evt.metaKey) {
switch (evt.which) {
case 90:
if (evt.shiftKey) {
self.redo();
} else {
self.undo();
}
return false;
case 89:
self.redo();
return false;
}
}
});
this.eventCallback('READY');
};
function RegexMap(options) {
var regexList = [];
var terms = [], variableRegex = '', digitsRegex = '(\\d|\.)?';
var escapeTerms = /[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;
var operatorsAllowed = '', allowDigits = false, allowOperators = false;
this.getTerms = function () { return terms; };
this.addTerm = function (term) {
if (terms.indexOf(term) == -1) {
terms.push(term);
}
return this;
};
this.addRegExp = function (regexp) {
if (!(regexp instanceof RegExp)) throw new TypeError("Invalid type passed in. Only RegExp instances can be added");
regexList.push(regexp);
return this;
};
this.compile = function () {
var variables = [];
terms.forEach(function (term) {
if (term.length == 1 && /^[a-zA-Z]$/g.test(term)) {
variables.push(term);
} else if (term.length == 1 && /[\d\.]/.test(term)) {
allowDigits = true;
} else if (term.length == 1 && /[\+\-\/\_\^><=\(\)\*\|]/.test(term)) {
operatorsAllowed += '|' + term.replace(escapeTerms, "\\$&");
allowOperators = true;
} else {
var regex = "^";
regex += "(";
for (var i = 1; i < term.length; i++) {
regex += term.substring(0, i).replace(escapeTerms, "\\$&");
regex += '|';
}
regex += term.replace(escapeTerms, "\\$&");
regex += ')$';
regexList.push(new RegExp(regex));
}
});
regexList.push(new RegExp("^(" + operatorsAllowed.substring(1) + ')$'));
variableRegex = new RegExp('^[' + variables.join('') + ((allowDigits) ? digitsRegex : '') + ((allowOperators) ? '(' + operatorsAllowed.substring(1) + ')?' : '') + ']+');
return this;
};
this.match = function (input) {
input = input.replace(variableRegex, '');
if (input.length == 0)
return true;
return regexList.some(function (regexp) {
var result = regexp.test(input);
if (result && window.DEBUG) console.log('RegExp:' + regexp + ":" + regexp.test(input));
return result;
});
};
}
widget.createKeypad = function (xml) {
var self = this;
var $keypad = $('<div class="keypad mje_controls"><div class="toolbar"><button class="mje_nav_next" mathquillonkey="Left">&larr;</button><button class="mje_nav_prev" mathquillonkey="Right">&rarr;</button><button disabled class="mje_nav_undo" callselfmethod="undo">Undo</button><button disabled class="mje_nav_redo" callselfmethod="redo">Redo</button><button class="mje_nav_del" mathquillonkey="Backspace">&lArr;</button></div><div class="keypad-body"></div></div>');
self.$undo = $keypad.find('button[callselfmethod=undo]');
self.$redo = $keypad.find('button[callselfmethod=redo]');
$keypad.on('selectstart', false);
self.$toolbar = $keypad.find('.toolbar').on('click', 'button', function () {
var lastFocusedMathquill = self.lastFocusedMathquill.mathquill('focus');
var $this = $(this), onKey = $this.attr('mathquillonkey');
if (onKey) {
lastFocusedMathquill.mathquill('onKey', onKey);
}
else {
self[$this.attr('callselfmethod')]();
}
});
var $keypadbody = $keypad.find('.keypad-body');
self.$tabs = $([]);
self.$tabButtons = $([]);
xml.find('tabConfig').find('tab').each(function () {
self.eventCallback("Creating Tab '" + $(this).attr('title') + "':");
self.createKeypadTab(this).appendTo($keypadbody);
});
self.$tabButtons.first().click();
return $keypad;
};
widget.createKeypadTab = function (xml) {
var self = this;
var ariaLabel = $(xml).attr('aria-label') || $(xml).attr('title');
var $tab = $('<div class="keypad-tab">').attr('aria-label', ariaLabel);
$(xml).find('grid').each(function () {
self.createKeypadGrid(this).appendTo($tab);
});
$rows = $('<div class="keypad-rows">').appendTo($tab);
$(xml).find('row').each(function () {
self.createKeypadRow(this).appendTo($rows);
});
this.$tabs = this.$tabs.add($tab);
this.createTabButton(xml, $tab);
if (this.$tabButtons.length > 1) {
this.$tabButtons.appendTo(this.$toolbar);
}
return $tab;
};
widget.createTabButton = function (xml, $tab) {
var self = this;
this.$tabButtons = this.$tabButtons.add(
$('<span class="keypad-tab-button">' + $(xml).attr('title') + '</span>')
.click(function () {
self.$tabs.add(self.$tabButtons).removeClass('selected');
$tab.add(this).addClass('selected');
self.resize();
})
);
};
widget.createKeypadRow = function (xml) {
var self = this;
var numItems = $(xml).find('item').length;
var $row = $('<div class="keypad-row">').addClass($(xml).attr('class'))
.attr('aria-label', $(xml).attr('aria-label'))
.attr('style', 'min-width:' + (Math.round(numItems*2.3*10)/10) + 'em');
self.eventCallback(" Creating Row:");
$(xml).find('item').each(function () {
self.createKeypadItem(this).appendTo($row);
});
return $row;
};
widget.createKeypadGrid = function (xml) {
var self = this;
var $grid = $('<div class="keypad-grid">').addClass($(xml).attr('class'))
.attr('aria-label', $(xml).attr('aria-label'));
self.eventCallback(" Creating Grid:");
var numCols = $(xml).attr('cols') || 3;
var $row;
$(xml).find('item').each(function (i) {
if (i % numCols === 0) {
$row = $('<div class="keypad-grid-row">').appendTo($grid);
}
self.createKeypadItem(this).appendTo($row);
});
return $grid;
};
widget.createKeypadItem = function (xml) {
var self = this;
var $xml = $(xml);
var text = $xml.text();
var cmd = $xml.attr('cmd') || text;
var wrap = $xml.attr('wrap-args') || false;
var insert = $xml.attr('insert-raw') || false;
var ariaLabel = $xml.attr('aria-label');
var title = $xml.attr('title');
if (self.restrictContentFlag) {
if (title == 'asterisk' || title == 'cdot' || title == 'times') {
self.restrictContentKeys.addTerm('*');
self.restrictContentKeys.addTerm(text);
}
else if (text == '( )') self.restrictContentKeys.addTerm('(');
else if (text == '| |') self.restrictContentKeys.addTerm('|');
else if (/^[\\]/.test(cmd) && self.AutoCmds.hasOwnProperty(cmd.substring(1))) self.restrictContentKeys.addTerm(cmd.substring(1));
else if (cmd != text && text == "") {
self.restrictContentKeys.addTerm(cmd);
}
else self.restrictContentKeys.addTerm(text);
}
if (title == 'cdot' || title == 'times')
{
this.mathOperatorOverride.push('*' + '|' + cmd);
}
if (title == 'le' || title == 'ge')
{
this.mathOperatorOverride.push(title + '|' + title);
}
self.eventCallback("  Creating Item: " + text);
return $('<div class="keypad-item">').text(text)
.addClass($xml.attr('class')).attr('aria-label', ariaLabel)
.on('click', function () {
var mq = self.lastFocusedMathquill.mathquill('focus');
if (wrap) {
mq.mathquill('cmd', '(', true).mathquill('onKey', 'Left').mathquill('cmd', cmd).mathquill('onKey', 'Right');
} else if (insert) {
mq.mathquill('write', cmd);
} else {
mq.mathquill('cmd', cmd, true);
}
pushUndoState(self);
self.resize();
self.eventCallback("Typed [" + cmd + "] with onscreen keypad");
});
};
widget.scale = function (factor) {
this.eventCallback("Scaling widget to " + factor + "x");
var prefixes = ['-webkit-', '-moz-', '-ms-', ''];
for (var i = 0; i < prefixes.length; i++) {
this.$body.css(prefixes[i] + 'transform', 'scale(' + factor + ')')
}
this.scaleFactor = factor;
this.resize();
};
widget.resize = function () {
this.$placeholder.width(this.$body.width() * this.scaleFactor);
this.$placeholder.height(this.$body.height() * this.scaleFactor);
};
widget.focus = function () {
this.lastFocusedMathquill.mathquill('focus');
this.eventCallback("Focused");
};
widget.unfocus = function () {
this.lastFocusedMathquill.mathquill('blur');
this.eventCallback("Unfocused");
};
widget.getResponse = function () {
if (this.readOnlyResponse) return this.readOnlyResponse;
var doc = $.parseXML('<response/>');
var responses = doc.firstChild;
var self = this;
this.$inputs.find('.mathquill-editable').each(function () {
responses.appendChild(self.mathmlFromLatex($(this).mathquill('latex')));
});
return doc;
};
widget.setResponse = function (doc) {
var responses = $(doc).children('response').children('math');
var self = this, readOnly = this.mode === 'readOnly';
if (readOnly) this.setMode('readWrite');
this.$inputs.find('.mathquill-editable').each(function (i) {
$(this).mathquill('latex', self.latexFromMathml(responses[i]));
});
if (readOnly) this.setMode('readOnly');
};
widget.getLatexResponses = function () {
return this.$inputs.find('.mathquill-editable').map(function () {
return $(this).mathquill('latex');
}).get();
};
widget.setLatexResponses = function (responses) {
this.$inputs.find('.mathquill-editable').each(function (i) {
$(this).mathquill('latex', responses[i]);
});
return responses;
};
widget.mode = 'readWrite';
widget.setMode = function (mode) {
if (mode === 'readOnly') {
this.readOnlyResponse = this.getResponse();
this.$inputs.find('.input-box').each(function () {
if ($(this).data('latex') === undefined) {
$(this).data('latex', $(this).mathquill('mqLatex'))
.mathquill('latex', $(this).mathquill('latex'));
}
$(this).addClass('readOnly');
});
this.lastFocusedMathquill = $([]);
} else if (mode === 'readWrite') {
delete this.readOnlyResponse;
this.$inputs.find('.input-box').each(function () {
if ($(this).data('latex') !== undefined) {
$(this).mathquill('latex', $(this).data('latex')).removeData('latex');
}
$(this).removeClass('readOnly');
});
this.lastFocusedMathquill = this.$inputs.find('.mathquill-editable:first');
} else {
this.eventCallback("Unrecognized mode (neither 'readOnly' nor 'readWrite'): '" + mode + "'");
return;
}
this.mode = mode;
this.eventCallback("Set mode to '" + mode + "'");
};
function pushUndoState(self) {
if (self.ignorePushUndoState) return;
var newState = self.getLatexResponses();
if (newState.some(function (latex, i) { return latex !== self.undoState[i]; })) {
self.undoStack.push(self.undoState);
self.undoState = newState;
self.redoStack.splice(0);
if (self.undoStack.length === 1) self.$undo.prop('disabled', false);
self.$redo.prop('disabled', true);
}
}
widget.undo = function () {
if (!this.undoStack.length) return this.eventCallback('Nothing to undo');
this.ignorePushUndoState = true;
this.redoStack.push(this.undoState);
this.undoState = this.setLatexResponses(this.undoStack.pop());
if (this.redoStack.length === 1) this.$redo.prop('disabled', false);
if (this.undoStack.length === 0) this.$undo.prop('disabled', true);
this.ignorePushUndoState = false;
this.eventCallback('Undid');
};
widget.redo = function () {
if (!this.redoStack.length) return this.eventCallback('Nothing to redo');
this.ignorePushUndoState = true;
this.undoStack.push(this.undoState);
this.undoState = this.setLatexResponses(this.redoStack.pop());
if (this.undoStack.length === 1) this.$undo.prop('disabled', false);
if (this.redoStack.length === 0) this.$redo.prop('disabled', true);
this.ignorePushUndoState = false;
this.eventCallback('Redid');
};
widget.mathmlFromLatex = function (latex) {
var span = AMparseMath(latex);
return span;
};
if (window.ActiveXObject || "ActiveXObject" in window) {
var xsltTree = new ActiveXObject("Msxml2.DOMDocument.6.0");
xsltTree.async = false;
xsltTree.loadXML(xsltMathml);
var srcTree = new ActiveXObject("Msxml2.DOMDocument.6.0");
srcTree.async = false;
widget.latexFromMathml = function (math) {
mathml = $(math).children('mstyle')[0]
if (mathml.transformNode) return mathml.transformNode(xsltTree);
srcTree.loadXML((new XMLSerializer).serializeToString(mathml));
var latexStr = srcTree.transformNode(xsltTree);
return latexStr.replace(/\\space/g, '\\space ');
};
}
else {
var mathmlProcessor = new XSLTProcessor();
mathmlProcessor.importStylesheet($.parseXML(xsltMathml));
widget.latexFromMathml = function (math) {
mathml = $(math).children('mstyle')[0]
var fragment = mathmlProcessor.transformToFragment(mathml, document);
var latexStr = fragment.textContent;
return latexStr.replace(/\\space/g, '\\space ');
};
}
});
Widget.convertMathMlToLatex = function (mathml) {
var fragment = null;
if (window.ActiveXObject || "ActiveXObject" in window) {
var xsltTree = new ActiveXObject("Msxml2.DOMDocument.6.0");
xsltTree.async = false;
xsltTree.loadXML(xsltMathml);
var srcTree = new ActiveXObject("Msxml2.DOMDocument.6.0");
srcTree.async = false;
mathml = $(mathml).children('mstyle')[0];
if (mathml.transformNode) return mathml.transformNode(xsltTree);
srcTree.loadXML((new XMLSerializer).serializeToString(mathml));
fragment = srcTree.transformNode(xsltTree);
var latexStr = fragment.textContent;
return latexStr.replace(/\\space/g, '\\space ');
}
else {
var mathmlProcessor = new XSLTProcessor();
mathmlProcessor.importStylesheet($.parseXML(xsltMathml));
mathml = $(mathml).children('mstyle')[0];
fragment = mathmlProcessor.transformToFragment(mathml, document);
var latexStr = fragment.textContent;
return latexStr.replace(/\\space/g, '\\space ');
}
};
Widget.convertLatexToMathml = function (latex) {
var span = AMparseMath(latex);
return span;
};
AMinitSymbols();
window.MathEditorWidget = Widget;
}());

/* SOURCE FILE: widget.js (6715e288) 10/26/2014 1:27:05 PM */

(function (CM) {
function match(page, item) {
var id = 'EquationEditor_' + item.position;
var el = document.getElementById(id);
if (el && !CM.isAccessibilityEnabled()) {
return new CM.WidgetConfig(id, el);
}
return false;
}
function Widget_EQ(page, item, config) {
this.eq = null;
}
CM.registerWidget('equationeditor', Widget_EQ, match);
Widget_EQ.prototype.load = function() {
var item = this.entity;
var content = item.rendererSpec;
if (!(item.rendererSpec && item.rendererSpec.indexOf('<editorRow>') != -1)) {
content = MathEditorContent.Config.EquationAdapter.convertToDesmosXml(item.rendererSpec);
}
var data = MathEditorContent.Config.PreviewFormatter.getPreviewXmlDoc(content);
var containerDom = document.getElementById('EquationEditor_' + item.position);
var oldClasses = containerDom.getAttribute('class');
containerDom.setAttribute('class', oldClasses + ' no-highlight');
var debug = false;
var eq = MathEditorWidget(containerDom, data, debug ? function (msg) {                                                    } : function (msg) { });
this.eq = eq;
if (item.value != null) {
item.setResponse(item.value);
}
var eqComponent = {
id: 'EQ_' + item.position,
focus: function() { eq.focus(); },
blur: function() { eq.unfocus(); }
};
item.addComponent(eqComponent);
var eqContainer = containerDom;
YUE.on(eqContainer, 'click', function () {
item.setActiveComponent(eqComponent);
});
if (item.isReadOnly()) {
eq.setMode('readOnly');
}
};
Widget_EQ.prototype.getResponse = function() {
var eq = this.eq;
try {
var val = eq.getResponse();
val = Util.Xml.serializeToString(val);
var isValid = eq.isValid();
return this.createResponse(val, isValid);
} catch (e) {
console.error("Failed to get a response for the EQ item.", eq, e);
}
return null;
};
Widget_EQ.prototype.setResponse = function(value) {
try {
if (value) {
var eq = this.eq;
var response = $.parseXML(value);
eq.setResponse(response);
}
} catch (e) {
console.error("Faield to update the mathML with this value.", value, e);
}
};
function match_EQA(page, item) {
var id = 'EquationEditor_' + item.position;
var el = document.getElementById(id);
if (el && CM.isAccessibilityEnabled()) {
return new CM.WidgetConfig(id, el);
}
return false;
}
function Widget_EQA(page, item, config) {
this.textAreaEl = null;
}
CM.registerWidget('equationeditor.text', Widget_EQA, match_EQA);
Widget_EQA.prototype.load = function() {
var item = this.entity;
var textAreaEl = HTML.TEXTAREA();
this.textAreaEl = textAreaEl;
var containerEl = this.element;
containerEl.appendChild(textAreaEl);
if (item.value != null) {
item.setResponse(item.value);
}
};
Widget_EQA.prototype.getResponse = function() {
var text = this.textAreaEl.value;
var xmlDoc = Util.Xml.parseFromString('<response type="plaintext"></response>');
var textNode = xmlDoc.createTextNode(text);
xmlDoc.documentElement.appendChild(textNode);
var value = Util.Xml.serializeToString(xmlDoc);
var isValid = text.length > 0;
return this.createResponse(value, isValid);
};
Widget_EQA.prototype.setResponse = function(value) {
value = value.replace('<![CDATA[', '');
value = value.replace(']]&gt;', '');
value = value.replace(']]>', '');
var text = '';
var xmlDoc = Util.Xml.parseFromString(value);
if (xmlDoc && xmlDoc.documentElement && xmlDoc.documentElement.childNodes[0]) {
text = Util.Xml.getNodeText(xmlDoc.documentElement.childNodes[0]);
}
this.textAreaEl.value = text;
};
})(window.ContentManager);

/* SOURCE FILE: control.js (8d4b31b9) 10/26/2014 1:27:05 PM */

9
var TDS = window.TDS || {};
TDS.LineReaderControl = {
Instance: null,
toggle: function(){
if(!TDS.LineReaderControl.Instance){
TDS.LineReaderControl.on();
}else{
TDS.LineReaderControl.off();
}
},
on: function(el){
if(!TDS.LineReaderControl.Instance){
var page = ContentManager.getCurrentPage();
if(page){
page.disableScroll();
}
var el = YAHOO.util.Selector.query("#contents")[0];
var root     = YAHOO.util.Selector.query('.showing');
var passages = YAHOO.util.Selector.query('.thePassage,.theQuestions', root[0]);
var stems    = YAHOO.util.Selector.query('.stemContainer', root[0]);
var fin = YAHOO.lang.isArray(el) ? el : passages.concat(stems);
var lr = new TDS.LineReader(fin);
lr.selectFirst();
TDS.LineReaderControl.Instance =  lr;
}
},
off: function(){
if(TDS.LineReaderControl.Instance){
if(window.ContentManager){
var page = ContentManager.getCurrentPage();
if(page){
page.enableScroll();
}
}
TDS.LineReaderControl.Instance.dispose();
delete TDS.LineReaderControl.Instance;
TDS.LineReaderControl.Instance = null;
}
},
reset: function(){
if (TDS.LineReaderControl.Instance) {
TDS.LineReaderControl.off();
TDS.LineReaderControl.on();
}
},
setupEvents: function(){
if(window.ContentManager){
ContentManager.onItemEvent('zoom', TDS.LineReaderControl.reset);
ContentManager.onItemEvent('hide', TDS.LineReaderControl.off);
ContentManager.onPageEvent('hide', TDS.LineReaderControl.off);
ContentManager.onEntityEvent('menushow', TDS.LineReaderControl.off);
}
}
};
YAHOO.util.Event.onDOMReady(function(){
TDS.LineReaderControl.setupEvents();
});
TDS.LineReader = function (el) {
var LHR = 1.25,
DEBUG_LINE_CLASS = 'LINERREADERDEBUGLINE',
AUTOSCROLL_TOLERANCE = 44;
var that = this;
this.TheLine;
this._parsers = [];
this._arguments = arguments;
this._linesList = [];
this._parentContainers;
this._textContainers = [];
this._ignoreContainers = [];
this._scrollableContainers = [];
this._parentWindow = window;
this._activeLineIndex = -1;
this._savedBackgroundColor = 'transparent';
this._onLineMove =  new YAHOO.util.CustomEvent('onLineMove');
this._settings = {
lineColor: 'rgba(0, 191, 243, 0.2)',
lineBorder: 'none',
lineID: '#theLine',
lineZIndex: '-1',
debug: false,
onLineMove: null
};
this.line = function () {
this.element = null;
this.top = 0;
this.width = 0;
this.height = 0;
this.bottom = 0;
};
this._findElements = function (el) {
var _foundElementsArray = [];
var _criteria = function (x) {
if ($(x).closest('div.itemContainer.hiding').length) {
return false;
}
var overflow = $(x.parentNode).css('overflow').toLowerCase();
if (overflow === 'auto' || overflow === 'scroll') {
that._scrollableContainers.push(x.parentNode);
}
overflow = null;
var p = that._get_parser(x.nodeName);
if (p) {
return p._criteria.call(that, x);
} else {
return false;
}
},
_saveElementToTextContainers = function (x) {
if (that._ignoreContainers.indexOf(x) === -1 && _foundElementsArray.indexOf(x) === -1) {
_foundElementsArray.push(x);
}
};
YAHOO.util.Dom.getElementsBy(
_criteria,
'',
el,
_saveElementToTextContainers
);
return _foundElementsArray;
};
this._processElement = function (el) {
var p = that._get_parser(el.nodeName);
if (p && p._processLines instanceof Function) {
p._processLines.call(this,el);
}
};
this._selectLineAt = function(index){
if(this._linesList){
if(index >= 0 && index < this._linesList.length){
var l = this._linesList[index];
this._activeLineIndex = this._linesList.indexOf(l);
this._moveLine(l);
}
}
};
this._findLine = function (el, Y) {
for (var i = 0; i < this._linesList.length; i++) {
var l = this._linesList[i];
if (l.element === el && (l.top < Y && l.bottom > Y)) {
return l;
}
}
return null;
};
this._moveLine = function (line) {
if (line) {
var elY = YAHOO.util.Dom.getXY(line.element)[1];
YAHOO.util.Dom.setStyle(this.TheLine, 'top', line.top + 'px');
YAHOO.util.Dom.setStyle(this.TheLine, 'left', '0');
YAHOO.util.Dom.setStyle(this.TheLine, 'height', line.height + 'px');
YAHOO.util.Dom.setStyle(this.TheLine, 'width', line.width);
YAHOO.util.Dom.addClass(this.TheLine, 'TDS_Line_Reader_Active');
if (YAHOO.util.Dom.getStyle(this.TheLine, 'display') === 'none') {
YAHOO.util.Dom.setStyle(this.TheLine, 'display', 'block');
}
line.element.appendChild(this.TheLine);
this._onLineMove.fire();
}
};
this._hideLine = function() {
var ln = this._linesList[this._activeLineIndex];
if (this._activeLineIndex > -1 && ln && ln.element.nodeName === 'TR') {
YAHOO.util.Dom.setStyle(ln.element, 'background-color', that._savedBackgroundColor);
} else {
if (ln) {
YAHOO.util.Dom.setStyle(that.TheLine, 'display', 'none');
}
}
};
this._initialize = function () {
this._linesList = [];
this._textContainers = [];
this._scrollableContainers = [];
this._activeLineIndex = -1;
var textContArray = [];
for(var i = 0; i < this._parentContainers.length; ++i){
var els = this._findElements.call(this, this._parentContainers[i]);
if(els && els.length){
textContArray = textContArray.concat(els);
}
}
for (var j = 0; j < textContArray.length; j++) {
if (this._textContainers.indexOf(textContArray[j]) === -1) {
this._textContainers.push(textContArray[j]);
}
}
textContArray = null;
for (var i = 0; i < this._textContainers.length; i++) {
this._processElement(this._textContainers[i]);
}
for (var i = 0; i < this._textContainers.length; i++) {
var p = that._get_parser(this._textContainers[i].nodeName);
if (p && p._onClick) {
YAHOO.util.Event.on(this._textContainers[i], "click", p._onClick, null, this);
}
}
this._onKeyDownRef = YAHOO.util.Event.on(
this._parentContainers[0].ownerDocument,
'keydown',
this._onArrowKeyPress,
null,
this
);
if (this._settings.onLineMove) {
this._onLineMove.subscribe(this._settings.onLineMove);
}
this._createLine();
if (this._settings.debug) {
for (var i = 0; i < this._linesList.length; i++) {
var l = this._linesList[i];
if (l.element.nodeName !== 'TR') {
var div = document.createElement('div');
div.id = "LR_DEBUG_" + i;
div.title = "LR_DEBUG_" + i;
div.className = DEBUG_LINE_CLASS;
YAHOO.util.Dom.setStyle(div, 'position', 'absolute');
YAHOO.util.Dom.setStyle(div, 'top', l.top + 'px');
YAHOO.util.Dom.setStyle(div, 'height', '1px');
YAHOO.util.Dom.setStyle(div, 'width', l.width + 'px');
if (l.EXP) {
YAHOO.util.Dom.setStyle(div, 'background-color', '#0f0');
} else {
YAHOO.util.Dom.setStyle(div, 'background-color', '#f00');
}
YAHOO.util.Dom.setStyle(div, 'z-index', '-1');
YAHOO.util.Dom.setStyle(div, 'display', 'block');
l.element.appendChild(div);
}
else {
YAHOO.util.Dom.setStyle(l.element, 'border', '1px solid #00f');
}
}
}
};
this._dispose = function () {
for (var i = 0; i < this._textContainers.length; i++) {
var p = this._get_parser(this._textContainers[i].nodeName);
if (p._onClick) {
YAHOO.util.Event.removeListener(this._textContainers[i], "click", p._onClick);
}
}
YAHOO.util.Event.removeListener(this._parentContainers[0].ownerDocument,
'keydown',
this._onArrowKeyPress
);
var elements = YAHOO.util.Selector.query('.TDS_Line_Reader');
for(var j=0; j<elements.length; ++j){
var el = elements[j];
if(el && el.parentNode && typeof el.parentNode.removeChild == 'function'){
el.parentNode.removeChild(el);
}
}
for (var i = 0; i < this._linesList.length; i++) {
var l = this._linesList[i];
var debugLines = YAHOO.util.Dom.getChildrenBy(l.element,
function (x) {
return x.className === DEBUG_LINE_CLASS;
});
for (var j = 0; j < debugLines.length; j++) {
l.element.removeChild(debugLines[j]);
}
}
var elRelative = YAHOO.util.Selector.query('.TDS_Line_Reader_Relative_Pos');
for(var i=0; i<elRelative.length; ++i){
YAHOO.util.Dom.removeClass(elRelative[i], 'TDS_Line_Reader_Relative_Pos');
}
};
this._createLine = function () {
this.TheLine = YAHOO.util.Selector.query(this._settings.lineID).length > 0 ? YAHOO.util.Selector.query(this._settings.lineID)[0] : document.createElement('div');
if (YAHOO.util.Selector.query(this._settings.lineID).length === 0) {
this.TheLine.setAttribute("id", this._settings.lineID.replace('#', ''));
}
YAHOO.util.Dom.addClass(this.TheLine, 'TDS_Line_Reader');
};
this._applySettings = function (settings) {
if (settings) {
if (settings.lineColor) { this._settings.lineColor = settings.lineColor; }
if (settings.lineBorder) { this._settings.lineBorder = settings.lineBorder; }
if (settings.lineID) { this._settings.lineID = settings.lineID; }
if (settings.lineZIndex) { this._settings.lineZIndex = settings.lineZIndex; }
if (settings.onLineMove) { this._settings.onLineMove = settings.onLineMove; }
if (typeof settings.debug === 'boolean') { this._settings.debug = settings.debug; }
}
return true;
};
this._add_parser = function (parserObj) {
this._parsers.push(parserObj);
};
this._get_parser = function (nodeName) {
for (var i = 0; i < this._parsers.length; i++) {
var nodeNames = [];
if (this._parsers[i]._nodeName.indexOf(',') > -1) {
nodeNames = this._parsers[i]._nodeName.split(',');
}
else {
nodeNames.push(this._parsers[i]._nodeName);
}
for (var j = 0; j < nodeNames.length; j++) {
if (nodeNames[j].toUpperCase() === nodeName) {
nodeNames = null;
return this._parsers[i];
}
}
}
return null;
};
this._getSuperScriptOffset = function (el,fontSize) {
var measurement1 = 0;
var measurement1 = 0;
var experimentDiv = document.createElement('div');
experimentDiv.id = 'SUPERSCRIPT_TEST';
experimentDiv.innerHTML = 'this is a test';
YAHOO.util.Dom.setStyle(experimentDiv, 'font-size', 'inherit');
YAHOO.util.Dom.setStyle(experimentDiv, 'line-height', 'inherit');
var experimentSpan1 = document.createElement('span');
experimentSpan1.innerHTML = "1";
YAHOO.util.Dom.setStyle(experimentSpan1, 'vertical-align', 'super');
YAHOO.util.Dom.setStyle(experimentSpan1, 'font-size', fontSize);
var experimentSpan2 = document.createElement('span');
experimentSpan2.innerHTML = "2";
YAHOO.util.Dom.setStyle(experimentSpan1, 'font-size', fontSize);
experimentDiv.appendChild(experimentSpan1);
experimentDiv.appendChild(experimentSpan2);
el.appendChild(experimentDiv);
measurement1 = YAHOO.util.Dom.getY(experimentSpan2);
YAHOO.util.Dom.setStyle(experimentSpan1, 'vertical-align', 'bottom');
measurement2 = YAHOO.util.Dom.getY(experimentSpan2);
var diff = (parseFloat(measurement1) - parseFloat(measurement2)) + 1;
el.removeChild(experimentDiv);
return diff;
};
this._textContainerOnClick = function (e) {
var target = e.target || e.srcElement;
if (target.nodeName === 'SPAN') {
target = YAHOO.util.Dom.getAncestorBy(target, function () { return true; });
}
var Y = YAHOO.util.Event.getXY(e)[1];
var elY = YAHOO.util.Region.getRegion(target);
Y = Y - elY.top;
var l = this._findLine(target, Y);
if (l) {
this._activeLineIndex = this._linesList.indexOf(l);
this._moveLine(l);
}
};
this.up = function(){
if (this._activeLineIndex > 0) {
pOff = this._get_parser(this._linesList[this._activeLineIndex].element.nodeName);
pOff._onLineExit.call(this, this._linesList[this._activeLineIndex]);
}
if ((this._activeLineIndex -1) >= 0) {
this._activeLineIndex = this._activeLineIndex - 1;
pOn = this._get_parser(this._linesList[this._activeLineIndex].element.nodeName);
pOn._onLineEnter.call(this, this._linesList[this._activeLineIndex]);
}
};
this.down = function(){
if (this._activeLineIndex > -1 && this._activeLineIndex < (this._linesList.length - 1) ) {
pOff = this._get_parser(this._linesList[this._activeLineIndex].element.nodeName);
pOff._onLineExit.call(this,this._linesList[this._activeLineIndex]);
}
if (this._activeLineIndex < (this._linesList.length - 1)) {
this._activeLineIndex = this._activeLineIndex + 1;
pOn = this._get_parser(this._linesList[this._activeLineIndex].element.nodeName);
pOn._onLineEnter.call(this, this._linesList[this._activeLineIndex]);
}
};
this._onArrowKeyPress = function (e) {
if (e.keyCode === 38 || e.keyCode === 40) {
YAHOO.util.Event.stopEvent(e);
var target = e.target || e.srcElement;
var pOn;
var pOff;
var viewableOffset = 0;
var scrollableOffset = this._parentWindow.pageYOffset;
var scrollParent = null;
for (var i = 0; i < this._scrollableContainers.length; i++) {
if (this._activeLineIndex > -1 && YAHOO.util.Dom.isAncestor(this._scrollableContainers[i], this._linesList[this._activeLineIndex].element)) {
scrollParent = this._scrollableContainers[i];
break;
}
}
if (e.keyCode === 38) {
this.up();
}
if (e.keyCode === 40) {
this.down();
}
var currentLinePostion = (YAHOO.util.Dom.getY(this.TheLine) - YAHOO.util.Dom.getY(scrollParent));
var topOfViewableArea = YAHOO.util.Dom.getY(scrollParent);
var bottomofViewableArea = parseInt(YAHOO.util.Dom.getStyle(scrollParent, 'height'));
if (currentLinePostion < 1 || (currentLinePostion + AUTOSCROLL_TOLERANCE) > bottomofViewableArea) {
this.TheLine.scrollIntoView(true);
}
}
};
var par    = new TDS.LineReader.Parser('P,DIV,LI');
var exclude = {
'TD': true,
'BUTTON': true,
'H': true
};
var excludeClasses = [
'prompt',
'format_wb'
];
var excludeClass = function(el){
for(var i=0; i<excludeClasses.length; ++i){
if(el && YAHOO.util.Dom.hasClass(el, excludeClasses[i])){
return true;
}
}
};
var dfsText = function(x){
if(excludeClass(x)){return;}
var parEles = YAHOO.util.Dom.getAncestorBy(x, function (E) { return true; });
if ((!exclude[parEles.nodeName] &&
!excludeClass(parEles)) ||
((parEles.nodeName == 'TD') && $(parEles).siblings().length == 0)) {
for (var i = 0; i < x.childNodes.length; i++) {
var cn = x.childNodes[i];
var nv = typeof cn.nodeValue == 'string' ? cn.nodeValue.trim() : '';
if (cn.nodeType === 3 && nv.length > 0) {
if(x.offsetWidth && x.offsetHeight) {
return true;
}
}else if(cn.nodeName == 'SPAN') {
if (!cn.textContent.trim() && x.childNodes[i + 1]) {
} else {
return dfsText(cn);
}
}
}
}
};
par._criteria = function (x) {
var parent = x.parentNode;
if (x.nodeName == 'P' &&
(parent.nodeName == 'TH' ||
parent.nodeName == 'TD')) {
if (parent.nodeName == 'TD' &&
$(parent).siblings().length == 0) {
return dfsText(x);
} else {
return false;
}
}
return dfsText(x);
};
par._processLines = function (el) {
var el_h = el.clientHeight,
el_w = el.clientWidth,
el_y = YAHOO.util.Dom.getY(el),
el_padding = parseInt(YAHOO.util.Dom.getStyle(el, 'padding-top'));
var ln_height = 0;
var el_line_height = YAHOO.util.Dom.getStyle(el, 'line-height');
var el_font_size = YAHOO.util.Dom.getStyle(el, 'font-size');
var pfel_lh = parseFloat(el_line_height);
var pfel_fs = parseFloat(el_font_size);
if(isNaN(pfel_lh))
{
ln_height = pfel_fs * LHR;
}
else
{
if(el_line_height.indexOf('%') > -1)
{
ln_height = pfel_fs * (pfel_lh / 100);
}
else if(el_line_height.indexOf('in') > -1)
{
ln_height = pfel_fs * LHR;
}
else
{
ln_height = pfel_lh;
}
}
var curr_pos = 0,
pos = YAHOO.util.Dom.getStyle(el, 'position');
if (el.nodeName === 'SPAN') {
el_h = ln_height;
}
if (pos.toLowerCase() !== 'relative' && pos.toLowerCase() !== 'absolute') {
YAHOO.util.Dom.addClass(el, 'TDS_Line_Reader_Relative_Pos');
}
var x = 1;
var foundSpans = YAHOO.util.Dom.getElementsBy(function (fel) {
if (YAHOO.util.Dom.getStyle(fel, 'vertical-align') !=='baseline') {
return true;
}
return false;
},'span',el);
var spansArray = [];
for (var i = 0; i < foundSpans.length; i++) {
var topY = (YAHOO.util.Dom.getY(foundSpans[i]) - el_y);
var height = 2;
var bottom = topY + height;
spansArray.push({
obj: foundSpans[i],
bottom: bottom,
height: height,
topY: topY,
left: YAHOO.util.Dom.getX(foundSpans[i])
});
}
var ssOffset = 0;
var curSuperOffset = spansArray.length > 0 ? that._getSuperScriptOffset(el, YAHOO.util.Dom.getStyle(spansArray[0].obj, 'font-size')) : 0;
while (curr_pos < el_h) {
var linObj = new that.line();
linObj.height = ln_height;
linObj.width = el_w;
linObj.top = (curr_pos + el_padding) + ssOffset;
linObj.element = el;
linObj.bottom = linObj.top + linObj.height;
for (var i = 0; i < spansArray.length; i++) {
if (spansArray[i].bottom > linObj.top && spansArray[i].bottom < linObj.bottom) {
linObj.height += curSuperOffset;
linObj.EXP = true;
ssOffset += curSuperOffset;
break;
}
}
this._linesList.push(linObj);
curr_pos = curr_pos + ln_height;
if (el.nodeName === 'TR') {
break;
}
}
};
par._onClick = function (e) {
this._textContainerOnClick(e);
};
par._onLineEnter = function (line) {
this._moveLine(line);
};
par._onLineExit = function (line) {
};
this._add_parser(par);
par = new TDS.LineReader.Parser('TR');
par._criteria = function (x) {
return true;
};
par._processLines = function (el) {
var linObj = new that.line();
linObj.height = 0;
linObj.width = 0;
linObj.top = 0;
linObj.element = el;
linObj.bottom = 0;
this._linesList.push(linObj);
};
par._onClick = function (e) {
var target = e.target || e.srcElement;
if (target.nodeName === 'TD' || target.nodeName === 'P' || target.nodeName === 'DIV' || target.nodeName === 'SPAN') {
target = YAHOO.util.Dom.getAncestorByTagName(target, 'TR');
}
for (var i = 0; i <  this._linesList.length; i++) {
if (this._linesList[i].element === target){
this._activeLineIndex = i;
break;
}
}
YAHOO.util.Dom.addClass(target, 'TDS_Line_Reader_Active');
this._onLineMove.fire();
};
par._onLineEnter = function (line) {
if (that.TheLine) {
YAHOO.util.Dom.setStyle(that.TheLine, 'display', 'none');
that._settings.lineColor = YAHOO.util.Dom.getStyle(that.TheLine, 'background-color');
}
YAHOO.util.Dom.setStyle(line.element, 'background-color', that._settings.lineColor);
};
par._onLineExit = function (line) {
YAHOO.util.Dom.setStyle(line.element, 'background-color', that._savedBackgroundColor);
};
this._parentContainers = YAHOO.lang.isArray(arguments[0]) ? arguments[0] : [arguments[0]];
for (var i = 1; i < arguments.length; i++) {
if (arguments[i]) {
if (arguments[i].lineColor ||
arguments[i].lineBorder ||
arguments[i].lineID ||
arguments[i].lineZIndex ||
arguments[i].debug ||
arguments[i].onLineMove) {
}
if (arguments[i].toString().toLowerCase().indexOf('window') > -1) {
this._parentWindow = arguments[i];
}
if (arguments[i].toString().toLowerCase().indexOf('nodelist') > -1 || arguments[i].toString().toLowerCase().indexOf('htmlcollection') > -1) {
for (var j = 0; j < arguments[i].length; j++) {
this._ignoreContainers.push(arguments[i][j]);
}
}
if (arguments[i] instanceof Array) {
for (var j = 0; j < arguments[i].length; j++) {
this._add_parser(arguments[i][j]);
}
}
}
}
this._initialize();
return {
obj: this,
dispose: function() {
that._dispose.call(that);
return true;
},
refresh: function() {
if (!that.TheLine) {
that._dispose.call(that)
}
;
that._initialize.call(that);
return true;
},
applySettings: function(settings) {
that._applySettings.call(that, settings);
that._dispose.call(that);
that._initialize.call(that);
return true;
},
settings: this._settings,
addParser: function(p) {
that._add_parser.call(that, p);
that._dispose.call(that);
that._initialize.call(that);
return true;
},
selectFirst: function() {
that._selectLineAt(0);
},
parsers: this._parsers
};
};
TDS.LineReader.Parser = function (nodeName) {
this._nodeName = nodeName.toUpperCase();
this._criteria = {};
this._processLines = {};
this._onClick = {};
this._onLineEnter = {};
this._onLineExit = {};
};

/* SOURCE FILE: sm2-show.js (65952d82) 9/9/2014 2:09:04 PM */

(function(){
var SM = soundManager;
var TDS = window.TDS || {};
var slide = {
id: 0,
Store: {},
Config: {
TimerMove: 1000
},
Tags: TDS.AriaSlideTags || {
Play: 'Play Slideshow',
Stop: 'Pause Slideshow',
Prev: 'Previous Slide',
Next: 'Next Slide'
}
};
function createEvent() {
return new Util.Event.Custom(this);
}
slide.onPlay = createEvent();
slide.onIdle = createEvent();
slide.scan = function(domOrId){
dom = typeof domOrId == 'string' ? document.getElementById(domOrId) : domOrId;
dom = dom && dom.querySelectorAll ? dom : document.body;
return dom.querySelectorAll('.slides_config');
};
slide.build = function(domOrId){
var domOrIds = typeof domOrId == 'string' ? [domOrId] : domOrId;
var built = [];
for(var i = 0; i < domOrIds.length; ++i){
var d = domOrIds[i];
d = typeof d == 'string' ? document.getElementById(d) : d;
if(!d || !d.className || d.className.match('slides_parsed')) {
continue;
}
var conf = slide.parseConfig(d);
built.push(new slide.Show(conf));
}
return built;
};
slide.parseConfig  = function(container){
if(!container) return;
return {
container: container,
audio: container.querySelector('.slides_audio'),
slides: container.querySelectorAll('.slide')
};
};
slide.scanAndBuild = function(domOrId){
var build = slide.scan(domOrId);
if(build.length){
return slide.build(build);
}
};
slide.pauseAll = function(){
try{
var store = slide.Store;
for (var i in store){
var s = store[i];
s.pauseBtnClick();
}
}catch(e){
console.error("Failed to pause all the slideshows.", e);
}
};
slide.Element = function (type,def,contents) {
var obj = document.createElement(type);
if (def) {
if (def.style) {
var style = def.style; def.style = {};
for (var id in style) {if (style.hasOwnProperty(id))
{def.style[id.replace(/-([a-z])/g,this.ucMatch)] = style[id]}}
}
slide.Insert(obj,def);
}
if (contents) {
if (!(contents instanceof Array)) {contents = [contents]}
for (var i = 0; i < contents.length; i++) {
if (contents[i] instanceof Array) {
obj.appendChild(slide.Element(contents[i][0],contents[i][1],contents[i][2]));
} else {
obj.appendChild(document.createTextNode(contents[i]));
}
}
}
return obj;
};
slide.addElement = function (el,type,def,contents) {
return el.appendChild(slide.Element(type,def,contents))
};
slide.ucMatch = function (match,c) {
return c.toUpperCase()
};
slide.Insert = function (dst,src) {
for (var id in src) {if (src.hasOwnProperty(id)) {
if (typeof src[id] === 'object' && !(src[id] instanceof Array) &&
(typeof dst[id] === 'object' || typeof dst[id] === 'function')) {
this.Insert(dst[id],src[id]);
} else {
dst[id] = src[id];
}
}}
return dst;
};
var S = function(args){
this.id = 'slideshow' + (++(slide.id));
this.intervals = [];
this.pointer   = 0;
this.slides    = [];
if(args){
this.init(args);
}
slide.Store[this.id] = this;
};
S.prototype.init = function(args){
try {
this.container = args.container;
this.audio     = args.audio;
this.slides    = args.slides;
this.initSlideVisibility(this.slides);
this.initSoundManager(this.audio);
if(!this.sm){
return;
}
this.container.id = this.id;
this.bindSlideToSound(this.sm, this.intervals, this.slides);
YAHOO.util.Dom.removeClass(this.container, 'hidden');
this.createControls(this.audio);
this.audio.parentNode.removeChild(this.audio);
} catch (e) {
console.error("Failed to hide?", e);
}finally{
YAHOO.util.Dom.addClass(this.container, 'slides_parsed');
}
};
S.prototype.stopEvt = function(evt){
evt = evt || window.event;
if(evt){
YAHOO.util.Event.stopEvent(evt);
}
};
S.prototype.initSlideVisibility = function(slides) {
slides = slides || this.slides;
if(!slides || !slides.length ) return;
for(var i = 0; i < slides.length; ++i){
var s = slides[i];
if(s){
YAHOO.util.Dom.addClass(s, 'hidden');
}
var t = s.getAttribute('data-begin');
if (!isNaN(t)) {
if (t.length === 6) {
var tHour = parseInt(t.substr(0, 2)),
tMin = parseInt(t.substr(2, 2)),
tSec = parseInt(t.substr(4, 2));
if (tHour <= 23 && tMin <= 59 && tSec <= 59) {
t = tHour * 3600 + tMin * 60 + tSec * 1;
}
} else {
console.log('The data-begin attribute is not in hhmmss format.');
}
this.intervals.push(t * 1000);
}
}
YAHOO.util.Dom.removeClass(slides[0], 'hidden');
console.log("Slideshow intervals.", this.intervals);
};
S.prototype.initSoundManager = function(audio){
audio   = audio || this.audio;
this.sm = null;
if(audio) {
for(var i = 0; i < audio.children.length; ++i){
var source = audio.children[i];
var src    = source.src ? decodeURIComponent(source.src) : null;
if(src && SM.canPlayURL(src)){
this.sm = SM.createSound({
id: this.id,
url: src,
whileplaying: this.audioMoveSlider.bind(this)
});
if(this.sm){
this.sm.load();
break;
}
}
}
}
if(!this.sm){
console.error("The sound was NOT initialized correctly, no sound.", audio, this.sm);
}
return this.sm;
};
S.prototype.bindSlideToSound = function(sm, intervals, slides){
sm       = sm        || this.sm;
intevals = intervals || this.intervals;
slides   = slides    || this.slides;
if(!sm || !intervals || !slides) return;
for(var i = 0; i < intervals.length; ++i){
var t = intervals[i];
}
};
S.prototype.createControls = function(insertBefore){
insertBefore = insertBefore || this.audio;
var main = slide.Element('span', {
className: 'slide_controls_contain'
});
main.setAttribute('aria-controls', this.id);
this.prevBtn = slide.addElement(main, 'button', {
className: 'slide_controls_btn slide_controls_prev_btn',
type: 'button', onclick: this.prev.bind(this)
}, '<');
this.prevBtn.setAttribute('aria-label', slide.Tags.Prev);
this.playBtn = slide.addElement(main, 'button', {
className: 'slide_controls_btn slide_controls_play_btn',
type: 'button', onclick:  this.playBtnClick.bind(this)
}, 'â–º');
this.playBtn.setAttribute('aria-label', slide.Tags.Play);
this.pauseBtn = slide.addElement(main, 'button', {
className: 'slide_controls_btn slide_controls_stop_btn hidden',
type: 'button', onclick: this.pauseBtnClick.bind(this)
}, 'âšâš');
this.pauseBtn.setAttribute('aria-label', slide.Tags.Stop);
this.nextBtn = slide.addElement(main, 'button', {
className: 'slide_controls_btn slide_controls_next_btn',
type: 'button', onclick: this.next.bind(this)
}, '>');
this.nextBtn.setAttribute('aria-label', slide.Tags.Next);
var sliderDom = this.createSlider();
main.appendChild(sliderDom);
this.container.insertBefore(main, insertBefore);
};
S.prototype.createSlider = function(dom){
var maxWidth = 190;
var d   = slide.Element('div', {
className: 'slide_controls_slider yui-h-slider',
style: {width: maxWidth + 'px'}
});
try{
var idBg  = 'slider_bg_' + this.id;
var idImg = 'slider_image_' + this.id;
var bg  = slide.addElement(d, 'div'  , {id: idBg, className: 'slide_controls_slider_bg'});
var img = slide.addElement(bg, 'span' , {
id: idImg,
className: 'slide_controls_img'
});
var slider   = YAHOO.widget.Slider.getHorizSlider(idBg, idImg, 0, maxWidth);
slider.maxWidth = maxWidth;
this.slider = slider;
this.subscribeAll(this.slider);
} catch(e){
console.error('Failed to create a slider?', e);
}
return d;
};
S.prototype.subscribeAll = function(slider){
slider.subscribe('change', this.sliderChange.bind(this));
slider.subscribe('slideEnd', this.sliderEnd.bind(this));
};
S.prototype.sliderEnd = function(evt){
if(this.slider.valueChangeSource == 1){
if(this.offset == null){
return;
}
var change = (this.offset / this.slider.maxWidth);
var time   = this.sm.durationEstimate * change;
this.setPosition(time);
}
};
S.prototype.lock = function(){
this.SliderMove = true;
};
S.prototype.unlock = function(immediate){
if(!this.unlockCb){
this.unlockCb = function(){
this.unlockCb = null;
this.SliderMove = false;
}.bind(this);
if(!immediate){
setTimeout(this.unlockCb, slide.Config.TimerMove);
}else{
this.unlockCb();
}
}
};
S.prototype.isLocked = function(){
return this.SliderMove;
};
S.prototype.sliderChange = function(offset){
try{
this.lock();
if(this.slider.valueChangeSource == 1){
this.offset = offset;
}else{
this.offset = null;
}
}catch(e){
console.error("Failed to slider change the position of the audio.", e);
}
this.unlock();
};
S.prototype.setPauseCb = function(cb){
this.audioPauseCb = cb;
};
S.prototype.audioPause = function(time){
if(typeof this.audioPauseCb == 'function'){
try{
this.audioPauseCb();
}catch(e){
console.error("Failed to run the audio callback.", e);
}
this.audioPauseCb = null;
}
};
S.prototype.audioMoveSlider = function(time){
if(this.isLocked()) return;
try{
time     = time || this.sm.position || this.time;
var pos  = this.slider.maxWidth * (this.sm.position / this.sm.durationEstimate);
this.slider.setValue(Math.floor(pos));
this.setSlideByTime(time);
}catch(e){
console.error("Failed to move the slider.", e);
}
};
S.prototype.playBtnClick = function(evt, time){
try{
this.play(time);
this.stopEvt(evt || window.event);
YAHOO.util.Dom.removeClass(this.pauseBtn, 'hidden');
YAHOO.util.Dom.addClass(this.playBtn, 'hidden');
} catch(e){
console.error("Failed to start play.", e);
}
};
S.prototype.pauseBtnClick = function(evt, cb){
try {
this.pause(cb);
this.stopEvt(evt || window.event);
YAHOO.util.Dom.removeClass(this.playBtn, 'hidden');
YAHOO.util.Dom.addClass(this.pauseBtn, 'hidden');
}catch(e){
console.error("Failed to pause the audio.", e);
}
};
S.prototype.next = function(evt) {
try{
this.stopEvt(evt);
var index = this.getSlideIndexByTime(this.sm.position);
if ((index+1) < this.slides.length) {
var t = this.intervals[index+1];
this.setPosition(t);
}
}catch(e){
console.error("Failed to set position again?", e);
}
};
S.prototype.prev = function(evt) {
try{
this.stopEvt(evt);
var index = this.getSlideIndexByTime(this.sm.position);
if ((index-1) >= 0) {
this.setPosition(this.intervals[index-1]);
}
}catch(e){
console.error("Failed to set the previous position.", e);
}
};
S.prototype.setPosition = function(time){
time = !isNaN(time) && time != null ?  time : (this.time || this.sm.position);
try{
time = Math.ceil(time);
var playAtPosition = function(time){
this.lock();
this.time = time;
this.setSlideByTime(time);
this.sm.setPosition(time);
this.playBtnClick(null, time);
this.unlock();
}.bind(this, time);
this.pause(playAtPosition);
}catch(e){
console.error("Failed to setPosition on the slider.", e);
}
};
S.prototype.getSlideIndexByTime = function(t){
var len = this.intervals.length
for (var i=1; i < len; ++i){
if(t <= this.intervals[i]){
return i-1;
}
}
return len-1;
};
S.prototype.setSlideByTime = function(t) {
this.setSlide(this.getSlideIndexByTime(t));
};
S.prototype.hideAll = function(exceptAtIndex) {
try {
for(var i = 0; i < this.slides.length; ++i) {
if(exceptAtIndex != null && i != exceptAtIndex){
YAHOO.util.Dom.addClass(this.slides[i], 'hidden');
}
}
} catch (e) {
console.error("Failed to hide all the slides.", e);
}
};
S.prototype.setSlide = function(index) {
if(index != this.position){
this.position = index;
this.hideAll(index);
YAHOO.util.Dom.removeClass(this.slides[index], 'hidden');
}
};
S.prototype.resetAudio = function(){
try{
var timeH = 1000;
this.unlock(true);
this.sm.setPosition(timeH);
this.audioMoveSlider(timeH);
this.time = timeH;
}catch(e){
console.error("Failed to reset the audio.", e);
}
};
S.prototype.onFinish = function(){
this.pauseBtnClick(null, this.resetAudio.bind(this));
slide.onIdle.fire();
};
S.prototype.play = function(time) {
try{
time = !isNaN(time) && time != null ? time : (this.time || this.sm.position || 0);
this.sm && this.sm.play({
position: time,
onpause: this.audioPause.bind(this),
whileplaying: this.audioMoveSlider.bind(this),
onfinish: this.onFinish.bind(this)
});
slide.onPlay.fire();
}catch(e){
console.error("Failed to play the file.", e);
slide.onIdle.fire();
}
};
S.prototype.pause = function(cb) {
if(!this.sm.paused && this.sm.playState){
this.setPauseCb(cb);
this.sm && this.sm.pause();
slide.onIdle.fire();
}else if(typeof cb == 'function'){
cb();
}
};
window.slide      = slide;
window.slide.Show = S;
})();

/* SOURCE FILE: module_slideshow.js (6277ad14) 9/9/2014 2:08:51 PM */

ContentManager.onPageEvent('loaded', function(page) {
if (page && window.slide && window.slide.scanAndBuild) {
var doc = page.getElement();
if (doc) {
soundManager.onready(slide.scanAndBuild.bind(slide, doc.body || doc));
}
}
});
ContentManager.onPageEvent('hide', function(page) {
if (page && window.slide) {
slide.pauseAll();
}
});

/* SOURCE FILE: main.js (ec426186) 10/26/2014 1:27:05 PM */

TDS = window.TDS || {};
var YUD = YAHOO.util.Dom;
TDS.Mask = {
Config: {
minH: 0,
minW: 5,
Debug: true,
Enabled: true,
altEventName: '',
eventName: '',
cls: {
INIT: 'tds_mask_init',
MOVE: 'tds_mask_move',
FIN:  'tds_mask_fin'
},
DialogClass: 'TDS.Mask.Dialog',
EnableClickClass: true,
ClickClasses:[
'thePassage',
'theQuestions',
'layoutColumnLeft',
'layoutColumnRight',
'itemContainer'
],
isScrollable: function(el){
if (YUD.hasClass(el, 'thePassage') === true || YUD.hasClass(el, 'theQuestions') === true) {
return true;
} else return false;
},
isTouchScreen: 'ontouchstart' in window ? true : false
},
EVENTS:  null,
CONTROL: null,
STATUS: 'off',
PAGE: null,
initialize: function(){
var ctrl =  new TDS.Mask.Control();
ctrl.setDialogClass(TDS.Mask.Config.DialogClass);
TDS.Mask.CONTROL = ctrl;
var em   = new TDS.Mask.EventManager();
em.setControl(ctrl);
TDS.Mask.EVENTS  = em;
},
getControl: function(){
return TDS.Mask.CONTROL;
},
getEvents: function(){
return TDS.Mask.EVENTS;
},
setPageDom: function(pageDom){
TDS.Mask.PAGE = pageDom;
},
setPageId: function(pageId){
var ctrl = TDS.Mask.getControl();
if(ctrl){
var pId = ctrl.getActivePageId();
ctrl.setActivePageId(pageId);
if(pId != pageId){
ctrl.off();
}
}
},
create: function(pageDom, pageId, evt){
var ctrl = TDS.Mask.getControl();
if(!ctrl){ return;}
pageDom = pageDom || TDS.Mask.PAGE;
ctrl.newMask(pageDom, pageId, evt);
this.on(null, pageId);
this.STATUS = 'on';
},
on: function(id, pageId, win){
win = win || window;
var ctrl = TDS.Mask.getControl(); if(!ctrl){return;}
(id || pageId) ? ctrl.on({id: id, pageId: pageId}) : ctrl.on();
var eM = TDS.Mask.getEvents(); if(!eM){return;}
eM.setPageId(pageId);
eM.listen(TDS.Mask.PAGE);
},
off: function(id, pageId){
var ctrl = TDS.Mask.getControl();
if(!ctrl){ return;}
ctrl.off({id: id, pageId: pageId});
this.STATUS = 'off';
},
hide: function (id, pageId) {
var ctrl = TDS.Mask.getControl();
if (!ctrl) { return; }
ctrl.hide({ id: id, pageId: pageId });
this.getEvents().sleep();
this.STATUS = 'off';
},
clear: function(instanceOrId){
},
toggle: function() {
if (this.STATUS === 'off') {
this.create();
} else {
this.off();
}
}
};

/* SOURCE FILE: control.js (db49ae3f) 10/26/2014 1:27:05 PM */

(function(){
var YUD = YAHOO.util.Dom;
var CFG = TDS.Mask.Config || {};
TDS.Mask.Control = function(args){
args = args || {};
this.setActivePageId(args.pageId);
this.setDialogClass(args.dialogClass || TDS.Mask.Config.DialogClass);
this._maskInCreation = null;
this.sequence = 0;
};
C = TDS.Mask.Control;
C.prototype.setDialogClass = function(str){
var cls = null;
if(typeof str == 'string'){
var cmp = str.split('.');
var ref = window;
for(var i=0; i<cmp.length; ++i){
if(ref[cmp[i]]){
ref = ref[cmp[i]];
}
}
CFG.Debug && console.log("lookup the class?", ref);
}
this._dialogClass = str;
};
C.prototype.getScrollParent = function(el){
if(!el){return;}
var pScroll = CFG.isScrollable(el) ? el : null;
while(!pScroll && el && el.parentNode && !el.nodeName != 'BODY'){
el = el.parentNode;
if(CFG.isScrollable(el)){
pScroll = el;
}
}
return pScroll;
};
C.prototype.genId = function(){
return 'tds_mask_' + (this.sequence++);
};
C.prototype.createMask = function(page, x, y, w, h, debugMsg){
var dialog = null;
var id = this.genId();
if(typeof this._dialogClass == 'function'){
dialog = new this._dialogClass(x, y, w, h, debugMsg);
dialog.id = id;
dialog.close = this.close.bind(this, id);
}else{
dialog =  document.createElement('div');
dialog.id = id;
dialog.innerHTML = debugMsg || '';
YUD.addClass(dialog, "tds_mask_container");
var close = document.createElement('button');
close.innerHTML = 'x';
close.onclick   = this.close.bind(this, id);
YUD.addClass(close, 'tds_mask_close');
dialog.appendChild(close);
CFG.Debug && console.log("createMask div (page, dialog, x, y, w, h)", page, dialog, x, y, w, h);
YUD.setStyle(dialog, 'position', 'fixed');
YUD.setStyle(dialog, 'left', x + 'px');
YUD.setStyle(dialog, 'top', y + 'px');
YUD.setStyle(dialog, 'width', w + 'px');
YUD.setStyle(dialog, 'height', h + 'px');
document.body.appendChild(dialog);
}
return dialog;
};
C.prototype.close = function(id){
console.log("Close this item.", id);
var dialog = TDS.Mask.Store.get(id);
if(dialog && typeof dialog.close == 'function'){
dialog.close();
delete dialog;
}else if(dialog.parentNode){
dialog.parentNode.removeChild(dialog);
}
TDS.Mask.Store.remove(id);
};
C.prototype.hide = function(optionalQuery){
var masks = TDS.Mask.Store.query(optionalQuery);
console.log("What came from masks?", masks);
if(!masks){return;}
for(var i = 0; i<masks.length; ++i){
var mask = masks[i];
if(mask && typeof mask.hide == 'function'){
mask.hide();
}else{
YUD.addClass(mask, 'hidden');
}
}
this.removeIndicateDrawingContainer();
};
C.prototype.show = function(optionalQuery){
var masks = TDS.Mask.Store.query(optionalQuery);
if(!masks){return;}
CFG.Debug && console.log("Should show these (masks, query)", masks, optionalQuery);
for(var i = 0; i<masks.length; ++i){
var mask = masks[i];
if(mask && typeof mask.show == 'function'){
mask.hide();
}else{
YUD.removeClass(mask, 'hidden');
}
}
};
C.prototype.on = function(query){
try{
query = query || {pageId: this.getActivePageId()};
CFG.Debug && console.log("TDS.Mask.Conrol.on with query: ", query);
this.show(query);
}catch(e){
console.error("Failed to turn on the masks for this query.", query, e);
}
};
C.prototype.off = function(query){
try{
console.log("Turn off the items.", query);
this.removeAllListeners();
}catch(e){
console.error("Failed to turn off the masks for this query.", query);
}
this.removeIndicateDrawingContainer();
};
C.prototype.move = function(x, y, scrollDomSource, pageId){
CFG.Debug && console.log("Move the masks (x, y, el, pageId)", x, y, scrollDomSource, pageId);
pageId = pageId || this.getActivePageId();
var masks = TDS.Mask.Store.query({pageId: pageId});
if(masks && masks.length){
var mask = null;
for(var i=0; i<masks.length; ++i){
mask = masks[i];
if((scrollDomSource == mask.scrollDomSource) && mask.scrollDomSource){
var initX = YUD.getAttribute(mask, 'initialX');
var initY = YUD.getAttribute(mask, 'initialY');
YUD.setStyle(mask, 'top',  (initY - y) + 'px');
YUD.setStyle(mask, 'left', (initX - x) + 'px');
}
}
}
};
C.prototype.newMask  = function(page, pageId, evt){
page   = page   || TDS.Mask.PAGE        || document.body;
pageId = pageId || this.getActivePageId() || page.id;
if(pageId){
this.setActivePageId(pageId);
}
CFG.Debug  && console.log("newMask (page, pageId, evt)", page, pageId, evt);
this.removeAllListeners();
this.createListeners(
this.getClickElements(page),
this.initMaskClick.bind(this),
'mousedown',
CFG.cls.INIT
);
};
C.prototype.getActiveMasks = function(){
return TDS.Mask.Store.query({pageId: this.getActivePageId()});
};
C.prototype.getClickElements = function(page){
if(!CFG.EnableClickClass){return [page];}
var cls = null;
var elements = [];
for(var i=0; i<CFG.ClickClasses.length; ++i){
cls = CFG.ClickClasses[i];
var s = YAHOO.util.Selector.query('.' + cls, page)
if(s && s.length){
elements = elements.concat(s);
}
}
if(!elements.length){
elements = [page];
}
return elements;
};
C.prototype.stopEvt = function(evt){
evt = evt || window.event;
if(evt){
evt.stopPropagation ? evt.stopPropagation() : evt.cancelBubble = true;
evt.preventDefault  ? evt.preventDefault() : evt.returnValue = false;
}
};
C.prototype.createListeners = function(elements, func, evtName, cls){
if(!elements || typeof func != 'function'){return;}
if(!YAHOO.lang.isArray(elements)){
elements = [elements];
}
evtName = evtName || 'click';
if(!this.pageListeners){
this.pageListeners = [];
}
var scopeIt = function(el, cb, evt){ cb(el, evt); };
var el = null;
var listener = null;
for(var i=0; i<elements.length; ++i){
el = elements[i];
if(el){
listener =  scopeIt.bind(this, el, func);
var lsnr = this.addMouseListener(el, evtName, listener);
if (CFG.altEventName) {
this.pageListeners.push({
el: el,
evtName: CFG.altEventName,
listener: lsnr
});
}
this.pageListeners.push({
el: el,
evtName: CFG.eventName,
listener: lsnr
});
cls && YUD.addClass(el, cls);
}
}
return this.pageListeners;
};
C.prototype.addMouseListener = function (target, name, fn) {
var touchScreen = 'ontouchstart' in window;
var touchEvents = {
'mousedown': 'touchstart',
'mouseup': 'touchend',
'mousemove': 'touchmove'
};
var mouseEvents = {
'mousedown': 'mousedown',
'mouseup': 'mouseup',
'mousemove': 'mousemove'
};
var getWindowsNTVersion = function () {
var matches = navigator.userAgent.match(/Windows NT (\d+\.\d+)/);
var value;
if (matches && matches[1]) {
value = parseFloat(matches[1]);
}
return value || 0;
};
var supportsTouchAndMouse = function () {
return (touchScreen && getWindowsNTVersion() >= 6.1);
};
var normalizeTouchEvent = function (evt) {
if (evt.changedTouches) {
var touches = evt.changedTouches;
for (var i = 0, ii = touches.length; i < ii; i++) {
if (touches[i].target == evt.target) {
var oldevt = evt;
evt = touches[i];
evt.preventDefault = function () {
return oldevt.preventDefault();
};
evt.stopPropagation = function () {
return oldevt.stopPropagation();
};
return evt;
}
}
}
return evt;
};
var touchAndMouse = supportsTouchAndMouse();
var eventName, altEventName;
if (touchScreen) {
eventName = (touchEvents[name] || name);
if (touchAndMouse) {
altEventName = (mouseEvents[name] || name);
}
} else {
eventName = (mouseEvents[name] || name);
}
var processEvent = function (evt) {
if (touchAndMouse) {
evt.preventDefault();
}
if (touchScreen) {
evt = normalizeTouchEvent(evt);
}
fn(evt);
};
if (eventName) {
target.addEventListener(eventName, processEvent, false);
if (altEventName) {
target.addEventListener(altEventName, processEvent, false);
}
}
CFG.eventName = eventName;
if (altEventName) {
CFG.altEventName = altEventName;
}
return processEvent;
};
C.prototype.removeMaskClasses = function(elements){
if(!elements || !elements.length){return;}
var el = null;
for(var i=0; i<elements.length; ++i){
el = elements[i];
YUD.removeClass(el, CFG.cls.INIT);
YUD.removeClass(el, CFG.cls.MOVE);
YUD.removeClass(el, CFG.cls.FIN);
}
};
C.prototype.removeAllListeners = function(){
if(this.pageListeners){
for(var i=0; i<this.pageListeners.length; ++i){
try{
var cfg = this.pageListeners[i];
if(cfg && cfg.el && cfg.listener){
cfg.el.removeEventListener(cfg.evtName, cfg.listener, false);
this.removeMaskClasses([cfg.el]);
}
}catch(e){
CFG.Debug && console.error("Failed to remove event listener. cfg, e", cfg, e);
}
}
}
this.pageListeners = null;
};
C.prototype.initMaskClick = function(page, evt){
this.stopEvt(evt);
this.removeAllListeners();
this.firstClick = evt;
if (CFG.isTouchScreen) {
this.firstClick = {
clientX: evt.clientX,
clientY: evt.clientY
};
}
this.createListeners(
this.getClickElements(page),
this.mouseMove.bind(this),
'mousemove'
);
this.createListeners(
this.getClickElements(page),
this.mouseUp.bind(this),
'mouseup',
CFG.cls.MOVE
);
};
C.prototype.mouseMove = function (page, evt) {
this.stopEvt(evt);
if (!this.firstClick) return;
this.indicateDrawing(this.firstClick, evt);
};
C.prototype.indicateDrawing = function (a, b) {
if (!a || !b) { return; }
var x = a.clientX <= b.clientX ? a.clientX : b.clientX;
var y = a.clientY <= b.clientY ? a.clientY : b.clientY;
var w = Math.abs(a.clientX - b.clientX);
var h = Math.abs(a.clientY - b.clientY);
var iDrawing = document.getElementById('indicateDrawingContainer');
if (!iDrawing && w > CFG.minW && h > CFG.minH) {
iDrawing = document.createElement('div');
iDrawing.setAttribute('id', 'indicateDrawingContainer');
YUD.setStyle(iDrawing, 'position', 'fixed');
YUD.addClass(iDrawing, 'tds_mask_container tds_mask_container_drawing');
document.body.appendChild(iDrawing);
this.createListeners(
iDrawing,
this.mouseMove.bind(this),
'mousemove'
);
this.createListeners(
iDrawing,
this.mouseUp.bind(this),
'mouseup',
CFG.cls.MOVE
);
}
YUD.setStyle(iDrawing, 'left', x + 'px');
YUD.setStyle(iDrawing, 'top', y + 'px');
YUD.setStyle(iDrawing, 'width', w + 'px');
YUD.setStyle(iDrawing, 'height', h + 'px');
};
C.prototype.mouseUp = function (page, evt) {
var box = this.determineBox(this.firstClick, evt);
if(box){
this.finishMaskClick(page, evt);
}else {
this.removeAllListeners();
this.createListeners(
this.getClickElements(page),
this.finishMaskClick.bind(this),
'mousedown',
CFG.cls.FIN
);
if (!CFG.isTouchScreen) {
this.createListeners(
this.getClickElements(page),
this.mouseMove.bind(this),
'mousemove'
);
}
}
};
C.prototype.finishMaskClick = function (page, evt) {
try {
this.stopEvt(evt);
this.removeAllListeners();
this.removeIndicateDrawingContainer();
this.secondClick = evt;
CFG.Debug && console.log("Finish mask click", page, this.firstClick, this.secondClick);
var box = this.determineBox(this.firstClick, this.secondClick);
if (box) {
this.initializeBox(page, box);
}
TDS.Mask.create();
} catch (e) {
console.error("Cannot finish mask click.", e);
}
};
C.prototype.removeIndicateDrawingContainer = function () {
var iDrawing = document.getElementById('indicateDrawingContainer');
if (iDrawing) {
document.body.removeChild(iDrawing);
}
};
C.prototype.determineBox = function(a, b){
if (!a || !b) { return; }
var box = {
tX: a.clientX <= b.clientX ? a.clientX : b.clientX,
tY: a.clientY <= b.clientY ? a.clientY : b.clientY,
bX: a.clientY <= b.clientX ? b.clientX : a.clientX,
bY: a.clientY <= b.clientX ? b.clientY : a.clientY,
w: Math.abs(a.clientX - b.clientX),
h: Math.abs(a.clientY - b.clientY)
};
if(box && (box.w > CFG.minW) && (box.h > CFG.minH)){
return box;
}
};
C.prototype.initializeBox = function(page, box){
try {
var dialog = this.createMask(page, box.tX, box.tY, box.w, box.h);
if(dialog){
var pScroll = this.getScrollParent(page);
if(pScroll){
box.tX += (pScroll.scrollLeft || 0);
box.tY += (pScroll.scrollTop  || 0);
dialog.scrollDomSource = pScroll;
}
YUD.setAttribute(dialog, 'initialX',  box.tX);
YUD.setAttribute(dialog, 'initialY',  box.tY);
dialog.pageId = this.getActivePageId() || page.id;
TDS.Mask.Store.set(dialog);
}
}catch(e){
console.error("Failed to initialize basic box model.", e);
}
};
C.prototype.abortMask = function(){
};
C.prototype.setActivePageId = function(pageId){
this._pageId = pageId;
};
C.prototype.getActivePageId = function(){
return this._pageId;
};
TDS.Mask.Store = {
Instances: {
},
get: function(id){
return TDS.Mask.Store.Instances[id];
},
remove: function(id){
if(TDS.Mask.Store.Instances[id]){
delete TDS.Mask.Store.Instances[id];
}
},
set: function(obj, id){
if(obj){
if(!obj.id){
obj.id = obj.id || id || ('tds_mask_' + (++TDS.Mask.Store.id));
}
TDS.Mask.Store.Instances[id || obj.id] = obj;
}
},
match: function(q, obj){
if(!obj || !obj.id){return;}
if((!q.id     || (q.id     == '*' || q.id.indexOf(obj.id) != -1)) &&
(!q.pageId || (q.pageId == '*' || q.pageId.indexOf(obj.pageId) != -1))){
return true;
}
},
query: function(q, matchFunc){
q = q || {id: '*'};
if(q && (q.id || q.pageId)){
if(q.id && q.id != '*' && !YAHOO.lang.isArray(q.id)){
q.id = [q.id];
}
if(q.pageId && !YAHOO.lang.isArray(q.pageId)){
q.pageId = [q.pageId];
}
}
if(typeof matchFunc != 'function'){
matchFunc = TDS.Mask.Store.match;
}
var results = [];
for(var k in TDS.Mask.Store.Instances){
if(k && typeof k != 'function'){
var obj = TDS.Mask.Store.Instances[k];
if(matchFunc(q, obj)){
results.push(obj);
}
}
}
return results;
}
};
})();

/* SOURCE FILE: events.js (cba4facd) 9/9/2014 2:09:01 PM */

(function(){
var CFG = TDS.Mask.Config;
TDS.Mask.EventManager = function(ctrl, doc){
this._listeners = null;
this.setControl(ctrl);
this.setScrollDocument(doc);
};
var eM = TDS.Mask.EventManager;
eM.prototype.getPageId = function(){
return this._pageId;
};
eM.prototype.setPageId = function(pageId){
this._pageId = pageId;
};
eM.prototype.getControl = function(){
return this._ctrl;
};
eM.prototype.setControl = function(ctrl){
this._ctrl = ctrl;
};
eM.prototype.setScrollDocument = function(doc){
doc = doc || document;
this._document = doc;
};
eM.prototype.getScrollDocument = function(){
return this._document || document.body;
}
eM.prototype.isElScrollable = function(dom){
if(!dom){return;}
var hasHorizontalScrollbar = dom.scrollWidth>div.clientWidth;
var hasVerticalScrollbar   = dom.scrollHeight>div.clientHeight;
if(hasHorizontalScrollbar || hasVerticalScrollbar){
return {
vertical: hasVerticalScrollbar,
horizontal: hasHorizontalScrollbar
};
}
return false;
};
eM.prototype.applyScroll = function(x, y, scrollContainer){
var ctrl = this.getControl();
if(ctrl){
ctrl.move(x, y, scrollContainer);
}
};
eM.prototype.findScrollable = function(dom){
if(dom && CFG.isScrollable(dom)){
return true;
}
return false;
};
eM.prototype.dfs = function(el, match, results){
if(!el){return;}
match   = typeof match == 'function' ? match : function(){return true};
results = results || [];
if(match(el)){
results.push(el);
}
var children = el.childNodes;
if(children){
for(var i=0; i<children.length; ++i){
this.dfs(children[i], match, results);
}
}
return results;
};
eM.prototype.stopEvt = function(evt){
evt = evt || window.event;
if(evt){
evt.stopPropagation ? evt.stopPropagation() : evt.cancelBubble = true;
evt.preventDefault  ? evt.preventDefault() : evt.returnValue = false;
}
};
eM.prototype.scrollDiff = function(el, evt){
try{
var sD = this.getScrollDocument();
var doc = sD && sD.documentElement ? sD.documentElement : document.documentElement;
var left = (window.pageXOffset  || doc.scrollLeft) - (doc.clientLeft || 0);
var top  = (window.pageYOffset  || doc.scrollTop)  - (doc.clientTop || 0);
var elTop  = el ? el.scrollTop  : 0;
var elLeft = el ? el.scrollLeft : 0;
var ctrl = this.getControl();
ctrl.move(left + elLeft, top + elTop, el)
}catch(e){
console.error("Failed to scroll correctly.", e);
}
};
eM.prototype.listen = function(docOrDom, cb, evtName){
if(this._listeners && this._listeners.length) { return; }
CFG.Debug && console.log("What is in eventManager listen?", docOrDom, cb);
evtName  = evtName || 'scroll';
docOrDom = docOrDom || this.getScrollDocument();
docOrDom = docOrDom && docOrDom.body ? docOrDom.body : docOrDom;
cb  = typeof cb == 'function' ? cb : this.scrollDiff;
var results = this.dfs(docOrDom, this.findScrollable);
CFG.Debug && console.log("Tried to find scrollable elements, results (docOrDom, results) ", docOrDom, results);
if(!results || !results.length){
results = [this.getScrollDocument()];
}
this._listeners = [];
for(var i=0; i<results.length; ++i){
var el     = results[i];
var listen = cb.bind(this, el);
el.addEventListener(evtName, listen, false);
this._listeners.push({
evtName: evtName,
el: el,
listen: listen
});
}
};
eM.prototype.sleep = function(){
if(!this._listeners){ return; }
for(var i=0; i<this._listeners.length;++i){
var cfg = this._listeners[i];
if(cfg && cfg.el && typeof cfg.listen == 'function'){
cfg.el.removeEventListener(cfg.evtName, cfg.listen, false);
}
}
this._listeners = null;
};
})();

/* SOURCE FILE: module_mask.js (eef3fe36) 9/9/2014 2:08:51 PM */

YAHOO.util.Event.onDOMReady(function(){
if(window.TDS && !window.TDS.Mask){ return; }
var accProps = ContentManager.getAccommodationProperties();
if(accProps.getSelectedCode('Masking') == 'TDS_Masking0'){
console.warn("Masking not enabled.");
return;
}
TDS.Mask.Config.Debug = true;
TDS.Mask.initialize();
ContentManager.onPageEvent('show', function(page) {
if(!page){return;}
var doc    = page.getElement();
var pageId = page.id;
TDS.Mask.setPageId(pageId);
TDS.Mask.setPageDom(doc);
});
ContentManager.onPageEvent('hide', function(page) {
console.log("Turn of masking on a hide.");
TDS.Mask.hide();
});
});

/* SOURCE FILE: edit.interaction.js (b9b4b91e) 9/9/2014 2:08:52 PM */

EditItem = (typeof (EditItem) == "undefined") ? {} : EditItem;
EditItem.InteractionSet = function () {
var self = this;
this.interactions = [];
this.forEachInteraction = function (ftor) {
for (var i = 0; i < self.interactions.length; ++i) {
ftor.call(this,self.interactions[i]);
}
};
this.getInteraction = function (ctor) {
for (var i = 0; i < self.interactions.length; ++i) {
if (ctor.call(this,self.interactions[i]))
return self.interactions[i];
}
return null;
};
this.push = function (interaction) {
self.interactions.push(interaction);
};
this.get = function (i) {
return self.interactions[i];
};
this.getXmlResponse = function () {
var responseBody = '';
this.forEachInteraction(function (interaction) {
responseBody = responseBody + interaction.getXmlResponse();
});
if (responseBody.length == 0)
return '';
var rv = '<testeeResponse>' + responseBody + '</testeeResponse>';
return rv;
};
this.setXmlResponse = function (xmlString) {
var xmlDoc = Util.Xml.parseFromString(xmlString);
var nodeAr = xmlDoc.getElementsByTagName('value');
for (var i = 0; nodeAr && i < nodeAr.length; ++i) {
var matchInteraction = self.getInteraction(function (interaction) {
var id = nodeAr[i].getAttribute('responseIdentifier');
return interaction.getId() == id;
});
if (matchInteraction) {
var node = nodeAr[i];
var newValue = '';
if (!node.getAttribute('choiceIdentifier')) {
for (var j = 0; j < node.childNodes.length; ++j) {
var inner = node.childNodes[j];
newValue = newValue + Util.Xml.serializeToString(inner);
}
} else {
newValue = newValue + node.getAttribute('choiceIdentifier');
}
matchInteraction.setXmlResponse(newValue);
}
}
this.redisplay();
};
};
EditItem.Interaction = function (parentIdentifier, identifier) {
this.getId = function () {
return identifier;
};
this.getParentId = function () {
return parentIdentifier;
};
};
EditItem.Interaction.Choice = function (parentId, identifier, shuffle, inlineChoices) {
var self = this;
this._inlineChoices = inlineChoices;
EditItem.Interaction.call(this, parentId, identifier);
this.forEachInlineChoice = function (ftor) {
for (var j = 0; j < inlineChoices.length; ++j) {
ftor.call(this,inlineChoices[j]);
}
};
this.getInlineChoice = function (comparator) {
for (var j = 0; j < inlineChoices.length; ++j) {
if (comparator.call(this,inlineChoices[j])) {
return inlineChoices[j];
}
}
return null;
};
this.getDefaultChoice = function () {
var rv = this.getInlineChoice(function (choice) {
return choice.showDefault;
});
return rv;
};
this.createDivId = function () {
return self.getParentId() + '-' + 'inlineChoiceInteraction' + '-' + self.getId();
};
this.get = function (i) {
return (inlineChoices.length > i) ? inlineChoices[i] : null;
};
this.setXmlResponse = function (string) {
this.forEachInlineChoice(function(choice) {
choice.selected = false;
if (choice.identifier == string) {
choice.selected = true;
}
});
};
this.getXmlResponse = function () {
var responseBody = '';
this.forEachInlineChoice(function (choice) {
if ((choice.selected === true) && (choice.showDefault === false))
responseBody = '<value responseIdentifier="' + this.getId() + '" choiceIdentifier="' + choice.identifier + '">' + choice.identifier + '</value>\n';
});
return responseBody;
};
};
EditItem.Interaction.Text = function (parentId, identifier, content) {
var self = this;
this.responseValue = '';
EditItem.Interaction.call(this, parentId, identifier);
this.setXmlResponse= function (xmlString) {
this.responseValue = xmlString;
};
this.createDivId = function () {
return this.getParentId() + '-' + 'textEntryInteraction' + '-' + this.getId();
};
this.getContent = function () {
return content;
};
this.getXmlResponse = function () {
if (self.responseValue && /\S/.test(self.responseValue))
return '<value responseIdentifier="' + this.getId() + '">' + self.responseValue + '</value>\n';
return '';
};
};

/* SOURCE FILE: edit.parse.js (fd1db5d2) 9/9/2014 2:08:52 PM */

EditItem = (typeof (EditItem) == "undefined") ? {} : EditItem;
EditItem.Parse = function (id) {
this.mid = id;
var self = this;
this.choiceInteractions = new EditItem.Html.Choice();
this.textInteractions = new EditItem.Html.Text();
this.createFromFile = function (xmlUrl) {
var xmlhttp;
if ((typeof (window.XMLHttpRequest) == "function") ||
(typeof (window.XMLHttpRequest) == "object")) {
xmlhttp = new XMLHttpRequest();
}
else {
xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
}
xmlhttp.open("GET", xmlUrl, false);
xmlhttp.send();
var xmlDoc = xmlhttp.responseText;
return this.createFromXml(xmlDoc);
};
this.createDivId = function (nodeType, identifier) {
return self.mid + '-' + nodeType + '-' + identifier;
};
var fixXmlTasks;
var fixXmlRecurse = function (parentNode) {
for (var i = 0; i < parentNode.childNodes.length; ++i) {
var childNode = parentNode.childNodes[i];
if ((childNode.nodeName == 'inlineChoiceInteraction') ||
(childNode.nodeName == 'textEntryInteraction')) {
var obj = {
parent: parentNode,
child: childNode
};
fixXmlTasks.push(obj);
} else
fixXmlRecurse(childNode);
}
};
var fixXml = function (xmlDoc, parentNode) {
fixXmlTasks = [];
fixXmlRecurse(parentNode);
for (var i = 0; i < fixXmlTasks.length; ++i) {
var span = xmlDoc.createElement('span');
var parent = fixXmlTasks[i].parent;
var child = fixXmlTasks[i].child;
var identifier = YUD.getAttribute(child, 'responseIdentifier');
var nid = self.createDivId(child.nodeName, identifier);
span.setAttribute('id', nid);
Util.Dom.setTextContent(span, ' ');
parent.replaceChild(span, child);
}
};
var removeItemBody = function (doc) {
var itemBody = doc.getElementsByTagName('itemBody');
if (itemBody && itemBody.length) {
if (itemBody && itemBody.length == 1) {
var bodyElement = itemBody[0];
var ndiv = doc.createElement('div');
var bodyChildren = YUD.getChildren(bodyElement);
for (var j = 0; j < bodyChildren.length; ++j) {
var childNode = bodyChildren[j];
var childClone = childNode.cloneNode(true);
ndiv.appendChild(childClone);
}
bodyElement.parentNode.replaceChild(ndiv, bodyElement);
}
}
};
var parseChoiceInteractions = function (xmlElements) {
var interactionElements = xmlElements.getElementsByTagName('inlineChoiceInteraction');
for (var i = 0; i < interactionElements.length; ++i) {
var interactionElement = interactionElements[i];
var choices = interactionElement.getElementsByTagName('inlineChoice');
var interactionObj = {
identifier: YUD.getAttribute(interactionElement, 'responseIdentifier'),
shuffle: YUD.getAttribute(interactionElement, 'shuffle'),
inlineChoices: []
};
for (var j = 0; j < choices.length; ++j) {
var choice = choices[j];
var obj = {
identifier: YUD.getAttribute(choice, 'identifier'),
showDefault: ((YUD.getAttribute(choice, 'default') == 'true') ? true : false),
content: ''
};
for (var k = 0; k < choice.childNodes.length; ++k) {
var cnode = choice.childNodes[k];
var cstr = Util.Xml.serializeToString(cnode);
obj.content = obj.content + cstr;
}
interactionObj.inlineChoices.push(obj);
}
var choiceInteraction = new EditItem.Interaction.Choice(
id, interactionObj.identifier, interactionObj.shuffle, interactionObj.inlineChoices);
self.choiceInteractions.push(choiceInteraction);
}
};
var parseTextInteractions = function (xmlElements) {
var interactionElements = xmlElements.getElementsByTagName('textEntryInteraction');
for (var i = 0; i < interactionElements.length; ++i) {
var interactionElement = interactionElements[i];
var interactionObj = {
identifier: YUD.getAttribute(interactionElement, 'responseIdentifier'),
content: ''
};
for (var k = 0; k < interactionElement.childNodes.length; ++k) {
var cnode = interactionElement.childNodes[k];
var cstr = Util.Xml.serializeToString(cnode);
interactionObj.content = interactionObj.content + cstr;
}
var editObj = new EditItem.Interaction.Text(id, interactionObj.identifier, interactionObj.content);
self.textInteractions.push(editObj);
}
};
this.createFromXml = function (xmlString,container) {
var xmlDoc = Util.Xml.parseFromString(xmlString);
removeItemBody(xmlDoc);
var xmlNodes = xmlDoc.documentElement;
parseChoiceInteractions(xmlNodes);
parseTextInteractions(xmlNodes);
fixXml(xmlDoc, xmlNodes);
var aDiv = document.createElement('div');
aDiv.innerHTML = Util.Xml.serializeToString(xmlNodes);
container.innerHTML = aDiv.childNodes[0].innerHTML;
};
};

/* SOURCE FILE: edit.html.js (8ae0ae54) 10/26/2014 1:27:05 PM */

EditItem = (typeof (EditItem) == "undefined") ? {} : EditItem;
EditItem.Html = function () {
if (EditItem.Html._activeDbInstance === undefined) {
EditItem.Html._activeDbInstance = {
interaction: null,
okHandler: null,
enterHandler: null,
choiceSpans: [],
textSpan: null
};
}
var self = this;
EditItem.InteractionSet.call(this);
this.getInteractionFromSpan = function (span) {
var spanId = span.getAttribute('id');
var nameAr = spanId.split('-');
return self.getInteraction(function (interaction) {
return interaction.getId() == nameAr[2];
});
};
this.createCrossoutSpan = function (crossoutContent, replaceContent, parentDiv) {
parentDiv.innerHTML = '';
YUD.setAttribute(parentDiv, 'tabindex', '0');
var crossoutSpan = document.createElement('span');
var replacementSpan = document.createElement('span');
crossoutSpan.innerHTML = crossoutContent;
parentDiv.setAttribute('role', 'button');
parentDiv.setAttribute('aria-haspopup', 'true');
parentDiv.setAttribute('title', 'click to correct');
if (replaceContent) {
YUD.addClass(crossoutSpan, 'edit-crossout');
crossoutSpan.setAttribute('title', 'crossed-out text');
YUD.addClass(replacementSpan, 'edit-newtext');
} else {
YUD.addClass(crossoutSpan, 'edit-originaltext');
}
var startCrossoutSpan = document.createElement('span');
YUD.addClass(startCrossoutSpan, 'hidden-spoken');
var spokenCue = Messages.getAlt('ET.strikethrough.begin', 'start crossed out text');
Util.Dom.setTextContent(startCrossoutSpan, spokenCue);
var endCrossoutSpan = document.createElement('span');
YUD.addClass(endCrossoutSpan, 'hidden-spoken');
spokenCue = Messages.getAlt('ET.strikethrough.end', 'end crossed out text');
Util.Dom.setTextContent(endCrossoutSpan, spokenCue);
if (replaceContent) {
parentDiv.appendChild(startCrossoutSpan);
parentDiv.appendChild(crossoutSpan);
parentDiv.appendChild(endCrossoutSpan);
Util.Dom.setTextContent(replacementSpan, replaceContent);
parentDiv.appendChild(replacementSpan);
} else {
parentDiv.appendChild(crossoutSpan);
}
};
this.createLabel = function (defaultPhrase, parentDiv, id) {
var stemLabel = document.createElement('label');
stemLabel.innerHTML = 'Replace "' + defaultPhrase + '" with:';
YUD.addClass(stemLabel, 'edit-db-stem');
YUD.setAttribute(stemLabel, 'for', id);
parentDiv.appendChild(stemLabel);
};
this.setDbPosition = function () {
if (EditItem.Html._activeDbInstance.activeSpan && EditItem.Html._activeDbInstance.panelWidget) {
var spanRegion = YUD.getRegion(EditItem.Html._activeDbInstance.activeSpan);
EditItem.Html._activeDbInstance.panelWidget.cfg.setProperty('xy', [spanRegion.x, spanRegion.y + spanRegion.height]);
}
};
this.handleKeyEvent = function(span, evt) {
if ((span) && (evt)) {
if (evt.key == 'Enter') {
if (typeof this.keyHandlerArray[span.id] == 'function') {
evt.stopPropagation();
evt.preventDefault();
YUD.addClass(span, 'TDS_EDIT_SPAN_HOVER');
this.keyHandlerArray[span.id]();
}
} else if (evt.key == 'Esc') {
evt.stopPropagation();
EditItem.Dialog._handleCancelButton(evt);
}
}
};
this.populateDialogBox = function (dialog, interaction) {
dialog.setHeader('Edit Tool');
YUD.addClass(dialog.header, 'edit-db-header');
var parentForm = this.createInteractionCore(interaction);
dialog.setBody(parentForm);
dialog.render(document.body);
};
};
EditItem.Dialog = {
textDialog: null,
choiceDialog: null,
getTextDialog: function () {
if (this.textDialog == null) {
this.textDialog = this._buildEditDialog('EditTaskTextDialog');
YUD.addClass(this.textDialog.element, 'edit-text itemMessage editTaskMessage');
}
return this.textDialog;
},
getChoiceDialog: function () {
if (this.choiceDialog == null) {
this.choiceDialog = this._buildEditDialog('EditTaskChoiceDialog');
YUD.addClass(this.choiceDialog.element, 'edit-text itemMessage editTaskMessage');
}
return this.choiceDialog;
},
_handleCancelButton: function (ev) {
if (EditItem.Html._activeDbInstance.panelWidget)  {
EditItem.Html._activeDbInstance.choiceSpans = [];
EditItem.Html._activeDbInstance.panelWidget.hide();
YUD.removeClass(EditItem.Html._activeDbInstance.activeSpan, 'TDS_EDIT_SPAN_HOVER');
}
EditItem.Html._activeDbInstance.interaction = null;
},
_handleOkButton : function (ev) {
if (EditItem.Html._activeDbInstance.interaction &&
EditItem.Html._activeDbInstance.panelWidget &&
EditItem.Html._activeDbInstance.okHandler) {
var interaction = EditItem.Html._activeDbInstance.interaction;
EditItem.Html._activeDbInstance.okHandler(interaction);
EditItem.Html._activeDbInstance.choiceSpans = [];
EditItem.Html._activeDbInstance.textSpan = null;
EditItem.Html._activeDbInstance.panelWidget.hide();
YUD.removeClass(EditItem.Html._activeDbInstance.activeSpan, 'TDS_EDIT_SPAN_HOVER');
}
EditItem.Html._activeDbInstance.interaction = null;
},
_addOkCancel : function () {
EditItem.Html.submit = EditItem.Dialog._handleOkButton;
var buttons = [
{ text: 'OK', handler: EditItem.Dialog._handleOkButton },
{ text: 'Cancel', handler: EditItem.Dialog._handleCancelButton }];
return buttons;
},
_buildEditDialog : function(label) {
var buttons = this._addOkCancel();
var editDialog = new YAHOO.widget.Dialog(label,
{
width: "320px",
constraintoviewport: true,
modal: true,
visible: false,
draggable: true,
close: false,
postmethod: 'none',
usearia: true,
buttons: buttons,
role: 'dialog'
});
editDialog.showEvent.subscribe(function () {
YUD.addClass(document.body, 'showingDialog');
editDialog.focusFirst();
editDialog.setTabLoop(editDialog.firstElement, editDialog.lastElement);
});
editDialog.hideEvent.subscribe(function () {
YUD.removeClass(document.body, 'showingDialog');
});
this._setTabIndexOnDialog(editDialog);
return editDialog;
},
_setTabIndexOnDialog: function (dialog) {
dialog.beforeShowEvent.subscribe(function () {
this.setFirstLastFocusable();
for (var i = 0; i < dialog.focusableElements.length; i++) {
var focusableElement = dialog.focusableElements[i];
focusableElement.setAttribute('tabindex', 0);
}
var usearia = dialog.cfg.getProperty('usearia');
if (usearia) {
var id = dialog.body.id || YUD.generateId(dialog.body);
dialog.cfg.setProperty('describedby', id);
}
});
}
};

/* SOURCE FILE: edit.html.text.js (628cb2e7) 9/9/2014 2:08:52 PM */

EditItem = (typeof (EditItem) == "undefined") ? {} : EditItem;
EditItem.Html.Text = function () {
EditItem.Html.call(this);
var self = this;
var addComponentArray = [];
this.keyHandlerArray = [];
this.textDialog = YUD.get('EditTaskTextDialog');
this.textDialog = (typeof(this.textDialog) == "undefined") ? 'EditTaskTextDialog' : this.textDialog;
this.showItem = function () {
this.forEachInteraction(function (interaction) {
var aDiv = YUD.get(interaction.createDivId());
YUD.addClass(aDiv, 'TDS_EDIT_SPAN ');
this.createCrossoutSpan(interaction.getContent(), null, aDiv);
YUE.addListener(aDiv, "click", clickOnTextItem, this);
if (aDiv) {
self.keyHandlerArray[aDiv.id] = function() {
clickOnTextItem.call(aDiv);
};
addComponentArray.push(aDiv);
}
YUD.addClass(aDiv, "TTS speakAs");
aDiv.setAttribute("ssml", "sub");
aDiv.setAttribute("ssml_alias", "{silence:1000}");
});
};
this.getComponentArray = function () {
return addComponentArray;
};
var entityEncode = function (text) {
if (text && typeof text == 'string') {
var textElement = document.createElement('span');
Util.Dom.setTextContent(textElement, text);
return textElement.innerHTML;
} else return;
};
var entityDecode = function (text, code) {
if (text && typeof text == 'string') {
var textElement = document.createElement('span');
textElement.innerHTML = text
text = Util.Dom.getTextContent(textElement);
return text;
} else return;
};
this.createInteractionCore = function(interaction) {
var parentForm = document.createElement('form');
YUD.addClass(parentForm, 'edit-text');
this.createLabel(interaction.getContent(), parentForm, 'edit-textarea');
YUD.setAttribute(parentForm, 'onSubmit', 'EditItem.Html.submit()');
var textInput = document.createElement('input');
var textValue = entityDecode(interaction.responseValue);
if (textValue && typeof textValue == 'string') textInput.value = textValue;
YUD.addClass(textInput, 'edit-textarea');
YUD.setAttribute(textInput, 'id', 'edit-textarea');
YUD.setAttribute(textInput, 'type', 'text');
parentForm.appendChild(textInput);
interaction.textSpan = textInput;
return parentForm;
};
var createTextInteractionMarkup = function (interaction) {
var dialog = EditItem.Dialog.getTextDialog();
this.populateDialogBox(dialog, interaction);
EditItem.Html._activeDbInstance.interaction = interaction;
EditItem.Html._activeDbInstance.textSpan = interaction.textSpan;
EditItem.Html._activeDbInstance.okHandler = handleOkButtonText;
EditItem.Html._activeDbInstance.panelWidget = dialog;
dialog.show();
dialog.cfg.setProperty('zindex', 1005);
inputPos(interaction.textSpan);
setTimeout(this.setDbPosition, 1);
};
var inputPos = function (node) {
var position = 0;
if ((node) && (node.value)) {
position = node.value.length;
}
if (node.setSelectionRange) {
node.focus();
node.setSelectionRange(0, position);
} else if (node.createTextRange) {
var range = node.createTextRange();
range.collapse(true);
range.moveEnd('character', position);
range.moveStart('character', 0);
range.select();
}
};
this.redisplay = function () {
this.forEachInteraction(function (interaction) {
var textSpan = YUD.get(interaction.createDivId());
var text = entityDecode(interaction.responseValue);
this.createCrossoutSpan(interaction.getContent(), text, textSpan);
});
};
var handleOkButtonText = function (ev) {
var text = EditItem.Html._activeDbInstance.textSpan.value;
if (!/\S/.test(text)) {
text = null;
}
var interaction = EditItem.Html._activeDbInstance.interaction;
self.createCrossoutSpan(interaction.getContent(), text, YUD.get(interaction.createDivId()));
interaction.responseValue = entityEncode(text);
};
var clickOnTextItem = function (ev) {
var span = this;
if (EditItem.Html._activeDbInstance.interaction)
return;
var interaction = self.getInteractionFromSpan(span);
YUD.addClass(span, 'TDS_EDIT_SPAN_HOVER');
EditItem.Html._activeDbInstance.activeSpan = span;
if (interaction) {
createTextInteractionMarkup.call(self, interaction);
}
};
};

/* SOURCE FILE: edit.html.choice.js (c3cbe255) 9/9/2014 2:08:52 PM */

EditItem = (typeof (EditItem) == "undefined") ? {} : EditItem;
EditItem.Html = (typeof (EditItem.Html) == "undefined") ? {} : EditItem.Html;
EditItem.Html.Choice = function () {
EditItem.Html.call(this);
var self = this;
var addComponentArray = [];
this.keyHandlerArray = [];
var forAllInlineChoices = function (ftor) {
self.forEachInteraction(function (interaction) {
interaction.forEachInlineChoice(function (choice) {
ftor(choice);
});
});
};
var initializeChoiceInteractions = function () {
forAllInlineChoices(function (choice) {
if (choice.showDefault) {
choice.selected = true;
} else {
choice.selected = false;
}
});
};
this.showItem = function () {
initializeChoiceInteractions();
self.forEachInteraction(function (interaction) {
var aDiv = YUD.get(interaction.createDivId());
var aChoice = interaction.getDefaultChoice();
if (aDiv && aChoice) {
aDiv.innerHTML = aChoice.content;
YUD.addClass(aDiv, 'TDS_EDIT_SPAN ');
YUD.addClass(aDiv, 'edit-originaltext');
YUE.addListener(aDiv, "click", clickOnChoiceItem, this);
self.keyHandlerArray[aDiv.id] = function () {
clickOnChoiceItem.call(aDiv);
};
addComponentArray.push(aDiv);
YUD.addClass(aDiv, "TTS speakAs");
aDiv.setAttribute("ssml", "sub");
aDiv.setAttribute("ssml_alias", "{silence:1000}");
}
});
this.getComponentArray = function () {
return addComponentArray;
};
};
var getInlineChoiceId = function (interaction, choice) {
var iid = interaction.createDivId();
return iid + '-' + choice.identifier + '-value';
};
var clickOnChoiceItem = function (ev) {
var span = this;
if (EditItem.Html._activeDbInstance.interaction)
return;
var interaction = self.getInteractionFromSpan(span);
YUD.addClass(span, 'TDS_EDIT_SPAN_HOVER');
EditItem.Html._activeDbInstance.activeSpan = span;
if (interaction) {
createChoiceInteractionMarkup(interaction);
}
};
var hideDropdown = function () {
var selectNode = EditItem.Html._activeDbInstance.activeSelect;
if (YUD.hasClass(selectNode, 'edit-nav-opened')) {
YUD.removeClass(selectNode, 'edit-nav-opened');
YUD.addClass(selectNode, 'edit-nav-closed');
}
YUE.removeListener(this, 'click', hideDropdown);
};
this.redisplay = function () {
this.forEachInteraction(function (interaction) {
var choiceSpan = YUD.get(interaction.createDivId());
var selectedValue = '';
interaction.forEachInlineChoice(function(choice) {
if (choice.selected && !choice.showDefault) {
selectedValue = choice.content;
}
});
this.createCrossoutSpan(interaction.getDefaultChoice().content, selectedValue, choiceSpan);
});
};
var handleOkButtonChoice = function (interaction) {
var responseContent = EditItem.Html._activeDbInstance.activeSelect.value;
var choiceSpan = YUD.get(interaction.createDivId());
var defaultChoice = interaction.getDefaultChoice();
self.createCrossoutSpan(defaultChoice.content, responseContent, choiceSpan);
var choiceSpans = EditItem.Html._activeDbInstance.choiceSpans;
for (var i = 0; i < choiceSpans.length; i++) {
if (choiceSpans[i].selected == true) {
var choiceId = choiceSpans[i].id.split('-')[3];
interaction.forEachInlineChoice(function(choice) {
if (choice.identifier == choiceId) {
choice.selected = true;
} else {
choice.selected = false;
}
});
}
}
};
var createChoiceInteractionMarkup = function (interaction) {
var dialog = EditItem.Dialog.getChoiceDialog();
EditItem.Html._activeDbInstance.okHandler = handleOkButtonChoice;
EditItem.Html._activeDbInstance.interaction = interaction;
EditItem.Html._activeDbInstance.panelWidget = dialog;
self.populateDialogBox(dialog, interaction);
dialog.show();
};
this.createInteractionCore = function(interaction) {
var parentForm = document.createElement('form');
YUD.addClass(parentForm, 'edit-nav');
YUD.setAttribute(parentForm, 'onSubmit', 'EditItem.Html.submit()');
var defaultChoice = interaction.getDefaultChoice();
this.createLabel(defaultChoice.content, parentForm, 'edit-select');
var select = document.createElement('select');
YUD.addClass(select, 'first-of-type');
YUD.addClass(select, 'edit-nav-closed');
YUD.setAttribute(select, 'id', 'edit-select');
EditItem.Html._activeDbInstance.activeSelect = select;
var i = 0;
interaction.forEachInlineChoice(function (choice) {
if (!choice.showDefault && !choice.selected) {
var li = document.createElement('option');
YUD.addClass(li, 'yuimenuitem edit-nav');
if (choice.selected) {
YUD.addClass(li, 'edit-list-selected');
YUD.setAttribute(li, 'selected', 'selected');
}
YUD.setAttribute(li, 'id', getInlineChoiceId(interaction, choice));
YUD.setAttribute(li, 'groupindex', 0);
YUD.setAttribute(li, 'index', i.toString());
YUD.setAttribute(li, 'value', choice.content);
li.innerHTML = choice.content;
if (choice.selected && select.firstChild) {
YUD.insertBefore(li, select.firstChild);
} else {
select.appendChild(li);
}
EditItem.Html._activeDbInstance.choiceSpans.push(li);
}
i++;
});
parentForm.appendChild(select);
return parentForm;
};
};

/* SOURCE FILE: edit.widget.js (67e02e93) 9/9/2014 2:08:52 PM */

(function(CM) {
function isEditTaskText(item) {
return item.isResponseType('EditTask');
}
function isEditTaskChoice(item) {
return item.isResponseType('EditTaskChoice');
}
function isEditTask(item) {
return isEditTaskText(item) || isEditTaskChoice(item);
}
function match(page, item, content) {
var id = 'EditContainer_' + item.position;
var el = document.getElementById(id);
if (el) {
return new CM.WidgetConfig(id, el, item.qti.xml);
}
return false;
}
function Widget_ET() {
this._editing = null;
}
CM.registerWidget('edittask', Widget_ET, match);
Widget_ET.prototype.init = function() {
var page = this.page;
var item = this.entity;
item.getStemElement = function () {
var compoundEl = page.getCompoundElement();
if (compoundEl) {
return compoundEl;
} else {
return item.getElement();
}
};
}
Widget_ET.prototype.load = function () {
var item = this.entity;
var container = this.element;
var qtiXml = this.config;
var ei = new EditItem.Parse(item.position);
ei.createFromXml(qtiXml, container);
YUD.removeClass(container, 'loading');
YUD.addClass(container, 'edit-container');
var editTextInstance = ei.textInteractions;
var editChoiceInstance = ei.choiceInteractions;
var editing = {
editText: editTextInstance,
editChoice: editChoiceInstance
};
this._editing = editing;
YUE.on(window, 'resize', function () {
if (onresize != null) {
onresize();
}
if (editTextInstance) {
editTextInstance.setDbPosition();
}
});
editChoiceInstance.showItem();
editTextInstance.showItem();
var componentArray = editTextInstance.getComponentArray();
componentArray.push.apply(componentArray, editChoiceInstance.getComponentArray());
for (var i = 0; i < componentArray.length; ++i) {
item.addComponent(componentArray[i]);
}
if (item.value) {
if (isEditTaskText(item)) {
editTextInstance.setXmlResponse(item.value);
}
else if (isEditTaskChoice(item)) {
editChoiceInstance.setXmlResponse(item.value);
}
}
}
Widget_ET.prototype.keyEvent = function(evt) {
var item = this.entity;
var editing = this._editing;
if (evt.type != 'keydown') return;
if (evt.ctrlKey || evt.altKey) return;
if (item.isReadOnly()) return;
var componentEl = item.getActiveComponent(evt);
if (componentEl == null) {
return;
}
var edits = isEditTaskText(item) ? editing.editText : editing.editChoice;
if (edits) {
edits.handleKeyEvent.call(edits, componentEl, evt);
}
}
Widget_ET.prototype.zoom = function () {
var editing = this._editing;
if (editing && editing.editText) {
editing.editText.setDbPosition();
}
}
Widget_ET.prototype.hide = function() {
var activeInstance = EditItem.Html._activeDbInstance;
if (activeInstance && activeInstance.panelWidget) {
activeInstance.panelWidget.hide();
activeInstance.interaction = null;
if (activeInstance.activeSpan) {
YUD.removeClass(activeInstance.activeSpan, 'TDS_EDIT_SPAN_HOVER');
activeInstance.activeSpan = null;
}
}
}
Widget_ET.prototype.isResponseAvailable = function () {
return this._editing != null;
}
Widget_ET.prototype.getResponse = function() {
var item = this.entity;
var editing = this._editing;
var editType = isEditTaskText(item) ? editing.editText : editing.editChoice;
var value = editType.getXmlResponse();
var isValid = (value && value.length > 0) ? true : false;
return this.createResponse(value, isValid);
}
Widget_ET.prototype.setResponse = function (value) {
var item = this.entity;
var editing = this._editing;
var editType = isEditTaskText(item) ? editing.editText : editing.editChoice;
editType.setXmlResponse(value);
}
})(window.ContentManager);

/* SOURCE FILE: main.js (4554fcdd) 9/9/2014 2:09:01 PM */

TDS = window.TDS || {};
TDS.Notes = {
Store: {},
Debug: true,
Sequence: { id: 0 },
_Factory:  null,
Events: {
Load: new YAHOO.util.CustomEvent('load'),
Save: new YAHOO.util.CustomEvent('save')
},
Types: {
Global: 'global',
DropDown: 'DropDown',
TextArea: 'TextArea',
ScratchPad: 'ScratchPad',
Equation: 'Equation'
},
close: function(obj){
var id = TDS.Notes.getIdFromObj(obj);
if(id){
var notes = TDS.Notes.Store[id];
if(notes){
notes.close();
}
}
},
get: function(id){
return TDS.Notes.Store[id];
},
open: function(obj){
var id = TDS.Notes.getIdFromObj(obj);
var notes = null;
if(id){
notes = TDS.Notes.Store[id];
if(!notes){
notes = TDS.Notes.getInstance(obj, id);
TDS.Notes.Store[id] = notes;
}
if(notes){
notes.open();
}else{
console.error('This object type could note create a valid notes instance?', obj);
}
}
return notes;
},
closeAll: function(){
for(var key in TDS.Notes.Store){
var notes = TDS.Notes.Store[key];
if(notes && notes.close && typeof notes == 'object'){
notes.close();
}
}
},
getInstance: function(obj, id){
return TDS.Notes.getFactory().buildNotes(obj, id);
},
setFactoryConfig: function(cfg){
this.getFactory().setConfig(cfg);
},
getFactory: function(){
if(!TDS.Notes._Factory){
TDS.Config = window.TDS.Config || {};
var fact   = new TDS.Notes.Factory();
fact.setConfig(TDS.Config.NotesConfig);
TDS.Notes._Factory = fact;
}
return TDS.Notes._Factory;
},
setFactory: function(factory){
TDS.Notes._Factory = factory;
},
getIdFromObj: function(obj){
if(!obj){
return TDS.Notes.Types.Global;
}else if(typeof obj == 'string'){
return obj;
}else if (typeof obj == 'number'){
return obj + '';
}else if(obj.id){
return obj.id + '_notes';
}else if(obj.position){
return obj.position + '_notes';
}
}
};

/* SOURCE FILE: dialog.js (a31296e9) 9/9/2014 2:09:01 PM */

TDS.Notes.Dialog = function(args) {
args = args || {};
this.dom = args.dom;
this.cfg = args.cfg;
this._yuiDialog = null;
this._impl = args.impl;
};
Messages = window.Messages || { get: function(str) { return str; } };
TDS.Notes.Dialog.prototype.setInstance = function(impl) {
this._impl = impl;
};
TDS.Notes.Dialog.prototype._onShow = function() {
};
TDS.Notes.Dialog.prototype.loading = function() {
};
TDS.Notes.Dialog.prototype.loadingComplete = function() {
};
TDS.Notes.Dialog.prototype._onBeforeShow = function() {
};
TDS.Notes.Dialog.prototype._onHide = function() {
};
TDS.Notes.Dialog.prototype.loadCb = function(response) {
TDS.Notes.Debug && console.log("Load Callback for (this, response)", this, response);
this.loadingComplete();
if (this._impl.unserialize(response)) {
this._impl.saveState(response);
}
};
TDS.Notes.Dialog.prototype.load = function() {
var args = {
id: this.getId(),
data: {
type: this._impl.type,
id: this.getId()
},
cb: this.loadCb.bind(this)
};
TDS.Notes.Debug && console.log('Loading information for this Notes instance', this, args);
TDS.Notes.Events.Load.fire(args);
return args;
};
TDS.Notes.Dialog.prototype.preSave = function(args){
return true;
};
TDS.Notes.Dialog.prototype.submit = function() {
var args = {
id: this.getId(),
data: {
type: this._impl.type,
comment: this._impl.serialize()
},
cb: this.saveCb.bind(this)
};
if(this.preSave(args)){
this._impl.saveState(args.data.comment);
TDS.Notes.Debug && console.log('Saving information for this Notes instance', this, args);
TDS.Notes.Events.Save.fire(args);
this.close(true);
}
return args;
};
TDS.Notes.Dialog.prototype.saveCb = function(response) {
TDS.Notes.Debug && console.log('Save cb for the notes has been called, (this, response)', this, response);
};
TDS.Notes.Dialog.prototype.close = function (preventRevert) {
if (this._yuiDialog) {
this._yuiDialog.hide();
}
if (typeof this.preClose == 'function') {
this.preClose();
}
if (preventRevert !== true) {
this._impl.revertState();
}
};
TDS.Notes.Dialog.prototype.open = function() {
if (!this._yuiDialog) {
this.create();
}
this._yuiDialog.render(document.body);
this._yuiDialog.show();
if(this._impl){
this._impl.focus();
}
};
TDS.Notes.Dialog.prototype.getId = function() {
if (this.dom) {
return this.dom.id;
}
};
TDS.Notes.Dialog.prototype.create = function() {
var id = this.getId();
if (!id) {
console.error('Cannot create a dialog without a valid dom element (id, this): ', id, this);
return;
}
var dialog = new YAHOO.widget.Dialog(id, {
visible: true,
draggable: false,
modal: true,
close: false,
fixedcenter: true,
width: this.cfg.width,
height: this.cfg.height,
zIndex: 1,
postmethod: 'none'
});
dialog.setHeader(this.cfg.label || 'Comments');
dialog.beforeShowEvent.subscribe(this._onBeforeShow, this, true);
dialog.showEvent.subscribe(this._onShow, this, true);
dialog.hideEvent.subscribe(this._onHide, this, true);
var buttons = [
{ text: Messages.get('Cancel'), handler: { fn: this.close, scope: this } },
{ text: Messages.get('Submit and Close'), handler: { fn: this.submit, scope: this }, isDefault: true }
];
dialog.cfg.queueProperty('buttons', buttons);
YAHOO.util.Dom.addClass(dialog.element, 'TDS_Notes_dialog');
YAHOO.util.Dom.addClass(dialog.innerElement, 'comment');
YAHOO.util.Dom.addClass(dialog.header, 'comment-header');
YAHOO.util.Dom.addClass(dialog.body, 'comment-body');
YAHOO.util.Dom.addClass(dialog.form, 'comment-form');
this._yuiDialog = dialog;
return dialog;
};

/* SOURCE FILE: base.js (1e3060f9) 9/9/2014 2:09:01 PM */

TDS.Notes.Base = function(){
this._saveState = ' ';
};
TDS.Notes.Base.prototype.create = function(){
TDS.Notes.Debug && console.log("Notes.Base class method, should be overriden: create");
};
TDS.Notes.Base.prototype.serialize   = function(){
TDS.Notes.Debug && console.log("Notes.Base class method, should be overriden: serialize");
};
TDS.Notes.Base.prototype.unserialize = function(response){
TDS.Notes.Debug && console.log("Notes.Base class method, should be overriden: unserialize");
};
TDS.Notes.Base.prototype.saveState = function(state){
this._saveState = state;
};
TDS.Notes.Base.prototype.getState = function(){
return this._saveState;
};
TDS.Notes.Base.prototype.revertState = function(){
this.unserialize(this.getState());
};
TDS.Notes.Base.prototype.focus = function(){
};
TDS.Notes.Base.prototype.unfocus = function(){
};

/* SOURCE FILE: textarea.js (1291c0c9) 9/9/2014 2:09:01 PM */

TDS.Notes.TextArea = function(args){
args = args || {};
this.dom = args.dom;
this.type = TDS.Notes.Types.TextArea;
};
YAHOO.lang.extend(TDS.Notes.TextArea, TDS.Notes.Base);
TDS.Notes.TextArea.prototype.serialize = function(){
return this.note.value;
};
TDS.Notes.TextArea.prototype.unserialize = function(response){
if(typeof response != 'string'){return;}
return (this.note.value = response);
};
TDS.Notes.TextArea.prototype.create = function()
{
var ta = document.createElement('textarea');
ta.className = 'comment-input comment-textbox';
ta.rows = 4;
YAHOO.util.Dom.setStyle(ta, 'resize', 'none');
document.getElementById('note_container_' + this.dom.id).appendChild(ta);
this.note = ta;
return this.note;
};
TDS.Notes.TextArea.prototype.unfocus = function()
{
if(this.note){
this.note.unfocus();
}
}
TDS.Notes.TextArea.prototype.focus = function()
{
if(this.note){
this.note.focus();
}
};

/* SOURCE FILE: scratchpad.js (805022dd) 9/9/2014 2:09:01 PM */

TDS.Notes.ScratchPad = function(args){
args = args || {};
this.dom = args.dom;
this.type = TDS.Notes.Types.ScratchPad;
};
YAHOO.lang.extend(TDS.Notes.ScratchPad, TDS.Notes.Base);
TDS.Notes.ScratchPad.prototype.serialize = function(){
return this.note.save();
};
TDS.Notes.ScratchPad.prototype.unserialize = function(response){
if(!response){return;}
if(typeof response == 'string' && response){
response = JSON.parse(response);
}
if(response){
this.note.load('list', response);
}
return true;
};
TDS.Notes.ScratchPad.prototype.create = function(){
var SPF = ScratchPad.Factory.getInstance();
var cId = 'note_container_' + this.dom.id;
this.note = SPF.getOrCreateScratchPadById(cId);
return this.note;
};

/* SOURCE FILE: dropdown.js (5aab6ee6) 9/9/2014 2:09:01 PM */

TDS.Notes.DropDown = function(args){
args = args || {};
this.comments = args.DropComments || TDS.Comments || [];
this.dom = args.dom;
this.type = TDS.Notes.Types.DropDown;
};
YAHOO.lang.extend(TDS.Notes.DropDown, TDS.Notes.Base);
TDS.Notes.DropDown.prototype.serialize = function(){
return this.note.value;
};
TDS.Notes.DropDown.prototype.unserialize = function(response){
if(typeof response != 'string'){return;}
return (this.note.value = response);
};
TDS.Notes.DropDown.prototype.create = function()
{
var selectBox = document.createElement('select');
selectBox.className = 'comment-input comment-selectbox';
for(var i = 0; i < this.comments.length; ++i){
var commentLine = this.comments[i];
var option = document.createElement('option');
option.text  = commentLine;
option.value = commentLine;
selectBox.appendChild(option);
}
document.getElementById('note_container_' + this.dom.id).appendChild(selectBox);
this.note = selectBox;
if (this.comments.length > 0) {
this.saveState(this.comments[0]);
}
return selectBox;
};

/* SOURCE FILE: equation.js (a1770d4d) 9/9/2014 2:09:01 PM */

TDS.Notes.Equation = function(args){
args = args || {};
this.dom = args.dom;
this.type = TDS.Notes.Types.Equation;
};
YAHOO.lang.extend(TDS.Notes.Equation, TDS.Notes.Base);
TDS.Notes.Equation.prototype.serialize = function(){
TDS.Notes.Debug && console.log("What save callback exists here?");
return this.note.serializeSettings();
};
TDS.Notes.Equation.prototype.unserialize = function(response){
if(!response){return;}
if(typeof response == 'string'){
response = JSON.parse(response);
}
TDS.Notes.Debug && console.log("What is in the response?", response);
if(this.note && response){
this.note.remove();
response.containerId = 'note_container_' + this.dom.id;
this.note = new MathJax.Editor.Widget(response);
}
return true;
};
TDS.Notes.Equation.prototype.create = function(){
this.note = new MathJax.Editor.Widget({
containerId: 'note_container_' + this.dom.id,
RestrictKeysToContent: true,
tabs: true,
tabConfig: {
Order: ['Algebra', 'Basic']
}
});
};

/* SOURCE FILE: factory.js (4ae1fd5a) 9/9/2014 2:09:01 PM */

TDS.Notes.TypeConfig = TDS.Notes.TypeConfig || {
Default: {
width: '450px',
height: '150px'
},
ScratchPad: {
width: '790px',
height: '780px'
},
Equation: {
width: '500px',
height: '331px',
label: 'Equation Editor'
}
};
TDS.Notes.Factory = function(cfg) {
this.setConfig(cfg);
};
TDS.Notes.Factory.prototype.setConfig = function(cfg) {
cfg = cfg || {};
cfg.GlobalClass = cfg.GlobalClass || TDS.Notes.Types.TextArea;
cfg.GlobalLabel = cfg.GlobalLabel || "Global Comments";
TDS.Notes['global'] = TDS.Notes[cfg.GlobalClass];
cfg.DefaultClass = cfg.DefaultClass || TDS.Notes.Types.TextArea;
cfg.DefaultLabel = cfg.DefaultLabel || "Comments";
TDS.Notes.Debug && console.log("Setting the Notes Factory config with cfg:", cfg);
this.cfg = cfg;
};
TDS.Notes.Factory.prototype.getConfig = function() {
return this.cfg;
};
TDS.Notes.Factory.prototype.getDialogConfigForType = function(type) {
var cfg = JSON.parse(JSON.stringify(TDS.Notes.TypeConfig[type] || TDS.Notes.TypeConfig.Default));
cfg.label = (type == TDS.Notes.Types.Global) ? this.cfg.GlobalLabel : (cfg.label ? cfg.label : this.cfg.DefaultLabel);
return cfg;
};
TDS.Notes.Factory.prototype.getNotesType = function(obj) {
if (obj && obj.NotesType && TDS.Notes.Types[obj.NotesType]) {
return TDS.Notes.Types[obj.NotesType];
}
return this.cfg.DefaultClass || TDS.Notes.Types.TextArea;
};
TDS.Notes.Factory.prototype.buildNotes = function(obj, id) {
var type = null;
if(!obj){
type = TDS.Notes.Types.Global;
}else if(typeof obj == 'string') {
type = obj;
}else if (obj) {
type = this.getNotesType(obj);
}
if (typeof TDS.Notes[type] == 'function') {
TDS.Notes.Debug && console.log("Building notes for (obj, id, type)", id, type);
return this.createNotesType(id, type);
}else{
console.error("Cannot build notes with this type: ", type);
}
};
TDS.Notes.Factory.prototype.createNotesType = function(id, type) {
var dom = this.getContainer(id, type);
var notes = new TDS.Notes[type]({ dom: dom });
notes.saveState('');
var dialog = new TDS.Notes.Dialog({
cfg: this.getDialogConfigForType(type),
dom: dom,
impl: notes
});
TDS.Notes.Debug && console.log("Creating an instance of this notes (id, type, dialog, notes)", id, type, dialog, notes);
dialog.create();
notes.create();
return dialog;
};
TDS.Notes.Factory.prototype.getContainer = function(id, type) {
var dom = document.getElementById(id);
if (!dom) {
dom = document.createElement('form');
dom.id = id;
dom.className += 'notes_dialog_form notes_dialog_form_' + type;
document.body.appendChild(dom);
}
var cId = 'note_container_' + id;
var c = document.getElementById(cId);
if (!c) {
c = document.createElement('div');
c.className = 'notes_dialog_container';
c.id = cId;
dom.appendChild(c);
}
return dom;
};

/* SOURCE FILE: zwibbler2.js (71228b56) 9/9/2014 2:09:04 PM */

(function () {
"use strict";
var __hasProp = Object.prototype.hasOwnProperty;
var __extends = function (child, parent) {
for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; }
function ctor() { this.constructor = child; }
ctor.prototype = parent.prototype;
child.prototype = new ctor;
child.__super__ = parent.prototype;
return child;
};
var __bind = function (fn, me) {
return function () {
return fn.apply(me, arguments);
};
}
var __indexOf = Array.prototype.indexOf || function (item) {
for (var i = 0, l = this.length; i < l; i++) {
if (this[i] === item) return i;
}
return -1;
};
var __slice = Array.prototype.slice;
function xml2jsonv2(xml, tab) {
var X = {
toObj: function (xml) {
var o = {};
if (xml.nodeType === 1) {
if (xml.attributes.length) {
for (var i = 0; i < xml.attributes.length; i++) {
o["@" + xml.attributes[i].nodeName] = (xml.attributes[i].value || "").toString();
}
}
if (xml.firstChild) {
var textChild = 0, cdataChild = 0, hasElementChild = false;
for (var n = xml.firstChild; n; n = n.nextSibling) {
if (n.nodeType === 1) {
hasElementChild = true;
} else if (n.nodeType === 3 && n.nodeValue.match(/[^ \f\n\r\t\v]/)) {
textChild++;
} else if (n.nodeType === 4) {
cdataChild++;
}
}
if (hasElementChild) {
if (textChild < 2 && cdataChild < 2) {
X.removeWhite(xml);
for (n = xml.firstChild; n; n = n.nextSibling) {
if (n.nodeType === 3) {
o["#text"] = X.escape(n.nodeValue);
} else if (n.nodeType === 4) {
o["#cdata"] = X.escape(n.nodeValue);
} else if (n.nodeName in o) {
if (o[n.nodeName] instanceof Array) {
o[n.nodeName][o[n.nodeName].length] = X.toObj(n);
} else {
o[n.nodeName] = [o[n.nodeName], X.toObj(n)];
}
} else {
o[n.nodeName] = X.toObj(n);
}
}
} else {
if (!xml.attributes.length) {
o = X.escape(X.innerXml(xml));
} else {
o["#text"] = X.escape(X.innerXml(xml));
}
}
} else if (textChild) {
if (!xml.attributes.length) {
o = X.escape(X.innerXml(xml));
} else {
o["#text"] = X.escape(X.innerXml(xml));
}
} else if (cdataChild) {
if (cdataChild > 1) {
o = X.escape(X.innerXml(xml));
} else {
for (n = xml.firstChild; n; n = n.nextSibling) {
o["#cdata"] = X.escape(n.nodeValue);
}
}
}
}
if (!xml.attributes.length && !xml.firstChild) { o = null; }
} else if (xml.nodeType === 9) {
o = X.toObj(xml.documentElement);
} else {
console.error("unhandled node type: ", xml.nodeType, xml);
}
return o;
},
toJson: function (o, name, ind) {
var json = name ? ("\"" + name + "\"") : "";
if (o instanceof Array) {
for (var i = 0, n = o.length; i < n; i++) {
o[i] = X.toJson(o[i], "", ind + "\t");
}
json += (name ? ":[" : "[") + (o.length > 1 ? ("\n" + ind + "\t" + o.join(",\n" + ind + "\t") + "\n" + ind) : o.join("")) + "]";
} else if (o === null) {
json += (name && ":") + "null";
} else if (typeof (o) === "object") {
var arr = [];
for (var m in o) {
if (o.hasOwnProperty(m)) {
arr[arr.length] = X.toJson(o[m], m, ind + "\t");
}
}
json += (name ? ":{" : "{") + (arr.length > 1 ? ("\n" + ind + "\t" + arr.join(",\n" + ind + "\t") + "\n" + ind) : arr.join("")) + "}";
} else if (typeof (o) === "string") {
if ((name.substr(0, 4) === "nmb_") || (name.substr(0, 4) ===
"bln_")) {
json = (name && "\"" + name.substr(4) + "\":") + o.toString();
} else {
json += (name && ":") + "\"" + o.toString() + "\"";
}
} else {
json += (name && ":") + o.toString();
}
return json;
},
innerXml: function (node) {
var s = "";
if ("innerHTML" in node) {
s = node.innerHTML;
} else {
var asXml = function (n) {
var s = "";
if (n.nodeType === 1) {
s += "<" + n.nodeName;
for (var i = 0; i < n.attributes.length; i++) {
s += " " + n.attributes[i].nodeName + "=\"" + (n.attributes[i].value || "").toString() + "\"";
}
if (n.firstChild) {
s += ">";
for (var c = n.firstChild; c; c = c.nextSibling) {
s += asXml(c);
}
s += "</" + n.nodeName + ">";
} else {
s += "/>";
}
} else if (n.nodeType === 3) {
s += n.nodeValue;
} else if (n.nodeType === 4) {
s += "<![CDATA[" + n.nodeValue + "]]>";
}
return s;
};
for (var c = node.firstChild; c; c = c.nextSibling) {
s += asXml(c);
}
}
return s;
},
escape: function (txt) {
return txt.replace(/[\\]/g, "\\\\")
.replace(/[\"]/g, '\\"')
.replace(/[\n]/g, '\\n')
.replace(/[\r]/g, '\\r');
},
removeWhite: function (e) {
e.normalize();
for (var n = e.firstChild; n; ) {
if (n.nodeType === 3) {
if (!n.nodeValue.match(/[^ \f\n\r\t\v]/)) {
var nxt = n.nextSibling;
e.removeChild(n);
n = nxt;
} else {
n = n.nextSibling;
}
} else if (n.nodeType === 1) {
X.removeWhite(n);
n = n.nextSibling;
} else {
n = n.nextSibling;
}
}
return e;
}
};
if (xml.nodeType === 9) {
xml = xml.documentElement;
}
var json = X.toJson(X.toObj(X.removeWhite(xml)), xml.nodeName, "\t");
return "{\n" + tab + (tab ? json.replace(/\t/g, tab) : json.replace(/\t|\n/g, "")) + "\n}";
}
function parseXml(xml) {
var dom = null;
if (window.DOMParser) {
try {
dom = (new DOMParser()).parseFromString(xml, "text/xml");
}
catch (e) { dom = null; }
}
else if (window.ActiveXObject) {
try {
dom = new ActiveXObject('Microsoft.XMLDOM');
dom.async = false;
if (!dom.loadXML(xml)) {
console.error(dom.parseError.reason + dom.parseError["srcText"]);
}
}
catch (e2) { dom = null; }
} else {
console.error("Failed to pare xml.");
}
return dom;
}
function resolveUrl(url) {
url = url.replace(/&amp;/g, '&');
url = url.split('&').join('&amp;').split('<').join('&lt;').split('"').join('&quot;');
var el = document.createElement('div');
el.innerHTML = '<a href="' + url + '">x</a>';
return el.firstChild.href;
}
(function ($) {
$.event.special.dbltap = {
bindType: 'touchend',
delegateType: 'touchend',
handle: function (event) {
var handleObj = event.handleObj,
targetData = jQuery.data(event.target),
now = new Date().getTime(),
delta = targetData.lastTouch ? now - targetData.lastTouch : 0,
delay = delay == null ? 300 : delay;
if (delta < delay && delta > 30) {
targetData.lastTouch = null;
event.type = handleObj.origType;
['clientX', 'clientY', 'pageX', 'pageY'].forEach(function (property) {
event[property] = event.originalEvent.changedTouches[0][property];
})
handleObj.handler.apply(this, arguments);
} else {
targetData.lastTouch = now;
}
}
};
})(jQuery);
var log = function (key, args) {
if (!console) {
return;
}
var message = [];
var format = args[0];
var i;
if (log.disabled[key]) {
return;
}
var segments = format.split("%s");
message.push(segments[0]);
for (i = 1; i < segments.length; i++) {
if (i - 1 >= args.length - 1) {
message.push("<too few args>");
} else if (typeof args[i] === "string" || typeof args[i] === "number") {
message.push(args[i]);
} else {
message.push(JSON.stringify(args[i]));
}
message.push(segments[i]);
}
var joined = message.join("");
for (i = 0; i < log.listeners.length; i++) {
log.listeners[i](key, joined);
}
};
log.disabled = {};
log.listeners = [];
log.enable = function (key, enabled) {
log.disabled[key] = !enabled;
};
log.create = function (key, enabled) {
if (enabled === false) {
log.disabled[key] = true;
}
return function (args) {
log(key, arguments);
};
};
log.addListener = function (listenerFn) {
log.listeners.push(listenerFn);
};
log.enableConsole = function () {
if (!log.emulatedConsole) {
log.listeners.push(function (key, message) {
console.log(key + ": " + message);
});
}
};
if (!("console" in window)) {
log.emulatedConsole = true;
window["console"] = {
"log": function () {
var parts = [];
for (var i = 0; i < arguments.length; i++) {
parts.push(JSON.stringify(arguments[i]));
}
for (i = 0; i < log.listeners.length; i++) {
log.listeners[i]("Console", parts.join(""));
}
}
};
window["console"]["error"] = window["console"]["log"];
}
function Toolbar(useTouch) {
this.div = $("<div>", { 'class': 'sp_toolbar_container' });
this.div_toolbarleftcol = $("<div>", { 'class': 'sp_toolbar_leftcolumn' });
this.div_toolbarrightcol = $("<div>", { 'class': 'sp_toolbar_rightcolumn' });
this.ul_Left = $("<ul>", { 'class': 'sp_toolbar_ul_left sp_controls' });
this.ul_Right = $("<ul>", { 'class': 'sp_toolbar_ul_right sp_tools' });
this.div.append(this.div_toolbarleftcol.append(this.ul_Left));
this.div.append(this.div_toolbarrightcol.append(this.ul_Right));
this.lastClick = new Date().getTime();
this.named = {};
this.buttons = [];
this.focusedIndex = 0;
this.zwibblerContext = null;
}
Toolbar.prototype = {
log: log.create("TOOLBAR"),
focus: function (index) {
if (this.buttons.length > 0) {
if (arguments.length > 0) {
this.buttons[this.focusedIndex].element.removeClass("focus");
this.focusedIndex = index;
}
this.buttons[this.focusedIndex].element.addClass("focus");
}
},
blur: function () {
if (this.buttons.length > 0) {
this.buttons[this.focusedIndex].element.removeClass("focus");
}
},
onKeyCommand: function (action, e) {
if (this.buttons.length === 0) {
return;
}
var change = action === "next" || action === "previous";
if (change) {
this.buttons[this.focusedIndex].element.removeClass("focus");
}
switch (action) {
case "next":
this.focusedIndex = Math.min(this.focusedIndex + 1,
this.buttons.length - 1);
break;
case "previous":
this.focusedIndex = Math.max(this.focusedIndex - 1, 0);
break;
case "enter":
this.buttons[this.focusedIndex].clickfn(e);
break;
}
if (change) {
this.buttons[this.focusedIndex].element.addClass("focus");
e.stopPropagation();
e.preventDefault();
}
},
width: function () {
return 50;
},
moveTo: function (x, y) {
this.div.css("left", "" + x + "px");
this.div.css("top", "" + y + "px");
},
clearHighlights: function () {
console.warn("Clear highlights");
},
setButtonHighlight: function (name, highlighted) {
$('.sp_tool_btn').removeClass('sp_tool_btn_select');
$('.sp_tool_' + name).addClass('sp_tool_btn_select');
},
addButton: function (name, clickfn, col_name, text) {
var self = this;
var a = $('<a>', { 'class': 'sp_tool_btn sp_tool_' + name, 'title': name }).text(text);
var li = $("<li>", { 'class': 'sp_tool_list_item' }).append(a);
var index = this.buttons.length;
if (clickfn) {
a.on('click touchend', function (evt) {
evt.stopPropagation();
evt.preventDefault();
if (!self.isReadOnly()) {
self.focus(index);
clickfn(evt);
}
});
}
if (col_name == this.ul_Left.valueOf(0)) {
this.ul_Left.append(li);
}
else
this.ul_Right.append(li);
this.buttons.push({
element: li,
clickfn: clickfn
});
},
isReadOnly : function () {
return this.zwibblerContext && this.zwibblerContext.isReadOnly();
}
};
var Url;
Url = {
log: log.create("URL"),
unescape: function (string) {
string = string.replace(/\+/g, " ");
if (window.decodeURIComponent) {
return window.decodeURIComponent(string);
} else {
return unescape(string);
}
},
splitQueryString: function (string, separator) {
var a, field, fields, i, index, key, value, _i, _len;
if (separator == null) {
separator = '?';
}
a = {};
index = string.indexOf(separator);
if (index >= 0) {
string = string.substr(index + 1);
}
index = string.indexOf('#');
if (index >= 0) {
string = string.substr(0, index);
}
fields = string.split("&");
for (_i = 0, _len = fields.length; _i < _len; _i++) {
field = fields[_i];
i = field.split("=");
key = Url.unescape(i[0]);
value = i.length > 1 ? Url.unescape(i[1]) : "";
if (key.length) {
a[key] = value;
}
}
return a;
},
encode: function (mapping) {
var first, key, parts;
parts = [];
first = true;
for (key in mapping) {
if (!first) {
parts.push('&');
}
first = false;
parts.push(encodeURIComponent(key));
if (mapping[key] !== "") {
parts.push('=');
parts.push(encodeURIComponent(mapping[key]));
}
}
return parts.join("");
},
replaceHashValue: function (key, value) {
var encoded, query;
query = Url.hash();
query[key] = value;
encoded = Url.encode(query);
return window.location.hash = encoded;
},
deleteHashValue: function (key) {
var encoded, query;
query = Url.hash();
delete query[key];
encoded = Url.encode(query);
return window.location.hash = encoded;
},
setBooleanHashValue: function (key, value) {
var encoded, query;
query = Url.hash();
if (value) {
query[key] = "1";
} else {
delete query[key];
}
encoded = Url.encode(query);
return window.location.hash = encoded;
},
hash: function () {
return Url.splitQueryString(window.location.hash, '#');
}
};
var GetMyScript, ScriptSrc;
GetMyScript = function () {
var script, scripts, src;
scripts = document.getElementsByTagName('script');
script = scripts[scripts.length - 1];
if (script.getAttribute.length !== 0) {
src = script.src;
} else {
src = script.getAttribute('src', -1);
}
return src;
};
ScriptSrc = GetMyScript();
var Config = function (options) {
var key, name, query, scriptPath, touch;
this.options = {
"backgroundImage": null,
"debug": false,
"defaultArrowHeadSize": "Medium",
"defaultBrushColour": "#ff0000",
"defaultBrushThickness": "Brush",
"defaultFillStyle": "#00ff00",
"defaultFont": "Arial",
"defaultFontSize": 20,
"defaultOutlineColour": "#000000",
"defaultOutlineThickness": "Pen",
"defaultSmoothness": "smooth",
"defaultTextColour": "#000000",
"defaultShadow": false,
"fonts": ["Arial", "Times New Roman"],
"imageFolder": "$SCRIPT/images",
"nudge": 10,
"showArrowTool": true,
"showArrowHeadSizeProperty": true,
"showBackgroundSelector": false,
"showBrushColourProperty": true,
"showBrushThicknessProperty": true,
"showBrushTool": true,
"showCircleTool": true,
"showColourPanel": true,
"showCopyPaste": true,
"showCurveTool": true,
"showDebug": false,
"showFillColourProperty": true,
"showFontProperty": true,
"showFontSizeProperty": true,
"showFreeformCurveTool": false,
"showImageSelector": false,
"showImageTool": false,
"showLineTool": true,
"showMathTool": true,
"showMenu": false,
"showOutlineColourProperty": true,
"showOutlineThicknessProperty": true,
"showPickTool": true,
"showPropertyPanel": false,
"showShadowProperty": true,
"showSquareTool": true,
"showKeyboardHelp": true,
"showTextColourProperty": true,
"showTextTool": true,
"showUndoRedo": true,
"showDeleteButton": true,
"sloppy": true,
"snap": 0,
"useTouch": "auto",
"canvasSize": ""
};
for (name in options) {
if (name && typeof options[name] !== 'function') {
if (name in this.options) {
var oldValue = this.options[name];
var newValue = options[name];
if (typeof oldValue === "string") {
} else if (typeof oldValue === "number") {
newValue = parseFloat(newValue);
} else if (typeof oldValue === "boolean") {
newValue = newValue === 'true';
}
this.options[name] = newValue;
} else {
if(name != '@xmlns')
console.error("Zwibbler: Unknown option: ", name, options[name]);
}
}
}
query = Url.hash();
for (name in query) {
if (typeof this.options[name] === "number") {
this.options[name] = parseFloat(query[name]);
} else if (typeof this.options[name] === "boolean") {
this.options[name] = query[name] === 'true';
} else {
this.options[name] = query[name];
}
}
scriptPath = this.getScriptFolder();
if (scriptPath === "") {
this.imageFolder = this.options["imageFolder"].replace("$SCRIPT/", "");
this.imageFolder = this.imageFolder.replace("$SCRIPT", "");
} else {
this.imageFolder = this.options["imageFolder"].replace("$SCRIPT", this.getScriptFolder());
}
if (this.imageFolder !== "" && this.imageFolder[this.imageFolder.length - 1] !== "/") {
this.imageFolder += "/";
}
if (this.options["useTouch"] === "auto") {
touch = 'ontouchstart' in window || 'onmsgesturechange' in window;
this.log("Detected touch support: %s", touch);
}
for (key in this.options) {
if (typeof this.options[key] !== 'function') {
this.log("%s=%s", key, this.options[key]);
}
}
};
Config.prototype.log = log.create("CONFIG");
Config.prototype.getScriptFolder = function () {
var i, src;
src = ScriptSrc;
i = src.lastIndexOf("/");
if (i >= 0) {
src = src.substr(0, i + 1);
} else {
src = "";
}
return src;
};
Config.prototype.hasMenu = function () {
return this.options["showMenu"];
};
Config.prototype.showFreeformCurveTool = function () {
return this.options["showFreeformCurveTool"];
};
Config.prototype.showBrushTool = function () {
return this.options["showBrushTool"];
};
Config.prototype.showPropertyPanel = function () {
return this.options["showPropertyPanel"];
};
Config.prototype.showColourPanel = function () {
return this.options["showColourPanel"];
};
Config.prototype.showKeyboardHelp = function () {
return this.options["showKeyboardHelp"];
};
Config.prototype.showDebug = function () {
return this.options["showDebug"];
};
Config.prototype.getOption = function (name) {
return this.options[name];
};
Config.prototype.get = function (name) {
return this.getOption(name);
};
Config.prototype.useTouch = function () {
if (this.options["useTouch"] === "auto") {
return 'ontouchstart' in window || 'onmsgesturechange' in window;
} else {
return this.options["useTouch"];
}
};
Config.prototype.getDefaultSmoothness = function () {
var smoothness;
smoothness = ("" + this.options["defaultSmoothness"]).toLowerCase();
if (smoothness === "sharper") {
return 0.1;
} else if (smoothness === "sharp") {
return 0.2;
} else if (smoothness === "smoothest") {
return 0.5;
} else {
return 0.3;
}
};
Config.prototype.getThickness = function (name) {
var thickness;
thickness = ("" + this.options[name]).toLowerCase();
if (thickness === "pencil") {
return 1.0;
} else if (thickness === "pen") {
return 2.0;
} else if (thickness === "marker") {
return 4.0;
} else if (thickness === "brush") {
return 10.0;
} else {
return 0.0;
}
};
Config.prototype.getDefaultBrushThickness = function () {
return this.getThickness("defaultBrushThickness");
};
Config.prototype.getDefaultOutlineThickness = function () {
return this.getThickness("defaultOutlineThickness");
};
Config.prototype.getDefaultArrowSize = function () {
var size;
size = ("" + this.options["defaultArrowHeadSize"]).toLowerCase();
if (size === "tiny") {
return 10.0;
} else if (size === "small") {
return 15.0;
} else if (size === "medium") {
return 20.0;
} else if (size === "large") {
return 30.0;
} else {
return 0.0;
}
};
Config.prototype.getImageUrl = function (icon) {
return this.imageFolder + icon;
};
var Transaction = function (parentid, actions, base, data) {
this.parentid = parentid;
this.actions = actions;
this.base = base;
this.id = "-1";
};
Transaction.prototype.log = log.create("TRANS", true);
Transaction.prototype.getId = function () {
return this.id;
};
Transaction.prototype.getParentId = function () {
return this.parentid;
};
Transaction.prototype.rename = function (replacer) {
var action, _i, _len, _ref;
_ref = this.actions;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
action = _ref[_i];
action.rename(replacer);
}
}; ;
function MoveSegment(previous, to) {
this.init(previous, to);
}
MoveSegment.prototype = {
init: function (previous, to) {
this.to = to;
},
draw: function (ctx) {
ctx.moveTo(this.to.x, this.to.y);
},
drawControls: function (ctx) {
},
outline: function (points, error) {
points.push(this.to);
},
startSlope: function () {
return null;
},
endSlope: function () {
return {
x: 1.0, y: 0.0
};
}
};
function DrawSegmentControls(ctx, segment) {
if (segment.previous && segment.control1 && segment.control2) {
ctx.moveTo(segment.previous.to.x, segment.previous.to.y);
ctx.lineTo(segment.control1.x, segment.control1.y);
ctx.moveTo(segment.to.x, segment.to.y);
ctx.lineTo(segment.control2.x, segment.control2.y);
}
}
function LineSegment(previous, to, randomSequence, sloppiness) {
this.init(previous, to, randomSequence, sloppiness);
}
LineSegment.prototype = {
init: function (previous, to, randomSeq, sloppiness) {
this.to = to;
this.previous = previous;
var length = CalcLineLength(
this.previous.to.x,
this.previous.to.y,
this.to.x,
this.to.y);
var offset = length / 10 * sloppiness;
if (offset > 10) {
offset = 10;
}
var r1 = randomSeq.next();
var r2 = randomSeq.next();
var r3 = randomSeq.next();
this.to.x = this.to.x + sloppiness * r1 * offset / 4;
this.to.y = this.to.y + sloppiness * r2 * offset / 4;
var t1X = this.previous.to.x;
var t1Y = this.previous.to.y;
var t2X = this.to.x;
var t2Y = this.to.y;
t1X += offset;
t2X += offset;
t1Y += offset;
t2Y += offset;
this.control1 = new Point(t1X + r2 * (t2X - t1X),
t1Y + r2 * (t2Y - t1Y));
t1X = this.previous.to.x - offset;
t2X = this.to.x - offset;
t1Y = this.previous.to.y - offset;
t2Y = this.to.y - offset;
this.control2 = new Point(
t1X + r3 * (t2X - t1X),
t1Y + r3 * (t2Y - t1Y));
},
draw: function (ctx) {
ctx.bezierCurveTo(this.control1.x, this.control1.y,
this.control2.x, this.control2.y,
this.to.x, this.to.y);
},
drawControls: function (ctx) {
DrawSegmentControls(ctx, this);
},
outline: function (points, error) {
bezier(points,
this.previous.to.x, this.previous.to.y,
this.control1.x, this.control1.y,
this.control2.x, this.control2.y,
this.to.x, this.to.y, error);
},
startSlope: function () {
if (this.previous) {
return CreateVector(this.previous.to.x, this.previous.to.y,
this.control1.x, this.control1.y);
} else {
return null;
}
},
endSlope: function () {
return CreateVector(this.control2.x, this.control2.y,
this.to.x, this.to.y);
}
};
function CurveSegment(previous, to, smoothness) {
this.init(previous, to, smoothness);
}
CurveSegment.prototype = {
init: function (previous, to, smoothness) {
this.to = to;
this.previous = previous;
this.smoothness = smoothness;
var length = CalcLineLength(previous.to.x, previous.to.y, to.x, to.y);
if (!length) {
length = 1;
}
var vx = (to.x - previous.to.x) / length;
var vy = (to.y - previous.to.y) / length;
this.control2 = new Point(
to.x - length * smoothness * vx,
to.y - length * smoothness * vy);
var pcontrol2 = previous.control2;
if (pcontrol2) {
var slope = CreateVector(previous.previous.to.x,
previous.previous.to.y,
previous.to.x,
previous.to.y);
var plength = CalcLineLength(previous.previous.to.x,
previous.previous.to.y,
previous.to.x,
previous.to.y);
vx = (vx + slope.x) * 0.5;
vy = (vy + slope.y) * 0.5;
pcontrol2.x = previous.to.x - plength * smoothness * vx;
pcontrol2.y = previous.to.y - plength * smoothness * vy;
}
this.control1 = new Point(
previous.to.x + length * smoothness * vx,
previous.to.y + length * smoothness * vy);
this.length = length;
},
setPrevious: function (previous) {
this.previous = previous;
var pcontrol2 = previous.control2;
var vx = (this.to.x - previous.to.x) / this.length;
var vy = (this.to.y - previous.to.y) / this.length;
var smoothness = this.smoothness;
if (pcontrol2) {
var slope = CreateVector(previous.previous.to.x,
previous.previous.to.y,
previous.to.x,
previous.to.y);
var plength = CalcLineLength(previous.previous.to.x,
previous.previous.to.y,
previous.to.x,
previous.to.y);
vx = (vx + slope.x) * 0.5;
vy = (vy + slope.y) * 0.5;
pcontrol2.x = previous.to.x - plength * smoothness * vx;
pcontrol2.y = previous.to.y - plength * smoothness * vy;
}
this.control1 = new Point(
previous.to.x + this.length * smoothness * vx,
previous.to.y + this.length * smoothness * vy);
},
draw: function (ctx) {
ctx.bezierCurveTo(this.control1.x, this.control1.y,
this.control2.x, this.control2.y,
this.to.x, this.to.y);
},
drawControls: function (ctx) {
DrawSegmentControls(ctx, this);
},
outline: function (points, error) {
bezier(points,
this.previous.to.x, this.previous.to.y,
this.control1.x, this.control1.y,
this.control2.x, this.control2.y,
this.to.x, this.to.y, error);
},
startSlope: function () {
if (this.previous) {
return CreateVector(this.previous.to.x, this.previous.to.y,
this.control1.x, this.control1.y);
} else {
return null;
}
},
endSlope: function () {
return CreateVector(this.control2.x, this.control2.y,
this.to.x, this.to.y);
}
};
function QuadraticSegment(previous, control, to) {
this.init(previous, control, to);
}
QuadraticSegment.prototype = {
init: function (previous, control, to) {
this.control = control;
this.to = to;
},
draw: function (ctx) {
ctx.quadraticCurveTo(this.control.x, this.control.y, this.to.x, this.to.y);
},
drawControls: function (ctx) {
DrawSegmentControls(ctx, this);
},
outline: function (points, error) {
points.push(this.control);
points.push(this.to);
},
startSlope: function () {
if (this.previous) {
return CreateVector(this.previous.to.x, this.previous.to.y,
this.control.x, this.control.y);
} else {
return null;
}
},
endSlope: function () {
return CreateVector(this.control.x, this.control.y,
this.to.x, this.to.y);
}
};
function ArcSegment(previous, control, to, radius) {
this.init(previous, control, to, radius);
}
ArcSegment.prototype = {
init: function (previous, control, to, radius) {
this.control = control;
this.to = to;
this.radius = radius;
},
draw: function (ctx) {
ctx.arcTo(this.control.x, this.control.y, this.to.x, this.to.y,
this.radius);
},
drawControls: function (ctx) {
DrawSegmentControls(ctx, this);
},
outline: function (points, error) {
points.push(this.control);
points.push(this.to);
}
};
function BezierSegment(previous, control1, control2, to) {
this.init(previous, control1, control2, to);
}
BezierSegment.prototype = {
init: function (previous, control1, control2, to) {
this.control1 = control1;
this.control2 = control2;
this.to = to;
this.previous = previous;
},
draw: function (ctx) {
ctx.bezierCurveTo(this.control1.x, this.control1.y,
this.control2.x, this.control2.y,
this.to.x, this.to.y);
},
drawControls: function (ctx) {
DrawSegmentControls(ctx, this);
},
outline: function (points, error) {
bezier(points,
this.previous.to.x, this.previous.to.y,
this.control1.x, this.control1.y,
this.control2.x, this.control2.y,
this.to.x, this.to.y, error);
},
startSlope: function () {
if (this.previous) {
return CreateVector(this.previous.to.x, this.previous.to.y,
this.control1.x, this.control1.y);
} else {
return null;
}
},
endSlope: function () {
return CreateVector(this.control2.x, this.control2.y,
this.to.x, this.to.y);
}
};
function CornerSegment(previous, corner, to, randomSequence, sloppiness) {
this.init(previous, corner, to, randomSequence, sloppiness);
}
CornerSegment.prototype = {
log: log.create("SEGMENT"),
init: function (previous, corner, to, randomSequence, sloppiness) {
var KAPPA = 0.5522847498;
this.previous = previous;
sloppiness = sloppiness * 2;
var r1 = randomSequence.next() * 2 - 1;
var r2 = randomSequence.next() * 2 - 1;
var slope = this.previous.endSlope();
if (slope) {
var radius = CalcLineLength(
previous.to.x, previous.to.y,
corner.x, corner.y);
this.control1 = new Point(
previous.to.x + slope.x * KAPPA * radius,
previous.to.y + slope.y * KAPPA * radius);
} else {
this.control1 = new Point(
previous.to.x + KAPPA * (corner.x - previous.to.x),
previous.to.y + KAPPA * (corner.y - previous.to.y));
}
this.control2 = new Point(
to.x - KAPPA * (to.x - corner.x) * (1.0 - r1 * sloppiness),
to.y - KAPPA * (to.y - corner.y) * (1.0 - r2 * sloppiness));
this.to = to;
},
draw: function (ctx) {
ctx.bezierCurveTo(this.control1.x, this.control1.y,
this.control2.x, this.control2.y,
this.to.x, this.to.y);
},
drawControls: function (ctx) {
DrawSegmentControls(ctx, this);
},
outline: function (points, error) {
bezier(points,
this.previous.to.x, this.previous.to.y,
this.control1.x, this.control1.y,
this.control2.x, this.control2.y,
this.to.x, this.to.y, error);
},
startSlope: function () {
if (this.previous) {
return CreateVector(this.previous.to.x, this.previous.to.y,
this.control1.x, this.control1.y);
} else {
return null;
}
},
endSlope: function () {
return CreateVector(this.control2.x, this.control2.y,
this.to.x, this.to.y);
}
};
function SelectBoxBehaviour(view, previousBehaviour, x, y) {
this.view = view;
this.dx = 0;
this.dy = 0;
this.dragging = false;
this.previousBehaviour = previousBehaviour;
this.onMouseDown(x, y);
}
SelectBoxBehaviour.prototype = {
log: log.create("SelectBehaviour"),
onTouch: function (e) {
var pt;
if (e.type === "touchmove") {
pt = this.view.touchPoint(e.changedTouches[0]);
this.onMouseMove(pt.x, pt.y);
} else if (e.type === "touchend") {
pt = this.view.touchPoint(e.changedTouches[0]);
this.onMouseUp(pt.x, pt.y);
}
},
onMouseDown: function (x, y) {
this.dx = x;
this.dy = y;
this.dragging = true;
},
onMouseMove: function (x, y) {
if (this.dragging) {
var ctx = this.view.ctx;
this.view.draw();
ctx.save();
ctx.strokeStyle = "#0050B7";
ctx.lineWidth = 2.0 / this.view.scale;
ctx.fillStyle = "rgba(0, 80, 183, 0.2)";
var rect = new Rectangle(this.dx + 0.5, this.dy + 0.5,
x - this.dx, y - this.dy);
ctx.fillRect(rect.x, rect.y, rect.width, rect.height);
ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
ctx.restore();
}
},
onMouseUp: function (x, y) {
this.dragging = false;
this.view.clearSelection();
this.view.selectByRect(new Rectangle(this.dx, this.dy, x - this.dx, y -
this.dy));
this.view.doneSelecting();
this.view.draw();
this.view.behaviour = this.previousBehaviour;
}
};
var ZwibblerContext = function (app) {
this.app = app;
this["app"] = app;
this.events = {};
this.app.setZwibblerContext(this);
this.id = "" + ZwibblerContext.nextId;
ZwibblerContext.nextId += 1;
};
ZwibblerContext.nextId = 0;
ZwibblerContext.prototype.enableConsoleLogging = function () {
log.enableConsole();
};
ZwibblerContext.prototype.emit = function (name, var_args) {
var args;
if (!this.events) {
this.events = {};
}
args = Array.prototype.slice.call(arguments, 1);
setTimeout(__bind(function () {
var fn, _i, _len, _ref;
if (name in this.events) {
_ref = this.events[name];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
fn = _ref[_i];
fn.apply(null, args);
}
}
}, this), 0);
return this;
};
ZwibblerContext.prototype.on = function (name, fn) {
if (name in this.events) {
this.events[name].push(fn);
} else {
this.events[name] = [fn];
}
return this;
};
ZwibblerContext.prototype.newDocument = function () {
return this.app.newDocument();
};
ZwibblerContext.prototype.isValid = function () {
var docNodes = this.app.view.doc.nodes;
var nitems = 0;
for (var p in docNodes) {
if (docNodes.hasOwnProperty(p) && docNodes[p].type() !== "GroupNode" && docNodes[p].type() !== "ImageNode") {
++nitems;
}
if (nitems > 0) {
return true;
}
}
return false;
};
ZwibblerContext.prototype.getResponseXml = function () {
return this.save('xml');
};
ZwibblerContext.prototype.setResponseXml = function (contents) {
return this.load('xml', contents);
};
ZwibblerContext.prototype.save = function (format) {
if (format === "list") {
return this.app.saveAsList();
} else if (format === "png") {
return this.app.saveAsDataUrl();
} else if (format === "zwibbler3" || arguments.length === 0) {
return this.app.view.doc.save("zwibbler3");
} else if (format === "xml") {
return this.app.view.doc.getResponseXml();
} else {
return "Unsupported format: " + format;
}
};
ZwibblerContext.prototype.load = function (format, data) {
if (format === "list") {
return this.app.loadFromList(data);
} else if (format === "xml") {
var eqParent = this.app.canvasContainer[0];
var eqItems = YAHOO.util.Dom.getElementsByClassName('mje_container', 'div', eqParent);
for (var i = 0; i < eqItems.length; i++) {
eqParent.removeChild(eqItems[i]);
}
this.app.newDocument();
this.app.setBackgroundImageFromConfig();
return this.app.loadFromList(this.app.view.doc.processResponseXml(data));
} else {
return this.app.setDocument(ZwibblerDocument.load(data));
}
};
ZwibblerContext.prototype.setBackgroundBrowserImages = function (urls) {
return this.app.setBackgroundImageList(urls);
};
ZwibblerContext.prototype.setIconBrowserImages = function (urls) {
return this.app.setIconBrowserList(urls);
};
ZwibblerContext.prototype.resize = function () {
return this.app._onResize();
};
ZwibblerContext.prototype.dirty = function () {
if (arguments.length === 1 && arguments[0] === false) {
this.app.view.doc.markClean();
}
return this.app.view.doc.dirty();
};
ZwibblerContext.prototype.setItemProperty = function (id, property, value) {
this.app.setItemProperty(id, property, value);
};
ZwibblerContext.prototype.setImage = function (id, img) {
var doc = this.app.view.doc;
var view = this.app.view;
var node = doc.getNode(id, true);
if (node.type() !== "MathNode") {
this.log("setImage() error: node %s is of type %s", id, node.type());
return;
}
node.setImage(img);
view.update();
};
ZwibblerContext.prototype.getItemProperty = function (id, property) {
return this.app.getItemProperty(id, property);
};
ZwibblerContext.prototype.setDomElement = function (nodeid, element) {
var node = this.app.view.doc.getNode(nodeid);
if (!node) {
this.error("setDomElement: Node %s does not exist", nodeid);
}
if (node.type() !== "DomNode") {
this.error("setDomElement: Node %s is not a DomNode. It is %s", nodeid,
node.type());
}
node.setElement(element);
};
ZwibblerContext.prototype.error = function (formatString, var_args) {
var parts = arguments[0].split("%s");
var message = [];
for (var i = 0; i < parts.length; i++) {
message.push(parts[i]);
if (i < parts.length - 1) {
message.push(JSON.stringify(arguments[i + 1]));
}
}
this.log(message.join(""));
throw {
"message": message,
"toString": function () {
return message;
}
};
};
ZwibblerContext.prototype.setInstanceId = function (id) {
this.id = id;
};
ZwibblerContext.prototype.getInstanceId = function () {
return this.id;
};
ZwibblerContext.prototype.isReadOnly = function () { return false; }
var Cookies;
Cookies = {
log: log.create("Cookies"),
set: function (name, value, secondsValid) {
var date, str;
if (secondsValid == null) {
secondsValid = 365 * 24 * 60 * 60;
}
date = new Date();
date.setTime(date.getTime() + (secondsValid * 1000));
name = encodeURIComponent(name);
value = encodeURIComponent(value);
str = "" + name + "=" + value + "; expires=" + (date.toGMTString()) + "; path=/";
Cookies.log("Set document.cookie=%s", str);
document.cookie = str;
},
get: function (name) {
var cookie, i, _i, _len, _ref;
name = encodeURIComponent(name);
_ref = document.cookie.split(';');
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
cookie = _ref[_i];
i = 0;
while (i < cookie.length && cookie[i] === ' ') {
i += 1;
}
if (cookie.indexOf(name + "=") === i) {
return decodeURIComponent(cookie.substr(i + name.length + 1));
}
}
return null;
},
remove: function (name) {
return Cookies.set(name, "", -1);
},
test: function () {
Cookies.set("steve", "blah blah");
Cookies.set("alice", "wife");
Cookies.log("Steve=%s", Cookies.get("steve"));
Cookies.log("Alice=%s", Cookies.get("alice"));
Cookies.remove("steve");
return Cookies.log("Steve=%s", Cookies.get("steve"));
}
};
var EventEmitter = function () {
this.events = {};
this.nolog = false;
};
EventEmitter.prototype.log = log.create("EventEmitter");
EventEmitter.prototype.emit = function (name, var_args) {
var args;
if (!this.events) {
this.events = {};
}
args = Array.prototype.slice.call(arguments, 1);
setTimeout(__bind(function () {
var fn, _i, _len, _ref;
if (name in this.events) {
_ref = this.events[name];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
fn = _ref[_i];
if (!this.nolog) {
this.log("Emit %s", name);
}
fn.apply(null, args);
}
}
}, this), 0);
return this;
};
EventEmitter.prototype.emitNow = function (name, var_args) {
var args;
if (!this.events) {
this.events = {};
}
args = Array.prototype.slice.call(arguments, 1);
var fn, _i, _len, _ref;
if (name in this.events) {
_ref = this.events[name];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
fn = _ref[_i];
if (!this.nolog) {
this.log("Emit %s", name);
}
fn.apply(null, args);
}
}
return this;
};
EventEmitter.prototype.on = function (name, fn) {
if (!this.events) {
this.events = {};
}
this.bind(name, fn);
return this;
};
EventEmitter.prototype.bind = function (name, fn) {
if (name in this.events) {
this.events[name].push(fn);
} else {
this.events[name] = [fn];
}
return fn;
};
EventEmitter.prototype.unbind = function (name, fn) {
var arr, i, _ref;
if (name in this.events) {
arr = this.events[name];
for (i = 0, _ref = arr.length - 1; i <= _ref; i += 1) {
if (arr[i] === fn) {
arr.splice(i, 1);
break;
}
}
}
};
EventEmitter.prototype.joinEvents = function (emitter) {
var key;
if (emitter.events === this.events) {
return;
}
for (key in emitter.events) {
if (key in this.events) {
this.events[key] = this.events[key].concat(emitter.events[key]);
} else {
this.events[key] = emitter.events[key];
}
}
emitter.events = this.events;
};
var Menu = function () {
this.items = [];
};
Menu.prototype.addItem = function (display, event, eventData) {
return this.items.push({
type: "normal",
display: display,
event: event,
eventData: eventData
});
};
Menu.prototype.addSeparator = function () {
return this.items.push({
type: "separator"
});
};
Menu.prototype.addSubmenu = function (display, menu) {
return this.items.push({
type: "menu",
display: display,
menu: menu
});
}; ;
function SplitQueryString(b) {
var a = {};
var c = b.split("#");
var fields = c[c.length - 1].split("&");
for (var f = 0; f < fields.length; f++) {
var i = fields[f].split("=");
if (i[0]) {
try {
if (i.length > 1) {
i[1] = i[1].replace(/\+/g, " ");
if (window.decodeURIComponent) {
a[i[0]] = decodeURIComponent(i[1]);
} else {
a[i[0]] = unescape(i[1]);
}
} else {
a[i[0]] = "";
}
} catch (except) {
}
}
}
return a;
}
var RandomString = function (length) {
var digits =
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890";
var usernameChars = [];
for (var i = 0; i < length; i++) {
usernameChars.push(digits[Math.floor(Math.random() * digits.length)]);
}
return usernameChars.join("");
};
if (typeof module === "object") {
exports.RandomString = RandomString;
}
function Inherit(base, child) {
for (var key in base) {
if (base.hasOwnProperty(key) && !child.hasOwnProperty(key)) {
child[key] = base[key];
}
}
}
function Point(x, y) {
this.x = x;
this.y = y;
}
Point.prototype.distanceTo = function (point) {
return Math.sqrt((point.x - this.x) * (point.x - this.x) +
(point.y - this.y) * (point.y - this.y));
};
Point.prototype.toString = function () {
return "(" + this.x + ", " + this.y + ")";
};
function Size(width, height) {
this.width = width;
this.height = height;
}
function CalcLineLength(x1, y1, x2, y2) {
return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));
}
function CreateVector(x1, y1, x2, y2) {
var len = CalcLineLength(x1, y1, x2, y2);
if (len === 0) {
return {
x: 1.0, y: 0.0
};
}
return {
x: (x2 - x1) / len,
y: (y2 - y1) / len
};
}
function CalculateCentroid(points) {
if (points.length === 0) {
return new Point(0, 0);
}
var x = points[0].x;
var y = points[0].y;
for (var i = 1; i < points.length; i++) {
x += points[i].x;
y += points[i].y;
}
return new Point(x / points.length, y / points.length);
}
function Rectangle(x, y, w, h) {
this.x = x;
this.y = y;
this.width = w;
this.height = h;
this.repair();
}
Rectangle.load = function (s) {
return new Rectangle(s["x"], s["y"], s["width"], s["height"]);
};
Rectangle.CreateBoundingBox = function (points) {
if (points.length === 0) {
return new Rectangle(0, 0, 0, 0);
}
var minX = points[0].x;
var maxX = points[0].x;
var minY = points[0].y;
var maxY = points[0].y;
for (var i = 1; i < points.length; i++) {
if (points[i].x < minX) {
minX = points[i].x;
}
if (points[i].x > maxX) {
maxX = points[i].x;
}
if (points[i].y < minY) {
minY = points[i].y;
}
if (points[i].y > maxY) {
maxY = points[i].y;
}
}
return new Rectangle(minX, minY, maxX - minX, maxY - minY);
};
Rectangle.prototype = {
save: function () {
return { "x": this.x, "y": this.y, "width": this.width, "height": this.height };
},
clone: function () {
return new Rectangle(this.x, this.y, this.width, this.height);
},
union: function (other) {
if (other.x < this.x) {
this.width += this.x - other.x;
this.x = other.x;
}
if (other.y < this.y) {
this.height += this.y - other.y;
this.y = other.y;
}
if (other.x + other.width > this.x + this.width) {
this.width += other.x + other.width - this.x - this.width;
}
if (other.y + other.height > this.y + this.height) {
this.height += other.y + other.height - this.y - this.height;
}
},
unionPoint: function (x, y) {
if (x < this.x) {
this.width += this.x - x;
this.x = x;
} else if (x > this.x + this.width) {
this.width = x - this.x;
}
if (y < this.y) {
this.height += this.y - y;
this.y = y;
} else if (y > this.y + this.height) {
this.height = y - this.y;
}
},
contains: function (other) {
return this.x <= other.x &&
this.x + this.width > other.x + other.width &&
this.y <= other.y &&
this.y + this.height > other.y + other.height;
},
containsPoint: function (x, y) {
return this.x <= x && this.x + this.width > x &&
this.y <= y && this.y + this.height > y;
},
repair: function () {
if (this.width < 0) {
this.x += this.width;
this.width = -this.width;
}
if (this.height < 0) {
this.y += this.height;
this.height = -this.height;
}
},
inflate: function (dx, dy) {
this.x -= dx / 2;
this.y -= dy / 2;
this.width += dx;
this.height += dy;
},
transform: function (matrix) {
var tl, tr, bl, br;
tl = matrix.apply(this.x, this.y);
tr = matrix.apply(this.x + this.width, this.y);
br = matrix.apply(this.x + this.width, this.y + this.height);
bl = matrix.apply(this.x, this.y + this.height);
this.x = Math.min(tl.x, tr.x, br.x, bl.x);
this.y = Math.min(tl.y, tr.y, br.y, bl.y);
this.width = Math.max(tl.x, tr.x, br.x, bl.x) - this.x;
this.height = Math.max(tl.y, tr.y, br.y, bl.y) - this.y;
},
right: function () {
return this.x + this.width;
},
bottom: function () {
return this.y + this.height;
},
centre: function () {
return new Point(this.x + this.width / 2, this.y + this.height / 2);
}
};
function Clone(obj) {
var copy;
if (obj instanceof Function) {
return obj;
} else if (obj instanceof Array) {
copy = obj.concat();
} else if (obj instanceof Object) {
copy = {};
for (var prop in obj) {
if (1) {
copy[prop] = Clone(obj[prop]);
}
}
} else {
copy = obj;
}
return copy;
}
function Matrix(var_args) {
if (arguments.length === 0) {
this.m11 = 1;
this.m12 = 0;
this.m21 = 0;
this.m22 = 1;
this.dx = 0;
this.dy = 0;
} else if (arguments.length === 1) {
if (arguments[0].length !== 6) {
throw "Bad array initializer for Matrix.";
}
this.m11 = arguments[0][0];
this.m12 = arguments[0][1];
this.m21 = arguments[0][2];
this.m22 = arguments[0][3];
this.dx = arguments[0][4];
this.dy = arguments[0][5];
} else if (arguments.length === 6) {
this.m11 = arguments[0];
this.m12 = arguments[1];
this.m21 = arguments[2];
this.m22 = arguments[3];
this.dx = arguments[4];
this.dy = arguments[5];
} else {
throw "Bad initializer for Matrix.";
}
}
Matrix.prototype.toString = function () {
return "[ " + this.m11 + " " + this.m12 + " " + this.dx + "\n" +
"   " + this.m21 + " " + this.m22 + " " + this.dy + "\n" +
"   0 0 1 ]";
};
Matrix.prototype.toArray = function () {
return [this.m11, this.m12, this.m21, this.m22, this.dx, this.dy];
};
Matrix.prototype.toCssTransformString = function () {
return 'matrix(' + [this.m11, this.m21, this.m12, this.m22, this.dx, this.dy].join(', ') + ')';
};
Matrix.prototype._class = "Matrix";
Matrix.prototype.isIdentity = function () {
return this.m11 === 1 &&
this.m12 === 0 &&
this.m21 === 0 &&
this.m22 === 1 &&
this.dx === 0 &&
this.dy === 0;
};
Matrix.prototype.multiply = function (o) {
var m = new Matrix();
m.m11 = this.m11 * o.m11 + this.m12 * o.m21;
m.m21 = this.m21 * o.m11 + this.m22 * o.m21;
m.m12 = this.m11 * o.m12 + this.m12 * o.m22;
m.m22 = this.m21 * o.m12 + this.m22 * o.m22;
m.dx = this.m11 * o.dx + this.m12 * o.dy + this.dx;
m.dy = this.m21 * o.dx + this.m22 * o.dy + this.dy;
return m;
};
Matrix.prototype.apply = function (x, y) {
return new Point(this.m11 * x + this.m12 * y + this.dx,
this.m21 * x + this.m22 * y + this.dy);
};
Matrix.prototype.applyWRTContext = function (x, y, ctx) {
var nudge = 10;
if (this.m11 * x + this.dx < 0) {
this.dx += nudge;
} else if (this.m11 * x + this.dx > ctx.canvas.width) {
this.dx -= nudge;
} else if (this.m22 * y + this.dy < 0) {
this.dy += nudge;
} else if (this.m22 * y + this.dy > ctx.canvas.height) {
this.dy -= nudge;
}
return new Point(this.m11 * x + this.m12 * y + this.dx,
this.m21 * x + this.m22 * y + this.dy);
};
Matrix.prototype.clone = function () {
return new Matrix(this.m11,
this.m12, this.m21, this.m22, this.dx, this.dy);
};
Matrix.prototype.inverse = function () {
var det = this.m11 * this.m22 -
this.m12 * this.m21;
return new Matrix(
this.m22 / det,
-this.m12 / det,
-this.m21 / det,
this.m11 / det,
(this.m12 * this.dy - this.dx * this.m22) / det,
(this.dx * this.m21 - this.m11 * this.dy) / det
);
};
function ScaleMatrix(sx, sy, ox, oy) {
if (sx === 0) {
sx = 0.1;
}
if (sy === 0) {
sy = 0.1;
}
if (ox === undefined) {
this.m11 = sx;
this.m12 = 0;
this.m21 = 0;
this.m22 = sy;
this.dx = 0;
this.dy = 0;
this.ox = 0;
this.oy = 0;
} else {
this.m11 = sx;
this.m12 = 0;
this.m21 = 0;
this.m22 = sy;
this.dx = ox - sx * ox;
this.dy = oy - sy * oy;
this.ox = ox;
this.oy = oy;
}
this.sx = sx;
this.sy = sy;
}
ScaleMatrix.prototype.inverse = function () {
return new ScaleMatrix(1.0 / this.sx, 1.0 / this.sy, this.ox, this.oy);
};
Inherit(Matrix.prototype, ScaleMatrix.prototype);
function RotateMatrix(angle, x, y) {
var cosa = Math.cos(angle);
var sina = Math.sin(angle);
this.m11 = cosa;
this.m12 = sina;
this.m21 = -sina;
this.m22 = cosa;
this.dx = -x * cosa - y * sina + x;
this.dy = x * sina - y * cosa + y;
this.angle = angle;
this.x = x;
this.y = y;
}
RotateMatrix.prototype.inverse = function () {
return new RotateMatrix(-this.angle, this.x, this.y);
};
Inherit(Matrix.prototype, RotateMatrix.prototype);
function TranslateMatrix(dx, dy) {
this.m11 = 1;
this.m12 = 0;
this.m21 = 0;
this.m22 = 1;
this.dx = dx;
this.dy = dy;
}
TranslateMatrix.prototype.inverse = function () {
return new TranslateMatrix(-this.dx, -this.dy);
};
Inherit(Matrix.prototype, TranslateMatrix.prototype);
function recursive_bezier(points, x1, y1, x2, y2, x3, y3, x4, y4, max_error) {
if (++recursive_bezier.depth > 8) {
recursive_bezier.depth -= 1;
return;
}
var x12 = (x1 + x2) / 2;
var y12 = (y1 + y2) / 2;
var x23 = (x2 + x3) / 2;
var y23 = (y2 + y3) / 2;
var x34 = (x3 + x4) / 2;
var y34 = (y3 + y4) / 2;
var x123 = (x12 + x23) / 2;
var y123 = (y12 + y23) / 2;
var x234 = (x23 + x34) / 2;
var y234 = (y23 + y34) / 2;
var x1234 = (x123 + x234) / 2;
var y1234 = (y123 + y234) / 2;
var dx = x4 - x1;
var dy = y4 - y1;
var d2 = Math.abs(((x2 - x4) * dy - (y2 - y4) * dx));
var d3 = Math.abs(((x3 - x4) * dy - (y3 - y4) * dx));
if ((d2 + d3) * (d2 + d3) < max_error * (dx * dx + dy * dy)) {
points.push(new Point(x1234, y1234));
recursive_bezier.depth -= 1;
return;
}
recursive_bezier(points, x1, y1, x12, y12, x123, y123, x1234, y1234,
max_error);
recursive_bezier(points, x1234, y1234, x234, y234, x34, y34, x4, y4,
max_error);
recursive_bezier.depth -= 1;
}
recursive_bezier.depth = 0;
function bezier(points, x1, y1, x2, y2, x3, y3, x4, y4, max_error) {
if (x1 !== x4 && y1 !== y4) {
recursive_bezier(points, x1, y1, x2, y2, x3, y3, x4, y4,
max_error * max_error);
}
points.push(new Point(x4, y4));
}
function PointInPolygon(poly, x, y, radius) {
var xnew, ynew;
var xold, yold;
var x1, y1;
var x2, y2;
var i;
var inside = 0;
if (poly.length < 3) {
return 0;
}
xold = poly[poly.length - 1].x;
yold = poly[poly.length - 1].y;
for (i = 0; i < poly.length; i++) {
xnew = poly[i].x;
ynew = poly[i].y;
if (xnew > xold) {
x1 = xold;
x2 = xnew;
y1 = yold;
y2 = ynew;
} else {
x1 = xnew;
x2 = xold;
y1 = ynew;
y2 = yold;
}
if ((xnew < x) === (x <= xold) &&
(y - y1) * (x2 - x1) < (y2 - y1) * (x - x1)) {
inside = !inside;
}
xold = xnew;
yold = ynew;
}
return (inside);
}
function PointNearPath(path, x3, y3, radius) {
radius = radius * radius;
for (var i = 1; i < path.length; i++) {
var x1 = path[i - 1].x;
var y1 = path[i - 1].y;
var x2 = path[i].x;
var y2 = path[i].y;
var px = x2 - x1;
var py = y2 - y1;
var something = px * px + py * py;
var u = ((x3 - x1) * px + (y3 - y1) * py) / something;
if (u > 1) {
u = 1;
} else if (u < 0) {
u = 0;
}
var x = x1 + u * px;
var y = y1 + u * py;
var dx = x - x3;
var dy = y - y3;
var dist = dx * dx + dy * dy;
if (dist <= radius) {
return true;
}
}
return false;
}
function ImageManipulator(imageData) {
this.image = imageData;
}
ImageManipulator.prototype =
{
clear: function () {
for (var i = 0; i < this.image.width * this.image.height * 4; i++) {
this.image.data[i] = 0;
}
},
getImageData: function () {
return this.image;
},
width: function () {
return this.image.width;
},
height: function () {
return this.image.height;
},
get: function (x, y) {
var i = this.image.width * y * 4 + x * 4;
return (this.image.data[i]) |
(this.image.data[i + 1] << 8) |
(this.image.data[i + 2] << 16) |
(this.image.data[i + 3] << 24);
},
set: function (x, y, clr) {
var i = this.image.width * y * 4 + x * 4;
this.image.data[i] = (clr) & 0xff;
this.image.data[i + 1] = (clr >> 8) & 0xff;
this.image.data[i + 2] = (clr >> 16) & 0xff;
this.image.data[i + 3] = (clr >> 24) & 0xff;
},
invertScanline: function (y, x1, x2) {
}
};
function BitmapImage(width, height) {
this._width = width;
this._height = height;
this.data = [];
}
BitmapImage.prototype = {
width: function () {
return this._width;
},
height: function () {
return this._height;
},
getImageData: function () {
var canvas = document.createElement("canvas");
canvas.width = this._width;
canvas.height = this._height;
var context = canvas.getContext("2d");
var image = context.getImageData(0, 0, this._width, this._height);
var size = this._width * this._height;
for (var i = 0; i < size; i++) {
var clr = this.data[i] === true ? 255 : 0;
image.data[i * 4] = clr;
image.data[i * 4 + 1] = clr;
image.data[i * 4 + 2] = clr;
image.data[i * 4 + 3] = 255;
}
return image;
},
get: function (x, y) {
return this.data[this._width * y + x] === true;
},
set: function (x, y, isSet) {
this.data[this._width * y + x] = isSet;
},
invertScanline: function (y, x1, x2) {
var start = this._width * y + x1;
var end = this._width * y + x2;
for (var i = start; i < end; i++) {
this.data[i] = !this.data[i];
}
},
findFirstOnPixel: function () {
for (var i = 0; i < this.data.length - 1; i++) {
if (this.data[i + 1]) {
return {
x: i % this._width,
y: Math.floor(i / this._width)
};
}
}
return null;
}
};
function PathData() {
this.closed = false;
this.commands = [];
}
PathData.MOVE = 0;
PathData.LINE = 1;
PathData.BEZIER_CURVE = 2;
PathData.CLOSE = 4;
PathData.SizeOf = [
3,
3,
7,
1
];
PathData.NumPoints = [
1,
1,
3,
0
];
PathData.prototype =
{
save: function () {
var s = {};
s["strokeStyle"] = this.strokeStyle;
s["fillStyle"] = this.fillStyle;
s["lineWidth"] = this.lineWidth;
s["d"] = this.commands.concat();
return s;
},
load: function (s) {
this.commands = s["d"];
this.strokeStyle = s["strokeStyle"];
this.fillStyle = s["fillStyle"];
this.lineWidth = s["lineWidth"];
},
moveTo: function (x, y) {
this.commands.push(PathData.MOVE, x, y);
},
lineTo: function (x, y) {
this.commands.push(PathData.LINE, x, y);
},
bezierCurveTo: function (x2, y2, x3, y3, x4, y4) {
this.commands.push(PathData.BEZIER_CURVE, x2, y2, x3, y3, x4, y4);
},
close: function () {
this.commands.push(PathData.CLOSE);
},
draw: function (ctx) {
var i = 0;
while (i < this.commands.length) {
switch (this.commands[i]) {
case PathData.MOVE:
ctx.moveTo(
this.commands[i + 1],
this.commands[i + 2]);
break;
case PathData.LINE:
ctx.lineTo(
this.commands[i + 1],
this.commands[i + 2]);
break;
case PathData.BEZIER_CURVE:
ctx.bezierCurveTo(
this.commands[i + 1],
this.commands[i + 2],
this.commands[i + 3],
this.commands[i + 4],
this.commands[i + 5],
this.commands[i + 6]);
break;
case PathData.CLOSE:
ctx.closePath();
break;
default:
console.error("Error!");
break;
}
i += PathData.SizeOf[this.commands[i]];
}
if (this.lineWidth !== undefined) {
ctx.lineWidth = this.lineWidth;
}
if (this.fillStyle !== undefined) {
ctx.fillStyle = this.fillStyle;
}
if (this.strokeStyle !== undefined) {
ctx.strokeStyle = this.strokeStyle;
}
},
drawControls: function (ctx) {
var i = 0;
var x = 0;
var y = 0;
while (i < this.commands.length) {
switch (this.commands[i]) {
case PathData.MOVE:
x = this.commands[i + 1];
y = this.commands[i + 2];
break;
case PathData.LINE:
x = this.commands[i + 1];
y = this.commands[i + 2];
break;
case PathData.BEZIER_CURVE:
ctx.rect(x - 2, y - 2, 4, 4);
ctx.moveTo(x, y);
ctx.lineTo(
this.commands[i + 1],
this.commands[i + 2]);
ctx.moveTo(
this.commands[i + 3],
this.commands[i + 4]);
ctx.lineTo(
this.commands[i + 5],
this.commands[i + 6]);
x = this.commands[i + 5];
y = this.commands[i + 6];
break;
case PathData.CLOSE:
ctx.closePath();
break;
}
i += PathData.SizeOf[this.commands[i]];
}
},
transform: function (matrix) {
var i = 0;
var j;
var numPoints;
while (i < this.commands.length) {
numPoints = PathData.NumPoints[this.commands[i]];
for (j = 0; j < numPoints; j++) {
var pt = matrix.apply(
this.commands[i + 1 + j * 2],
this.commands[i + 1 + j * 2 + 1]);
this.commands[i + 1 + j * 2] = pt.x;
this.commands[i + 1 + j * 2 + 1] = pt.y;
}
i += PathData.SizeOf[this.commands[i]];
}
},
clone: function () {
var newPath = new PathData();
newPath.commands = this.commands.concat();
newPath.fillStyle = this.fillStyle;
newPath.strokeStyle = this.strokeStyle;
return newPath;
},
calcBoundingRect: function (tolerance) {
var i = 0;
var x, y;
var rect = new Rectangle(this.commands[1], this.commands[2], 0, 0);
while (i < this.commands.length) {
switch (this.commands[i]) {
case PathData.MOVE:
case PathData.LINE:
x = this.commands[i + 1];
y = this.commands[i + 2];
rect.unionPoint(x, y);
break;
case PathData.BEZIER_CURVE:
var points = [];
bezier(points, x, y,
this.commands[i + 1],
this.commands[i + 2],
this.commands[i + 3],
this.commands[i + 4],
this.commands[i + 5],
this.commands[i + 6],
tolerance);
for (var j = 0; j < points.length; j++) {
rect.unionPoint(points[j].x, points[j].y);
}
break;
}
i += PathData.SizeOf[this.commands[i]];
}
return rect;
},
append: function (otherPath) {
this.commands = this.commands.concat(otherPath.commands);
}
};
function blur_image_data(srcdata, radius, MAX_ITERATIONS) {
radius = Math.round(radius);
var width = srcdata.width;
var height = srcdata.height;
var width4 = width * 4;
var radius4 = radius * 4;
var precalc = [];
var src = srcdata.data;
var mul = 1.0 / ((radius * 2) * (radius * 2));
var channel;
var iteration;
for (iteration = 0; iteration < MAX_ITERATIONS; iteration++) {
var x, y, i;
precalc[0] = src[0];
precalc[1] = src[1];
precalc[2] = src[2];
precalc[3] = src[3];
for (i = 4; i < width4; i++) {
precalc[i] = src[i] + precalc[i - 4];
}
for (y = 1; y < height; y++) {
precalc[i] = src[i] + precalc[i - width4];
precalc[i + 1] = src[i + 1] + precalc[i + 1 - width4];
precalc[i + 2] = src[i + 2] + precalc[i + 2 - width4];
precalc[i + 3] = src[i + 3] + precalc[i + 3 - width4];
i += 4;
for (x = 4; x < width4; x++) {
precalc[i] = src[i] + precalc[i - width4] + precalc[i - 4] -
precalc[i - width4 - 4];
i++;
}
}
for (y = radius; y < height - radius; y++) {
var r = (radius) * width4;
i = y * width4 + radius4;
for (x = radius4; x < width4 - radius; x++) {
src[i] = Math.floor(mul * (
precalc[i + radius4 + r] +
precalc[i - radius4 - r] -
precalc[i - radius4 + r] -
precalc[i + radius4 - r]));
i++;
}
}
}
}
function blur_image_data2(srcdata, radius, MAX_ITERATIONS) {
var width = srcdata.width;
var height = srcdata.height;
var width4 = width * 4;
var height4 = height * 4;
var precalc = [];
var src = srcdata.data;
var mul = 1.0 / ((radius * 2) * (radius * 2));
var channel;
var iteration;
for (iteration = 0; iteration < MAX_ITERATIONS; iteration++) {
for (channel = 0; channel < 4; channel++) {
var x, y, i;
var pix = 0;
var pre = 0;
var tot;
pix = channel;
i = 1;
x = 0;
y = 1;
precalc[0] = src[pix];
while (i < width) {
precalc[i] = src[pix] + precalc[i - 1];
i += 1;
pix += 4;
}
while (y < height) {
precalc[i] = src[pix] + precalc[i - width];
i++;
pix += 4;
x = 1;
while (x < width) {
precalc[i] = src[pix] + precalc[i - width] + precalc[i - 1] -
precalc[i - width - 1];
x++;
i++;
pix += 4;
}
y++;
}
pix = radius * width * 4 + radius * 4 + channel;
for (y = radius; y < height - radius; y++) {
for (x = radius; x < width - radius; x++) {
var l = x < radius ? 0 : x - radius;
var t = y < radius ? 0 : y - radius;
var r = x + radius >= width ? width - 1 : x + radius;
var b = y + radius >= height ? height - 1 : y + radius;
tot = precalc[r + b * width] + precalc[l + t * width] -
precalc[l + b * width] - precalc[r + t * width];
src[pix] = Math.round(tot * mul);
pix += 4;
}
pix += radius * 2 * 4;
}
}
}
}
function Canvas_drawRoundRect(ctx, x, y, width, height, radius) {
if (radius === 0.0) {
ctx.rect(x, y, width, height);
} else {
var x1 = x;
var x2 = x + width;
var y1 = y;
var y2 = y + height;
ctx.moveTo(x1 + radius, y1);
ctx.lineTo(x2 - radius, y1);
ctx.quadraticCurveTo(x2, y1, x2, y1 + radius);
ctx.lineTo(x2, y2 - radius);
ctx.quadraticCurveTo(x2, y2, x2 - radius, y2);
ctx.lineTo(x1 + radius, y2);
ctx.quadraticCurveTo(x1, y2, x1, y2 - radius);
ctx.lineTo(x1, y1 + radius);
ctx.quadraticCurveTo(x1, y1, x1 + radius, y1);
ctx.closePath();
}
}
function Polygon(var_args) {
this.points = [];
if (arguments.length === 1) {
var arg = arguments[0];
if (arg instanceof Rectangle) {
this.points.push(new Point(arg.x, arg.y));
this.points.push(new Point(arg.right(), arg.y));
this.points.push(new Point(arg.right(), arg.bottom()));
this.points.push(new Point(arg.x, arg.bottom()));
} else if (arg instanceof Array) {
this.points = arg;
} else {
console.error("Bad parameter passed to Polygon() constructor.");
}
}
}
Polygon.prototype = {
transform: function (matrix) {
for (var i = 0; i < this.points.length; i++) {
this.points[i] = matrix.apply(this.points[i].x, this.points[i].y);
}
},
transformWRTContext: function (matrix, ctx) {
for (var i = 0; i < this.points.length; i++) {
this.points[i] = matrix.applyWRTContext(this.points[i].x, this.points[i].y, ctx);
}
},
containsPoint: function (x, y, radius) {
return PointInPolygon(this.points, x, y, radius);
}
};
function TransformSelectionBehaviour(view, previousBehaviour, handle,
toggleEditNode, x, y) {
this.view = view;
this.handle = handle;
this.previousBehaviour = previousBehaviour;
this.toggleEditNode = toggleEditNode;
this.view.showRotationHandle(this.handle === this.view.ROT);
this.haveGesture = false;
this.onMouseDown(x, y);
}
function GetNodeIds(nodes) {
var result = [];
for (var i = 0; i < nodes.length; i++) {
result.push(nodes[i].id);
}
return result;
}
TransformSelectionBehaviour.prototype = {
log: log.create("TransformSelectionBehaviour"),
onTouch: function (e) {
var touch;
var i;
var point;
if (this.haveGesture) {
return;
}
for (i = 0; i < e.touches.length; ) {
touch = e.touches[i];
point = this.view.screenPoint(touch.pageX, touch.pageY);
if (e.type === "touchmove") {
this.onMouseMove(point.x, point.y);
}
break;
}
for (i = 0; i < e.changedTouches.length; ) {
touch = e.changedTouches[i];
point = this.view.screenPoint(touch.pageX, touch.pageY);
if (e.type === "touchend") {
this.onMouseUp(point.x, point.y);
}
break;
}
},
onGesture: function (e) {
this.log("%s scale=%s rotation=%s", e.type, e.scale, e.rotation);
this.haveGesture = true;
var cx = this.selRect.x + this.selRect.width / 2;
var cy = this.selRect.y + this.selRect.height / 2;
var scale = new ScaleMatrix(e.scale, e.scale, cx, cy);
var rotate = new RotateMatrix(-e.rotation / 180 * Math.PI, cx, cy);
var xform = scale.multiply(rotate);
var inverse = xform.inverse();
var i;
for (i = 0; i < this.nodes.length; i++) {
this.nodes[i].setMatrix(xform.multiply(this.matrices[i]),
this.inverses[i].multiply(inverse));
this.nodes[i].format(this.view.ctx, this.view.request);
}
this.view.transformSelectHandles(xform);
this.view.draw();
if (e.type === "gestureend") {
for (i = 0; i < this.nodes.length; i++) {
this.nodes[i].setMatrix(this.matrices[i], this.inverses[i]);
}
this.view.commit([
new TransformAction(
GetNodeIds(this.nodes),
xform,
xform.inverse())
]);
this.exit();
}
},
onMouseDown: function (x, y) {
this.log("onMouseDown");
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
this.dx = x;
this.dy = y;
this.nodes = this.view.getSelectedNodes();
this.extractMatrices(this.nodes);
this.selRect = new Rectangle(this.view.selectionBounds.x,
this.view.selectionBounds.y,
this.view.selectionBounds.width,
this.view.selectionBounds.height);
if (this.handle === this.view.ROT) {
this.cx = this.selRect.x + this.selRect.width / 2;
this.cy = this.selRect.y + this.selRect.height / 2;
this.startAngle = Math.atan2(this.cy - y, x - this.cx);
}
},
extractMatrices: function (nodes) {
this.matrices = [];
this.inverses = [];
for (var i = 0; i < nodes.length; i++) {
this.matrices.push(nodes[i].getMatrix());
this.inverses.push(nodes[i].getInverseMatrix());
}
},
getTransform: function (x, y) {
var offsetX = x - this.dx;
var offsetY = y - this.dy;
var xform;
var sx;
var sy;
switch (this.handle) {
case this.view.NE:
sx = (x - this.selRect.x) / this.selRect.width;
sy = (this.selRect.y + this.selRect.height - y) / this.selRect.height;
xform = new ScaleMatrix(sx, sy, this.selRect.x,
this.selRect.y + this.selRect.height);
break;
case this.view.SE:
sx = (x - this.selRect.x) / this.selRect.width;
sy = (y - this.selRect.y) / this.selRect.height;
xform = new ScaleMatrix(sx, sy, this.selRect.x, this.selRect.y);
break;
case this.view.SW:
sx = (this.selRect.x + this.selRect.width - x) / this.selRect.width;
sy = (y - this.selRect.y) / this.selRect.height;
xform = new ScaleMatrix(sx, sy, this.selRect.x +
this.selRect.width, this.selRect.y);
break;
case this.view.NW:
sx = (this.selRect.x + this.selRect.width - x) / this.selRect.width;
sy = (this.selRect.y + this.selRect.height - y) / this.selRect.height;
xform = new ScaleMatrix(sx, sy,
this.selRect.x + this.selRect.width,
this.selRect.y + this.selRect.height);
break;
case this.view.ROT:
var angle = Math.atan2(this.cy - y, x - this.cx) - this.startAngle;
xform = new RotateMatrix(angle, this.cx, this.cy);
break;
default:
xform = new TranslateMatrix(offsetX, offsetY);
}
return xform;
},
onMouseMove: function (x, y) {
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
var xform = this.getTransform(x, y);
var inverse = xform.inverse();
for (var i = 0; i < this.nodes.length; i++) {
this.nodes[i].setMatrix(xform.multiply(this.matrices[i]),
this.inverses[i].multiply(inverse));
this.nodes[i].format(this.view.ctx, this.view.request);
}
this.view.transformSelectHandles(xform);
if (this.handle === this.view.ROT) {
this.view.rotHandleX = x;
this.view.rotHandleY = y;
}
this.view.draw();
if (this.handle === this.view.ROT) {
var ctx = this.view.ctx;
ctx.save();
ctx.beginPath();
ctx.strokeStyle = "#0050B7";
ctx.lineWidth = 1.0 / this.view.scale;
ctx.moveTo(this.cx, this.cy);
ctx.lineTo(x, y);
ctx.stroke();
ctx.restore();
}
},
onMouseUp: function (x, y) {
this.log("onMouseUp");
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
var node;
if (x !== this.dx || y !== this.dy) {
var xform = this.getTransform(x, y);
for (var i = 0; i < this.nodes.length; i++) {
this.nodes[i].setMatrix(this.matrices[i], this.inverses[i]);
}
this.view.commit([
new TransformAction(
GetNodeIds(this.nodes),
xform,
xform.inverse())
]);
}
else if (this.toggleEditNode) {
node = this.view.doc.hittest(x, y);
if (node && node.hasEditMode()) {
this.log("Didn't move, and has edit mode. Selecting node %s",
node.id);
this.view.clearSelection();
this.view.setEditNode(node);
}
}
this.exit();
},
exit: function () {
this.view.transformSelectHandles(new Matrix());
this.view.showRotationHandle(true);
this.view.calcSelection();
this.view.update(true);
this.view.behaviour = this.previousBehaviour;
},
onDoubleClick: function (x, y) {
this.log("onDoubleClick");
}
};
var _fitLogger = log.create("FitCurve");
function GenerateCurvesFromPoints(points, error) {
var path = new PathData();
function DrawBezierCurve(n, curve) {
path.bezierCurveTo(
curve[1].x, curve[1].y,
curve[2].x, curve[2].y,
curve[3].x, curve[3].y);
_fitLogger("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",
curve[0].x, curve[0].y,
curve[1].x, curve[1].y,
curve[2].x, curve[2].y,
curve[3].x, curve[3].y);
}
function V2Negate(v) {
v.x = -v.x;
v.y = -v.y;
return v;
}
function V2Dot(a, b) {
return (a.x * b.x) + (a.y * b.y);
}
function B0(u) {
var tmp = 1.0 - u;
return (tmp * tmp * tmp);
}
function B1(u) {
var tmp = 1.0 - u;
return (3 * u * (tmp * tmp));
}
function B2(u) {
var tmp = 1.0 - u;
return (3 * u * u * tmp);
}
function B3(u) {
return (u * u * u);
}
function V2DistanceBetween2Points(a, b) {
var dx = a.x - b.x;
var dy = a.y - b.y;
return Math.sqrt((dx * dx) + (dy * dy));
}
function V2SquaredLength(a) {
return (a.x * a.x) + (a.y * a.y);
}
function V2Length(a) {
return Math.sqrt(V2SquaredLength(a));
}
function V2Scale(v, newlen) {
var len = V2Length(v);
if (len !== 0.0) {
v.x *= newlen / len;
v.y *= newlen / len;
}
return v;
}
function V2Add(a, b, c) {
if (c === undefined) {
_fitLogger("Undef!");
}
c.x = a.x + b.x;
c.y = a.y + b.y;
return c;
}
function V2AddII(a, b) {
return { x: a.x + b.x, y: a.y + b.y };
}
function V2ScaleII(v, s) {
return { x: v.x * s, y: v.y * s };
}
function V2SubII(a, b) {
return { x: a.x - b.x, y: a.y - b.y };
}
function GenerateBezier(d, first, last, uPrime, tHat1, tHat2) {
var i;
var A = [];
var nPts;
var C = [[], []];
var X = [];
var det_C0_C1,
det_C0_X,
det_X_C1;
var alpha_l,
alpha_r;
var tmp;
var bezCurve;
bezCurve = [{}, {}, {}, {}];
nPts = last - first + 1;
for (i = 0; i < nPts; i++) {
var v1 = { x: tHat1.x, y: tHat1.y };
var v2 = { x: tHat2.x, y: tHat2.y };
V2Scale(v1, B1(uPrime[i]));
V2Scale(v2, B2(uPrime[i]));
A[i] = [v1, v2];
}
C[0][0] = 0.0;
C[0][1] = 0.0;
C[1][0] = 0.0;
C[1][1] = 0.0;
X[0] = 0.0;
X[1] = 0.0;
for (i = 0; i < nPts; i++) {
C[0][0] += V2Dot(A[i][0], A[i][0]);
C[0][1] += V2Dot(A[i][0], A[i][1]);
C[1][0] = C[0][1];
C[1][1] += V2Dot(A[i][1], A[i][1]);
tmp = V2SubII(d[first + i],
V2AddII(
V2ScaleII(d[first], B0(uPrime[i])),
V2AddII(
V2ScaleII(d[first], B1(uPrime[i])),
V2AddII(
V2ScaleII(d[last], B2(uPrime[i])),
V2ScaleII(d[last], B3(uPrime[i]))))));
X[0] += V2Dot(A[i][0], tmp);
X[1] += V2Dot(A[i][1], tmp);
}
det_C0_C1 = C[0][0] * C[1][1] - C[1][0] * C[0][1];
det_C0_X = C[0][0] * X[1] - C[0][1] * X[0];
det_X_C1 = X[0] * C[1][1] - X[1] * C[0][1];
if (det_C0_C1 === 0.0) {
det_C0_C1 = (C[0][0] * C[1][1]) * 10e-12;
}
alpha_l = det_X_C1 / det_C0_C1;
alpha_r = det_C0_X / det_C0_C1;
if (alpha_l < 0.0 || alpha_r < 0.0) {
var dist = V2DistanceBetween2Points(d[last], d[first]) /
3.0;
bezCurve[0] = d[first];
bezCurve[3] = d[last];
V2Add(bezCurve[0], V2Scale(tHat1, dist), bezCurve[1]);
V2Add(bezCurve[3], V2Scale(tHat2, dist), bezCurve[2]);
return (bezCurve);
}
bezCurve[0] = d[first];
bezCurve[3] = d[last];
V2Add(bezCurve[0], V2Scale(tHat1, alpha_l), bezCurve[1]);
V2Add(bezCurve[3], V2Scale(tHat2, alpha_r), bezCurve[2]);
return (bezCurve);
}
function Bezier(degree, V, t) {
var i, j;
var Q;
var Vtemp;
Vtemp = [];
for (i = 0; i <= degree; i++) {
Vtemp[i] = { x: V[i].x, y: V[i].y };
}
for (i = 1; i <= degree; i++) {
for (j = 0; j <= degree - i; j++) {
Vtemp[j].x = (1.0 - t) * Vtemp[j].x + t * Vtemp[j + 1].x;
Vtemp[j].y = (1.0 - t) * Vtemp[j].y + t * Vtemp[j + 1].y;
}
}
Q = Vtemp[0];
return Q;
}
function NewtonRaphsonRootFind(Q, P, u) {
var numerator, denominator;
var Q1 = [], Q2 = [];
var Q_u, Q1_u, Q2_u;
var uPrime;
var i;
Q_u = Bezier(3, Q, u);
for (i = 0; i <= 2; i++) {
Q1[i] = {};
Q1[i].x = (Q[i + 1].x - Q[i].x) * 3.0;
Q1[i].y = (Q[i + 1].y - Q[i].y) * 3.0;
}
for (i = 0; i <= 1; i++) {
Q2[i] = {};
Q2[i].x = (Q1[i + 1].x - Q1[i].x) * 2.0;
Q2[i].y = (Q1[i + 1].y - Q1[i].y) * 2.0;
}
Q1_u = Bezier(2, Q1, u);
Q2_u = Bezier(1, Q2, u);
numerator = (Q_u.x - P.x) * (Q1_u.x) + (Q_u.y - P.y) * (Q1_u.y);
denominator = (Q1_u.x) * (Q1_u.x) + (Q1_u.y) * (Q1_u.y) +
(Q_u.x - P.x) * (Q2_u.x) + (Q_u.y - P.y) * (Q2_u.y);
uPrime = u - (numerator / denominator);
return (uPrime);
}
function Reparameterize(d, first, last, u, bezCurve) {
var nPts = last - first + 1;
var i;
var uPrime = [];
uPrime = [];
for (i = first; i <= last; i++) {
uPrime[i - first] = NewtonRaphsonRootFind(bezCurve, d[i],
u[i - first]);
}
return (uPrime);
}
function V2Normalize(v) {
var len = Math.sqrt(V2Length(v));
if (len !== 0.0) {
v.x /= len;
v.y /= len;
}
return v;
}
function ComputeCenterTangent(d, center) {
var V1, V2, tHatCenter = {};
V1 = V2SubII(d[center - 1], d[center]);
V2 = V2SubII(d[center], d[center + 1]);
tHatCenter.x = (V1.x + V2.x) / 2.0;
tHatCenter.y = (V1.y + V2.y) / 2.0;
tHatCenter = V2Normalize(tHatCenter);
return tHatCenter;
}
function ChordLengthParameterize(d, first, last) {
var i;
var u = [];
u[0] = 0.0;
for (i = first + 1; i <= last; i++) {
u[i - first] = u[i - first - 1] +
V2DistanceBetween2Points(d[i], d[i - 1]);
}
for (i = first + 1; i <= last; i++) {
u[i - first] = u[i - first] / u[last - first];
}
return (u);
}
function ComputeMaxError(d, first, last, bezCurve, u) {
var i;
var maxDist;
var dist;
var P;
var v;
var splitPoint = (last - first + 1) / 2;
maxDist = 0.0;
for (i = first + 1; i < last; i++) {
P = Bezier(3, bezCurve, u[i - first]);
v = V2SubII(P, d[i]);
dist = V2SquaredLength(v);
if (dist >= maxDist) {
maxDist = dist;
splitPoint = i;
}
}
return { maxError: maxDist, splitPoint: splitPoint };
}
function FitCubic(d, first, last, tHat1, tHat2, error) {
var bezCurve;
var u;
var uPrime;
var maxError;
var splitPoint;
var nPts;
var iterationError;
var maxIterations = 4;
var tHatCenter;
var i;
bezCurve = [{}, {}, {}, {}];
iterationError = error * error;
nPts = last - first + 1;
if (nPts === 2) {
var dist = V2DistanceBetween2Points(d[last], d[first]) / 3.0;
bezCurve[0] = d[first];
bezCurve[3] = d[last];
V2Add(bezCurve[0], V2Scale(tHat1, dist), bezCurve[1]);
V2Add(bezCurve[3], V2Scale(tHat2, dist), bezCurve[2]);
DrawBezierCurve(3, bezCurve);
return;
}
u = ChordLengthParameterize(d, first, last);
bezCurve = GenerateBezier(d, first, last, u, tHat1, tHat2);
var ret = ComputeMaxError(d, first, last, bezCurve, u);
maxError = ret.maxError;
splitPoint = ret.splitPoint;
if (maxError < error) {
DrawBezierCurve(3, bezCurve);
return;
}
if (maxError < iterationError) {
for (i = 0; i < maxIterations; i++) {
uPrime = Reparameterize(d, first, last, u, bezCurve);
bezCurve = GenerateBezier(d, first, last, uPrime, tHat1, tHat2);
ret = ComputeMaxError(d, first, last,
bezCurve, uPrime);
maxError = ret.maxError;
splitPoint = ret.splitPoint;
if (maxError < error) {
DrawBezierCurve(3, bezCurve);
return;
}
u = uPrime;
}
}
tHatCenter = ComputeCenterTangent(d, splitPoint);
FitCubic(d, first, splitPoint, tHat1, tHatCenter, error);
V2Negate(tHatCenter);
FitCubic(d, splitPoint, last, tHatCenter, tHat2, error);
}
function ComputeLeftTangent(d, end) {
var tHat1;
tHat1 = V2SubII(d[end + 1], d[end]);
tHat1 = V2Normalize(tHat1);
return tHat1;
}
function ComputeRightTangent(d, end) {
var tHat2;
tHat2 = V2SubII(d[end - 1], d[end]);
tHat2 = V2Normalize(tHat2);
return tHat2;
}
function FitCurve(d, nPts, error) {
var tHat1 = ComputeLeftTangent(d, 0);
var tHat2 = ComputeRightTangent(d, nPts - 1);
FitCubic(d, 0, nPts - 1, tHat1, tHat2, error);
}
path.moveTo(points[0].x, points[0].y);
FitCurve(points, points.length, error * error);
return path;
}
function main() {
var d = [
];
var x = 0;
var y = 0;
for (var j = 0; j < 10; j++) {
d.push({
x: Math.random() * 640,
y: Math.random() * 480
});
}
var canvas = document.createElement("canvas");
canvas.width = 640;
canvas.height = 480;
canvas.style.borderWidth = "1px";
canvas.style.borderColor = "#000000";
canvas.style.borderStyle = "solid";
canvas.strokeStyle = "#000000";
canvas.lineWidth = 1;
document.getElementById("debug").appendChild(canvas);
var m = 1;
var ctx = canvas.getContext("2d");
for (var i = 0; i < d.length; i++) {
ctx.rect(d[i].x * m - 2, d[i].y * m - 2, 4, 4);
}
ctx.stroke();
ctx.beginPath();
var error = 4.0;
var path = GenerateCurvesFromPoints(d, error);
ctx.lineWidth = 3;
path.draw(ctx);
ctx.stroke();
ctx.beginPath();
ctx.lineWidth = 1;
ctx.strokeStyle = "#c0c0ff";
path.drawControls(ctx);
ctx.stroke();
}
function DrawTextBehaviour(view) {
this.view = view;
this.editing = false;
this.editBox = null;
this.editPoint = null;
this.editNodeId = 0;
this.textPosition = "normal";
}
DrawTextBehaviour.prototype = {
log: log.create("Text"),
enter: function () {
this.log("Entering text mode");
this.view.canvas.style.cursor = "text";
},
leave: function () {
if (this.editing) {
this.createText();
}
this.view.canvas.style.cursor = "default";
this.log("Leaving text mode");
if (this.editBox) {
$(this.editBox).remove();
this.editBox = null;
}
},
onTouch: function (e) {
for (var i = 0; i < e.touches.length; i++) {
var touch = e.touches[i];
var point = this.view.screenPoint(touch.pageX, touch.pageY);
if (e.type === "touchstart") {
this.onMouseDown(point.x, point.y, e);
}
}
},
onMouseDown: function (x, y, e) {
if (this.editing) {
this.log("Editing somewhere else on mousedown; submit that first.");
this.createText();
this.view.pickTool();
return;
}
var node = this.view.doc.hittest(x, y);
var fontName, fontSize;
if (node && node.type() === "TextNode") {
this.editNode = node;
if (this.textPosition !== "top") {
this.editNode.setHidden(true);
}
this.view.draw();
this.editPoint = new Point(node.rect.x, node.rect.y);
fontName = node.getProperty("fontName");
fontSize = node.getProperty("fontSize");
} else {
this.editNode = null;
this.editPoint = new Point(x, y);
fontName = this.view.defaults["fontName"];
fontSize = this.view.defaults["fontSize"];
}
var self = this;
var self = this, cContainer = $(this.view.canvas).parent(), cOffset = cContainer.offset();
this.editBox = document.createElement("input");
this.editBox.type = "text";
cContainer.append(this.editBox);
var height = $(this.editBox).height();
if (this.editPoint.x < $(this.view.canvas.parentNode.parentNode).find('div.sp_toolbar_container')[0].offsetWidth) {
this.editPoint.x = $(this.view.canvas.parentNode.parentNode).find('div.sp_toolbar_container')[0].offsetWidth;
}
var pos = this.view.documentPoint(this.editPoint.x, this.editPoint.y);
this.editBox.style.position = "absolute";
this.editBox.style.fontFamily = fontName;
this.editBox.style.fontSize = "" + (fontSize * this.view.scale) + "px";
if (this.textPosition === "top") {
var offset = $(this.view.canvas).offset();
var width = $(this.view.canvas).width();
var editWidth = $(this.editBox).width();
this.editBox.style.left = "" + (offset.left + width / 2 - editWidth / 2) + "px";
this.editBox.style.top = "" + (offset.top) + "px";
} else {
this.editBox.style.left = "" + Math.round(pos.x - cOffset.left) + "px";
this.editBox.style.top = "" + Math.round(pos.y - cOffset.top) + "px";
}
this.editing = true;
this.editPoint = new Point(x, y + height);
if (this.editNode) {
this.editBox.value = this.editNode.getProperty("text");
}
$(this.editBox).bind("keydown", function (e) {
if (e.keyCode === 27) {
self.log("ESC pressed; cancel.");
self.cancel();
self.view.pickTool();
self.view.eventSource.emit("goto-toolbar");
} else if (e.keyCode === 13) {
self.log("Enter pressed. create text.");
self.createText();
if (self.view.isKeyboardCursorShown()) {
self.view.showKeyboardCursorAndStartMoving();
}
self.view.pickTool();
self.view.eventSource.emitNow("goto-canvas");
}
});
setTimeout(function () {
if (self.editBox) {
$(self.editBox).focus();
}
}, 300);
$(self.editBox).focus();
},
cancel: function () {
$(this.editBox).remove();
this.editBox = null;
this.editing = false;
if (this.editNode) {
this.editNode.setHidden(false);
this.view.draw();
}
},
createText: function () {
var text = this.editBox.value;
this.cancel();
if (this.editNode && this.editNode.getProperty("text") === text) {
this.log("Text was not changed.");
return;
}
if (this.editNode === null && text === "") {
this.log("No text entered.");
return;
}
if (this.editNode) {
this.log("Update text in node %s", this.editNode.id);
this.view.commit([
new SetAction([this.editNode.id], "text", text)]);
this.view.doneSelecting();
} else {
this.log("Create new text node.");
var id = this.view.doc.peekNextId();
var xform = new TranslateMatrix(this.editPoint.x,
this.editPoint.y);
this.view.commit([
new CreateAction("TextNode", {
"text": text,
"fontSize": this.view.defaults["fontSize"],
"fontName": this.view.defaults["fontName"],
"textFillStyle": this.view.defaults["textFillStyle"]
}),
new TransformAction([id], xform, xform.inverse())
]);
}
},
onMouseMove: function (x, y) {
},
onKeyCommand: function (action) {
this.log("keyboard: %s", action);
if (action === "cancel" && this.editBox === null) {
this.view.pickTool();
this.view.eventSource.emit("goto-toolbar");
}
},
onColourClicked: function (e) {
this.log("Set text colour to %s", e.colour);
this.view.setProperty("textFillStyle", e.colour);
}
};
function BaseNode(id) {
this.initBase(id, BaseNode);
}
BaseNode.defaults = {
"fillStyle": "#cccccc",
"strokeStyle": "#000000",
"lineWidth": 2,
"shadow": false
};
BaseNode.prototype = {
initBase: function (id, constructor) {
this.id = id;
this.properties = {};
this.applyDefaults(BaseNode.defaults);
this.rect = new Rectangle(0, 0, 1, 1);
this.properties["matrix"] = new Matrix();
this.properties["inverse"] = new Matrix();
this.parent = null;
this.constructor = constructor;
this._hidden = false;
},
applyDefaults: function (defaults) {
for (var key in defaults) {
if (1) {
this.properties[key] = defaults[key];
}
}
},
hasEditMode: function () {
return false;
},
hasText: function () {
return "text" in this.properties;
},
hasData: function () {
return "data" in this.properties;
},
clone: function (nameGenerator) {
var clone = new this.constructor(nameGenerator());
clone.setProperties(this.getProperties());
return clone;
},
getProperties: function () {
return this.properties;
},
setProperties: function (properties) {
for (var key in properties) {
if (properties.hasOwnProperty(key)) {
this.setProperty(key, properties[key]);
}
}
},
isGroup: function () {
return this.children !== undefined;
},
isRoot: function () {
return this.parent === null;
},
isGroupMember: function () {
return this.parent !== null && !this.parent.isRoot();
},
type: function () {
return "BaseNode";
},
getMatrix: function () {
return this.properties["matrix"];
},
getInverseMatrix: function () {
return this.properties["inverse"];
},
setMatrix: function (matrix, inverse) {
this.properties["matrix"] = matrix;
this.properties["inverse"] = inverse;
},
setProperty: function (name, value) {
if (name in this.properties) {
this.properties[name] = value;
}
},
getProperty: function (name) {
return this.properties[name];
},
getRect: function () {
return this.rect;
},
transform: function (matrix, inverse) {
this.properties["matrix"] = matrix.multiply(this.properties["matrix"]);
this.properties["inverse"] = this.properties["inverse"].multiply(
inverse);
},
format: function (ctx, request) {
},
hittest: function (x, y) {
return this.rect.containsPoint(x, y) ? this : null;
},
setHidden: function (hidden) {
this._hidden = hidden;
},
hidden: function () {
return this._hidden;
},
draw: function (ctx) {
ctx.save();
var matrix = this.properties["matrix"];
ctx.transform(matrix.m11, matrix.m21, matrix.m12,
matrix.m22, matrix.dx, matrix.dy);
ctx.strokeStyle = this.properties["strokeStyle"];
ctx.fillStyle = this.properties["fillStyle"];
ctx.lineWidth = this.properties["lineWidth"];
if (this.properties["shadow"]) {
ctx.shadowOffsetX = 3;
ctx.shadowOffsetY = 3;
ctx.shadowBlur = 5;
ctx.shadowColor = "rgba(0,0,0,0.5)";
}
this._draw(ctx);
ctx.restore();
},
_draw: function (ctx) {
},
onAdded: function () {
},
onRemoved: function () {
}
};
var ImageNode = function (id) {
this.initBase(id, ImageNode);
this.properties["url"] = "";
this.img = null;
this.width = 100;
this.height = 20;
this.poly = new Polygon();
this.locked = false;
};
__extends(ImageNode, BaseNode);
ImageNode.prototype.log = log.create("IMAGE", true);
ImageNode.prototype.type = function () {
return "ImageNode";
};
ImageNode.prototype.setProperty = function (name, value) {
this.properties[name] = value;
if (name === "url") {
return this.img = null;
}
};
ImageNode.prototype.format = function (ctx, request) {
var name;
if (this.img === null) {
this.rect = new Rectangle(0, 0, this.width, this.height);
name = "image-" + this.id + this.properties["url"];
request.add(this, "image", this.properties["url"], null, __bind(function (img, url) {
this.log("Got image response.");
this.img = img;
return request.emit("reformat", this);
}, this));
} else {
this.rect = new Rectangle(0, 0, this.img.width, this.img.height);
}
this.poly = new Polygon(this.rect);
this.poly.transform(this.properties["matrix"]);
return this.rect.transform(this.properties["matrix"]);
};
ImageNode.prototype.hittest = function (x, y) {
if (!this.properties["locked"] && this.poly.containsPoint(x, y, 3)) {
return this;
} else {
return null;
}
};
ImageNode.prototype._draw = function (ctx) {
if (this.img === null) {
ctx.save();
ctx.lineWidth = 1.0;
ctx.strokeStyle = "#cccccc";
ctx.strokeRect(0, 0, this.width, this.height);
return ctx.restore();
} else {
return ctx.drawImage(this.img, 0, 0);
}
}; ;
function DomNode(id) {
this.initBase(id, DomNode);
this.properties["data"] = "";
this.element = null;
this.dataRequested = "";
}
DomNode.prototype = {
log: log.create("DomNode", true),
type: function () {
return "DomNode";
},
setProperty: function (key, value) {
if (key === "data") {
if (this.element) {
$(this.element).remove();
this.element = null;
this.dataRequested = null;
}
}
BaseNode.prototype.setProperty.call(this, key, value);
},
setElement: function (element) {
this.log("Node %s receives DOM element and requests reformat", this.id);
this.element = element;
this.element.style.position = "absolute";
this.element.style["pointerEvents"] = "none";
$(this.formatRequest.canvas.parentNode).append(this.element);
this.originalWidth = this.element.offsetWidth;
this.originalHeight = this.element.offsetHeight;
this.element.style.top = "0px";
this.element.style.left = "0px";
this._setStyle("transformOrigin", "top left");
this.formatRequest.requestReformat(this);
},
_setStyle: function (name, value) {
var upper = name.charAt(0).toUpperCase() + name.substr(1);
var prefixes = ["ms", "Webkit", "O", "Moz"];
for (var i = 0; i < prefixes.length; i++) {
this.element.style[prefixes[i] + upper] = value;
}
this.element.style[name] = value;
},
format: function (ctx, request) {
if (this.element === null && this.dataRequested !==
this.getProperty("data")) {
this.dataRequested = this.getProperty("data");
this.formatRequest = request;
this.log("DomNode %s requests conversion to DOM element", this.id);
this.formatRequest.convertDomRequest(this.dataRequested, this.id);
}
if (this.element) {
var scale = request.getScale(),
matrix = this.getMatrix();
this.rect.x = 0;
this.rect.y = 0;
this.rect.width = this.originalWidth;
this.rect.height = this.originalHeight;
this.rect.transform(matrix);
var scaleTransform = new ScaleMatrix(scale, scale),
elementTransform = scaleTransform.multiply(matrix);
this._setStyle("transform", elementTransform.toCssTransformString());
}
},
_draw: function (ctx) {
if (!this.element) {
ctx.beginPath();
ctx.lineWidth = 1;
ctx.fillStyle = "#888888";
ctx.strokeStyle = "#CCCCCC";
ctx.rect(0, 0, 100, 22);
ctx.stroke();
ctx.font = "20px Arial";
ctx.textBaseline = "top";
ctx.fillText("", 0, 0);
}
},
hittest: function (x, y) {
if (!this.properties["locked"] &&
this.rect.containsPoint(x, y)) {
return this;
} else {
return null;
}
},
onAdded: function () {
if (this.element) {
document.body.appendChild(this.element);
}
},
onRemoved: function () {
if (this.element) {
$(this.element).remove();
}
}
};
DomNode.prototype = $.extend({}, BaseNode.prototype, DomNode.prototype);
function GroupNode(name) {
this.init(name);
}
GroupNode.prototype.init = function (name) {
this.initBase(name, GroupNode);
this.parent = null;
this.children = [];
};
GroupNode.prototype.type = function () {
return "GroupNode";
};
GroupNode.prototype.clone = function (namer) {
var clone = new GroupNode(namer());
for (var i = 0; i < this.children.length; i++) {
var child = this.children[i].clone(namer);
child.parent = clone;
clone.children.push(child);
}
return clone;
};
GroupNode.prototype.setProperty = function (key, value) {
for (var i = 0; i < this.children.length; i++) {
this.children[i].setProperty(key, value);
}
};
GroupNode.prototype.format = function (ctx, request) {
for (var i = 0; i < this.children.length; i++) {
this.children[i].format(ctx, request);
if (i === 0) {
this.rect = this.children[i].rect.clone();
} else {
this.rect.union(this.children[i].rect);
}
}
};
GroupNode.prototype.draw = function (ctx) {
for (var i = 0; i < this.children.length; i++) {
this.children[i].draw(ctx);
}
};
GroupNode.prototype.hittest = function (x, y) {
for (var i = this.children.length - 1; i >= 0; i--) {
var result = this.children[i].hittest(x, y);
if (result) {
return result;
}
}
return null;
};
GroupNode.prototype.findChildIndex = function (child) {
for (var i = 0; i < this.children.length; i++) {
if (child === this.children[i]) {
return i;
}
}
return -1;
};
Inherit(BaseNode.prototype, GroupNode.prototype);
var MathNode = function (id) {
this.initBase(id, MathNode);
this.properties["mathml"] = "";
this.img = null;
this.width = 100;
this.height = 20;
this.poly = new Polygon();
this.locked = false;
this.zoomed = false;
};
__extends(MathNode, BaseNode);
MathNode.prototype.log = log.create("MATHNODE", true);
MathNode.prototype.type = function () {
return "MathNode";
};
MathNode.prototype.setProperty = function (name, value) {
this.properties[name] = value;
if (name === "mathml") {
this.img = null;
return;
}
};
MathNode.prototype.setImage = function (img) {
if (!img) { return; }
this.img = img;
};
MathNode.prototype.format = function (ctx, request) {
if (this.img === null) {
this.zoomed = false;
this.rect = new Rectangle(0, 0, this.width, this.height);
console.log("Format call in the math node.", ctx, request);
request.add(this, "math", this.properties["mathml"], null, __bind(function (img, url) {
this.log("Got math response.");
this.img = img;
if (this.img) {
return request.emit("reformat", this);
}
}, this));
} else {
this.realWidth = this.img.width;
this.realHeight = this.img.height;
this.zoomedWidth = this.img.width;
this.zoomedHeight = this.img.height;
this.rect = new Rectangle(0, 0, this.realWidth, this.realHeight);
}
this.poly = new Polygon(this.rect);
this.poly.transform(this.properties["matrix"]);
return this.rect.transform(this.properties["matrix"]);
};
MathNode.prototype.hittest = function (x, y) {
if (!this.properties["locked"] && this.poly.containsPoint(x, y, 3)) {
return this;
} else {
return null;
}
};
MathNode.prototype._draw = function (ctx) {
console.log("What is the draw context?", ctx);
if (this.img === null) {
ctx.save();
ctx.lineWidth = 1.0;
ctx.strokeStyle = "#cccccc";
ctx.strokeRect(0, 0, this.width, this.height);
return ctx.restore();
} else {
try {
return ctx.drawImage(this.img, 0, 0);
} catch (e) {
return console.error("Error drawing the image", e);
}
}
};
var TextNode = function (id) {
this.initBase(id, TextNode);
this.applyDefaults(TextNode.defaults);
this.properties["text"] = "lorum ipsum dolor";
this.textWidth = 0;
this.textHeight = 0;
this.path = null;
this.xpath = null;
this.bounds = [];
this.lines = [];
};
__extends(TextNode, BaseNode);
TextNode.prototype.log = log.create("TEXT", true);
TextNode.prototype.type = function () {
return "TextNode";
};
TextNode.prototype.setProperty = function (name, value) {
this.properties[name] = value;
if (name === "fontName" || name === "text") {
this.path = null;
}
if (name === 'textFillStyle') {
return this.properties['fillStyle'] = value;
} else if (name === 'fillStyle') {
return this.properties['textFillStyle'] = value;
}
};
TextNode.prototype.strip = function (text) {
if (text === null)
return '';
var len;
len = text.length;
while (len > 0 && text[len - 1] === '\n') {
len -= 1;
}
return text.substr(0, len);
};
TextNode.prototype.format = function (ctx, request) {
var bl, br, i, line, lineHeight, matrix, pt, text, tl, tr, width, _i, _len, _ref;
this.font = "" + this.properties["fontSize"] + "px " + this.properties["fontName"];
ctx.font = this.font;
if (ctx.getTextOutline) {
ctx.textBaseline = "alphabetic";
this.path = ctx.getTextOutline(this.properties["text"], 0, 0);
}
if (this.path === null) {
ctx.save();
matrix = this.properties["matrix"];
if (matrix.dx < 0) {
matrix.dx = 0;
}
if (matrix.dx > ctx.canvas.width - this.textWidth) {
matrix.dx = ctx.canvas.width - this.textWidth;
}
if (matrix.dy < this.textHeight) {
matrix.dy = this.textHeight;
}
if (matrix.dy > ctx.canvas.height) {
matrix.dy = ctx.canvas.height;
}
ctx.transform(matrix.m11, matrix.m21, matrix.m12, matrix.m22, matrix.dx, matrix.dy);
i = 0;
this.textWidth = 0;
this.lines = [];
text = this.strip(this.properties["text"]);
lineHeight = this.properties["fontSize"];
_ref = text.split("\n");
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
line = _ref[_i];
this.lines.push({
text: line,
x: 0,
y: this.properties["fontSize"] * i
});
width = ctx.measureText(line).width;
this.textWidth = Math.max(this.textWidth, width);
i += 1;
}
this.textHeight = lineHeight * this.lines.length;
ctx.restore();
tl = matrix.apply(0, -lineHeight);
tr = matrix.apply(this.textWidth, -lineHeight);
br = matrix.apply(this.textWidth, lineHeight * (this.lines.length - 1));
bl = matrix.apply(0, lineHeight * (this.lines.length - 1));
this.bounds = [tl, tr, br, bl];
this.rect = Rectangle.CreateBoundingBox(this.bounds);
} else {
i = 0;
matrix = this.properties["matrix"];
this.xpath = this.path.concat();
while (i < this.xpath.length) {
switch (this.xpath[i]) {
case 0:
case 1:
pt = matrix.apply(this.xpath[i + 1], this.xpath[i + 2]);
this.xpath[i + 1] = pt.x;
this.xpath[i + 2] = pt.y;
if (i === 0) {
this.rect.x = pt.x;
this.rect.y = pt.y;
this.rect.width = 0;
this.rect.height = 0;
} else {
this.rect.unionPoint(pt.x, pt.y);
}
i += 3;
break;
case 2:
pt = matrix.apply(this.xpath[i + 1], this.xpath[i + 2]);
this.xpath[i + 1] = pt.x;
this.xpath[i + 2] = pt.y;
this.rect.unionPoint(pt.x, pt.y);
pt = matrix.apply(this.xpath[i + 3], this.xpath[i + 4]);
this.xpath[i + 3] = pt.x;
this.xpath[i + 4] = pt.y;
this.rect.unionPoint(pt.x, pt.y);
pt = matrix.apply(this.xpath[i + 5], this.xpath[i + 6]);
this.xpath[i + 5] = pt.x;
this.xpath[i + 6] = pt.y;
this.rect.unionPoint(pt.x, pt.y);
i += 7;
break;
case 3:
i += 1;
break;
default:
this.log("Bad path command: %s", this.xpath[i]);
i = this.xpath.length;
break;
}
}
}
};
TextNode.prototype._draw = function (ctx) {
var i, line, matrix, offset, _i, _len, _ref;
if (this.path) {
matrix = this.properties["inverse"];
ctx.transform(matrix.m11, matrix.m21, matrix.m12, matrix.m22, matrix.dx, matrix.dy);
ctx.beginPath();
i = 0;
while (i < this.xpath.length) {
switch (this.xpath[i]) {
case 0:
ctx.moveTo(this.xpath[i + 1], this.xpath[i + 2]);
i += 3;
break;
case 1:
ctx.lineTo(this.xpath[i + 1], this.xpath[i + 2]);
i += 3;
break;
case 2:
ctx.bezierCurveTo(this.xpath[i + 1], this.xpath[i + 2], this.xpath[i + 3], this.xpath[i + 4], this.xpath[i + 5], this.xpath[i + 6]);
i += 7;
break;
case 3:
ctx.closePath();
i += 1;
break;
default:
this.log("Bad xpath command: %s", this.xpath[i]);
i = this.xpath.length;
break;
}
}
ctx.fill();
if (this.properties["lineWidth"] > 0) {
ctx.shadowColor = "rgba(0,0,0,0.0)";
ctx.stroke();
}
} else {
ctx.font = this.font;
ctx.textBaseline = "alphabetic";
offset = 0;
if (window["IN_SERVER_CGI"] === true) {
offset = -this.properties["fontSize"];
}
_ref = this.lines;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
line = _ref[_i];
if (this.properties["lineWidth"] > 0.0) {
ctx.strokeText(line.text, line.x, line.y + offset);
}
ctx.fillText(line.text, line.x, line.y + offset);
}
}
}; ;
TextNode.defaults = {
"textFillStyle": "#000000",
"fontName": "Arial",
"fontSize": 20,
"lineWidth": 0,
"fillStyle": "#000000"
};
var BrushNode = function (id) {
this.initBase(id, BrushNode);
this.log("New BrushNode created.");
this.properties["points"] = [];
this.properties["strokeStyle"] = "#ff00ff";
this.properties["lineWidth"] = 10;
this.points = [];
this.inverse = null;
};
__extends(BrushNode, BaseNode);
BrushNode.prototype.log = log.create("BRUSH", true);
BrushNode.prototype.type = function () {
return "BrushNode";
};
BrushNode.prototype.setProperty = function (name, value) {
if (name === "fillStyle") {
name = "strokeStyle";
}
if (name in this.properties) {
return this.properties[name] = value;
}
};
BrushNode.prototype.format = function (ctx, request) {
var i, points, poly, rect, _ref;
this.points.length = 0;
points = this.properties["points"];
for (i = 0, _ref = points.length - 1; i <= _ref; i += 2) {
this.points.push(new Point(points[i], points[i + 1]));
}
rect = Rectangle.CreateBoundingBox(this.points);
rect.inflate(this.properties["lineWidth"] + 3, this.properties["lineWidth"] + 3);
poly = new Polygon(rect);
poly.transformWRTContext(this.properties["matrix"], ctx);
this.rect = Rectangle.CreateBoundingBox(poly.points);
return this.inverse = this.properties["matrix"].inverse();
};
BrushNode.prototype.hittest = function (x, y) {
var point;
if (this.rect.containsPoint(x, y)) {
point = this.inverse.apply(x, y);
if (PointNearPath(this.points, point.x, point.y, this.properties["lineWidth"] / 2)) {
return this;
}
}
return null;
};
BrushNode.prototype._draw = function (ctx) {
var i, points, _ref;
points = this.properties["points"];
if (points.length === 0) {
return;
}
ctx.save();
ctx.beginPath();
ctx.lineCap = "round";
ctx.lineJoin = "round";
ctx.moveTo(points[0], points[1]);
for (i = 2, _ref = points.length - 1; i <= _ref; i += 2) {
ctx.lineTo(points[i], points[i + 1]);
}
ctx.stroke();
return ctx.restore();
}; ;
var DrawBrushBehaviour = function (view, previousBehaviour) {
this.view = view;
this.previousBehaviour = previousBehaviour;
this.dragging = false;
this.paths = [];
};
DrawBrushBehaviour.prototype.log = log.create("Brush");
DrawBrushBehaviour.prototype.enter = function () {
this.view.setHintText("Hold down the button to draw");
this.view.canvas.style.cursor = "crosshair";
};
DrawBrushBehaviour.prototype.reset = function () {
this.dragging = false;
this.paths = [];
};
DrawBrushBehaviour.prototype.onTouch = function (e) {
var p, path, touch, _i, _j, _len, _len2, _ref, _ref2, _results, _results2;
if (e.type === "touchstart") {
_ref = e.changedTouches;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
touch = _ref[_i];
p = this.view.screenPoint(touch.pageX, touch.pageY);
this.paths.push([p]);
}
} else if (e.type === "touchmove") {
_ref2 = e.changedTouches;
for (_j = 0, _len2 = _ref2.length; _j < _len2; _j++) {
touch = _ref2[_j];
p = this.view.screenPoint(touch.pageX, touch.pageY);
path = this.findNearest(p);
if (p.x !== path[path.length - 1].x || p.y !== path[path.length - 1].y) {
path.push(p);
this.draw(path);
}
}
} else if (e.type === "touchend") {
if (e.touches.length === 0) {
this.commit();
}
}
};
DrawBrushBehaviour.prototype.findNearest = function (point) {
var best, bestDist, path, _i, _len, _ref;
best = null;
bestDist = 1000000;
_ref = this.paths;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
path = _ref[_i];
if (best === null || path[path.length - 1].distanceTo(point) < bestDist) {
best = path;
bestDist = path[path.length - 1].distanceTo(point);
}
}
return best;
};
DrawBrushBehaviour.prototype.onMouseDown = function (x, y) {
var pt;
pt = this.view.snap(new Point(x, y));
this.dragging = true;
this.view.setHintText(null);
return this.paths.push([pt]);
};
DrawBrushBehaviour.prototype.draw = function (points) {
this.from = points[points.length - 2];
this.to = points[points.length - 1];
this.view.ctx.beginPath();
this.view.ctx.moveTo(this.from.x, this.from.y);
this.view.ctx.lineTo(this.to.x, this.to.y);
this.stroke(this.view.ctx);
};
DrawBrushBehaviour.prototype.stroke = function (ctx) {
ctx.strokeStyle = this.view.defaultBrushStyle;
ctx.lineCap = "round";
ctx.joinCap = "round";
ctx.lineWidth = this.view.defaultBrushThickness;
ctx.stroke();
};
DrawBrushBehaviour.prototype.onRedraw = function (ctx) {
if (this.paths.length === 0) {
return;
}
ctx.beginPath();
for (var i = 0; i < this.paths.length; i++) {
var path = this.paths[i];
ctx.moveTo(path[0].x, path[0].y);
for (var j = 1; j < path.length; j++) {
var p = path[j];
ctx.lineTo(p.x, p.y);
}
}
this.stroke(ctx);
};
DrawBrushBehaviour.prototype.onMouseMove = function (x, y) {
var pt;
pt = this.view.snap(new Point(x, y));
if (this.dragging) {
this.from = this.paths[0][this.paths[0].length - 1];
if (pt.x !== this.from.x || pt.y !== this.from.y) {
this.paths[0].push(pt);
this.draw(this.paths[0]);
}
}
};
DrawBrushBehaviour.prototype.onMouseUp = function (x, y) {
this.onMouseMove(x, y);
this.dragging = false;
this.commit();
this.view.pickTool();
};
DrawBrushBehaviour.prototype.commit = function () {
var actions, commands, i, path, _i, _len, _ref, _ref2;
actions = [];
_ref = this.paths;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
path = _ref[_i];
commands = [];
for (i = 0, _ref2 = path.length - 1; i <= _ref2; i += 1) {
commands.push(path[i].x);
commands.push(path[i].y);
}
actions.push(new CreateAction("BrushNode", {
"points": commands,
"strokeStyle": this.view.defaultBrushStyle,
"lineWidth": this.view.defaultBrushThickness
}));
}
this.view.commit(actions);
this.reset();
};
DrawBrushBehaviour.prototype.leave = function () {
this.view.canvas.style.cursor = "default";
this.view.setHintText(null);
this.view.draw();
};
DrawBrushBehaviour.prototype.onColourClicked = function (e) {
if (e.button === 1) {
this.view.defaultBrushStyle = e.colour;
}
};
DrawBrushBehaviour.prototype.onKeyCommand = function (action, e) {
if (action === "cancel") {
this.log("ESC pressed. Abort brush and go back to toolbar.");
this.view.pickTool();
this.view.eventSource.emit("goto-toolbar");
}
};
function KeyboardMap() {
EventEmitter.call(this);
this.init();
}
KeyboardMap.prototype = {
init: function () {
this.keys = {};
this.nolog = true;
this.specialWords = new RegExp([
"alt",
"control",
"ctrl",
"del",
"delete",
"down",
"end",
"esc",
"enter",
"home",
"ins",
"insert",
"left",
"pagedown",
"pageup",
"right",
"shift",
"up",
"backspace"
].sort(function (a, b) {
return b.length - a.length;
}).join("|"), "g");
var self = this;
this.handler = function (e) {
self.handleKeyboardEvent(e);
};
},
log: log.create("KEYMAP"),
map: function (keyString, actionString) {
var keys = keyString.toLowerCase().split(",");
var actions = actionString.split(",");
for (var i = 0; i < keys.length; i++) {
for (var j = 0; j < actions.length; j++) {
this._addMapping(keys[i], actions[j]);
}
}
},
_addMapping: function (keyString, action) {
if (keyString.length === 0) {
return false;
}
var words = keyString.match(this.specialWords) || [];
var shift = false;
var control = false;
var alt = false;
var codes = [];
var i;
for (i = 0; i < words.length; i++) {
switch (words[i]) {
case "alt":
alt = true;
break;
case "control":
case "ctrl":
control = true;
break;
case "shift":
shift = true;
break;
case "shift":
shift = true;
break;
case "home":
codes.push(36);
break;
case "end":
codes.push(35);
break;
case "pageup":
codes.push(33);
break;
case "pagedown":
codes.push(34);
break;
case "delete":
case "del":
codes.push(46);
break;
case "backspace":
codes.push(8);
break;
case "up":
codes.push(38);
break;
case "right":
codes.push(39);
break;
case "down":
codes.push(40);
break;
case "left":
codes.push(37);
break;
case "esc":
codes.push(27);
break;
case "enter":
codes.push(13);
break;
default:
console.error("key entry not found: " + words[i]);
break;
}
}
var self = this;
var assign = function (key) {
if (shift && key.indexOf("-shift") === -1) {
key += "-shift";
}
if (control && key.indexOf("-control") === -1) {
key += "-control";
}
if (alt && key.indexOf("-alt") === -1) {
key += "-alt";
}
self.log("Keyboard mapping: %s->%s", key, action);
if (key in self.keys) {
var i = 0;
var actions = self.keys[key];
for (i = 0; i < actions.length; i++) {
if (actions[i] === action) {
break;
}
}
if (i === actions.length) {
self.keys[key].push(action);
}
} else {
self.keys[key] = [action];
}
};
if (codes.length === 0) {
var ch = keyString.toUpperCase()[keyString.length - 1];
switch (ch) {
case "=":
assign("107-shift");
assign("187");
assign("61");
break;
case "+":
assign("107");
assign("61-shift");
break;
case "-":
assign("109");
assign("189");
assign("173");
break;
default:
codes.push(ch.charCodeAt(0));
break;
}
}
for (i = 0; i < codes.length; i++) {
assign("" + codes[i]);
}
},
getKeyName: function (e) {
var key = "";
if (e.keyCode) {
key += e.keyCode;
}
if (e.shiftKey) {
key += "-shift";
}
if (e.ctrlKey) {
key += "-control";
}
if (e.altKey) {
key += "-alt";
}
return key;
},
translate: function (e) {
var actions = [];
var key = this.getKeyName(e);
if (key in this.keys) {
actions = this.keys[key];
}
this.log("%s", key);
return actions;
},
each: function (e, fn) {
var actions = this.translate(e);
for (var i = 0; i < actions.length; i++) {
fn(actions[i]);
}
},
handleKeyboardEvent: function (e) {
var actions = this.translate(e);
for (var i = 0; i < actions.length; i++) {
this.log("action: %s", actions[i]);
this.emitNow("*", actions[i], e);
}
},
attachTo: function (element) {
element.addEventListener("keydown", this.handler, false);
}
};
Inherit(EventEmitter.prototype, KeyboardMap.prototype);
function Panel(div) {
this.initPanel(div);
}
Panel.prototype.initPanel = function (div) {
this.div = div || $("<div>");
$("body").append(this.div);
};
Panel.prototype.width = function (width) {
var self = this;
function get(name) {
var v = parseInt(self.div.css(name), 10);
if (isNaN(v)) {
return 0;
} else {
return v;
}
}
if (width === undefined) {
return this.div.outerWidth();
} else {
width -= get("border-left-width");
width -= get("border-right-width");
width -= get("padding-right");
width -= get("padding-left");
width -= get("margin-left");
width -= get("margin-right");
this._width = width;
this.div.css("width", "" + width + "px");
}
};
Panel.prototype.height = function (height) {
var self = this;
function get(name) {
var v = parseInt(self.div.css(name), 10);
if (isNaN(v)) {
return 0;
} else {
return v;
}
}
if (height === undefined) {
return this.div.outerHeight();
} else {
height -= get("border-top-width");
height -= get("border-bottom-width");
height -= get("padding-top");
height -= get("padding-bottom");
height -= get("margin-top");
height -= get("margin-bottom");
this._height = height;
this.div.css("height", "" + this._height + "px");
}
};
Panel.prototype.moveTo = function (x, y) {
this.div.css("left", "" + x + "px");
this.div.css("top", "" + y + "px");
};
Panel.prototype.show = function () {
this.div.show();
};
Panel.prototype.hide = function () {
this.div.hide();
};
Panel.prototype.destroy = function () {
this.div.remove();
};
var DebugPanel = function (div) {
Panel.apply(this, arguments);
this.div.css("background", "black");
this.div.css("font-family", "\"Lucida Console\",\"Dejavu Sans Mono\",Monospace,\"Courier New\"");
this.div.css("font-size", "10px");
this.div.css("line-height", "12px");
this.div.css("overflow", "scroll");
this.div.css("z-index", 1);
this.nextColour = 0;
this.keyColours = {};
this.curColour = this.colours[0];
this.shown = false;
this.width(300);
log.addListener(__bind(function (key, line) {
return this.addLine(key, line);
}, this));
this.timeout = null;
this.lines = [];
this.addLine("DEBUG", "Debug window starting");
};
__extends(DebugPanel, Panel);
DebugPanel.prototype.colours = ["#ffffff", "#008800", "#008888", "#880000", "#880088", "#884400", "#888888", "#444444", "#0000ff", "#00ff00", "#00ffff", "#ff0000", "#ff00ff", "#ffff00"];
DebugPanel.prototype.show = function () {
Panel.prototype.show.apply(this, arguments);
this.shown = true;
this._addLine();
this.div[0].scrollTop = this.div[0].scrollHeight;
};
DebugPanel.prototype.hide = function () {
this.shown = false;
return Panel.prototype.hide.apply(this, arguments);
};
DebugPanel.prototype.getColourOf = function (key) {
if (!(key in this.keyColours)) {
this.keyColours[key] = this.colours[this.nextColour];
this.nextColour = (this.nextColour + 1) % this.colours.length;
}
return this.keyColours[key];
};
DebugPanel.prototype.addLine = function (key, line) {
var part, _i, _len, _ref;
var self = this;
_ref = line.split('\n');
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
part = _ref[_i];
this.lines.push({
key: key,
line: part
});
}
if (this.shown && this.timeout === null) {
this.timeout = setTimeout(function () {
self._addLine();
}, 100);
}
};
DebugPanel.prototype._addLine = function () {
var atBottom, colour, div, item, key, line, _i, _len, _ref;
atBottom = true;
_ref = this.lines;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
item = _ref[_i];
key = item.key;
line = item.line;
colour = this.getColourOf(key);
div = $("<div>").css("color", colour);
div.css("border-bottom", "1px solid #222");
div.text("" + key + ": " + line);
this.div.append(div);
}
if (atBottom) {
this.div[0].scrollTop = this.div[0].scrollHeight;
}
this.timeout = null;
this.lines.length = 0;
};
var ImageLoader = {
loading: [],
timeoutRunning: null,
timeout: function () {
var self = ImageLoader;
var repl = [];
for (var i = 0; i < self.loading.length; i++) {
if (self.loading[i].complete) {
self.loading[i].fn(self.loading[i],
self.loading[i].srcWanted);
} else {
repl.push(self.loading[i]);
}
}
self.loading = repl;
if (self.loading.length) {
setTimeout(self.timeout, 250);
} else {
self.timeoutRunning = false;
}
},
load: function (url, fn) {
var self = ImageLoader;
var img = new Image();
self.loading.push(img);
img.fn = fn;
img.src = url;
img.srcWanted = url;
img.onload = function () {
if (img.complete) {
for (var i = 0; i < self.loading.length; i++) {
if (self.loading[i] === this) {
self.loading.splice(i, 1);
fn(img, img.srcWanted);
break;
}
}
} else if (!self.timeoutRunning) {
self.timeoutRunning = true;
setTimeout(self.timeout, 250);
}
};
return img;
},
loadDebug: function (url, fn) {
setTimeout(function () {
ImageLoader.load(url, fn);
}, Math.floor(Math.random() * 2500));
}
};
var FormatRequest = function () {
EventEmitter.apply(this, arguments);
this.queue = [];
this.busy = false;
this.mathjax = null;
this.canvas = null;
};
__extends(FormatRequest, EventEmitter);
FormatRequest.prototype.log = log.create("FORMAT", true);
FormatRequest.prototype.add = function (node, type, url, params, callback) {
var item, _i, _len, _ref;
_ref = this.queue;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
item = _ref[_i];
if (item.type === type && item.node === node) {
item.skip = true;
}
}
this.log("Request URL %s", url);
this.queue.push({
node: node,
type: type,
url: url,
params: params,
callback: callback,
skip: false
});
return this.check();
};
FormatRequest.prototype.check = function () {
console.log("Checking the format request.");
var index, item;
index = 0;
while (!this.busy && index < this.queue.length) {
if (this.queue[0].skip) {
this.queue.shift();
continue;
}
this.busy = true;
item = this.queue[index];
this.log("Processing request for item %s url=%s", item.node.id, item.url);
if (item.type.indexOf("image") === 0) {
ImageLoader.load(item.url, __bind(function (img, url) {
this.log("Image request completed for item %s", item.node.id);
item.callback(img, url);
this.log("Image request completed for url %s", url);
this.busy = false;
item.skip = true;
this.check();
}, this));
} else {
$.ajax({
"url": item.url,
"data": item.params,
"dataType": "json",
"success": __bind(function (data) {
if (!item.skip) {
this.log("Request completed for item %s", item.node.id);
item.callback(data);
this.emit("reformat", item.node);
this.busy = false;
this.queue.shift();
this.check();
}
}, this),
"error": __bind(function (jqXHR, textStatus, errorThrown) {
this.log("Error: %s %s", textStatus, errorThrown);
this.busy = false;
this.queue.shift();
this.check();
}, this)
});
}
}
};
FormatRequest.prototype.getCanvasRect = function () {
var offset = $(this.canvas).offset();
return new Rectangle(offset.left, offset.top, this.canvas.width,
this.canvas.height);
};
FormatRequest.prototype.convertDomRequest = function (dataString, domNodeId) {
this.emit("convert-dom-request", dataString, domNodeId);
};
FormatRequest.prototype.requestReformat = function (node) {
this.emit("reformat", node);
};
var ListView = function (parent) {
Panel.call(this, $("<div>"));
parent.append(this.div);
this.events = {};
this.maxWidth = 60;
this.spacing = 5;
this.div.css("overflow-x", "auto");
this.div.css("overflow-y", "auto");
this.layout = "grid";
this.nextIndex = 0;
this.generation = 1;
this.cells = [];
};
__extends(ListView, Panel);
ListView.prototype.on = function (name, fn) {
return this.events[name] = fn;
};
ListView.prototype.setIconWidth = function (width, height) {
return this.maxWidth = width;
};
ListView.prototype.log = log.create("ListView");
ListView.prototype.setLayout = function (layout) {
this.layout = layout;
if (this.layout !== 'grid') {
return this.div.css("white-space", "no-wrap");
}
};
ListView.prototype.addImage = function (url, data) {
var cell, generation;
generation = this.generation;
cell = {
img: null,
index: this.nextIndex,
inserted: false
};
this.nextIndex += 1;
return ImageLoader.load(url, __bind(function (img) {
var height, ratio, width;
if (generation !== this.generation) {
return;
}
width = img.width;
height = img.height;
if (width > this.maxWidth) {
ratio = height / width;
img.width = this.maxWidth;
img.height = this.maxWidth * ratio;
}
img = $(img);
img.css("margin", "" + this.spacing + "px");
img.css("border-width", "3");
img.css("border-color", "white");
img.css("border-style", "solid");
img.css("image-rendering", "optimizeQuality");
img.mouseenter(__bind(function (e) {
this.log("Mouseenter");
return img.css("border-color", "#888888");
}, this));
img.mouseleave(function (e) {
return img.css("border-color", "white");
});
img.click(__bind(function (e) {
if ("click" in this.events) {
return this.events["click"](data);
}
}, this));
cell.img = img;
this.cells.push(cell);
this.cells.sort(function (a, b) {
return a.index - b.index;
});
return this.format();
}, this));
};
ListView.prototype.format = function () {
var cell, prev, _i, _len, _ref, _results;
prev = null;
_ref = this.cells;
_results = [];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
cell = _ref[_i];
if (!cell.inserted) {
if (prev === null) {
this.div.prepend(cell.img);
} else {
prev.img.after(cell.img);
}
cell.inserted = true;
}
_results.push(prev = cell);
}
return _results;
};
ListView.prototype.clear = function () {
this.div.empty();
this.cells.length = 0;
return this.generation += 1;
}; ;
function RandomSequence(seed) {
this.init(seed);
}
RandomSequence.prototype = {
init: function (seed) {
if (typeof seed === "string") {
while (seed.length < 8) {
seed = seed + seed;
}
var d = 0x01000193;
for (var i = 0; i < seed.length; i++) {
d = ((d * 0x01000193) ^ seed.charCodeAt(i)) & 0xffffffff;
}
seed = d;
}
this.seed = seed;
this.reset();
},
reset: function () {
this.m_w = this.seed;
this.m_z = this.seed;
},
next: function () {
this.m_z = 36969 * (this.m_z & 65535) + (this.m_z >> 16);
this.m_w = 18000 * (this.m_w & 65535) + (this.m_w >> 16);
var value = (this.m_z << 16) + this.m_w;
return value / 0xffffffff / 2 + 0.5;
}
};
var SHOW_LINES = false;
var SHOW_CONTROL_POINTS = false;
function PathNode(name) {
this.init(name);
}
PathNode.defaults = {
"strokeStyle": "#000000",
"fillStyle": "#ffffff",
"textFillStyle": "#000000",
"fontName": "Arial",
"fontSize": 20,
"lineWidth": 2,
"smoothness": 0.3,
"sloppiness": 0.5,
"shadow": false,
"closed": false,
"arrowSize": 0,
"text": "",
"isTextEditable": true
};
PathNode.BEZIER_ERROR = 16;
PathNode.MOVE_TO = 0;
PathNode.LINE_TO = 1;
PathNode.QUADRATIC_TO = 2;
PathNode.ARC_TO = 3;
PathNode.BEZIER_TO = 4;
PathNode.CURVE_TO = 5;
PathNode.CORNER_TO = 6;
PathNode.CLOSE = 7;
PathNode.KAPPA = 0.5522847498;
PathNode.CommandLengths = [];
PathNode.CommandLengths[PathNode.MOVE_TO] = 2;
PathNode.CommandLengths[PathNode.LINE_TO] = 2;
PathNode.CommandLengths[PathNode.QUADRATIC_TO] = 4;
PathNode.CommandLengths[PathNode.ARC_TO] = 5;
PathNode.CommandLengths[PathNode.BEZIER_TO] = 6;
PathNode.CommandLengths[PathNode.CURVE_TO] = 2;
PathNode.CommandLengths[PathNode.CORNER_TO] = 4;
PathNode.CommandLengths[PathNode.CLOSE] = 0;
PathNode.prototype.init = function (name) {
this.initBase(name, PathNode);
this.applyDefaults(PathNode.defaults);
this.properties["closed"] = false;
this.properties["commands"] = [];
this.segments = [];
this.properties["seed"] = 0;
this.textNode = new TextNode(0);
this.textNode.setProperty("text", this.properties["text"]);
};
PathNode.prototype.moveTo = function (x, y) {
var commands = this.properties["commands"];
commands.push(PathNode.MOVE_TO);
commands.push(x);
commands.push(y);
};
PathNode.prototype.bezierTo = function (c1x, c1y, c2x, c2y, x, y) {
var commands = this.properties["commands"];
commands.push(PathNode.BEZIER_TO);
commands.push(x);
commands.push(y);
commands.push(c1x);
commands.push(c1y);
commands.push(c2x);
commands.push(c2y);
};
PathNode.prototype.type = function () {
return "PathNode";
};
PathNode.prototype.setPath = function (commands) {
var old = this.properties["commands"];
this.properties["commands"] = commands;
return old;
};
PathNode.prototype.getPath = function () {
return this.properties["commands"];
};
PathNode.prototype.setProperty = function (key, value) {
BaseNode.prototype.setProperty.apply(this, arguments);
if (key === "fontName" || key === "fontSize" || key === "text") {
this.textNode.setProperty(key, value);
} else if (key === "textFillStyle") {
this.textNode.setProperty("fillStyle", value);
}
};
PathNode.prototype.moveEditHandle = function (index, x, y) {
var pos = 0;
var commands = this.properties["commands"];
for (var i = 0; i < index; i++) {
pos += PathNode.CommandLengths[commands[pos]] + 1;
}
var point = this.properties["matrix"].apply(commands[pos + 1],
commands[pos + 2]);
point = this.properties["inverse"].apply(point.x + x, point.y + y);
commands[pos + 1] = point.x;
commands[pos + 2] = point.y;
if (index === 0 && this.properties["closed"]) {
var lastCommand = null;
while (pos < commands.length) {
var length = PathNode.CommandLengths[commands[pos]];
if (length >= 2) {
lastCommand = pos;
}
pos += length + 1;
}
if (lastCommand) {
pos = lastCommand;
point = this.properties["matrix"].apply(commands[pos + 1],
commands[pos + 2]);
point = this.properties["inverse"].apply(point.x + x, point.y + y);
commands[pos + 1] = point.x;
commands[pos + 2] = point.y;
}
}
};
PathNode.prototype.removePoint = function (index) {
var commands = this.properties["commands"];
var pos = 0;
for (var i = 0; i < index; i++) {
pos += PathNode.CommandLengths[commands[pos]] + 1;
}
commands.splice(pos, PathNode.CommandLengths[commands[pos]] + 1);
};
PathNode.prototype.getStartPoint = function () {
return this.origin;
};
PathNode.prototype.getEndPoint = function () {
var seg = this.segments[this.segments.length - 1];
return seg.to;
};
PathNode.prototype.format = function (ctx, request) {
var from = new Point(0, 0);
this.origin = null;
this.segments.length = 0;
var to = new Point(0, 0);
var commands = this.properties["commands"];
var prev = null;
var control, control1, control2;
var radius;
var matrix = this.properties["matrix"];
var randomSequence = new RandomSequence(this.properties["seed"]);
if (commands.length > 0) {
var canvasWidth = ctx.canvas.width;
var canvasheight = ctx.canvas.height;
var nudge = 10;
for (var j = 0; j < commands.length;) {
var cmd = commands[j++];
for (var k = 0; k < PathNode.CommandLengths[cmd];) {
var cp = new Point(commands[j++], commands[j++]);
if (matrix.m11 * cp.x + matrix.dx < 0) {
matrix.dx += nudge;
} else if (matrix.m11 * cp.x + matrix.dx > canvasWidth) {
matrix.dx -= nudge;
} else if (matrix.m22 * cp.y + matrix.dy < 0) {
matrix.dy += nudge;
} else if (matrix.m22 * cp.y + matrix.dy > canvasheight) {
matrix.dy -= nudge;
}
k += 2;
}
}
this.properties["matrix"] = matrix;
this.properties["inverse"] = matrix.inverse();
}
for (var i = 0; i < commands.length; ) {
switch (commands[i++]) {
case PathNode.MOVE_TO:
to = matrix.apply(commands[i++], commands[i++]);
this.segments.push(new MoveSegment(prev, to));
if (this.origin === null) {
this.origin = to;
}
break;
case PathNode.LINE_TO:
to = matrix.apply(commands[i++], commands[i++]);
this.segments.push(new LineSegment(prev, to,
randomSequence,
this.properties["sloppiness"]));
break;
case PathNode.QUADRATIC_TO:
to = matrix.apply(commands[i++], commands[i++]);
control = matrix.apply(commands[i++], commands[i++]);
this.segments.push(new QuadraticSegment(prev, control, to));
break;
case PathNode.ARC_TO:
to = matrix.apply(commands[i++], commands[i++]);
control = matrix.apply(commands[i++], commands[i++]);
radius = commands[i++];
this.segments.push(new ArcSegment(prev, control, to,
radius));
break;
case PathNode.BEZIER_TO:
to = matrix.apply(commands[i++], commands[i++]);
control1 = matrix.apply(commands[i++], commands[i++]);
control2 = matrix.apply(commands[i++], commands[i++]);
this.segments.push(new BezierSegment(prev, control1,
control2, to));
break;
case PathNode.CURVE_TO:
to = matrix.apply(commands[i++], commands[i++]);
this.segments.push(new CurveSegment(prev, to,
this.properties["smoothness"]));
break;
case PathNode.CORNER_TO:
to = matrix.apply(commands[i++], commands[i++]);
control1 = matrix.apply(commands[i++], commands[i++]);
this.segments.push(new CornerSegment(prev, control1,
to, randomSequence,
this.properties["sloppiness"]));
break;
case PathNode.CLOSE:
this.properties["closed"] = true;
break;
default:
i++;
break;
}
prev = this.segments[this.segments.length - 1];
}
if (this.properties["closed"] && this.segments.length >= 4 &&
this.segments[1].setPrevious) {
this.segments[1].setPrevious(prev);
prev.to = this.origin;
}
this.formatArrow();
this.rect.x = this.origin.x;
this.rect.y = this.origin.y;
this.rect.width = 0;
this.rect.height = 0;
this.points = this.calcPoints(PathNode.BEZIER_ERROR);
this.rect = Rectangle.CreateBoundingBox(this.points);
var lineWidth = this.properties["lineWidth"];
this.rect.inflate(lineWidth * 2 + 1, lineWidth * 2 + 1);
if (this.rect.width < 8) {
this.rect.x += this.rect.width / 2 - 4;
this.rect.width = 8;
}
if (this.rect.height < 8) {
this.rect.y += this.rect.height / 2 - 4;
this.rect.height = 8;
}
if (this.properties["closed"]) {
var centroid = CalculateCentroid(this.points);
this.textNode.format(ctx, request);
var xshift = centroid.x - this.textNode.rect.x -
this.textNode.rect.width / 2;
var yshift = centroid.y - this.textNode.rect.y -
this.textNode.rect.height / 2;
this.textNode.transform(new TranslateMatrix(xshift, yshift),
new TranslateMatrix(-xshift, -yshift));
this.textNode.format(ctx, request);
}
};
PathNode.prototype.formatArrow = function () {
this.hasArrow = this.properties["arrowSize"] > 0 &&
!this.properties["closed"] && this.segments.length > 0;
if (!this.hasArrow) {
return;
}
var finalSegment = this.segments[this.segments.length - 1];
var endPoint = finalSegment.to;
var directionVector = finalSegment.endSlope();
var arrowSize = this.properties["arrowSize"];
var smoothness = this.properties["smoothness"];
var x1, y1;
var x2, y2;
x1 = endPoint.x - directionVector.x * arrowSize;
y1 = endPoint.y - directionVector.y * arrowSize;
x2 = x1 + directionVector.y * arrowSize / 2;
y2 = y1 - directionVector.x * arrowSize / 2;
x1 += -directionVector.y * arrowSize / 2;
y1 += directionVector.x * arrowSize / 2;
this.segments.push(new MoveSegment(finalSegment, new Point(x1, y1)));
this.segments.push(new CurveSegment(
this.segments[this.segments.length - 1],
endPoint, smoothness));
this.segments.push(new CurveSegment(
this.segments[this.segments.length - 1],
new Point(x2, y2), smoothness));
};
PathNode.prototype.close = function () {
var commands = this.properties["commands"];
commands.push(PathNode.CLOSE);
};
PathNode.prototype.autoclose = function () {
var seg = this.segments[this.segments.length - 1];
if (CalcLineLength(seg.to.x, seg.to.y, this.origin.x, this.origin.y) <= 8) {
this.close();
}
};
PathNode.prototype._draw = function (ctx) {
var matrix = this.properties["inverse"];
ctx.save();
ctx.lineJoin = "round";
ctx.transform(matrix.m11, matrix.m21, matrix.m12,
matrix.m22, matrix.dx, matrix.dy);
ctx.beginPath();
ctx.lineCap = 'round';
ctx.joinCap = 'round';
for (var i = 0; i < this.segments.length; i++) {
this.segments[i].draw(ctx);
}
if (this.properties["closed"]) {
ctx.closePath();
ctx.fill();
ctx.shadowColor = "rgba(0,0,0,0.0)";
}
if (this.properties["lineWidth"] > 0) {
ctx.stroke();
}
if (SHOW_LINES && this.points.length > 0) {
ctx.shadowColor = "rgba(0,0,0,0.0)";
ctx.beginPath();
ctx.moveTo(this.points[0].x, this.points[0].y);
for (i = 1; i < this.points.length; i++) {
ctx.lineTo(this.points[i].x, this.points[i].y);
}
ctx.lineWidth = 1.0;
ctx.strokeStyle = "#ff0000";
ctx.stroke();
ctx.beginPath();
ctx.moveTo(this.points[0].x, this.points[0].y);
for (i = 1; i < this.points.length; i++) {
ctx.rect(this.points[i].x - 4, this.points[i].y - 4, 8, 8);
}
ctx.lineWidth = 1;
ctx.fillStyle = "#a0a0e0";
ctx.fill();
}
if (SHOW_CONTROL_POINTS && this.segments.length > 0) {
ctx.shadowColor = "rgba(0,0,0,0.0)";
ctx.beginPath();
for (i = 0; i < this.segments.length; i++) {
this.segments[i].drawControls(ctx);
}
ctx.strokeStyle = "#800000";
ctx.lineWidth = 0.5;
ctx.stroke();
}
if (this.properties["closed"]) {
this.textNode.draw(ctx);
}
ctx.restore();
};
PathNode.prototype.hittest = function (x, y) {
var radius = 8;
if (x >= this.rect.x - radius && x < this.rect.x + radius + this.rect.width &&
y >= this.rect.y - radius && y < this.rect.y + radius + this.rect.height) {
if (this.properties["closed"]) {
if (PointInPolygon(this.points, x, y, radius)) {
return this;
}
} else if (PointNearPath(this.points, x, y, radius)) {
return this;
}
}
return null;
};
PathNode.prototype.calcPoints = function (resolution) {
var points = [];
for (var i = 0; i < this.segments.length; i++) {
this.segments[i].outline(points, resolution);
}
return points;
};
PathNode.prototype.lineTo = function (x, y) {
var commands = this.properties["commands"];
commands.push(PathNode.LINE_TO);
commands.push(x);
commands.push(y);
};
PathNode.prototype.curveTo = function (x, y) {
var commands = this.properties["commands"];
commands.push(PathNode.CURVE_TO);
commands.push(x);
commands.push(y);
};
PathNode.prototype.hasEditMode = function () {
return this.properties["editable"] !== false;
};
PathNode.prototype.hitTestEditHandle = function (x, y, scale) {
var r = 8.0 * scale;
if (x >= this.origin.x - r && x < this.origin.x + r &&
y >= this.origin.y - r && y < this.origin.y + r) {
return 0;
}
var num = this.properties["closed"] ? this.segments.length - 1 :
this.segments.length;
if (this.hasArrow) {
num -= 3;
}
for (var i = 0; i < num; i++) {
if (x >= this.segments[i].to.x - r && x < this.segments[i].to.x + r &&
y >= this.segments[i].to.y - r && y < this.segments[i].to.y + r) {
return i;
}
}
return null;
};
PathNode.prototype.drawEditHandles = function (ctx, scale) {
ctx.save();
ctx.lineWidth = 1.0 * scale;
ctx.strokeStyle = "#0050B7";
var r = 4.0 * scale;
ctx.strokeRect(this.origin.x - r, this.origin.y - r, r * 2, r * 2);
var num = this.segments.length;
if (this.properties["closed"]) {
num -= 1;
}
if (this.hasArrow) {
num -= 3;
}
for (var i = 1; i < num; i++) {
ctx.strokeRect(this.segments[i].to.x - r, this.segments[i].to.y - r,
r * 2, r * 2);
}
ctx.restore();
};
Inherit(BaseNode.prototype, PathNode.prototype);
function PathCommands(commands) {
this.init(commands);
}
PathCommands.prototype = {
init: function (commands) {
if (commands === undefined) {
this.commands = [];
} else {
this.commands = commands;
}
},
change: function (index, x, y) {
var pos = 0;
for (var i = 0; i < index; i++) {
pos += PathNode.CommandLengths[this.commands[pos]] + 1;
}
this.commands[pos + 1] = x;
this.commands[pos + 2] = y;
},
moveTo: function (x, y) {
this.commands.push(PathNode.MOVE_TO);
this.commands.push(x);
this.commands.push(y);
},
lineTo: function (x, y) {
this.commands.push(PathNode.LINE_TO);
this.commands.push(x);
this.commands.push(y);
},
curveTo: function (x, y) {
this.commands.push(PathNode.CURVE_TO);
this.commands.push(x);
this.commands.push(y);
},
quadraticTo: function (cx, cy, x, y) {
this.commands.push(PathNode.QUADRATIC_TO);
this.commands.push(x);
this.commands.push(y);
this.commands.push(cx);
this.commands.push(cy);
},
cornerTo: function (cx, cy, x, y) {
this.commands.push(PathNode.CORNER_TO);
this.commands.push(x);
this.commands.push(y);
this.commands.push(cx);
this.commands.push(cy);
},
bezierTo: function (c1x, c1y, c2x, c2y, x, y) {
this.commands.push(PathNode.BEZIER_TO);
this.commands.push(x);
this.commands.push(y);
this.commands.push(c1x);
this.commands.push(c1y);
this.commands.push(c2x);
this.commands.push(c2y);
},
arcTo: function (x1, y1, x2, y2, radius) {
this.commands.push(PathNode.ARC_TO);
this.commands.push(x2);
this.commands.push(y2);
this.commands.push(x1);
this.commands.push(y1);
this.commands.push(radius);
},
close: function () {
this.commands.push(PathNode.CLOSE);
},
toArray: function () {
return this.commands;
}
};
function CreatePolygonPath(centre, corners, outerRadius, innerRadius) {
var outer = true;
var commands = new PathCommands();
var angle = Math.PI / corners + Math.PI;
var startx = 0;
var starty = 0;
for (var i = 0; i < corners; i++) {
var radius = outer ? outerRadius : innerRadius;
var x = centre.x - Math.sin(angle) * radius;
var y = centre.y - Math.cos(angle) * radius;
if (i === 0) {
commands.moveTo(x, y);
startx = x;
starty = y;
} else {
commands.lineTo(x, y);
}
angle += 2 * Math.PI / corners;
outer = !outer;
}
commands.lineTo(startx, starty);
commands.close();
return commands.toArray();
}
function CreateCirclePath(center, radius) {
var commands = new PathCommands();
commands.moveTo(center.x, center.y - radius);
commands.cornerTo(center.x + radius, center.y - radius,
center.x + radius, center.y);
commands.cornerTo(center.x + radius, center.y + radius,
center.x, center.y + radius);
commands.cornerTo(center.x - radius, center.y + radius,
center.x - radius, center.y);
commands.cornerTo(center.x - radius, center.y - radius,
center.x, center.y - radius);
commands.close();
return commands.toArray();
}
var DrawFreeformBehaviour = function (view, previousBehaviour) {
this.view = view;
this.previousBehaviour = previousBehaviour;
this.view.setHintText("Hold down the button to draw");
this.view.canvas.style.cursor = "crosshair";
this.dragging = false;
this.points = [];
};
DrawFreeformBehaviour.prototype.log = log.create("Freeform");
DrawFreeformBehaviour.prototype.onMouseDown = function (x, y) {
this.dragging = true;
this.view.setHintText(null);
return this.points.push(new Point(x, y));
};
DrawFreeformBehaviour.prototype.onMouseUp = function (x, y) {
var commands, i, node, path;
this.onMouseMove(x, y);
this.dragging = false;
this.log("Points=%s", "" + this.points);
path = GenerateCurvesFromPoints(this.points, 8);
node = new PathNode(this.view.doc.getNextId());
commands = path.commands;
i = 0;
while (i < commands.length) {
if (commands[i] === PathData.MOVE) {
node.moveTo(commands[i + 1], commands[i + 2]);
this.log("MoveTo: %s, %s", commands[i + 1], commands[i + 2]);
} else if (commands[i] === PathData.BEZIER_CURVE) {
node.bezierTo(commands[i + 1], commands[i + 2], commands[i + 3], commands[i + 4], commands[i + 5], commands[i + 6]);
this.log("CurveTo: %s, %s, %s, %s, %s, %s", commands[i + 1], commands[i + 2], commands[i + 3], commands[i + 4], commands[i + 5], commands[i + 6]);
} else {
this.log("Unknown command %s", commands[i]);
}
i += PathData.SizeOf[commands[i]];
}
node.format(this.view.ctx, this.view.request);
node.autoclose();
this.view.commit([
new CreateAction("PathNode", {
"commands": node.getProperty("commands"),
"seed": node.getProperty("seed"),
"fillStyle": this.view.defaultFillStyle,
"strokeStyle": this.view.defaultStrokeStyle,
"lineWidth": this.view.defaults["lineWidth"]
})
]);
return this.exit();
};
DrawFreeformBehaviour.prototype.onMouseMove = function (x, y) {
if (this.dragging) {
this.from = this.points[this.points.length - 1];
if (x !== this.from.x || y !== this.from.y) {
this.points.push(new Point(x, y));
this.to = this.points[this.points.length - 1];
this.view.ctx.beginPath();
this.view.ctx.moveTo(this.from.x, this.from.y);
this.view.ctx.lineTo(this.to.x, this.to.y);
this.view.ctx.strokeStyle = "black";
this.view.ctx.lineWidth = 1;
return this.view.ctx.stroke();
}
}
};
DrawFreeformBehaviour.prototype.exit = function () {
this.view.behaviour = this.previousBehaviour;
this.view.canvas.style.cursor = "default";
this.view.setHintText(null);
return this.view.draw();
}; ;
function DrawLinesBehaviour(view, isCurves, hasArrow) {
this.view = view;
this.node = null;
this.isCurves = isCurves;
this.hasArrow = hasArrow;
}
DrawLinesBehaviour.prototype = {
enter: function () {
this.numPoints = 0;
this.view.canvas.style.cursor = "crosshair";
this.view.setHintText("Click to place first point of line");
this.view.draw();
this.oldId = this.view.doc.peekNextId();
this.lastPoint = new Point(0, 0);
this.node = null;
},
reset: function () {
this.enter();
},
onTouch: function (e) {
var touch, pt;
if (e.type === 'touchstart') {
touch = e.changedTouches[0];
pt = this.view.screenPoint(touch.pageX, touch.pageY);
if (pt.distanceTo(this.lastPoint) > 10) {
this.onMouseClick(pt.x, pt.y);
} else {
this.onMouseClick(pt.x, pt.y);
this.onMouseClick(pt.x, pt.y);
this.onDoubleClick(pt.x, pt.y);
}
} else if (e.type === 'touchmove') {
touch = e.changedTouches[0];
pt = this.view.screenPoint(touch.pageX, touch.pageY);
this.onMouseMove(pt.x, pt.y);
}
},
onKeyCommand: function (action, e) {
if (action === "cancel") {
if (this.node !== null && this.view.isKeyboardCursorShown &&
this.isCurves && !this.hasArrow) {
this.commit();
}
if (this.node !== null) {
this.view.doc.removeNode(this.node);
this.view.doc.setNextId(this.oldId);
}
if (this.view.isKeyboardCursorShown()) {
this.view.eventSource.emit("goto-toolbar");
} else {
this.view.pickTool();
}
}
},
addPoint: function (x, y) {
if (this.isCurves) {
this.node.curveTo(x, y);
} else {
this.node.lineTo(x, y);
}
},
onMouseClick: function (x, y) {
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
if (this.node === null) {
this.node = new PathNode(this.view.doc.getNextId());
this.node.setProperty("seed", Math.round(Math.random() * 65535)
);
this.node.setProperty("strokeStyle", this.view.defaultStrokeStyle
);
this.node.setProperty("lineWidth", this.view.defaults["lineWidth"]
);
this.node.setProperty("sloppiness", this.view.defaults["sloppiness"]
);
this.node.setProperty("smoothness", this.view.defaults["smoothness"]
);
this.view.doc.addNode(this.node);
if (this.hasArrow) {
this.node.setProperty("arrowSize",
this.view.defaults["arrowSize"]);
}
this.node.moveTo(x, y);
this.addPoint(x, y);
this.index = 1;
this.view.setHintText("Click to place another point, or double-click to end the line");
this.view.update();
this.numPoints = 2;
var self = this;
$(this.view.canvas).mouseleave(function (e) {
console.log('Mouse Leave on canvas called !!');
if (self && self.node && typeof self.commit == 'function') {
self.commit();
self.view.pickTool();
}
e.preventDefault();
});
} else {
if (this.view.isKeyboardCursorShown() && (!this.isCurves ||
this.hasArrow)) {
this.commit();
this.view.pickTool();
this.view.eventSource.emit("goto-toolbar");
} else {
this.addPoint(x, y);
this.numPoints++;
this.index += 1;
this.view.doc.markRedraw(this.node.id);
this.view.update();
}
}
this.lastPoint.x = x;
this.lastPoint.y = y;
},
onMouseMove: function (x, y) {
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
if (this.node) {
this.node.moveEditHandle(this.index, x - this.lastPoint.x,
y - this.lastPoint.y);
this.node.format(this.view.ctx, this.view.request);
this.view.draw();
this.lastPoint.x = x;
this.lastPoint.y = y;
}
},
onDoubleClick: function (x, y) {
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
if (this.node && this.index > 1) {
var numPoints = this.index;
this.node.removePoint(numPoints);
this.node.removePoint(numPoints - 1);
this.commit();
}
this.reset();
this.view.pickTool();
},
commit: function () {
this.node.autoclose();
this.view.doc.removeNode(this.node);
this.view.doc.setNextId(this.oldId);
this.view.commit([
new CreateAction(
"PathNode", {
"arrowSize": this.hasArrow ?
this.view.defaults["arrowSize"] : 0,
"commands": this.node.getProperty("commands"),
"seed": this.node.getProperty("seed"),
"fillStyle": this.view.defaultFillStyle,
"strokeStyle": this.view.defaultStrokeStyle,
"lineWidth": this.view.defaults["lineWidth"],
"sloppiness": this.view.defaults["sloppiness"],
"smoothness": this.view.defaults["smoothness"],
"shadow": this.view.defaults["shadow"],
"isTextEditable": false
})
]);
this.node = null;
},
leave: function () {
this.view.canvas.style.cursor = "default";
this.view.setHintText(null);
if (this.node) {
this.commit();
}
this.view.draw();
$(this.view.canvas).unbind('mouseleave');
},
onColourClicked: function (e) {
var property;
if (e.button === 1) {
this.view.defaultFillStyle = e.colour;
this.view.defaultBrushStyle = e.colour;
property = "fillStyle";
} else {
this.view.defaultStrokeStyle = e.colour;
property = "strokeStyle";
}
this.view.setProperty(property, e.colour);
}
};
function MoveEditNodeBehaviour(view, node, handle, x, y) {
this.view = view;
this.node = node;
this.handle = handle;
this.onMouseDown(x, y);
}
MoveEditNodeBehaviour.prototype = {
onTouch: function (e) {
var touch, pt;
if (e.type === "touchmove") {
touch = e.touches[0];
pt = this.view.screenPoint(touch.pageX, touch.pageY);
this.onMouseMove(pt.x, pt.y);
} else if (e.type === "touchend") {
touch = e.changedTouches[0];
pt = this.view.screenPoint(touch.pageX, touch.pageY);
this.onMouseUp(pt.x, pt.y);
}
},
onMouseDown: function (x, y) {
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
this.startX = x;
this.startY = y;
this.prevX = x;
this.prevY = y;
},
onMouseMove: function (x, y) {
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
this.node.moveEditHandle(this.handle, x - this.prevX, y - this.prevY);
this.node.format(this.view.ctx, this.view.request);
this.view.draw();
this.prevX = x;
this.prevY = y;
},
onMouseUp: function (x, y) {
var pt = this.view.snap(new Point(x, y));
x = pt.x;
y = pt.y;
if (x !== this.startX || y !== this.startY) {
this.view.commit([
new MoveEditHandleAction(this.node.id, this.handle,
x - this.startX, y - this.startY)],
this.view.doc.peekNextId());
} else {
}
this.view.draw();
this.view.setBehaviour(new DefaultBehaviour(this.view));
}
};
function Overlay(colour, left, top, width, height) {
this.colour = colour || "transparent";
this.left = left || 0;
this.top = top || 0;
this.width = width || $(window).width();
this.height = height || $(window).height();
}
Overlay.prototype.hide = function () {
this.div.remove();
};
Overlay.prototype.show = function (clickfn) {
this.div = $("<div>");
var body = $(window);
this.div.css("position", "fixed");
this.div.css("background", this.colour);
this.div.css("opacity", "0.25");
this.div.css("left", "" + this.left + "px");
this.div.css("top", "" + this.top + "px");
this.div.css("z-index", "1");
this.div.css("width", "" + this.width + "px");
this.div.css("height", "" + this.height + "px");
this.div.css("display", "none");
this.div.click(function (e) {
clickfn(e);
});
$("body").append(this.div);
this.div.fadeIn("normal");
};
function Menubar(menu, eventSource, popup) {
this.init(menu, eventSource, popup);
}
Menubar.HilightColour = "#ff9900";
Menubar.ClickColour = "#ffffff";
Menubar.BackgroundColour = "#ccc";
Menubar.prototype.log = log.create("Menubar");
Menubar.prototype.init = function (menu, eventSource, popup) {
this.initPanel($("<div>"));
this.popup = popup;
this.div.css("position", "absolute");
this.div.css("background", Menubar.BackgroundColour);
this.div.css("font-family", "tahoma,helvetica,arial,sans");
this.div.css("font-size", "12px");
this.div.css("padding", "0.5em");
this.div.css("cursor", "default");
this.div.css("MozUserSelect", "none");
this.div[0].onselectstart = function () { return false; };
if (popup) {
this.div.css("background", "white");
this.div.css("border-left", "1px solid #ccc");
this.div.css("border-bottom", "1px solid #888");
this.div.css("border-right", "1px solid #888");
this.div.css("box-shadow", "3px 3px 5px #ccc");
}
this.menu = menu;
this.eventSource = eventSource;
for (var i = 0; i < menu.items.length; i++) {
var item = menu.items[i];
this._append(item);
}
this.overlay = null;
this.currentlyShownMenu = null;
this.div.css("z-index", 3001);
};
Menubar.prototype._append = function (item) {
var div;
var self = this;
if (!this.popup) {
if (item.type === "separator") {
return;
}
if (item.display.length > 6 && item.display.substr(0, 6) === "image:") {
div = $("<img>");
div.attr("src", item.display.substr(6));
div.load(function () {
self.eventSource.emit("resize", {});
});
div.css("border", "1px solid #888");
div.css("box-shadow", "3px 3px 3px #000");
div.css("border-radius", "5px");
div.css("vertical-align", "middle");
div.css("margin-left", "0.5em");
div.css("margin-right", "0.5em");
div.hover(
function () {
div.css("background", Menubar.HilightColour);
div.css("color", "white");
},
function () {
div.css("background", "transparent");
div.css("color", "black");
}
);
this.div.append(div);
} else {
div = $("<div>");
div.css("display", "inline");
div.css("padding-left", "0.5em");
div.css("padding-right", "0.5em");
div.css("padding-top", "0.5em");
div.css("padding-bottom", "0.5em");
div.css("MozUserSelect", "none");
div[0].onselectstart = function () { return false; };
div.css("vertical-align", "middle");
div.text(item.display);
div.hover(
function () {
div.css("background", Menubar.HilightColour);
},
function () {
div.css("background", "transparent");
}
);
}
if (item.type === "menu") {
div.mousedown(function () {
var offset = div.offset();
self.showMenu(item, offset.left,
offset.top + div.outerHeight());
});
} else {
div.click(function () {
self.eventSource.emit(item.event, {});
});
}
this.div.append(div);
} else {
if (item.type === "separator") {
div = $("<hr>");
this.div.append(div);
return;
}
div = $("<div>");
div.css("padding-left", "0.5em");
div.css("padding-right", "0.5em");
div.text(item.display);
div.hover(
function () {
div.css("background", Menubar.HilightColour);
},
function () {
div.css("background", "transparent");
}
);
div.mouseup(function () {
if (self.clickfn) {
self.clickfn();
}
self.eventSource.emit(item.event, item.eventData);
});
this.div.append(div);
}
};
Menubar.prototype.click = function (clickfn) {
this.clickfn = clickfn;
};
Menubar.prototype.hideActive = function () {
if (this.currentlyShownMenu) {
this.currentlyShownMenu.destroy();
this.currentlyShownMenu = null;
}
if (this.overlay) {
this.overlay.hide();
this.overlay = null;
}
};
Menubar.prototype.showMenu = function (item, x, y) {
if (this.currentlyShownMenu && this.currentlyShownMenu.menu === item.menu) {
this.hideActive();
return;
}
this.hideActive();
var top = $(this.div).offset().top + this.height();
var overlay = new Overlay("transparent", 0, top);
var menu;
var self = this;
var hidefn = function (e) {
self.hideActive();
};
overlay.show(hidefn);
menu = new Menubar(item.menu, this.eventSource, true);
menu.click(hidefn);
menu.moveTo(x, y);
this.currentlyShownMenu = menu;
this.overlay = overlay;
};
Inherit(Panel.prototype, Menubar.prototype);
var Dialog = function (name) {
this.name = name;
EventEmitter.apply(this, arguments);
if (typeof this.name === "string") {
this.div = $("#" + this.name);
} else {
this.div = $("<div>").addClass("dialog");
$(document.body).append(this.div);
this.div.css("z-index", "2");
}
this.overlay = null;
};
__extends(Dialog, EventEmitter);
Dialog.prototype.log = log.create("Dialog");
Dialog.prototype.show = function () {
if (Dialog._current) {
Dialog._current.hide();
}
this.log("Set Dialog.current");
Dialog._current = this;
this.overlay = new Overlay("black");
this.overlay.show(__bind(function () {
return this.hide();
}, this));
this.onResize();
this.div.slideDown("fast");
return this.on("cancel", __bind(function () {
return this.hide();
}, this));
};
Dialog.prototype.onResize = function () {
var winHeight, winWidth;
winWidth = $(window).width();
winHeight = $(window).height();
this.div.css("left", "" + (winWidth / 2 - this.div.outerWidth() / 2) + "px");
return this.div.css("top", "" + (winHeight / 2 - this.div.outerHeight() / 2) + "px");
};
Dialog.prototype.hide = function () {
if (Dialog._current === this) {
this.overlay.hide();
this.div.hide();
Dialog._current = null;
return this.log("Clear Dialog.current");
}
}; ;
Dialog._current = null;
Dialog.emit = function () {
var args;
args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
if (Dialog._current) {
Dialog._current.emit.apply(Dialog._current, args);
}
};
Dialog.current = function () {
return Dialog._current;
};
$(document).keydown(function (e) {
if (Dialog._current !== null && e.keyCode === 27) {
return Dialog._current.emit("cancel");
}
});
$(window).resize(function () {
if (Dialog._current) {
return Dialog._current.onResize();
}
});
var editTextDialog = (function () {
var _dialog;
function getDialog() {
return _dialog || createDialog();
}
function createDialog() {
var dialogHtml = '\
<div id="editTextDialog"> \
<div class="hd title"></div> \
<div class="bd"> \
<input type="text"></input> \
</div> \
</div>';
var dialog = $(dialogHtml)[0];
document.body.appendChild(dialog);
_dialog = new YAHOO.widget.Dialog(dialog, {
modal: true,
visible: false,
draggable: false,
close: false,
postmethod: 'none',
width: 'auto'
});
_dialog.renderEvent.subscribe(function () {
this.element.style.marginLeft = -this.element.offsetWidth / 2 + 'px';
});
return _dialog;
}
return function (title, value, onOk) {
var dialog = getDialog(),
$input = $(dialog.body).find('input');
dialog.header.innerHTML = title;
$input.val(value);
var handleOk = function () {
var value = $input.val();
this.hide();
onOk(value);
};
var handleCancel = function () {
this.hide();
};
dialog.cfg.queueProperty("buttons", [
{ text: 'OK', handler: handleOk, isDefault: true },
{ text: 'Cancel', handler: handleCancel }
]);
dialog.render();
dialog.show();
$input.focus().select();
};
})();
function DefaultBehaviour(view) {
this.init(view);
}
DefaultBehaviour.prototype = {
init: function (view) {
this.view = view;
this.view.setHintText("");
this.useTouch = this.view.config.useTouch();
this.scaleTouchRadius = 1.0;
if (this.useTouch) {
this.scaleTouchRadius = 2.0;
}
},
log: log.create("DefaultBehaviour"),
enter: function () {
this.log("Entering pick tool.");
},
leave: function () {
this.log("Leaving pick tool.");
},
onTouch: function (e) {
for (var i = 0; i < e.touches.length; i++) {
var touch = e.touches[i];
var point = this.view.screenPoint(touch.pageX, touch.pageY);
if (e.type === "touchstart") {
this.handleTouchStart(point.x, point.y, e);
} else if (e.type === "touchend") {
this.onMouseUp(point.x, point.y);
}
}
},
handleTouchStart: function (x, y, e) {
this.onMouseDown(x, y, e);
},
onMouseDown: function (x, y, e) {
this.log("onMouseDown");
var dir = this.view.getHandleUnderPoint(x, y);
if (dir) {
this.view.setBehaviour(new TransformSelectionBehaviour(this.view,
this, dir, false, x, y));
return;
}
if (this.view.selection.length &&
this.view.selectionBounds.containsPoint(x, y)) {
this.view.setBehaviour(new TransformSelectionBehaviour(this.view,
this, -1, true, x, y));
return;
}
var node;
var handle;
if (this.view.editNode) {
node = this.view.editNode;
handle = node.hitTestEditHandle(x, y, 1.0 / this.view.scale *
this.scaleTouchRadius);
if (handle !== null) {
this.view.setBehaviour(new MoveEditNodeBehaviour(this.view,
node, handle, x, y));
return;
}
}
node = this.view.doc.hittest(x, y);
if (node) {
var wasEditNode = node === this.view.editNode;
var wasSelected = this.view.isNodeSelected(node);
this.log("wasEditNode: %s, wasSelected: %s", wasEditNode,
wasSelected);
if (!wasSelected) {
this.view.clearSelection();
this.view.addToSelection(node);
this.view.doneSelecting();
this.view.draw();
}
this.view.setBehaviour(new TransformSelectionBehaviour(
this.view, this, -1, !wasEditNode && wasSelected, x, y));
} else {
this.view.setEditNode(null);
this.view.setBehaviour(new SelectBoxBehaviour(this.view, this, x,
y));
}
},
onMouseUp: function (x, y) {
this.log("onMouseUp");
},
onKeyCommand: function (action, e) {
this.log("keyboard: %s", action);
var handled = true;
switch (action) {
case "bring-to-front":
this.view.eventSource.emit("menu.bringToFront", {});
break;
case "send-to-back":
this.view.eventSource.emit("menu.sendToBack", {});
break;
case "left":
if (!this.view.nudgeSelection(-1, 0)) {
this.view.translateX = Math.min(this.view.translateX + 16,
0);
this.view.draw();
}
break;
case "right":
if (!this.view.nudgeSelection(1, 0)) {
this.view.translateX = Math.max(
-(this.view.canvas.width * this.view.scale -
this.view.canvas.width),
this.view.translateX - 16);
this.view.draw();
}
break;
case "up":
if (!this.view.nudgeSelection(0, -1)) {
this.view.translateY = Math.min(this.view.translateY + 16,
0);
this.view.draw();
}
break;
case "down":
if (!this.view.nudgeSelection(0, 1)) {
this.view.translateY = Math.max(
-(this.view.canvas.height * this.view.scale -
this.view.canvas.height),
this.view.translateY - 16);
this.view.draw();
}
break;
case "select-none":
this.view.clearSelection();
this.view.doneSelecting();
this.view.draw();
if (this.view.isKeyboardCursorShown()) {
this.view.eventSource.emit("goto-toolbar");
}
break;
case "duplicate":
this.view.eventSource.emit("menu.duplicate", {});
break;
case "move-up":
this.view.eventSource.emit("menu.moveUp", {});
break;
case "move-down":
this.view.eventSource.emit("menu.moveDown", {});
break;
case "delete":
this.view.eventSource.emit("menu.delete", {});
break;
case "curve-tool":
this.view.curveTool();
break;
case "line-tool":
this.view.lineTool();
break;
case "group":
this.view.eventSource.emit("menu.group", {});
break;
case "ungroup":
this.view.eventSource.emit("menu.ungroup", {});
break;
case "undo":
this.view.eventSource.emit("menu.undo", {});
break;
case "redo":
this.view.eventSource.emit("menu.redo", {});
break;
case "cut":
this.view.eventSource.emit("menu.cut", {});
break;
case "copy":
this.view.eventSource.emit("menu.copy", {});
break;
case "paste":
this.view.eventSource.emit("menu.paste", {});
break;
case "zoom-1-1":
this.view.scale = 1;
this.view.translateX = 0;
this.view.translateY = 0;
this.view.draw();
break;
case "zoom-in":
this.view.scale = this.view.scale * 1.1;
this.view.draw();
break;
case "zoom-out":
this.view.scale = this.view.scale / 1.1;
this.view.draw();
break;
default:
handled = false;
}
if (handled) {
e.preventDefault();
e.stopPropagation();
}
},
onColourClicked: function (e) {
var property;
if (e.button === 1) {
this.view.defaultFillStyle = e.colour;
this.view.defaultBrushStyle = e.colour;
property = "fillStyle";
} else {
this.view.defaultStrokeStyle = e.colour;
property = "strokeStyle";
}
this.view.setProperty(property, e.colour);
},
onDoubleClick: function (x, y) {
this.log("onDoubleClick");
var node = this.view.doc.hittest(x, y);
if (node && node.hasText()) {
var isEditable = node.getProperty("isTextEditable");
if (isEditable) {
var oldValue = node.getProperty("text"),
self = this;
editTextDialog("Enter new text:", oldValue, function (value) {
if (value !== null && value !== oldValue) {
self.changeText(node, value);
}
});
}
}
if (node && node.hasData()) {
this.view.zwibblerContext.app.startMathEditor(node.id);
}
if (node && node.type() == "TextNode") {
this.view.setBehaviour(new DrawTextBehaviour(this.view));
this.view.behaviour.onMouseDown(x, y);
}
this.log("hittest: %s, hasText: %s",
node !== null, node !== null && node.hasText());
},
changeText: function (node, text) {
if (text === node.getProperty("text")) {
return;
}
this.view.commit([new SetAction([node.id], "text", text)]);
}
};
var assert, assertArray, assertArrayOf, assertInstanceOf, assertNumber, assertString, isarray, isnumber, isstring;
assert = null;
assert = function (condition, message) {
if (message == null) {
message = "Assertion failed";
}
if (!condition) {
throw message;
}
};
assertInstanceOf = function (fn, arg) {
return assert(arg instanceof fn);
};
assertArray = function (arg) {
return assert(Object.prototype.toString.apply(arg) === '[object Array]');
};
assertArrayOf = function (fn, arg) {
return assert(arg.length === 0 || arg[0] instanceof fn);
};
assertString = function (arg) {
return assert(typeof arg === 'string', "Expected a string");
};
assertNumber = function (arg) {
return assert(typeof arg === 'number', "Expected a number");
};
isarray = function (arg) {
return typeof arg === 'object' && Object.prototype.toString.apply(arg) === '[object Array]';
};
isstring = function (arg) {
return typeof arg === 'string';
};
isnumber = function (arg) {
return typeof arg === 'number';
};
var Set = function () {
this.keys = {};
this.length = 0;
};
Set.prototype.contains = function (key) {
return key in this.keys;
};
Set.prototype.add = function (arg) {
var key, _i, _len, _ref, _results;
if ((_ref = typeof arg) === "string" || _ref === "number") {
if (!(arg in this.keys)) {
this.keys[arg] = true;
return this.length += 1;
}
} else if (typeof arg === "object" && Object.prototype.toString.apply(arg) === '[object Array]') {
_results = [];
for (_i = 0, _len = arg.length; _i < _len; _i++) {
key = arg[_i];
_results.push(!(arg in this.keys) ? (this.keys[arg] = true, this.length += 1) : void 0);
}
return _results;
} else {
return assert(false, "Arg must be an array");
}
};
Set.prototype.remove = function (key) {
return delete this.keys[key];
};
Set.prototype.intersect = function (other) {
var key, result;
assertInstanceOf(Set, other);
result = new Set();
for (key in this.keys) {
if (other.contains(key)) {
result.add(key);
}
}
return result;
};
Set.prototype.unionWith = function (other) {
var key, _results;
assertInstanceOf(Set, other);
_results = [];
for (key in other.keys) {
_results.push(this.add(key));
}
return _results;
};
Set.prototype.toArray = function () {
var key, _results;
_results = [];
for (key in this.keys) {
_results.push(key);
}
return _results;
};
Set.prototype.toMap = function () {
return this.keys;
};
Set.prototype.clear = function () {
this.keys = {};
}; ;
var TransformNode;
var Action = function () { };
Action.prototype.rename = function (replacer) {
var i, _ref, _results;
if (this.id !== null && this.id !== undefined) {
this.id = replacer(this.id);
}
if ((this.ids !== null && this.ids !== undefined) && this.ids.length > 0) {
for (i = 0, _ref = this.ids.length - 1; 0 <= _ref ? i <= _ref : i >= _ref; 0 <= _ref ? i++ : i--) {
this.ids[i] = replacer(this.ids[i]);
}
}
};
Action.prototype.log = log.create("ACTION");
Action.prototype.getDependentIds = function (doc, set) {
var ids;
if (this.ids !== null) {
ids = this.ids.concat();
} else {
ids = [];
}
if (this.id !== null) {
ids.push(this.id);
}
return doc.closure(ids, set);
};
Action.prototype.getAffectedIds = function (doc, set) {
return this.getDependentIds(doc, set);
};
Action.prototype.toString = function () {
return "" + this._class + "()";
};
var CreateAction = function (type, properties) {
this.type = type;
this.properties = properties;
};
__extends(CreateAction, Action);
CreateAction.prototype._class = "CreateAction";
CreateAction.prototype.redo = function (doc) {
switch (this.type) {
case "TextNode":
this.node = new TextNode(doc.getNextId());
break;
case "PathNode":
this.node = new PathNode(doc.getNextId());
break;
case "ImageNode":
this.node = new ImageNode(doc.getNextId());
break;
case "BrushNode":
this.node = new BrushNode(doc.getNextId());
break;
case "MathNode":
this.node = new MathNode(doc.getNextId());
break;
case "DomNode":
this.node = new DomNode(doc.getNextId());
break;
}
if (!this.node) {
this.log("Bad node type: %s", this.type);
}
this.node.setProperties(this.properties);
return doc.addNode(this.node);
};
CreateAction.prototype.toString = function () {
return "" + this._class + "(" + this.type + ", " + (JSON.stringify(this.properties)) + ")";
};
CreateAction.prototype.undo = function (doc) {
return doc.removeNode(this.node);
};
CreateAction.prototype.getAffectedIds = function (doc, set) {
return set.add(doc.peekNextId());
};
var DeleteAction = function (ids) {
this.ids = ids;
this.old = [];
};
__extends(DeleteAction, Action);
DeleteAction.prototype._class = "DeleteAction";
DeleteAction.prototype.redo = function (doc) {
var id, node, _i, _len, _ref, _results;
this.old.length = 0;
_ref = this.ids;
_results = [];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
id = _ref[_i];
node = doc.getNode(id, false);
_results.push(this.old.push({
node: node,
parent: node.parent,
index: doc.removeNode(node)
}));
}
return _results;
};
DeleteAction.prototype.undo = function (doc) {
var old, _i, _len, _ref, _results;
if (this.old.length === 0) {
return;
}
_ref = this.old;
_results = [];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
old = _ref[_i];
_results.push(doc.addChild(old.parent, old.node, old.index));
}
return _results;
};
var SetAction = function (ids, name, value) {
this.ids = ids;
this.name = name;
this.value = value;
this.oldValues = [];
};
__extends(SetAction, Action);
SetAction.prototype._class = "SetAction";
SetAction.prototype.redo = function (doc) {
var id, node, _i, _len, _ref;
this.oldValues.length = 0;
_ref = this.ids;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
id = _ref[_i];
node = doc.getNode(id, true);
this.oldValues.push(node.getProperty(this.name));
node.setProperty(this.name, this.value);
}
};
SetAction.prototype.undo = function (doc) {
var i, node, _ref;
if (this.ids.length === 0) {
return;
}
for (i = 0, _ref = this.ids.length - 1; 0 <= _ref ? i <= _ref : i >= _ref; 0 <= _ref ? i++ : i--) {
node = doc.getNode(this.ids[i], true);
node.setProperty(this.name, this.oldValues[i]);
}
};
var TransformAction = function (ids, matrix, inverse) {
this.ids = ids;
this.matrix = matrix;
this.inverse = inverse;
};
__extends(TransformAction, Action);
TransformAction.prototype._class = "TransformAction";
TransformAction.prototype.redo = function (doc) {
var id, node, _i, _len, _ref;
_ref = this.ids;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
id = _ref[_i];
node = doc.getNode(id, true);
node.transform(this.matrix, this.inverse);
}
};
TransformAction.prototype.undo = function (doc) {
var id, node, _i, _len, _ref;
_ref = this.ids;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
id = _ref[_i];
node = doc.getNode(id, true);
node.transform(this.inverse, this.matrix);
}
};
TransformAction.prototype.rename = function (replacer) {
var i, _ref;
if (this.ids.length === 0) {
return;
}
for (i = 0, _ref = this.ids.length - 1; 0 <= _ref ? i <= _ref : i >= _ref; 0 <= _ref ? i++ : i--) {
this.ids[i] = replacer(this.ids[i]);
}
};
var SetPathAction = function (id, commands) {
this.id = id;
this.commands = commands;
};
__extends(SetPathAction, Action);
SetPathAction.prototype._class = "SetPathAction";
SetPathAction.prototype.redo = function (doc) {
var node;
node = doc.getNode(this.id, true);
this.oldCommands = node.setPath(this.commands);
};
SetPathAction.prototype.redo = function (doc) {
var node;
node = doc.getNode(this.id, true);
node.setPath(this.oldCommands);
};
var MoveEditHandleAction = function (id, handle, offsetX, offsetY) {
this.id = id;
this.handle = handle;
this.offsetX = offsetX;
this.offsetY = offsetY;
};
__extends(MoveEditHandleAction, Action);
MoveEditHandleAction.prototype._class = "MoveEditHandleAction";
MoveEditHandleAction.prototype.redo = function (doc) {
var node;
node = doc.getNode(this.id, true);
return node.moveEditHandle(this.handle, this.offsetX, this.offsetY);
};
MoveEditHandleAction.prototype.undo = function (doc) {
var node;
node = doc.getNode(this.id, true);
return node.moveEditHandle(this.handle, -this.offsetX, -this.offsetY);
};
var GroupAction = function (ids) {
this.ids = ids;
this.old = [];
};
__extends(GroupAction, Action);
GroupAction.prototype._class = "GroupAction";
GroupAction.prototype.redo = function (doc) {
var id, node, _i, _len, _ref;
this.old.length = 0;
_ref = this.ids;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
id = _ref[_i];
node = doc.getNode(id);
this.old.push({
node: node,
parent: node.parent,
index: node.parent.findChildIndex(node)
});
}
this.node = doc.createGroup(this.ids);
};
GroupAction.prototype.undo = function (doc) {
var i, info, _ref;
if (this.ids.length === 0) {
return;
}
for (i = _ref = this.ids.length - 1; i >= 0; i += -1) {
if (i < 0) {
break;
}
info = this.old[i];
doc.addChild(info.parent, info.node, info.index);
}
return doc.removeNode(this.node);
};
GroupAction.prototype.getAffectedIds = function (doc, set) {
return set.add(doc.peekNextId());
};
GroupAction.prototype.toString = function () {
return "GroupAction(" + (JSON.stringify(this.ids)) + ")";
};
var UngroupAction = function (ids) {
this.ids = ids;
this.groups = [];
};
__extends(UngroupAction, Action);
UngroupAction.prototype._class = "UngroupAction";
UngroupAction.prototype.redo = function (doc) {
var child, id, info, node, nodesProcessed, _i, _j, _len, _len2, _ref, _ref2, _ref3;
nodesProcessed = [];
_ref = this.ids;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
id = _ref[_i];
node = doc.getNode(id);
if (!node.isGroup()) {
continue;
}
_ref2 = node.id;
if (__indexOf.call(nodesProcessed, _ref2) >= 0) {
continue;
}
nodesProcessed[node.id] = true;
info = {
node: node,
parent: node.parent,
children: node.children.concat(),
index: doc.removeNode(node)
};
this.groups.push(info);
_ref3 = info.children;
for (_j = 0, _len2 = _ref3.length; _j < _len2; _j++) {
child = _ref3[_j];
doc.addChild(info.parent, child, -1);
}
}
};
UngroupAction.prototype.undo = function (doc) {
var group, i, j, _ref, _ref2;
if (this.groups.length === 0) {
return;
}
for (i = _ref = this.groups.length - 1; i >= 0; i += -1) {
if (i < 0) {
break;
}
group = this.groups[i];
if (group.children.length === 0) {
continue;
}
for (j = _ref2 = group.children.length - 1; j >= 0; j += -1) {
if (j < 0) {
break;
}
doc.addChild(group.node, group.children[j], -1);
}
doc.addChild(group.parent, group.node, group.index);
}
doc.forceRenumber();
};
TransformNode = function (node, matrix, inverse) {
var child, _i, _len, _ref, _results;
if (node.isGroup()) {
_ref = node.children;
_results = [];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
child = _ref[_i];
_results.push(TransformNode(child, matrix, inverse));
}
return _results;
} else {
return node.transform(matrix, inverse);
}
};
var DuplicateAction = function (ids, offset) {
this.ids = ids;
this.offset = offset;
this.nodes = [];
};
__extends(DuplicateAction, Action);
DuplicateAction.prototype._class = "DuplicateAction";
DuplicateAction.prototype.redo = function (doc) {
var id, inverse, namer, node, xform, _i, _len, _ref;
xform = new TranslateMatrix(this.offset, this.offset);
inverse = xform.inverse();
this.nodes.length = 0;
namer = function () {
return doc.getNextId();
};
_ref = this.ids;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
id = _ref[_i];
node = (doc.getNode(id)).clone(namer);
TransformNode(node, xform, inverse);
doc.addNode(node);
this.nodes.push(node);
}
};
DuplicateAction.prototype.undo = function (doc) {
var i, _ref;
if (this.nodes.length === 0) {
return;
}
for (i = _ref = this.nodes.length - 1; i >= 0; i += -1) {
if (i < 0) {
break;
}
doc.removeNode(this.nodes[i]);
}
};
DuplicateAction.prototype.getAffectedIds = function (doc, set) {
var base, count, id, _ref;
base = doc.peekNextId();
count = (doc.closure(this.ids)).length;
for (id = base, _ref = count - 1; id <= _ref; id += 1) {
set.add(id);
}
};
var ChangeOrderAction = function (ids, type) {
this.ids = ids;
this.type = type;
this.nodes = [];
this.oldPositions = [];
};
__extends(ChangeOrderAction, Action);
ChangeOrderAction.prototype._class = "ChangeOrderAction";
ChangeOrderAction.prototype.redo = function (doc) {
var id, node, oldIndex, parent, _i, _len, _ref;
this.oldPositions.length = 0;
this.nodes.length = 0;
_ref = this.ids;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
id = _ref[_i];
node = doc.getNode(id);
parent = node.parent;
oldIndex = doc.removeNode(node);
this.oldPositions.push(oldIndex);
this.nodes.push(node);
switch (this.type) {
case ChangeOrderAction.BRING_TO_FRONT:
doc.addChild(parent, node, -1);
break;
case ChangeOrderAction.SEND_TO_BACK:
doc.addChild(parent, node, 0);
break;
case ChangeOrderAction.MOVE_DOWN:
if (oldIndex > 0) {
doc.addChild(parent, node, oldIndex - 1);
} else {
doc.addChild(parent, node, oldIndex);
}
break;
case ChangeOrderAction.MOVE_UP:
if (oldIndex < parent.children.length) {
doc.addChild(parent, node, oldIndex + 1);
} else {
doc.addChild(parent, node, oldIndex);
}
}
}
};
ChangeOrderAction.prototype.undo = function (doc) {
var i, node, parent, _ref;
if (this.ids.length === 0) {
return;
}
for (i = _ref = this.ids.length - 1; i >= 0; i += -1) {
if (i < 0) {
break;
}
node = this.nodes[i];
parent = node.parent;
doc.removeNode(node);
doc.addChild(parent, node, this.oldPositions[i]);
}
};
ChangeOrderAction.BRING_TO_FRONT = 0;
ChangeOrderAction.SEND_TO_BACK = 1;
ChangeOrderAction.MOVE_UP = 2;
ChangeOrderAction.MOVE_DOWN = 3;
var SetBackgroundAction = function (url) {
this.createAction = new CreateAction("ImageNode", {
"url": resolveUrl(decodeURIComponent(url)),
"locked": true
});
this.oldBackground = null;
};
__extends(SetBackgroundAction, Action);
SetBackgroundAction.prototype._class = "SetBackgroundAction";
SetBackgroundAction.prototype.redo = function (doc) {
this.oldBackground = doc.findBackground();
this.createAction.redo(doc);
doc.setBackground(this.createAction.node);
};
SetBackgroundAction.prototype.undo = function (doc) {
this.createAction.undo(doc);
if (this.oldBackground) {
doc.setBackground(this.oldBackground);
}
};
function ZwibblerView(canvas, doc, colourPanel, eventSource, config) {
this.init(canvas, doc, colourPanel, eventSource, config);
}
ZwibblerView.prototype = {
init: function (canvas, doc, colourPanel, eventSource, config) {
this.config = config;
this.scale = config.scale;
this.colourPanel = colourPanel;
this.eventSource = eventSource;
this.canvas = canvas[0];
this.ctx = this.canvas.getContext("2d");
this.zwibblerContext = null;
this.registerEvents();
this.initializeKeyboardCursor();
this.behaviour = null;
this.setBehaviour(new DefaultBehaviour(this));
this.propertyPanel = null;
var self = this;
this.request = new FormatRequest();
this.request.canvas = this.canvas;
this.request.getScale = function () {
return self.scale;
};
this.request.on("reformat", function (node) {
self.log("Node %s requests reformat", node.id);
if (self.doc.exists(node.id)) {
self.log("   Reformatting...");
self.doc.markRedraw(node.id);
self.update();
}
});
this.request.on("convert-dom-request", function (dataString, node) {
self.zwibblerContext.emit("convert-dom-request", dataString, node);
});
this.editNode = null;
this.HANDLE_RADIUS = 4;
this.RESIZE_RADIUS = 9;
if (this.config.useTouch()) {
this.HANDLE_TOUCH_RADIUS = this.HANDLE_RADIUS * 4;
} else {
this.HANDLE_TOUCH_RADIUS = this.HANDLE_RADIUS * 2;
}
this.NE = 1;
this.SE = 2;
this.SW = 3;
this.NW = 4;
this.ROT = 5;
this.eventSource.bind("menu.edit", function (e) {
if (self.propertyPanel) {
self.propertyPanel.resetOffset();
self.propertyPanel.show();
}
});
this.eventSource.bind("menu.undo", function (e) {
self.undo();
});
this.eventSource.bind("menu.redo", function (e) {
self.redo();
});
this.eventSource.bind("menu.copy", function (e) {
self.copy();
});
this.eventSource.bind("menu.cut", function (e) {
self.copy();
self.deleteAction();
});
this.eventSource.bind("menu.paste", function (e) {
self.paste();
});
this.eventSource.bind("menu.duplicate", function (e) {
self.duplicate();
});
this.eventSource.bind("menu.moveUp", function (e) {
self.moveUp();
});
this.eventSource.bind("menu.moveDown", function (e) {
self.moveDown();
});
this.eventSource.bind("menu.bringToFront", function (e) {
self.bringToFront();
});
this.eventSource.bind("menu.sendToBack", function (e) {
self.sendToBack();
});
this.eventSource.bind("menu.group", function (e) {
self.group();
});
this.eventSource.bind("menu.ungroup", function (e) {
self.ungroup();
});
this.eventSource.bind("menu.delete", function (e) {
self.deleteAction();
});
this.eventSource.bind("menu.outline-none", function (e) {
self.setProperty("lineWidth", 0);
});
this.eventSource.bind("menu.outline-pencil", function (e) {
self.setProperty("lineWidth", 1);
});
this.eventSource.bind("menu.outline-pen", function (e) {
self.setProperty("lineWidth", 2);
});
this.eventSource.bind("menu.outline-marker", function (e) {
self.setProperty("lineWidth", 4);
});
this.eventSource.bind("menu.shadow-none", function (e) {
self.setProperty("shadow", false);
});
this.eventSource.bind("menu.shadow", function (e) {
self.setProperty("shadow", true);
});
this.eventSource.bind("menu.font.FG Virgil", function (e) {
self.setProperty("fontName", "FG Virgil");
});
this.eventSource.bind("menu.font.Stinky Kitty", function (e) {
self.setProperty("fontName", "Stinky Kitty");
});
this.eventSource.bind("menu.font.Arial", function (e) {
self.setProperty("fontName", "Arial");
});
this.eventSource.bind("menu.font.Times New Roman", function (e) {
self.setProperty("fontName", "Times New Roman");
});
this.eventSource.bind("menu.sloppiness-draftsman", function (e) {
self.setProperty("sloppiness", 0.0);
});
this.eventSource.bind("menu.sloppiness-artist", function (e) {
self.setProperty("sloppiness", 0.25);
});
this.eventSource.bind("menu.sloppiness-Cartoonist", function (e) {
self.setProperty("sloppiness", 0.5);
});
this.eventSource.bind("menu.sloppiness-child", function (e) {
self.setProperty("sloppiness", 1.0);
});
this.eventSource.bind("menu.sloppiness-dizzy", function (e) {
self.setProperty("sloppiness", 2.0);
});
this.eventSource.bind("menu.insert.cylinder", function (e) {
var id = self.doc.peekNextId();
var commands = new PathCommands([]);
commands.moveTo(100, 100);
commands.lineTo(200, 100);
commands.lineTo(200, 200);
commands.cornerTo(200, 225, 150, 225);
commands.cornerTo(100, 225, 100, 200);
commands.lineTo(100, 100);
commands.close();
var circle = new PathCommands();
circle.moveTo(100, 100);
circle.cornerTo(100, 75, 150, 75);
circle.cornerTo(200, 75, 200, 100);
circle.cornerTo(200, 125, 150, 125);
circle.cornerTo(100, 125, 100, 100);
circle.close();
self.commit([
new CreateAction("PathNode",
{
"commands": commands.toArray()
}),
new CreateAction("PathNode",
{
"commands": circle.toArray()
}),
new GroupAction([id, id + 1])
]);
});
this.setDocument(doc);
},
log: log.create("VIEW"),
setDocument: function (doc) {
this.doc = doc;
this.translateX = 0;
this.translateY = 0;
this.selection = [];
this.editNode = null;
this.selectGeneration = 1;
this.selectionBounds = new Rectangle(0, 0, 0, 0);
this.selectHandleTransform = new Matrix();
this.enableRotationHandle = true;
this.rotHandleX = 0;
this.rotHandleY = 0;
this.hintText = "";
this.defaultFillStyle = "#ffffff";
this.defaultBrushStyle = this.config.getOption("defaultBrushColour");
this.defaultStrokeStyle =
this.config.getOption("defaultOutlineColour");
this.defaults = {};
this.defaults["lineWidth"] =
this.config.getDefaultOutlineThickness();
this.defaults["sloppiness"] = 0.5;
this.defaults["fontName"] = this.config.getOption("defaultFont");
this.defaults["fontSize"] = this.config.getOption("defaultFontSize");
this.defaults["arrowSize"] =
this.config.getDefaultArrowSize();
this.defaults["smoothness"] = 0.3;
this.defaults["textFillStyle"] =
this.config.getOption("defaultTextColour");
this.defaults["shadow"] = this.config.getOption("defaultShadow");
this.defaultBrushThickness = this.config.getDefaultBrushThickness();
this.doc.format(this.ctx, this.request);
this.draw();
},
setDefault: function (name, value) {
this.defaults[name] = value;
if (name === "fillStyle") {
this.defaultFillStyle = value;
} else if (name === "strokeStyle") {
this.defaultStrokeStyle = value;
}
},
screenPoint: function (pagex, pagey) {
var border = 4;
var offset = $(this.canvas).offset();
var x = (pagex - offset.left - border - this.translateX) / this.scale;
var y = (pagey - offset.top - border - this.translateY) / this.scale;
return this.snap(new Point(x, y));
},
documentPoint: function (docx, docy) {
var border = 4;
var offset = $(this.canvas).offset();
var x = docx * this.scale + this.translateX + offset.left + border;
var y = docy * this.scale + this.translateY + offset.top + border;
return new Point(x, y);
},
touchPoint: function (touch) {
return this.screenPoint(touch.pageX, touch.pageY);
},
onKeyCommand: function (action, e) {
if (this.handleKeyboardCursorKeys(action, e)) {
return;
}
if (this.behaviour.onKeyCommand) {
this.behaviour.onKeyCommand(action, e);
}
switch (action) {
case "send-to-back":
case "bring-to-front":
case "move-up":
case "move-down":
case "up":
case "down":
e.preventDefault();
e.stopPropagation();
break;
}
},
registerEvents: function () {
var self = this;
var border = 4;
this.canvas.addEventListener("touchstart", function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
if (self.behaviour.onTouch) {
self.behaviour.onTouch(e);
e.stopPropagation();
e.preventDefault();
}
}, false);
this.canvas.addEventListener("touchmove", function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
if (self.behaviour.onTouch) {
self.behaviour.onTouch(e);
e.stopPropagation();
e.preventDefault();
}
}, false);
this.canvas.addEventListener("touchend", function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
if (self.behaviour.onTouch) {
self.behaviour.onTouch(e);
e.stopPropagation();
e.preventDefault();
}
}, false);
this.canvas.addEventListener("gesturestart", function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
self.log("GestureStart");
if (self.behaviour.onGesture) {
self.behaviour.onGesture(e);
e.stopPropagation();
e.preventDefault();
}
}, false);
this.canvas.addEventListener("gesturechange", function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
self.log("GestureChange");
if (self.behaviour.onGesture) {
self.behaviour.onGesture(e);
e.stopPropagation();
e.preventDefault();
}
}, false);
this.canvas.addEventListener("gestureend", function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
self.log("GestureEnd");
if (self.behaviour.onGesture) {
self.behaviour.onGesture(e);
e.stopPropagation();
e.preventDefault();
}
}, false);
$(this.canvas).mousemove(function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
if (self.behaviour.onMouseMove) {
var offset = $(self.canvas).offset();
var x = (e.pageX - offset.left - border - self.translateX) / self.scale;
var y = (e.pageY - offset.top - border - self.translateY) / self.scale;
self.behaviour.onMouseMove(x, y);
}
});
$(this.canvas).mousedown(function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
var offset = $(self.canvas).offset();
self.log("Offset=%s", offset);
if (self.behaviour.onMouseDown) {
var x = (e.pageX - offset.left - border - self.translateX) / self.scale;
var y = (e.pageY - offset.top - border - self.translateY) / self.scale;
self.behaviour.onMouseDown(x, y, e);
}
e.preventDefault();
});
$(this.canvas).mouseup(function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
var offset = $(self.canvas).offset();
if (self.behaviour.onMouseUp) {
var x = (e.pageX - offset.left - border - self.translateX) / self.scale;
var y = (e.pageY - offset.top - border - self.translateY) / self.scale;
self.behaviour.onMouseUp(x, y);
}
e.preventDefault();
});
$(this.canvas).click(function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
var offset = $(self.canvas).offset();
$(self.canvas).focus();
if (self.behaviour.onMouseClick) {
var x = (e.pageX - offset.left - border - self.translateX) / self.scale;
var y = (e.pageY - offset.top - border - self.translateY) / self.scale;
self.behaviour.onMouseClick(x, y);
}
e.preventDefault();
});
$(this.canvas).on("dblclick dbltap", function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
var offset = $(self.canvas).offset();
if (self.behaviour.onDoubleClick) {
var x = (e.pageX - offset.left - border - self.translateX) / self.scale;
var y = (e.pageY - offset.top - border - self.translateY) / self.scale;
self.behaviour.onDoubleClick(x, y);
}
e.preventDefault();
});
$(this.canvas).focus();
this.colourPanel.bind("colour", function (e) {
if (self.isReadOnly()) {
e.stopPropagation();
e.preventDefault();
return;
}
if (self.behaviour.onColourClicked) {
self.behaviour.onColourClicked(e);
}
});
},
initializeKeyboardCursor: function () {
var self = this;
this.keyboardCursor = {
shown: false,
dragging: false,
caret: false,
x: 100,
y: 100
};
},
handleKeyboardCursorKeys: function (action, e) {
if (!this.keyboardCursor.shown) {
return false;
}
var moveX = 0, moveY = 0;
var nudge = this.config.get("nudge");
var eventType;
switch (action) {
case "right":
moveX = nudge;
break;
case "left":
moveX = -nudge;
break;
case "down":
moveY = nudge;
break;
case "up":
moveY = -nudge;
break;
case "enter":
if (this.behaviour.onMouseClick) {
this.keyboardCursor.dragging = false;
eventType = "click";
} else {
this.keyboardCursor.dragging = !this.keyboardCursor.dragging;
if (this.keyboardCursor.dragging) {
eventType = "mousedown";
} else {
eventType = "mouseup";
}
}
break;
}
if (moveX || moveY) {
this.keyboardCursor.x += moveX;
this.keyboardCursor.x = Math.max(this.keyboardCursor.x, 0);
this.keyboardCursor.x = Math.min(this.canvas.width,
this.keyboardCursor.x);
this.keyboardCursor.y += moveY;
this.keyboardCursor.y = Math.max(this.keyboardCursor.y, 0);
this.keyboardCursor.y = Math.min(this.canvas.height,
this.keyboardCursor.y);
this.draw();
eventType = "mousemove";
}
if (eventType) {
e.preventDefault();
e.stopPropagation();
this.draw();
var offset = $(this.canvas).offset();
var x = this.keyboardCursor.x + offset.left;
var y = this.keyboardCursor.y + offset.top;
this.log("Simulate a %s at (%s,%s)", eventType, x, y);
var evt = document.createEvent("MouseEvents");
evt.initMouseEvent(eventType, true, true, window,
0,
x, y, x, y, false, false, false, false,
this.keyboardCursor.dragging ? 1 : 0,
null);
this.canvas.dispatchEvent(evt);
return true;
}
return false;
},
showKeyboardCursor: function (caret) {
this.keyboardCursor.shown = true;
this.keyboardCursor.dragging = false;
this.keyboardCursor.caret = caret;
this.log("Showing keyboard cursor, caret=%s", caret);
this.draw();
},
showKeyboardCursorAndStartMoving: function () {
this.keyboardCursor.shown = true;
this.keyboardCursor.caret = false;
if (this.selection.length > 0) {
this.log("showKeyboardCursorAndStartMoving()");
this.keyboardCursor.dragging = true;
var centre = this.selectionBounds.centre();
var border = 4;
this.keyboardCursor.x = centre.x;
this.keyboardCursor.y = centre.y;
this.pickTool();
this.setBehaviour(new TransformSelectionBehaviour(this,
this.behaviour, null, false, centre.x - border,
centre.y - border));
}
this.draw();
},
hideKeyboardCursor: function () {
if (this.keyboardCursor.shown) {
this.keyboardCursor.shown = false;
this.draw();
}
},
isKeyboardCursorShown: function () {
return this.keyboardCursor.shown;
},
snap: function (pt) {
var snap = this.config.get("snap");
var x, y;
if (snap > 0) {
x = Math.round(pt.x / snap) * snap;
y = Math.round(pt.y / snap) * snap;
} else {
x = pt.x;
y = pt.y;
}
return new Point(x, y);
},
moveUp: function () {
var ids = this.getSelectedIds();
if (ids.length) {
this.commit([
new ChangeOrderAction(ids,
ChangeOrderAction.MOVE_UP)
]);
}
},
moveDown: function () {
var ids = this.getSelectedIds();
if (ids.length) {
this.commit([
new ChangeOrderAction(ids,
ChangeOrderAction.MOVE_DOWN)
]);
}
},
bringToFront: function () {
var ids = this.getSelectedIds();
if (ids.length) {
this.commit([
new ChangeOrderAction(ids,
ChangeOrderAction.BRING_TO_FRONT)
]);
}
},
sendToBack: function () {
var ids = this.getSelectedIds();
if (ids.length) {
this.commit([
new ChangeOrderAction(ids,
ChangeOrderAction.SEND_TO_BACK)
]);
}
},
setProperty: function (key, value) {
var ids = this.getSelectedIds();
this.defaults[key] = value;
if (ids.length) {
this.commit([
new SetAction(ids, key, value)
]);
}
if (this.selection.length > 0 && key === "lineWidth" && this.selection[0].type() ===
"BrushNode") {
this.defaultBrushThickness = value;
}
},
group: function () {
var ids = this.getSelectedIds();
if (ids.length) {
this.commit([
new GroupAction(ids)
]);
}
},
ungroup: function () {
var ids = this.getSelectedIds();
if (ids.length) {
this.commit([
new UngroupAction(ids)
]);
}
},
deleteAction: function () {
var ids = this.getSelectedIds();
if (ids.length) {
this.commit([
new DeleteAction(ids)
]);
if (this.propertyPanel) {
this.propertyPanel.loadFromNodes([]);
}
}
this.pickTool();
},
clearSelection: function () {
if (this.selection.length > 0) {
this.selectGeneration += 1;
this.selection.length = 0;
this.log("Clear selection. selectGeneration=%s", this.selectGeneration);
}
},
addToSelection: function (node) {
this.setEditNode(null);
if (node.selectGeneration === this.selectGeneration) {
return;
}
this.selection.push(node);
node.selectGeneration = this.selectGeneration;
if (node.isGroupMember()) {
var parent = node.parent;
for (var i = 0; i < parent.children.length; i++) {
this.addToSelection(parent.children[i]);
}
this.addToSelection(parent);
}
if (node.children && node.children.length > 0) {
this.addToSelection(node.children[0]);
}
},
selectNodes: function (nodes) {
this.clearSelection();
for (var i = 0; i < nodes.length; i++) {
this.addToSelection(nodes[i]);
}
this.doneSelecting();
},
commit: function (actions, alreadyDone) {
var addedNodes = this.doc.commit(actions, alreadyDone);
this.doc.format(this.ctx, this.request);
if (addedNodes.length) {
this.selectNodes(addedNodes);
} else if (this.selection.length || this.editNode) {
var j = 0;
this.selectGeneration += 1;
for (var i = 0; i < this.selection.length; i++) {
if (i !== j) {
this.selection[j] = this.selection[i];
}
if (this.doc.exists(this.selection[j].id)) {
this.selection[j].selectGeneration = this.selectGeneration;
j++;
}
}
if (this.selection.length !== j) {
this.selection.length = j;
this.calcSelection();
}
if (this.selection.length === 0) {
this.clearSelection();
}
if (this.editNode && !this.doc.exists(this.editNode.id)) {
this.editNode = null;
}
}
this.calcSelection();
this.draw();
this.eventSource.emit("document-changed");
},
selectByRect: function (rect) {
var nodes = this.doc.getNodesInRectangle(rect);
for (var i = 0; i < nodes.length; i++) {
this.addToSelection(nodes[i]);
}
},
doneSelecting: function () {
this.calcSelection();
if (this.propertyPanel) {
this.propertyPanel.loadFromNodes(this.selection);
}
},
calcSelection: function () {
if (this.selection.length === 0) {
return;
}
this.selectionBounds = this.selection[0].getRect().clone();
for (var i = 1; i < this.selection.length; i++) {
this.selectionBounds.union(this.selection[i].getRect());
}
this.rotHandleX = this.selectionBounds.x +
this.selectionBounds.width - 20 / this.scale;
this.rotHandleY = this.selectionBounds.y;
},
checkSelection: function () {
var dest = 0;
for (var i = 0; i < this.selection.length; i++) {
if (i !== dest) {
this.selection[dest] = this.selection[i];
}
if (this.doc.exists(this.selection[dest].id)) {
dest += 1;
}
}
if (this.selection.length !== dest) {
this.selection.length = dest;
}
},
getSelectedNodes: function () {
var nodes = this.selection.concat();
if (this.editNode) {
nodes.push(this.editNode);
}
this.log("editNode=%s", this.editNode ? this.editNode.id : "none");
for (var i = 0; i < nodes.length; i++) {
this.log("Selected node=%s", nodes[i].id);
}
return nodes;
},
getSelectedIds: function () {
var result = [];
var nodes = this.doc.collapseGroups(this.getSelectedNodes());
for (var i = 0; i < nodes.length; i++) {
this.log("Selected id=%s", nodes[i].id);
result.push(nodes[i].id);
}
return result;
},
hasSelection: function () {
return this.selection.length > 0;
},
update: function (forceDraw) {
this.doc.forceRedraw = forceDraw === true || this.doc.forceRedraw;
if (this.doc.format(this.ctx, this.request) || forceDraw) {
this.calcSelection();
this.draw();
}
},
drawBackground: function () {
var snap = this.config.get("snap");
if (snap > 0) {
this.ctx.beginPath();
for (var y = 0; y < this.canvas.height; y += snap) {
for (var x = 0; x < this.canvas.width; x += snap) {
this.ctx.arc(x, y, 3, 0, 2 * Math.PI, false);
this.log("x=%s width=%s", x, this.canvas.width);
}
}
this.ctx.fillStyle = "#c0c0c0";
this.ctx.fill();
}
},
drawKeyboardCursor: function (ctx) {
if (this.keyboardCursor.shown) {
var x = this.keyboardCursor.x;
var y = this.keyboardCursor.y;
ctx.globalCompositeOperation = "xor";
ctx.beginPath();
if (this.keyboardCursor.caret) {
ctx.moveTo(x - 3, y - 10);
ctx.lineTo(x + 3, y - 10);
ctx.moveTo(x - 3, y + 10);
ctx.lineTo(x + 3, y + 10);
ctx.moveTo(x, y - 10);
ctx.lineTo(x, y + 10);
} else {
ctx.moveTo(x, y - 3);
ctx.lineTo(x, y - 15);
ctx.moveTo(x, y + 3);
ctx.lineTo(x, y + 15);
ctx.moveTo(x - 3, y);
ctx.lineTo(x - 15, y);
ctx.moveTo(x + 3, y);
ctx.lineTo(x + 15, y);
}
if (this.keyboardCursor.dragging) {
this.ctx.arc(x, y, 8, 0, 2 * Math.PI, false);
}
ctx.lineWidth = 2;
ctx.strokeStyle = "#000000";
ctx.stroke();
ctx.globalCompositeOperation = "source-over";
}
},
draw: function () {
this.ctx.setTransform(1, 0, 0, 1, 0, 0);
this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
this.drawBackground();
this.ctx.translate(this.translateX, this.translateY);
this.ctx.scale(this.scale, this.scale);
this.doc.draw(this.ctx);
if (this.behaviour.onRedraw) {
this.behaviour.onRedraw(this.ctx);
}
if (this.selection.length > 0) {
this.ctx.save();
this.ctx.strokeStyle = "#000000";
this.ctx.lineWidth = 1.0 / this.scale;
var tr = this.selectHandleTransform.apply(
this.selectionBounds.x,
this.selectionBounds.y);
var tl = this.selectHandleTransform.apply(
this.selectionBounds.x + this.selectionBounds.width,
this.selectionBounds.y);
var bl = this.selectHandleTransform.apply(
this.selectionBounds.x + this.selectionBounds.width,
this.selectionBounds.y + this.selectionBounds.height);
var br = this.selectHandleTransform.apply(
this.selectionBounds.x,
this.selectionBounds.y + this.selectionBounds.height);
if (tr.x < 0) {
tr.x = 0;
br.x = 0;
tl.x = this.selectionBounds.width;
bl.x = this.selectionBounds.width;
}
if (tr.y < 0) {
tr.y = 0;
tl.y = 0;
br.y = this.selectionBounds.height;
bl.y = this.selectionBounds.height;
}
if (tl.x > this.canvas.width) {
tl.x = this.canvas.width;
bl.x = this.canvas.width;
tr.x = this.canvas.width - this.selectionBounds.width;
br.x = this.canvas.width - this.selectionBounds.width;
}
if (br.y > this.canvas.height) {
br.y = this.canvas.height;
bl.y = this.canvas.height;
tl.y = this.canvas.height - this.selectionBounds.height;
tr.y = this.canvas.height - this.selectionBounds.height;
}
var rh = new Point(this.rotHandleX, this.rotHandleY);
var r = this.HANDLE_RADIUS / this.scale;
this.ctx.strokeRect(tl.x - r, tl.y - r, r * 2, r * 2);
this.ctx.strokeRect(tr.x - r, tr.y - r, r * 2, r * 2);
this.ctx.strokeRect(br.x - r, br.y - r, r * 2, r * 2);
this.ctx.strokeRect(bl.x - r, bl.y - r, r * 2, r * 2);
if (this.enableRotationHandle) {
this.ctx.beginPath();
this.ctx.strokeStyle = "#008000";
this.ctx.lineWidth = 3.0 / this.scale;
this.ctx.moveTo(rh.x, rh.y);
this.ctx.arc(rh.x, rh.y, 6.0 / this.scale, 0, 1.5 * Math.PI, false);
this.ctx.stroke();
}
}
if (this.editNode) {
this.editNode.drawEditHandles(this.ctx, 1.0 / this.scale);
}
if (this.hintText) {
this.ctx.save();
this.ctx.font = "12px Arial";
this.ctx.fillStyle = "#000000";
this.ctx.textBaseline = "top";
this.ctx.textAlign = "right";
this.ctx.fillText(this.hintText, this.ctx.canvas.width, 0);
this.ctx.restore();
}
this.drawKeyboardCursor(this.ctx);
},
setEditNode: function (node) {
this.editNode = node;
},
transformSelectHandles: function (matrix) {
this.selectHandleTransform = matrix;
},
showRotationHandle: function (shown) {
this.enableRotationHandle = shown;
},
isNodeSelected: function (node) {
return node.selectGeneration === this.selectGeneration;
},
getHandleUnderPoint: function (x, y) {
if (this.selection.length) {
var r = this.HANDLE_TOUCH_RADIUS / this.scale;
if (x >= this.selectionBounds.x - r && x < this.selectionBounds.x + r
) {
if (y >= this.selectionBounds.y - r &&
y < this.selectionBounds.y + r) {
return this.NW;
} else if (y >= this.selectionBounds.y +
this.selectionBounds.height - r && y <
this.selectionBounds.y + this.selectionBounds.height +
r
) {
return this.SW;
}
} else if (
x >= this.selectionBounds.x + this.selectionBounds.width - r &&
x < this.selectionBounds.x + this.selectionBounds.width + r
) {
if (y >= this.selectionBounds.y - r &&
y < this.selectionBounds.y + r) {
return this.NE;
} else if (y >= this.selectionBounds.y +
this.selectionBounds.height - r && y <
this.selectionBounds.y + this.selectionBounds.height +
r
) {
return this.SE;
}
}
if (x >= this.rotHandleX - r && x < this.rotHandleX + r &&
y >= this.rotHandleY - r && y < this.rotHandleY + r) {
return this.ROT;
}
}
return null;
},
undo: function () {
if (this.zwibblerContext && !this.zwibblerContext.isValid())
return;
this.doc.undo();
this.doc.format(this.ctx, this.request);
this.checkSelection();
this.calcSelection();
this.draw();
this.eventSource.emit("document-changed");
this.pickTool();
},
redo: function () {
this.doc.redo();
this.doc.format(this.ctx, this.request);
this.checkSelection();
this.calcSelection();
this.draw();
this.eventSource.emit("document-changed");
this.pickTool();
},
objectCounter: 0,
copy: function () {
var nodes = this.getSelectedNodes();
if (nodes.length === 0) {
return;
}
this.objectCounter = 0;
this.copiedTransaction = this.doc.saveTransactions(nodes);
this.pickTool();
},
duplicate: function () {
var ids = this.getSelectedIds();
if (ids.length > 0) {
this.commit([
new DuplicateAction(ids, 10)
]);
}
},
paste: function () {
var saved = this.copiedTransaction;
if (!saved)
return;
var offset = (++this.objectCounter) * 5;
var actions = this.doc.loads(saved, offset);
this.commit(actions);
this.update();
this.pickTool();
},
setHintText: function (text) {
this.hintText = text;
},
pickTool: function () {
this.setBehaviour(new DefaultBehaviour(this));
},
setBehaviour: function (behaviour) {
if (this.behaviour && this.behaviour.leave) {
this.behaviour.leave();
}
this.behaviour = behaviour;
if (behaviour.enter) {
behaviour.enter();
}
},
lineTool: function () {
this.setBehaviour(new DrawLinesBehaviour(this,
false, false));
},
drawFreeformTool: function () {
this.setBehaviour(new DrawFreeformBehaviour(this, this.behaviour));
},
drawBrushTool: function () {
this.setBehaviour(new DrawBrushBehaviour(this, this.behaviour));
},
curveTool: function () {
this.setBehaviour(new DrawLinesBehaviour(this,
true, false));
},
arrowTool: function () {
this.setBehaviour(new DrawLinesBehaviour(this,
true, true));
},
textTool: function () {
this.setBehaviour(new DrawTextBehaviour(this));
},
onPropertyButtonClicked: function (propertyName) {
this.log("Someone clicked a button for %s", propertyName);
if (propertyName === "mathml") {
this.eventSource.emit("math.edit", this.getSelectedIds()[0]);
}
},
nudgeSelection: function (dx, dy) {
var nudge = this.config.get("nudge");
dx *= nudge / this.scale;
dy *= nudge / this.scale;
this.log("Nudge selection by %s, %s", dx, dy);
var ids = this.getSelectedIds();
if (ids.length) {
var xform = new TranslateMatrix(dx, dy);
this.commit([
new TransformAction(ids, xform, xform.inverse())
]);
}
return ids.length > 0;
},
isReadOnly : function () {
return this.zwibblerContext && this.zwibblerContext.isReadOnly();
}
};
var TransactionList = function () {
this.transactions = [];
this.next = 0;
};
TransactionList.prototype.log = log.create("TRANSLIST");
TransactionList.prototype.getIndex = function () {
return this.next;
};
TransactionList.prototype.commit = function (doc, actions, base) {
var parentid;
if (base == null) {
base = null;
}
if (this.transactions.length) {
parentid = this.transactions[this.transactions.length - 1].getId();
} else {
parentid = "0";
}
this.transactions.length = this.next;
if (base === null) {
this.transactions.push(new Transaction(parentid, actions, doc.peekNextId(), null));
return this.redo(doc);
} else {
this.transactions.push(new Transaction(parentid, actions, base, null));
return this.next += 1;
}
};
TransactionList.prototype.commitTransaction = function (doc, transaction, affectedIds, dependentIds) {
var parentid;
if (this.transactions.length) {
parentid = this.transactions[this.transactions.length - 1].getId();
} else {
parentid = "0";
}
if (transaction.parentid !== parentid) {
throw "ERROR! mismatched parent id";
}
if (transaction.base !== doc.peekNextId()) {
throw "ERROR! mismatched base id";
}
this.transactions.length = this.next;
this.transactions.push(transaction);
return this.redo(doc, affectedIds, dependentIds);
};
TransactionList.prototype.redo = function (doc, affectedIds, dependentIds) {
var action, _i, _len, _ref;
if (affectedIds == null) {
affectedIds = null;
}
if (dependentIds == null) {
dependentIds = null;
}
if (this.next === this.transactions.length) {
return false;
}
assert(doc.peekNextId() === this.transactions[this.next].base);
_ref = this.transactions[this.next].actions;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
action = _ref[_i];
if (affectedIds) {
action.getAffectedIds(doc, affectedIds);
}
if (dependentIds) {
action.getDependentIds(doc, dependentIds);
}
action.redo(doc);
}
this.next += 1;
return true;
};
TransactionList.prototype.undo = function (doc, affectedIds, dependentIds) {
var actions, i, _ref;
if (affectedIds == null) {
affectedIds = null;
}
if (dependentIds == null) {
dependentIds = null;
}
if (this.next === 0) {
return false;
}
this.next -= 1;
actions = this.transactions[this.next].actions;
if (actions.length === 0) {
return;
}
for (i = _ref = actions.length - 1; i >= 0; i += -1) {
if (i < 0) {
break;
}
actions[i].undo(doc);
if (affectedIds) {
actions[i].getAffectedIds(doc, affectedIds);
}
if (dependentIds) {
actions[i].getDependentIds(doc, dependentIds);
}
}
return doc.setNextId(this.transactions[this.next].base);
}; ;
if (!window.JSON) {
window.JSON = {};
}
(function () {
function f(n) {
return n < 10 ? '0' + n : n;
}
if (typeof Date.prototype.toJSON !== 'function') {
Date.prototype.toJSON = function (key) {
return isFinite(this.valueOf()) ?
this.getUTCFullYear() + '-' +
f(this.getUTCMonth() + 1) + '-' +
f(this.getUTCDate()) + 'T' +
f(this.getUTCHours()) + ':' +
f(this.getUTCMinutes()) + ':' +
f(this.getUTCSeconds()) + 'Z' : "";
};
String.prototype.toJSON =
Number.prototype.toJSON =
Boolean.prototype.toJSON = function (key) {
return "" + this.valueOf();
};
}
var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
gap,
indent,
meta = {
'\b': '\\b',
'\t': '\\t',
'\n': '\\n',
'\f': '\\f',
'\r': '\\r',
'"': '\\"',
'\\': '\\\\'
},
rep;
function quote(string) {
escapable.lastIndex = 0;
return escapable.test(string) ?
'"' + string.replace(escapable, function (a) {
var c = meta[a];
return typeof c === 'string' ? c :
'\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
}) + '"' :
'"' + string + '"';
}
function str(key, holder) {
var i,
k,
v,
length,
mind = gap,
partial,
value = holder[key];
if (value && typeof value === 'object' &&
typeof value.toJSON === 'function') {
value = value.toJSON(key);
}
if (typeof rep === 'function') {
value = rep.call(holder, key, value);
}
switch (typeof value) {
case 'string':
return quote(value);
case 'number':
return isFinite(value) ? String(value) : 'null';
case 'boolean':
case 'null':
return String(value);
case 'object':
if (!value) {
return 'null';
}
gap += indent;
partial = [];
if (Object.prototype.toString.apply(value) === '[object Array]') {
length = value.length;
for (i = 0; i < length; i += 1) {
partial[i] = str(i, value) || 'null';
}
v = partial.length === 0 ? '[]' :
gap ? '[\n' + gap +
partial.join(',\n' + gap) + '\n' +
mind + ']' :
'[' + partial.join(',') + ']';
gap = mind;
return v;
}
if (rep && typeof rep === 'object') {
length = rep.length;
for (i = 0; i < length; i += 1) {
k = rep[i];
if (typeof k === 'string') {
v = str(k, value);
if (v) {
partial.push(quote(k) + (gap ? ': ' : ':') + v);
}
}
}
} else {
for (k in value) {
if (Object.hasOwnProperty.call(value, k)) {
v = str(k, value);
if (v) {
partial.push(quote(k) + (gap ? ': ' : ':') + v);
}
}
}
}
v = partial.length === 0 ? '{}' :
gap ? '{\n' + gap + partial.join(',\n' + gap) + '\n' +
mind + '}' : '{' + partial.join(',') + '}';
gap = mind;
return v;
}
}
if (typeof window.JSON.stringify !== 'function') {
window.JSON.stringify = function (value, replacer, space) {
var i;
gap = '';
indent = '';
if (typeof space === 'number') {
for (i = 0; i < space; i += 1) {
indent += ' ';
}
} else if (typeof space === 'string') {
indent = space;
}
rep = replacer;
if (replacer && typeof replacer !== 'function' &&
(typeof replacer !== 'object' ||
typeof replacer.length !== 'number')) {
throw new Error('JSON.stringify');
}
return str('', { '': value });
};
}
if (typeof window.JSON.parse !== 'function') {
window.JSON.parse = function (text, reviver) {
var j;
function walk(holder, key) {
var k, v, value = holder[key];
if (value && typeof value === 'object') {
for (k in value) {
if (Object.hasOwnProperty.call(value, k)) {
v = walk(value, k);
if (v !== undefined) {
value[k] = v;
} else {
delete value[k];
}
}
}
}
return reviver.call(holder, key, value);
}
text = String(text);
cx.lastIndex = 0;
if (cx.test(text)) {
text = text.replace(cx, function (a) {
return '\\u' +
('0000' + a.charCodeAt(0).toString(16)).slice(-4);
});
}
if (/^[\],:{}\s]*$/.
test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@').
replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']').
replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {
j = eval('(' + text + ')');
return typeof reviver === 'function' ?
walk({ '': j }, '') : j;
}
throw new SyntaxError('JSON.parse');
};
}
} ());
var Api = function () {
EventEmitter.apply(this, arguments);
window.addEventListener("message", __bind(function (e) {
return this.receive(e);
}, this), false);
window.parent.postMessage("{\"event\": \"ready\"}", "*");
};
__extends(Api, EventEmitter);
Api.prototype.log = log.create("Api");
Api.prototype.receive = function (e) {
var fn, json, replyFn, _i, _len, _ref, _results;
try {
json = window["JSON"].parse(e.data);
} catch (except) {
this.log("Error parsing %s from %s", e.data, e.origin);
return;
}
this.log("Received %s", e.data);
replyFn = function (args_array) {
var rep;
if ("ticket" in json) {
rep = {
"ticket": json["ticket"],
"args": args_array
};
return window.parent.postMessage(window["JSON"].stringify(rep), "*");
}
};
if (json["function"] in this.events) {
_ref = this.events[json["function"]];
_results = [];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
fn = _ref[_i];
_results.push(fn(json["args"], replyFn));
}
return _results;
}
}; ;
var ZwibblerDocument = function () {
EventEmitter.apply(this, arguments);
this.transactions = new TransactionList();
this.nodes = {};
this.redraw = new Set();
this.forceRedraw = true;
this.forceRenumber = true;
this.nextId = 0;
this.newNodes = [];
this.root = new GroupNode(this.getNextId());
this.markClean();
this._insert(this.root);
this.domRoot = new GroupNode(this.getNextId());
this.addChild(this.root, this.domRoot);
this.domRoot.parent = null;
};
__extends(ZwibblerDocument, EventEmitter);
ZwibblerDocument.prototype.log = log.create("DOC");
ZwibblerDocument.prototype.markClean = function () {
this.savedTo = this.transactions.getIndex();
};
ZwibblerDocument.prototype.dirty = function () {
return this.savedTo !== this.transactions.getIndex();
};
ZwibblerDocument.prototype.rebuild = function () {
while (this.transactions.undo(this)) { }
if (this.root.children.length) {
throw "Error: There should be 0 children length.";
}
if (this.nextId !== 1) {
throw "Error: nextId should be 1";
}
while (this.transactions.redo(this)) { }
};
ZwibblerDocument.prototype.getNextId = function () {
return this.nextId++;
};
ZwibblerDocument.prototype.setNextId = function (id) {
assertNumber(id);
this.nextId = id;
this.log("nextId now %s", id);
};
ZwibblerDocument.prototype.peekNextId = function () {
return this.nextId;
};
ZwibblerDocument.prototype.exists = function (id) {
return id in this.nodes;
};
ZwibblerDocument.prototype._insert = function (node, redraw) {
var child, _i, _len, _ref;
if (redraw === undefined) {
redraw = true;
}
assert("id" in node, "Must be a node");
if (!(node.id in this.nodes)) {
this.nodes[node.id] = node;
this.newNodes.push(node);
node.onAdded();
if (node.isGroup()) {
_ref = node.children;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
child = _ref[_i];
this._insert(child, redraw);
}
}
}
if (redraw) {
this.redraw.add(node.id);
}
};
ZwibblerDocument.prototype.markRedraw = function (id) {
assertNumber(id);
return this.redraw.add(id);
};
ZwibblerDocument.prototype.addNode = function (node) {
return this.addChild(this.domRoot, node, -1);
};
ZwibblerDocument.prototype.getNode = function (id, redraw) {
var node;
if (redraw === undefined) {
redraw = false;
}
assertNumber(id);
if (id in this.nodes) {
node = this.nodes[id];
this.redraw.add(id);
return node;
} else {
return null;
}
};
ZwibblerDocument.prototype.commit = function (actions, base) {
this.newNodes.length = 0;
this.transactions.commit(this, actions, base);
return this.newNodes;
};
ZwibblerDocument.prototype.undo = function () {
return this.transactions.undo(this);
};
ZwibblerDocument.prototype.redo = function () {
return this.transactions.redo(this);
};
ZwibblerDocument.prototype.format = function (ctx, request) {
var ids = this.forceRedraw ? this.nodes : this.redraw.toMap();
var nodes = [];
for (var id in ids) {
if (ids.hasOwnProperty(id)) {
nodes.push(this.nodes[id]);
}
}
nodes = this.collapseGroups(nodes);
for (var i = 0; i < nodes.length; i++) {
var node = nodes[i];
node.format(ctx, request);
}
this.redraw.clear();
this.forceRedraw = false;
return nodes.length;
};
ZwibblerDocument.prototype.draw = function (ctx) {
this.each(false, function (node) {
if (node.hidden()) {
} else {
node.draw(ctx);
}
});
};
ZwibblerDocument.prototype.hittest = function (x, y) {
return this.root.hittest(x, y);
};
ZwibblerDocument.prototype.getNodesInRectangle = function (rect) {
return this.filter(function (node) {
return rect.contains(node.getRect());
});
};
ZwibblerDocument.prototype.collapseGroups = function (nodes) {
var added, node, result, _i, _len;
result = [];
added = {};
for (_i = 0, _len = nodes.length; _i < _len; _i++) {
node = nodes[_i];
while (node.isGroupMember()) {
node = node.parent;
}
if (!(node.id in added)) {
added[node.id] = true;
result.push(node);
}
}
this.sortNodes(result);
return result;
};
ZwibblerDocument.prototype.closure = function (ids, result) {
var id, process, _i, _len;
result = result || new Set();
process = function (node) {
var child, _i, _len, _ref, _results;
result.add(node.id);
if (node.isGroup()) {
_ref = node.children;
_results = [];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
child = _ref[_i];
_results.push(process(child));
}
return _results;
}
};
for (_i = 0, _len = ids.length; _i < _len; _i++) {
id = ids[_i];
process(this.nodes[id]);
}
return result;
};
ZwibblerDocument.prototype.each = function (wantGroups, fn) {
var process;
process = function (node) {
var child, _i, _len, _ref;
if (node.isGroup()) {
if (wantGroups) {
fn(node);
}
_ref = node.children;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
child = _ref[_i];
process(child);
}
} else {
fn(node);
}
};
process(this.root);
};
ZwibblerDocument.prototype.filter = function (fn) {
var results;
results = [];
this.each(false, function (node) {
if (fn(node)) {
return results.push(node);
}
});
return results;
};
ZwibblerDocument.prototype.sortNodes = function (nodes) {
var count;
count = 0;
if (this.forceRenumber) {
this.forceRenumber = false;
this.each(true, function (node) {
node.order = count++;
});
}
nodes.sort(function (a, b) {
return a.order - b.order;
});
return nodes;
};
ZwibblerDocument.prototype.createGroup = function (ids) {
var group, id, _i, _len;
group = new GroupNode(this.getNextId());
this.addNode(group);
for (_i = 0, _len = ids.length; _i < _len; _i++) {
id = ids[_i];
this.addChild(group, this.nodes[id], -1);
}
return group;
};
ZwibblerDocument.prototype.getTransactionCount = function () {
return this.transactions.transactions.length;
};
ZwibblerDocument.prototype.saveTransactions = function (nodes) {
var actions, id, node, _i, _len, _ref;
actions = [];
id = 0;
_ref = this.collapseGroups(nodes);
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
node = _ref[_i];
id = this._save(node, actions, id);
}
return JSON.stringify(actions);
};
ZwibblerDocument.prototype._save = function (node, actions, nextid) {
var child, members, name, properties, value, x, _i, _len, _ref;
if (node.isGroup()) {
members = [];
_ref = node.children;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
child = _ref[_i];
nextid = this._save(child, actions, nextid);
members.push(nextid - 1);
}
actions.push({
"type": "GroupAction",
"members": members
});
} else {
properties = node.getProperties();
x = {};
for (name in properties) {
if (properties.hasOwnProperty(name)) {
value = properties[name];
if (value instanceof Matrix) {
value = ["Matrix", value.m11, value.m12, value.m21, value.m22, value.dx, value.dy];
}
x[name] = value;
}
}
actions.push({
"type": "CreateAction",
"node": node.type(),
"properties": x
});
}
return nextid + 1;
};
ZwibblerDocument.prototype.loads = function (input, offset) {
var action, actions, base, item, items, name, properties, renamer, value, x, _i, _j, _len, _len2;
items = JSON.parse(input);
actions = [];
for (_i = 0, _len = items.length; _i < _len; _i++) {
item = items[_i];
if (item["type"] === "GroupAction") {
actions.push(new GroupAction(item["members"]));
} else if (item["type"] === "CreateAction") {
x = item["properties"];
properties = {};
for (name in x) {
if (x.hasOwnProperty(name)) {
value = x[name];
if (Object.prototype.toString.apply(value) === '[object Array]' && value[0] === "Matrix") {
value.splice(0, 1);
if (name === "inverse") {
value[4] -= offset;
value[5] -= offset;
} else {
value[4] += offset;
value[5] += offset;
}
value = new Matrix(value);
}
properties[name] = value;
}
}
actions.push(new CreateAction(item["node"], properties));
}
}
base = this.nextId;
renamer = __bind(function (oldName) {
this.log("Remap %s -> %s", oldName, oldName + base);
return oldName + base;
}, this);
for (_j = 0, _len2 = actions.length; _j < _len2; _j++) {
action = actions[_j];
action.rename(renamer);
}
return actions;
};
ZwibblerDocument.prototype.addChild = function (parent, child, index) {
if (child.parent) {
this.removeNode(child, false);
}
if (index === -1) {
parent.children.push(child);
} else {
parent.children.splice(index, 0, child);
}
this._insert(child);
this.forceRenumber = true;
child.parent = parent;
};
ZwibblerDocument.prototype.removeNode = function (child, detach) {
var index, process;
if (detach === undefined) {
detach = true;
}
index = child.parent.findChildIndex(child);
if (index >= 0) {
child.parent.children.splice(index, 1);
child.parent = null;
if (detach) {
process = __bind(function (node) {
var n, _i, _len, _ref;
delete this.nodes[node.id];
child.onRemoved();
this.redraw.remove(node.id);
if (node.isGroup()) {
_ref = node.children;
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
n = _ref[_i];
process(n);
}
}
}, this);
process(child);
}
}
return index;
};
ZwibblerDocument.prototype.findBackground = function () {
var firstNode = this.root.children[0];
if (firstNode && firstNode.locked && firstNode.type() == "ImageNode") {
return firstNode;
}
};
ZwibblerDocument.prototype.setBackground = function (background) {
var oldBackground = this.findBackground();
if (oldBackground) {
this.removeNode(oldBackground);
}
if (typeof background === 'number') {
background = this.getNode(background);
this.removeNode(background);
}
this.addChild(this.root, background, 0);
};
ZwibblerDocument.prototype.docString = function () {
var parts, process;
parts = [];
process = function (node, level) {
var child, i, _i, _len, _ref, _ref2;
for (i = 0, _ref = level - 1; i <= _ref; i += 1) {
parts.push("  ");
}
parts.push(node.type());
parts.push(":" + node.id + "\n");
if (node.isGroup()) {
_ref2 = node.children;
for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
child = _ref2[_i];
process(child, level + 1);
}
}
};
process(this.root, 0);
return parts.join("");
};
ZwibblerDocument.prototype.getRect = function () {
var bottom, left, right, top;
left = null;
right = null;
top = null;
bottom = null;
this.each(false, function (node) {
if (left === null || node.rect.x < left) {
left = node.rect.x;
}
if (right === null || node.rect.right() > right) {
right = node.rect.right();
}
if (top === null || node.rect.y < top) {
top = node.rect.y;
}
if (bottom === null || node.rect.bottom() > bottom) {
bottom = node.rect.bottom();
}
});
if (left === null) {
return new Rectangle(0, 0, 10, 10);
} else {
return new Rectangle(left, top, right - left, bottom - top);
}
};
ZwibblerDocument.log = log.create("DOC");
ZwibblerDocument.prototype.getResponseXml = function () {
try {
var list = ZwibblerDocument.exportAsList(this.root);
var j = 0;
var resArr = [];
for (var i = 0; i < list.length; i++) {
var lItem = list[i];
var res = '<node>';
if (lItem.type === "ImageNode")
continue;
for (var p in lItem) {
if (p === 'matrix' || p === 'commands' || p === 'points') {
var matrixData = lItem[p];
for (j = 0; j < matrixData.length; j++) {
res += '<' + p + '>' + matrixData[j] + '</' + p + '>';
}
} else if (p === 'url') {
res += '<' + p + '>' + 'nobgimg' + '</' + p + '>';
} else if (p === 'data') {
res += '<data>';
for (var eqd in lItem[p]) {
if (eqd == 'tabConfig') {
res += '<tabConfig>';
var tcOrder = (lItem[p])[eqd];
for (j = 0; j < tcOrder.Order.length; j++) {
res += '<Order>' + tcOrder.Order[j] + '</Order>';
}
res += '</tabConfig>';
}
else if (eqd.toLowerCase() == 'editorlabels') {
}
else
res += '<' + eqd + '>' + (lItem[p])[eqd] + '</' + eqd + '>';
}
res += '</data>';
} else {
res += '<' + p + '>' + lItem[p] + '</' + p + '>';
}
}
res += '</node>';
resArr.push(res);
}
return "<response>" + resArr.join(' ') + "</response>";
} catch (e) {
return "Unsupported format: xml";
}
};
ZwibblerDocument.prototype.processResponseXml = function (contents) {
try {
contents = contents.replace(/<mathML>/g, '<mathML><![CDATA[');
contents = contents.replace(/<\/mathML>/g, ']]></mathML>');
var list = JSON.parse(xml2jsonv2(parseXml(contents), ''));
for (var i in list.response.node) {
for (var p in list.response.node[i]) {
if (p === 'id' || p == 'lineWidth' || p == 'parent' || p == 'arrowSize')
(list.response.node[i])[p] = parseInt((list.response.node[i])[p]);
else if (p === 'fontSize' || p == 'smoothness' || p == 'sloppiness' )
(list.response.node[i])[p] = parseFloat((list.response.node[i])[p]);
else if (p === 'matrix' || p === 'commands' || p === 'points') {
for (var j = 0; j < (list.response.node[i])[p].length; j++) {
((list.response.node[i])[p])[j] = parseFloat(((list.response.node[i])[p])[j]);
}
} else if (typeof (list.response.node[i])[p] == 'string' && ((list.response.node[i])[p] == 'true' || (list.response.node[i])[p] == 'false')) {
(list.response.node[i])[p] = ((list.response.node[i])[p] == 'true');
} else if (p == 'text')
(list.response.node[i])[p] = (list.response.node[i])[p] != null ? (list.response.node[i])[p] : "";
}
}
for (i in list.response.node) {
var n = list.response.node[i];
if (typeof n.data !== 'undefined') {
n.data.mathML = [n.data.mathML["#cdata"]];
}
}
return list.response.node;
} catch (e) {
throw "XML Format detection failed.";
}
};
ZwibblerDocument.prototype.save = function (format) {
if (format === "list") {
return ZwibblerDocument.exportAsList(this.root);
} else if (format === "zwibbler3") {
var list = ZwibblerDocument.exportAsList(this.root);
return "zwibbler3." + window.JSON.stringify(list);
} else {
throw "Unknown save format: " + format;
}
};
ZwibblerDocument.load = function (contents) {
if (contents.indexOf("zwibbler3.") === 0) {
var list = window.JSON.parse(contents.substr(10));
return ZwibblerDocument.importFromList(list);
} else {
throw "Format detection failed.";
}
};
ZwibblerDocument.exportAsList = function (root) {
var list = [];
function handle(parent, node) {
var saved = {
"id": node.id,
"type": node.type()
};
list.push(saved);
if (parent) {
saved["parent"] = parent.id;
}
var properties = node.getProperties();
for (var name in properties) {
if (properties.hasOwnProperty(name)) {
if (name === "matrix") {
saved[name] = properties[name].toArray();
} else if (name === "inverse") {
} else {
saved[name] = properties[name];
}
}
}
if (node.isGroup()) {
for (var i = 0; i < node.children.length; i++) {
handle(node, node.children[i]);
}
}
}
handle(null, root);
return list;
};
ZwibblerDocument.importFromList = function (list, zwibblerDocument) {
var i;
var parent, child;
list = window.JSON.parse(window.JSON.stringify(list));
var actions = [];
var mapping = {};
var nextId = 1;
var tree = {};
for (i = 0; i < list.length; i++) {
child = list[i];
if ("parent" in child) {
if (!(child["parent"] in tree)) {
throw "Error: child " + child["id"] +
" references parent " + child["parent"] +
" before it was defined.";
}
parent = tree[child["parent"]];
if (parent.children !== undefined) {
parent.children.push(child);
} else {
parent.children = [child];
}
}
if (child["type"] === "GroupNode" && child.children === undefined) {
child.children = [];
}
tree[child["id"]] = child;
}
function handle(item) {
var j;
if (item === undefined)
return;
if (item.children !== undefined) {
for (j = 0; j < item.children.length; j++) {
handle(item.children[j]);
}
if (item["id"] !== 0) {
var members = [];
for (j = 0; j < item.children.length; j++) {
members.push(mapping[item.children[j]["id"]]);
}
actions.push(new GroupAction(members));
}
} else {
var properties = {};
for (var key in item) {
if (item.hasOwnProperty(key)) {
if (key === "children" || key === "parent" ||
key === "id" || key === "type") {
} else if (key === "matrix") {
properties[key] = new Matrix(item[key]);
properties["inverse"] = properties["matrix"].inverse();
} else {
properties[key] = item[key];
}
}
}
actions.push(new CreateAction(item["type"], properties));
}
if (item["id"] !== 0) {
mapping[nextId] = item["id"];
nextId += 1;
}
}
handle(tree[0]);
ZwibblerDocument.log(JSON.stringify(mapping));
for (i = 0; i < actions.length; i++) {
ZwibblerDocument.log(actions[i].toString());
zwibblerDocument.commit([actions[i]]);
}
return zwibblerDocument;
};
function Colour(type, values) {
this.type = type;
this.values = values;
if (this.values.length < 4) {
throw "Bad value";
}
}
Colour.RGBA = 0;
Colour.XYZA = 1;
Colour.HSVA = 2;
Colour.LABA = 3;
Colour.LAST_COLOURSPACE = 3;
Colour.fromString = function (colourString) {
if (colourString.toLowerCase() in Colour.CssColours) {
colourString = Colour.CssColours[colourString.toLowerCase()];
}
var hex6 = /\#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i;
var rgbStr = /rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/;
var r, g, b, a;
var m = hex6.exec(colourString);
if (m !== null) {
r = parseInt(m[1], 16) / 255;
g = parseInt(m[2], 16) / 255;
b = parseInt(m[3], 16) / 255;
a = 1.0;
} else {
m = rgbStr.exec(colourString);
if (m !== null) {
r = parseFloat(m[1]) / 255;
g = parseFloat(m[2]) / 255;
b = parseFloat(m[3]) / 255;
a = parseFloat(m[4]);
} else {
r = 1.0;
g = 0.0;
b = 1.0;
a = 1.0;
}
}
return new Colour(Colour.RGBA, [r, g, b, a]);
};
Colour.prototype = {
toString: function () {
function toHex(val) {
val = Math.round(val * 255);
if (val < 16) {
return "0" + val.toString(16);
} else {
return val.toString(16);
}
}
var clr = this.convertTo(Colour.RGBA);
if (clr.values[3] === 1.0) {
return "#" +
toHex(clr.values[0]) +
toHex(clr.values[1]) +
toHex(clr.values[2]);
} else {
return "rgba(" +
Math.round(clr.values[0] * 255) + "," +
Math.round(clr.values[1] * 255) + "," +
Math.round(clr.values[2] * 255) + "," +
clr.values[3] + ")";
}
},
convertTo: function (type) {
return Colour.converters[this.type][type](this);
},
distanceTo: function (colour) {
if (colour.type !== this.type) {
colour = colour.convertTo(this.type);
}
if (this.type === Colour.HSVA) {
var a = this.values[0], b = colour.values[0];
var hueDiff;
if (a > b) {
hueDiff = Math.min(a - b, b - a + 360);
} else {
hueDiff = Math.min(b - a, a - b + 360);
}
hueDiff /= 360;
return Math.pow(
hueDiff * hueDiff +
(this.values[1] - colour.values[1]) *
(this.values[1] - colour.values[1]) +
(this.values[2] - colour.values[2]) *
(this.values[2] - colour.values[2]), 0.5);
} else {
return Math.pow(
(this.values[0] - colour.values[0]) *
(this.values[0] - colour.values[0]) +
(this.values[1] - colour.values[1]) *
(this.values[1] - colour.values[1]) +
(this.values[2] - colour.values[2]) *
(this.values[2] - colour.values[2]), 0.5);
}
}
};
(function () {
var WHITE = { X: 0.9505, Y: 1.0000, Z: 1.0890 };
function convert_HSVA_RGBA(clr) {
var h = clr.values[0];
var s = clr.values[1];
var v = clr.values[2];
if (h < 0) { h += 360; }
var hi = Math.floor(h / 60) % 6;
var f = h / 60 - Math.floor(h / 60);
var p = v * (1 - s);
var q = v * (1 - f * s);
var t = v * (1 - (1 - f) * s);
var r, g, b;
switch (hi) {
case 0:
r = v;
g = t;
b = p;
break;
case 1:
r = q;
g = v;
b = p;
break;
case 2:
r = p;
g = v;
b = t;
break;
case 3:
r = p;
g = q;
b = v;
break;
case 4:
r = t;
g = p;
b = v;
break;
case 5:
r = v;
g = p;
b = q;
break;
}
return new Colour(Colour.RGBA, [r, g, b, clr.values[3]]);
}
function convert_RGBA_HSVA(clr) {
var h, s, v;
var r = clr.values[0];
var g = clr.values[1];
var b = clr.values[2];
var max = Math.max(r, g, b);
var min = Math.min(r, g, b);
if (max === min) {
h = 0;
} else if (max === r) {
h = (60 * (g - b) / (max - min) + 360) % 360;
} else if (max === g) {
h = 60 * (b - r) / (max - min) + 120;
} else if (max === b) {
h = 60 * (r - g) / (max - min) + 240;
}
if (max === 0) {
s = 0;
} else {
s = 1 - min / max;
}
v = max;
return new Colour(Colour.HSVA, [h, s, v, clr.values[3]]);
}
function convert_XYZA_LABA(clr) {
function f(t) {
if (t > (6.0 / 29.0) * (6.0 / 29.0) * (6.0 / 29.0)) {
return Math.pow(t, 1.0 / 3.0);
} else {
return (1.0 / 3.0) *
(29.0 / 6.0) * (29.0 / 6.0) * t +
4.0 / 29.0;
}
}
var X = f(clr.values[0] / WHITE.X);
var Y = f(clr.values[1] / WHITE.Y);
var Z = f(clr.values[2] / WHITE.Z);
return new Colour(Colour.LABA,
[116 * Y - 16,
500 * (X - Y),
200 * (Y - Z),
clr.values[3]]);
}
function convert_LABA_XYZA(clr) {
var fy = (clr.values[0] + 16) / 116;
var fx = fy + clr.values[1] / 500;
var fz = fy - clr.values[2] / 200;
var squiggle = 6.0 / 29;
var X, Y, Z;
if (fy > squiggle) {
Y = WHITE.Y * fy * fy * fy;
} else {
Y = (fy - 16.0 / 116) * 3 * squiggle * squiggle * WHITE.Y;
}
if (fx > squiggle) {
X = WHITE.X * fx * fx * fx;
} else {
X = (fx - 16.0 / 116) * 3 * squiggle * squiggle * WHITE.X;
}
if (fz > squiggle) {
Z = WHITE.Z * fz * fz * fz;
} else {
Z = (fz - 16.0 / 116) * 3 * squiggle * squiggle * WHITE.Z;
}
return new Colour(Colour.XYZA, [X, Y, Z, clr.values[3]]);
}
function convert_RGBA_XYZA(rgb) {
var temp = [];
for (var i = 0; i < 3; i++) {
if (rgb.values[i] <= 0.04045) {
temp[i] = rgb.values[i] / 12.92;
} else {
temp[i] = Math.pow((rgb.values[i] + 0.055) / 1.055, 2.4);
}
}
return new Colour(Colour.XYZA, [
0.4124 * temp[0] + 0.3576 * temp[1] + 0.1805 * temp[2],
0.2126 * temp[0] + 0.7152 * temp[1] + 0.0722 * temp[2],
0.0193 * temp[0] + 0.1192 * temp[1] + 0.9505 * temp[2],
rgb.values[3]]);
}
function convert_XYZA_RGBA(xyz) {
var temp = [];
var values = [];
temp[0] = 3.2410 * xyz.values[0] - 1.5374 * xyz.values[1] - 0.4986 * xyz.values[2];
temp[1] = -0.9692 * xyz.values[0] + 1.8760 * xyz.values[1] + 0.0416 * xyz.values[2];
temp[2] = 0.0556 * xyz.values[0] - 0.2040 * xyz.values[1] + 1.0570 * xyz.values[2];
for (var i = 0; i < 3; i++) {
if (temp[i] <= 0.0031308) {
values[i] = 12.92 * temp[i];
} else {
values[i] = 1.055 * Math.pow(temp[i], 1.0 / 2.4) - 0.055;
}
}
values[3] = xyz.values[3];
return new Colour(Colour.RGBA, values);
}
function convert_SAME(clr) {
return new Colour(clr.type, clr.values.concat());
}
function convert_RGBA_LABA(clr) {
return convert_XYZA_LABA(
convert_RGBA_XYZA(clr));
}
function convert_LABA_RGBA(clr) {
return convert_XYZA_RGBA(
convert_LABA_XYZA(clr));
}
function convert_XYZA_HSVA(clr) {
return convert_RGBA_HSVA(
convert_XYZA_RGBA(clr));
}
function convert_HSVA_XYZA(clr) {
return convert_RGBA_XYZA(
convert_HSVA_RGBA(clr));
}
function convert_HSVA_LABA(clr) {
return convert_RGBA_LABA(
convert_HSVA_RGBA(clr));
}
function convert_LABA_HSVA(clr) {
return convert_XYZA_HSVA(
convert_LABA_XYZA(clr));
}
Colour.converters = [
[convert_SAME,
convert_RGBA_XYZA,
convert_RGBA_HSVA,
convert_RGBA_LABA],
[convert_XYZA_RGBA,
convert_SAME,
convert_XYZA_HSVA,
convert_XYZA_LABA],
[convert_HSVA_RGBA,
convert_HSVA_XYZA,
convert_SAME,
convert_HSVA_LABA],
[convert_LABA_RGBA,
convert_LABA_XYZA,
convert_LABA_HSVA,
convert_SAME]
];
} ());
Colour.CssColours = {
"aliceblue": "#f0f8ff",
"antiquewhite": "#faebd7",
"aqua": "#00ffff",
"aquamarine": "#7fffd4",
"azure": "#f0ffff",
"beige": "#f5f5dc",
"bisque": "#ffe4c4",
"black": "#000000",
"blanchedalmond": "#ffebcd",
"blue": "#0000ff",
"blueviolet": "#8a2be2",
"brown": "#a52a2a",
"burlywood": "#deb887",
"cadetblue": "#5f9ea0",
"chartreuse": "#7fff00",
"chocolate": "#d2691e",
"coral": "#ff7f50",
"cornflowerblue": "#6495ed",
"cornsilk": "#fff8dc",
"crimson": "#dc143c",
"cyan": "#00ffff",
"darkblue": "#00008b",
"darkcyan": "#008b8b",
"darkgoldenrod": "#b8860b",
"darkgray": "#a9a9a9",
"darkgreen": "#006400",
"darkkhaki": "#bdb76b",
"darkmagenta": "#8b008b",
"darkolivegreen": "#556b2f",
"darkorange": "#ff8c00",
"darkorchid": "#9932cc",
"darkred": "#8b0000",
"darksalmon": "#e9967a",
"darkseagreen": "#8fbc8f",
"darkslateblue": "#483d8b",
"darkslategray": "#2f4f4f",
"darkturquoise": "#00ced1",
"darkviolet": "#9400d3",
"deeppink": "#ff1493",
"deepskyblue": "#00bfff",
"dimgray": "#696969",
"dodgerblue": "#1e90ff",
"firebrick": "#b22222",
"floralwhite": "#fffaf0",
"forestgreen": "#228b22",
"fuchsia": "#ff00ff",
"gainsboro": "#dcdcdc",
"ghostwhite": "#f8f8ff",
"gold": "#ffd700",
"goldenrod": "#daa520",
"gray": "#808080",
"green": "#008000",
"greenyellow": "#adff2f",
"honeydew": "#f0fff0",
"hotpink": "#ff69b4",
"indianred": "#cd5c5c",
"indigo": "#4b0082",
"ivory": "#fffff0",
"khaki": "#f0e68c",
"lavender": "#e6e6fa",
"lavenderblush": "#fff0f5",
"lawngreen": "#7cfc00",
"lemonchiffon": "#fffacd",
"lightblue": "#add8e6",
"lightcoral": "#f08080",
"lightcyan": "#e0ffff",
"lightgoldenrodyellow": "#fafad2",
"lightgreen": "#90ee90",
"lightgrey": "#d3d3d3",
"lightpink": "#ffb6c1",
"lightsalmon": "#ffa07a",
"lightseagreen": "#20b2aa",
"lightskyblue": "#87cefa",
"lightslategray": "#778899",
"lightsteelblue": "#b0c4de",
"lightyellow": "#ffffe0",
"lime": "#00ff00",
"limegreen": "#32cd32",
"linen": "#faf0e6",
"magenta": "#ff00ff",
"maroon": "#800000",
"mediumaquamarine": "#66cdaa",
"mediumblue": "#0000cd",
"mediumorchid": "#ba55d3",
"mediumpurple": "#9370d8",
"mediumseagreen": "#3cb371",
"mediumslateblue": "#7b68ee",
"mediumspringgreen": "#00fa9a",
"mediumturquoise": "#48d1cc",
"mediumvioletred": "#c71585",
"midnightblue": "#191970",
"mintcream": "#f5fffa",
"mistyrose": "#ffe4e1",
"moccasin": "#ffe4b5",
"navajowhite": "#ffdead",
"navy": "#000080",
"oldlace": "#fdf5e6",
"olive": "#808000",
"olivedrab": "#6b8e23",
"orange": "#ffa500",
"orangered": "#ff4500",
"orchid": "#da70d6",
"palegoldenrod": "#eee8aa",
"palegreen": "#98fb98",
"paleturquoise": "#afeeee",
"palevioletred": "#d87093",
"papayawhip": "#ffefd5",
"peachpuff": "#ffdab9",
"peru": "#cd853f",
"pink": "#ffc0cb",
"plum": "#dda0dd",
"powderblue": "#b0e0e6",
"purple": "#800080",
"red": "#ff0000",
"rosybrown": "#bc8f8f",
"royalblue": "#4169e1",
"saddlebrown": "#8b4513",
"salmon": "#fa8072",
"sandybrown": "#f4a460",
"seagreen": "#2e8b57",
"seashell": "#fff5ee",
"sienna": "#a0522d",
"silver": "#c0c0c0",
"skyblue": "#87ceeb",
"slateblue": "#6a5acd",
"slategray": "#708090",
"snow": "#fffafa",
"springgreen": "#00ff7f",
"steelblue": "#4682b4",
"tan": "#d2b48c",
"teal": "#008080",
"thistle": "#d8bfd8",
"tomato": "#ff6347",
"turquoise": "#40e0d0",
"violet": "#ee82ee",
"wheat": "#f5deb3",
"white": "#ffffff",
"whitesmoke": "#f5f5f5",
"yellow": "#ffff00",
"yellowgreen": "#9acd32"
};
function ColourPanel(parent, size, useTouch, colours) {
this.init(parent, size, useTouch, colours);
}
ColourPanel.prototype.init = function (parent, size, useTouch, colours) {
EventEmitter.call(this);
this.canvas = $("<div>", { 'class': 'sp_colour_panel' });
this.useTouch = useTouch;
this.colours = colours || [
"#000000",
"#ffffff",
"#000088",
"#008800",
"#008888",
"#880000",
"#880088",
"#884400",
"#888888",
"#444444",
"#0000ff",
"#00ff00",
"#00ffff",
"#ff0000",
"#ff00ff",
"#ffff00"
];
this.buildPanel(this.colours, this.canvas);
parent.append(this.canvas);
};
ColourPanel.prototype.buildPanel = function (colours, p) {
var ul = $('<ul>', { 'class': 'sp_color_ul' });
for (var i = 0; i < colours.length; ++i) {
var colour = colours[i];
var li = $('<li>', { 'class': 'sp_colour_list_item' }).append($('<a>', {
'title': 'Fill color',
'class': 'sp_colour sp_colour_' + colour.replace('#', ''),
text: colour,
click: this.onMouseClick.bind(this, colour)
}));
ul.append(li);
}
p.append(ul);
};
ColourPanel.prototype.setWidth = function (width) {
this.width = width;
};
ColourPanel.prototype.setHeight = function (height) {
this._height = height;
};
ColourPanel.prototype.height = function () {
return this._height;
};
ColourPanel.prototype.moveTo = function (x, y) {
};
ColourPanel.prototype.draw = function () {
};
ColourPanel.prototype.hide = function () {
this.canvas.hide();
};
ColourPanel.prototype.show = function () {
this.canvas.show();
};
ColourPanel.prototype.onMouseClick = function (colour, evt) {
evt = evt || window.event;
console.log("The colour, the button etc.", colour, evt);
$('.sp_colour').removeClass('sp_colour_select');
$('.sp_colour_' + colour.replace('#', '')).addClass('sp_colour_select');
console.log($('.sp_color_' + colour.replace('#', '')));
this.emit("colour", {
colour: colour,
button: evt.which
});
};
$.extend(ColourPanel.prototype, EventEmitter.prototype);
var nextIdForColorWheelSlider = 0;
function ColourWheel(size) {
this.div = document.createElement("div");
this.canvas = document.createElement("canvas");
this.width = size;
this.height = size;
this.canvas.width = this.width;
this.canvas.height = this.height;
this.canvas.style.cursor = "crosshair";
this.ctx = this.canvas.getContext("2d");
this.div.appendChild(this.canvas);
var input = document.createElement("input");
input.setAttribute("type", "range");
if (input.type === "range") {
this.div.appendChild(document.createElement("br"));
this.div.appendChild(input);
input.min = 0;
input.max = 255;
input.value = 255;
this.alphaSlider = input;
} else {
this.nextId = nextIdForColorWheelSlider;
this.alphaSlider = null;
var id = "colourSlider" + this.nextId;
var colourSlider = Util.Slider.create(id, 0, 100);
var sliderEl = colourSlider.getEl();
this.div.appendChild(document.createElement("br"));
this.div.appendChild(sliderEl);
this.colourSlider = colourSlider;
this.nextId += 1;
}
nextIdForColorWheelSlider = this.nextId;
this.outer = this.height;
this.inner = this.height * 0.8;
if (ColourWheel[size]) {
this.data = ColourWheel[size];
} else {
var data = this.ctx.getImageData(0, 0, this.outer, this.outer);
var r = this.outer / 2;
var r2 = this.inner / 2;
var rgb, hsv;
var a;
for (var y = 0; y < this.outer; y++) {
var s = Math.sqrt(r * r - (y - r) * (y - r));
var fromX1 = Math.floor(-s + r);
var toX1 = Math.floor(s + r);
var p;
var x;
var b = r2 * r2 - (y - r) * (y - r);
if (b >= 0) {
s = Math.sqrt(b);
var fromX2 = Math.floor(-s + r);
var toX2 = Math.floor(s + r);
p = y * this.outer * 4 + fromX1 * 4;
for (x = fromX1; x <= fromX2; x++) {
a = Math.atan2(y - r, x - r);
hsv = new Colour(Colour.HSVA,
[a / Math.PI * 180, 1, 1, 1]);
rgb = hsv.convertTo(Colour.RGBA);
data.data[p++] = rgb.values[0] * 255;
data.data[p++] = rgb.values[1] * 255;
data.data[p++] = rgb.values[2] * 255;
data.data[p++] = 255;
}
p = y * this.outer * 4 + toX2 * 4;
for (x = toX2; x <= toX1; x++) {
a = Math.atan2(y - r, x - r);
hsv = new Colour(Colour.HSVA,
[a / Math.PI * 180, 1, 1, 1]);
rgb = hsv.convertTo(Colour.RGBA);
data.data[p++] = rgb.values[0] * 255;
data.data[p++] = rgb.values[1] * 255;
data.data[p++] = rgb.values[2] * 255;
data.data[p++] = 255;
}
} else {
p = y * this.outer * 4 + fromX1 * 4;
for (x = fromX1; x <= toX1; x++) {
a = Math.atan2(y - r, x - r);
hsv = new Colour(Colour.HSVA,
[a / Math.PI * 180, 1, 1, 1]);
rgb = hsv.convertTo(Colour.RGBA);
data.data[p++] = rgb.values[0] * 255;
data.data[p++] = rgb.values[1] * 255;
data.data[p++] = rgb.values[2] * 255;
data.data[p++] = 255;
}
}
}
this.data = data;
ColourWheel[size] = data;
}
this.hsv = new Colour(Colour.HSVA, [20, 1, 1, 1]);
this.update();
this.draw();
var self = this;
self.buttonDown = false;
self.mouseArea = "";
$(this.canvas).mousedown(function (e) {
var offset = $(self.canvas).offset();
var x = (e.pageX - offset.left);
var y = (e.pageY - offset.top);
self.buttonDown = true;
self.calcClick(x, y);
e.stopPropagation();
e.preventDefault();
});
$(this.canvas).mousemove(function (e) {
if (self.buttonDown) {
var offset = $(self.canvas).offset();
var x = (e.pageX - offset.left);
var y = (e.pageY - offset.top);
self.calcClick(x, y);
}
e.stopPropagation();
e.preventDefault();
});
$(window).mouseup(function (e) {
self.buttonDown = false;
self.mouseArea = "";
});
if (this.alphaSlider !== null) {
$(this.alphaSlider).change(function (e) {
self.hsv.values[3] = self.alphaSlider.value / 255;
self.update();
self.draw();
});
}else {
colourSlider.onEnd.subscribe(function (e) {
console.log("Slider start");
self.hsv.values[3] = (this.getValue() * 2.55) / 255;
self.update();
self.draw();
});
}
}
ColourWheel.prototype = {
setFromColour: function (colourString) {
this.hsv = Colour.fromString(colourString).convertTo(Colour.HSVA);
if (this.alphaSlider !== null) {
this.alphaSlider.value = Math.round(this.hsv.values[3] * 255);
}
else if (this.colourSlider !== null) {
this.colourSlider.value = Math.round(this.hsv.values[3] * 255);
}
this.draw();
this.update();
},
update: function () {
if (this.onUpdate) {
this.onUpdate(this.hsv.toString());
}
},
draw: function () {
this.ctx.save();
this.ctx.lineWidth = 1;
this.ctx.fillStyle = "rgb(128, 128, 128)";
this.ctx.fillRect(0, 0, this.width, this.height);
this.ctx.putImageData(this.data, 0, 0);
var a = this.hsv.values[0] / 180 * Math.PI;
this.ctx.beginPath();
var p1 = {
x: Math.cos(a) * this.inner / 2 + this.outer / 2,
y: Math.sin(a) * this.inner / 2 + this.outer / 2
};
var p2 = {
x: Math.cos(a + 2 * Math.PI / 3) * this.inner / 2 + this.outer / 2,
y: Math.sin(a + 2 * Math.PI / 3) * this.inner / 2 + this.outer / 2
};
var p3 = {
x: Math.cos(a + 4 * Math.PI / 3) * this.inner / 2 + this.outer / 2,
y: Math.sin(a + 4 * Math.PI / 3) * this.inner / 2 + this.outer / 2
};
var outLine = {
x: Math.cos(a) * this.outer / 2 + this.outer / 2,
y: Math.sin(a) * this.outer / 2 + this.outer / 2
};
var mid = {
x: p2.x + (p3.x - p2.x) / 2,
y: p2.y + (p3.y - p2.y) / 2
};
this.ctx.moveTo(p1.x, p1.y);
this.ctx.lineTo(p2.x, p2.y);
this.ctx.lineTo(p3.x, p3.y);
this.ctx.lineTo(p1.x, p1.y);
var fill = this.ctx.createLinearGradient(p2.x, p2.y, p3.x, p3.y);
fill.addColorStop(0, "#ffffff");
fill.addColorStop(1, "#000000");
this.ctx.fillStyle = fill;
this.ctx.fill();
fill = this.ctx.createLinearGradient(p1.x, p1.y, mid.x, mid.y);
var hsv = this.hsv.convertTo(Colour.HSVA);
hsv.values[1] = 1.0;
hsv.values[2] = 1.0;
var fullRgb = hsv.convertTo(Colour.RGBA);
fullRgb.values[3] = 1.0;
fill.addColorStop(0, fullRgb.toString());
fullRgb.values[3] = 0.0;
fill.addColorStop(1, fullRgb.toString());
this.ctx.fillStyle = fill;
this.ctx.fill();
this.strokeStyle = "#000000";
this.ctx.beginPath();
this.ctx.moveTo(p1.x, p1.y);
this.ctx.lineTo(outLine.x, outLine.y);
this.ctx.stroke();
var x, y, v;
v = 1.0 - this.hsv.values[2];
x = this.hsv.values[1] * p1.x + v * p3.x + (1 - this.hsv.values[1] - v) *
p2.x;
y = this.hsv.values[1] * p1.y + v * p3.y + (1 - this.hsv.values[1] - v) *
p2.y;
this.ctx.beginPath();
this.ctx.arc(x, y, 4, 0, 2 * Math.PI, false);
this.ctx.stroke();
this.ctx.restore();
this.p1 = p1;
this.p2 = p2;
this.p3 = p3;
this.mid = mid;
},
calcClick: function (x, y) {
var distance = Math.sqrt((x - this.outer / 2) * (x - this.outer / 2) +
(y - this.outer / 2) * (y - this.outer / 2));
if (this.mouseArea === "ring" ||
this.mouseArea !== "triangle" &&
distance >= this.inner / 2 && distance <= this.outer / 2) {
var a = Math.atan2(this.outer / 2 - y, this.outer / 2 - x);
this.hsv.values[0] = a / Math.PI * 180 + 180;
if (this.hsv.values[1] === 0.0) {
this.hsv.values[1] = 1.0;
this.hsv.values[2] = 1.0;
}
this.mouseArea = "ring";
} else {
var lambda1, lambda2, lambda3;
var det;
var p1 = this.p1;
var p2 = this.p2;
var p3 = this.p3;
det = (p1.x - p3.x) * (p2.y - p3.y) - (p2.x - p3.x) * (p1.y - p3.y);
lambda1 = ((p2.y - p3.y) * (x - p3.x) - (p2.x - p3.x) * (y - p3.y)) / det;
lambda2 = (-(p1.y - p3.y) * (x - p3.x) + (p1.x - p3.x) * (y - p3.y)) / det;
lambda3 = 1.0 - Math.max(0, lambda1) - Math.max(0, lambda2);
this.hsv.values[1] = Math.min(Math.max(lambda1, 0.0), 1.0);
this.hsv.values[2] = 1.0 - Math.min(Math.max(lambda3, 0.0), 1.0);
this.mouseArea = "triangle";
}
this.draw();
this.update();
}
};
function PropertyPanel(config, id) {
this.config = config;
this.initPanel($("<div>"));
this.div.addClass("sp_property_panel");
this.SPID = id;
this.div.attr('id', id + '_sp_property-panel');
this.wrapperDiv = $('<div>', { 'class': 'sp_property_panel_wrapper' });
this.div.append(this.wrapperDiv);
var dragHanldeId = this.SPID + '_property_panel_drag_handle';
var dragHandle = $('<div>', { 'class': 'sp_drag_panel_handle', 'title': 'Move', 'id': dragHanldeId }).text('Property Panel');
this.makeDraggableElement(this.div, dragHandle, $('.theQuestions'));
this.wrapperDiv.append(dragHandle);
var self = this;
var a = $('<a>', { 'class': 'sp_close_panel', 'title': 'Close', 'href': '#'}).text('Hide Options').click(function () { self.hide() });
this.wrapperDiv.append(a);
var contentsDiv = $('<div>', { 'class': 'sp_property_panel_contents'});
this.contentsDiv = contentsDiv;
this.wrapperDiv.append(contentsDiv);
this.config = config;
this.records = [];
this.recordsByName = {};
this.view = null;
this.nodes = [];
this.action = null;
}
PropertyPanel.prototype = {
log: log.create("PROP"),
loadFromNodes: function (nodes) {
this.action = null;
this.records.length = 0;
this.recordsByName = {};
this.nodes = nodes.concat();
var hasGroup = false;
for (var i = 0; i < nodes.length; i++) {
var node = nodes[i];
if (node.isGroupMember()) {
hasGroup = true;
}
if (node.type() === "DomNode") {
continue;
}
var properties = node.getProperties();
for (var key in properties) {
if (properties.hasOwnProperty(key)) {
this.loadFromNode(key, node);
}
}
}
this.createControls();
if (this.config.showKeyboardHelp()) {
this.showKeyboardShortcuts(nodes, hasGroup);
}
},
showKeyboardShortcuts: function (nodes, hasGroup) {
var keydiv = $("<div>").addClass("keydiv");
$(this.contentsDiv).append(keydiv);
keydiv.append("<h4>Keyboard</h4>");
var Shortcuts = [
{
key: 'C',
description: "Draw curves"
},
{
key: 'L',
description: "Draw lines"
}
];
if (nodes.length > 0) {
Shortcuts.push(
{
key: 'Del',
description: "Delete Selection"
},
{
key: 'Ctrl+D',
description: "Duplicate Selection"
},
{
key: 'PageUp',
description: "Move selection closer"
},
{
key: 'PageDown',
description: "Move selection away"
}
);
}
if (nodes.length > 1) {
Shortcuts.push(
{
key: 'Ctrl+G',
description: "Group selection"
});
}
if (hasGroup) {
Shortcuts.push(
{
key: 'Ctrl+Shift+G',
description: "Break apart group"
}
);
}
Shortcuts.push({
key: "Arrow Keys",
description: "Move while zoomed"
});
for (var i = 0; i < Shortcuts.length; i++) {
var a = $("<span>").text(Shortcuts[i].key).addClass("key sp_property_shortcut");
var p = $("<p>").append(a);
p[0].appendChild(document.createTextNode(Shortcuts[i].description));
keydiv.append(p);
}
},
createProperty: function (node, name) {
var i;
if (name === "strokeStyle") {
return {
name: name,
type: "colour",
display: "Outline Colour"
};
} else if (name === "fillStyle") {
return {
name: name,
type: "colour",
display: "Fill Colour"
};
} else if (name === "lineWidth") {
var values = [
{ name: "Pencil", value: 1.0 },
{ name: "Pen", value: 2.0 },
{ name: "Marker", value: 4.0 },
{ name: "Brush", value: 10.0 }
];
if (node.getProperty("closed") === true ||
node.type() === "TextNode") {
values.unshift({ name: "None", value: 0.0 });
}
return {
name: name,
display: "Outline Thickness",
type: "select",
values: values
};
} else if (name === "sloppiness") {
return {
name: "sloppiness",
display: "Sloppiness",
type: "select",
values: [
{ name: "Draftsman", value: 0.0 },
{ name: "Artist", value: 0.25 },
{ name: "Cartoonist", value: 0.5 },
{ name: "Child", value: 1.0 },
{ name: "Dizzy", value: 2.0 }
]
};
} else if (name === "smoothness") {
return {
name: "smoothness",
display: "Smoothness",
type: "select",
values: [
{ name: "Sharper", value: 0.1 },
{ name: "Sharp", value: 0.2 },
{ name: "Smooth", value: 0.3 },
{ name: "Smoothest", value: 0.5 }
]
};
} else if (name === "shadow") {
return {
name: "shadow",
display: "Shadow",
type: "select",
values: [
{ name: "Shadow", value: true },
{ name: "None", value: false }
]
};
} else if (name === "matrix" || name === "inverse" ||
name === "closed" || name === "commands" || name === "seed") {
return {
name: name,
type: "none"
};
} else if (name === "text") {
return {
name: "text",
display: "Text",
type: "textarea"
};
} else if (name === "textFillStyle") {
return {
name: "textFillStyle",
display: "Text Colour",
type: "colour"
};
} else if (name === "fontSize") {
return {
name: "fontSize",
display: "Font Size",
type: "select",
values: [
{ name: "10", value: 10 },
{ name: "12", value: 12 },
{ name: "15", value: 15 },
{ name: "20", value: 20 },
{ name: "30", value: 30 },
{ name: "40", value: 40 },
{ name: "50", value: 50 },
{ name: "60", value: 60 }
]
};
} else if (name === "fontName") {
var fonts = [];
var allowedFonts = this.config.getOption("fonts");
for (i = 0; i < allowedFonts.length; i++) {
fonts.push({
name: allowedFonts[i], value: allowedFonts[i]
});
}
return {
name: "fontName",
display: "Font",
type: "select",
values: fonts
};
} else if (name === "arrowSize") {
return {
name: "arrowSize",
display: "Arrow Head Size",
type: "select",
values: [
{ name: "None", value: 0.0 },
{ name: "Tiny", value: 10.0 },
{ name: "Small", value: 15.0 },
{ name: "Medium", value: 20.0 },
{ name: "Large", value: 30.0 }
]
};
} else if (name === "url") {
return {
name: "url",
display: "Image URL",
type: "text"
};
} else if (name === "mathml") {
return {
name: "mathml",
display: "Equation",
type: "button"
};
} else if (name === "isTextEditable") {
return {
name: "isTextEditable",
display: "isTextEditable",
type: "none"
};
} else {
return {
name: name,
display: "Display-" + name,
type: "text"
};
}
},
loadFromNode: function (property, node) {
var record;
var config = this.config;
if (property in this.recordsByName) {
record = this.recordsByName[property];
if (record.value !== node.getProperty(property)) {
record.value = null;
}
} else if (property === "locked" || property === "points") {
} else if ((node.getProperty("closed") === true &&
property === "arrowSize") ||
(node.getProperty("closed") === false &&
(property === "fontName" ||
property === "fontSize" ||
property === "textFillStyle" ||
property === "text" ||
property === 'fillStyle'))) {
} else if (node.type() === "BrushNode" && property === "fillStyle") {
} else if (node.type() === "MathNode" &&
(property === "fillStyle" ||
property === "strokeStyle" ||
property === "lineWidth")) {
} else if (node.type() === "TextNode" &&
property === 'fillStyle') {
} else if (
property === "fillStyle" &&
!config.get("showFillColourProperty") ||
property === "strokeStyle" &&
!config.get("showOutlineColourProperty") ||
node.type() !== "BrushNode" && property === "lineWidth" &&
!config.get("showOutlineThicknessProperty") ||
node.type() === "BrushNode" && property === "lineWidth" &&
!config.get("showBrushThicknessProperty") ||
node.type() === "BrushNode" && property === "strokeStyle" &&
!config.get("showBrushColourProperty") ||
property === "shadow" &&
!config.get("showShadowProperty") ||
property === "textFillStyle" &&
!config.get("showTextColourProperty") ||
property === "fontName" &&
!config.get("showFontProperty") ||
property === "fontSize" &&
!config.get("showFontSizeProperty") ||
property === "arrowSize" &&
!config.get("showArrowHeadSizeProperty")
) {
} else {
record = {
property: this.createProperty(node, property),
value: node.getProperty(property)
};
this.records.push(record);
this.recordsByName[property] = record;
}
},
createControls: function () {
$(this.contentsDiv).empty();
var self = this;
var i;
var j;
var input;
var self = this;
var selectOnChangeFn = function () {
var which = parseInt(this.value, 10);
self.apply(this.prop.name, this.prop.values[which].value);
};
var onEnterFn = function (e) {
if (e.keyCode === 13) {
self.apply(this.prop.name, this.value);
}
};
var onColourEnterFn = function (e) {
e.preventDefault ? e.preventDefault() : e.returnValue = false;
e.stopPropagation ? e.stopPropagation() : e.cancelBubble = true;
};
var onButtonClickFn = function () {
self.view.onPropertyButtonClicked(this.prop.name);
};
var onWheelClickFn = function (wheel, input) {
wheel.input = input;
self.wheelClicked(wheel);
};
for (i = 0; i < this.records.length; i++) {
var record = this.records[i];
var prop = record.property;
if (prop.type === "none") {
continue;
}
var div = document.createElement("div");
var span = document.createElement("span");
span.appendChild(document.createTextNode(prop.display));
div.appendChild(span);
div.appendChild(document.createElement("br"));
if (prop.type === "select") {
var select = document.createElement("select");
for (j = 0; j < prop.values.length; j++) {
var item = prop.values[j];
var option = document.createElement("option");
option.appendChild(document.createTextNode(item.name));
option.setAttribute("value", j);
if (item.value === record.value) {
option.setAttribute("selected", "");
}
select.appendChild(option);
}
select.prop = prop;
select.onchange = selectOnChangeFn;
div.appendChild(select);
} else if (prop.type === "colour") {
input = document.createElement("input");
input.setAttribute("type", "text");
input.className = 'sp_colour_input';
input.value = record.value;
input.prop = prop;
input.readOnly = true;
$(input).keydown(onColourEnterFn);
div.appendChild(input);
var wheel = document.createElement("a");
wheel.className = 'sp_colour_wheel';
div.appendChild(wheel);
$(wheel).click(onWheelClickFn.bind(this, wheel, input));
$(input).click(onWheelClickFn.bind(this, wheel, input));
} else if (prop.type === "text") {
input = document.createElement("input");
input.setAttribute("type", "text");
input.value = record.value;
input.prop = prop;
$(input).keydown(onEnterFn);
div.appendChild(input);
} else if (prop.type === "textarea") {
input = document.createElement("textarea");
input.setAttribute("rows", "3");
input.setAttribute("cols", "20");
input.value = record.value;
input.prop = prop;
$(input).keyup(function(e) {
self.apply(this.prop.name, this.value);
});
div.appendChild(input);
} else if (prop.type === "button") {
input = document.createElement("input");
input.setAttribute("type", "button");
input.value = "Edit";
input.prop = prop;
$(input).click(onButtonClickFn);
div.appendChild(input);
} else {
throw "Error: No such property";
}
this.contentsDiv.append(div);
}
},
apply: function (name, value) {
this.view.setProperty(name, value);
},
wheelClicked: function (element) {
if (element.hasWheel) {
if (element.wheel.div.style.display == "") {
element.wheel.div.style.display = "none";
} else {
element.wheel.div.style.display = "";
}
return;
}
var wheel = new ColourWheel(120);
var self = this;
wheel.setFromColour(element.input.value);
wheel.onUpdate = function (colourStr) {
self.colourChanged(colourStr, element.input, element.input.prop);
};
element.wheel = wheel;
element.hasWheel = true;
element.parentNode.appendChild(wheel.div);
},
colourChanged: function (colour, input, prop) {
if (this.action === null || this.action.name !== prop.name) {
this.view.setProperty(prop.name, colour);
}
input.value = colour;
},
resetOffset: function (){
if(parseInt(this.div.css('left')) > 0 && parseInt(this.div.css('top')) > -30)
return;
this.div.css({
"left": "155px",
"top": "30px"
});
},
makeDraggableElement: function ($element, $dragHandle, $boundingElement) {
var dragging = false,
$document = $(document),
mouseOrigin, elementOffsetOrigin;
function getPoint(event) {
if (typeof event.screenX !== 'number') {
event = event.originalEvent.changedTouches[0];
}
return {
x: event.screenX | 0,
y: event.screenY | 0
};
}
function getDelta(currentEvent) {
var point = getPoint(currentEvent);
point.x -= mouseOrigin.x;
point.y -= mouseOrigin.y;
return point;
}
function getRect($element, outter) {
var element = $element[0],
elementOffset = $element.offset();
return {
left: elementOffset.left | 0,
top: elementOffset.top | 0,
right: (elementOffset.left + (outter ? element.offsetWidth : element.scrollWidth)) | 0,
bottom: (elementOffset.top + (outter ? element.offsetHeight : element.scrollHeight)) | 0,
width: function () {
return this.right - this.left;
},
height: function () {
return this.bottom - this.top;
}
};
}
function getOutterRect($element) {
return getRect($element, true);
}
function getInnerRect($element) {
return getRect($element, false);
}
function startDrag(event) {
if (!dragging) {
dragging = true;
mouseOrigin = getPoint(event);
elementOffsetOrigin = getOutterRect($element);
$dragHandle.off('mousedown touchstart', startDrag).on('mouseup touchend', endDrag);
$document.on('mousemove touchmove', drag);
event.stopPropagation();
event.preventDefault();
}
}
function drag(event) {
if (!dragging) {
return endDrag(event);
}
var delta = getDelta(event),
bounds = getInnerRect($boundingElement),
deltaLimits = {
min: {
x: bounds.left - elementOffsetOrigin.left,
y: bounds.top - elementOffsetOrigin.top
},
max: {
x: bounds.right - elementOffsetOrigin.right,
y: bounds.bottom - elementOffsetOrigin.bottom
}
};
function constrain(dimension, axis) {
if (elementOffsetOrigin[dimension]() < bounds[dimension]()) {
delta[axis] = Math.max(delta[axis], deltaLimits.min[axis]);
delta[axis] = Math.min(delta[axis], deltaLimits.max[axis]);
} else {
delta[axis] = 0;
}
}
constrain('width', 'x');
constrain('height', 'y');
if (delta.x || delta.y) {
$element.offset({
left: elementOffsetOrigin.left + delta.x,
top: elementOffsetOrigin.top + delta.y
});
}
event.stopPropagation();
event.preventDefault();
}
function endDrag(event) {
if (dragging) {
$dragHandle.on('mousedown touchstart', startDrag).off('mouseup touchend', endDrag);
$document.off('mousemove touchmove', drag);
dragging = false;
}
event.stopPropagation();
event.preventDefault();
}
$dragHandle.on('mousedown', startDrag);
}
};
PropertyPanel.prototype = $.extend({}, Panel.prototype,
PropertyPanel.prototype);
var Application = function (div, options) {
var mjax;
this.div = div;
this.minimal = true;
this.div.empty();
this.objectCounter = 0;
this.readOnly = false;
this.debugPanel = new DebugPanel($("<div>"));
this.div.append(this.debugPanel.div);
this.config = new Config(options);
this.backgroundImageId = null;
this.toolbarContainer = $('<div>', { 'class': 'sp_toolbar' });
this.div.append(this.toolbarContainer);
this.config.scale = this.config.scale || 1.0;
var canvasSize = (this.config.options.canvasSize || "600X800").split('X');
this.config.originalWidth = canvasSize[0];
this.config.originalHeight = canvasSize[1];
this.canvasContainer = $('<div>', {
'class': 'sp_canvas_container',
'width': this.config.originalWidth + 'px',
'height': this.config.originalHeight + 'px'
});
this.div.append(this.canvasContainer);
this.canvas = $("<canvas>", { 'class': 'sp_main_canvas' });
this.resizeCanvas();
this.canvasContainer.append(this.canvas);
this.ctx = this.canvas[0].getContext("2d");
if (this.config.useTouch()) {
this.colourPanel = new ColourPanel(this.toolbarContainer, 40, true);
} else {
this.colourPanel = new ColourPanel(this.toolbarContainer, 20, false);
}
this.eventSource = new EventEmitter();
this.eventSource.bind("document-changed", __bind(function (e) {
return this.onLocalDocumentChanged(e);
}, this));
this.eventSource.bind("math.edit", __bind(function (id) {
this.startMathEditor(id);
}, this));
this.view = new ZwibblerView(this.canvas, new ZwibblerDocument(), this.colourPanel, this.eventSource, this.config);
this.setDefaults();
this.createToolbar(this.toolbarContainer);
this.propertyPanel = new PropertyPanel(this.config, this.div.attr('id'));
this.div.append(this.propertyPanel.div);
if (this.config.showPropertyPanel()) {
this.view.propertyPanel = this.propertyPanel;
}
this.propertyPanel.view = this.view;
$(window).resize(__bind(function () {
return this._onResize();
}, this));
this.eventSource.bind("resize", __bind(function (e) {
return this._onResize;
}, this));
this.query = Url.hash();
this.showDebug = ("debug" in this.query) || this.config.showDebug();
this.backgroundSelector = new ListView(this.div);
this.backgroundSelector.div.css("border-right", "1px solid black");
this.imageSelector = new ListView(this.div);
this.imageSelector.div.css("border-top", "1px solid black");
this.imageSelector.setLayout("horizontal");
this.imageSelector.on("click", __bind(function (url) {
return this.newImage(url);
}, this));
this.backgroundSelector.on("click", __bind(function (url) {
return this.setBackgroundImage(url);
}, this));
this.oldWidth = -1;
this.oldHeight = -1;
this._onResize();
this.setupKeyboardSupport();
if (this.config.getOption("backgroundImage") !== null) {
this.setBackgroundImage(this.config.getOption("backgroundImage"));
}
this.ensureFontsAreLoaded();
this.zwibblerContext = null;
};
Application.prototype.log = log.create("APP");
Application.prototype.ensureFontsAreLoaded = function () {
var ctx, div, fontname, _i, _len, _ref, _results;
ctx = this.canvas[0].getContext("2d");
_ref = this.config.getOption("fonts");
_results = [];
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
fontname = _ref[_i];
this.log("Preloading: %s", fontname);
div = $("<div>", { 'class': 'hidden' }).css("font-family", fontname).text("abcd");
div.css("color", "white");
_results.push(this.div.append(div));
}
return _results;
};
Application.prototype.setDefaults = function () {
if (!this.config.getOption("sloppy")) {
this.view.setDefault("sloppiness", 0.0);
}
this.view.setDefault("smoothness", this.config.getDefaultSmoothness());
return this.view.setDefault("fillStyle", this.config.getOption("defaultFillStyle"));
};
Application.prototype.setBackgroundImageList = function (images) {
var arg, _i, _len, _results;
this.backgroundSelector.clear();
_results = [];
for (_i = 0, _len = images.length; _i < _len; _i++) {
arg = images[_i];
_results.push(typeof arg === 'string' ? this.backgroundSelector.addImage(arg, arg) : this.backgroundSelector.addImage(arg['small'], arg['large']));
}
return _results;
};
Application.prototype.setIconBrowserList = function (images) {
var arg, _i, _len, _results;
this.imageSelector.clear();
_results = [];
for (_i = 0, _len = images.length; _i < _len; _i++) {
arg = images[_i];
_results.push(typeof arg === 'string' ? this.imageSelector.addImage(arg, arg) : this.imageSelector.addImage(arg['small'], arg['large']));
}
return _results;
};
Application.prototype.setDocument = function (doc) {
this.backgroundImageId = null;
this.view.setDocument(doc);
this.setDefaults();
this.findBackgroundImage();
};
Application.prototype.notify = function (text) {
return $("#notifier").text(text);
};
Application.prototype.onLocalDocumentChanged = function (doc) {
return this.log("Local document changed.");
};
Application.prototype.zoom = function (scale) {
this.canvasContainer.css({
width: this.config.originalWidth * scale + 'px',
height: this.config.originalHeight * scale + 'px',
});
this.resizeCanvas();
this.view.scale = scale;
this.view.update(true);
};
Application.prototype.resizeCanvas = function () {
var rect = this.getCanvasRectangle(this.canvasContainer);
this.canvas[0].setAttribute('width', rect.width);
this.canvas[0].setAttribute('height', rect.height);
};
Application.prototype.getCanvasRectangle = function (dom) {
dom = dom || this.canvasContainer;
var outerRect = this.div[0].getBoundingClientRect();
var innerRect = dom[0].getBoundingClientRect();
return {
width: innerRect.width || outerRect.width || window.innerWidth - 200,
height: innerRect.height || outerRect.height || window.innerHeight
};
};
Application.prototype.createToolbar = function (div) {
div = div || this.div;
var menu, submenu;
var self = this;
this.toolbar = new Toolbar(this.config.useTouch());
var leftList = this.toolbar.ul_Left;
var rightList = this.toolbar.ul_Right;
function isKeyEvent(e) {
return e.type.indexOf("key") === 0;
}
if (this.config.get("showPickTool")) {
this.toolbar.addButton("pick", function (e) {
self.toolbar.setButtonHighlight("pick", true);
self.view.pickTool();
if (isKeyEvent(e)) {
self.showKeyboardCursor();
}
}, leftList, 'Pick');
}
if (!this.config.hasMenu()) {
if (this.config.get("showDeleteButton")) {
this.toolbar.addButton('delete', __bind(function (e) {
return this.eventSource.emit("menu.delete");
}, this), leftList, 'Delete');
}
if (this.config.get("showUndoRedo")) {
this.toolbar.addButton('undo', __bind(function (e) {
return this.eventSource.emit("menu.undo");
}, this), leftList, 'Undo');
this.toolbar.addButton('redo', __bind(function (e) {
return this.eventSource.emit("menu.redo");
}, this), leftList, 'Redo');
}
if (this.config.get("showCopyPaste")) {
this.toolbar.addButton('copy', __bind(function (e) {
return this.eventSource.emit("menu.copy");
}, this), leftList, 'Copy');
this.toolbar.addButton('paste', __bind(function (e) {
return this.eventSource.emit("menu.paste");
}, this), leftList, 'Paste');
}
}
if (this.config.get("showPropertyPanel")) {
this.toolbar.addButton('edit', __bind(function (e) {
return this.eventSource.emit("menu.edit");
}, this), leftList, 'Options');
}
if (this.config.get("showSquareTool")) {
this.toolbar.addButton('box', function (e) {
self.toolbar.clearHighlights();
self.newRect();
if (isKeyEvent(e)) {
self.startMovingWithKeyboard();
}
}, rightList, 'Box');
}
if (this.config.get("showCircleTool")) {
this.toolbar.addButton('circle', function (e) {
self.toolbar.clearHighlights();
self.newCircle();
if (isKeyEvent(e)) {
self.startMovingWithKeyboard();
}
}, rightList, 'Circle');
}
if (this.config.showBrushTool()) {
this.toolbar.addButton("brush", function (e) {
self.toolbar.setButtonHighlight("brush", true);
self.view.drawBrushTool();
if (isKeyEvent(e)) {
self.showKeyboardCursor();
}
}, rightList, 'Brush');
}
if (this.config.get("showLineTool")) {
this.toolbar.addButton("line", function (e) {
self.toolbar.setButtonHighlight("line", true);
self.view.lineTool();
if (isKeyEvent(e)) {
self.showKeyboardCursor();
}
}, rightList, 'Line');
}
if (this.config.get("showCurveTool")) {
this.toolbar.addButton("curve", function (e) {
self.toolbar.setButtonHighlight("curve", true);
self.view.curveTool();
if (isKeyEvent(e)) {
self.showKeyboardCursor();
}
}, rightList, 'Curve');
}
if (this.config.get("showArrowTool")) {
this.toolbar.addButton("arrow", function (e) {
self.toolbar.setButtonHighlight("arrow", true);
self.view.arrowTool();
if (isKeyEvent(e)) {
self.showKeyboardCursor();
}
}, rightList, 'Arrow');
}
if (this.config.get("showTextTool")) {
this.toolbar.addButton('text', __bind(function (e) {
this.toolbar.clearHighlights();
this.newText();
if (isKeyEvent(e)) {
self.showKeyboardCursor(true);
}
}, this), rightList, 'Text');
}
this.toolbar.setButtonHighlight("pick", true);
if (this.config.getOption("showImageTool")) {
this.toolbar.addButton('pick', __bind(function (e) {
return this.newImage("logo.png");
}, this, rightList));
}
div.prepend(this.toolbar.div);
menu = new Menu();
submenu = new Menu();
submenu.addItem("New", "menu.new");
menu.addSubmenu("File", submenu);
submenu = new Menu();
submenu.addItem("Undo\tCtrl+Z", "menu.undo");
submenu.addItem("Redo\tCtrl+Shift+Z", "menu.redo");
submenu.addSeparator();
submenu.addItem("Cut\tCtrl+X", "menu.cut");
submenu.addItem("Copy\tCtrl+C", "menu.copy");
submenu.addItem("Paste\tCtrl+V", "menu.paste");
submenu.addItem("Duplicate\tCtrl+D", "menu.duplicate");
submenu.addSeparator();
submenu.addItem("Delete\tDel", "menu.delete");
menu.addSubmenu("Edit", submenu);
submenu = new Menu();
submenu.addItem("Raise", "menu.moveUp");
submenu.addItem("Lower", "menu.moveDown");
submenu.addItem("Raise to front", "menu.bringToFront");
submenu.addItem("Send to back", "menu.sendToBack");
submenu.addSeparator();
submenu.addItem("Group", "menu.group");
submenu.addItem("Break apart group", "menu.ungroup");
menu.addSubmenu("Arrange", submenu);
submenu = new Menu();
submenu.addItem("No Outline", "menu.outline-none");
submenu.addItem("Pencil Outline", "menu.outline-pencil");
submenu.addItem("Pen Outline", "menu.outline-pen");
submenu.addItem("Marker Outline", "menu.outline-marker");
submenu.addSeparator();
submenu.addItem("No shadow", "menu.shadow-none");
submenu.addItem("Shadow", "menu.shadow");
submenu.addSeparator();
submenu.addItem("Draftsman", "menu.sloppiness-draftsman");
submenu.addItem("Artist", "menu.sloppiness-artist");
submenu.addItem("Cartoonist", "menu.sloppiness-cartoonist");
submenu.addItem("Child", "menu.sloppiness-child");
submenu.addItem("Dizzy", "menu.sloppiness-dizzy");
menu.addSubmenu("Appearance", submenu);
submenu = new Menu();
submenu.addItem("Arial", "menu.font.Arial");
submenu.addItem("Times New Roman", "menu.font.Times New Roman");
menu.addSubmenu("Font", submenu);
submenu = new Menu();
submenu.addItem("Force redraw", "menu.force-redraw");
submenu.addSeparator();
submenu.addItem("Rebuild document", "menu.rebuild-doc");
submenu.addItem("Show/Hide Debug Panel", "menu.toggle-debug");
submenu.addItem("dump", "menu.dump");
if (true || "debug" in this.query) {
menu.addSubmenu("Debug", submenu);
}
this.menuBar = new Menubar(menu, this.eventSource);
this.div.append(this.menuBar.div);
this.menuBar.moveTo(0, 0);
this.eventSource.bind("menu.new", __bind(function () {
return this.newDocument();
}, this));
this.eventSource.bind("menu.force-redraw", __bind(function () {
return this.view.update(true);
}, this));
this.eventSource.bind("menu.remove-cookie", __bind(function () {
return Cookies.remove("cookieid");
}, this));
this.eventSource.bind("menu.rebuild-doc", __bind(function () {
return this.view.doc.rebuild();
}, this));
return this.eventSource.bind("menu.toggle-debug", __bind(function () {
this.showDebug = !this.showDebug;
Url.setBooleanHashValue("debug", this.showDebug);
return this._onResize();
}, this));
};
Application.prototype.newRect = function () {
var bl, br, commands, tl, tr;
commands = new PathCommands();
var offset = (++this.objectCounter) * 5;
tl = this.view.snap(new Point(100 + offset, 100 + offset));
tr = this.view.snap(new Point(200 + offset, 100 + offset));
br = this.view.snap(new Point(200 + offset, 200 + offset));
bl = this.view.snap(new Point(100 + offset, 200 + offset));
commands.moveTo(tl.x, tl.y);
commands.lineTo(tr.x, tr.y);
commands.lineTo(br.x, br.y);
commands.lineTo(bl.x, bl.y);
commands.lineTo(tl.x, tl.y);
commands.close();
this.view.pickTool();
return this.view.commit([
new CreateAction("PathNode", {
"commands": commands.toArray(),
"fillStyle": this.view.defaultFillStyle,
"strokeStyle": this.view.defaultStrokeStyle,
"seed": Math.round(Math.random() * 65535),
"lineWidth": this.view.defaults["lineWidth"],
"sloppiness": this.view.defaults["sloppiness"]
})
]);
};
Application.prototype.newCircle = function () {
var offset = (++this.objectCounter) * 5;
this.view.pickTool();
return this.view.commit([
new CreateAction("PathNode", {
"commands": CreateCirclePath(this.view.snap(new Point(150 + offset, 150 + offset)), 50),
"fillStyle": this.view.defaultFillStyle,
"strokeStyle": this.view.defaultStrokeStyle,
"seed": Math.round(Math.random() * 65535),
"lineWidth": this.view.defaults["lineWidth"],
"sloppiness": this.view.defaults["sloppiness"]
})
]);
};
Application.prototype.newText = function () {
this.view.textTool();
};
Application.prototype.newImage = function (url) {
var id, pt, xform;
id = this.view.doc.peekNextId();
pt = this.view.snap(new Point(100, 100));
xform = new TranslateMatrix(pt.x, pt.y);
return this.view.commit([
new CreateAction("ImageNode", {
"url": url
}), new TransformAction([id], xform, xform.inverse())
]);
};
Application.prototype.newMathML = function () {
var id, xform;
this.view.pickTool();
id = this.view.doc.peekNextId();
var offset = (++this.objectCounter) * 5;
xform = new TranslateMatrix(100 + offset, 100 + offset);
var mn = new CreateAction("DomNode", {});
console.log("Math node?", mn);
var ret = this.view.commit([
mn,
new TransformAction([id], xform, xform.inverse())
]);
console.log("What is the return from the commit action?", ret);
this.startMathEditor(id, mn.node);
};
Application.prototype.findBackgroundImage = function () {
this.backgroundImageId = null;
return this.view.doc.each(false, __bind(function (node) {
if (node.type() === "ImageNode" && node.getProperty("locked") === true) {
this.log("Found background image at nodeid %s", node.id);
return (this.backgroundImageId = node.id);
}
}, this));
};
Application.prototype.setBackgroundImage = function (url) {
var actions = [new SetBackgroundAction(url)];
this.view.commit(actions);
this.view.clearSelection();
return this.view.doneSelecting();
};
Application.prototype.setBackgroundImageFromConfig = function () {
if (this.config.getOption("backgroundImage")) {
this.setBackgroundImage(this.config.getOption("backgroundImage"));
}
};
Application.prototype.newDocument = function () {
return this.setDocument(new ZwibblerDocument());
};
Application.prototype._onResize = function () {
var backgroundSelectorWidth, borderWidth, canvasHeight, colourHeight, colourPanelTop,
debugPanelWidth, fudge, height, imageSelectorHeight, imageSelectorWidth,
menuHeight, propPanelWidth, sideWidth, toolbarWidth, width;
fudge = 5;
width = this.div.width() - fudge;
height = this.div.height() - fudge;
if (width === this.oldWidth && height === this.oldHeight) {
return;
}
this.oldWidth = width;
this.oldHeight = height;
toolbarWidth = this.toolbar.width();
borderWidth = 4;
menuHeight = this.menuBar.height();
if (this.config.hasMenu()) {
this.menuBar.show();
this.menuBar.moveTo(0, 0);
this.menuBar.width(width);
} else {
this.menuBar.hide();
menuHeight = 0;
}
if (this.config.getOption("showBackgroundSelector")) {
backgroundSelectorWidth = 100;
this.backgroundSelector.show();
} else {
backgroundSelectorWidth = 0;
this.backgroundSelector.hide();
}
if (this.config.getOption("showImageSelector")) {
imageSelectorHeight = 100;
this.imageSelector.show();
} else {
imageSelectorHeight = 0;
this.imageSelector.hide();
}
if (this.config.showColourPanel()) {
this.colourPanel.show();
colourHeight = this.colourPanel.height();
} else {
this.colourPanel.hide();
colourHeight = 0;
}
colourPanelTop = height - colourHeight;
sideWidth = 0;
propPanelWidth = 0;
debugPanelWidth = 0;
if (this.showDebug) {
debugPanelWidth = this.debugPanel.width();
}
if (this.config.showPropertyPanel()) {
propPanelWidth = 300;
}
sideWidth += propPanelWidth + debugPanelWidth;
imageSelectorWidth = width - 2 * borderWidth - backgroundSelectorWidth - sideWidth;
canvasHeight = height - 2 * borderWidth - colourHeight - menuHeight - imageSelectorHeight;
this.backgroundSelector.width(backgroundSelectorWidth);
this.backgroundSelector.height(height - 2 * borderWidth - menuHeight - colourHeight);
this.backgroundSelector.moveTo(0, menuHeight);
this.imageSelector.width(imageSelectorWidth);
this.imageSelector.height(imageSelectorHeight);
this.imageSelector.moveTo(backgroundSelectorWidth, height - 2 * borderWidth - colourHeight - imageSelectorHeight);
this.colourPanel.moveTo(0, colourPanelTop);
this.colourPanel.setWidth(width);
this.colourPanel.draw();
if (this.showDebug) {
this.debugPanel.show();
this.debugPanel.moveTo(width - debugPanelWidth, menuHeight);
this.debugPanel.height($(window).height() | 0);
} else {
this.debugPanel.hide();
}
this.view.draw();
};
Application.prototype.setupKeyboardSupport = function () {
var self = this;
this.toolbarInFocus = false;
this.keymap = new KeyboardMap();
this.keymap.map("left", "left");
this.keymap.map("right", "right");
this.keymap.map("up", "up");
this.keymap.map("down", "down");
this.keymap.map("esc", "select-none");
this.keymap.map("esc", "cancel");
this.keymap.map("home", "bring-to-front");
this.keymap.map("end", "send-to-back");
this.keymap.map("pageup", "move-up");
this.keymap.map("pagedown", "move-down");
this.keymap.map("ctrl+d", "duplicate");
this.keymap.map("delete,backspace", "delete");
this.keymap.map("c,C", "curve-tool");
this.keymap.map("l,L", "line-tool");
this.keymap.map("ctrl+shift+g", "ungroup");
this.keymap.map("ctrl+g", "group");
this.keymap.map("ctrl+z", "undo");
this.keymap.map("ctrl+shift+z", "redo");
this.keymap.map("ctrl+x", "cut");
this.keymap.map("ctrl+c", "copy");
this.keymap.map("ctrl+v", "paste");
this.keymap.map("left,up", "previous");
this.keymap.map("down,right", "next");
this.keymap.map("enter", "enter");
this.keymap.on("*", function (action, e) {
if (self.isReadOnly()) {
return;
}
var targetEl = e.target || e.srcElement;
if (targetEl.tagName.toLowerCase() === 'div') {
if (self.toolbarInFocus) {
self.toolbar.onKeyCommand(action, e);
} else {
self.view.onKeyCommand(action, e);
}
}
});
this.div.attr("tabindex", "-1");
this.div.on("focus", function (e) {
self.log("Got keyboard focus");
});
this.div.on("blur", function (e) {
self.log("Lost keyboard focus");
});
this.keymap.attachTo(this.div[0]);
this.canvas.click(function (e) {
self.focus(false);
});
this.toolbar.div.click(function (e) {
self.focus(true);
});
this.colourPanel.on("colour", function (colour) {
self.focus(false);
});
this.eventSource.on("goto-toolbar", function () {
self.focus(true);
});
this.eventSource.on("goto-canvas", function () {
self.focus(false);
});
};
Application.prototype.focus = function (toolbar) {
var container = $('.theQuestions'),
scrollTop = container.scrollTop();
this.toolbarInFocus = toolbar;
if (this.toolbarInFocus) {
this.toolbar.focus();
this.view.hideKeyboardCursor();
} else {
this.toolbar.blur();
}
this.div.focus();
container.scrollTop(scrollTop);
};
Application.prototype.startMovingWithKeyboard = function () {
this.focus(false);
this.view.showKeyboardCursorAndStartMoving();
};
Application.prototype.showKeyboardCursor = function (caret) {
this.focus(false);
this.view.showKeyboardCursor(caret);
};
/@export Application.prototype.emit*/
Application.prototype.emit = function (name, data) {
return this.eventSource.emit(name, data);
};
Application.prototype.saveAsList = function () {
return ZwibblerDocument.exportAsList(this.view.doc.root);
};
Application.prototype.saveAsDataUrl = function () {
var canvas, ctx, rect;
rect = this.view.doc.getRect();
canvas = $("<canvas>");
canvas.attr("width", "" + rect.width);
canvas.attr("height", "" + rect.height);
ctx = canvas[0].getContext("2d");
ctx.translate(-rect.x, -rect.y);
this.view.doc.draw(ctx);
return canvas[0].toDataURL();
};
Application.prototype.loadFromList = function (list) {
return ZwibblerDocument.importFromList(list, this.view.doc);
};
Application.prototype.setZwibblerContext = function (zwibblerContext) {
this.zwibblerContext = zwibblerContext;
this.view.zwibblerContext = zwibblerContext;
if (this.toolbar) {
this.toolbar.zwibblerContext = zwibblerContext;
}
};
Application.prototype.startMathEditor = function (id, mn) {
this.log("Starting equation editor");
if (typeof mn === 'undefined') {
var node = this.view.doc.getNode(id);
if (typeof node === 'undefined')
this.app.newMathML();
else
this.startMathEditor(id, node);
} else {
this.zwibblerContext.emit("math.edit", id, mn);
}
};
Application.prototype.setItemProperty = function (id, property, value) {
this.log("External app setItemProperty %s: %s=%s", id, property, value);
this.view.commit([new SetAction([id], property, value)]);
};
Application.prototype.getItemProperty = function (id, property) {
var node, value;
node = this.view.doc.getNode(id);
value = 0;
if (node) {
value = node.getProperty(property);
}
this.log("GetItemProperty %s: %s=%s", id, property, value);
return value;
};
Application.prototype.isReadOnly = function () {
return this.zwibblerContext && this.zwibblerContext.isReadOnly();
}
if ("jQuery" in window) {
window["jQuery"].fn["zwibbler"] = function (options) {
options = options || {};
var context = null;
this.each(function (i, elem) {
if (elem["zwibbler"]) {
$(elem).empty();
}
var app = new Application($(elem), options);
elem["zwibbler"] = new ZwibblerContext(app);
context = elem["zwibbler"];
});
return context;
};
window["jQuery"].fn["zwibblerContext"] = function () {
return this[0]["zwibbler"];
};
}
var Zwibbler = {
create: function (id, options) {
var div = document.getElementById(id);
if (div === null) {
console.error("Zwibbler.create: Cannot find an element with id " + id);
return null;
}
var app = new Application($(div),
window["Zwibbler"]["parseConfig"](options));
var context = new ZwibblerContext(app);
return context;
},
parseConfig: function (config) {
var object = {};
if (typeof config === "string") {
try {
object = JSON.parse(config);
} catch (e) {
if (config) {
object = JSON.parse(xml2jsonv2(parseXml(config), ""));
if ("scratchpad" in object) {
object = object["scratchpad"];
}
}
}
} else {
object = config;
}
return object;
}
};
window["Zwibbler"] = Zwibbler;
Zwibbler["create"] = Zwibbler.create;
Zwibbler["parseConfig"] = Zwibbler.parseConfig;
var ScratchPad = {};
window['ScratchPad'] = ScratchPad;
ScratchPad.Factory = {
Instance: null,
Sequence: { id: 0 },
getInstance: function () {
if (!ScratchPad.Factory.Instance) {
ScratchPad.Factory.Instance = new ScratchPad.ZwibblerFactory();
}
return ScratchPad.Factory.Instance;
},
setInstance: function (impl) {
ScratchPad.Factory.Instance = impl;
}
};
var ZwibblerFactory = function () {
this.Store = {};
this.targetDom = document.body;
};
ScratchPad.ZwibblerFactory = ZwibblerFactory;
ZwibblerFactory.prototype.createScratchPad = function (id, configuration) {
id = id || 'ScratchPad_' + (++ScratchPad.Factory.Sequence.id);
var zwibbler = Zwibbler.create(this.assureDomExists(id), configuration);
if (zwibbler) {
zwibbler.setInstanceId(id);
}
return zwibbler;
};
ZwibblerFactory.prototype.assureDomExists = function (id, pNode) {
if (!id) { return; }
pNode = pNode || this.targetDom || document.body;
var dom = document.getElementById(id);
if (!dom && pNode) {
dom = document.createElement('div');
dom.id = id;
pNode.appendChild(dom);
}
dom.className += ' sp_container';
return id;
};
ZwibblerFactory.prototype.getGlobalScratchPad = function () {
return this.getScratchPadById('global_scratchpad');
};
ZwibblerFactory.prototype.getOrCreateScratchPadById = function (id,
configuration) {
if (!id) { return; }
configuration = configuration || "";
try {
if (!this.Store[id]) {
this.Store[id] = this.createScratchPad(id, configuration);
}
return this.Store[id];
} catch (e) {
console.error('Failed to create a new instance (id, e)', id, e);
}
return this.Store[id];
};
ZwibblerFactory.prototype.getScratchPadById = function (id) {
try {
if (!id) { return; }
return this.Store[id];
} catch (e) {
console.error('Failed to initialize or find a new Scratchpad (id, e)', id, e);
}
};
ScratchPad["Factory"] = ScratchPad.Factory;
ScratchPad.Factory["getInstance"] = ScratchPad.Factory.getInstance;
ScratchPad["ZwibblerFactory"] = ScratchPad.ZwibblerFactory;
ZwibblerFactory.prototype["getGlobalScratchPad"] = ZwibblerFactory.prototype.getGlobalScratchPad;
ZwibblerFactory.prototype["getOrCreateScratchPadById"] = ZwibblerFactory.prototype.getOrCreateScratchPadById;
ZwibblerFactory.prototype["getScratchPadById"] = ZwibblerFactory.prototype.getScratchPadById;
ZwibblerContext.prototype["enableConsoleLogging"] = ZwibblerContext.prototype.enableConsoleLogging;
ZwibblerContext.prototype["on"] = ZwibblerContext.prototype.on;
ZwibblerContext.prototype["newDocument"] = ZwibblerContext.prototype.newDocument;
ZwibblerContext.prototype["save"] = ZwibblerContext.prototype.save;
ZwibblerContext.prototype["load"] = ZwibblerContext.prototype.load;
ZwibblerContext.prototype["setBackgroundBrowserImages"] = ZwibblerContext.prototype.setBackgroundBrowserImages;
ZwibblerContext.prototype["setIconBrowserImages"] = ZwibblerContext.prototype.setIconBrowserImages;
ZwibblerContext.prototype["resize"] = ZwibblerContext.prototype.resize;
ZwibblerContext.prototype["dirty"] = ZwibblerContext.prototype.dirty;
ZwibblerContext.prototype["setItemProperty"] = ZwibblerContext.prototype.setItemProperty;
ZwibblerContext.prototype["setImage"] = ZwibblerContext.prototype.setImage;
ZwibblerContext.prototype["getItemProperty"] = ZwibblerContext.prototype.getItemProperty;
ZwibblerContext.prototype["setDomElement"] = ZwibblerContext.prototype.setDomElement;
ZwibblerContext.prototype["getInstanceId"] = ZwibblerContext.prototype.getInstanceId;
Application.prototype["newMathML"] = Application.prototype.newMathML;
Application.prototype["emit"] = Application.prototype.emit;
window["Dialog"] = Dialog;
Dialog["emit"] = Dialog.emit;
Dialog["current"] = Dialog.current;
DomNode.prototype["setElement"] = DomNode.prototype.setElement;
} ());

/* SOURCE FILE: speqeditor.js (7f237d63) 9/9/2014 2:09:02 PM */

var SPEquations = {
_store : [],
_storeHash : [],
_activeWndId : '',
_widgetList : [],
cfg : {
width: '500px',
height: '331px',
label: 'Equation Editor'
},
init: function(wndId, equation) {
wndId = 'Eq_Equation_' + wndId;
var wnd = this._store[this._storeHash.indexOf(wndId)];
if (!wnd) {
var dom = this._createDOM(wndId);
wnd = new YAHOO.widget.Dialog(wndId, {
visible: true,
draggable: false,
modal: true,
close: false,
fixedcenter: true,
width: this.cfg.width,
height: this.cfg.height,
zIndex: 1,
postmethod: 'none'
});
var buttons = [
{ text: Messages.get('Cancel'), handler: { fn: this.close, scope: this } },
{ text: Messages.get('Submit and Close'), handler: { fn: this.submit, scope: this }, isDefault: true }
];
wnd.cfg.queueProperty('buttons', buttons);
wnd.setHeader(this.cfg.label);
this._applyCSS(wnd);
this._storeHash.push(wndId);
this._store.push(wnd);
}
this._activeWndId = wndId;
var widget = this._createEquation(wndId, equation);
this._widgetList.push(widget);
return this;
},
_createDOM: function(wndId) {
var dom = document.getElementById(wndId);
if (!dom) {
dom = document.createElement('form');
dom.id = wndId;
dom.className += 'notes_dialog_form notes_dialog_form_equation';
document.body.appendChild(dom);
}
var cId = 'note_container_' + wndId;
var c = document.getElementById(cId);
if (!c) {
c = document.createElement('div');
c.className = 'notes_dialog_container';
c.id = cId;
dom.appendChild(c);
}
return dom;
},
_createEquation: function (wndId, equation) {
var widget = this._widgetList[this._storeHash.indexOf(wndId)];
if (!widget) {
widget = new MathJax.Editor.Widget({
containerId: 'note_container_' + wndId,
RestrictKeysToContent: true,
tabs: true,
tabConfig: {
Order: ['Algebra', 'Basic']
}
});
}
if (typeof equation.properties.data === "object") {
widget.updateEditors(equation.properties.data.mathML);
}
return widget;
},
_applyCSS: function(wnd) {
YAHOO.util.Dom.addClass(wnd.element, 'TDS_Notes_dialog');
YAHOO.util.Dom.addClass(wnd.innerElement, 'comment');
YAHOO.util.Dom.addClass(wnd.header, 'comment-header');
YAHOO.util.Dom.addClass(wnd.body, 'comment-body');
YAHOO.util.Dom.addClass(wnd.form, 'comment-form');
},
show: function() {
var wnd = this._store[this._storeHash.indexOf(this._activeWndId)];
if (wnd) {
wnd.render(document.body);
wnd.show();
}
},
preSave: function () { return true; },
submit: function () {
var widget = this._widgetList[this._storeHash.indexOf(this._activeWndId)];
var wnd = this._store[this._storeHash.indexOf(this._activeWndId)];
var args = {
id: this._activeWndId,
data: {
type: 'Equation',
comment: widget.serializeSettings()
}
};
this.preSave(args, wnd);
this._remove();
},
preClose: function() { return true; },
close: function() {
this.preClose();
this._remove();
},
_remove: function() {
var wnd = this._store[this._storeHash.indexOf(this._activeWndId)];
var wdget = this._widgetList[this._storeHash.indexOf(this._activeWndId)];
if (wnd) {
wdget.clearAll();
wnd.hide();
}
}
};

/* SOURCE FILE: widget.js (18ba6556) 9/9/2014 2:09:02 PM */

(function(CM, ScratchPad) {
if (!ScratchPad) {
return;
}
function editListener(nodeId, node) {
console.log("what is this?", this, nodeId);
var isNew = (typeof node.properties.data === 'object') ? false : true;
var wnd = SPEquations.init(this.id, node);
wnd.show();
wnd.preSave = function (args, eqWnd) {
console.log("$$$$equation item save", this);
var data = args.data ? args.data.comment : {};
data.isNew = isNew;
this.setItemProperty(nodeId, 'data', data);
return false;
}.bind(this);
wnd.preClose = function () {
console.log("$$$$equation item cancel", this);
if (isNew) {
this.app.view.eventSource.emit("menu.undo", {});
}
return false;
}.bind(this);
}
function parseImageFiles(questionXml) {
var eachNode = function (nodeList, func) {
var nodes = [];
for (var i = 0; i < nodeList.length; i++) {
nodes.push(nodeList[i] || nodeList.item(i));
}
YAHOO.util.Dom.batch(nodes, func);
};
var getTextContent = function (node) {
if (node && node.childNodes && node.childNodes.length)
return node.childNodes[0].nodeValue;
return null;
};
var imageFiles = [];
var xmlDoc = Util.Xml.parseFromString(questionXml);
var imageNodes = xmlDoc.getElementsByTagName('backgroundImage');
eachNode(imageNodes, function (imageNode) {
var imageFile = getTextContent(imageNode);
if (imageFiles.indexOf(imageFile) == -1) imageFiles.push(imageFile);
});
return imageFiles;
};
function loadImageFiles(page, questionXml) {
var imageFiles = parseImageFiles(questionXml);
for (var i = 0; i < imageFiles.length; i++) {
var imageFile = imageFiles[i];
var imageUrl = resolveUrl(imageFile);
var img = new Image();
page.getRenderer().addImage(img);
img.src = imageUrl;
}
};
function resolveUrl(url) {
url = url.replace(/&amp;/g, '&');
url = url.split('&').join('&amp;').split('<').join('&lt;').split('"').join('&quot;');
var el = document.createElement('div');
el.innerHTML = '<a href="' + url + '">x</a>';
return el.firstChild.href;
};
ScratchPad.Config = ScratchPad.Config || {};
ScratchPad.Config.DefaultLabel = CM.getCommentLabel();
ScratchPad.Config.CommentCode = 'ScratchPad';
function match(page, item, config) {
var id = 'ScratchPad_' + item.position;
var el = document.getElementById(id);
if (el && item.rendererSpec) {
return new CM.WidgetConfig(id, el, item.rendererSpec);
}
return false;
}
function Widget_SP(page, item, content) {
this.scratchpad = null;
}
CM.registerWidget('scratchpad', Widget_SP, match);
Widget_SP.prototype.init = function () {
loadImageFiles(this.page, this.entity.rendererSpec);
}
Widget_SP.prototype.load = function() {
var item = this.entity;
var sp = ScratchPad.Factory.getInstance().createScratchPad(this.id, this.config);
this.scratchpad = sp;
setTimeout(function () {
sp.app.resizeCanvas();
sp.app.view.draw();
if (item.value) {
sp.setResponseXml(item.value);
}
}, 100);
sp.on('math.edit', editListener.bind(sp));
sp.isReadOnly = item.isReadOnly;
}
Widget_SP.prototype.zoom = function(level) {
this.scratchpad.app.zoom(level);
}
Widget_SP.prototype.getResponse = function () {
var value = this.scratchpad.getResponseXml();
var isValid = this.scratchpad.isValid();
return this.createResponse(value, isValid);
}
Widget_SP.prototype.setResponse = function (value) {
this.scratchpad.setResponseXml(value);
}
})(window.ContentManager, window.ScratchPad);

/* SOURCE FILE: audio.js (46046b58) 9/9/2014 2:09:01 PM */

if (typeof AsiItem != 'object') AsiItem = {};
if (typeof AsiItem.Audio != 'object') AsiItem.Audio = {};
(function(SM, Audio) {
SM.audioFormats.mp3.required = false;
var rebooted = false;
function setup(flashPath) {
SM.setup({
url: flashPath,
flashVersion: 9,
preferFlash: false,
useHTML5Audio: true
});
SM.ontimeout(function() {
console.warn('AudioManager Error: SM2 timeout');
if (!rebooted) {
rebooted = true;
setTimeout(function() {
SM.reboot();
}, 1000);
}
});
}
function parseSources(el) {
var sources = [];
if (el.nodeName == 'A') {
sources.push({
url: decodeURIComponent(el.href),
type: el.getAttribute('type')
});
} else if (el.nodeName == 'AUDIO') {
for (var i = 0; i < el.children.length; ++i) {
var source = el.children[i];
sources.push({
url: decodeURIComponent(source.src),
type: source.type
});
}
}
return sources;
};
function getPlayableSource(el) {
var sources = parseSources(el);
for (var i = 0; i < sources.length; i++) {
var source = sources[i];
var url = source.url ? source.url : null;
if (url && SM.canPlayURL(url)) {
return source;
}
}
return null;
}
function createSound(id, url) {
var config = {
id: id,
url: url
};
var sound = new Audio.Sound(config);
return sound;
}
function createSoundFromElement(id, el, config) {
var source = getPlayableSource(el);
if (source == null) return null;
config = config || {};
config.id = id;
config = YAHOO.lang.augmentObject(config, source);
var sound = new Audio.Sound(config);
return sound;
}
Audio.setup = setup;
Audio.onReady = SM.onready;
Audio.stopAll = SM.stopAll;
Audio.getPlayableSource = getPlayableSource;
Audio.createSound = createSound;
Audio.createSoundFromElement = createSoundFromElement;
})(soundManager, AsiItem.Audio);

/* SOURCE FILE: sound.js (57e6e77e) 9/9/2014 2:09:01 PM */

(function(SM, Audio) {
var Sound = function(settings) {
this.onPlay = new YAHOO.util.CustomEvent('onPlay', this, false, YAHOO.util.CustomEvent.FLAT);
this.onStop = new YAHOO.util.CustomEvent('onStop', this, false, YAHOO.util.CustomEvent.FLAT);
this.onFinish = new YAHOO.util.CustomEvent('onFinish', this, false, YAHOO.util.CustomEvent.FLAT);
this.onIdle = new YAHOO.util.CustomEvent('onIdle', this, false, YAHOO.util.CustomEvent.FLAT);
this.onFailure = new YAHOO.util.CustomEvent('onFailure', this, false, YAHOO.util.CustomEvent.FLAT);
settings.onload = this._onLoad.bind(this);
settings.onplay = this._onPlay.bind(this);
settings.onstop = this._onStop.bind(this);
settings.onfinish = this._onFinish.bind(this);
settings.onfailure = this._onFailure.bind(this);
this._service = SM.createSound(settings);
};
Sound.prototype.getId = function() {
return this._service.id;
};
Sound.prototype.isPlaying = function() {
return (this._service.playState === 1);
};
Sound.prototype.play = function() {
var result = this._service.play();
if (result && result.readyState !== 2) {
return true;
} else {
return false;
}
};
Sound.prototype.stop = function() {
return this._service.stop();
};
Sound.prototype._onLoad = function(success) {
if (success === false) {
console.log('AUDIO FAILED: ' + this.getId());
YAHOO.lang.later(0, this.onFailure, this.onFailure.fire, this);
}
};
Sound.prototype._onPlay = function() {
console.log('AUDIO PLAY: ' + this.getId());
YAHOO.lang.later(0, this.onPlay, this.onPlay.fire, this);
};
Sound.prototype._onStop = function() {
console.log('AUDIO STOP: ' + this.getId());
YAHOO.lang.later(0, this.onStop, this.onStop.fire, this);
YAHOO.lang.later(0, this.onIdle, this.onIdle.fire, this);
};
Sound.prototype._onFinish = function() {
console.log('AUDIO FINISH: ' + this.getId());
YAHOO.lang.later(0, this.onFinish, this.onFinish.fire, this);
YAHOO.lang.later(0, this.onIdle, this.onIdle.fire, this);
};
Sound.prototype._onFailure = function() {
console.log('AUDIO FAILURE: ' + this.getId());
YAHOO.lang.later(0, this.onFailure, this.onFailure.fire, this);
};
Audio.Sound = Sound;
})(soundManager, AsiItem.Audio);

/* SOURCE FILE: queue.js (a816ccdf) 9/9/2014 2:09:01 PM */

(function(YAHOO, Audio) {
var numInstances = 0;
var Queue = function() {
this._instance = ++numInstances;
this._isStarted = false;
this._sounds = [];
this._current = null;
this.onStart = new YAHOO.util.CustomEvent('onStart', this, false, YAHOO.util.CustomEvent.FLAT);
this.onStop = new YAHOO.util.CustomEvent('onStop', this, false, YAHOO.util.CustomEvent.FLAT);
};
Queue.prototype.getSounds = function() {
return this._sounds;
};
Queue.prototype.add = function(sound) {
this._log('Add', sound);
sound.onFailure.subscribe(this._onStop, this, true);
sound.onStop.subscribe(this._onStop, this, true);
sound.onIdle.subscribe(this._onFinish, this, true);
this._sounds.push(sound);
};
Queue.prototype.remove = function(sound) {
sound.onFailure.subscribe(this._onStop, this, true);
sound.onStop.unsubscribe(this._onStop, this, true);
sound.onIdle.unsubscribe(this._onFinish, this, true);
Util.Array.remove(this._sounds, sound);
};
Queue.prototype.clear = function() {
for (var i = 0; i < this._sounds.length; i++) {
this.remove(this._sounds[i]);
}
};
Queue.prototype.dispose = function() {
this._log('Dispose');
this.stop();
this.clear();
this.onStart.unsubscribeAll();
this.onStop.unsubscribeAll();
};
Queue.prototype.isStarted = function() {
return this._isStarted;
};
Queue.prototype.getCurrent = function() {
return this._current;
};
Queue.prototype.start = function() {
if (this._isStarted) {
return false;
}
if (this._sounds.length == 0) {
return false;
}
var played = this._play(this._sounds[0]);
if (played) {
this._log('Start');
this._isStarted = true;
this.onStart.fire(this);
}
return played;
};
Queue.prototype.stop = function() {
if (this._current) {
this._current.stop();
}
};
Queue.prototype._play = function(sound) {
if (sound.play()) {
this._current = sound;
return true;
} else {
return false;
}
};
Queue.prototype._onStop = function(sound) {
if (!this._isStarted) return;
if (this._current != sound) return;
this._setStopped();
};
Queue.prototype._onFinish = function(sound) {
if (!this._isStarted) return;
if (this._current != sound) return;
var inactiveIdx = this._sounds.indexOf(sound);
if (inactiveIdx == -1) return;
var nextSound = this._sounds[inactiveIdx + 1];
if (nextSound) {
if (!this._play(nextSound)) {
this._setStopped();
}
} else {
this._setStopped();
}
};
Queue.prototype._setStopped = function() {
if (!this._isStarted) return;
this._log('Stop');
this._isStarted = false;
this._current = null;
this.onStop.fire(this);
};
Queue.prototype._log = function(name, sound) {
var msg = 'AUDIO QUEUE ' + this._instance + ': ' + name;
if (sound) {
msg += ' - ' + sound.getId();
}
console.log(msg);
};
Audio.createQueue = function() {
return new Queue();
};
})(YAHOO, AsiItem.Audio);

/* SOURCE FILE: asi.parse.js (0684ef0c) 9/9/2014 2:09:01 PM */

AsiItem = (typeof (AsiItem) == "undefined") ? {} : AsiItem;
AsiItem.Parse = function (item) {
var YUD = YAHOO.util.Dom;
var YUE = YAHOO.util.Event;
this.mid = item.position;
this.createAsiChoices = function () {
var stem = item.getStemElement();
var answers = YUD.get('ScaffoldingContainer_' + this.mid);
this.identifier = 'ScaffoldingItemId_' + this.mid;
this.stem = stem;
this.asiContent = this.processNodes(stem, answers);
this.minSelection = 1;
this.maxAttempts = (this.asiContent.choices.length) - 1;
answers.innerHTML = '';
};
};
AsiItem.Parse.prototype.processNodes = function (aStem, aAnswers) {
aStem.audioCue = this.processSoundLinks(this.stem);
var choiceAr = [];
var feedbackAr = [];
var choiceElems = aAnswers.getElementsByTagName('div');
for (var j = 0; j < choiceElems.length; ++j) {
var choice = choiceElems[j];
var id = YUD.getAttribute(choice, 'data-asi-identifier');
if (id && id.length > 0) {
var feedback = this.readFeedbackContent(choice, j);
if (feedback) {
feedbackAr[feedback.identifier] = feedback;
}
}
}
for (j = 0; j < choiceElems.length; ++j) {
choice = choiceElems[j];
id = YUD.getAttribute(choice, 'data-asi-identifier');
if (id && id.length > 0)
{
var choiceContent = {
identifier: id,
complete: choice.getAttribute('data-asi-complete'),
audioCue: this.processSoundLinks(choice),
content: {
htmlContent: this.readChoiceContent(choice, j),
feedback: feedbackAr[id]
}
};
if (choiceContent.audioCue != null)
choiceAr.push(choiceContent);
}
}
return {
stem: this.stem,
choices: choiceAr
};
};
AsiItem.Parse.prototype.processSoundLinks = function (parentSpan) {
var anchors = parentSpan.getElementsByTagName('a');
for (var i = 0; i < anchors.length; ++i) {
var anchor = anchors[i];
var source = AsiItem.Audio.getPlayableSource(anchor);
if (source != null) {
anchor.parentNode.removeChild(anchor);
return source.url;
}
}
return null;
};
AsiItem.Parse.prototype.readChoiceContent = function (choice, index) {
var choiceChildNodes = choice.childNodes;
var htmlContent;
var htmlContentString = '';
for (var k = 0; k < choiceChildNodes.length; ++k) {
if (choiceChildNodes[k].nodeType == 1) {
var childNode = choiceChildNodes[k];
var feedbackId = YUD.getAttribute(childNode, 'data-feedback-identifier');
if (feedbackId && feedbackId.length > 0) {
continue;
}
else {
htmlContentString = htmlContentString + Util.Xml.serializeToString(choiceChildNodes[k]);
}
}
}
htmlContent = document.createElement('div');
AsiItem.Html.setSpanId(htmlContent,this.mid, index);
htmlContent.innerHTML = htmlContentString;
return htmlContent;
};
AsiItem.Parse.prototype.readFeedbackContent = function (choice, index) {
var choiceChildNodes = choice.childNodes;
var feedback = null;
for (var k = 0; k < choiceChildNodes.length; ++k) {
if (choiceChildNodes[k].nodeType == 1) {
var childNode = choiceChildNodes[k];
var feedbackId = YUD.getAttribute(childNode, 'data-feedback-identifier');
if (feedbackId && feedbackId.length > 0) {
feedback = this.getFeedback(childNode, feedbackId);
}
}
}
return feedback;
};
AsiItem.Parse.prototype.getFeedback = function (feedbackElement, identifier) {
var feedbackContainer = document.createElement('div');
feedbackContainer.appendChild(feedbackElement);
var feedback = {
identifier: identifier,
audioCue: this.processSoundLinks(feedbackElement),
feedbackContainer: feedbackContainer
};
return feedback;
};

/* SOURCE FILE: asi.audio.js (0c22acce) 9/9/2014 2:09:01 PM */

AsiItem = (typeof (AsiItem) == "undefined") ? {} : AsiItem;
AsiItem.AudioInterface = function () {
this._tracksToPlay = [];
this._lastPlayed = 0;
this._audioQ = AsiItem.Audio.createQueue();
var self = this;
this.disposed = false;
this.add = function (url, id, startFunction, stopFunction, instance) {
var obj = {
url: url,
id: id,
startFunction: startFunction,
stopFunction: stopFunction,
instance: instance
};
this._tracksToPlay.push(obj);
var audioData = AsiItem.AudioInterface.audioData[id];
if (audioData == null) {
audioData = AsiItem.Audio.createSound(id, url);
AsiItem.AudioInterface.audioData[id] = audioData;
}
audioData.onPlay.subscribe(function () {
if (self.disposed)
return;
self.onStart();
});
audioData.onIdle.subscribe(function () {
if (self.disposed)
return;
self.onStop();
});
this._audioQ.add(audioData);
};
};
AsiItem.AudioInterface.prototype.dispose = function () {
AsiItem.EventLog('AudioInterface - dispose');
this._audioQ.dispose();
this.disposed = true;
};
AsiItem.AudioInterface.prototype.start = function () {
this._audioQ.start();
};
AsiItem.AudioInterface.prototype.stop = function () {
this._audioQ.stop();
};
AsiItem.AudioInterface.prototype.onStop = function () {
if ((this._lastPlayed > 0) && (this._tracksToPlay.length > this._lastPlayed - 1)) {
var current = this._tracksToPlay[this._lastPlayed - 1];
var spid = current.id;
var instance = current.instance;
if (current.stopFunction)
current.stopFunction(spid, instance);
}
};
AsiItem.AudioInterface.prototype.onStart = function () {
if (this._tracksToPlay.length > this._lastPlayed) {
var current = this._tracksToPlay[this._lastPlayed];
var spid = current.id;
var instance = current.instance;
if (current.startFunction) {
current.startFunction(spid, instance);
}
}
this._lastPlayed++;
};
AsiItem.AudioInterface.audioData = [];

/* SOURCE FILE: asi.wapiaudio.js (39f5a052) 9/9/2014 2:09:01 PM */

AsiItem = (typeof (AsiItem) == "undefined") ? {} : AsiItem;
AsiItem.WAPIAudioInterface = function (context) {
this._tracksToPlay = [];
this._currentTrack = 0;
this.disposed = false;
this._context = context;
this._source = null;
this._isPlaying = false;
this._timer = null;
};
AsiItem.WAPIAudioInterface.prototype.add = function (url, id, startFunction, stopFunction, instance) {
var buffer = AsiItem.WAPIAudioInterface.audioDataHash[url];
if (buffer === 'undefined') {
AsiItem.EventLog("WAPIAudioInterface.add - Audio is not preloaded.");
return;
}
var track = {
url: url,
id: id,
startFunction: startFunction,
stopFunction: stopFunction,
instance: instance,
audioData: buffer
};
this._tracksToPlay.push(track);
};
AsiItem.WAPIAudioInterface.prototype.start = function () {
if (this._isPlaying) {
this.stop();
}
AsiItem.EventLog("WAPI Interface start - Intialize player for playing");
this._currentTrack = 0;
this._isPlaying = true;
this.playCurrentTrack();
};
AsiItem.WAPIAudioInterface.prototype.createSource = function (buffer) {
var source = this._context.createBufferSource();
source.buffer = buffer;
source.connect(this._context.destination);
return source;
};
AsiItem.WAPIAudioInterface.prototype.playCurrentTrack = function () {
var audioData = AsiItem.WAPIAudioInterface.audioDataHash[this._tracksToPlay[this._currentTrack].url];
if (!audioData) {
AsiItem.EventLog("WAPIAudioInterface.playCurrentTrack - audioData no longer available.");
while (this._currentTrack < this._tracksToPlay.length) {
var current = this._tracksToPlay[this._currentTrack];
current.startFunction(current.id, current.instance);
current.stopFunction(current.id, current.instance);
this._currentTrack += 1;
}
return;
}
var source = this.createSource(audioData);
var duration = audioData.duration;
this._source = source;
source.start ? source.start(0) : source.noteOn(0);
this.onTrackStarted();
var self = this;
var recurse = arguments.callee;
var delayInSeconds = 1;
this._timer = setTimeout(function() {
self.onTrackEnded();
self._currentTrack += 1;
if (self._currentTrack < self._tracksToPlay.length) {
recurse.call(self);
} else {
self.stop();
}
},
(duration + delayInSeconds) * 1000);
};
AsiItem.WAPIAudioInterface.prototype.stop = function () {
clearTimeout(this._timer);
if (this._source && this._isPlaying) {
this._source.stop ? this._source.stop(0) : this._source.noteOff(0);
}
this._isPlaying = false;
};
AsiItem.WAPIAudioInterface.prototype.dispose = function () {
this._tracksToPlay = [];
this.disposed = true;
this._context = null;
this._source = null;
this._isPlaying = false;
this._timer = null;
this.audioDataHash = {};
};
AsiItem.WAPIAudioInterface.prototype.onTrackStarted = function () {
if (this._currentTrack < this._tracksToPlay.length) {
var current = this._tracksToPlay[this._currentTrack];
if (current.startFunction) {
current.startFunction(current.id, current.instance);
}
}
};
AsiItem.WAPIAudioInterface.prototype.onTrackEnded = function () {
if (this._currentTrack < this._tracksToPlay.length && this._isPlaying) {
var current = this._tracksToPlay[this._currentTrack];
if (current.stopFunction) {
current.stopFunction(current.id, current.instance);
}
}
};
AsiItem.WAPIAudioInterface.audioDataHash = {};

/* SOURCE FILE: asi.audiofactory.js (2b04d490) 9/9/2014 2:09:01 PM */

AsiItem = (typeof (AsiItem) == "undefined") ? {} : AsiItem;
AsiItem.AudioPlayerFactory = function () {
if (AsiItem.AudioPlayerFactory.Context === undefined) {
AsiItem.AudioPlayerFactory.Context = null;
window.AudioContext = window.AudioContext || window.webkitAudioContext;
if (!window.AudioContext) {
AsiItem.EventLog('Web Audio API is not supported in this browser.');
} else {
try {
var audioContext = new window.AudioContext();
AsiItem.AudioPlayerFactory.Context = audioContext;
} catch (e) {
AsiItem.EventLog('Web Audio API not supported on this browser');
}
}
}
if (AsiItem.AudioPlayerFactory.Context !== null) {
this.context = AsiItem.AudioPlayerFactory.Context;
this.EnvSupportsWebAPI = true;
} else {
this.EnvSupportsWebAPI = false;
}
};
AsiItem.AudioPlayerFactory.prototype.createAudioInterface = function () {
if (this.EnvSupportsWebAPI) {
return new AsiItem.WAPIAudioInterface(this.context);
} else {
return new AsiItem.AudioInterface();
}
};
AsiItem.AudioPlayerFactory.prototype.onReady = function (playerContent, onReady) {
if (!this.EnvSupportsWebAPI) {
onReady();
return;
}
try {
var loader = new AsiItem.AudioPlayerFactory.BufferLoader(
this.context,
playerContent,
function() {
AsiItem.EventLog('onReady - ASI audio content loaded');
onReady();
});
} catch (e) {
AsiItem.EventLog('Failed to load audio tracks for Web Audio API... reverting to SM2 audio');
this.EnvSupportsWebAPI = false;
onReady();
}
};
AsiItem.AudioPlayerFactory.BufferLoader = function (context, playerContent, callback) {
this.context = context;
this.onLoadComplete = callback;
this.loadCount = 0;
var len = playerContent ? playerContent.length : 0;
var loadInitiated = {};
for (var i = 0; i < len; ++i) {
if (typeof loadInitiated[playerContent[i].url] === 'undefined') {
loadInitiated[playerContent[i].url] = true;
this.loadBuffer(playerContent[i], playerContent.length);
} else {
this.loadCount += 1;
}
}
};
AsiItem.AudioPlayerFactory.BufferLoader.prototype.loadBuffer = function (track, numTracks) {
var request = new XMLHttpRequest();
request.open("GET", track.url, true);
request.responseType = "arraybuffer";
var self = this;
request.onload = function() {
self.context.decodeAudioData(
request.response,
function(decodedBuffer) {
if (!decodedBuffer) {
AsiItem.EventLog('BufferLoader.loadBuffer: Error decoding file data');
return;
}
AsiItem.EventLog('BufferLoader.loadBuffer: Buffer decoded successfully (' + self.loadCount + ')');
if (typeof AsiItem.WAPIAudioInterface.audioDataHash[track.url] !== 'undefined') {
AsiItem.EventLog('BufferLoader.loadBuffer: Track ' + track.url + ' already loaded');
}
AsiItem.WAPIAudioInterface.audioDataHash[track.url] = decodedBuffer;
self.loadCount += 1;
if (self.loadCount === numTracks) {
self.onLoadComplete();
}
},
function(error) {
AsiItem.EventLog('BufferLoader.loadBuffer: decodeAudioData error');
}
);
};
request.onerror = function () {
AsiItem.EventLog('BufferLoader.loadBuffer: XHR error');
};
request.send();
};

/* SOURCE FILE: asi.html.js (0c30bd88) 9/9/2014 2:09:01 PM */

AsiItem = (typeof (AsiItem) == "undefined") ? {} : AsiItem;
AsiItem.EventLog = function(str) {
if (AsiItem.EventLog.enabled) {
ContentManager.log('ASI: ' + str);
}
};
AsiItem.EventLog.enabled = true;
AsiItem.Html = function (parser, parentDiv) {
this._parentDiv = parentDiv;
this._parser = parser;
this._stemCell = parser.stem;
this.setSpanId(this._stemCell, 'asiStem');
};
AsiItem.Html.prototype.getStemCell = function () {
return this._stemCell;
};
AsiItem.Html.prototype.getParentDiv = function() {
return this._parentDiv;
};
AsiItem.Html.prototype.resetInteractions = function(responseSpanIds) {
for (var i = 0; i < responseSpanIds.length; ++i) {
YUD.addClass(responseSpanIds, 'asi-response-hidden');
YUD.removeClass(responseSpanIds, 'asi-response-shown');
YUD.removeClass(responseSpanIds, 'asi-response-subdued');
}
};
AsiItem.Html.prototype.showFeedbackHideResponse = function (fSpan, rSpan) {
var region = YUD.getRegion(rSpan);
YUD.removeClass(rSpan, 'asi-response-shown');
YUD.removeClass(fSpan, 'asi-response-hidden');
YUD.addClass(rSpan, 'asi-response-hidden');
YUD.addClass(fSpan, 'asi-feedback-shown');
YUD.setStyle(fSpan, 'width', region.width.toString() + 'px');
YUD.setStyle(fSpan, 'height', region.height.toString() + 'px');
};
AsiItem.Html.prototype.createAudioButton = function () {
var audioWidget = document.createElement('button');
audioWidget.type = 'button';
this.setPlayIcon(audioWidget);
YUD.addClass(audioWidget, 'asi-playback-span');
return audioWidget;
};
AsiItem.Html.prototype.allowInteractiveGui = function () {
YUD.addClass(this._stemCell, 'stemContainer contextAreaFocus asi-stem');
};
AsiItem.Html.prototype.setPlayIcon = function (widget) {
AsiItem.EventLog('setPlayIcon');
YUD.removeClass(widget, 'asi-stop-button');
YUD.addClass(widget, 'asi-playback-button');
YUD.removeClass(widget, 'asi-response-subdued');
};
AsiItem.Html.prototype.subduePlayIcon = function (widget) {
AsiItem.EventLog('subduePlayIcon');
YUD.addClass(widget, 'asi-response-subdued');
};
AsiItem.Html.prototype.setStopIcon = function (widget) {
AsiItem.EventLog('setStopIcon');
YUD.removeClass(widget, 'asi-playback-button');
YUD.addClass(widget, 'asi-stop-button');
YUD.removeClass(widget, 'asi-response-subdued');
};
AsiItem.Html.prototype.enableResponses = function (responseArray) {
AsiItem.EventLog('enableResponses');
for (var i = 0; i < responseArray.length; ++i) {
var span = YUD.get(responseArray[i]);
AsiItem.EventLog('enableResponses span ' + YUD.getAttribute(span, 'id'));
YUD.removeClass(span, 'asi-response-subdued');
YUD.removeClass(span, 'asi-response-emphasis');
YUD.addClass(span, 'asi-response-enabled');
var audioResponse = this.getAudioSpanFromResponseSpan(span);
if (audioResponse) {
YUD.removeClass(audioResponse, 'asi-response-subdued');
YUD.removeClass(audioResponse, 'asi-stop-button');
YUD.addClass(audioResponse, 'asi-playback-button');
}
}
};
AsiItem.Html.prototype.emphasizeResponse = function(span) {
YUD.addClass(span, 'asi-response-emphasis');
YUD.addClass(span, 'asi-response-shown');
YUD.removeClass(span, 'asi-response-subdued');
YUD.removeClass(span, 'asi-response-hidden');
};
AsiItem.Html.prototype.disableResponses = function (responseArray) {
AsiItem.EventLog('disableResponses');
for (var i = 0; i < responseArray.length; ++i) {
var span = YUD.get(responseArray[i]);
AsiItem.EventLog('disableResponses span ' + YUD.getAttribute(span, 'id'));
YUD.removeClass(span, 'asi-response-enabled');
YUD.removeClass(span, 'asi-response-emphasis');
}
};
AsiItem.Html.prototype.subdueSpan = function (span) {
YUD.addClass(span, 'asi-response-subdued');
YUD.removeClass(span, 'asi-response-emphasis');
};
AsiItem.Html.prototype.subdueResponses = function (responseArray) {
AsiItem.EventLog('subdueResponses');
for (var i = 0; i < responseArray.length; ++i) {
var span = YUD.get(responseArray[i]);
AsiItem.EventLog('subdue span ' + YUD.getAttribute(span, 'id'));
this.subdueSpan(span);
}
};
AsiItem.Html.prototype.createSpanId = function (purpose) {
return AsiItem.Html.createSpanId(this._parser.mid, purpose);
};
AsiItem.Html.prototype.setSpanId = function (stemDiv, purpose) {
AsiItem.Html.setSpanId(stemDiv, this._parser.mid, purpose);
};
AsiItem.Html.createSpanId = function (itemId, purpose) {
return 'asi-' + itemId.toString() + '-' + purpose;
};
AsiItem.Html.setSpanId = function (spanId, itemId, purpose) {
YUD.setAttribute(spanId, 'id', AsiItem.Html.createSpanId(itemId, purpose));
};
AsiItem.Html.prototype.getResponseIndex = function (span) {
var id = '';
if (typeof (span) == "string") {
id = span;
} else {
id = YUD.getAttribute(span, 'id');
}
var idSplit = id.split('-');
if (idSplit.length >= 4) {
return idSplit[3];
}
return '';
};
AsiItem.Html.prototype.getRelatedFeedbackSpan = function (span) {
var fid = AsiItem.Html.createSpanId(this._parser.mid, 'feedback-' + this.getResponseIndex(span));
var fspan = YUD.get(fid);
return fspan;
};
AsiItem.Html.prototype.getResponseSpanFromIdentifier = function (identifier) {
var choiceContent = this._parser.asiContent.choices;
for (var i = 0; i < choiceContent.length; i++) {
var choice = choiceContent[i];
if (choice.identifier == identifier) {
var spid = this.createSpanId('response-' + i.toString());
return YUD.get(spid);
}
}
return null;
};
AsiItem.Html.prototype.getAudioSpanFromResponseSpan = function (responseSpan) {
var id = responseSpan;
if (typeof (responseSpan) == 'object') {
id = responseSpan.id;
}
var rindex = this.getResponseIndex(id);
var responseAudioSpanIndex = this.createSpanId('audioResponse-' + rindex);
var responseAudioSpan = YUD.get(responseAudioSpanIndex);
return responseAudioSpan;
};

/* SOURCE FILE: asi.interaction.js (cf0b7512) 9/9/2014 2:09:01 PM */

AsiItem.Interaction = function (asiHtmlObject, parser,voiceGuidance) {
this._html = asiHtmlObject;
this._parser = parser;
this._voiceGuidance = voiceGuidance;
this._playSourceFromResponse = false;
this._player = null;
this._responsePlayer = null;
this._isPlaying = false;
this._isResponsePlaying = false;
this._isFeedbackPlaying = false;
this._attempts = [];
this._terminateEvent = new YAHOO.util.CustomEvent('onTerminate', this);
this._responseSpanIds = [];
this.complete = false;
this.responsesLeft = parser.maxAttempts;
this.isReadOnly = function() { return false; };
this._html.setSpanId(this._stemCell, 'asiStem');
this._playbackInfo = {
stemId: YUD.getAttribute(this._html.getStemCell(), 'id'),
stemAudio: parser.asiContent.stem.audioCue,
playStemAudio: true,
responseAudio: []
};
this._terminalSpanIds = [];
this._spanToIdentifierMap = [];
this.audioWidget = null;
this._responseButtons = [];
this.hasPlayedOnce = false;
this._feedbackCues = [];
this._responseIdentifiers = [];
this._audioFactory = new AsiItem.AudioPlayerFactory();
};
AsiItem.Interaction.prototype.hidePage = function () {
if (this.complete)
return;
if (this._isPlaying && this._player) {
this._player.stop();
this._player.dispose();
this._player = null;
this._isPlaying = false;
}
if (this._isResponsePlaying && this._responsePlayer) {
this._responsePlayer.stop();
this._responsePlayer.dispose();
this._responsePlayer = null;
this._isResponsePlaying = false;
}
if (this._voiceGuidance && this.hasPlayedOnce) {
this._html.enableResponses(this._responseSpanIds);
this._html.setPlayIcon(this.audioWidget);
} else if (this._voiceGuidance) {
this._html.resetInteractions(this._responseSpanIds);
this._html.setPlayIcon(this.audioWidget);
}
};
AsiItem.Interaction.prototype.startInteraction = function (valueToRestore) {
var self = this;
if (this._voiceGuidance) {
var playerContent = [];
var stemId = YUD.getAttribute(this._html.getStemCell(), 'id');
var stemAudio = this._parser.asiContent.stem.audioCue;
var track = {
id: stemId,
url: stemAudio,
audioData: null
};
playerContent.push(track);
var choiceContent = this._parser.asiContent.choices;
for (var i = 0; i < choiceContent.length; i++) {
var respSpanId = this._html.createSpanId('response-' + i.toString());
track = {
id: respSpanId,
url: choiceContent[i].audioCue,
audioData: null
};
playerContent.push(track);
var feedbackSpanId = this._html.createSpanId('feedback-' + i.toString());
if (choiceContent[i].audioCue) {
track = {
id: feedbackSpanId,
url: choiceContent[i].audioCue,
audioData: null
};
playerContent.push(track);
}
}
this._audioFactory.onReady(playerContent, function() {
self.constructAudioTag(self._html.getStemCell());
self.populateResponses(self._parentDiv, self._voiceGuidance);
self._html.allowInteractiveGui();
self._playSourceFromResponse = false;
if (valueToRestore) {
self.setResponse(valueToRestore);
}
});
} else {
this.populateResponses(this._parentDiv, this._voiceGuidance);
this._html.allowInteractiveGui();
if (valueToRestore) {
self.setResponse(valueToRestore);
}
}
};
AsiItem.Interaction.prototype.playStory = function () {
AsiItem.EventLog('AsiItem.Interaction.prototype.playStory');
this._html.setPlayIcon(this.audioWidget);
};
AsiItem.Interaction.prototype.getResponse = function () {
var rv = '';
for (var i = 0; i < this._responseIdentifiers.length; ++i) {
if (rv.length > 0) {
rv = rv + ' ';
}
rv = rv + this._responseIdentifiers[i];
}
return rv;
};
AsiItem.Interaction.prototype.setResponse = function (value) {
var values = value.split(' ');
this.hasPlayedOnce = true;
this.displayResponses(this._responseSpanIds);
this._html.enableResponses(this._responseSpanIds);
for (var i = 0; i < values.length; ++i) {
var span = this._html.getResponseSpanFromIdentifier(values[i]);
if (span) {
this._responseIdentifiers.push(values[i]);
var fSpan = this._html.getRelatedFeedbackSpan(span);
if (fSpan) {
this.responsesLeft--;
this._html.showFeedbackHideResponse(fSpan, span);
if (this._terminalSpanIds[YUD.getAttribute(span, 'id')]) {
this.complete = true;
this.terminateInteraction();
}
if (this.responsesLeft == 0) {
this.complete = true;
this.terminateInteraction();
}
}
}
}
};
AsiItem.Interaction.prototype.onTerminate = function (callback) {
this._terminateEvent.subscribe(callback, this);
};
AsiItem.Interaction.prototype.terminateInteraction = function () {
this._html.subdueResponses(this._responseSpanIds);
this._html.disableResponses(this._responseSpanIds);
this._html.subduePlayIcon(this.audioWidget);
this._terminateEvent.fire();
if (this._player && this._player._tracksToPlay) {
var tracks = this._player._tracksToPlay;
for (var i = 0; i < tracks.length; i ++) {
var track = tracks[i];
if (AsiItem.WAPIAudioInterface.audioDataHash[track.url]) {
delete AsiItem.WAPIAudioInterface.audioDataHash[track.url];
}
}
}
};
AsiItem.Interaction.prototype.constructAudioTag = function (parentDiv) {
var audioWidgetSpan = document.createElement('span');
this.audioWidget = this._html.createAudioButton();
audioWidgetSpan.appendChild(this.audioWidget);
parentDiv.appendChild(audioWidgetSpan);
YUE.addListener(audioWidgetSpan, 'click', AsiItem.Interaction.handlePlayAudioButton, this);
};
AsiItem.Interaction.prototype.processResponse = function (span) {
if (this._isPlaying || this._isResponsePlaying || this._isFeedbackPlaying)
return;
this.responsesLeft--;
var fspan = this._html.getRelatedFeedbackSpan(span);
var spid = YUD.getAttribute(span, 'id');
this._responseIdentifiers.push(this._spanToIdentifierMap[spid]);
if (this._terminalSpanIds[spid]) {
this.complete = true;
this.terminateInteraction();
} else if ((this.complete == false) && (this.responsesLeft == 0)) {
this.complete = true;
this.terminateInteraction();
}
if ((fspan) && (this.complete != true)) {
var fid = YUD.getAttribute(fspan, 'id');
this._html.showFeedbackHideResponse(fspan, span);
if (this._feedbackCues[fid]) {
this._isFeedbackPlaying = true;
this._html.subdueResponses(this._responseSpanIds);
this._html.disableResponses(this._responseSpanIds);
this._html.subduePlayIcon(this.audioWidget);
var hap = new AsiItem.AudioInterface();
hap.add(this._feedbackCues[fid], fid, null,
AsiItem.Interaction.handleEndFeedbackAudio, this);
hap.start();
} else {
AsiItem.Interaction.handleEndFeedbackAudio(fid, this);
}
}
};
AsiItem.Interaction.prototype.processResponse_noVoiceGuidance = function (span) {
this.responsesLeft--;
var fspan = this._html.getRelatedFeedbackSpan(span);
var spid = YUD.getAttribute(span, 'id');
this._responseIdentifiers.push(this._spanToIdentifierMap[spid]);
if (this._terminalSpanIds[spid]) {
this.complete = true;
this.terminateInteraction();
} else if ((this.complete == false) && (this.responsesLeft == 0)) {
this.complete = true;
this.terminateInteraction();
} else {
YUD.removeClass(span, 'asi-response-shown');
YUD.removeClass(span, 'asi-response-enabled');
YUD.addClass(span, 'asi-response-hidden');
}
};
AsiItem.Interaction.handleResponseCallback = function (ev, instance) {
if (instance.isReadOnly() || instance._isPlaying || instance._isFeedbackPlaying || instance._isResponsePlaying)
return;
if (instance.complete)
return;
var span = this;
instance._playSourceFromResponse = true;
instance.processResponse(span);
};
AsiItem.Interaction.handleResponseCallback_noVoiceGuidance = function (ev, instance) {
if (instance.isReadOnly() || instance.complete)
return;
var span = this;
instance.processResponse_noVoiceGuidance(span);
};
AsiItem.Interaction.handleEndFeedbackAudio = function (spid, instance) {
AsiItem.EventLog('handleEndFeedbackAudio');
instance._isFeedbackPlaying = false;
if ((!instance.complete) && (instance.responsesLeft > 0)) {
instance.populateResponseAudio(instance._playbackInfo);
instance._html.setStopIcon(instance.audioWidget);
instance.playAudio(instance._playbackInfo);
} else if ((instance.complete == false) && (instance.responsesLeft == 0)) {
instance.complete = true;
instance.terminateInteraction();
}
};
AsiItem.Interaction.prototype.displayResponses = function (responseArray) {
AsiItem.EventLog('subdueResponses');
for (var i = 0; i < responseArray.length; ++i) {
var span = YUD.get(responseArray[i]);
AsiItem.EventLog('display span ' + YUD.getAttribute(span, 'id'));
YUD.addClass(span, 'asi-response-shown');
YUD.removeClass(span, 'asi-response-hidden');
}
};
AsiItem.Interaction.handlePlayAudioButton = function (ev, instance) {
if (instance.isReadOnly()) return;
AsiItem.EventLog('Main story button pressed');
instance._playSourceFromResponse = false;
instance.playAudio(instance._playbackInfo);
};
AsiItem.Interaction.handleResponseAudioButton = function (ev, instance) {
if (instance.isReadOnly())
return;
YUE.stopEvent(ev);
if ((instance._isResponsePlaying) && (instance._responsePlayer)) {
AsiItem.EventLog('handleResponseAudioButton - playing, treat like stop');
instance._responsePlayer.stop();
return;
}
if (instance.complete)
return;
AsiItem.EventLog('handleResponseAudioButton');
var responseIndex = instance._html.getResponseIndex(this);
var playbackInfo = {
stemId: null,
stemAudio: null,
responseAudio: []
};
var audioObject = {
audioCue: instance._parser.asiContent.choices[responseIndex].audioCue,
spanId: YUD.getAttribute(this, 'id')
};
playbackInfo.responseAudio[responseIndex] = audioObject;
instance._html.subdueResponses(instance._responseSpanIds);
instance._html.subduePlayIcon(instance.audioWidget);
var responseId = instance._html.createSpanId('response-' + responseIndex);
YUD.addClass(responseId, 'asi-response-emphasis');
YUD.removeClass(responseId, 'asi-response-subdued');
instance.populateResponseAudio(playbackInfo, responseIndex);
instance.playAudioResponse(playbackInfo);
};
AsiItem.Interaction.prototype.playAudioResponse = function (audioArray) {
if ((this._isPlaying === true) || (this._isResponsePlaying) || (this._isFeedbackPlaying)) {
AsiItem.EventLog('no audio response - playing already');
return;
}
if (this.complete === true) {
AsiItem.EventLog('complete');
return;
}
this._responsePlayer = new AsiItem.AudioInterface();
var self = this;
var startPlaying = function () {
AsiItem.EventLog('playAudioResponse - startPlaying');
self._isResponsePlaying = true;
self._html.setStopIcon(responseSpan);
};
var stopPlaying = function () {
AsiItem.EventLog('playAudioResponse - stopPlaying');
self._isResponsePlaying = false;
self._html.setPlayIcon(responseSpan);
self._html.enableResponses(self._responseSpanIds);
self._html.setPlayIcon(self.audioWidget);
};
AsiItem.EventLog('playAudioResponse - setting up audio');
for (var i = 0; i < audioArray.responseAudio.length; ++i) {
var responseInfo = audioArray.responseAudio[i];
if (responseInfo.audioCue) {
var responseSpanId = responseInfo.spanId;
var responseSpan = YUD.get(responseSpanId);
if (responseSpan && (YUD.getStyle(responseSpan, 'display') != 'none')) {
this._responsePlayer.add(responseInfo.audioCue, responseInfo.spanId, startPlaying, stopPlaying);
}
}
}
this._responsePlayer.start();
};
AsiItem.Interaction.prototype.playAudio = function (audioArray) {
var self = this;
if ((this._isResponsePlaying) || (this._isFeedbackPlaying)) {
AsiItem.EventLog('playAudio - already playing response');
return;
}
if (this.hasPlayedOnce == false && this._isPlaying === true) {
AsiItem.EventLog('playAudio - already playing first time, replay entire story ');
}
if ((this._isPlaying === true) && (this._player)) {
AsiItem.EventLog('playAudio - already playing, treat like stop');
this._player.stop();
this._player.dispose();
this._player = null;
this._isPlaying = false;
this._html.setPlayIcon(this.audioWidget);
this._html.enableResponses(this._responseSpanIds);
if (this.hasPlayedOnce == false) {
setTimeout(function () {
self.populateResponseAudio(audioArray);
self.playAudio(audioArray);
}, 1);
}
return;
}
if (this._player) {
this._player.stop();
this._player.dispose();
this._player = null;
}
if (this.complete === true) {
AsiItem.EventLog('playAudio - complete');
return;
}
this._player = this._audioFactory.createAudioInterface();
this._html.subdueResponses(this._responseSpanIds);
var stopAudioCallback = function (id) {
if (self._isPlaying == false) {
AsiItem.EventLog('playAudio - stopAudioCallback late stop event, enabling');
self._html.enableResponses(self._responseSpanIds);
return;
}
AsiItem.EventLog('playAudio - stopAudioCallback');
var span = YUD.get(id);
if (/asiStem/.test(id)) {
if (audioArray.responseAudio.length == 0) {
AsiItem.EventLog('playAudio - finished palying stem and no responses');
self._isPlaying = false;
self._html.enableResponses(self._responseSpanIds);
self._html.setPlayIcon(self.audioWidget);
}
AsiItem.EventLog('playAudio - finished palying stem');
return;
}
if (span) {
AsiItem.EventLog('playAudio - finished playing response ' + id + ', remove emphasis');
YUD.removeClass(span, 'asi-response-emphasis');
}
var idx = self._html.getResponseIndex(id);
if (audioArray.highestIndexToPlay == idx) {
AsiItem.EventLog('playAudio - playing last response ' + id + ', enabling');
self._isPlaying = false;
self._html.enableResponses(self._responseSpanIds);
self._html.setPlayIcon(self.audioWidget);
self.hasPlayedOnce = true;
} else {
AsiItem.EventLog('playAudio - finished playing response ' + id + ', subdue');
YUD.addClass(span, 'asi-response-subdued');
}
};
var startAudioCallback = function (id) {
var span = YUD.get(id);
if (/asiStem/.test(id)) {
AsiItem.EventLog('playAudio - starting stem');
return;
}
AsiItem.EventLog('playAudio - starting a response  ' + id);
if (span) {
self._html.emphasizeResponse(span);
var responseAudioSpan = self._html.getAudioSpanFromResponseSpan(span);
if (responseAudioSpan) {
self._html.subduePlayIcon(responseAudioSpan);
}
}
};
AsiItem.EventLog('playAudio - populating player');
if ((audioArray.playStemAudio) || (self._playSourceFromResponse == false)) {
this._player.add(audioArray.stemAudio, audioArray.stemId, startAudioCallback, stopAudioCallback);
}
for (var i = 0; i < audioArray.responseAudio.length; ++i) {
var responseInfo = audioArray.responseAudio[i];
if (responseInfo.audioCue) {
var responseSpanId = responseInfo.spanId;
var responseSpan = YUD.get(responseSpanId);
if (responseSpan && ((this.hasPlayedOnce == false) || YUD.getStyle(responseSpan, 'display') != 'none')) {
this._player.add(responseInfo.audioCue, responseInfo.spanId, startAudioCallback, stopAudioCallback);
}
}
}
this._isPlaying = true;
if (this.hasPlayedOnce == false) {
this._html.setStopIcon(this.audioWidget);
this._html.subduePlayIcon(this.audioWidget);
} else {
this._html.setStopIcon(this.audioWidget);
}
this._player.start();
};
AsiItem.Interaction.prototype.hasResponseBeenChosen = function (spid) {
for (var i = 0; i < this._responseIdentifiers.length; ++i) {
var responseSpan = this._html.getResponseSpanFromIdentifier(this._responseIdentifiers[i]);
if (responseSpan != null && responseSpan.id == spid) {
return true;
}
}
return false;
};
AsiItem.Interaction.prototype.populateResponseAudio = function (audioObject, responseId) {
var ar = [];
audioObject.highestIndexToPlay = 0;
for (var i = 0; i < this._responseSpanIds.length; ++i) {
var spid = this._responseSpanIds[i];
var span = YUD.get(spid);
var index = this._html.getResponseIndex(spid);
if ((responseId == null) || (responseId == index)) {
if (this.hasResponseBeenChosen(spid) == false) {
if (audioObject.responseAudio[i]) {
ar.push(audioObject.responseAudio[i]);
if (index > audioObject.highestIndexToPlay) {
audioObject.highestIndexToPlay = index;
}
}
}
}
}
audioObject.responseAudio = ar;
};
AsiItem.Interaction.prototype.populateResponses = function (parentDiv) {
var choiceContent = this._parser.asiContent.choices;
var answerCell = document.createElement('div');
this._html.setSpanId(answerCell, 'responses');
this._playbackInfo.highestIndexToPlay = 0;
for (var i = 0; i < choiceContent.length; i++) {
var responseContent = choiceContent[i].content.htmlContent;
var responseSpan = document.createElement('div');
if (!this._voiceGuidance) {
YUD.addClass(responseSpan, 'asi-response-shown asi-response-enable');
}
var spanId = this._html.createSpanId('response-' + i.toString());
this._spanToIdentifierMap[spanId] = choiceContent[i].identifier;
this._responseSpanIds.push(spanId);
var audioTag = choiceContent[i].audioCue;
var audioObject = {
audioCue: audioTag,
spanId: spanId
};
if (audioObject.audioCue) {
this._playbackInfo.responseAudio.push(audioObject);
if (i > this._playbackInfo.highestIndexToPlay) {
this._playbackInfo.highestIndexToPlay = i;
}
}
if (/true/i.test(choiceContent[i].complete)) {
this._terminalSpanIds[spanId] = true;
}
this._html.setSpanId(responseSpan, 'response-' + i.toString());
responseSpan.innerHTML = Util.Xml.serializeToString(responseContent);
YUD.setAttribute(responseSpan, 'tabIndex', '0');
if (this._voiceGuidance) {
YUD.addClass(responseSpan, 'asi-response-hidden');
}
var responseAudioButton = this._html.createAudioButton();
this._html.setPlayIcon(responseAudioButton);
this._html.setSpanId(responseAudioButton, 'audioResponse-' + i.toString());
YUE.addListener(responseAudioButton, 'click', AsiItem.Interaction.handleResponseAudioButton, this);
if (this._voiceGuidance) {
responseSpan.appendChild(responseAudioButton);
this._responseButtons.push(responseAudioButton);
}
var feedbackContent = choiceContent[i].content.feedback;
var feedbackSpan = document.createElement('div');
YUD.addClass(feedbackSpan, 'asi-feedback-hidden');
this._html.setSpanId(feedbackSpan, 'feedback-' + i.toString());
if (feedbackContent.audioCue) {
this._feedbackCues[this._html.createSpanId('feedback-' + i.toString())] = feedbackContent.audioCue;
this._playbackInfo.playStemAudio = false;
}
if (feedbackContent.feedbackContainer)
feedbackSpan.innerHTML = Util.Xml.serializeToString(feedbackContent.feedbackContainer);
answerCell.appendChild(responseSpan);
answerCell.appendChild(feedbackSpan);
if (this._voiceGuidance) {
YUE.addListener(responseSpan, 'click', AsiItem.Interaction.handleResponseCallback, this);
} else {
YUE.addListener(responseSpan, 'click', AsiItem.Interaction.handleResponseCallback_noVoiceGuidance, this);
}
}
this._html.getParentDiv().appendChild(answerCell);
};

/* SOURCE FILE: asi.widget.js (8d62759f) 9/9/2014 2:09:01 PM */

(function(CM) {
function match(page, item, content) {
var id = 'ScaffoldingContainer_' + item.position;
var el = document.getElementById(id);
if (el) {
return new CM.WidgetConfig(id, el);
}
return false;
}
CM.registerWidget('scaffolding', Widget_ASI, match);
function Widget_ASI() {
this.scaffolding = null;
}
Widget_ASI.prototype.init = function () {
var page = this.page;
var item = this.entity;
var containerEl = this.element;
var accProps = page.getAccommodationProperties();
var hasASIVoiceGuidance = accProps.hasASIVoiceGuidance();
var stem = item.getStemElement();
if (stem) {
var exitAudioCue = this._processExitAudioLink(stem, hasASIVoiceGuidance);
var exitAudioPlayer = new AsiItem.AudioInterface();
var exitAudioPlayerId = 'asi-' + item.position + 'exitAudio';
exitAudioPlayer.add(exitAudioCue, exitAudioPlayerId);
}
var onTerminate = function(type, args, instance) {
var questionSpan = containerEl;
while (questionSpan) {
if ((/div/i.test(questionSpan.tagName)) && (YUD.hasClass(questionSpan, 'theQuestions'))) {
break;
} else {
questionSpan = questionSpan.parentNode;
}
}
if (questionSpan) {
var completeDiv = document.createElement('div');
YUD.addClass(completeDiv, 'asi-complete-span');
questionSpan.parentNode.insertBefore(completeDiv, questionSpan);
var nextFunction = ContentManager.setItemCompleted;
if (nextFunction && item) {
YUE.addListener(completeDiv, 'click', function() { nextFunction(item); });
}
}
exitAudioPlayer.start();
};
CM.log('ASI: Processing item. ');
var asi = new AsiItem.Parse(item);
asi.createAsiChoices();
var html = new AsiItem.Html(asi, containerEl);
this.scaffolding = new AsiItem.Interaction(html, asi,hasASIVoiceGuidance);
this.scaffolding.isReadOnly = item.isReadOnly;
this.scaffolding.onTerminate(onTerminate);
this.scaffolding.startInteraction(item.value);
};
Widget_ASI.prototype.show = function () {
if (this.scaffolding) {
AsiItem.Audio.onReady(function () {
this.scaffolding.playStory();
}.bind(this));
}
};
Widget_ASI.prototype.hide = function() {
if (this.scaffolding) {
this.scaffolding.hidePage();
}
};
Widget_ASI.prototype._processExitAudioLink = function(parentSpan, hasVoiceGuide) {
var anchors = parentSpan.getElementsByTagName('a');
for (var i = 0; i < anchors.length; i++) {
var anchor = anchors[i];
var source = AsiItem.Audio.getPlayableSource(anchor);
var anchorExitAudioAttr = YUD.getAttribute(anchor, 'data-its-exitaudio');
if (anchorExitAudioAttr == 'true' && source != null) {
anchor.parentNode.removeChild(anchor);
return hasVoiceGuide ? source.url : null;
}
}
return null;
};
Widget_ASI.prototype.getResponse = function() {
var value = '';
if (this.scaffolding) {
value = this.scaffolding.getResponse();
}
var validResponse = (value && (value.length > 0) && (this.scaffolding) && (this.scaffolding.complete)) ? true : false;
return this.createResponse(value, validResponse);
};
Widget_ASI.prototype.setResponse = function(value) {
if (this.scaffolding) {
this.scaffolding.setResponse(value);
}
};
})(window.ContentManager);

/* SOURCE FILE: base.js (641e70ff) 9/9/2014 2:09:05 PM */

TDS = window.TDS || {};
(function (TDS) {
var TI = function (el, useTextArea) {
this._tableEl = el;
this._useTextArea = useTextArea || false;
this._columnIds = [];
this._inputValidators = [];
};
TI.CSS_INPUT = 'ti-input';
TI.CSS_EDITABLE = 'ti-editable';
TI.CSS_ACTIVE = 'ti-active';
TI.CSS_INVALID = 'ti-invalid';
var globalValidator;
TI.setValidator = function(fn) {
globalValidator = fn;
};
TI.prototype.getColumnIds = function () {
return this._columnIds;
};
TI.prototype.getElement = function() {
return this._tableEl;
};
TI.prototype.getInputs = function () {
var tableEl = this.getElement();
return $('.' + TI.CSS_INPUT, tableEl);
};
TI.prototype.validateInputs = function() {
this._inputValidators.forEach(function(inputValidator) {
inputValidator();
});
};
TI.prototype._processTag = function (idx, tagEl) {
var $tag = $(tagEl);
var validationRule = $tag.data('itsValidationrule');
var includedInResponse = ($tag.data('itsIncludedinresponse') === true);
var tagName = this._useTextArea ? 'textarea' : 'input';
var $input = $(document.createElement(tagName));
$input.attr('type', 'text')
.attr('autocomplete', 'off')
.attr('autocorrect', 'off')
.attr('autocapitalize', 'off')
.attr('spellcheck', 'false');
$input.addClass(TI.CSS_INPUT);
if ($tag.parent().css('text-align') == 'center') {
$input.css('text-align', 'center');
}
var tableEl = this.getElement();
var $cell = $tag.closest('td, th', tableEl);
$cell.addClass(TI.CSS_EDITABLE);
$input.focus(function() {
$cell.addClass(TI.CSS_ACTIVE);
}).blur(function() {
$cell.removeClass(TI.CSS_ACTIVE);
});
if (includedInResponse) {
var tagText = $tag.text().trim();
if (tagText) {
$input.val(tagText);
}
}
$input.data('originalResponse', $input.val());
if (typeof globalValidator == 'function') {
var inputValidator = globalValidator.bind(this, $input, $cell, validationRule);
$input.on('input', inputValidator);
this._inputValidators.push(inputValidator);
}
$tag.replaceWith($input);
};
TI.prototype.render = function() {
var tableEl = this.getElement();
$('thead th', tableEl).each(function (idx, thEl) {
var $cell = $(thEl);
if ($cell.prop('tagName') == 'TH') {
var id = $cell.data('itsIdentifier');
this._columnIds.push(id);
}
}.bind(this));
$('span[data-its-input="true"]', tableEl)
.each(this._processTag.bind(this));
};
TDS.TableInput = TI;
})(TDS);

/* SOURCE FILE: validator.js (e5760aee) 9/9/2014 2:09:05 PM */

(function (TI) {
var Rules = {
'alphaOnly': /^[a-zA-Z]+$/i,
'numericOnly': /^(\+|-)?(\d+)?([.]?\d*)?$/,
'alphaNumericOnly': /[a-zA-Z0-9]/i,
'textOnly': null
};
function showAlert(msg) {
if (TDS.Dialog) {
TDS.Dialog.showWarning(msg);
} else {
alert(msg);
}
}
function validator($input, $cell, rule, evt) {
var textValid = true;
var re = Rules[rule];
if (re) {
var text = $input.val().trim();
if (text) {
textValid = re.test(text);
}
}
var styleInvalid = $cell.hasClass(TI.CSS_INVALID);
if (textValid && styleInvalid) {
$cell.removeClass(TI.CSS_INVALID);
} else if (!textValid && !styleInvalid) {
$cell.addClass(TI.CSS_INVALID);
if (evt) {
setTimeout(function() {
showAlert('TI.InvalidInput.' + rule);
}, 0);
}
}
}
TI.setValidator(validator);
})(TDS.TableInput);

/* SOURCE FILE: response.js (f92e84ca) 9/9/2014 2:09:05 PM */

(function (TI) {
TI.prototype.getResponseXml = function () {
var xmlDoc = Util.Xml.createDocument('responseSpec');
var rootEl = xmlDoc.documentElement;
var tableNode = xmlDoc.createElement('responseTable');
var tableEl = this.getElement();
$('tr', tableEl).each(function (rowIdx, rowEl) {
var rowNode = xmlDoc.createElement('tr');
$('th, td', rowEl).each(function (colIdx, colEl) {
var colName = colEl.nodeName.toLowerCase();
var colNode = xmlDoc.createElement(colName);
var id = $(colEl).data('itsIdentifier');
if (id) {
$(colNode).attr('id', id);
}
var response = $('.' + TI.CSS_INPUT, colEl).first().val();
if (response) {
$(colNode).text(response);
}
rowNode.appendChild(colNode);
});
tableNode.appendChild(rowNode);
});
rootEl.appendChild(tableNode);
return xmlDoc;
};
TI.prototype.getResponse = function() {
var xmlDoc = this.getResponseXml();
var xmlStr = Util.Xml.serializeToString(xmlDoc);
return xmlStr;
};
TI.prototype.setResponseXml = function (xmlDoc) {
var tableEl = this.getElement();
var $htmlRows = $('tr', tableEl);
var $xmlRows = $('tr', xmlDoc);
for (var i = 0, ii = $htmlRows.length; i < ii; i++) {
var $htmlCols =  $('th, td', $htmlRows[i]);
var $xmlCols = $('th, td', $xmlRows[i]);
for (var j = 0, jj = $htmlCols.length; j < jj; j++) {
var $htmlCol = $($htmlCols[j]);
var $xmlCol = $($xmlCols[j]);
var $input = $('.' + TI.CSS_INPUT, $htmlCol).first();
if ($input) {
var response = $xmlCol.text();
$input.val(response || '');
}
}
}
};
TI.prototype.setResponse = function (xmlStr) {
var xmlDoc = Util.Xml.parseFromString(xmlStr);
this.setResponseXml(xmlDoc);
};
TI.prototype.isResponseValid = function () {
var $inputs = this.getInputs();
if ($inputs.length == 0) return false;
var valid = true;
$inputs.each(function (idx, inputEl) {
var originalResponse = $(inputEl).data('originalResponse');
var currentResponse = $(inputEl).val().trim();
if (originalResponse === currentResponse) {
valid = false;
return false;
}
});
return valid;
};
})(TDS.TableInput);

/* SOURCE FILE: widget.js (66c58832) 9/9/2014 2:09:05 PM */

(function (CM) {
function match(page, item, content) {
if (!item.isResponseType('TableInput') && !item.isResponseType('TableInputExt')) {
return false;
}
var $tables = $('table.tableItem', item.getElement());
if ($tables.length == 0) {
throw new Error('Could not find table matching class "tableItem" for TableInput item');
}
var tableEl = $tables.get(0);
var id = 'TableContainer_' + item.position;
var containerEl = document.getElementById(id);
return new CM.WidgetConfig(id, tableEl, containerEl);
}
function Widget_TI(page, item, config) {
this._tableInput = null;
}
CM.registerWidget('tableinput', Widget_TI, match);
Widget_TI.prototype.load = function () {
var item = this.entity;
var tableEl = this.element;
var containerEl = this.config;
if (containerEl) {
containerEl.appendChild(tableEl);
}
var useTextArea = item.isResponseType('TableInputExt');
var ti = new TDS.TableInput(tableEl, useTextArea);
this._tableInput = ti;
ti.render();
if (item.value) {
ti.setResponse(item.value);
ti.validateInputs();
}
var inputEls = ti.getInputs();
for (var i = 0; i < inputEls.length; ++i) {
item.addComponent(inputEls[i]);
}
var readOnlyFunc = function (evt) {
if (item.isReadOnly()) {
YUE.stopEvent(evt);
}
};
YUE.on(tableEl, 'keypress', readOnlyFunc);
YUE.on(tableEl, 'mousedown', readOnlyFunc);
}
Widget_TI.prototype.getResponse = function () {
var ti = this._tableInput;
var value = ti.getResponse();
var isValid = ti.isResponseValid();
return this.createResponse(value, isValid);
}
Widget_TI.prototype.setResponse = function(value) {
var ti = this._tableInput;
ti.setResponse(value);
}
})(window.ContentManager);

/* SOURCE FILE: moogle.js (6ed9384d) 9/9/2014 2:09:01 PM */

TDS.Moogle = (typeof (TDS.Moogle) == "undefined") ? {} : TDS.Moogle;
TDS.Moogle = function (identifier) {
};
TDS.Moogle.prototype.load = function(parent, spec) {
parent = YUD.get(parent);
var searchResultsTitle = Messages.get('TDSMoogle.searchResults');
var searchResultsDiv = document.createElement('div');
var searchResultsHeaderH3 = document.createElement('h3');
YUD.addClass(searchResultsHeaderH3, 'moogle-Header');
var searchResultsText = document.createTextNode(searchResultsTitle);
YUD.addClass(searchResultsText, 'moogle-title');
searchResultsHeaderH3.appendChild(searchResultsText);
searchResultsDiv.appendChild(searchResultsHeaderH3);
YUD.setAttribute(searchResultsDiv, 'id', 'moogleSearchResults');
var articleDiv = [];
var resultElements = YUD.getChildren(spec);
if (resultElements.length > 0) {
var titleLink = [];
for (var i = 0; i < resultElements.length; i++) {
var result = resultElements[i];
var resultDiv = document.createElement('div');
YUD.setAttribute(resultDiv, 'id', 'moogleSearchResult_' + i);
YUD.addClass(resultDiv, 'moogleSearchResultContainer');
titleLink[i] = document.createElement('a');
YUD.setAttribute(titleLink[i], 'id', 'moogleSearchResultTitle_' + i);
YUD.addClass(titleLink[i], 'moogle-resultTitle');
titleLink[i].innerHTML = result.children[1].textContent;
resultDiv.appendChild(titleLink[i]);
var thumbnailSnippetDiv = document.createElement('div');
YUD.setAttribute(thumbnailSnippetDiv, 'id', 'moogleSearchResultThumbnailSnippet_' + i);
var thumbnailSpan = document.createElement('span');
YUD.setAttribute(thumbnailSpan, 'id', 'moogleSearchResultThumbnail_' + i);
YUD.setAttribute(thumbnailSpan, 'moogle-thumbnailLeft');
thumbnailSpan.innerHTML = result.children[0].textContent;
thumbnailSnippetDiv.appendChild(thumbnailSpan);
var snippetSpan = document.createElement('span');
YUD.setAttribute(snippetSpan, 'moogle-snippetRight');
YUD.setAttribute(snippetSpan, 'id', 'moogleSearchResultSnippet_' + i);
snippetSpan.innerHTML = result.children[2].textContent;
thumbnailSnippetDiv.appendChild(snippetSpan);
resultDiv.appendChild(thumbnailSnippetDiv);
searchResultsDiv.appendChild(resultDiv);
YUD.addClass(searchResultsDiv, 'moogle-show');
articleDiv[i] = document.createElement('div');
YUD.setAttribute(articleDiv[i], 'id', 'moogleSearchResultArticle_' + i);
articleDiv[i].innerHTML = result.children[3].textContent;
YUD.addClass(articleDiv[i], 'moogle-hide');
}
}
var backToIndexLink = document.createElement('a');
var backToIndexText = document.createTextNode('Back to Index');
backToIndexLink.appendChild(backToIndexText);
YUD.addClass(backToIndexLink, 'moogle-btiLink');
YUD.addClass(backToIndexLink, 'moogle-hide');
var paddingEl = Util.Dom.getElementByClassName('padding', 'div', parent);
if (paddingEl) {
paddingEl.appendChild(searchResultsDiv);
paddingEl.appendChild(backToIndexLink);
for (var m = 0; m < articleDiv.length; m++) {
paddingEl.appendChild(articleDiv[m]);
}
}
YAHOO.util.Event.onDOMReady(function() {
for (var j = 0; j < resultElements.length; j++) {
YUE.addListener(titleLink[j], 'click', function(k) {
return function() {
YUD.removeClass(searchResultsDiv, 'moogle-show');
YUD.addClass(searchResultsDiv, 'moogle-hide');
YUD.removeClass(backToIndexLink, 'moogle-hide');
YUD.addClass(backToIndexLink, 'moogle-show');
YUD.removeClass(articleDiv[k], 'moogle-hide');
YUD.addClass(articleDiv[k], 'moogle-show');
YUE.addListener(backToIndexLink, 'click', function() {
YUD.removeClass(backToIndexLink, 'moogle-show');
YUD.addClass(backToIndexLink, 'moogle-hide');
YUD.removeClass(articleDiv[k], 'moogle-show');
YUD.addClass(articleDiv[k], 'moogle-hide');
YUD.removeClass(searchResultsDiv, 'moogle-hide');
YUD.addClass(searchResultsDiv, 'moogle-show');
});
};
}(j));
}
});
};

/* SOURCE FILE: plugin.js (1c217ccb) 9/9/2014 2:09:01 PM */

(function(CM) {
function match(page, entity) {
if (entity.specs && entity.specs.length > 0) {
var results = Util.Array.find(entity.specs, function(spec) {
return spec.nodeName == 'search';
});
if (results) {
return results;
}
}
return false;
}
function Plugin_Moogle(page, entity, config) {
}
CM.registerEntityPlugin('moogle', Plugin_Moogle, match);
Plugin_Moogle.prototype.load = function () {
var passage = this.entity;
var results = this.config;
var moogle = new TDS.Moogle('moogle' + passage.getID());
var passageContainer = passage.getElement();
moogle.load(passageContainer, results);
};
})(window.ContentManager);

/* SOURCE FILE: mc.group.js (f26dce54) 9/9/2014 2:09:01 PM */

(function() {
function MC(item) {
this._item = item;
this._options = [];
this._optionHash = {};
this._role = 'radiogroup';
this.autoRespond = false;
}
MC.prototype.getItem = function() {
return this._item;
};
MC.prototype.addOption = function(option) {
this._options.push(option);
this._optionHash[option.key] = option;
};
MC.prototype.getOptions = function() {
return this._options;
};
MC.prototype.getOption = function(optionKey) {
var option = null;
if (typeof optionKey == 'string') {
optionKey = optionKey.toUpperCase();
option = this._optionHash[optionKey] || null;
} else if (typeof optionKey == 'number') {
option = this._options[optionKey - 1] || null;
}
return option;
};
MC.prototype.getSelected = function() {
for (var i = 0; i < this._options.length; i++) {
if (this._options[i].isSelected()) {
return this._options[i];
}
}
return null;
};
MC.prototype.clear = function() {
var selected = this.getSelected();
if (selected != null) {
selected.deselect();
}
};
MC.prototype.getValue = function() {
var option = this.getSelected();
return (option) ? option.key : null;
};
MC.prototype.setValue = function(optionKey) {
var option = this.getOption(optionKey);
if (!option) {
return false;
}
option.select();
return true;
};
MC.prototype.getFocusedOption = function() {
var focusedComponent = this.getItem().getActiveComponent();
for (var i = 0; i < this._options.length; i++) {
var option = this._options[i];
if (option.getElement() == focusedComponent) {
return option;
}
}
return null;
};
MC.prototype.render = function (el) {
if (el) {
el.setAttribute('role', this._role);
el.setAttribute('aria-required', 'true');
}
this.getOptions().forEach(function (option) {
option.render();
});
};
window.ContentMCGroup = MC;
})();

/* SOURCE FILE: mc.option.js (b3a29d26) 10/26/2014 1:27:05 PM */

(function() {
function MCOption(options, key) {
Util.Event.Emitter(this);
this._options = options;
this._role = 'radio';
this.key = key;
this.audioLink = null;
this.tts = null;
this.feedback = null;
}
MCOption.prototype.getElement = function() {
var item = this._options.getItem();
return document.getElementById('Item_OptionContainer_Response_MC_' + item.position + '_' + this.key);
};
MCOption.prototype.getInputElement = function() {
var item = this._options.getItem();
var inputName = 'Item_Response_MC_' + item.position + '_' + this.key;
return document.getElementById(inputName);
};
MCOption.prototype.getSoundLink = function() {
var item = this._options.getItem();
var soundEl = document.getElementById('Item_OptionSound_Response_MC_' + item.position + '_' + this.key);
if (soundEl) {
return soundEl.getElementsByTagName('a')[0];
}
return null;
};
MCOption.prototype.getContentElement = function() {
var optionElement = this.getElement();
return Util.Dom.getElementByClassName('optionContent', 'div', optionElement);
};
MCOption.prototype.getFeedbackElement = function() {
var optionElement = this.getElement();
return Util.Dom.getElementByClassName('optionFeedback', 'div', optionElement);
};
MCOption.prototype.showFeedback = function() {
var feedbackElement = this.getFeedbackElement();
if (feedbackElement != null) {
YUD.addClass(feedbackElement, 'showing');
}
};
MCOption.prototype.hideFeedback = function() {
var feedbackElement = this.getFeedbackElement();
if (feedbackElement != null) {
YUD.removeClass(feedbackElement, 'showing');
}
};
MCOption.prototype.createFeedback = function() {
var group = this._options;
var item = group.getItem();
var page = item.getPage();
var accProps = page.getAccProps();
if (accProps && accProps.showFeedback()) {
var feedbackEl = document.createElement('div');
YUD.addClass(feedbackEl, 'optionFeedback');
feedbackEl.innerHTML = this.feedback;
var optionEl = this.getElement();
optionEl.appendChild(feedbackEl);
if (this.isSelected()) {
this.showFeedback();
} else {
this.hideFeedback();
}
}
};
MCOption.prototype.select = function (force) {
var group = this._options;
var item = group.getItem();
var page = item.getPage();
if (item.isReadOnly()) {
return false;
}
var currentSelection = group.getSelected();
if (currentSelection == this && force !== true) {
return false;
}
var cancelSelect = this.fire('beforeSelect');
if (cancelSelect === false) {
return false;
}
if (force) {
var options = group.getOptions();
Util.Array.each(options, function(option) {
option.deselect();
});
} else if (currentSelection) {
currentSelection.deselect();
}
var inputEl = this.getInputElement();
if (!inputEl.checked) {
inputEl.checked = true;
}
var optionEl = this.getElement();
YUD.addClass(optionEl, 'optionSelected');
optionEl.setAttribute('aria-checked', 'true');
var pageAccProps = page.getAccommodationProperties();
if (pageAccProps != null && pageAccProps.showFeedback()) {
this.showFeedback();
}
this.fire('select');
if (group.autoRespond && typeof window.tdsUpdateItemResponse == 'function') {
window.tdsUpdateItemResponse(item.position, this.key);
}
return true;
};
MCOption.prototype.deselect = function () {
var group = this._options;
var optionEl = this.getElement();
var inputEl = this.getInputElement();
YUD.removeClass(optionEl, 'optionSelected');
optionEl.setAttribute('aria-checked', 'false');
inputEl.checked = false;
this.hideFeedback();
this.fire('deselect');
};
MCOption.prototype.isSelected = function() {
var inputEl = this.getInputElement();
return (inputEl && inputEl.checked === true);
};
MCOption.prototype.hasStrikethrough = function() {
var element = this.getElement();
return (element && YUD.hasClass(element, 'strikethrough'));
};
MCOption.prototype.toggleStrikethrough = function() {
var element = this.getElement();
if (element) {
YUD.toggleClass(element, 'strikethrough');
}
};
MCOption.prototype.render = function () {
var item = this._options.getItem();
var optionEl = this.getElement();
optionEl.setAttribute('role', 'radio');
optionEl.setAttribute('aria-checked', this.isSelected());
optionEl.setAttribute('aria-label', 'Option ' + this.key);
var contentEl = this.getContentElement();
var contentId = contentEl.getAttribute('id');
if (!contentId) {
contentId = 'Item_OptionContent_Response_MC_' + item.position + '_' + this.key;
contentEl.setAttribute('id', contentId);
}
optionEl.setAttribute('aria-labelledby', contentId);
var clickerEl = Util.Dom.getElementByClassName('optionClicker', 'span', optionEl);
if (clickerEl) {
clickerEl.setAttribute('style', 'text-indent:-9999px;overflow:hidden;');
clickerEl.innerHTML = '&nbsp';
}
if (this.feedback) {
this.createFeedback();
}
YUE.on(optionEl, 'click', function (evt) {
this.select();
}, this, true);
var inputEl = this.getInputElement();
YUE.on(inputEl, 'click', function (evt) {
this.select(true);
}, this, true);
YUE.on(inputEl, 'focus', function (evt) {
YUD.setStyle(optionEl, 'background-color', 'orange');
});
YUE.on(inputEl, 'blur', function (evt) {
YUD.setStyle(optionEl, 'background-color', '');
});
new YAHOO.util.KeyListener(optionEl, {
keys: [32]
}, {
fn: this.select,
scope: this,
correctScope: true
}).enable();
};
MCOption.prototype.toString = function() {
return this.key;
};
window.ContentMCOption = MCOption;
})();

/* SOURCE FILE: ms.group.js (21e08872) 9/9/2014 2:09:01 PM */

(function() {
function MS(item) {
MS.superclass.constructor.call(this, item);
this._role = 'group';
this._minChoices = 0;
this._maxChoices = 0;
}
YAHOO.lang.extend(MS, ContentMCGroup);
MS.prototype.setMinChoices = function(num) {
this._minChoices = num;
};
MS.prototype.getMinChoices = function() {
return this._minChoices;
};
MS.prototype.setMaxChoices = function(num) {
this._maxChoices = num;
};
MS.prototype.getMaxChoices = function() {
return this._maxChoices;
};
MS.prototype.getSelected = function() {
var selectedOptions = [];
for (var i = 0; i < this._options.length; i++) {
if (this._options[i].isSelected()) {
selectedOptions.push(this._options[i]);
}
}
return selectedOptions;
};
MS.prototype.clear = function() {
var selected = this.getSelected();
for (var i = 0; i < selected.length; i++) {
selected[i].deselect();
}
};
MS.prototype.getValue = function() {
var options = this.getSelected();
return options.join(',');
};
MS.prototype.setValue = function(value) {
this.clear();
if (value == null) {
return false;
}
var optionKeys = value.split(',');
for (var i = 0; i < optionKeys.length; i++) {
var optionKey = optionKeys[i];
var option = this.getOption(optionKey);
if (option != null) {
option.select();
}
}
return true;
};
window.ContentMSGroup = MS;
})();

/* SOURCE FILE: ms.option.js (72b31e4b) 9/9/2014 2:09:01 PM */

(function() {
var MSOption = function(options, key) {
MSOption.superclass.constructor.call(this, options, key);
this._role = 'checkbox';
};
YAHOO.lang.extend(MSOption, ContentMCOption);
MSOption.prototype._validateSelection = function() {
var maxChoices = this._options.getMaxChoices();
var selected = this._options.getSelected();
var selectedCount = selected.length;
if (maxChoices == 1 && selectedCount > 0) {
selected[0].deselect();
} else if (maxChoices > 0 && maxChoices <= selectedCount) {
return false;
}
return true;
};
MSOption.prototype.select = function() {
var group = this._options;
var item = group.getItem();
var page = item.getPage();
if (item.isReadOnly()) {
return false;
}
var cancelSelect = this.fire('beforeSelect');
if (cancelSelect === false) {
return false;
}
var inputEl = this.getInputElement();
if (inputEl.checked) {
this.deselect();
} else {
if (!this._validateSelection()) {
return false;
}
inputEl.checked = true;
var optionEl = this.getElement();
YUD.addClass(optionEl, 'optionSelected');
optionEl.setAttribute('aria-checked', 'true');
var accProps = page.getAccommodationProperties();
if (accProps != null && accProps.showFeedback()) {
this.showFeedback();
}
}
this.fire('select');
return true;
};
window.ContentMSOption = MSOption;
})();

/* SOURCE FILE: mc.widget.js (1c39e779) 10/26/2014 1:27:05 PM */

(function(CM) {
function match(page, entity, content) {
var item = entity;
var id = 'OptionsContainer_' + item.position;
var optionsEl = document.getElementById(id);
if (optionsEl && content.options) {
return new CM.WidgetConfig('choice', optionsEl, {
options: content.options,
constraints: content.optionsConfig
});
} else {
return false;
}
}
function Widget_MC(page, entity, config) {
this._ready = false;
this._group = null;
}
CM.registerWidget('mc', Widget_MC, match);
Widget_MC.prototype.init = function (config) {
var item = this.entity,
group = null;
if (item.format != null && item.format.toUpperCase() == 'MS') {
group = new ContentMSGroup(item);
if (config.constraints) {
group.setMinChoices(config.constraints.minChoices);
group.setMaxChoices(config.constraints.maxChoices);
}
} else {
group = new ContentMCGroup(item);
group.autoRespond = true;
}
config.options.forEach(function (configOption) {
var optionKey = configOption.key.toUpperCase();
var option;
if (item.format != null && item.format.toUpperCase() == 'MS') {
option = new ContentMSOption(group, optionKey);
} else {
option = new ContentMCOption(group, optionKey);
}
group.addOption(option);
option.tts = configOption.tts;
option.feedback = configOption.feedback;
}.bind(this));
this._group = group;
}
Widget_MC.prototype.load = function () {
if (this.page.layout == 'wai') {
var item = this.entity;
var itemEl = item.getElement();
YUD.addClass(itemEl, 'multipleChoiceItem');
if (item.format == 'MS') {
YUD.addClass(itemEl, 'format_ms');
} else {
YUD.addClass(itemEl, 'format_mc');
}
}
this._group.render(this.element);
this._ready = true;
}
Widget_MC.prototype.getComponents = function () {
return this._group.getOptions().map(function (option) {
return option.getElement();
});
}
Widget_MC.prototype.isReady = function() {
return this._ready;
}
Widget_MC.prototype.isBusy = function() {
return this.isReady();
}
Widget_MC.prototype.getResponse = function() {
var value = this._group.getValue();
if (value) {
return this.createResponse(value, true, true);
} else {
return this.createResponse(null, false, false);
}
}
Widget_MC.prototype.setResponse = function (value) {
if (value) {
this._group.setValue(value);
return true;
}
return false;
}
Widget_MC.prototype.toString = function() {
return 'widget-mc';
}
})(ContentManager);

/* SOURCE FILE: ebsr.js (194d0532) 9/9/2014 2:08:52 PM */

var EBSR = function (xmlString, item) {
this._xmlString = xmlString;
var ebsrItem = this;
this._position = item.position;
var nodes = Util.Xml.parseFromString(xmlString);
var docElement = nodes.documentElement;
this.interactionsXml = docElement.getElementsByTagName('choiceInteraction');
this._interactions = [];
this._interactionHash = {};
$.each(this.interactionsXml, function (i, interactionXml) {
var contentOptionClass = [];
contentOptionClass["MS"] = EBSR.MSOption;
contentOptionClass["MC"] = EBSR.MCOption;
var interaction = new EBSR.QTI(interactionXml, item.position, contentOptionClass, i + 1);
interaction.options.getItem = function () {
return item;
};
ebsrItem.addInteraction(interaction);
});
};
EBSR.prototype.addInteraction = function(interaction) {
this._interactions.push(interaction);
this._interactionHash[interaction.responseId] = interaction;
};
EBSR.prototype.getInteractions = function() {
return this._interactions;
};
EBSR.prototype.getPrompts = function() {
var interactions = this.getInteractions();
var prompts = [];
Util.Array.each(interactions, function(interaction) {
var prompt = interaction.getPrompt();
if (prompt && prompt.length == 1) {
prompts.push(prompt[0]);
}
});
return prompts;
};
EBSR.prototype.getInteractionByKey = function (key) {
var interactions = this.getInteractions();
var targetInteraction = {};
Util.Array.each(interactions, function(interaction) {
if (interaction.key == key) {
targetInteraction = interaction;
}
});
return targetInteraction;
};
EBSR.prototype.getInteraction = function (key) {
return this._interactionHash[key];
};
EBSR.prototype.getFocusedOption = function (focusedComponent) {
for (var i = 0; i< this._interactions.length; i++) {
var options = this._interactions[i].getOptions();
for (var j = 0; j < options.length; j++) {
var option = options[j];
if (option.getElement() == focusedComponent) return option;
}
}
};
EBSR.prototype.populateStem = function () {
if (this._xmlString == null) return;
var xmlDoc = Util.Xml.parseFromString(this._xmlString);
var docEl = xmlDoc.documentElement;
var stemContent = $(docEl).children().not('choiceInteraction');
$("#Stem_" + this._position).html(stemContent.contents());
};
EBSR.prototype.generateHTML = function (answerContainer) {
var interactions = this.getInteractions();
Util.Array.each(interactions, function (interaction) {
interaction.generateInteractionHTML(answerContainer);
});
};
EBSR.prototype.getAllComponentLists = function () {
var componentList = [];
var interactions = this.getInteractions();
Util.Array.each(interactions, function (interaction) {
var interactionComponentList = interaction.getComponentList();
componentList = componentList.concat(interactionComponentList);
});
return componentList;
};
EBSR.prototype.getAllRadioButtons = function () {
var radioButtons = [];
var interactions = this.getInteractions();
Util.Array.each(interactions, function (interaction) {
var interactionRadioButtons = interaction.getRadioButtons();
radioButtons = radioButtons.concat(interactionRadioButtons);
});
return radioButtons;
};
EBSR.prototype.setValue = function (value) {
if (typeof value != 'string' ||
value.indexOf('<itemResponse>') == -1) {
return false;
}
var ebsr = this;
var nodes = Util.Xml.parseFromString(value);
var docElement = nodes.documentElement;
$('response', docElement).each(function (responseIdx, responseNode) {
var responseId = responseNode.getAttribute('id');
var interaction = ebsr.getInteraction(responseId);
if (interaction && interaction.options) {
interaction.options.clear();
$('value', responseNode).each(function (valueIdx, valueNode) {
var optionId = $(valueNode).text();
if (optionId) {
var option = interaction.options.getOption(optionId);
if (option) {
option.select(true);
}
}
});
}
});
return true;
};
EBSR.prototype.getResponse = function() {
var responseEl = ['<itemResponse>'];
var interactions = this.getInteractions();
var createSelectedNode = function (selected) {
if (selected) {
responseEl.push('<value>');
responseEl.push(selected);
responseEl.push('</value>');
}
};
Util.Array.each(interactions, function(interaction) {
responseEl.push('<response id="' + interaction.responseId + '">');
var selected = interaction.options.getSelected();
if (interaction.type.toUpperCase() == "MS") {
for (var i = 0; i < selected.length; i++) {
createSelectedNode(selected[i]);
}
} else {
createSelectedNode(selected);
}
responseEl.push('</response>');
});
responseEl.push('</itemResponse>');
return responseEl.join('');
};
EBSR.prototype.isValid = function() {
var interactions = this.getInteractions();
var response = true;
Util.Array.each(interactions, function (interaction) {
var selected = interaction.options.getSelected();
if (!selected || selected.length == 0) {
response = false;
}
});
return response;
};

/* SOURCE FILE: ebsr.option.js (739f5753) 9/9/2014 2:08:52 PM */

(function() {
var getElement = function () {
var item = this._options.getItem();
var doc = item.getPage().getDoc();
return doc.getElementById('Item_OptionContainer_Response_EBSR_' +
item.position + '_Part' + this._interactionKey + '_' + this.key);
};
var getInputElement = function () {
var item = this._options.getItem();
var doc = item.getPage().getDoc();
return doc.getElementById('Item_Response_EBSR_' + item.position + '_Part' + this._interactionKey +
'_' + this.key);
};
var getSoundLink = function () {
var item = this._options.getItem();
var doc = item.getPage().getDoc();
var soundDIV = doc.getElementById('Item_OptionSound_Response_EBSR_' + item.position +
'_Part' + this._interactionKey + '_' + this.key);
if (soundDIV == null) return null;
var soundLink = soundDIV.getElementsByTagName('a')[0];
return soundLink;
};
EBSR.MCOption = function (options, key, interactionKey) {
EBSR.MCOption.superclass.constructor.call(this, options, key);
this._interactionKey = interactionKey;
};
YAHOO.lang.extend(EBSR.MCOption, ContentMCOption);
EBSR.MCOption.prototype.getElement = getElement;
EBSR.MCOption.prototype.getInputElement = getInputElement;
EBSR.MCOption.prototype.getSoundLink = getSoundLink;
EBSR.MSOption = function (options, key, interactionKey) {
EBSR.MSOption.superclass.constructor.call(this, options, key, interactionKey);
this._interactionKey = interactionKey;
};
YAHOO.lang.extend(EBSR.MSOption, ContentMSOption);
EBSR.MSOption.prototype.getElement = getElement;
EBSR.MSOption.prototype.getInputElement = getInputElement;
EBSR.MSOption.prototype.getSoundLink = getSoundLink;
})();

/* SOURCE FILE: ebsr.qti.js (ae4e8f70) 9/9/2014 2:08:52 PM */

EBSR.QTI = function (interactionXml, itemKey, contentOptionClass, interactionKey) {
this._componentList = [];
if (contentOptionClass == null) {
contentOptionClass = [];
contentOptionClass["MS"] = ContentMSOption;
contentOptionClass["MC"] = ContentMCOption;
}
var options;
this.responseId = interactionXml.getAttribute('responseIdentifier');
this.maxChoice = interactionXml.getAttribute('maxChoice');
if (this.maxChoice && (this.maxChoice != "1")) {
this.type = "MS";
options = new ContentMSGroup();
} else {
this.type = "MC";
options = new ContentMCGroup();
};
this.itemKey = itemKey;
this.key = interactionKey;
var prompt = interactionXml.getElementsByTagName('prompt')[0];
var promptToHtml = Util.Xml.serializeToString(prompt);
this.promptText = $(promptToHtml).html();
var optionsXml = interactionXml.getElementsByTagName('simpleChoice');
var optionsArray = [];
var contentOption = contentOptionClass[this.type];
Util.Array.each(optionsXml, function (optionXml) {
var optionKey = optionXml.getAttribute('identifier').toUpperCase();
var option = new contentOption(options, optionKey, interactionKey);
options.addOption(option);
var parsedOption = {};
parsedOption.key = optionKey;
var optionToHtml = Util.Xml.serializeToString(optionXml);
parsedOption.innerHTML = $(optionToHtml).html();
optionsArray[optionKey] = parsedOption;
});
this.options = options;
this.parsedOptions = optionsArray;
};
EBSR.QTI.prototype.getOptions = function () {
return this.options.getOptions();
};
EBSR.QTI.prototype.getPrompt = function () {
return this._prompt;
};
EBSR.QTI.prototype.getHeader = function () {
return this._header;
};
EBSR.QTI.prototype.getComponentList = function () {
return this._componentList;
};
EBSR.QTI.prototype.generateInteractionHTML = function (answerContainer) {
var interactionHTML = $('<div></div')
.attr('id', 'Item_Container_EBSR_' + this.itemKey + '_' + this.key)
.attr('role', this.options._role)
.addClass('interactionContainer')
.appendTo(answerContainer);
this.generatePromptHTML(interactionHTML);
this._componentList.push(this._prompt[0]);
var interaction = this;
var options = this.getOptions();
if (options && options.length > 0) {
Util.Array.each(options, function (option) {
var optionContainer = interaction.generateOptionHTML(interactionHTML, option);
interaction._componentList.push(optionContainer);
option.render();
});
}
};
EBSR.QTI.prototype.generatePromptHTML = function (parent) {
var headerKey = 'EBSR.Header.Part' + this.key;
var ttsKey = 'TDSTTS.Speak.EBSR.Part' + this.key;
var headerText = Messages.get(headerKey);
this._header = $('<h3>' + headerText + '</h3>').appendTo(parent);
if (Messages.has(ttsKey)) {
var ttsText = Messages.get(ttsKey);
this._header.attr('ssml', 'sub')
.attr('ssml_alias', ttsText)
.addClass('TTS')
.addClass('speakAs');
}
this._prompt = $('<div></div>')
.attr('id', 'Item_InteractionPrompt_Response_EBSR_' + this.itemKey + '_' + this.key)
.addClass('interactionPrompt')
.html(this.promptText)
.appendTo(parent);
};
EBSR.QTI.prototype.generateOptionHTML = function (parent, option) {
var optionIdString = this.itemKey + '_Part' + this.key;
var nodeId = 'Item_OptionContainer_Response_EBSR_' + optionIdString + '_' + option.key;
var nodeClass = "EBSR_" + this.type.toLowerCase();
var node = $('<div></div>')
.attr('id', nodeId)
.attr('title', Messages.get('EBSR.Header.Part' + this.key) + ' Option ' + option.key)
.addClass('optionContainer option' + option.key + ' ' + nodeClass)
.append('<span class="striked"></span>')
.append('<span class="optionClicker"></span>')
.appendTo(parent);
var inputButton = $('<input></input')
.attr('name', 'Item_Response_EBSR_' + optionIdString)
.attr('value', option.key)
.attr('id', 'Item_Response_EBSR_' + optionIdString + '_' + option.key)
.addClass('option')
.appendTo(node);
if (this.type.toUpperCase() == "MS") {
var type = 'checkbox';
inputButton.attr('data-tts-prefix', 'TDSTTS.Speak.Select' + option.key);
} else {
type = 'radio';
}
inputButton.prop('type', type);
$('<div></div>')
.addClass('optionContent')
.attr('id', 'Item_OptionContent_Response_EBSR_' + optionIdString + '_' + option.key)
.html(this.parsedOptions[option.key].innerHTML)
.appendTo(node);
return node[0];
};

/* SOURCE FILE: ebsr.widget.js (ce46e11d) 10/26/2014 1:27:05 PM */

(function(CM) {
function match(page, item, content) {
var id = 'EBSR_' + item.position;
var el = document.getElementById(id);
if (el) {
return new CM.WidgetConfig(id, el, item.qti.xml);
}
return false;
}
function Widget_EBSR(page, item, config) {
this.ebsr = null;
}
CM.registerWidget('ebsr', Widget_EBSR, match);
Widget_EBSR.prototype.load = function () {
var item = this.entity;
var ebsrEl = this.element;
var qtiXml = this.config;
var ebsr = new EBSR(qtiXml, item);
this.ebsr = ebsr;
ebsr.generateHTML(ebsrEl);
ebsr.populateStem();
var componentList = ebsr.getAllComponentLists();
if (componentList && componentList.length) {
for (var i = 0; i < componentList.length; i++) {
item.addComponent(componentList[i]);
}
}
if (item.value) {
ebsr.setValue(item.value);
}
}
Widget_EBSR.prototype.keyEvent = function(evt) {
var item = this.entity;
var ebsr = this.ebsr;
if (evt.type != 'keydown') return;
if (evt.ctrlKey || evt.altKey) return;
if (evt.key == 'Enter') {
if (item.isReadOnly()) return;
var focusedComponent = item.getActiveComponent();
if (focusedComponent) {
var option = ebsr.getFocusedOption(focusedComponent);
if (option) {
option.select();
}
}
}
}
function onMenuShowTTS(page, item, menu, ebsr, interaction, selection) {
var accProps = page.getAccommodationProperties();
if (!accProps.hasTTSItem()) return;
var pageWin = page.getActiveWin();
var languages = CM.getLanguage() == 'ESN' ? ['ESN', 'ENU'] : ['ENU'];
var focusedComponent = item.getActiveComponent();
var focusedOption = ebsr.getFocusedOption(focusedComponent);
var domToParse = [];
domToParse.push(interaction.getHeader()[0]);
domToParse.push(interaction.getPrompt()[0]);
var ttsMenu = new TTS.Menu(languages);
var menuCfg = ttsMenu.getMenuCfg(domToParse, selection, pageWin, item.stemTTS, page, item);
for (var i = 0; i < interaction.getOptions().length; ++i) {
var element = (interaction.getOptions())[i].getElement();
var testCfg = null;
var testMenu = new TTS.Menu(languages);
testCfg = testMenu.addFocusedOption(testCfg, element);
if (testCfg && testCfg.PRI.cb) {
domToParse.push(element);
}
}
if (domToParse.length > 2) {
ttsMenu.addOptions(menuCfg, domToParse);
}
if (focusedOption && focusedOption.key) {
menuCfg.SEL_PRI = false;
menuCfg.SEL_SEC = false;
menuCfg.PRI.level = 'component';
menuCfg.SEC.level = 'component';
menuCfg.STOP.level = 'component';
menuCfg.PAUSE.level = 'component';
menuCfg.RESUME.level = 'component';
ttsMenu.addFocusedOption(menuCfg, item.getActiveComponent());
}
TTS.MenuSystem.addMenuSetup(menu, menuCfg);
TTS.Config.Debug && console.log("TTS On Item Menushow config", menuCfg);
}
function onMenuShowASL(page, item, menu, ebsr, interaction) {
var attachments = item.getAslAttachments();
if (attachments && attachments.length > 0) {
for (var i = 0; i < attachments.length; ++i) {
var at = attachments[i];
if (at.subType.toLowerCase() == 'targeted') {
var target = at.target;
if (interaction.responseId == target) {
var menuItem = {
text: Messages.get('TDSContentEventJS.Label.ASLItem'),
classname: 'ASL',
onclick: {
fn: function () {
AslModule.showImageDialog(at.url, page.getZoomFactor());
}
}
};
menu.addMenuItem('component', menuItem);
return;
}
}
}
}
}
function onMenuShowStemTTS(page, item, menu, ebsr, stem, selection) {
var accProps = page.getAccommodationProperties();
if (!accProps.hasTTSItem()) return;
var pageWin = page.getActiveWin();
var languages = CM.getLanguage() == 'ESN' ? ['ESN', 'ENU'] : ['ENU'];
var domToParse = [];
domToParse.push(stem);
var ttsMenu = new TTS.Menu(languages);
var menuCfg = ttsMenu.getMenuCfg(domToParse, selection, pageWin, item.stemTTS, page, item);
var interactions = ebsr.getInteractions();
for (var i = 0; i < interactions.length; i++) {
var interaction = interactions[i];
domToParse.push(interaction.getHeader()[0]);
domToParse.push(interaction.getPrompt()[0]);
for (var j = 0; j < interaction.getOptions().length; ++j) {
domToParse.push((interaction.getOptions())[j].getElement());
}
}
ttsMenu.addOptions(menuCfg, domToParse);
TTS.MenuSystem.addMenuSetup(menu, menuCfg);
TTS.Config.Debug && console.log("TTS On Item Menushow config", menuCfg);
}
Widget_EBSR.prototype.showMenu = function (menu, evt, selection) {
var page = this.page;
var item = this.entity;
var ebsr = this.ebsr;
function getClosestInteraction(target) {
var pageEl = page.getElement();
var $closestInteraction = $(target).closest('div.interactionContainer', pageEl);
return $closestInteraction;
};
var interaction = null;
var $interactionContainer = getClosestInteraction(evt.target);
if ($interactionContainer && $interactionContainer.length == 0) {
var componentEl = item.getActiveComponent();
$interactionContainer = getClosestInteraction(componentEl);
}
if ($interactionContainer.length > 0) {
var interactionId = $interactionContainer.attr('id');
if (interactionId) {
var interactionKey = interactionId.split('_').pop();
if (interactionKey) {
interaction = ebsr.getInteractionByKey(interactionKey);
}
}
}
if (interaction != null) {
onMenuShowTTS(page, item, menu, ebsr, interaction, selection);
onMenuShowASL(page, item, menu, ebsr, interaction);
}
var $stemContainer = $(evt.target).closest('div.stemContainer');
if ($stemContainer.length > 0) {
onMenuShowStemTTS(page, item, menu, ebsr, $stemContainer[0], selection);
}
}
Widget_EBSR.prototype.hide = function () {
TTS.getInstance().stop();
}
Widget_EBSR.prototype.isResponseAvailable = function () {
return this.ebsr != null;
}
Widget_EBSR.prototype.getResponse = function() {
var ebsr = this.ebsr;
var value = ebsr.getResponse();
var isValid = ebsr.isValid();
return this.createResponse(value, isValid);
}
Widget_EBSR.prototype.setResponse = function(value) {
var ebsr = this.ebsr;
ebsr.setValue(value);
}
})(window.ContentManager);

/* SOURCE FILE: wl_item.js (9503d043) 9/9/2014 2:09:05 PM */

WordListItem.tagType = ["div", "span"];
WordListItem.attributeName = "data-word-index";
WordListItem.groupAttributeName = "data-wl-group";
WordListItem.ClassNameString = "TDS_WORD_LIST";
WordListItem.ClassNameStringHover = "TDS_WORD_LIST_HOVER";
WordListItem.CTag = 0;
WordListItem.GTag = 0;
function WordListItem () {
var myPageSpans = [];
var myPageZOrders = {
current: -1,
total: 0
};
var spanCount = 0;
this.getSpanCount = function() { return spanCount;};
this.TagSingleSpan = function (span) {
YUD.addClass(span, WordListItem.ClassNameString);
var spanid = 'word-list-' + WordListItem.CTag;
WordListItem.CTag++;
YUD.setAttribute(span, 'id', spanid);
YAHOO.util.Event.addListener(span, 'mouseenter', WordListItem.mouseOver, this);
YAHOO.util.Event.addListener(span, 'mouseleave', WordListItem.mouseOut, this);
YAHOO.util.Event.addListener(span, 'click', WordListItem.clickHandler, this);
myPageSpans[spanCount] = span;
++spanCount;
myPageZOrders.total = spanCount;
};
this.TagSpans = (function (elements) {
var spans = [];
var dupSpans = [];
var tmpSpanCount = 0;
for (var i = 0; i < WordListItem.tagType.length; ++i) {
var divs = elements.getElementsByTagName(WordListItem.tagType[i]);
for (var j = 0; divs != null && j < divs.length; ++j) {
var div = divs[j];
if (YUD.getAttribute(div, WordListItem.attributeName) != null) {
spans[tmpSpanCount] = div;
++tmpSpanCount;
}
}
for (j = 0; j < spans.length; ++j) {
spans[j].setAttribute(WordListItem.groupAttributeName, "" + WordListItem.GTag);
var fff = new Retagger(spans[j]);
fff.Retag();
WordListItem.GTag++;
}
}
var itemKey = this.wl_res.itemKey;
var baseKey = this.wl_res.bankKey + '-' + this.wl_res.itemKey + '-';
WordListPanel.requestQ[itemKey] = [];
for (var i = 0; i < WordListItem.tagType.length; ++i) {
divs = elements.getElementsByTagName(WordListItem.tagType[i]);
for (var j = 0; divs != null && j < divs.length; ++j) {
div = divs[j];
var index = YUD.getAttribute(div, WordListItem.attributeName);
if (index != null) {
var key = baseKey + index.toString();
WordListPanel.requestQ[itemKey].push({ wl_item: this, span: div, key: key });
if (!dupSpans[parseInt(index)]) {
var indexString = WordListPanel.indexHdr + "=" + index.toString();
if (WordListPanel.indices == "") WordListPanel.indices = indexString;
else WordListPanel.indices = WordListPanel.indices + '&' + indexString;
dupSpans[parseInt(index)] = true;
}
}
}
}
WordListPanel.sendRequest(this);
WordListPanel.indices = '';
});
this.HandleKey = function (evt) {
var isHandled = false;
if ((evt.type == 'keyup') && (!evt.ctrlKey)) {
if (myPageZOrders != null) {
zo = myPageZOrders;
spans = myPageSpans;
if (zo.current >= 0) {
var div = spans[zo.current];
var entry = { wl_item: this, span: div };
WordListPanel.processClick(entry,
this.getGroupHtml(div));
this.AddClassToGroup(div,
WordListItem.ClassNameString, WordListItem.ClassNameStringHover);
isHandled = true;
}
}
}
if (evt.keyCode == 27)
{
if (WordListPanel.panel != null)
WordListPanel.panel.hide();
return isHandled;
}
if (!(evt.type == 'keydown'))
return isHandled;
if (!evt.ctrlKey) return;
if (evt.keyCode != 88)
return isHandled;
isHandled = true;
if ((WordListPanel.panel != null)  &&
(WordListPanel.panel.cfg.getProperty('visible') == true) &&
(WordListPanel.tabView != null) &&
(WordListPanel.tabCount > 0)) {
WordListPanel.tabCurrent = (WordListPanel.tabCurrent + 1) % WordListPanel.tabCount;
WordListPanel.tabView.selectTab(WordListPanel.tabCurrent);
return isHandled;
}
var spanGroupAttr = "";
if (myPageZOrders != null) {
var zo = myPageZOrders;
var spans = myPageSpans;
if (zo.current >= 0) {
spanGroupAttr = YUD.getAttribute(spans[zo.current],WordListItem.groupAttributeName);
this.AddClassToGroup(
spans[zo.current],WordListItem.ClassNameString, WordListItem.ClassNameStringHover);
}
zo.current = zo.current + 1;
while ((zo.current < zo.total) &&
(YUD.getAttribute(spans[zo.current],WordListItem.groupAttributeName) == spanGroupAttr)) {
zo.current = zo.current + 1;
}
if (zo.current == zo.total) {
zo.current = -1;
return isHandled;
}
this.AddClassToGroup(spans[zo.current],WordListItem.ClassNameStringHover, WordListItem.ClassNameString);
ContentManager.log("wordlist: focus span " + zo.current + " out of " + zo.total + " evt is " + evt.type);
}
return isHandled;
};
this.AddClassToGroup = function(div, classToAdd, classToRemove) {
var groupTag = YAHOO.util.Dom.getAttribute(div,WordListItem.groupAttributeName);
for (var j = 0; j < myPageSpans.length; ++j) {
if (YAHOO.util.Dom.getAttribute(myPageSpans[j],WordListItem.groupAttributeName) == groupTag) {
YAHOO.util.Dom.removeClass(myPageSpans[j], classToRemove);
YAHOO.util.Dom.addClass(myPageSpans[j], classToAdd);
}
}
};
this.getGroupHtml = function(div) {
var groupTag = YAHOO.util.Dom.getAttribute(div, WordListItem.groupAttributeName);
var rv = "";
for (var j = 0; j < myPageSpans.length; ++j) {
if (YAHOO.util.Dom.getAttribute(myPageSpans[j], WordListItem.groupAttributeName) == groupTag) {
rv = rv + myPageSpans[j].innerHTML;
}
}
return rv;
};
};
WordListItem.mouseOver = (function (event, wl) {
var div = this;
wl.AddClassToGroup(div,
WordListItem.ClassNameStringHover, WordListItem.ClassNameString);
});
WordListItem.mouseOut = (function (event, wl) {
var div = this;
wl.AddClassToGroup(div,
WordListItem.ClassNameString, WordListItem.ClassNameStringHover);
});
WordListItem.clickHandler = (function(event, wl) {
var div = this;
var entry = { wl_item: wl, span: div };
var headerText = wl.getGroupHtml(div);
WordListPanel.processClick(entry, headerText);
});

/* SOURCE FILE: wl_panel.js (1722ced9) 10/26/2014 1:27:06 PM */

function WordListPanel() {
}
WordListPanel.queryName = "key";
WordListPanel.bankKeyHdr = "bankKey";
WordListPanel.itemKeyHdr = "itemKey";
WordListPanel.indexHdr = "index";
WordListPanel.AccType = "Word List";
WordListPanel.AccNoAccs = "TDS_WL0";
WordListPanel.AccHdr = "TDS_ACCS";
WordListPanel.divId = "WordListTool";
WordListPanel.toolDiv = null;
WordListPanel.panel = null;
WordListPanel.tabView = null;
WordListPanel.tabCount = 0;
WordListPanel.tabCurrent = 0;
WordListPanel.requestQ = [];
WordListPanel.indices = '';
WordListPanel.LoadingPageString = "<div id=\"word-list-list-div\" class=\"yui-navset\">\r\n<ul class=\"yui-nav\"> " +
"<li class=\"selected\"><a href=\"#word-list-tab1\"><em>Loading</em></a></li></ul>\r\n" +
"   <div class=\"yui-content\"> " +
"<div id=\"word-list-tab1\"><p>Please Wait</p></div> </div> ";
WordListPanel.ErrorPageString = "<div id=\"word-list-list-div\" class=\"yui-navset\">\r\n<ul class=\"yui-nav\"> " +
"<li class=\"selected\"><a href=\"#word-list-tab1\"><em>Information</em></a></li></ul>\r\n" +
"   <div class=\"yui-content\"> " +
"<div id=\"word-list-tab1\"><p>Content Not Found.</p></div> </div> ";
WordListPanel.xhrUrl = "Pages/API/WordList.axd";
WordListPanel.xhrMethod = "resolve";
WordListPanel.tabbedDivName = "word-list-list-div";
WordListPanel.splitter = new RegExp("(\\d+):(\\w+)");
WordListPanel.contentWordCache = [];
WordListPanel.headerWordCache = [];
WordListPanel.message = [];
WordListPanel.failedRequest = [];
WordListPanel.getKeyFromQEntry = function(entry) {
var keyIndex = YUD.getAttribute(entry.span, WordListItem.attributeName);
var bankKey = entry.wl_item.wl_res.bankKey;
var itemKey = entry.wl_item.wl_res.itemKey;
return bankKey + '-' + itemKey + '-' + keyIndex;
};
WordListPanel.postCallback = {
success: (function (resp) {
var messages = YAHOO.lang.JSON.parse(resp.responseText);
for (var i = 0; messages != null && i < messages.length; ++i) {
var tabString = WordListPanel.RenderHtmlTabs(messages[i]);
var key = messages[i].EntryKey;
var itemKey = key.split('-')[1];
WordListPanel.contentWordCache[key] = tabString;
WordListPanel.message[key] = messages[i];
}
if (WordListPanel.requestQ[itemKey] == null) {
console.log("word list: server returned empty response, returning.");
return;
}
for (i = 0; i < WordListPanel.requestQ[itemKey].length; ++i) {
var entry = WordListPanel.requestQ[itemKey][i];
var cacheEntry = WordListPanel.message[entry.key];
if (cacheEntry && cacheEntry.EntryFound) {
entry.wl_item.TagSingleSpan(entry.span);
}
}
}),
argument: []
};
WordListPanel.processClick = (function (entry, headerText) {
if (entry != null) {
if ((WordListPanel.panel != null) && (WordListPanel.toolDiv != null)) {
var cacheKey = WordListPanel.getKeyFromQEntry(entry);
if (WordListPanel.contentWordCache[cacheKey] != null) {
WordListPanel.headerWordCache[cacheKey] = headerText;
WordListPanel.setPanel(WordListPanel.headerWordCache[cacheKey], WordListPanel.contentWordCache[cacheKey]);
} else {
ContentManager.log("WordList: errantly tagged span");
}
}
}
});
WordListPanel.sendRequest = (function (wl_item) {
var bankKey = wl_item.wl_res.bankKey;
var itemKey = wl_item.wl_res.itemKey;
if (typeof(WordListPanel.indices) != "string" || WordListPanel.indices.length < 1)
return;
var str = WordListPanel.bankKeyHdr + "=" + bankKey.toString();
str = str + "&" + WordListPanel.itemKeyHdr + "=" + itemKey.toString();
str = str + "&" + WordListPanel.indices;
var wlCodes = Accommodations.Manager.getCurrent().getType(WordListPanel.AccType).getCodes(true);
for (var i = 0, ii = wlCodes.length; i < ii; i++) {
var wlInner = wlCodes[i].split('&');
for (var j = 0; j < wlInner.length; ++j) {
str += "&" + WordListPanel.AccHdr + "=" + wlInner[j];
}
}
var urlString = TDS.baseUrl + WordListPanel.xhrUrl + "/" + WordListPanel.xhrMethod;
if (/^http/.test(WordListPanel.xhrUrl))
urlString = WordListPanel.xhrUrl + "/" + WordListPanel.xhrMethod;
YAHOO.util.Connect.asyncRequest('POST', urlString, WordListPanel.postCallback, str);
});
WordListPanel.IsWordListEnabled = (function () {
var accs = Accommodations.Manager.getCurrent();
var wlType = accs.getType(WordListPanel.AccType);
if (!wlType) {
return false;
}
var wlValues = wlType.getSelected();
if (wlValues.length == 0) {
return false;
}
for (var i = 0; i < wlValues.length; ++i) {
var codes = wlValues[i].getCodes();
for (var j = 0; j < codes.length; ++j) {
if (codes[j] == WordListPanel.AccNoAccs) {
return false;
}
}
}
return true;
});
WordListPanel.setPanel = function (hd, bd) {
if ((WordListPanel.panel != null) && (WordListPanel.toolDiv != null)) {
if (hd != null) {
WordListPanel.panel.setHeader(hd);
}
WordListPanel.panel.setBody(bd);
WordListPanel.panel.show();
WordListPanel.tabView = new YAHOO.widget.TabView(WordListPanel.tabbedDivName);
WordListPanel.tabCount = 0;
while (WordListPanel.tabView.getTab(WordListPanel.tabCount) != null) {
WordListPanel.tabCount++;
}
WordListPanel.tabCurrent = 0;
setTimeout(function () {
WordListPanel.postProcessAudioTags();
}.bind(this), 1);
}
};
WordListPanel.InitializePane = (function () {
YAHOO.widget.Tab.prototype.ACTIVE_TITLE = '';
var toolDiv = document.getElementById("tools");
if (toolDiv != null) {
WordListPanel.toolDiv = document.createElement("div");
YUD.addClass(WordListPanel.toolDiv, "yui-dialog focused");
YUD.setAttribute(WordListPanel.toolDiv, 'id', WordListPanel.divId);
var clink = document.createElement("link");
YUD.setAttribute(clink, 'type', 'text/css');
YUD.setAttribute(clink, 'rel', 'stylesheet');
YUD.setAttribute(clink, 'media', 'screen');
YUD.setAttribute(clink, 'href', ContentManager.resolveBaseUrl('Scripts/Libraries/YUI/tabview/assets/skins/sam/tabview.css'));
WordListPanel.toolDiv.appendChild(clink);
toolDiv.appendChild(WordListPanel.toolDiv);
WordListPanel.panel = new YAHOO.widget.Panel("wordListPanel", { width: "320px", zindex: 1004, visible:false, constraintoviewport: true });
WordListPanel.panel.render(WordListPanel.toolDiv);
}
});
WordListPanel.RenderHtmlTabs = function (messages) {
var tabString = "<div id=\"" + WordListPanel.tabbedDivName + "\" class=\"yui-navset\"> \r\n";
tabString = tabString + "<ul class=\"yui-nav\">\r\n";
var contentString = " <div class=\"yui-content\">\r\n";
var i;
for (i = 0; i < messages.Entries.length; ++i) {
tabString = tabString + "<li";
if (i == 0) {
tabString = tabString + " class=\"selected\"";
}
tabString = tabString + "> <a href=\"#word-list-" + i.toString();
var wlTypeTranslation = Messages.get('TDS.WordList.' + messages.Entries[i].wlType);
tabString = tabString + "\">" + wlTypeTranslation + "</a></li>\r\n";
contentString = contentString + "<div id=\"word-list-" + i.toString() + "\"><p>" + messages.Entries[i].wlContent + "</p></div>";
}
tabString = tabString + "</ul>";
tabString = tabString + contentString + "</div>";
return tabString;
};
WordListPanel.postProcessAudioTags = function () {
if (!window.TDS || !window.TDS.Audio || !window.TDS.Audio.Widget) { return; }
var bd = WordListPanel.panel.body;
try {
if (!bd) { return; }
var audioEls = YAHOO.util.Selector.query('a', bd) || [];
for (var i = 0; i < audioEls.length; ++i) {
var span = audioEls[i];
if ((span) && (span.href)) {
var href = span.href;
if (href.indexOf('.ogg') != -1 || (href.indexOf('.m4a') != -1)) {
YUD.addClass(span, 'sound_repeat');
href = href.replace(/&amp;/gmi, '&');
span.href = href;
TDS.Audio.Widget.createPlayer(span);
}
}
}
} catch (e) {
console.error("Error creating players in the word list panel (error, dom).", e, bd);
}
};

/* SOURCE FILE: wl_retag.js (e570cfb3) 9/9/2014 2:09:05 PM */

function Retagger(astartElement) {
var endSibling = null;
var _startElement = astartElement;
this.Retag = function () {
debugLog(0, _startElement, "Retagging entry")
RetagSiblings(astartElement, false, 0);
};
var consumeInners = function (startElement, innerElements, level) {
if ((startElement == null) ||
(innerElements.length == 0)) {
return;
}
debugLog(level, startElement, "consumeInners: make sibs children of ");
for (var i = 0; i < innerElements.length; ++i) {
var newNode = innerElements[i].cloneNode(true);
debugLog(level, newNode, "consumeInners: adding child ");
startElement.appendChild(newNode);
innerElements[i].parentNode.removeChild(innerElements[i]);
}
};
var doesChildContainEnd = function (startElement,peerElement) {
var child = YUD.getFirstChild(peerElement);
if (child == null)
return false;
while (child) {
if (isEndElement(startElement, child)) {
return true;
}
if (doesChildContainEnd(startElement, child)) {
return true;
}
child = child.nextSibling;
}
return false;
};
var debugLog = function (level, obj, str) {
if (Retagger.verboseDebug) {
var props = ["outerHTML", "nodeType", "nodeName", "nodeValue"];
var op = "";
if ((typeof(obj) == "object") && (obj != null)) {
for (var i = 0; i < props.length; ++i) {
var pp = props[i];
if ((obj[pp] != undefined) && (obj[pp] != null)) {
op = op + " " + pp + ":" + obj[pp];
}
}
}
if (str != null) {
op = str + ":" + op;
}
console.log("lvl: " + level + " " + op);
}
};
var isEndElement = function (startElement, endElementTest) {
if ((YUD.getAttribute(endElementTest,"data-tag-boundary") == "end") &&
(YUD.getAttribute(endElementTest,"data-tag-ref") == YUD.getAttribute(startElement,"id"))) {
return true;
}
return false;
};
var RetagSiblings = function (startElement, endFound, level) {
var isParentElement = false;
var innerElements = [];
if (startElement == null)
return;
var sib = startElement.nextSibling;
while (sib != null) {
debugLog(level, sib, "Iterating");
if (isEndElement(startElement,sib)) {
debugLog(level, sib, "Found end span in sib");
endSibling = sib;
break;
}
if ((level >= 0) && (doesChildContainEnd(startElement,sib))) {
debugLog(level, sib, "Found end span in child");
isParentElement = true;
endSibling = sib;
break;
}
debugLog(level, sib, "Sib neither child nor parent, pushing");
innerElements.push(sib);
sib = sib.nextSibling;
}
if (endSibling != null) {
if (isParentElement) {
var newStartElem = startElement.cloneNode(false);
var child = endSibling.firstChild;
endSibling.insertBefore(newStartElem, child);
debugLog(level, newStartElem, "recursively calling retag on child");
RetagSiblings(newStartElem, true, level + 1);
}
consumeInners(startElement, innerElements, level);
if (!isParentElement) {
debugLog(level, endSibling, "End tag found at this level, removing.");
endSibling.parentNode.removeChild(endSibling);
}
}
else if (endFound == false) {
consumeInners(startElement, innerElements, level);
sib = startElement.parentNode;
if ((sib == null) || (sib.parentNode == null) ||
((sib.nodeName != undefined && (sib.nodeName == 'FORM') ||
(sib.nodeName == 'BODY'))
)
){
debugLog(level, sib, " endtag not found");
return;
}
newStartElem = startElement.cloneNode(false);
sib.parentNode.insertBefore(newStartElem,sib.nextSibling);
debugLog(level, sib, "End tag not found, looking in sibling of parent");
RetagSiblings(newStartElem, false, level - 1);
}
};
}
Retagger.verboseDebug = false;

/* SOURCE FILE: module_wordlist.js (61e8a0c5) 9/9/2014 2:08:51 PM */

(function(CM) {
function processEntity(page, entity) {
if (WordListPanel.IsWordListEnabled() == false) {
return;
}
var wordListResource = entity.getResource('wordList');
if (wordListResource == null) {
return;
}
var inst = new WordListItem();
inst.wl_res = wordListResource;
entity.wordList = inst;
var elements = entity.getElement();
inst.TagSpans(elements);
if (WordListPanel.toolDiv == null) {
WordListPanel.InitializePane();
}
}
CM.onPassageEvent('available', processEntity);
CM.onItemEvent('available', processEntity);
CM.onEntityEvent('keyevent', function (page, entity, evt) {
var inst = entity.wordList;
if (inst) {
if (inst.HandleKey(evt)) {
YUE.stopEvent(evt);
}
}
});
CM.onEntityEvent('hide', function (page, entity) {
if (WordListPanel && WordListPanel.panel) {
WordListPanel.panel.hide();
}
});
})(ContentManager);

/* SOURCE FILE: base.js (3742f6e8) 9/9/2014 2:09:05 PM */

function WordBuilder(keyboardDiv, textfield) {
this._keyboard = keyboardDiv;
this._textfield = textfield;
this._keyLinkToValueMap = new Object();
this._allowedKeyCodesMap = new Object();
this._allowedCharCodesMap = new Object();
this._allowedKeyCodesMap['8']="OK";
this._allowedKeyCodesMap['9']="OK";
this._allowedKeyCodesMap['46']="OK";
this._allowedKeyCodesMap['37']="OK";
this._allowedKeyCodesMap['38']="OK";
this._allowedKeyCodesMap['39']="OK";
this._allowedKeyCodesMap['40']="OK";
this.activate = function()
{
if (!this._textfield) this._textfield = this._getAssociatedTextField();
var keyContainers = this._keyboard.getElementsByTagName('li');
var allowableKeysArray = [];
for (var i = 0; i < keyContainers.length; i++) {
var keyValue = this._getText(YAHOO.util.Dom.getElementsByClassName('keyvalue', 'span', keyContainers[i])[0]);
var keyLink = keyContainers[i].getElementsByTagName('a')[0];
var keyDisplay = this._getText(keyLink);
allowableKeysArray.push(keyDisplay);
var success = YAHOO.util.Event.addListener(keyLink, 'click', this._keyboardClick, null, this);
this._keyLinkToValueMap[keyLink.id] = keyValue;
if (keyDisplay.length == 1) {
this._allowedCharCodesMap[keyDisplay.toUpperCase().charCodeAt()+'']="OK";
this._allowedCharCodesMap[keyDisplay.toLowerCase().charCodeAt()+'']="OK";
}
if (keyDisplay.toLowerCase() == 'space') {
this._allowedCharCodesMap['32']="OK";
this._allowedKeyCodesMap['32']="OK";
}
}
var instructions;
if ($(keyboardDiv).hasClass('fullsize')) {
instructions= Messages.getAlt('WB.Accessible.LetterKeys', 'Use the letter keys on your keyboard to answer the question.');
} else {
instructions = Messages.getAlt('WB.Accessible.AllowableKeys', 'Use the following keys on your keyboard to answer the question: ');
instructions += allowableKeysArray.join(', ');
}
this._textfield.setAttribute('aria-label', instructions);
this._textfield.setAttribute('aria-required', 'true');
YAHOO.util.Event.addListener(this._textfield, 'keypress', this._keyboardClick2, this, true);
};
this._getAssociatedTextField = function() {
var containerDiv = YAHOO.util.Dom.getAncestorByClassName(this._keyboard, 'itemContainer');
var textfields = YAHOO.util.Dom.getElementsByClassName('inputCloze', 'input', containerDiv);
return textfields[0];
};
this._getAssociatedStem = function() {
var containerDiv = YAHOO.util.Dom.getAncestorByClassName(this._keyboard, 'itemContainer');
var stem = YAHOO.util.Dom.getElementsByClassName('stemContainer', 'div', containerDiv);
return stem[0];
};
this._simulate_key = function(type, ctrlKey, altKey, shiftKey, keyCode, charCode) {
var textFieldValueBeforeKeyPress = this._textfield.value;
try {
YAHOO.util.UserAction.simulateKeyEvent(this._textfield, type, true, true, null, ctrlKey, altKey, shiftKey, false, keyCode, charCode);
} catch (ex) {
return false;
}
return (this._textfield.value != textFieldValueBeforeKeyPress);
};
this._keyboardClick = function(event)
{
YAHOO.util.Event.stopEvent(event);
var linkClicked = YAHOO.util.Event.getTarget(event);
var value = this._keyLinkToValueMap[linkClicked.id];
if (ContentManager.isReadOnly()) return;
if (value.toLowerCase() == "delete")
{
if (!this._simulate_key('keypress', false, false, false, 8, 0))
{
this._deleteFromTextField();
}
}
else
{
if (parseInt(this._textfield.maxLength) == 1) {
this._textfield.value = "";
}
if (!this._simulate_key('keypress', false, false, false, null, value.charCodeAt()))
{
this._appendToTextField(value);
}
}
};
this._keyboardClick2 = function(key) {
var charCode = key.charCode;
if (!charCode || charCode == 0) {
charCode = String.fromCharCode(key.keyCode).charCodeAt();
}
if (key.ctrlKey
|| this._allowedCharCodesMap[charCode + '']
|| (key.charCode == 0 && this._allowedKeyCodesMap[key.keyCode + '']))
{
return true;
}
if ((!key.shiftKey && key.keyCode == 190)                                   || (key.keyCode == 110 && charCode == 46)                  ) {
if (this._allowedKeyCodesMap['46']) {
return true;
}
}
YAHOO.util.Event.stopEvent(key);
return false;
};
this._appendToTextField = function(valueToInsert) {
if (valueToInsert) {
var cursorPosition = this._getCursorPosition();
if ((parseInt(this._textfield.maxLength) != -1) && (this._textfield.value.length >= parseInt(this._textfield.maxLength))) {
this._textfield.value = this._textfield.value.substr(0, this._textfield.value.length - 1) + valueToInsert;
this._setCursorPosition(this._textfield.value.length);
} else {
this._textfield.value = this._textfield.value.substr(0, cursorPosition)
+ valueToInsert
+ this._textfield.value.substr(cursorPosition, this._textfield.value.length);
if(cursorPosition == this._textfield.value.length-1)
{
this._setCursorPosition(this._textfield.value.length);
} else
{
this._setCursorPosition(cursorPosition+1);
}
}
}
ContentManager.focus(this._textfield);
};
this._deleteFromTextField = function() {
if (this._textfield.value.length > 0) {
var cursorPosition = this._getCursorPosition();
this._textfield.value = this._textfield.value.substr(0, cursorPosition-1) + this._textfield.value.substr(cursorPosition, this._textfield.value.length);
if(cursorPosition-1 < this._textfield.value.length)
{
this._setCursorPosition(cursorPosition-1);
}
}
ContentManager.focus(this._textfield);
};
this._getText = function(element) {
if (element.text) {
return element.text;
} else if (element.innerText) {
return element.innerText;
}
return element.innerHTML;
};
this._getCursorPosition = function() {
var CaretPos = 0;
if (document.selection) {
this._textfield.focus ();
var Sel = document.selection.createRange ();
var SelLength = document.selection.createRange().text.length;
Sel.moveStart ('character', -this._textfield.value.length);
CaretPos = Sel.text.length - SelLength;
}
else if (this._textfield.selectionStart || this._textfield.selectionStart == '0')
{
CaretPos = this._textfield.selectionStart;
}
return (CaretPos);
};
this._setCursorPosition = function(pos)
{
ContentManager.focus(this._textfield);
if (this._textfield.setSelectionRange) {
this._textfield.setSelectionRange(pos, pos);
}
else if (this._textfield.createTextRange) {
var range = this._textfield.createTextRange();
range.collapse(true);
range.moveEnd('character', pos);
range.moveStart('character', pos);
range.select();
}
};
}

/* SOURCE FILE: widget.js (1dc8435e) 10/26/2014 1:27:06 PM */

(function(CM) {
function getInputEl(item) {
var itemEl = item.getElement();
return $('input[name=textbox1_item_' + item.itemKey + ']', itemEl).get(0);
}
function match(page, item, content) {
if (item.isResponseType('keyboard custom') ||
item.isResponseType('keyboard alphabetical')) {
var id = 'keyboard_' + item.position;
var el = getInputEl(item);
if (el) {
return new CM.WidgetConfig(id, el);
}
}
return false;
}
function Widget_WB(page, item) {
}
CM.registerWidget('wordbuilder', Widget_WB, match);
Widget_WB.prototype.load = function () {
var item = this.entity;
var inputEl = this.element;
var keyboardEl = document.getElementById('keyboard_' + item.position);
if (keyboardEl == null || inputEl == null) return;
var wb = new WordBuilder(keyboardEl, inputEl);
wb.activate();
CM.setReadOnlyKeyEvent(item, inputEl);
if (item.value != null) {
inputEl.value = item.value;
}
var ariaTag = inputEl.getAttribute('data-desc');
if (ariaTag) {
inputEl.removeAttribute('data-desc');
inputEl.setAttribute('aria-label', ariaTag);
}
keyboardEl.setAttribute('aria-hidden', true);
keyboardEl.setAttribute('role', 'presentation');
var accProps = Accommodations.Manager.getCurrentProps();
if (accProps.isStreamlinedMode()) {
$('.keydisplay').children('a').attr('tabIndex', '-1');
}
}
Widget_WB.prototype.focus = function() {
CM.focus(this.element);
}
Widget_WB.prototype.isResponseAvailable = function () {
return getInputEl(this.entity) != null;
}
Widget_WB.prototype.getResponse = function() {
var value = this.element.value;
var isValid = (value.length > 0) ? true : false;
return this.createResponse(value, isValid);
}
Widget_WB.prototype.setResponse = function(value) {
this.element.value = value;
}
})(window.ContentManager);

/* SOURCE FILE: widget.js (1fb2a225) 9/9/2014 2:09:01 PM */

(function(CM) {
function match(page, item) {
var id = 'Item_Response_' + item.position;
var el = document.getElementById(id);
if (el) {
return new CM.WidgetConfig(id, el);
}
return false;
}
function Widget_PT(page, item) {
}
CM.registerWidget('plaintext', Widget_PT, match);
Widget_PT.prototype.load = function () {
var item = this.entity;
var inputEl = this.element;
inputEl.setAttribute('aria-required', 'true');
item.addComponent(inputEl);
CM.setReadOnlyKeyEvent(item, inputEl);
}
Widget_PT.prototype.focus = function() {
}
Widget_PT.prototype.blur = function () {
}
Widget_PT.prototype.isResponseAvailable = function () {
return this.element != null;
}
Widget_PT.prototype.getResponse = function() {
var value = this.element.value;
var isValid = value.length > 0;
if (value) {
value = value.replace(/]]>/g, ']]&gt;');
}
return this.createResponse(value, isValid);
}
Widget_PT.prototype.setResponse = function (value) {
this.element.value = value;
}
})(window.ContentManager);

